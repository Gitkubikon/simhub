import{e as g,a as P,b as l,af as u,ag as b,ah as v,ai as x}from"./index-DG8rgzil.js";const m=d=>{let r=class extends d{_validateFetchPopupFeatures(t){const{layer:a}=this,{popupEnabled:p}=a;if(!p)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:a});if(!u(a,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:a})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,a){if(this._validateFetchPopupFeatures(a),t.length===0)return[];const p=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=b(this.layer.fieldsIndex,await v(p,u(this.layer,a)))),await this.prepareFetchPopupFeatures(i);const o=new Set,n=[],s=[];for(const e of t)x(i,e,o)?s.push(e):n.push(e);if(s.length===0)return n;const c=new Map;for(let e=0;e<t.length;e++)c.set(t[e].getObjectId()??0,e);const h=await this.whenGraphicAttributes(s,[...o]).catch(()=>s).then(e=>n.concat(e));return h.sort((e,y)=>{const f=e.getObjectId()??0,w=c.get(f)??0,F=y.getObjectId()??0;return w-(c.get(F)??0)}),h}};return r=g([P("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{m as i};
