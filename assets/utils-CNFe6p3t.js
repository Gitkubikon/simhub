import{eO as e,ez as t,eP as a,eQ as r,eN as o,eG as i,b as n,eR as s,eL as p}from"./index-DSIPxOWi.js";function l(e,t,a){const r=a(e);if(!r.isValid)throw new n(`${t}:invalid-parameters`,r.errorMessage,{layer:e})}async function m(e){const{layer:t,errorNamePrefix:a,validateLayer:r}=e;await t.load(),l(t,a,r)}function c(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function u(e){const{item:t,errorNamePrefix:a,layer:r,validateItem:o}=e;if(s(t),function f(e){const{item:t,itemType:a,additionalItemType:r,errorNamePrefix:o,layer:i}=e,s=[a];if(r&&s.push(r),!s.includes(t.type)){const e=s.map((e=>`'${e}'`)).join(", ");throw new n(`${o}:portal-item-wrong-type`,`Portal item type should be one of: "${e}"`,{item:t,layer:i})}}(e),o){const e=o(t);if(!e.isValid)throw new n(`${a}:invalid-parameters`,e.errorMessage,{layer:r})}}function d(e){const{layer:t,errorNamePrefix:a}=e,{portalItem:r}=t;if(!r)throw new n(`${a}:portal-item-not-set`,c(t,"requires the portalItem property to be set"));if(!r.loaded)throw new n(`${a}:portal-item-not-loaded`,c(t,"cannot be saved to a portal item that does not exist or is inaccessible"));u({...e,item:r})}function y(a){const{newItem:r,itemType:o}=a;let i=e.from(r);return i.id&&(i=i.clone(),i.id=null),i.type??(i.type=o),i.portal??(i.portal=t.getDefault()),u({...a,item:i}),i}function w(e){return a(e,"portal-item")}async function I(e,t,a){var o;"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const i=e.write({},t);return await Promise.all((null==(o=t.resources)?void 0:o.pendingOperations)??[]),r(t,{errorName:"layer-write:unsupported"},a),i}function v(e){o(e,p.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function P(e,t,a){var r;const o=e.portal;await o.signIn(),await(null==(r=o.user)?void 0:r.addItem({item:e,data:t,folder:null==a?void 0:a.folder}))}async function $(e,t){const{layer:a,createItemData:r,createJSONContext:o,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e),d(e);const x=a.portalItem,N=o?o(x):w(x),h=await I(a,N,{...t,supplementalUnsupportedErrors:p}),b=await r({layer:a,layerJSON:h},x);return await(null==n?void 0:n(a,x)),v(x),await x.update({data:b}),i(N),await(null==s?void 0:s(x,N)),x}async function j(e,t){const{layer:a,createItemData:r,createJSONContext:o,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e);const x=y(e),N=o?o(x):w(x),h=await I(a,N,{...t,supplementalUnsupportedErrors:p}),b=await r({layer:a,layerJSON:h},x);return await n(a,x),v(x),await P(x,b,t),a.portalItem=x,i(N),await(null==s?void 0:s(x,N)),x}export{$,I,P,c,d,j,l,v,w,y};
