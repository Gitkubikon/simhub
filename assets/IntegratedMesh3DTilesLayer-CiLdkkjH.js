import{en as e,eo as t,ep as i,g4 as a,eq as s,gc as r,gd as n,I as o,az as l,ge as p,bM as y,cx as d,dD as h,cy as c,du as f,fE as m,gf as u,gg as g,gh as v,gi as x,b,er as A,bZ as w,gj as _,gk as E,n as I,gl as L,e as M,y as S,gm as T,ev as R,a as D,Z as N,Q as j}from"./index-DSIPxOWi.js";let z=class extends(e(t(i(a(s(r(n(N)))))))){constructor(e){super(e),this.operationalLayerType="IntegratedMesh3DTilesLayer",this.spatialReference=new o({wkid:4326,vcsWkid:115700}),this.fullExtent=new l(-180,-90,180,90,this.spatialReference),this.url=null,this.type="integrated-mesh-3dtiles",this.path=null,this.minScale=0,this.maxScale=0}set elevationInfo(e){this._set("elevationInfo",e),this._validateElevationInfo()}_verifyArray(e,t){if(!Array.isArray(e)||e.length<t)return!1;for(const i of e)if("number"!=typeof i)return!1;return!0}_initFullExtent(e){var t,i;const a=null==(t=e.root)?void 0:t.boundingVolume;if(!a)return;if(a.box){const e=null==a?void 0:a.box;if(e[3]>7972671&&e[7]>7972671&&e[11]>7945940)return}const s=null==(i=e.root)?void 0:i.transform,r=j();if(a.region&&this._verifyArray(a.region,6)){const e=a.region,t=p(e[0]),i=p(e[1]),s=e[4],r=p(e[2]),n=p(e[3]),o=e[5];this.fullExtent=new l({xmin:t,ymin:i,zmin:s,xmax:r,ymax:n,zmax:o,spatialReference:this.spatialReference})}else if(a.sphere&&this._verifyArray(a.sphere,4)){const e=a.sphere,t=y(e[0],e[1],e[2]),i=e[3]/Math.sqrt(3),n=j();d(n,t,y(i,i,i));const p=j();if(h(p,t,y(i,i,i)),s&&this._verifyArray(s,16)){const e=s;c(r,n,e),f(n,r),c(r,p,e),f(p,r)}m(n,u,0,n,o.WGS84,0,1),m(p,u,0,p,o.WGS84,0,1);const x=j(),b=j();g(x,n,p),v(b,n,p),this.fullExtent=new l({xmin:x[0],ymin:x[1],zmin:x[2],xmax:b[0],ymax:b[1],zmax:b[2],spatialReference:this.spatialReference})}else if(a.box&&this._verifyArray(a.box,12)){const e=a.box,t=y(e[0],e[1],e[2]),i=y(e[3],e[4],e[5]),r=y(e[6],e[7],e[8]),n=y(e[9],e[10],e[11]),p=[];for(let a=0;a<8;++a)p.push(j());if(h(p[0],t,i),h(p[0],p[0],r),h(p[0],p[0],n),x(p[1],t,i),h(p[1],p[1],r),h(p[1],p[1],n),h(p[2],t,i),x(p[2],p[2],r),h(p[2],p[2],n),x(p[3],t,i),x(p[3],p[3],r),h(p[3],p[3],n),h(p[4],t,i),h(p[4],p[4],r),x(p[4],p[4],n),x(p[5],t,i),h(p[5],p[5],r),x(p[5],p[5],n),h(p[6],t,i),x(p[6],p[6],r),x(p[6],p[6],n),x(p[7],t,i),x(p[7],p[7],r),x(p[7],p[7],n),s&&this._verifyArray(s,16)){const e=s;for(let t=0;t<8;++t)c(p[t],p[t],e)}const d=y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let a=0;a<8;++a)m(p[a],u,0,p[a],o.WGS84,0,1),g(f,f,p[a]),v(d,d,p[a]);this.fullExtent=new l({xmin:f[0],ymin:f[1],zmin:f[2],xmax:d[0],ymax:d[1],zmax:d[2],spatialReference:this.spatialReference})}}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=null!=e?e.signal:null;try{await this.loadFromPortal({supportedTypes:["3DTiles Service"],validateItem:e=>{var t;if(null==(t=e.typeKeywords)?void 0:t.includes("IntegratedMesh"))return!0;throw new b("portal:invalid-layer-item-type","Invalid layer item, expected '${expectedType}' ",{expectedType:"3DTiles Service containing IntegratedMesh"})}},e)}catch(i){A(i)}if(this.url){const e=w(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then((e=>{this._initFullExtent(e.data)}),(e=>{A(e)}));await e}}async fetchAttributionData(){return this.load().then((()=>({})))}_validateElevationInfo(){const e=this.elevationInfo,t="Integrated mesh 3d tiles layers";_(I.getLogger(this),E(t,"absolute-height",e)),_(I.getLogger(this),L(t,e))}};M([S({type:["IntegratedMesh3DTilesLayer"]})],z.prototype,"operationalLayerType",void 0),M([S({type:o})],z.prototype,"spatialReference",void 0),M([S({type:l})],z.prototype,"fullExtent",void 0),M([S(T)],z.prototype,"elevationInfo",null),M([S({type:["show","hide"]})],z.prototype,"listMode",void 0),M([S(R)],z.prototype,"url",void 0),M([S({readOnly:!0})],z.prototype,"type",void 0),M([S({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],z.prototype,"path",void 0),M([S({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:!1,write:!1}}}})],z.prototype,"minScale",void 0),M([S({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:!1,write:!1}}}})],z.prototype,"maxScale",void 0),z=M([D("esri.layers.IntegratedMesh3DTilesLayer")],z);const V=z;export{V as default};
