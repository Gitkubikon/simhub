import{a as e,s as t,am as i,an as s,b as o,x as l,a8 as r,a5 as a,af as n,ao as h}from"./Theme-BWSWhkMY.js";class p extends e{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let e=this.width(),t=this.height();if(e>0&&t>0){let i=this.get("cornerRadius",8);i=h(i,0,Math.min(e/2,t/2));let s=this.get("pointerX",0),o=this.get("pointerY",0),l=this.get("pointerBaseWidth",15)/2,r=0,a=0,n=0,d=(s-r)*(t-a)-(o-a)*(e-r),g=(s-n)*(0-t)-(o-t)*(e-n);const b=this._display;if(b.moveTo(i,0),d>0&&g>0){let t=Math.round(h(s,i+l,e-l-i));o=h(o,-1/0,0),b.lineTo(t-l,0),b.lineTo(s,o),b.lineTo(t+l,0)}if(b.lineTo(e-i,0),b.arcTo(e,0,e,i,i),d>0&&g<0){let r=Math.round(h(o,i+l,t-l-i));s=h(s,e,1/0),b.lineTo(e,i),b.lineTo(e,Math.max(r-l,i)),b.lineTo(s,o),b.lineTo(e,r+l)}if(b.lineTo(e,t-i),b.arcTo(e,t,e-i,t,i),d<0&&g<0){let r=Math.round(h(s,i+l,e-l-i));o=h(o,t,1/0),b.lineTo(e-i,t),b.lineTo(r+l,t),b.lineTo(s,o),b.lineTo(r-l,t)}if(b.lineTo(i,t),b.arcTo(0,t,0,t-i,i),d<0&&g>0){let e=Math.round(h(o,i+l,t-i-l));s=h(s,-1/0,0),b.lineTo(0,t-i),b.lineTo(0,e+l),b.lineTo(s,o),b.lineTo(0,Math.max(e-l,i))}b.lineTo(0,i),b.arcTo(0,0,i,0,i),b.closePath()}}}}Object.defineProperty(p,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(p,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:e.classNames.concat([p.className])});class u extends t{constructor(e,t,i,s=[]){super(e,t,i,s),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=i(this._settings.themeTags,["tooltip"]),super._afterNew(),this._setDefaultFn("background",(()=>p.new(this._root,{}))).set("themeTags",["tooltip","background"]),this._label=this.children.push(s.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",(()=>{this._updateBackground()}))),this._disposers.push(this.on("bounds",(()=>{this._updateBackground()}))),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",(e=>{e&&(this._disposers.push(o(e,"pointerover",(e=>{this._htmlContentHovered=!0}))),this._disposers.push(o(e,"pointerout",(e=>{this._htmlContentHovered=!1}))))}))),this.on("visible",(e=>{this._handleReaderAnnouncement()})),this.label.events.on("dataitemchanged",(e=>{this._handleReaderAnnouncement()})),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}dispose(){super.dispose(),l(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),null!=this.get("labelText")&&this.label.set("text",this.get("labelText")),null!=this.get("labelHTML")&&this.label.set("html",this.get("labelHTML")),null!=this.get("labelAriaLabel")&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){const e=this.get("background");this._keepHoverDp=new r([e.events.on("pointerover",(e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),t.hover())})),e.events.on("pointerout",(e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),this._htmlContentHovered||t.unhover())}))]),this.label.onPrivate("htmlElement",(t=>{this._keepHoverDp&&t&&this._keepHoverDp.disposers.push(o(t,"pointerleave",(t=>{const i=this.root._renderer.getEvent(t);e.events.dispatch("pointerout",{type:"pointerout",originalEvent:i.event,point:i.point,simulated:!1,target:e})})))}))}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let e=this.get("tooltipTarget");const t=this.get("background");let i,s;e&&t&&(i=e.get("fill"),s=e.get("stroke"),null==i&&(i=s),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),null!=i&&t.set("fill",i),this._fillDp=e.on("fill",(e=>{null!=e&&(t.set("fill",e),this._updateTextColor(e))})),this._disposers.push(this._fillDp)),this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),null!=i&&t.set("stroke",i),this._strokeDp=e.on("fill",(e=>{null!=e&&t.set("stroke",e)})),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),null!=i&&this.label.set("fill",i),this._labelDp=e.on("fill",(e=>{null!=e&&this.label.set("fill",e)})),this._disposers.push(this._labelDp))),this._updateTextColor(i)}_updateTextColor(e){this.get("autoTextColor")&&(null==e&&(e=this.get("background").get("fill")),null==e&&(e=this._root.interfaceColors.get("background")),e instanceof a&&this.label.set("fill",a.alternative(e,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(e){super._setDataItem(e),this.label._setDataItem(e)}_updateBackground(){super.updateBackground();const e=this._root.container;if(e){let t=.5,i=.5,s=this.get("centerX");s instanceof n&&(t=s.value);let o=this.get("centerY");o instanceof n&&(i=o.value);let l=e.width(),r=e.height(),a=this.parent,d=0,g=0;if(a){d=a.x(),g=a.y();const e=a.get("layerMargin");e&&(d+=e.left||0,g+=e.top||0,l+=(e.left||0)+(e.right||0),r+=(e.top||0)+(e.bottom||0))}const b=this.get("bounds",{left:-d,top:-g,right:l-d,bottom:r-g});this._updateBounds();let c=this.width(),_=this.height();0===c&&(c=this._w),0===_&&(_=this._h);let f=this.get("pointTo",{x:l/2,y:r/2}),m=f.x,v=f.y,T=this.get("pointerOrientation"),y=this.get("background"),D=0,k=0,w=0;y instanceof p&&(D=y.get("pointerLength",0),k=y.get("strokeWidth",0)/2,w=k,y.set("width",c),y.set("height",_));let x=0,P=0,C=b.right-b.left,O=b.bottom-b.top;"horizontal"==T||"left"==T||"right"==T?(k=0,"horizontal"==T?m>b.left+C/2?(m-=c*(1-t)+D,w*=-1):m+=c*t+D:"left"==T?m+=c*(1-t)+D:(m-=c*t+D,w*=-1)):(w=0,"vertical"==T?v>b.top+_/2+D?v-=_*(1-i)+D:(v+=_*i+D,k*=-1):"down"==T?v-=_*(1-i)+D:(v+=_*i+D,k*=-1)),m=h(m,b.left+c*t,b.left+C-c*(1-t))+w,v=h(v,b.top+_*i,b.top+O-_*(1-i))-k,x=f.x-m+c*t+w,P=f.y-v+_*i-k,this._fx=m,this._fy=v;const H=this.get("animationDuration",0);if(H>0&&this.get("visible")&&this.get("opacity")>.1){const e=this.get("animationEasing");this.animate({key:"x",to:m,duration:H,easing:e}),this.animate({key:"y",to:v,duration:H,easing:e})}else this.set("x",m),this.set("y",v);y instanceof p&&(y.set("pointerX",x),y.set("pointerY",P)),c>0&&(this._w=c),_>0&&(this._h=_)}}}Object.defineProperty(u,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(u,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:t.classNames.concat([u.className])});export{u};
