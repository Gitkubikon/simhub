const __vite__fileDeps=["assets/IdentityManager-h5X-3O1R.js","assets/substitute-DBNnxKeF.js","assets/statsWorker-Dv0jT8Zm.js","assets/utils-B-uQJqPz.js","assets/utils-DEUXBrCj.js","assets/utils-1_4Re7um.js","assets/ClassBreaksDefinition-Dt1HCCB7.js","assets/geometryEngineWorker-D-miBz2b.js","assets/geometryEngineJSON-CrXS8d22.js","assets/geometryEngineBase-9EI9fooq.js","assets/json-omtrO2vq.js","assets/CSVSourceWorker-UHVPdeeS.js","assets/date-Do_V47iR.js","assets/FeatureStore-Dpo5Syxq.js","assets/BoundsStore-BQ0MOdb7.js","assets/PooledRBush-DOZnXWx2.js","assets/quickselect-D9ta8ndX.js","assets/QueryEngine-DAD9skS_.js","assets/normalizeUtils-BrH-PrZy.js","assets/normalizeUtilsCommon-BU8xfl77.js","assets/WhereClause-DYd7Xwn9.js","assets/TimeOnly-C5lZbbIX.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/optimizedFeatureQueryEngineAdapter--U1rvwBV.js","assets/number-DXNV0RYc.js","assets/clientSideDefaults-Cn_svm8L.js","assets/EdgeProcessingWorker-L1RiCQIR.js","assets/workerHelper-CgQLvwGd.js","assets/ElevationSamplerWorker-BsHkmm6W.js","assets/vertexSpaceConversion-C_GU75pR.js","assets/FeatureServiceSnappingSourceWorker-D4YYjILh.js","assets/symbologySnappingCandidates-Cl8kN1ha.js","assets/pbfQueryUtils-DUjEbwA9.js","assets/pbf-B53Txr8m.js","assets/query-C2USZ63O.js","assets/GeoJSONSourceWorker-DnSqbUGS.js","assets/geojson-CFL0cZN1.js","assets/sourceUtils-BFIlJ45V.js","assets/MemorySourceWorker-ey2R9wYK.js","assets/objectIdUtils-Djb6_mZK.js","assets/PBFDecoderWorker-dDXUnLGY.js","assets/FeaturePipelineWorker-v730mzdu.js","assets/TurboLine-C4MsOSzA.js","assets/constants-D5zmR9t2.js","assets/Rect-3ZUgN72u.js","assets/ogcFeatureUtils-BnWXFknr.js","assets/StreamFeatureManager-BCRzo0LN.js","assets/createConnection-BF5tMznP.js","assets/PointCloudWorker-BrKtBccU.js","assets/PointCloudWorkerUtil-BvnCwL7b.js","assets/PointCloudUniqueValueRenderer-CAfl8sj6.js","assets/RasterWorker-CiaEcTjx.js","assets/dataUtils-DNEwlV4z.js","assets/PolynomialTransform-8quIBSKZ.js","assets/rasterProjectionHelper-WTn80RSY.js","assets/SceneLayerWorker-B2gy9gVB.js","assets/I3SNode-mlgend4K.js","assets/WFSSourceWorker-DfHKtVDj.js","assets/wfsUtils-fdslda3j.js","assets/xmlUtils-DL7icO0w.js","assets/WorkerTileHandler-kWQfTgZe.js","assets/Lyr3DWorker-BEIINypx.js","assets/ILyr3DWasmPerSceneView-Cbzithql.js","assets/Lyr3DModule-BbMpFjW9.js","assets/Popup-BfGhmo2X.js","assets/unitFormatUtils-B9MPZ1wj.js","assets/AttachmentInfo-u2TyaLjZ.js","assets/executeQueryJSON-DDi8KdIf.js","assets/ReactiveSet-XbWJTkHf.js","assets/ElevationLayer-Cl972X1d.js","assets/LercDecoder-Bc-3KfiY.js","assets/WorkerHandle-Bq2affGI.js","assets/layersCreator-CnQujQsO.js","assets/portalLayers-CiL_1SNh.js","assets/fetchService-CJQ8-6Ub.js","assets/arcgisLayers-CGTLBiNd.js","assets/arcadeUtils-CHsZDnQG.js","assets/ImmutableArray-BLzlMo4D.js","assets/hash-BjBdcEEU.js","assets/TileLayerView3D-BkvAktpX.js","assets/LayerView3D-ApO6iJqK.js","assets/TiledLayerView3D-BIihePS5.js","assets/fetchTile-D6sSdSlv.js","assets/LayerView-DMoB2q_T.js","assets/RefreshableLayerView-MYyyoaX8.js","assets/MapServiceLayerViewHelper-B9RVlFpw.js","assets/floorFilterUtils-2NbRkqHK.js","assets/drapedUtils-DOQFzwPw.js","assets/sublayerUtils-DIUcTD2L.js","assets/ElevationLayerView3D-D1kuWQpa.js","assets/BaseDynamicLayerView3D-DbAanppG.js","assets/DynamicLayerView3D-C51-uYFg.js","assets/projectExtentUtils-KG39_WUt.js","assets/ImageMaterial.glsl-V3C9c4TG.js","assets/BuildingSceneLayerView3D-BXyS7FXi.js","assets/I3SMeshView3D-DvgHMyu_.js","assets/Transform-A6X0mfYo.js","assets/RenderTexture-DbJC7CTU.js","assets/I3SOverrides-CXcxzPSI.js","assets/meshFeatureSet-BNHS2qnT.js","assets/Mesh-BS04vQSz.js","assets/MeshTransform-Y0ppddED.js","assets/External-Djr0rIk9.js","assets/infoFor3D-BTCPmnmy.js","assets/FeatureLayerView3D-C33G2_Ur.js","assets/FeatureLayerViewBase3D-BxcSlUqN.js","assets/HeatmapDensity.glsl-jGaN0eX9.js","assets/timeSupport-CU-EQyfu.js","assets/dehydratedFeatureComparison-dI04k89u.js","assets/queryForSymbologySnapping-CEKgwdf_.js","assets/Graphics3DObjectStates-B77mD6jz.js","assets/EventedSet-D3TBRYG7.js","assets/SceneModification-yCQPZUfb.js","assets/persistable-Bz3xp-b5.js","assets/resourceExtension-BScMZjEL.js","assets/makeScheduleFunction-Cc-EjyuG.js","assets/I3SQueryFeatureStore-BUMvs8o8.js","assets/TemporalSceneLayerView-BafFz-f2.js","assets/CatalogLayerView3D-CmqZrAt9.js","assets/CatalogDynamicGroupLayerView3D-Ch7uP-FH.js","assets/CatalogFootprintLayerView3D-BZ-DgcyO.js","assets/CSVLayerView3D-Ci3mbuCn.js","assets/DimensionLayerView3D-DWm0ssSo.js","assets/GeoJSONLayerView3D-D5fnqN20.js","assets/GraphicsLayerView3D-B3FxZS09.js","assets/GraphicsProcessor-B-W2SKph.js","assets/GroupLayerView-DNsp_O6J.js","assets/ImageryLayerView3D-Bbb2O7MC.js","assets/IntegratedMeshLayerView3D-7o5s9Hf_.js","assets/IntegratedMesh3DTilesLayerView3D-xPlEfqBo.js","assets/LineOfSightLayerView3D-BnaPY1US.js","assets/MapImageLayerView3D-B6DELmcb.js","assets/ExportImageParameters-Bjx0Q-yu.js","assets/MediaLayerView3D-D6RJug-G.js","assets/MediaElementView-DU1VM6lV.js","assets/normalizeUtilsSync-B5F66Zka.js","assets/keybindings-DkkJsHdp.js","assets/SnappingManagerPool-BslN_FM5.js","assets/geodesicLengthMeasurementUtils-Pq-FipkN.js","assets/geometryEngine-Bp1TD6MM.js","assets/hydrated-DE1HcVsK.js","assets/geometry2dUtils-4c9qUvJ6.js","assets/OGCFeatureLayerView3D-B1VzOeSO.js","assets/PointCloudLayerView3D-Cx5jye9T.js","assets/PopupSceneLayerView-Cv6_Wug9.js","assets/VoxelLayerView3D-DkXg5bU6.js","assets/RouteLayerView3D-9kb31CFs.js","assets/Stop-DYKHva0u.js","assets/SceneLayerView3D-Bn1aAvVW.js","assets/SceneLayerView-DRJlFU-M.js","assets/SceneLayerGraphicsView3D-DBRckUke.js","assets/StreamLayerView3D-Byd3_Wih.js","assets/ImageryTileLayerView3D-MJ5zBNDs.js","assets/VectorTileLayerView3D-hkBK8Xx7.js","assets/vec4f32-APunXZaC.js","assets/WFSLayerView3D-Craup2MT.js","assets/WMSLayerView3D-BrGZlLgm.js","assets/ExportWMSImageParameters-QCOpDXr6.js","assets/WMTSLayerView3D-C7eHNiKi.js","assets/AreaMeasurementAnalysisView3D-4gp_1Skz.js","assets/interfaces-BqQPACG7.js","assets/TextOverlayItem-BcN_gvXw.js","assets/AnalysisView3D-CNsY6W7Z.js","assets/euclideanAreaMeasurementUtils-D_-Y3voK.js","assets/projectionUtils-B1mpMSec.js","assets/EditGeometryOperations-sseMUvB1.js","assets/Segment-ByPzCwlk.js","assets/LineVisualElement-EjMrPPob.js","assets/DimensionAnalysisView3D-rpfIQ-hz.js","assets/LengthDimension-CqUogCKq.js","assets/SnappingOperation-CpAicAwN.js","assets/ExtendedLineVisualElement-C_fk7Jva.js","assets/EngineVisualElement-Cxk2Aaf7.js","assets/Laserlines.glsl-C_dc6leb.js","assets/PointVisualElement-kTFgcxXB.js","assets/RightAngleQuadVisualElement-CPtUkCyd.js","assets/PointSnappingHint-Ct-FTQTL.js","assets/ShadedColorMaterial.glsl-C-XXTK_B.js","assets/dragEventPipeline3D-C-8mYpU2.js","assets/memoize-Dzy0sPL8.js","assets/Factory-CfOltYNW.js","assets/analysisViewUtils-9rYF9O9W.js","assets/ToolIntersector-ChuFIaMQ.js","assets/DirectLineMeasurementAnalysisView3D-BfXIjrBJ.js","assets/LineOfSightAnalysisView3D-DfHTTTJq.js","assets/LineOfSightAnalysisTarget-DgKp4JZr.js","assets/manipulatorUtils-ypp-R_oV.js","assets/SliceAnalysisView3D-CAKnYQzy.js","assets/SlicePlaneMaterial.glsl-AaZx_lGc.js","assets/sliceToolConfig-Doq59PhP.js","assets/ViewshedAnalysisView3D-CaO3x2iV.js","assets/MoveManipulation-4UnOjdbg.js","assets/TerrainTileTree3DDebugger-B78FfYtA.js","assets/TileTreeDebugger-CDFY3SV7.js","assets/EdgeView-DFiD3E-9.js","assets/EdgeWorkerHandle-BFdu_J0U.js","assets/Lyr3DWasmPerSceneView-w0kAfvDk.js","assets/calcite-button-BNKeIR-C.js","assets/form-BR8JUNQO.js","assets/dom-CG95YN3b.js","assets/guid-DBupVat2.js","assets/interactive-Dv2N9_bt.js","assets/label-B0K2ZKoz.js","assets/component-BaDXbCam.js","assets/loadable-TuT7-EDA.js","assets/t9n-Dkvwz2Wg.js","assets/key-Bjfr4614.js","assets/observers-4D3dvPBC.js","assets/icon-DN35inCc.js","assets/loader-DnD0exo2.js","assets/calcite-icon-I_Xwj0DW.js","assets/FeatureTileTree3DDebugger-DM1PlW85.js","assets/GraphicsView3D-D-zmwbfX.js","assets/layersLoader-BOfTpi_L.js","assets/editingSupport-BNx5CWnq.js","assets/featureLayerUtils-BsNTakUV.js","assets/utils-CNFe6p3t.js","assets/FeatureLayerSource-CSPBNDDE.js","assets/QueryTask-D61WShEy.js","assets/executeForIds-vkxYbvNq.js","assets/executeQueryPBF-71YCUWAF.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe=Object.defineProperty,__publicField=(fe,ve,_e)=>((fe,ve,_e)=>ve in fe?Oe(fe,ve,{enumerable:!0,configurable:!0,writable:!0,value:_e}):fe[ve]=_e)(fe,"symbol"!=typeof ve?ve+"":ve,_e);function noop(){}!function polyfill(){const fe=document.createElement("link").relList;if(!(fe&&fe.supports&&fe.supports("modulepreload"))){for(const fe of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(fe);new MutationObserver((fe=>{for(const ve of fe)if("childList"===ve.type)for(const fe of ve.addedNodes)"LINK"===fe.tagName&&"modulepreload"===fe.rel&&processPreload(fe)})).observe(document,{childList:!0,subtree:!0})}function processPreload(fe){if(fe.ep)return;fe.ep=!0;const ve=function getFetchOpts(fe){const ve={};return fe.integrity&&(ve.integrity=fe.integrity),fe.referrerPolicy&&(ve.referrerPolicy=fe.referrerPolicy),"use-credentials"===fe.crossOrigin?ve.credentials="include":"anonymous"===fe.crossOrigin?ve.credentials="omit":ve.credentials="same-origin",ve}(fe);fetch(fe.href,ve)}}();const identity=fe=>fe;function run(fe){return fe()}function blank_object(){return Object.create(null)}function run_all(fe){fe.forEach(run)}function is_function(fe){return"function"==typeof fe}function safe_not_equal(fe,ve){return fe!=fe?ve==ve:fe!==ve||fe&&"object"==typeof fe||"function"==typeof fe}let Re;function src_url_equal(fe,ve){return fe===ve||(Re||(Re=document.createElement("a")),Re.href=ve,fe===Re.href)}function create_slot(fe,ve,_e,be){if(fe){const we=get_slot_context(fe,ve,_e,be);return fe[0](we)}}function get_slot_context(fe,ve,_e,be){return fe[1]&&be?function assign(fe,ve){for(const _e in ve)fe[_e]=ve[_e];return fe}(_e.ctx.slice(),fe[1](be(ve))):_e.ctx}function get_slot_changes(fe,ve,_e,be){if(fe[2]&&be){const we=fe[2](be(_e));if(void 0===ve.dirty)return we;if("object"==typeof we){const fe=[],_e=Math.max(ve.dirty.length,we.length);for(let be=0;be<_e;be+=1)fe[be]=ve.dirty[be]|we[be];return fe}return ve.dirty|we}return ve.dirty}function update_slot_base(fe,ve,_e,be,we,Se){if(we){const Te=get_slot_context(ve,_e,be,Se);fe.p(Te,we)}}function get_all_dirty_from_scope(fe){if(fe.ctx.length>32){const ve=[],_e=fe.ctx.length/32;for(let fe=0;fe<_e;fe++)ve[fe]=-1;return ve}return-1}function null_to_empty(fe){return null==fe?"":fe}const De="undefined"!=typeof window;let Be=De?()=>window.performance.now():()=>Date.now(),Ze=De?fe=>requestAnimationFrame(fe):noop;const Xe=new Set;function run_tasks(fe){Xe.forEach((ve=>{ve.c(fe)||(Xe.delete(ve),ve.f())})),0!==Xe.size&&Ze(run_tasks)}function append(fe,ve){fe.appendChild(ve)}function get_root_for_style(fe){if(!fe)return document;const ve=fe.getRootNode?fe.getRootNode():fe.ownerDocument;return ve&&ve.host?ve:fe.ownerDocument}function append_empty_stylesheet(fe){const ve=element("style");return ve.textContent="/* empty */",function append_stylesheet(fe,ve){return append(fe.head||fe,ve),ve.sheet}(get_root_for_style(fe),ve),ve.sheet}function insert(fe,ve,_e){fe.insertBefore(ve,_e||null)}function detach(fe){fe.parentNode&&fe.parentNode.removeChild(fe)}function destroy_each(fe,ve){for(let _e=0;_e<fe.length;_e+=1)fe[_e]&&fe[_e].d(ve)}function element(fe){return document.createElement(fe)}function text(fe){return document.createTextNode(fe)}function space(){return text(" ")}function empty(){return text("")}function attr(fe,ve,_e){null==_e?fe.removeAttribute(ve):fe.getAttribute(ve)!==_e&&fe.setAttribute(ve,_e)}function set_data(fe,ve){ve=""+ve,fe.data!==ve&&(fe.data=ve)}function set_style(fe,ve,_e,be){null==_e?fe.style.removeProperty(ve):fe.style.setProperty(ve,_e,be?"important":"")}function custom_event(fe,ve,{bubbles:_e=!1,cancelable:be=!1}={}){return new CustomEvent(fe,{detail:ve,bubbles:_e,cancelable:be})}const Je=new Map;let Qe,dt=0;function create_rule(fe,ve,_e,be,we,Se,Te,Ee=0){const Ce=16.666/be;let Oe="{\n";for(let Je=0;Je<=1;Je+=Ce){const fe=ve+(_e-ve)*Se(Je);Oe+=100*Je+`%{${Te(fe,1-fe)}}\n`}const Re=Oe+`100% {${Te(_e,1-_e)}}\n}`,De=`__svelte_${function hash(fe){let ve=5381,_e=fe.length;for(;_e--;)ve=(ve<<5)-ve^fe.charCodeAt(_e);return ve>>>0}(Re)}_${Ee}`,Be=get_root_for_style(fe),{stylesheet:Ze,rules:Xe}=Je.get(Be)||function create_style_information(fe,ve){const _e={stylesheet:append_empty_stylesheet(ve),rules:{}};return Je.set(fe,_e),_e}(Be,fe);Xe[De]||(Xe[De]=!0,Ze.insertRule(`@keyframes ${De} ${Re}`,Ze.cssRules.length));const Qe=fe.style.animation||"";return fe.style.animation=`${Qe?`${Qe}, `:""}${De} ${be}ms linear ${we}ms 1 both`,dt+=1,De}function delete_rule(fe,ve){const _e=(fe.style.animation||"").split(", "),be=_e.filter(ve?fe=>fe.indexOf(ve)<0:fe=>-1===fe.indexOf("__svelte")),we=_e.length-be.length;we&&(fe.style.animation=be.join(", "),dt-=we,dt||function clear_rules(){Ze((()=>{dt||(Je.forEach((fe=>{const{ownerNode:ve}=fe.stylesheet;ve&&detach(ve)})),Je.clear())}))}())}function set_current_component(fe){Qe=fe}function get_current_component(){if(!Qe)throw new Error("Function called outside component initialization");return Qe}function onMount(fe){get_current_component().$$.on_mount.push(fe)}const $t=[],bt=[];let wt=[];const xt=[],St=Promise.resolve();let Et=!1;function add_render_callback(fe){wt.push(fe)}const Pt=new Set;let Ot,At=0;function flush$1(){if(0!==At)return;const fe=Qe;do{try{for(;At<$t.length;){const fe=$t[At];At++,set_current_component(fe),update(fe.$$)}}catch(vr){throw $t.length=0,At=0,vr}for(set_current_component(null),$t.length=0,At=0;bt.length;)bt.pop()();for(let fe=0;fe<wt.length;fe+=1){const ve=wt[fe];Pt.has(ve)||(Pt.add(ve),ve())}wt.length=0}while($t.length);for(;xt.length;)xt.pop()();Et=!1,Pt.clear(),set_current_component(fe)}function update(fe){if(null!==fe.fragment){fe.update(),run_all(fe.before_update);const ve=fe.dirty;fe.dirty=[-1],fe.fragment&&fe.fragment.p(fe.ctx,ve),fe.after_update.forEach(add_render_callback)}}function dispatch(fe,ve,_e){fe.dispatchEvent(custom_event(`intro${_e}`))}const Mt=new Set;let Rt;function group_outros(){Rt={r:0,c:[],p:Rt}}function check_outros(){Rt.r||run_all(Rt.c),Rt=Rt.p}function transition_in(fe,ve){fe&&fe.i&&(Mt.delete(fe),fe.i(ve))}function transition_out(fe,ve,_e,be){if(fe&&fe.o){if(Mt.has(fe))return;Mt.add(fe),Rt.c.push((()=>{Mt.delete(fe),be&&(_e&&fe.d(1),be())})),fe.o(ve)}else be&&be()}const Nt={duration:0};function create_in_transition(fe,ve,_e){const be={direction:"in"};let we,Se,Te=ve(fe,_e,be),Ee=!1,Ce=0;function cleanup(){we&&delete_rule(fe,we)}function go(){const{delay:ve=0,duration:_e=300,easing:be=identity,tick:Oe=noop,css:Re}=Te||Nt;Re&&(we=create_rule(fe,0,1,_e,ve,be,Re,Ce++)),Oe(0,1);const De=Be()+ve,Je=De+_e;Se&&Se.abort(),Ee=!0,add_render_callback((()=>dispatch(fe,0,"start"))),Se=function loop(fe){let ve;return 0===Xe.size&&Ze(run_tasks),{promise:new Promise((_e=>{Xe.add(ve={c:fe,f:_e})})),abort(){Xe.delete(ve)}}}((ve=>{if(Ee){if(ve>=Je)return Oe(1,0),dispatch(fe,0,"end"),cleanup(),Ee=!1;if(ve>=De){const fe=be((ve-De)/_e);Oe(fe,1-fe)}}return Ee}))}let Oe=!1;return{start(){Oe||(Oe=!0,delete_rule(fe),is_function(Te)?(Te=Te(be),function wait(){return Ot||(Ot=Promise.resolve(),Ot.then((()=>{Ot=null}))),Ot}().then(go)):go())},invalidate(){Oe=!1},end(){Ee&&(cleanup(),Ee=!1)}}}function ensure_array_like(fe){return void 0!==(null==fe?void 0:fe.length)?fe:Array.from(fe)}function create_component(fe){fe&&fe.c()}function mount_component(fe,ve,_e){const{fragment:be,after_update:we}=fe.$$;be&&be.m(ve,_e),add_render_callback((()=>{const ve=fe.$$.on_mount.map(run).filter(is_function);fe.$$.on_destroy?fe.$$.on_destroy.push(...ve):run_all(ve),fe.$$.on_mount=[]})),we.forEach(add_render_callback)}function destroy_component(fe,ve){const _e=fe.$$;null!==_e.fragment&&(!function flush_render_callbacks(fe){const ve=[],_e=[];wt.forEach((be=>-1===fe.indexOf(be)?ve.push(be):_e.push(be))),_e.forEach((fe=>fe())),wt=ve}(_e.after_update),run_all(_e.on_destroy),_e.fragment&&_e.fragment.d(ve),_e.on_destroy=_e.fragment=null,_e.ctx=[])}function make_dirty(fe,ve){-1===fe.$$.dirty[0]&&($t.push(fe),function schedule_update(){Et||(Et=!0,St.then(flush$1))}(),fe.$$.dirty.fill(0)),fe.$$.dirty[ve/31|0]|=1<<ve%31}function init(fe,ve,_e,be,we,Se,Te=null,Ee=[-1]){const Ce=Qe;set_current_component(fe);const Oe=fe.$$={fragment:null,ctx:[],props:Se,update:noop,not_equal:we,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(ve.context||(Ce?Ce.$$.context:[])),callbacks:blank_object(),dirty:Ee,skip_bound:!1,root:ve.target||Ce.$$.root};Te&&Te(Oe.root);let Re=!1;if(Oe.ctx=_e?_e(fe,ve.props||{},((ve,_e,...be)=>{const Se=be.length?be[0]:_e;return Oe.ctx&&we(Oe.ctx[ve],Oe.ctx[ve]=Se)&&(!Oe.skip_bound&&Oe.bound[ve]&&Oe.bound[ve](Se),Re&&make_dirty(fe,ve)),_e})):[],Oe.update(),Re=!0,run_all(Oe.before_update),Oe.fragment=!!be&&be(Oe.ctx),ve.target){if(ve.hydrate){const fe=function children(fe){return Array.from(fe.childNodes)}(ve.target);Oe.fragment&&Oe.fragment.l(fe),fe.forEach(detach)}else Oe.fragment&&Oe.fragment.c();ve.intro&&transition_in(fe.$$.fragment),mount_component(fe,ve.target,ve.anchor),flush$1()}set_current_component(Ce)}class SvelteComponent{constructor(){__publicField(this,"$$"),__publicField(this,"$$set")}$destroy(){destroy_component(this,1),this.$destroy=noop}$on(fe,ve){if(!is_function(ve))return noop;const _e=this.$$.callbacks[fe]||(this.$$.callbacks[fe]=[]);return _e.push(ve),()=>{const fe=_e.indexOf(ve);-1!==fe&&_e.splice(fe,1)}}$set(fe){this.$$set&&!function is_empty(fe){return 0===Object.keys(fe).length}(fe)&&(this.$$.skip_bound=!0,this.$$set(fe),this.$$.skip_bound=!1)}}function get_each_context$3(fe,ve,_e){const be=fe.slice();return be[8]=ve[_e],be}function create_each_block$3(fe){let ve,_e,be,we,Se,Te,Ee=fe[8][0]+"";return{c(){ve=element("li"),_e=element("a"),be=text(Ee),Te=space(),attr(_e,"class",we="nav-link text-"+fe[3]+" svelte-m94b5x"),attr(_e,"href",Se=fe[8][1]),attr(ve,"class","nav-item svelte-m94b5x")},m(fe,we){insert(fe,ve,we),append(ve,_e),append(_e,be),append(ve,Te)},p(fe,ve){4&ve&&Ee!==(Ee=fe[8][0]+"")&&set_data(be,Ee),8&ve&&we!==(we="nav-link text-"+fe[3]+" svelte-m94b5x")&&attr(_e,"class",we),4&ve&&Se!==(Se=fe[8][1])&&attr(_e,"href",Se)},d(fe){fe&&detach(ve)}}}function create_fragment$8(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t,bt,wt,xt,St,Et,Pt,Ot,At,Mt,Rt,Nt,Ft,zt,kt,Bt,jt,Gt,Ht=ensure_array_like(fe[2]),qt=[];for(let Wt=0;Wt<Ht.length;Wt+=1)qt[Wt]=create_each_block$3(get_each_context$3(fe,Ht,Wt));return{c(){ve=element("div"),_e=element("nav"),be=element("div"),we=element("a"),Se=element("span"),Te=text(fe[1]),Ee=space(),Ce=element("button"),Ce.innerHTML='<i class="fas fa-bars"></i>',Oe=space(),Re=element("div"),De=element("ul");for(let fe=0;fe<qt.length;fe+=1)qt[fe].c();Be=space(),Ze=element("li"),Xe=element("a"),Je=element("i"),dt=space(),$t=element("li"),bt=element("a"),wt=element("i"),St=space(),Et=element("li"),Pt=element("a"),Ot=element("i"),Mt=space(),Rt=element("li"),Nt=element("a"),Ft=element("i"),attr(Se,"class","text-shadows"),attr(Se,"data-text",fe[1]),attr(we,"class","navbar-brand text-primary svelte-m94b5x"),attr(we,"href","/"),attr(Ce,"class","navbar-toggler svelte-m94b5x"),attr(Ce,"type","button"),attr(Ce,"aria-label","Toggle navigation"),attr(Je,"class","fab fa-facebook-f"),attr(Xe,"class",Qe="nav-link text-"+fe[3]+" svelte-m94b5x"),attr(Xe,"href","https://www.facebook.com"),attr(Xe,"target","_blank"),attr(Ze,"class","nav-item svelte-m94b5x"),attr(wt,"class","fab fa-twitter"),attr(bt,"class",xt="nav-link text-"+fe[3]+" svelte-m94b5x"),attr(bt,"href","https://www.twitter.com"),attr(bt,"target","_blank"),attr($t,"class","nav-item svelte-m94b5x"),attr(Ot,"class","fab fa-instagram"),attr(Pt,"class",At="nav-link text-"+fe[3]+" svelte-m94b5x"),attr(Pt,"href","https://www.instagram.com"),attr(Pt,"target","_blank"),attr(Et,"class","nav-item svelte-m94b5x"),attr(Ft,"class","fas fa-user"),attr(Nt,"class",zt="nav-link text-"+fe[3]+" svelte-m94b5x"),attr(Nt,"href","/profile"),attr(Rt,"class","nav-item svelte-m94b5x"),attr(De,"class","navbar-nav ms-auto mb-2 mb-lg-0"),attr(Re,"class",kt=null_to_empty("collapse navbar-collapse "+(fe[5]?"show":""))+" svelte-m94b5x"),attr(Re,"id","navbarSupportedContent"),attr(be,"class","container-fluid"),attr(_e,"class",Bt="navbar navbar-expand-lg navbar-"+fe[4]+" bg-"+fe[4]+" shadow-0 fixed-top px-3 py-3 svelte-m94b5x"),attr(_e,"id",fe[0]),attr(ve,"class","container")},m(Qe,xt){insert(Qe,ve,xt),append(ve,_e),append(_e,be),append(be,we),append(we,Se),append(Se,Te),append(be,Ee),append(be,Ce),append(be,Oe),append(be,Re),append(Re,De);for(let fe=0;fe<qt.length;fe+=1)qt[fe]&&qt[fe].m(De,null);append(De,Be),append(De,Ze),append(Ze,Xe),append(Xe,Je),append(De,dt),append(De,$t),append($t,bt),append(bt,wt),append(De,St),append(De,Et),append(Et,Pt),append(Pt,Ot),append(De,Mt),append(De,Rt),append(Rt,Nt),append(Nt,Ft),jt||(Gt=function listen(fe,ve,_e,be){return fe.addEventListener(ve,_e,be),()=>fe.removeEventListener(ve,_e,be)}(Ce,"click",fe[6]),jt=!0)},p(fe,[ve]){if(2&ve&&set_data(Te,fe[1]),2&ve&&attr(Se,"data-text",fe[1]),12&ve){let _e;for(Ht=ensure_array_like(fe[2]),_e=0;_e<Ht.length;_e+=1){const be=get_each_context$3(fe,Ht,_e);qt[_e]?qt[_e].p(be,ve):(qt[_e]=create_each_block$3(be),qt[_e].c(),qt[_e].m(De,Be))}for(;_e<qt.length;_e+=1)qt[_e].d(1);qt.length=Ht.length}8&ve&&Qe!==(Qe="nav-link text-"+fe[3]+" svelte-m94b5x")&&attr(Xe,"class",Qe),8&ve&&xt!==(xt="nav-link text-"+fe[3]+" svelte-m94b5x")&&attr(bt,"class",xt),8&ve&&At!==(At="nav-link text-"+fe[3]+" svelte-m94b5x")&&attr(Pt,"class",At),8&ve&&zt!==(zt="nav-link text-"+fe[3]+" svelte-m94b5x")&&attr(Nt,"class",zt),32&ve&&kt!==(kt=null_to_empty("collapse navbar-collapse "+(fe[5]?"show":""))+" svelte-m94b5x")&&attr(Re,"class",kt),16&ve&&Bt!==(Bt="navbar navbar-expand-lg navbar-"+fe[4]+" bg-"+fe[4]+" shadow-0 fixed-top px-3 py-3 svelte-m94b5x")&&attr(_e,"class",Bt),1&ve&&attr(_e,"id",fe[0])},i:noop,o:noop,d(fe){fe&&detach(ve),destroy_each(qt,fe),jt=!1,Gt()}}}function instance$8(fe,ve,_e){let{Id:be}=ve,{brand:we}=ve,{nav_items:Se}=ve,{state:Te}=ve,Ee="dark",Ce="light";"dark"==Te&&(Ee="light",Ce="dark");let Oe=!1;return fe.$$set=fe=>{"Id"in fe&&_e(0,be=fe.Id),"brand"in fe&&_e(1,we=fe.brand),"nav_items"in fe&&_e(2,Se=fe.nav_items),"state"in fe&&_e(7,Te=fe.state)},[be,we,Se,Ee,Ce,Oe,function toggleMenu(){_e(5,Oe=!Oe)},Te]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class Navbar extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$8,create_fragment$8,safe_not_equal,{Id:0,brand:1,nav_items:2,state:7})}}function create_fragment$7(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re=(new Date).getFullYear()+"";return{c(){ve=element("footer"),_e=element("div"),be=text("Â© "),we=text(Re),Se=text(" Copyright:\n        "),Te=element("a"),Ee=text(fe[1]),attr(Te,"class",Ce="text-"+fe[2]),attr(Te,"href","/"),attr(_e,"class","text-center p-3"),attr(ve,"class",Oe="bg-"+fe[3]+" text-center text-"+fe[2]),attr(ve,"id",fe[0])},m(fe,Ce){insert(fe,ve,Ce),append(ve,_e),append(_e,be),append(_e,we),append(_e,Se),append(_e,Te),append(Te,Ee)},p(fe,[_e]){2&_e&&set_data(Ee,fe[1]),4&_e&&Ce!==(Ce="text-"+fe[2])&&attr(Te,"class",Ce),12&_e&&Oe!==(Oe="bg-"+fe[3]+" text-center text-"+fe[2])&&attr(ve,"class",Oe),1&_e&&attr(ve,"id",fe[0])},i:noop,o:noop,d(fe){fe&&detach(ve)}}}function instance$7(fe,ve,_e){let{Id:be}=ve,{brand:we}=ve,{state:Se}=ve,Te="dark",Ee="light";return"dark"==Se&&(Te="light",Ee="dark"),fe.$$set=fe=>{"Id"in fe&&_e(0,be=fe.Id),"brand"in fe&&_e(1,we=fe.brand),"state"in fe&&_e(4,Se=fe.state)},[be,we,Te,Ee,Se]}class Footer extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$7,create_fragment$7,safe_not_equal,{Id:0,brand:1,state:4})}}function cubicOut(fe){const ve=fe-1;return ve*ve*ve+1}function fade(fe,{delay:ve=0,duration:_e=400,easing:be=identity}={}){const we=+getComputedStyle(fe).opacity;return{delay:ve,duration:_e,easing:be,css:fe=>"opacity: "+fe*we}}function slide(fe,{delay:ve=0,duration:_e=400,easing:be=cubicOut,axis:we="y"}={}){const Se=getComputedStyle(fe),Te=+Se.opacity,Ee="y"===we?"height":"width",Ce=parseFloat(Se[Ee]),Oe="y"===we?["top","bottom"]:["left","right"],Re=Oe.map((fe=>`${fe[0].toUpperCase()}${fe.slice(1)}`)),De=parseFloat(Se[`padding${Re[0]}`]),Be=parseFloat(Se[`padding${Re[1]}`]),Ze=parseFloat(Se[`margin${Re[0]}`]),Xe=parseFloat(Se[`margin${Re[1]}`]),Je=parseFloat(Se[`border${Re[0]}Width`]),Qe=parseFloat(Se[`border${Re[1]}Width`]);return{delay:ve,duration:_e,easing:be,css:fe=>`overflow: hidden;opacity: ${Math.min(20*fe,1)*Te};${Ee}: ${fe*Ce}px;padding-${Oe[0]}: ${fe*De}px;padding-${Oe[1]}: ${fe*Be}px;margin-${Oe[0]}: ${fe*Ze}px;margin-${Oe[1]}: ${fe*Xe}px;border-${Oe[0]}-width: ${fe*Je}px;border-${Oe[1]}-width: ${fe*Qe}px;`}}function create_if_block$4(fe){let ve,_e,be,we,Se,Te,Ee,Ce;return{c(){ve=element("h1"),ve.textContent="Dein Fahrerlebnis in Ingolstadt",be=space(),we=element("p"),we.textContent="Lorem ipsum dolor sit amet lorem ipsum dolor sit amet lorem ipsum dolor sit amet lorem ipsum dolor.",Te=space(),Ee=element("div"),Ee.innerHTML='<button class="cta-button svelte-x53rqg">Jetzt Termin buchen</button> <p class="cta-text svelte-x53rqg">Oder komm einfach vorbei</p>',attr(ve,"class","main-title svelte-x53rqg"),attr(we,"class","subtitle svelte-x53rqg"),attr(Ee,"class","button-group svelte-x53rqg")},m(fe,_e){insert(fe,ve,_e),insert(fe,be,_e),insert(fe,we,_e),insert(fe,Te,_e),insert(fe,Ee,_e)},i(fe){fe&&(_e||add_render_callback((()=>{_e=create_in_transition(ve,fade,{duration:1e3}),_e.start()}))),fe&&(Se||add_render_callback((()=>{Se=create_in_transition(we,fade,{duration:1e3,delay:500}),Se.start()}))),fe&&(Ce||add_render_callback((()=>{Ce=create_in_transition(Ee,fade,{duration:1e3,delay:1e3}),Ce.start()})))},o:noop,d(fe){fe&&(detach(ve),detach(be),detach(we),detach(Te),detach(Ee))}}}function create_fragment$6(fe){let ve,_e,be,we,Se,Te=fe[0]&&create_if_block$4();return{c(){ve=element("section"),_e=element("div"),be=element("div"),Te&&Te.c(),we=space(),Se=element("div"),Se.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',attr(be,"class","container svelte-x53rqg"),attr(_e,"class","overlay svelte-x53rqg"),attr(Se,"class","scroll-indicator svelte-x53rqg"),attr(ve,"id","home"),attr(ve,"class","home-section svelte-x53rqg")},m(fe,Ee){insert(fe,ve,Ee),append(ve,_e),append(_e,be),Te&&Te.m(be,null),append(ve,we),append(ve,Se)},p(fe,[ve]){fe[0]?Te?1&ve&&transition_in(Te,1):(Te=create_if_block$4(),Te.c(),transition_in(Te,1),Te.m(be,null)):Te&&(Te.d(1),Te=null)},i(fe){transition_in(Te)},o:noop,d(fe){fe&&detach(ve),Te&&Te.d()}}}function instance$6(fe,ve,_e){let be=!1;return onMount((()=>{_e(0,be=!0)})),[be]}class Header extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$6,create_fragment$6,safe_not_equal,{})}}function get_each_context$2(fe,ve,_e){const be=fe.slice();return be[5]=ve[_e],be}function create_if_block$3(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t=ensure_array_like(fe[3]),bt=[];for(let wt=0;wt<$t.length;wt+=1)bt[wt]=create_each_block$2(get_each_context$2(fe,$t,wt));return{c(){ve=element("div"),_e=element("div"),be=element("div"),we=element("h1"),Se=text(fe[1]),Te=space(),Ee=element("hr"),Ce=space(),Oe=element("p"),Re=text(fe[2]),Be=space(),Ze=element("div");for(let fe=0;fe<bt.length;fe+=1)bt[fe].c();Xe=space(),Je=element("div"),Je.innerHTML='<button class="cta-button svelte-10gpq3r">Book Your Experience</button>',attr(we,"class","content-header fw-bold text-primary mb-5 svelte-10gpq3r"),attr(Ee,"class","mb-5"),attr(Oe,"class","description-text svelte-10gpq3r"),attr(Ze,"class","features mt-5 svelte-10gpq3r"),attr(Je,"class","button-group mt-5 svelte-10gpq3r"),attr(be,"class","col-12 mb-3"),attr(_e,"class","row"),attr(ve,"class","container text-center transition-container svelte-10gpq3r")},m(fe,De){insert(fe,ve,De),append(ve,_e),append(_e,be),append(be,we),append(we,Se),append(be,Te),append(be,Ee),append(be,Ce),append(be,Oe),append(Oe,Re),append(be,Be),append(be,Ze);for(let ve=0;ve<bt.length;ve+=1)bt[ve]&&bt[ve].m(Ze,null);append(be,Xe),append(be,Je)},p(fe,ve){if(2&ve&&set_data(Se,fe[1]),4&ve&&set_data(Re,fe[2]),8&ve){let _e;for($t=ensure_array_like(fe[3]),_e=0;_e<$t.length;_e+=1){const be=get_each_context$2(fe,$t,_e);bt[_e]?(bt[_e].p(be,ve),transition_in(bt[_e],1)):(bt[_e]=create_each_block$2(be),bt[_e].c(),transition_in(bt[_e],1),bt[_e].m(Ze,null))}for(;_e<bt.length;_e+=1)bt[_e].d(1);bt.length=$t.length}},i(fe){fe&&(De||add_render_callback((()=>{De=create_in_transition(Oe,fade,{delay:500,duration:1e3}),De.start()})));for(let ve=0;ve<$t.length;ve+=1)transition_in(bt[ve]);fe&&(Qe||add_render_callback((()=>{Qe=create_in_transition(Je,fade,{delay:1e3,duration:1e3}),Qe.start()}))),fe&&(dt||add_render_callback((()=>{dt=create_in_transition(be,fade,{duration:1e3}),dt.start()})))},o:noop,d(fe){fe&&detach(ve),destroy_each(bt,fe)}}}function create_each_block$2(fe){let ve,_e,be,we,Se,Te,Ee,Ce=fe[5]+"";return{c(){ve=element("div"),_e=element("i"),be=space(),we=element("span"),Se=text(Ce),Te=space(),attr(_e,"class","fas fa-check-circle feature-icon svelte-10gpq3r"),attr(we,"class","feature-text"),attr(ve,"class","feature-item svelte-10gpq3r")},m(fe,Ee){insert(fe,ve,Ee),append(ve,_e),append(ve,be),append(ve,we),append(we,Se),append(ve,Te)},p(fe,ve){8&ve&&Ce!==(Ce=fe[5]+"")&&set_data(Se,Ce)},i(fe){fe&&(Ee||add_render_callback((()=>{Ee=create_in_transition(ve,fade,{delay:700,duration:1e3}),Ee.start()})))},o:noop,d(fe){fe&&detach(ve)}}}function create_fragment$5(fe){let ve,_e=fe[4]&&create_if_block$3(fe);return{c(){ve=element("div"),_e&&_e.c(),attr(ve,"class","about-section bg-dark text-light d-flex justify-content-center align-items-center min-vh-100 svelte-10gpq3r"),attr(ve,"id",fe[0])},m(fe,be){insert(fe,ve,be),_e&&_e.m(ve,null)},p(fe,[be]){fe[4]?_e?(_e.p(fe,be),16&be&&transition_in(_e,1)):(_e=create_if_block$3(fe),_e.c(),transition_in(_e,1),_e.m(ve,null)):_e&&(_e.d(1),_e=null),1&be&&attr(ve,"id",fe[0])},i(fe){transition_in(_e)},o:noop,d(fe){fe&&detach(ve),_e&&_e.d()}}}function instance$5(fe,ve,_e){let be=!1;onMount((()=>_e(4,be=!0)));let{Id:we}=ve,{about_title:Se="Welcome to RacingHub!"}=ve,{description:Te="Experience the thrill of high-speed racing with our state-of-the-art simulators. Whether you're a professional racer or just looking for some fun, RacingHub has something for everyone."}=ve,{features:Ee=["Realistic Racing Simulators","Multiple Tracks and Cars","Professional Coaching","Competitive Tournaments","Corporate Events and Parties"]}=ve;return fe.$$set=fe=>{"Id"in fe&&_e(0,we=fe.Id),"about_title"in fe&&_e(1,Se=fe.about_title),"description"in fe&&_e(2,Te=fe.description),"features"in fe&&_e(3,Ee=fe.features)},[we,Se,Te,Ee,be]}class About extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$5,create_fragment$5,safe_not_equal,{Id:0,about_title:1,description:2,features:3})}}function create_else_block(fe){let ve,_e,be;const we=fe[10].default,Se=create_slot(we,fe,fe[9],null);return{c(){ve=element("div"),Se&&Se.c(),attr(ve,"style",_e="animation: "+fe[1]+"; "+fe[3])},m(fe,_e){insert(fe,ve,_e),Se&&Se.m(ve,null),be=!0},p(fe,Te){Se&&Se.p&&(!be||512&Te)&&update_slot_base(Se,we,fe,fe[9],be?get_slot_changes(we,fe[9],Te,null):get_all_dirty_from_scope(fe[9]),null),(!be||10&Te&&_e!==(_e="animation: "+fe[1]+"; "+fe[3]))&&attr(ve,"style",_e)},i(fe){be||(transition_in(Se,fe),be=!0)},o(fe){transition_out(Se,fe),be=!1},d(fe){fe&&detach(ve),Se&&Se.d(fe)}}}function create_if_block$2(fe){let ve,_e,be;const we=fe[10].default,Se=create_slot(we,fe,fe[9],null);return{c(){ve=element("div"),Se&&Se.c(),attr(ve,"style",_e="animation: "+fe[0]+"; "+fe[3])},m(fe,_e){insert(fe,ve,_e),Se&&Se.m(ve,null),be=!0},p(fe,Te){Se&&Se.p&&(!be||512&Te)&&update_slot_base(Se,we,fe,fe[9],be?get_slot_changes(we,fe[9],Te,null):get_all_dirty_from_scope(fe[9]),null),(!be||9&Te&&_e!==(_e="animation: "+fe[0]+"; "+fe[3]))&&attr(ve,"style",_e)},i(fe){be||(transition_in(Se,fe),be=!0)},o(fe){transition_out(Se,fe),be=!1},d(fe){fe&&detach(ve),Se&&Se.d(fe)}}}function create_fragment$4(fe){let ve,_e,be,we;const Se=[create_if_block$2,create_else_block],Te=[];function select_block_type(fe,ve){return fe[4]?0:1}return _e=select_block_type(fe),be=Te[_e]=Se[_e](fe),{c(){ve=element("div"),be.c(),attr(ve,"id",fe[5]),attr(ve,"style",fe[2])},m(fe,be){insert(fe,ve,be),Te[_e].m(ve,null),we=!0},p(fe,[Ee]){let Ce=_e;_e=select_block_type(fe),_e===Ce?Te[_e].p(fe,Ee):(group_outros(),transition_out(Te[Ce],1,1,(()=>{Te[Ce]=null})),check_outros(),be=Te[_e],be?be.p(fe,Ee):(be=Te[_e]=Se[_e](fe),be.c()),transition_in(be,1),be.m(ve,null)),(!we||4&Ee)&&attr(ve,"style",fe[2])},i(fe){we||(transition_in(be),we=!0)},o(fe){transition_out(be),we=!1},d(fe){fe&&detach(ve),Te[_e].d()}}}function instance$4(fe,ve,_e){let{$$slots:be={},$$scope:we}=ve,{animation:Se="none"}=ve,{animation_out:Te="none; opacity: 0"}=ve,{once:Ee=!1}=ve,{top:Ce=0}=ve,{bottom:Oe=0}=ve,{css_observer:Re=""}=ve,{css_animation:De=""}=ve;const Be=function createEventDispatcher(){const fe=get_current_component();return(ve,_e,{cancelable:be=!1}={})=>{const we=fe.$$.callbacks[ve];if(we){const Se=custom_event(ve,_e,{cancelable:be});return we.slice().forEach((ve=>{ve.call(fe,Se)})),!Se.defaultPrevented}return!0}}();let Ze=!0;const Xe=`__saos-${Math.random()}__`;function bounding_verify(fe){const ve=fe.getBoundingClientRect();return _e(4,Ze=ve.top+Ce<window.innerHeight&&ve.bottom-Oe>0),Ze&&Ee&&window.removeEventListener("scroll",verify),window.addEventListener("scroll",bounding_verify),()=>window.removeEventListener("scroll",bounding_verify)}return onMount((()=>{const fe=document.getElementById(Xe);return IntersectionObserver?function intersection_verify(fe){const ve=new IntersectionObserver((be=>{_e(4,Ze=be[0].isIntersecting),Ze&&Ee&&ve.unobserve(fe)}),{rootMargin:`${-Oe}px 0px ${-Ce}px 0px`});return ve.observe(fe),()=>ve.unobserve(fe)}(fe):bounding_verify(fe)})),fe.$$set=fe=>{"animation"in fe&&_e(0,Se=fe.animation),"animation_out"in fe&&_e(1,Te=fe.animation_out),"once"in fe&&_e(6,Ee=fe.once),"top"in fe&&_e(7,Ce=fe.top),"bottom"in fe&&_e(8,Oe=fe.bottom),"css_observer"in fe&&_e(2,Re=fe.css_observer),"css_animation"in fe&&_e(3,De=fe.css_animation),"$$scope"in fe&&_e(9,we=fe.$$scope)},fe.$$.update=()=>{16&fe.$$.dirty&&Be("update",{observing:Ze})},[Se,Te,Re,De,Ze,Xe,Ee,Ce,Oe,we,be]}class Saos extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$4,create_fragment$4,safe_not_equal,{animation:0,animation_out:1,once:6,top:7,bottom:8,css_observer:2,css_animation:3})}}function get_each_context$1(fe,ve,_e){const be=fe.slice();return be[7]=ve[_e],be}function create_if_block$1(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re=ensure_array_like(fe[2]),De=[];for(let Be=0;Be<Re.length;Be+=1)De[Be]=create_each_block$1(get_each_context$1(fe,Re,Be));return{c(){ve=element("div"),_e=element("div"),be=element("h1"),we=text(fe[1]),Te=space(),Ee=element("hr"),Ce=space(),Oe=element("div");for(let fe=0;fe<De.length;fe+=1)De[fe].c();attr(be,"class","fw-bold text-primary"),attr(_e,"class","mb-5"),attr(Ee,"class","mb-5"),attr(Oe,"class","flex-container svelte-lal039"),attr(ve,"class","container text-center")},m(fe,Se){insert(fe,ve,Se),append(ve,_e),append(_e,be),append(be,we),append(ve,Te),append(ve,Ee),append(ve,Ce),append(ve,Oe);for(let ve=0;ve<De.length;ve+=1)De[ve]&&De[ve].m(Oe,null)},p(fe,ve){if(2&ve&&set_data(we,fe[1]),20&ve){let _e;for(Re=ensure_array_like(fe[2]),_e=0;_e<Re.length;_e+=1){const be=get_each_context$1(fe,Re,_e);De[_e]?(De[_e].p(be,ve),transition_in(De[_e],1)):(De[_e]=create_each_block$1(be),De[_e].c(),transition_in(De[_e],1),De[_e].m(Oe,null))}for(;_e<De.length;_e+=1)De[_e].d(1);De.length=Re.length}},i(fe){fe&&(Se||add_render_callback((()=>{Se=create_in_transition(_e,slide,{duration:1e3}),Se.start()})));for(let ve=0;ve<Re.length;ve+=1)transition_in(De[ve])},o:noop,d(fe){fe&&detach(ve),destroy_each(De,fe)}}}function create_each_block$1(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t=fe[7].title+"",bt=fe[7].description+"";return{c(){ve=element("div"),_e=element("a"),be=element("div"),we=element("img"),Ee=space(),Ce=element("div"),Oe=element("h5"),Re=text($t),De=space(),Be=element("p"),Ze=text(bt),Qe=space(),attr(we,"class","card-img-top service-image svelte-lal039"),src_url_equal(we.src,Se=fe[7].image)||attr(we,"src",Se),attr(we,"alt",Te=fe[7].title),attr(Oe,"class","card-title text-primary fw-bold"),attr(Be,"class","card-text"),attr(Ce,"class","card-body"),attr(be,"class","card svelte-lal039"),attr(_e,"class",Xe="text-"+fe[4]+" svelte-lal039"),attr(_e,"href",Je=fe[7].link),attr(_e,"target","_blank"),attr(ve,"class","service-card svelte-lal039")},m(fe,Se){insert(fe,ve,Se),append(ve,_e),append(_e,be),append(be,we),append(be,Ee),append(be,Ce),append(Ce,Oe),append(Oe,Re),append(Ce,De),append(Ce,Be),append(Be,Ze),append(ve,Qe)},p(fe,ve){4&ve&&!src_url_equal(we.src,Se=fe[7].image)&&attr(we,"src",Se),4&ve&&Te!==(Te=fe[7].title)&&attr(we,"alt",Te),4&ve&&$t!==($t=fe[7].title+"")&&set_data(Re,$t),4&ve&&bt!==(bt=fe[7].description+"")&&set_data(Ze,bt),16&ve&&Xe!==(Xe="text-"+fe[4]+" svelte-lal039")&&attr(_e,"class",Xe),4&ve&&Je!==(Je=fe[7].link)&&attr(_e,"href",Je)},i(fe){fe&&(dt||add_render_callback((()=>{dt=create_in_transition(ve,fade,{delay:500,duration:1500}),dt.start()})))},o:noop,d(fe){fe&&detach(ve)}}}function create_default_slot$1(fe){let ve,_e=fe[3]&&create_if_block$1(fe);return{c(){_e&&_e.c(),ve=empty()},m(fe,be){_e&&_e.m(fe,be),insert(fe,ve,be)},p(fe,be){fe[3]?_e?(_e.p(fe,be),8&be&&transition_in(_e,1)):(_e=create_if_block$1(fe),_e.c(),transition_in(_e,1),_e.m(ve.parentNode,ve)):_e&&(_e.d(1),_e=null)},d(fe){fe&&detach(ve),_e&&_e.d(fe)}}}function create_fragment$3(fe){let ve,_e,be,we;return _e=new Saos({props:{animation:"",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:fe}}}),{c(){ve=element("div"),create_component(_e.$$.fragment),attr(ve,"class",be="text-"+fe[4]+" d-flex justify-content-center align-items-center min-vh-100 svelte-lal039"),attr(ve,"id",fe[0]),set_style(ve,"padding-top","58px"),set_style(ve,"background-color","transparent",1)},m(fe,be){insert(fe,ve,be),mount_component(_e,ve,null),we=!0},p(fe,[Se]){const Te={};1054&Se&&(Te.$$scope={dirty:Se,ctx:fe}),_e.$set(Te),(!we||16&Se&&be!==(be="text-"+fe[4]+" d-flex justify-content-center align-items-center min-vh-100 svelte-lal039"))&&attr(ve,"class",be),(!we||1&Se)&&attr(ve,"id",fe[0])},i(fe){we||(transition_in(_e.$$.fragment,fe),we=!0)},o(fe){transition_out(_e.$$.fragment,fe),we=!1},d(fe){fe&&detach(ve),destroy_component(_e)}}}function instance$3(fe,ve,_e){let be=!1;onMount((()=>_e(3,be=!0)));let{Id:we}=ve,{services_title:Se="Our Services"}=ve,{services:Te=[{title:"Realistic Racing Simulators",description:"Experience the thrill of racing with our state-of-the-art simulators that provide a realistic driving experience.",image:"../assets/background.png",link:"#"},{title:"Multiple Tracks and Cars",description:"Choose from a variety of tracks and cars to race on, providing endless possibilities and challenges.",image:"../assets/background.png",link:"#"},{title:"Professional Coaching",description:"Get tips and training from professional racers to improve your skills and performance.",image:"../assets/background.png",link:"#"},{title:"Competitive Tournaments",description:"Participate in our regular tournaments and compete against others to win exciting prizes.",image:"../assets/background.png",link:"#"},{title:"Corporate Events and Parties",description:"Book our venue for corporate events, team-building activities, and private parties.",image:"../assets/background.png",link:"#"}]}=ve,{state:Ee}=ve,Ce="dark";return"dark"==Ee&&(Ce="light"),fe.$$set=fe=>{"Id"in fe&&_e(0,we=fe.Id),"services_title"in fe&&_e(1,Se=fe.services_title),"services"in fe&&_e(2,Te=fe.services),"state"in fe&&_e(5,Ee=fe.state)},[we,Se,Te,be,Ce,Ee]}class Services extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$3,create_fragment$3,safe_not_equal,{Id:0,services_title:1,services:2,state:5})}}const Ft={},zt=function preload(fe,ve,_e){let be=Promise.resolve();if(ve&&ve.length>0){document.getElementsByTagName("link");const fe=document.querySelector("meta[property=csp-nonce]"),_e=(null==fe?void 0:fe.nonce)||(null==fe?void 0:fe.getAttribute("nonce"));be=Promise.all(ve.map((fe=>{if((fe=function(fe){return"/simhub/"+fe}(fe))in Ft)return;Ft[fe]=!0;const ve=fe.endsWith(".css"),be=ve?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${fe}"]${be}`))return;const we=document.createElement("link");return we.rel=ve?"stylesheet":"modulepreload",ve||(we.as="script",we.crossOrigin=""),we.href=fe,_e&&we.setAttribute("nonce",_e),document.head.appendChild(we),ve?new Promise(((ve,_e)=>{we.addEventListener("load",ve),we.addEventListener("error",(()=>_e(new Error(`Unable to preload CSS for ${fe}`))))})):void 0})))}return be.then((()=>fe())).catch((fe=>{const ve=new Event("vite:preloadError",{cancelable:!0});if(ve.payload=fe,window.dispatchEvent(ve),!ve.defaultPrevented)throw fe}))};function e$4o(fe,ve,_e,be){var we,Se=arguments.length,Te=Se<3?ve:null===be?be=Object.getOwnPropertyDescriptor(ve,_e):be;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Te=Reflect.decorate(fe,ve,_e,be);else for(var Ee=fe.length-1;Ee>=0;Ee--)(we=fe[Ee])&&(Te=(Se<3?we(Te):Se>3?we(ve,_e,Te):we(ve,_e))||Te);return Se>3&&Te&&Object.defineProperty(ve,_e,Te),Te}function t$4z(fe,ve){return function(_e,be){ve(_e,be,fe)}}function n$4V(fe,ve,_e,be){return new(_e||(_e=Promise))((function(ve,we){function f31(fe){try{i52(be.next(fe))}catch(ve){we(ve)}}function u30(fe){try{i52(be.throw(fe))}catch(ve){we(ve)}}function i52(fe){fe.done?ve(fe.value):function o39(fe){return fe instanceof _e?fe:new _e((function(ve){ve(fe)}))}(fe.value).then(f31,u30)}i52((be=be.apply(fe,[])).next())}))}let kt;function has(fe){return"function"==typeof kt[fe]?kt[fe]=kt[fe](globalThis):kt[fe]}"function"==typeof SuppressedError&&SuppressedError,kt=(null==(fe=globalThis.dojoConfig)?void 0:fe.has)||(null==(ve=globalThis.esriConfig)?void 0:ve.has)?{...null==(_e=globalThis.dojoConfig)?void 0:_e.has,...null==(be=globalThis.esriConfig)?void 0:be.has}:{},has.add=(fe,ve,_e,be)=>((be||void 0===kt[fe])&&(kt[fe]=ve),_e&&has(fe)),has.cache=kt,has.add("big-integer-warning-enabled",!0),has.add("esri-deprecation-warnings",!0),has.add("esri-tests-disable-screenshots",!1),has.add("esri-tests-use-full-window",!1),has.add("esri-tests-post-to-influx",!0),(()=>{var fe;has.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const ve="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(has.add("host-browser",ve),has.add("host-node","object"==typeof globalThis.process&&(null==(fe=globalThis.process.versions)?void 0:fe.node)&&globalThis.process.versions.v8),has.add("dom",ve),has("host-browser")){const fe=navigator,ve=fe.userAgent,_e=fe.appVersion,be=parseFloat(_e);if(has.add("wp",parseFloat(ve.split("Windows Phone")[1])||void 0),has.add("msapp",parseFloat(ve.split("MSAppHost/")[1])||void 0),has.add("khtml",_e.includes("Konqueror")?be:void 0),has.add("edge",parseFloat(ve.split("Edge/")[1])||void 0),has.add("opr",parseFloat(ve.split("OPR/")[1])||void 0),has.add("webkit",!has("wp")&&!has("edge")&&parseFloat(ve.split("WebKit/")[1])||void 0),has.add("chrome",!has("edge")&&!has("opr")&&parseFloat(ve.split("Chrome/")[1])||void 0),has.add("android",!has("wp")&&parseFloat(ve.split("Android ")[1])||void 0),has.add("safari",!_e.includes("Safari")||has("wp")||has("chrome")||has("android")||has("edge")||has("opr")?void 0:parseFloat(_e.split("Version/")[1])),has.add("mac",_e.includes("Macintosh")),!has("wp")&&/(iPhone|iPod|iPad)/.test(ve)){const fe=RegExp.$1.replace(/P/,"p"),_e=/OS ([\d_]+)/.test(ve)?RegExp.$1:"1",be=parseFloat(_e.replace(/_/,".").replaceAll("_",""));has.add(fe,be),has.add("ios",be)}has("webkit")||(!ve.includes("Gecko")||has("wp")||has("khtml")||has("edge")||has.add("mozilla",be),has("mozilla")&&has.add("ff",parseFloat(ve.split("Firefox/")[1]||ve.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const fe=navigator.userAgent,ve=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(fe),_e=/iPhone/i.test(fe);ve&&has.add("esri-mobile",ve),_e&&has.add("esri-iPhone",_e),has.add("esri-geolocation",!!navigator.geolocation)}has.add("esri-wasm","WebAssembly"in globalThis),has.add("esri-performance-mode-frames-between-render",20),has.add("esri-force-performance-mode",!1),has.add("esri-shared-array-buffer",(()=>{const fe="SharedArrayBuffer"in globalThis,ve=!1===globalThis.crossOriginIsolated;return fe&&!ve})),has.add("wasm-simd",(()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))),has.add("esri-atomics","Atomics"in globalThis),has.add("esri-workers","Worker"in globalThis),has.add("web-feat:cache","caches"in globalThis),has.add("esri-workers-arraybuffer-transfer",!has("safari")||Number(has("safari"))>=12),has.add("workers-pool-size",8),has.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),has.add("featurelayer-simplify-payload-size-factors",[1,1,4]),has.add("featurelayer-fast-triangulation-enabled",!0),has.add("featurelayer-animation-enabled",!0),has.add("featurelayer-snapshot-enabled",!0),has.add("featurelayer-snapshot-point-min-threshold",8e4),has.add("featurelayer-snapshot-point-max-threshold",4e5),has.add("featurelayer-snapshot-point-coverage",.1),has.add("featurelayer-query-max-depth",4),has.add("featurelayer-query-pausing-enabled",!1),has.add("featurelayer-advanced-symbols",!1),has.add("featurelayer-pbf",!0),has.add("featurelayer-pbf-statistics",!1),has.add("feature-layers-workers",!0),has.add("feature-polyline-generalization-factor",1),has.add("mapview-transitions-duration",200),has.add("mapview-essential-goto-duration",200),has.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),has.add("mapserver-pbf-version-support",10.81),has.add("mapservice-popup-identify-max-tolerance",20),has("host-webworker")||has("host-browser")&&(has.add("esri-csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),has.add("esri-image-decode",(()=>{if("decode"in new Image){const fe=new Image;return fe.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void fe.decode().then((()=>{has.add("esri-image-decode",!0,!0,!0)})).catch((()=>{has.add("esri-image-decode",!1,!0,!0)}))}return!1})),has.add("esri-url-encodes-apostrophe",(()=>{const fe=window.document.createElement("a");return fe.href="?'",fe.href.includes("?%27")})))})();const Bt=new WeakMap;function t$4y(fe,ve,_e={}){if(has("esri-deprecation-warnings")){const{moduleName:be}=_e;a$4K(fe,"Function: "+((be?be+"::":"")+ve+"()"),_e)}}function i$4Y(fe,ve,_e={}){if(has("esri-deprecation-warnings")){const{moduleName:be}=_e;a$4K(fe,"Property: "+((be?be+"::":"")+ve),_e)}}function a$4K(fe,ve,_e={}){if(has("esri-deprecation-warnings")){const{replacement:be,version:we,see:Se,warnOnce:Te}=_e;let Ee=ve;be&&(Ee+=`\n\tðŸ› ï¸ Replacement: ${be}`),we&&(Ee+=`\n\tâš™ï¸ Version: ${we}`),Se&&(Ee+=`\n\tðŸ”— See ${Se} for more details.`),function n$4U(fe,ve,_e=!1){const be=`ðŸ›‘ DEPRECATED - ${ve}`;if(!_e)return void fe.warn(be);let we=Bt.get(fe);we||(we=new Set,Bt.set(fe,we)),we.has(ve)||(we.add(ve),fe.warn(be))}(fe,Ee,Te)}}function n$4T(fe){const ve=[];return function*(){yield*ve;for(const _e of fe)ve.push(_e),yield _e}}function o$4x(fe,ve){for(const _e of fe)if(null!=_e&&ve(_e))return _e}function t$4x(fe){return null!=fe&&"function"==typeof fe[Symbol.iterator]}let jt=class r{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let fe=0;return this._groups.forEach((ve=>{fe+=ve.length})),fe}add(fe,ve){if(t$4x(fe)){const _e=this._getOrCreateGroup(ve);for(const ve of fe)o$4w(ve)&&_e.push(ve)}else o$4w(fe)&&this._getOrCreateGroup(ve).push(fe);return this}forEach(fe,ve){if("function"==typeof fe)this._groups.forEach((ve=>ve.forEach(fe)));else{const _e=this._getGroup(fe);_e&&ve&&_e.forEach(ve)}}has(fe){return this._groups.has(e$4l(fe))}remove(fe){if("string"!=typeof fe&&t$4x(fe)){for(const ve of fe)this.remove(ve);return this}return this.has(fe)?(s$4B(this._getGroup(fe)),this._groups.delete(e$4l(fe)),this):this}removeAll(){return this._groups.forEach(s$4B),this._groups.clear(),this}removeReference(fe){return this._groups.delete(fe),this}_getOrCreateGroup(fe){if(this.has(fe))return this._getGroup(fe);const ve=[];return this._groups.set(e$4l(fe),ve),ve}_getGroup(fe){return this._groups.get(e$4l(fe))}};function e$4l(fe){return fe||"_default_"}function s$4B(fe){for(const ve of fe)ve instanceof jt?ve.removeAll():ve.remove()}function o$4w(fe){return null!=fe&&(!!fe.remove||fe instanceof jt)}let Gt=class t{constructor(fe=1){this._seed=fe}set seed(fe){this._seed=fe??Math.random()*t._m}getInt(){return this._seed=(t._a*this._seed+t._c)%t._m,this._seed}getFloat(){return this.getInt()/(t._m-1)}getIntRange(fe,ve){return Math.round(this.getFloatRange(fe,ve))}getFloatRange(fe,ve){const _e=ve-fe;return fe+this.getInt()/t._m*_e}};Gt._m=2147483647,Gt._a=48271,Gt._c=0;const Ht=1.5,qt=1/Ht;function s$4A(fe,ve){return ve?fe.filter(((fe,_e,be)=>be.findIndex(ve.bind(null,fe))===_e)):Array.from(new Set(fe))}function h$30(fe,ve,_e){if(null==fe&&null==ve)return!0;if(null==fe||null==ve||fe.length!==ve.length)return!1;if(_e){for(let be=0;be<fe.length;be++)if(!_e(fe[be],ve[be]))return!1}else for(let be=0;be<fe.length;be++)if(fe[be]!==ve[be])return!1;return!0}function a$4J(fe,ve){let _e=fe.length!==ve.length;_e&&(fe.length=ve.length);for(let be=0;be<ve.length;++be)fe[be]!==ve[be]&&(fe[be]=ve[be],_e=!0);return _e}function g$2J(fe,ve,_e){let be,we;return _e?(be=ve.filter((ve=>!fe.some((fe=>_e(fe,ve))))),we=fe.filter((fe=>!ve.some((ve=>_e(ve,fe)))))):(be=ve.filter((ve=>!fe.includes(ve))),we=fe.filter((fe=>!ve.includes(fe)))),{added:be,removed:we}}function p$59(fe,ve){const _e=fe.length;if(0===_e)return[];const be=[];for(let we=0;we<_e;we+=ve)be.push(fe.slice(we,we+ve));return be}function w$24(fe,ve,_e){const be=fe.length;let we=0,Se=be-1;for(;we<Se;){const _e=we+Math.floor((Se-we)/2);ve>fe[_e]?we=_e+1:Se=_e}const Te=fe[we];return _e?ve>=fe[be-1]?-1:Te===ve?we:we-1:Te===ve?we:-1}let Wt=class v{constructor(){this.last=0}};const Yt=new Wt;function y$2D(fe,ve,_e,be){be=be||Yt;const we=Math.max(0,be.last-10);for(let Te=we;Te<_e;++Te)if(fe[Te]===ve)return be.last=Te,Te;const Se=Math.min(we,_e);for(let Te=0;Te<Se;++Te)if(fe[Te]===ve)return be.last=Te,Te;return-1}function S$1U(fe,ve,_e,be){const we=fe.length,Se=y$2D(fe,ve,we,be);if(-1!==Se)return fe[Se]=fe[we-1],fe.pop(),ve}const Xt=new Set;function I$1K(fe,ve){let _e=0;for(let be=0;be<fe.length;++be){const we=fe[be];ve(we,be)&&(fe[_e]=we,_e++)}fe.length=_e}function F$1f(fe,ve){const _e=function C$1u(fe){return Jt.seed=fe,()=>Jt.getFloat()}(ve);for(let be=fe.length-1;be>0;be--){const ve=Math.floor(_e()*(be+1)),we=fe[be];fe[be]=fe[ve],fe[ve]=we}return fe}const Jt=new Gt;function L$1i(fe,ve){const _e=fe.indexOf(ve);return-1!==_e?(fe.splice(_e,1),ve):null}function N$1f(fe,ve){const _e=new Map,be=fe.length;for(let we=0;we<be;we++){const be=fe[we],Se=ve(be,we,fe),Te=_e.get(Se);Te?Te.push(be):_e.set(Se,[be])}return _e}function O$1y(fe,ve){return null!=fe}const Qt=[];function r$3P(fe){return 32+fe.length}function n$4S(){return 16}function t$4u(fe){if(!fe)return 0;let ve=Kt;for(const _e in fe)if(fe.hasOwnProperty(_e)){const be=fe[_e];switch(typeof be){case"string":ve+=r$3P(be);break;case"number":ve+=16;break;case"boolean":ve+=4}}return ve}function e$4j(fe){if(!fe)return 0;if(Array.isArray(fe))return function o$4v(fe){const ve=fe.length;if(0===ve||"number"==typeof fe[0])return 32+8*ve;let _e=er;for(let be=0;be<ve;be++)_e+=u$4h(fe[be]);return _e}(fe);let ve=Kt;for(const _e in fe)fe.hasOwnProperty(_e)&&(ve+=u$4h(fe[_e]));return ve}function u$4h(fe){switch(typeof fe){case"object":return e$4j(fe);case"string":return r$3P(fe);case"number":return 16;case"boolean":return 4;default:return 8}}function c$55(fe,ve){return er+fe.length*ve}const Kt=32,er=16;function t$4t(fe){return fe instanceof ArrayBuffer}function o$4u(fe){var ve;return"Int8Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function u$4g(fe){var ve;return"Uint8Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function e$4i(fe){var ve;return"Uint8ClampedArray"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function c$54(fe){var ve;return"Int16Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function i$4W(fe){var ve;return"Uint16Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function a$4I(fe){var ve;return"Int32Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function f$3z(fe){var ve;return"Uint32Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function s$4z(fe){var ve;return"Float32Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function m$3V(fe){var ve;return"Float64Array"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}function y$2C(fe){return!("buffer"in fe)}function A$1L(...fe){return fe.reduce(((fe,ve)=>fe+(ve?y$2C(ve)?c$55(ve,16):ve.byteLength+tr:0)),0)}const tr=145,rr=1024;function l$4G(fe,ve){let _e;for(_e in fe)fe.hasOwnProperty(_e)&&void 0===fe[_e]&&delete fe[_e];return fe}function a$4H(fe){if(!fe||"object"!=typeof fe||"function"==typeof fe)return fe;const ve=O$1x(fe);if(null!=ve)return ve;if(y$2B(fe))return fe.clone();if(m$3U(fe))return fe.map(a$4H);if(b$2h(fe))return fe.clone();const _e={};for(const be of Object.getOwnPropertyNames(fe))_e[be]=a$4H(fe[be]);return _e}function p$57(fe){if(!fe||"object"!=typeof fe||"function"==typeof fe||"HTMLElement"in globalThis&&fe instanceof HTMLElement)return fe;const ve=O$1x(fe);if(null!=ve)return ve;if(m$3U(fe)){let ve=!0;const _e=fe.map((fe=>{const _e=p$57(fe);return null!=fe&&null==_e&&(ve=!1),_e}));return ve?_e:null}if(y$2B(fe))return fe.clone();if(fe instanceof File||fe instanceof Blob)return fe;if(!b$2h(fe)){const ve=new(Object.getPrototypeOf(fe).constructor);for(const _e of Object.getOwnPropertyNames(fe)){const be=fe[_e],we=p$57(be);if(null!=be&&null==we)return null;ve[_e]=we}return ve}return null}function y$2B(fe){return"function"==typeof fe.clone}function m$3U(fe){return"function"==typeof fe.map&&"function"==typeof fe.forEach}function b$2h(fe){return"function"==typeof fe.notifyChange&&"function"==typeof fe.watch}function g$2I(fe){if("[object Object]"!==Object.prototype.toString.call(fe))return!1;const ve=Object.getPrototypeOf(fe);return null===ve||ve===Object.prototype}function O$1x(fe){if(o$4u(fe)||u$4g(fe)||e$4i(fe)||c$54(fe)||i$4W(fe)||a$4I(fe)||f$3z(fe)||s$4z(fe)||m$3V(fe))return fe.slice();if(fe instanceof Date)return new Date(fe.getTime());if(fe instanceof ArrayBuffer)return fe.slice(0,fe.byteLength);if(fe instanceof Map){const ve=new Map;for(const[_e,be]of fe)ve.set(_e,a$4H(be));return ve}if(fe instanceof Set){const ve=new Set;for(const _e of fe)ve.add(a$4H(_e));return ve}return null}function j$1V(fe,ve){return fe===ve||"number"==typeof fe&&isNaN(fe)&&"number"==typeof ve&&isNaN(ve)||"function"==typeof(null==fe?void 0:fe.getTime)&&"function"==typeof(null==ve?void 0:ve.getTime)&&fe.getTime()===ve.getTime()||!1}function h$2$(fe,ve){return fe===ve||(null==fe||"string"==typeof fe?fe===ve:"number"==typeof fe?fe===ve||"number"==typeof ve&&isNaN(fe)&&isNaN(ve):fe instanceof Date?ve instanceof Date&&fe.getTime()===ve.getTime():Array.isArray(fe)?Array.isArray(ve)&&h$30(fe,ve):fe instanceof Set?ve instanceof Set&&function N$1e(fe,ve){if(fe.size!==ve.size)return!1;for(const _e of fe)if(!ve.has(_e))return!1;return!0}(fe,ve):fe instanceof Map?ve instanceof Map&&function T$1s(fe,ve){if(fe.size!==ve.size)return!1;for(const[_e,be]of fe){const fe=ve.get(_e);if(fe!==be||void 0===fe&&!ve.has(_e))return!1}return!0}(fe,ve):!!g$2I(fe)&&g$2I(ve)&&function w$23(fe,ve){if(null===fe||null===ve)return!1;const _e=Object.keys(fe);if(null===ve||Object.keys(ve).length!==_e.length)return!1;for(const be of _e)if(fe[be]!==ve[be]||!Object.prototype.hasOwnProperty.call(ve,be))return!1;return!0}(fe,ve))}function n$4R(fe,ve,_e=!1){return o$4t(fe,ve,_e)}function t$4s(fe,ve){if(null!=ve)return ve[fe]||i$4V(fe.split("."),!1,ve)}function e$4h(fe,ve,_e){const be=fe.split("."),we=be.pop(),Se=i$4V(be,!0,_e);Se&&we&&(Se[we]=ve)}function u$4f(fe,ve){if(null==fe&&null==ve)return!1;if(null==fe)return!0;if(null==ve)return!0;if("object"==typeof fe){if(Array.isArray(fe)){const _e=ve;if(fe.length!==_e.length)return!0;for(let ve=0;ve<fe.length;ve++)if(u$4f(fe[ve],_e[ve]))return!0;return!1}if(Object.keys(fe).length!==Object.keys(ve).length)return!0;for(const _e in fe)if(u$4f(fe[_e],ve[_e]))return!0;return!1}return fe!==ve}function i$4V(fe,ve,_e){let be=_e;for(const we of fe){if(null==be)return;if(!(we in be)){if(!ve)return;be[we]={}}be=be[we]}return be}function o$4t(fe,ve,_e){return ve?Object.keys(ve).reduce(((fe,be)=>{let we=fe[be],Se=ve[be];return we===Se?fe:void 0===we?(fe[be]=a$4H(Se),fe):(Array.isArray(Se)||Array.isArray(fe)?(we=we?Array.isArray(we)?fe[be]=we.concat():fe[be]=[we]:fe[be]=[],Se&&(Array.isArray(Se)||(Se=[Se]),_e?Se.forEach((fe=>{we.includes(fe)||we.push(fe)})):fe[be]=Se.concat())):Se&&"object"==typeof Se?fe[be]=o$4t(we,Se,_e):fe.hasOwnProperty(be)&&!ve.hasOwnProperty(be)||(fe[be]=Se),fe)}),fe||{}):fe}const ir={apiKey:void 0,applicationName:"",applicationUrl:null==(we=globalThis.location)?void 0:we.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(n$4R(ir,globalThis.esriConfig,!0),delete ir.has),!ir.assetsPath){{const fe="4.30";ir.assetsPath=`https://js.arcgis.com/${fe}/@arcgis/core/assets`}ir.defaultAssetsPath=ir.assetsPath}const nr=/\{([^}]+)\}/g;function n$4Q(fe){return fe??""}function r$3O(fe,ve){return ve?fe.replaceAll(nr,"object"==typeof ve?(fe,_e)=>n$4Q(t$4s(_e,ve)):(fe,_e)=>n$4Q(ve(_e))):fe}function o$4s(fe,ve){return fe.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,(fe=>(null==ve?void 0:ve.includes(fe))?fe:`\\${fe}`))}function l$4F(fe){let ve=0;for(let _e=0;_e<fe.length;_e++)ve=(ve<<5)-ve+fe.charCodeAt(_e),ve|=0;return ve}let sr;function c$53(fe){return sr??(sr=new DOMParser),sr.parseFromString(fe||"","text/html").body.innerText||""}function i$4U(fe,ve){return new RegExp(`{${ve}}`,"ig").test(fe)}function f$3y(fe,...ve){let _e=fe[0];for(let be=0;be<ve.length;++be)_e+=ve[be]+fe[be+1];return _e}const or={info:0,warn:1,error:2,none:3};let ar=class n{constructor(fe){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=fe.level&&(this.level=fe.level),null!=fe.writer&&(this.writer=fe.writer),this._module=fe.module,n._loggers.set(this.module,this);const ve=this.module.lastIndexOf(".");-1!==ve&&(this._parent=n.getLogger(this.module.slice(0,ve)))}get module(){return this._module}get parent(){return this._parent}error(...fe){this._log("error","always",...fe)}warn(...fe){this._log("warn","always",...fe)}info(...fe){this._log("info","always",...fe)}errorOnce(...fe){this._log("error","once",...fe)}warnOnce(...fe){this._log("warn","once",...fe)}infoOnce(...fe){this._log("info","once",...fe)}errorOncePerTick(...fe){this._log("error","oncePerTick",...fe)}warnOncePerTick(...fe){this._log("warn","oncePerTick",...fe)}infoOncePerTick(...fe){this._log("info","oncePerTick",...fe)}get test(){}static get test(){}static getLogger(fe){return fe="string"!=typeof fe?fe.declaredClass:fe,n._loggers.get(fe)||new n({module:fe})}_log(fe,ve,..._e){if(this._matchLevel(fe)){if("always"!==ve&&!n._throttlingDisabled){const be=function o$4r(...fe){const r65=(fe,ve)=>"object"!=typeof ve||Array.isArray(ve)?ve:"[Object]";return l$4F(JSON.stringify(fe,r65))}(_e),we=this._loggedMessages[fe].get(be);if("once"===ve&&null!=we||"oncePerTick"===ve&&we&&we>=n._tickCounter)return;this._loggedMessages[fe].set(be,n._tickCounter),n._scheduleTickCounterIncrement()}for(const ve of ir.log.interceptors)if(ve(fe,this.module,..._e))return;this._inheritedWriter()(fe,this.module,..._e)}}_parentWithMember(fe,ve){let _e=this;for(;null!=_e;){const ve=_e[fe];if(null!=ve)return ve;_e=_e.parent}return ve}_inheritedWriter(){return this._parentWithMember("writer",i$4T)}_matchLevel(fe){const ve=ir.log.level||"warn";return or[this._parentWithMember("level",ve)]<=or[fe]}static _scheduleTickCounterIncrement(){n._tickCounterScheduled||(n._tickCounterScheduled=!0,Promise.resolve().then((()=>{n._tickCounter++,n._tickCounterScheduled=!1})))}};function i$4T(fe,ve,..._e){}function n$4O(fe,ve){if(null==fe)throw new Error(ve??"value is None")}function u$4d(fe){return null==fe||fe.destroy(),null}function r$3M(fe){return null==fe||fe.dispose(),null}function l$4E(fe){return null==fe||fe.remove(),null}function e$4f(fe){return null==fe||fe.abort(),null}function t$4r(fe){return null==fe||fe.release(),null}function o$4q(fe,ve,_e){return null!=fe&&null!=ve?null!=_e?_e(fe,ve):fe.equals(ve):fe===ve}function i$4S(fe,ve){return null==fe?void 0:fe[ve]}ar._loggers=new Map,ar._tickCounter=0,ar._tickCounterScheduled=!1,ar._throttlingDisabled=!1;const lr=Symbol("Accessor-beforeDestroy"),cr={remove:()=>{}};function e$4e(fe){return fe?{remove(){fe&&(fe(),fe=void 0)}}:cr}function r$3L(fe){fe.forEach((fe=>null==fe?void 0:fe.remove()))}function o$4o(fe){return e$4e((()=>r$3L(fe)))}function t$4q(fe){return e$4e((()=>{var ve;return null==(ve=fe())?void 0:ve.remove()}))}function l$4D(fe){return e$4e(null!=fe?()=>fe.destroy():void 0)}function t$4p(fe){return fe.__accessor__??null}function u$4c(fe,ve,_e){return o$4n(fe,ve,_e?{policy:_e,path:""}:null)}function o$4n(fe,ve,_e){return ve?Object.keys(ve).reduce(((fe,be)=>{const we=be;let Se=null,Te="merge";if(_e&&(Se=_e.path?`${_e.path}.${be}`:be,Te=_e.policy(Se)),"replace"===Te)return fe[we]=ve[we],fe;if("replace-arrays"===Te&&Array.isArray(fe[we]))return fe[we]=ve[we],fe;if(void 0===fe[we])return fe[we]=a$4H(ve[we]),fe;let Ee=fe[we],Ce=ve[we];if(Ee===Ce)return fe;if(Array.isArray(Ce)||Array.isArray(fe))Ee=Ee?Array.isArray(Ee)?fe[we]=Ee.concat():fe[we]=[Ee]:fe[we]=[],Ce&&(Array.isArray(Ce)||(Ce=[Ce]),Ce.forEach((fe=>{Ee.includes(fe)||Ee.push(fe)})));else if(Ce&&"object"==typeof Ce)if(_e){const ve=_e.path;_e.path=Se,fe[we]=o$4n(Ee,Ce,_e),_e.path=ve}else fe[we]=o$4n(Ee,Ce,null);else fe.hasOwnProperty(be)&&!ve.hasOwnProperty(be)||(fe[we]=Ce);return fe}),fe||{}):fe}function l$4C(fe){return Array.isArray(fe)?fe:fe.split(".")}function s$4x(fe){return fe.includes(",")?fe.split(",").map((fe=>fe.trim())):[fe.trim()]}function p$56(fe,ve,_e,be){const we=function c$52(fe){if(Array.isArray(fe)){const ve=[];for(const _e of fe)ve.push(...s$4x(_e));return ve}return s$4x(fe)}(ve);if(1!==we.length){return o$4o(we.map((ve=>be(fe,ve,_e))))}return be(fe,we[0],_e)}function e$4c(fe,ve){const _e="?"===fe[fe.length-1]?fe.slice(0,-1):fe;if(null!=ve.getItemAt||Array.isArray(ve)){const fe=parseInt(_e,10);if(!isNaN(fe))return Array.isArray(ve)?ve[fe]:ve.at(fe)}const be=t$4p(ve);return function e$4d(fe,ve){var _e;return null!=(null==(_e=null==fe?void 0:fe.metadata)?void 0:_e[ve])}(be,_e)?be.get(_e):ve[_e]}function i$4R(fe,ve,_e){if(null==fe)return fe;const be=e$4c(ve[_e],fe);return!be&&_e<ve.length-1?void 0:_e===ve.length-1?be:i$4R(be,ve,_e+1)}function u$4b(fe,ve,_e=0){return"string"!=typeof ve||ve.includes(".")?i$4R(fe,l$4C(ve),_e):e$4c(ve,fe)}function o$4m(fe,ve){return u$4b(fe,ve)}function s$4w(fe,ve){return void 0!==u$4b(ve,fe)}var ur,hr;function r$3K(fe){let ve=fe.constructor.__accessorMetadata__;const _e=Object.prototype.hasOwnProperty.call(fe.constructor,"__accessorMetadata__");if(ve){if(!_e){ve=Object.create(ve);for(const fe in ve)ve[fe]=a$4H(ve[fe]);Object.defineProperty(fe.constructor,"__accessorMetadata__",{value:ve,enumerable:!1,configurable:!0,writable:!0})}}else ve={},Object.defineProperty(fe.constructor,"__accessorMetadata__",{value:ve,enumerable:!1,configurable:!0,writable:!0});return fe.constructor.__accessorMetadata__}function o$4l(fe,ve){const _e=r$3K(fe);let be=_e[ve];return be||(be=_e[ve]={}),be}(hr=ur||(ur={}))[hr.INITIALIZING=0]="INITIALIZING",hr[hr.CONSTRUCTING=1]="CONSTRUCTING",hr[hr.CONSTRUCTED=2]="CONSTRUCTED",hr[hr.DESTROYED=3]="DESTROYED";const dr=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function n$4M(fe){return dr.test(fe)?"replace":"merge"}let pr=class e{constructor(fe,ve,_e,be=1,we=0){if(this._ctor=fe,this._acquireFunction=ve,this._releaseFunction=_e,this.allocationSize=be,this._pool=new Array(we),this._initialSize=we,this._ctor)for(let Se=0;Se<we;Se++)this._pool[Se]=new this._ctor;this.allocationSize=Math.max(be,1)}destroy(){this.prune(0)}acquire(...fe){let ve;if(e.test.disabled)ve=new this._ctor;else{if(0===this._pool.length){const fe=this.allocationSize;for(let ve=0;ve<fe;ve++)this._pool[ve]=new this._ctor}ve=this._pool.pop()}return this._acquireFunction?this._acquireFunction(ve,...fe):function i$4Q(fe){return(null==fe?void 0:fe.acquire)&&"function"==typeof fe.acquire}(ve)&&ve.acquire(...fe),ve}release(fe){fe&&!e.test.disabled&&(this._releaseFunction?this._releaseFunction(fe):function t$4o(fe){return(null==fe?void 0:fe.release)&&"function"==typeof fe.release}(fe)&&fe.release(),this._pool.push(fe))}prune(fe=this._initialSize){if(!(fe>=this._pool.length)){for(let ve=fe;ve<this._pool.length;++ve){const fe=this._pool[ve];this._dispose(fe)}this._pool.length=fe}}_dispose(fe){fe.dispose&&"function"==typeof fe.dispose&&fe.dispose()}};pr.test={disabled:!1};let fr=class s{constructor(fe,ve){this._observers=fe,this._observer=ve}remove(){L$1i(this._observers,this._observer)}},mr=class r2{constructor(){this._observers=null,this.destroyed=!1}observe(fe){if(this.destroyed||fe.destroyed)return yr;null==this._observers&&(this._observers=[]);const ve=this._observers;let _e=!1,be=!1;const we=ve.length;for(let Se=0;Se<we;++Se){const we=ve[Se];if(we.destroyed)be=!0;else if(we===fe){_e=!0;break}}return _e||(ve.push(fe),be&&this._removeDestroyedObservers()),new fr(ve,fe)}_removeDestroyedObservers(){const fe=this._observers;if(!fe||0===fe.length)return;const ve=fe.length;let _e=0;for(let be=0;be<ve;++be){for(;be+_e<ve&&fe[be+_e].destroyed;)++_e;if(_e>0){if(!(be+_e<ve))break;fe[be]=fe[be+_e]}}fe.length=ve-_e}destroy(){if(this.destroyed)return;this.destroyed=!0;const fe=this._observers;if(null!=fe){for(const ve of fe)ve.onCommitted();this._observers=null}}};const yr=e$4e();var gr,vr;(vr=gr||(gr={}))[vr.DEFAULTS=0]="DEFAULTS",vr[vr.COMPUTED=1]="COMPUTED",vr[vr.SERVICE=2]="SERVICE",vr[vr.PORTAL_ITEM=3]="PORTAL_ITEM",vr[vr.WEB_SCENE=4]="WEB_SCENE",vr[vr.WEB_MAP=5]="WEB_MAP",vr[vr.LINK_CHART=6]="LINK_CHART",vr[vr.USER=7]="USER";const _r=gr.USER+1;function n$4L(fe){switch(fe){case"defaults":return gr.DEFAULTS;case"service":return gr.SERVICE;case"portal-item":return gr.PORTAL_ITEM;case"web-scene":return gr.WEB_SCENE;case"web-map":return gr.WEB_MAP;case"link-chart":return gr.LINK_CHART;case"user":return gr.USER;default:return null}}function t$4m(fe){switch(fe){case gr.DEFAULTS:return"defaults";case gr.SERVICE:return"service";case gr.PORTAL_ITEM:return"portal-item";case gr.WEB_SCENE:return"web-scene";case gr.WEB_MAP:return"web-map";case gr.LINK_CHART:return"link-chart";case gr.USER:return"user"}}function u$4a(fe){return t$4m(fe)}var $r,br;(br=$r||($r={}))[br.Dirty=1]="Dirty",br[br.Overridden=2]="Overridden",br[br.Computing=4]="Computing",br[br.NonNullable=8]="NonNullable",br[br.HasDefaultValue=16]="HasDefaultValue",br[br.DepTrackingInitialized=32]="DepTrackingInitialized",br[br.AutoTracked=64]="AutoTracked",br[br.ExplicitlyTracking=128]="ExplicitlyTracking";const wr={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},xr=[];let Sr=wr;function s$4u(fe){Sr.onObservableAccessed(fe)}let Tr=!1,Er=!1;function f$3w(fe,ve,_e){if(Tr)return u$49(fe,ve,_e);p$55(fe);const be=ve.call(_e);return d$3B(),be}function u$49(fe,ve,_e){const be=Tr;Tr=!0,p$55(fe);let we=null;try{we=ve.call(_e)}catch(br){Er&&ar.getLogger("esri.core.accessorSupport.tracking").error(br)}return d$3B(),Tr=be,we}function p$55(fe){Sr=fe,xr.push(fe)}function d$3B(){const fe=xr.length;if(fe>1){const ve=xr.pop();Sr=xr[fe-2],ve.onTrackingEnd()}else if(1===fe){const fe=xr.pop();Sr=wr,fe.onTrackingEnd()}else Sr=wr}function m$3T(fe,ve){if(ve.flags&$r.DepTrackingInitialized)return;const _e=Er;Er=!1,ve.flags&$r.AutoTracked?u$49(ve,ve.metadata.get,fe):k$1D(fe,ve),Er=_e}const Pr=[];function k$1D(fe,ve){ve.flags&$r.ExplicitlyTracking||(ve.flags|=$r.ExplicitlyTracking,u$49(ve,(()=>{const _e=ve.metadata.dependsOn||Pr;for(const ve of _e)if("string"!=typeof ve||ve.includes(".")){const _e=l$4C(ve);for(let ve=0,be=fe;ve<_e.length&&null!=be&&"object"==typeof be;++ve)be=A$1K(be,_e[ve],ve!==_e.length-1)}else A$1K(fe,ve,!1)})),ve.flags&=~$r.ExplicitlyTracking)}function A$1K(fe,ve,_e){const be="?"===ve[ve.length-1]?ve.slice(0,-1):ve;if(null!=fe.getItemAt||Array.isArray(fe)){const ve=parseInt(be,10);if(!isNaN(ve))return Array.isArray(fe)?fe[ve]:fe.at(ve)}const we=t$4p(fe);if(we){const ve=we.propertiesByName.get(be);ve&&(s$4u(ve),m$3T(fe,ve))}return _e?fe[be]:void 0}let Cr=class r3 extends mr{constructor(fe,ve){super(),this.propertyName=fe,this.metadata=ve,this._accessed=null,this._handles=null,this.flags=0,this.flags=$r.Dirty|(ve.nonNullable?$r.NonNullable:0)|(ve.hasOwnProperty("value")?$r.HasDefaultValue:0)|(void 0===ve.get?$r.DepTrackingInitialized:0)|(void 0===ve.dependsOn?$r.AutoTracked:0)}destroy(){this.flags&$r.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(fe){s$4u(this);const ve=fe.store,_e=this.propertyName,be=this.flags,we=ve.get(_e);if(be&$r.Computing)return we;if(~be&$r.Dirty&&ve.has(_e))return we;this.flags|=$r.Computing;const Se=fe.host;let Te;be&$r.AutoTracked?Te=f$3w(this,this.metadata.get,Se):(k$1D(Se,this),Te=this.metadata.get.call(Se)),ve.set(_e,Te,gr.COMPUTED);const Ee=ve.get(_e);return Ee===we?this.flags&=~$r.Dirty:function g$2H(fe,ve){return f$3w(wr,fe,ve)}(this.commit,this),this.flags&=~$r.Computing,Ee}onObservableAccessed(fe){fe!==this&&(this._accessed??(this._accessed=new Set),this._accessed.add(fe))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=$r.DepTrackingInitialized,null!=this._accessed&&(this._handles??(this._handles=[]),this._accessed.forEach((fe=>{this._handles.push(fe.observe(this))})),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~$r.Dirty,this.onCommitted()}_clearObservationHandles(){const fe=this._handles;if(null!==fe){for(let ve=0;ve<fe.length;++ve)fe[ve].remove();fe.length=0}}onInvalidated(){~this.flags&$r.Overridden&&(this.flags|=$r.Dirty);const fe=this._observers;if(fe&&fe.length>0)for(const ve of fe)ve.onInvalidated()}onCommitted(){const fe=this._observers;if(fe&&fe.length>0){const ve=fe.slice();for(const fe of ve)fe.onCommitted()}}},Or=class t2{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(fe){const ve=new t2;return this._values.forEach(((_e,be)=>{fe&&fe.has(be)||ve.set(be,a$4H(_e))})),ve}get(fe){return this._values.get(fe)}originOf(){return gr.USER}keys(){return[...this._values.keys()]}set(fe,ve){this._values.set(fe,ve)}delete(fe){this._values.delete(fe)}has(fe){return this._values.has(fe)}forEach(fe){this._values.forEach(fe)}};function f$3v(fe,ve,_e){return void 0!==fe}function d$3A(fe,ve,_e,be){return!(void 0===fe||null==_e&&fe.flags&$r.NonNullable&&(be.lifecycle,ur.INITIALIZING,1))}let Ar=class g{constructor(fe){this.host=fe,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=ur.INITIALIZING,this.store=new Or,this._origin=gr.USER;const ve=this.host.constructor.__accessorMetadata__;for(const _e in ve){const fe=new Cr(_e,ve[_e]);this.propertiesByName.set(_e,fe)}this.metadata=ve}initialize(){this.lifecycle=ur.CONSTRUCTING}constructed(){this.lifecycle=ur.CONSTRUCTED}destroy(){this.lifecycle=ur.DESTROYED,this.propertiesByName.forEach((fe=>fe.destroy()))}get initialized(){return this.lifecycle!==ur.INITIALIZING}get(fe){const ve=this.propertiesByName.get(fe);if(ve.metadata.get)return ve.getComputed(this);s$4u(ve);const _e=this.store;return _e.has(fe)?_e.get(fe):ve.metadata.value}originOf(fe){const ve=this.store.originOf(fe);if(void 0===ve){const ve=this.propertiesByName.get(fe);if(void 0!==ve&&ve.flags&$r.HasDefaultValue)return"defaults"}return t$4m(ve)}has(fe){return this.propertiesByName.has(fe)&&this.store.has(fe)}keys(){return[...this.propertiesByName.keys()]}internalGet(fe){const ve=this.propertiesByName.get(fe);if(f$3v(ve))return this.store.has(fe)?this.store.get(fe):ve.metadata.value}internalSet(fe,ve){const _e=this.propertiesByName.get(fe);f$3v(_e)&&this._internalSet(_e,ve)}getDependsInfo(fe,ve,_e){const be=this.propertiesByName.get(ve);if(!f$3v(be))return"";const we=new Set,Se=f$3w({onObservableAccessed:fe=>we.add(fe),onTrackingEnd:()=>{}},(()=>{var ve;return null==(ve=be.metadata.get)?void 0:ve.call(fe)}));let Te=`${_e}${fe.declaredClass.split(".").pop()}.${ve}: ${Se}\n`;if(0===we.size)return Te;_e+="  ";for(const Ee of we)Ee instanceof Cr&&(Te+=`${_e}${Ee.propertyName}: undefined\n`);return Te}setAtOrigin(fe,ve,_e){const be=this.propertiesByName.get(fe);if(f$3v(be))return this._setAtOrigin(be,ve,_e)}isOverridden(fe){const ve=this.propertiesByName.get(fe);return void 0!==ve&&!!(ve.flags&$r.Overridden)}clearOverride(fe){const ve=this.propertiesByName.get(fe);ve&&ve.flags&$r.Overridden&&(ve.flags&=~$r.Overridden,ve.notifyChange())}override(fe,ve){const _e=this.propertiesByName.get(fe);if(!d$3A(_e,0,ve,this))return;const be=_e.metadata.cast;if(be){const fe=this._cast(be,ve),{valid:_e,value:we}=fe;if(Mr.release(fe),!_e)return;ve=we}_e.flags|=$r.Overridden,this._internalSet(_e,ve)}set(fe,ve){const _e=this.propertiesByName.get(fe);if(!d$3A(_e,0,ve,this))return;const be=_e.metadata.cast;if(be){const fe=this._cast(be,ve),{valid:_e,value:we}=fe;if(Mr.release(fe),!_e)return;ve=we}const we=_e.metadata.set;we?we.call(this.host,ve):this._internalSet(_e,ve)}setDefaultOrigin(fe){this._origin=n$4L(fe)}getDefaultOrigin(){return t$4m(this._origin)}notifyChange(fe){const ve=this.propertiesByName.get(fe);void 0!==ve&&ve.notifyChange()}invalidate(fe){const ve=this.propertiesByName.get(fe);void 0!==ve&&ve.invalidate()}commit(fe){const ve=this.propertiesByName.get(fe);void 0!==ve&&ve.commit()}_internalSet(fe,ve){const _e=this.lifecycle!==ur.INITIALIZING?this._origin:gr.DEFAULTS;this._setAtOrigin(fe,ve,_e)}_setAtOrigin(fe,ve,_e){const be=this.store,we=fe.propertyName;be.has(we,_e)&&j$1V(ve,be.get(we))&&~fe.flags&$r.Overridden&&_e===be.originOf(we)||(fe.invalidate(),be.set(we,ve,_e),fe.commit(),m$3T(this.host,fe))}_cast(fe,ve){const _e=Mr.acquire();return _e.valid=!0,_e.value=ve,fe&&(_e.value=fe.call(this.host,ve,_e)),_e}};const Mr=new pr(class m{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});let Rr=class e2{constructor(fe,ve,_e=void 0){this.name=fe,this.details=_e,this.message=(ve&&function s$4t(fe,ve){return fe.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,((fe,_e)=>""===_e?"$":(t$4s(_e,ve)??"").toString()))}(ve,_e))??""}toString(){return"["+this.name+"]: "+this.message}},Ir=class s2 extends Rr{constructor(fe,ve,_e){super(fe,ve,_e)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((fe,ve)=>{if(ve&&"object"==typeof ve&&"function"==typeof ve.toJSON)return ve;try{return a$4H(ve)}catch(vv){return"[object]"}})))}}catch(Dr){throw ar.getLogger("esri.core.Error").error(Dr),Dr}return{name:this.name,message:this.message,details:this.details}}static fromJSON(fe){return new s2(fe.name,fe.message,fe.details)}};function t$4k(fe,ve,_e){if(fe&&ve)if("object"==typeof ve)for(const be of Object.getOwnPropertyNames(ve))t$4k(fe,be,ve[be]);else{if(ve.includes(".")){const be=ve.split("."),we=be.splice(-1,1)[0];return void t$4k(o$4m(fe,be),we,_e)}const be=fe.__accessor__;null!=be&&function n$4K(fe,ve){if(has("esri-unknown-property-errors")&&!function e$48(fe,ve){return null!=ve.metadata[fe]}(fe,ve))throw new Ir("set:unknown-property",function s$4r(fe,ve){return"setting unknown property '"+fe+"' on instance of "+ve.host.declaredClass}(fe,ve))}(ve,be),fe[ve]=_e}}var Lr,Dr;function r$3F(fe){fe.length=0}Ir.prototype.type="error",(Dr=Lr||(Lr={}))[Dr.Ignore=0]="Ignore",Dr[Dr.Destroy=1]="Destroy",Dr[Dr.ThrowError=2]="ThrowError";let Nr=class t3{constructor(fe=50,ve=50){this._pool=new pr(Array,void 0,r$3F,ve,fe)}acquire(){return this._pool.acquire()}release(fe){this._pool.release(fe)}prune(){this._pool.prune(0)}static acquire(){return Fr.acquire()}static release(fe){return Fr.release(fe)}static prune(){Fr.prune()}};const Fr=new Nr(100);let zr=class s3 extends pr{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...fe){const ve=super.acquire(...fe);return this._set.delete(ve),ve}release(fe){fe&&!this._set.has(fe)&&(super.release(fe),this._set.add(fe))}_dispose(fe){this._set.delete(fe),super._dispose(fe)}};const kr=[];function t$4h(fe){kr.push(fe),1===kr.length&&queueMicrotask((()=>{const fe=kr.slice();kr.length=0;for(const ve of fe)ve()}))}let Ur=class s4{constructor(fe,ve=30){this.name=fe,this._counter=0,this._samples=new Array(ve)}record(fe){null!=fe&&(this._samples[++this._counter%this._samples.length]=fe)}get median(){return this._samples.slice().sort(((fe,ve)=>fe-ve))[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce(((fe,ve)=>fe+ve),0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var Vr;!function(fe){const t84=(fe,ve,_e,be)=>{let we=ve,Se=ve;const Te=_e>>>1,Ee=fe[we-1];for(;Se<=Te;){Se=we<<1,Se<_e&&be(fe[Se-1],fe[Se])<0&&++Se;const ve=fe[Se-1];if(be(ve,Ee)<=0)break;fe[we-1]=ve,we=Se}fe[we-1]=Ee},n52=(fe,ve)=>fe<ve?-1:fe>ve?1:0;fe.sort=function e76(fe,ve,_e,be){void 0===ve&&(ve=0),void 0===_e&&(_e=fe.length),void 0===be&&(be=n52);for(let Se=_e>>>1;Se>ve;Se--)t84(fe,Se,_e,be);const we=ve+1;for(let Se=_e-1;Se>ve;Se--){const _e=fe[ve];fe[ve]=fe[Se],fe[Se]=_e,t84(fe,we,Se,be)}},fe.iterableSort=function*i52(fe,ve,_e,be){void 0===ve&&(ve=0),void 0===_e&&(_e=fe.length),void 0===be&&(be=n52);for(let Se=_e>>>1;Se>ve;Se--)t84(fe,Se,_e,be),yield;const we=ve+1;for(let Se=_e-1;Se>ve;Se--){const _e=fe[ve];fe[ve]=fe[Se],fe[Se]=_e,t84(fe,we,Se,be),yield}}}(Vr||(Vr={}));const Br=Vr;let jr=class l{constructor(fe){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Wt,fe&&(fe.initialSize&&(this.data=new Array(fe.initialSize)),fe.allocator&&(this._allocator=fe.allocator),void 0!==fe.deallocator&&(this._deallocator=fe.deallocator),fe.shrink&&(this._shrink=()=>n$4J(this)))}toArray(){return this.data.slice(0,this.length)}filter(fe){const ve=new Array;for(let _e=0;_e<this._length;_e++){const be=this.data[_e];fe(be)&&ve.push(be)}return ve}at(fe){if((fe=Math.trunc(fe)||0)<0&&(fe+=this._length),!(fe<0||fe>=this._length))return this.data[fe]}includes(fe,ve){const _e=this.data.indexOf(fe,ve);return-1!==_e&&_e<this.length}get length(){return this._length}set length(fe){if(fe>this._length){if(this._allocator){for(;this._length<fe;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=fe}else{if(this._deallocator)for(let ve=fe;ve<this._length;++ve)this.data[ve]=this._deallocator(this.data[ve]);this._length=fe,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(fe){this.data[this._length++]=fe}pushArray(fe,ve=fe.length){for(let _e=0;_e<ve;_e++)this.data[this._length++]=fe[_e]}fill(fe,ve){for(let _e=0;_e<ve;_e++)this.data[this._length++]=fe}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const fe=this.data[this._length];return++this._length,fe}unshift(fe){this.data.unshift(fe),this._length++,n$4J(this)}pop(){if(0===this.length)return;const fe=this.data[this.length-1];return this.length=this.length-1,this._shrink(),fe}remove(fe){const ve=y$2D(this.data,fe,this.length,this._hint);if(-1!==ve)return this.data.splice(ve,1),this.length=this.length-1,fe}removeUnordered(fe){return this.removeUnorderedIndex(y$2D(this.data,fe,this.length,this._hint))}removeUnorderedIndex(fe){if(!(fe>=this.length||fe<0))return this.swapElements(fe,this.length-1),this.pop()}removeUnorderedMany(fe,ve=fe.length,_e){this.length=function A$1M(fe,ve,_e=fe.length,be=ve.length,we,Se){if(0===be||0===_e)return _e;Xt.clear();for(let Ee=0;Ee<be;++Ee)Xt.add(ve[Ee]);we=we||Yt;const Te=Math.max(0,we.last-10);for(let Ee=Te;Ee<_e;++Ee)if(Xt.has(fe[Ee])&&(null==Se||Se.push(fe[Ee]),Xt.delete(fe[Ee]),fe[Ee]=fe[_e-1],--_e,--Ee,0===Xt.size||0===_e))return Xt.clear(),_e;for(let Ee=0;Ee<Te;++Ee)if(Xt.has(fe[Ee])&&(null==Se||Se.push(fe[Ee]),Xt.delete(fe[Ee]),fe[Ee]=fe[_e-1],--_e,--Ee,0===Xt.size||0===_e))return Xt.clear(),_e;return Xt.clear(),_e}(this.data,fe,this.length,ve,this._hint,_e),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(fe,ve){if(fe>=this.length||ve>=this.length||fe===ve)return;const _e=this.data[fe];this.data[fe]=this.data[ve],this.data[ve]=_e}sort(fe){Br.sort(this.data,0,this.length,fe)}iterableSort(fe){return Br.iterableSort(this.data,0,this.length,fe)}some(fe,ve){for(let _e=0;_e<this.length;++_e)if(fe.call(ve,this.data[_e],_e,this.data))return!0;return!1}find(fe,ve){for(let _e=0;_e<this.length;++_e){const be=this.data[_e];if(fe.call(ve,be,_e))return be}}filterInPlace(fe,ve){let _e=0;for(let be=0;be<this._length;++be){const we=this.data[be];fe.call(ve,we,be,this.data)&&(this.data[be]=this.data[_e],this.data[_e]=we,_e++)}if(this._deallocator)for(let be=_e;be<this._length;be++)this.data[be]=this._deallocator(this.data[be]);return this._length=_e,this._shrink(),this}forAll(fe,ve){const{data:_e,length:be}=this;for(let we=0;we<be;++we)fe.call(ve,_e[we],we,_e)}forEach(fe,ve){this.data.slice(0,this.length).forEach(fe,ve)}map(fe,ve){const _e=new Array(this.length);for(let be=0;be<this.length;++be)_e[be]=fe.call(ve,this.data[be],be,this.data);return _e}reduce(fe,ve){let _e=ve;for(let be=0;be<this.length;++be)_e=fe(_e,this.data[be],be,this.data);return _e}has(fe){const ve=this.length,_e=this.data;for(let be=0;be<ve;++be)if(_e[be]===fe)return!0;return!1}*[Symbol.iterator](){for(let fe=0;fe<this.length;fe++)yield this.data[fe]}};function n$4J(fe){fe.data.length>1.5*fe.length&&(fe.data.length=Math.floor(1.1*fe.length))}const Gr=function e$46(fe){return{setTimeout:(ve,_e)=>{const be=fe.setTimeout(ve,_e);return e$4e((()=>fe.clearTimeout(be)))}}}(globalThis);function n$4I(fe){return function t$4f(fe){return null!=fe&&"object"==typeof fe&&"on"in fe&&"function"==typeof fe.on}(fe)||r$3E(fe)}function r$3E(fe){return null!=fe&&"object"==typeof fe&&"addEventListener"in fe&&"function"==typeof fe.addEventListener}function o$4e(fe,ve,_e){if(!n$4I(fe))throw new TypeError("target is not a Evented or EventTarget object");return r$3E(fe)?function i$4N(fe,ve,_e,be){if(Array.isArray(ve)){const we=ve.slice();for(const ve of we)fe.addEventListener(ve,_e,be);return e$4e((()=>{for(const ve of we)fe.removeEventListener(ve,_e,be)}))}return fe.addEventListener(ve,_e,be),e$4e((()=>fe.removeEventListener(ve,_e,be)))}(fe,ve,_e):fe.on(ve,_e)}function c$4$(fe,ve,_e){if(!n$4I(fe))throw new TypeError("target is not a Evented or EventTarget object");if("once"in fe)return fe.once(ve,_e);const be=o$4e(fe,ve,(ve=>{be.remove(),_e.call(fe,ve)}));return be}function u$47(fe="Aborted"){return new Ir("AbortError",fe)}function s$4o(fe,ve="Aborted"){if(c$4_(fe))throw u$47(ve)}function l$4z(fe){return fe instanceof AbortSignal?fe:null==fe?void 0:fe.signal}function c$4_(fe){const ve=l$4z(fe);return null!=ve&&ve.aborted}function a$4D(fe){if(b$2g(fe))throw fe}function f$3u(fe){if(!b$2g(fe))throw fe}function m$3R(fe,ve){const _e=l$4z(fe);if(null!=_e){if(!_e.aborted)return c$4$(_e,"abort",(()=>ve()));ve()}}function w$22(fe,ve){const _e=l$4z(fe);if(null!=_e)return s$4o(_e),c$4$(_e,"abort",(()=>ve(u$47())))}function h$2_(fe,ve){return null==l$4z(ve)?fe:new Promise(((_e,be)=>{let we=m$3R(ve,(()=>be(u$47())));const s84=()=>{we=l$4E(we)};fe.then(s84,s84),fe.then(_e,be)}))}function b$2g(fe){return"AbortError"===(null==fe?void 0:fe.name)}async function d$3z(fe){try{return await fe}catch(da){if(!b$2g(da))throw da;return}}async function y$2z(fe,ve=ar.getLogger("esri")){try{return await fe}catch(Dr){b$2g(Dr)||ve.error(Dr)}}async function v$28(fe){if(!fe)return;if("function"!=typeof fe.forEach){const ve=Object.keys(fe),_e=ve.map((ve=>fe[ve])),be=await v$28(_e),we={};return ve.map(((fe,ve)=>we[fe]=be[ve])),we}const ve=fe;return Promise.allSettled(ve).then((fe=>Array.from(ve,((ve,_e)=>{const be=fe[_e];return"fulfilled"===be.status?{promise:ve,value:be.value}:{promise:ve,error:be.reason}}))))}async function g$2F(fe){return(await Promise.allSettled(fe)).filter((fe=>"fulfilled"===fe.status)).map((fe=>fe.value))}function A$1J(fe,ve=void 0,_e){const be=new AbortController;return m$3R(_e,(()=>be.abort())),new Promise(((_e,we)=>{let Se=setTimeout((()=>{Se=0,_e(ve)}),fe);m$3R(be,(()=>{Se&&(clearTimeout(Se),we(u$47()))}))}))}function S$1T(fe){return fe&&"function"==typeof fe.then}function C$1t(fe){return S$1T(fe)?fe:Promise.resolve(fe)}function k$1C(fe,ve=-1){let _e,be,we,Se,Te=null;const l49=(...Ee)=>{if(_e){be=Ee,Se&&Se.reject(u$47()),Se=L$1h();const fe=Se.promise;if(Te){const fe=Te;Te=null,fe.abort()}return fe}if(we=Se||L$1h(),Se=null,ve>0){const be=new AbortController;_e=C$1t(fe(...Ee,be.signal));const we=_e;A$1J(ve).then((()=>{_e===we&&(Se?be.abort():Te=be)}))}else _e=1,_e=C$1t(fe(...Ee));const a55=()=>{const fe=be;be=we=_e=Te=null,null!=fe&&l49(...fe)},Ce=_e,Oe=we;return Ce.then(a55,a55),Ce.then(Oe.resolve,Oe.reject),Oe.promise};return l49}function L$1h(){let fe,ve;const _e=new Promise(((_e,be)=>{fe=_e,ve=be})),o39=ve=>{fe(ve)};return o39.resolve=ve=>fe(ve),o39.reject=fe=>ve(fe),o39.timeout=(fe,ve)=>Gr.setTimeout((()=>o39.reject(ve)),fe),o39.promise=_e,o39}function $$J(fe,ve){return fe.then(ve,ve)}async function D$1i(fe){await Promise.resolve(),s$4o(fe)}function n$4H(fe){return fe}function r$3D(fe){return 1e3*fe}function t$4e(fe){return fe}function u$46(fe){return.001*fe}let Hr=class i{constructor(fe){this.phases=fe,this.paused=!1,this.ticks=-1,this.removed=!1}},qr=class c{constructor(fe){this.callback=fe,this.isActive=!0}remove(){this.isActive=!1}},Wr=0,Yr=0;const Zr={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},Xr=["prepare","preRender","render","postRender","update","finish"],Jr=[],Qr=new jr;let Kr=class d{constructor(fe){this._task=fe}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const ri={frameTasks:Qr,willDispatch:!1,clearFrameTasks:function T$1r(fe=!1){Qr.forAll((fe=>{fe.removed=!0})),fe&&q$13()},dispatch:_$1D,executeFrameTasks:function D$1h(fe){const ve=fe-Wr;Wr=fe;const _e=Yr>0?Yr:1e3/60,be=Math.max(0,ve-_e);Zr.time=fe,Zr.frameDuration=_e-be;for(let we=0;we<Xr.length;we++){const _e=performance.now(),be=Xr[we];Qr.forAll((_e=>{var Se;_e.paused||_e.removed||(0===we&&_e.ticks++,_e.phases[be]&&(Zr.elapsedFrameTime=performance.now()-fe,Zr.deltaTime=0===_e.ticks?0:ve,null==(Se=_e.phases[be])||Se.call(_e,Zr)))})),di[we].record(performance.now()-_e)}q$13(),fi.record(performance.now()-fe)},reschedule:function w$21(){null!=si&&(cancelAnimationFrame(si),si=requestAnimationFrame(x$1X))}};function v$27(fe){const ve=new qr(fe);return Jr.push(ve),ri.willDispatch||(ri.willDispatch=!0,t$4h(_$1D)),ve}function A$1I(fe){const ve=new Hr(fe);return Qr.push(ve),null==si&&(Wr=performance.now(),si=requestAnimationFrame(x$1X)),new Kr(ve)}let si=null;function x$1X(){const fe=performance.now();si=null,si=Qr.length>0?requestAnimationFrame(x$1X):null,ri.executeFrameTasks(fe)}const hi=new jr;function q$13(){Qr.forAll((fe=>{fe.removed&&hi.push(fe)})),Qr.removeUnorderedMany(hi.data,hi.length),hi.clear()}function _$1D(){for(;Jr.length;){const fe=Jr.shift();fe.isActive&&fe.callback()}ri.willDispatch=!1}function y$2y(fe=1,ve){const _e=L$1h(),i52=()=>{c$4_(ve)?_e.reject(u$47()):0===fe?_e():(--fe,t$4h((()=>i52())))};return i52(),_e.promise}function M$1A(fe){return y$2y(1,fe)}async function R$1m(){await M$1A(),await new Promise((fe=>requestAnimationFrame(fe)))}const di=Xr.map((fe=>new Ur(fe))),fi=new Ur("total");function n$4G(fe,ve){for(const _e of fe.entries())if(ve(_e[0]))return!0;return!1}function r$3C(fe,ve){if(!ve)return fe;for(const _e of ve)null!=_e&&fe.add(_e);return fe}function t$4d(fe,ve){return null!=ve&&fe.add(ve),fe}function o$4d(fe,ve){const _e=new Set;return r$3C(_e,fe),r$3C(_e,ve),_e}function u$44(fe,ve){const _e=new Set;for(const be of ve)fe.has(be)&&_e.add(be);return _e}function e$45(fe,ve){if(!fe||!ve)return!1;if(fe===ve)return!0;for(const _e of fe)if(!ve.has(_e))return!1;return!0}function f$3s(fe,ve){if(null==fe&&null==ve)return!0;if(null==fe||null==ve||fe.size!==ve.size)return!1;for(const _e of fe)if(!ve.has(_e))return!1;return!0}function i$4L(fe,ve){const _e=new Set(fe);for(const be of ve)_e.delete(be);return _e}let mi=0;function e$44(){return++mi}let yi=class e3{constructor(fe){this._accessed=new Set,this._handles=[],this._observerObject=new gi(fe),vi.register(this,new WeakRef(this._observerObject),this)}destroy(){var fe;vi.unregister(this._observerObject),this._accessed.clear(),null==(fe=this._observerObject)||fe.destroy(),this.clear()}onObservableAccessed(fe){this._accessed.add(fe)}onTrackingEnd(){const fe=this._handles,ve=this._observerObject;this._accessed.forEach((_e=>{fe.push(_e.observe(ve))})),this._accessed.clear()}clear(){const fe=this._handles;for(let ve=0;ve<fe.length;++ve)fe[ve].remove();fe.length=0}},gi=class s5{constructor(fe){this._notify=fe,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const fe=this._invalidCount;if(1===fe)return this._invalidCount=0,void this._notify();this._invalidCount=fe>0?fe-1:0}destroy(){this.destroyed=!0,this._notify=i$4K}};const vi=new FinalizationRegistry((fe=>{var ve;null==(ve=fe.deref())||ve.destroy()}));function i$4K(){}let _i=!1;const $i=[];function o$4c(fe,ve){let _e=new yi((function a55(){if(!_e||we)return;if(_i)return void c$4X(a55);const Se=be;_e.clear(),_i=!0,we=!0,be=f$3w(_e,fe),we=!1,_i=!1,ve(be,Se),f$3r()})),be=null,we=!1;return we=!0,be=f$3w(_e,fe),we=!1,e$4e((function m39(){_e&&(_e.destroy(),_e=null,be=null)}))}function e$42(fe,ve){let _e=new yi((function i52(){ve(be,f31)})),be=null;function f31(){return _e?(_e.clear(),be=f$3w(_e,fe),be):null}return f31(),e$4e((function c50(){_e&&(_e.destroy(),_e=null),be=null}))}function i$4J(fe){let ve=new yi((function i52(){ve&&!_e&&(_i?c$4X(i52):(ve.clear(),_i=!0,_e=!0,f$3w(ve,fe),_e=!1,_i=!1,f$3r()))})),_e=!1;return _e=!0,f$3w(ve,fe),_e=!1,e$4e((function s84(){ve&&(ve.destroy(),ve=null)}))}function c$4X(fe){$i.includes(fe)||$i.unshift(fe)}function f$3r(){for(;$i.length;)$i.pop()()}var bi;!function(fe){fe[fe.Untracked=0]="Untracked",fe[fe.Tracked=1]="Tracked"}(bi||(bi={}));let wi=class m2{constructor(){this.uid=e$44(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(fe,ve,_e,be,we){return this.pool.acquire(bi.Untracked,fe,ve,_e,be,we,j$1V)}static acquireTracked(fe,ve,_e,be){return this.pool.acquire(bi.Tracked,fe,ve,_e,null,null,be)}notify(fe,ve){this.type===bi.Untracked?this.callback.call(this.target,fe,ve,this.path,this.target):this.callback.call(null,fe,ve,void 0,void 0)}acquire(fe,ve,_e,be,we,Se,Te){this.uid=e$44(),this.removed=!1,this.type=fe,this.oldValue=ve,this.callback=_e,this.getValue=be,this.target=we,this.path=Se,this.equals=Te}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=e$44(),this.removed=!0}};wi.pool=new zr(wi);const xi=new Nr,Si=new Set;let Ti;function _$1C(fe){Si.delete(fe),Si.add(fe),Ti||(Ti=v$27(q$12))}function g$2D(fe){if(fe.removed)return;const ve=fe.oldValue,_e=fe.getValue();fe.equals(ve,_e)||(fe.oldValue=_e,fe.notify(_e,ve))}function q$12(){let fe=10;for(;Ti&&fe--;){Ti=null;const fe=V$1b(),ve=xi.acquire();for(const _e of fe){const fe=_e.uid;g$2D(_e),fe===_e.uid&&_e.removed&&ve.push(_e)}for(const _e of Si)_e.removed&&(ve.push(_e),Si.delete(_e));for(const _e of ve)wi.pool.release(_e);xi.release(ve),xi.release(fe),Ei.forEach((fe=>fe()))}}function V$1b(){const fe=xi.acquire();fe.length=Si.size;let ve=0;for(const _e of Si)fe[ve]=_e,++ve;return Si.clear(),fe}const Ei=new Set;function U$1d(fe){return Ei.add(fe),e$4e((()=>Ei.delete(fe)))}function b$2e(fe,ve,_e,be=!1){return fe.__accessor__&&fe.__accessor__.lifecycle!==ur.DESTROYED?be?function E$1P(fe,ve,_e){const be=p$56(fe,ve,_e,((fe,ve,_e)=>{let we=!1;return o$4c((()=>u$4b(fe,ve)),((Se,Te)=>{fe.__accessor__.lifecycle!==ur.DESTROYED?we||(we=!0,j$1V(Te,Se)||_e.call(fe,Se,Te,ve,fe),we=!1):be.remove()}))}));return be}(fe,ve,_e):function T$1q(fe,ve,_e){let be=p$56(fe,ve,_e,((fe,ve,_e)=>{let we,Se,Te=e$42((()=>u$4b(fe,ve)),((Te,Ee)=>{var Ce;(null==(Ce=fe.__accessor__)?void 0:Ce.lifecycle)===ur.DESTROYED||we&&we.uid!==Se?be.remove():(we||(we=wi.acquireUntracked(Te,_e,Ee,fe,ve),Se=we.uid),_$1C(we))}));return e$4e((()=>{Te.remove(),we&&(we.uid!==Se||we.removed||(we.removed=!0,_$1C(we)),we=null),be=Te=null}))}));return be}(fe,ve,_e):e$4e()}function w$20(fe,ve,_e=!1,be=h$2$){return _e?function S$1S(fe,ve,_e){let be=!1;return o$4c(fe,((fe,we)=>{be||(be=!0,_e(we,fe)||ve(fe,we),be=!1)}))}(fe,ve,be):function D$1g(fe,ve,_e){let be,we,Se=e$42(fe,((fe,Te)=>{be&&be.uid!==we?Se.remove():(be||(be=wi.acquireTracked(fe,ve,Te,_e),we=be.uid),_$1C(be))}));return e$4e((()=>{Se.remove(),be&&(be.uid!==we||be.removed||(be.removed=!0,_$1C(be)),be=null),Se=null}))}(fe,ve,be)}function O$1w(fe){return n$4G(Si,(ve=>ve.oldValue===fe))}function n$4E(fe,ve){for(const[_e,be]of fe)if(ve(be,_e))return!0;return!1}function t$4a(fe,ve){for(const[_e,be]of fe)if(ve(be,_e))return be;return null}function r$3B(fe,ve,_e){const be=fe.get(ve);if(void 0!==be)return be;const we=_e();return fe.set(ve,we),we}function o$4b(fe){const ve=new Map;return _e=>(ve.has(_e)||ve.set(_e,fe(_e)),ve.get(_e))}const r$3A=()=>ar.getLogger("esri.core.accessorSupport.ensureTypes");function t$49(fe){return null==fe?fe:new Date(fe)}function o$4a(fe){return null==fe?fe:!!fe}function u$42(fe){return null==fe?fe:fe.toString()}function a$4C(fe){return null==fe?fe:(fe=parseFloat(fe),isNaN(fe)?0:fe)}function s$4m(fe){return null==fe?fe:Math.round(parseFloat(fe))}function c$4W(fe){return null}function i$4I(fe){return(null==fe?void 0:fe.constructor)&&void 0!==fe.constructor.__accessorMetadata__}function l$4w(fe,ve){return null!=ve&&fe&&!(ve instanceof fe)}function f$3q(fe){return fe&&"isCollection"in fe}function p$52(fe){return(null==fe?void 0:fe.Type)?"function"==typeof fe.Type?fe.Type:fe.Type.base:null}function v$25(fe,ve){return!!i$4I(ve)&&(r$3A().error("Accessor#set","Assigning an instance of '"+(ve.declaredClass||"unknown")+"' which is not a subclass of '"+h$2X(fe)+"'"),!0)}function g$2C(fe,ve){return null==ve?ve:f$3q(fe)?function y$2w(fe,ve){if(!(null==ve?void 0:ve.constructor)||!f$3q(ve.constructor))return v$25(fe,ve)?ve:new fe(ve);const _e=p$52(fe.prototype.itemType),be=p$52(ve.constructor.prototype.itemType);return _e?be?_e===be?ve:_e.prototype.isPrototypeOf(be.prototype)?new fe(ve):(v$25(fe,ve),ve):new fe(ve):ve}(fe,ve):l$4w(fe,ve)?v$25(fe,ve)?ve:new fe(ve):ve}function h$2X(fe){var ve;return(null==(ve=null==fe?void 0:fe.prototype)?void 0:ve.declaredClass)||"unknown"}const Pi=new WeakMap;function b$2d(fe,ve){const _e=function d$3x(fe){switch(fe){case Number:return a$4C;case Ci:return s$4m;case Boolean:return o$4a;case String:return u$42;case Date:return t$49;case Oi:return c$4W;default:return r$3B(Pi,fe,(()=>g$2C.bind(null,fe)))}}(fe);return 1===arguments.length?_e:_e(ve)}function w$1$(fe,ve,_e){return 1===arguments.length?w$1$.bind(null,fe):ve?Array.isArray(ve)?ve.map((ve=>fe(ve,_e))):[fe(ve,_e)]:ve}function $$I(fe,ve,_e){return 0!==ve&&Array.isArray(_e)?_e.map((_e=>$$I(fe,ve-1,_e))):fe(_e)}function j$1S(fe,ve,_e){if(2===arguments.length)return _e=>j$1S(fe,ve,_e);if(!_e)return _e;_e=$$I(fe,ve,_e);let be=ve,we=_e;for(;be>0&&Array.isArray(we);)be--,we=we[0];if(void 0!==we)for(let Se=0;Se<be;Se++)_e=[_e];return _e}function M$1z(fe){return!!Array.isArray(fe)&&!fe.some((ve=>{const _e=typeof ve;return!("string"===_e||"number"===_e||"function"===_e&&fe.length>1)}))}function S$1R(fe,ve){if(2===arguments.length)return S$1R(fe).call(null,ve);const _e=new Set,be=fe.filter((fe=>"function"!=typeof fe)),we=fe.filter((fe=>"function"==typeof fe));for(const Ee of fe)"string"!=typeof Ee&&"number"!=typeof Ee||_e.add(Ee);let Se=null,Te=null;return(fe,ve)=>{if(null==fe)return fe;const Ee=typeof fe,Ce="string"===Ee||"number"===Ee;return Ce&&(_e.has(fe)||we.some((fe=>"string"===Ee&&fe===String||"number"===Ee&&fe===Number)))||"object"===Ee&&we.some((ve=>!l$4w(fe,ve)))?fe:(Ce&&be.length?(Se||(Se=be.map((fe=>"string"==typeof fe?`'${fe}'`:`${fe}`)).join(", ")),r$3A().error("Accessor#set",`'${fe}' is not a valid value for this property, only the following values are valid: ${Se}`)):"object"==typeof fe&&we.length?(Te||(Te=we.map((fe=>h$2X(fe))).join(", ")),r$3A().error("Accessor#set",`'${fe}' is not a valid value for this property, value must be one of ${Te}`)):r$3A().error("Accessor#set",`'${fe}' is not a valid value for this property`),ve&&(ve.valid=!1),null)}}function T$1p(fe,ve){if(2===arguments.length)return T$1p(fe).call(null,ve);const _e={},be=[],we=[];for(const Te in fe.typeMap){const ve=fe.typeMap[Te];_e[Te]=b$2d(ve),be.push(h$2X(ve)),we.push(Te)}const Se="string"==typeof fe.key?ve=>ve[fe.key]:fe.key;return ve=>{if(fe.base&&!l$4w(fe.base,ve))return ve;if(null==ve)return ve;const Te=Se(ve)||fe.defaultKeyValue,Ee=_e[Te];if(!Ee)return r$3A().error("Accessor#set",`Invalid property value, value needs to be one of '${be.join("', '")}', or a plain object that can autocast (having .type = '${we.join("', '")}')`),null;if(!l$4w(fe.typeMap[Te],ve))return ve;if("string"==typeof fe.key&&!i$4I(ve)){const _e={};for(const be in ve)be!==fe.key&&(_e[be]=ve[be]);return Ee(_e)}return Ee(ve)}}let Ci=class N{},Oi=class _{};const Ai={native:fe=>({type:"native",value:fe}),array:fe=>({type:"array",value:fe}),oneOf:fe=>({type:"one-of",values:fe})};function D$1f(fe){switch(fe.type){case"native":return b$2d(fe.value);case"array":return w$1$(D$1f(fe.value));case"one-of":return function F$1d(fe){let ve=null;return(_e,be)=>L$1g(_e,fe)?_e:(null==ve&&(ve=I$1H(fe)),r$3A().error("Accessor#set",`Invalid property value, value needs to be of type ${ve}`),be&&(be.valid=!1),null)}(fe);default:return null}}function I$1H(fe){switch(fe.type){case"native":switch(fe.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ci:return"integer";case Date:return"date";case Oi:return"null";default:return h$2X(fe.value)}case"array":return`array of ${I$1H(fe.value)}`;case"one-of":{const ve=fe.values.map((fe=>I$1H(fe)));return`one of ${ve.slice(0,-1)} or ${ve[ve.length-1]}`}}return"unknown"}function L$1g(fe,ve){if(null==fe)return!0;switch(ve.type){case"native":switch(ve.value){case Number:case Ci:return"number"==typeof fe;case Boolean:return"boolean"==typeof fe;case String:return"string"==typeof fe;case Oi:return null===fe}return fe instanceof ve.value;case"array":return!!Array.isArray(fe)&&!fe.some((fe=>!L$1g(fe,ve.value)));case"one-of":return ve.values.some((ve=>L$1g(fe,ve)))}}function y$2v(fe={}){return(ve,_e)=>{if(ve===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${ve.name}.${_e}. Accessor does not support static properties.`);const be=Object.getOwnPropertyDescriptor(ve,_e),we=o$4l(ve,_e);be&&(be.get||be.set?(we.get=be.get||we.get,we.set=be.set||we.set):"value"in be&&("value"in fe&&ar.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${_e}" on "${ve.constructor.name}" already defined in the metadata`,fe),we.value=fe.value=be.value)),null!=fe.readOnly&&(we.readOnly=fe.readOnly);const Se=fe.aliasOf;if(Se){const fe="string"==typeof Se?Se:Se.source,ve="string"==typeof Se?null:!0===Se.overridable;let be;we.dependsOn=[fe],we.get=function(){let ve=o$4m(this,fe);if("function"==typeof ve){be||(be=fe.split(".").slice(0,-1).join("."));const _e=o$4m(this,be);_e&&(ve=ve.bind(_e))}return ve},we.readOnly||(we.set=ve?function(fe){this._override(_e,fe)}:function(ve){t$4k(this,fe,ve)})}const Te=fe.type,Ee=fe.types;we.cast||(Te?we.cast=function h$2W(fe){let ve=0,_e=fe;if(function C$1s(fe){if(!fe||!("type"in fe))return!1;switch(fe.type){case"native":case"array":case"one-of":return!0}return!1}(fe))return D$1f(fe);for(;Array.isArray(_e)&&1===_e.length&&"string"!=typeof _e[0]&&"number"!=typeof _e[0];)_e=_e[0],ve++;const be=_e;if(M$1z(be))return 0===ve?S$1R(be):j$1S(S$1R(be),ve);if(1===ve)return function A$1H(fe,ve){return 1===arguments.length?w$1$((ve=>b$2d(fe,ve))):w$1$((ve=>b$2d(fe,ve)),ve)}(be);if(ve>1)return function k$1z(fe,ve,_e){return 2===arguments.length?j$1S((ve=>b$2d(fe,ve)),ve):j$1S((ve=>b$2d(fe,ve)),ve,_e)}(be,ve);const we=fe;return we.from?we.from:b$2d(we)}(Te):Ee&&(Array.isArray(Ee)?we.cast=w$1$(T$1p(Ee[0])):we.cast=T$1p(Ee))),function c$51(fe,ve){return u$4c(fe,ve,n$4M)}(we,fe),fe.range&&(we.cast=j$1R(we.cast,fe.range))}}function d$3w(fe,ve,_e){const be=o$4l(fe,_e);be.json||(be.json={});let we=be.json;return void 0!==ve&&(we.origins||(we.origins={}),we.origins[ve]||(we.origins[ve]={}),we=we.origins[ve]),we}function j$1R(fe,ve){return _e=>{let be=+fe(_e);return null!=ve.step&&(be=Math.round(be/ve.step)*ve.step),null!=ve.min&&(be=Math.max(ve.min,be)),null!=ve.max&&(be=Math.min(ve.max,be)),be}}let Mi=class s6 extends Rr{constructor(fe,ve,_e){super(fe,ve,_e)}};function e$41(fe){var ve;return!!fe&&(null==(ve=fe.prototype)?void 0:ve.declaredClass)&&0===fe.prototype.declaredClass.indexOf("esri.core.Collection")}Mi.prototype.type="warning";const i$4H=()=>ar.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function p$51(fe,ve,_e){var be,we;fe&&(!_e&&!ve.read||(null==(be=ve.read)?void 0:be.reader)||!1===(null==(we=ve.read)?void 0:we.enabled)||function l$4v(fe){return"types"in fe?j$1Q(fe.types):m$3N(fe.type)}(fe)&&e$4h("read.reader",u$41(fe),ve))}function u$41(fe){var ve,_e;const be=fe.ndimArray??0;if(be>1)return function c$4V(fe){const ve=s$4k(fe),_e=f$3p.bind(null,ve),be=fe.ndimArray??0;return(fe,ve,we)=>{if(null==fe)return fe;fe=_e(fe,we,be);let Se=be,Te=fe;for(;Se>0&&Array.isArray(Te);)Se--,Te=Te[0];if(void 0!==Te)for(let _e=0;_e<Se;_e++)fe=[fe];return fe}}(fe);if(1===be)return a$4B(fe);if("type"in fe&&d$3v(fe.type)){const be=null==(_e=null==(ve=fe.type.prototype)?void 0:ve.itemType)?void 0:_e.Type,we=a$4B("function"==typeof be?{type:be}:{types:be});return(ve,_e,be)=>{const Se=we(ve,_e,be);return Se?new fe.type(Se):Se}}return s$4k(fe)}function s$4k(fe){return"type"in fe?function y$2u(fe){return fe.prototype.read?(ve,_e,be)=>{if(null==ve)return ve;const we=typeof ve;if("object"!==we)return void i$4H().error(`Expected JSON value of type 'object' to deserialize type '${fe.prototype.declaredClass}', but got '${we}'`);const Se=new fe;return Se.read(ve,be),Se}:fe.fromJSON}(fe.type):function g$2B(fe){let ve=null;const _e=fe.errorContext??"type",be=fe.validate;return(we,Se,Te)=>{if(null==we)return we;const Ee=typeof we;if("object"!==Ee)return void i$4H().error(`Expected JSON value of type 'object' to deserialize, but got '${Ee}'`);ve||(ve=function v$24(fe){var ve,_e;const be={};for(const we in fe.typeMap){const Se=fe.typeMap[we],Te=r$3K(Se.prototype);if("function"==typeof fe.key)continue;const Ee=Te[fe.key];if(!Ee)continue;if((null==(ve=Ee.json)?void 0:ve.type)&&Array.isArray(Ee.json.type)&&1===Ee.json.type.length&&"string"==typeof Ee.json.type[0]){be[Ee.json.type[0]]=Se;continue}const Ce=null==(_e=Ee.json)?void 0:_e.write;if(!(null==Ce?void 0:Ce.writer)){be[we]=Se;continue}const Oe=Ce.target,Re="string"==typeof Oe?Oe:fe.key,De={};Ce.writer(we,De,Re),De[Re]&&(be[De[Re]]=Se)}return be}(fe));const Ce=fe.key;if("string"!=typeof Ce)return;const Oe=we[Ce],Re=Oe?ve[Oe]:fe.defaultKeyValue?fe.typeMap[fe.defaultKeyValue]:void 0;if(!Re){const fe=`Type '${Oe||"unknown"}' is not supported`;return(null==Te?void 0:Te.messages)&&we&&Te.messages.push(new Mi(`${_e}:unsupported`,fe,{definition:we,context:Te})),void i$4H().error(fe)}const De=new Re;return De.read(we,Te),be?be(De):De}}(fe.types)}function f$3p(fe,ve,_e,be){return 0!==be&&Array.isArray(ve)?ve.map((ve=>f$3p(fe,ve,_e,be-1))):fe(ve,void 0,_e)}function a$4B(fe){const ve=s$4k(fe);return(fe,_e,be)=>{if(null==fe)return fe;if(Array.isArray(fe)){const _e=[];for(const we of fe){const fe=ve(we,void 0,be);void 0!==fe&&_e.push(fe)}return _e}const we=ve(fe,void 0,be);return void 0!==we?[we]:void 0}}function d$3v(fe){if(!e$41(fe))return!1;const ve=fe.prototype.itemType;return!(!ve||!ve.Type)&&("function"==typeof ve.Type?m$3N(ve.Type):j$1Q(ve.Type))}function m$3N(fe){return!Array.isArray(fe)&&!!fe&&fe.prototype&&("read"in fe.prototype||"fromJSON"in fe||d$3v(fe))}function j$1Q(fe){for(const ve in fe.typeMap)if(!m$3N(fe.typeMap[ve]))return!1;return!0}function r$3z(fe){fe.name&&(fe.read&&"object"==typeof fe.read?void 0===fe.read.source&&(fe.read.source=fe.name):fe.read={source:fe.name},fe.write&&"object"==typeof fe.write?void 0===fe.write.target&&(fe.write.target=fe.name):fe.write={target:fe.name})}function o$49(fe){"boolean"==typeof fe.read?fe.read={enabled:fe.read}:"function"==typeof fe.read?fe.read={enabled:!0,reader:fe.read}:fe.read&&"object"==typeof fe.read&&void 0===fe.read.enabled&&(fe.read.enabled=!0)}function n$4C(fe){"boolean"==typeof fe.write?fe.write={enabled:fe.write}:"function"==typeof fe.write?fe.write={enabled:!0,writer:fe.write}:fe.write&&"object"==typeof fe.write&&void 0===fe.write.enabled&&(fe.write.enabled=!0)}function i$4G(fe,ve){if(!ve.write||ve.write.writer||!1===ve.write.enabled&&!ve.write.overridePolicy)return;const _e=(null==fe?void 0:fe.ndimArray)??0;fe&&(1===_e||"type"in fe&&e$41(fe.type))?ve.write.writer=a$4A:_e>1?ve.write.writer=function l$4u(fe){return(ve,_e,be,we)=>{let Se;if(null===ve)Se=null;else{Se=c$4U(ve,we,fe);let _e=fe,be=Se;for(;_e>0&&Array.isArray(be);)_e--,be=be[0];if(void 0!==be)for(let fe=0;fe<_e;fe++)Se=[Se]}e$4h(be,Se,_e)}}(_e):ve.types?Array.isArray(ve.types)?ve.write.writer=function f$3o(fe){return(ve,_e,be,we)=>ve&&Array.isArray(ve)?s$4j(ve.filter((ve=>u$40(ve,fe,we))),_e,be,we):s$4j(ve,_e,be,we)}(ve.types[0]):ve.write.writer=function o$48(fe){return(ve,_e,be,we)=>ve?u$40(ve,fe,we)?s$4j(ve,_e,be,we):void 0:s$4j(ve,_e,be,we)}(ve.types):ve.write.writer=s$4j}function u$40(fe,ve,_e){for(const be in ve.typeMap)if(fe instanceof ve.typeMap[be])return!0;if(null==_e?void 0:_e.messages){const be=ve.errorContext??"type",we=`Values of type '${("function"!=typeof ve.key?fe[ve.key]:fe.declaredClass)??"Unknown"}' cannot be written`;_e&&_e.messages&&fe&&_e.messages.push(new Ir(`${be}:unsupported`,we,{definition:fe,context:_e})),ar.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(we)}return!1}function s$4j(fe,ve,_e,be){e$4h(_e,p$50(fe,be),ve)}function p$50(fe,ve){return fe&&"function"==typeof fe.write?fe.write({},ve):fe&&"function"==typeof fe.toJSON?fe.toJSON():"number"==typeof fe?y$2t(fe):fe}function y$2t(fe){return fe===-1/0?-Number.MAX_VALUE:fe===1/0?Number.MAX_VALUE:isNaN(fe)?null:fe}function a$4A(fe,ve,_e,be){let we;null===fe?we=null:fe&&"function"==typeof fe.map?(we=fe.map((fe=>p$50(fe,be))),"function"==typeof we.toArray&&(we=we.toArray())):we=[p$50(fe,be)],e$4h(_e,we,ve)}function c$4U(fe,ve,_e){return 0!==_e&&Array.isArray(fe)?fe.map((fe=>c$4U(fe,ve,_e-1))):p$50(fe,ve)}function s$4i(fe,ve){return y$2s(fe,"read",null==ve?void 0:ve.origin)}function a$4z(fe,ve){return y$2s(fe,"write",null==ve?void 0:ve.origin)}function y$2s(fe,ve,_e){let be=null==fe?void 0:fe.json;if((null==be?void 0:be.origins)&&_e){let fe;fe="link-chart"===_e?be.origins[_e]&&("any"===ve||ve in be.origins[_e])?be.origins[_e]:be.origins["web-map"]:be.origins[_e],fe&&("any"===ve||ve in fe)&&(be=fe)}return be}function p$4$(fe){var ve;const _e=function f$3n(fe){return fe.json.types?j$1P(fe.json):fe.type?c$4T(fe):j$1P(fe)}(fe);if(fe.json.origins)for(const be in fe.json.origins){const we=fe.json.origins[be],Se=we.types?u$3$(we):_e;p$51(Se,we,!1),we.types&&!we.write&&(null==(ve=fe.json.write)?void 0:ve.enabled)&&(we.write={...fe.json.write}),i$4G(Se,we)}p$51(_e,fe.json,!0),i$4G(_e,fe.json)}function u$3$(fe){return fe.type?c$4T(fe):j$1P(fe)}function c$4T(fe){if(!fe.type)return;let ve=0,_e=fe.type;for(;Array.isArray(_e)&&!M$1z(_e);)_e=_e[0],ve++;return{type:_e,ndimArray:ve}}function j$1P(fe){if(!fe.types)return;let ve=0,_e=fe.types;for(;Array.isArray(_e);)_e=_e[0],ve++;return{types:_e,ndimArray:ve}}function l$4t(fe){(function e$40(fe){if(fe.json||(fe.json={}),o$49(fe.json),n$4C(fe.json),r$3z(fe.json),fe.json.origins)for(const ve in fe.json.origins)o$49(fe.json.origins[ve]),n$4C(fe.json.origins[ve]),r$3z(fe.json.origins[ve]);return!0})(fe)&&(function n$4D(fe){if(fe.json&&fe.json.origins){const ve=fe.json.origins,_e={"web-document":["web-scene","web-map"]};for(const fe in _e)if(ve[fe]){const be=ve[fe];_e[fe].forEach((fe=>{ve[fe]=be})),delete ve[fe]}}}(fe),p$4$(fe))}const Ri=new Set,Ii=new Set;function a$4y(fe){return ve=>{fe??(fe="esri.core.Accessor"),ve.prototype.declaredClass=fe,function p$4_(fe){const ve=fe.prototype,_e=r$3K(ve),be={};for(const we of Object.getOwnPropertyNames(_e)){const fe=_e[we];l$4t(fe),be[we]={enumerable:!0,configurable:!0,get:l$4s(we,fe),set(ve){const _e=this.__accessor__;if(void 0!==_e){if(!Object.isFrozen(this))return _e.initialized&&fe.readOnly?f$3m("read-only",we):_e.lifecycle===ur.CONSTRUCTED&&fe.constructOnly?f$3m("construct-only",we):void _e.set(we,ve)}else Object.defineProperty(this,we,{enumerable:!0,configurable:!0,writable:!0,value:ve})}}}Object.defineProperties(fe.prototype,be)}(ve);const _e=[],be=[];let we=ve.prototype;for(;we;)we.hasOwnProperty("initialize")&&!Ri.has(we.initialize)&&(Ri.add(we.initialize),_e.push(we.initialize)),we.hasOwnProperty("destroy")&&!Ii.has(we.destroy)&&(Ii.add(we.destroy),be.push(we.destroy)),we=Object.getPrototypeOf(we);Ri.clear(),Ii.clear();const Se=class extends ve{constructor(...fe){if(super(...fe),this.constructor===Se&&"function"==typeof this.postscript){if(_e.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let fe=_e.length-1;fe>=0;fe--)_e[fe].call(this)}}),be.length){let fe=!1;const ve=this[lr];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!fe){fe=!0,ve.call(this);for(let fe=0;fe<be.length;fe++)be[fe].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};Se.__accessorMetadata__=r$3K(ve.prototype),Se.prototype.declaredClass=fe;const Te=(fe||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(Se,"name",{value:Te,configurable:!0}),Se}}function l$4s(fe,ve){return null==ve.get?function(){const ve=this.__accessor__,_e=ve.propertiesByName.get(fe);if(void 0===_e)return;s$4u(_e);const be=ve.store;return be.has(fe)?be.get(fe):_e.metadata.value}:function(){const ve=this.__accessor__,_e=ve.propertiesByName.get(fe);if(void 0!==_e)return _e.getComputed(ve)}}const f$3m=(fe,ve)=>{ar.getLogger("esri.core.Accessor").error(`cannot assign to ${fe} property '${ve}'`)};var Li,Di;function y$2r(fe){var ve;if(null==fe)return{value:fe};if(Array.isArray(fe))return{type:[fe[0]],value:null};switch(typeof fe){case"object":return(null==(ve=fe.constructor)?void 0:ve.__accessorMetadata__)||fe instanceof Date?{type:fe.constructor,value:fe}:fe;case"boolean":return{type:Boolean,value:fe};case"string":return{type:String,value:fe};case"number":return{type:Number,value:fe};case"function":return{type:fe,value:null};default:return}}const Ni=Symbol("Accessor-Handles"),Fi=Symbol("Accessor-Initialized");let zi=class S{static createSubclass(fe={}){if(Array.isArray(fe))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:ve,declaredClass:_e,constructor:be}=fe;delete fe.declaredClass,delete fe.properties,delete fe.constructor;const we=this;class i52 extends we{constructor(...fe){super(...fe),this.inherited=null,be&&be.apply(this,fe)}}r$3K(i52.prototype);for(const Se in fe){const ve=fe[Se];i52.prototype[Se]="function"==typeof ve?function(...fe){const _e=this.inherited;let be;this.inherited=function(...fe){if(we.prototype[Se])return we.prototype[Se].apply(this,fe)};try{be=ve.apply(this,fe)}catch(Te){throw this.inherited=_e,Te}return this.inherited=_e,be}:fe[Se]}for(const Se in ve){y$2v(y$2r(ve[Se]))(i52.prototype,Se)}return a$4y(_e)(i52)}constructor(...fe){var ve;if(this[Li]=null,this[Di]=!1,this.constructor===S)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const _e=new Ar(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:_e}),fe.length>0&&(_e.ctorArgs=(null==(ve=this.normalizeCtorArgs)?void 0:ve.apply(this,fe))??fe[0])}postscript(){const fe=this.__accessor__,ve=fe.ctorArgs;fe.initialize(),ve&&(this.set(ve),fe.ctorArgs=null),fe.constructed(),this.initialize(),this[Fi]=!0}initialize(){}[lr](){this[Ni]=u$4d(this[Ni])}destroy(){var fe;this.destroyed||(function j$1T(fe){for(const ve of Si.values())ve.target===fe&&(ve.removed=!0)}(this),this.__accessor__.destroy(),null==(fe=void 0)||fe.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[Fi]}get destroyed(){var fe;return(null==(fe=this.__accessor__)?void 0:fe.lifecycle)===ur.DESTROYED||!1}commitProperty(fe){o$4m(this,fe)}get(fe){return t$4y(ar.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),o$4m(this,fe)}hasOwnProperty(fe){return this.__accessor__?this.__accessor__.has(fe):Object.prototype.hasOwnProperty.call(this,fe)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(fe,ve){return t$4k(this,fe,ve),this}watch(fe,ve,_e){return b$2e(this,fe,ve,_e)}addHandles(fe,ve){if(this.destroyed){const ve=Array.isArray(fe)?fe:[fe];for(const fe of ve)fe.remove()}else(this[Ni]??(this[Ni]=new jt)).add(fe,ve)}removeHandles(fe){var ve;null==(ve=this[Ni])||ve.remove(fe)}removeAllHandles(){var fe;null==(fe=this[Ni])||fe.removeAll()}removeHandlesReference(fe){var ve;null==(ve=this[Ni])||ve.removeReference(fe)}hasHandles(fe){var ve;return!0===(null==(ve=this[Ni])?void 0:ve.has(fe))}_override(fe,ve){void 0===ve?this.__accessor__.clearOverride(fe):this.__accessor__.override(fe,ve)}_clearOverride(fe){return this.__accessor__.clearOverride(fe)}_overrideIfSome(fe,ve){null==ve?this.__accessor__.clearOverride(fe):this.__accessor__.override(fe,ve)}_isOverridden(fe){return this.__accessor__.isOverridden(fe)}notifyChange(fe){this.__accessor__.notifyChange(fe)}_get(fe){return this.__accessor__.internalGet(fe)}_set(fe,ve){return this.__accessor__.internalSet(fe,ve),this}};Li=Ni,Di=Fi;const i$4F=fe=>{let ve=class extends fe{clone(){var fe;const ve=t$4p(this);n$4O(ve,"unable to clone instance of non-accessor class");const _e=ve.metadata,be=ve.store,we={},Se=new Map;for(const Ee in _e){const fe=_e[Ee],ve=null==be?void 0:be.originOf(Ee),Te=fe.clonable;if(fe.readOnly||!1===Te||ve!==gr.USER&&ve!==gr.DEFAULTS&&ve!==gr.WEB_MAP&&ve!==gr.WEB_SCENE)continue;const Ce=this[Ee];let Oe=null;Oe="function"==typeof Te?Te(Ce):"reference"===Te?Ce:p$57(Ce),null!=Ce&&null==Oe||(ve===gr.DEFAULTS?Se.set(Ee,Oe):we[Ee]=Oe)}const Te=new(Object.getPrototypeOf(this).constructor)(we);if(Se.size){const ve=null==(fe=t$4p(Te))?void 0:fe.store;if(ve)for(const[fe,_e]of Se)ve.set(fe,_e,gr.DEFAULTS)}return Te}};return ve=e$4o([a$4y("esri.core.Clonable")],ve),ve};let ki=class l2 extends(i$4F(zi)){};ki=e$4o([a$4y("esri.core.Clonable")],ki);let Ui=class t4 extends ki{constructor(fe){super(fe),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(fe){return null!=fe&&this.row===fe.row&&this.rows===fe.rows&&this.column===fe.column&&this.columns===fe.columns}};e$4o([y$2v({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Ui.prototype,"row",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Ui.prototype,"column",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Ui.prototype,"rows",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Ui.prototype,"columns",void 0),Ui=e$4o([a$4y("esri.CameraLayout")],Ui);const Vi=Ui;function n$4A(){return[0,0,0]}function t$47(fe){return[fe[0],fe[1],fe[2]]}function r$3y(fe,ve,_e){return[fe,ve,_e]}function e$3$(fe,ve=[0,0,0]){const _e=Math.min(3,fe.length);for(let be=0;be<_e;++be)ve[be]=fe[be];return ve}function o$46(){return[0,0,0]}function c$4R(){return r$3y(1,1,1)}function i$4E(){return r$3y(1,0,0)}function f$3k(){return r$3y(0,1,0)}function a$4x(){return r$3y(0,0,1)}const Bi=[0,0,0],ji=c$4R(),Gi=i$4E(),Hi=f$3k(),qi=a$4x();Object.freeze(Object.defineProperty({__proto__:null,ONES:ji,UNIT_X:Gi,UNIT_Y:Hi,UNIT_Z:qi,ZEROS:Bi,clone:t$47,create:n$4A,createView:function u$3_(fe,ve){return new Float64Array(fe,ve,3)},fromArray:e$3$,fromValues:r$3y,ones:c$4R,unitX:i$4E,unitY:f$3k,unitZ:a$4x,zeros:o$46},Symbol.toStringTag,{value:"Module"}));let Wi=1e-6;function e$3_(){return Wi}const Yi=Math.random,Zi=Math.PI/180,Xi=180/Math.PI;function u$3Z(fe){return fe*Zi}function c$4Q(fe){return fe*Xi}function s$4g(fe){const ve=fe[0],_e=fe[1],be=fe[2];return Math.sqrt(ve*ve+_e*_e+be*be)}function r$3w(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe}function o$44(fe,ve,_e,be){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe}function u$3Y(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe}function e$3Z(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe}function c$4P(fe,ve,_e){return fe[0]=ve[0]*_e[0],fe[1]=ve[1]*_e[1],fe[2]=ve[2]*_e[2],fe}function i$4C(fe,ve,_e){return fe[0]=ve[0]/_e[0],fe[1]=ve[1]/_e[1],fe[2]=ve[2]/_e[2],fe}function M$1y(fe,ve){return fe[0]=Math.floor(ve[0]),fe[1]=Math.floor(ve[1]),fe[2]=Math.floor(ve[2]),fe}function f$3j(fe,ve){return fe[0]=Math.abs(ve[0]),fe[1]=Math.abs(ve[1]),fe[2]=Math.abs(ve[2]),fe}function l$4o(fe,ve){return fe[0]=Math.sign(ve[0]),fe[1]=Math.sign(ve[1]),fe[2]=Math.sign(ve[2]),fe}function m$3K(fe,ve,_e){return fe[0]=Math.min(ve[0],_e[0]),fe[1]=Math.min(ve[1],_e[1]),fe[2]=Math.min(ve[2],_e[2]),fe}function b$2c(fe,ve,_e){return fe[0]=Math.max(ve[0],_e[0]),fe[1]=Math.max(ve[1],_e[1]),fe[2]=Math.max(ve[2],_e[2]),fe}function g$2z(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe}function q$11(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe}function x$1W(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1],we=ve[2]-fe[2];return Math.sqrt(_e*_e+be*be+we*we)}function p$4Z(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1],we=ve[2]-fe[2];return _e*_e+be*be+we*we}function v$22(fe){const ve=fe[0],_e=fe[1],be=fe[2];return ve*ve+_e*_e+be*be}function j$1O(fe,ve){return fe[0]=-ve[0],fe[1]=-ve[1],fe[2]=-ve[2],fe}function y$2p(fe,ve){return fe[0]=1/ve[0],fe[1]=1/ve[1],fe[2]=1/ve[2],fe}function z$1d(fe,ve){const _e=ve[0],be=ve[1],we=ve[2];let Se=_e*_e+be*be+we*we;return Se>0&&(Se=1/Math.sqrt(Se),fe[0]=ve[0]*Se,fe[1]=ve[1]*Se,fe[2]=ve[2]*Se),fe}function P$1g(fe,ve){return fe[0]*ve[0]+fe[1]*ve[1]+fe[2]*ve[2]}function _$1z(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=_e[0],Ee=_e[1],Ce=_e[2];return fe[0]=we*Ce-Se*Ee,fe[1]=Se*Te-be*Ce,fe[2]=be*Ee-we*Te,fe}function A$1G(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2];return fe[0]=we+be*(_e[0]-we),fe[1]=Se+be*(_e[1]-Se),fe[2]=Te+be*(_e[2]-Te),fe}function O$1v(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2];return fe[0]=_e[0]*be+_e[4]*we+_e[8]*Se+_e[12],fe[1]=_e[1]*be+_e[5]*we+_e[9]*Se+_e[13],fe[2]=_e[2]*be+_e[6]*we+_e[10]*Se+_e[14],fe}function S$1P(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2];return fe[0]=be*_e[0]+we*_e[3]+Se*_e[6],fe[1]=be*_e[1]+we*_e[4]+Se*_e[7],fe[2]=be*_e[2]+we*_e[5]+Se*_e[8],fe}function E$1O(fe,ve,_e){const be=_e[0],we=_e[1],Se=_e[2],Te=_e[3],Ee=ve[0],Ce=ve[1],Oe=ve[2],Re=we*Oe-Se*Ce,De=Se*Ee-be*Oe,Be=be*Ce-we*Ee,Ze=we*Be-Se*De,Xe=Se*Re-be*Be,Je=be*De-we*Re,Qe=2*Te;return fe[0]=Ee+Re*Qe+2*Ze,fe[1]=Ce+De*Qe+2*Xe,fe[2]=Oe+Be*Qe+2*Je,fe}function k$1y(fe,ve,_e,be){const we=[],Se=[];return we[0]=ve[0]-_e[0],we[1]=ve[1]-_e[1],we[2]=ve[2]-_e[2],Se[0]=we[0]*Math.cos(be)-we[1]*Math.sin(be),Se[1]=we[0]*Math.sin(be)+we[1]*Math.cos(be),Se[2]=we[2],fe[0]=Se[0]+_e[0],fe[1]=Se[1]+_e[1],fe[2]=Se[2]+_e[2],fe}function w$1_(fe,ve){z$1d(Ji,fe),z$1d(Qi,ve);const _e=P$1g(Ji,Qi);return _e>1?0:_e<-1?Math.PI:Math.acos(_e)}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:Yi,equals:function i$4D(fe,ve){return Math.abs(fe-ve)<=Wi*Math.max(1,Math.abs(fe),Math.abs(ve))},getEpsilon:e$3_,setEpsilon:function n$4z(fe){Wi=fe},toDegree:c$4Q,toRadian:u$3Z},Symbol.toStringTag,{value:"Module"}));const Ji=[0,0,0],Qi=[0,0,0];function G$$(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]}function H$19(fe,ve){if(fe===ve)return!0;const _e=fe[0],be=fe[1],we=fe[2],Se=ve[0],Te=ve[1],Ee=ve[2],Ce=e$3_();return Math.abs(_e-Se)<=Ce*Math.max(1,Math.abs(_e),Math.abs(Se))&&Math.abs(be-Te)<=Ce*Math.max(1,Math.abs(be),Math.abs(Te))&&Math.abs(we-Ee)<=Ce*Math.max(1,Math.abs(we),Math.abs(Ee))}function J$M(fe,ve,_e){const be=_e[0]-ve[0],we=_e[1]-ve[1],Se=_e[2]-ve[2];let Te=be*be+we*we+Se*Se;return Te>0?(Te=1/Math.sqrt(Te),fe[0]=be*Te,fe[1]=we*Te,fe[2]=Se*Te,fe):(fe[0]=0,fe[1]=0,fe[2]=0,fe)}const Ki=e$3Z,en=c$4P,tn=i$4C,nn=x$1W,hn=p$4Z,dn=s$4g,pn=v$22,fn=Object.freeze(Object.defineProperty({__proto__:null,abs:f$3j,add:u$3Y,angle:w$1_,bezier:function I$1G(fe,ve,_e,be,we,Se){const Te=1-Se,Ee=Te*Te,Ce=Se*Se,Oe=Ee*Te,Re=3*Se*Ee,De=3*Ce*Te,Be=Ce*Se;return fe[0]=ve[0]*Oe+_e[0]*Re+be[0]*De+we[0]*Be,fe[1]=ve[1]*Oe+_e[1]*Re+be[1]*De+we[1]*Be,fe[2]=ve[2]*Oe+_e[2]*Re+be[2]*De+we[2]*Be,fe},ceil:function h$2V(fe,ve){return fe[0]=Math.ceil(ve[0]),fe[1]=Math.ceil(ve[1]),fe[2]=Math.ceil(ve[2]),fe},copy:r$3w,cross:_$1z,direction:J$M,dist:nn,distance:x$1W,div:tn,divide:i$4C,dot:P$1g,equals:H$19,exactEquals:G$$,floor:M$1y,hermite:function D$1e(fe,ve,_e,be,we,Se){const Te=Se*Se,Ee=Te*(2*Se-3)+1,Ce=Te*(Se-2)+Se,Oe=Te*(Se-1),Re=Te*(3-2*Se);return fe[0]=ve[0]*Ee+_e[0]*Ce+be[0]*Oe+we[0]*Re,fe[1]=ve[1]*Ee+_e[1]*Ce+be[1]*Oe+we[1]*Re,fe[2]=ve[2]*Ee+_e[2]*Ce+be[2]*Oe+we[2]*Re,fe},inverse:y$2p,len:dn,length:s$4g,lerp:A$1G,max:b$2c,min:m$3K,mul:en,multiply:c$4P,negate:j$1O,normalize:z$1d,random:function L$1f(fe,ve){ve=ve||1;const _e=Yi,be=2*_e()*Math.PI,we=2*_e()-1,Se=Math.sqrt(1-we*we)*ve;return fe[0]=Math.cos(be)*Se,fe[1]=Math.sin(be)*Se,fe[2]=we*ve,fe},rotateX:function Q$K(fe,ve,_e,be){const we=[],Se=[];return we[0]=ve[0]-_e[0],we[1]=ve[1]-_e[1],we[2]=ve[2]-_e[2],Se[0]=we[0],Se[1]=we[1]*Math.cos(be)-we[2]*Math.sin(be),Se[2]=we[1]*Math.sin(be)+we[2]*Math.cos(be),fe[0]=Se[0]+_e[0],fe[1]=Se[1]+_e[1],fe[2]=Se[2]+_e[2],fe},rotateY:function T$1o(fe,ve,_e,be){const we=[],Se=[];return we[0]=ve[0]-_e[0],we[1]=ve[1]-_e[1],we[2]=ve[2]-_e[2],Se[0]=we[2]*Math.sin(be)+we[0]*Math.cos(be),Se[1]=we[1],Se[2]=we[2]*Math.cos(be)-we[0]*Math.sin(be),fe[0]=Se[0]+_e[0],fe[1]=Se[1]+_e[1],fe[2]=Se[2]+_e[2],fe},rotateZ:k$1y,round:function d$3u(fe,ve){return fe[0]=Math.round(ve[0]),fe[1]=Math.round(ve[1]),fe[2]=Math.round(ve[2]),fe},scale:g$2z,scaleAndAdd:q$11,set:o$44,sign:l$4o,sqrDist:hn,sqrLen:pn,squaredDistance:p$4Z,squaredLength:v$22,str:function F$1c(fe){return"vec3("+fe[0]+", "+fe[1]+", "+fe[2]+")"},sub:Ki,subtract:e$3Z,transformMat3:S$1P,transformMat4:O$1v,transformQuat:E$1O},Symbol.toStringTag,{value:"Module"})),mn=new Float32Array(1);function u$3X(fe){--fe;for(let ve=1;ve<32;ve<<=1)fe|=fe>>ve;return fe+1}function e$3Y(fe,ve,_e){return Math.min(Math.max(fe,ve),_e)}function a$4v(fe){return!(fe&fe-1)}function o$43(fe){return fe--,fe|=fe>>1,fe|=fe>>2,fe|=fe>>4,fe|=fe>>8,fe|=fe>>16,++fe}function c$4O(fe){return 10**Math.ceil(Math.LOG10E*Math.log(fe))}function f$3i(fe,ve,_e){return fe+(ve-fe)*_e}function s$4f(fe,ve,_e,be,we){return f$3i(be,we,(fe-ve)/(_e-ve))}function h$2U(fe){return fe*Math.PI/180}function M$1x(fe){return 180*fe/Math.PI}function b$2b(fe,ve=1e-6){return(fe<0?-1:1)/Math.max(Math.abs(fe),ve)}function m$3J(fe){return Math.acos(e$3Y(fe,-1,1))}function l$4n(fe){return Math.asin(e$3Y(fe,-1,1))}function F$1b(fe,ve,_e=1e-6){return fe===ve||!(!Number.isFinite(fe)||!Number.isFinite(ve))&&(fe>ve?fe-ve:ve-fe)<=_e}const yn=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function g$2y(fe){return yn.setFloat64(0,fe),yn.getBigInt64(0)}const gn=BigInt("1000000"),vn=w$1Z(1);function w$1Z(fe){const ve=g$2y(fe=Math.abs(fe)),_e=function E$1N(fe){return yn.setBigInt64(0,fe),yn.getFloat64(0)}(ve<=gn?gn:ve-gn);return Math.abs(fe-_e)}function x$1V(fe,ve,_e=vn){if(fe===ve)return!0;if(!Number.isFinite(fe)||!Number.isFinite(ve))return!1;if(null!=_e&&w$1Z(Math.min(Math.abs(fe),Math.abs(ve)))<_e)return Math.abs(fe-ve)<=_e;const be=g$2y(fe),we=g$2y(ve);return be<0==we<0&&!((be<we?we-be:be-we)>gn)}function A$1F(fe){return P$1f(Math.max(-_n,Math.min(fe,_n)))}function P$1f(fe){return mn[0]=fe,mn[0]}function p$4Y(fe,ve,_e){const be=e$3Y((_e-fe)/(ve-fe),0,1);return be*be*(3-2*be)}function L$1e(fe,ve){const _e=s$4g(fe);return o$44(ve,_e,l$4n(fe[2]/_e),Math.atan2(fe[1]/_e,fe[0]/_e)),ve}function _$1y(fe){const ve=fe[0]*fe[0]+fe[1]*fe[1]+fe[2]*fe[2],_e=fe[3]*fe[3]+fe[4]*fe[4]+fe[5]*fe[5],be=fe[6]*fe[6]+fe[7]*fe[7]+fe[8]*fe[8];return!(F$1b(ve,1)&&F$1b(_e,1)&&F$1b(be,1))}const _n=P$1f(34028234663852886e22);let $n=class n2{constructor(fe,ve){this.min=fe,this.max=ve,this.range=ve-fe}normalize(fe,ve=0,_e=!1){return i$4B(this.range,this.min,this.max,fe,ve,_e)}clamp(fe,ve=0){return e$3Y(fe-ve,this.min,this.max)+ve}monotonic(fe,ve,_e){return fe<ve?ve:ve+o$42(this.range,fe-ve,_e)}minimalMonotonic(fe,ve,_e){return i$4B(this.range,fe,fe+this.range,ve,_e)}center(fe,ve,_e){return ve=this.monotonic(fe,ve,_e),this.normalize((fe+ve)/2,_e)}diff(fe,ve,_e){return this.monotonic(fe,ve,_e)-fe}shortestSignedDiff(fe,ve){fe=this.normalize(fe);const _e=(ve=this.normalize(ve))-fe,be=ve<fe?this.minimalMonotonic(fe,ve)-fe:ve-this.minimalMonotonic(ve,fe);return Math.abs(_e)<Math.abs(be)?_e:be}contains(fe,ve,_e){return ve=this.minimalMonotonic(fe,ve),(_e=this.minimalMonotonic(fe,_e))>fe&&_e<ve}};function i$4B(fe,ve,_e,be,we=0,Se=!1){return(be-=we)<ve?be+=o$42(fe,ve-be):be>_e&&(be-=o$42(fe,be-_e)),Se&&be===_e&&(be=ve),be+we}function o$42(fe,ve,_e=0){return Math.ceil((ve-_e)/fe)*fe+_e}const bn=new $n(0,2*Math.PI),wn=new $n(-Math.PI,Math.PI),xn=new $n(0,360);let Sn=class s7{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(fe){const ve=new s7;return this._values.forEach(((_e,be)=>{fe&&fe.has(be)||ve.set(be,a$4H(_e.value),_e.origin)})),ve}get(fe,ve){ve=this._normalizeOrigin(ve);const _e=this._values.get(fe);return null==ve||(null==_e?void 0:_e.origin)===ve?null==_e?void 0:_e.value:void 0}originOf(fe){var ve;return(null==(ve=this._values.get(fe))?void 0:ve.origin)??gr.USER}keys(fe){fe=this._normalizeOrigin(fe);const ve=[...this._values.keys()];return null==fe?ve:ve.filter((ve=>{var _e;return(null==(_e=this._values.get(ve))?void 0:_e.origin)===fe}))}set(fe,ve,_e){if((_e=this._normalizeOrigin(_e))===gr.DEFAULTS){const ve=this._values.get(fe);if(null!=(null==ve?void 0:ve.origin)&&ve.origin>_e)return}this._values.set(fe,new Tn(ve,_e))}delete(fe,ve){var _e;null!=(ve=this._normalizeOrigin(ve))&&(null==(_e=this._values.get(fe))?void 0:_e.origin)!==ve||this._values.delete(fe)}has(fe,ve){var _e;return null!=(ve=this._normalizeOrigin(ve))?(null==(_e=this._values.get(fe))?void 0:_e.origin)===ve:this._values.has(fe)}forEach(fe){this._values.forEach((({value:ve},_e)=>fe(ve,_e)))}_normalizeOrigin(fe){if(null!=fe)return fe===gr.DEFAULTS?fe:gr.USER}},Tn=class t5{constructor(fe,ve){this.value=fe,this.origin=ve}};function e$3X(fe,ve,_e){ve.keys().forEach((fe=>{_e.set(fe,ve.get(fe),gr.DEFAULTS)}));const be=fe.metadata;Object.keys(be).forEach((ve=>{fe.internalGet(ve)&&_e.set(ve,fe.internalGet(ve),gr.DEFAULTS)}))}function s$4c(fe,ve,_e){if(!(null==fe?void 0:fe.read)||!1===fe.read.enabled||!fe.read.source)return!1;const be=fe.read.source;if("string"==typeof be){if(be===ve)return!0;if(be.includes(".")&&0===be.indexOf(ve)&&s$4w(be,_e))return!0}else for(const we of be){if(we===ve)return!0;if(we.includes(".")&&0===we.indexOf(ve)&&s$4w(we,_e))return!0}return!1}function f$3h(fe,ve,_e,be,we){let Se=s$4i(ve[_e],we);(function i$4A(fe){return fe&&(!fe.read||!1!==fe.read.enabled&&!fe.read.source)})(Se)&&(fe[_e]=!0);for(const Te of Object.getOwnPropertyNames(ve))Se=s$4i(ve[Te],we),s$4c(Se,_e,be)&&(fe[Te]=!0)}function a$4t(fe,ve,_e,be){const we=function o$47(fe,ve){return y$2s(fe,"any",null==ve?void 0:ve.origin)}(_e.metadata[ve],be),Se=null==we?void 0:we.default;if(void 0===Se)return;const Te="function"==typeof Se?Se.call(fe,ve,be):Se;void 0!==Te&&_e.set(ve,Te)}const En={origin:"service"};function u$3W(fe,ve,_e=En){if(!ve||"object"!=typeof ve)return;const be=t$4p(fe),we=be.metadata,Se={};for(const Te of Object.getOwnPropertyNames(ve))f$3h(Se,we,Te,ve,_e);be.setDefaultOrigin(_e.origin);for(const Te of Object.getOwnPropertyNames(Se)){const Se=s$4i(we[Te],_e).read,Ee=null==Se?void 0:Se.source;let Ce;Ce=Ee&&"string"==typeof Ee?u$4b(ve,Ee):ve[Te],(null==Se?void 0:Se.reader)&&(Ce=Se.reader.call(fe,Ce,ve,_e)),void 0!==Ce&&be.set(Te,Ce)}if(!_e||!_e.ignoreDefaults){be.setDefaultOrigin("defaults");for(const ve of Object.getOwnPropertyNames(we))Se[ve]||a$4t(fe,ve,be,_e)}be.setDefaultOrigin("user")}function p$4X(fe,ve,_e,be,we){var Se,Te;const Ee={};return null==(Te=null==(Se=ve.write)?void 0:Se.writer)||Te.call(fe,be,Ee,_e,we),Ee}function f$3g(fe,ve,_e,be,we,Se){if(!(null==be?void 0:be.write))return!1;const Te=o$4m(fe,_e);if(!we&&be.write.overridePolicy){const ve=be.write.overridePolicy.call(fe,Te,_e,Se??void 0);void 0!==ve&&(we=ve)}if(we||(we=be.write),!we||!1===we.enabled)return!1;if(we.layerContainerTypes&&(null==Se?void 0:Se.layerContainerType)&&!we.layerContainerTypes.includes(Se.layerContainerType))return!1;if((null===Te&&!we.allowNull&&!we.writerEnsuresNonNull||void 0===Te)&&we.isRequired){const ve=new Ir("web-document-write:property-required",`Missing value for required property '${_e}' on '${fe.declaredClass}'`,{propertyName:_e,target:fe});return ve&&(null==Se?void 0:Se.messages)?Se.messages.push(ve):ve&&!Se&&ar.getLogger("esri.core.accessorSupport.write").error(ve.name,ve.message),!1}return void 0!==Te&&(!(null===Te&&!we.allowNull&&!we.writerEnsuresNonNull)&&(!(!(we.alwaysWriteDefaults||ve.store.multipleOriginsSupported&&ve.store.originOf(_e)!==gr.DEFAULTS)&&function c$4M(fe,ve,_e,be,we){const Se=be.default;if(void 0===Se)return!1;if(null!=be.defaultEquals)return be.defaultEquals(we);if("function"==typeof Se){if(Array.isArray(we)){return h$30(Se.call(fe,ve,_e??void 0),we)}return!1}return Se===we}(fe,_e,Se,be,Te))&&!(!we.ignoreOrigin&&(null==Se?void 0:Se.origin)&&ve.store.multipleOriginsSupported&&ve.store.originOf(_e)<n$4L(Se.origin))))}function g$2x(fe,ve,_e,be){const we=t$4p(fe),Se=a$4z(we.metadata[ve],be);return!!Se&&f$3g(fe,we,ve,Se,_e,be)}function d$3s(fe,ve,_e){var be,we;if(fe&&"function"==typeof fe.toJSON&&(!fe.toJSON.isDefaultToJSON||!fe.write))return u$4c(ve,fe.toJSON(_e));const Se=t$4p(fe),Te=Se.metadata;for(const Ee in Te){const Ce=a$4z(Te[Ee],_e);if(!f$3g(fe,Se,Ee,Ce,void 0,_e))continue;const Oe=o$4m(fe,Ee),Re=p$4X(fe,Ce,Ce.write&&"string"==typeof Ce.write.target?Ce.write.target:Ee,Oe,_e);Object.keys(Re).length>0&&(ve=u$4c(ve,Re),(null==(we=null==(be=null==_e?void 0:_e.resources)?void 0:be.pendingOperations)?void 0:we.length)&&_e.resources.pendingOperations.push(Promise.all(_e.resources.pendingOperations).then((()=>u$4c(ve,Re,(()=>"replace-arrays"))))),(null==_e?void 0:_e.writtenProperties)&&_e.writtenProperties.push({target:fe,propName:Ee,oldOrigin:u$4a(Se.store.originOf(Ee)),newOrigin:_e.origin}))}return ve}const u$3V=fe=>{let ve=class extends fe{constructor(...fe){super(...fe);const ve=t$4p(this),_e=ve.store,be=new Sn;ve.store=be,e$3X(ve,_e,be)}read(fe,ve){u$3W(this,fe,ve)}write(fe,ve){return d$3s(this,fe??{},ve)}toJSON(fe){return this.write({},fe)}static fromJSON(fe,ve){return n$4x.call(this,fe,ve)}};return ve=e$4o([a$4y("esri.core.JSONSupport")],ve),ve.prototype.toJSON.isDefaultToJSON=!0,ve};function n$4x(fe,ve){if(!fe)return null;if(fe.declaredClass)throw new Error("JSON object is already hydrated");const _e=new this;return _e.read(fe,ve),_e}function a$4s(fe){return fe&&"object"==typeof fe&&"toJSON"in fe&&"function"==typeof fe.toJSON}let Pn=class f extends(u$3V(zi)){};Pn=e$4o([a$4y("esri.core.JSONSupport")],Pn);const On=Object.prototype.toString;function o$41(fe){const ve="__accessorMetadata__"in fe?b$2d(fe):fe;return function(...fe){if(fe.push(ve),"number"==typeof fe[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return e$3W.apply(this,fe)}}function e$3W(fe,ve,_e,be){o$4l(fe,ve).cast=be}function s$4b(...fe){if(3!==fe.length||"string"!=typeof fe[1])return 1===fe.length&&"[object Function]"===On.call(fe[0])?o$41(fe[0]):1===fe.length&&"string"==typeof fe[0]?function i$4z(fe){return(ve,_e)=>{o$4l(ve,fe).cast=ve[_e]}}(fe[0]):void 0}function o$40(fe,ve,_e){let be,we;return void 0===ve||Array.isArray(ve)?(we=fe,_e=ve,be=[void 0]):(we=ve,be=Array.isArray(fe)?fe:[fe]),(fe,ve)=>{const Se=fe.constructor.prototype;be.forEach((be=>{const Te=d$3w(fe,be,we);Te.read&&"object"==typeof Te.read||(Te.read={}),Te.read.reader=Se[ve],_e&&(Te.read.source=(Te.read.source||[]).concat(_e))}))}}function r$3s(fe,ve,_e){let be,we;return void 0===ve?(we=fe,be=[void 0]):"string"!=typeof ve?(we=fe,be=[void 0],_e=ve):(we=ve,be=Array.isArray(fe)?fe:[fe]),(fe,ve)=>{const Se=fe.constructor.prototype;for(const Te of be){const be=d$3w(fe,Te,we);be.write&&"object"==typeof be.write||(be.write={}),_e&&(be.write.target=_e),be.write.writer=Se[ve]}}}let An=class n3{constructor(fe,ve={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=fe,this._options=ve,this.apiValues=[],this.jsonValues=[],this._apiToJSON=function t$44(fe){const ve={};for(const _e in fe)ve[fe[_e]]=_e;return ve}(fe),this.apiValues=s$4a(this._apiToJSON),this.jsonValues=s$4a(this._jsonToAPI),this.read=fe=>this.fromJSON(fe),this.write=(fe,ve,_e)=>{const be=this.toJSON(fe);void 0!==be&&e$4h(_e,be,ve)},this.write.isJSONMapWriter=!0}toJSON(fe){if(null==fe)return null;if(this._apiToJSON.hasOwnProperty(fe)){const ve=this._apiToJSON[fe];return this._options.useNumericKeys?+ve:ve}return this._options.ignoreUnknown?void 0:fe}fromJSON(fe){return null!=fe&&this._jsonToAPI.hasOwnProperty(fe)?this._jsonToAPI[fe]:this._options.ignoreUnknown?void 0:fe}};function s$4a(fe){const ve=[];for(const _e in fe)ve.push(_e);return ve.sort(),ve}function i$4y(){return function(fe,ve){return new An(fe,{ignoreUnknown:!0,...ve})}}let Mn=class i2{constructor(fe,ve,_e,be){this.semiMajorAxis=fe,this.flattening=ve,this.outerAtmosphereRimWidth=_e;const we=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*we,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=be||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Rn=new Mn(6378137,1/298.257223563,3e5,.006694379990137799),In=new Mn(3396190,1/169.8944472236118,23e4),Ln=new Mn(1737400,0,0),Dn=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Nn={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function a$4r(fe){const ve=null==fe?void 0:fe.match(Dn);if(!ve)return null;const[,_e,be,we]=ve;if(!_e)return null;let Se=null,Te=null,Ee=null;const{devext:Ce,qaext:Oe,www:Re}=Nn;if(be)if(Se=_e,we)switch(we.toLowerCase()){case"devext":({customBaseUrl:Te,portalHostname:Ee}=Ce);break;case"qa":({customBaseUrl:Te,portalHostname:Ee}=Oe);break;default:return null}else({customBaseUrl:Te,portalHostname:Ee}=Re);else switch(_e.toLowerCase()){case"devext":({customBaseUrl:Te,portalHostname:Ee}=Ce);break;case"qaext":({customBaseUrl:Te,portalHostname:Ee}=Oe);break;case"www":({customBaseUrl:Te,portalHostname:Ee}=Re);break;default:return null}return{customBaseUrl:Te,isPortal:!1,portalHostname:Ee,urlKey:Se}}function t$42(fe){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(fe)}function t$41(fe){const ve=atob(fe),_e=new Uint8Array(ve.length);for(let be=0;be<ve.length;be++)_e[be]=ve.charCodeAt(be);return _e.buffer}const l$4m=()=>ar.getLogger("esri.core.urlUtils"),Fn=ir.request,zn="esri/config: esriConfig.request.proxyUrl is not set.",kn=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Un=/^\s*http:/i,Vn=/^\s*https:/i,Bn=/^\s*file:/i,jn=/:\d+$/,Gn=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Hn=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),qn=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let Wn=class x{constructor(fe=""){this.uri=fe,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let ve=this.uri.match(Hn);this.scheme=ve[2]||(ve[1]?"":null),this.authority=ve[4]||(ve[3]?"":null),this.path=ve[5],this.query=ve[7]||(ve[6]?"":null),this.fragment=ve[9]||(ve[8]?"":null),null!=this.authority&&(ve=this.authority.match(qn),this.user=ve[3]||null,this.password=ve[4]||null,this.host=ve[6]||ve[7],this.port=ve[9]||null)}toString(){return this.uri}};const Yn={};let Zn=new Wn(ir.applicationUrl);const Xn=function j$1M(){const fe=Zn.path,ve=fe.substring(0,fe.lastIndexOf(fe.split("/")[fe.split("/").length-1]));return`${Zn.scheme}://${Zn.host}${null!=Zn.port?`:${Zn.port}`:""}${ve}`}();let Jn=Xn;const C$1q=()=>Zn,q$10=()=>Jn;function I$1E(fe){if(!fe)return null;const ve={path:null,query:null},_e=new Wn(fe),be=fe.indexOf("?");return null===_e.query?ve.path=fe:(ve.path=fe.substring(0,be),ve.query=A$1E(_e.query)),_e.fragment&&(ve.hash=_e.fragment,null===_e.query&&(ve.path=ve.path.substring(0,ve.path.length-(_e.fragment.length+1)))),ve}function A$1E(fe){const ve=fe.split("&"),_e={};for(const be of ve){if(!be)continue;const fe=be.indexOf("=");let ve,we;fe<0?(ve=decodeURIComponent(be),we=""):(ve=decodeURIComponent(be.slice(0,fe)),we=decodeURIComponent(be.slice(fe+1)));let Se=_e[ve];"string"==typeof Se&&(Se=_e[ve]=[Se]),Array.isArray(Se)?Se.push(we):_e[ve]=we}return _e}function v$21(fe,ve){return fe?Object.keys(fe).map((_e=>{const be=fe[_e];if(null==be)return"";const we=encodeURIComponent(_e)+"=",Se=null==ve?void 0:ve[_e];return Se?we+encodeURIComponent(Se(be)):Array.isArray(be)?be.map((fe=>a$4s(fe)?we+encodeURIComponent(JSON.stringify(fe)):we+encodeURIComponent(fe))).join("&"):a$4s(be)?we+encodeURIComponent(JSON.stringify(be)):we+encodeURIComponent(be)})).filter((fe=>fe)).join("&"):""}function S$1O(fe){const ve=T$1n(fe);let _e,be;if(ve){const fe=E$1M(ve.proxyUrl);_e=fe.path,be=fe.query?A$1E(fe.query):null}if(_e){const ve=I$1E(fe);fe=_e+"?"+ve.path;const we=v$21({...be,...ve.query});we&&(fe=`${fe}?${we}`)}return fe}const Qn={path:"",query:""};function E$1M(fe){const ve=fe.indexOf("?");return-1!==ve?(Qn.path=fe.slice(0,ve),Qn.query=fe.slice(ve+1)):(Qn.path=fe,Qn.query=null),Qn}function B$16(fe){return(fe=Ot$5(fe=Ct$5(fe=E$1M(fe).path),!0)).toLowerCase()}function T$1n(fe){const ve=Fn.proxyRules,_e=B$16(fe);for(let be=0;be<ve.length;be++)if(0===_e.indexOf(ve[be].urlPrefix))return ve[be]}function N$1a(fe,ve){return fe=z$1c(fe),ve=z$1c(ve),Ot$5(fe)===Ot$5(ve)}function z$1c(fe){const ve=(fe=K$I(fe)).indexOf("/sharing");return ve>0?fe.substring(0,ve):fe.replace(/\/+$/,"")}function D$1d(fe,ve=Fn.interceptors){const e76=ve=>null==ve||ve instanceof RegExp&&ve.test(fe)||"string"==typeof ve&&fe.startsWith(ve);if(ve)for(const _e of ve)if(Array.isArray(_e.urls)){if(_e.urls.some(e76))return _e}else if(e76(_e.urls))return _e;return null}function F$1a(fe,ve,_e=!1){if(!fe||!ve)return!1;const be=vt$3(fe),we=vt$3(ve);return!(!_e&&be.scheme!==we.scheme)&&null!=be.host&&null!=we.host&&be.host.toLowerCase()===we.host.toLowerCase()&&be.port===we.port}function M$1w(fe){if("string"==typeof fe){if(!Y$F(fe))return!0;fe=vt$3(fe)}if(F$1a(fe,Zn))return!0;const ve=Fn.trustedServers||[];for(let _e=0;_e<ve.length;_e++){const be=Q$J(ve[_e]);for(let ve=0;ve<be.length;ve++)if(F$1a(fe,be[ve]))return!0}return!1}function Q$J(fe){return Yn[fe]||(ht$d(fe)||pt$9(fe)?Yn[fe]=[new Wn(_$1x(fe))]:Yn[fe]=[new Wn(`http://${fe}`),new Wn(`https://${fe}`)]),Yn[fe]}function _$1x(fe,ve=Jn,_e){return pt$9(fe)?(null==_e?void 0:_e.preserveProtocolRelative)?fe:"http"===Zn.scheme&&Zn.authority===X$B(fe).slice(2)?`http:${fe}`:`https:${fe}`:ht$d(fe)?fe:V$19("/"===fe[0]?function Ut$2(fe){const ve=fe.indexOf("//"),_e=fe.indexOf("/",ve+2);return-1===_e?fe:fe.slice(0,_e)}(ve):ve,fe)}function G$_(fe,ve=Jn,_e){if(null==fe||!Y$F(fe))return fe;const be=K$I(fe),we=be.toLowerCase(),Se=K$I(ve).toLowerCase().replace(/\/+$/,""),Te=_e?K$I(_e).toLowerCase().replace(/\/+$/,""):null;if(Te&&0!==Se.indexOf(Te))return fe;const u30=(fe,ve,_e)=>-1===(_e=fe.indexOf(ve,_e))?fe.length:_e;let Ee=u30(we,"/",we.indexOf("//")+2),Ce=-1;for(;we.slice(0,Ee+1)===Se.slice(0,Ee)+"/"&&(Ce=Ee+1,Ee!==we.length);)Ee=u30(we,"/",Ee+1);if(-1===Ce)return fe;if(Te&&Ce<Te.length)return fe;fe=be.slice(Ce);const Oe=Se.slice(Ce-1).replaceAll(/[^/]+/g,"").length;if(Oe>0)for(let Re=0;Re<Oe;Re++)fe=`../${fe}`;else fe=`./${fe}`;return fe}function K$I(fe){return function It$6(fe){const ve=Fn.httpsDomains;if(!function mt$a(fe){return null!=fe&&Un.test(fe)||"http"===Zn.scheme&&pt$9(fe)}(fe))return fe;const _e=fe.indexOf("/",7);let be;if(be=-1===_e?fe:fe.slice(0,_e),be=be.toLowerCase().slice(7),jn.test(be)){if(!be.endsWith(":80"))return fe;be=be.slice(0,-3),fe=fe.replace(":80","")}return function xt$5(){return"http"===Zn.scheme}()&&be===Zn.authority&&!Gn.test(fe)||(wt$7()&&be===Zn.authority||ve&&ve.some((fe=>be===fe||be.endsWith(`.${fe}`)))||wt$7()&&!T$1n(fe))&&(fe=$t$1(fe)),fe}(fe=function Lt$4(fe){return fe.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(fe=function jt$5(fe){if(/^https?:\/\//i.test(fe)){const ve=E$1M(fe);fe=(fe=ve.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),ve.query&&(fe+=`?${ve.query}`)}return fe}(fe=_$1x(fe=fe.trim()))))}function V$19(...fe){const ve=fe.filter(O$1y);if(!(null==ve?void 0:ve.length))return;const _e=[];if(Y$F(ve[0])){const fe=ve[0],be=fe.indexOf("//");-1!==be&&(_e.push(fe.slice(0,be+1)),function gt$b(fe){return null!=fe&&Bn.test(fe)}(ve[0])&&(_e[0]+="/"),ve[0]=fe.slice(be+2))}else"/"===ve[0][0]&&_e.push("");const be=ve.reduce(((fe,ve)=>ve?fe.concat(ve.split("/")):fe),[]);for(let we=0;we<be.length;we++){const fe=be[we];".."===fe&&_e.length>0&&".."!==_e[_e.length-1]?_e.pop():(!fe&&we===be.length-1||fe&&("."!==fe||0===_e.length))&&_e.push(fe)}return _e.join("/")}function X$B(fe,ve=!1){if(null==fe||Z$I(fe)||tt$k(fe))return null;let _e=fe.indexOf("://");if(-1===_e&&pt$9(fe))_e=2;else{if(-1===_e)return null;_e+=3}const be=fe.indexOf("/",_e);return-1!==be&&(fe=fe.slice(0,be)),ve&&(fe=Ot$5(fe,!0)),fe}function Y$F(fe){return pt$9(fe)||ht$d(fe)}function Z$I(fe){return null!=fe&&"blob:"===fe.slice(0,5)}function tt$k(fe){return null!=fe&&"data:"===fe.slice(0,5)}function nt$h(fe){const ve=ot$i(fe);return(null==ve?void 0:ve.isBase64)?t$41(ve.data):null}function et$g(fe){return function n$4v(fe){const ve=new Uint8Array(fe);let _e="";for(let be=0;be<ve.length;be++)_e+=String.fromCharCode(ve[be]);return btoa(_e)}(fe).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const Kn=/^data:(.*?)(;base64)?,(.*)$/;function ot$i(fe){const ve=fe.match(Kn);if(!ve)return null;const[,_e,be,we]=ve;return{mediaType:_e,isBase64:!!be,data:we}}function st$k(fe){return fe.isBase64?`data:${fe.mediaType};base64,${fe.data}`:`data:${fe.mediaType},${fe.data}`}async function it$h(fe){return(await fetch(fe)).blob()}function ut$d(fe){const ve=nt$h(fe);if(!ve)return null;const _e=ot$i(fe);return new Blob([ve],{type:_e.mediaType})}function pt$9(fe){return null!=fe&&"/"===fe[0]&&"/"===fe[1]}function ht$d(fe){return null!=fe&&kn.test(fe)}function dt$8(fe){return null!=fe&&Vn.test(fe)||"https"===Zn.scheme&&pt$9(fe)}function $t$1(fe){return pt$9(fe)?`https:${fe}`:fe.replace(Un,"https:")}function wt$7(){return"https"===Zn.scheme}function Ot$5(fe,ve=!1){return pt$9(fe)?fe.slice(2):(fe=fe.replace(kn,""),ve&&fe.length>1&&"/"===fe[0]&&"/"===fe[1]&&(fe=fe.slice(2)),fe)}function Rt$3(fe){let ve=0;if(Y$F(fe)){const _e=fe.indexOf("//");-1!==_e&&(ve=_e+2)}const _e=fe.lastIndexOf("/");return _e<ve?fe:fe.slice(0,_e+1)}function bt$5(fe,ve){if(!fe)return"";const _e=I$1E(fe).path.replace(/\/+$/,""),be=_e.substring(_e.lastIndexOf("/")+1);if(!(null==ve?void 0:ve.length))return be;const we=new RegExp(`\\.(${ve.join("|")})$`,"i");return be.replace(we,"")}function Ct$5(fe){return fe.endsWith("/")?fe:`${fe}/`}function qt$3(fe){return fe.replace(/\/+$/,"")}function At$5(fe,ve,_e){if(!(ve&&_e&&fe&&Y$F(fe)))return fe;const be=fe.indexOf("//"),we=fe.indexOf("/",be+2),Se=fe.indexOf(":",be+2),Te=Math.min(we<0?fe.length:we,Se<0?fe.length:Se);return fe.slice(be+2,Te).toLowerCase()!==ve.toLowerCase()?fe:`${fe.slice(0,be+2)}${_e}${fe.slice(Te)}`}function vt$3(fe){return"string"==typeof fe?new Wn(_$1x(fe)):(fe.scheme||(fe.scheme=Zn.scheme),fe)}function Pt$4(fe){return $s.test(fe)}function St$4(fe,ve){const _e=I$1E(fe),be=Object.keys(_e.query||{});return be.length>0&&ve&&ve.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${be.join(", ")}.`),_e.path}function Et$4(fe,ve){if(!ve)return fe;const _e=I$1E(fe),be=_e.query||{};for(const[Se,Te]of Object.entries(ve))null!=Te&&(be[Se]=Te);const we=v$21(be);return we?`${_e.path}?${we}`:_e.path}function Ht$2(fe){if(null==fe)return null;const ve=fe.match(_s);return ve?ve[2]:null}function Tt$7(fe){if(null==fe)return null;const ve=fe.match(_s);return ve?{path:ve[1],extension:ve[2]}:{path:fe,extension:null}}async function Wt$2(fe){return"string"==typeof fe?ot$i(fe)??{data:fe}:new Promise(((ve,_e)=>{const be=new FileReader;be.readAsDataURL(fe),be.onload=()=>ve(ot$i(be.result)),be.onerror=fe=>_e(fe)}))}const _s=/([^.]*)\.([^/]*)$/,$s=/(^data:image\/svg|\.svg$)/i,ws="20240621",xs="96d683427103aedd3960cf342647a8857de30ca3";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const Ss="4.30";let Ts,Es=Ss;function n$4u(fe){Ts=fe}function m$3H(fe){const ve=null==Ts?void 0:Ts.findCredential(fe);return(null==ve?void 0:ve.token)?function kt$2(fe,ve,_e){const be=I$1E(fe),we=be.query||{};return we[ve]=String(_e),`${be.path}?${v$21(we)}`}(fe,"token",ve.token):fe}Es="4.30.0",has("host-webworker");const Cs=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function c$4K(fe){const ve=X$B(fe,!0);return!!ve&&ve.endsWith(".arcgis.com")&&!Cs.has(ve)&&!fe.endsWith("/sharing/rest/generateToken")}function i$4v(fe,ve,_e=!1,be){return new Promise(((we,Se)=>{if(c$4_(be))return void Se(c$4J());let a55=()=>{l49(),Se(new Error(`Unable to load ${ve}`))},u30=()=>{const ve=fe;l49(),we(ve)},m39=()=>{if(!fe)return;const ve=fe;l49(),ve.src="",Se(c$4J())};const l49=()=>{has("esri-image-decode")||(fe.removeEventListener("error",a55),fe.removeEventListener("load",u30)),a55=null,u30=null,fe=null,null!=be&&be.removeEventListener("abort",m39),m39=null,_e&&URL.revokeObjectURL(ve)};null!=be&&be.addEventListener("abort",m39),has("esri-image-decode")?fe.decode().then(u30,a55):(fe.addEventListener("error",a55),fe.addEventListener("load",u30))}))}function c$4J(){try{return new DOMException("Aborted","AbortError")}catch{const fe=new Error;return fe.name="AbortError",fe}}const Os="Timeout exceeded";function m$3G(fe){return"object"==typeof fe&&!!fe&&"message"in fe&&fe.message===Os}async function U$1a(fe,ve){var _e;fe instanceof URL&&(fe=fe.toString()),(null==ve?void 0:ve.query)instanceof URLSearchParams&&(ve.query=A$1E(ve.query.toString().replaceAll("+"," ")));const be=tt$k(fe),we=Z$I(fe);we||be||(fe=K$I(fe));const Se={url:fe,requestOptions:{...ve}},n52=fe=>({data:fe,getAllHeaders:H$17,getHeader:H$17,httpStatus:200,requestOptions:Se.requestOptions,url:Se.url}),Te=D$1d(fe,Ms.internalInterceptors);if(Te){const fe=await G$Z(Te,Se);if(null!=fe)return n52(fe)}let Ee=D$1d(fe);if(Ee){const fe=await G$Z(Ee,Se);if(null!=fe)return n52(fe);Ee.after||Ee.error||(Ee=null)}if(fe=Se.url,"image"===(ve=Se.requestOptions).responseType&&(has("host-webworker")||has("host-node")))throw N$19("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),Se);if("head"===ve.method){if(ve.body)throw N$19("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),Se);if(be||we)throw N$19("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),Se)}if(await async function B$15(){has("host-webworker")&&!As&&(As=await zt((()=>import("./request-E7xuk0Uu.js")),[]))}(),As)return As.execute(fe,ve);const Ce=new AbortController,Oe=m$3R(ve,(()=>Ce.abort())),Re={controller:Ce,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:Ee,params:Se,redoRequest:!1,useIdentity:Ms.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},De=await async function Q$I(fe){var ve,_e;let be,we;await async function z$1b(fe){var ve;const _e=fe.params.url,be=fe.params.requestOptions,we=fe.controller.signal,Se=be.body;let Te=null,Ee=null;if(Rs&&"HTMLFormElement"in globalThis&&(Se instanceof FormData?Te=Se:Se instanceof HTMLFormElement&&(Te=new FormData(Se))),"string"==typeof Se&&(Ee=Se),fe.fetchOptions={cache:be.cacheBust?"no-cache":"default",credentials:"same-origin",headers:be.headers||{},method:"head"===be.method?"HEAD":"GET",mode:"cors",priority:Ms.priority,redirect:"follow",signal:we},(Te||Ee)&&(fe.fetchOptions.body=Te||Ee),"anonymous"===be.authMode&&(fe.useIdentity=!1),fe.hasToken=!!(/token=/i.test(_e)||(null==(ve=be.query)?void 0:ve.token)||(null==Te?void 0:Te.get("token"))),!fe.hasToken&&ir.apiKey&&c$4K(_e)&&(be.query||(be.query={}),be.query.token=ir.apiKey,fe.hasToken=!0),fe.useIdentity&&!fe.hasToken&&!fe.credentialToken&&!K$H(_e)&&!c$4_(we)){let ve;"immediate"===be.authMode?(await $$G(),ve=await Ts.getCredential(_e,{signal:we}),fe.credential=ve):"no-prompt"===be.authMode?(await $$G(),ve=await Ts.getCredential(_e,{prompt:!1,signal:we}).catch((()=>{})),fe.credential=ve):Ts&&(ve=Ts.findCredential(_e)),ve&&(fe.credentialToken=ve.token,fe.useSSL=!!ve.ssl)}}(fe);try{do{[be,we]=await W$N(fe)}while(!(await V$18(fe,be,we)))}catch(n52){const we=N$19("request:server",n52,fe.params,be);throw we.details.ssl=fe.useSSL,(null==(ve=fe.interceptor)?void 0:ve.error)&&fe.interceptor.error(we),we}const Se=fe.params.url;if(we&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(Se)){if(!fe.hasToken&&!fe.credentialToken&&(null==(_e=we.user)?void 0:_e.username)&&!M$1w(Se)){const fe=X$B(Se,!0);fe&&Ms.trustedServers.push(fe)}Array.isArray(we.authorizedCrossOriginNoCorsDomains)&&function l$4l(fe){ir.request.crossOriginNoCorsDomains||(ir.request.crossOriginNoCorsDomains={});const ve=ir.request.crossOriginNoCorsDomains;for(let _e of fe)_e=_e.toLowerCase(),/^https?:\/\//.test(_e)?ve[X$B(_e)??""]=0:(ve[X$B("http://"+_e)??""]=0,ve[X$B("https://"+_e)??""]=0)}(we.authorizedCrossOriginNoCorsDomains)}const Te=fe.credential;if(Te&&Ts){const fe=Ts.findServerInfo(Te.server);let ve=null==fe?void 0:fe.owningSystemUrl;if(ve){ve=ve.replace(/\/?$/,"/sharing");const fe=Ts.findCredential(ve,Te.userId);fe&&-1===Ts._getIdenticalSvcIdx(ve,fe)&&fe.resources.unshift(ve)}}return{data:we,getAllHeaders:be?()=>Array.from(be.headers):H$17,getHeader:be?fe=>be.headers.get(fe):H$17,httpStatus:(null==be?void 0:be.status)??200,requestOptions:fe.params.requestOptions,ssl:fe.useSSL,url:fe.params.url}}(Re).finally((()=>null==Oe?void 0:Oe.remove()));return null==(_e=null==Ee?void 0:Ee.after)||_e.call(Ee,De),De}let As;const Ms=ir.request,Rs="FormData"in globalThis,Ls=new Set([499,498,403,401]),Ds=new Set(["COM_0056","COM_0057","SB_0008"]),Ns=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],H$17=()=>null,Fs=Symbol();function M$1v(fe){const ve=X$B(fe);return!ve||ve.endsWith(".arcgis.com")||U$1a._corsServers.includes(ve)||M$1w(ve)}function N$19(fe,ve,_e,be){let we="Error";const Se={url:_e.url,requestOptions:_e.requestOptions,getAllHeaders:H$17,getHeader:H$17,ssl:!1};if(ve instanceof Ir)return ve.details?(ve.details=a$4H(ve.details),ve.details.url=_e.url,ve.details.requestOptions=_e.requestOptions):ve.details=Se,ve;if(ve){const fe=be&&(()=>Array.from(be.headers)),_e=be&&(fe=>be.headers.get(fe)),Te=null==be?void 0:be.status,Ee=ve.message;Ee&&(we=Ee),fe&&_e&&(Se.getAllHeaders=fe,Se.getHeader=_e),Se.httpStatus=(null!=ve.httpCode?ve.httpCode:ve.code)||Te||0,Se.subCode=ve.subcode,Se.messageCode=ve.messageCode,"string"==typeof ve.details?Se.messages=[ve.details]:Se.messages=ve.details,Se.raw=Fs in ve?ve[Fs]:ve}return b$2g(ve)?u$47():new Ir(fe,we,Se)}async function $$G(){Ts||await zt((()=>import("./IdentityManager-h5X-3O1R.js")),__vite__mapDeps([0,1]))}function K$H(fe){return Ns.some((ve=>ve.test(fe)))}async function W$N(fe){let ve=fe.params.url;const _e=fe.params.requestOptions,be=fe.fetchOptions??{},we=Z$I(ve)||tt$k(ve),Se=_e.responseType||"json",Te=we?0:null!=_e.timeout?_e.timeout:Ms.timeout;let Ee=!1;if(!we){fe.useSSL&&(ve=$t$1(ve));let we={..._e.query};fe.credentialToken&&(we.token=fe.credentialToken);let Se=v$21(we);has("esri-url-encodes-apostrophe")&&(Se=Se.replaceAll("'","%27"));const Te=ve.length+1+Se.length;let Ce;Ee="delete"===_e.method||"post"===_e.method||"put"===_e.method||!!_e.body||Te>Ms.maxUrlLength;const Oe=_e.useProxy||!!T$1n(ve);if(Oe){const fe=function P$1e(fe=!1){let ve,_e=Fn.proxyUrl;if("string"==typeof fe){ve=dt$8(fe);const be=T$1n(fe);be&&(_e=be.proxyUrl)}else ve=!!fe;if(!_e)throw l$4m().warn(zn),new Ir("urlUtils:proxy-not-set",zn);return ve&&wt$7()&&(_e=$t$1(_e)),I$1E(_e)}(ve);Ce=fe.path,!Ee&&Ce.length+1+Te>Ms.maxUrlLength&&(Ee=!0),fe.query&&(we={...fe.query,...we})}if("HEAD"===be.method&&(Ee||Oe)){if(Ee){if(Te>Ms.maxUrlLength)throw N$19("request:invalid-parameters",new Error("URL exceeds maximum length"),fe.params);throw N$19("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),fe.params)}if(Oe)throw N$19("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),fe.params)}if(Ee?(be.method="delete"===_e.method?"DELETE":"put"===_e.method?"PUT":"POST",_e.body?ve=Et$4(ve,we):(be.body=v$21(we),be.headers||(be.headers={}),be.headers["Content-Type"]="application/x-www-form-urlencoded")):ve=Et$4(ve,we),Oe&&(fe.useProxy=!0,ve=`${Ce}?${ve}`),we.token&&Rs&&be.body instanceof FormData&&!t$42(ve)&&be.body.set("token",we.token),_e.hasOwnProperty("withCredentials"))fe.withCredentials=_e.withCredentials;else if(!F$1a(ve,C$1q()))if(M$1w(ve))fe.withCredentials=!0;else if(Ts){const _e=Ts.findServerInfo(ve);(null==_e?void 0:_e.webTierAuth)&&(fe.withCredentials=!0)}fe.withCredentials&&(be.credentials="include",function d$3p(fe){const ve=ir.request.crossOriginNoCorsDomains;if(ve){let _e=X$B(fe);if(_e)return _e=_e.toLowerCase(),!F$1a(_e,C$1q())&&ve[_e]<Date.now()-36e5}return!1}(ve)&&await async function f$3d(fe){var ve;const _e=ir.request.crossOriginNoCorsDomains,be=X$B(fe);_e&&be&&(_e[be.toLowerCase()]=Date.now());const we=I$1E(fe);fe=we.path,"json"===(null==(ve=we.query)?void 0:ve.f)&&(fe+="?f=json");try{await fetch(fe,{mode:"no-cors",credentials:"include"})}catch{}}(Ee?Et$4(ve,we):ve))}let Ce,Oe,Re=0,De=!1;Te>0&&(Re=setTimeout((()=>{De=!0,fe.controller.abort()}),Te));try{if("native-request-init"===_e.responseType)Oe=be,Oe.url=ve;else if("image"!==_e.responseType||"default"!==be.cache||"GET"!==be.method||Ee||function J$L(fe){if(fe)for(const ve of Object.getOwnPropertyNames(fe))if(fe[ve])return!0;return!1}(_e.headers)||!we&&!fe.useProxy&&Ms.proxyUrl&&!M$1v(ve)){if(U$1a._beforeFetch&&await U$1a._beforeFetch(ve,be),Ce=await fetch(ve,be),U$1a._afterFetch&&await U$1a._afterFetch(Ce),fe.useProxy||function R$1j(fe){const ve=X$B(fe);ve&&!U$1a._corsServers.includes(ve)&&U$1a._corsServers.push(ve)}(ve),"native"===_e.responseType)Oe=Ce;else if("HEAD"!==be.method)if(Ce.ok){switch(Se){case"array-buffer":Oe=await Ce.arrayBuffer();break;case"blob":case"image":Oe=await Ce.blob();break;default:Oe=await Ce.text()}if(Re&&(clearTimeout(Re),Re=0),"json"===Se||"xml"===Se||"document"===Se)if(Oe)switch(Se){case"json":Oe=JSON.parse(Oe);break;case"xml":Oe=X$A(Oe,"application/xml");break;case"document":Oe=X$A(Oe,"text/html")}else Oe=null;if(Oe){if("array-buffer"===Se||"blob"===Se){const fe=Ce.headers.get("Content-Type");if(fe&&/application\/json|text\/plain/i.test(fe)&&Oe["blob"===Se?"size":"byteLength"]<=750)try{const fe=await new Response(Oe).json();fe.error&&(Oe=fe)}catch{}}"image"===Se&&Oe instanceof Blob&&(Oe=await Y$E(URL.createObjectURL(Oe),fe,!0))}}else{Oe=await Ce.text();try{Oe=JSON.parse(Oe)}catch{}}}else Oe=await Y$E(ve,fe)}catch(Be){if("AbortError"===Be.name){if(De)throw function u$3U(){return new Error(Os)}();throw u$47("Request canceled")}if(!(!Ce&&Be instanceof TypeError&&Ms.proxyUrl)||_e.body||"delete"===_e.method||"head"===_e.method||"post"===_e.method||"put"===_e.method||fe.useProxy||M$1v(ve))throw Be;fe.redoRequest=!0,function H$18(fe){const ve={proxyUrl:fe.proxyUrl,urlPrefix:B$16(fe.urlPrefix)},_e=Fn.proxyRules,be=ve.urlPrefix;let we=_e.length;for(let Se=0;Se<_e.length;Se++){const fe=_e[Se].urlPrefix;if(0===be.indexOf(fe)){if(be.length===fe.length)return-1;we=Se;break}0===fe.indexOf(be)&&(we=Se+1)}return _e.splice(we,0,ve),we}({proxyUrl:Ms.proxyUrl,urlPrefix:X$B(ve)??""})}finally{Re&&clearTimeout(Re)}return[Ce,Oe]}async function G$Z(fe,ve){if(null!=fe.responseData)return fe.responseData;if(fe.headers&&(ve.requestOptions.headers={...ve.requestOptions.headers,...fe.headers}),fe.query&&(ve.requestOptions.query={...ve.requestOptions.query,...fe.query}),fe.before){let _e,be;try{be=await fe.before(ve)}catch(vv){_e=N$19("request:interceptor",vv,ve)}if((be instanceof Error||be instanceof Ir)&&(_e=N$19("request:interceptor",be,ve)),_e)throw fe.error&&fe.error(_e),_e;return be}}function X$A(fe,ve){let _e;try{_e=(new DOMParser).parseFromString(fe,ve)}catch{}if(!_e||_e.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return _e}async function V$18(fe,ve,_e){var be;if(fe.redoRequest)return fe.redoRequest=!1,!1;const we=fe.params.requestOptions;if(!ve||"native"===we.responseType||"native-request-init"===we.responseType)return!0;let Se,Te;if(_e&&(_e.error&&"object"==typeof _e.error?Se=_e.error:"error"===_e.status&&Array.isArray(_e.messages)&&(Se={..._e},Se[Fs]=_e,Se.details=_e.messages)),!Se&&!ve.ok)throw Se=new Error(`Unable to load ${ve.url} status: ${ve.status}`),Se[Fs]=_e,Se;let Ee,Ce=null;Se&&(Te=Number(Se.code),Ce=Se.hasOwnProperty("subcode")?Number(Se.subcode):null,Ee=Se.messageCode,Ee=null==Ee?void 0:Ee.toUpperCase());const Oe=we.authMode;if(403===Te&&(4===Ce||(null==(be=Se.message)?void 0:be.toLowerCase().includes("ssl"))&&!Se.message.toLowerCase().includes("permission"))){if(!fe.useSSL)return fe.useSSL=!0,!1}else if(!fe.hasToken&&fe.useIdentity&&("no-prompt"!==Oe||498===Te)&&void 0!==Te&&Ls.has(Te)&&!K$H(fe.params.url)&&(403!==Te||(!Ee||!Ds.has(Ee))&&(null==Ce||2===Ce&&fe.credentialToken))){await $$G();try{const ve=await Ts.getCredential(fe.params.url,{error:N$19("request:server",Se,fe.params),prompt:"no-prompt"!==Oe,signal:fe.controller.signal,token:fe.credentialToken});return fe.credential=ve,fe.credentialToken=ve.token,fe.useSSL=fe.useSSL||ve.ssl,!1}catch(jR){if("no-prompt"===Oe)return fe.credential=void 0,fe.credentialToken=void 0,!1;Se=jR}}if(Se)throw Se;return!0}function Y$E(fe,ve,_e=!1){const be=ve.controller.signal,we=new Image;return ve.withCredentials?we.crossOrigin="use-credentials":we.crossOrigin="anonymous",we.alt="",we.fetchPriority=Ms.priority,we.src=fe,i$4v(we,fe,_e,be)}function n$4t(fe){if(!ir.assetsPath)throw ar.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Ir("assets:path-not-set","config.assetsPath is not set");return V$19(ir.assetsPath,fe)}U$1a._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],U$1a._beforeFetch=void 0,U$1a._afterFetch=void 0;let zs,ks=null;function r$3q(){return!!ks}function _$1v(){return zs||(zs=zt((()=>import("./pe-wasm-DojFl_xy.js")),[]).then((fe=>fe.p)).then((({default:fe})=>fe({locateFile:fe=>n$4t(`esri/geometry/support/${fe}`)}))).then((fe=>{l$4k(fe)})),zs)}var Us,Vs,Bs;!function(fe){function t84(fe,ve,_e){ks.ensureCache.prepare();const be=M$1u(_e),we=_e===be,Se=ks.ensureFloat64(be),Te=ks._pe_geog_to_proj(ks.getPointer(fe),ve,Se);return Te&&A$1C(_e,ve,Se,we),Te}function n52(fe,ve,_e){return _21(fe,ve,_e,0)}function _21(fe,ve,_e,be){ks.ensureCache.prepare();const we=M$1u(_e),Se=_e===we,Te=ks.ensureFloat64(we),Ee=ks._pe_proj_to_geog_center(ks.getPointer(fe),ve,Te,be);return Ee&&A$1C(_e,ve,Te,Se),Ee}fe.geogToProj=t84,fe.projGeog=function r65(fe,ve,_e,be){switch(be){case Vs.PE_TRANSFORM_P_TO_G:return n52(fe,ve,_e);case Vs.PE_TRANSFORM_G_TO_P:return t84(fe,ve,_e)}return 0},fe.projToGeog=n52,fe.projToGeogCenter=_21}(Us||(Us={})),function(fe){fe.init=function t84(){fe.PE_BUFFER_MAX=ks.PeDefs.prototype.PE_BUFFER_MAX,fe.PE_NAME_MAX=ks.PeDefs.prototype.PE_NAME_MAX,fe.PE_MGRS_MAX=ks.PeDefs.prototype.PE_MGRS_MAX,fe.PE_USNG_MAX=ks.PeDefs.prototype.PE_USNG_MAX,fe.PE_DD_MAX=ks.PeDefs.prototype.PE_DD_MAX,fe.PE_DDM_MAX=ks.PeDefs.prototype.PE_DDM_MAX,fe.PE_DMS_MAX=ks.PeDefs.prototype.PE_DMS_MAX,fe.PE_UTM_MAX=ks.PeDefs.prototype.PE_UTM_MAX,fe.PE_PARM_MAX=ks.PeDefs.prototype.PE_PARM_MAX,fe.PE_TYPE_NONE=ks.PeDefs.prototype.PE_TYPE_NONE,fe.PE_TYPE_GEOGCS=ks.PeDefs.prototype.PE_TYPE_GEOGCS,fe.PE_TYPE_PROJCS=ks.PeDefs.prototype.PE_TYPE_PROJCS,fe.PE_TYPE_GEOGTRAN=ks.PeDefs.prototype.PE_TYPE_GEOGTRAN,fe.PE_TYPE_COORDSYS=ks.PeDefs.prototype.PE_TYPE_COORDSYS,fe.PE_TYPE_UNIT=ks.PeDefs.prototype.PE_TYPE_UNIT,fe.PE_TYPE_LINUNIT=ks.PeDefs.prototype.PE_TYPE_LINUNIT,fe.PE_STR_OPTS_NONE=ks.PeDefs.prototype.PE_STR_OPTS_NONE,fe.PE_STR_AUTH_NONE=ks.PeDefs.prototype.PE_STR_AUTH_NONE,fe.PE_STR_AUTH_TOP=ks.PeDefs.prototype.PE_STR_AUTH_TOP,fe.PE_STR_NAME_CANON=ks.PeDefs.prototype.PE_STR_NAME_CANON,fe.PE_STR_FMT_WKT=ks.PeDefs.prototype.PE_STR_FMT_WKT,fe.PE_STR_FMT_WKT2=ks.PeDefs.prototype.PE_STR_FMT_WKT2,fe.PE_PARM_X0=ks.PeDefs.prototype.PE_PARM_X0,fe.PE_PARM_ND=ks.PeDefs.prototype.PE_PARM_ND,fe.PE_TRANSFORM_1_TO_2=ks.PeDefs.prototype.PE_TRANSFORM_1_TO_2,fe.PE_TRANSFORM_2_TO_1=ks.PeDefs.prototype.PE_TRANSFORM_2_TO_1,fe.PE_TRANSFORM_P_TO_G=ks.PeDefs.prototype.PE_TRANSFORM_P_TO_G,fe.PE_TRANSFORM_G_TO_P=ks.PeDefs.prototype.PE_TRANSFORM_G_TO_P,fe.PE_HORIZON_RECT=ks.PeDefs.prototype.PE_HORIZON_RECT,fe.PE_HORIZON_POLY=ks.PeDefs.prototype.PE_HORIZON_POLY,fe.PE_HORIZON_LINE=ks.PeDefs.prototype.PE_HORIZON_LINE,fe.PE_HORIZON_DELTA=ks.PeDefs.prototype.PE_HORIZON_DELTA}}(Vs||(Vs={})),function(fe){const ve={},_e={},n52=fe=>{if(fe){const ve=fe.getType();switch(ve){case Vs.PE_TYPE_GEOGCS:fe=ks.castObject(fe,ks.PeGeogcs);break;case Vs.PE_TYPE_PROJCS:fe=ks.castObject(fe,ks.PeProjcs);break;case Vs.PE_TYPE_GEOGTRAN:fe=ks.castObject(fe,ks.PeGeogtran);break;default:ve&Vs.PE_TYPE_UNIT&&(fe=ks.castObject(fe,ks.PeUnit))}}return fe};function E12(fe,_e){let be=null,we=ve[fe];if(we||(we={},ve[fe]=we),we.hasOwnProperty(String(_e)))be=we[_e];else{const ve=ks.PeFactory.prototype.factoryByType(fe,_e);ks.compare(ve,ks.NULL)||(be=ve,we[_e]=be)}return be=n52(be),be}fe.initialize=function _21(){ks.PeFactory.prototype.initialize(null)},fe.coordsys=function P9(fe){return E12(Vs.PE_TYPE_COORDSYS,fe)},fe.factoryByType=E12,fe.fromString=function i52(fe,ve){let be=null,we=_e[fe];if(we||(we={},_e[fe]=we),we.hasOwnProperty(ve))be=we[ve];else{const _e=ks.PeFactory.prototype.fromString(fe,ve);ks.compare(_e,ks.NULL)||(be=_e,we[ve]=be)}return be=n52(be),be},fe.geogcs=function p48(fe){return E12(Vs.PE_TYPE_GEOGCS,fe)},fe.geogtran=function u30(fe){return E12(Vs.PE_TYPE_GEOGTRAN,fe)},fe.getCode=function a55(fe){return ks.PeFactory.prototype.getCode(fe)},fe.projcs=function c50(fe){return E12(Vs.PE_TYPE_PROJCS,fe)},fe.unit=function T14(fe){return E12(Vs.PE_TYPE_UNIT,fe)}}(Bs||(Bs={}));let Gs=null;var Hs,qs,Ws,Ys,Zs,Xs,Js,Qs,Ks;function l$4k(fe){function t84(fe,ve,_e){fe[ve]=_e(fe[ve])}ks=fe,Vs.init(),Hs.init(),Zs.init(),Js.init(),Qs.init(),Gs=class extends ks.PeGCSExtent{destroy(){ks.destroy(this)}};const ve=[ks.PeDatum,ks.PeGeogcs,ks.PeGeogtran,ks.PeObject,ks.PeParameter,ks.PePrimem,ks.PeProjcs,ks.PeSpheroid,ks.PeUnit];for(const be of ve)t84(be.prototype,"getName",(fe=>function(){return fe.call(this,new Array(Vs.PE_NAME_MAX))}));for(const be of[ks.PeGeogtran,ks.PeProjcs])t84(be.prototype,"getParameters",(fe=>function(){const ve=new Array(Vs.PE_PARM_MAX);let _e=fe.call(this);for(let fe=0;fe<ve.length;fe++){const be=ks.getValue(_e,"*");ve[fe]=be?ks.wrapPointer(be,ks.PeParameter):null,_e+=Int32Array.BYTES_PER_ELEMENT}return ve}));t84(ks.PeHorizon.prototype,"getCoord",(fe=>function(){const ve=this.getSize();if(!ve)return null;const _e=[];return A$1C(_e,ve,fe.call(this)),_e})),t84(ks.PeGTlistExtendedEntry.prototype,"getEntries",(fe=>{const ve=ks._pe_getPeGTlistExtendedGTsSize();return function(){let _e=null;const be=fe.call(this);if(!ks.compare(be,ks.NULL)){_e=[be];const fe=this.getSteps();if(fe>1){const we=ks.getPointer(be);for(let be=1;be<fe;be++)_e.push(ks.wrapPointer(we+ve*be,ks.PeGTlistExtendedGTs))}}return _e}}));const _e=ks._pe_getPeHorizonSize(),_21=fe=>function(){let ve=this._cache;if(ve||(ve=new Map,this._cache=ve),ve.has(fe))return ve.get(fe);let be=null;const we=fe.call(this);if(!ks.compare(we,ks.NULL)){be=[we];const fe=we.getNump();if(fe>1){const ve=ks.getPointer(we);for(let we=1;we<fe;we++)be.push(ks.wrapPointer(ve+_e*we,ks.PeHorizon))}}return ve.set(fe,be),be};t84(ks.PeProjcs.prototype,"horizonGcsGenerate",_21),t84(ks.PeProjcs.prototype,"horizonPcsGenerate",_21),ks.PeObject.prototype.toString=function(fe=Vs.PE_STR_OPTS_NONE){ks.ensureCache.prepare();const ve=ks.getPointer(this),_e=ks.ensureInt8(new Array(Vs.PE_BUFFER_MAX));return ks.UTF8ToString(ks._pe_object_to_string_ext(ve,fe,_e))}}function N$18(fe){if(!fe)return;const ve=ks.getClass(fe);if(!ve)return;const _e=ks.getCache(ve);if(!_e)return;const be=ks.getPointer(fe);be&&delete _e[be]}function y$2m(fe,ve){const _e=[],be=new Array(ve);for(let we=0;we<fe;we++)_e.push(ks.ensureInt8(be));return _e}function M$1u(fe){let ve;return Array.isArray(fe[0])?(ve=[],fe.forEach((fe=>{ve.push(fe[0],fe[1])}))):ve=fe,ve}function A$1C(fe,ve,_e,be=!1){if(be)for(let we=0;we<2*ve;we++)fe[we]=ks.getValue(_e+we*Float64Array.BYTES_PER_ELEMENT,"double");else{const be=0===fe.length;for(let we=0;we<ve;we++)be&&(fe[we]=new Array(2)),fe[we][0]=ks.getValue(_e,"double"),fe[we][1]=ks.getValue(_e+Float64Array.BYTES_PER_ELEMENT,"double"),_e+=2*Float64Array.BYTES_PER_ELEMENT}}!function(fe){let ve;fe.init=function r65(){fe.PE_GTLIST_OPTS_COMMON=ks.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,ve=ks._pe_getPeGTlistExtendedEntrySize()},fe.getGTlist=function n52(fe,_e,be,we,Se,Te){let Ee=null;const Ce=new ks.PeInteger(Te);try{const Oe=ks.PeGTlistExtended.prototype.getGTlist(fe,_e,be,we,Se,Ce);if((Te=Ce.val)&&(Ee=[Oe],Te>1)){const fe=ks.getPointer(Oe);for(let _e=1;_e<Te;_e++)Ee.push(ks.wrapPointer(fe+ve*_e,ks.PeGTlistExtendedEntry))}}finally{ks.destroy(Ce)}return Ee}}(Hs||(Hs={})),(qs||(qs={})).destroy=function t84(fe){if(null==fe?void 0:fe.length){for(const ve of fe)N$18(ve),ve.getEntries().forEach((fe=>{N$18(fe);const ve=fe.getGeogtran();N$18(ve),ve.getParameters().forEach(N$18),[ve.getGeogcs1(),ve.getGeogcs2()].forEach((fe=>{N$18(fe);const ve=fe.getDatum();N$18(ve),N$18(ve.getSpheroid()),N$18(fe.getPrimem()),N$18(fe.getUnit())}))}));ks.PeGTlistExtendedEntry.prototype.Delete(fe[0])}},(Ws||(Ws={})).geogToGeog=function t84(fe,ve,_e,be,we){ks.ensureCache.prepare();const Se=M$1u(_e),Te=_e===Se,Ee=ks.ensureFloat64(Se);let Ce=0;be&&(Ce=ks.ensureFloat64(be));const Oe=ks._pe_geog_to_geog(ks.getPointer(fe),ve,Ee,Ce,we);return Oe&&A$1C(_e,ve,Ee,Te),Oe},function(fe){const t84=(fe,ve,_e,be,we,Se)=>{let Te,Ee;switch(ks.ensureCache.prepare(),fe){case"dd":Te=ks._pe_geog_to_dd,Ee=Vs.PE_DD_MAX;break;case"ddm":Te=ks._pe_geog_to_ddm,Ee=Vs.PE_DDM_MAX;break;case"dms":Te=ks._pe_geog_to_dms,Ee=Vs.PE_DMS_MAX}let Ce=0;ve&&(Ce=ks.getPointer(ve));const Oe=M$1u(be),Re=ks.ensureFloat64(Oe),De=y$2m(_e,Ee),Be=Te(Ce,_e,Re,we,ks.ensureInt32(De));if(Be)for(let Ze=0;Ze<_e;Ze++)Se[Ze]=ks.UTF8ToString(De[Ze]);return Be},r65=(fe,ve,_e,be,we)=>{let Se;switch(ks.ensureCache.prepare(),fe){case"dd":Se=ks._pe_dd_to_geog;break;case"ddm":Se=ks._pe_ddm_to_geog;break;case"dms":Se=ks._pe_dms_to_geog}let Te=0;ve&&(Te=ks.getPointer(ve));const Ee=be.map((fe=>ks.ensureString(fe))),Ce=ks.ensureInt32(Ee),Oe=ks.ensureFloat64(new Array(2*_e)),Re=Se(Te,_e,Ce,Oe);return Re&&A$1C(we,_e,Oe),Re};fe.geogToDms=function n52(fe,ve,_e,be,we){return t84("dms",fe,ve,_e,be,we)},fe.dmsToGeog=function _21(fe,ve,_e,be){return r65("dms",fe,ve,_e,be)},fe.geogToDdm=function P9(fe,ve,_e,be,we){return t84("ddm",fe,ve,_e,be,we)},fe.ddmToGeog=function E12(fe,ve,_e,be){return r65("ddm",fe,ve,_e,be)},fe.geogToDd=function i52(fe,ve,_e,be,we){return t84("dd",fe,ve,_e,be,we)},fe.ddToGeog=function p48(fe,ve,_e,be){return r65("dd",fe,ve,_e,be)}}(Ys||(Ys={})),function(fe){fe.init=function t84(){fe.PE_MGRS_STYLE_NEW=ks.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,fe.PE_MGRS_STYLE_OLD=ks.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,fe.PE_MGRS_STYLE_AUTO=ks.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,fe.PE_MGRS_180_ZONE_1_PLUS=ks.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,fe.PE_MGRS_ADD_SPACES=ks.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},fe.geogToMgrsExtended=function r65(fe,ve,_e,be,we,Se,Te){ks.ensureCache.prepare();let Ee=0;fe&&(Ee=ks.getPointer(fe));const Ce=M$1u(_e),Oe=ks.ensureFloat64(Ce),Re=y$2m(ve,Vs.PE_MGRS_MAX),De=ks.ensureInt32(Re),Be=ks._pe_geog_to_mgrs_extended(Ee,ve,Oe,be,we,Se,De);if(Be)for(let Ze=0;Ze<ve;Ze++)Te[Ze]=ks.UTF8ToString(Re[Ze]);return Be},fe.mgrsToGeogExtended=function n52(fe,ve,_e,be,we){ks.ensureCache.prepare();let Se=0;fe&&(Se=ks.getPointer(fe));const Te=_e.map((fe=>ks.ensureString(fe))),Ee=ks.ensureInt32(Te),Ce=ks.ensureFloat64(new Array(2*ve)),Oe=ks._pe_mgrs_to_geog_extended(Se,ve,Ee,be,Ce);return Oe&&A$1C(we,ve,Ce),Oe}}(Zs||(Zs={})),function(fe){fe.geogToUsng=function t84(fe,ve,_e,be,we,Se,Te){ks.ensureCache.prepare();let Ee=0;fe&&(Ee=ks.getPointer(fe));const Ce=M$1u(_e),Oe=ks.ensureFloat64(Ce),Re=y$2m(ve,Vs.PE_MGRS_MAX),De=ks.ensureInt32(Re),Be=ks._pe_geog_to_usng(Ee,ve,Oe,be,we,Se,De);if(Be)for(let Ze=0;Ze<ve;Ze++)Te[Ze]=ks.UTF8ToString(Re[Ze]);return Be},fe.usngToGeog=function r65(fe,ve,_e,be){ks.ensureCache.prepare();let we=0;fe&&(we=ks.getPointer(fe));const Se=_e.map((fe=>ks.ensureString(fe))),Te=ks.ensureInt32(Se),Ee=ks.ensureFloat64(new Array(2*ve)),Ce=ks._pe_usng_to_geog(we,ve,Te,Ee);return Ce&&A$1C(be,ve,Ee),Ce}}(Xs||(Xs={})),function(fe){fe.init=function t84(){fe.PE_UTM_OPTS_NONE=ks.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,fe.PE_UTM_OPTS_ADD_SPACES=ks.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,fe.PE_UTM_OPTS_NS=ks.PeNotationUtm.prototype.PE_UTM_OPTS_NS},fe.geogToUtm=function r65(fe,ve,_e,be,we){ks.ensureCache.prepare();let Se=0;fe&&(Se=ks.getPointer(fe));const Te=M$1u(_e),Ee=ks.ensureFloat64(Te),Ce=y$2m(ve,Vs.PE_UTM_MAX),Oe=ks.ensureInt32(Ce),Re=ks._pe_geog_to_utm(Se,ve,Ee,be,Oe);if(Re)for(let De=0;De<ve;De++)we[De]=ks.UTF8ToString(Ce[De]);return Re},fe.utmToGeog=function n52(fe,ve,_e,be,we){ks.ensureCache.prepare();let Se=0;fe&&(Se=ks.getPointer(fe));const Te=_e.map((fe=>ks.ensureString(fe))),Ee=ks.ensureInt32(Te),Ce=ks.ensureFloat64(new Array(2*ve)),Oe=ks._pe_utm_to_geog(Se,ve,Ee,be,Ce);return Oe&&A$1C(we,ve,Ce),Oe}}(Js||(Js={})),function(fe){const ve=new Map;fe.init=function r65(){fe.PE_PCSINFO_OPTION_NONE=ks.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,fe.PE_PCSINFO_OPTION_DOMAIN=ks.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,fe.PE_POLE_OUTSIDE_BOUNDARY=ks.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,fe.PE_POLE_POINT=ks.PePCSInfo.prototype.PE_POLE_POINT},fe.generate=function n52(_e,be=fe.PE_PCSINFO_OPTION_DOMAIN){let we=null,Se=null;return ve.has(_e)&&(Se=ve.get(_e),Se[be]&&(we=Se[be])),we||(we=ks.PePCSInfo.prototype.generate(_e,be),Se||(Se=[],ve.set(_e,Se)),Se[be]=we),we}}(Qs||(Qs={})),(Ks||(Ks={})).versionString=function t84(){return ks.PeVersion.prototype.version_string()};const eo=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return Us},get PeDefs(){return Vs},get PeFactory(){return Bs},get PeGCSExtent(){return Gs},get PeGTTransformations(){return Ws},get PeGTlistExtended(){return Hs},get PeGTlistExtendedEntry(){return qs},get PeNotationDms(){return Ys},get PeNotationMgrs(){return Zs},get PeNotationUsng(){return Xs},get PeNotationUtm(){return Js},get PePCSInfo(){return Qs},get PeVersion(){return Ks},_init:l$4k,get _pe(){return ks},isLoaded:r$3q,isSupported:function n$4s(){return!!has("esri-wasm")},load:_$1v},Symbol.toStringTag,{value:"Module"}));var to,ro;let io;(ro=to||(to={}))[ro.CGCS2000=4490]="CGCS2000",ro[ro.GCSMARS2000=104971]="GCSMARS2000",ro[ro.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",ro[ro.GCSMOON2000=104903]="GCSMOON2000";const no={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(io=2e3;io<=2045;io++)no[io]=0;for(io=2056;io<=2065;io++)no[io]=0;for(io=2067;io<=2135;io++)no[io]=0;for(io=2137;io<=2154;io++)no[io]=0;for(io=2161;io<=2170;io++)no[io]=0;for(io=2172;io<=2193;io++)no[io]=0;for(io=2195;io<=2198;io++)no[io]=0;for(io=2200;io<=2203;io++)no[io]=0;for(io=2205;io<=2217;io++)no[io]=0;for(io=2222;io<=2224;io++)no[io]=1;for(io=2225;io<=2250;io++)no[io]=2;for(io=2251;io<=2253;io++)no[io]=1;for(io=2257;io<=2264;io++)no[io]=2;for(io=2274;io<=2279;io++)no[io]=2;for(io=2280;io<=2282;io++)no[io]=1;for(io=2283;io<=2289;io++)no[io]=2;for(io=2290;io<=2292;io++)no[io]=0;for(io=2308;io<=2313;io++)no[io]=0;for(io=2315;io<=2491;io++)no[io]=0;for(io=2494;io<=2866;io++)no[io]=0;for(io=2867;io<=2869;io++)no[io]=1;for(io=2870;io<=2888;io++)no[io]=2;for(io=2891;io<=2895;io++)no[io]=2;for(io=2896;io<=2898;io++)no[io]=1;for(io=2902;io<=2908;io++)no[io]=2;for(io=2915;io<=2920;io++)no[io]=2;for(io=2921;io<=2923;io++)no[io]=1;for(io=2924;io<=2930;io++)no[io]=2;for(io=2931;io<=2962;io++)no[io]=0;for(io=2964;io<=2968;io++)no[io]=2;for(io=2969;io<=2973;io++)no[io]=0;for(io=2975;io<=2991;io++)no[io]=0;for(io=2995;io<=3051;io++)no[io]=0;for(io=3054;io<=3079;io++)no[io]=0;for(io=3081;io<=3088;io++)no[io]=0;for(io=3092;io<=3101;io++)no[io]=0;for(io=3106;io<=3138;io++)no[io]=0;for(io=3146;io<=3151;io++)no[io]=0;for(io=3153;io<=3166;io++)no[io]=0;for(io=3168;io<=3172;io++)no[io]=0;for(io=3174;io<=3203;io++)no[io]=0;for(io=3294;io<=3358;io++)no[io]=0;for(io=3367;io<=3403;io++)no[io]=0;for(io=3408;io<=3416;io++)no[io]=0;for(io=3417;io<=3438;io++)no[io]=2;for(io=3441;io<=3446;io++)no[io]=2;for(io=3447;io<=3450;io++)no[io]=0;for(io=3451;io<=3459;io++)no[io]=2;for(io=3460;io<=3478;io++)no[io]=0;for(io=3554;io<=3559;io++)no[io]=0;for(io=3560;io<=3570;io++)no[io]=2;for(io=3571;io<=3581;io++)no[io]=0;for(io=3594;io<=3597;io++)no[io]=0;for(io=3601;io<=3604;io++)no[io]=0;for(io=3637;io<=3639;io++)no[io]=0;for(io=3665;io<=3667;io++)no[io]=0;for(io=3693;io<=3695;io++)no[io]=0;for(io=3701;io<=3727;io++)no[io]=0;for(io=3728;io<=3739;io++)no[io]=2;for(io=3740;io<=3751;io++)no[io]=0;for(io=3753;io<=3760;io++)no[io]=2;for(io=3761;io<=3773;io++)no[io]=0;for(io=3775;io<=3777;io++)no[io]=0;for(io=3779;io<=3781;io++)no[io]=0;for(io=3783;io<=3785;io++)no[io]=0;for(io=3788;io<=3791;io++)no[io]=0;for(io=3797;io<=3802;io++)no[io]=0;for(io=3814;io<=3816;io++)no[io]=0;for(io=3825;io<=3829;io++)no[io]=0;for(io=3832;io<=3841;io++)no[io]=0;for(io=3844;io<=3852;io++)no[io]=0;for(io=3873;io<=3885;io++)no[io]=0;for(io=3890;io<=3893;io++)no[io]=0;for(io=3907;io<=3912;io++)no[io]=0;for(io=3942;io<=3950;io++)no[io]=0;for(io=3968;io<=3970;io++)no[io]=0;for(io=3973;io<=3976;io++)no[io]=0;for(io=3986;io<=3989;io++)no[io]=0;for(io=3994;io<=3997;io++)no[io]=0;for(io=4048;io<=4051;io++)no[io]=0;for(io=4056;io<=4063;io++)no[io]=0;for(io=4093;io<=4096;io++)no[io]=0;for(io=4390;io<=4398;io++)no[io]=0;for(io=4399;io<=4413;io++)no[io]=2;for(io=4418;io<=4433;io++)no[io]=2;for(io=4455;io<=4457;io++)no[io]=2;for(io=4484;io<=4489;io++)no[io]=0;for(io=4491;io<=4554;io++)no[io]=0;for(io=4568;io<=4589;io++)no[io]=0;for(io=4652;io<=4656;io++)no[io]=0;for(io=4766;io<=4800;io++)no[io]=0;for(io=5014;io<=5016;io++)no[io]=0;for(io=5069;io<=5072;io++)no[io]=0;for(io=5105;io<=5130;io++)no[io]=0;for(io=5167;io<=5188;io++)no[io]=0;for(io=5253;io<=5259;io++)no[io]=0;for(io=5269;io<=5275;io++)no[io]=0;for(io=5292;io<=5311;io++)no[io]=0;for(io=5329;io<=5331;io++)no[io]=0;for(io=5343;io<=5349;io++)no[io]=0;for(io=5355;io<=5357;io++)no[io]=0;for(io=5387;io<=5389;io++)no[io]=0;for(io=5459;io<=5463;io++)no[io]=0;for(io=5479;io<=5482;io++)no[io]=0;for(io=5518;io<=5520;io++)no[io]=0;for(io=5530;io<=5539;io++)no[io]=0;for(io=5550;io<=5552;io++)no[io]=0;for(io=5562;io<=5583;io++)no[io]=0;for(io=5623;io<=5625;io++)no[io]=2;for(io=5631;io<=5639;io++)no[io]=0;for(io=5649;io<=5653;io++)no[io]=0;for(io=5663;io<=5680;io++)no[io]=0;for(io=5682;io<=5685;io++)no[io]=0;for(io=5875;io<=5877;io++)no[io]=0;for(io=5896;io<=5899;io++)no[io]=0;for(io=5921;io<=5940;io++)no[io]=0;for(io=6050;io<=6125;io++)no[io]=0;for(io=6244;io<=6275;io++)no[io]=0;for(io=6328;io<=6348;io++)no[io]=0;for(io=6350;io<=6356;io++)no[io]=0;for(io=6366;io<=6372;io++)no[io]=0;for(io=6381;io<=6387;io++)no[io]=0;for(io=6393;io<=6404;io++)no[io]=0;for(io=6480;io<=6483;io++)no[io]=0;for(io=6511;io<=6514;io++)no[io]=0;for(io=6579;io<=6581;io++)no[io]=0;for(io=6619;io<=6624;io++)no[io]=0;for(io=6625;io<=6627;io++)no[io]=2;for(io=6628;io<=6632;io++)no[io]=0;for(io=6634;io<=6637;io++)no[io]=0;for(io=6669;io<=6692;io++)no[io]=0;for(io=6707;io<=6709;io++)no[io]=0;for(io=6720;io<=6723;io++)no[io]=0;for(io=6732;io<=6738;io++)no[io]=0;for(io=6931;io<=6933;io++)no[io]=0;for(io=6956;io<=6959;io++)no[io]=0;for(io=7005;io<=7007;io++)no[io]=0;for(io=7057;io<=7070;io++)no[io]=2;for(io=7074;io<=7082;io++)no[io]=0;for(io=7109;io<=7118;io++)no[io]=0;for(io=7119;io<=7127;io++)no[io]=1;for(io=7374;io<=7376;io++)no[io]=0;for(io=7528;io<=7586;io++)no[io]=0;for(io=7587;io<=7645;io++)no[io]=2;for(io=7692;io<=7696;io++)no[io]=0;for(io=7755;io<=7787;io++)no[io]=0;for(io=7791;io<=7795;io++)no[io]=0;for(io=7799;io<=7801;io++)no[io]=0;for(io=7803;io<=7805;io++)no[io]=0;for(io=7825;io<=7831;io++)no[io]=0;for(io=7845;io<=7859;io++)no[io]=0;for(io=8013;io<=8032;io++)no[io]=0;for(io=8065;io<=8068;io++)no[io]=1;for(io=8518;io<=8529;io++)no[io]=2;for(io=8533;io<=8536;io++)no[io]=2;for(io=8538;io<=8540;io++)no[io]=2;for(io=8677;io<=8679;io++)no[io]=0;for(io=8836;io<=8840;io++)no[io]=0;for(io=8857;io<=8859;io++)no[io]=0;for(io=8908;io<=8910;io++)no[io]=0;for(io=9154;io<=9159;io++)no[io]=0;for(io=9205;io<=9218;io++)no[io]=0;for(io=9271;io<=9273;io++)no[io]=0;for(io=9295;io<=9297;io++)no[io]=0;for(io=9356;io<=9360;io++)no[io]=0;for(io=9404;io<=9407;io++)no[io]=0;for(io=9476;io<=9482;io++)no[io]=0;for(io=9487;io<=9494;io++)no[io]=0;for(io=9697;io<=9699;io++)no[io]=0;for(io=9821;io<=9865;io++)no[io]=0;for(io=10285;io<=10291;io++)no[io]=0;for(io=10314;io<=10317;io++)no[io]=0;for(io=10448;io<=10465;io++)no[io]=0;for(io=10731;io<=10733;io++)no[io]=0;for(io=11114;io<=11118;io++)no[io]=0;for(io=20004;io<=20032;io++)no[io]=0;for(io=20047;io<=20049;io++)no[io]=0;for(io=20062;io<=20092;io++)no[io]=0;for(io=20135;io<=20138;io++)no[io]=0;for(io=20248;io<=20258;io++)no[io]=0;for(io=20348;io<=20358;io++)no[io]=0;for(io=20436;io<=20440;io++)no[io]=0;for(io=20822;io<=20824;io++)no[io]=0;for(io=20904;io<=20932;io++)no[io]=0;for(io=20934;io<=20936;io++)no[io]=0;for(io=21004;io<=21032;io++)no[io]=0;for(io=21035;io<=21037;io++)no[io]=0;for(io=21095;io<=21097;io++)no[io]=0;for(io=21148;io<=21150;io++)no[io]=0;for(io=21207;io<=21264;io++)no[io]=0;for(io=21307;io<=21364;io++)no[io]=0;for(io=21413;io<=21423;io++)no[io]=0;for(io=21453;io<=21463;io++)no[io]=0;for(io=21473;io<=21483;io++)no[io]=0;for(io=21780;io<=21782;io++)no[io]=0;for(io=21891;io<=21894;io++)no[io]=0;for(io=21896;io<=21899;io++)no[io]=0;for(io=22171;io<=22177;io++)no[io]=0;for(io=22181;io<=22187;io++)no[io]=0;for(io=22191;io<=22197;io++)no[io]=0;for(io=22207;io<=22222;io++)no[io]=0;for(io=22229;io<=22232;io++)no[io]=0;for(io=22234;io<=22236;io++)no[io]=0;for(io=22243;io<=22250;io++)no[io]=0;for(io=22262;io<=22265;io++)no[io]=0;for(io=22307;io<=22322;io++)no[io]=0;for(io=22348;io<=22357;io++)no[io]=0;for(io=22407;io<=22422;io++)no[io]=0;for(io=22462;io<=22465;io++)no[io]=0;for(io=22521;io<=22525;io++)no[io]=0;for(io=22607;io<=22622;io++)no[io]=0;for(io=22641;io<=22646;io++)no[io]=0;for(io=22648;io<=22657;io++)no[io]=0;for(io=22707;io<=22722;io++)no[io]=0;for(io=22762;io<=22765;io++)no[io]=0;for(io=22807;io<=22822;io++)no[io]=0;for(io=22991;io<=22994;io++)no[io]=0;for(io=23028;io<=23038;io++)no[io]=0;for(io=23301;io<=23333;io++)no[io]=2;for(io=23830;io<=23853;io++)no[io]=0;for(io=23866;io<=23872;io++)no[io]=0;for(io=23877;io<=23884;io++)no[io]=0;for(io=23886;io<=23894;io++)no[io]=0;for(io=23946;io<=23948;io++)no[io]=0;for(io=24311;io<=24313;io++)no[io]=0;for(io=24342;io<=24347;io++)no[io]=0;for(io=24370;io<=24374;io++)no[io]=10;for(io=24375;io<=24381;io++)no[io]=0;for(io=24718;io<=24721;io++)no[io]=0;for(io=24817;io<=24821;io++)no[io]=0;for(io=24877;io<=24882;io++)no[io]=0;for(io=24891;io<=24893;io++)no[io]=0;for(io=25391;io<=25395;io++)no[io]=0;for(io=25828;io<=25838;io++)no[io]=0;for(io=26191;io<=26195;io++)no[io]=0;for(io=26391;io<=26393;io++)no[io]=0;for(io=26701;io<=26722;io++)no[io]=0;for(io=26729;io<=26799;io++)no[io]=2;for(io=26801;io<=26803;io++)no[io]=2;for(io=26811;io<=26813;io++)no[io]=2;for(io=26847;io<=26870;io++)no[io]=2;for(io=26891;io<=26899;io++)no[io]=0;for(io=26901;io<=26923;io++)no[io]=0;for(io=26929;io<=26946;io++)no[io]=0;for(io=26948;io<=26998;io++)no[io]=0;for(io=27037;io<=27040;io++)no[io]=0;for(io=27205;io<=27232;io++)no[io]=0;for(io=27258;io<=27260;io++)no[io]=0;for(io=27391;io<=27398;io++)no[io]=0;for(io=27561;io<=27564;io++)no[io]=0;for(io=27571;io<=27574;io++)no[io]=0;for(io=27581;io<=27584;io++)no[io]=0;for(io=27591;io<=27594;io++)no[io]=0;for(io=27700;io<=27707;io++)no[io]=0;for(io=28191;io<=28193;io++)no[io]=0;for(io=28348;io<=28358;io++)no[io]=0;for(io=28402;io<=28432;io++)no[io]=0;for(io=28462;io<=28492;io++)no[io]=0;for(io=29118;io<=29122;io++)no[io]=0;for(io=29168;io<=29172;io++)no[io]=0;for(io=29177;io<=29185;io++)no[io]=0;for(io=29187;io<=29195;io++)no[io]=0;for(io=29900;io<=29903;io++)no[io]=0;for(io=30161;io<=30179;io++)no[io]=0;for(io=30491;io<=30494;io++)no[io]=0;for(io=30729;io<=30732;io++)no[io]=0;for(io=31251;io<=31259;io++)no[io]=0;for(io=31265;io<=31268;io++)no[io]=0;for(io=31275;io<=31279;io++)no[io]=0;for(io=31281;io<=31297;io++)no[io]=0;for(io=31461;io<=31469;io++)no[io]=0;for(io=31491;io<=31495;io++)no[io]=0;for(io=31917;io<=31922;io++)no[io]=0;for(io=31965;io<=32e3;io++)no[io]=0;for(io=32001;io<=32003;io++)no[io]=2;for(io=32005;io<=32031;io++)no[io]=2;for(io=32033;io<=32060;io++)no[io]=2;for(io=32064;io<=32067;io++)no[io]=2;for(io=32074;io<=32077;io++)no[io]=2;for(io=32081;io<=32086;io++)no[io]=0;for(io=32107;io<=32130;io++)no[io]=0;for(io=32133;io<=32159;io++)no[io]=0;for(io=32164;io<=32167;io++)no[io]=2;for(io=32180;io<=32199;io++)no[io]=0;for(io=32201;io<=32260;io++)no[io]=0;for(io=32301;io<=32360;io++)no[io]=0;for(io=32401;io<=32460;io++)no[io]=0;for(io=32501;io<=32560;io++)no[io]=0;for(io=32601;io<=32662;io++)no[io]=0;for(io=32664;io<=32667;io++)no[io]=2;for(io=32701;io<=32761;io++)no[io]=0;for(io=53001;io<=53004;io++)no[io]=0;for(io=53008;io<=53019;io++)no[io]=0;for(io=53021;io<=53032;io++)no[io]=0;for(io=53034;io<=53037;io++)no[io]=0;for(io=53042;io<=53046;io++)no[io]=0;for(io=53074;io<=53080;io++)no[io]=0;for(io=54001;io<=54004;io++)no[io]=0;for(io=54008;io<=54019;io++)no[io]=0;for(io=54021;io<=54032;io++)no[io]=0;for(io=54034;io<=54037;io++)no[io]=0;for(io=54042;io<=54046;io++)no[io]=0;for(io=54048;io<=54053;io++)no[io]=0;for(io=54074;io<=54080;io++)no[io]=0;for(io=54098;io<=54101;io++)no[io]=0;for(io=102001;io<=102040;io++)no[io]=0;for(io=102042;io<=102063;io++)no[io]=0;for(io=102065;io<=102067;io++)no[io]=0;for(io=102070;io<=102117;io++)no[io]=0;for(io=102122;io<=102216;io++)no[io]=0;for(io=102221;io<=102377;io++)no[io]=0;for(io=102382;io<=102388;io++)no[io]=0;for(io=102389;io<=102398;io++)no[io]=2;for(io=102399;io<=102444;io++)no[io]=0;for(io=102445;io<=102447;io++)no[io]=2;for(io=102448;io<=102458;io++)no[io]=0;for(io=102459;io<=102468;io++)no[io]=2;for(io=102469;io<=102499;io++)no[io]=0;for(io=102500;io<=102519;io++)no[io]=1;for(io=102520;io<=102524;io++)no[io]=0;for(io=102525;io<=102529;io++)no[io]=2;for(io=102530;io<=102588;io++)no[io]=0;for(io=102590;io<=102598;io++)no[io]=0;for(io=102601;io<=102603;io++)no[io]=0;for(io=102605;io<=102628;io++)no[io]=0;for(io=102629;io<=102646;io++)no[io]=2;for(io=102648;io<=102700;io++)no[io]=2;for(io=102701;io<=102703;io++)no[io]=0;for(io=102707;io<=102730;io++)no[io]=2;for(io=102733;io<=102758;io++)no[io]=2;for(io=102767;io<=102900;io++)no[io]=0;for(io=102901;io<=102933;io++)no[io]=2;for(io=102934;io<=102950;io++)no[io]=13;for(io=102951;io<=102963;io++)no[io]=0;for(io=102965;io<=102969;io++)no[io]=0;for(io=102971;io<=102973;io++)no[io]=0;for(io=102975;io<=102989;io++)no[io]=0;for(io=102990;io<=102992;io++)no[io]=1;for(io=102997;io<=103002;io++)no[io]=0;for(io=103003;io<=103008;io++)no[io]=2;for(io=103009;io<=103011;io++)no[io]=0;for(io=103012;io<=103014;io++)no[io]=2;for(io=103019;io<=103021;io++)no[io]=0;for(io=103022;io<=103024;io++)no[io]=2;for(io=103029;io<=103031;io++)no[io]=0;for(io=103032;io<=103034;io++)no[io]=2;for(io=103065;io<=103068;io++)no[io]=0;for(io=103074;io<=103076;io++)no[io]=0;for(io=103077;io<=103079;io++)no[io]=1;for(io=103080;io<=103082;io++)no[io]=0;for(io=103083;io<=103085;io++)no[io]=2;for(io=103090;io<=103093;io++)no[io]=0;for(io=103097;io<=103099;io++)no[io]=0;for(io=103100;io<=103102;io++)no[io]=2;for(io=103107;io<=103109;io++)no[io]=0;for(io=103110;io<=103112;io++)no[io]=2;for(io=103113;io<=103116;io++)no[io]=0;for(io=103117;io<=103120;io++)no[io]=2;for(io=103153;io<=103157;io++)no[io]=0;for(io=103158;io<=103162;io++)no[io]=2;for(io=103163;io<=103165;io++)no[io]=0;for(io=103166;io<=103168;io++)no[io]=1;for(io=103169;io<=103171;io++)no[io]=2;for(io=103186;io<=103188;io++)no[io]=0;for(io=103189;io<=103191;io++)no[io]=2;for(io=103192;io<=103195;io++)no[io]=0;for(io=103196;io<=103199;io++)no[io]=2;for(io=103200;io<=103224;io++)no[io]=0;for(io=103225;io<=103227;io++)no[io]=1;for(io=103232;io<=103237;io++)no[io]=0;for(io=103238;io<=103243;io++)no[io]=2;for(io=103244;io<=103246;io++)no[io]=0;for(io=103247;io<=103249;io++)no[io]=2;for(io=103254;io<=103256;io++)no[io]=0;for(io=103257;io<=103259;io++)no[io]=2;for(io=103264;io<=103266;io++)no[io]=0;for(io=103267;io<=103269;io++)no[io]=2;for(io=103300;io<=103375;io++)no[io]=0;for(io=103381;io<=103383;io++)no[io]=0;for(io=103384;io<=103386;io++)no[io]=1;for(io=103387;io<=103389;io++)no[io]=0;for(io=103390;io<=103392;io++)no[io]=2;for(io=103397;io<=103399;io++)no[io]=0;for(io=103400;io<=103471;io++)no[io]=2;for(io=103476;io<=103478;io++)no[io]=0;for(io=103479;io<=103481;io++)no[io]=2;for(io=103486;io<=103488;io++)no[io]=0;for(io=103489;io<=103491;io++)no[io]=2;for(io=103492;io<=103495;io++)no[io]=0;for(io=103496;io<=103499;io++)no[io]=2;for(io=103528;io<=103543;io++)no[io]=0;for(io=103544;io<=103548;io++)no[io]=2;for(io=103549;io<=103551;io++)no[io]=0;for(io=103552;io<=103554;io++)no[io]=1;for(io=103555;io<=103557;io++)no[io]=2;for(io=103558;io<=103560;io++)no[io]=0;for(io=103571;io<=103573;io++)no[io]=0;for(io=103574;io<=103576;io++)no[io]=2;for(io=103577;io<=103580;io++)no[io]=0;for(io=103581;io<=103583;io++)no[io]=2;for(io=103595;io<=103694;io++)no[io]=0;for(io=103696;io<=103699;io++)no[io]=0;for(io=103700;io<=103793;io++)no[io]=2;for(io=103794;io<=103890;io++)no[io]=0;for(io=103891;io<=103896;io++)no[io]=2;for(io=103900;io<=103971;io++)no[io]=2;for(io=103972;io<=103977;io++)no[io]=0;for(io=112e3;io<=112101;io++)no[io]=0;const so=[102100,102113,3857,3785],oo=[4326,...so,104905,104971],ao='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',lo=[-20037508.342788905,20037508.342788905],co=[-20037508.342787,20037508.342787],uo={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:lo,origin:co,dx:1e-5},102100:{wkTemplate:ao,valid:lo,origin:co,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:lo,origin:co,dx:1e-5},3857:{wkTemplate:ao,valid:lo,origin:co,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function G$Y(fe,ve){if(fe===ve)return!0;if(null==fe||null==ve)return!1;const _e=fe.wkid,be=ve.wkid;if(null!=_e||null!=be){if(_e===be)return!0;if(w$1X(fe)&&w$1X(ve))return!0;const we=fe.latestWkid;if(null!=we&&be===we)return!0;const Se=ve.latestWkid;return null!=Se&&_e===Se}let we,Se;return fe.wkt2&&ve.wkt2?(we=fe.wkt2,Se=ve.wkt2):fe.wkt&&ve.wkt&&(we=fe.wkt,Se=ve.wkt),!(!we||!Se)&&we.toUpperCase()===Se.toUpperCase()}function s$46(fe){const ve=null==fe?void 0:fe.wkid;return null!=ve&&ve>=2e3&&uo[ve]||null}function d$3n(fe){if(!fe)return;const{wkid:ve,vcsWkid:_e}=fe;if(ve)return _e?JSON.stringify({wkid:ve,vcsWkid:_e}):String(ve);const be=fe.wkt||fe.wkt2;return JSON.stringify(be?_e?{wkt:be,vcsWkid:_e}:{wkt:be}:{})}function A$1B(fe){if(!N$17(fe))return!1;const{wkid:ve}=fe;if(ve)return null==no[ve];const _e=fe.wkt2||fe.wkt;return!!_e&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(_e)}function P$1b(fe){return!(f$3b(fe)||p$4U(fe))}function C$1p(fe){return 4326===(null==fe?void 0:fe.wkid)}function c$4H(fe){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(fe)}function k$1w(fe){return(null==fe?void 0:fe.wkid)===to.CGCS2000}function w$1X(fe){const ve=null==fe?void 0:fe.wkid;return null!=ve&&ve>=2e3&&so.includes(ve)}function O$1s(fe){return 32662===(null==fe?void 0:fe.wkid)}function I$1C(fe){return fe===to.GCSMARS2000||fe===to.GCSMARS2000_SPHERE}function f$3b(fe){return I$1C(null==fe?void 0:fe.wkid)}function D$1b(fe){return fe===to.GCSMOON2000}function p$4U(fe){return D$1b(null==fe?void 0:fe.wkid)}function W$M(fe){const ve=null==fe?void 0:fe.wkid;return null!=ve&&ve>=2e3&&oo.includes(ve)}function N$17(fe){if(null==fe)return!1;const ve=fe.wkid;return null!=ve&&ve>=2e3||null!=fe.wkt2||null!=fe.wkt}const ho={wkid:4326,wkt:r$3O(uo[4326].wkTemplate,{Central_Meridian:"0.0"})},po={wkid:102100,latestWkid:3857};function S$1K(fe){return{wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${fe.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`}}const fo=S$1K(Rn),mo=S$1K(In),yo=S$1K(Ln),vo={wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${Rn.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`},_o=mo.wkt.toUpperCase(),$o=yo.wkt.toUpperCase();function s$45(fe){if(null!=fe&&N$17(fe)){const ve=fe.wkid,_e=fe.wkt2??fe.wkt;if(I$1C(ve))return In;const be=null==_e?void 0:_e.toUpperCase();if(_e&&be===_o)return In;if(D$1b(ve)||be&&be===$o)return Ln}return Rn}function R$1h(fe){return I$1C(fe)?In:D$1b(fe)?Ln:Rn}function A$1A(fe){return G$Y(fe,fo)}function O$1r(fe){return A$1A(fe)||G$Y(fe,mo)||G$Y(fe,yo)}const bo=39.37,wo=Rn.radius*Math.PI/200,xo=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,So=no,To=/UNIT\[([^\]]+)]/i,Eo=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),Po=i$4y()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),B$14=fe=>fe*fe,k$1v=fe=>fe*fe*fe,Co={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:B$14(.001)},"square-centimeters":{inBaseUnits:B$14(.01)},"square-decimeters":{inBaseUnits:B$14(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:B$14(1e3)},"square-inches":{inBaseUnits:B$14(.0254)},"square-feet":{inBaseUnits:B$14(.3048)},"square-yards":{inBaseUnits:B$14(.9144)},"square-miles":{inBaseUnits:B$14(1609.344)},"square-us-feet":{inBaseUnits:B$14(1200/3937)},acres:{inBaseUnits:.0015625*B$14(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*k$1v(.001)},"cubic-centimeters":{inBaseUnits:1e3*k$1v(.01)},"cubic-decimeters":{inBaseUnits:1e3*k$1v(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*k$1v(1e3)},"cubic-inches":{inBaseUnits:1e3*k$1v(.0254)},"cubic-feet":{inBaseUnits:1e3*k$1v(.3048)},"cubic-yards":{inBaseUnits:1e3*k$1v(.9144)},"cubic-miles":{inBaseUnits:1e3*k$1v(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},Oo=(()=>{const fe={};for(const ve in Co)for(const _e in Co[ve].units)fe[_e]=ve;return fe})();const Ao=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],Mo=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function D$1a(fe){const ve=Oo[fe];if(!ve)throw new Error("unknown type");return ve}function I$1A(fe,ve=null){return ve=ve||D$1a(fe),Co[ve].baseUnit===fe}function j$1K(fe,ve,_e){if(ve===_e)return fe;const be=D$1a(ve);if(be!==D$1a(_e))throw new Error("incompatible units");const we=I$1A(ve,be)?fe:function y$2l(fe,ve,_e){return fe*Co[_e].units[ve].inBaseUnits}(fe,ve,be);return I$1A(_e,be)?we:function _$1u(fe,ve,_e){return fe/Co[_e].units[ve].inBaseUnits}(we,_e,be)}function E$1I(fe){switch(fe){case"metric":return"meters";case"imperial":return"feet";default:return fe}}function R$1g(fe){return E$1I(fe)}function x$1T(fe){switch(fe){case"metric":return"square-meters";case"imperial":return"square-feet";default:return fe}}function N$16(fe,ve,_e){switch(_e){case"metric":return v$20(fe,ve);case"imperial":return J$K(fe,ve);default:return _e}}function O$1q(fe,ve,_e){switch(_e){case"metric":return F$18(fe,ve);case"imperial":return T$1k(fe,ve);default:return _e}}function v$20(fe,ve){const _e=j$1K(fe,ve,"meters");return Math.abs(_e)<3e3?"meters":"kilometers"}function F$18(fe,ve){const _e=j$1K(fe,ve,"meters");return Math.abs(_e)<1e5?"meters":"kilometers"}function J$K(fe,ve){const _e=j$1K(fe,ve,"feet");return Math.abs(_e)<1e3?"feet":"miles"}function T$1k(fe,ve){const _e=j$1K(fe,ve,"feet");return Math.abs(_e)<1e5?"feet":"miles"}function K$G(fe,ve){const _e=j$1K(fe,ve,"square-meters");return Math.abs(_e)<3e6?"square-meters":"square-kilometers"}function A$1z(fe,ve){const _e=j$1K(fe,ve,"square-feet");return Math.abs(_e)<1e6?"square-feet":"square-miles"}function G$W(fe,ve,_e){return j$1K(fe,ve,"meters")/(_e*Math.PI/180)}function H$16(fe){return Po.fromJSON(fe.toLowerCase())||null}function L$1d(fe){if(null!=fe&&!P$1b(fe))return 1;const ve=W$L(fe);return ve>1e5?1:ve}function Y$D(fe){return W$L(fe)>=s$45(fe).metersPerDegree?"meters":X$z(fe)}function W$L(fe,ve=Rn.metersPerDegree){return $$F(fe,!0)??ve}function $$F(fe,ve=!1){const _e=(null==fe?void 0:fe.wkid)??null,be=(null==fe?void 0:fe.wkt2)??(null==fe?void 0:fe.wkt)??null;let we=null;if(_e){if(I$1C(_e))return In.metersPerDegree;if(D$1b(_e))return Ln.metersPerDegree;we=So.values[So[_e]],!we&&ve&&Eo.has(_e)&&(we=wo)}else be&&(re$e(be)?we=Q$H(xo.exec(be),we):te$f(be)&&(we=Q$H(To.exec(be),we)));return we}function z$1a(fe){return A$1B(fe)?1:W$L(fe)}function Q$H(fe,ve){return(null==fe?void 0:fe[1])?V$17(fe[1]):ve}function V$17(fe){return parseFloat(fe.split(",")[1])}function X$z(fe){const ve=(null==fe?void 0:fe.wkid)??null,_e=(null==fe?void 0:fe.wkt2)??(null==fe?void 0:fe.wkt)??null;let be=null;if(ve)be=So.units[So[ve]];else if(_e){const fe=re$e(_e)?xo:te$f(_e)?To:null;if(fe){const ve=fe.exec(_e);(null==ve?void 0:ve[1])&&(be=function ne$f(fe){const ve=/[\\"']{1}([^\\"']+)/.exec(fe);let _e=null==ve?void 0:ve[1];if(!_e||!So.units.includes(_e)){const ve=V$17(fe);_e=null;const be=So.values;for(let fe=0;fe<be.length;++fe)if(Math.abs(ve-be[fe])<Ro){_e=So.units[fe];break}}return _e}(ve[1]))}}return null!=be?H$16(be):null}function Z$H(fe){const ve=X$z(fe);return null!=ve&&Ao.includes(ve)?ve:null}function ee$g(fe){const ve=Y$D(fe);return null!=ve&&Ao.includes(ve)?ve:null}function se$e(fe){const ve=X$z(fe);return null==ve?null:Mo.get(ve)}function te$f(fe){return/^GEOCCS/i.test(fe)}function re$e(fe){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(fe)}const Ro=1e-7;function ae$e(fe){const ve=X$z(fe);if(null==ve)return null;switch(ve){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const Io=i$4y()({esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"}),Lo=i$4y()({esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"}),Do=i$4y()({esriDUDecimalDegrees:"degrees",esriDURadians:"radians"});var No;let Fo=No=class extends Pn{static fromJSON(fe){if(!fe)return null;if(fe.wkid){if(102100===fe.wkid)return No.WebMercator;if(4326===fe.wkid)return No.WGS84}const ve=new No;return ve.read(fe),ve}constructor(fe){super(fe),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(fe){if(fe&&"object"==typeof fe)return fe;const ve="string"==typeof fe?"wkt":"wkid";return{[ve]:fe}}get isWGS84(){return C$1p(this)}get isWebMercator(){return w$1X(this)}get isGeographic(){return A$1B(this)}get isWrappable(){return W$M(this)}get metersPerUnit(){return W$L(this)}get unit(){return X$z(this)||(this.isGeographic?"degrees":null)}writeWkt(fe,ve){this.wkid||(ve.wkt=fe)}clone(){if(this===No.WGS84)return new No(ho);if(this===No.WebMercator)return new No(po);const fe=new No;return null!=this.wkid?(fe.wkid=this.wkid,null!=this.latestWkid&&(fe.latestWkid=this.latestWkid),null!=this.vcsWkid&&(fe.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(fe.latestVcsWkid=this.latestVcsWkid)):(null!=this.wkt&&(fe.wkt=this.wkt),null!=this.wkt2&&(fe.wkt2=this.wkt2)),this.imageCoordinateSystem&&(fe.imageCoordinateSystem=a$4H(this.imageCoordinateSystem)),fe}equals(fe){if(null==fe)return!1;if(this.imageCoordinateSystem||fe.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==fe.imageCoordinateSystem)return!1;const{id:ve,referenceServiceName:_e}=fe.imageCoordinateSystem,{geodataXform:be}=fe.imageCoordinateSystem,we=this.imageCoordinateSystem;return null==ve||be?JSON.stringify(we)===JSON.stringify(fe.imageCoordinateSystem):_e?we.id===ve&&we.referenceServiceName===_e:we.id===ve}return G$Y(this,fe)}toJSON(fe){return this.write(void 0,fe)}};Fo.GCS_NAD_1927=null,Fo.WGS84=null,Fo.WebMercator=null,Fo.PlateCarree=null,e$4o([y$2v({readOnly:!0})],Fo.prototype,"isWGS84",null),e$4o([y$2v({readOnly:!0})],Fo.prototype,"isWebMercator",null),e$4o([y$2v({readOnly:!0})],Fo.prototype,"isGeographic",null),e$4o([y$2v({readOnly:!0})],Fo.prototype,"isWrappable",null),e$4o([y$2v({type:Ci,json:{write:!0}})],Fo.prototype,"latestWkid",void 0),e$4o([y$2v({readOnly:!0})],Fo.prototype,"metersPerUnit",null),e$4o([y$2v({readOnly:!0})],Fo.prototype,"unit",null),e$4o([y$2v({type:Ci,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkt}}}}}}})],Fo.prototype,"wkid",void 0),e$4o([y$2v({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkid}}}}}}})],Fo.prototype,"wkt",void 0),e$4o([r$3s("wkt"),r$3s("web-scene","wkt")],Fo.prototype,"writeWkt",null),e$4o([y$2v({type:String,json:{write:!1}})],Fo.prototype,"wkt2",void 0),e$4o([y$2v({type:Ci,json:{write:!0}})],Fo.prototype,"vcsWkid",void 0),e$4o([y$2v({type:Ci,json:{write:!0}})],Fo.prototype,"latestVcsWkid",void 0),e$4o([y$2v()],Fo.prototype,"imageCoordinateSystem",void 0),Fo=No=e$4o([a$4y("esri.geometry.SpatialReference")],Fo),Fo.prototype.toJSON.isDefaultToJSON=!0,Fo.GCS_NAD_1927=new Fo({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Fo.WGS84=new Fo(ho),Fo.WebMercator=new Fo(po),Fo.PlateCarree=new Fo({wkid:32662}),Object.freeze&&(Object.freeze(Fo.GCS_NAD_1927),Object.freeze(Fo.WGS84),Object.freeze(Fo.WebMercator),Object.freeze(Fo.PlateCarree));const zo=Fo;let ko=class c2 extends Pn{constructor(...fe){super(...fe),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=zo.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(fe,ve){if(fe instanceof zo)return fe;if(null!=fe){const _e=new zo;return _e.read(fe,ve),_e}return fe}clone(){return null}clearCache(){this.notifyChange("cache")}getCacheValue(fe){return this.cache[fe]}setCacheValue(fe,ve){this.cache[fe]=ve}};e$4o([y$2v()],ko.prototype,"type",void 0),e$4o([y$2v({readOnly:!0})],ko.prototype,"cache",null),e$4o([y$2v({readOnly:!0})],ko.prototype,"extent",null),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],ko.prototype,"hasM",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],ko.prototype,"hasZ",void 0),e$4o([y$2v({type:zo,json:{write:!0},value:zo.WGS84})],ko.prototype,"spatialReference",void 0),e$4o([o$40("spatialReference")],ko.prototype,"readSpatialReference",null),ko=e$4o([a$4y("esri.geometry.Geometry")],ko);const Uo=ko,Vo=57.29577951308232,Bo=.017453292519943;function u$3Q(fe){return fe*Vo}function l$4i(fe){return fe*Bo}function p$4R(fe){return fe/Rn.radius}function f$38(fe){return Math.PI/2-2*Math.atan(Math.exp(-fe/Rn.radius))}function c$4F(fe){return null!=fe.wkid||null!=fe.wkt}const jo=[0,0];function m$3E(fe,ve,_e,be,we){const Se=fe,Te=we;if(Te.spatialReference=_e,"x"in Se&&"x"in Te)[Te.x,Te.y]=ve(Se.x,Se.y,jo,be);else if("xmin"in Se&&"xmin"in Te)[Te.xmin,Te.ymin]=ve(Se.xmin,Se.ymin,jo,be),[Te.xmax,Te.ymax]=ve(Se.xmax,Se.ymax,jo,be);else if("paths"in Se&&"paths"in Te||"rings"in Se&&"rings"in Te){const fe="paths"in Se?Se.paths:Se.rings,_e=[];let we;for(let Se=0;Se<fe.length;Se++){const Te=fe[Se];we=[],_e.push(we);for(let fe=0;fe<Te.length;fe++)we.push(ve(Te[fe][0],Te[fe][1],[0,0],be)),Te[fe].length>2&&we[fe].push(Te[fe][2]),Te[fe].length>3&&we[fe].push(Te[fe][3])}"paths"in Te?Te.paths=_e:Te.rings=_e}else if("points"in Se&&"points"in Te){const fe=Se.points,_e=[];for(let we=0;we<fe.length;we++)_e[we]=ve(fe[we][0],fe[we][1],[0,0],be),fe[we].length>2&&_e[we].push(fe[we][2]),fe[we].length>3&&_e[we].push(fe[we][3]);Te.points=_e}return we}function x$1S(fe,ve){const _e=fe&&(c$4F(fe)?fe:fe.spatialReference),be=ve&&(c$4F(ve)?ve:ve.spatialReference);return!(fe&&"type"in fe&&"mesh"===fe.type||ve&&"type"in ve&&"mesh"===ve.type||!_e||!be)&&(!!G$Y(be,_e)||w$1X(be)&&C$1p(_e)||w$1X(_e)&&C$1p(be))}function g$2s(fe,ve){if(null==fe)return null;const _e=fe.spatialReference,be=ve&&(c$4F(ve)?ve:ve.spatialReference);return x$1S(_e,be)?G$Y(_e,be)?a$4H(fe):w$1X(be)?m$3E(fe,M$1r,zo.WebMercator,!1,a$4H(fe)):C$1p(be)?m$3E(fe,y$2k,zo.WGS84,!1,a$4H(fe)):null:null}function M$1r(fe,ve,_e=[0,0]){ve>89.99999?ve=89.99999:ve<-89.99999&&(ve=-89.99999);const be=l$4i(ve);return _e[0]=l$4i(fe)*Rn.radius,_e[1]=Rn.halfSemiMajorAxis*Math.log((1+Math.sin(be))/(1-Math.sin(be))),_e}function y$2k(fe,ve,_e=[0,0],be=!1){const we=u$3Q(fe/Rn.radius);return _e[0]=be?we:we-360*Math.floor((we+180)/360),_e[1]=u$3Q(Math.PI/2-2*Math.atan(Math.exp(-ve/Rn.radius))),_e}function d$3l(fe,ve=!1,_e=a$4H(fe)){return m$3E(fe,M$1r,zo.WebMercator,ve,_e)}function R$1f(fe,ve=!1,_e=a$4H(fe)){return m$3E(fe,y$2k,zo.WGS84,ve,_e)}function i$4s({x:fe,y:ve,spatialReference:_e},be=[0,0]){if(_e){if(w$1X(_e))return y$2k(fe,ve,be);if(A$1B(_e))return be[0]=fe,be[1]=ve,be}return null}const Go=[0,0];var Ho;const qo=[0,0];function w$1W(fe){return fe&&("esri.geometry.SpatialReference"===fe.declaredClass||null!=fe.wkid)}let Wo=Ho=class extends Uo{static copy(fe,ve){ve._set("x",fe._get("x")),ve._set("y",fe._get("y")),ve._set("z",fe._get("z")),ve._set("m",fe._get("m"));const _e=fe._get("spatialReference");ve._set("spatialReference",Object.isFrozen(_e)?_e:_e.clone())}constructor(...fe){super(...fe),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(fe,ve,_e,be,we){let Se;if(Array.isArray(fe))Se=fe,we=ve,fe=Se[0],ve=Se[1],_e=Se[2],be=Se[3];else if(fe&&"object"==typeof fe){if(Se=fe,fe=null!=Se.x?Se.x:Se.longitude,ve=null!=Se.y?Se.y:Se.latitude,_e=Se.z,be=Se.m,(we=Se.spatialReference)&&"esri.geometry.SpatialReference"!==we.declaredClass&&(we=new zo(we)),null!=Se.longitude||null!=Se.latitude)if(null==Se.longitude)ar.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(null==Se.latitude)ar.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!Se.declaredClass&&(null==we?void 0:we.isWebMercator)){const _e=M$1r(Se.longitude,Se.latitude,qo);fe=_e[0],ve=_e[1]}}else w$1W(_e)?(we=_e,_e=null):w$1W(be)&&(we=be,be=null);const Te={x:fe,y:ve};return null==Te.x&&null!=Te.y?ar.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):null==Te.y&&null!=Te.x&&ar.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),null!=we&&(Te.spatialReference=we),null!=_e&&(Te.z=_e),null!=be&&(Te.m=be),Te}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(fe){fe!==(void 0!==this._get("m"))&&(this._set("m",fe?0:void 0),this._set("hasM",fe))}get hasZ(){return void 0!==this.z}set hasZ(fe){fe!==(void 0!==this._get("z"))&&(this._set("z",fe?0:void 0),this._set("hasZ",fe))}get latitude(){return function l$4h(fe){var ve;return(null==(ve=i$4s(fe,Go))?void 0:ve[1])??null}(this)}set latitude(fe){const{spatialReference:ve,x:_e}=this;null!=fe&&ve&&(ve.isWebMercator?this._set("y",M$1r(_e,fe,qo)[1]):ve.isGeographic&&this._set("y",fe),this._set("latitude",fe))}get longitude(){return function u$3P(fe){var ve;return(null==(ve=i$4s(fe,Go))?void 0:ve[0])??null}(this)}set longitude(fe){const{y:ve,spatialReference:_e}=this;null!=fe&&_e&&(_e.isWebMercator?this._set("x",M$1r(fe,ve,qo)[0]):_e.isGeographic&&this._set("x",fe),this._set("longitude",fe))}writeX(fe,ve,_e){ve[_e]=isNaN(fe)?"NaN":fe}readX(fe){return"string"==typeof fe?NaN:fe}clone(){const fe=new Ho;return fe.x=this.x,fe.y=this.y,fe.z=this.z,fe.m=this.m,fe.spatialReference=this.spatialReference,fe}copy(fe){return Ho.copy(fe,this),this}equals(fe){if(null==fe)return!1;const{x:ve,y:_e,z:be,m:we,spatialReference:Se}=this,{z:Te,m:Ee}=fe;let{x:Ce,y:Oe,spatialReference:Re}=fe;if(!Se.equals(Re))if(Se.isWebMercator&&Re.isWGS84)[Ce,Oe]=M$1r(Ce,Oe),Re=Se;else{if(!Se.isWGS84||!Re.isWebMercator)return!1;[Ce,Oe]=y$2k(Ce,Oe),Re=Se}return ve===Ce&&_e===Oe&&be===Te&&we===Ee&&Se.wkid===Re.wkid}offset(fe,ve,_e){return this.x+=fe,this.y+=ve,null!=_e&&(this.z=(this.z??0)+_e),this}normalize(){if(!this.spatialReference)return this;const fe=s$46(this.spatialReference);if(!fe)return this;let ve=this.x;const[_e,be]=fe.valid,we=2*be;let Se;return ve>be?(Se=Math.ceil(Math.abs(ve-be)/we),ve-=Se*we):ve<_e&&(Se=Math.ceil(Math.abs(ve-_e)/we),ve+=Se*we),this._set("x",ve),this}distance(fe){return function e$3T(fe,ve){const _e=fe.x-ve.x,be=fe.y-ve.y,we=null!=fe.z&&null!=ve.z?fe.z-ve.z:0;return Math.sqrt(_e*_e+be*be+we*we)}(this,fe)}toArray(){const fe=this.hasZ,ve=this.hasM;return fe&&ve?[this.x,this.y,this.z,this.m]:fe?[this.x,this.y,this.z]:ve?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(fe){return this.write({},fe)}};e$4o([y$2v({readOnly:!0})],Wo.prototype,"cache",null),e$4o([y$2v({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Wo.prototype,"hasM",null),e$4o([y$2v({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Wo.prototype,"hasZ",null),e$4o([y$2v({type:Number})],Wo.prototype,"latitude",null),e$4o([y$2v({type:Number})],Wo.prototype,"longitude",null),e$4o([y$2v({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),s$4b((fe=>isNaN(fe)?fe:a$4C(fe)))],Wo.prototype,"x",void 0),e$4o([r$3s("x")],Wo.prototype,"writeX",null),e$4o([o$40("x")],Wo.prototype,"readX",null),e$4o([y$2v({type:Number,json:{write:!0}})],Wo.prototype,"y",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Wo.prototype,"z",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Wo.prototype,"m",void 0),Wo=Ho=e$4o([a$4y("esri.geometry.Point")],Wo),Wo.prototype.toJSON.isDefaultToJSON=!0;const Yo=Wo;let Zo=class y extends(i$4F(Pn)){constructor(...fe){super(...fe),this.position=new Yo([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Vi}normalizeCtorArgs(fe,ve,_e,be){if(fe&&"object"==typeof fe&&("x"in fe||Array.isArray(fe))){const we={position:fe};return null!=ve&&(we.heading=ve),null!=_e&&(we.tilt=_e),null!=be&&(we.fov=be),we}return fe}writePosition(fe,ve,_e,be){const we=fe.clone();we.x=a$4C(fe.x||0),we.y=a$4C(fe.y||0),we.z=fe.hasZ?a$4C(fe.z||0):fe.z,ve[_e]=we.write({},be)}readPosition(fe,ve){const _e=new Yo;return _e.read(fe,ve),_e.x=a$4C(_e.x||0),_e.y=a$4C(_e.y||0),_e.z=_e.hasZ?a$4C(_e.z||0):_e.z,_e}equals(fe){return null!=fe&&this.tilt===fe.tilt&&this.heading===fe.heading&&this.fov===fe.fov&&this.position.equals(fe.position)&&this.layout.equals(fe.layout)}};e$4o([y$2v({type:Yo,json:{write:{isRequired:!0}}})],Zo.prototype,"position",void 0),e$4o([r$3s("position")],Zo.prototype,"writePosition",null),e$4o([o$40("position")],Zo.prototype,"readPosition",null),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),s$4b((fe=>xn.normalize(a$4C(fe))))],Zo.prototype,"heading",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),s$4b((fe=>e$3Y(a$4C(fe),-180,180)))],Zo.prototype,"tilt",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Zo.prototype,"fov",void 0),e$4o([y$2v({type:Vi,nonNullable:!0,json:{read:!1,write:!1}})],Zo.prototype,"layout",void 0),Zo=e$4o([a$4y("esri.Camera")],Zo);const Xo=Zo,Jo=[0,0];function t$3Z(fe,ve){return null!=ve&&e$3S(fe,ve.x,ve.y,ve.z)}function r$3o(fe,ve){if(!ve.points||ve.points.length)return!1;for(const _e of ve.points)if(!i$4r(fe,_e))return!1;return!0}function i$4r(fe,ve){return e$3S(fe,ve[0],ve[1])}function o$3V(fe,ve){return e$3S(fe,ve[0],ve[1],ve[2])}function e$3S(fe,ve,_e,be){return ve>=fe.xmin&&ve<=fe.xmax&&_e>=fe.ymin&&_e<=fe.ymax&&(null==be||!fe.hasZ||be>=fe.zmin&&be<=fe.zmax)}function f$36(fe,ve){return Jo[1]=ve.y,Jo[0]=ve.x,function c$4E(fe,ve){return s$44(fe.rings,ve)}(fe,Jo)}function s$44(fe,ve){if(!fe)return!1;if(function x$1Q(fe){return!Array.isArray(fe[0][0])}(fe))return m$3D(!1,fe,ve);let _e=!1;for(let be=0,we=fe.length;be<we;be++)_e=m$3D(_e,fe[be],ve);return _e}function m$3D(fe,ve,_e){const[be,we]=_e;let Se=fe,Te=0;for(let Ee=0,Ce=ve.length;Ee<Ce;Ee++){Te++,Te===Ce&&(Te=0);const[fe,_e]=ve[Ee],[Oe,Re]=ve[Te];(_e<we&&Re>=we||Re<we&&_e>=we)&&fe+(we-_e)/(Re-_e)*(Oe-fe)<be&&(Se=!Se)}return Se}function i$4q(fe,ve){return t$3Z(fe,ve)}function o$3U(fe,ve){const _e=fe.hasZ&&ve.hasZ;let be,we,Se;if(fe.xmin<=ve.xmin){if(be=ve.xmin,fe.xmax<be)return!1}else if(be=fe.xmin,ve.xmax<be)return!1;if(fe.ymin<=ve.ymin){if(we=ve.ymin,fe.ymax<we)return!1}else if(we=fe.ymin,ve.ymax<we)return!1;if(_e&&ve.hasZ)if(fe.zmin<=ve.zmin){if(Se=ve.zmin,fe.zmax<Se)return!1}else if(Se=fe.zmin,ve.zmax<Se)return!1;return!0}function f$35(fe,ve){const{points:_e,hasZ:be}=ve,we=be?o$3V:i$4r;for(const Se of _e)if(we(fe,Se))return!0;return!1}const Qo=[0,0],Ko=[0,0],ea=[0,0],ta=[0,0],ra=[Qo,Ko,ea,ta],ia=[[ea,Qo],[Qo,Ko],[Ko,ta],[ta,ea]];function x$1P(fe,ve){return function y$2i(fe,ve){Qo[0]=fe.xmin,Qo[1]=fe.ymax,Ko[0]=fe.xmax,Ko[1]=fe.ymax,ea[0]=fe.xmin,ea[1]=fe.ymin,ta[0]=fe.xmax,ta[1]=fe.ymin;for(const _e of ra)if(s$44(ve,_e))return!0;for(const _e of ve){if(!_e.length)continue;let ve=_e[0];if(i$4r(fe,ve))return!0;for(let be=1;be<_e.length;be++){const we=_e[be];if(i$4r(fe,we)||z$19(ve,we,ia))return!0;ve=we}}return!1}(fe,ve.rings)}function h$2O(fe,ve){Qo[0]=fe.xmin,Qo[1]=fe.ymax,Ko[0]=fe.xmax,Ko[1]=fe.ymax,ea[0]=fe.xmin,ea[1]=fe.ymin,ta[0]=fe.xmax,ta[1]=fe.ymin;const _e=ve.paths;for(const be of _e){if(!_e.length)continue;let ve=be[0];if(i$4r(fe,ve))return!0;for(let _e=1;_e<be.length;_e++){const we=be[_e];if(i$4r(fe,we)||z$19(ve,we,ia))return!0;ve=we}}return!1}const na=[0,0];function z$19(fe,ve,_e){for(let be=0;be<_e.length;be++)if(G$V(fe,ve,_e[be][0],_e[be][1]))return!0;return!1}function G$V(fe,ve,_e,be,we){const[Se,Te]=fe,[Ee,Ce]=ve,[Oe,Re]=_e,[De,Be]=be,Ze=De-Oe,Xe=Se-Oe,Je=Ee-Se,Qe=Be-Re,dt=Te-Re,$t=Ce-Te,bt=Qe*Je-Ze*$t;if(0===bt)return!1;const wt=(Ze*dt-Qe*Xe)/bt,xt=(Je*dt-$t*Xe)/bt;return wt>=0&&wt<=1&&xt>=0&&xt<=1&&(we&&(we[0]=Se+wt*(Ee-Se),we[1]=Te+wt*(Ce-Te)),!0)}function Z$G(fe){switch(fe){case"esriGeometryEnvelope":case"extent":return o$3U;case"esriGeometryMultipoint":case"multipoint":return f$35;case"esriGeometryPoint":case"point":return i$4q;case"esriGeometryPolygon":case"polygon":return x$1P;case"esriGeometryPolyline":case"polyline":return h$2O}}var sa;function d$3j(fe,ve,_e){return null==ve?_e:null==_e?ve:fe(ve,_e)}let oa=sa=class extends Uo{constructor(...fe){super(...fe),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(fe,ve,_e,be,we){return function f$34(fe){return fe&&("esri.geometry.SpatialReference"===fe.declaredClass||null!=fe.wkid)}(fe)?{spatialReference:fe,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof fe?(fe.spatialReference=null==fe.spatialReference?zo.WGS84:fe.spatialReference,fe):{xmin:fe,ymin:ve,xmax:_e,ymax:be,spatialReference:we??zo.WGS84}}static fromBounds(fe,ve){return new sa({xmin:fe[0],ymin:fe[1],xmax:fe[2],ymax:fe[3],spatialReference:ve})}static fromPoint(fe){return new sa({xmin:fe.x,ymin:fe.y,zmin:fe.z,xmax:fe.x,ymax:fe.y,zmax:fe.z,spatialReference:fe.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const fe=new Yo({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(fe.z=.5*(this.zmin+this.zmax)),this.hasM&&(fe.m=.5*(this.mmin+this.mmax)),fe}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(fe){const ve=this.center;return null!=fe.z&&this.hasZ?this.offset(fe.x-ve.x,fe.y-ve.y,fe.z-ve.z):this.offset(fe.x-ve.x,fe.y-ve.y)}clone(){const fe=new sa;return fe.xmin=this.xmin,fe.ymin=this.ymin,fe.xmax=this.xmax,fe.ymax=this.ymax,fe.spatialReference=this.spatialReference,null!=this.zmin&&(fe.zmin=this.zmin,fe.zmax=this.zmax),null!=this.mmin&&(fe.mmin=this.mmin,fe.mmax=this.mmax),fe}contains(fe){if(!fe)return!1;const ve=this.spatialReference,_e=fe.spatialReference;return ve&&_e&&!ve.equals(_e)&&x$1S(ve,_e)&&(fe=ve.isWebMercator?d$3l(fe):R$1f(fe,!0)),"point"===fe.type?t$3Z(this,fe):"extent"===fe.type&&function u$3O(fe,ve){const{xmin:_e,ymin:be,zmin:we,xmax:Se,ymax:Te,zmax:Ee}=ve;return fe.hasZ&&ve.hasZ?e$3S(fe,_e,be,we)&&e$3S(fe,_e,Te,we)&&e$3S(fe,Se,Te,we)&&e$3S(fe,Se,be,we)&&e$3S(fe,_e,be,Ee)&&e$3S(fe,_e,Te,Ee)&&e$3S(fe,Se,Te,Ee)&&e$3S(fe,Se,be,Ee):e$3S(fe,_e,be)&&e$3S(fe,_e,Te)&&e$3S(fe,Se,Te)&&e$3S(fe,Se,be)}(this,fe)}equals(fe){if(this===fe)return!0;if(null==fe)return!1;const ve=this.spatialReference,_e=fe.spatialReference;return ve&&_e&&!ve.equals(_e)&&x$1S(ve,_e)&&(fe=ve.isWebMercator?d$3l(fe):R$1f(fe,!0)),this.xmin===fe.xmin&&this.ymin===fe.ymin&&this.zmin===fe.zmin&&this.mmin===fe.mmin&&this.xmax===fe.xmax&&this.ymax===fe.ymax&&this.zmax===fe.zmax&&this.mmax===fe.mmax}expand(fe){const ve=.5*(1-fe),_e=this.width*ve,be=this.height*ve;if(this.xmin+=_e,this.ymin+=be,this.xmax-=_e,this.ymax-=be,this.hasZ){const fe=(this.zmax-this.zmin)*ve;this.zmin+=fe,this.zmax-=fe}if(this.hasM){const fe=(this.mmax-this.mmin)*ve;this.mmin+=fe,this.mmax-=fe}return this}intersects(fe){if(null==fe)return!1;"mesh"===fe.type&&(fe=fe.extent);const ve=this.spatialReference,_e=fe.spatialReference;return ve&&_e&&!G$Y(ve,_e)&&x$1S(ve,_e)&&(fe=ve.isWebMercator?d$3l(fe):R$1f(fe,!0)),Z$G(fe.type)(this,fe)}normalize(){const fe=this._normalize(!1,!0);return Array.isArray(fe)?fe:[fe]}offset(fe,ve,_e){return this.xmin+=fe,this.ymin+=ve,this.xmax+=fe,this.ymax+=ve,null!=_e&&(this.zmin+=_e,this.zmax+=_e),this}shiftCentralMeridian(){return this._normalize(!0)}union(fe){return this===fe||(this.xmin=Math.min(this.xmin,fe.xmin),this.ymin=Math.min(this.ymin,fe.ymin),this.xmax=Math.max(this.xmax,fe.xmax),this.ymax=Math.max(this.ymax,fe.ymax),(this.hasZ||fe.hasZ)&&(this.zmin=d$3j(Math.min,this.zmin,fe.zmin),this.zmax=d$3j(Math.max,this.zmax,fe.zmax)),(this.hasM||fe.hasM)&&(this.mmin=d$3j(Math.min,this.mmin,fe.mmin),this.mmax=d$3j(Math.max,this.mmax,fe.mmax))),this}intersection(fe){return this===fe?this:null!=fe&&this.intersects(fe)?(this.xmin=Math.max(this.xmin,fe.xmin),this.ymin=Math.max(this.ymin,fe.ymin),this.xmax=Math.min(this.xmax,fe.xmax),this.ymax=Math.min(this.ymax,fe.ymax),(this.hasZ||fe.hasZ)&&(this.zmin=d$3j(Math.max,this.zmin,fe.zmin),this.zmax=d$3j(Math.min,this.zmax,fe.zmax)),(this.hasM||fe.hasM)&&(this.mmin=d$3j(Math.max,this.mmin,fe.mmin),this.mmax=d$3j(Math.min,this.mmax,fe.mmax)),this):null}toJSON(fe){return this.write({},fe)}_shiftCM(fe=s$46(this.spatialReference)){if(!fe||!this.spatialReference)return this;const ve=this.spatialReference,_e=this._getCM(fe);if(_e){const be=ve.isWebMercator?R$1f(_e):_e;this.xmin-=_e.x,this.xmax-=_e.x,ve.isWebMercator||(be.x=M$1q(be.x,fe).x),this.spatialReference=new zo(r$3O((ve.isWGS84?fe.altTemplate:null)??fe.wkTemplate,{Central_Meridian:be.x}))}return this}_getCM(fe){let ve=null;const[_e,be]=fe.valid,we=this.xmin,Se=this.xmax;return we>=_e&&we<=be&&Se>=_e&&Se<=be||(ve=this.center),ve}_normalize(fe,ve,_e){const be=this.spatialReference;if(!be)return this;const we=_e??s$46(be);if(null==we)return this;const Se=this._getParts(we).map((fe=>fe.extent));if(Se.length<2)return Se[0]||this;if(Se.length>2)return fe?this._shiftCM(we):this.set({xmin:we.valid[0],xmax:we.valid[1]});if(fe)return this._shiftCM(we);if(ve)return Se;let Te=!0,Ee=!0;return Se.forEach((fe=>{fe.hasZ||(Te=!1),fe.hasM||(Ee=!1)})),{rings:Se.map((fe=>{const ve=[[fe.xmin,fe.ymin],[fe.xmin,fe.ymax],[fe.xmax,fe.ymax],[fe.xmax,fe.ymin],[fe.xmin,fe.ymin]];if(Te){const _e=(fe.zmax-fe.zmin)/2;for(let fe=0;fe<ve.length;fe++)ve[fe].push(_e)}if(Ee){const _e=(fe.mmax-fe.mmin)/2;for(let fe=0;fe<ve.length;fe++)ve[fe].push(_e)}return ve})),hasZ:Te,hasM:Ee,spatialReference:be}}_getParts(fe){let ve=this.cache._parts;if(!ve){ve=[];const{ymin:_e,ymax:be,spatialReference:we}=this,Se=this.width,Te=this.xmin,Ee=this.xmax;let Ce;fe=fe||s$46(we);const[Oe,Re]=fe.valid;Ce=M$1q(this.xmin,fe);const De=Ce.x,Be=Ce.frameId;Ce=M$1q(this.xmax,fe);const Ze=Ce.x,Xe=Ce.frameId,Je=De===Ze&&Se>0;if(Se>2*Re){const fe=new sa(Te<Ee?De:Ze,_e,Re,be,we),Se=new sa(Oe,_e,Te<Ee?Ze:De,be,we),Ce=new sa(0,_e,Re,be,we),Je=new sa(Oe,_e,0,be,we),Qe=[],dt=[];fe.contains(Ce)&&Qe.push(Be),fe.contains(Je)&&dt.push(Be),Se.contains(Ce)&&Qe.push(Xe),Se.contains(Je)&&dt.push(Xe);for(let ve=Be+1;ve<Xe;ve++)Qe.push(ve),dt.push(ve);ve.push({extent:fe,frameIds:[Be]},{extent:Se,frameIds:[Xe]},{extent:Ce,frameIds:Qe},{extent:Je,frameIds:dt})}else De>Ze||Je?ve.push({extent:new sa(De,_e,Re,be,we),frameIds:[Be]},{extent:new sa(Oe,_e,Ze,be,we),frameIds:[Xe]}):ve.push({extent:new sa(De,_e,Ze,be,we),frameIds:[Be]});this.cache._parts=ve}const _e=this.hasZ,be=this.hasM;if(_e||be){const fe={};_e&&(fe.zmin=this.zmin,fe.zmax=this.zmax),be&&(fe.mmin=this.mmin,fe.mmax=this.mmax);for(let _e=0;_e<ve.length;_e++)ve[_e].extent.set(fe)}return ve}};function M$1q(fe,ve){const[_e,be]=ve.valid,we=2*be;let Se,Te=0;return fe>be?(Se=Math.ceil(Math.abs(fe-be)/we),fe-=Se*we,Te=Se):fe<_e&&(Se=Math.ceil(Math.abs(fe-_e)/we),fe+=Se*we,Te=-Se),{x:fe,frameId:Te}}e$4o([y$2v({readOnly:!0})],oa.prototype,"cache",null),e$4o([y$2v({readOnly:!0})],oa.prototype,"center",null),e$4o([y$2v({readOnly:!0})],oa.prototype,"extent",null),e$4o([y$2v({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],oa.prototype,"hasM",null),e$4o([y$2v({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],oa.prototype,"hasZ",null),e$4o([y$2v({readOnly:!0})],oa.prototype,"height",null),e$4o([y$2v({readOnly:!0})],oa.prototype,"width",null),e$4o([y$2v({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],oa.prototype,"xmin",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],oa.prototype,"ymin",void 0),e$4o([y$2v({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],oa.prototype,"mmin",void 0),e$4o([y$2v({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],oa.prototype,"zmin",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],oa.prototype,"xmax",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],oa.prototype,"ymax",void 0),e$4o([y$2v({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],oa.prototype,"mmax",void 0),e$4o([y$2v({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],oa.prototype,"zmax",void 0),oa=sa=e$4o([a$4y("esri.geometry.Extent")],oa),oa.prototype.toJSON.isDefaultToJSON=!0;const aa=oa;function h$2N(fe,ve,_e=!1){let{hasM:be,hasZ:we}=fe;Array.isArray(ve)?4!==ve.length||be||we?3===ve.length&&_e&&!be?(we=!0,be=!1):3===ve.length&&be&&we&&(be=!1,we=!1):(be=!0,we=!0):(we=!we&&ve.hasZ&&(!be||ve.hasM),be=!be&&ve.hasM&&(!we||ve.hasZ)),fe.hasZ=we,fe.hasM=be}var la;function l$4f(fe){return(ve,_e)=>null==ve?_e:null==_e?ve:fe(ve,_e)}let ca=la=class extends Uo{constructor(...fe){super(...fe),this.points=[],this.type="multipoint"}normalizeCtorArgs(fe,ve){var _e;if(!fe&&!ve)return{};const be={};Array.isArray(fe)?(be.points=fe,be.spatialReference=ve):function c$4C(fe){return fe&&("esri.geometry.SpatialReference"===fe.declaredClass||null!=fe.wkid)}(fe)?be.spatialReference=fe:(fe.points&&(be.points=fe.points),fe.spatialReference&&(be.spatialReference=fe.spatialReference),fe.hasZ&&(be.hasZ=fe.hasZ),fe.hasM&&(be.hasM=fe.hasM));const we=null==(_e=be.points)?void 0:_e[0];return we&&(void 0===be.hasZ&&void 0===be.hasM?(be.hasZ=we.length>2,be.hasM=!1):void 0===be.hasZ?be.hasZ=we.length>3:void 0===be.hasM&&(be.hasM=we.length>3)),be}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const fe=this.points;if(!fe.length)return null;const ve=new aa,_e=this.hasZ,be=this.hasM,we=_e?3:2,Se=fe[0],Te=l$4f(Math.min),Ee=l$4f(Math.max);let Ce,Oe,Re,De,[Be,Ze]=Se,[Xe,Je]=Se;for(let Qe=0,dt=fe.length;Qe<dt;Qe++){const ve=fe[Qe],[Se,dt]=ve;if(Be=Te(Be,Se),Ze=Te(Ze,dt),Xe=Ee(Xe,Se),Je=Ee(Je,dt),_e&&ve.length>2){const fe=ve[2];Ce=Te(Ce,fe),Re=Ee(Re,fe)}if(be&&ve.length>we){const fe=ve[we];Oe=Te(Oe,fe),De=Ee(De,fe)}}return ve.xmin=Be,ve.ymin=Ze,ve.xmax=Xe,ve.ymax=Je,ve.spatialReference=this.spatialReference,_e?(ve.zmin=Ce,ve.zmax=Re):(ve.zmin=void 0,ve.zmax=void 0),be?(ve.mmin=Oe,ve.mmax=De):(ve.mmin=void 0,ve.mmax=void 0),ve}writePoints(fe,ve){ve.points=a$4H(this.points)}addPoint(fe){return h$2N(this,fe),Array.isArray(fe)?this.points.push(fe):this.points.push(fe.toArray()),this.notifyChange("points"),this}clone(){const fe={points:a$4H(this.points),spatialReference:this.spatialReference};return this.hasZ&&(fe.hasZ=!0),this.hasM&&(fe.hasM=!0),new la(fe)}getPoint(fe){if(!this._validateInputs(fe))return null;const ve=this.points[fe],_e={x:ve[0],y:ve[1],spatialReference:this.spatialReference};let be=2;return this.hasZ&&(_e.z=ve[2],be=3),this.hasM&&(_e.m=ve[be]),new Yo(_e)}removePoint(fe){if(!this._validateInputs(fe))return null;const ve=new Yo(this.points.splice(fe,1)[0],this.spatialReference);return this.notifyChange("points"),ve}setPoint(fe,ve){return this._validateInputs(fe)?(h$2N(this,ve),Array.isArray(ve)||(ve=ve.toArray()),this.points[fe]=ve,this.notifyChange("points"),this):this}toJSON(fe){return this.write({},fe)}_validateInputs(fe){return null!=fe&&fe>=0&&fe<this.points.length}};e$4o([y$2v({readOnly:!0})],ca.prototype,"cache",null),e$4o([y$2v()],ca.prototype,"extent",null),e$4o([y$2v({type:[[Number]],json:{write:{isRequired:!0}}})],ca.prototype,"points",void 0),e$4o([r$3s("points")],ca.prototype,"writePoints",null),ca=la=e$4o([a$4y("esri.geometry.Multipoint")],ca),ca.prototype.toJSON.isDefaultToJSON=!0;const ua=ca;function t$3Y(fe){const ve=[];for(fe.reset();fe.nextPath();){const _e=[];for(;fe.nextPoint();)_e.push([fe.x,fe.y]);ve.push(_e)}return fe.reset(),ve}function n$4p(fe){const ve=[];for(;fe.nextPoint();)ve.push([fe.x,fe.y]);return fe.seekPathStart(),ve}var ha,da;function i$4p(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1];if(fe.length>2&&ve.length>2){const we=fe[2]-ve[2];return Math.sqrt(_e*_e+be*be+we*we)}return Math.sqrt(_e*_e+be*be)}function o$3T(fe,ve,_e){const be=fe[0]+_e*(ve[0]-fe[0]),we=fe[1]+_e*(ve[1]-fe[1]);return fe.length>2&&ve.length>2?[be,we,fe[2]+_e*(ve[2]-fe[2])]:[be,we]}function f$33(fe,ve,_e,be){const[we,Se]=ve,[Te,Ee]=_e,[Ce,Oe]=be,Re=Ce-Te,De=Oe-Ee,Be=Re*Re+De*De,Ze=(we-Te)*Re+(Se-Ee)*De,Xe=Math.min(1,Math.max(0,Ze/Be));return fe[0]=Te+Re*Xe,fe[1]=Ee+De*Xe,fe}function l$4e(fe,ve,_e,be,we,Se){let Te=_e,Ee=be,Ce=we-Te,Oe=Se-Ee;if(0!==Ce||0!==Oe){const _e=((fe-Te)*Ce+(ve-Ee)*Oe)/(Ce*Ce+Oe*Oe);_e>1?(Te=we,Ee=Se):_e>0&&(Te+=Ce*_e,Ee+=Oe*_e)}return Ce=fe-Te,Oe=ve-Ee,Ce*Ce+Oe*Oe}function c$4B(fe,ve){return o$3T(fe,ve,.5)}function h$2L(fe){const ve=fe.length;let _e=0;for(let be=0;be<ve-1;++be)_e+=i$4p(fe[be],fe[be+1]);return _e}function p$4P(fe,ve){if(ve<=0)return fe[0];const _e=fe.length;let be=0;for(let we=0;we<_e-1;++we){const _e=i$4p(fe[we],fe[we+1]);if(ve-be<_e){const Se=(ve-be)/_e;return o$3T(fe[we],fe[we+1],Se)}be+=_e}return fe[_e-1]}function a$4k(fe,ve=ha.X,_e=ha.Y){let be=0;const we=fe.length;let Se=fe[0];for(let Te=1;Te<we;Te++){const we=fe[Te];be+=(we[ve]-Se[ve])*(we[_e]+Se[_e]),Se=we}if(!y$2h(fe)){const we=fe[0];be+=(we[ve]-Se[ve])*(we[_e]+Se[_e])}return be>=0}function y$2h(fe){const ve=fe.length;return ve<3||h$30(fe[0],fe[ve-1])}function g$2p(fe){if(!("rings"in fe))return!1;let ve=!1;for(const _e of fe.rings)y$2h(_e)||(_e.push(_e[0].slice()),ve=!0);return ve}function M$1p(fe){return"polygon"!==fe.type&&"polyline"!==fe.type||z$17("polygon"===fe.type?fe.rings:fe.paths,fe.spatialReference),fe}function z$17(fe,ve){const _e=s$46(ve);if(!_e)return;const be=_e.valid[0],we=_e.valid[1],Se=we-be;for(const Te of fe){let fe=1/0,ve=-1/0;for(const Se of Te){const _e=v$1$(Se[0],be,we);fe=Math.min(fe,_e),ve=Math.max(ve,_e),Se[0]=_e}const _e=ve-fe;Se-_e<_e&&Te.forEach((fe=>{fe[0]<0&&(fe[0]+=Se)}))}}function v$1$(fe,ve,_e){const be=_e-ve;return fe<ve?_e-(ve-fe)%be:fe>_e?ve+(fe-ve)%be:fe}function j$1J(fe,ve){if(fe===ve)return!0;if(fe.type!==ve.type)return!1;if("point"===fe.type||"mesh"===fe.type||"extent"===fe.type)return!0;if("multipoint"===fe.type)return fe.points.length===ve.points.length;const[_e,be]="polyline"===fe.type?[fe.paths,ve.paths]:[fe.rings,ve.rings];return _e.length===be.length&&_e.every(((fe,ve)=>fe.length===be[ve].length))}function r$3n(fe){return fe?fe.hasZ?[fe.xmax-fe.xmin/2,fe.ymax-fe.ymin/2,fe.zmax-fe.zmin/2]:[fe.xmax-fe.xmin/2,fe.ymax-fe.ymin/2]:null}function l$4d(fe){return fe?o$3S(fe.rings,fe.hasZ??!1):null}function o$3S(fe,ve){if(!(null==fe?void 0:fe.length))return null;const _e=[],be=[],we=ve?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let Se=0,Te=fe.length;Se<Te;Se++){const _e=u$3K(fe[Se],ve,we);_e&&be.push(_e)}if(be.sort(((fe,_e)=>{let be=fe[2]-_e[2];return 0===be&&ve&&(be=fe[4]-_e[4]),be})),be.length&&(_e[0]=be[0][0],_e[1]=be[0][1],ve&&(_e[2]=be[0][3]),(_e[0]<we[0]||_e[0]>we[1]||_e[1]<we[2]||_e[1]>we[3]||ve&&(_e[2]<we[4]||_e[2]>we[5]))&&(_e.length=0)),!_e.length){const be=fe[0]&&fe[0].length?function s$42(fe,ve){const _e=ve?[0,0,0]:[0,0],be=ve?[0,0,0]:[0,0];let we=0,Se=0,Te=0,Ee=0;for(let Ce=0,Oe=fe.length;Ce<Oe-1;Ce++){const Oe=fe[Ce],Re=fe[Ce+1];if(Oe&&Re){_e[0]=Oe[0],_e[1]=Oe[1],be[0]=Re[0],be[1]=Re[1],ve&&Oe.length>2&&Re.length>2&&(_e[2]=Oe[2],be[2]=Re[2]);const fe=i$4p(_e,be);if(fe){we+=fe;const _e=c$4B(Oe,Re);Se+=fe*_e[0],Te+=fe*_e[1],ve&&_e.length>2&&(Ee+=fe*_e[2])}}}return we>0?ve?[Se/we,Te/we,Ee/we]:[Se/we,Te/we]:fe.length?fe[0]:null}(fe[0],ve):null;if(!be)return null;_e[0]=be[0],_e[1]=be[1],ve&&be.length>2&&(_e[2]=be[2])}return _e}function u$3K(fe,ve,_e){let be=0,we=0,Se=0,Te=0,Ee=0;const Ce=fe.length?fe[0][0]:0,Oe=fe.length?fe[0][1]:0,Re=fe.length&&ve?fe[0][2]:0;for(let Be=0;Be<fe.length;Be++){const De=fe[Be],Ze=fe[(Be+1)%fe.length],[Xe,Je,Qe]=De,dt=Xe-Ce,$t=Je-Oe,[bt,wt,xt]=Ze,St=bt-Ce,Et=wt-Oe,Pt=dt*Et-St*$t;if(Te+=Pt,be+=(dt+St)*Pt,we+=($t+Et)*Pt,ve&&De.length>2&&Ze.length>2){const fe=Qe-Re,ve=xt-Re,_e=dt*ve-St*fe;Se+=(fe+ve)*_e,Ee+=_e}Xe<_e[0]&&(_e[0]=Xe),Xe>_e[1]&&(_e[1]=Xe),Je<_e[2]&&(_e[2]=Je),Je>_e[3]&&(_e[3]=Je),ve&&(Qe<_e[4]&&(_e[4]=Qe),Qe>_e[5]&&(_e[5]=Qe))}if(Te>0&&(Te*=-1),Ee>0&&(Ee*=-1),!Te)return null;Te*=.5,Ee*=.5;const De=[be/(6*Te)+Ce,we/(6*Te)+Oe,Te];return ve&&(_e[4]===_e[5]||0===Ee?(De[3]=(_e[4]+_e[5])/2,De[4]=0):(De[3]=Se/(6*Ee)+Re,De[4]=Ee)),De}function I$1z(fe){const{hasZ:ve,totalSize:_e}=fe;if(0===_e)return null;const be=[],we=[],Se=ve?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(fe.reset();fe.nextPath();){const ve=u$3K(n$4p(fe),fe.hasZ,Se);ve&&we.push(ve)}if(we.sort(((fe,_e)=>{let be=fe[2]-_e[2];return 0===be&&ve&&(be=fe[4]-_e[4]),be})),we.length&&(be[0]=we[0][0],be[1]=we[0][1],ve&&(be[2]=we[0][3]),(be[0]<Se[0]||be[0]>Se[1]||be[1]<Se[2]||be[1]>Se[3]||ve&&(be[2]<Se[4]||be[2]>Se[5]))&&(be.length=0)),!be.length){fe.reset(),fe.nextPath();const _e=fe.pathSize?function h$2K(fe){const{hasZ:ve}=fe,_e=ve?[0,0,0]:[0,0],be=ve?[0,0,0]:[0,0];let we=0,Se=0,Te=0,Ee=0;if(fe.nextPoint()){let Ce=fe.x,Oe=fe.y,Re=fe.z;for(;fe.nextPoint();){const De=fe.x,Be=fe.y,Ze=fe.z;_e[0]=Ce,_e[1]=Oe,be[0]=De,be[1]=Be,ve&&(_e[2]=Re,be[2]=Ze);const Xe=i$4p(_e,be);if(Xe){we+=Xe;const fe=c$4B(_e,be);Se+=Xe*fe[0],Te+=Xe*fe[1],ve&&fe.length>2&&(Ee+=Xe*fe[2])}Ce=De,Oe=Be,Re=Ze}}return we>0?ve?[Se/we,Te/we,Ee/we]:[Se/we,Te/we]:fe.pathSize?(fe.seekPathStart(),fe.nextPoint(),[fe.x,fe.y]):null}(fe):null;if(!_e)return null;be[0]=_e[0],be[1]=_e[1],ve&&_e.length>2&&(be[2]=_e[2])}return be}(da=ha||(ha={}))[da.X=0]="X",da[da.Y=1]="Y",da[da.Z=2]="Z";const pa=1/3;function x$1O(fe,ve,_e){if(!fe||!_e||_e.pathSize<3)return null;_e.nextPoint();const be=_e.x,we=_e.y;_e.nextPoint();let Se,Te=_e.x-be,Ee=_e.y-we,Ce=0,Oe=0;for(;_e.nextPoint();)Ce=_e.x-be,Oe=_e.y-we,Se=.5*pa*(Ce*Ee-Oe*Te),fe[0]+=Se*(Te+Ce),fe[1]+=Se*(Ee+Oe),Te=Ce,Ee=Oe;const Re=_e.getCurrentRingArea(),De=[be,we];return De[0]-=ve[0],De[1]-=ve[1],De[0]*=Re,De[1]*=Re,fe[0]+=De[0],fe[1]+=De[1],fe}function u$3J(fe=ya){return[fe[0],fe[1],fe[2],fe[3]]}function i$4n(fe){return[fe[0],fe[1],fe[2],fe[3]]}function e$3R(fe,ve){return fe!==ve&&(fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3]),fe}function a$4j(fe,ve,_e,be,we=u$3J()){return we[0]=fe,we[1]=ve,we[2]=_e,we[3]=be,we}function o$3R(fe,ve=u$3J()){return ve[0]=fe.xmin,ve[1]=fe.ymin,ve[2]=fe.xmax,ve[3]=fe.ymax,ve}function c$4z(fe,ve){return new aa({xmin:fe[0],ymin:fe[1],xmax:fe[2],ymax:fe[3],spatialReference:ve})}function f$31(fe,ve){ve[0]<fe[0]&&(fe[0]=ve[0]),ve[0]>fe[2]&&(fe[2]=ve[0]),ve[1]<fe[1]&&(fe[1]=ve[1]),ve[1]>fe[3]&&(fe[3]=ve[1])}function m$3A(fe,ve,_e){if(null!=ve)if("length"in ve)G$U(ve)?(_e[0]=Math.min(fe[0],ve[0]),_e[1]=Math.min(fe[1],ve[1]),_e[2]=Math.max(fe[2],ve[2]),_e[3]=Math.max(fe[3],ve[3])):2!==ve.length&&3!==ve.length||(_e[0]=Math.min(fe[0],ve[0]),_e[1]=Math.min(fe[1],ve[1]),_e[2]=Math.max(fe[2],ve[0]),_e[3]=Math.max(fe[3],ve[1]));else switch(ve.type){case"extent":_e[0]=Math.min(fe[0],ve.xmin),_e[1]=Math.min(fe[1],ve.ymin),_e[2]=Math.max(fe[2],ve.xmax),_e[3]=Math.max(fe[3],ve.ymax);break;case"point":_e[0]=Math.min(fe[0],ve.x),_e[1]=Math.min(fe[1],ve.y),_e[2]=Math.max(fe[2],ve.x),_e[3]=Math.max(fe[3],ve.y)}else e$3R(_e,fe)}function h$2J(fe,ve,_e=fe){const be=ve.length;let we=fe[0],Se=fe[1],Te=fe[2],Ee=fe[3];for(let Ce=0;Ce<be;Ce++){const fe=ve[Ce];we=Math.min(we,fe[0]),Se=Math.min(Se,fe[1]),Te=Math.max(Te,fe[0]),Ee=Math.max(Ee,fe[1])}return _e[0]=we,_e[1]=Se,_e[2]=Te,_e[3]=Ee,_e}function x$1N(fe){for(let ve=0;ve<4;ve++)if(!isFinite(fe[ve]))return!1;return!0}function M$1o(fe){return null==fe||fe[0]>=fe[2]?0:fe[2]-fe[0]}function s$41(fe){return null==fe||fe[1]>=fe[3]?0:fe[3]-fe[1]}function l$4c(fe){return M$1o(fe)*s$41(fe)}function y$2g(fe){return M$1o(fe)>0&&s$41(fe)>0}function p$4O(fe,ve=[0,0]){return ve[0]=(fe[0]+fe[2])/2,ve[1]=(fe[1]+fe[3])/2,ve}function b$28(fe,ve){return w$1U(fe,ve[0],ve[1])}function g$2o(fe,ve){const _e=ve[3],be=.5*(fe[0]+fe[2]),we=Math.abs(ve[0]-be),Se=.5*(fe[2]-fe[0]);if(we>_e+Se)return!1;const Te=.5*(fe[1]+fe[3]),Ee=.5*(fe[3]-fe[1]),Ce=Math.abs(ve[1]-Te);if(Ce>_e+Ee)return!1;if(we<Se||Ce<Ee)return!0;const Oe=we-Se,Re=Ce-Ee;return Oe*Oe+Re*Re<=_e*_e}function j$1I(fe,ve,_e){const be=fe[0],we=fe[1],Se=fe[2],Te=fe[3],{x:Ee,y:Ce}=ve,{x:Oe,y:Re}=_e,h33=(fe,ve)=>(Re-Ce)*fe+(Ee-Oe)*ve+(Oe*Ce-Ee*Re)<0,De=h33(be,Te),Be=h33(Se,Te),Ze=h33(Se,we),Xe=h33(be,we);return!(De===Be&&Be===Ze&&Ze===Xe&&Xe===De||Ee<be&&Oe<be||Ee>Se&&Oe>Se||Ce>Te&&Re>Te||Ce<we&&Re<we)}function F$17(fe,ve){return w$1U(fe,ve.x,ve.y)}function w$1U(fe,ve,_e){return ve>=fe[0]&&_e>=fe[1]&&ve<=fe[2]&&_e<=fe[3]}function E$1H(fe,ve){return Math.max(ve[0],fe[0])<=Math.min(ve[2],fe[2])&&Math.max(ve[1],fe[1])<=Math.min(ve[3],fe[3])}function R$1e(fe,ve){return ve[0]>=fe[0]&&ve[2]<=fe[2]&&ve[1]>=fe[1]&&ve[3]<=fe[3]}function U$17(fe,ve,_e){if(null==ve)return e$3R(_e,fe);const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3];return _e[0]=e$3Y(fe[0],be,Se),_e[1]=e$3Y(fe[1],we,Te),_e[2]=e$3Y(fe[2],be,Se),_e[3]=e$3Y(fe[3],we,Te),_e}function z$16(fe,ve,_e,be=fe){return be[0]=fe[0]+ve,be[1]=fe[1]+_e,be[2]=fe[2]+ve,be[3]=fe[3]+_e,be}function D$19(fe){return fe?e$3R(fe,ma):u$3J(ma)}function G$U(fe){return null!=fe&&4===fe.length}function I$1y(fe,ve){return G$U(fe)&&G$U(ve)?fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]:fe===ve}const fa=[-1/0,-1/0,1/0,1/0],ma=[1/0,1/0,-1/0,-1/0],ya=[0,0,0,0];function t$3X(fe){return void 0!==fe.xmin&&void 0!==fe.ymin&&void 0!==fe.xmax&&void 0!==fe.ymax}function i$4m(fe){return void 0!==fe.points}function o$3Q(fe){return void 0!==fe.x&&void 0!==fe.y}function e$3Q(fe){return void 0!==fe.paths}function r$3l(fe){return void 0!==fe.rings}function u$3I(fe){return function t84(ve,_e){return null==ve?_e:null==_e?ve:fe(ve,_e)}}const ga=u$3I(Math.min),va=u$3I(Math.max);function a$4i(fe,ve){return e$3Q(ve)?x$1M(fe,ve.paths,!1,!1):r$3l(ve)?x$1M(fe,ve.rings,!1,!1):i$4m(ve)?g$2n(fe,ve.points,!1,!1,!1,!1):t$3X(ve)?s$40(fe,ve):(o$3Q(ve)&&(fe[0]=ve.x,fe[1]=ve.y,fe[2]=ve.x,fe[3]=ve.y),fe)}function c$4y(fe){let ve,_e,be,we;for(fe.reset(),ve=be=1/0,_e=we=-1/0;fe.nextPath();){const Se=f$30(fe);ve=Math.min(Se[0],ve),be=Math.min(Se[1],be),_e=Math.max(Se[2],_e),we=Math.max(Se[3],we)}return u$3J([ve,be,_e,we])}function f$30(fe){let ve,_e,be,we;for(ve=be=1/0,_e=we=-1/0;fe.nextPoint();)ve=Math.min(fe.x,ve),be=Math.min(fe.y,be),_e=Math.max(fe.x,_e),we=Math.max(fe.y,we);return u$3J([ve,be,_e,we])}function m$3z(fe,ve){return e$3Q(ve)?x$1M(fe,ve.paths,!0,!1):r$3l(ve)?x$1M(fe,ve.rings,!0,!1):i$4m(ve)?g$2n(fe,ve.points,!0,!1,!0,!1):t$3X(ve)?s$40(fe,ve,!0,!1,!0,!1):(o$3Q(ve)&&(fe[0]=ve.x,fe[1]=ve.y,fe[2]=ve.z,fe[3]=ve.x,fe[4]=ve.y,fe[5]=ve.z),fe)}function x$1M(fe,ve,_e,be){const we=_e?3:2;if(!ve.length||!ve[0].length)return null;let Se,Te,Ee,Ce,[Oe,Re]=ve[0][0],[De,Be]=ve[0][0];for(let Ze=0;Ze<ve.length;Ze++){const fe=ve[Ze];for(let ve=0;ve<fe.length;ve++){const Ze=fe[ve],[Xe,Je]=Ze;if(Oe=ga(Oe,Xe),Re=ga(Re,Je),De=va(De,Xe),Be=va(Be,Je),_e&&Ze.length>2){const fe=Ze[2];Se=ga(Se,fe),Te=va(Te,fe)}if(be&&Ze.length>we){const fe=Ze[we];Ee=ga(Se,fe),Ce=va(Te,fe)}}}return _e?be?(fe[0]=Oe,fe[1]=Re,fe[2]=Se,fe[3]=Ee,fe[4]=De,fe[5]=Be,fe[6]=Te,fe[7]=Ce,fe.length=8,fe):(fe[0]=Oe,fe[1]=Re,fe[2]=Se,fe[3]=De,fe[4]=Be,fe[5]=Te,fe.length=6,fe):be?(fe[0]=Oe,fe[1]=Re,fe[2]=Ee,fe[3]=De,fe[4]=Be,fe[5]=Ce,fe.length=6,fe):(fe[0]=Oe,fe[1]=Re,fe[2]=De,fe[3]=Be,fe.length=4,fe)}function s$40(fe,ve,_e,be,we,Se){const Te=ve.xmin,Ee=ve.xmax,Ce=ve.ymin,Oe=ve.ymax;let Re=ve.zmin,De=ve.zmax,Be=ve.mmin,Ze=ve.mmax;return we?(Re=Re||0,De=De||0,Se?(Be=Be||0,Ze=Ze||0,fe[0]=Te,fe[1]=Ce,fe[2]=Re,fe[3]=Be,fe[4]=Ee,fe[5]=Oe,fe[6]=De,fe[7]=Ze,fe):(fe[0]=Te,fe[1]=Ce,fe[2]=Re,fe[3]=Ee,fe[4]=Oe,fe[5]=De,fe)):Se?(Be=Be||0,Ze=Ze||0,fe[0]=Te,fe[1]=Ce,fe[2]=Be,fe[3]=Ee,fe[4]=Oe,fe[5]=Ze,fe):(fe[0]=Te,fe[1]=Ce,fe[2]=Ee,fe[3]=Oe,fe)}function g$2n(fe,ve,_e,be,we,Se){const Te=_e?3:2,Ee=be&&Se,Ce=_e&&we;if(!ve.length||!ve[0].length)return null;let Oe,Re,De,Be,[Ze,Xe]=ve[0],[Je,Qe]=ve[0];for(let dt=0;dt<ve.length;dt++){const fe=ve[dt],[_e,be]=fe;if(Ze=ga(Ze,_e),Xe=ga(Xe,be),Je=va(Je,_e),Qe=va(Qe,be),Ce&&fe.length>2){const ve=fe[2];Oe=ga(Oe,ve),Re=va(Re,ve)}if(Ee&&fe.length>Te){const ve=fe[Te];De=ga(Oe,ve),Be=va(Re,ve)}}return we?(Oe=Oe||0,Re=Re||0,Se?(De=De||0,Be=Be||0,fe[0]=Ze,fe[1]=Xe,fe[2]=Oe,fe[3]=De,fe[4]=Je,fe[5]=Qe,fe[6]=Re,fe[7]=Be,fe):(fe[0]=Ze,fe[1]=Xe,fe[2]=Oe,fe[3]=Je,fe[4]=Qe,fe[5]=Re,fe)):Se?(De=De||0,Be=Be||0,fe[0]=Ze,fe[1]=Xe,fe[2]=De,fe[3]=Je,fe[4]=Qe,fe[5]=Be,fe):(fe[0]=Ze,fe[1]=Xe,fe[2]=Je,fe[3]=Qe,fe)}const _a=[];function a$4h(fe,ve,_e,be){return{xmin:fe,ymin:ve,xmax:_e,ymax:be}}function c$4x(fe,ve,_e,be,we,Se){return{xmin:fe,ymin:ve,zmin:_e,xmax:be,ymax:we,zmax:Se}}function s$3$(fe,ve,_e,be,we,Se){return{xmin:fe,ymin:ve,mmin:_e,xmax:be,ymax:we,mmax:Se}}function e$3P(fe,ve,_e,be,we,Se,Te,Ee){return{xmin:fe,ymin:ve,zmin:_e,mmin:be,xmax:we,ymax:Se,zmax:Te,mmax:Ee}}function f$2$(fe,ve=!1,_e=!1){return ve?_e?e$3P(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5],fe[6],fe[7]):c$4x(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]):_e?s$3$(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]):a$4h(fe[0],fe[1],fe[2],fe[3])}function l$4a(fe){return fe?function t$3W(fe){return void 0!==fe.xmin&&void 0!==fe.ymin&&void 0!==fe.xmax&&void 0!==fe.ymax}(fe)?fe:function m$3y(fe){return void 0!==fe.x&&void 0!==fe.y}(fe)?function d$3h(fe){const{x:ve,y:_e,z:be,m:we}=fe,Se=null!=we;return null!=be?Se?e$3P(ve,_e,be,we,ve,_e,be,we):c$4x(ve,_e,be,ve,_e,be):Se?s$3$(ve,_e,we,ve,_e,we):a$4h(ve,_e,ve,_e)}(fe):function r$3k(fe){return void 0!==fe.rings}(fe)?v$1_(fe):function o$3P(fe){return void 0!==fe.paths}(fe)?h$2H(fe):function u$3H(fe){return void 0!==fe.points}(fe)?function y$2f(fe){const{hasZ:ve,hasM:_e,points:be}=fe;return f$2$(g$2n(_a,be,ve??!1,_e??!1),ve,_e)}(fe):null:null}function v$1_(fe){const{hasZ:ve,hasM:_e,rings:be}=fe,we=x$1M(_a,be,ve??!1,_e??!1);return we?f$2$(we,ve,_e):null}function h$2H(fe){const{hasZ:ve,hasM:_e,paths:be}=fe,we=x$1M(_a,be,ve??!1,_e??!1);return we?f$2$(we,ve,_e):null}var $a;function R$1d(fe){return!Array.isArray(fe[0])}let ba=$a=class extends Uo{static fromExtent(fe){const ve=fe.clone().normalize(),_e=fe.spatialReference;let be=!1,we=!1;for(const Te of ve)Te.hasZ&&(be=!0),Te.hasM&&(we=!0);const Se={rings:ve.map((fe=>{const ve=[[fe.xmin,fe.ymin],[fe.xmin,fe.ymax],[fe.xmax,fe.ymax],[fe.xmax,fe.ymin],[fe.xmin,fe.ymin]];if(be&&fe.hasZ){const _e=fe.zmin+.5*(fe.zmax-fe.zmin);for(let fe=0;fe<ve.length;fe++)ve[fe].push(_e)}if(we&&fe.hasM){const _e=fe.mmin+.5*(fe.mmax-fe.mmin);for(let fe=0;fe<ve.length;fe++)ve[fe].push(_e)}return ve})),spatialReference:_e};return be&&(Se.hasZ=!0),we&&(Se.hasM=!0),new $a(Se)}constructor(...fe){super(...fe),this.rings=[],this.type="polygon"}normalizeCtorArgs(fe,ve){var _e,be;let we,Se,Te=null,Ee=null;return fe&&!Array.isArray(fe)?(Te=fe.rings??null,ve||(fe.spatialReference?ve=fe.spatialReference:fe.rings||(ve=fe)),we=fe.hasZ,Se=fe.hasM):Te=fe,Te=Te||[],ve=ve||zo.WGS84,Te.length&&null!=(null==(_e=Te[0])?void 0:_e[0])&&"number"==typeof Te[0][0]&&(Te=[Te]),Ee=null==(be=Te[0])?void 0:be[0],Ee&&(void 0===we&&void 0===Se?(we=Ee.length>2,Se=Ee.length>3):void 0===we?we=Se?Ee.length>3:Ee.length>2:void 0===Se&&(Se=we?Ee.length>3:Ee.length>2)),{rings:Te,spatialReference:ve,hasZ:we,hasM:Se}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const fe=l$4d(this);if(!fe||isNaN(fe[0])||isNaN(fe[1])||this.hasZ&&isNaN(fe[2]))return null;const ve=new Yo;return ve.x=fe[0],ve.y=fe[1],ve.spatialReference=this.spatialReference,this.hasZ&&(ve.z=fe[2]),ve}get extent(){const{spatialReference:fe}=this,ve=v$1_(this);if(!ve)return null;const _e=new aa(ve);return _e.spatialReference=fe,_e}get isSelfIntersecting(){return function p$4Q(fe){for(let ve=0;ve<fe.length;ve++){const _e=fe[ve];for(let we=0;we<_e.length-1;we++){const be=_e[we],Se=_e[we+1];for(let _e=ve+1;_e<fe.length;_e++)for(let ve=0;ve<fe[_e].length-1;ve++){const we=fe[_e][ve],Te=fe[_e][ve+1];if(G$V(be,Se,we,Te,na)&&!(na[0]===be[0]&&na[1]===be[1]||na[0]===we[0]&&na[1]===we[1]||na[0]===Se[0]&&na[1]===Se[1]||na[0]===Te[0]&&na[1]===Te[1]))return!0}}const be=_e.length;if(!(be<=4))for(let fe=0;fe<be-3;fe++){let ve=be-1;0===fe&&(ve=be-2);const we=_e[fe],Se=_e[fe+1];for(let be=fe+2;be<ve;be++){const fe=_e[be],ve=_e[be+1];if(G$V(we,Se,fe,ve,na)&&!(na[0]===we[0]&&na[1]===we[1]||na[0]===fe[0]&&na[1]===fe[1]||na[0]===Se[0]&&na[1]===Se[1]||na[0]===ve[0]&&na[1]===ve[1]))return!0}}}return!1}(this.rings)}writeRings(fe,ve){ve.rings=a$4H(this.rings)}addRing(fe){if(!fe)return;const ve=this.rings,_e=ve.length;if(R$1d(fe)){const be=[];for(let ve=0,_e=fe.length;ve<_e;ve++)be[ve]=fe[ve].toArray();ve[_e]=be}else ve[_e]=fe.concat();return this.notifyChange("rings"),this}clone(){const fe=new $a;return fe.spatialReference=this.spatialReference,fe.rings=a$4H(this.rings),fe.hasZ=this.hasZ,fe.hasM=this.hasM,fe}equals(fe){if(this===fe)return!0;if(null==fe)return!1;const ve=this.spatialReference,_e=fe.spatialReference;if(null!=ve!=(null!=_e))return!1;if(null!=ve&&null!=_e&&!ve.equals(_e))return!1;if(this.rings.length!==fe.rings.length)return!1;const n52=([fe,ve,_e,be],[we,Se,Te,Ee])=>fe===we&&ve===Se&&(null==_e&&null==Te||_e===Te)&&(null==be&&null==Ee||be===Ee);for(let be=0;be<this.rings.length;be++){if(!h$30(this.rings[be],fe.rings[be],n52))return!1}return!0}contains(fe){if(!fe)return!1;const ve=g$2s(fe,this.spatialReference);return f$36(this,null!=ve?ve:fe)}isClockwise(fe){return a$4k(R$1d(fe)?fe.map((fe=>this.hasZ?this.hasM?[fe.x,fe.y,fe.z,fe.m]:[fe.x,fe.y,fe.z]:[fe.x,fe.y])):fe)}getPoint(fe,ve){if(!this._validateInputs(fe,ve))return null;const _e=this.rings[fe][ve],be=this.hasZ,we=this.hasM;return be&&!we?new Yo(_e[0],_e[1],_e[2],void 0,this.spatialReference):we&&!be?new Yo(_e[0],_e[1],void 0,_e[2],this.spatialReference):be&&we?new Yo(_e[0],_e[1],_e[2],_e[3],this.spatialReference):new Yo(_e[0],_e[1],this.spatialReference)}insertPoint(fe,ve,_e){return this._validateInputs(fe,ve,!0)?(h$2N(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.rings[fe].splice(ve,0,_e),this.notifyChange("rings"),this):this}removePoint(fe,ve){if(!this._validateInputs(fe,ve))return null;const _e=new Yo(this.rings[fe].splice(ve,1)[0],this.spatialReference);return this.notifyChange("rings"),_e}removeRing(fe){if(!this._validateInputs(fe,null))return null;const ve=this.rings.splice(fe,1)[0],_e=this.spatialReference,be=ve.map((fe=>new Yo(fe,_e)));return this.notifyChange("rings"),be}setPoint(fe,ve,_e){return this._validateInputs(fe,ve)?(h$2N(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.rings[fe][ve]=_e,this.notifyChange("rings"),this):this}_validateInputs(fe,ve,_e=!1){if(null==fe||fe<0||fe>=this.rings.length)return!1;if(null!=ve){const be=this.rings[fe];if(_e&&(ve<0||ve>be.length))return!1;if(!_e&&(ve<0||ve>=be.length))return!1}return!0}toJSON(fe){return this.write({},fe)}};e$4o([y$2v({readOnly:!0})],ba.prototype,"cache",null),e$4o([y$2v({readOnly:!0})],ba.prototype,"centroid",null),e$4o([y$2v({readOnly:!0})],ba.prototype,"extent",null),e$4o([y$2v({readOnly:!0})],ba.prototype,"isSelfIntersecting",null),e$4o([y$2v({type:[[[Number]]],json:{write:{isRequired:!0}}})],ba.prototype,"rings",void 0),e$4o([r$3s("rings")],ba.prototype,"writeRings",null),ba=$a=e$4o([a$4y("esri.geometry.Polygon")],ba),ba.prototype.toJSON.isDefaultToJSON=!0;const wa=ba;var xa;let Sa=xa=class extends Uo{constructor(...fe){super(...fe),this.paths=[],this.type="polyline"}normalizeCtorArgs(fe,ve){var _e,be;let we,Se,Te=null,Ee=null;return fe&&!Array.isArray(fe)?(Te=fe.paths??null,ve||(fe.spatialReference?ve=fe.spatialReference:fe.paths||(ve=fe)),we=fe.hasZ,Se=fe.hasM):Te=fe,Te=Te||[],ve=ve||zo.WGS84,Te.length&&null!=(null==(_e=Te[0])?void 0:_e[0])&&"number"==typeof Te[0][0]&&(Te=[Te]),Ee=null==(be=Te[0])?void 0:be[0],Ee&&(void 0===we&&void 0===Se?(we=Ee.length>2,Se=!1):void 0===we?we=!Se&&Ee.length>3:void 0===Se&&(Se=!we&&Ee.length>3)),{paths:Te,spatialReference:ve,hasZ:we,hasM:Se}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:fe}=this,ve=h$2H(this);if(!ve)return null;const _e=new aa(ve);return _e.spatialReference=fe,_e}writePaths(fe,ve){ve.paths=a$4H(this.paths)}addPath(fe){if(!fe)return;const ve=this.paths,_e=ve.length;if(function u$3G(fe){return!Array.isArray(fe[0])}(fe)){const be=[];for(let ve=0,_e=fe.length;ve<_e;ve++)be[ve]=fe[ve].toArray();ve[_e]=be}else ve[_e]=fe.concat();return this.notifyChange("paths"),this}clone(){const fe=new xa;return fe.spatialReference=this.spatialReference,fe.paths=a$4H(this.paths),fe.hasZ=this.hasZ,fe.hasM=this.hasM,fe}getPoint(fe,ve){if(!this._validateInputs(fe,ve))return null;const _e=this.paths[fe][ve],be=this.hasZ,we=this.hasM;return be&&!we?new Yo(_e[0],_e[1],_e[2],void 0,this.spatialReference):we&&!be?new Yo(_e[0],_e[1],void 0,_e[2],this.spatialReference):be&&we?new Yo(_e[0],_e[1],_e[2],_e[3],this.spatialReference):new Yo(_e[0],_e[1],this.spatialReference)}insertPoint(fe,ve,_e){return this._validateInputs(fe,ve,!0)?(h$2N(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.paths[fe].splice(ve,0,_e),this.notifyChange("paths"),this):this}removePath(fe){if(!this._validateInputs(fe,null))return null;const ve=this.paths.splice(fe,1)[0],_e=this.spatialReference,be=ve.map((fe=>new Yo(fe,_e)));return this.notifyChange("paths"),be}removePoint(fe,ve){if(!this._validateInputs(fe,ve))return null;const _e=new Yo(this.paths[fe].splice(ve,1)[0],this.spatialReference);return this.notifyChange("paths"),_e}setPoint(fe,ve,_e){return this._validateInputs(fe,ve)?(h$2N(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.paths[fe][ve]=_e,this.notifyChange("paths"),this):this}_validateInputs(fe,ve,_e=!1){if(null==fe||fe<0||fe>=this.paths.length)return!1;if(null!=ve){const be=this.paths[fe];if(_e&&(ve<0||ve>be.length))return!1;if(!_e&&(ve<0||ve>=be.length))return!1}return!0}toJSON(fe){return this.write({},fe)}};e$4o([y$2v({readOnly:!0})],Sa.prototype,"cache",null),e$4o([y$2v({readOnly:!0})],Sa.prototype,"extent",null),e$4o([y$2v({type:[[[Number]]],json:{write:{isRequired:!0}}})],Sa.prototype,"paths",void 0),e$4o([r$3s("paths")],Sa.prototype,"writePaths",null),Sa=xa=e$4o([a$4y("esri.geometry.Polyline")],Sa),Sa.prototype.toJSON.isDefaultToJSON=!0;const Ta=Sa,Ea=i$4y()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Pa=i$4y()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function m$3w(fe){return void 0!==fe.xmin&&void 0!==fe.ymin&&void 0!==fe.xmax&&void 0!==fe.ymax}function l$49(fe){return void 0!==fe.points}function u$3F(fe){return void 0!==fe.x&&void 0!==fe.y}function s$3_(fe){return void 0!==fe.paths}function f$2Z(fe){return void 0!==fe.rings}function y$2e(fe){return null==fe?null:fe instanceof Uo?fe:u$3F(fe)?Yo.fromJSON(fe):s$3_(fe)?Ta.fromJSON(fe):f$2Z(fe)?wa.fromJSON(fe):l$49(fe)?ua.fromJSON(fe):m$3w(fe)?aa.fromJSON(fe):null}function p$4N(fe){return fe?u$3F(fe)?"esriGeometryPoint":s$3_(fe)?"esriGeometryPolyline":f$2Z(fe)?"esriGeometryPolygon":m$3w(fe)?"esriGeometryEnvelope":l$49(fe)?"esriGeometryMultipoint":null:null}const Ca={esriGeometryPoint:Yo,esriGeometryPolyline:Ta,esriGeometryPolygon:wa,esriGeometryEnvelope:aa,esriGeometryMultipoint:ua};const Oa={base:Uo,key:"type",typeMap:{extent:aa,multipoint:ua,point:Yo,polyline:Ta,polygon:wa}};var Aa;T$1p(Oa);let Ma=Aa=class extends Pn{constructor(fe){super(fe),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(fe){return(fe%=360)<0&&(fe+=360),fe}clone(){return new Aa({rotation:this.rotation,scale:this.scale,targetGeometry:null!=this.targetGeometry?this.targetGeometry.clone():null,camera:null!=this.camera?this.camera.clone():null})}};e$4o([y$2v({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:l$48}}}}})],Ma.prototype,"rotation",void 0),e$4o([s$4b("rotation")],Ma.prototype,"castRotation",null),e$4o([y$2v({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:l$48}}}}})],Ma.prototype,"scale",void 0),e$4o([y$2v({types:Oa,json:{read:y$2e,write:!0,origins:{"web-scene":{read:y$2e,write:{overridePolicy:l$48}}}}})],Ma.prototype,"targetGeometry",void 0),e$4o([y$2v({type:Xo,json:{write:!0}})],Ma.prototype,"camera",void 0),Ma=Aa=e$4o([a$4y("esri.Viewpoint")],Ma);const Ra=Ma;function l$48(){return{enabled:!this.camera}}let Ia=class i3{constructor(){this._emitter=new i3.EventEmitter(this)}emit(fe,ve){return this._emitter.emit(fe,ve)}on(fe,ve){return this._emitter.on(fe,ve)}once(fe,ve){return this._emitter.once(fe,ve)}hasEventListener(fe){return this._emitter.hasEventListener(fe)}};!function(fe){class c50{constructor(fe=null){this._target=fe,this._listenersMap=null}clear(){var fe;null==(fe=this._listenersMap)||fe.clear(),this._listenersMap=null}destroy(){this.clear()}emit(fe,ve){var _e;let be=null==(_e=this._listenersMap)?void 0:_e.get(fe);if(!be)return!1;const we=this._target||this;let Se=!1;for(const Te of be.slice()){const fe="deref"in Te?Te.deref():Te;fe?null==fe||fe.call(we,ve):Se=!0}return Se&&(be=be.filter((fe=>!("deref"in fe)||null!=fe.deref())),this._listenersMap.set(fe,be)),be.length>0}on(fe,ve){if(Array.isArray(fe)){return o$4o(fe.map((fe=>this.on(fe,ve))))}if(fe.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const _e=this._listenersMap.get(fe)||[];return _e.push(ve),this._listenersMap.set(fe,_e),e$4e((()=>{var _e;const be=null==(_e=this._listenersMap)?void 0:_e.get(fe),we=(null==be?void 0:be.indexOf(ve))??-1;we>=0&&be.splice(we,1)}))}once(fe,ve){const _e=this.on(fe,(fe=>{_e.remove();const be="deref"in ve?ve.deref():ve;null==be||be.call(null,fe)}));return _e}hasEventListener(fe){var ve;const _e=null==(ve=this._listenersMap)?void 0:ve.get(fe);return null!=_e&&_e.length>0}}fe.EventEmitter=c50,fe.EventedMixin=fe=>{let ve=class extends fe{constructor(){super(...arguments),this._emitter=new c50}destroy(){this._emitter.clear()}emit(fe,ve){return this._emitter.emit(fe,ve)}on(fe,ve){return this._emitter.on(fe,ve)}once(fe,ve){return this._emitter.once(fe,ve)}hasEventListener(fe){return this._emitter.hasEventListener(fe)}};return ve=e$4o([a$4y("esri.core.Evented")],ve),ve};let ve=class extends zi{constructor(){super(...arguments),this._emitter=new Ia.EventEmitter(this)}destroy(){this._emitter.clear()}emit(fe,ve){return this._emitter.emit(fe,ve)}on(fe,ve){return this._emitter.on(fe,ve)}once(fe,ve){return this._emitter.once(fe,ve)}hasEventListener(fe){return this._emitter.hasEventListener(fe)}};ve=e$4o([a$4y("esri.core.Evented.EventedAccessor")],ve),fe.EventedAccessor=ve}(Ia||(Ia={}));const La=Ia;var Da,Na;function n$4l(fe){return(ve,_e)=>{ve[_e]=fe}}(Na=Da||(Da={}))[Na.ADD=1]="ADD",Na[Na.REMOVE=2]="REMOVE",Na[Na.MOVE=4]="MOVE";let Fa=class s8 extends mr{notify(){const fe=this._observers;if(fe&&fe.length>0){const ve=fe.slice();for(const fe of ve)fe.onInvalidated(),fe.onCommitted()}}};var za;let ka=class p{constructor(fe,ve,_e,be,we){this.target=fe,this.added=ve,this.removed=_e,this.start=be,this.deleteCount=we}};const Ua=new pr(class d2{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(fe){this.defaultPrevented=!1,this.item=fe}},void 0,(fe=>{fe.item=null,fe.target=null,fe.defaultPrevented=!1,fe.cancellable=!1}));function v$1Y(fe){fe&&"object"==typeof fe&&"destroy"in fe&&"function"==typeof fe.destroy&&fe.destroy()}function y$2d(fe){return fe?fe instanceof qa?fe.toArray():fe.length?Array.prototype.slice.apply(fe):[]:[]}function E$1F(fe){if(null==fe?void 0:fe.length)return fe[0]}function A$1y(fe,ve,_e,be){const we=Math.min(fe.length-_e,ve.length-be);let Se=0;for(;Se<we&&fe[_e+Se]===ve[be+Se];)Se++;return Se}function C$1o(fe,ve,_e,be){ve&&ve.forEach(((ve,we,Se)=>{fe.push(ve),C$1o(fe,_e.call(be,ve,we,Se),_e,be)}))}const Va=new Set,Ba=new Set,ja=new Set,Ga=new Map;let Ha=0,qa=za=class extends La.EventedAccessor{static isCollection(fe){return null!=fe&&fe instanceof za}constructor(fe){super(fe),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new Fa,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:Ha++})}normalizeCtorArgs(fe){return fe?Array.isArray(fe)||fe instanceof za?{items:fe}:fe:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return s$4u(this._observable),this._items}set items(fe){this._emitBeforeChanges(Da.ADD)||(this._splice(0,this.length,y$2d(fe)),this._emitAfterChanges(Da.ADD))}hasEventListener(fe){return!this.destroyed&&("change"===fe?this._chgListeners.length>0:this._emitter.hasEventListener(fe))}on(fe,ve){if(this.destroyed)return e$4e();if("change"===fe){const fe=this._chgListeners,_e={removed:!1,callback:ve};return fe.push(_e),this._notifications&&this._notifications.push({listeners:fe.slice(),items:this._items.slice(),changes:[]}),e$4e((()=>{_e.removed=!0,fe.splice(fe.indexOf(_e),1)}))}return this._emitter.on(fe,ve)}once(fe,ve){const _e="deref"in ve?()=>ve.deref():()=>ve,be=this.on(fe,(fe=>{var ve;null==(ve=_e())||ve.call(null,fe),be.remove()}));return be}add(fe,ve){if(s$4u(this._observable),this._emitBeforeChanges(Da.ADD))return this;const _e=this.getNextIndex(ve??null);return this._splice(_e,0,[fe]),this._emitAfterChanges(Da.ADD),this}addMany(fe,ve=this._items.length){if(s$4u(this._observable),!(null==fe?void 0:fe.length))return this;if(this._emitBeforeChanges(Da.ADD))return this;const _e=this.getNextIndex(ve);return this._splice(_e,0,y$2d(fe)),this._emitAfterChanges(Da.ADD),this}at(fe){if(s$4u(this._observable),(fe=Math.trunc(fe)||0)<0&&(fe+=this.length),!(fe<0||fe>=this.length))return this._items[fe]}removeAll(){if(s$4u(this._observable),!this.length||this._emitBeforeChanges(Da.REMOVE))return[];const fe=this._removeAllRaw();return this._emitAfterChanges(Da.REMOVE),fe}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return s$4u(this._observable),this._createNewInstance({items:this._items.map(a$4H)})}concat(...fe){s$4u(this._observable);const ve=fe.map(y$2d);return this._createNewInstance({items:this._items.concat(...ve)})}drain(fe,ve){if(s$4u(this._observable),!this.length||this._emitBeforeChanges(Da.REMOVE))return;const _e=this._splice(0,this.length),be=_e.length;for(let we=0;we<be;we++)fe.call(ve,_e[we],we,_e);this._emitAfterChanges(Da.REMOVE)}destroyAll(){this.drain(v$1Y)}destroyMany(fe){const ve=this.removeMany(fe);return ve.forEach(v$1Y),ve}every(fe,ve){return s$4u(this._observable),this._items.every(fe,ve)}filter(fe,ve){let _e;return s$4u(this._observable),_e=2===arguments.length?this._items.filter(fe,ve):this._items.filter(fe),this._createNewInstance({items:_e})}find(fe,ve){return s$4u(this._observable),this._items.find(fe,ve)}findIndex(fe,ve){return s$4u(this._observable),this._items.findIndex(fe,ve)}flatten(fe,ve){s$4u(this._observable);const _e=[];return C$1o(_e,this,fe,ve),new za(_e)}forEach(fe,ve){return s$4u(this._observable),this._items.forEach(fe,ve)}getItemAt(fe){return s$4u(this._observable),this._items[fe]}getNextIndex(fe){s$4u(this._observable);const ve=this.length;return(fe=fe??ve)<0?fe=0:fe>ve&&(fe=ve),fe}includes(fe,ve=0){return s$4u(this._observable),this._items.includes(fe,ve)}indexOf(fe,ve=0){return s$4u(this._observable),this._items.indexOf(fe,ve)}join(fe=","){return s$4u(this._observable),this._items.join(fe)}lastIndexOf(fe,ve=this.length-1){return s$4u(this._observable),this._items.lastIndexOf(fe,ve)}map(fe,ve){s$4u(this._observable);const _e=this._items.map(fe,ve);return new za({items:_e})}reorder(fe,ve=this.length-1){s$4u(this._observable);const _e=this.indexOf(fe);if(-1!==_e){if(ve<0?ve=0:ve>=this.length&&(ve=this.length-1),_e!==ve){if(this._emitBeforeChanges(Da.MOVE))return fe;this._splice(_e,1),this._splice(ve,0,[fe]),this._emitAfterChanges(Da.MOVE)}return fe}}pop(){if(s$4u(this._observable),!this.length||this._emitBeforeChanges(Da.REMOVE))return;const fe=E$1F(this._splice(this.length-1,1));return this._emitAfterChanges(Da.REMOVE),fe}push(...fe){return s$4u(this._observable),this._emitBeforeChanges(Da.ADD)||(this._splice(this.length,0,fe),this._emitAfterChanges(Da.ADD)),this.length}reduce(fe,ve){s$4u(this._observable);const _e=this._items;return 2===arguments.length?_e.reduce(fe,ve):_e.reduce(fe)}reduceRight(fe,ve){s$4u(this._observable);const _e=this._items;return 2===arguments.length?_e.reduceRight(fe,ve):_e.reduceRight(fe)}remove(fe){return s$4u(this._observable),this.removeAt(this.indexOf(fe))}removeAt(fe){if(s$4u(this._observable),fe<0||fe>=this.length||this._emitBeforeChanges(Da.REMOVE))return;const ve=E$1F(this._splice(fe,1));return this._emitAfterChanges(Da.REMOVE),ve}removeMany(fe){if(s$4u(this._observable),!(null==fe?void 0:fe.length)||this._emitBeforeChanges(Da.REMOVE))return[];const ve=fe instanceof za?fe.toArray():fe,_e=this._items,be=[],we=ve.length;for(let Se=0;Se<we;Se++){const fe=ve[Se],we=_e.indexOf(fe);if(we>-1){const fe=1+A$1y(ve,_e,Se+1,we+1),Te=this._splice(we,fe);Te&&Te.length>0&&be.push.apply(be,Te),Se+=fe-1}}return this._emitAfterChanges(Da.REMOVE),be}reverse(){if(s$4u(this._observable),this._emitBeforeChanges(Da.MOVE))return this;const fe=this._splice(0,this.length);return fe&&(fe.reverse(),this._splice(0,0,fe)),this._emitAfterChanges(Da.MOVE),this}shift(){if(s$4u(this._observable),!this.length||this._emitBeforeChanges(Da.REMOVE))return;const fe=E$1F(this._splice(0,1));return this._emitAfterChanges(Da.REMOVE),fe}slice(fe=0,ve=this.length){return s$4u(this._observable),this._createNewInstance({items:this._items.slice(fe,ve)})}some(fe,ve){return s$4u(this._observable),this._items.some(fe,ve)}sort(fe){if(s$4u(this._observable),!this.length||this._emitBeforeChanges(Da.MOVE))return this;const ve=this._splice(0,this.length);return arguments.length?ve.sort(fe):ve.sort(),this._splice(0,0,ve),this._emitAfterChanges(Da.MOVE),this}splice(fe,ve,..._e){s$4u(this._observable);const be=(ve?Da.REMOVE:0)|(_e.length?Da.ADD:0);if(this._emitBeforeChanges(be))return[];const we=this._splice(fe,ve,_e)||[];return this._emitAfterChanges(be),we}toArray(){return s$4u(this._observable),this._items.slice()}toJSON(){return s$4u(this._observable),this.toArray()}toLocaleString(){return s$4u(this._observable),this._items.toLocaleString()}toString(){return s$4u(this._observable),this._items.toString()}unshift(...fe){return s$4u(this._observable),!fe.length||this._emitBeforeChanges(Da.ADD)||(this._splice(0,0,fe),this._emitAfterChanges(Da.ADD)),this.length}_createNewInstance(fe){return new this.constructor(fe)}_splice(fe,ve,_e){const be=this._items,we=this.itemType;let Se,Te;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=v$27((()=>this._dispatchChange()))),fe<0&&(fe+=this.length),ve){if(Te=be.splice(fe,ve),this.hasEventListener("before-remove")){const ve=Ua.acquire();ve.target=this,ve.cancellable=!0;for(let _e=0,we=Te.length;_e<we;_e++)Se=Te[_e],ve.reset(Se),this.emit("before-remove",ve),ve.defaultPrevented&&(Te.splice(_e,1),be.splice(fe,0,Se),fe+=1,_e-=1,we-=1);Ua.release(ve)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const fe=Ua.acquire();fe.target=this,fe.cancellable=!1;const ve=Te.length;for(let _e=0;_e<ve;_e++)fe.reset(Te[_e]),this.emit("after-remove",fe);Ua.release(fe)}}if(null==_e?void 0:_e.length){if(we){const fe=[];for(const ve of _e){const _e=we.ensureType(ve);null==_e&&null!=ve||fe.push(_e)}_e=fe}const ve=this.hasEventListener("before-add"),Se=this.hasEventListener("after-add"),Te=fe===this.length;if(ve||Se){const we=Ua.acquire();we.target=this,we.cancellable=!0;const Ee=Ua.acquire();Ee.target=this,Ee.cancellable=!1;for(const Ce of _e)ve?(we.reset(Ce),this.emit("before-add",we),we.defaultPrevented||(Te?be.push(Ce):be.splice(fe++,0,Ce),this._set("length",be.length),Se&&(Ee.reset(Ce),this.emit("after-add",Ee)))):(Te?be.push(Ce):be.splice(fe++,0,Ce),this._set("length",be.length),Ee.reset(Ce),this.emit("after-add",Ee));Ua.release(Ee),Ua.release(we)}else{if(Te)for(const fe of _e)be.push(fe);else be.splice(fe,0,..._e);this._set("length",be.length)}}if(((null==_e?void 0:_e.length)||(null==Te?void 0:Te.length))&&this._notifyChangeEvent(_e,Te),this.hasEventListener("after-splice")){const be=new ka(this,_e,Te,fe,ve);this.emit("after-splice",be)}return Te}_emitBeforeChanges(fe){let ve=!1;if(this.hasEventListener("before-changes")){const _e=Ua.acquire();_e.target=this,_e.cancellable=!0,_e.type=fe,this.emit("before-changes",_e),ve=_e.defaultPrevented,Ua.release(_e)}return ve}_emitAfterChanges(fe){if(this.hasEventListener("after-changes")){const ve=Ua.acquire();ve.target=this,ve.cancellable=!1,ve.type=fe,this.emit("after-changes",ve),Ua.release(ve)}this._observable.notify()}_notifyChangeEvent(fe,ve){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:fe,removed:ve})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const fe=this._notifications;this._notifications=null;for(const ve of fe){const fe=ve.changes;Va.clear(),Ba.clear(),ja.clear();for(const{added:ve,removed:Ee}of fe){if(ve)if(0===ja.size&&0===Ba.size)for(const fe of ve)Va.add(fe);else for(const fe of ve)Ba.has(fe)?(ja.add(fe),Ba.delete(fe)):ja.has(fe)||Va.add(fe);if(Ee)if(0===ja.size&&0===Va.size)for(const fe of Ee)Ba.add(fe);else for(const fe of Ee)Va.has(fe)?Va.delete(fe):(ja.delete(fe),Ba.add(fe))}const _e=Nr.acquire();Va.forEach((fe=>{_e.push(fe)}));const be=Nr.acquire();Ba.forEach((fe=>{be.push(fe)}));const we=this._items,Se=ve.items,Te=Nr.acquire();if(ja.forEach((fe=>{Se.indexOf(fe)!==we.indexOf(fe)&&Te.push(fe)})),ve.listeners&&(_e.length||be.length||Te.length)){const fe={target:this,added:_e,removed:be,moved:Te},we=ve.listeners.length;for(let _e=0;_e<we;_e++){const be=ve.listeners[_e];be.removed||be.callback.call(this,fe)}}Nr.release(_e),Nr.release(be),Nr.release(Te)}Va.clear(),Ba.clear(),ja.clear()}};qa.ofType=fe=>{if(!fe)return za;if(Ga.has(fe))return Ga.get(fe);let ve=null;if("function"==typeof fe)ve=fe.prototype.declaredClass;else if(fe.base)ve=fe.base.prototype.declaredClass;else for(const be in fe.typeMap){const _e=fe.typeMap[be].prototype.declaredClass;ve?ve+=` | ${_e}`:ve=_e}let _e=class extends za{};return e$4o([n$4l({Type:fe,ensureType:"function"==typeof fe?b$2d(fe):T$1p(fe)})],_e.prototype,"itemType",void 0),_e=e$4o([a$4y(`esri.core.Collection<${ve}>`)],_e),Ga.set(fe,_e),_e},e$4o([y$2v()],qa.prototype,"_updating",void 0),e$4o([y$2v()],qa.prototype,"length",void 0),e$4o([y$2v()],qa.prototype,"items",null),e$4o([y$2v({readOnly:!0})],qa.prototype,"updating",null),qa=za=e$4o([a$4y("esri.core.Collection")],qa);const Wa=qa;function e$3O(fe){return"string"==typeof fe?document.getElementById(fe):fe??null}function n$4k(fe){for(;fe.hasChildNodes();)fe.removeChild(fe.firstChild)}function o$3M(fe,ve){const _e=ve.parentNode;_e&&_e.insertBefore(fe,ve)}function i$4j(fe,ve){for(;;){const _e=fe.firstChild;if(!_e)break;ve.appendChild(_e)}}function a$4g(fe,ve,_e){return v$28(fe.map(((fe,be)=>ve.apply(_e,[fe,be]))))}function c$4v(fe){return{ok:!0,value:fe}}function h$2G(fe){return{ok:!1,error:fe}}async function _$1s(fe){if(null==fe)return{ok:!1,error:new Error("no promise provided")};try{return c$4v(await fe)}catch(t84){return h$2G(t84)}}async function b$26(fe){try{return c$4v(await fe)}catch(t84){return a$4D(t84),h$2G(t84)}}function y$2c(fe){if(!0===fe.ok)return fe.value;throw fe.error}function d$3e(fe,ve){return new Ya(fe,ve)}let Ya=class v2 extends zi{get value(){return function m$3u(fe){return null!=fe&&!0===fe.ok?fe.value:null}(this._result)}get error(){return function f$2Y(fe){return null!=fe&&!1===fe.ok?fe.error:null}(this._result)}get finished(){return null!=this._result}constructor(fe,ve){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=e$4f(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:_e}=this._abortController;this.promise=fe(_e),this.promise.then((fe=>{this._result=c$4v(fe),this._cleanup()}),(fe=>{this._result=h$2G(fe),this._cleanup()})),this._abortHandle=m$3R(ve,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=l$4E(this._abortHandle),this._abortController=null}};function d$3d(fe,ve,_e={}){return y$2b(fe,ve,_e,L$1b)}function p$4J(fe,ve,_e={}){return y$2b(fe,ve,_e,M$1m)}function y$2b(fe,ve,_e={},be){let we=null;const Se=_e.once?(fe,_e)=>{be(fe)&&(l$4E(we),ve(fe,_e))}:(fe,_e)=>{be(fe)&&ve(fe,_e)};if(we=w$20(fe,Se,_e.sync,_e.equals),_e.initial){const ve=fe();Se(ve,ve)}return we}function v$1W(fe,ve,_e,be={}){let we=null,Se=null,Te=null;function f31(){var fe;we&&Se&&(Se.remove(),null==(fe=be.onListenerRemove)||fe.call(be,we),we=null,Se=null)}function m39(fe){be.once&&be.once&&l$4E(Te),_e(fe)}const Ee=d$3d(fe,((fe,_e)=>{var Te;f31(),n$4I(fe)&&(we=fe,Se=o$4e(fe,ve,m39),null==(Te=be.onListenerAdd)||Te.call(be,fe))}),{sync:be.sync,initial:!0});return Te=e$4e((()=>{Ee.remove(),f31()})),Te}function w$1T(fe,ve){return function h$2F(fe,ve,_e){if(c$4_(_e))return Promise.reject(u$47());const be=fe();if(null==ve?void 0:ve(be))return Promise.resolve(be);let we=null;function i52(){we=l$4E(we)}return new Promise(((be,Se)=>{we=o$4o([m$3R(_e,(()=>{i52(),Se(u$47())})),y$2b(fe,(fe=>{i52(),be(fe)}),{sync:!1,once:!0},ve??L$1b)])}))}(fe,M$1m,ve)}function L$1b(fe){return!0}function M$1m(fe){return!!fe}function g$2l(fe,ve){const _e=new Wa,be=v$1W(fe,"after-splice",(({added:fe,start:be,deleteCount:we})=>{const Se=_e.splice(be,we);for(const ve of Se)ve.remove();if(null==fe?void 0:fe.length){const we=fe.map(ve);_e.addMany(we,be)}}),{sync:!0,onListenerRemove:()=>_e.drain((fe=>fe.remove())),onListenerAdd:fe=>_e.addMany(fe.items.map(ve))});return _e.addHandles(be),_e}function x$1I(fe,ve){const _e=new Wa,be=g$2l(fe,(fe=>d$3e((async _e=>{const be=await ve(fe,_e);if(c$4_(_e))throw be.remove(),u$47();return be})))),c50=()=>null,a55=async fe=>{const ve=await fe.promise,we=be.indexOf(fe);we<0||_e.splice(we,1,ve)};_e.addMany(be.items.map(c50));for(const Se of be)d$3z(a55(Se));const we=be.on("after-splice",(({added:fe,start:ve,deleteCount:be})=>{const we=_e.splice(ve,be);for(const _e of we)null==_e||_e.remove();if(null==fe?void 0:fe.length){_e.addMany(fe.map(c50),ve);for(const ve of fe)d$3z(a55(ve))}}));return _e.addHandles([l$4D(be),we]),_e}e$4o([y$2v()],Ya.prototype,"value",null),e$4o([y$2v()],Ya.prototype,"error",null),e$4o([y$2v()],Ya.prototype,"finished",null),e$4o([y$2v()],Ya.prototype,"promise",void 0),e$4o([y$2v()],Ya.prototype,"_result",void 0),Ya=e$4o([a$4y("esri.core.asyncUtils.ReactiveTask")],Ya);const Za={sync:!0},Xa={initial:!0},Ja={sync:!0,initial:!0},Qa=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Ka=96;function u$3E(fe){return fe?fe/72*Ka:0}function e$3N(fe){return fe?72*fe/Ka:0}function o$3L(fe){if("string"==typeof fe){const ve=fe.match(Qa);if(ve){const _e=Number(ve[1]),be=ve[3]&&ve[3].toLowerCase(),we="-"===fe.charAt(0),Se="px"===be?e$3N(_e):_e;return we?-Se:Se}return null}return fe}function c$4u(fe=0,ve=0){return{x:fe,y:ve}}function i$4i(fe=0,ve=0){return[fe,ve]}function s$3Y(fe=0,ve=0){return[fe,ve]}function x$1H(fe=0,ve=0,_e=0){return[fe,ve,_e]}function y$2a(fe){return fe}function p$4I(fe){return fe}function l$47(fe){return fe}function d$3c(fe,ve){return ve?(ve[0]=fe.x,ve[1]=fe.y,ve.length>2&&(ve[2]=0),ve):[fe.x,fe.y]}let el=class s9{constructor(fe=fe=>fe.values().next().value){this._peeker=fe,this._observable=new Fa,this._items=new Set}get length(){return s$4u(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let fe;for(fe of this._items);return fe}peek(){if(0!==this.length)return this._peeker(this._items)}push(fe){this.contains(fe)||(this._items.add(fe),this._observable.notify())}contains(fe){return s$4u(this._observable),this._items.has(fe)}pop(){if(0===this.length)return;const fe=this.peek();return this._items.delete(fe),this._observable.notify(),fe}popLast(){if(0===this.length)return;const fe=this.last();return this._items.delete(fe),this._observable.notify(),fe}remove(fe){this.contains(fe)&&(this._items.delete(fe),this._observable.notify())}filter(fe){const ve=this.length;return this._items.forEach((ve=>{fe(ve)||this._items.delete(ve)})),ve!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){s$4u(this._observable),yield*this._items}};const tl=new FinalizationRegistry((fe=>{fe.close()}));function t$3U(fe,ve){return new Proxy({},{get:(_e,be,we)=>(..._e)=>{let we,Se;const Te=_e[_e.length-1];return function n$4h(fe){return"object"==typeof fe&&!Array.isArray(fe)&&null!=fe&&("signal"in fe||"transferList"in fe||0===Object.keys(fe).length)}(Te)&&(we=Te.signal,Se=Te.transferList,_e.pop()),fe.apply(ve?`${ve}.${be.toString()}`:be.toString(),_e,{transferList:Se,signal:we})}})}const rl={statsWorker:()=>zt((()=>import("./statsWorker-Dv0jT8Zm.js")),__vite__mapDeps([2,3,4,5,6])),geometryEngineWorker:()=>zt((()=>import("./geometryEngineWorker-D-miBz2b.js")),__vite__mapDeps([7,8,9,10])),CSVSourceWorker:()=>zt((()=>import("./CSVSourceWorker-UHVPdeeS.js")),__vite__mapDeps([11,12,10,13,14,15,16,17,18,19,20,21,22,3,4,5,6,23,24,25])),EdgeProcessingWorker:()=>zt((()=>import("./EdgeProcessingWorker-L1RiCQIR.js")),__vite__mapDeps([26,27])),ElevationSamplerWorker:()=>zt((()=>import("./ElevationSamplerWorker-BsHkmm6W.js")),__vite__mapDeps([28,15,16,29])),FeatureServiceSnappingSourceWorker:()=>zt((()=>import("./FeatureServiceSnappingSourceWorker-D4YYjILh.js")),__vite__mapDeps([30,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,31,32,33,34])),GeoJSONSourceWorker:()=>zt((()=>import("./GeoJSONSourceWorker-DnSqbUGS.js")),__vite__mapDeps([35,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,36,12,25,37])),LercWorker:()=>zt((()=>import("./LercWorker-TsL02BpB.js")),[]),MemorySourceWorker:()=>zt((()=>import("./MemorySourceWorker-ey2R9wYK.js")),__vite__mapDeps([38,39,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,25,37,12])),PBFDecoderWorker:()=>zt((()=>import("./PBFDecoderWorker-dDXUnLGY.js")),__vite__mapDeps([40,32,33])),FeaturePipelineWorker:()=>zt((()=>import("./FeaturePipelineWorker-v730mzdu.js")),__vite__mapDeps([41,42,43,44,17,18,19,20,21,10,22,3,4,5,6,23,16,34,32,33,45,36,12,25,37,46,47])),PointCloudWorker:()=>zt((()=>import("./PointCloudWorker-BrKtBccU.js")),__vite__mapDeps([48,49,50])),RasterWorker:()=>zt((()=>import("./RasterWorker-CiaEcTjx.js")),__vite__mapDeps([51,52,53,54])),SceneLayerSnappingSourceWorker:()=>zt((()=>import("./SceneLayerSnappingSourceWorker-BtqCwabz.js")),[]),SceneLayerWorker:()=>zt((()=>import("./SceneLayerWorker-B2gy9gVB.js").then((fe=>fe.S))),__vite__mapDeps([55,56])),WFSSourceWorker:()=>zt((()=>import("./WFSSourceWorker-DfHKtVDj.js")),__vite__mapDeps([57,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,36,12,37,58,59])),WorkerTileHandler:()=>zt((()=>import("./WorkerTileHandler-kWQfTgZe.js")),__vite__mapDeps([60,44,33,42])),Lyr3DWorker:()=>zt((()=>import("./Lyr3DWorker-BEIINypx.js")),__vite__mapDeps([61,62,63]))},il="worker:port-closed";var nl,t84;(t84=nl||(nl={}))[t84.HANDSHAKE=0]="HANDSHAKE",t84[t84.OPEN=1]="OPEN",t84[t84.OPENED=2]="OPENED",t84[t84.RESPONSE=3]="RESPONSE",t84[t84.INVOKE=4]="INVOKE",t84[t84.ABORT=5]="ABORT",t84[t84.CLOSE=6]="CLOSE",t84[t84.OPEN_PORT=7]="OPEN_PORT",t84[t84.ON=8]="ON";let sl=0;function s$3W(){return sl++}function i$4g(fe){return fe?"string"==typeof fe?JSON.stringify({name:"message",message:fe}):fe.toJSON?JSON.stringify(fe):JSON.stringify({name:fe.name,message:fe.message,details:fe.details||{stack:fe.stack}}):null}function a$4f(fe,ve,_e,be){if(ve.type===nl.OPEN_PORT)return void fe.postMessage(ve,[ve.port]);if(ve.type!==nl.INVOKE&&ve.type!==nl.RESPONSE)return void fe.postMessage(ve);let we;if(function o$3K(fe){return fe&&"object"==typeof fe&&("result"in fe||"transferList"in fe)}(_e)?(we=u$3D(_e.transferList),ve.data=_e.result):(we=u$3D(be),ve.data=_e),we){if(has("ff"))for(const _e of we)if("byteLength"in _e&&_e.byteLength>267386880){const _e="Worker call with large ArrayBuffer would crash Firefox";switch(ve.type){case nl.INVOKE:throw _e;case nl.RESPONSE:return void a$4f(fe,{type:nl.RESPONSE,jobId:ve.jobId,error:i$4g(_e)})}}fe.postMessage(ve,we)}else fe.postMessage(ve)}function f$2X(fe){if(!fe)return null;const ve=fe.data;return ve?"string"==typeof ve?JSON.parse(ve):ve:null}function u$3D(fe){if(!(null==fe?void 0:fe.length))return null;if(has("esri-workers-arraybuffer-transfer"))return fe;const ve=fe.filter((fe=>!function c$4t(fe){var ve;return fe instanceof ArrayBuffer||"ArrayBuffer"===(null==(ve=null==fe?void 0:fe.constructor)?void 0:ve.name)}(fe)));return ve.length?ve:null}async function O$1o(fe){try{return await fe}catch(da){const ve=(null==da?void 0:da.name)===il;if(!b$2g(da)&&!ve)throw da;return}}const{CLOSE:ol,ABORT:al,INVOKE:ll,RESPONSE:cl,OPEN_PORT:ul,ON:hl}=nl;let dl=class O{constructor(fe){this._invoke=fe,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(fe){fe.type===nl.ABORT?this._cancelledJobIds.add(fe.jobId):(this._invokeMessages.push(fe),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const fe of this._invokeMessages)this._cancelledJobIds.has(fe.jobId)||this._invoke(fe);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},pl=class E{static connect(fe,ve){const _e=new MessageChannel;let be;be="function"==typeof fe?new fe:"default"in fe&&"function"==typeof fe.default?new fe.default:fe;const we=new E(_e.port1,{channel:_e,client:be,schedule:ve});return"object"==typeof be&&"remoteClient"in be&&(be.remoteClient=we),E.clients.set(we,be),_e.port2}static loadWorker(fe){const ve=rl[fe];return ve?ve():Promise.resolve(null)}constructor(fe,ve,_e){this._port=fe,this._jobQueue=_e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new dl((fe=>this._onInvokeMessage(fe))),this._client=ve.client,this._onMessage=this._onMessage.bind(this),this._channel=ve.channel,this._schedule=ve.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:ol}),this._close()}isBusy(){return this._outJobs.size>0}invoke(fe,ve,_e){return this.apply(fe,[ve],_e)}apply(fe,ve,_e){const be=null==_e?void 0:_e.signal,we=null==_e?void 0:_e.transferList;if(!this._port)return Promise.reject(new Ir(il,`Cannot call invoke('${fe}'), port is closed`,{methodName:fe,data:ve}));const Se=s$3W();return new Promise(((_e,Te)=>{if(c$4_(be))return this._processWork(),void Te(u$47());const Ee=m$3R(be,(()=>{const fe=this._outJobs.get(Se);fe&&(this._outJobs.delete(Se),this._processWork(),l$4E(fe.abortHandle),this._post({type:al,jobId:Se}),Te(u$47()))})),Ce={resolve:_e,reject:Te,abortHandle:Ee,debugInfo:fe};this._outJobs.set(Se,Ce),this._post({type:ll,jobId:Se,methodName:fe,abortable:null!=be},ve,we)}))}createInvokeProxy(fe){return t$3U(this,fe)}on(fe,ve){const _e=new MessageChannel;function n52(fe){ve(fe.data)}return this._port.postMessage({type:nl.ON,eventType:fe,port:_e.port2},[_e.port2]),_e.port1.addEventListener("message",n52),_e.port1.start(),e$4e((()=>{_e.port1.postMessage({type:nl.CLOSE}),_e.port1.close(),_e.port1.removeEventListener("message",n52)}))}jobAdded(){this._processWork()}openPort(){const fe=new MessageChannel;return this._post({type:ul,port:fe.port2}),fe.port1}_processWork(){var fe;if(this._outJobs.size>=2)return;const ve=null==(fe=this._jobQueue)?void 0:fe.pop();if(!ve)return;const{methodName:_e,data:be,invokeOptions:we,resolver:Se}=ve;this.apply(_e,be,we).then((fe=>Se.resolve(fe))).catch((fe=>Se.reject(fe)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((fe=>{l$4E(fe.abortHandle),fe.reject(u$47(`Worker closing, aborting job calling '${fe.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(fe){null!=this._schedule?this._schedule((()=>this._processMessage(fe,!0))):this._processMessage(fe,!1)}_processMessage(fe,ve){const _e=f$2X(fe);if(_e)switch(_e.type){case cl:this._onResponseMessage(_e);break;case ll:ve?this._onInvokeMessage(_e):this._invokeQueue.push(_e);break;case al:this._onAbortMessage(_e);break;case ol:this._onCloseMessage();break;case ul:this._onOpenPortMessage(_e);break;case hl:this._onOnMessage(_e)}}_onAbortMessage(fe){const ve=this._inJobs,_e=fe.jobId,be=ve.get(_e);this._invokeQueue.push(fe),be&&(be.controller&&be.controller.abort(),ve.delete(_e))}_onCloseMessage(){const fe=this._client;this._close(),fe&&"destroy"in fe&&E.clients.get(this)===fe&&fe.destroy(),E.clients.delete(this),(null==fe?void 0:fe.remoteClient)&&(fe.remoteClient=null)}_onInvokeMessage(fe){const{methodName:ve,jobId:_e,data:be=[],abortable:we}=fe,Se=we?new AbortController:null,Te=this._inJobs;let Ee,Ce=this._client,Oe=Ce[ve];try{if(!Oe&&ve&&ve.includes(".")){const fe=ve.split(".");for(let ve=0;ve<fe.length-1;ve++)Ce=Ce[fe[ve]],Oe=Ce[fe[ve+1]]}if("function"!=typeof Oe)throw new TypeError(`${ve} is not a function`);be.push({client:this,signal:Se?Se.signal:null}),Ee=Oe.apply(Ce,be)}catch(tA){return void this._post({type:cl,jobId:_e,error:i$4g(tA)})}S$1T(Ee)?(Te.set(_e,{controller:Se,promise:Ee}),Ee.then((fe=>{Te.has(_e)&&(Te.delete(_e),this._post({type:cl,jobId:_e},fe))}),(fe=>{Te.has(_e)&&(Te.delete(_e),b$2g(fe)||this._post({type:cl,jobId:_e,error:i$4g(fe||{message:`Error encountered at method ${ve}`})}))}))):this._post({type:cl,jobId:_e},Ee)}_onOpenPortMessage(fe){new E(fe.port,{client:this._client})}_onOnMessage(fe){const{port:ve}=fe,_e=this._client.on(fe.eventType,(fe=>{ve.postMessage(fe)})),be=o$4e(fe.port,"message",(fe=>{const we=f$2X(fe);(null==we?void 0:we.type)===nl.CLOSE&&(be.remove(),_e.remove(),ve.close())}))}_onResponseMessage(fe){const{jobId:ve,error:_e,data:be}=fe,we=this._outJobs;if(!we.has(ve))return;const Se=we.get(ve);we.delete(ve),this._processWork(),l$4E(Se.abortHandle),_e?Se.reject(Ir.fromJSON(JSON.parse(_e))):Se.resolve(be)}_post(fe,ve,_e){return a$4f(this._port,fe,ve,_e)}};pl.kernelInfo={buildDate:ws,fullVersion:Es,revision:xs},pl.clients=new Map;let fl=class c3{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new el}destroy(){this.close()}get closed(){var fe;return!(null==(fe=this._clients)?void 0:fe.length)}open(fe,ve){return new Promise(((_e,be)=>{let we=!0;const l49=fe=>{s$4o(ve.signal),we&&(we=!1,fe())};this._clients.length=fe.length,this._clientPromises.length=fe.length,this._inUseClients.length=fe.length;for(let Se=0;Se<fe.length;++Se){const we=fe[Se];S$1T(we)?this._clientPromises[Se]=we.then((fe=>(this._clients[Se]=new pl(fe,ve,this._ongoingJobsQueue),l49(_e),this._clients[Se])),(()=>(l49(be),null))):(this._clients[Se]=new pl(we,ve,this._ongoingJobsQueue),this._clientPromises[Se]=Promise.resolve(this._clients[Se]),l49(_e))}}))}broadcast(fe,ve,_e){const be=new Array(this._clientPromises.length);for(let we=0;we<this._clientPromises.length;++we){const Se=this._clientPromises[we];be[we]=Se.then((be=>null==be?void 0:be.invoke(fe,ve,_e)))}return be}close(){let fe;for(;fe=this._ongoingJobsQueue.pop();)fe.resolver.reject(u$47(`Worker closing, aborting job calling '${fe.methodName}'`));for(const ve of this._clientPromises)ve.then((fe=>null==fe?void 0:fe.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,function i$4h(fe){tl.unregister(fe)}(this)}invoke(fe,ve,_e){return this.apply(fe,[ve],_e)}apply(fe,ve,_e){const be=L$1h();this._ongoingJobsQueue.push({methodName:fe,data:ve,invokeOptions:_e,resolver:be});for(let we=0;we<this._clientPromises.length;we++){const fe=this._clients[we];fe?fe.jobAdded():this._clientPromises[we].then((fe=>null==fe?void 0:fe.jobAdded()))}return be.promise}createInvokeProxy(fe){return t$3U(this,fe)}on(fe,ve){return Promise.all(this._clientPromises).then((()=>o$4o(this._clients.map((_e=>_e.on(fe,ve))))))}openPorts(){return new Promise((fe=>{const ve=new Array(this._clientPromises.length);let _e=ve.length;for(let be=0;be<this._clientPromises.length;++be)this._clientPromises[be].then((we=>{we&&(ve[be]=we.openPort()),0==--_e&&fe(ve)}))}))}get test(){}};const ml={async request(fe,ve){var _e,be;const we=fe.options,Se=we.responseType;we.signal=null==ve?void 0:ve.signal,we.responseType="native"===Se||"native-request-init"===Se?"native-request-init":Se&&["blob","json","text"].includes(Se)&&(null==(_e=D$1d(fe.url))?void 0:_e.after)?Se:"array-buffer";const Te=await U$1a(fe.url,we),Ee={data:Te.data,httpStatus:Te.httpStatus,ssl:Te.ssl};switch(null==(be=Te.requestOptions)?void 0:be.responseType){case"native-request-init":return delete Ee.data.signal,Ee;case"blob":Ee.data=await Ee.data.arrayBuffer();break;case"json":Ee.data=(new TextEncoder).encode(JSON.stringify(Ee.data)).buffer;break;case"text":Ee.data=(new TextEncoder).encode(Ee.data).buffer}return{result:Ee,transferList:[Ee.data]}}};let yl;const gl=(null==(Se=globalThis.esriConfig)?void 0:Se.locale)??(null==(Te=globalThis.dojoConfig)?void 0:Te.locale);function i$4f(){var fe;return gl??(null==(fe=globalThis.navigator)?void 0:fe.language)??"en"}function c$4r(){return void 0===yl&&(yl=i$4f()),yl}function a$4d(fe=c$4r()){const ve=/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(fe);return null==ve?void 0:ve[1].toLowerCase()}const vl=[];function f$2W(fe){return vl.push(fe),e$4e((()=>vl.splice(vl.indexOf(fe),1)))}const _l=[];function h$2E(fe){return _l.push(fe),e$4e((()=>_l.splice(_l.indexOf(fe),1)))}null==(Ee=globalThis.addEventListener)||Ee.call(globalThis,"languagechange",(function d$3b(){const fe=i$4f();yl!==fe&&([..._l].forEach((ve=>ve(fe))),yl=fe,[...vl].forEach((ve=>ve(fe))))}));const $l=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class LuxonError extends Error{}class InvalidDateTimeError extends LuxonError{constructor(fe){super(`Invalid DateTime: ${fe.toMessage()}`)}}class InvalidIntervalError extends LuxonError{constructor(fe){super(`Invalid Interval: ${fe.toMessage()}`)}}class InvalidDurationError extends LuxonError{constructor(fe){super(`Invalid Duration: ${fe.toMessage()}`)}}class ConflictingSpecificationError extends LuxonError{}class InvalidUnitError extends LuxonError{constructor(fe){super(`Invalid unit ${fe}`)}}class InvalidArgumentError extends LuxonError{}class ZoneIsAbstractError extends LuxonError{constructor(){super("Zone is an abstract class")}}const bl="numeric",wl="short",xl="long",Sl={year:bl,month:bl,day:bl},Tl={year:bl,month:wl,day:bl},El={year:bl,month:wl,day:bl,weekday:wl},Pl={year:bl,month:xl,day:bl},Cl={year:bl,month:xl,day:bl,weekday:xl},Ol={hour:bl,minute:bl},Al={hour:bl,minute:bl,second:bl},Ml={hour:bl,minute:bl,second:bl,timeZoneName:wl},Rl={hour:bl,minute:bl,second:bl,timeZoneName:xl},Il={hour:bl,minute:bl,hourCycle:"h23"},Ll={hour:bl,minute:bl,second:bl,hourCycle:"h23"},Dl={hour:bl,minute:bl,second:bl,hourCycle:"h23",timeZoneName:wl},Nl={hour:bl,minute:bl,second:bl,hourCycle:"h23",timeZoneName:xl},Fl={year:bl,month:bl,day:bl,hour:bl,minute:bl},zl={year:bl,month:bl,day:bl,hour:bl,minute:bl,second:bl},kl={year:bl,month:wl,day:bl,hour:bl,minute:bl},Ul={year:bl,month:wl,day:bl,hour:bl,minute:bl,second:bl},Vl={year:bl,month:wl,day:bl,weekday:wl,hour:bl,minute:bl},Bl={year:bl,month:xl,day:bl,hour:bl,minute:bl,timeZoneName:wl},jl={year:bl,month:xl,day:bl,hour:bl,minute:bl,second:bl,timeZoneName:wl},Gl={year:bl,month:xl,day:bl,weekday:xl,hour:bl,minute:bl,timeZoneName:xl},Hl={year:bl,month:xl,day:bl,weekday:xl,hour:bl,minute:bl,second:bl,timeZoneName:xl};class Zone{get type(){throw new ZoneIsAbstractError}get name(){throw new ZoneIsAbstractError}get ianaName(){return this.name}get isUniversal(){throw new ZoneIsAbstractError}offsetName(fe,ve){throw new ZoneIsAbstractError}formatOffset(fe,ve){throw new ZoneIsAbstractError}offset(fe){throw new ZoneIsAbstractError}equals(fe){throw new ZoneIsAbstractError}get isValid(){throw new ZoneIsAbstractError}}let ql=null;class SystemZone extends Zone{static get instance(){return null===ql&&(ql=new SystemZone),ql}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(fe,{format:ve,locale:_e}){return parseZoneInfo(fe,ve,_e)}formatOffset(fe,ve){return formatOffset(this.offset(fe),ve)}offset(fe){return-new Date(fe).getTimezoneOffset()}equals(fe){return"system"===fe.type}get isValid(){return!0}}let Wl={};const Yl={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Zl={};class IANAZone extends Zone{static create(fe){return Zl[fe]||(Zl[fe]=new IANAZone(fe)),Zl[fe]}static resetCache(){Zl={},Wl={}}static isValidSpecifier(fe){return this.isValidZone(fe)}static isValidZone(fe){if(!fe)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:fe}).format(),!0}catch(vr){return!1}}constructor(fe){super(),this.zoneName=fe,this.valid=IANAZone.isValidZone(fe)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(fe,{format:ve,locale:_e}){return parseZoneInfo(fe,ve,_e,this.name)}formatOffset(fe,ve){return formatOffset(this.offset(fe),ve)}offset(fe){const ve=new Date(fe);if(isNaN(ve))return NaN;const _e=function makeDTF(fe){return Wl[fe]||(Wl[fe]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:fe,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Wl[fe]}(this.name);let[be,we,Se,Te,Ee,Ce,Oe]=_e.formatToParts?function partsOffset(fe,ve){const _e=fe.formatToParts(ve),be=[];for(let we=0;we<_e.length;we++){const{type:fe,value:ve}=_e[we],Se=Yl[fe];"era"===fe?be[Se]=ve:isUndefined(Se)||(be[Se]=parseInt(ve,10))}return be}(_e,ve):function hackyOffset(fe,ve){const _e=fe.format(ve).replace(/\u200E/g,""),be=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(_e),[,we,Se,Te,Ee,Ce,Oe,Re]=be;return[Te,we,Se,Ee,Ce,Oe,Re]}(_e,ve);"BC"===Te&&(be=1-Math.abs(be));let Re=+ve;const De=Re%1e3;return Re-=De>=0?De:1e3+De,(objToLocalTS({year:be,month:we,day:Se,hour:24===Ee?0:Ee,minute:Ce,second:Oe,millisecond:0})-Re)/6e4}equals(fe){return"iana"===fe.type&&fe.name===this.name}get isValid(){return this.valid}}let Xl={};let Jl={};function getCachedDTF(fe,ve={}){const _e=JSON.stringify([fe,ve]);let be=Jl[_e];return be||(be=new Intl.DateTimeFormat(fe,ve),Jl[_e]=be),be}let Ql={};let Kl={};let ec=null;let tc={};function listStuff(fe,ve,_e,be){const we=fe.listingMode();return"error"===we?null:"en"===we?_e(ve):be(ve)}class PolyNumberFormatter{constructor(fe,ve,_e){this.padTo=_e.padTo||0,this.floor=_e.floor||!1;const{padTo:be,floor:we,...Se}=_e;if(!ve||Object.keys(Se).length>0){const ve={useGrouping:!1,..._e};_e.padTo>0&&(ve.minimumIntegerDigits=_e.padTo),this.inf=function getCachedINF(fe,ve={}){const _e=JSON.stringify([fe,ve]);let be=Ql[_e];return be||(be=new Intl.NumberFormat(fe,ve),Ql[_e]=be),be}(fe,ve)}}format(fe){if(this.inf){const ve=this.floor?Math.floor(fe):fe;return this.inf.format(ve)}return padStart(this.floor?Math.floor(fe):roundTo(fe,3),this.padTo)}}class PolyDateFormatter{constructor(fe,ve,_e){let be;if(this.opts=_e,this.originalZone=void 0,this.opts.timeZone)this.dt=fe;else if("fixed"===fe.zone.type){const ve=fe.offset/60*-1,_e=ve>=0?`Etc/GMT+${ve}`:`Etc/GMT${ve}`;0!==fe.offset&&IANAZone.create(_e).valid?(be=_e,this.dt=fe):(be="UTC",this.dt=0===fe.offset?fe:fe.setZone("UTC").plus({minutes:fe.offset}),this.originalZone=fe.zone)}else"system"===fe.zone.type?this.dt=fe:"iana"===fe.zone.type?(this.dt=fe,be=fe.zone.name):(be="UTC",this.dt=fe.setZone("UTC").plus({minutes:fe.offset}),this.originalZone=fe.zone);const we={...this.opts};we.timeZone=we.timeZone||be,this.dtf=getCachedDTF(ve,we)}format(){return this.originalZone?this.formatToParts().map((({value:fe})=>fe)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const fe=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?fe.map((fe=>{if("timeZoneName"===fe.type){const ve=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...fe,value:ve}}return fe})):fe}resolvedOptions(){return this.dtf.resolvedOptions()}}class PolyRelFormatter{constructor(fe,ve,_e){this.opts={style:"long",..._e},!ve&&hasRelative()&&(this.rtf=function getCachedRTF(fe,ve={}){const{base:_e,...be}=ve,we=JSON.stringify([fe,be]);let Se=Kl[we];return Se||(Se=new Intl.RelativeTimeFormat(fe,ve),Kl[we]=Se),Se}(fe,_e))}format(fe,ve){return this.rtf?this.rtf.format(fe,ve):function formatRelativeTime(fe,ve,_e="always",be=!1){const we={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},Se=-1===["hours","minutes","seconds"].indexOf(fe);if("auto"===_e&&Se){const _e="days"===fe;switch(ve){case 1:return _e?"tomorrow":`next ${we[fe][0]}`;case-1:return _e?"yesterday":`last ${we[fe][0]}`;case 0:return _e?"today":`this ${we[fe][0]}`}}const Te=Object.is(ve,-0)||ve<0,Ee=Math.abs(ve),Ce=1===Ee,Oe=we[fe],Re=be?Ce?Oe[1]:Oe[2]||Oe[1]:Ce?we[fe][0]:fe;return Te?`${Ee} ${Re} ago`:`in ${Ee} ${Re}`}(ve,fe,this.opts.numeric,"long"!==this.opts.style)}formatToParts(fe,ve){return this.rtf?this.rtf.formatToParts(fe,ve):[]}}const rc={firstDay:1,minimalDays:4,weekend:[6,7]};class Locale{static fromOpts(fe){return Locale.create(fe.locale,fe.numberingSystem,fe.outputCalendar,fe.weekSettings,fe.defaultToEN)}static create(fe,ve,_e,be,we=!1){const Se=fe||Settings.defaultLocale,Te=Se||(we?"en-US":function systemLocale(){return ec||(ec=(new Intl.DateTimeFormat).resolvedOptions().locale,ec)}()),Ee=ve||Settings.defaultNumberingSystem,Ce=_e||Settings.defaultOutputCalendar,Oe=validateWeekSettings(be)||Settings.defaultWeekSettings;return new Locale(Te,Ee,Ce,Oe,Se)}static resetCache(){ec=null,Jl={},Ql={},Kl={}}static fromObject({locale:fe,numberingSystem:ve,outputCalendar:_e,weekSettings:be}={}){return Locale.create(fe,ve,_e,be)}constructor(fe,ve,_e,be,we){const[Se,Te,Ee]=function parseLocaleString(fe){const ve=fe.indexOf("-x-");-1!==ve&&(fe=fe.substring(0,ve));const _e=fe.indexOf("-u-");if(-1===_e)return[fe];{let ve,be;try{ve=getCachedDTF(fe).resolvedOptions(),be=fe}catch(vr){const Se=fe.substring(0,_e);ve=getCachedDTF(Se).resolvedOptions(),be=Se}const{numberingSystem:we,calendar:Se}=ve;return[be,we,Se]}}(fe);this.locale=Se,this.numberingSystem=ve||Te||null,this.outputCalendar=_e||Ee||null,this.weekSettings=be,this.intl=function intlConfigString(fe,ve,_e){return _e||ve?(fe.includes("-u-")||(fe+="-u"),_e&&(fe+=`-ca-${_e}`),ve&&(fe+=`-nu-${ve}`),fe):fe}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=we,this.fastNumbersCached=null}get fastNumbers(){return null==this.fastNumbersCached&&(this.fastNumbersCached=function supportsFastNumbers(fe){return(!fe.numberingSystem||"latn"===fe.numberingSystem)&&("latn"===fe.numberingSystem||!fe.locale||fe.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(fe.intl).resolvedOptions().numberingSystem)}(this)),this.fastNumbersCached}listingMode(){const fe=this.isEnglish(),ve=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return fe&&ve?"en":"intl"}clone(fe){return fe&&0!==Object.getOwnPropertyNames(fe).length?Locale.create(fe.locale||this.specifiedLocale,fe.numberingSystem||this.numberingSystem,fe.outputCalendar||this.outputCalendar,validateWeekSettings(fe.weekSettings)||this.weekSettings,fe.defaultToEN||!1):this}redefaultToEN(fe={}){return this.clone({...fe,defaultToEN:!0})}redefaultToSystem(fe={}){return this.clone({...fe,defaultToEN:!1})}months(fe,ve=!1){return listStuff(this,fe,months,(()=>{const _e=ve?{month:fe,day:"numeric"}:{month:fe},be=ve?"format":"standalone";return this.monthsCache[be][fe]||(this.monthsCache[be][fe]=function mapMonths(fe){const ve=[];for(let _e=1;_e<=12;_e++){const be=DateTime.utc(2009,_e,1);ve.push(fe(be))}return ve}((fe=>this.extract(fe,_e,"month")))),this.monthsCache[be][fe]}))}weekdays(fe,ve=!1){return listStuff(this,fe,weekdays,(()=>{const _e=ve?{weekday:fe,year:"numeric",month:"long",day:"numeric"}:{weekday:fe},be=ve?"format":"standalone";return this.weekdaysCache[be][fe]||(this.weekdaysCache[be][fe]=function mapWeekdays(fe){const ve=[];for(let _e=1;_e<=7;_e++){const be=DateTime.utc(2016,11,13+_e);ve.push(fe(be))}return ve}((fe=>this.extract(fe,_e,"weekday")))),this.weekdaysCache[be][fe]}))}meridiems(){return listStuff(this,void 0,(()=>_c),(()=>{if(!this.meridiemCache){const fe={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map((ve=>this.extract(ve,fe,"dayperiod")))}return this.meridiemCache}))}eras(fe){return listStuff(this,fe,eras,(()=>{const ve={era:fe};return this.eraCache[fe]||(this.eraCache[fe]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map((fe=>this.extract(fe,ve,"era")))),this.eraCache[fe]}))}extract(fe,ve,_e){const be=this.dtFormatter(fe,ve).formatToParts().find((fe=>fe.type.toLowerCase()===_e));return be?be.value:null}numberFormatter(fe={}){return new PolyNumberFormatter(this.intl,fe.forceSimple||this.fastNumbers,fe)}dtFormatter(fe,ve={}){return new PolyDateFormatter(fe,this.intl,ve)}relFormatter(fe={}){return new PolyRelFormatter(this.intl,this.isEnglish(),fe)}listFormatter(fe={}){return function getCachedLF(fe,ve={}){const _e=JSON.stringify([fe,ve]);let be=Xl[_e];return be||(be=new Intl.ListFormat(fe,ve),Xl[_e]=be),be}(this.intl,fe)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:hasLocaleWeekInfo()?function getCachedWeekInfo(fe){let ve=tc[fe];if(!ve){const _e=new Intl.Locale(fe);ve="getWeekInfo"in _e?_e.getWeekInfo():_e.weekInfo,tc[fe]=ve}return ve}(this.locale):rc}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(fe){return this.locale===fe.locale&&this.numberingSystem===fe.numberingSystem&&this.outputCalendar===fe.outputCalendar}}let ic=null;class FixedOffsetZone extends Zone{static get utcInstance(){return null===ic&&(ic=new FixedOffsetZone(0)),ic}static instance(fe){return 0===fe?FixedOffsetZone.utcInstance:new FixedOffsetZone(fe)}static parseSpecifier(fe){if(fe){const ve=fe.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(ve)return new FixedOffsetZone(signedOffset(ve[1],ve[2]))}return null}constructor(fe){super(),this.fixed=fe}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${formatOffset(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${formatOffset(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(fe,ve){return formatOffset(this.fixed,ve)}get isUniversal(){return!0}offset(){return this.fixed}equals(fe){return"fixed"===fe.type&&fe.fixed===this.fixed}get isValid(){return!0}}class InvalidZone extends Zone{constructor(fe){super(),this.zoneName=fe}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function normalizeZone(fe,ve){if(isUndefined(fe)||null===fe)return ve;if(fe instanceof Zone)return fe;if(function isString(fe){return"string"==typeof fe}(fe)){const _e=fe.toLowerCase();return"default"===_e?ve:"local"===_e||"system"===_e?SystemZone.instance:"utc"===_e||"gmt"===_e?FixedOffsetZone.utcInstance:FixedOffsetZone.parseSpecifier(_e)||IANAZone.create(fe)}return isNumber(fe)?FixedOffsetZone.instance(fe):"object"==typeof fe&&"offset"in fe&&"function"==typeof fe.offset?fe:new InvalidZone(fe)}let nc,now=()=>Date.now(),sc="system",oc=null,ac=null,lc=null,cc=60,uc=null;class Settings{static get now(){return now}static set now(fe){now=fe}static set defaultZone(fe){sc=fe}static get defaultZone(){return normalizeZone(sc,SystemZone.instance)}static get defaultLocale(){return oc}static set defaultLocale(fe){oc=fe}static get defaultNumberingSystem(){return ac}static set defaultNumberingSystem(fe){ac=fe}static get defaultOutputCalendar(){return lc}static set defaultOutputCalendar(fe){lc=fe}static get defaultWeekSettings(){return uc}static set defaultWeekSettings(fe){uc=validateWeekSettings(fe)}static get twoDigitCutoffYear(){return cc}static set twoDigitCutoffYear(fe){cc=fe%100}static get throwOnInvalid(){return nc}static set throwOnInvalid(fe){nc=fe}static resetCaches(){Locale.resetCache(),IANAZone.resetCache()}}class Invalid{constructor(fe,ve){this.reason=fe,this.explanation=ve}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const hc=[0,31,59,90,120,151,181,212,243,273,304,334],dc=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(fe,ve){return new Invalid("unit out of range",`you specified ${ve} (of type ${typeof ve}) as a ${fe}, which is invalid`)}function dayOfWeek(fe,ve,_e){const be=new Date(Date.UTC(fe,ve-1,_e));fe<100&&fe>=0&&be.setUTCFullYear(be.getUTCFullYear()-1900);const we=be.getUTCDay();return 0===we?7:we}function computeOrdinal(fe,ve,_e){return _e+(isLeapYear(fe)?dc:hc)[ve-1]}function uncomputeOrdinal(fe,ve){const _e=isLeapYear(fe)?dc:hc,be=_e.findIndex((fe=>fe<ve));return{month:be+1,day:ve-_e[be]}}function isoWeekdayToLocal(fe,ve){return(fe-ve+7)%7+1}function gregorianToWeek(fe,ve=4,_e=1){const{year:be,month:we,day:Se}=fe,Te=computeOrdinal(be,we,Se),Ee=isoWeekdayToLocal(dayOfWeek(be,we,Se),_e);let Ce,Oe=Math.floor((Te-Ee+14-ve)/7);return Oe<1?(Ce=be-1,Oe=weeksInWeekYear(Ce,ve,_e)):Oe>weeksInWeekYear(be,ve,_e)?(Ce=be+1,Oe=1):Ce=be,{weekYear:Ce,weekNumber:Oe,weekday:Ee,...timeObject(fe)}}function weekToGregorian(fe,ve=4,_e=1){const{weekYear:be,weekNumber:we,weekday:Se}=fe,Te=isoWeekdayToLocal(dayOfWeek(be,1,ve),_e),Ee=daysInYear(be);let Ce,Oe=7*we+Se-Te-7+ve;Oe<1?(Ce=be-1,Oe+=daysInYear(Ce)):Oe>Ee?(Ce=be+1,Oe-=daysInYear(be)):Ce=be;const{month:Re,day:De}=uncomputeOrdinal(Ce,Oe);return{year:Ce,month:Re,day:De,...timeObject(fe)}}function gregorianToOrdinal(fe){const{year:ve,month:_e,day:be}=fe;return{year:ve,ordinal:computeOrdinal(ve,_e,be),...timeObject(fe)}}function ordinalToGregorian(fe){const{year:ve,ordinal:_e}=fe,{month:be,day:we}=uncomputeOrdinal(ve,_e);return{year:ve,month:be,day:we,...timeObject(fe)}}function usesLocalWeekValues(fe,ve){if(!isUndefined(fe.localWeekday)||!isUndefined(fe.localWeekNumber)||!isUndefined(fe.localWeekYear)){if(!isUndefined(fe.weekday)||!isUndefined(fe.weekNumber)||!isUndefined(fe.weekYear))throw new ConflictingSpecificationError("Cannot mix locale-based week fields with ISO-based week fields");return isUndefined(fe.localWeekday)||(fe.weekday=fe.localWeekday),isUndefined(fe.localWeekNumber)||(fe.weekNumber=fe.localWeekNumber),isUndefined(fe.localWeekYear)||(fe.weekYear=fe.localWeekYear),delete fe.localWeekday,delete fe.localWeekNumber,delete fe.localWeekYear,{minDaysInFirstWeek:ve.getMinDaysInFirstWeek(),startOfWeek:ve.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function hasInvalidGregorianData(fe){const ve=isInteger(fe.year),_e=integerBetween(fe.month,1,12),be=integerBetween(fe.day,1,daysInMonth(fe.year,fe.month));return ve?_e?!be&&unitOutOfRange("day",fe.day):unitOutOfRange("month",fe.month):unitOutOfRange("year",fe.year)}function hasInvalidTimeData(fe){const{hour:ve,minute:_e,second:be,millisecond:we}=fe,Se=integerBetween(ve,0,23)||24===ve&&0===_e&&0===be&&0===we,Te=integerBetween(_e,0,59),Ee=integerBetween(be,0,59),Ce=integerBetween(we,0,999);return Se?Te?Ee?!Ce&&unitOutOfRange("millisecond",we):unitOutOfRange("second",be):unitOutOfRange("minute",_e):unitOutOfRange("hour",ve)}function isUndefined(fe){return void 0===fe}function isNumber(fe){return"number"==typeof fe}function isInteger(fe){return"number"==typeof fe&&fe%1==0}function hasRelative(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(vr){return!1}}function hasLocaleWeekInfo(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(vr){return!1}}function bestBy(fe,ve,_e){if(0!==fe.length)return fe.reduce(((fe,be)=>{const we=[ve(be),be];return fe&&_e(fe[0],we[0])===fe[0]?fe:we}),null)[1]}function hasOwnProperty(fe,ve){return Object.prototype.hasOwnProperty.call(fe,ve)}function validateWeekSettings(fe){if(null==fe)return null;if("object"!=typeof fe)throw new InvalidArgumentError("Week settings must be an object");if(!integerBetween(fe.firstDay,1,7)||!integerBetween(fe.minimalDays,1,7)||!Array.isArray(fe.weekend)||fe.weekend.some((fe=>!integerBetween(fe,1,7))))throw new InvalidArgumentError("Invalid week settings");return{firstDay:fe.firstDay,minimalDays:fe.minimalDays,weekend:Array.from(fe.weekend)}}function integerBetween(fe,ve,_e){return isInteger(fe)&&fe>=ve&&fe<=_e}function padStart(fe,ve=2){let _e;return _e=fe<0?"-"+(""+-fe).padStart(ve,"0"):(""+fe).padStart(ve,"0"),_e}function parseInteger(fe){return isUndefined(fe)||null===fe||""===fe?void 0:parseInt(fe,10)}function parseFloating(fe){return isUndefined(fe)||null===fe||""===fe?void 0:parseFloat(fe)}function parseMillis(fe){if(!isUndefined(fe)&&null!==fe&&""!==fe){const ve=1e3*parseFloat("0."+fe);return Math.floor(ve)}}function roundTo(fe,ve,_e=!1){const be=10**ve;return(_e?Math.trunc:Math.round)(fe*be)/be}function isLeapYear(fe){return fe%4==0&&(fe%100!=0||fe%400==0)}function daysInYear(fe){return isLeapYear(fe)?366:365}function daysInMonth(fe,ve){const _e=function floorMod(fe,ve){return fe-ve*Math.floor(fe/ve)}(ve-1,12)+1;return 2===_e?isLeapYear(fe+(ve-_e)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][_e-1]}function objToLocalTS(fe){let ve=Date.UTC(fe.year,fe.month-1,fe.day,fe.hour,fe.minute,fe.second,fe.millisecond);return fe.year<100&&fe.year>=0&&(ve=new Date(ve),ve.setUTCFullYear(fe.year,fe.month-1,fe.day)),+ve}function firstWeekOffset(fe,ve,_e){return-isoWeekdayToLocal(dayOfWeek(fe,1,ve),_e)+ve-1}function weeksInWeekYear(fe,ve=4,_e=1){const be=firstWeekOffset(fe,ve,_e),we=firstWeekOffset(fe+1,ve,_e);return(daysInYear(fe)-be+we)/7}function untruncateYear(fe){return fe>99?fe:fe>Settings.twoDigitCutoffYear?1900+fe:2e3+fe}function parseZoneInfo(fe,ve,_e,be=null){const we=new Date(fe),Se={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};be&&(Se.timeZone=be);const Te={timeZoneName:ve,...Se},Ee=new Intl.DateTimeFormat(_e,Te).formatToParts(we).find((fe=>"timezonename"===fe.type.toLowerCase()));return Ee?Ee.value:null}function signedOffset(fe,ve){let _e=parseInt(fe,10);Number.isNaN(_e)&&(_e=0);const be=parseInt(ve,10)||0;return 60*_e+(_e<0||Object.is(_e,-0)?-be:be)}function asNumber(fe){const ve=Number(fe);if("boolean"==typeof fe||""===fe||Number.isNaN(ve))throw new InvalidArgumentError(`Invalid unit value ${fe}`);return ve}function normalizeObject(fe,ve){const _e={};for(const be in fe)if(hasOwnProperty(fe,be)){const we=fe[be];if(null==we)continue;_e[ve(be)]=asNumber(we)}return _e}function formatOffset(fe,ve){const _e=Math.trunc(Math.abs(fe/60)),be=Math.trunc(Math.abs(fe%60)),we=fe>=0?"+":"-";switch(ve){case"short":return`${we}${padStart(_e,2)}:${padStart(be,2)}`;case"narrow":return`${we}${_e}${be>0?`:${be}`:""}`;case"techie":return`${we}${padStart(_e,2)}${padStart(be,2)}`;default:throw new RangeError(`Value format ${ve} is out of range for property format`)}}function timeObject(fe){return function pick(fe,ve){return ve.reduce(((ve,_e)=>(ve[_e]=fe[_e],ve)),{})}(fe,["hour","minute","second","millisecond"])}const pc=["January","February","March","April","May","June","July","August","September","October","November","December"],fc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],mc=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(fe){switch(fe){case"narrow":return[...mc];case"short":return[...fc];case"long":return[...pc];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const yc=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],gc=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],vc=["M","T","W","T","F","S","S"];function weekdays(fe){switch(fe){case"narrow":return[...vc];case"short":return[...gc];case"long":return[...yc];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const _c=["AM","PM"],$c=["Before Christ","Anno Domini"],bc=["BC","AD"],wc=["B","A"];function eras(fe){switch(fe){case"narrow":return[...wc];case"short":return[...bc];case"long":return[...$c];default:return null}}function stringifyTokens(fe,ve){let _e="";for(const be of fe)be.literal?_e+=be.val:_e+=ve(be.val);return _e}const xc={D:Sl,DD:Tl,DDD:Pl,DDDD:Cl,t:Ol,tt:Al,ttt:Ml,tttt:Rl,T:Il,TT:Ll,TTT:Dl,TTTT:Nl,f:Fl,ff:kl,fff:Bl,ffff:Gl,F:zl,FF:Ul,FFF:jl,FFFF:Hl};class Formatter{static create(fe,ve={}){return new Formatter(fe,ve)}static parseFormat(fe){let ve=null,_e="",be=!1;const we=[];for(let Se=0;Se<fe.length;Se++){const Te=fe.charAt(Se);"'"===Te?(_e.length>0&&we.push({literal:be||/^\s+$/.test(_e),val:_e}),ve=null,_e="",be=!be):be||Te===ve?_e+=Te:(_e.length>0&&we.push({literal:/^\s+$/.test(_e),val:_e}),_e=Te,ve=Te)}return _e.length>0&&we.push({literal:be||/^\s+$/.test(_e),val:_e}),we}static macroTokenToFormatOpts(fe){return xc[fe]}constructor(fe,ve){this.opts=ve,this.loc=fe,this.systemLoc=null}formatWithSystemDefault(fe,ve){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(fe,{...this.opts,...ve}).format()}dtFormatter(fe,ve={}){return this.loc.dtFormatter(fe,{...this.opts,...ve})}formatDateTime(fe,ve){return this.dtFormatter(fe,ve).format()}formatDateTimeParts(fe,ve){return this.dtFormatter(fe,ve).formatToParts()}formatInterval(fe,ve){return this.dtFormatter(fe.start,ve).dtf.formatRange(fe.start.toJSDate(),fe.end.toJSDate())}resolvedOptions(fe,ve){return this.dtFormatter(fe,ve).resolvedOptions()}num(fe,ve=0){if(this.opts.forceSimple)return padStart(fe,ve);const _e={...this.opts};return ve>0&&(_e.padTo=ve),this.loc.numberFormatter(_e).format(fe)}formatDateTimeFromString(fe,ve){const _e="en"===this.loc.listingMode(),be=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,string=(ve,_e)=>this.loc.extract(fe,ve,_e),formatOffset2=ve=>fe.isOffsetFixed&&0===fe.offset&&ve.allowZ?"Z":fe.isValid?fe.zone.formatOffset(fe.ts,ve.format):"",meridiem=()=>_e?function meridiemForDateTime(fe){return _c[fe.hour<12?0:1]}(fe):string({hour:"numeric",hourCycle:"h12"},"dayperiod"),month=(ve,be)=>_e?function monthForDateTime(fe,ve){return months(ve)[fe.month-1]}(fe,ve):string(be?{month:ve}:{month:ve,day:"numeric"},"month"),weekday=(ve,be)=>_e?function weekdayForDateTime(fe,ve){return weekdays(ve)[fe.weekday-1]}(fe,ve):string(be?{weekday:ve}:{weekday:ve,month:"long",day:"numeric"},"weekday"),maybeMacro=ve=>{const _e=Formatter.macroTokenToFormatOpts(ve);return _e?this.formatWithSystemDefault(fe,_e):ve},era=ve=>_e?function eraForDateTime(fe,ve){return eras(ve)[fe.year<0?0:1]}(fe,ve):string({era:ve},"era");return stringifyTokens(Formatter.parseFormat(ve),(ve=>{switch(ve){case"S":return this.num(fe.millisecond);case"u":case"SSS":return this.num(fe.millisecond,3);case"s":return this.num(fe.second);case"ss":return this.num(fe.second,2);case"uu":return this.num(Math.floor(fe.millisecond/10),2);case"uuu":return this.num(Math.floor(fe.millisecond/100));case"m":return this.num(fe.minute);case"mm":return this.num(fe.minute,2);case"h":return this.num(fe.hour%12==0?12:fe.hour%12);case"hh":return this.num(fe.hour%12==0?12:fe.hour%12,2);case"H":return this.num(fe.hour);case"HH":return this.num(fe.hour,2);case"Z":return formatOffset2({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return formatOffset2({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return formatOffset2({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return fe.zone.offsetName(fe.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return fe.zone.offsetName(fe.ts,{format:"long",locale:this.loc.locale});case"z":return fe.zoneName;case"a":return meridiem();case"d":return be?string({day:"numeric"},"day"):this.num(fe.day);case"dd":return be?string({day:"2-digit"},"day"):this.num(fe.day,2);case"c":case"E":return this.num(fe.weekday);case"ccc":return weekday("short",!0);case"cccc":return weekday("long",!0);case"ccccc":return weekday("narrow",!0);case"EEE":return weekday("short",!1);case"EEEE":return weekday("long",!1);case"EEEEE":return weekday("narrow",!1);case"L":return be?string({month:"numeric",day:"numeric"},"month"):this.num(fe.month);case"LL":return be?string({month:"2-digit",day:"numeric"},"month"):this.num(fe.month,2);case"LLL":return month("short",!0);case"LLLL":return month("long",!0);case"LLLLL":return month("narrow",!0);case"M":return be?string({month:"numeric"},"month"):this.num(fe.month);case"MM":return be?string({month:"2-digit"},"month"):this.num(fe.month,2);case"MMM":return month("short",!1);case"MMMM":return month("long",!1);case"MMMMM":return month("narrow",!1);case"y":return be?string({year:"numeric"},"year"):this.num(fe.year);case"yy":return be?string({year:"2-digit"},"year"):this.num(fe.year.toString().slice(-2),2);case"yyyy":return be?string({year:"numeric"},"year"):this.num(fe.year,4);case"yyyyyy":return be?string({year:"numeric"},"year"):this.num(fe.year,6);case"G":return era("short");case"GG":return era("long");case"GGGGG":return era("narrow");case"kk":return this.num(fe.weekYear.toString().slice(-2),2);case"kkkk":return this.num(fe.weekYear,4);case"W":return this.num(fe.weekNumber);case"WW":return this.num(fe.weekNumber,2);case"n":return this.num(fe.localWeekNumber);case"nn":return this.num(fe.localWeekNumber,2);case"ii":return this.num(fe.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(fe.localWeekYear,4);case"o":return this.num(fe.ordinal);case"ooo":return this.num(fe.ordinal,3);case"q":return this.num(fe.quarter);case"qq":return this.num(fe.quarter,2);case"X":return this.num(Math.floor(fe.ts/1e3));case"x":return this.num(fe.ts);default:return maybeMacro(ve)}}))}formatDurationFromString(fe,ve){const tokenToField=fe=>{switch(fe[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},_e=Formatter.parseFormat(ve),be=_e.reduce(((fe,{literal:ve,val:_e})=>ve?fe:fe.concat(_e)),[]),we=fe.shiftTo(...be.map(tokenToField).filter((fe=>fe)));return stringifyTokens(_e,(fe=>ve=>{const _e=tokenToField(ve);return _e?this.num(fe.get(_e),ve.length):ve})(we))}}const Sc=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function combineRegexes(...fe){const ve=fe.reduce(((fe,ve)=>fe+ve.source),"");return RegExp(`^${ve}$`)}function combineExtractors(...fe){return ve=>fe.reduce((([fe,_e,be],we)=>{const[Se,Te,Ee]=we(ve,be);return[{...fe,...Se},Te||_e,Ee]}),[{},null,1]).slice(0,2)}function parse(fe,...ve){if(null==fe)return[null,null];for(const[_e,be]of ve){const ve=_e.exec(fe);if(ve)return be(ve)}return[null,null]}function simpleParse(...fe){return(ve,_e)=>{const be={};let we;for(we=0;we<fe.length;we++)be[fe[we]]=parseInteger(ve[_e+we]);return[be,null,_e+we]}}const Tc=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Ec=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Pc=RegExp(`${Ec.source}${`(?:${Tc.source}?(?:\\[(${Sc.source})\\])?)?`}`),Cc=RegExp(`(?:T${Pc.source})?`),Oc=simpleParse("weekYear","weekNumber","weekDay"),Ac=simpleParse("year","ordinal"),Mc=RegExp(`${Ec.source} ?(?:${Tc.source}|(${Sc.source}))?`),Rc=RegExp(`(?: ${Mc.source})?`);function int(fe,ve,_e){const be=fe[ve];return isUndefined(be)?_e:parseInteger(be)}function extractISOTime(fe,ve){return[{hours:int(fe,ve,0),minutes:int(fe,ve+1,0),seconds:int(fe,ve+2,0),milliseconds:parseMillis(fe[ve+3])},null,ve+4]}function extractISOOffset(fe,ve){const _e=!fe[ve]&&!fe[ve+1],be=signedOffset(fe[ve+1],fe[ve+2]);return[{},_e?null:FixedOffsetZone.instance(be),ve+3]}function extractIANAZone(fe,ve){return[{},fe[ve]?IANAZone.create(fe[ve]):null,ve+1]}const Ic=RegExp(`^T?${Ec.source}$`),Lc=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function extractISODuration(fe){const[ve,_e,be,we,Se,Te,Ee,Ce,Oe]=fe,Re="-"===ve[0],De=Ce&&"-"===Ce[0],maybeNegate=(fe,ve=!1)=>void 0!==fe&&(ve||fe&&Re)?-fe:fe;return[{years:maybeNegate(parseFloating(_e)),months:maybeNegate(parseFloating(be)),weeks:maybeNegate(parseFloating(we)),days:maybeNegate(parseFloating(Se)),hours:maybeNegate(parseFloating(Te)),minutes:maybeNegate(parseFloating(Ee)),seconds:maybeNegate(parseFloating(Ce),"-0"===Ce),milliseconds:maybeNegate(parseMillis(Oe),De)}]}const Dc={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function fromStrings(fe,ve,_e,be,we,Se,Te){const Ee={year:2===ve.length?untruncateYear(parseInteger(ve)):parseInteger(ve),month:fc.indexOf(_e)+1,day:parseInteger(be),hour:parseInteger(we),minute:parseInteger(Se)};return Te&&(Ee.second=parseInteger(Te)),fe&&(Ee.weekday=fe.length>3?yc.indexOf(fe)+1:gc.indexOf(fe)+1),Ee}const Nc=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(fe){const[,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De]=fe,Be=fromStrings(ve,we,be,_e,Se,Te,Ee);let Ze;return Ze=Ce?Dc[Ce]:Oe?0:signedOffset(Re,De),[Be,new FixedOffsetZone(Ze)]}const Fc=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,zc=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,kc=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(fe){const[,ve,_e,be,we,Se,Te,Ee]=fe;return[fromStrings(ve,we,be,_e,Se,Te,Ee),FixedOffsetZone.utcInstance]}function extractASCII(fe){const[,ve,_e,be,we,Se,Te,Ee]=fe;return[fromStrings(ve,Ee,_e,be,we,Se,Te),FixedOffsetZone.utcInstance]}const Uc=combineRegexes(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Cc),Vc=combineRegexes(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Cc),Bc=combineRegexes(/(\d{4})-?(\d{3})/,Cc),jc=combineRegexes(Pc),Gc=combineExtractors((function extractISOYmd(fe,ve){return[{year:int(fe,ve),month:int(fe,ve+1,1),day:int(fe,ve+2,1)},null,ve+3]}),extractISOTime,extractISOOffset,extractIANAZone),Hc=combineExtractors(Oc,extractISOTime,extractISOOffset,extractIANAZone),qc=combineExtractors(Ac,extractISOTime,extractISOOffset,extractIANAZone),Wc=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);const Yc=combineExtractors(extractISOTime);const Zc=combineRegexes(/(\d{4})-(\d\d)-(\d\d)/,Rc),Xc=combineRegexes(Mc),Jc=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);const Qc="Invalid Duration",Kc={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},eu={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...Kc},tu=365.2425,ru=30.436875,iu={years:{quarters:4,months:12,weeks:52.1775,days:tu,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:ru,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...Kc},nu=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],su=nu.slice(0).reverse();function clone$1(fe,ve,_e=!1){const be={values:_e?ve.values:{...fe.values,...ve.values||{}},loc:fe.loc.clone(ve.loc),conversionAccuracy:ve.conversionAccuracy||fe.conversionAccuracy,matrix:ve.matrix||fe.matrix};return new Duration(be)}function durationToMillis(fe,ve){let _e=ve.milliseconds??0;for(const be of su.slice(1))ve[be]&&(_e+=ve[be]*fe[be].milliseconds);return _e}function normalizeValues(fe,ve){const _e=durationToMillis(fe,ve)<0?-1:1;nu.reduceRight(((be,we)=>{if(isUndefined(ve[we]))return be;if(be){const Se=ve[be]*_e,Te=fe[we][be],Ee=Math.floor(Se/Te);ve[we]+=Ee*_e,ve[be]-=Ee*Te*_e}return we}),null),nu.reduce(((_e,be)=>{if(isUndefined(ve[be]))return _e;if(_e){const we=ve[_e]%1;ve[_e]-=we,ve[be]+=we*fe[_e][be]}return be}),null)}class Duration{constructor(fe){const ve="longterm"===fe.conversionAccuracy||!1;let _e=ve?iu:eu;fe.matrix&&(_e=fe.matrix),this.values=fe.values,this.loc=fe.loc||Locale.create(),this.conversionAccuracy=ve?"longterm":"casual",this.invalid=fe.invalid||null,this.matrix=_e,this.isLuxonDuration=!0}static fromMillis(fe,ve){return Duration.fromObject({milliseconds:fe},ve)}static fromObject(fe,ve={}){if(null==fe||"object"!=typeof fe)throw new InvalidArgumentError("Duration.fromObject: argument expected to be an object, got "+(null===fe?"null":typeof fe));return new Duration({values:normalizeObject(fe,Duration.normalizeUnit),loc:Locale.fromObject(ve),conversionAccuracy:ve.conversionAccuracy,matrix:ve.matrix})}static fromDurationLike(fe){if(isNumber(fe))return Duration.fromMillis(fe);if(Duration.isDuration(fe))return fe;if("object"==typeof fe)return Duration.fromObject(fe);throw new InvalidArgumentError(`Unknown duration argument ${fe} of type ${typeof fe}`)}static fromISO(fe,ve){const[_e]=function parseISODuration(fe){return parse(fe,[Lc,extractISODuration])}(fe);return _e?Duration.fromObject(_e,ve):Duration.invalid("unparsable",`the input "${fe}" can't be parsed as ISO 8601`)}static fromISOTime(fe,ve){const[_e]=function parseISOTimeOnly(fe){return parse(fe,[Ic,Yc])}(fe);return _e?Duration.fromObject(_e,ve):Duration.invalid("unparsable",`the input "${fe}" can't be parsed as ISO 8601`)}static invalid(fe,ve=null){if(!fe)throw new InvalidArgumentError("need to specify a reason the Duration is invalid");const _e=fe instanceof Invalid?fe:new Invalid(fe,ve);if(Settings.throwOnInvalid)throw new InvalidDurationError(_e);return new Duration({invalid:_e})}static normalizeUnit(fe){const ve={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[fe?fe.toLowerCase():fe];if(!ve)throw new InvalidUnitError(fe);return ve}static isDuration(fe){return fe&&fe.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(fe,ve={}){const _e={...ve,floor:!1!==ve.round&&!1!==ve.floor};return this.isValid?Formatter.create(this.loc,_e).formatDurationFromString(this,fe):Qc}toHuman(fe={}){if(!this.isValid)return Qc;const ve=nu.map((ve=>{const _e=this.values[ve];return isUndefined(_e)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...fe,unit:ve.slice(0,-1)}).format(_e)})).filter((fe=>fe));return this.loc.listFormatter({type:"conjunction",style:fe.listStyle||"narrow",...fe}).format(ve)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let fe="P";return 0!==this.years&&(fe+=this.years+"Y"),0===this.months&&0===this.quarters||(fe+=this.months+3*this.quarters+"M"),0!==this.weeks&&(fe+=this.weeks+"W"),0!==this.days&&(fe+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(fe+="T"),0!==this.hours&&(fe+=this.hours+"H"),0!==this.minutes&&(fe+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(fe+=roundTo(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===fe&&(fe+="T0S"),fe}toISOTime(fe={}){if(!this.isValid)return null;const ve=this.toMillis();if(ve<0||ve>=864e5)return null;fe={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...fe,includeOffset:!1};return DateTime.fromMillis(ve,{zone:"UTC"}).toISOTime(fe)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?durationToMillis(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(fe){if(!this.isValid)return this;const ve=Duration.fromDurationLike(fe),_e={};for(const be of nu)(hasOwnProperty(ve.values,be)||hasOwnProperty(this.values,be))&&(_e[be]=ve.get(be)+this.get(be));return clone$1(this,{values:_e},!0)}minus(fe){if(!this.isValid)return this;const ve=Duration.fromDurationLike(fe);return this.plus(ve.negate())}mapUnits(fe){if(!this.isValid)return this;const ve={};for(const _e of Object.keys(this.values))ve[_e]=asNumber(fe(this.values[_e],_e));return clone$1(this,{values:ve},!0)}get(fe){return this[Duration.normalizeUnit(fe)]}set(fe){if(!this.isValid)return this;return clone$1(this,{values:{...this.values,...normalizeObject(fe,Duration.normalizeUnit)}})}reconfigure({locale:fe,numberingSystem:ve,conversionAccuracy:_e,matrix:be}={}){return clone$1(this,{loc:this.loc.clone({locale:fe,numberingSystem:ve}),matrix:be,conversionAccuracy:_e})}as(fe){return this.isValid?this.shiftTo(fe).get(fe):NaN}normalize(){if(!this.isValid)return this;const fe=this.toObject();return normalizeValues(this.matrix,fe),clone$1(this,{values:fe},!0)}rescale(){if(!this.isValid)return this;return clone$1(this,{values:function removeZeroes(fe){const ve={};for(const[_e,be]of Object.entries(fe))0!==be&&(ve[_e]=be);return ve}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...fe){if(!this.isValid)return this;if(0===fe.length)return this;fe=fe.map((fe=>Duration.normalizeUnit(fe)));const ve={},_e={},be=this.toObject();let we;for(const Se of nu)if(fe.indexOf(Se)>=0){we=Se;let fe=0;for(const ve in _e)fe+=this.matrix[ve][Se]*_e[ve],_e[ve]=0;isNumber(be[Se])&&(fe+=be[Se]);const Te=Math.trunc(fe);ve[Se]=Te,_e[Se]=(1e3*fe-1e3*Te)/1e3}else isNumber(be[Se])&&(_e[Se]=be[Se]);for(const Se in _e)0!==_e[Se]&&(ve[we]+=Se===we?_e[Se]:_e[Se]/this.matrix[we][Se]);return normalizeValues(this.matrix,ve),clone$1(this,{values:ve},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const fe={};for(const ve of Object.keys(this.values))fe[ve]=0===this.values[ve]?0:-this.values[ve];return clone$1(this,{values:fe},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(fe){if(!this.isValid||!fe.isValid)return!1;if(!this.loc.equals(fe.loc))return!1;for(const be of nu)if(ve=this.values[be],_e=fe.values[be],!(void 0===ve||0===ve?void 0===_e||0===_e:ve===_e))return!1;var ve,_e;return!0}}const ou="Invalid Interval";class Interval{constructor(fe){this.s=fe.start,this.e=fe.end,this.invalid=fe.invalid||null,this.isLuxonInterval=!0}static invalid(fe,ve=null){if(!fe)throw new InvalidArgumentError("need to specify a reason the Interval is invalid");const _e=fe instanceof Invalid?fe:new Invalid(fe,ve);if(Settings.throwOnInvalid)throw new InvalidIntervalError(_e);return new Interval({invalid:_e})}static fromDateTimes(fe,ve){const _e=friendlyDateTime(fe),be=friendlyDateTime(ve),we=function validateStartEnd(fe,ve){return fe&&fe.isValid?ve&&ve.isValid?ve<fe?Interval.invalid("end before start",`The end of an interval must be after its start, but you had start=${fe.toISO()} and end=${ve.toISO()}`):null:Interval.invalid("missing or invalid end"):Interval.invalid("missing or invalid start")}(_e,be);return null==we?new Interval({start:_e,end:be}):we}static after(fe,ve){const _e=Duration.fromDurationLike(ve),be=friendlyDateTime(fe);return Interval.fromDateTimes(be,be.plus(_e))}static before(fe,ve){const _e=Duration.fromDurationLike(ve),be=friendlyDateTime(fe);return Interval.fromDateTimes(be.minus(_e),be)}static fromISO(fe,ve){const[_e,be]=(fe||"").split("/",2);if(_e&&be){let fe,Se,Te,Ee;try{fe=DateTime.fromISO(_e,ve),Se=fe.isValid}catch(we){Se=!1}try{Te=DateTime.fromISO(be,ve),Ee=Te.isValid}catch(we){Ee=!1}if(Se&&Ee)return Interval.fromDateTimes(fe,Te);if(Se){const _e=Duration.fromISO(be,ve);if(_e.isValid)return Interval.after(fe,_e)}else if(Ee){const fe=Duration.fromISO(_e,ve);if(fe.isValid)return Interval.before(Te,fe)}}return Interval.invalid("unparsable",`the input "${fe}" can't be parsed as ISO 8601`)}static isInterval(fe){return fe&&fe.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(fe="milliseconds"){return this.isValid?this.toDuration(fe).get(fe):NaN}count(fe="milliseconds",ve){if(!this.isValid)return NaN;const _e=this.start.startOf(fe,ve);let be;return be=(null==ve?void 0:ve.useLocaleWeeks)?this.end.reconfigure({locale:_e.locale}):this.end,be=be.startOf(fe,ve),Math.floor(be.diff(_e,fe).get(fe))+(be.valueOf()!==this.end.valueOf())}hasSame(fe){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,fe))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(fe){return!!this.isValid&&this.s>fe}isBefore(fe){return!!this.isValid&&this.e<=fe}contains(fe){return!!this.isValid&&(this.s<=fe&&this.e>fe)}set({start:fe,end:ve}={}){return this.isValid?Interval.fromDateTimes(fe||this.s,ve||this.e):this}splitAt(...fe){if(!this.isValid)return[];const ve=fe.map(friendlyDateTime).filter((fe=>this.contains(fe))).sort(((fe,ve)=>fe.toMillis()-ve.toMillis())),_e=[];let{s:be}=this,we=0;for(;be<this.e;){const fe=ve[we]||this.e,Se=+fe>+this.e?this.e:fe;_e.push(Interval.fromDateTimes(be,Se)),be=Se,we+=1}return _e}splitBy(fe){const ve=Duration.fromDurationLike(fe);if(!this.isValid||!ve.isValid||0===ve.as("milliseconds"))return[];let _e,{s:be}=this,we=1;const Se=[];for(;be<this.e;){const fe=this.start.plus(ve.mapUnits((fe=>fe*we)));_e=+fe>+this.e?this.e:fe,Se.push(Interval.fromDateTimes(be,_e)),be=_e,we+=1}return Se}divideEqually(fe){return this.isValid?this.splitBy(this.length()/fe).slice(0,fe):[]}overlaps(fe){return this.e>fe.s&&this.s<fe.e}abutsStart(fe){return!!this.isValid&&+this.e==+fe.s}abutsEnd(fe){return!!this.isValid&&+fe.e==+this.s}engulfs(fe){return!!this.isValid&&(this.s<=fe.s&&this.e>=fe.e)}equals(fe){return!(!this.isValid||!fe.isValid)&&(this.s.equals(fe.s)&&this.e.equals(fe.e))}intersection(fe){if(!this.isValid)return this;const ve=this.s>fe.s?this.s:fe.s,_e=this.e<fe.e?this.e:fe.e;return ve>=_e?null:Interval.fromDateTimes(ve,_e)}union(fe){if(!this.isValid)return this;const ve=this.s<fe.s?this.s:fe.s,_e=this.e>fe.e?this.e:fe.e;return Interval.fromDateTimes(ve,_e)}static merge(fe){const[ve,_e]=fe.sort(((fe,ve)=>fe.s-ve.s)).reduce((([fe,ve],_e)=>ve?ve.overlaps(_e)||ve.abutsStart(_e)?[fe,ve.union(_e)]:[fe.concat([ve]),_e]:[fe,_e]),[[],null]);return _e&&ve.push(_e),ve}static xor(fe){let ve=null,_e=0;const be=[],we=fe.map((fe=>[{time:fe.s,type:"s"},{time:fe.e,type:"e"}])),Se=Array.prototype.concat(...we).sort(((fe,ve)=>fe.time-ve.time));for(const Te of Se)_e+="s"===Te.type?1:-1,1===_e?ve=Te.time:(ve&&+ve!=+Te.time&&be.push(Interval.fromDateTimes(ve,Te.time)),ve=null);return Interval.merge(be)}difference(...fe){return Interval.xor([this].concat(fe)).map((fe=>this.intersection(fe))).filter((fe=>fe&&!fe.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:ou}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(fe=Sl,ve={}){return this.isValid?Formatter.create(this.s.loc.clone(ve),fe).formatInterval(this):ou}toISO(fe){return this.isValid?`${this.s.toISO(fe)}/${this.e.toISO(fe)}`:ou}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:ou}toISOTime(fe){return this.isValid?`${this.s.toISOTime(fe)}/${this.e.toISOTime(fe)}`:ou}toFormat(fe,{separator:ve=" â€“ "}={}){return this.isValid?`${this.s.toFormat(fe)}${ve}${this.e.toFormat(fe)}`:ou}toDuration(fe,ve){return this.isValid?this.e.diff(this.s,fe,ve):Duration.invalid(this.invalidReason)}mapEndpoints(fe){return Interval.fromDateTimes(fe(this.s),fe(this.e))}}class Info{static hasDST(fe=Settings.defaultZone){const ve=DateTime.now().setZone(fe).set({month:12});return!fe.isUniversal&&ve.offset!==ve.set({month:6}).offset}static isValidIANAZone(fe){return IANAZone.isValidZone(fe)}static normalizeZone(fe){return normalizeZone(fe,Settings.defaultZone)}static getStartOfWeek({locale:fe=null,locObj:ve=null}={}){return(ve||Locale.create(fe)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:fe=null,locObj:ve=null}={}){return(ve||Locale.create(fe)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:fe=null,locObj:ve=null}={}){return(ve||Locale.create(fe)).getWeekendDays().slice()}static months(fe="long",{locale:ve=null,numberingSystem:_e=null,locObj:be=null,outputCalendar:we="gregory"}={}){return(be||Locale.create(ve,_e,we)).months(fe)}static monthsFormat(fe="long",{locale:ve=null,numberingSystem:_e=null,locObj:be=null,outputCalendar:we="gregory"}={}){return(be||Locale.create(ve,_e,we)).months(fe,!0)}static weekdays(fe="long",{locale:ve=null,numberingSystem:_e=null,locObj:be=null}={}){return(be||Locale.create(ve,_e,null)).weekdays(fe)}static weekdaysFormat(fe="long",{locale:ve=null,numberingSystem:_e=null,locObj:be=null}={}){return(be||Locale.create(ve,_e,null)).weekdays(fe,!0)}static meridiems({locale:fe=null}={}){return Locale.create(fe).meridiems()}static eras(fe="short",{locale:ve=null}={}){return Locale.create(ve,null,"gregory").eras(fe)}static features(){return{relative:hasRelative(),localeWeek:hasLocaleWeekInfo()}}}function dayDiff(fe,ve){const utcDayStart=fe=>fe.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),_e=utcDayStart(ve)-utcDayStart(fe);return Math.floor(Duration.fromMillis(_e).as("days"))}function diff(fe,ve,_e,be){let[we,Se,Te,Ee]=function highOrderDiffs(fe,ve,_e){const be=[["years",(fe,ve)=>ve.year-fe.year],["quarters",(fe,ve)=>ve.quarter-fe.quarter+4*(ve.year-fe.year)],["months",(fe,ve)=>ve.month-fe.month+12*(ve.year-fe.year)],["weeks",(fe,ve)=>{const _e=dayDiff(fe,ve);return(_e-_e%7)/7}],["days",dayDiff]],we={},Se=fe;let Te,Ee;for(const[Ce,Oe]of be)_e.indexOf(Ce)>=0&&(Te=Ce,we[Ce]=Oe(fe,ve),Ee=Se.plus(we),Ee>ve?(we[Ce]--,(fe=Se.plus(we))>ve&&(Ee=fe,we[Ce]--,fe=Se.plus(we))):fe=Ee);return[fe,we,Ee,Te]}(fe,ve,_e);const Ce=ve-we,Oe=_e.filter((fe=>["hours","minutes","seconds","milliseconds"].indexOf(fe)>=0));0===Oe.length&&(Te<ve&&(Te=we.plus({[Ee]:1})),Te!==we&&(Se[Ee]=(Se[Ee]||0)+Ce/(Te-we)));const Re=Duration.fromObject(Se,be);return Oe.length>0?Duration.fromMillis(Ce,be).shiftTo(...Oe).plus(Re):Re}const au={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},lu={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},cu=au.hanidec.replace(/[\[|\]]/g,"").split("");function digitRegex({numberingSystem:fe},ve=""){return new RegExp(`${au[fe||"latn"]}${ve}`)}const uu="missing Intl.DateTimeFormat.formatToParts support";function intUnit(fe,ve=fe=>fe){return{regex:fe,deser:([fe])=>ve(function parseDigits(fe){let ve=parseInt(fe,10);if(isNaN(ve)){ve="";for(let _e=0;_e<fe.length;_e++){const be=fe.charCodeAt(_e);if(-1!==fe[_e].search(au.hanidec))ve+=cu.indexOf(fe[_e]);else for(const fe in lu){const[_e,we]=lu[fe];be>=_e&&be<=we&&(ve+=be-_e)}}return parseInt(ve,10)}return ve}(fe))}}const hu=`[ ${String.fromCharCode(160)}]`,du=new RegExp(hu,"g");function fixListRegex(fe){return fe.replace(/\./g,"\\.?").replace(du,hu)}function stripInsensitivities(fe){return fe.replace(/\./g,"").replace(du," ").toLowerCase()}function oneOf(fe,ve){return null===fe?null:{regex:RegExp(fe.map(fixListRegex).join("|")),deser:([_e])=>fe.findIndex((fe=>stripInsensitivities(_e)===stripInsensitivities(fe)))+ve}}function offset(fe,ve){return{regex:fe,deser:([,fe,ve])=>signedOffset(fe,ve),groups:ve}}function simple(fe){return{regex:fe,deser:([fe])=>fe}}const pu={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let fu=null;function expandMacroTokens(fe,ve){return Array.prototype.concat(...fe.map((fe=>function maybeExpandMacroToken(fe,ve){if(fe.literal)return fe;const _e=formatOptsToTokens(Formatter.macroTokenToFormatOpts(fe.val),ve);return null==_e||_e.includes(void 0)?fe:_e}(fe,ve))))}function explainFromTokens(fe,ve,_e){const be=expandMacroTokens(Formatter.parseFormat(_e),fe),we=be.map((ve=>function unitForToken(fe,ve){const _e=digitRegex(ve),be=digitRegex(ve,"{2}"),we=digitRegex(ve,"{3}"),Se=digitRegex(ve,"{4}"),Te=digitRegex(ve,"{6}"),Ee=digitRegex(ve,"{1,2}"),Ce=digitRegex(ve,"{1,3}"),Oe=digitRegex(ve,"{1,6}"),Re=digitRegex(ve,"{1,9}"),De=digitRegex(ve,"{2,4}"),Be=digitRegex(ve,"{4,6}"),literal=fe=>{return{regex:RegExp((ve=fe.val,ve.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([fe])=>fe,literal:!0};var ve},Ze=(Ze=>{if(fe.literal)return literal(Ze);switch(Ze.val){case"G":return oneOf(ve.eras("short"),0);case"GG":return oneOf(ve.eras("long"),0);case"y":return intUnit(Oe);case"yy":case"kk":return intUnit(De,untruncateYear);case"yyyy":case"kkkk":return intUnit(Se);case"yyyyy":return intUnit(Be);case"yyyyyy":return intUnit(Te);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return intUnit(Ee);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return intUnit(be);case"MMM":return oneOf(ve.months("short",!0),1);case"MMMM":return oneOf(ve.months("long",!0),1);case"LLL":return oneOf(ve.months("short",!1),1);case"LLLL":return oneOf(ve.months("long",!1),1);case"o":case"S":return intUnit(Ce);case"ooo":case"SSS":return intUnit(we);case"u":return simple(Re);case"uu":return simple(Ee);case"uuu":case"E":case"c":return intUnit(_e);case"a":return oneOf(ve.meridiems(),0);case"EEE":return oneOf(ve.weekdays("short",!1),1);case"EEEE":return oneOf(ve.weekdays("long",!1),1);case"ccc":return oneOf(ve.weekdays("short",!0),1);case"cccc":return oneOf(ve.weekdays("long",!0),1);case"Z":case"ZZ":return offset(new RegExp(`([+-]${Ee.source})(?::(${be.source}))?`),2);case"ZZZ":return offset(new RegExp(`([+-]${Ee.source})(${be.source})?`),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);case" ":return simple(/[^\S\n\r]/);default:return literal(Ze)}})(fe)||{invalidReason:uu};return Ze.token=fe,Ze}(ve,fe))),Se=we.find((fe=>fe.invalidReason));if(Se)return{input:ve,tokens:be,invalidReason:Se.invalidReason};{const[fe,_e]=function buildRegex(fe){const ve=fe.map((fe=>fe.regex)).reduce(((fe,ve)=>`${fe}(${ve.source})`),"");return[`^${ve}$`,fe]}(we),Se=RegExp(fe,"i"),[Te,Ee]=function match(fe,ve,_e){const be=fe.match(ve);if(be){const fe={};let ve=1;for(const we in _e)if(hasOwnProperty(_e,we)){const Se=_e[we],Te=Se.groups?Se.groups+1:1;!Se.literal&&Se.token&&(fe[Se.token.val[0]]=Se.deser(be.slice(ve,ve+Te))),ve+=Te}return[be,fe]}return[be,{}]}(ve,Se,_e),[Ce,Oe,Re]=Ee?function dateTimeFromMatches(fe){let ve,_e=null;isUndefined(fe.z)||(_e=IANAZone.create(fe.z)),isUndefined(fe.Z)||(_e||(_e=new FixedOffsetZone(fe.Z)),ve=fe.Z),isUndefined(fe.q)||(fe.M=3*(fe.q-1)+1),isUndefined(fe.h)||(fe.h<12&&1===fe.a?fe.h+=12:12===fe.h&&0===fe.a&&(fe.h=0)),0===fe.G&&fe.y&&(fe.y=-fe.y),isUndefined(fe.u)||(fe.S=parseMillis(fe.u));const be=Object.keys(fe).reduce(((ve,_e)=>{const be=(fe=>{switch(fe){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(_e);return be&&(ve[be]=fe[_e]),ve}),{});return[be,_e,ve]}(Ee):[null,null,void 0];if(hasOwnProperty(Ee,"a")&&hasOwnProperty(Ee,"H"))throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:ve,tokens:be,regex:Se,rawMatches:Te,matches:Ee,result:Ce,zone:Oe,specificOffset:Re}}}function formatOptsToTokens(fe,ve){if(!fe)return null;const _e=Formatter.create(ve,fe).dtFormatter(function getDummyDateTime(){return fu||(fu=DateTime.fromMillis(1555555555555)),fu}()),be=_e.formatToParts(),we=_e.resolvedOptions();return be.map((ve=>function tokenForPart(fe,ve,_e){const{type:be,value:we}=fe;if("literal"===be){const fe=/^\s+$/.test(we);return{literal:!fe,val:fe?" ":we}}const Se=ve[be];let Te=be;"hour"===be&&(Te=null!=ve.hour12?ve.hour12?"hour12":"hour24":null!=ve.hourCycle?"h11"===ve.hourCycle||"h12"===ve.hourCycle?"hour12":"hour24":_e.hour12?"hour12":"hour24");let Ee=pu[Te];if("object"==typeof Ee&&(Ee=Ee[Se]),Ee)return{literal:!1,val:Ee}}(ve,fe,we)))}const mu="Invalid DateTime",yu=864e13;function unsupportedZone(fe){return new Invalid("unsupported zone",`the zone "${fe.name}" is not supported`)}function possiblyCachedWeekData(fe){return null===fe.weekData&&(fe.weekData=gregorianToWeek(fe.c)),fe.weekData}function possiblyCachedLocalWeekData(fe){return null===fe.localWeekData&&(fe.localWeekData=gregorianToWeek(fe.c,fe.loc.getMinDaysInFirstWeek(),fe.loc.getStartOfWeek())),fe.localWeekData}function clone(fe,ve){const _e={ts:fe.ts,zone:fe.zone,c:fe.c,o:fe.o,loc:fe.loc,invalid:fe.invalid};return new DateTime({..._e,...ve,old:_e})}function fixOffset(fe,ve,_e){let be=fe-60*ve*1e3;const we=_e.offset(be);if(ve===we)return[be,ve];be-=60*(we-ve)*1e3;const Se=_e.offset(be);return we===Se?[be,we]:[fe-60*Math.min(we,Se)*1e3,Math.max(we,Se)]}function tsToObj(fe,ve){const _e=new Date(fe+=60*ve*1e3);return{year:_e.getUTCFullYear(),month:_e.getUTCMonth()+1,day:_e.getUTCDate(),hour:_e.getUTCHours(),minute:_e.getUTCMinutes(),second:_e.getUTCSeconds(),millisecond:_e.getUTCMilliseconds()}}function objToTS(fe,ve,_e){return fixOffset(objToLocalTS(fe),ve,_e)}function adjustTime(fe,ve){const _e=fe.o,be=fe.c.year+Math.trunc(ve.years),we=fe.c.month+Math.trunc(ve.months)+3*Math.trunc(ve.quarters),Se={...fe.c,year:be,month:we,day:Math.min(fe.c.day,daysInMonth(be,we))+Math.trunc(ve.days)+7*Math.trunc(ve.weeks)},Te=Duration.fromObject({years:ve.years-Math.trunc(ve.years),quarters:ve.quarters-Math.trunc(ve.quarters),months:ve.months-Math.trunc(ve.months),weeks:ve.weeks-Math.trunc(ve.weeks),days:ve.days-Math.trunc(ve.days),hours:ve.hours,minutes:ve.minutes,seconds:ve.seconds,milliseconds:ve.milliseconds}).as("milliseconds"),Ee=objToLocalTS(Se);let[Ce,Oe]=fixOffset(Ee,_e,fe.zone);return 0!==Te&&(Ce+=Te,Oe=fe.zone.offset(Ce)),{ts:Ce,o:Oe}}function parseDataToDateTime(fe,ve,_e,be,we,Se){const{setZone:Te,zone:Ee}=_e;if(fe&&0!==Object.keys(fe).length||ve){const be=ve||Ee,we=DateTime.fromObject(fe,{..._e,zone:be,specificOffset:Se});return Te?we:we.setZone(Ee)}return DateTime.invalid(new Invalid("unparsable",`the input "${we}" can't be parsed as ${be}`))}function toTechFormat(fe,ve,_e=!0){return fe.isValid?Formatter.create(Locale.create("en-US"),{allowZ:_e,forceSimple:!0}).formatDateTimeFromString(fe,ve):null}function toISODate(fe,ve){const _e=fe.c.year>9999||fe.c.year<0;let be="";return _e&&fe.c.year>=0&&(be+="+"),be+=padStart(fe.c.year,_e?6:4),ve?(be+="-",be+=padStart(fe.c.month),be+="-",be+=padStart(fe.c.day)):(be+=padStart(fe.c.month),be+=padStart(fe.c.day)),be}function toISOTime(fe,ve,_e,be,we,Se){let Te=padStart(fe.c.hour);return ve?(Te+=":",Te+=padStart(fe.c.minute),0===fe.c.millisecond&&0===fe.c.second&&_e||(Te+=":")):Te+=padStart(fe.c.minute),0===fe.c.millisecond&&0===fe.c.second&&_e||(Te+=padStart(fe.c.second),0===fe.c.millisecond&&be||(Te+=".",Te+=padStart(fe.c.millisecond,3))),we&&(fe.isOffsetFixed&&0===fe.offset&&!Se?Te+="Z":fe.o<0?(Te+="-",Te+=padStart(Math.trunc(-fe.o/60)),Te+=":",Te+=padStart(Math.trunc(-fe.o%60))):(Te+="+",Te+=padStart(Math.trunc(fe.o/60)),Te+=":",Te+=padStart(Math.trunc(fe.o%60)))),Se&&(Te+="["+fe.zone.ianaName+"]"),Te}const gu={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},vu={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},_u={ordinal:1,hour:0,minute:0,second:0,millisecond:0},$u=["year","month","day","hour","minute","second","millisecond"],bu=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],wu=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnitWithLocalWeeks(fe){switch(fe.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function normalizeUnit(fe){const ve={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[fe.toLowerCase()];if(!ve)throw new InvalidUnitError(fe);return ve}(fe)}}function quickDT(fe,ve){const _e=normalizeZone(ve.zone,Settings.defaultZone),be=Locale.fromObject(ve),we=Settings.now();let Se,Te;if(isUndefined(fe.year))Se=we;else{for(const _e of $u)isUndefined(fe[_e])&&(fe[_e]=gu[_e]);const ve=hasInvalidGregorianData(fe)||hasInvalidTimeData(fe);if(ve)return DateTime.invalid(ve);const be=_e.offset(we);[Se,Te]=objToTS(fe,be,_e)}return new DateTime({ts:Se,zone:_e,loc:be,o:Te})}function diffRelative(fe,ve,_e){const be=!!isUndefined(_e.round)||_e.round,format=(fe,we)=>{fe=roundTo(fe,be||_e.calendary?0:2,!0);return ve.loc.clone(_e).relFormatter(_e).format(fe,we)},differ=be=>_e.calendary?ve.hasSame(fe,be)?0:ve.startOf(be).diff(fe.startOf(be),be).get(be):ve.diff(fe,be).get(be);if(_e.unit)return format(differ(_e.unit),_e.unit);for(const we of _e.units){const fe=differ(we);if(Math.abs(fe)>=1)return format(fe,we)}return format(fe>ve?-0:0,_e.units[_e.units.length-1])}function lastOpts(fe){let ve,_e={};return fe.length>0&&"object"==typeof fe[fe.length-1]?(_e=fe[fe.length-1],ve=Array.from(fe).slice(0,fe.length-1)):ve=Array.from(fe),[_e,ve]}class DateTime{constructor(fe){const ve=fe.zone||Settings.defaultZone;let _e=fe.invalid||(Number.isNaN(fe.ts)?new Invalid("invalid input"):null)||(ve.isValid?null:unsupportedZone(ve));this.ts=isUndefined(fe.ts)?Settings.now():fe.ts;let be=null,we=null;if(!_e){if(fe.old&&fe.old.ts===this.ts&&fe.old.zone.equals(ve))[be,we]=[fe.old.c,fe.old.o];else{const fe=ve.offset(this.ts);be=tsToObj(this.ts,fe),_e=Number.isNaN(be.year)?new Invalid("invalid input"):null,be=_e?null:be,we=_e?null:fe}}this._zone=ve,this.loc=fe.loc||Locale.create(),this.invalid=_e,this.weekData=null,this.localWeekData=null,this.c=be,this.o=we,this.isLuxonDateTime=!0}static now(){return new DateTime({})}static local(){const[fe,ve]=lastOpts(arguments),[_e,be,we,Se,Te,Ee,Ce]=ve;return quickDT({year:_e,month:be,day:we,hour:Se,minute:Te,second:Ee,millisecond:Ce},fe)}static utc(){const[fe,ve]=lastOpts(arguments),[_e,be,we,Se,Te,Ee,Ce]=ve;return fe.zone=FixedOffsetZone.utcInstance,quickDT({year:_e,month:be,day:we,hour:Se,minute:Te,second:Ee,millisecond:Ce},fe)}static fromJSDate(fe,ve={}){const _e=function isDate(fe){return"[object Date]"===Object.prototype.toString.call(fe)}(fe)?fe.valueOf():NaN;if(Number.isNaN(_e))return DateTime.invalid("invalid input");const be=normalizeZone(ve.zone,Settings.defaultZone);return be.isValid?new DateTime({ts:_e,zone:be,loc:Locale.fromObject(ve)}):DateTime.invalid(unsupportedZone(be))}static fromMillis(fe,ve={}){if(isNumber(fe))return fe<-yu||fe>yu?DateTime.invalid("Timestamp out of range"):new DateTime({ts:fe,zone:normalizeZone(ve.zone,Settings.defaultZone),loc:Locale.fromObject(ve)});throw new InvalidArgumentError(`fromMillis requires a numerical input, but received a ${typeof fe} with value ${fe}`)}static fromSeconds(fe,ve={}){if(isNumber(fe))return new DateTime({ts:1e3*fe,zone:normalizeZone(ve.zone,Settings.defaultZone),loc:Locale.fromObject(ve)});throw new InvalidArgumentError("fromSeconds requires a numerical input")}static fromObject(fe,ve={}){fe=fe||{};const _e=normalizeZone(ve.zone,Settings.defaultZone);if(!_e.isValid)return DateTime.invalid(unsupportedZone(_e));const be=Locale.fromObject(ve),we=normalizeObject(fe,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:Se,startOfWeek:Te}=usesLocalWeekValues(we,be),Ee=Settings.now(),Ce=isUndefined(ve.specificOffset)?_e.offset(Ee):ve.specificOffset,Oe=!isUndefined(we.ordinal),Re=!isUndefined(we.year),De=!isUndefined(we.month)||!isUndefined(we.day),Be=Re||De,Ze=we.weekYear||we.weekNumber;if((Be||Oe)&&Ze)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(De&&Oe)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");const Xe=Ze||we.weekday&&!Be;let Je,Qe,dt=tsToObj(Ee,Ce);Xe?(Je=bu,Qe=vu,dt=gregorianToWeek(dt,Se,Te)):Oe?(Je=wu,Qe=_u,dt=gregorianToOrdinal(dt)):(Je=$u,Qe=gu);let $t=!1;for(const Ot of Je){isUndefined(we[Ot])?we[Ot]=$t?Qe[Ot]:dt[Ot]:$t=!0}const bt=Xe?function hasInvalidWeekData(fe,ve=4,_e=1){const be=isInteger(fe.weekYear),we=integerBetween(fe.weekNumber,1,weeksInWeekYear(fe.weekYear,ve,_e)),Se=integerBetween(fe.weekday,1,7);return be?we?!Se&&unitOutOfRange("weekday",fe.weekday):unitOutOfRange("week",fe.weekNumber):unitOutOfRange("weekYear",fe.weekYear)}(we,Se,Te):Oe?function hasInvalidOrdinalData(fe){const ve=isInteger(fe.year),_e=integerBetween(fe.ordinal,1,daysInYear(fe.year));return ve?!_e&&unitOutOfRange("ordinal",fe.ordinal):unitOutOfRange("year",fe.year)}(we):hasInvalidGregorianData(we),wt=bt||hasInvalidTimeData(we);if(wt)return DateTime.invalid(wt);const xt=Xe?weekToGregorian(we,Se,Te):Oe?ordinalToGregorian(we):we,[St,Et]=objToTS(xt,Ce,_e),Pt=new DateTime({ts:St,zone:_e,o:Et,loc:be});return we.weekday&&Be&&fe.weekday!==Pt.weekday?DateTime.invalid("mismatched weekday",`you can't specify both a weekday of ${we.weekday} and a date of ${Pt.toISO()}`):Pt}static fromISO(fe,ve={}){const[_e,be]=function parseISODate(fe){return parse(fe,[Uc,Gc],[Vc,Hc],[Bc,qc],[jc,Wc])}(fe);return parseDataToDateTime(_e,be,ve,"ISO 8601",fe)}static fromRFC2822(fe,ve={}){const[_e,be]=function parseRFC2822Date(fe){return parse(function preprocessRFC2822(fe){return fe.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(fe),[Nc,extractRFC2822])}(fe);return parseDataToDateTime(_e,be,ve,"RFC 2822",fe)}static fromHTTP(fe,ve={}){const[_e,be]=function parseHTTPDate(fe){return parse(fe,[Fc,extractRFC1123Or850],[zc,extractRFC1123Or850],[kc,extractASCII])}(fe);return parseDataToDateTime(_e,be,ve,"HTTP",ve)}static fromFormat(fe,ve,_e={}){if(isUndefined(fe)||isUndefined(ve))throw new InvalidArgumentError("fromFormat requires an input string and a format");const{locale:be=null,numberingSystem:we=null}=_e,Se=Locale.fromOpts({locale:be,numberingSystem:we,defaultToEN:!0}),[Te,Ee,Ce,Oe]=function parseFromTokens(fe,ve,_e){const{result:be,zone:we,specificOffset:Se,invalidReason:Te}=explainFromTokens(fe,ve,_e);return[be,we,Se,Te]}(Se,fe,ve);return Oe?DateTime.invalid(Oe):parseDataToDateTime(Te,Ee,_e,`format ${ve}`,fe,Ce)}static fromString(fe,ve,_e={}){return DateTime.fromFormat(fe,ve,_e)}static fromSQL(fe,ve={}){const[_e,be]=function parseSQL(fe){return parse(fe,[Zc,Gc],[Xc,Jc])}(fe);return parseDataToDateTime(_e,be,ve,"SQL",fe)}static invalid(fe,ve=null){if(!fe)throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");const _e=fe instanceof Invalid?fe:new Invalid(fe,ve);if(Settings.throwOnInvalid)throw new InvalidDateTimeError(_e);return new DateTime({invalid:_e})}static isDateTime(fe){return fe&&fe.isLuxonDateTime||!1}static parseFormatForOpts(fe,ve={}){const _e=formatOptsToTokens(fe,Locale.fromObject(ve));return _e?_e.map((fe=>fe?fe.val:null)).join(""):null}static expandFormat(fe,ve={}){return expandMacroTokens(Formatter.parseFormat(fe),Locale.fromObject(ve)).map((fe=>fe.val)).join("")}get(fe){return this[fe]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN}get weekNumber(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN}get weekday(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?possiblyCachedLocalWeekData(this).weekday:NaN}get localWeekNumber(){return this.isValid?possiblyCachedLocalWeekData(this).weekNumber:NaN}get localWeekYear(){return this.isValid?possiblyCachedLocalWeekData(this).weekYear:NaN}get ordinal(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN}get monthShort(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const fe=864e5,ve=6e4,_e=objToLocalTS(this.c),be=this.zone.offset(_e-fe),we=this.zone.offset(_e+fe),Se=this.zone.offset(_e-be*ve),Te=this.zone.offset(_e-we*ve);if(Se===Te)return[this];const Ee=_e-Se*ve,Ce=_e-Te*ve,Oe=tsToObj(Ee,Se),Re=tsToObj(Ce,Te);return Oe.hour===Re.hour&&Oe.minute===Re.minute&&Oe.second===Re.second&&Oe.millisecond===Re.millisecond?[clone(this,{ts:Ee}),clone(this,{ts:Ce})]:[this]}get isInLeapYear(){return isLeapYear(this.year)}get daysInMonth(){return daysInMonth(this.year,this.month)}get daysInYear(){return this.isValid?daysInYear(this.year):NaN}get weeksInWeekYear(){return this.isValid?weeksInWeekYear(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?weeksInWeekYear(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(fe={}){const{locale:ve,numberingSystem:_e,calendar:be}=Formatter.create(this.loc.clone(fe),fe).resolvedOptions(this);return{locale:ve,numberingSystem:_e,outputCalendar:be}}toUTC(fe=0,ve={}){return this.setZone(FixedOffsetZone.instance(fe),ve)}toLocal(){return this.setZone(Settings.defaultZone)}setZone(fe,{keepLocalTime:ve=!1,keepCalendarTime:_e=!1}={}){if((fe=normalizeZone(fe,Settings.defaultZone)).equals(this.zone))return this;if(fe.isValid){let be=this.ts;if(ve||_e){const ve=fe.offset(this.ts),_e=this.toObject();[be]=objToTS(_e,ve,fe)}return clone(this,{ts:be,zone:fe})}return DateTime.invalid(unsupportedZone(fe))}reconfigure({locale:fe,numberingSystem:ve,outputCalendar:_e}={}){return clone(this,{loc:this.loc.clone({locale:fe,numberingSystem:ve,outputCalendar:_e})})}setLocale(fe){return this.reconfigure({locale:fe})}set(fe){if(!this.isValid)return this;const ve=normalizeObject(fe,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:_e,startOfWeek:be}=usesLocalWeekValues(ve,this.loc),we=!isUndefined(ve.weekYear)||!isUndefined(ve.weekNumber)||!isUndefined(ve.weekday),Se=!isUndefined(ve.ordinal),Te=!isUndefined(ve.year),Ee=!isUndefined(ve.month)||!isUndefined(ve.day),Ce=Te||Ee,Oe=ve.weekYear||ve.weekNumber;if((Ce||Se)&&Oe)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Ee&&Se)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");let Re;we?Re=weekToGregorian({...gregorianToWeek(this.c,_e,be),...ve},_e,be):isUndefined(ve.ordinal)?(Re={...this.toObject(),...ve},isUndefined(ve.day)&&(Re.day=Math.min(daysInMonth(Re.year,Re.month),Re.day))):Re=ordinalToGregorian({...gregorianToOrdinal(this.c),...ve});const[De,Be]=objToTS(Re,this.o,this.zone);return clone(this,{ts:De,o:Be})}plus(fe){if(!this.isValid)return this;return clone(this,adjustTime(this,Duration.fromDurationLike(fe)))}minus(fe){if(!this.isValid)return this;return clone(this,adjustTime(this,Duration.fromDurationLike(fe).negate()))}startOf(fe,{useLocaleWeeks:ve=!1}={}){if(!this.isValid)return this;const _e={},be=Duration.normalizeUnit(fe);switch(be){case"years":_e.month=1;case"quarters":case"months":_e.day=1;case"weeks":case"days":_e.hour=0;case"hours":_e.minute=0;case"minutes":_e.second=0;case"seconds":_e.millisecond=0}if("weeks"===be)if(ve){const fe=this.loc.getStartOfWeek(),{weekday:ve}=this;ve<fe&&(_e.weekNumber=this.weekNumber-1),_e.weekday=fe}else _e.weekday=1;if("quarters"===be){const fe=Math.ceil(this.month/3);_e.month=3*(fe-1)+1}return this.set(_e)}endOf(fe,ve){return this.isValid?this.plus({[fe]:1}).startOf(fe,ve).minus(1):this}toFormat(fe,ve={}){return this.isValid?Formatter.create(this.loc.redefaultToEN(ve)).formatDateTimeFromString(this,fe):mu}toLocaleString(fe=Sl,ve={}){return this.isValid?Formatter.create(this.loc.clone(ve),fe).formatDateTime(this):mu}toLocaleParts(fe={}){return this.isValid?Formatter.create(this.loc.clone(fe),fe).formatDateTimeParts(this):[]}toISO({format:fe="extended",suppressSeconds:ve=!1,suppressMilliseconds:_e=!1,includeOffset:be=!0,extendedZone:we=!1}={}){if(!this.isValid)return null;const Se="extended"===fe;let Te=toISODate(this,Se);return Te+="T",Te+=toISOTime(this,Se,ve,_e,be,we),Te}toISODate({format:fe="extended"}={}){return this.isValid?toISODate(this,"extended"===fe):null}toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:fe=!1,suppressSeconds:ve=!1,includeOffset:_e=!0,includePrefix:be=!1,extendedZone:we=!1,format:Se="extended"}={}){if(!this.isValid)return null;return(be?"T":"")+toISOTime(this,"extended"===Se,ve,fe,_e,we)}toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?toISODate(this,!0):null}toSQLTime({includeOffset:fe=!0,includeZone:ve=!1,includeOffsetSpace:_e=!0}={}){let be="HH:mm:ss.SSS";return(ve||fe)&&(_e&&(be+=" "),ve?be+="z":fe&&(be+="ZZ")),toTechFormat(this,be,!0)}toSQL(fe={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(fe)}`:null}toString(){return this.isValid?this.toISO():mu}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(fe={}){if(!this.isValid)return{};const ve={...this.c};return fe.includeConfig&&(ve.outputCalendar=this.outputCalendar,ve.numberingSystem=this.loc.numberingSystem,ve.locale=this.loc.locale),ve}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(fe,ve="milliseconds",_e={}){if(!this.isValid||!fe.isValid)return Duration.invalid("created by diffing an invalid DateTime");const be={locale:this.locale,numberingSystem:this.numberingSystem,..._e},we=function maybeArray(fe){return Array.isArray(fe)?fe:[fe]}(ve).map(Duration.normalizeUnit),Se=fe.valueOf()>this.valueOf(),Te=diff(Se?this:fe,Se?fe:this,we,be);return Se?Te.negate():Te}diffNow(fe="milliseconds",ve={}){return this.diff(DateTime.now(),fe,ve)}until(fe){return this.isValid?Interval.fromDateTimes(this,fe):this}hasSame(fe,ve,_e){if(!this.isValid)return!1;const be=fe.valueOf(),we=this.setZone(fe.zone,{keepLocalTime:!0});return we.startOf(ve,_e)<=be&&be<=we.endOf(ve,_e)}equals(fe){return this.isValid&&fe.isValid&&this.valueOf()===fe.valueOf()&&this.zone.equals(fe.zone)&&this.loc.equals(fe.loc)}toRelative(fe={}){if(!this.isValid)return null;const ve=fe.base||DateTime.fromObject({},{zone:this.zone}),_e=fe.padding?this<ve?-fe.padding:fe.padding:0;let be=["years","months","days","hours","minutes","seconds"],we=fe.unit;return Array.isArray(fe.unit)&&(be=fe.unit,we=void 0),diffRelative(ve,this.plus(_e),{...fe,numeric:"always",units:be,unit:we})}toRelativeCalendar(fe={}){return this.isValid?diffRelative(fe.base||DateTime.fromObject({},{zone:this.zone}),this,{...fe,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...fe){if(!fe.every(DateTime.isDateTime))throw new InvalidArgumentError("min requires all arguments be DateTimes");return bestBy(fe,(fe=>fe.valueOf()),Math.min)}static max(...fe){if(!fe.every(DateTime.isDateTime))throw new InvalidArgumentError("max requires all arguments be DateTimes");return bestBy(fe,(fe=>fe.valueOf()),Math.max)}static fromFormatExplain(fe,ve,_e={}){const{locale:be=null,numberingSystem:we=null}=_e;return explainFromTokens(Locale.fromOpts({locale:be,numberingSystem:we,defaultToEN:!0}),fe,ve)}static fromStringExplain(fe,ve,_e={}){return DateTime.fromFormatExplain(fe,ve,_e)}static get DATE_SHORT(){return Sl}static get DATE_MED(){return Tl}static get DATE_MED_WITH_WEEKDAY(){return El}static get DATE_FULL(){return Pl}static get DATE_HUGE(){return Cl}static get TIME_SIMPLE(){return Ol}static get TIME_WITH_SECONDS(){return Al}static get TIME_WITH_SHORT_OFFSET(){return Ml}static get TIME_WITH_LONG_OFFSET(){return Rl}static get TIME_24_SIMPLE(){return Il}static get TIME_24_WITH_SECONDS(){return Ll}static get TIME_24_WITH_SHORT_OFFSET(){return Dl}static get TIME_24_WITH_LONG_OFFSET(){return Nl}static get DATETIME_SHORT(){return Fl}static get DATETIME_SHORT_WITH_SECONDS(){return zl}static get DATETIME_MED(){return kl}static get DATETIME_MED_WITH_SECONDS(){return Ul}static get DATETIME_MED_WITH_WEEKDAY(){return Vl}static get DATETIME_FULL(){return Bl}static get DATETIME_FULL_WITH_SECONDS(){return jl}static get DATETIME_HUGE(){return Gl}static get DATETIME_HUGE_WITH_SECONDS(){return Hl}}function friendlyDateTime(fe){if(DateTime.isDateTime(fe))return fe;if(fe&&fe.valueOf&&isNumber(fe.valueOf()))return DateTime.fromJSDate(fe);if(fe&&"object"==typeof fe)return DateTime.fromObject(fe);throw new InvalidArgumentError(`Unknown datetime argument: ${fe}, of type ${typeof fe}`)}const xu="system",Su="unknown",Tu="UTC",Eu=Intl.DateTimeFormat().resolvedOptions().timeZone;function c$4q(fe,ve=!1){return{json:{read:{source:fe,reader:(ve,_e)=>_e[fe]?f$2V(_e[fe]):null},write:!!ve&&{allowNull:!0,writer(ve,_e){_e[fe]=ve?function l$45(fe){return{timeZoneIANA:fe}}(ve):null}}}}}function f$2V(fe,ve=xu){return fe?function m$3t(fe){return"timeZoneIANA"in fe}(fe)?fe.timeZoneIANA:function Z$F(fe,ve=xu){if(!fe||!$l.has(fe.timeZone))return ve;const _e=$l.get(fe.timeZone);return function u$3B(fe){return fe.startsWith("UTC")}(fe.timeZone)||fe.respectsDaylightSaving?_e:function d$3a(fe){const ve=DateTime.local().setZone(fe),_e=Math.min(ve.set({month:1,day:1}).offset,ve.set({month:5}).offset);return 0===_e?"Etc/UTC":`Etc/GMT${FixedOffsetZone.instance(-_e).formatOffset(0,"narrow")}`}(_e)}(fe,ve):ve}function g$2j(fe,ve,_e,be,we){if(ve&&"date"===we)return{timeZone:Tu,timeZoneName:void 0};const Se=be.timeStyle||be.hour,Te=_e===Su;return{timeZone:Te?"timestamp-offset"===we?void 0:fe??Tu:_e,timeZoneName:Te&&Se?"shortOffset":void 0}}const Pu={year:void 0,month:void 0,day:void 0,weekday:void 0},Cu={hour:void 0,minute:void 0,second:void 0},Ou={timeZone:Tu},Au={year:"numeric",month:"numeric",day:"numeric"},Mu={year:"numeric",month:"long",day:"numeric"},Ru={year:"numeric",month:"short",day:"numeric"},Iu={year:"numeric",month:"long",weekday:"long",day:"numeric"},Lu={hour:"numeric",minute:"numeric"},Du={...Lu,second:"numeric"},Nu={hourCycle:"h23"},Fu={...Lu,...Nu},zu={...Du,...Nu},ku={"short-date":Au,"short-date-short-time":{...Au,...Lu},"short-date-short-time-24":{...Au,...Fu},"short-date-long-time":{...Au,...Du},"short-date-long-time-24":{...Au,...zu},"short-date-le":Au,"short-date-le-short-time":{...Au,...Lu},"short-date-le-short-time-24":{...Au,...Fu},"short-date-le-long-time":{...Au,...Du},"short-date-le-long-time-24":{...Au,...zu},"long-month-day-year":Mu,"long-month-day-year-short-time":{...Mu,...Lu},"long-month-day-year-short-time-24":{...Mu,...Fu},"long-month-day-year-long-time":{...Mu,...Du},"long-month-day-year-long-time-24":{...Mu,...zu},"day-short-month-year":Ru,"day-short-month-year-short-time":{...Ru,...Lu},"day-short-month-year-short-time-24":{...Ru,...Fu},"day-short-month-year-long-time":{...Ru,...Du},"day-short-month-year-long-time-24":{...Ru,...zu},"long-date":Iu,"long-date-short-time":{...Iu,...Lu},"long-date-short-time-24":{...Iu,...Fu},"long-date-long-time":{...Iu,...Du},"long-date-long-time-24":{...Iu,...zu},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Lu,"long-time":Du},Uu=i$4y()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Vu={ar:"ar-u-nu-latn-ca-gregory"};let Bu=new WeakMap;const ju=ku["short-date-short-time"];function E$1D(fe){return ku[fe]}function j$1E(fe,ve=ju){return function v$1V(fe){let ve=Bu.get(fe);if(!ve){const _e=c$4r(),be=Vu[_e]||_e,we=F$16(fe.timeZone??xu),Se={...fe,timeZone:we};ve=new Intl.DateTimeFormat(be,Se),Bu.set(fe,ve)}return ve}(ve).format(fe)}function k$1t(fe,ve=ju){return j$1E(new Date(fe),{...ve,...Ou,...Cu})}function I$1w(fe,ve=ju){return j$1E(new Date(`1970-01-01T${fe}Z`),{...ve,...Ou,...Pu})}function x$1G(fe,ve=ju){if(ve.timeZone)return j$1E(new Date(fe),ve);const _e=DateTime.fromISO(fe,{setZone:!0}),be=c$4r(),we=Vu[be]??be,Se=0===_e.offset?Tu:ve.timeZone,Te={...ve,timeZone:Se};return _e.toLocaleString(Te,{locale:we})}function F$16(fe){switch(fe){case xu:return Eu;case Su:return Tu;default:return fe}}h$2E((()=>{Bu=new WeakMap}));const Gu={ar:"ar-u-nu-latn"};let Hu=new WeakMap,qu={};function a$4a(fe){const ve=fe||qu;if(!Hu.has(ve)){const _e=c$4r(),be=Gu[c$4r()]||_e;Hu.set(ve,new Intl.NumberFormat(be,fe))}return Hu.get(ve)}function i$4d(fe={}){const ve={};return null!=fe.digitSeparator&&(ve.useGrouping=fe.digitSeparator),null!=fe.places&&(ve.minimumFractionDigits=ve.maximumFractionDigits=fe.places),ve}function l$43(fe,ve){return Object.is(fe,-0)&&(fe=0),a$4a(ve).format(fe)}function o$3I(fe,ve=c$4r()){var _e,be;if(!fe)return null;let we=Wu.get(ve);if(!we){const fe=a$4a().formatToParts(12345.6),Se=[...a$4a({useGrouping:!1}).format(9876543210)].reverse(),Te=new Map(Se.map(((fe,ve)=>[fe,ve]))),Ee=new RegExp(`[${null==(_e=fe.find((fe=>"group"===fe.type)))?void 0:_e.value}]`,"g"),Ce=new RegExp(`[${null==(be=fe.find((fe=>"decimal"===fe.type)))?void 0:be.value}]`),Oe=new RegExp(`[${Se.join("")}]`,"g"),Re=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,De=/[-\u2212\u2013\u2014\u2015]/g;we=fe=>{if(""===(fe=fe.trim().replaceAll(Ee,"").replace(Ce,".").replace(Oe,(fe=>String(Te.get(fe)))).replaceAll(Re,"").replaceAll(De,"-")))return null;const ve=Number(fe);return isNaN(ve)?null:ve},Wu.set(ve,we)}return we(fe)}h$2E((()=>{Hu=new WeakMap,qu={}}));const Wu=new Map,Yu=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Zu={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function a$49(fe){return fe in Zu}const Xu=[],Ju=new Map;function l$42(fe){for(const ve of Ju.keys())_$1r(fe.pattern,ve)&&Ju.delete(ve)}async function h$2D(fe){const ve=c$4r();Ju.has(fe)||Ju.set(fe,async function m$3s(fe,ve){const _e=[];for(const be of Xu)if(_$1r(be.pattern,fe))try{return await be.fetchMessageBundle(fe,ve)}catch(Dr){_e.push(Dr)}if(_e.length)throw new Ir("intl:message-bundle-error",`Errors occurred while loading "${fe}"`,{errors:_e});throw new Ir("intl:no-message-bundle-loader",`No loader found for message bundle "${fe}"`)}(fe,ve));const _e=Ju.get(fe);return _e&&await Qu.add(_e),_e}function _$1r(fe,ve){return"string"==typeof fe?ve.startsWith(fe):fe.test(ve)}h$2E((()=>{Ju.clear()}));const Qu=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(fe){return this._increase(),fe.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=L$1h())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}};async function r$3e(fe,ve,_e,be){const we=ve.exec(_e);if(!we)throw new Ir("esri-intl:invalid-bundle",`Bundle id "${_e}" is not compatible with the pattern "${ve}"`);const Se=we[1]?`${we[1]}/`:"",Te=we[2],Ee=function f$2T(fe){if(!Yu.test(fe))return null;const ve=Yu.exec(fe);if(null===ve)return null;const[,_e,be]=ve,we=_e+(be?"-"+be.toUpperCase():"");return a$49(we)?we:a$49(_e)?_e:null}(be),Ce=`${Se}${Te}.json`,Oe=Ee?`${Se}${Te}_${Ee}.json`:Ce;let Re;try{Re=await o$3G(fe(Oe))}catch(De){if(Oe===Ce)throw new Ir("intl:unknown-bundle",`Bundle "${_e}" cannot be loaded`,{error:De});try{Re=await o$3G(fe(Ce))}catch(Be){throw new Ir("intl:unknown-bundle",`Bundle "${_e}" cannot be loaded`,{error:Be})}}return Re}async function o$3G(fe){if(null!=eh.fetchBundleAsset)return eh.fetchBundleAsset(fe);const ve=await U$1a(fe,{responseType:"text"});return JSON.parse(ve.data)}let Ku=class s10{constructor({base:fe="",pattern:ve,location:_e=new URL(window.location.href)}){let be;be="string"==typeof _e?fe=>new URL(fe,new URL(_e,window.location.href)).href:_e instanceof URL?fe=>new URL(fe,_e).href:_e,this.pattern="string"==typeof ve?new RegExp(`^${ve}`):ve,this.getAssetUrl=be,fe=fe?fe.endsWith("/")?fe:fe+"/":"",this.matcher=new RegExp(`^${fe}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(fe,ve){return r$3e(this.getAssetUrl,this.matcher,fe,ve)}};const eh={};!function u$3y(fe){return Xu.includes(fe)||(l$42(fe),Xu.unshift(fe)),e$4e((()=>{const ve=Xu.indexOf(fe);ve>-1&&(Xu.splice(ve,1),l$42(fe))}))}(function i$4b(fe){return new Ku(fe)}({pattern:"esri/",location:n$4t}));const th={};let rh=class n4{constructor(){const fe=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((ve=>{this[ve]=(..._e)=>fe[ve](..._e)}))}},ih=class a{constructor(){this._dispatcher=new rh,this._workerPostMessage({type:nl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(fe){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=fe,fe&&this.addEventListener("message",fe)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(fe){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=fe,fe&&this.addEventListener("messageerror",fe)}get onerror(){return this._onerrorHandler}set onerror(fe){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=fe,fe&&this.addEventListener("error",fe)}postMessage(fe){t$4h((()=>{this._workerMessageHandler(new MessageEvent("message",{data:fe}))}))}dispatchEvent(fe){return this._dispatcher.dispatchEvent(fe)}addEventListener(fe,ve,_e){this._dispatcher.addEventListener(fe,ve,_e)}removeEventListener(fe,ve,_e){this._dispatcher.removeEventListener(fe,ve,_e)}_workerPostMessage(fe){t$4h((()=>{this.dispatchEvent(new MessageEvent("message",{data:fe}))}))}async _workerMessageHandler(fe){const ve=f$2X(fe);if(ve&&ve.type===nl.OPEN){const{modulePath:fe,jobId:_e}=ve;let be=await pl.loadWorker(fe);be||(be=await import(fe));const we=pl.connect(be);this._workerPostMessage({type:nl.OPENED,jobId:_e,data:we})}}};const d$37=()=>ar.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:nh}=nl;let sh,oh;const ah="Failed to create Worker. Fallback to execute module in main thread";async function y$27(){if(!has("esri-workers"))return w$1Q(new ih);if(!sh&&!oh)try{const fe='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function b$25(){let fe;if(null!=ir.default){const ve={...ir};delete ve.default,fe=JSON.parse(JSON.stringify(ve))}else fe=JSON.parse(JSON.stringify(ir));fe.assetsPath=_$1x(fe.assetsPath),fe.defaultAssetsPath=fe.defaultAssetsPath?_$1x(fe.defaultAssetsPath):void 0,fe.request.interceptors=[],fe.log.interceptors=[],fe.locale=c$4r(),fe.has={"esri-csp-restrictions":has("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":has("esri-2d-update-debug"),"esri-2d-log-updating":has("esri-2d-log-updating"),"featurelayer-pbf":has("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":has("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":has("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":has("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":has("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":has("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":has("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":has("featurelayer-snapshot-enabled"),"esri-atomics":has("esri-atomics"),"esri-shared-array-buffer":has("esri-shared-array-buffer"),"esri-tiles-debug":has("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":has("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":has("feature-polyline-generalization-factor"),"host-webworker":1},fe.workers.loaderUrl&&(fe.workers.loaderUrl=_$1x(fe.workers.loaderUrl)),fe.workers.workerPath?fe.workers.workerPath=_$1x(fe.workers.workerPath):fe.workers.workerPath=_$1x(n$4t("esri/core/workers/RemoteClient.js")),fe.workers.useDynamicImport=!1;const ve=ir.workers.loaderConfig,_e=function r$3d(fe){var ve;const _e={async:fe.async,isDebug:fe.isDebug,locale:fe.locale,baseUrl:fe.baseUrl,has:{...fe.has},map:{...fe.map},packages:(null==(ve=fe.packages)?void 0:ve.concat())||[],paths:{...th.paths,...fe.paths}};return fe.hasOwnProperty("async")||(_e.async=!0),fe.hasOwnProperty("isDebug")||(_e.isDebug=!1),fe.baseUrl||(_e.baseUrl=th.baseUrl),_e}({baseUrl:null==ve?void 0:ve.baseUrl,locale:c$4r(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...null==ve?void 0:ve.has},map:{...null==ve?void 0:ve.map},paths:{...null==ve?void 0:ve.paths},packages:(null==ve?void 0:ve.packages)||[]}),be={buildDate:ws,fullVersion:Es,revision:xs};return JSON.stringify({esriConfig:fe,loaderConfig:_e,kernelInfo:be})}());sh=URL.createObjectURL(new Blob([fe],{type:"text/javascript"}))}catch(Dr){oh=Dr||{}}let fe;if(sh)try{fe=new Worker(sh,{name:"esri-worker-"+lh++})}catch(Dr){d$37().warn(ah,oh),fe=new ih}else d$37().warn(ah,oh),fe=new ih;return w$1Q(fe)}async function w$1Q(fe){return new Promise((ve=>{function t84(_e){const be=f$2X(_e);be&&be.type===nh&&(fe.removeEventListener("message",t84),fe.removeEventListener("error",o39),ve(fe))}function o39(ve){ve.preventDefault(),fe.removeEventListener("message",t84),fe.removeEventListener("error",o39),d$37().warn("Failed to create Worker. Fallback to execute module in main thread",ve),(fe=new ih).addEventListener("message",t84),fe.addEventListener("error",o39)}fe.addEventListener("message",t84),fe.addEventListener("error",o39)}))}let lh=0;const{ABORT:ch,INVOKE:uh,OPEN:hh,OPENED:dh,RESPONSE:ph}=nl;let fh=class j{static async create(fe){const ve=await y$27();return new j(ve,fe)}constructor(fe,ve){this._outJobs=new Map,this._inJobs=new Map,this.worker=fe,this.id=ve,fe.addEventListener("message",this._onMessage.bind(this)),fe.addEventListener("error",(fe=>{fe.preventDefault(),ar.getLogger("esri.core.workers.WorkerOwner").error(fe)}))}terminate(){this.worker.terminate()}async open(fe,ve={}){const{signal:_e}=ve,be=s$3W();return new Promise(((ve,we)=>{const Se={resolve:ve,reject:we,abortHandle:w$22(_e,(()=>{this._outJobs.delete(be),this._post({type:ch,jobId:be})}))};this._outJobs.set(be,Se),this._post({type:hh,jobId:be,modulePath:fe})}))}_onMessage(fe){const ve=f$2X(fe);if(ve)switch(ve.type){case dh:this._onOpenedMessage(ve);break;case ph:this._onResponseMessage(ve);break;case ch:this._onAbortMessage(ve);break;case uh:this._onInvokeMessage(ve)}}_onAbortMessage(fe){const ve=this._inJobs,_e=fe.jobId,be=ve.get(_e);be&&(be.controller&&be.controller.abort(),ve.delete(_e))}_onInvokeMessage(fe){const{methodName:ve,jobId:_e,data:be,abortable:we}=fe,Se=we?new AbortController:null,Te=this._inJobs,Ee=ml[ve];let Ce;try{if("function"!=typeof Ee)throw new TypeError(`${ve} is not a function`);Ce=Ee.call(null,be,{signal:Se?Se.signal:null})}catch(Oe){return void this._post({type:ph,jobId:_e,error:i$4g(Oe)})}S$1T(Ce)?(Te.set(_e,{controller:Se,promise:Ce}),Ce.then((fe=>{Te.has(_e)&&(Te.delete(_e),this._post({type:ph,jobId:_e},fe))}),(fe=>{Te.has(_e)&&(Te.delete(_e),fe||(fe={message:"Error encountered at method"+ve}),b$2g(fe)||this._post({type:ph,jobId:_e,error:i$4g(fe||{message:`Error encountered at method ${ve}`})}))}))):this._post({type:ph,jobId:_e},Ce)}_onOpenedMessage(fe){const{jobId:ve,data:_e}=fe,be=this._outJobs.get(ve);be&&(this._outJobs.delete(ve),l$4E(be.abortHandle),be.resolve(_e))}_onResponseMessage(fe){const{jobId:ve,error:_e,data:be}=fe,we=this._outJobs.get(ve);we&&(this._outJobs.delete(ve),l$4E(we.abortHandle),_e?we.reject(Ir.fromJSON(JSON.parse(_e))):we.resolve(be))}_post(fe,ve,_e){return a$4f(this.worker,fe,ve,_e)}};const mh=has("host-browser")?Math.min(navigator.hardwareConcurrency-1,has("workers-pool-size")):0;let yh=has("esri-mobile")?Math.min(mh,3):mh;yh||(yh=has("safari")&&has("mac")?7:2);let gh=0;const vh=[];async function f$2S(fe,ve){const _e=new fl,{registryTarget:be,...we}=ve;return await _e.open(fe,we),be&&function e$3M(fe,ve){tl.register(fe,ve,ve)}(be,_e),_e}async function p$4D(fe,ve={}){if("string"!=typeof fe)throw new Ir("workers:undefined-module","modulePath is missing");let _e=ve.strategy||"distributed";if(has("host-webworker")&&!has("esri-workers")&&(_e="local"),"local"===_e){let _e=await pl.loadWorker(fe);_e||(_e=await import(fe)),s$4o(ve.signal);const be=ve.client||_e;return f$2S([pl.connect(_e,ve.schedule)],{...ve,client:be})}if(await g$2f(),s$4o(ve.signal),"dedicated"===_e){const _e=gh++%yh;return f$2S([await vh[_e].open(fe,ve)],ve)}if(ve.maxNumWorkers&&ve.maxNumWorkers>0){const _e=Math.min(ve.maxNumWorkers,yh);if(_e<yh){const be=new Array(_e);for(let we=0;we<_e;++we){const _e=gh++%yh;be[we]=vh[_e].open(fe,ve)}return f$2S(be,ve)}}return f$2S(vh.map((_e=>_e.open(fe,ve))),ve)}let _h=null;async function g$2f(){if(_h)return _h;new AbortController;const fe=[];for(let ve=0;ve<yh;ve++){const _e=fh.create(ve).then((fe=>(vh[ve]=fe,fe)));fe.push(_e)}return _h=Promise.all(fe),_h}function n$4d(fe,ve){const _e=t$4p(fe),be=t$4p(ve),we=_e.store,Se=be.store,Te=be.metadata;for(const Ee in Te){const ve=Te[Ee],_e=we.originOf(Ee),be=Se.originOf(Ee);if(!ve.readOnly&&be!==gr.DEFAULTS)if(_e===gr.DEFAULTS)fe.set(Ee,Se.get(Ee));else{const fe=we.get(Ee),ve=Se.get(Ee);fe&&ve&&ve instanceof zi&&fe instanceof zi&&fe instanceof ve.constructor&&n$4d(fe,ve)}}}function n$4c(fe,ve,_e=Wa){return ve||(ve=new _e),ve===fe||(ve.removeAll(),function e$3J(fe){return fe&&(Array.isArray(fe)||"items"in fe&&Array.isArray(fe.items))}(fe)?ve.addMany(fe):fe&&ve.add(fe)),ve}function t$3R(fe){return fe}let $h=class n5 extends Wa{constructor(fe){super(fe),this.addHandles([this.on("before-add",(fe=>{null==fe.item&&fe.preventDefault()})),this.on("after-add",(fe=>this._own(fe.item))),this.on("after-remove",(fe=>this._release(fe.item)))])}get owner(){return this._get("owner")}set owner(fe){fe!==this._get("owner")&&(this._releaseAll(),this._set("owner",fe),this._ownAll())}_ownAll(){for(const fe of this.items)this._own(fe)}_releaseAll(){for(const fe of this.items)this._release(fe)}_createNewInstance(fe){return this.itemType?new(Wa.ofType(this.itemType.Type))(fe):new Wa(fe)}};function l$40(fe,ve){return{type:fe,cast:t$3R,set(_e){const be=n$4c(_e,this._get(ve),fe);be.owner=this,this._set(ve,be)}}}var bh;e$4o([y$2v()],$h.prototype,"owner",null),$h=e$4o([a$4y("esri.core.support.OwningCollection")],$h);const wh=i$4y()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),xh=wh.jsonValues.slice();S$1U(xh,"orthometric");const Sh=i$4y()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Th=bh=class extends Pn{constructor(fe){super(fe),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(fe,ve,_e){return wh.write(fe,ve,_e)}readHeightModel(fe,ve,_e){return wh.read(fe)||((null==_e?void 0:_e.messages)&&_e.messages.push(function f$2R(fe,ve){return new Mi("height-model:unsupported",`Height model of value '${fe}' is not supported`,ve)}(fe,{context:_e})),null)}readHeightUnit(fe,ve,_e){return Sh.read(fe)||((null==_e?void 0:_e.messages)&&_e.messages.push(y$26(fe,{context:_e})),null)}readHeightUnitService(fe,ve,_e){return H$16(fe)||Sh.read(fe)||((null==_e?void 0:_e.messages)&&_e.messages.push(y$26(fe,{context:_e})),null)}readVertCRS(fe,ve){return ve.vertCRS||ve.ellipsoid||ve.geoid}clone(){return new bh({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(fe){return!!fe&&(this===fe||this.heightModel===fe.heightModel&&this.heightUnit===fe.heightUnit&&this.vertCRS===fe.vertCRS)}static deriveUnitFromSR(fe,ve){const _e=Y$D(ve);return new bh({heightModel:fe.heightModel,heightUnit:_e??void 0,vertCRS:fe.vertCRS})}write(fe,ve){return ve={origin:"web-scene",...ve},super.write(fe,ve)}static fromJSON(fe){if(!fe)return null;const ve=new bh;return ve.read(fe,{origin:"web-scene"}),ve}};function y$26(fe,ve){return new Mi("height-unit:unsupported",`Height unit of value '${fe}' is not supported`,ve)}e$4o([y$2v({type:wh.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:xh,default:"ellipsoidal"}}}})],Th.prototype,"heightModel",void 0),e$4o([r$3s("web-scene","heightModel")],Th.prototype,"writeHeightModel",null),e$4o([o$40(["web-scene","service"],"heightModel")],Th.prototype,"readHeightModel",null),e$4o([y$2v({type:Sh.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Sh.jsonValues,write:Sh.write}}}})],Th.prototype,"heightUnit",void 0),e$4o([o$40("web-scene","heightUnit")],Th.prototype,"readHeightUnit",null),e$4o([o$40("service","heightUnit")],Th.prototype,"readHeightUnitService",null),e$4o([y$2v({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Th.prototype,"vertCRS",void 0),e$4o([o$40("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Th.prototype,"readVertCRS",null),Th=bh=e$4o([a$4y("esri.geometry.HeightModelInfo")],Th);const Eh=Th,Ph=Math.PI/180,Ch=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Oh=Rn.radius,Ah=Rn.eccentricitySquared,Mh={a1:Oh*Ah,a2:Oh*Ah*Oh*Ah,a3:Oh*Ah*Ah/2,a4:Oh*Ah*Oh*Ah*2.5,a5:Oh*Ah+Oh*Ah*Ah/2,a6:1-Ah},Rh={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Rn.radius,f:Rn.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Ln.radius,f:Ln.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:In.radius,f:In.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:In.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var Ih;!function(fe){fe[fe.UNKNOWN=0]="UNKNOWN",fe[fe.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",fe[fe.WGS84=2]="WGS84",fe[fe.WEB_MERCATOR=3]="WEB_MERCATOR",fe[fe.WGS84_ECEF=4]="WGS84_ECEF",fe[fe.CGCS2000=5]="CGCS2000",fe[fe.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",fe[fe.GCSMARS2000=7]="GCSMARS2000",fe[fe.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",fe[fe.GCSMOON2000=9]="GCSMOON2000",fe[fe.LON_LAT=10]="LON_LAT",fe[fe.PLATE_CARREE=11]="PLATE_CARREE"}(Ih||(Ih={}));const Lh={[Ih.WGS84]:{[Ih.CGCS2000]:f$2Q,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:f$2Q,[Ih.SPHERICAL_ECEF]:x$1F,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:h$2B,[Ih.PLATE_CARREE]:d$33,[Ih.WGS84]:f$2Q,[Ih.WGS84_ECEF]:X$y},[Ih.CGCS2000]:{[Ih.CGCS2000]:f$2Q,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:f$2Q,[Ih.SPHERICAL_ECEF]:x$1F,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:h$2B,[Ih.PLATE_CARREE]:d$33,[Ih.WGS84]:f$2Q,[Ih.WGS84_ECEF]:X$y},[Ih.GCSMARS2000]:{[Ih.CGCS2000]:null,[Ih.GCSMARS2000]:f$2Q,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:f$2Q,[Ih.SPHERICAL_ECEF]:null,[Ih.SPHERICAL_MARS_PCPF]:k$1r,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:null,[Ih.PLATE_CARREE]:null,[Ih.WGS84]:null,[Ih.WGS84_ECEF]:null},[Ih.GCSMOON2000]:{[Ih.CGCS2000]:null,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:f$2Q,[Ih.LON_LAT]:f$2Q,[Ih.SPHERICAL_ECEF]:null,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:b$23,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:null,[Ih.PLATE_CARREE]:null,[Ih.WGS84]:null,[Ih.WGS84_ECEF]:null},[Ih.WEB_MERCATOR]:{[Ih.CGCS2000]:I$1v,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:I$1v,[Ih.SPHERICAL_ECEF]:T$1i,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:f$2Q,[Ih.PLATE_CARREE]:K$E,[Ih.WGS84]:I$1v,[Ih.WGS84_ECEF]:p$4B},[Ih.WGS84_ECEF]:{[Ih.CGCS2000]:Y$B,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:Y$B,[Ih.SPHERICAL_ECEF]:Z$D,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:$$E,[Ih.PLATE_CARREE]:function m$3n(fe,ve,_e,be){Y$B(fe,ve,_e,be),d$33(_e,be,_e,be)},[Ih.WGS84]:Y$B,[Ih.WGS84_ECEF]:f$2Q},[Ih.SPHERICAL_ECEF]:{[Ih.CGCS2000]:D$16,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:D$16,[Ih.SPHERICAL_ECEF]:f$2Q,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:J$H,[Ih.PLATE_CARREE]:function w$1P(fe,ve,_e,be){D$16(fe,ve,_e,be),d$33(_e,be,_e,be)},[Ih.WGS84]:D$16,[Ih.WGS84_ECEF]:Q$G},[Ih.SPHERICAL_MARS_PCPF]:{[Ih.CGCS2000]:null,[Ih.GCSMARS2000]:z$15,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:z$15,[Ih.SPHERICAL_ECEF]:null,[Ih.SPHERICAL_MARS_PCPF]:f$2Q,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:null,[Ih.PLATE_CARREE]:null,[Ih.WGS84]:null,[Ih.WGS84_ECEF]:null},[Ih.SPHERICAL_MOON_PCPF]:{[Ih.CGCS2000]:null,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:v$1S,[Ih.LON_LAT]:v$1S,[Ih.SPHERICAL_ECEF]:null,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:f$2Q,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:null,[Ih.PLATE_CARREE]:null,[Ih.WGS84]:null,[Ih.WGS84_ECEF]:null},[Ih.UNKNOWN]:{[Ih.CGCS2000]:null,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:null,[Ih.SPHERICAL_ECEF]:null,[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:f$2Q,[Ih.WEB_MERCATOR]:null,[Ih.PLATE_CARREE]:null,[Ih.WGS84]:null,[Ih.WGS84_ECEF]:null},[Ih.LON_LAT]:{[Ih.CGCS2000]:f$2Q,[Ih.GCSMARS2000]:f$2Q,[Ih.GCSMOON2000]:f$2Q,[Ih.LON_LAT]:f$2Q,[Ih.SPHERICAL_ECEF]:x$1F,[Ih.SPHERICAL_MARS_PCPF]:k$1r,[Ih.SPHERICAL_MOON_PCPF]:b$23,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:h$2B,[Ih.PLATE_CARREE]:d$33,[Ih.WGS84]:f$2Q,[Ih.WGS84_ECEF]:X$y},[Ih.PLATE_CARREE]:{[Ih.CGCS2000]:U$16,[Ih.GCSMARS2000]:null,[Ih.GCSMOON2000]:null,[Ih.LON_LAT]:U$16,[Ih.SPHERICAL_ECEF]:function B$13(fe,ve,_e,be){U$16(fe,ve,_e,be),x$1F(_e,be,_e,be)},[Ih.SPHERICAL_MARS_PCPF]:null,[Ih.SPHERICAL_MOON_PCPF]:null,[Ih.UNKNOWN]:null,[Ih.WEB_MERCATOR]:function j$1C(fe,ve,_e,be){U$16(fe,ve,_e,be),h$2B(_e,be,_e,be)},[Ih.PLATE_CARREE]:f$2Q,[Ih.WGS84]:U$16,[Ih.WGS84_ECEF]:function q$Z(fe,ve,_e,be){U$16(fe,ve,_e,be),X$y(_e,be,_e,be)}}};function G$S(fe,ve,_e=Cn()){return null==fe||null==ve?null:nn$2(fe,ve,_e).projector}function W$K(fe,ve){switch(G$S(fe,ve,Fh)){case f$2Q:return"copy3";case x$1F:return"wgs84ToSphericalECEF";case h$2B:return"wgs84ToWebMercator";case d$33:return"wgs84ToPlateCarree";case X$y:return"wgs84ToWGS84ECEF";case I$1v:return"webMercatorToWGS84";case T$1i:return"webMercatorToSphericalECEF";case p$4B:return"webMercatorToWGS84ECEF";case K$E:return"webMercatorToPlateCarree";case Y$B:return"wgs84ECEFToWGS84";case Z$D:return"wgs84ECEFToSphericalECEF";case $$E:return"wgs84ECEFToWebMercator";case D$16:return"sphericalECEFToWGS84";case J$H:return"sphericalECEFToWebMercator";case z$15:return"sphericalMarsPCPFToMars2000";case v$1S:return"sphericalMoonPCPFToMoon2000";case Q$G:return"sphericalECEFToWGS84ECEF";case k$1r:return"mars2000ToSphericalPCPF";case b$23:return"moon2000ToSphericalPCPF";default:return null}}function F$15(fe,ve){return fe?ve.spatialReference===fe?ve.spatialReferenceId:(ve.spatialReference=fe,"metersPerUnit"in ve&&(ve.metersPerUnit=W$L(fe,1)),A$1A(fe)?ve.spatialReferenceId=Ih.SPHERICAL_ECEF:C$1p(fe)?ve.spatialReferenceId=Ih.WGS84:w$1X(fe)?ve.spatialReferenceId=Ih.WEB_MERCATOR:O$1s(fe)?ve.spatialReferenceId=Ih.PLATE_CARREE:fe.wkt===vo.wkt?ve.spatialReferenceId=Ih.WGS84_ECEF:fe.wkid===to.CGCS2000?ve.spatialReferenceId=Ih.CGCS2000:fe.wkt===mo.wkt?ve.spatialReferenceId=Ih.SPHERICAL_MARS_PCPF:fe.wkt===yo.wkt?ve.spatialReferenceId=Ih.SPHERICAL_MOON_PCPF:f$3b(fe)?ve.spatialReferenceId=Ih.GCSMARS2000:p$4U(fe)?ve.spatialReferenceId=Ih.GCSMOON2000:ve.spatialReferenceId=Ih.UNKNOWN):Ih.UNKNOWN}function f$2Q(fe,ve,_e,be){fe!==_e&&(_e[be++]=fe[ve++],_e[be++]=fe[ve++],_e[be]=fe[ve])}function I$1v(fe,ve,_e,be){_e[be]=kh*(fe[ve]/Bh),_e[be+1]=kh*(Vh-2*Math.atan(Math.exp(-fe[ve+1]/Bh))),_e[be+2]=fe[ve+2]}function T$1i(fe,ve,_e,be){const we=fe[ve]/Bh,Se=Vh-2*Math.atan(Math.exp(-fe[ve+1]/Bh)),Te=Bh+fe[ve+2],Ee=Math.cos(Se)*Te;_e[be]=Math.cos(we)*Ee,_e[be+1]=Math.sin(we)*Ee,_e[be+2]=Math.sin(Se)*Te}function p$4B(fe,ve,_e,be){I$1v(fe,ve,_e,be),X$y(_e,be,_e,be)}function H$14(fe,ve,_e,be,we){const Se=.4999999*Uh,Te=e$3Y(zh*fe[ve+1],-Se,Se),Ee=Math.sin(Te);_e[be++]=zh*fe[ve]*we.radius,_e[be++]=we.halfSemiMajorAxis*Math.log((1+Ee)/(1-Ee)),_e[be]=fe[ve+2]}function h$2B(fe,ve,_e,be){H$14(fe,ve,_e,be,Rn)}function d$33(fe,ve,_e,be){_e[be]=fe[ve]*jh,_e[be+1]=fe[ve+1]*jh,_e[be+2]=fe[ve+2]}function U$16(fe,ve,_e,be){_e[be]=fe[ve]*Gh,_e[be+1]=fe[ve+1]*Gh,_e[be+2]=fe[ve+2]}function K$E(fe,ve,_e,be){I$1v(fe,ve,_e,be),d$33(_e,be,_e,be)}function g$2d(fe,ve,_e,be,we){const Se=we+fe[ve+2],Te=zh*fe[ve+1],Ee=zh*fe[ve],Ce=Math.cos(Te)*Se;_e[be]=Math.cos(Ee)*Ce,_e[be+1]=Math.sin(Ee)*Ce,_e[be+2]=Math.sin(Te)*Se}function b$23(fe,ve,_e,be){g$2d(fe,ve,_e,be,Ln.radius)}function k$1r(fe,ve,_e,be){g$2d(fe,ve,_e,be,In.radius)}function x$1F(fe,ve,_e,be){g$2d(fe,ve,_e,be,Rn.radius)}function y$25(fe,ve,_e,be,we){const Se=fe[ve],Te=fe[ve+1],Ee=fe[ve+2],Ce=Math.sqrt(Se*Se+Te*Te+Ee*Ee),Oe=l$4n(Ee/(0===Ce?1:Ce)),Re=Math.atan2(Te,Se);_e[be++]=kh*Re,_e[be++]=kh*Oe,_e[be]=Ce-we}function v$1S(fe,ve,_e,be){y$25(fe,ve,_e,be,Ln.radius)}function z$15(fe,ve,_e,be){y$25(fe,ve,_e,be,In.radius)}function D$16(fe,ve,_e,be){y$25(fe,ve,_e,be,Rn.radius)}function J$H(fe,ve,_e,be){D$16(fe,ve,_e,be),h$2B(_e,be,_e,be)}function Q$G(fe,ve,_e,be){D$16(fe,ve,_e,be),X$y(_e,be,_e,be)}function X$y(fe,ve,_e,be){!function V$15(fe,ve,_e,be,we){const Se=zh*fe[ve],Te=zh*fe[ve+1],Ee=fe[ve+2],Ce=Math.sin(Te),Oe=Math.cos(Te),Re=we.radius/Math.sqrt(1-we.eccentricitySquared*Ce*Ce);_e[be++]=(Re+Ee)*Oe*Math.cos(Se),_e[be++]=(Re+Ee)*Oe*Math.sin(Se),_e[be++]=(Re*(1-we.eccentricitySquared)+Ee)*Ce}(fe,ve,_e,be,Rn)}function Y$B(fe,ve,_e,be){const we=Mh,Se=fe[ve],Te=fe[ve+1],Ee=fe[ve+2];let Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t,bt,wt,xt,St,Et,Pt,Ot,At,Mt,Rt;Ce=Math.abs(Ee),Oe=Se*Se+Te*Te,Re=Math.sqrt(Oe),De=Oe+Ee*Ee,Be=Math.sqrt(De),Mt=Math.atan2(Te,Se),Ze=Ee*Ee/De,Xe=Oe/De,xt=we.a2/Be,St=we.a3-we.a4/Be,Xe>.3?(Je=Ce/Be*(1+Xe*(we.a1+xt+Ze*St)/Be),At=Math.asin(Je),dt=Je*Je,Qe=Math.sqrt(1-dt)):(Qe=Re/Be*(1-Ze*(we.a5-xt-Xe*St)/Be),At=Math.acos(Qe),dt=1-Qe*Qe,Je=Math.sqrt(dt)),$t=1-Rn.eccentricitySquared*dt,bt=Rn.radius/Math.sqrt($t),wt=we.a6*bt,xt=Re-bt*Qe,St=Ce-wt*Je,Pt=Qe*xt+Je*St,Et=Qe*St-Je*xt,Ot=Et/(wt/$t+Pt),At+=Ot,Rt=Pt+Et*Ot/2,Ee<0&&(At=-At),_e[be++]=kh*Mt,_e[be++]=kh*At,_e[be]=Rt}function Z$D(fe,ve,_e,be){Y$B(fe,ve,_e,be),x$1F(_e,be,_e,be)}function $$E(fe,ve,_e,be){Y$B(fe,ve,_e,be),h$2B(_e,be,_e,be)}function nn$2(fe,ve,_e){if(null==fe||null==ve||_e.source.spatialReference===fe&&_e.dest.spatialReference===ve)return _e;const be=F$15(fe,_e.source),we=F$15(ve,_e.dest);return be===Ih.UNKNOWN&&we===Ih.UNKNOWN?G$Y(fe,ve)?_e.projector=f$2Q:_e.projector=null:_e.projector=Lh[be][we],_e}function Cn(){return{source:{spatialReference:null,spatialReferenceId:Ih.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Ih.UNKNOWN,metersPerUnit:1},projector:f$2Q}}const Dh={spatialReference:null,spatialReferenceId:Ih.UNKNOWN},Nh={spatialReference:null,spatialReferenceId:Ih.UNKNOWN},Fh=Cn(),zh=h$2U(1),kh=M$1x(1),Uh=Math.PI,Vh=.5*Uh,Bh=Rn.radius,jh=Bh*Uh/180,Gh=180/(Bh*Uh);function n$49(fe,ve,_e,be,we,Se,Te=1){const Ee=G$S(ve,we,Fh);if(null==Ee)return!1;if(Ee===f$2Q){if(fe===be&&_e===Se)return!0;const ve=_e+3*Te;for(let we=_e,Te=Se;we<ve;we++,Te++)be[Te]=fe[we];return!0}const Ce=_e+3*Te;for(let Oe=_e,Re=Se;Oe<Ce;Oe+=3,Re+=3)Ee(fe,Oe,be,Re);return!0}const Hh=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:n$49},Symbol.toStringTag,{value:"Module"}));function t$3P(fe,ve,_e,be,we,Se){return qh[0]=fe,qh[1]=ve,qh[2]=_e,n$49(qh,be,0,we,Se,0,1)}const qh=[0,0,0];let Wh=0,Yh=class t6{static fromGE(fe){const ve=new t6;return ve._wkt=fe.wkt,ve._wkid=fe.wkid,ve._isInverse=fe.isInverse,ve}constructor(fe){this.uid=Wh++,fe?(this._wkt=null!=fe.wkt?fe.wkt:null,this._wkid=null!=fe.wkid?fe.wkid:-1,this._isInverse=null!=fe.isInverse&&!0===fe.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(fe){this._wkt=fe,this.uid=Wh++}get wkid(){return this._wkid}set wkid(fe){this._wkid=fe,this.uid=Wh++}get isInverse(){return this._isInverse}set isInverse(fe){this._isInverse=fe,this.uid=Wh++}getInverse(){const fe=new t6;return fe._wkt=this.wkt,fe._wkid=this._wkid,fe._isInverse=!this.isInverse,fe}},Zh=class s11{static cacheKey(fe,ve){var _e,be,we,Se,Te,Ee;return[(null==(_e=fe.wkid)?void 0:_e.toString())??"-1",(null==(be=fe.wkt)?void 0:be.toString())??"",(null==(we=fe.wkt2)?void 0:we.toString())??"",(null==(Se=ve.wkid)?void 0:Se.toString())??"-1",(null==(Te=ve.wkt)?void 0:Te.toString())??"",(null==(Ee=ve.wkt2)?void 0:Ee.toString())??""].join()}static fromGE(fe){const ve=new s11;let _e="";for(const be of fe.steps){const fe=Yh.fromGE(be);ve.steps.push(fe),_e+=fe.uid.toString()+","}return ve._cachedProjection={},ve._gtlistentry=null,ve._chain=_e,ve}constructor(fe){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,null==fe?void 0:fe.steps)for(const ve of fe.steps)ve instanceof Yh?this.steps.push(ve):this.steps.push(new Yh({wkid:ve.wkid,wkt:ve.wkt,isInverse:ve.isInverse}))}getInverse(){const fe=new s11;fe.steps=[];for(let ve=this.steps.length-1;ve>=0;ve--){const _e=this.steps[ve];fe.steps.push(_e.getInverse())}return fe}getGTListEntry(){let fe="";for(const ve of this.steps)fe+=ve.uid.toString()+",";return fe!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=fe),this._gtlistentry}assignCachedGe(fe,ve,_e){this._cachedProjection[s11.cacheKey(fe,ve)]=_e}getCachedGeTransformation(fe,ve){let _e="";for(const we of this.steps)_e+=we.uid.toString()+",";_e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=_e);const be=this._cachedProjection[s11.cacheKey(fe,ve)];return void 0===be?null:be}};function o$3F(fe,ve,_e){if(null==ve||null==_e||_e.vcsWkid||G$Y(ve,_e)||O$1r(ve)||O$1r(_e))return null;const be=L$1d(ve)/L$1d(_e);if(1===be)return null;switch(fe){case"point":case"esriGeometryPoint":return fe=>function r$3b(fe,ve){null!=(null==fe?void 0:fe.z)&&(fe.z*=ve)}(fe,be);case"polyline":case"esriGeometryPolyline":return fe=>function l$3$(fe,ve){if(fe)for(const _e of fe.paths)for(const fe of _e)fe.length>2&&(fe[2]*=ve)}(fe,be);case"polygon":case"esriGeometryPolygon":return fe=>function i$49(fe,ve){if(fe)for(const _e of fe.rings)for(const fe of _e)fe.length>2&&(fe[2]*=ve)}(fe,be);case"multipoint":case"esriGeometryMultipoint":return fe=>function s$3N(fe,ve){if(fe)for(const _e of fe.points)_e.length>2&&(_e[2]*=ve)}(fe,be);case"extent":case"esriGeometryEnvelope":return fe=>function c$4m(fe,ve){fe&&null!=fe.zmin&&null!=fe.zmax&&(fe.zmin*=ve,fe.zmax*=ve)}(fe,be);default:return null}}let Xh=null,Jh=null,Qh=null,Kh={};const ed=new Fa;function _$1p(){return!!Xh&&r$3q()}function k$1q(){return!!_$1p()||(s$4u(ed),W$J(),!1)}function B$12(fe,ve){return!fe||!ve||J$G(fe,ve)||k$1q()}function U$15(fe,ve){return!J$G(fe,ve)&&!_$1p()}function W$J(fe){return null==Qh&&(Qh=Promise.all([_$1v(),zt((()=>import("./geometryEngineBase-9EI9fooq.js")),[]).then((fe=>fe.g)),zt((()=>import("./hydrated-DE1HcVsK.js")),[])])),Qh.then((([,ve,{hydratedAdapter:_e}])=>{s$4o(fe),Jh=_e,Xh=ve.default,Xh._enableProjection(eo),ed.notify()}))}function K$D(fe,ve,_e=null,be=null){return Array.isArray(fe)?0===fe.length?[]:O$1m(Jh,fe,fe[0].spatialReference,ve,_e,be):O$1m(Jh,[fe],fe.spatialReference,ve,_e,be)[0]}function O$1m(fe,ve,_e,be,we=null,Se=null){if(null==_e||null==be)return ve;if(J$G(_e,be,we))return ve.map((fe=>Q$F(fe,_e,be)));if(null==we&&A$1A(_e))return ve.map((fe=>Q$F(fe,_e,zo.WGS84))).map((fe=>H$13(fe,be)));if(null==we&&A$1A(be))return ve.map((fe=>H$13(fe,zo.WGS84))).map((fe=>Q$F(fe,zo.WGS84,be)));if(null==we){const fe=Zh.cacheKey(_e,be);void 0!==Kh[fe]?we=Kh[fe]:(null==(we=Y$A(_e,be,void 0))&&(we=new Zh),Kh[fe]=we)}if(null==Xh||null==fe)throw new td;return null!=Se?Xh._project(fe,ve,_e,be,we,Se):Xh._project(fe,ve,_e,be,we)}function V$14(fe,ve){const _e=X$x([fe],ve);return null!=_e.pending?{pending:_e.pending,geometry:null}:null!=_e.geometries?{pending:null,geometry:_e.geometries[0]}:{pending:null,geometry:null}}function X$x(fe,ve){if(!_$1p())for(const _e of fe)if(null!=_e&&!G$Y(_e.spatialReference,ve)&&N$17(_e.spatialReference)&&N$17(ve)&&!J$G(_e.spatialReference,ve))return s$4u(ed),{pending:W$J(),geometries:null};return{pending:null,geometries:fe.map((fe=>null==fe?null:G$Y(fe.spatialReference,ve)?fe:N$17(fe.spatialReference)&&N$17(ve)?H$13(fe,ve):null))}}function Y$A(fe,ve,_e=null){if(null==fe||null==ve)return null;if(null==Xh||null==Jh)throw new td;const be=Xh._getTransformation(Jh,fe,ve,_e,null==_e?void 0:_e.spatialReference);return null!==be?Zh.fromGE(be):null}let td=class C extends Ir{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};const rd={get loadPromise(){return Qh}};function H$13(fe,ve){try{const _e=K$D(fe,ve);if(null==_e)return null;"xmin"in fe&&"xmin"in _e&&(_e.zmin=fe.zmin,_e.zmax=fe.zmax);const be=o$3F(_e.type,fe.spatialReference,ve);return null!=be&&be(_e),_e}catch(Dr){if(!(Dr instanceof td))throw Dr;return null}}async function I$1u(fe,ve,_e){const be=fe.spatialReference;return null!=be&&null!=ve&&await N$13(be,ve,null,_e),H$13(fe,ve)}function J$G(fe,ve,_e){return!_e&&(!!G$Y(fe,ve)||N$17(fe)&&N$17(ve)&&!!G$S(fe,ve,Fh))}function L$18(fe,ve){if(G$Y(fe,ve))return!0;if(!N$17(fe)||!N$17(ve))return!1;const _e=C$1p(fe)||w$1X(fe)||k$1w(fe),be=C$1p(ve)||w$1X(ve)||k$1w(ve);return _e&&be}async function N$13(fe,ve,_e,be){if(_$1p())return D$1i(be);if(Array.isArray(fe)){for(const{source:we,dest:Se,geographicTransformation:Te}of fe)if(we&&Se&&!J$G(we,Se,Te))return W$J(be)}else if(fe&&ve&&!J$G(fe,ve,_e))return W$J(be);return D$1i(be)}function Q$F(fe,ve,_e){return fe?"x"in fe?nn$1(fe,ve,new Yo,_e,0):"xmin"in fe?an(fe,ve,new aa,_e,0):"rings"in fe?un(fe,ve,new wa,_e,0):"paths"in fe?ln(fe,ve,new Ta,_e,0):"points"in fe?rn(fe,ve,new ua,_e,0):null:null}function $$D(fe,ve,_e=ve.spatialReference,be=0){return null!=_e&&null!=fe.spatialReference&&null!=nn$1(fe,fe.spatialReference,ve,_e,be)}function nn$1(fe,ve,_e,be,we){id[0]=fe.x,id[1]=fe.y;const Se=fe.z;return id[2]=void 0!==Se?Se:we,n$49(id,ve,0,id,be,0,1)?(_e.x=id[0],_e.y=id[1],_e.spatialReference=be,void 0!==Se||O$1r(be)?(_e.z=id[2],_e.hasZ=!0):(_e.z=void 0,_e.hasZ=!1),void 0===fe.m?(_e.m=void 0,_e.hasM=!1):(_e.m=fe.m,_e.hasM=!0),_e):null}function rn(fe,ve,_e,be,we){const{points:Se,hasZ:Te,hasM:Ee}=fe,Ce=[],Oe=Se.length,Re=[];for(const Be of Se)Re.push(Be[0],Be[1],Te?Be[2]:we);if(!n$49(Re,ve,0,Re,be,0,Oe))return null;const De=Te||O$1r(be);for(let Be=0;Be<Oe;++Be){const fe=3*Be,ve=Re[fe],_e=Re[fe+1];De&&Ee?Ce.push([ve,_e,Re[fe+2],Se[Be][3]]):De?Ce.push([ve,_e,Re[fe+2]]):Ee?Ce.push([ve,_e,Se[Be][2]]):Ce.push([ve,_e])}return _e.points=Ce,_e.spatialReference=be,_e.hasZ=Te,_e.hasM=Ee,_e}function ln(fe,ve,_e,be,we){const{paths:Se,hasZ:Te,hasM:Ee}=fe,Ce=[];if(!cn(Se,Te??!1,Ee??!1,ve,Ce,be,we))return null;const Oe=Te||O$1r(be);return _e.paths=Ce,_e.spatialReference=be,_e.hasZ=Oe,_e.hasM=Ee,_e}function on(fe,ve,_e=ve.spatialReference,be=0){return null!=fe.spatialReference&&null!=_e&&null!=un(fe,fe.spatialReference,ve,_e,be)}function un(fe,ve,_e,be,we){const{rings:Se,hasZ:Te,hasM:Ee}=fe,Ce=[];if(!cn(Se,Te??!1,Ee??!1,ve,Ce,be,we))return null;const Oe=Te||O$1r(be);return _e.rings=Ce,_e.spatialReference=be,_e.hasZ=Oe,_e.hasM=Ee,_e}function an(fe,ve,_e,be,we){const{xmin:Se,ymin:Te,xmax:Ee,ymax:Ce,hasZ:Oe,hasM:Re}=fe;if(!t$3P(Se,Te,Oe?fe.zmin:we,ve,id,be))return null;const De=Oe||O$1r(be);_e.xmin=id[0],_e.ymin=id[1],De&&(_e.zmin=id[2]);return t$3P(Ee,Ce,Oe?fe.zmax:we,ve,id,be)?(_e.xmax=id[0],_e.ymax=id[1],De&&(_e.zmax=id[2]),Re&&(_e.mmin=fe.mmin,_e.mmax=fe.mmax),_e.spatialReference=be,_e):null}function cn(fe,ve,_e,be,we,Se,Te=0){const Ee=new Array;for(const Re of fe)for(const fe of Re)Ee.push(fe[0],fe[1],ve?fe[2]:Te);if(!n$49(Ee,be,0,Ee,Se,0,Ee.length/3))return!1;let Ce=0;we.length=0;const Oe=ve||O$1r(Se);for(const Re of fe){const fe=new Array;for(const ve of Re)Oe&&_e?fe.push([Ee[Ce++],Ee[Ce++],Ee[Ce++],ve[3]]):Oe?fe.push([Ee[Ce++],Ee[Ce++],Ee[Ce++]]):_e?(fe.push([Ee[Ce++],Ee[Ce++],ve[2]]),Ce++):(fe.push([Ee[Ce++],Ee[Ce++]]),Ce++);we.push(fe)}return!0}const id=[0,0,0],nd=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:J$G,getTransformation:Y$A,getTransformations:function q$Y(fe,ve,_e=null){if(null==Xh||null==Jh)throw new td;const be=Xh._getTransformationBySuitability(Jh,fe,ve,_e,null==_e?void 0:_e.spatialReference);if(null!==be){const fe=[];for(const ve of be)fe.push(Zh.fromGE(ve));return fe}return[]},initializeProjection:N$13,isEqualBaseGCS:L$18,isLoaded:_$1p,isLoadedOrLoad:k$1q,isLoadedOrLoadFor:B$12,load:W$J,project:K$D,projectExtent:function sn(fe,ve,_e=ve.spatialReference,be=0){return null!=fe.spatialReference&&null!=_e&&null!=an(fe,fe.spatialReference,ve,_e,be)},projectMany:O$1m,projectMultipoint:function en$1(fe,ve,_e=ve.spatialReference,be=0){return null!=fe.spatialReference&&null!=_e&&null!=rn(fe,fe.spatialReference,ve,_e,be)},projectOrLoad:V$14,projectOrLoadMany:X$x,projectPoint:$$D,projectPolygon:on,projectPolyline:function tn$1(fe,ve,_e=ve.spatialReference,be=0){return null!=fe.spatialReference&&null!=_e&&null!=ln(fe,fe.spatialReference,ve,_e,be)},projectWithZConversion:I$1u,projectWithoutEngine:Q$F,requiresLoad:U$15,test:rd,tryProjectWithZConversion:H$13,unload:function D$15(){Xh=null,Jh=null,Qh=null,Kh={}}},Symbol.toStringTag,{value:"Module"}));function i$48(fe,ve,_e,be){return!(null==fe||(G$Y(ve,be)?(e$3R(_e,fe),0):(sd[0]=fe[0],sd[1]=fe[1],sd[2]=0,!n$49(sd,ve,0,sd,be,0,1)||(_e[0]=sd[0],_e[1]=sd[1],sd[0]=fe[2],sd[1]=fe[3],sd[2]=0,!n$49(sd,ve,0,sd,be,0,1)||(_e[2]=sd[0],_e[3]=sd[1],0)))))}const sd=[0,0,0];function c$4l(fe,ve,_e,be){if(J$G(fe.spatialReference,_e)){od[0]=fe.x,od[1]=fe.y;const we=fe.z;return od[2]=we??be??0,n$49(od,fe.spatialReference,0,ve,_e,0,1)}const we=H$13(fe,_e);return!!we&&(ve[0]=null==we?void 0:we.x,ve[1]=null==we?void 0:we.y,ve[2]=(null==we?void 0:we.z)??be??0,!0)}async function i$47(fe,ve,_e,be,we){return await N$13(fe.spatialReference,_e,null,we),c$4l(fe,ve,_e,be)}const od=[0,0,0];let ad=class s12{constructor(fe){this._allocator=fe,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t$4h((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const fe=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*ld);this._items.length=Math.min(fe,this._items.length),this._itemsPtr=0}_grow(){for(let fe=0;fe<Math.max(8,Math.min(this._items.length,ld));fe++)this._items.push(this._allocator())}};const ld=1024;function n$48(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe[4]=ve[4],fe[5]=ve[5],fe[6]=ve[6],fe[7]=ve[7],fe[8]=ve[8],fe[9]=ve[9],fe[10]=ve[10],fe[11]=ve[11],fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15],fe}function r$3a(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe[4]=Se,fe[5]=Te,fe[6]=Ee,fe[7]=Ce,fe[8]=Oe,fe[9]=Re,fe[10]=De,fe[11]=Be,fe[12]=Ze,fe[13]=Xe,fe[14]=Je,fe[15]=Qe,fe}function o$3E(fe){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=1,fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[10]=1,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function s$3L(fe,ve){if(fe===ve){const _e=ve[1],be=ve[2],we=ve[3],Se=ve[6],Te=ve[7],Ee=ve[11];fe[1]=ve[4],fe[2]=ve[8],fe[3]=ve[12],fe[4]=_e,fe[6]=ve[9],fe[7]=ve[13],fe[8]=be,fe[9]=Se,fe[11]=ve[14],fe[12]=we,fe[13]=Te,fe[14]=Ee}else fe[0]=ve[0],fe[1]=ve[4],fe[2]=ve[8],fe[3]=ve[12],fe[4]=ve[1],fe[5]=ve[5],fe[6]=ve[9],fe[7]=ve[13],fe[8]=ve[2],fe[9]=ve[6],fe[10]=ve[10],fe[11]=ve[14],fe[12]=ve[3],fe[13]=ve[7],fe[14]=ve[11],fe[15]=ve[15];return fe}function e$3H(fe,ve){return h$2A(fe,ve)||o$3E(fe),fe}function h$2A(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5],Ce=ve[6],Oe=ve[7],Re=ve[8],De=ve[9],Be=ve[10],Ze=ve[11],Xe=ve[12],Je=ve[13],Qe=ve[14],dt=ve[15],$t=_e*Ee-be*Te,bt=_e*Ce-we*Te,wt=_e*Oe-Se*Te,xt=be*Ce-we*Ee,St=be*Oe-Se*Ee,Et=we*Oe-Se*Ce,Pt=Re*Je-De*Xe,Ot=Re*Qe-Be*Xe,At=Re*dt-Ze*Xe,Mt=De*Qe-Be*Je,Rt=De*dt-Ze*Je,Nt=Be*dt-Ze*Qe;let Ft=$t*Nt-bt*Rt+wt*Mt+xt*At-St*Ot+Et*Pt;return Ft?(Ft=1/Ft,fe[0]=(Ee*Nt-Ce*Rt+Oe*Mt)*Ft,fe[1]=(we*Rt-be*Nt-Se*Mt)*Ft,fe[2]=(Je*Et-Qe*St+dt*xt)*Ft,fe[3]=(Be*St-De*Et-Ze*xt)*Ft,fe[4]=(Ce*At-Te*Nt-Oe*Ot)*Ft,fe[5]=(_e*Nt-we*At+Se*Ot)*Ft,fe[6]=(Qe*wt-Xe*Et-dt*bt)*Ft,fe[7]=(Re*Et-Be*wt+Ze*bt)*Ft,fe[8]=(Te*Rt-Ee*At+Oe*Pt)*Ft,fe[9]=(be*At-_e*Rt-Se*Pt)*Ft,fe[10]=(Xe*St-Je*wt+dt*$t)*Ft,fe[11]=(De*wt-Re*St-Ze*$t)*Ft,fe[12]=(Ee*Ot-Te*Mt-Ce*Pt)*Ft,fe[13]=(_e*Mt-be*Ot+we*Pt)*Ft,fe[14]=(Je*bt-Xe*xt-Qe*$t)*Ft,fe[15]=(Re*xt-De*bt+Be*$t)*Ft,fe):null}function c$4k(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=ve[6],Re=ve[7],De=ve[8],Be=ve[9],Ze=ve[10],Xe=ve[11],Je=ve[12],Qe=ve[13],dt=ve[14],$t=ve[15];let bt=_e[0],wt=_e[1],xt=_e[2],St=_e[3];return fe[0]=bt*be+wt*Ee+xt*De+St*Je,fe[1]=bt*we+wt*Ce+xt*Be+St*Qe,fe[2]=bt*Se+wt*Oe+xt*Ze+St*dt,fe[3]=bt*Te+wt*Re+xt*Xe+St*$t,bt=_e[4],wt=_e[5],xt=_e[6],St=_e[7],fe[4]=bt*be+wt*Ee+xt*De+St*Je,fe[5]=bt*we+wt*Ce+xt*Be+St*Qe,fe[6]=bt*Se+wt*Oe+xt*Ze+St*dt,fe[7]=bt*Te+wt*Re+xt*Xe+St*$t,bt=_e[8],wt=_e[9],xt=_e[10],St=_e[11],fe[8]=bt*be+wt*Ee+xt*De+St*Je,fe[9]=bt*we+wt*Ce+xt*Be+St*Qe,fe[10]=bt*Se+wt*Oe+xt*Ze+St*dt,fe[11]=bt*Te+wt*Re+xt*Xe+St*$t,bt=_e[12],wt=_e[13],xt=_e[14],St=_e[15],fe[12]=bt*be+wt*Ee+xt*De+St*Je,fe[13]=bt*we+wt*Ce+xt*Be+St*Qe,fe[14]=bt*Se+wt*Oe+xt*Ze+St*dt,fe[15]=bt*Te+wt*Re+xt*Xe+St*$t,fe}function i$45(fe,ve,_e){const be=_e[0],we=_e[1],Se=_e[2];if(ve===fe)fe[12]=ve[0]*be+ve[4]*we+ve[8]*Se+ve[12],fe[13]=ve[1]*be+ve[5]*we+ve[9]*Se+ve[13],fe[14]=ve[2]*be+ve[6]*we+ve[10]*Se+ve[14],fe[15]=ve[3]*be+ve[7]*we+ve[11]*Se+ve[15];else{const _e=ve[0],Te=ve[1],Ee=ve[2],Ce=ve[3],Oe=ve[4],Re=ve[5],De=ve[6],Be=ve[7],Ze=ve[8],Xe=ve[9],Je=ve[10],Qe=ve[11];fe[0]=_e,fe[1]=Te,fe[2]=Ee,fe[3]=Ce,fe[4]=Oe,fe[5]=Re,fe[6]=De,fe[7]=Be,fe[8]=Ze,fe[9]=Xe,fe[10]=Je,fe[11]=Qe,fe[12]=_e*be+Oe*we+Ze*Se+ve[12],fe[13]=Te*be+Re*we+Xe*Se+ve[13],fe[14]=Ee*be+De*we+Je*Se+ve[14],fe[15]=Ce*be+Be*we+Qe*Se+ve[15]}return fe}function f$2O(fe,ve,_e){const be=_e[0],we=_e[1],Se=_e[2];return fe[0]=ve[0]*be,fe[1]=ve[1]*be,fe[2]=ve[2]*be,fe[3]=ve[3]*be,fe[4]=ve[4]*we,fe[5]=ve[5]*we,fe[6]=ve[6]*we,fe[7]=ve[7]*we,fe[8]=ve[8]*Se,fe[9]=ve[9]*Se,fe[10]=ve[10]*Se,fe[11]=ve[11]*Se,fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15],fe}function b$21(fe,ve,_e,be){let we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t,bt,wt,xt,St,Et,Pt,Ot,At,Mt,Rt=be[0],Nt=be[1],Ft=be[2],zt=Math.sqrt(Rt*Rt+Nt*Nt+Ft*Ft);return zt<e$3_()?null:(zt=1/zt,Rt*=zt,Nt*=zt,Ft*=zt,we=Math.sin(_e),Se=Math.cos(_e),Te=1-Se,Ee=ve[0],Ce=ve[1],Oe=ve[2],Re=ve[3],De=ve[4],Be=ve[5],Ze=ve[6],Xe=ve[7],Je=ve[8],Qe=ve[9],dt=ve[10],$t=ve[11],bt=Rt*Rt*Te+Se,wt=Nt*Rt*Te+Ft*we,xt=Ft*Rt*Te-Nt*we,St=Rt*Nt*Te-Ft*we,Et=Nt*Nt*Te+Se,Pt=Ft*Nt*Te+Rt*we,Ot=Rt*Ft*Te+Nt*we,At=Nt*Ft*Te-Rt*we,Mt=Ft*Ft*Te+Se,fe[0]=Ee*bt+De*wt+Je*xt,fe[1]=Ce*bt+Be*wt+Qe*xt,fe[2]=Oe*bt+Ze*wt+dt*xt,fe[3]=Re*bt+Xe*wt+$t*xt,fe[4]=Ee*St+De*Et+Je*Pt,fe[5]=Ce*St+Be*Et+Qe*Pt,fe[6]=Oe*St+Ze*Et+dt*Pt,fe[7]=Re*St+Xe*Et+$t*Pt,fe[8]=Ee*Ot+De*At+Je*Mt,fe[9]=Ce*Ot+Be*At+Qe*Mt,fe[10]=Oe*Ot+Ze*At+dt*Mt,fe[11]=Re*Ot+Xe*At+$t*Mt,ve!==fe&&(fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15]),fe)}function l$3_(fe,ve,_e){const be=Math.sin(_e),we=Math.cos(_e),Se=ve[4],Te=ve[5],Ee=ve[6],Ce=ve[7],Oe=ve[8],Re=ve[9],De=ve[10],Be=ve[11];return ve!==fe&&(fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15]),fe[4]=Se*we+Oe*be,fe[5]=Te*we+Re*be,fe[6]=Ee*we+De*be,fe[7]=Ce*we+Be*be,fe[8]=Oe*we-Se*be,fe[9]=Re*we-Te*be,fe[10]=De*we-Ee*be,fe[11]=Be*we-Ce*be,fe}function m$3m(fe,ve,_e){const be=Math.sin(_e),we=Math.cos(_e),Se=ve[0],Te=ve[1],Ee=ve[2],Ce=ve[3],Oe=ve[8],Re=ve[9],De=ve[10],Be=ve[11];return ve!==fe&&(fe[4]=ve[4],fe[5]=ve[5],fe[6]=ve[6],fe[7]=ve[7],fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15]),fe[0]=Se*we-Oe*be,fe[1]=Te*we-Re*be,fe[2]=Ee*we-De*be,fe[3]=Ce*we-Be*be,fe[8]=Se*be+Oe*we,fe[9]=Te*be+Re*we,fe[10]=Ee*be+De*we,fe[11]=Ce*be+Be*we,fe}function x$1E(fe,ve,_e){const be=Math.sin(_e),we=Math.cos(_e),Se=ve[0],Te=ve[1],Ee=ve[2],Ce=ve[3],Oe=ve[4],Re=ve[5],De=ve[6],Be=ve[7];return ve!==fe&&(fe[8]=ve[8],fe[9]=ve[9],fe[10]=ve[10],fe[11]=ve[11],fe[12]=ve[12],fe[13]=ve[13],fe[14]=ve[14],fe[15]=ve[15]),fe[0]=Se*we+Oe*be,fe[1]=Te*we+Re*be,fe[2]=Ee*we+De*be,fe[3]=Ce*we+Be*be,fe[4]=Oe*we-Se*be,fe[5]=Re*we-Te*be,fe[6]=De*we-Ee*be,fe[7]=Be*we-Ce*be,fe}function q$X(fe,ve){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=1,fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[10]=1,fe[11]=0,fe[12]=ve[0],fe[13]=ve[1],fe[14]=ve[2],fe[15]=1,fe}function d$32(fe,ve){return fe[0]=ve[0],fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=ve[1],fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[10]=ve[2],fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function p$4z(fe,ve,_e){if(0===ve)return o$3E(fe);let be,we,Se,Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=Math.sqrt(Te*Te+Ee*Ee+Ce*Ce);return Oe<e$3_()?null:(Oe=1/Oe,Te*=Oe,Ee*=Oe,Ce*=Oe,be=Math.sin(ve),we=Math.cos(ve),Se=1-we,fe[0]=Te*Te*Se+we,fe[1]=Ee*Te*Se+Ce*be,fe[2]=Ce*Te*Se-Ee*be,fe[3]=0,fe[4]=Te*Ee*Se-Ce*be,fe[5]=Ee*Ee*Se+we,fe[6]=Ce*Ee*Se+Te*be,fe[7]=0,fe[8]=Te*Ce*Se+Ee*be,fe[9]=Ee*Ce*Se-Te*be,fe[10]=Ce*Ce*Se+we,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe)}function g$2c(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=be,fe[6]=_e,fe[7]=0,fe[8]=0,fe[9]=-_e,fe[10]=be,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function y$24(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=be,fe[1]=0,fe[2]=-_e,fe[3]=0,fe[4]=0,fe[5]=1,fe[6]=0,fe[7]=0,fe[8]=_e,fe[9]=0,fe[10]=be,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function R$1b(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=be,fe[1]=_e,fe[2]=0,fe[3]=0,fe[4]=-_e,fe[5]=be,fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[10]=1,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function S$1H(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=be+be,Ce=we+we,Oe=Se+Se,Re=be*Ee,De=be*Ce,Be=be*Oe,Ze=we*Ce,Xe=we*Oe,Je=Se*Oe,Qe=Te*Ee,dt=Te*Ce,$t=Te*Oe;return fe[0]=1-(Ze+Je),fe[1]=De+$t,fe[2]=Be-dt,fe[3]=0,fe[4]=De-$t,fe[5]=1-(Re+Je),fe[6]=Xe+Qe,fe[7]=0,fe[8]=Be+dt,fe[9]=Xe-Qe,fe[10]=1-(Re+Ze),fe[11]=0,fe[12]=_e[0],fe[13]=_e[1],fe[14]=_e[2],fe[15]=1,fe}const cd=[0,0,0];function I$1t(fe,ve){return fe[0]=ve[12],fe[1]=ve[13],fe[2]=ve[14],fe}function O$1l(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[4],Te=ve[5],Ee=ve[6],Ce=ve[8],Oe=ve[9],Re=ve[10];return fe[0]=Math.sqrt(_e*_e+be*be+we*we),fe[1]=Math.sqrt(Se*Se+Te*Te+Ee*Ee),fe[2]=Math.sqrt(Ce*Ce+Oe*Oe+Re*Re),fe}function j$1B(fe,ve){const _e=ve[0]+ve[5]+ve[10];let be=0;return _e>0?(be=2*Math.sqrt(_e+1),fe[3]=.25*be,fe[0]=(ve[6]-ve[9])/be,fe[1]=(ve[8]-ve[2])/be,fe[2]=(ve[1]-ve[4])/be):ve[0]>ve[5]&&ve[0]>ve[10]?(be=2*Math.sqrt(1+ve[0]-ve[5]-ve[10]),fe[3]=(ve[6]-ve[9])/be,fe[0]=.25*be,fe[1]=(ve[1]+ve[4])/be,fe[2]=(ve[8]+ve[2])/be):ve[5]>ve[10]?(be=2*Math.sqrt(1+ve[5]-ve[0]-ve[10]),fe[3]=(ve[8]-ve[2])/be,fe[0]=(ve[1]+ve[4])/be,fe[1]=.25*be,fe[2]=(ve[6]+ve[9])/be):(be=2*Math.sqrt(1+ve[10]-ve[0]-ve[5]),fe[3]=(ve[1]-ve[4])/be,fe[0]=(ve[8]+ve[2])/be,fe[1]=(ve[6]+ve[9])/be,fe[2]=.25*be),fe}function P$18(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2],Ee=ve[3],Ce=we+we,Oe=Se+Se,Re=Te+Te,De=we*Ce,Be=we*Oe,Ze=we*Re,Xe=Se*Oe,Je=Se*Re,Qe=Te*Re,dt=Ee*Ce,$t=Ee*Oe,bt=Ee*Re,wt=be[0],xt=be[1],St=be[2];return fe[0]=(1-(Xe+Qe))*wt,fe[1]=(Be+bt)*wt,fe[2]=(Ze-$t)*wt,fe[3]=0,fe[4]=(Be-bt)*xt,fe[5]=(1-(De+Qe))*xt,fe[6]=(Je+dt)*xt,fe[7]=0,fe[8]=(Ze+$t)*St,fe[9]=(Je-dt)*St,fe[10]=(1-(De+Xe))*St,fe[11]=0,fe[12]=_e[0],fe[13]=_e[1],fe[14]=_e[2],fe[15]=1,fe}function D$14(fe,ve,_e,be,we){const Se=ve[0],Te=ve[1],Ee=ve[2],Ce=ve[3],Oe=Se+Se,Re=Te+Te,De=Ee+Ee,Be=Se*Oe,Ze=Se*Re,Xe=Se*De,Je=Te*Re,Qe=Te*De,dt=Ee*De,$t=Ce*Oe,bt=Ce*Re,wt=Ce*De,xt=be[0],St=be[1],Et=be[2],Pt=we[0],Ot=we[1],At=we[2],Mt=(1-(Je+dt))*xt,Rt=(Ze+wt)*xt,Nt=(Xe-bt)*xt,Ft=(Ze-wt)*St,zt=(1-(Be+dt))*St,kt=(Qe+$t)*St,Bt=(Xe+bt)*Et,jt=(Qe-$t)*Et,Gt=(1-(Be+Je))*Et;return fe[0]=Mt,fe[1]=Rt,fe[2]=Nt,fe[3]=0,fe[4]=Ft,fe[5]=zt,fe[6]=kt,fe[7]=0,fe[8]=Bt,fe[9]=jt,fe[10]=Gt,fe[11]=0,fe[12]=_e[0]+Pt-(Mt*Pt+Ft*Ot+Bt*At),fe[13]=_e[1]+Ot-(Rt*Pt+zt*Ot+jt*At),fe[14]=_e[2]+At-(Nt*Pt+kt*Ot+Gt*At),fe[15]=1,fe}function _$1o(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=_e+_e,Ee=be+be,Ce=we+we,Oe=_e*Te,Re=be*Te,De=be*Ee,Be=we*Te,Ze=we*Ee,Xe=we*Ce,Je=Se*Te,Qe=Se*Ee,dt=Se*Ce;return fe[0]=1-De-Xe,fe[1]=Re+dt,fe[2]=Be-Qe,fe[3]=0,fe[4]=Re-dt,fe[5]=1-Oe-Xe,fe[6]=Ze+Je,fe[7]=0,fe[8]=Be+Qe,fe[9]=Ze-Je,fe[10]=1-Oe-De,fe[11]=0,fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1,fe}function A$1w(fe,ve,_e,be,we,Se,Te){const Ee=1/(_e-ve),Ce=1/(we-be),Oe=1/(Se-Te);return fe[0]=2*Se*Ee,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=2*Se*Ce,fe[6]=0,fe[7]=0,fe[8]=(_e+ve)*Ee,fe[9]=(we+be)*Ce,fe[10]=(Te+Se)*Oe,fe[11]=-1,fe[12]=0,fe[13]=0,fe[14]=Te*Se*2*Oe,fe[15]=0,fe}function Q$E(fe,ve,_e,be,we,Se,Te){const Ee=1/(ve-_e),Ce=1/(be-we),Oe=1/(Se-Te);return fe[0]=-2*Ee,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=-2*Ce,fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[10]=2*Oe,fe[11]=0,fe[12]=(ve+_e)*Ee,fe[13]=(we+be)*Ce,fe[14]=(Te+Se)*Oe,fe[15]=1,fe}function X$w(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2];let Ee=we-_e[0],Ce=Se-_e[1],Oe=Te-_e[2];const Re=e$3_();if(Math.abs(Ee)<Re&&Math.abs(Ce)<Re&&Math.abs(Oe)<Re)return void o$3E(fe);let De=1/Math.sqrt(Ee*Ee+Ce*Ce+Oe*Oe);Ee*=De,Ce*=De,Oe*=De;const Be=be[0],Ze=be[1],Xe=be[2];let Je=Ze*Oe-Xe*Ce,Qe=Xe*Ee-Be*Oe,dt=Be*Ce-Ze*Ee;De=Math.sqrt(Je*Je+Qe*Qe+dt*dt),De?(De=1/De,Je*=De,Qe*=De,dt*=De):(Je=0,Qe=0,dt=0);let $t=Ce*dt-Oe*Qe,bt=Oe*Je-Ee*dt,wt=Ee*Qe-Ce*Je;De=Math.sqrt($t*$t+bt*bt+wt*wt),De?(De=1/De,$t*=De,bt*=De,wt*=De):($t=0,bt=0,wt=0),fe[0]=Je,fe[1]=$t,fe[2]=Ee,fe[3]=0,fe[4]=Qe,fe[5]=bt,fe[6]=Ce,fe[7]=0,fe[8]=dt,fe[9]=wt,fe[10]=Oe,fe[11]=0,fe[12]=-(Je*we+Qe*Se+dt*Te),fe[13]=-($t*we+bt*Se+wt*Te),fe[14]=-(Ee*we+Ce*Se+Oe*Te),fe[15]=1}function Y$z(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2],Ee=be[0],Ce=be[1],Oe=be[2];let Re=we-_e[0],De=Se-_e[1],Be=Te-_e[2],Ze=Re*Re+De*De+Be*Be;Ze>0&&(Ze=1/Math.sqrt(Ze),Re*=Ze,De*=Ze,Be*=Ze);let Xe=Ce*Be-Oe*De,Je=Oe*Re-Ee*Be,Qe=Ee*De-Ce*Re;return Ze=Xe*Xe+Je*Je+Qe*Qe,Ze>0&&(Ze=1/Math.sqrt(Ze),Xe*=Ze,Je*=Ze,Qe*=Ze),fe[0]=Xe,fe[1]=Je,fe[2]=Qe,fe[3]=0,fe[4]=De*Qe-Be*Je,fe[5]=Be*Xe-Re*Qe,fe[6]=Re*Je-De*Xe,fe[7]=0,fe[8]=Re,fe[9]=De,fe[10]=Be,fe[11]=0,fe[12]=we,fe[13]=Se,fe[14]=Te,fe[15]=1,fe}function E$1B(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe[3]=ve[3]-_e[3],fe[4]=ve[4]-_e[4],fe[5]=ve[5]-_e[5],fe[6]=ve[6]-_e[6],fe[7]=ve[7]-_e[7],fe[8]=ve[8]-_e[8],fe[9]=ve[9]-_e[9],fe[10]=ve[10]-_e[10],fe[11]=ve[11]-_e[11],fe[12]=ve[12]-_e[12],fe[13]=ve[13]-_e[13],fe[14]=ve[14]-_e[14],fe[15]=ve[15]-_e[15],fe}function B$11(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]&&fe[4]===ve[4]&&fe[5]===ve[5]&&fe[6]===ve[6]&&fe[7]===ve[7]&&fe[8]===ve[8]&&fe[9]===ve[9]&&fe[10]===ve[10]&&fe[11]===ve[11]&&fe[12]===ve[12]&&fe[13]===ve[13]&&fe[14]===ve[14]&&fe[15]===ve[15]}function C$1l(fe,ve){if(fe===ve)return!0;const _e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=fe[4],Ee=fe[5],Ce=fe[6],Oe=fe[7],Re=fe[8],De=fe[9],Be=fe[10],Ze=fe[11],Xe=fe[12],Je=fe[13],Qe=fe[14],dt=fe[15],$t=ve[0],bt=ve[1],wt=ve[2],xt=ve[3],St=ve[4],Et=ve[5],Pt=ve[6],Ot=ve[7],At=ve[8],Mt=ve[9],Rt=ve[10],Nt=ve[11],Ft=ve[12],zt=ve[13],kt=ve[14],Bt=ve[15],jt=e$3_();return Math.abs(_e-$t)<=jt*Math.max(1,Math.abs(_e),Math.abs($t))&&Math.abs(be-bt)<=jt*Math.max(1,Math.abs(be),Math.abs(bt))&&Math.abs(we-wt)<=jt*Math.max(1,Math.abs(we),Math.abs(wt))&&Math.abs(Se-xt)<=jt*Math.max(1,Math.abs(Se),Math.abs(xt))&&Math.abs(Te-St)<=jt*Math.max(1,Math.abs(Te),Math.abs(St))&&Math.abs(Ee-Et)<=jt*Math.max(1,Math.abs(Ee),Math.abs(Et))&&Math.abs(Ce-Pt)<=jt*Math.max(1,Math.abs(Ce),Math.abs(Pt))&&Math.abs(Oe-Ot)<=jt*Math.max(1,Math.abs(Oe),Math.abs(Ot))&&Math.abs(Re-At)<=jt*Math.max(1,Math.abs(Re),Math.abs(At))&&Math.abs(De-Mt)<=jt*Math.max(1,Math.abs(De),Math.abs(Mt))&&Math.abs(Be-Rt)<=jt*Math.max(1,Math.abs(Be),Math.abs(Rt))&&Math.abs(Ze-Nt)<=jt*Math.max(1,Math.abs(Ze),Math.abs(Nt))&&Math.abs(Xe-Ft)<=jt*Math.max(1,Math.abs(Xe),Math.abs(Ft))&&Math.abs(Je-zt)<=jt*Math.max(1,Math.abs(Je),Math.abs(zt))&&Math.abs(Qe-kt)<=jt*Math.max(1,Math.abs(Qe),Math.abs(kt))&&Math.abs(dt-Bt)<=jt*Math.max(1,Math.abs(dt),Math.abs(Bt))}function G$Q(fe){const ve=e$3_(),_e=fe[0],be=fe[1],we=fe[2],Se=fe[4],Te=fe[5],Ee=fe[6],Ce=fe[8],Oe=fe[9],Re=fe[10];return Math.abs(1-(_e*_e+Se*Se+Ce*Ce))<=ve&&Math.abs(1-(be*be+Te*Te+Oe*Oe))<=ve&&Math.abs(1-(we*we+Ee*Ee+Re*Re))<=ve}function H$12(fe){return 1===fe[0]&&0===fe[1]&&0===fe[2]&&0===fe[4]&&1===fe[5]&&0===fe[6]&&0===fe[8]&&0===fe[9]&&1===fe[10]}const ud=c$4k,hd=E$1B;function e$3G(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r$39(fe){return[fe[0],fe[1],fe[2],fe[3],fe[4],fe[5],fe[6],fe[7],fe[8],fe[9],fe[10],fe[11],fe[12],fe[13],fe[14],fe[15]]}function t$3N(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je){return[fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je]}Object.freeze(Object.defineProperty({__proto__:null,add:function z$14(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe[3]=ve[3]+_e[3],fe[4]=ve[4]+_e[4],fe[5]=ve[5]+_e[5],fe[6]=ve[6]+_e[6],fe[7]=ve[7]+_e[7],fe[8]=ve[8]+_e[8],fe[9]=ve[9]+_e[9],fe[10]=ve[10]+_e[10],fe[11]=ve[11]+_e[11],fe[12]=ve[12]+_e[12],fe[13]=ve[13]+_e[13],fe[14]=ve[14]+_e[14],fe[15]=ve[15]+_e[15],fe},adjoint:function u$3v(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5],Ce=ve[6],Oe=ve[7],Re=ve[8],De=ve[9],Be=ve[10],Ze=ve[11],Xe=ve[12],Je=ve[13],Qe=ve[14],dt=ve[15];return fe[0]=Ee*(Be*dt-Ze*Qe)-De*(Ce*dt-Oe*Qe)+Je*(Ce*Ze-Oe*Be),fe[1]=-(be*(Be*dt-Ze*Qe)-De*(we*dt-Se*Qe)+Je*(we*Ze-Se*Be)),fe[2]=be*(Ce*dt-Oe*Qe)-Ee*(we*dt-Se*Qe)+Je*(we*Oe-Se*Ce),fe[3]=-(be*(Ce*Ze-Oe*Be)-Ee*(we*Ze-Se*Be)+De*(we*Oe-Se*Ce)),fe[4]=-(Te*(Be*dt-Ze*Qe)-Re*(Ce*dt-Oe*Qe)+Xe*(Ce*Ze-Oe*Be)),fe[5]=_e*(Be*dt-Ze*Qe)-Re*(we*dt-Se*Qe)+Xe*(we*Ze-Se*Be),fe[6]=-(_e*(Ce*dt-Oe*Qe)-Te*(we*dt-Se*Qe)+Xe*(we*Oe-Se*Ce)),fe[7]=_e*(Ce*Ze-Oe*Be)-Te*(we*Ze-Se*Be)+Re*(we*Oe-Se*Ce),fe[8]=Te*(De*dt-Ze*Je)-Re*(Ee*dt-Oe*Je)+Xe*(Ee*Ze-Oe*De),fe[9]=-(_e*(De*dt-Ze*Je)-Re*(be*dt-Se*Je)+Xe*(be*Ze-Se*De)),fe[10]=_e*(Ee*dt-Oe*Je)-Te*(be*dt-Se*Je)+Xe*(be*Oe-Se*Ee),fe[11]=-(_e*(Ee*Ze-Oe*De)-Te*(be*Ze-Se*De)+Re*(be*Oe-Se*Ee)),fe[12]=-(Te*(De*Qe-Be*Je)-Re*(Ee*Qe-Ce*Je)+Xe*(Ee*Be-Ce*De)),fe[13]=_e*(De*Qe-Be*Je)-Re*(be*Qe-we*Je)+Xe*(be*Be-we*De),fe[14]=-(_e*(Ee*Qe-Ce*Je)-Te*(be*Qe-we*Je)+Xe*(be*Ce-we*Ee)),fe[15]=_e*(Ee*Be-Ce*De)-Te*(be*Be-we*De)+Re*(be*Ce-we*Ee),fe},copy:n$48,determinant:function M$1j(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3],Se=fe[4],Te=fe[5],Ee=fe[6],Ce=fe[7],Oe=fe[8],Re=fe[9],De=fe[10],Be=fe[11],Ze=fe[12],Xe=fe[13],Je=fe[14],Qe=fe[15];return(ve*Te-_e*Se)*(De*Qe-Be*Je)-(ve*Ee-be*Se)*(Re*Qe-Be*Xe)+(ve*Ce-we*Se)*(Re*Je-De*Xe)+(_e*Ee-be*Te)*(Oe*Qe-Be*Ze)-(_e*Ce-we*Te)*(Oe*Je-De*Ze)+(be*Ce-we*Ee)*(Oe*Xe-Re*Ze)},equals:C$1l,exactEquals:B$11,frob:function k$1p(fe){return Math.sqrt(fe[0]**2+fe[1]**2+fe[2]**2+fe[3]**2+fe[4]**2+fe[5]**2+fe[6]**2+fe[7]**2+fe[8]**2+fe[9]**2+fe[10]**2+fe[11]**2+fe[12]**2+fe[13]**2+fe[14]**2+fe[15]**2)},fromQuat:_$1o,fromQuat2:function v$1R(fe,ve){const _e=cd,be=-ve[0],we=-ve[1],Se=-ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=ve[6],Re=ve[7],De=be*be+we*we+Se*Se+Te*Te;return De>0?(_e[0]=2*(Ee*Te+Re*be+Ce*Se-Oe*we)/De,_e[1]=2*(Ce*Te+Re*we+Oe*be-Ee*Se)/De,_e[2]=2*(Oe*Te+Re*Se+Ee*we-Ce*be)/De):(_e[0]=2*(Ee*Te+Re*be+Ce*Se-Oe*we),_e[1]=2*(Ce*Te+Re*we+Oe*be-Ee*Se),_e[2]=2*(Oe*Te+Re*Se+Ee*we-Ce*be)),S$1H(fe,ve,_e),fe},fromRotation:p$4z,fromRotationTranslation:S$1H,fromRotationTranslationScale:P$18,fromRotationTranslationScaleOrigin:D$14,fromScaling:d$32,fromTranslation:q$X,fromXRotation:g$2c,fromYRotation:y$24,fromZRotation:R$1b,frustum:A$1w,getRotation:j$1B,getScaling:O$1l,getTranslation:I$1t,hasIdentityRotation:H$12,identity:o$3E,invert:h$2A,invertOrIdentity:e$3H,isOrthoNormal:G$Q,lookAt:X$w,mul:ud,multiply:c$4k,multiplyScalar:function N$12(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe[3]=ve[3]*_e,fe[4]=ve[4]*_e,fe[5]=ve[5]*_e,fe[6]=ve[6]*_e,fe[7]=ve[7]*_e,fe[8]=ve[8]*_e,fe[9]=ve[9]*_e,fe[10]=ve[10]*_e,fe[11]=ve[11]*_e,fe[12]=ve[12]*_e,fe[13]=ve[13]*_e,fe[14]=ve[14]*_e,fe[15]=ve[15]*_e,fe},multiplyScalarAndAdd:function V$13(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe[3]=ve[3]+_e[3]*be,fe[4]=ve[4]+_e[4]*be,fe[5]=ve[5]+_e[5]*be,fe[6]=ve[6]+_e[6]*be,fe[7]=ve[7]+_e[7]*be,fe[8]=ve[8]+_e[8]*be,fe[9]=ve[9]+_e[9]*be,fe[10]=ve[10]+_e[10]*be,fe[11]=ve[11]+_e[11]*be,fe[12]=ve[12]+_e[12]*be,fe[13]=ve[13]+_e[13]*be,fe[14]=ve[14]+_e[14]*be,fe[15]=ve[15]+_e[15]*be,fe},ortho:Q$E,perspective:function w$1O(fe,ve,_e,be,we){const Se=1/Math.tan(ve/2);let Te;return fe[0]=Se/_e,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=Se,fe[6]=0,fe[7]=0,fe[8]=0,fe[9]=0,fe[11]=-1,fe[12]=0,fe[13]=0,fe[15]=0,null!=we&&we!==1/0?(Te=1/(be-we),fe[10]=(we+be)*Te,fe[14]=2*we*be*Te):(fe[10]=-1,fe[14]=-2*be),fe},perspectiveFromFieldOfView:function F$13(fe,ve,_e,be){const we=Math.tan(ve.upDegrees*Math.PI/180),Se=Math.tan(ve.downDegrees*Math.PI/180),Te=Math.tan(ve.leftDegrees*Math.PI/180),Ee=Math.tan(ve.rightDegrees*Math.PI/180),Ce=2/(Te+Ee),Oe=2/(we+Se);return fe[0]=Ce,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=0,fe[5]=Oe,fe[6]=0,fe[7]=0,fe[8]=-(Te-Ee)*Ce*.5,fe[9]=(we-Se)*Oe*.5,fe[10]=be/(_e-be),fe[11]=-1,fe[12]=0,fe[13]=0,fe[14]=be*_e/(_e-be),fe[15]=0,fe},rotate:b$21,rotateX:l$3_,rotateY:m$3m,rotateZ:x$1E,scale:f$2O,set:r$3a,str:function Z$C(fe){return"mat4("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+", "+fe[4]+", "+fe[5]+", "+fe[6]+", "+fe[7]+", "+fe[8]+", "+fe[9]+", "+fe[10]+", "+fe[11]+", "+fe[12]+", "+fe[13]+", "+fe[14]+", "+fe[15]+")"},sub:hd,subtract:E$1B,targetTo:Y$z,translate:i$45,transpose:s$3L},Symbol.toStringTag,{value:"Module"}));const dd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e$3F(){return[1,0,0,0,1,0,0,0,1]}function r$38(fe){return[fe[0],fe[1],fe[2],fe[3],fe[4],fe[5],fe[6],fe[7],fe[8]]}function t$3M(fe,ve,_e,be,we,Se,Te,Ee,Ce){return[fe,ve,_e,be,we,Se,Te,Ee,Ce]}Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:dd,clone:r$39,create:e$3G,createView:function n$47(fe,ve){return new Float64Array(fe,ve,16)},fromValues:t$3N},Symbol.toStringTag,{value:"Module"}));const pd=[1,0,0,0,1,0,0,0,1];function e$3E(){return[0,0,0,1]}function r$37(fe){return[fe[0],fe[1],fe[2],fe[3]]}function t$3L(fe,ve,_e,be){return[fe,ve,_e,be]}Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:pd,clone:r$38,create:e$3F,createView:function n$46(fe,ve){return new Float64Array(fe,ve,9)},fromValues:t$3M},Symbol.toStringTag,{value:"Module"}));const fd=[0,0,0,1];function n$44(){return[0,0]}function t$3K(fe){return[fe[0],fe[1]]}function r$36(fe,ve){return[fe,ve]}function e$3D(fe,ve=[0,0]){const _e=Math.min(2,fe.length);for(let be=0;be<_e;++be)ve[be]=fe[be];return ve}function u$3u(){return[0,0]}function c$4j(){return r$36(1,1)}function i$44(){return r$36(1,0)}function f$2N(){return r$36(0,1)}Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:fd,clone:r$37,create:e$3E,createView:function n$45(fe,ve){return new Float64Array(fe,ve,4)},fromValues:t$3L},Symbol.toStringTag,{value:"Module"}));const md=[0,0],yd=c$4j(),gd=i$44(),vd=f$2N();function n$43(){return[0,0,0,0]}function t$3J(fe){return[fe[0],fe[1],fe[2],fe[3]]}function r$35(fe,ve,_e,be){return[fe,ve,_e,be]}function e$3C(fe,ve=[0,0,0,0]){const _e=Math.min(4,fe.length);for(let be=0;be<_e;++be)ve[be]=fe[be];return ve}function o$3z(){return[0,0,0,0]}function i$43(){return r$35(1,1,1,1)}function c$4i(){return r$35(1,0,0,0)}function f$2M(){return r$35(0,1,0,0)}function a$43(){return r$35(0,0,1,0)}function l$3Y(){return r$35(0,0,0,1)}Object.freeze(Object.defineProperty({__proto__:null,ONES:yd,UNIT_X:gd,UNIT_Y:vd,ZEROS:md,clone:t$3K,create:n$44,createView:function o$3A(fe,ve){return new Float64Array(fe,ve,2)},fromArray:e$3D,fromValues:r$36,ones:c$4j,unitX:i$44,unitY:f$2N,zeros:u$3u},Symbol.toStringTag,{value:"Module"}));const _d=[0,0,0,0],$d=i$43(),bd=c$4i(),wd=f$2M(),xd=a$43(),Sd=l$3Y();Object.freeze(Object.defineProperty({__proto__:null,ONES:$d,UNIT_W:Sd,UNIT_X:bd,UNIT_Y:wd,UNIT_Z:xd,ZEROS:_d,clone:t$3J,create:n$43,createView:function u$3t(fe,ve){return new Float64Array(fe,ve,4)},fromArray:e$3C,fromValues:r$35,ones:i$43,unitW:l$3Y,unitX:c$4i,unitY:f$2M,unitZ:a$43,zeros:o$3z},Symbol.toStringTag,{value:"Module"}));let Td=class m3{constructor(fe){this._create=fe,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&t$4h((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const fe=2*this._itemsPtr;this._items.length>fe&&(this._items.length=fe),this._itemsPtr=0}static createVec2f64(){return new m3(n$44)}static createVec3f64(){return new m3(n$4A)}static createVec4f64(){return new m3(n$43)}static createMat3f64(){return new m3(e$3F)}static createMat4f64(){return new m3(e$3G)}static createQuatf64(){return new m3(e$3E)}get test(){}};const Ed=Td.createVec2f64(),Pd=Td.createVec3f64(),Cd=Td.createVec4f64();Td.createMat3f64();const Od=Td.createMat4f64(),Ad=Td.createQuatf64();function v$1Q(fe){return fe?{origin:t$47(fe.origin),vector:t$47(fe.vector)}:{origin:[0,0,0],vector:[0,0,0]}}function p$4y(fe,ve=v$1Q()){return b$20(fe.origin,fe.vector,ve)}function b$20(fe,ve,_e=v$1Q()){return r$3w(_e.origin,fe),r$3w(_e.vector,ve),_e}function h$2z(fe,ve,_e=v$1Q()){return r$3w(_e.origin,fe),e$3Z(_e.vector,ve,fe),_e}function j$1A(fe,ve){const _e=e$3Z(Pd.get(),ve,fe.origin),be=e$3Y(P$1g(fe.vector,_e)/P$1g(fe.vector,fe.vector),0,1),we=e$3Z(Pd.get(),g$2z(Pd.get(),fe.vector,be),_e);return P$1g(we,we)}function M$1i(fe,ve,_e){return A$1v(fe,ve,0,1,_e)}function l$3X(fe,ve,_e){return u$3Y(_e,fe.origin,g$2z(_e,fe.vector,ve))}function A$1v(fe,ve,_e,be,we){const{vector:Se,origin:Te}=fe;return g$2z(we,Se,e$3Y(P$1g(Se,e$3Z(Pd.get(),ve,Te))/v$22(Se),_e,be)),u$3Y(we,we,fe.origin)}function B$10(fe,ve){if(k$1o(fe,function m$3j(fe,ve){const _e=Rd.get();return _e.origin=fe,_e.vector=ve,_e}(ve.origin,ve.direction),!1,Md)){const{tA:ve,pB:_e,distance2:be}=Md;if(ve>=0&&ve<=1)return be;if(ve<0)return p$4Z(fe.origin,_e);if(ve>1)return p$4Z(u$3Y(Pd.get(),fe.origin,fe.vector),_e)}return null}function d$31(fe,ve,_e){return!!k$1o(fe,ve,!0,Md)&&(r$3w(_e,Md.pA),!0)}function k$1o(fe,ve,_e,be){const we=1e-6,Se=fe.origin,Te=u$3Y(Pd.get(),Se,fe.vector),Ee=ve.origin,Ce=u$3Y(Pd.get(),Ee,ve.vector),Oe=Pd.get(),Re=Pd.get();if(Oe[0]=Se[0]-Ee[0],Oe[1]=Se[1]-Ee[1],Oe[2]=Se[2]-Ee[2],Re[0]=Ce[0]-Ee[0],Re[1]=Ce[1]-Ee[1],Re[2]=Ce[2]-Ee[2],Math.abs(Re[0])<we&&Math.abs(Re[1])<we&&Math.abs(Re[2])<we)return!1;const De=Pd.get();if(De[0]=Te[0]-Se[0],De[1]=Te[1]-Se[1],De[2]=Te[2]-Se[2],Math.abs(De[0])<we&&Math.abs(De[1])<we&&Math.abs(De[2])<we)return!1;const Be=Oe[0]*Re[0]+Oe[1]*Re[1]+Oe[2]*Re[2],Ze=Re[0]*De[0]+Re[1]*De[1]+Re[2]*De[2],Xe=Oe[0]*De[0]+Oe[1]*De[1]+Oe[2]*De[2],Je=Re[0]*Re[0]+Re[1]*Re[1]+Re[2]*Re[2],Qe=(De[0]*De[0]+De[1]*De[1]+De[2]*De[2])*Je-Ze*Ze;if(Math.abs(Qe)<we)return!1;let dt=(Be*Ze-Xe*Je)/Qe,$t=(Be+Ze*dt)/Je;_e&&(dt=e$3Y(dt,0,1),$t=e$3Y($t,0,1));const bt=Pd.get(),wt=Pd.get();return bt[0]=Se[0]+dt*De[0],bt[1]=Se[1]+dt*De[1],bt[2]=Se[2]+dt*De[2],wt[0]=Ee[0]+$t*Re[0],wt[1]=Ee[1]+$t*Re[1],wt[2]=Ee[2]+$t*Re[2],be.tA=dt,be.tB=$t,be.pA=bt,be.pB=wt,be.distance2=p$4Z(bt,wt),!0}const Md={tA:0,tB:0,pA:[0,0,0],pB:[0,0,0],distance2:0},Rd=new ad((()=>v$1Q()));function a$42(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe}function r$33(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe}function s$3I(fe,ve,_e,be,we){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe}function o$3x(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe[3]=ve[3]+_e[3],fe}function u$3s(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe[3]=ve[3]-_e[3],fe}function e$3B(fe,ve,_e){return fe[0]=ve[0]*_e[0],fe[1]=ve[1]*_e[1],fe[2]=ve[2]*_e[2],fe[3]=ve[3]*_e[3],fe}function c$4g(fe,ve,_e){return fe[0]=ve[0]/_e[0],fe[1]=ve[1]/_e[1],fe[2]=ve[2]/_e[2],fe[3]=ve[3]/_e[3],fe}function m$3i(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe[3]=ve[3]*_e,fe}function b$1$(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1],we=ve[2]-fe[2],Se=ve[3]-fe[3];return Math.sqrt(_e*_e+be*be+we*we+Se*Se)}function x$1C(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1],we=ve[2]-fe[2],Se=ve[3]-fe[3];return _e*_e+be*be+we*we+Se*Se}function q$W(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3];return Math.sqrt(ve*ve+_e*_e+be*be+we*we)}function p$4x(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3];return ve*ve+_e*_e+be*be+we*we}function y$22(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3];let Te=_e*_e+be*be+we*we+Se*Se;return Te>0&&(Te=1/Math.sqrt(Te),fe[0]=_e*Te,fe[1]=be*Te,fe[2]=we*Te,fe[3]=Se*Te),fe}function j$1z(fe,ve){return fe[0]*ve[0]+fe[1]*ve[1]+fe[2]*ve[2]+fe[3]*ve[3]}function _$1l(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2],Ee=ve[3];return fe[0]=we+be*(_e[0]-we),fe[1]=Se+be*(_e[1]-Se),fe[2]=Te+be*(_e[2]-Te),fe[3]=Ee+be*(_e[3]-Ee),fe}function z$13(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3];return fe[0]=_e[0]*be+_e[4]*we+_e[8]*Se+_e[12]*Te,fe[1]=_e[1]*be+_e[5]*we+_e[9]*Se+_e[13]*Te,fe[2]=_e[2]*be+_e[6]*we+_e[10]*Se+_e[14]*Te,fe[3]=_e[3]*be+_e[7]*we+_e[11]*Se+_e[15]*Te,fe}function E$1A(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]}function L$17(fe,ve){const _e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=ve[0],Ee=ve[1],Ce=ve[2],Oe=ve[3],Re=e$3_();return Math.abs(_e-Te)<=Re*Math.max(1,Math.abs(_e),Math.abs(Te))&&Math.abs(be-Ee)<=Re*Math.max(1,Math.abs(be),Math.abs(Ee))&&Math.abs(we-Ce)<=Re*Math.max(1,Math.abs(we),Math.abs(Ce))&&Math.abs(Se-Oe)<=Re*Math.max(1,Math.abs(Se),Math.abs(Oe))}const Id=u$3s,Ld=e$3B,Dd=c$4g,Nd=b$1$,Fd=x$1C,zd=q$W,kd=p$4x,Ud=Object.freeze(Object.defineProperty({__proto__:null,add:o$3x,ceil:function i$42(fe,ve){return fe[0]=Math.ceil(ve[0]),fe[1]=Math.ceil(ve[1]),fe[2]=Math.ceil(ve[2]),fe[3]=Math.ceil(ve[3]),fe},copy:a$42,copyVec3:r$33,dist:Nd,distance:b$1$,div:Dd,divide:c$4g,dot:j$1z,equals:L$17,exactEquals:E$1A,floor:function h$2y(fe,ve){return fe[0]=Math.floor(ve[0]),fe[1]=Math.floor(ve[1]),fe[2]=Math.floor(ve[2]),fe[3]=Math.floor(ve[3]),fe},inverse:function v$1P(fe,ve){return fe[0]=1/ve[0],fe[1]=1/ve[1],fe[2]=1/ve[2],fe[3]=1/ve[3],fe},len:zd,length:q$W,lerp:_$1l,max:function f$2K(fe,ve,_e){return fe[0]=Math.max(ve[0],_e[0]),fe[1]=Math.max(ve[1],_e[1]),fe[2]=Math.max(ve[2],_e[2]),fe[3]=Math.max(ve[3],_e[3]),fe},min:function M$1h(fe,ve,_e){return fe[0]=Math.min(ve[0],_e[0]),fe[1]=Math.min(ve[1],_e[1]),fe[2]=Math.min(ve[2],_e[2]),fe[3]=Math.min(ve[3],_e[3]),fe},mul:Ld,multiply:e$3B,negate:function g$2b(fe,ve){return fe[0]=-ve[0],fe[1]=-ve[1],fe[2]=-ve[2],fe[3]=-ve[3],fe},normalize:y$22,random:function w$1N(fe,ve){const _e=Yi;let be,we,Se,Te,Ee,Ce;ve=ve||1;do{be=2*_e()-1,we=2*_e()-1,Ee=be*be+we*we}while(Ee>=1);do{Se=2*_e()-1,Te=2*_e()-1,Ce=Se*Se+Te*Te}while(Ce>=1);const Oe=Math.sqrt((1-Ee)/Ce);return fe[0]=ve*be,fe[1]=ve*we,fe[2]=ve*Se*Oe,fe[3]=ve*Te*Oe,fe},round:function l$3W(fe,ve){return fe[0]=Math.round(ve[0]),fe[1]=Math.round(ve[1]),fe[2]=Math.round(ve[2]),fe[3]=Math.round(ve[3]),fe},scale:m$3i,scaleAndAdd:function d$30(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe[3]=ve[3]+_e[3]*be,fe},set:s$3I,sqrDist:Fd,sqrLen:kd,squaredDistance:x$1C,squaredLength:p$4x,str:function D$13(fe){return"vec4("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+")"},sub:Id,subtract:u$3s,transformMat4:z$13,transformQuat:function A$1u(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=_e[3],Re=Oe*be+Ee*Se-Ce*we,De=Oe*we+Ce*be-Te*Se,Be=Oe*Se+Te*we-Ee*be,Ze=-Te*be-Ee*we-Ce*Se;return fe[0]=Re*Oe+Ze*-Te+De*-Ce-Be*-Ee,fe[1]=De*Oe+Ze*-Ee+Be*-Te-Re*-Ce,fe[2]=Be*Oe+Ze*-Ce+Re*-Ee-De*-Te,fe[3]=ve[3],fe}},Symbol.toStringTag,{value:"Module"}));function e$3A(fe,ve,_e){return g$2z(_e,fe,P$1g(fe,ve)/P$1g(fe,fe))}function a$41(fe,ve){return P$1g(fe,ve)/s$4g(fe)}function f$2J(fe,ve){return-m$3J(P$1g(fe,ve)/(s$4g(fe)*s$4g(ve)))}function m$3h(fe,ve,_e){z$1d(Vd,fe),z$1d(Bd,ve);const be=m$3J(P$1g(Vd,Bd));return P$1g(_$1z(Vd,Vd,Bd),_e)<0?2*Math.PI-be:be}const Vd=[0,0,0],Bd=[0,0,0];function m$3g(fe){const ve=fe[0]*fe[0]+fe[4]*fe[4]+fe[8]*fe[8],_e=fe[1]*fe[1]+fe[5]*fe[5]+fe[9]*fe[9],be=fe[2]*fe[2]+fe[6]*fe[6]+fe[10]*fe[10];return Math.sqrt(Math.max(ve,_e,be))}function b$1_(fe,ve,_e){_e=_e||fe;const be=P$1g(fe,ve);o$44(_e,fe[0]-be*ve[0],fe[1]-be*ve[1],fe[2]-be*ve[2]),z$1d(_e,_e)}function j$1x(fe,ve,_e){Math.abs(fe[0])>Math.abs(fe[1])?o$44(ve,0,1,0):o$44(ve,1,0,0),_$1z(_e,fe,ve),_$1z(ve,_e,fe),z$1d(_e,_e),z$1d(ve,ve)}function p$4w(fe,ve,_e,be,we,Se){const Te=fe+(ve-fe)*we;return Te+(_e+(be-_e)*we-Te)*Se}function q$V(fe,ve,_e,be=[0,0,0]){const we=s$4g(fe),Se=s$4g(ve),Te=P$1g(fe,ve)/(we*Se);if(Te<.9999999999999999){const Ee=Math.acos(Te),Ce=((1-_e)*we+_e*Se)/Math.sin(Ee),Oe=Ce/we*Math.sin((1-_e)*Ee),Re=Ce/Se*Math.sin(_e*Ee);return g$2z(qd,fe,Oe),g$2z(Wd,ve,Re),u$3Y(be,qd,Wd)}return A$1G(be,fe,ve,_e)}function x$1B(fe,ve,_e,be=[0,0,0],we=[0,0,0]){const Se=s$4g(fe),Te=s$4g(ve),Ee=P$1g(fe,ve)/(Se*Te);if(Ee<.9999999999999999){const Ce=Math.acos(Ee),Oe=Math.sin(Ce),Re=Math.sin(_e*Ce),De=Math.sin((1-_e)*Ce),Be=(1-_e)*Se+_e*Te;{const _e=Be/Oe,we=_e/Te*Re;g$2z(qd,fe,_e/Se*De),g$2z(Wd,ve,we),u$3Y(be,qd,Wd)}{const be=1/Se*(-Math.cos((1-_e)*Ce)*Ce*Be+De*(-Se+Te));g$2z(qd,fe,be);const Ee=1/Te*(Math.cos(_e*Ce)*Ce*Be+Re*(-Se+Te));g$2z(Wd,ve,Ee),u$3Y(we,qd,Wd),g$2z(we,we,1/Oe)}return we}return A$1G(be,fe,ve,_e),e$3Z(we,ve,fe),z$1d(we,we),we}function v$1O(fe,ve,_e){const be=m$3J(P$1g(fe=z$1d(qd,fe),ve=z$1d(Wd,ve)));if(_e){if(P$1g(_$1z(Hd,fe,ve),_e)<0)return-be}return be}function k$1m(fe){const ve=fe.length;return _e=>{if(_e<=fe[0][0])return fe[0][1];if(_e>=fe[ve-1][0])return fe[ve-1][1];let be=1;for(;_e>fe[be][0];)be++;const we=fe[be-1][0],Se=fe[be][0],Te=(Se-_e)/(Se-we);return Te*fe[be-1][1]+(1-Te)*fe[be][1]}}function U$14(fe,ve,_e,be){e$3Z(jd,ve,fe),e$3Z(Gd,_e,fe),_$1z(be,jd,Gd),z$1d(be,be),be[3]=-P$1g(fe,be)}function d$2$(fe,ve){if(o$44(ve,0,0,0),fe.length>0){for(let _e=0;_e<fe.length;++_e)u$3Y(ve,ve,fe[_e]);g$2z(ve,ve,1/fe.length)}}const jd=[0,0,0],Gd=[0,0,0],Hd=[0,0,0],qd=[0,0,0],Wd=[0,0,0];function E$1z(fe=ep){return[fe[0],fe[1],fe[2],fe[3]]}function v$1N(fe=ep[0],ve=ep[1],_e=ep[2],be=ep[3]){return T$1e(fe,ve,_e,be,Cd.get())}function A$1s(fe,ve){return T$1e(ve[0],ve[1],ve[2],ve[3],fe)}function F$11(fe){return fe}function T$1e(fe,ve,_e,be,we=E$1z()){return we[0]=fe,we[1]=ve,we[2]=_e,we[3]=be,we}function _$1k(fe,ve,_e){return r$3w(_e,fe),_e[3]=ve,_e}function j$1w(fe,ve,_e){const be=ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2],we=Math.abs(be-1)>1e-5&&be>1e-12?1/Math.sqrt(be):1;return _e[0]=ve[0]*we,_e[1]=ve[1]*we,_e[2]=ve[2]*we,_e[3]=-(_e[0]*fe[0]+_e[1]*fe[1]+_e[2]*fe[2]),_e}function b$1Z(fe,ve,_e,be=E$1z()){const we=_e[0]-ve[0],Se=_e[1]-ve[1],Te=_e[2]-ve[2],Ee=fe[0]-ve[0],Ce=fe[1]-ve[1],Oe=fe[2]-ve[2],Re=Se*Oe-Te*Ce,De=Te*Ee-we*Oe,Be=we*Ce-Se*Ee,Ze=Re*Re+De*De+Be*Be,Xe=Math.abs(Ze-1)>1e-5&&Ze>1e-12?1/Math.sqrt(Ze):1;return be[0]=Re*Xe,be[1]=De*Xe,be[2]=Be*Xe,be[3]=-(be[0]*fe[0]+be[1]*fe[1]+be[2]*fe[2]),be}function X$v(fe,ve,_e,be=0,we=Math.floor(_e*(1/3)),Se=Math.floor(_e*(2/3))){if(_e<3)return!1;ve(Zd,be);let Te=we,Ee=!1;for(;Te<_e-1&&!Ee;)ve(Xd,Te),Te++,Ee=!G$$(Zd,Xd);if(!Ee)return!1;for(Te=Math.max(Te,Se),Ee=!1;Te<_e&&!Ee;)ve(Jd,Te),Te++,e$3Z(Qd,Zd,Xd),z$1d(Qd,Qd),e$3Z(Kd,Xd,Jd),z$1d(Kd,Kd),Ee=!G$$(Zd,Jd)&&!G$$(Xd,Jd)&&Math.abs(P$1g(Qd,Kd))<Yd;return Ee?(b$1Z(Zd,Xd,Jd,fe),!0):(0!==be||1!==we||2!==Se)&&X$v(fe,ve,_e,0,1,2)}const Yd=.99619469809,Zd=[0,0,0],Xd=[0,0,0],Jd=[0,0,0],Qd=[0,0,0],Kd=[0,0,0];function O$1j(fe,ve,_e){return ve!==fe&&A$1s(fe,ve),fe[3]=-P$1g(fe,_e),fe}function q$U(fe,ve){return ve[0]=-fe[0],ve[1]=-fe[1],ve[2]=-fe[2],ve[3]=-fe[3],ve}function U$13(fe,ve,_e,be){return _$1z(Jd,ve,fe),j$1w(_e,Jd,be)}function w$1L(fe,ve,_e,be){return W$I(fe,ve,e$3Z(Pd.get(),_e,ve),rp,be)}function S$1E(fe,ve,_e){return null!=ve&&W$I(fe,ve.origin,ve.direction,ip,_e)}function z$11(fe,ve,_e){return W$I(fe,ve.origin,ve.vector,tp.NONE,_e)}function B$Z(fe,ve,_e){return W$I(fe,ve.origin,ve.vector,tp.CLAMP,_e)}function D$12(fe,ve){return V$12(fe,ve)>=0}function G$O(fe,ve){const _e=P$1g(fe,ve.ray.direction),be=-V$12(fe,ve.ray.origin);if(be<0&&_e>=0)return!1;if(_e>-1e-6&&_e<1e-6)return be>0;if((be<0||_e<0)&&!(be<0&&_e<0))return!0;const we=be/_e;return _e>0?we<ve.c1&&(ve.c1=we):we>ve.c0&&(ve.c0=we),ve.c0<=ve.c1}function H$10(fe,ve){const _e=P$1g(fe,ve.ray.direction),be=-V$12(fe,ve.ray.origin);if(_e>-1e-6&&_e<1e-6)return be>0;const we=be/_e;return _e>0?we<ve.c1&&(ve.c1=we):we>ve.c0&&(ve.c0=we),ve.c0<=ve.c1}function J$E(fe,ve,_e){const be=g$2z(Pd.get(),fe,-fe[3]);return u$3Y(_e,Q$D(fe,e$3Z(Pd.get(),ve,be),Pd.get()),be),_e}function K$B(fe,ve,_e,be){const we=fe,Se=Pd.get(),Te=Pd.get();j$1x(we,Se,Te);const Ee=e$3Z(Pd.get(),_e,ve);return o$44(be,a$41(Se,Ee),a$41(Te,Ee),a$41(we,Ee))}function Q$D(fe,ve,_e){return e$3Z(_e,ve,g$2z(Pd.get(),fe,P$1g(fe,ve))),_e}function R$1a(fe,ve){return Math.abs(V$12(fe,ve))}function V$12(fe,ve){return P$1g(fe,ve)+fe[3]}function W$I(fe,ve,_e,be,we){const Se=P$1g(fe,_e);if(0===Se)return!1;let Te=-(P$1g(fe,ve)+fe[3])/Se;return be&tp.CLAMP&&(Te=e$3Y(Te,0,1)),!(!(be&tp.INFINITE_MIN)&&Te<0||!(be&tp.INFINITE_MAX)&&Te>1||(u$3Y(we,ve,g$2z(we,_e,Te)),0))}const ep=[0,0,1,0];var tp;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.CLAMP=1]="CLAMP",fe[fe.INFINITE_MIN=4]="INFINITE_MIN",fe[fe.INFINITE_MAX=8]="INFINITE_MAX"}(tp||(tp={}));const rp=tp.INFINITE_MIN|tp.INFINITE_MAX,ip=tp.INFINITE_MAX;function m$3f(fe){return fe?j$1v(t$47(fe.origin),t$47(fe.direction)):j$1v([0,0,0],[0,0,0])}function j$1v(fe,ve){return{origin:fe,direction:ve}}function p$4v(fe,ve){return h$30(fe.origin,ve.origin)&&h$30(fe.direction,ve.direction)}function l$3V(fe,ve){const _e=np.get();return _e.origin=fe,_e.direction=ve,_e}function b$1Y(fe,ve=m$3f()){return v$1M(fe.origin,fe.direction,ve)}function k$1k(fe,ve,_e=m$3f()){return r$3w(_e.origin,fe),e$3Z(_e.direction,ve,fe),_e}function v$1M(fe,ve,_e=m$3f()){return r$3w(_e.origin,fe),r$3w(_e.direction,ve),_e}function x$1z(fe,ve){const _e=_$1z(Pd.get(),z$1d(Pd.get(),fe.direction),e$3Z(Pd.get(),ve,fe.origin));return P$1g(_e,_e)}function h$2x(fe,ve,_e,be){const we=fe.direction,Se=ve.direction,Te=Ki(sp,ve.origin,fe.origin),Ee=P$1g(we,Se),Ce=P$1g(Se,Te),Oe=P$1g(we,Te),Re=P$1g(we,we),De=P$1g(Se,Se),Be=(Ee*Ce+Oe*De)/(Re*De-Ee*Ee),Ze=(Ee*Oe-Ce*Re)/(Re*De-Ee*Ee);return u$3Y(_e,fe.origin,g$2z(sp,we,Be)),u$3Y(be,ve.origin,g$2z(sp,Se,Ze)),[_e,be]}const np=new ad((()=>m$3f())),sp=[0,0,0],U$12=()=>ar.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const op=class z{constructor(){this.plane=E$1z(),this.origin=[0,0,0],this.basis1=[0,0,0],this.basis2=[0,0,0]}};function W$H(fe=ap){return{plane:E$1z(fe.plane),origin:t$47(fe.origin),basis1:t$47(fe.basis1),basis2:t$47(fe.basis2)}}function Z$A(fe,ve=W$H()){return H$$(fe.origin,fe.basis1,fe.basis2,ve)}function H$$(fe,ve,_e,be=W$H()){return r$3w(be.origin,fe),r$3w(be.basis1,ve),r$3w(be.basis2,_e),J$D(be),function Ps(fe,ve){Math.abs(P$1g(fe.basis1,fe.basis2)/(s$4g(fe.basis1)*s$4g(fe.basis2)))>1e-6&&U$12().warn(ve,"Provided basis vectors are not perpendicular"),Math.abs(P$1g(fe.basis1,ds(fe)))>1e-6&&U$12().warn(ve,"Basis vectors and plane normal are not perpendicular"),Math.abs(-P$1g(ds(fe),fe.origin)-fe.plane[3])>1e-6&&U$12().warn(ve,"Plane offset is not consistent with plane origin")}(be,"fromValues()"),be}function J$D(fe){U$13(fe.basis2,fe.basis1,fe.origin,fe.plane)}function K$A(fe,ve,_e){fe!==_e&&Z$A(fe,_e);const be=g$2z(Pd.get(),ds(fe),ve);return u$3Y(_e.origin,_e.origin,be),_e.plane[3]-=ve,_e}function $$B(fe,ve=W$H()){const _e=(fe[2]-fe[0])/2,be=(fe[3]-fe[1])/2;return o$44(ve.origin,fe[0]+_e,fe[1]+be,0),o$44(ve.basis1,_e,0,0),o$44(ve.basis2,0,be,0),T$1e(0,0,1,0,ve.plane),ve}function ss(fe,ve,_e){return!!S$1E(fe.plane,ve,_e)&&js(fe,_e)}function is(fe,ve,_e){const be=lp.get();vs(fe,ve,be,lp.get());let we=Number.POSITIVE_INFINITY;for(const Se of dp){const Te=ys(fe,Se,cp.get()),Ee=Pd.get();if(z$11(be,Te,Ee)){const fe=J$M(Pd.get(),ve.origin,Ee),be=Math.abs(m$3J(P$1g(ve.direction,fe)));be<we&&(we=be,r$3w(_e,Ee))}}return we===Number.POSITIVE_INFINITY?ns(fe,ve,_e):_e}function ns(fe,ve,_e){if(ss(fe,ve,_e))return _e;const be=lp.get(),we=lp.get();vs(fe,ve,be,we);let Se=Number.POSITIVE_INFINITY;for(const Te of dp){const Ee=ys(fe,Te,cp.get()),Ce=Pd.get();if(B$Z(be,Ee,Ce)){const fe=x$1z(ve,Ce);if(!D$12(we,Ce))continue;fe<Se&&(Se=fe,r$3w(_e,Ce))}}return es(fe,ve.origin)<Se&&rs(fe,ve.origin,_e),_e}function rs(fe,ve,_e){const be=J$E(fe.plane,ve,Pd.get()),we=A$1v(Is(fe,fe.basis1),be,-1,1,Pd.get()),Se=A$1v(Is(fe,fe.basis2),be,-1,1,Pd.get());return e$3Z(_e,u$3Y(Pd.get(),we,Se),fe.origin),_e}function os(fe,ve,_e){const{origin:be,basis1:we,basis2:Se}=fe,Te=e$3Z(Pd.get(),ve,be);return o$44(_e,a$41(we,Te),a$41(Se,Te),a$41(ds(fe),Te))}function es(fe,ve){const _e=os(fe,ve,Pd.get()),{basis1:be,basis2:we}=fe,Se=s$4g(be),Te=s$4g(we),Ee=Math.max(Math.abs(_e[0])-Se,0),Ce=Math.max(Math.abs(_e[1])-Te,0),Oe=_e[2];return Ee*Ee+Ce*Ce+Oe*Oe}function as(fe,ve){return Math.sqrt(es(fe,ve))}function us(fe,ve){return D$12(fe.plane,ve)&&js(fe,ve)}function bs(fe,ve){const _e=-fe.plane[3];return a$41(ds(fe),ve)-_e}function ps(fe,ve){return G$$(fe.basis1,ve.basis1)&&G$$(fe.basis2,ve.basis2)&&G$$(fe.origin,ve.origin)}function ls(fe,ve,_e){return fe!==_e&&Z$A(fe,_e),h$2A(pp,ve),s$3L(pp,pp),O$1v(_e.basis1,fe.basis1,pp),O$1v(_e.basis2,fe.basis2,pp),O$1v(_e.plane,fe.plane,pp),O$1v(_e.origin,fe.origin,ve),O$1j(_e.plane,_e.plane,_e.origin),_e}function ms(fe,ve,_e,be){return fe!==be&&Z$A(fe,be),p$4z(fp,ve,_e),O$1v(be.basis1,fe.basis1,fp),O$1v(be.basis2,fe.basis2,fp),J$D(be),be}function ds(fe){return fe.plane}function js(fe,ve){const _e=e$3Z(Pd.get(),ve,fe.origin),be=v$22(fe.basis1),we=v$22(fe.basis2),Se=P$1g(fe.basis1,_e),Te=P$1g(fe.basis2,_e);return-Se-be<0&&Se-be<0&&-Te-we<0&&Te-we<0}function Is(fe,ve){const _e=cp.get();return r$3w(_e.origin,fe.origin),r$3w(_e.vector,ve),_e}function ys(fe,ve,_e){const{basis1:be,basis2:we,origin:Se}=fe,Te=g$2z(Pd.get(),be,ve.origin[0]),Ee=g$2z(Pd.get(),we,ve.origin[1]);u$3Y(_e.origin,Te,Ee),u$3Y(_e.origin,_e.origin,Se);const Ce=g$2z(Pd.get(),be,ve.direction[0]),Oe=g$2z(Pd.get(),we,ve.direction[1]);return g$2z(_e.vector,u$3Y(Ce,Ce,Oe),2),_e}function vs(fe,ve,_e,be){const we=ds(fe);U$13(we,ve.direction,ve.origin,_e),U$13(_e,we,ve.origin,be)}const ap={plane:E$1z(),origin:r$3y(0,0,0),basis1:r$3y(1,0,0),basis2:r$3y(0,1,0)},lp=new ad(E$1z),cp=new ad(v$1Q),up=[0,0,0],hp=new ad((()=>W$H())),dp=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],pp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mp=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:op,altitudeAt:bs,axisAt:function gs(fe,ve,_e,be){return function hs(fe,ve,_e){switch(ve){case ha.X:r$3w(_e,fe.basis1),z$1d(_e,_e);break;case ha.Y:r$3w(_e,fe.basis2),z$1d(_e,_e);break;case ha.Z:r$3w(_e,ds(fe))}return _e}(fe,_e,be)},closestPoint:ns,closestPointOnSilhouette:is,copy:Z$A,copyWithoutVerify:function D$11(fe,ve){r$3w(ve.origin,fe.origin),r$3w(ve.basis1,fe.basis1),r$3w(ve.basis2,fe.basis2),A$1s(ve.plane,fe.plane)},create:W$H,distance:as,distance2:es,distanceToSilhouette:function cs(fe,ve){let _e=Number.NEGATIVE_INFINITY;for(const be of dp){const we=j$1A(ys(fe,be,cp.get()),ve);we>_e&&(_e=we)}return Math.sqrt(_e)},elevate:K$A,equals:ps,extrusionContainsPoint:us,fromAABoundingRect:$$B,fromValues:H$$,intersectRay:ss,intersectRayClosestSilhouette:function ts(fe,ve,_e){if(ss(fe,ve,_e))return _e;const be=is(fe,ve,Pd.get());return u$3Y(_e,ve.origin,g$2z(Pd.get(),ve.direction,x$1W(ve.origin,be)/s$4g(ve.direction))),_e},normal:ds,projectPoint:rs,projectPointLocal:os,rotate:ms,setAltitudeAt:function fs(fe,ve,_e,be){const we=bs(fe,ve);return u$3Y(be,ve,g$2z(up,ds(fe),_e-we)),be},setExtent:function Q$C(fe,ve,_e){return $$B(ve,_e),K$A(_e,bs(fe,fe.origin),_e),_e},transform:ls,up:ap,updateUnboundedPlane:J$D,wrap:function X$u(fe,ve,_e){const be=hp.get();return be.origin=fe,be.basis1=ve,be.basis2=_e,be.plane=v$1N(0,0,0,0),J$D(be),be}},Symbol.toStringTag,{value:"Module"})),yp=new zo(fo),gp=new zo(mo),vp=new zo(yo),_p=new zo(vo);function a$40(fe){const ve=$p.get(fe);if(ve)return ve;let _e=yp;if(fe)if(fe===gp)_e=gp;else if(fe===vp)_e=vp;else{const ve=fe.wkid,be=fe.latestWkid;if(null!=ve||null!=be)I$1C(ve)||I$1C(be)?_e=gp:(D$1b(ve)||D$1b(be))&&(_e=vp);else{const ve=fe.wkt2??fe.wkt;if(ve){const fe=ve.toUpperCase();fe===bp?_e=gp:fe===wp&&(_e=vp)}}}return $p.set(fe,_e),_e}const $p=new Map,bp=gp.wkt.toUpperCase(),wp=vp.wkt.toUpperCase(),xp=_$1j();function _$1j(){return[0,0,0,0]}const Sp=L$17,Tp=L$17;function T$1d(fe,ve){return a$42(ve,fe)}function k$1i(fe,ve){return r$35(fe[0],fe[1],fe[2],ve)}function z$$(fe){return fe}function L$15(fe,ve){return fe[0]=fe[1]=fe[2]=0,fe[3]=ve,fe}function N$10(fe){return fe[3]}function V$11(fe){return fe}function Z$z(fe,ve,_e,be){return r$35(fe,ve,_e,be)}function X$t(fe,ve,_e){if(null==ve)return!1;if(!F$10(fe,ve,Ep))return!1;let{t0:be,t1:we}=Ep;if((be<0||we<be&&we>0)&&(be=we),be<0)return!1;if(_e){const{origin:fe,direction:we}=ve;_e[0]=fe[0]+we[0]*be,_e[1]=fe[1]+we[1]*be,_e[2]=fe[2]+we[2]*be}return!0}function Y$x(fe,ve,_e){const be=k$1k(ve,_e);if(!F$10(fe,be,Ep))return[];const{origin:we,direction:Se}=be,{t0:Te,t1:Ee}=Ep,c50=ve=>{const _e=[0,0,0];return q$11(_e,we,Se,ve),Q$B(fe,_e,_e)};return Math.abs(Te-Ee)<e$3_()?[c50(Te)]:[c50(Te),c50(Ee)]}const Ep={t0:0,t1:0};function F$10(fe,ve,_e){const{origin:be,direction:we}=ve,Se=Pp;Se[0]=be[0]-fe[0],Se[1]=be[1]-fe[1],Se[2]=be[2]-fe[2];const Te=we[0]*we[0]+we[1]*we[1]+we[2]*we[2];if(0===Te)return!1;const Ee=2*(we[0]*Se[0]+we[1]*Se[1]+we[2]*Se[2]),Ce=Ee*Ee-4*Te*(Se[0]*Se[0]+Se[1]*Se[1]+Se[2]*Se[2]-fe[3]*fe[3]);if(Ce<0)return!1;const Oe=Math.sqrt(Ce);return _e.t0=(-Ee-Oe)/(2*Te),_e.t1=(-Ee+Oe)/(2*Te),!0}const Pp=[0,0,0];function H$_(fe,ve){return X$t(fe,ve,null)}function J$C(fe,ve,_e){const be=Pd.get(),we=Od.get();_$1z(be,ve.origin,ve.direction);const Se=N$10(fe);_$1z(_e,be,ve.origin),g$2z(_e,_e,1/s$4g(_e)*Se);const Te=$$A(fe,ve.origin);return p$4z(we,f$2J(ve.origin,_e)+Te,be),O$1v(_e,_e,we),_e}function Q$B(fe,ve,_e){const be=e$3Z(Pd.get(),ve,fe);return u$3Y(_e,g$2z(Pd.get(),be,fe[3]/s$4g(be)),fe)}function W$G(fe,ve){const _e=v$22(e$3Z(Pd.get(),ve,fe)),be=fe[3]*fe[3];return Math.sqrt(Math.abs(_e-be))}function $$A(fe,ve){const _e=s$4g(e$3Z(Pd.get(),ve,fe)),be=N$10(fe);return m$3J(be/(be+Math.abs(be-_e)))}const Cp=[0,0,0];function rt$h(fe,ve,_e,be){const we=e$3Z(Cp,ve,fe);switch(_e){case ha.X:{const fe=L$1e(we,Cp)[2];return o$44(be,-Math.sin(fe),Math.cos(fe),0)}case ha.Y:{const fe=L$1e(we,Cp),ve=fe[1],_e=fe[2],Se=Math.sin(ve);return o$44(be,-Se*Math.cos(_e),-Se*Math.sin(_e),Math.cos(ve))}case ha.Z:return z$1d(be,we);default:return}}function nt$g(fe,ve){return s$4g(e$3Z(Op,ve,fe))-fe[3]}function st$j(fe,ve){const _e=p$4Z(fe,ve),be=N$10(fe);return _e<=be*be}function et$f(fe,ve,_e=[0,0,0,0]){const be=x$1W(fe,ve),we=fe[3],Se=ve[3];return be+Se<we?(a$42(_e,fe),_e):be+we<Se?(a$42(_e,ve),_e):(A$1G(_e,fe,ve,(be+Se-we)/(2*be)),_e[3]=(be+we+Se)/2,_e)}const Op=[0,0,0],Ap=[0,0,0,0],Mp=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:xp,altitudeAt:nt$g,angleToSilhouette:$$A,axisAt:rt$h,clear:function E$1y(fe){fe[0]=fe[1]=fe[2]=fe[3]=0},closestPoint:function K$z(fe,ve,_e){return X$t(fe,ve,_e)?_e:(function S$1D(fe,ve,_e){const be=P$1g(fe.direction,e$3Z(_e,ve,fe.origin));return u$3Y(_e,fe.origin,g$2z(_e,fe.direction,be)),_e}(ve,fe,_e),Q$B(fe,_e,_e))},closestPointOnSilhouette:J$C,containsPoint:st$j,copy:T$1d,create:_$1j,distanceToSilhouette:W$G,elevate:function B$Y(fe,ve,_e){return fe!==_e&&(_e[0]=fe[0],_e[1]=fe[1],_e[2]=fe[2]),_e[3]=fe[3]+ve,_e},equals:Tp,exactEquals:Sp,fromCenterAndRadius:k$1i,fromRadius:L$15,fromValues:Z$z,getCenter:V$11,getRadius:N$10,intersectLine:Y$x,intersectRay:X$t,intersectRayClosestSilhouette:function I$1s(fe,ve,_e){if(X$t(fe,ve,_e))return _e;const be=J$C(fe,ve,Pd.get());return u$3Y(_e,ve.origin,g$2z(Pd.get(),ve.direction,x$1W(ve.origin,be)/s$4g(ve.direction))),_e},intersectsRay:H$_,projectPoint:Q$B,setAltitudeAt:function ot$h(fe,ve,_e,be){const we=nt$g(fe,ve),Se=rt$h(fe,ve,ha.Z,Op);return u$3Y(be,ve,g$2z(Op,Se,_e-we))},setExtent:function U$11(fe,ve,_e){return fe!==_e&&T$1d(fe,_e),_e},tmpSphere:Ap,union:et$f,wrap:z$$},Symbol.toStringTag,{value:"Module"}));function x$1y(fe,ve,_e=function d$2Z(fe){return{operations:fe,value:fe.create()}}(fe)){return _e.operations=fe,fe.copy(ve,_e.value),_e}const Rp=2**50;function G$L(fe,ve,_e,be){return fe.operations.setAltitudeAt(fe.value,ve,_e,be)}function T$1c(fe,ve,_e){return fe.operations.elevate(fe.value,ve,_e.value)}const Ip=[0,0,0];function q$S(fe,ve,_e,be,we){return we[0]=P$1g(fe,ve),we[1]=P$1g(fe,_e),we[2]=P$1g(fe,be),we}function w$1H(fe,ve,_e,be,we){r$3w(_e,fe),r$3w(Lp,ve),z$1d(Lp,Lp),_$1z(be,Lp,_e),_$1z(we,be,_e)}function z$_(fe,ve){return fe?a$40(ve):ve.isGeographic?zo.PlateCarree:ve}const Lp=[0,0,0],Dp=96;function i$41(fe,ve){const _e=fe.extent,be=fe.width,we=W$L(null==_e?void 0:_e.spatialReference);return _e&&be?_e.width/be*we*bo*Dp:0}function o$3w(fe,ve){return fe/(W$L(ve)*bo*Dp)}function d$2Y(fe,ve,_e){return function a$3$(fe,ve){return 0===ve||F$1b(fe,ve)||fe<ve}(fe,ve)&&function p$4t(fe,ve){return 0===ve||F$1b(fe,ve)||fe>ve}(fe,_e)}function r$31(fe){return null!=fe&&"object"==typeof fe&&"type"in fe&&"feature"===fe.type}function c$4e(fe){return null!=fe&&"object"==typeof fe&&"type"in fe&&"subtype-group"===fe.type&&"sublayers"in fe}function l$3T(fe){return"subtype-sublayer"===(null==fe?void 0:fe.type)}function y$1_(fe){const ve=null==fe?void 0:fe.type;return"base-tile"===ve||"tile"===ve||"elevation"===ve||"imagery-tile"===ve||"base-elevation"===ve||"open-street-map"===ve||"wcs"===ve||"web-tile"===ve||"wmts"===ve||"vector-tile"===ve}function p$4s(fe){return null!=fe&&"type"in fe&&"group"===fe.type}const Np={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function b$1W(fe){const ve=null==fe?void 0:fe.type;return"building-scene"===ve||"integrated-mesh"===ve||"point-cloud"===ve||"scene"===ve}function m$3d(fe){return"integrated-mesh"===fe||"integrated-mesh-3dtiles"===fe}function h$2v(fe){return"voxel"===(null==fe?void 0:fe.type)}function v$1L(fe){return"imagery-tile"===(null==fe?void 0:fe.type)}function j$1t(fe){return null!=(null==fe?void 0:fe.parent)&&"declaredClass"in fe.parent&&"esri.Basemap"===fe.parent.declaredClass&&fe.parent.baseLayers.includes(fe)}function w$1G(fe){var ve;return"feature"===(null==fe?void 0:fe.type)&&!fe.url&&"memory"===(null==(ve=fe.source)?void 0:ve.type)}function L$14(fe){var ve;return("feature"===(null==fe?void 0:fe.type)||"subtype-group"===(null==fe?void 0:fe.type))&&"feature-layer"===(null==(ve=fe.source)?void 0:ve.type)}function M$1g(fe){if(fe.activeLayer){const ve=fe.activeLayer.tileMatrixSet;if(ve)return ve;const _e=fe.activeLayer.tileMatrixSets;if(_e)return _e}return null}async function x$1x(fe,ve){const _e=null==Ts?void 0:Ts.findServerInfo(fe);if(null!=(null==_e?void 0:_e.currentVersion))return _e.owningSystemUrl||null;const be=fe.toLowerCase().indexOf("/rest/services");if(-1===be)return null;const we=`${fe.substring(0,be)}/rest/info`,Se=null!=ve?ve.signal:null,{data:Te}=await U$1a(we,{query:{f:"json"},responseType:"json",signal:Se});return(null==Te?void 0:Te.owningSystemUrl)||null}function O$1g(fe){return function I$1r(fe){if(!("capabilities"in fe))return!1;switch(fe.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}(fe)?"effectiveCapabilities"in fe?fe.effectiveCapabilities:fe.capabilities:null}function B$W(fe){return!!function T$1b(fe){if(!("editingEnabled"in fe))return!1;switch(fe.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(fe)&&("effectiveEditingEnabled"in fe?fe.effectiveEditingEnabled:fe.editingEnabled)}let Fp=class t7 extends $h{constructor(fe){super(fe),this.addHandles(this.on("before-add",(fe=>{null!=fe.item&&fe.item.parent===this.owner&&(ar.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),fe.preventDefault())})))}_own(fe){fe.parent=this.owner}_release(fe){fe.parent=null}};Fp=e$4o([a$4y("esri.support.AnalysesCollection")],Fp);const zp={widthBreakpoint:{getValue(fe){const ve=fe.viewSize[0],_e=fe.breakpoints,be=this.values;return ve<=_e.xsmall?be.xsmall:ve<=_e.small?be.small:ve<=_e.medium?be.medium:ve<=_e.large?be.large:be.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(fe){const ve=fe.viewSize[1],_e=fe.breakpoints,be=this.values;return ve<=_e.xsmall?be.xsmall:ve<=_e.small?be.small:ve<=_e.medium?be.medium:ve<=_e.large?be.large:be.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(fe){const ve=fe.viewSize,_e=ve[0],be=ve[1],we=this.values;return be>=_e?we.portrait:we.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},kp={xsmall:544,small:768,medium:992,large:1200};function m$3c(fe,ve){return ve?zp[fe].valueToClassName[ve].split(" "):[]}const o$3v=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=kp}initialize(){this.addHandles(d$3d((()=>[this.breakpoints,this.size]),(()=>this._updateClassNames()),Xa))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(fe){if(fe!==this._get("breakpoints")){if(!function n$42(fe){const ve=fe;return ve&&ve.xsmall<ve.small&&ve.small<ve.medium&&ve.medium<ve.large}(fe)){JSON.stringify(kp,null,2);fe=kp}this._set("breakpoints",{...fe})}}_updateClassNames(){if(!this.container)return;const fe=Nr.acquire(),ve=Nr.acquire();let _e,be=!1;for(_e in zp){const we=this[_e],Se=zp[_e].getValue({viewSize:this.size,breakpoints:this.breakpoints});we!==Se&&(be=!0,this[_e]=Se,m$3c(_e,we).forEach((fe=>ve.push(fe))),m$3c(_e,Se).forEach((ve=>fe.push(ve))))}be&&(this._applyClassNameChanges(fe,ve),Nr.release(fe),Nr.release(ve))}_applyClassNameChanges(fe,ve){const _e=this.container;_e&&(ve.forEach((fe=>_e.classList.remove(fe))),fe.forEach((fe=>_e.classList.add(fe))))}_removeActiveClassNames(){const fe=this.container;if(!fe)return;let ve;for(ve in zp)m$3c(ve,this[ve]).forEach((ve=>fe.classList.remove(ve)))}};return e$4o([y$2v()],ve.prototype,"breakpoints",null),e$4o([y$2v()],ve.prototype,"orientation",void 0),e$4o([y$2v()],ve.prototype,"widthBreakpoint",void 0),e$4o([y$2v()],ve.prototype,"heightBreakpoint",void 0),ve=e$4o([a$4y("esri.views.BreakpointsOwner")],ve),ve};let Up=class h extends zi{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(fe,ve,_e={}){return this._installWatch(fe,ve,_e,d$3d)}addWhen(fe,ve,_e={}){return this._installWatch(fe,ve,_e,p$4J)}addOnCollectionChange(fe,ve,{initial:_e=!1,final:be=!1}={}){const we=++this._handleId;return this.addHandles([v$1W(fe,"after-changes",this._createSyncUpdatingCallback(),Za),v$1W(fe,"change",ve,{onListenerAdd:_e?fe=>ve({added:fe.toArray(),removed:[]}):void 0,onListenerRemove:be?fe=>ve({added:[],removed:fe.toArray()}):void 0})],we),e$4e((()=>this.removeHandles(we)))}addPromise(fe){if(null==fe)return fe;const ve=++this._handleId;this.addHandles(e$4e((()=>{this._pendingPromises.delete(fe)&&(0!==this._pendingPromises.size||this.hasHandles(Vp)||this._set("updating",!1))})),ve),this._pendingPromises.add(fe),this._set("updating",!0);const i52=()=>this.removeHandles(ve);return fe.then(i52,i52),fe}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(fe,ve,_e={},be){const we=++this._handleId;_e.sync||this._installSyncUpdatingWatch(fe,we);const Se=be(fe,ve,_e);return this.addHandles(Se,we),e$4e((()=>this.removeHandles(we)))}_installSyncUpdatingWatch(fe,ve){const _e=d$3d(fe,this._createSyncUpdatingCallback(),{sync:!0,equals:()=>!1});return this.addHandles(_e,ve),_e}_createSyncUpdatingCallback(){return()=>{this.removeHandles(Vp),++this._scheduleHandleId;const fe=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(v$27((()=>{fe===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(Vp))})),Vp)}}};e$4o([y$2v({readOnly:!0})],Up.prototype,"updating",void 0),Up=e$4o([a$4y("esri.core.support.UpdatingHandles")],Up);const Vp=-42;
/*!
 * @esri/arcgis-html-sanitizer - v4.0.1 - Thu May 30 2024 10:12:55 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var __assign=function(){return __assign=Object.assign||function __assign2(fe){for(var ve,_e=1,be=arguments.length;_e<be;_e++)for(var we in ve=arguments[_e])Object.prototype.hasOwnProperty.call(ve,we)&&(fe[we]=ve[we]);return fe},__assign.apply(this,arguments)},Bp={exports:{}},jp={},Gp={exports:{}},Hp={};function getDefaultWhiteList$1(){var fe={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return fe}var qp=/javascript\s*\:/gim;Hp.whiteList=getDefaultWhiteList$1(),Hp.getDefaultWhiteList=getDefaultWhiteList$1,Hp.onAttr=function onAttr(fe,ve,_e){},Hp.onIgnoreAttr=function onIgnoreAttr(fe,ve,_e){},Hp.safeAttrValue=function safeAttrValue$1(fe,ve){return qp.test(ve)?"":ve};var Wp={indexOf:function(fe,ve){var _e,be;if(Array.prototype.indexOf)return fe.indexOf(ve);for(_e=0,be=fe.length;_e<be;_e++)if(fe[_e]===ve)return _e;return-1},forEach:function(fe,ve,_e){var be,we;if(Array.prototype.forEach)return fe.forEach(ve,_e);for(be=0,we=fe.length;be<we;be++)ve.call(_e,fe[be],be,fe)},trim:function(fe){return String.prototype.trim?fe.trim():fe.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(fe){return String.prototype.trimRight?fe.trimRight():fe.replace(/(\s*$)/g,"")}},Yp=Wp;var Zp=function parseStyle$1(fe,ve){";"!==(fe=Yp.trimRight(fe))[fe.length-1]&&(fe+=";");var _e=fe.length,be=!1,we=0,Se=0,Te="";function addNewAttr(){if(!be){var _e=Yp.trim(fe.slice(we,Se)),Ee=_e.indexOf(":");if(-1!==Ee){var Ce=Yp.trim(_e.slice(0,Ee)),Oe=Yp.trim(_e.slice(Ee+1));if(Ce){var Re=ve(we,Te.length,Ce,Oe,_e);Re&&(Te+=Re+"; ")}}}we=Se+1}for(;Se<_e;Se++){var Ee=fe[Se];if("/"===Ee&&"*"===fe[Se+1]){var Ce=fe.indexOf("*/",Se+2);if(-1===Ce)break;we=(Se=Ce+1)+1,be=!1}else"("===Ee?be=!0:")"===Ee?be=!1:";"===Ee?be||addNewAttr():"\n"===Ee&&addNewAttr()}return Yp.trim(Te)},Xp=Hp,Jp=Zp;function isNull$1(fe){return null==fe}function FilterCSS$2(fe){fe=function shallowCopyObject$1(fe){var ve={};for(var _e in fe)ve[_e]=fe[_e];return ve}(fe||{}),fe.whiteList=fe.whiteList||Xp.whiteList,fe.onAttr=fe.onAttr||Xp.onAttr,fe.onIgnoreAttr=fe.onIgnoreAttr||Xp.onIgnoreAttr,fe.safeAttrValue=fe.safeAttrValue||Xp.safeAttrValue,this.options=fe}FilterCSS$2.prototype.process=function(fe){if(!(fe=(fe=fe||"").toString()))return"";var ve=this.options,_e=ve.whiteList,be=ve.onAttr,we=ve.onIgnoreAttr,Se=ve.safeAttrValue;return Jp(fe,(function(fe,ve,Te,Ee,Ce){var Oe=_e[Te],Re=!1;if(!0===Oe?Re=Oe:"function"==typeof Oe?Re=Oe(Ee):Oe instanceof RegExp&&(Re=Oe.test(Ee)),!0!==Re&&(Re=!1),Ee=Se(Te,Ee)){var De,Be={position:ve,sourcePosition:fe,source:Ce,isWhite:Re};return Re?isNull$1(De=be(Te,Ee,Be))?Te+":"+Ee:De:isNull$1(De=we(Te,Ee,Be))?void 0:De}}))};var Qp=FilterCSS$2;!function(fe,ve){var _e=Hp,be=Qp;for(var we in(ve=fe.exports=function filterCSS(fe,ve){return new be(ve).process(fe)}).FilterCSS=be,_e)ve[we]=_e[we]}(Gp,Gp.exports);var Kp=Gp.exports,ef={indexOf:function(fe,ve){var _e,be;if(Array.prototype.indexOf)return fe.indexOf(ve);for(_e=0,be=fe.length;_e<be;_e++)if(fe[_e]===ve)return _e;return-1},forEach:function(fe,ve,_e){var be,we;if(Array.prototype.forEach)return fe.forEach(ve,_e);for(be=0,we=fe.length;be<we;be++)ve.call(_e,fe[be],be,fe)},trim:function(fe){return String.prototype.trim?fe.trim():fe.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(fe){var ve=/\s|\n|\t/.exec(fe);return ve?ve.index:-1}},tf=Kp.FilterCSS,rf=Kp.getDefaultWhiteList,nf=ef;function getDefaultWhiteList(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var sf=new tf;function escapeHtml(fe){return fe.replace(of,"&lt;").replace(af,"&gt;")}var of=/</g,af=/>/g,lf=/"/g,cf=/&quot;/g,uf=/&#([a-zA-Z0-9]*);?/gim,hf=/&colon;?/gim,df=/&newline;?/gim,pf=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ff=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,mf=/u\s*r\s*l\s*\(.*/gi;function escapeQuote(fe){return fe.replace(lf,"&quot;")}function unescapeQuote(fe){return fe.replace(cf,'"')}function escapeHtmlEntities(fe){return fe.replace(uf,(function replaceUnicode(fe,ve){return"x"===ve[0]||"X"===ve[0]?String.fromCharCode(parseInt(ve.substr(1),16)):String.fromCharCode(parseInt(ve,10))}))}function escapeDangerHtml5Entities(fe){return fe.replace(hf,":").replace(df," ")}function clearNonPrintableCharacter(fe){for(var ve="",_e=0,be=fe.length;_e<be;_e++)ve+=fe.charCodeAt(_e)<32?" ":fe.charAt(_e);return nf.trim(ve)}function friendlyAttrValue(fe){return fe=clearNonPrintableCharacter(fe=escapeDangerHtml5Entities(fe=escapeHtmlEntities(fe=unescapeQuote(fe))))}function escapeAttrValue(fe){return fe=escapeHtml(fe=escapeQuote(fe))}jp.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},jp.getDefaultWhiteList=getDefaultWhiteList,jp.onTag=function onTag(fe,ve,_e){},jp.onIgnoreTag=function onIgnoreTag(fe,ve,_e){},jp.onTagAttr=function onTagAttr(fe,ve,_e){},jp.onIgnoreTagAttr=function onIgnoreTagAttr(fe,ve,_e){},jp.safeAttrValue=function safeAttrValue(fe,ve,_e,be){if(_e=friendlyAttrValue(_e),"href"===ve||"src"===ve){if("#"===(_e=nf.trim(_e)))return"#";if("http://"!==_e.substr(0,7)&&"https://"!==_e.substr(0,8)&&"mailto:"!==_e.substr(0,7)&&"tel:"!==_e.substr(0,4)&&"data:image/"!==_e.substr(0,11)&&"ftp://"!==_e.substr(0,6)&&"./"!==_e.substr(0,2)&&"../"!==_e.substr(0,3)&&"#"!==_e[0]&&"/"!==_e[0])return""}else if("background"===ve){if(pf.lastIndex=0,pf.test(_e))return""}else if("style"===ve){if(ff.lastIndex=0,ff.test(_e))return"";if(mf.lastIndex=0,mf.test(_e)&&(pf.lastIndex=0,pf.test(_e)))return"";!1!==be&&(_e=(be=be||sf).process(_e))}return _e=escapeAttrValue(_e)},jp.escapeHtml=escapeHtml,jp.escapeQuote=escapeQuote,jp.unescapeQuote=unescapeQuote,jp.escapeHtmlEntities=escapeHtmlEntities,jp.escapeDangerHtml5Entities=escapeDangerHtml5Entities,jp.clearNonPrintableCharacter=clearNonPrintableCharacter,jp.friendlyAttrValue=friendlyAttrValue,jp.escapeAttrValue=escapeAttrValue,jp.onIgnoreTagStripAll=function onIgnoreTagStripAll(){return""},jp.StripTagBody=function StripTagBody(fe,ve){"function"!=typeof ve&&(ve=function(){});var _e=!Array.isArray(fe),be=[],we=!1;return{onIgnoreTag:function(Se,Te,Ee){if(function isRemoveTag(ve){return!!_e||-1!==nf.indexOf(fe,ve)}(Se)){if(Ee.isClosing){var Ce="[/removed]",Oe=Ee.position+10;return be.push([!1!==we?we:Ee.position,Oe]),we=!1,Ce}return we||(we=Ee.position),"[removed]"}return ve(Se,Te,Ee)},remove:function(fe){var ve="",_e=0;return nf.forEach(be,(function(be){ve+=fe.slice(_e,be[0]),_e=be[1]})),ve+=fe.slice(_e)}}},jp.stripCommentTag=function stripCommentTag(fe){for(var ve="",_e=0;_e<fe.length;){var be=fe.indexOf("\x3c!--",_e);if(-1===be){ve+=fe.slice(_e);break}ve+=fe.slice(_e,be);var we=fe.indexOf("--\x3e",be);if(-1===we)break;_e=we+3}return ve},jp.stripBlankChar=function stripBlankChar(fe){var ve=fe.split("");return(ve=ve.filter((function(fe){var ve=fe.charCodeAt(0);return 127!==ve&&(!(ve<=31)||(10===ve||13===ve))}))).join("")},jp.attributeWrapSign='"',jp.cssFilter=sf,jp.getDefaultCSSWhiteList=rf;var yf={},gf=ef;function getTagName(fe){var ve,_e=gf.spaceIndex(fe);return ve=-1===_e?fe.slice(1,-1):fe.slice(1,_e+1),"/"===(ve=gf.trim(ve).toLowerCase()).slice(0,1)&&(ve=ve.slice(1)),"/"===ve.slice(-1)&&(ve=ve.slice(0,-1)),ve}function isClosing(fe){return"</"===fe.slice(0,2)}var vf=/[^a-zA-Z0-9\\_:.-]/gim;function findNextEqual(fe,ve){for(;ve<fe.length;ve++){var _e=fe[ve];if(" "!==_e)return"="===_e?ve:-1}}function findNextQuotationMark(fe,ve){for(;ve<fe.length;ve++){var _e=fe[ve];if(" "!==_e)return"'"===_e||'"'===_e?ve:-1}}function findBeforeEqual(fe,ve){for(;ve>0;ve--){var _e=fe[ve];if(" "!==_e)return"="===_e?ve:-1}}function stripQuoteWrap(fe){return function isQuoteWrapString(fe){return'"'===fe[0]&&'"'===fe[fe.length-1]||"'"===fe[0]&&"'"===fe[fe.length-1]}(fe)?fe.substr(1,fe.length-2):fe}yf.parseTag=function parseTag$1(fe,ve,_e){var be="",we=0,Se=!1,Te=!1,Ee=0,Ce=fe.length,Oe="",Re="";e:for(Ee=0;Ee<Ce;Ee++){var De=fe.charAt(Ee);if(!1===Se){if("<"===De){Se=Ee;continue}}else if(!1===Te){if("<"===De){be+=_e(fe.slice(we,Ee)),Se=Ee,we=Ee;continue}if(">"===De||Ee===Ce-1){be+=_e(fe.slice(we,Se)),Oe=getTagName(Re=fe.slice(Se,Ee+1)),be+=ve(Se,be.length,Oe,Re,isClosing(Re)),we=Ee+1,Se=!1;continue}if('"'===De||"'"===De)for(var Be=1,Ze=fe.charAt(Ee-Be);""===Ze.trim()||"="===Ze;){if("="===Ze){Te=De;continue e}Ze=fe.charAt(Ee-++Be)}}else if(De===Te){Te=!1;continue}}return we<Ce&&(be+=_e(fe.substr(we))),be},yf.parseAttr=function parseAttr$1(fe,ve){var _e=0,be=0,we=[],Se=!1,Te=fe.length;function addAttr(fe,_e){if(!((fe=(fe=gf.trim(fe)).replace(vf,"").toLowerCase()).length<1)){var be=ve(fe,_e||"");be&&we.push(be)}}for(var Ee=0;Ee<Te;Ee++){var Ce,Oe=fe.charAt(Ee);if(!1!==Se||"="!==Oe)if(!1===Se||Ee!==be)if(/\s|\n|\t/.test(Oe)){if(fe=fe.replace(/\s|\n|\t/g," "),!1===Se){if(-1===(Ce=findNextEqual(fe,Ee))){addAttr(gf.trim(fe.slice(_e,Ee))),Se=!1,_e=Ee+1;continue}Ee=Ce-1;continue}if(-1===(Ce=findBeforeEqual(fe,Ee-1))){addAttr(Se,stripQuoteWrap(gf.trim(fe.slice(_e,Ee)))),Se=!1,_e=Ee+1;continue}}else;else{if(-1===(Ce=fe.indexOf(Oe,Ee+1)))break;addAttr(Se,gf.trim(fe.slice(be+1,Ce))),Se=!1,_e=(Ee=Ce)+1}else Se=fe.slice(_e,Ee),_e=Ee+1,be='"'===fe.charAt(_e)||"'"===fe.charAt(_e)?_e:findNextQuotationMark(fe,Ee+1)}return _e<fe.length&&(!1===Se?addAttr(fe.slice(_e)):addAttr(Se,stripQuoteWrap(gf.trim(fe.slice(_e))))),gf.trim(we.join(" "))};var _f=Kp.FilterCSS,$f=jp,bf=yf,wf=bf.parseTag,xf=bf.parseAttr,Sf=ef;function isNull(fe){return null==fe}function FilterXSS(fe){fe=function shallowCopyObject(fe){var ve={};for(var _e in fe)ve[_e]=fe[_e];return ve}(fe||{}),fe.stripIgnoreTag&&(fe.onIgnoreTag,fe.onIgnoreTag=$f.onIgnoreTagStripAll),fe.whiteList||fe.allowList?fe.whiteList=function keysToLowerCase(fe){var ve={};for(var _e in fe)Array.isArray(fe[_e])?ve[_e.toLowerCase()]=fe[_e].map((function(fe){return fe.toLowerCase()})):ve[_e.toLowerCase()]=fe[_e];return ve}(fe.whiteList||fe.allowList):fe.whiteList=$f.whiteList,this.attributeWrapSign=!0===fe.singleQuotedAttributeValue?"'":$f.attributeWrapSign,fe.onTag=fe.onTag||$f.onTag,fe.onTagAttr=fe.onTagAttr||$f.onTagAttr,fe.onIgnoreTag=fe.onIgnoreTag||$f.onIgnoreTag,fe.onIgnoreTagAttr=fe.onIgnoreTagAttr||$f.onIgnoreTagAttr,fe.safeAttrValue=fe.safeAttrValue||$f.safeAttrValue,fe.escapeHtml=fe.escapeHtml||$f.escapeHtml,this.options=fe,!1===fe.css?this.cssFilter=!1:(fe.css=fe.css||{},this.cssFilter=new _f(fe.css))}FilterXSS.prototype.process=function(fe){if(!(fe=(fe=fe||"").toString()))return"";var ve=this,_e=ve.options,be=_e.whiteList,we=_e.onTag,Se=_e.onIgnoreTag,Te=_e.onTagAttr,Ee=_e.onIgnoreTagAttr,Ce=_e.safeAttrValue,Oe=_e.escapeHtml,Re=ve.attributeWrapSign,De=ve.cssFilter;_e.stripBlankChar&&(fe=$f.stripBlankChar(fe)),_e.allowCommentTag||(fe=$f.stripCommentTag(fe));var Be=!1;_e.stripIgnoreTagBody&&(Be=$f.StripTagBody(_e.stripIgnoreTagBody,Se),Se=Be.onIgnoreTag);var Ze=wf(fe,(function(fe,ve,_e,Be,Ze){var Xe={sourcePosition:fe,position:ve,isClosing:Ze,isWhite:Object.prototype.hasOwnProperty.call(be,_e)},Je=we(_e,Be,Xe);if(!isNull(Je))return Je;if(Xe.isWhite){if(Xe.isClosing)return"</"+_e+">";var Qe=function getAttrs(fe){var ve=Sf.spaceIndex(fe);if(-1===ve)return{html:"",closing:"/"===fe[fe.length-2]};var _e="/"===(fe=Sf.trim(fe.slice(ve+1,-1)))[fe.length-1];return _e&&(fe=Sf.trim(fe.slice(0,-1))),{html:fe,closing:_e}}(Be),dt=be[_e],$t=xf(Qe.html,(function(fe,ve){var be=-1!==Sf.indexOf(dt,fe),we=Te(_e,fe,ve,be);return isNull(we)?be?(ve=Ce(_e,fe,ve,De))?fe+"="+Re+ve+Re:fe:isNull(we=Ee(_e,fe,ve,be))?void 0:we:we}));return Be="<"+_e,$t&&(Be+=" "+$t),Qe.closing&&(Be+=" /"),Be+=">"}return isNull(Je=Se(_e,Be,Xe))?Oe(Be):Je}),Oe);return Be&&(Ze=Be.remove(Ze)),Ze};var Tf=FilterXSS;!function(fe,ve){var _e=jp,be=yf,we=Tf;function filterXSS(fe,ve){return new we(ve).process(fe)}(ve=fe.exports=filterXSS).filterXSS=filterXSS,ve.FilterXSS=we,function(){for(var fe in _e)ve[fe]=_e[fe];for(var we in be)ve[we]=be[we]}(),function isWorkerEnv(){return"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope}()&&(self.filterXSS=fe.exports)}(Bp,Bp.exports);var Ef=Bp.exports,Pf=function(){function Sanitizer2(fe,ve){var _e,be=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=__assign(__assign({},Ef.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(fe,ve,_e,we){return"a"===fe&&"href"===ve||("img"===fe||"source"===fe)&&"src"===ve?be.sanitizeUrl(_e):Ef.safeAttrValue(fe,ve,_e,we)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},fe&&!ve?_e=fe:fe&&ve?((_e=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(fe).forEach((function(ve){if("whiteList"===ve)_e.whiteList=be._extendObjectOfArrays([be.arcgisWhiteList,fe.whiteList||{}]);else if("css"===ve){var we=fe.css.whiteList;null!=we&&fe.css instanceof Object&&Object.keys(we).forEach((function(fe){return _e.css.whiteList[fe]=we[fe]}))}else _e[ve]=fe[ve]}))):((_e=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,_e.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=_e,this._xssFilter=new Ef.FilterXSS(_e)}return Sanitizer2.prototype.sanitize=function(fe,ve){switch(void 0===ve&&(ve={}),typeof fe){case"number":return isNaN(fe)||!isFinite(fe)?null:fe;case"boolean":return fe;case"string":return this._xssFilter.process(fe);case"object":return this._iterateOverObject(fe,ve);default:if(ve.allowUndefined&&void 0===fe)return;return null}},Sanitizer2.prototype.sanitizeUrl=function(fe,ve){var _e=(null!=ve?ve:{}).isProtocolRequired,be=void 0===_e||_e,we=this._trim(fe.substring(0,fe.indexOf(":"))),Se="/"===fe,Te=/^#/.test(fe),Ee=we&&this.allowedProtocols.indexOf(we.toLowerCase())>-1;return Se||Te||Ee?Ef.escapeAttrValue(fe):we||be?"":Ef.escapeAttrValue("https://".concat(fe))},Sanitizer2.prototype.sanitizeHTMLAttribute=function(fe,ve,_e,be){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(fe,ve,_e,be):Ef.safeAttrValue(fe,ve,_e,be)},Sanitizer2.prototype.validate=function(fe,ve){void 0===ve&&(ve={});var _e=this.sanitize(fe,ve);return{isValid:fe===_e,sanitized:_e}},Sanitizer2.prototype.encodeHTML=function(fe){var ve=this;return String(fe).replace(/[&<>"'\/]/g,(function(fe){return ve._entityMap[fe]}))},Sanitizer2.prototype.encodeAttrValue=function(fe){var ve=/^[a-zA-Z0-9]$/;return String(fe).replace(/[\x00-\xFF]/g,(function(_e,be){return ve.test(_e)?_e:"&#x".concat(Number(fe.charCodeAt(be)).toString(16),";")}))},Sanitizer2.prototype._extendObjectOfArrays=function(fe){var ve={};return fe.forEach((function(fe){Object.keys(fe).forEach((function(_e){Array.isArray(fe[_e])&&Array.isArray(ve[_e])?ve[_e]=ve[_e].concat(fe[_e]):ve[_e]=fe[_e]}))})),ve},Sanitizer2.prototype._iterateOverObject=function(fe,ve){var _e=this;void 0===ve&&(ve={});try{var be=!1,we=void 0;if(Array.isArray(fe))we=fe.reduce((function(fe,we){var Se=_e.validate(we,ve);return Se.isValid?fe.concat([we]):(be=!0,fe.concat([Se.sanitized]))}),[]);else{if(!function(fe){if("object"!=typeof fe||null===fe)return!1;if("[object Object]"!==Object.prototype.toString.call(fe))return!1;var ve=Object.getPrototypeOf(fe);if(null===ve)return!0;for(;null!==Object.getPrototypeOf(ve);)ve=Object.getPrototypeOf(ve);return Object.getPrototypeOf(fe)===ve}(fe)){if(ve.allowUndefined&&void 0===fe)return;return null}we=Object.keys(fe).reduce((function(we,Se){var Te=fe[Se],Ee=_e.validate(Te,ve);return Ee.isValid?we[Se]=Te:(be=!0,we[Se]=Ee.sanitized),we}),{})}return be?we:fe}catch(Se){return null}},Sanitizer2.prototype._trim=function(fe){return String.prototype.trim?fe.trim():fe.replace(/(^\s*)|(\s*$)/g,"")},Sanitizer2}();const Cf=new Map;function t$3G(){Cf.clear()}function o$3u(fe){Cf.delete(fe)}function f$2H(...fe){const ve=Nr.acquire();for(let be=0;be<fe.length;be++){const _e=fe[be],we=typeof _e;if("string"===we)ve.push(_e);else if(Array.isArray(_e))ve.push.apply(ve,_e);else if("object"===we)for(const fe in _e)_e[fe]&&ve.push(fe)}const _e=ve.join(" ");return Nr.release(ve),_e}function g$27(fe){const ve=null==fe?void 0:fe.closest("[dir]");return null!==ve&&ve instanceof HTMLElement&&"rtl"===ve.dir||"rtl"===document.dir}function v$1K(fe){this[fe.getAttribute("data-node-ref")]=null}function b$1V(fe){this[fe.getAttribute("data-node-ref")]=fe}(()=>{const fe=new Map,ve=new ResizeObserver((ve=>{var _e;t$3G();for(const be of ve)null==(_e=fe.get(be.target))||_e(be)}))})();const Of=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((fe,ve)=>(fe[ve]=[],fe)),{}),Af=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Mf=new Pf({whiteList:Of,onTagAttr:(fe,ve,_e)=>{const be=`${ve}="${_e}"`;if(Af.includes(ve))return be},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);const Rf="http://www.w3.org/",If=`${Rf}2000/svg`,Lf=`${Rf}1999/xlink`;let Df=[],n$40=(fe,ve)=>{let _e={};return Object.keys(fe).forEach((ve=>{_e[ve]=fe[ve]})),ve&&Object.keys(ve).forEach((fe=>{_e[fe]=ve[fe]})),_e},s$3H=(fe,ve)=>fe.vnodeSelector===ve.vnodeSelector&&(fe.properties&&ve.properties?fe.properties.key===ve.properties.key&&fe.properties.bind===ve.properties.bind:!fe.properties&&!ve.properties),l$3R=fe=>{if("string"!=typeof fe)throw new Error("Style values must be strings")},p$4r=(fe,ve,_e)=>{if(""!==ve.vnodeSelector)for(let be=_e;be<fe.length;be++)if(s$3H(fe[be],ve))return be;return-1},d$2W=(fe,ve,_e,be)=>{let we=fe[ve];if(""===we.vnodeSelector)return;let Se=we.properties;if(!(Se?void 0===Se.key?Se.bind:Se.key:void 0))for(let Te=0;Te<fe.length;Te++)if(Te!==ve){let ve=fe[Te];if(s$3H(ve,we))throw new Error(`${_e.vnodeSelector} had a ${we.vnodeSelector} child ${"added"===be?be:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},a$3_=fe=>{if(fe.properties){let ve=fe.properties.enterAnimation;ve&&ve(fe.domNode,fe.properties)}},Nf=[],Ff=!1,u$3p=fe=>{(fe.children||[]).forEach(u$3p),fe.properties&&fe.properties.afterRemoved&&fe.properties.afterRemoved.apply(fe.properties.bind||fe.properties,[fe.domNode])},m$3b=()=>{Ff=!1,Nf.forEach(u$3p),Nf.length=0},h$2s=fe=>{Nf.push(fe),Ff||(Ff=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(m$3b,{timeout:16}):setTimeout(m$3b,16))},v$1J=fe=>{let ve=fe.domNode;if(fe.properties){let _e=fe.properties.exitAnimation;if(_e){ve.style.pointerEvents="none";let o39=()=>{ve.parentNode&&(ve.parentNode.removeChild(ve),h$2s(fe))};return void _e(ve,o39,fe.properties)}}ve.parentNode&&(ve.parentNode.removeChild(ve),h$2s(fe))},y$1Y=(fe,ve,_e)=>{if(!ve)return;let be=_e.eventHandlerInterceptor,we=Object.keys(ve),Se=we.length;for(let Te=0;Te<Se;Te++){let Se=we[Te],Ee=ve[Se];if("className"===Se)throw new Error('Property "className" is not supported, use "class".');if("class"===Se)k$1g(fe,Ee,!0);else if("classes"===Se){let ve=Object.keys(Ee),_e=ve.length;for(let be=0;be<_e;be++){let _e=ve[be];Ee[_e]&&fe.classList.add(_e)}}else if("styles"===Se){let ve=Object.keys(Ee),be=ve.length;for(let we=0;we<be;we++){let be=ve[we],Se=Ee[be];Se&&(l$3R(Se),_e.styleApplyer(fe,be,Se))}}else if("key"!==Se&&null!=Ee){let we=typeof Ee;"function"===we?(0===Se.lastIndexOf("on",0)&&(be&&(Ee=be(Se,Ee,fe,ve)),"oninput"===Se&&function(){let fe=Ee;Ee=function(ve){fe.apply(this,[ve]),ve.target["oninput-value"]=ve.target.value}}()),fe[Se]=Ee):_e.namespace===If?"href"===Se?fe.setAttributeNS(Lf,Se,Ee):fe.setAttribute(Se,Ee):"string"===we&&"value"!==Se?"innerHTML"===Se?fe[Se]=Mf.sanitize(Ee):g$26(fe)&&Se in fe?fe[Se]=Ee:fe.setAttribute(Se,Ee):fe[Se]=Ee}}};function g$26(fe){if(!(fe instanceof Element&&fe.tagName.includes("-")))return!1;const ve=window.customElements.get(fe.tagName.toLowerCase());return!!ve&&fe instanceof ve}let zf,w$1E=(fe,ve,_e)=>{((fe,ve,_e)=>{if(ve)for(let be of ve)x$1w(be,fe,void 0,_e)})(fe,ve.children,_e),ve.text&&(fe.textContent=ve.text),y$1Y(fe,ve.properties,_e),ve.properties&&ve.properties.afterCreate&&ve.properties.afterCreate.apply(ve.properties.bind||ve.properties,[fe,_e,ve.vnodeSelector,ve.properties,ve.children])},x$1w=(fe,ve,_e,be)=>{let we,Se=0,Te=fe.vnodeSelector,Ee=ve.ownerDocument;if(""===Te)we=fe.domNode=Ee.createTextNode(fe.text),void 0!==_e?ve.insertBefore(we,_e):ve.appendChild(we);else{for(let Ce=0;Ce<=Te.length;++Ce){let Oe=Te.charAt(Ce);if(Ce===Te.length||"."===Oe||"#"===Oe){let Oe=Te.charAt(Se-1),Re=Te.slice(Se,Ce);"."===Oe?we.classList.add(Re):"#"===Oe?we.id=Re:("svg"===Re&&(be=n$40(be,{namespace:If})),void 0!==be.namespace?we=fe.domNode=Ee.createElementNS(be.namespace,Re):(we=fe.domNode=fe.domNode||Ee.createElement(Re),"input"===Re&&fe.properties&&void 0!==fe.properties.type&&we.setAttribute("type",fe.properties.type)),void 0!==_e?ve.insertBefore(we,_e):we.parentNode!==ve&&ve.appendChild(we)),Se=Ce+1}}w$1E(we,fe,be)}},k$1g=(fe,ve,_e)=>{ve&&ve.split(" ").forEach((ve=>{ve&&fe.classList.toggle(ve,_e)}))};zf=(fe,ve,_e)=>{let be=fe.domNode,we=!1;if(fe===ve)return!1;let Se=!1;if(""===ve.vnodeSelector){if(ve.text!==fe.text){let fe=be.ownerDocument.createTextNode(ve.text);return be.parentNode.replaceChild(fe,be),ve.domNode=fe,we=!0,we}ve.domNode=be}else 0===ve.vnodeSelector.lastIndexOf("svg",0)&&(_e=n$40(_e,{namespace:If})),fe.text!==ve.text&&(Se=!0,void 0===ve.text?be.removeChild(be.firstChild):be.textContent=ve.text),ve.domNode=be,Se=((fe,ve,_e,be,we)=>{if(_e===be)return!1;be=be||Df;let Se,Te=(_e=_e||Df).length,Ee=be.length,Ce=0,Oe=0,Re=!1;for(;Oe<Ee;){let Ee=Ce<Te?_e[Ce]:void 0,De=be[Oe];if(void 0!==Ee&&s$3H(Ee,De))Re=zf(Ee,De,we)||Re,Ce++;else{let Ee=p$4r(_e,De,Ce+1);if(Ee>=0){for(Se=Ce;Se<Ee;Se++)v$1J(_e[Se]),d$2W(_e,Se,fe,"removed");Re=zf(_e[Ee],De,we)||Re,Ce=Ee+1}else x$1w(De,ve,Ce<Te?_e[Ce].domNode:void 0,we),a$3_(De),d$2W(be,Oe,fe,"added")}Oe++}if(Te>Ce)for(Se=Ce;Se<Te;Se++)v$1J(_e[Se]),d$2W(_e,Se,fe,"removed");return Re})(ve,be,fe.children,ve.children,_e)||Se,Se=((fe,ve,_e,be)=>{if(!_e)return;let we=!1,Se=Object.keys(_e),Te=Se.length;for(let Ee=0;Ee<Te;Ee++){let Te=Se[Ee],Ce=_e[Te],Oe=ve[Te];if("class"===Te)Oe!==Ce&&(k$1g(fe,Oe,!1),k$1g(fe,Ce,!0));else if("classes"===Te){let ve=fe.classList,_e=Object.keys(Ce),be=_e.length;for(let fe=0;fe<be;fe++){let be=_e[fe],Se=!!Ce[be];Se!==!!Oe[be]&&(we=!0,Se?ve.add(be):ve.remove(be))}}else if("styles"===Te){let ve=Object.keys(Ce),_e=ve.length;for(let Se=0;Se<_e;Se++){let _e=ve[Se],Te=Ce[_e];Te!==Oe[_e]&&(we=!0,Te?(l$3R(Te),be.styleApplyer(fe,_e,Te)):be.styleApplyer(fe,_e,""))}}else if(Ce||"string"!=typeof Oe||(Ce=""),"value"!==Te||g$26(fe)){if(Ce!==Oe){let ve=typeof Ce;"function"===ve&&be.eventHandlerInterceptor||(be.namespace===If?"href"===Te?fe.setAttributeNS(Lf,Te,Ce):fe.setAttribute(Te,Ce):"string"===ve?"innerHTML"===Te?fe[Te]=Mf.sanitize(Ce):"role"===Te&&""===Ce?fe.removeAttribute(Te):g$26(fe)&&Te in fe?fe[Te]=Ce:fe.setAttribute(Te,Ce):fe[Te]!==Ce&&(fe[Te]=Ce),we=!0)}}else{let ve=fe[Te];ve!==Ce&&(fe["oninput-value"]?ve===fe["oninput-value"]:Ce!==Oe)&&(fe[Te]=Ce,fe["oninput-value"]=void 0),Ce!==Oe&&(we=!0)}}return we})(be,fe.properties,ve.properties,_e)||Se,ve.properties&&ve.properties.afterUpdate&&ve.properties.afterUpdate.apply(ve.properties.bind||ve.properties,[be,_e,ve.vnodeSelector,ve.properties,ve.children]);return Se&&ve.properties&&ve.properties.updateAnimation&&ve.properties.updateAnimation(be,ve.properties,fe.properties),we};let C$1h=(fe,ve)=>({getLastRender:()=>fe,update:_e=>{if(fe.vnodeSelector!==_e.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let be=fe;fe=_e,zf(be,_e,ve)},domNode:fe.domNode});const kf={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(fe,ve,_e)=>{"-"===ve.charAt(0)?fe.style.setProperty(ve,_e):fe.style[ve]=_e}};let Uf,d$2V=fe=>n$40(kf,fe),n$3$_append=(fe,ve,_e)=>(_e=d$2V(_e),x$1w(ve,fe,void 0,_e),C$1h(ve,_e)),n$3$_insertBefore=(fe,ve,_e)=>(_e=d$2V(_e),x$1w(ve,fe.parentNode,fe,_e),C$1h(ve,_e)),n$3$_merge=(fe,ve,_e)=>(_e=d$2V(_e),ve.domNode=fe,w$1E(fe,ve,_e),C$1h(ve,_e)),n$3$_replace=(fe,ve,_e)=>(_e=d$2V(_e),x$1w(ve,fe.parentNode,fe,_e),fe.parentNode.removeChild(fe),C$1h(ve,_e));Uf=Array.prototype.find?(fe,ve)=>fe.find(ve):(fe,ve)=>fe.filter(ve)[0];let d$2U=(fe,ve,_e)=>{let d35=function(be){_e("domEvent",be);let we=ve(),Se=((fe,ve)=>{let _e=[];for(;fe&&fe!==ve;)_e.push(fe),fe=fe.parentNode;return _e})(be.currentTarget,we.domNode);Se.reverse();let Te,Ee=((fe,ve)=>{let _e=fe;return ve.forEach((fe=>{_e=_e&&_e.children?Uf(_e.children,(ve=>ve.domNode===fe)):void 0})),_e})(we.getLastRender(),Se);return fe.scheduleRender(),Ee&&(Te=Ee.properties[`on${be.type}`].apply(Ee.properties.bind||this,arguments)),_e("domEventProcessed",be),Te};return(fe,ve,_e,be)=>d35},i$3$=fe=>{let ve,_e,be=d$2V(fe),we=be.performanceLogger,Se=!0,Te=!1,Ee=[],Ce=[],u30=(fe,_e,Se)=>{let Te;be.eventHandlerInterceptor=d$2U(ve,(()=>Te),we),Te=fe(_e,Se(),be),Ee.push(Te),Ce.push(Se)},f31=()=>{if(_e=void 0,Se){Se=!1,we("renderStart",void 0);for(let fe=0;fe<Ee.length;fe++){let ve=Ce[fe]();we("rendered",void 0),Ee[fe].update(ve),we("patched",void 0)}we("renderDone",void 0),Se=!0}};return ve={renderNow:f31,scheduleRender:()=>{_e||Te||(_e=requestAnimationFrame(f31))},stop:()=>{_e&&(cancelAnimationFrame(_e),_e=void 0),Te=!0},resume:()=>{Te=!1,Se=!0,ve.scheduleRender()},append:(fe,ve)=>{u30(n$3$_append,fe,ve)},insertBefore:(fe,ve)=>{u30(n$3$_insertBefore,fe,ve)},merge:(fe,ve)=>{u30(n$3$_merge,fe,ve)},replace:(fe,ve)=>{u30(n$3$_replace,fe,ve)},detach:fe=>{for(let ve=0;ve<Ce.length;ve++)if(Ce[ve]===fe)return Ce.splice(ve,1),Ee.splice(ve,1)[0];throw new Error("renderFunction was not found")}},ve},Vf=class a2 extends zi{constructor(){super(...arguments),this.items=new Wa,this._watchUpdatingTracking=new Up,this._callbacks=new Map,this._projector=i$3$(),this._hiddenProjector=i$3$()}get needsRender(){return this.items.length>0}get updating(){var fe;return(null==(fe=this._watchUpdatingTracking)?void 0:fe.updating)??!1}initialize(){const fe=document.createElement("div");fe.className="esri-overlay-surface",this._set("surface",fe),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),fe.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(fe=>{for(const ve of fe.added){const t86=()=>ve.render();this._callbacks.set(ve,t86),this._projector.append(this.surface,t86)}for(const ve of fe.removed){const fe=this._projector.detach(this._callbacks.get(ve));this.surface.removeChild(fe.domNode),this._callbacks.delete(ve)}}))}addItem(fe){this.items.add(fe)}removeItem(fe){this.items.remove(fe)}destroy(){this.items.removeAll(),this._callbacks.forEach((fe=>this._projector.detach(fe))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(fe){const ve=this._hiddenSurface,_e=this._hiddenProjector;let be;const s84=()=>(be=fe.render(),be);_e.append(ve,s84),_e.renderNow();const we={left:0,top:0,right:0,bottom:0};if(null==be?void 0:be.domNode){const fe=be.domNode.getBoundingClientRect();we.left=fe.left,we.top=fe.top,we.right=fe.right,we.bottom=fe.bottom}for(_e.detach(s84);ve.firstChild;)ve.removeChild(ve.firstChild);return we}overlaps(fe,ve){const _e=this.computeBoundingRect(fe),be=this.computeBoundingRect(ve);return Math.max(_e.left,be.left)<=Math.min(_e.right,be.right)&&Math.max(_e.top,be.top)<=Math.min(_e.bottom,be.bottom)}get hasVisibleItems(){return this.items.some((fe=>fe.visible))}async prepare(){await document.fonts.load(this._fontString()).catch((()=>{}))}renderCanvas(fe,ve){const _e=!!(null==ve?void 0:ve.disableDecorations);if(!this.items.some((fe=>fe.visible&&!(_e&&fe.isDecoration))))return;const be=fe.getContext("2d");be.save(),be.font=this._fontString(),this.items.forEach((fe=>{_e&&fe.isDecoration||(be.save(),fe.renderCanvas(be),be.restore())})),be.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};e$4o([y$2v({readOnly:!0})],Vf.prototype,"surface",void 0),e$4o([y$2v({readOnly:!0})],Vf.prototype,"items",void 0),e$4o([y$2v({readOnly:!0})],Vf.prototype,"needsRender",null),e$4o([y$2v({readOnly:!0})],Vf.prototype,"_watchUpdatingTracking",void 0),e$4o([y$2v({readOnly:!0})],Vf.prototype,"updating",null),Vf=e$4o([a$4y("esri.views.overlay.ViewOverlay")],Vf);const Bf=Vf,jf=[0,0];function g$25(fe){fe&&(n$4k(fe),fe.parentNode&&fe.parentNode.removeChild(fe))}const Gf=750,H$Z=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this._freqInfo={freq:16,time:Gf},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([d$3d((()=>this.cursor),(fe=>{const{surface:ve}=this;ve&&ve.setAttribute("data-cursor",fe)})),d$3d((()=>this.navigating),(fe=>{const{surface:ve}=this;ve&&ve.setAttribute("data-navigating",fe.toString())}))])}initialize(){this.addHandles([d$3d((()=>this.ui),((fe,ve)=>this._handleUIChange(fe,ve)),Xa),this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui=u$4d(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(fe){const ve=this._get("container"),_e=e$3O(fe);if(_e||"string"!=typeof fe||ar.getLogger(this).error("#container",`element with id '${fe}' not found`),ve===_e)return;if(this._stopMeasuring(),ve&&(ve.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(g$25(this.root),this._set("root",null)),this.userContent&&(i$4j(this.userContent,ve),g$25(this.userContent),this._set("userContent",null))),!_e)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);_e.classList.add("esri-view");const be=document.createElement("div");be.className="esri-view-user-storage",i$4j(_e,be),_e.appendChild(be),this._set("userContent",be);const we=document.createElement("div");we.className="esri-view-root",_e.insertBefore(we,_e.firstChild),this._set("root",we);const Se=document.createElement("div");Se.className="esri-view-surface",Se.setAttribute("role","application"),Se.tabIndex=0,we.appendChild(Se),this._set("surface",Se);const Te=new Bf;we.appendChild(Te.surface),this._set("overlay",Te),this.addHandles(d$3d((()=>Te.needsRender),(fe=>{fe&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=A$1I({render:()=>{var fe;return null==(fe=this.overlay)?void 0:fe.render()}}):this._overlayRenderTaskHandle=l$4E(this._overlayRenderTaskHandle)}))),this.forceDOMReadyCycle(),this._set("container",_e),this._startMeasuring()}get focused(){const fe=document.activeElement===this.surface;return document.hasFocus()&&fe}get size(){return[this.width,this.height]}blur(){var fe;null==(fe=this.surface)||fe.blur()}focus(){var fe;null==(fe=this.surface)||fe.focus()}pageToContainer(fe,ve,_e){const be=this.position;return fe-=be?be[0]:0,ve-=be?be[1]:0,_e?(_e[0]=fe,_e[1]=ve):_e=[fe,ve],_e}containerToPage(fe,ve,_e){const be=this.position;return fe+=be?be[0]:0,ve+=be?be[1]:0,_e?(_e[0]=fe,_e[1]=ve):_e=[fe,ve],_e}_handleUIChange(fe,ve){this.removeHandles("ui"),ve&&ve!==fe&&ve.destroy(),fe&&(fe.view=this,this.addHandles(d$3d((()=>this.root),(ve=>{fe.container=ve?function y$1X(fe){const ve=document.createElement("div");return fe.appendChild(ve),ve}(ve):null}),Xa),"ui")),this._set("ui",fe)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const fe=this._freqInfo;fe.freq=16,fe.time=Gf,this.addHandles([o$4e(window,"resize",(()=>{fe.freq=16,fe.time=Gf})),A$1I({prepare:fe=>{const ve=this._measure(),_e=this._freqInfo;if(_e.time+=fe.deltaTime,ve&&(_e.freq=16,this._get("resizing")||this._set("resizing",!0)),_e.time<_e.freq)return;_e.time=0;const be=this._position();_e.freq=be||ve?16:Math.min(Gf,2*_e.freq),!ve&&_e.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const fe=this.container,ve=fe?fe.clientWidth:0,_e=fe?fe.clientHeight:0;if(0===ve||0===_e)return this.suspended||this._set("suspended",!0),!1;const be=this.width,we=this.height;return ve===be&&_e===we?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",ve),this._set("height",_e),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:be,oldHeight:we,width:ve,height:_e}),!0)}_position(){const fe=this.container,ve=this.position,_e=fe&&function f$2F(fe){const ve=(fe.ownerDocument||window.document).defaultView,_e=fe.getBoundingClientRect();return jf[0]=_e.left+((null==ve?void 0:ve.pageXOffset)??0),jf[1]=_e.top+((null==ve?void 0:ve.pageYOffset)??0),jf}(fe);return!(!_e||ve&&_e[0]===ve[0]&&_e[1]===ve[1]||(this._set("position",[_e[0],_e[1]]),0))}forceDOMReadyCycle(){}};return e$4o([y$2v()],ve.prototype,"container",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"focused",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"height",void 0),e$4o([y$2v()],ve.prototype,"messagesCommon",void 0),e$4o([y$2v({type:Bf})],ve.prototype,"overlay",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"position",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"resizing",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"root",void 0),e$4o([y$2v({value:null,readOnly:!0})],ve.prototype,"size",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"surface",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"suspended",void 0),e$4o([y$2v()],ve.prototype,"ui",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"userContent",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"width",void 0),e$4o([y$2v()],ve.prototype,"widthBreakpoint",void 0),ve=e$4o([a$4y("esri.views.DOMContainer")],ve),ve};function e$3y(fe,ve,_e,be){return{x:fe,y:ve,z:_e,hasZ:null!=_e,hasM:!1,spatialReference:be,type:"point"}}function n$3Z(fe,ve,_e,be,we){fe.x=ve,fe.y=_e,fe.z=be,fe.hasZ=null!=be,fe.spatialReference=we}function n$3Y(fe,ve,_e,be,we){return!(null==ve||null==be||fe.length<2)&&(Hf.x=fe[0],Hf.y=fe[1],Hf.z=fe[2],Hf.spatialReference=ve,c$4l(Hf,_e,be,we))}const Hf=e$3y(0,0,0,zo.WGS84);function t$3D(fe,ve,_e){return!!n$3Y(fe,ve,qf,_e.spatialReference)&&(_e.x=qf[0],_e.y=qf[1],_e.z=qf[2],!0)}async function c$49(fe,ve,_e,be){return await N$13(ve,_e.spatialReference,null,be),t$3D(fe,ve,_e)}const qf=[0,0,0];var Wf,Yf,Zf,Xf;function o$3r(fe){return"global"===fe?Wf.Global:Wf.Local}function a$3X(fe){return fe===Wf.Global?"global":"local"}(Yf=Wf||(Wf={}))[Yf.Global=1]="Global",Yf[Yf.Local=2]="Local",function(fe){fe[fe.OBJECT=0]="OBJECT",fe[fe.HUD=1]="HUD",fe[fe.TERRAIN=2]="TERRAIN",fe[fe.OVERLAY=3]="OVERLAY",fe[fe.I3S=4]="I3S",fe[fe.PCL=5]="PCL",fe[fe.LOD=6]="LOD",fe[fe.VOXEL=7]="VOXEL",fe[fe.TILES3D=8]="TILES3D"}(Zf||(Zf={}));let Jf=class t8{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Xf.ALL,this.normalRequired=!0}};!function(fe){fe[fe.MIN=0]="MIN",fe[fe.MINMAX=1]="MINMAX",fe[fe.ALL=2]="ALL"}(Xf||(Xf={}));let Qf=class t9{constructor(fe,ve,_e){this.object=fe,this.geometryId=ve,this.triangleNr=_e}},Kf=class r4 extends Qf{constructor(fe,ve,_e,be){super(fe,ve,_e),this.center=null!=be?t$47(be):null}},em=class e4{constructor(fe){this.layerUid=fe}},tm=class o extends em{constructor(fe,ve){super(fe),this.graphicUid=ve}};function o$3p(fe){return null!=(null==fe?void 0:fe.dist)}function c$48(fe){return(ve,_e,be)=>(A$1G(rm,ve,_e,be),!us(fe,rm))}function s$3G(fe){return o$3p(fe)&&fe.intersector===Zf.OBJECT&&!!fe.target}function i$3Y(fe){return o$3p(fe)&&fe.intersector===Zf.HUD&&!!fe.target&&"center"in fe.target&&null!=fe.target.center}const rm=[0,0,0];function n$3X(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[4],fe[4]=ve[5],fe[5]=ve[6],fe[6]=ve[8],fe[7]=ve[9],fe[8]=ve[10],fe}function r$2_(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe[4]=Se,fe[5]=Te,fe[6]=Ee,fe[7]=Ce,fe[8]=Oe,fe}function o$3o(fe){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=1,fe[5]=0,fe[6]=0,fe[7]=0,fe[8]=1,fe}function u$3n(fe,ve){if(fe===ve){const _e=ve[1],be=ve[2],we=ve[5];fe[1]=ve[3],fe[2]=ve[6],fe[3]=_e,fe[5]=ve[7],fe[6]=be,fe[7]=we}else fe[0]=ve[0],fe[1]=ve[3],fe[2]=ve[6],fe[3]=ve[1],fe[4]=ve[4],fe[5]=ve[7],fe[6]=ve[2],fe[7]=ve[5],fe[8]=ve[8];return fe}function s$3F(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5],Ce=ve[6],Oe=ve[7],Re=ve[8],De=Re*Te-Ee*Oe,Be=-Re*Se+Ee*Ce,Ze=Oe*Se-Te*Ce;let Xe=_e*De+be*Be+we*Ze;return Xe?(Xe=1/Xe,fe[0]=De*Xe,fe[1]=(-Re*be+we*Oe)*Xe,fe[2]=(Ee*be-we*Te)*Xe,fe[3]=Be*Xe,fe[4]=(Re*_e-we*Ce)*Xe,fe[5]=(-Ee*_e+we*Se)*Xe,fe[6]=Ze*Xe,fe[7]=(-Oe*_e+be*Ce)*Xe,fe[8]=(Te*_e-be*Se)*Xe,fe):null}function c$47(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5],Ce=ve[6],Oe=ve[7],Re=ve[8];return fe[0]=Te*Re-Ee*Oe,fe[1]=we*Oe-be*Re,fe[2]=be*Ee-we*Te,fe[3]=Ee*Ce-Se*Re,fe[4]=_e*Re-we*Ce,fe[5]=we*Se-_e*Ee,fe[6]=Se*Oe-Te*Ce,fe[7]=be*Ce-_e*Oe,fe[8]=_e*Te-be*Se,fe}function i$3X(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=ve[6],Re=ve[7],De=ve[8],Be=_e[0],Ze=_e[1],Xe=_e[2],Je=_e[3],Qe=_e[4],dt=_e[5],$t=_e[6],bt=_e[7],wt=_e[8];return fe[0]=Be*be+Ze*Te+Xe*Oe,fe[1]=Be*we+Ze*Ee+Xe*Re,fe[2]=Be*Se+Ze*Ce+Xe*De,fe[3]=Je*be+Qe*Te+dt*Oe,fe[4]=Je*we+Qe*Ee+dt*Re,fe[5]=Je*Se+Qe*Ce+dt*De,fe[6]=$t*be+bt*Te+wt*Oe,fe[7]=$t*we+bt*Ee+wt*Re,fe[8]=$t*Se+bt*Ce+wt*De,fe}function M$1f(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=ve[6],Re=ve[7],De=ve[8],Be=_e[0],Ze=_e[1];return fe[0]=be,fe[1]=we,fe[2]=Se,fe[3]=Te,fe[4]=Ee,fe[5]=Ce,fe[6]=Be*be+Ze*Te+Oe,fe[7]=Be*we+Ze*Ee+Re,fe[8]=Be*Se+Ze*Ce+De,fe}function h$2r(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=ve[6],Re=ve[7],De=ve[8],Be=Math.sin(_e),Ze=Math.cos(_e);return fe[0]=Ze*be+Be*Te,fe[1]=Ze*we+Be*Ee,fe[2]=Ze*Se+Be*Ce,fe[3]=Ze*Te-Be*be,fe[4]=Ze*Ee-Be*we,fe[5]=Ze*Ce-Be*Se,fe[6]=Oe,fe[7]=Re,fe[8]=De,fe}function f$2D(fe,ve,_e){const be=_e[0],we=_e[1],Se=_e[2];return fe[0]=be*ve[0],fe[1]=be*ve[1],fe[2]=be*ve[2],fe[3]=we*ve[3],fe[4]=we*ve[4],fe[5]=we*ve[5],fe[6]=Se*ve[6],fe[7]=Se*ve[7],fe[8]=Se*ve[8],fe}function p$4p(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=_e+_e,Ee=be+be,Ce=we+we,Oe=_e*Te,Re=be*Te,De=be*Ee,Be=we*Te,Ze=we*Ee,Xe=we*Ce,Je=Se*Te,Qe=Se*Ee,dt=Se*Ce;return fe[0]=1-De-Xe,fe[3]=Re-dt,fe[6]=Be+Qe,fe[1]=Re+dt,fe[4]=1-Oe-Xe,fe[7]=Ze-Je,fe[2]=Be-Qe,fe[5]=Ze+Je,fe[8]=1-Oe-De,fe}function y$1W(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[4],Te=ve[5],Ee=ve[6],Ce=ve[8],Oe=ve[9],Re=ve[10],De=Re*Te-Ee*Oe,Be=-Re*Se+Ee*Ce,Ze=Oe*Se-Te*Ce,Xe=_e*De+be*Be+we*Ze;if(!Xe)return null;const Je=1/Xe;return fe[0]=De*Je,fe[1]=(-Re*be+we*Oe)*Je,fe[2]=(Ee*be-we*Te)*Je,fe[3]=Be*Je,fe[4]=(Re*_e-we*Ce)*Je,fe[5]=(-Ee*_e+we*Se)*Je,fe[6]=Ze*Je,fe[7]=(-Oe*_e+be*Ce)*Je,fe[8]=(Te*_e-be*Se)*Je,fe}function j$1r(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5],Ce=ve[6],Oe=ve[7],Re=ve[8],De=ve[9],Be=ve[10],Ze=ve[11],Xe=ve[12],Je=ve[13],Qe=ve[14],dt=ve[15],$t=_e*Ee-be*Te,bt=_e*Ce-we*Te,wt=_e*Oe-Se*Te,xt=be*Ce-we*Ee,St=be*Oe-Se*Ee,Et=we*Oe-Se*Ce,Pt=Re*Je-De*Xe,Ot=Re*Qe-Be*Xe,At=Re*dt-Ze*Xe,Mt=De*Qe-Be*Je,Rt=De*dt-Ze*Je,Nt=Be*dt-Ze*Qe;let Ft=$t*Nt-bt*Rt+wt*Mt+xt*At-St*Ot+Et*Pt;return Ft?(Ft=1/Ft,fe[0]=(Ee*Nt-Ce*Rt+Oe*Mt)*Ft,fe[1]=(Ce*At-Te*Nt-Oe*Ot)*Ft,fe[2]=(Te*Rt-Ee*At+Oe*Pt)*Ft,fe[3]=(we*Rt-be*Nt-Se*Mt)*Ft,fe[4]=(_e*Nt-we*At+Se*Ot)*Ft,fe[5]=(be*At-_e*Rt-Se*Pt)*Ft,fe[6]=(Je*Et-Qe*St+dt*xt)*Ft,fe[7]=(Qe*wt-Xe*Et-dt*bt)*Ft,fe[8]=(Xe*St-Je*wt+dt*$t)*Ft,fe):null}function O$1f(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe[3]=ve[3]-_e[3],fe[4]=ve[4]-_e[4],fe[5]=ve[5]-_e[5],fe[6]=ve[6]-_e[6],fe[7]=ve[7]-_e[7],fe[8]=ve[8]-_e[8],fe}const im=i$3X,nm=O$1f;function I$1q(fe,ve,_e){_e*=.5;const be=Math.sin(_e);return fe[0]=be*ve[0],fe[1]=be*ve[1],fe[2]=be*ve[2],fe[3]=Math.cos(_e),fe}function v$1G(fe,ve){const _e=2*Math.acos(ve[3]),be=Math.sin(_e/2);return be>e$3_()?(fe[0]=ve[0]/be,fe[1]=ve[1]/be,fe[2]=ve[2]/be):(fe[0]=1,fe[1]=0,fe[2]=0),_e}function x$1u(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=_e[0],Ce=_e[1],Oe=_e[2],Re=_e[3];return fe[0]=be*Re+Te*Ee+we*Oe-Se*Ce,fe[1]=we*Re+Te*Ce+Se*Ee-be*Oe,fe[2]=Se*Re+Te*Oe+be*Ce-we*Ee,fe[3]=Te*Re-be*Ee-we*Ce-Se*Oe,fe}function z$Y(fe,ve,_e,be){const we=ve[0],Se=ve[1],Te=ve[2],Ee=ve[3];let Ce,Oe,Re,De,Be,Ze=_e[0],Xe=_e[1],Je=_e[2],Qe=_e[3];return Oe=we*Ze+Se*Xe+Te*Je+Ee*Qe,Oe<0&&(Oe=-Oe,Ze=-Ze,Xe=-Xe,Je=-Je,Qe=-Qe),1-Oe>e$3_()?(Ce=Math.acos(Oe),Re=Math.sin(Ce),De=Math.sin((1-be)*Ce)/Re,Be=Math.sin(be*Ce)/Re):(De=1-be,Be=be),fe[0]=De*we+Be*Ze,fe[1]=De*Se+Be*Xe,fe[2]=De*Te+Be*Je,fe[3]=De*Ee+Be*Qe,fe}function L$13(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=_e*_e+be*be+we*we+Se*Se,Ee=Te?1/Te:0;return fe[0]=-_e*Ee,fe[1]=-be*Ee,fe[2]=-we*Ee,fe[3]=Se*Ee,fe}function O$1e(fe,ve){return fe[0]=-ve[0],fe[1]=-ve[1],fe[2]=-ve[2],fe[3]=ve[3],fe}function S$1z(fe,ve){const _e=ve[0]+ve[4]+ve[8];let be;if(_e>0)be=Math.sqrt(_e+1),fe[3]=.5*be,be=.5/be,fe[0]=(ve[5]-ve[7])*be,fe[1]=(ve[6]-ve[2])*be,fe[2]=(ve[1]-ve[3])*be;else{let _e=0;ve[4]>ve[0]&&(_e=1),ve[8]>ve[3*_e+_e]&&(_e=2);const we=(_e+1)%3,Se=(_e+2)%3;be=Math.sqrt(ve[3*_e+_e]-ve[3*we+we]-ve[3*Se+Se]+1),fe[_e]=.5*be,be=.5/be,fe[3]=(ve[3*we+Se]-ve[3*Se+we])*be,fe[we]=(ve[3*we+_e]+ve[3*_e+we])*be,fe[Se]=(ve[3*Se+_e]+ve[3*_e+Se])*be}return fe}function T$19(fe,ve,_e,be){const we=.5*Math.PI/180;ve*=we,_e*=we,be*=we;const Se=Math.sin(ve),Te=Math.cos(ve),Ee=Math.sin(_e),Ce=Math.cos(_e),Oe=Math.sin(be),Re=Math.cos(be);return fe[0]=Se*Ce*Re-Te*Ee*Oe,fe[1]=Te*Ee*Re+Se*Ce*Oe,fe[2]=Te*Ce*Oe-Se*Ee*Re,fe[3]=Te*Ce*Re+Se*Ee*Oe,fe}Object.freeze(Object.defineProperty({__proto__:null,add:function q$R(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe[3]=ve[3]+_e[3],fe[4]=ve[4]+_e[4],fe[5]=ve[5]+_e[5],fe[6]=ve[6]+_e[6],fe[7]=ve[7]+_e[7],fe[8]=ve[8]+_e[8],fe},adjoint:c$47,copy:function a$3W(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe[4]=ve[4],fe[5]=ve[5],fe[6]=ve[6],fe[7]=ve[7],fe[8]=ve[8],fe},determinant:function e$3v(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3],Se=fe[4],Te=fe[5],Ee=fe[6],Ce=fe[7],Oe=fe[8];return ve*(Oe*Se-Te*Ce)+_e*(-Oe*we+Te*Ee)+be*(Ce*we-Se*Ee)},equals:function T$1a(fe,ve){const _e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=fe[4],Ee=fe[5],Ce=fe[6],Oe=fe[7],Re=fe[8],De=ve[0],Be=ve[1],Ze=ve[2],Xe=ve[3],Je=ve[4],Qe=ve[5],dt=ve[6],$t=ve[7],bt=ve[8],wt=e$3_();return Math.abs(_e-De)<=wt*Math.max(1,Math.abs(_e),Math.abs(De))&&Math.abs(be-Be)<=wt*Math.max(1,Math.abs(be),Math.abs(Be))&&Math.abs(we-Ze)<=wt*Math.max(1,Math.abs(we),Math.abs(Ze))&&Math.abs(Se-Xe)<=wt*Math.max(1,Math.abs(Se),Math.abs(Xe))&&Math.abs(Te-Je)<=wt*Math.max(1,Math.abs(Te),Math.abs(Je))&&Math.abs(Ee-Qe)<=wt*Math.max(1,Math.abs(Ee),Math.abs(Qe))&&Math.abs(Ce-dt)<=wt*Math.max(1,Math.abs(Ce),Math.abs(dt))&&Math.abs(Oe-$t)<=wt*Math.max(1,Math.abs(Oe),Math.abs($t))&&Math.abs(Re-bt)<=wt*Math.max(1,Math.abs(Re),Math.abs(bt))},exactEquals:function F$$(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]&&fe[4]===ve[4]&&fe[5]===ve[5]&&fe[6]===ve[6]&&fe[7]===ve[7]&&fe[8]===ve[8]},frob:function _$1g(fe){return Math.sqrt(fe[0]**2+fe[1]**2+fe[2]**2+fe[3]**2+fe[4]**2+fe[5]**2+fe[6]**2+fe[7]**2+fe[8]**2)},fromMat2d:function x$1v(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=0,fe[3]=ve[2],fe[4]=ve[3],fe[5]=0,fe[6]=ve[4],fe[7]=ve[5],fe[8]=1,fe},fromMat4:n$3X,fromQuat:p$4p,fromRotation:function m$39(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=be,fe[1]=_e,fe[2]=0,fe[3]=-_e,fe[4]=be,fe[5]=0,fe[6]=0,fe[7]=0,fe[8]=1,fe},fromScaling:function d$2T(fe,ve){return fe[0]=ve[0],fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=ve[1],fe[5]=0,fe[6]=0,fe[7]=0,fe[8]=1,fe},fromTranslation:function l$3P(fe,ve){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=1,fe[5]=0,fe[6]=ve[0],fe[7]=ve[1],fe[8]=1,fe},identity:o$3o,invert:s$3F,isOrthoNormal:function z$Z(fe){const ve=e$3_(),_e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=fe[4],Ee=fe[5],Ce=fe[6],Oe=fe[7],Re=fe[8];return Math.abs(1-(_e*_e+Se*Se+Ce*Ce))<=ve&&Math.abs(1-(be*be+Te*Te+Oe*Oe))<=ve&&Math.abs(1-(we*we+Ee*Ee+Re*Re))<=ve},mul:im,multiply:i$3X,multiplyScalar:function v$1H(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe[3]=ve[3]*_e,fe[4]=ve[4]*_e,fe[5]=ve[5]*_e,fe[6]=ve[6]*_e,fe[7]=ve[7]*_e,fe[8]=ve[8]*_e,fe},multiplyScalarAndAdd:function A$1p(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe[3]=ve[3]+_e[3]*be,fe[4]=ve[4]+_e[4]*be,fe[5]=ve[5]+_e[5]*be,fe[6]=ve[6]+_e[6]*be,fe[7]=ve[7]+_e[7]*be,fe[8]=ve[8]+_e[8]*be,fe},normalFromMat4:j$1r,normalFromMat4Legacy:y$1W,projection:function S$1A(fe,ve,_e){return fe[0]=2/ve,fe[1]=0,fe[2]=0,fe[3]=0,fe[4]=-2/_e,fe[5]=0,fe[6]=-1,fe[7]=1,fe[8]=1,fe},rotate:h$2r,scale:f$2D,scaleByVec2:function b$1T(fe,ve,_e){const be=_e[0],we=_e[1];return fe[0]=be*ve[0],fe[1]=be*ve[1],fe[2]=be*ve[2],fe[3]=we*ve[3],fe[4]=we*ve[4],fe[5]=we*ve[5],fe},set:r$2_,str:function g$24(fe){return"mat3("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+", "+fe[4]+", "+fe[5]+", "+fe[6]+", "+fe[7]+", "+fe[8]+")"},sub:nm,subtract:O$1f,translate:M$1f,transpose:u$3n},Symbol.toStringTag,{value:"Module"}));const sm=a$42,om=s$3I,am=o$3x,lm=x$1u,cm=m$3i,um=j$1z,hm=_$1l,dm=q$W,pm=dm,fm=p$4x,mm=fm,ym=y$22,gm=E$1A,vm=L$17;function R$18(fe,ve,_e){const be=P$1g(ve,_e);return be<-.999999?(_$1z(_m,$m,ve),dn(_m)<1e-6&&_$1z(_m,bm,ve),z$1d(_m,_m),I$1q(fe,_m,Math.PI),fe):be>.999999?(fe[0]=0,fe[1]=0,fe[2]=0,fe[3]=1,fe):(_$1z(_m,ve,_e),fe[0]=_m[0],fe[1]=_m[1],fe[2]=_m[2],fe[3]=1+be,ym(fe,fe))}const _m=[0,0,0],$m=r$3y(1,0,0),bm=r$3y(0,1,0);const wm=[0,0,0,1],xm=[0,0,0,1];const Sm=[1,0,0,0,1,0,0,0,1];function n$3W(fe,ve,_e){const be=Math.sin(fe),we=Math.cos(fe),Se=Math.sin(ve),Te=Math.cos(ve),Ee=_e;return Ee[0]=-be,Ee[4]=-Se*we,Ee[8]=Te*we,Ee[12]=0,Ee[1]=we,Ee[5]=-Se*be,Ee[9]=Te*be,Ee[13]=0,Ee[2]=0,Ee[6]=Te,Ee[10]=Se,Ee[14]=0,Ee[3]=0,Ee[7]=0,Ee[11]=0,Ee[15]=1,Ee}function u$3m(fe,ve,_e,be){if(null==fe||null==be)return!1;const we=F$15(fe,Dh),Se=F$15(be,Nh);if(we===Se&&!c$46(Se)&&(we!==Ih.UNKNOWN||G$Y(fe,be)))return q$X(_e,ve),!0;if(c$46(Se)){const fe=Lh[we][Ih.LON_LAT],be=Lh[Ih.LON_LAT][Se];return null!=fe&&null!=be&&(fe(ve,0,Em,0),be(Em,0,Pm,0),n$3W(Tm*Em[0],Tm*Em[1],_e),_e[12]=Pm[0],_e[13]=Pm[1],_e[14]=Pm[2],!0)}if(!(Se!==Ih.WEB_MERCATOR&&Se!==Ih.PLATE_CARREE&&Se!==Ih.WGS84&&Se!==Ih.CGCS2000||we!==Ih.WGS84&&we!==Ih.SPHERICAL_ECEF&&we!==Ih.WEB_MERCATOR&&we!==Ih.CGCS2000)){const fe=Lh[we][Ih.LON_LAT],be=Lh[Ih.LON_LAT][Se];return null!=fe&&null!=be&&(fe(ve,0,Em,0),be(Em,0,Pm,0),we===Ih.SPHERICAL_ECEF?function o$3n(fe,ve,_e){return n$3W(fe,ve,_e),s$3L(_e,_e),_e}(Tm*Em[0],Tm*Em[1],_e):o$3E(_e),_e[12]=Pm[0],_e[13]=Pm[1],_e[14]=Pm[2],!0)}return!1}function c$46(fe){return fe===Ih.SPHERICAL_ECEF||fe===Ih.SPHERICAL_MARS_PCPF||fe===Ih.SPHERICAL_MOON_PCPF}Object.freeze(Object.defineProperty({__proto__:null,add:am,calculateW:function k$1f(fe,ve){const _e=ve[0],be=ve[1],we=ve[2];return fe[0]=_e,fe[1]=be,fe[2]=we,fe[3]=Math.sqrt(Math.abs(1-_e*_e-be*be-we*we)),fe},conjugate:O$1e,copy:sm,dot:um,equals:vm,exactEquals:gm,fromEuler:T$19,fromMat3:S$1z,getAxisAngle:v$1G,identity:function b$1S(fe){return fe[0]=0,fe[1]=0,fe[2]=0,fe[3]=1,fe},invert:L$13,len:pm,length:dm,lerp:hm,mul:lm,multiply:x$1u,normalize:ym,random:function E$1v(fe){const ve=Yi,_e=ve(),be=ve(),we=ve(),Se=Math.sqrt(1-_e),Te=Math.sqrt(_e);return fe[0]=Se*Math.sin(2*Math.PI*be),fe[1]=Se*Math.cos(2*Math.PI*be),fe[2]=Te*Math.sin(2*Math.PI*we),fe[3]=Te*Math.cos(2*Math.PI*we),fe},rotateX:function y$1V(fe,ve,_e){_e*=.5;const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=Math.sin(_e),Ce=Math.cos(_e);return fe[0]=be*Ce+Te*Ee,fe[1]=we*Ce+Se*Ee,fe[2]=Se*Ce-we*Ee,fe[3]=Te*Ce-be*Ee,fe},rotateY:function A$1o(fe,ve,_e){_e*=.5;const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=Math.sin(_e),Ce=Math.cos(_e);return fe[0]=be*Ce-Se*Ee,fe[1]=we*Ce+Te*Ee,fe[2]=Se*Ce+be*Ee,fe[3]=Te*Ce-we*Ee,fe},rotateZ:function _$1f(fe,ve,_e){_e*=.5;const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=Math.sin(_e),Ce=Math.cos(_e);return fe[0]=be*Ce+we*Ee,fe[1]=we*Ce-be*Ee,fe[2]=Se*Ce+Te*Ee,fe[3]=Te*Ce-Se*Ee,fe},rotationTo:R$18,scale:cm,set:om,setAxes:function ot$g(fe,ve,_e,be){const we=Sm;return we[0]=_e[0],we[3]=_e[1],we[6]=_e[2],we[1]=be[0],we[4]=be[1],we[7]=be[2],we[2]=-ve[0],we[5]=-ve[1],we[8]=-ve[2],ym(fe,S$1z(fe,we))},setAxisAngle:I$1q,slerp:z$Y,sqlerp:function tt$h(fe,ve,_e,be,we,Se){return z$Y(wm,ve,we,Se),z$Y(xm,_e,be,Se),z$Y(fe,wm,xm,2*Se*(1-Se)),fe},sqrLen:mm,squaredLength:fm,str:function H$Y(fe){return"quat("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+")"}},Symbol.toStringTag,{value:"Module"}));const Tm=h$2U(1),Em=[0,0,0],Pm=[0,0,0];let Cm=class s13{constructor(fe,ve,_e=ve){this.data=fe,this.size=ve,this.stride=_e}},Om=class t10 extends Cm{constructor(fe,ve,_e,be=!1,we=_e){super(fe,_e,we),this.indices=ve,this.exclusive=be}};const Am=1e-6,Mm=[0,0,0],Rm=[0,0,0];function u$3l(fe,ve){const{data:_e,size:be}=fe,we=_e.length/be;if(we<=0)return;const Se=new ay(fe);it$f(Mm,Se.minProj,Se.maxProj),st$h(Mm,Mm,.5),ot$f(Rm,Se.maxProj,Se.minProj);const Te=nt$e(Rm),Ee=new ly;Ee.quality=Te,we<14&&(fe=new Cm(new Float64Array(Se.buffer,112,42),3));const Ce=[0,0,0],Oe=[0,0,0],Re=[0,0,0],De=[0,0,0],Be=[0,0,0],Ze=[0,0,0],Xe=[0,0,0];switch(function l$3O(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){return function A$1m(fe,ve,_e){let be=ft$a(fe.maxVert[0],fe.minVert[0]),we=0;for(let Se=1;Se<7;++Se){const ve=ft$a(fe.maxVert[Se],fe.minVert[Se]);ve>be&&(be=ve,we=Se)}et$e(ve,fe.minVert[we]),et$e(_e,fe.maxVert[we])}(fe,be,we),ft$a(be,we)<Am?1:(ot$f(Te,be,we),ct$c(Te,Te),function q$Q(fe,ve,_e,be){const{data:we,size:Se}=fe;let Te=Number.NEGATIVE_INFINITY,Ee=0;for(let Ce=0;Ce<we.length;Ce+=Se){Vm[0]=we[Ce]-ve[0],Vm[1]=we[Ce+1]-ve[1],Vm[2]=we[Ce+2]-ve[2];const fe=_e[0]*Vm[0]+_e[1]*Vm[1]+_e[2]*Vm[2],be=_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2],Se=Vm[0]*Vm[0]+Vm[1]*Vm[1]+Vm[2]*Vm[2]-fe*fe/be;Se>Te&&(Te=Se,Ee=Ce)}return et$e(be,we,Ee),Te}(ve,be,Te,Se)<Am?2:(ot$f(Ee,we,Se),ct$c(Ee,Ee),ot$f(Ce,Se,be),ct$c(Ce,Ce),at$f(_e,Ee,Te),ct$c(_e,_e),Y$v(ve,_e,Te,Ee,Ce,Oe),0))}(Se,fe,Xe,Ce,Oe,Re,De,Be,Ze,Ee)){case 1:return void O$1d(Mm,Rm,ve);case 2:return void function K$x(fe,ve,_e){et$e(Xm,ve),Math.abs(ve[0])>Math.abs(ve[1])&&Math.abs(ve[0])>Math.abs(ve[2])?Xm[0]=0:Math.abs(ve[1])>Math.abs(ve[2])?Xm[1]=0:Xm[2]=0,mt$9(Xm)<Am&&(Xm[0]=Xm[1]=Xm[2]=1),at$f(Jm,ve,Xm),ct$c(Jm,Jm),at$f(Qm,ve,Jm),ct$c(Qm,Qm),L$11(fe,ve,Jm,Qm,Km,ey),ot$f(ty,ey,Km),Z$w(ve,Jm,Qm,Km,ey,ty,_e)}(fe,De,ve)}(function w$1B(fe,ve,_e,be,we,Se,Te,Ee,Ce){(function M$1e(fe,ve,_e,be,we){!function G$J(fe,ve,_e,be,we){const{data:Se,size:Te}=fe;et$e(be,Se),et$e(we,be),_e[0]=ht$c(Zm,ve),_e[1]=_e[0];for(let Ee=Te;Ee<Se.length;Ee+=Te){const fe=Se[Ee]*ve[0]+Se[Ee+1]*ve[1]+Se[Ee+2]*ve[2];fe<_e[0]&&(_e[0]=fe,et$e(be,Se,Ee)),fe>_e[1]&&(_e[1]=fe,et$e(we,Se,Ee))}}(fe,ve,Bm,we,be);const Se=ht$c(_e,ve);Bm[1]-Am<=Se&&(be[0]=void 0),Bm[0]+Am>=Se&&(we[0]=void 0)})(fe,ve,_e,Im,Lm),void 0!==Im[0]&&(ot$f(Dm,Im,_e),ct$c(Dm,Dm),ot$f(Nm,Im,be),ct$c(Nm,Nm),ot$f(Fm,Im,we),ct$c(Fm,Fm),at$f(zm,Nm,Se),ct$c(zm,zm),at$f(km,Fm,Te),ct$c(km,km),at$f(Um,Dm,Ee),ct$c(Um,Um),Y$v(fe,zm,Se,Nm,Dm,Ce),Y$v(fe,km,Te,Fm,Nm,Ce),Y$v(fe,Um,Ee,Dm,Fm,Ce)),void 0!==Lm[0]&&(ot$f(Dm,Lm,_e),ct$c(Dm,Dm),ot$f(Nm,Lm,be),ct$c(Nm,Nm),ot$f(Fm,Lm,we),ct$c(Fm,Fm),at$f(zm,Nm,Se),ct$c(zm,zm),at$f(km,Fm,Te),ct$c(km,km),at$f(Um,Dm,Ee),ct$c(Um,Um),Y$v(fe,zm,Se,Nm,Dm,Ce),Y$v(fe,km,Te,Fm,Nm,Ce),Y$v(fe,Um,Ee,Dm,Fm,Ce))})(fe,Xe,Ce,Oe,Re,De,Be,Ze,Ee),L$11(fe,Ee.b0,Ee.b1,Ee.b2,Km,ey);const Je=[0,0,0];ot$f(Je,ey,Km),Ee.quality=nt$e(Je),Ee.quality<Te?Z$w(Ee.b0,Ee.b1,Ee.b2,Km,ey,Je,ve):O$1d(Mm,Rm,ve)}const Im=[0,0,0],Lm=[0,0,0],Dm=[0,0,0],Nm=[0,0,0],Fm=[0,0,0],zm=[0,0,0],km=[0,0,0],Um=[0,0,0];const Vm=[0,0,0];const Bm=[0,0];const jm=[0,0,0],Gm=[0,0,0],Hm=[0,0,0],qm=[0,0,0],Wm=[0,0,0],Ym=[0,0,0];function Y$v(fe,ve,_e,be,we,Se){if(mt$9(ve)<Am)return;at$f(jm,_e,ve),at$f(Gm,be,ve),at$f(Hm,we,ve),S$1y(fe,ve,Bm),Wm[1]=Bm[0],qm[1]=Bm[1],Ym[1]=qm[1]-Wm[1];const Te=[_e,be,we],Ee=[jm,Gm,Hm];for(let Ce=0;Ce<3;++Ce){S$1y(fe,Te[Ce],Bm),Wm[0]=Bm[0],qm[0]=Bm[1],S$1y(fe,Ee[Ce],Bm),Wm[2]=Bm[0],qm[2]=Bm[1],Ym[0]=qm[0]-Wm[0],Ym[2]=qm[2]-Wm[2];const _e=nt$e(Ym);_e<Se.quality&&(et$e(Se.b0,Te[Ce]),et$e(Se.b1,ve),et$e(Se.b2,Ee[Ce]),Se.quality=_e)}}const Zm=[0,0,0];function S$1y(fe,ve,_e){const{data:be,size:we}=fe;_e[0]=Number.POSITIVE_INFINITY,_e[1]=Number.NEGATIVE_INFINITY;for(let Se=0;Se<be.length;Se+=we){const fe=be[Se]*ve[0]+be[Se+1]*ve[1]+be[Se+2]*ve[2];_e[0]=Math.min(_e[0],fe),_e[1]=Math.max(_e[1],fe)}}function O$1d(fe,ve,_e){_e.center=fe,_e.halfSize=g$2z(ve,ve,.5),_e.quaternion=fd}const Xm=[0,0,0],Jm=[0,0,0],Qm=[0,0,0],Km=[0,0,0],ey=[0,0,0],ty=[0,0,0];function L$11(fe,ve,_e,be,we,Se){S$1y(fe,ve,Bm),we[0]=Bm[0],Se[0]=Bm[1],S$1y(fe,_e,Bm),we[1]=Bm[0],Se[1]=Bm[1],S$1y(fe,be,Bm),we[2]=Bm[0],Se[2]=Bm[1]}const ry=[0,0,0],iy=[0,0,0],ny=[0,0,0],sy=t$3M(1,0,0,0,1,0,0,0,1),oy=[0,0,0,1];function Z$w(fe,ve,_e,be,we,Se,Te){sy[0]=fe[0],sy[1]=fe[1],sy[2]=fe[2],sy[3]=ve[0],sy[4]=ve[1],sy[5]=ve[2],sy[6]=_e[0],sy[7]=_e[1],sy[8]=_e[2],Te.quaternion=function ut$c(fe,ve){const _e=ve[0]+ve[4]+ve[8];if(_e>0){let be=Math.sqrt(_e+1);fe[3]=.5*be,be=.5/be,fe[0]=(ve[5]-ve[7])*be,fe[1]=(ve[6]-ve[2])*be,fe[2]=(ve[1]-ve[3])*be}else{let _e=0;ve[4]>ve[0]&&(_e=1),ve[8]>ve[3*_e+_e]&&(_e=2);const be=(_e+1)%3,we=(_e+2)%3;let Se=Math.sqrt(ve[3*_e+_e]-ve[3*be+be]-ve[3*we+we]+1);fe[_e]=.5*Se,Se=.5/Se,fe[3]=(ve[3*be+we]-ve[3*we+be])*Se,fe[be]=(ve[3*be+_e]+ve[3*_e+be])*Se,fe[we]=(ve[3*we+_e]+ve[3*_e+we])*Se}return fe}(oy,sy),it$f(ry,be,we),st$h(ry,ry,.5),st$h(iy,fe,ry[0]),st$h(ny,ve,ry[1]),it$f(iy,iy,ny),st$h(ny,_e,ry[2]),Te.center=u$3Y(iy,iy,ny),Te.halfSize=g$2z(ry,Se,.5)}let ay=class tt{constructor(fe){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let ve=0;this.minProj=new Float64Array(this.buffer,ve,7),ve+=56,this.maxProj=new Float64Array(this.buffer,ve,7),ve+=56;for(let Te=0;Te<7;++Te)this.minVert[Te]=new Float64Array(this.buffer,ve,3),ve+=24;for(let Te=0;Te<7;++Te)this.maxVert[Te]=new Float64Array(this.buffer,ve,3),ve+=24;for(let Te=0;Te<7;++Te)this.minProj[Te]=Number.POSITIVE_INFINITY,this.maxProj[Te]=Number.NEGATIVE_INFINITY;const _e=new Array(7),be=new Array(7),{data:we,size:Se}=fe;for(let Te=0;Te<we.length;Te+=Se){let fe=we[Te];fe<this.minProj[0]&&(this.minProj[0]=fe,_e[0]=Te),fe>this.maxProj[0]&&(this.maxProj[0]=fe,be[0]=Te),fe=we[Te+1],fe<this.minProj[1]&&(this.minProj[1]=fe,_e[1]=Te),fe>this.maxProj[1]&&(this.maxProj[1]=fe,be[1]=Te),fe=we[Te+2],fe<this.minProj[2]&&(this.minProj[2]=fe,_e[2]=Te),fe>this.maxProj[2]&&(this.maxProj[2]=fe,be[2]=Te),fe=we[Te]+we[Te+1]+we[Te+2],fe<this.minProj[3]&&(this.minProj[3]=fe,_e[3]=Te),fe>this.maxProj[3]&&(this.maxProj[3]=fe,be[3]=Te),fe=we[Te]+we[Te+1]-we[Te+2],fe<this.minProj[4]&&(this.minProj[4]=fe,_e[4]=Te),fe>this.maxProj[4]&&(this.maxProj[4]=fe,be[4]=Te),fe=we[Te]-we[Te+1]+we[Te+2],fe<this.minProj[5]&&(this.minProj[5]=fe,_e[5]=Te),fe>this.maxProj[5]&&(this.maxProj[5]=fe,be[5]=Te),fe=we[Te]-we[Te+1]-we[Te+2],fe<this.minProj[6]&&(this.minProj[6]=fe,_e[6]=Te),fe>this.maxProj[6]&&(this.maxProj[6]=fe,be[6]=Te)}for(let Te=0;Te<7;++Te){let fe=_e[Te];et$e(this.minVert[Te],we,fe),fe=be[Te],et$e(this.maxVert[Te],we,fe)}}},ly=class rt{constructor(){this.b0=r$3y(1,0,0),this.b1=r$3y(0,1,0),this.b2=r$3y(0,0,1),this.quality=0}};function nt$e(fe){return fe[0]*fe[1]+fe[0]*fe[2]+fe[1]*fe[2]}function it$f(fe,ve,_e){fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2]}function ot$f(fe,ve,_e){fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2]}function st$h(fe,ve,_e){fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e}function et$e(fe,ve,_e=0){fe[0]=ve[_e],fe[1]=ve[_e+1],fe[2]=ve[_e+2]}function at$f(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=_e[0],Ee=_e[1],Ce=_e[2];fe[0]=we*Ce-Se*Ee,fe[1]=Se*Te-be*Ce,fe[2]=be*Ee-we*Te}function ct$c(fe,ve){const _e=ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2];if(_e>0){const be=1/Math.sqrt(_e);fe[0]=ve[0]*be,fe[1]=ve[1]*be,fe[2]=ve[2]*be}}function mt$9(fe){return fe[0]*fe[0]+fe[1]*fe[1]+fe[2]*fe[2]}function ft$a(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1],we=ve[2]-fe[2];return _e*_e+be*be+we*we}function ht$c(fe,ve){return fe[0]*ve[0]+fe[1]*ve[1]+fe[2]*ve[2]}let cy=class I{constructor(fe=Bi,ve=Ay,_e=fd){this._data=[fe[0],fe[1],fe[2],ve[0],ve[1],ve[2],_e[0],_e[1],_e[2],_e[3]]}clone(){const fe=new I;return fe._data=this._data.slice(),fe}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(fe){const ve=new I;return ve._data=fe.slice(),ve}static fromJSON(fe){return new I(fe.center,fe.halfSize,fe.quaternion)}copy(fe){this._data=fe.data.slice()}get center(){return o$44(Pd.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(fe){return fe[0]=this._data[0],fe[1]=this._data[1],fe[2]=this._data[2],fe}set center(fe){this._data[0]=fe[0],this._data[1]=fe[1],this._data[2]=fe[2]}setCenter(fe,ve,_e){this._data[0]=fe,this._data[1]=ve,this._data[2]=_e}get halfSize(){return o$44(Pd.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(fe){return fe[0]=this._data[3],fe[1]=this._data[4],fe[2]=this._data[5],fe}set halfSize(fe){this._data[3]=fe[0],this._data[4]=fe[1],this._data[5]=fe[2]}get quaternion(){return om(Ad.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(fe){return fe[0]=this._data[6],fe[1]=this._data[7],fe[2]=this._data[8],fe[3]=this._data[9],fe}set quaternion(fe){this._data[6]=fe[0],this._data[7]=fe[1],this._data[8]=fe[2],this._data[9]=fe[3]}get data(){return this._data}getCorners(fe){const ve=uy,_e=this._data;ve[0]=_e[6],ve[1]=_e[7],ve[2]=_e[8],ve[3]=_e[9];for(let be=0;be<8;++be){const we=fe[be];we[0]=(1&be?-1:1)*_e[3],we[1]=(2&be?-1:1)*_e[4],we[2]=(4&be?-1:1)*_e[5],E$1O(we,we,ve),we[0]+=_e[0],we[1]+=_e[1],we[2]+=_e[2]}}doesIntersectFrustumConservativeApproximation(fe){return this.intersectPlane(fe[0])<=0&&this.intersectPlane(fe[1])<=0&&this.intersectPlane(fe[2])<=0&&this.intersectPlane(fe[3])<=0&&this.intersectPlane(fe[4])<=0&&this.intersectPlane(fe[5])<=0}get radius(){const fe=this._data[3],ve=this._data[4],_e=this._data[5];return Math.sqrt(fe*fe+ve*ve+_e*_e)}intersectSphere(fe){py[0]=this._data[0]-fe[0],py[1]=this._data[1]-fe[1],py[2]=this._data[2]-fe[2];const ve=this.getQuaternion(hy);return O$1e(uy,ve),E$1O(py,py,uy),f$3j(py,py),fy[0]=Math.min(py[0],this._data[3]),fy[1]=Math.min(py[1],this._data[4]),fy[2]=Math.min(py[2],this._data[5]),hn(fy,py)<fe[3]*fe[3]}intersectSphereWithMBS(fe,ve=this.radius){const _e=this._data;py[0]=_e[0]-fe[0],py[1]=_e[1]-fe[1],py[2]=_e[2]-fe[2];const be=fe[3],we=be+ve;return!(pn(py)>we*we)&&(uy[0]=-_e[6],uy[1]=-_e[7],uy[2]=-_e[8],uy[3]=_e[9],E$1O(py,py,uy),f$3j(py,py),fy[0]=Math.min(py[0],_e[3]),fy[1]=Math.min(py[1],_e[4]),fy[2]=Math.min(py[2],_e[5]),hn(fy,py)<be*be)}intersectPlane(fe){const ve=fe[0]*this._data[0]+fe[1]*this._data[1]+fe[2]*this._data[2]+fe[3],_e=this.projectedRadius(fe);return ve>_e?1:ve<-_e?-1:0}intersectRay(fe,ve,_e=0){const be=this._data,we=uy;we[0]=-be[6],we[1]=-be[7],we[2]=-be[8],we[3]=be[9],py[0]=fe[0]-be[0],py[1]=fe[1]-be[1],py[2]=fe[2]-be[2];const Se=E$1O(py,py,uy),Te=E$1O(fy,ve,uy);let Ee=-1/0,Ce=1/0;const Oe=this.getHalfSize(xy);for(let Re=0;Re<3;Re++){const fe=Se[Re],ve=Te[Re],be=Oe[Re]+_e;if(Math.abs(ve)>1e-6){const _e=(be-fe)/ve,we=(-be-fe)/ve;Ee=Math.max(Ee,Math.min(_e,we)),Ce=Math.min(Ce,Math.max(_e,we))}else if(fe>be||fe<-be)return!1}return Ee<=Ce}projectedArea(fe,ve,_e,be){const we=this.getQuaternion(hy);O$1e(uy,we),py[0]=fe[0]-this._data[0],py[1]=fe[1]-this._data[1],py[2]=fe[2]-this._data[2],E$1O(py,py,uy);const Se=this.getHalfSize(xy),Te=py[0]<-Se[0]?-1:py[0]>Se[0]?1:0,Ee=py[1]<-Se[1]?-1:py[1]>Se[1]?1:0,Ce=py[2]<-Se[2]?-1:py[2]>Se[2]?1:0,Oe=Math.abs(Te)+Math.abs(Ee)+Math.abs(Ce);if(0===Oe)return 1/0;const Re=1===Oe?4:6,De=6*(Te+3*Ee+9*Ce+13);p$4p(Sy,we),f$2D(Sy,Sy,Se);const Be=this.getCenter(by);for(let Je=0;Je<Re;Je++){const fe=gy[De+Je];o$44(py,((1&fe)<<1)-1,(2&fe)-1,((4&fe)>>1)-1),S$1P(py,py,Sy),u$3Y(my,Be,py),my[3]=1,z$13(my,my,ve);const _e=1/Math.max(1e-6,my[3]);yy[2*Je]=my[0]*_e,yy[2*Je+1]=my[1]*_e}const Ze=2*Re-2;let Xe=yy[0]*(yy[3]-yy[Ze+1])+yy[Ze]*(yy[1]-yy[Ze-1]);for(let Je=2;Je<Ze;Je+=2)Xe+=yy[Je]*(yy[Je+3]-yy[Je-1]);return Math.abs(Xe)*_e*be*.125}projectedRadius(fe){const ve=this.getQuaternion(hy);return O$1e(uy,ve),E$1O(py,fe,uy),Math.abs(py[0]*this._data[3])+Math.abs(py[1]*this._data[4])+Math.abs(py[2]*this._data[5])}minimumDistancePlane(fe){return fe[0]*this._data[0]+fe[1]*this._data[1]+fe[2]*this._data[2]+fe[3]-this.projectedRadius(fe)}maximumDistancePlane(fe){return fe[0]*this._data[0]+fe[1]*this._data[1]+fe[2]*this._data[2]+fe[3]+this.projectedRadius(fe)}toAaBoundingBox(fe){const ve=this.getQuaternion(hy),_e=p$4p(Sy,ve),be=this._data[3]*Math.abs(_e[0])+this._data[4]*Math.abs(_e[3])+this._data[5]*Math.abs(_e[6]),we=this._data[3]*Math.abs(_e[1])+this._data[4]*Math.abs(_e[4])+this._data[5]*Math.abs(_e[7]),Se=this._data[3]*Math.abs(_e[2])+this._data[4]*Math.abs(_e[5])+this._data[5]*Math.abs(_e[8]);fe[0]=this._data[0]-be,fe[1]=this._data[1]-we,fe[2]=this._data[2]-Se,fe[3]=this._data[0]+be,fe[4]=this._data[1]+we,fe[5]=this._data[2]+Se}transform(fe,ve,_e,be=0,we=a$40(_e),Se=a$40(ve),Te=G$S(ve,Se)){if(_e===we)ve.isGeographic?function st$g(fe,ve,_e,be,we=a$40(_e)){const Se=s$45(_e),Te=1+Math.max(0,be)/(Se.radius+fe.centerZ);fe.getCenter($y),$y[2]+=be,n$49($y,_e,0,$y,we,0,1),ve.center=$y;const Ee=fe.getQuaternion(hy);ve.quaternion=Ee,O$1e(uy,Ee),o$44(Py,0,0,1),E$1O(Py,Py,uy);const Ce=fe.getHalfSize(xy);o$44(Py,Ce[0]*Math.abs(Py[0]),Ce[1]*Math.abs(Py[1]),Ce[2]*Math.abs(Py[2])),g$2z(Py,Py,Se.inverseFlattening),u$3Y(Py,Ce,Py),ve.halfSize=g$2z(Py,Py,Te)}(this,fe,ve,be,Se):function et$d(fe,ve,_e,be,we=a$40(_e),Se=G$S(_e,we)){fe.getCorners(Ey),fe.getCenter($y),$y[2]+=be,u$3m(_e,$y,Ty,we),ve.setCenter(Ty[12],Ty[13],Ty[14]);const Te=2*Math.sqrt(1+Ty[0]+Ty[5]+Ty[10]);uy[0]=(Ty[6]-Ty[9])/Te,uy[1]=(Ty[8]-Ty[2])/Te,uy[2]=(Ty[1]-Ty[4])/Te,uy[3]=.25*Te;const Ee=fe.getQuaternion(hy);ve.quaternion=x$1u(uy,uy,Ee),O$1e(uy,uy),o$44(Cy,0,0,0);const Ce=ve.getCenter(wy);for(const Oe of Ey)Oe[2]+=be,Se(Oe,0,Oe,0),Ki(Py,Oe,Ce),E$1O(Py,Py,uy),f$3j(Py,Py),b$2c(Cy,Cy,Py);ve.halfSize=Cy}(this,fe,ve,be,Se,Te);else if(ve.isWGS84&&(_e.isWebMercator||O$1s(_e)))!function $$x(fe,ve,_e,be,we){ve.getCenter(by),by[2]+=we;const Se=a$40(_e);n$49(by,fe,0,by,Se,0,1),at$e(Se,ve,by,_e,be)}(ve,this,_e,fe,be);else if(ve.isWebMercator&&O$1s(_e))!function tt$f(fe,ve,_e,be,we){ve.getCenter(by),by[2]+=we,at$e(fe,ve,by,_e,be)}(ve,this,_e,fe,be);else{const we=this.getCenter(by);we[2]+=be,n$49(we,ve,0,we,_e,0,1),fe.center=we,this!==fe&&(fe.quaternion=this.getQuaternion(hy),fe.halfSize=this.getHalfSize(xy))}}};const uy=[0,0,0,1],hy=[0,0,0,1],dy=[0,0,0,1],py=[0,0,0],fy=[0,0,0],my=[0,0,0,0];function J$z(fe,ve=new cy){return u$3l(fe,ve),ve}const yy=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],gy=(()=>{const fe=new Int8Array(162);let ve=0;const e76=_e=>{for(let be=0;be<_e.length;be++)fe[ve+be]=_e[be];ve+=6};return e76([6,2,3,1,5,4]),e76([0,2,3,1,5,4]),e76([0,2,3,7,5,4]),e76([0,1,3,2,6,4]),e76([0,1,3,2,0,0]),e76([0,1,5,7,3,2]),e76([0,1,3,7,6,4]),e76([0,1,3,7,6,2]),e76([0,1,5,7,6,2]),e76([0,1,5,4,6,2]),e76([0,1,5,4,0,0]),e76([0,1,3,7,5,4]),e76([0,2,6,4,0,0]),e76([0,0,0,0,0,0]),e76([1,3,7,5,0,0]),e76([2,3,7,6,4,0]),e76([2,3,7,6,0,0]),e76([2,3,1,5,7,6]),e76([0,1,5,7,6,2]),e76([0,1,5,7,6,4]),e76([0,1,3,7,6,4]),e76([4,5,7,6,2,0]),e76([4,5,7,6,0,0]),e76([4,5,1,3,7,6]),e76([0,2,3,7,5,4]),e76([6,2,3,7,5,4]),e76([6,2,3,1,5,4]),fe})();function L$10(fe,ve,_e,be,we){const Se=fe.getQuaternion(hy);we.quaternion=Se,O$1e(uy,Se);const Te=fe.getCenter(by),Ee=fe.getHalfSize(xy);if(be===Wf.Global){E$1O(Py,Te,uy),f$3j(Cy,Py),m$3K(Oy,Cy,Ee),Ki(Oy,Cy,Oy);const be=s$4g(Oy);u$3Y(Oy,Cy,Ee);const Se=s$4g(Oy);if(be<_e)we.center=Te,o$44(Py,_e,_e,_e),we.halfSize=u$3Y(Py,Ee,Py);else{const Te=Se>0?1+ve/Se:1,Ce=be>0?1+_e/be:1,Oe=(Ce+Te)/2,Re=(Ce-Te)/2;g$2z(Oy,Cy,Re),we.halfSize=q$11(Oy,Oy,Ee,Oe),g$2z(Oy,Cy,Oe),q$11(Oy,Oy,Ee,Re),l$4o(Py,Py),c$4P(Py,Oy,Py);const De=fe.getQuaternion(dy);we.center=E$1O(Py,Py,De)}}else{we.center=q$11(Py,Te,qi,(_e+ve)/2);const fe=E$1O(Py,qi,uy);f$3j(fe,fe),we.halfSize=q$11(Cy,Ee,fe,(_e-ve)/2)}return we}function at$e(fe,ve,_e,be,we){const Se=ve.getQuaternion(hy),Te=p$4p(Sy,Se),Ee=ve.getHalfSize(xy);for(let Ce=0;Ce<8;++Ce){for(let fe=0;fe<3;++fe)$y[fe]=Ee[fe]*(Ce&1<<fe?-1:1);for(let fe=0;fe<3;++fe){let ve=_e[fe];for(let _e=0;_e<3;++_e)ve+=$y[_e]*Te[3*_e+fe];vy[3*Ce+fe]=ve}}n$49(vy,fe,0,vy,be,0,8),J$z(_y,we)}const vy=new Array(24),_y=new Cm(vy,3),$y=[0,0,0],by=[0,0,0],wy=[0,0,0],xy=[0,0,0],Sy=[1,0,0,0,1,0,0,0,1],Ty=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ey=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Py=[0,0,0],Cy=[0,0,0],Oy=[0,0,0],Ay=r$3y(-1,-1,-1);let My=class v3{constructor(){this._transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._transformInverse=new Ry({value:this._transform},h$2A,e$3G),this._transformInverseTranspose=new Ry(this._transformInverse,s$3L,e$3G),this._transformTranspose=new Ry({value:this._transform},s$3L,e$3G),this._transformInverseRotation=new Ry({value:this._transform},y$1W,e$3F)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(fe){n$48(this._transform,fe)}multiplyTransform(fe){c$4k(this._transform,this._transform,fe)}set(fe){n$48(this._transform,fe),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(fe,ve){this.setTransformMatrix(fe),this.multiplyTransform(ve),this._invalidateLazyTransforms()}},Ry=class b{constructor(fe,ve,_e){this._original=fe,this._update=ve,this._dirty=!0,this._transform=_e()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}};const Iy=new class O2{constructor(fe=0){this.offset=fe,this.sphere=[0,0,0,0],this.tmpVertex=[0,0,0]}applyToVertex(fe,ve,_e){const be=this.objectTransform.transform,we=o$44(Fy,fe,ve,_e),Se=O$1v(we,we,be);q$11(Se,Se,Se,this.offset/s$4g(Se));const Te=this.objectTransform.inverse;return O$1v(this.tmpVertex,Se,Te),this.tmpVertex}applyToMinMax(fe,ve){q$11(fe,fe,fe,this.offset/s$4g(fe));q$11(ve,ve,ve,this.offset/s$4g(ve))}applyToAabb(fe){const ve=this.offset/Math.sqrt(fe[0]*fe[0]+fe[1]*fe[1]+fe[2]*fe[2]);fe[0]+=fe[0]*ve,fe[1]+=fe[1]*ve,fe[2]+=fe[2]*ve;const _e=this.offset/Math.sqrt(fe[3]*fe[3]+fe[4]*fe[4]+fe[5]*fe[5]);return fe[3]+=fe[3]*_e,fe[4]+=fe[4]*_e,fe[5]+=fe[5]*_e,fe}applyToBoundingSphere(fe){const ve=s$4g(fe),_e=this.offset/ve;return q$11(this.sphere,fe,fe,_e),this.sphere[3]=fe[3]+fe[3]*this.offset/ve,this.sphere}};function d$2R(fe){return null!=fe?(Iy.offset=fe,Iy):null}const Ly=new class x2{constructor(fe=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=[0,0,0],this._tmpMbs=[0,0,0,0],this._tmpObb=new cy,this._resetOffset(fe)}_resetOffset(fe){this._offset=fe,this._totalOffset=fe}set offset(fe){this._resetOffset(fe)}get offset(){return this._offset}set componentOffset(fe){this._totalOffset=this._offset+fe}set localOrigin(fe){this.componentLocalOriginLength=s$4g(fe)}applyToVertex(fe,ve,_e){const be=o$44(Fy,fe,ve,_e),we=o$44(zy,fe,ve,_e+this.componentLocalOriginLength),Se=this._totalOffset/s$4g(we);return q$11(this._tmpVertex,be,we,Se),this._tmpVertex}applyToAabb(fe){const ve=this.componentLocalOriginLength,_e=fe[0],be=fe[1],we=fe[2]+ve,Se=fe[3],Te=fe[4],Ee=fe[5]+ve,Ce=Math.abs(_e),Oe=Math.abs(be),Re=Math.abs(we),De=Math.abs(Se),Be=Math.abs(Te),Ze=Math.abs(Ee),Xe=.5*(1+Math.sign(_e*Se))*Math.min(Ce,De),Je=.5*(1+Math.sign(be*Te))*Math.min(Oe,Be),Qe=.5*(1+Math.sign(we*Ee))*Math.min(Re,Ze),dt=Math.max(Ce,De),$t=Math.max(Oe,Be),bt=Math.max(Re,Ze),wt=Math.sqrt(Xe*Xe+Je*Je+Qe*Qe),xt=Math.sign(Ce+_e),St=Math.sign(Oe+be),Et=Math.sign(Re+we),Pt=Math.sign(De+Se),Ot=Math.sign(Be+Te),At=Math.sign(Ze+Ee),Mt=this._totalOffset;if(wt<Mt)return fe[0]-=(1-xt)*Mt,fe[1]-=(1-St)*Mt,fe[2]-=(1-Et)*Mt,fe[3]+=Pt*Mt,fe[4]+=Ot*Mt,fe[5]+=At*Mt,fe;const Rt=Mt/Math.sqrt(dt*dt+$t*$t+bt*bt),Nt=Mt/wt,Ft=Nt-Rt,zt=-Ft;return fe[0]+=_e*(xt*zt+Nt),fe[1]+=be*(St*zt+Nt),fe[2]+=we*(Et*zt+Nt),fe[3]+=Se*(Pt*Ft+Rt),fe[4]+=Te*(Ot*Ft+Rt),fe[5]+=Ee*(At*Ft+Rt),fe}applyToMbs(fe){const ve=s$4g(fe),_e=this._totalOffset/ve;return q$11(this._tmpMbs,fe,fe,_e),this._tmpMbs[3]=fe[3]+fe[3]*this._totalOffset/ve,this._tmpMbs}applyToObb(fe){return L$10(fe,this._totalOffset,this._totalOffset,Wf.Global,this._tmpObb),this._tmpObb}};function L$$(fe){return null!=fe?(Ly.offset=fe,Ly):null}const Dy=new class T{constructor(fe=0){this.offset=fe,this.tmpVertex=[0,0,0]}applyToVertex(fe,ve,_e){const be=o$44(Fy,fe,ve,_e),we=u$3Y(zy,be,this.localOrigin),Se=this.offset/s$4g(we);return q$11(this.tmpVertex,be,we,Se),this.tmpVertex}applyToAabb(fe){const ve=ky,_e=Uy,be=Vy;for(let Te=0;Te<3;++Te)ve[Te]=fe[0+Te]+this.localOrigin[Te],_e[Te]=fe[3+Te]+this.localOrigin[Te],be[Te]=ve[Te];const we=this.applyToVertex(ve[0],ve[1],ve[2]);for(let Te=0;Te<3;++Te)fe[Te]=we[Te],fe[Te+3]=we[Te];const o39=ve=>{const _e=this.applyToVertex(ve[0],ve[1],ve[2]);for(let be=0;be<3;++be)fe[be]=Math.min(fe[be],_e[be]),fe[be+3]=Math.max(fe[be+3],_e[be])};for(let Te=1;Te<8;++Te){for(let fe=0;fe<3;++fe)be[fe]=Te&1<<fe?_e[fe]:ve[fe];o39(be)}let Se=0;for(let Te=0;Te<3;++Te)ve[Te]*_e[Te]<0&&(Se|=1<<Te);if(0!==Se&&7!==Se)for(let Te=0;Te<8;++Te)if(!(Se&Te)){for(let fe=0;fe<3;++fe)be[fe]=Se&1<<fe?0:Te&1<<fe?ve[fe]:_e[fe];o39(be)}for(let Te=0;Te<3;++Te)fe[Te]-=this.localOrigin[Te],fe[Te+3]-=this.localOrigin[Te];return fe}};const Ny="terrain",Fy=[0,0,0],zy=[0,0,0],ky=[0,0,0],Uy=[0,0,0],Vy=[0,0,0],By=1e-5;let jy=class b2{constructor(fe){this.options=new Jf,this._results=new Gy,this.transform=new My,this.tolerance=By,this.verticalOffset=null,this._ray=m$3f(),this._rayEnd=[0,0,0],this._rayBeginTransformed=[0,0,0],this._rayEndTransformed=[0,0,0],this.viewingMode=fe??Wf.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(fe,ve,_e){this.resetWithRay(k$1k(fe,ve,this._ray),_e)}resetWithRay(fe,ve){this.camera=ve,fe!==this._ray&&b$1Y(fe,this._ray),0!==this.options.verticalOffset?this.viewingMode===Wf.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,u$3Y(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(fe=null,ve,_e,be,we){var Se;this.point=ve,this.filterPredicate=be,this.tolerance=_e??By;const Te=d$2R(this.verticalOffset);if(fe&&fe.length>0){const ve=we?fe=>{we(fe)&&this.intersectObject(fe)}:fe=>{this.intersectObject(fe)};for(const _e of fe){const fe=null==(Se=_e.getSpatialQueryAccelerator)?void 0:Se.call(_e);null!=fe?(null!=Te?fe.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,ve,Te):fe.forEachAlongRay(this._ray.origin,this._ray.direction,ve),this.options.selectionMode&&this.options.hud&&fe.forEachDegenerateObject(ve)):_e.objects.forAll((fe=>ve(fe)))}}this.sortResults()}intersectObject(fe){const ve=fe.geometries;if(!ve)return;const _e=fe.effectiveTransformation,be=d$2R(this.verticalOffset);for(const we of ve){if(!we.visible)continue;const{material:ve,id:Se}=we;this.transform.setAndInvalidateLazyTransforms(_e,we.transformation),O$1v(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),O$1v(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const Te=this.transform.transform;null!=be&&(be.objectTransform=this.transform),ve.intersect(we,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((ve,_e,be,we,Ee,Ce)=>{if(ve>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,ve))return;const Oe=we?this._results.hud:this._results,Re=we?we=>{const Te=new Kf(fe,Se,be,Ce);we.set(Zf.HUD,Te,ve,_e,dd,Ee)}:we=>we.set(Zf.OBJECT,{object:fe,geometryId:Se,triangleNr:be},ve,_e,Te,Ee);if((null==Oe.min.drapedLayerOrder||Ee>=Oe.min.drapedLayerOrder)&&(null==Oe.min.dist||ve<Oe.min.dist)&&Re(Oe.min),this.options.store!==Xf.MIN&&(null==Oe.max.drapedLayerOrder||Ee<Oe.max.drapedLayerOrder)&&(null==Oe.max.dist||ve>Oe.max.dist)&&Re(Oe.max),this.options.store===Xf.ALL)if(we){const fe=new qy(this._ray);Re(fe),this._results.hud.all.push(fe)}else{const fe=new Hy(this._ray);Re(fe),this._results.all.push(fe)}}}))}}sortResults(fe=this._results.all){fe.sort(((fe,ve)=>fe.dist!==ve.dist?(fe.dist??0)-(ve.dist??0):fe.drapedLayerOrder!==ve.drapedLayerOrder?x$1r(fe.drapedLayerOrder,ve.drapedLayerOrder):x$1r(fe.drapedLayerGraphicOrder,ve.drapedLayerGraphicOrder)))}};function x$1r(fe,ve){return(ve??-Number.MAX_VALUE)-(fe??-Number.MAX_VALUE)}function T$15(fe){return new jy(fe)}let Gy=class A{constructor(){this.min=new Hy(m$3f()),this.max=new Hy(m$3f()),this.hud={min:new qy(m$3f()),max:new qy(m$3f()),all:new Array},this.ground=new Hy(m$3f()),this.all=[]}init(fe){this.min.init(fe),this.max.init(fe),this.ground.init(fe),this.all.length=0,this.hud.min.init(fe),this.hud.max.init(fe),this.hud.all.length=0}},Hy=class B{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(g$2z(Wy,this.ray.direction,this.dist),s$4g(Wy)):null}getIntersectionPoint(fe){return!!o$3p(this)&&(g$2z(Wy,this.ray.direction,this.dist),u$3Y(fe,this.ray.origin,Wy),!0)}getTransformedNormal(fe){return r$3w(Yy,this.normal),Yy[3]=0,z$13(Yy,Yy,this.transformation),r$3w(fe,Yy),z$1d(fe,fe)}constructor(fe){this.intersector=Zf.OBJECT,this.normal=[0,0,0],this.transformation=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._ray=m$3f(),this.init(fe)}init(fe){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Zf.OBJECT,b$1Y(fe,this._ray)}set(fe,ve,_e,be,we,Se,Te){this.intersector=fe,this.dist=_e,r$3w(this.normal,be??qi),n$48(this.transformation,we??dd),this.target=ve,this.drapedLayerOrder=Se,this.drapedLayerGraphicOrder=Te}copy(fe){b$1Y(fe.ray,this._ray),this.intersector=fe.intersector,this.dist=fe.dist,this.target=fe.target,this.drapedLayerOrder=fe.drapedLayerOrder,this.drapedLayerGraphicOrder=fe.drapedLayerGraphicOrder,r$3w(this.normal,fe.normal),n$48(this.transformation,fe.transformation)}},qy=class I2 extends Hy{constructor(){super(...arguments),this.intersector=Zf.HUD}};function G$I(fe){return new Hy(fe)}const Wy=[0,0,0],Yy=[0,0,0,0];function u$3k(fe,ve,_e,be){return null!=fe.renderCoordsHelper.fromRenderCoords(ve.eye,Xy,be)&&b$28(_e,Xy)}function f$2B(fe,ve){return fe.elevationProvider?fe.elevationProvider.getElevation(ve[0],ve[1],ve[2],fe.renderCoordsHelper.spatialReference,"ground")??0:0}function g$22(fe,ve,_e,be){const we=fe.state.camera.clone();ve&&_e&&be&&(we.eye=ve,we.center=_e,we.up=be),function p$4n(fe,ve,_e){let be=Zy[fe.viewingMode];be||(be=T$15(fe.state.viewingMode),be.options.backfacesTerrain=!fe.state.isGlobal,be.options.invisibleTerrain=!0,Zy[fe.viewingMode]=be);const{isGlobal:we}=fe.state;return!(!fe.sceneIntersectionHelper.intersectRay(ve,be,_e)||m$37(fe,ve.origin,_e))||!(!fe.renderCoordsHelper.intersectManifold(ve,0,_e)||m$37(fe,ve.origin,_e))||!!we&&function y$1S(fe,ve,_e){const be=P$1g(fe.origin,fe.origin)-_e*_e,we=be>0?Math.sqrt(be)/3:1;return g$2z(ve,fe.direction,we/s$4g(fe.direction)),u$3Y(ve,ve,fe.origin),!0}(ve,_e,s$45(fe.spatialReference).radius)}(fe,we.ray,Jy)||r$3w(Jy,we.center);const Se=fe.state.constraints,Te=Se.minimumPoiDistance;if(p$4Z(we.eye,Jy)<Te){const ve=Se.collision.enabled;r$3w(Qy,we.viewForward),g$2z(Qy,Qy,Te),ve?we.eye=e$3Z(Xy,Jy,Qy):u$3Y(Jy,we.eye,Qy);const _e=fe.renderCoordsHelper,be=_e.getAltitude(we.eye),Ee=Se.collision.elevationMargin;ve&&be<Ee&&(e$3Z(Qy,Jy,we.eye),we.eye=_e.setAltitude(Xy,Ee,we.eye),u$3Y(Jy,we.eye,Qy))}return we.center=Jy,we}function m$37(fe,ve,_e){if(!fe.state.isGlobal||!fe.stateManager.constraintsManager)return!1;const be=f$2B(fe,ve),we=fe.stateManager.constraintsManager.nearFarHeuristic,{far:Se}=we.compute(ve,_e,fe.renderDataExtent,be,Ky),Te=Se*Se;return p$4Z(ve,_e)>Te}const Zy={},Xy=[0,0,0],Jy=[0,0,0],Qy=[0,0,0],Ky={near:0,far:0},eg=[0,0,0],tg=[0,0,0];function u$3j(){return{direction:[0,0,0],up:[0,0,0]}}function h$2p(fe,ve,_e,be,we){let Se=z$1d(eg,fe),Te=P$1g(Se,be);const Ee=Te>0;Te=Math.abs(Te),Te>.99&&(Te=Math.abs(P$1g(ve,be)),Te<.99?(r$3w(Se,ve),Ee&&g$2z(Se,Se,-1)):Se=null);let Ce=0;if(Se){g$2z(tg,be,P$1g(be,Se)),e$3Z(Se,Se,tg);const fe=P$1g(Se,we)/(s$4g(Se)*s$4g(we));_$1z(tg,Se,we),Ce=(P$1g(tg,be)>0?1:-1)*M$1x(m$3J(fe))}const Oe=M$1x(m$3J(-P$1g(be,fe)/s$4g(fe)));return _e?(_e.heading=Ce,_e.tilt=Oe,_e):{heading:Ce,tilt:Oe}}const rg=r$3y(0,1,0),ig=r$3y(0,0,1),ng=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sg=[0,0,0],og=[0,0,0];function h$2o(fe,ve,_e,be={direction:[0,0,0],up:[0,0,0]}){const{direction:we,up:Se}=be;return R$1b(ng,-h$2U(ve)),l$3_(ng,ng,h$2U(_e)),O$1v(we,ig,ng),g$2z(we,we,-1),O$1v(Se,rg,ng),be}function E$1r(fe,ve,_e,be,we){const Se=fe.renderSpatialReference,Te=fe.map&&fe.spatialReference||ve.spatialReference;return c$4l(ve,sg,Se),c$4l(ve,og,Se),sg[0]-=_e/2,og[0]+=_e/2,sg[1]-=be/2,og[1]+=be/2,n$3Y(sg,Se,sg,Te),n$3Y(og,Se,og,Te),we?(we.xmin=sg[0],we.ymin=sg[1],we.xmax=og[0],we.ymax=og[1],we.spatialReference=Te):we=new aa(sg[0],sg[1],og[0],og[1],Te),we}const ag=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function b$1N(fe,ve,_e,be){return h$2p(ve,_e,be,ig,rg)},eyeForCenterWithHeadingTilt:function v$1C(fe,ve,_e,be){const we=h$2o(0,_e,be),Se=[0,0,0];return g$2z(Se,we.direction,-ve),u$3Y(Se,Se,fe),{up:we.up,eye:Se,heading:_e,tilt:be}},eyeTiltToLookAtTilt:function _$1d(fe){return h$2U(fe)},headingTiltToDirectionUp:h$2o,lookAtTiltToEyeTilt:function R$13(fe){return M$1x(fe)},toExtent:E$1r},Symbol.toStringTag,{value:"Module"}));function u$3i(fe,ve,_e){if(null==ve.longitude||null==ve.latitude||null==_e.longitude||null==_e.latitude)throw new Error("Invalid points: no lon/lat");return function i$3W(fe,ve,_e,be,we){const Se=h$2U(_e),Te=h$2U(we),Ee=Se-Te,Ce=h$2U(ve)-h$2U(be),Oe=Math.sin(Ee/2),Re=Math.sin(Ce/2),De=2*l$4n(Math.sqrt(Oe*Oe+Math.cos(Se)*Math.cos(Te)*Re*Re))*fe;return Math.round(1e4*De)/1e4}(fe,ve.longitude,ve.latitude,_e.longitude,_e.latitude)}function c$45(fe,ve){const _e=null==fe?void 0:fe[0];if(null==_e)return null;ve||(ve={hours:0,minutes:0,seconds:0}),ve.hours=function a$3V(fe,ve){return fe/15}(_e);const be=ve.hours%1;ve.hours-=be,ve.minutes=60*be;const we=ve.minutes%1;return ve.minutes-=we,ve.seconds=Math.round(60*we),ve}const lg=r$3y(0,0,1),cg=z$1d([0,0,0],r$3y(1,1,1)),ug=new $n(-180,180),hg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dg=[0,0,0],pg=[0,0,0];function S$1x(fe,ve,_e,be={direction:[0,0,0],up:[0,0,0]}){_$1z(dg,fe,lg),0===P$1g(dg,dg)&&_$1z(dg,fe,cg),p$4z(hg,-h$2U(ve),fe),b$21(hg,hg,-h$2U(_e),dg);const{up:we,direction:Se}=be;return _$1z(we,dg,fe),z$1d(we,we),O$1v(we,we,hg),z$1d(Se,fe),j$1O(Se,Se),O$1v(Se,Se,hg),be}function E$1q(fe){const ve=fe[1];fe[1]=-fe[2],fe[2]=ve}function H$V(fe,ve){const _e=S$1x(ve,fe.heading,fe.tilt);return fe.up=_e.up,fe}function A$1j(fe,ve,_e,be,we){let Se,Te,Ee,Ce;const Oe=ve.latitude,Re=s$45(fe.spatialReference).radius,De=ve.longitude,Be=function l$3N(fe,ve,_e){const be=ve/_e,we=h$2U(fe),Se=Math.sin(be/2),Te=Math.cos(we);return M$1x(2*l$4n(Math.sqrt(Se*Se/(Te*Te))))}(Oe,_e,Re)/2;Se=De-Be,Te=De+Be;const Ze=h$2U(Oe),Xe=(1+Math.sin(Ze))/(1-Math.sin(Ze)),Je=(Xe+1)*Math.tan(be/Re/2),Qe=Je*Je;function P9(fe){const ve=Math.PI/2;return(fe=bn.normalize(fe,-ve))>ve&&(fe=Math.PI-fe),fe}if(Ee=1.5*Math.PI-2*Math.atan(.5*(Je+Math.sqrt(4*Xe+Qe))),Ce=Ee+be/Re,Ee=P9(Ee),Ce=P9(Ce),Ce<Ee){const fe=Ce;Ce=Ee,Ee=fe}if(Ee=Math.max(M$1x(Ee),-90),Ce=Math.min(M$1x(Ce),90),Te=ug.monotonic(Se,Te),Te-Se>180){const fe=(Te-Se-180)/2;Se+=fe,Te-=fe}const dt=fe.spatialReference&&fe.spatialReference.isGeographic?fe.spatialReference:zo.WGS84;return we?(we.xmin=Se,we.ymin=Ee,we.xmax=Te,we.ymax=Ce,we.spatialReference=dt):we=new aa(Se,Ee,Te,Ce,dt),fe.spatialReference&&fe.spatialReference.isWebMercator&&d$3l(we,!1,we),we}const fg=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function _$1c(fe,ve,_e,be){const we=dg,Se=pg;return z$1d(we,fe),_$1z(pg,we,lg),0===P$1g(pg,pg)&&_$1z(pg,we,cg),_$1z(Se,pg,we),h$2p(ve,_e,be,we,Se)},eyeForCenterWithHeadingTilt:function k$1d(fe,ve,_e,be){const we={eye:[0,0,0],up:null,tilt:be,heading:_e},Se=dg;Se[0]=fe[0],Se[1]=fe[2],Se[2]=-fe[1];const Te=ve,Ee=h$2U(_e),Ce=h$2U(be),Oe=Math.sin(Ee),Re=Math.cos(Ee),De=Math.sin(Ce),Be=Math.cos(Ce),Ze=s$4g(Se);let Xe;if(Math.abs(Ce)<1e-8)Xe=Te+Ze;else{const fe=Ze/De,ve=l$4n(Te/fe),_e=Math.PI-Ce-ve;Xe=fe*Math.sin(_e)}const Je=Be*Te,Qe=Te*Te*(De*De),dt=Re*Re*Qe,$t=Xe-Je,bt=$t*$t,wt=dt*(dt+bt-Se[1]*Se[1]);if(wt<0)return g$2z(we.eye,Se,Xe/Ze),we.tilt=0,H$V(we,fe);const xt=Math.sqrt(wt),St=Se[1]*$t,Et=dt+bt;let Pt;if(Pt=Re>0?-xt+St:xt+St,Math.abs(Et)<1e-8)return Ze<1e-8?(we.eye[0]=0,we.eye[1]=0,we.eye[2]=Te):g$2z(we.eye,Se,Xe/Ze),we.tilt=0,E$1q(we.eye),H$V(we,fe);we.eye[1]=Pt/Et;const Ot=Oe*Oe*Qe,At=De*Te,Mt=Re*At*we.eye[1],Rt=we.eye[1]*we.eye[1],Nt=1-Rt,Ft=Math.sqrt(Nt),zt=dt*Rt+Ot-2*Mt*Ft*$t+Nt*bt;return Math.abs(zt)<1e-8?(g$2z(we.eye,Se,Xe/Ze),we.tilt=0,E$1q(we.eye),H$V(we,fe)):(we.eye[0]=(Nt*(Xe*Se[0]-Je*Se[0])-At*Ft*(Se[0]*we.eye[1]*Re+Se[2]*Oe))/zt,we.eye[2]=(Nt*(Xe*Se[2]-Je*Se[2])-At*Ft*(Se[2]*we.eye[1]*Re-Se[0]*Oe))/zt,g$2z(we.eye,we.eye,Xe),E$1q(we.eye),H$V(we,fe))},eyeTiltToLookAtTilt:function z$V(fe,ve,_e){const be=h$2U(fe);return l$4n(_e/(s$4g(ve)/Math.sin(be)))+be},headingTiltToDirectionUp:S$1x,lookAtTiltToEyeTilt:function W$D(fe,ve,_e){const be=s$4g(ve);return M$1x(fe-l$4n(_e/(Math.sqrt(_e*_e+be*be-2*_e*be*Math.cos(Math.PI-fe))/Math.sin(fe))))},toExtent:A$1j},Symbol.toStringTag,{value:"Module"}));function t$3z(fe){return"point"===fe.type}let mg=class r5{constructor(fe,ve=null,_e=0){this.array=fe,this.spatialReference=ve,this.offset=_e}};function t$3y(fe){return"array"in fe}function a$3U(fe,ve,_e="ground"){if(t$3z(ve))return fe.getElevation(ve.x,ve.y,ve.z||0,ve.spatialReference,_e);if(t$3y(ve)){let be=ve.offset;return fe.getElevation(ve.array[be++],ve.array[be++],ve.array[be]||0,ve.spatialReference??fe.spatialReference,_e)}return fe.getElevation(ve[0],ve[1],ve[2]||0,fe.spatialReference,_e)}function r$2Y(fe,ve){return null!=fe&&(null==ve||(ve===Wf.Local?!fe.isGeographic||fe.isWGS84||fe.wkid===to.CGCS2000:fe.isWebMercator||fe.isWGS84||fe.wkid===to.CGCS2000||fe.wkid===to.GCSMARS2000||fe.wkid===to.GCSMARS2000_SPHERE||fe.wkid===to.GCSMOON2000))}const H$U=()=>ar.getLogger("esri.views.3d.support.cameraUtils"),yg=39.37,gg=96,vg=1,_g=8,$g=5,bg=1,wg=[0,0,0],xg={heading:0,tilt:0},Sg=[0,0,0],Tg=new $n(-20037508.342788905,20037508.342788905),Eg=new $n(-180,180);var Pg;function W$C(fe){return fe.spatialReference??zo.WGS84}function Y$t(fe){return"global"===fe.viewingMode?fg:ag}function N$X(fe,ve,_e,be,we){return Y$t(fe).headingTiltToDirectionUp(ve,_e,be,we)}function Z$v(fe,ve){if(null==ve)return null;const _e=fe.renderSpatialReference,be=Y$t(fe).headingTiltToDirectionUp,we=[0,0,0];if(!c$4l(ve.position,we,_e))return null;const Se=be(we,ve.heading,ve.tilt);g$2z(Se.direction,Se.direction,fe.state.camera.distance),u$3Y(Se.direction,Se.direction,we);const Te=g$22(fe,we,Se.direction,Se.up);return Te.fov=h$2U(ve.fov),Te.row=ve.layout.row,Te.rows=ve.layout.rows,Te.column=ve.layout.column,Te.columns=ve.layout.columns,Te}!function(fe){fe[fe.LOCKED=0]="LOCKED",fe[fe.ADJUST=1]="ADJUST"}(Pg||(Pg={}));const Cg=[0,0,0];function Q$y(fe,ve,_e){const be=fe.renderSpatialReference,we=re$d(fe,ve.eye,ve.viewForward,ve.up,xg);let Se=W$C(fe);return n$3Y(ve.eye,be,Cg,Se)||(Se=zo.WGS84,n$3Y(ve.eye,be,Cg,Se)),null==_e?_e=new Xo(new Yo(Cg,Se),we.heading,we.tilt,M$1x(ve.fov)):(_e.position.x=Cg[0],_e.position.y=Cg[1],_e.position.z=Cg[2],_e.position.spatialReference=Se,_e.heading=we.heading,_e.tilt=we.tilt,_e.fov=M$1x(ve.fov)),_e.layout.row=ve.row,_e.layout.rows=ve.rows,_e.layout.column=ve.column,_e.layout.columns=ve.columns,_e}function $$w(fe,ve,_e){const be=fe.state.camera,we=be.width/2/be.pixelRatio;return fe.renderCoordsHelper.viewingMode===Wf.Global&&null!=_e&&(ve*=Math.cos(h$2U(_e))),ve/=fe.renderCoordsHelper.unitInMeters,we/(gg*yg/ve)/Math.tan(be.fovX/2)}function _$1b(fe,ve,_e){const be=fe.state.camera,we=ve*Math.tan(be.fovX/2),Se=be.width/2/be.pixelRatio;let Te=gg*yg/(Se/we);return fe.renderCoordsHelper.viewingMode===Wf.Global&&null!=_e&&(Te/=Math.cos(h$2U(_e))),Te*fe.renderCoordsHelper.unitInMeters}async function ee$f(fe,ve,_e,be,we,Se){return ne$e(fe,ve,$$w(fe,_e,ve.latitude),be,we,Se)}async function ne$e(fe,ve,_e,be,we,Se){const Te=await se$d(fe,be.heading,be.tilt,ve,_e,we,Se);return s$4o(Se),be$4(fe,Te,be.fov,Se)}function re$d(fe,ve,_e,be,we){return Y$t(fe).directionToHeadingTilt(ve,_e,be,we)}function oe$e(fe,ve){return!!(fe.basemapTerrain&&fe.renderCoordsHelper.fromRenderCoords(ve,Sg,fe.spatialReference)&&fe.elevationProvider&&(a$3U(fe.elevationProvider,Sg)??0)>Sg[2]-bg)}function ce$b(fe,ve,_e,be,we,Se){return ue$b(fe,ve,_e,be instanceof Yo?be:null,function le$d(fe,ve){const _e=[0,0,0];if(null==ve)return r$3w(_e,fe.state.camera.center);if(ve instanceof Yo){if(!c$4l(ve,_e,fe.renderSpatialReference))return null;const{basemapTerrain:be,elevationProvider:we}=fe;if(null==ve.z&&null!=be&&null!=we){const be=a$3U(we,ve);null!=be&&fe.renderCoordsHelper.setAltitude(_e,be)}return _e}return r$3w(_e,ve)}(fe,be),we,Se)}async function se$d(fe,ve,_e,be,we,Se,Te){const Ee=be instanceof Yo?be:null,Ce=await async function ae$d(fe,ve,_e){const be=[0,0,0];if(null==ve)return r$3w(be,fe.state.camera.center);if(ve instanceof Yo){const{renderSpatialReference:we,basemapTerrain:Se,elevationProvider:Te}=fe,Ee=ve.spatialReference;if(await i$47(ve,be,we,0,{signal:_e}),s$4o(_e),null==ve.z&&null!=Se&&null!=Te){const we=await Te.queryElevation(ve.x,ve.y,ve.z??0,Ee,"ground",_e);s$4o(_e),null!=we&&fe.renderCoordsHelper.setAltitude(be,we)}return be}return r$3w(be,ve)}(fe,be,Te);return s$4o(Te),fe$9(fe,ve,_e,Ee,Ce,we,Se,Te)}function ue$b(fe,ve,_e,be,we,Se,Te){if(null==we)return null;if(!be&&(be=new Yo({spatialReference:W$C(fe)}),!t$3D(we,fe.renderSpatialReference,be)))return null;const Ee=me$9(fe,ve,_e,we,Se,Te);if(pe$b(fe,_e,Te)&&oe$e(fe,Ee.eye)){const{tilt:Te,mode:Ee}=de$9(fe,_e,we,Se);return ue$b(fe,ve,Te,be,we,Se,Ee)}return he$9(Ee,we)}async function fe$9(fe,ve,_e,be,we,Se,Te,Ee){be||(be=new Yo({spatialReference:W$C(fe)}),await c$49(we,fe.renderSpatialReference,be,{signal:Ee})||(be=null)),s$4o(Ee);const Ce=me$9(fe,ve,_e,we,Se,Te);if(pe$b(fe,_e,Te)&&await async function ie$d(fe,ve,_e){if(oe$e(fe,ve))return!0;const{elevationProvider:be,spatialReference:we,renderCoordsHelper:Se}=fe;if(null==be||!Se.fromRenderCoords(ve,Sg,we))return!1;const[Te,Ee,Ce]=Sg,Oe=await be.queryElevation(Te,Ee,Ce,we,"ground",_e)??0;return s$4o(_e),Oe>Ce-bg}(fe,Ce.eye,Ee)){s$4o(Ee);const{tilt:Te,mode:Ce}=de$9(fe,_e,we,Se);return fe$9(fe,ve,Te,be,we,Se,Ce,Ee)}return he$9(Ce,we)}function me$9(fe,ve,_e,be,we,Se){const Te=function je$1(fe,ve,_e,be,we,Se){let Te=0;return Se===Pg.ADJUST&&function xe$1(fe,ve,_e){const be=fe.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(_e/be)/Math.LN2>_g)return!0;const we=ve,Se=fe.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return x$1W(we,Se)/(Math.tan(.5*fe.state.camera.fov)*be)>$g}(fe,be,we)?(ve=0,Te=function Te$3(fe,ve,_e,be){const we=ze$1(fe,be,ve,_e);if(!fe.state.constraints.tilt)return we;const Se=fe.state.constraints.tilt(ve);Se.max=Math.min(Se.max,.5*Math.PI);const Te=Se.min*(1-Og)+Se.max*Og;return Math.min(we,Te)}(fe,we,_e,be)):Te=ze$1(fe,be,we,_e),Te=fe.state.constraints.clampTilt(we,Te),{heading:ve,tilt:_e=Ce$1(fe,be,we,Te)}}(fe,ve,_e,be,we=Math.max(we,fe.state.constraints.minimumPoiDistance),Se);return(0,Y$t(fe).eyeForCenterWithHeadingTilt)(be,we,Te.heading,Te.tilt)}function pe$b(fe,ve,_e){const be=fe.map.ground.navigationConstraint;return _e===Pg.ADJUST&&"global"===fe.viewingMode&&ve>0&&(null==be||"stay-above"===be.type)}function de$9(fe,ve,_e,be){const we=Ce$1(fe,_e,be,function Se$5(fe,ve,_e,be){let we=ze$1(fe,be,ve,_e);if(!fe.state.constraints.tilt)return we;const Se=fe.state.constraints.tilt(ve);return we=Math.min(we,.5*Math.PI),Se.min*(1-Og)+we*Og}(fe,be,ve,_e));return{tilt:we,mode:ve-we<1?Pg.LOCKED:Pg.ADJUST}}function he$9(fe,ve){return{...fe,center:t$47(ve)}}function ge$7(fe,ve){const{state:_e,spatialReference:be}=fe,we=ve.spatialReference;return _e.isGlobal&&r$2Y(we,Wf.Global)||_e.isLocal&&be.equals(we)}function ye$7(fe,ve){let _e,be,we;if(fe.state.isGlobal){const fe=new Yo(ve.xmin,ve.ymin,ve.spatialReference),Se=new Yo(ve.xmax,ve.ymax,ve.spatialReference),Te=ve.spatialReference.isGeographic?Eg:Tg;_e=new Yo({x:Te.center(fe.x,Se.x),y:(Se.y+fe.y)/2,z:null!=ve.zmax&&null!=ve.zmin?(ve.zmax+ve.zmin)/2:void 0,spatialReference:ve.spatialReference});const Ee=s$45(ve.spatialReference),Ce=function s$3D(fe,ve,_e){const be=ve.spatialReference,we=s$45(be),Se=new Yo(ve.x,fe.y,be),Te=new Yo(_e.x,fe.y,be),Ee=new Yo(fe.x,ve.y,be),Ce=new Yo(fe.x,_e.y,be);return{lon:u$3i(we.radius,Se,Te),lat:u$3i(we.radius,Ee,Ce)}}(_e,fe,Se);be=Ce.lon,we=Ce.lat,Te.diff(fe.x,Se.x)>Te.range/2&&(be+=Ee.halfCircumference),be=Math.min(be,Ee.halfCircumference),we=Math.min(we,Ee.halfCircumference)}else{const Se=fe.renderSpatialReference??ve.spatialReference;Se.equals(ve.spatialReference)||(ve=K$D(ve,Se)),be=ve.xmax-ve.xmin,we=ve.ymax-ve.ymin;const Te=null!=ve.zmax&&null!=ve.zmin?(ve.zmax+ve.zmin)/2:void 0;_e=new Yo({x:ve.xmin+.5*be,y:ve.ymin+.5*we,z:Te,spatialReference:Se})}const Se=null!=ve.zmax&&null!=ve.zmin?ve.zmax-ve.zmin:0,Te=fe.state.camera,Ee=1/Math.tan(Te.fovX/2),Ce=1/Math.tan(Te.fovY/2),Oe=1/Math.tan(Te.fov/2);return{center:_e,distance:Math.max(.5*be*Ee,.5*we*Ce,.5*Se*Oe)/vg}}async function ve$3(fe,ve,_e,be,we,Se){const Te=ge$7(fe,ve)?ve:await I$1u(ve,fe.spatialReference,{signal:Se});s$4o(Se);const{center:Ee,distance:Ce}=ye$7(fe,Te),Oe=await se$d(fe,_e,be,Ee,Ce,we,Se);return s$4o(Se),be$4(fe,Oe,fe.camera.fov,Se)}function we$3(fe,ve,_e,be,we,Se){let Te;try{Te=ge$7(fe,ve)?ve:K$D(ve,fe.spatialReference)}catch(Re){return null}const{center:Ee,distance:Ce}=ye$7(fe,Te),Oe=ce$b(fe,_e,be,Ee,Ce,we);return null==Oe?null:Ue$2(fe,Oe,fe.camera.fov,Se)}function Re$2(fe,ve,_e){const be=fe.renderSpatialReference,we=new Yo({spatialReference:W$C(fe)});if(!t$3D(_e,be,we))return null;const Se=Math.tan(ve.fovX/2),Te=Math.tan(ve.fovY/2),Ee=nn(ve.eye,_e),Ce=2*Ee*Se*vg,Oe=2*Ee*Te*vg;return"global"===fe.viewingMode?A$1j(fe,we,Ce,Oe):E$1r(fe,we,Ce,Oe)}const Og=.7;function Ce$1(fe,ve,_e,be){return Y$t(fe).lookAtTiltToEyeTilt(be,ve,_e)}function ze$1(fe,ve,_e,be){return Y$t(fe).eyeTiltToLookAtTilt(be,ve,_e)}function Ue$2(fe,ve,_e,be){if(null==ve)return null;const we=fe.renderSpatialReference,Se=new Yo({spatialReference:W$C(fe)});return t$3D(ve.eye,we,Se)?(be??(be=new Xo),be.position=Se,be.heading=ve.heading,be.tilt=ve.tilt,be.fov=_e,be):null}async function be$4(fe,ve,_e,be){const we=fe.renderSpatialReference,Se=new Yo({spatialReference:W$C(fe)});return await c$49(ve.eye,we,Se,{signal:be}),s$4o(be),new Xo(Se,ve.heading,ve.tilt,_e)}function Ae$2(fe,ve){var _e;const be=null==(_e=fe.basemapTerrain)?void 0:_e.tilingScheme;if(be)return be.scaleAtLevel(ve);H$U().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function De$3(fe,ve){const{renderSpatialReference:_e}=fe,be=function f$2E(fe){return G$Y(fe,gp)||f$3b(fe)?{wkid:to.GCSMARS2000}:G$Y(fe,vp)||p$4U(fe)?{wkid:to.GCSMOON2000}:zo.WGS84}(_e);let we=null;try{n$3Y(ve.center,_e,wg,be)&&(we=wg[1])}catch{}return _$1b(fe,ve.distance,we)}const l$3M=()=>ar.getLogger("esri.layers.support.ElevationSampler");let Ag=class m4{queryElevation(fe){return p$4m(fe.clone(),this)}on(){return e$4e()}projectIfRequired(fe,ve){return h$2n(fe,ve)}},Mg=class c4 extends Ag{get spatialReference(){return this.extent.spatialReference}constructor(fe,ve,_e){super(),this.tile=fe,this.noDataValue=_e;const be=fe.tile.extent;this.extent=c$4z(be,ve.spatialReference),this.extent.zmin=fe.zmin,this.extent.zmax=fe.zmax,this._aaExtent=be;const we=W$L(ve.spatialReference),Se=ve.lodAt(fe.tile.level).resolution*we;this.demResolution={min:Se,max:Se}}contains(fe){const ve=this.projectIfRequired(fe,this.spatialReference);return null!=ve&&this.containsAt(ve.x,ve.y)}containsAt(fe,ve){return w$1U(this._aaExtent,fe,ve)}elevationAt(fe,ve){if(!this.containsAt(fe,ve)){const _e=this.extent,be=`${_e.xmin}, ${_e.ymin}, ${_e.xmax}, ${_e.ymax}`;return l$3M().warn("#elevationAt()",`Point used to sample elevation (${fe}, ${ve}) is outside of the sampler extent (${be})`),this.noDataValue}return this.tile.sample(fe,ve)??this.noDataValue}},Rg=class u extends Ag{get spatialReference(){return this.extent.spatialReference}constructor(fe,ve,_e){let be;super(),"number"==typeof ve?(this.noDataValue=ve,be=null):(be=ve,this.noDataValue=_e),this.samplers=be?fe.map((fe=>new Mg(fe,be,this.noDataValue))):fe;const we=this.samplers[0];if(we){this.extent=we.extent.clone();const{min:fe,max:ve}=we.demResolution;this.demResolution={min:fe,max:ve};for(let _e=1;_e<this.samplers.length;_e++){const fe=this.samplers[_e];this.extent.union(fe.extent),this.demResolution.min=Math.min(this.demResolution.min,fe.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,fe.demResolution.max)}}else this.extent=c$4z(u$3J(),be.spatialReference),this.demResolution={min:0,max:0}}elevationAt(fe,ve){let _e,be=!1;for(const we of this.samplers)if(we.containsAt(fe,ve)&&(be=!0,_e=we.elevationAt(fe,ve),_e!==we.noDataValue))return _e;return null!=_e?_e:(be||l$3M().warn("#elevationAt()",`Point used to sample elevation (${fe}, ${ve}) is outside of the sampler`),this.noDataValue)}};function p$4m(fe,ve){const _e=h$2n(fe,ve.spatialReference);if(!_e)return null;switch(fe.type){case"point":!function f$2z(fe,ve,_e){fe.z=_e.elevationAt(ve.x,ve.y)}(fe,_e,ve);break;case"polyline":!function x$1p(fe,ve,_e){Ig.spatialReference=ve.spatialReference;const be=fe.hasM&&!fe.hasZ;for(let we=0;we<fe.paths.length;we++){const Se=fe.paths[we],Te=ve.paths[we];for(let fe=0;fe<Se.length;fe++){const ve=Se[fe],we=Te[fe];Ig.x=we[0],Ig.y=we[1],be&&(ve[3]=ve[2]),ve[2]=_e.elevationAt(Ig.x,Ig.y)}}fe.hasZ=!0}(fe,_e,ve);break;case"multipoint":!function R$12(fe,ve,_e){Ig.spatialReference=ve.spatialReference;const be=fe.hasM&&!fe.hasZ;for(let we=0;we<fe.points.length;we++){const Se=fe.points[we],Te=ve.points[we];Ig.x=Te[0],Ig.y=Te[1],be&&(Se[3]=Se[2]),Se[2]=_e.elevationAt(Ig.x,Ig.y)}fe.hasZ=!0}(fe,_e,ve)}return fe}function h$2n(fe,ve){if(null==fe)return null;const _e=fe.spatialReference;if(_e.equals(ve))return fe;const be=g$2s(fe,ve);return be||l$3M().error(`Cannot project geometry spatial reference (wkid:${_e.wkid}) to elevation sampler spatial reference (wkid:${ve.wkid})`),be}const Ig=new Yo;var Lg;let Dg=Lg=class extends Pn{constructor(fe){super(fe),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Lg({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};e$4o([y$2v({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"cols",void 0),e$4o([y$2v({type:Ci,json:{write:!0}})],Dg.prototype,"level",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Dg.prototype,"levelValue",void 0),e$4o([y$2v({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"origin",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],Dg.prototype,"resolution",void 0),e$4o([y$2v({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"rows",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],Dg.prototype,"scale",void 0),Dg=Lg=e$4o([a$4y("esri.layers.support.LOD")],Dg);const Ng=Dg;let Fg=class t11{constructor(fe,ve,_e,be,we=void 0){this.id=fe,this.level=ve,this.row=_e,this.col=be,this.extent=we}};var zg;const kg=new An({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ug=zg=class extends Pn{static create(fe={}){const{resolutionFactor:ve=1,scales:_e,size:be=256,spatialReference:we=zo.WebMercator,numLODs:Se=24}=fe;if(!N$17(we)){const fe=[];if(_e)for(let ve=0;ve<_e.length;ve++){const be=_e[ve];fe.push(new Ng({level:ve,scale:be,resolution:be}))}else{let ve=5e-4;for(let _e=Se-1;_e>=0;_e--)fe.unshift(new Ng({level:_e,scale:ve,resolution:ve})),ve*=2}return new zg({dpi:96,lods:fe,origin:new Yo(0,0,we),size:[be,be],spatialReference:we})}const Te=s$46(we),Ee=fe.origin?new Yo({x:fe.origin.x,y:fe.origin.y,spatialReference:we}):new Yo(Te?{x:Te.origin[0],y:Te.origin[1],spatialReference:we}:{x:0,y:0,spatialReference:we}),Ce=1/(39.37*W$L(we)*96),Oe=[];if(_e)for(let Re=0;Re<_e.length;Re++){const fe=_e[Re],ve=fe*Ce;Oe.push(new Ng({level:Re,scale:fe,resolution:ve}))}else{let fe=A$1B(we)?512/be*591657527.5917094:256/be*591657527.591555;const _e=Math.ceil(Se/ve);Oe.push(new Ng({level:0,scale:fe,resolution:fe*Ce}));for(let be=1;be<_e;be++){const _e=fe/2**ve,we=_e*Ce;Oe.push(new Ng({level:be,scale:_e,resolution:we})),fe=_e}}return new zg({dpi:96,lods:Oe,origin:Ee,size:[be,be],spatialReference:we})}constructor(fe){super(fe),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:fe,origin:ve}=this;if(fe&&ve){const _e=s$46(fe);return fe.isWrappable&&!!_e&&Math.abs(_e.origin[0]-ve.x)<=_e.dx}return!1}readOrigin(fe,ve){return Yo.fromJSON({spatialReference:ve.spatialReference,...fe})}set lods(fe){let ve=0,_e=0;const be=[],we=this._levelToLOD={};fe&&(ve=-1/0,_e=1/0,fe.forEach((fe=>{be.push(fe.scale),ve=fe.scale>ve?fe.scale:ve,_e=fe.scale<_e?fe.scale:_e,we[fe.level]=fe}))),this._set("scales",be),this._set("lods",fe),this._initializeUpsampleLevels()}readSize(fe,ve){return[ve.cols,ve.rows]}writeSize(fe,ve){ve.cols=fe[0],ve.rows=fe[1]}zoomToScale(fe){const ve=this.scales;if(fe<=0)return ve[0];if(fe>=ve.length-1)return ve[ve.length-1];const _e=Math.floor(fe),be=_e+1;return ve[_e]/(ve[_e]/ve[be])**(fe-_e)}scaleToZoom(fe){const ve=this.scales,_e=ve.length-1;let be=0;for(;be<_e;be++){const _e=ve[be],we=ve[be+1];if(_e<=fe)return be;if(we===fe)return be+1;if(_e>fe&&we<fe)return be+Math.log(_e/fe)/Math.log(_e/we)}return be}tileAt(fe,ve,_e,be){const we=this.lodAt(fe);if(!we)return null;let Se,Te;if("number"==typeof ve)Se=ve,Te=_e;else if(G$Y(ve.spatialReference,this.spatialReference))Se=ve.x,Te=ve.y,be=_e;else{const fe=g$2s(ve,this.spatialReference);if(null==fe)return null;Se=fe.x,Te=fe.y,be=_e}const Ee=we.resolution*this.size[0],Ce=we.resolution*this.size[1];return be||(be=new Fg(null,0,0,0,u$3J())),be.level=fe,be.row=Math.floor((this.origin.y-Te)/Ce+.001),be.col=Math.floor((Se-this.origin.x)/Ee+.001),this.updateTileInfo(be),be}updateTileInfo(fe,ve=zg.ExtrapolateOptions.NONE){let _e=this.lodAt(fe.level);if(!_e&&ve===zg.ExtrapolateOptions.POWER_OF_TWO){const ve=this.lods[this.lods.length-1];ve.level<fe.level&&(_e=ve)}if(!_e)return;const be=fe.level-_e.level,we=_e.resolution*this.size[0]/2**be,Se=_e.resolution*this.size[1]/2**be;fe.id=`${fe.level}/${fe.row}/${fe.col}`,fe.extent||(fe.extent=u$3J()),fe.extent[0]=this.origin.x+fe.col*we,fe.extent[1]=this.origin.y-(fe.row+1)*Se,fe.extent[2]=fe.extent[0]+we,fe.extent[3]=fe.extent[1]+Se}upsampleTile(fe){const ve=this._upsampleLevels[fe.level];return!(!ve||-1===ve.parentLevel||(fe.level=ve.parentLevel,fe.row=Math.floor(fe.row/ve.factor+.001),fe.col=Math.floor(fe.col/ve.factor+.001),this.updateTileInfo(fe),0))}getTileBounds(fe,ve){const _e=this.lodAt(ve.level);if(null==_e)return null;const{resolution:be}=_e,we=be*this.size[0],Se=be*this.size[1];return fe[0]=this.origin.x+ve.col*we,fe[1]=this.origin.y-(ve.row+1)*Se,fe[2]=fe[0]+we,fe[3]=fe[1]+Se,fe}lodAt(fe){var ve;return(null==(ve=this._levelToLOD)?void 0:ve[fe])??null}clone(){return zg.fromJSON(this.write({}))}getCompatibleForVTL(fe){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===fe)return null;const ve=(512===this.size[0]&&256===fe?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===fe&&0===ve)return this;const _e=[],be=this.lods.length-ve;for(let we=0;we<be;we++){const fe=we+ve,{scale:be,resolution:Se}=fe>=0?this.lods[fe]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};_e.push(new Ng({level:we,scale:be,resolution:Se}))}return new zg({size:[fe,fe],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:_e})}_initializeUpsampleLevels(){const fe=this.lods;this._upsampleLevels=[];let ve=null;for(let _e=0;_e<fe.length;_e++){const be=fe[_e];this._upsampleLevels[be.level]={parentLevel:ve?ve.level:-1,factor:ve?ve.resolution/be.resolution:0},ve=be}}};e$4o([y$2v({type:Number,json:{write:!0}})],Ug.prototype,"compressionQuality",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],Ug.prototype,"dpi",void 0),e$4o([y$2v({type:String,json:{read:kg.read,write:kg.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ug.prototype,"format",void 0),e$4o([y$2v({readOnly:!0})],Ug.prototype,"isWrappable",null),e$4o([y$2v({type:Yo,json:{write:!0}})],Ug.prototype,"origin",void 0),e$4o([o$40("origin")],Ug.prototype,"readOrigin",null),e$4o([y$2v({type:[Ng],value:null,json:{write:!0}})],Ug.prototype,"lods",null),e$4o([y$2v({readOnly:!0})],Ug.prototype,"scales",void 0),e$4o([y$2v({cast:fe=>Array.isArray(fe)?fe:"number"==typeof fe?[fe,fe]:[256,256]})],Ug.prototype,"size",void 0),e$4o([o$40("size",["rows","cols"])],Ug.prototype,"readSize",null),e$4o([r$3s("size",{cols:{type:Ci},rows:{type:Ci}})],Ug.prototype,"writeSize",null),e$4o([y$2v({type:zo,json:{write:!0}})],Ug.prototype,"spatialReference",void 0),Ug=zg=e$4o([a$4y("esri.layers.support.TileInfo")],Ug),function(fe){var ve;(ve=fe.ExtrapolateOptions||(fe.ExtrapolateOptions={}))[ve.NONE=0]="NONE",ve[ve.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ug||(Ug={}));const Vg=Ug;let Bg=class f2{constructor(fe){const ve=f2.checkUnsupported(fe);if(null!=ve)throw ve;const _e=fe;this.spatialReference=_e.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=A$1B(this.spatialReference),this.origin=[_e.origin.x,_e.origin.y],this.pixelSize=_e.size[0],this.dpi=_e.dpi;const be=_e.lods.reduce(((fe,ve)=>(ve.level<fe.minLod.level&&(fe.minLod=ve),fe.max=Math.max(fe.max,ve.level),fe)),{minLod:_e.lods[0],max:-1/0}),we=be.minLod,Se=2**we.level;let Te=we.resolution*Se,Ee=we.scale*Se;this.levels=new Array(be.max+1);for(let Ce=0;Ce<this.levels.length;Ce++)this.levels[Ce]={resolution:Te,scale:Ee,tileSize:[Te*_e.size[0],Te*_e.size[1]]},Te/=2,Ee/=2}clone(){return new f2(this.toTileInfo())}toTileInfo(){return new Vg({dpi:this.dpi,origin:new Yo({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((fe,ve)=>new Ng({level:ve,scale:fe.scale,resolution:fe.resolution})))})}getExtent(fe,ve,_e,be){const we=this.levels[fe],Se=we.tileSize[0],Te=we.tileSize[1];be[0]=this.origin[0]+_e*Se,be[2]=this.origin[0]+(_e+1)*Se,be[3]=this.origin[1]-ve*Te,be[1]=this.origin[1]-(ve+1)*Te}convertExtentToRadians(fe,ve){this._isWebMercator?(ve[0]=p$4R(fe[0]),ve[1]=f$38(fe[1]),ve[2]=p$4R(fe[2]),ve[3]=f$38(fe[3])):this._isGCS&&(ve[0]=h$2U(fe[0]),ve[1]=h$2U(fe[1]),ve[2]=h$2U(fe[2]),ve[3]=h$2U(fe[3]))}getExtentGeometry(fe,ve,_e,be=new aa){return this.getExtent(fe,ve,_e,jg),be.spatialReference=this.spatialReference,be.xmin=jg[0],be.ymin=jg[1],be.xmax=jg[2],be.ymax=jg[3],be.zmin=void 0,be.zmax=void 0,be}ensureMaxLod(fe){if(null==fe)return!1;let ve=!1;for(;this.levels.length<=fe;){const{resolution:fe,scale:_e}=this.levels[this.levels.length-1],be=fe/2*this.pixelSize;this.levels.push({resolution:fe/2,scale:_e/2,tileSize:[be,be]}),ve=!0}return ve}capMaxLod(fe){this.levels.length>fe+1&&(this.levels.length=fe+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(fe){return this.levels[0].scale/2**fe}levelAtScale(fe){const ve=this.levels[0].scale;return fe>=ve?0:Math.log(ve/fe)*Math.LOG2E}resolutionAtLevel(fe){return this.levels[0].resolution/2**fe}compatibleWith(fe,ve=1/0){if(f2.checkUnsupported(fe))return!1;const _e=new f2(fe);if(!_e.spatialReference.equals(this.spatialReference))return!1;if(_e.pixelSize!==this.pixelSize)return!1;const be=Math.min(this.levels.length-1,_e.levels.length-1,ve),we=this.levels[be].resolution;let Se=.5*we;return!(!F$1b(_e.origin[0],this.origin[0],Se)||!F$1b(_e.origin[1],this.origin[1],Se))&&(Se=.5*we/2**be/this.pixelSize*12,F$1b(we,_e.levels[be].resolution,Se))}rootTilesInExtent(fe,ve=null,_e=1/0){const be=new Array,we=this.levels[0].tileSize;if(null==fe||0===we[0]||0===we[1])return be;f2.computeRowColExtent(fe,we,this.origin,jg);let Se=jg[1],Te=jg[3],Ee=jg[0],Ce=jg[2];const Oe=Ce-Ee,Re=Te-Se;if(Oe*Re>_e){const fe=Math.floor(Math.sqrt(_e));Re>fe&&(Se=Se+Math.floor(.5*Re)-Math.floor(.5*fe),Te=Se+fe),Oe>fe&&(Ee=Ee+Math.floor(.5*Oe)-Math.floor(.5*fe),Ce=Ee+fe)}for(let De=Se;De<Te;De++)for(let fe=Ee;fe<Ce;fe++)be.push([0,De,fe]);return null!=ve&&(ve[0]=this.origin[0]+Ee*we[0],ve[1]=this.origin[1]-Te*we[1],ve[2]=this.origin[0]+Ce*we[0],ve[3]=this.origin[1]-Se*we[1]),be}static computeRowColExtent(fe,ve,_e,be){const we=.001*(fe[2]-fe[0]+(fe[3]-fe[1]));be[0]=Math.max(0,Math.floor((fe[0]+we-_e[0])/ve[0])),be[2]=Math.max(0,Math.ceil((fe[2]-we-_e[0])/ve[0])),be[1]=Math.max(0,Math.floor((_e[1]-fe[3]+we)/ve[1])),be[3]=Math.max(0,Math.ceil((_e[1]-fe[1]-we)/ve[1]))}static isPowerOfTwo(fe){const ve=fe.lods,_e=ve[0].resolution*2**ve[0].level;return!ve.some((fe=>!function y$2o(fe,ve,_e=1e-6){if(fe===ve)return!0;if(!Number.isFinite(fe)||!Number.isFinite(ve))return!1;const be=Math.abs(fe-ve),we=Math.abs(fe),Se=Math.abs(ve);if(0===fe||0===ve||we<1e-12&&Se<1e-12){if(be>.01*_e)return!1}else if(be/(we+Se)>_e)return!1;return!0}(fe.resolution,_e/2**fe.level)))}static hasGapInLevels(fe){const ve=fe.lods.map((fe=>fe.level));ve.sort(((fe,ve)=>fe-ve));for(let _e=1;_e<ve.length;_e++)if(ve[_e]!==ve[0]+_e)return!0;return!1}static tileSizeSupported(fe){const ve=fe.size[1];return ve===fe.size[0]&&!(ve&ve-1)&&ve>=128&&ve<=512}static hasOriginPerLODs(fe){const ve=fe.origin;return fe.lods.some((fe=>null!=fe.origin&&(fe.origin[0]!==ve.x||fe.origin[1]!==ve.y)))}static getMissingTileInfoError(){return new Ir("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(fe){return null==fe?x$1n():fe.lods.length<1?new Ir("tilingscheme:generic","Tiling scheme must have at least one level"):f2.isPowerOfTwo(fe)?f2.hasGapInLevels(fe)?new Ir("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):f2.tileSizeSupported(fe)?f2.hasOriginPerLODs(fe)?new Ir("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new Ir("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new Ir("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(fe,ve){const _e=fe[2]-fe[0],be=fe[3]-fe[1],we=W$L(ve),Se=1.2*Math.max(_e,be),Te=Se/256,Ee=Te*we*(96/.0254),Ce=new f2(new Vg({size:[256,256],origin:new Yo({x:fe[0]-.5*(Se-_e),y:fe[3]+.5*(Se-be)}),lods:[new Ng({level:0,resolution:Te,scale:Ee})],spatialReference:ve}));return Ce.ensureMaxLod(20),Ce}static makeWebMercatorAuxiliarySphere(fe){const ve=new f2(f2.WebMercatorAuxiliarySphereTileInfo);return ve.ensureMaxLod(fe),ve}static makeGCSWithTileSize(fe,ve=256,_e=16){const be=256/ve,we=new f2(new Vg({size:[ve,ve],origin:new Yo({x:-180,y:90,spatialReference:fe}),spatialReference:fe,lods:[new Ng({level:0,resolution:.703125*be,scale:295497598.570834*be})]}));return we.ensureMaxLod(_e),we}get test(){}};function x$1n(){return new Ir("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Bg.WebMercatorAuxiliarySphereTileInfo=new Vg({size:[256,256],origin:new Yo({x:-20037508.342787,y:20037508.342787,spatialReference:zo.WebMercator}),spatialReference:zo.WebMercator,lods:[new Ng({level:0,resolution:156543.03392800014,scale:591657527.591555})]}),Bg.WebMercatorAuxiliarySphere=Bg.makeWebMercatorAuxiliarySphere(19);const jg=u$3J(),Gg=64,Hg=512,qg=A$1F(_n/10),Wg=u$3J();Bg.WebMercatorAuxiliarySphere.getExtent(0,0,0,Wg);const Yg=u$3J([-180,-90,180,90]),Zg=4;let Xg=class m5 extends La.EventedAccessor{constructor(fe){super(fe),this.demResolution={min:-1,max:-1},this.noDataValue=qg}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})))}get extent(){const fe=this.view.basemapTerrain;if(null==(null==fe?void 0:fe.extent)||null==fe.spatialReference)return null;const ve=c$4z(fe.extent,fe.spatialReference);return ve.zmin=fe.visibleElevationBounds.min,ve.zmax=fe.visibleElevationBounds.max,ve}get spatialReference(){var fe;return(null==(fe=this.view.basemapTerrain)?void 0:fe.spatialReference)??zo.WGS84}elevationAt(fe,ve){var _e;if(null==this.extent||!e$3S(this.extent,fe,ve)){const _e=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ar.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${fe}, ${ve}) is outside of the sampler extent (${_e})`),this.noDataValue}return(null==(_e=this.view.elevationProvider)?void 0:_e.getElevation(fe,ve,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(fe){return p$4m(fe.clone(),this)}};e$4o([y$2v({readOnly:!0})],Xg.prototype,"demResolution",void 0),e$4o([y$2v({readOnly:!0})],Xg.prototype,"extent",null),e$4o([y$2v({readOnly:!0})],Xg.prototype,"noDataValue",void 0),e$4o([y$2v()],Xg.prototype,"spatialReference",null),e$4o([y$2v({constructOnly:!0})],Xg.prototype,"view",void 0),Xg=e$4o([a$4y("esri.views.support.GroundViewElevationSampler")],Xg);const Jg=Xg;let Qg=class d3 extends zi{constructor(fe){super(fe),this.view=null,this.layerViews=new Wa}initialize(){this.addHandles(p$4J((()=>{var fe,ve;return null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.ground}),(fe=>fe.load()))),this.addHandles(this.layerViews.on("after-changes",(()=>this._layerViewsAfterChangesHandler())))}destroy(){this._set("view",null);for(const fe of this.layerViews)fe.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Jg({view:this.view}):null:null}get extent(){const fe=this.view;return fe&&"2d"!==fe.type&&fe.ready?Re$2(fe,fe.state.camera,fe.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some((fe=>fe.updating))}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map((fe=>d$3d((()=>fe.updating),(()=>this._updateUpdating()),Za))).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};e$4o([y$2v({readOnly:!0})],Qg.prototype,"elevationSampler",null),e$4o([y$2v({readOnly:!0})],Qg.prototype,"extent",null),e$4o([y$2v({type:Boolean,readOnly:!0})],Qg.prototype,"updating",null),e$4o([y$2v({constructOnly:!0})],Qg.prototype,"view",void 0),e$4o([y$2v({type:Wa,readOnly:!0})],Qg.prototype,"layerViews",void 0),e$4o([y$2v({readOnly:!0})],Qg.prototype,"suspended",null),Qg=e$4o([a$4y("esri.views.GroundView")],Qg);const Kg=Qg;let ev=class o2{constructor(fe,ve){this._owner=ve,this._properties={},this._afterDispatchHandle=null;for(const _e in fe){const ve=fe[_e],be=new zr(ve,void 0,void 0,2,2);this._properties[_e]={pool:be,acquired:[]}}this._afterDispatchHandle=U$1d((()=>this._release()))}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const fe in this._properties){const ve=this._properties[fe];for(const fe of ve.acquired)O$1w(fe)||ve.pool.release(fe);ve.pool.destroy(),ve.pool=null,ve.acquired=null}this._properties=null,this._owner=null}get(fe){const ve=this._owner._get(fe),_e=this._properties[fe];let be=_e.pool.acquire();for(_e.acquired.push(be);be===ve;)_e.acquired.push(be),be=_e.pool.acquire();return be}_release(){for(const fe in this._properties){const ve=this._properties[fe];let _e=0;for(const fe of ve.acquired)O$1w(fe)?ve.acquired[_e++]=fe:ve.pool.release(fe);ve.acquired.length=_e}}};const tv=has("mac")?"Meta":"Control",rv=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),r$2X=fe=>rv.has(fe);let iv=class e5{constructor(fe,ve=[]){this.eventType=fe,this.keyModifiers=ve}matches(fe){if(fe.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const ve=fe.modifiers;for(const _e of this.keyModifiers)if(!ve.has(_e))return!1;return!0}},nv=class t12{constructor(fe){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=fe}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const fe in this._incoming){const ve=this._incoming[fe];for(const fe of ve)this._incomingEventMatches.push(fe.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((fe=>fe.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(fe){this._manager||(fe.setEventCallback((fe=>this._handleEvent(fe))),fe.setUninstallCallback((()=>this._onUninstall())),this._manager=fe)}onUninstall(){}registerIncoming(fe,ve,_e){let be;"function"==typeof ve?(_e=ve,be=[]):be=ve||[];const we="string"==typeof fe?new iv(fe,be):fe,h33=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},r65=fe=>{const ve=this._incoming[fe.match.eventType];if(ve){const _e=ve.indexOf(fe);ve.splice(_e,1),h33(),this._manager&&this._manager.updateDependencies()}},Se=new sv(we,_e,{onPause:r65,onRemove:r65,onResume:fe=>{const ve=this._incoming[fe.match.eventType];ve&&!ve.includes(fe)&&(ve.push(fe),h33(),this._manager&&this._manager.updateDependencies())}});let Te=this._incoming[we.eventType];return Te||(Te=[],this._incoming[we.eventType]=Te),Te.push(Se),h33(),this._manager&&this._manager.updateDependencies(),Se}registerOutgoing(fe){if(this._outgoing[fe])throw new Error("There is already a callback registered for this outgoing InputEvent: "+fe);const ve=new ov(fe,{onEmit:(fe,ve,_e,be)=>{var we;null==(we=this._manager)||we.emit(fe.eventType,ve,_e,be)},onRemove:fe=>{var ve;delete this._outgoing[fe.eventType],null==(ve=this._manager)||ve.updateDependencies()}});return this._outgoing[fe]=ve,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),ve}startCapturingPointer(fe){var ve;null==(ve=this._manager)||ve.setPointerCapture(fe,!0)}stopCapturingPointer(fe){var ve;null==(ve=this._manager)||ve.setPointerCapture(fe,!1)}refreshHasPendingInputs(){var fe;null==(fe=this._manager)||fe.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(fe){var ve;const _e=this._incoming[fe.type];if(_e)for(const be of _e)if(be.match.matches(fe)&&(null==(ve=be.callback)||ve.call(be,fe),fe.shouldStopPropagation()))break}},sv=class n6{constructor(fe,ve,_e){this.match=fe,this._callback=ve,this._handler=_e}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},ov=class i4{constructor(fe,ve){this.eventType=fe,this._removed=!1,this._handler=ve}emit(fe,ve,_e){this._removed||this._handler.onEmit(this,fe,ve,_e)}remove(){this._removed=!0,this._handler.onRemove(this)}},av=class s14 extends nv{constructor(fe){super(!0),this._onChange=fe,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",(fe=>{this._update(fe.data)}))}_update(fe){const ve="touch"===fe.native.pointerType?"touch":"mouse",{x:_e,y:be}=fe;ve===this._value&&this._x===_e&&this._y===be||(this._value=ve,this._x=_e,this._y=be,this._onChange(ve,_e,be))}},lv=class i5{constructor(fe,ve){this._observable=new Fa,this._value=fe,this._equalityFunction=ve}get value(){return s$4u(this._observable),this._value}set value(fe){this._equalityFunction(fe,this._value)||(this._value=fe,this._observable.notify())}mutate(fe){fe(this._value),this._observable.notify()}};function r$2W(fe,ve=h$2$){return new lv(fe,ve)}let cv=class i6 extends nv{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=r$2W(!1),this._onPointerAdd=({data:fe})=>{"touch"===fe.pointerType&&(this._activeTouchPointerIds.add(fe.native.pointerId),this._update())},this._onPointerRemove=({data:fe})=>{"touch"===fe.pointerType&&(this._activeTouchPointerIds.delete(fe.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},uv=class d4 extends zi{constructor(fe){super(fe),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=tv,this._latestPointerType="mouse",this._propertiesPool=new ev({latestPointerLocation:fv},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const fe=Object.keys(this._nameToGroup);for(const ve of fe)this.uninstallHandlers(ve);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some((fe=>fe.handler.hasPendingInputs))}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(fe,ve,_e=pv.INTERNAL){if(this._nameToGroup[fe])return;if(0===ve.length)return;const be={name:fe,handlers:ve.map((fe=>({handler:fe,active:!0,removed:!1,priorityIndex:0,groupPriority:_e,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[fe]=be;for(let we=be.handlers.length-1;we>=0;we--){const fe=be.handlers[we];this._handlers.push(fe),fe.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(ve,_e,be,we,Se)=>{this._emitInputEvent(fe.priorityIndex+1,ve,_e,be,Se,we)},setPointerCapture:(ve,_e)=>{this._setPointerCapture(be,fe,ve,_e)},setEventCallback:ve=>{fe.eventCallback=ve},setUninstallCallback:ve=>{fe.uninstallCallback=ve},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(fe){const ve=this._nameToGroup[fe];ve?(ve.handlers.forEach((fe=>{var ve;fe.removed=!0,null==(ve=fe.uninstallCallback)||ve.call(fe)})),delete this._nameToGroup[fe],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ar.getLogger(this).error("There is no InputHandler group registered under the name `"+fe+"`")}hasHandlers(fe){return void 0!==this._nameToGroup[fe]}isModifierKeyDown(fe){return this._activeKeyModifiers&&this._activeKeyModifiers.has(fe)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const fe=new Set,ve=new Set;this._handlersPriority=[];for(let _e=this._handlers.length-1;_e>=0;_e--){const fe=this._handlers[_e];fe.priorityIndex=_e,this._handlersPriority.push(fe)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let _e=this._handlersPriority.length-1;_e>=0;_e--){const be=this._handlersPriority[_e];be.priorityIndex=_e;let we=be.handler.hasSideEffects;if(!we)for(const ve of be.handler.outgoingEventTypes)if(fe.has(ve)){we=!0;break}if(we)for(const _e of be.handler.incomingEventMatches){fe.add(_e.eventType);for(const fe of _e.keyModifiers)r$2X(fe)||ve.add(fe)}be.active=we}this._sourceEvents=fe,this._keyModifiers=ve,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(fe,ve,_e){this._latestPointerType=fe;const be=this._get("latestPointerLocation");if(null==be||be.x!==ve||be.y!==_e){const fe=this._propertiesPool.get("latestPointerLocation");fe.x=ve,fe.y=_e,this._set("latestPointerLocation",fe)}}_onEventReceived(fe,ve){if("pointer-capture-lost"===fe){const fe=ve;this._pointerCaptures.delete(fe.native.pointerId)}this._updateKeyModifiers(fe,ve);const _e=null!=this.test.timestamp?this.test.timestamp:ve.native?ve.native.timestamp:void 0,be=ve.native?ve.native.cancelable:void 0;this._emitInputEventFromSource(fe,ve,_e,be)}_updateKeyModifiers(fe,ve){if(!ve)return;let _e=!1;const r65=()=>{if(!_e){const fe=new Set;this._activeKeyModifiers.forEach((ve=>{fe.add(ve)})),this._activeKeyModifiers=fe,_e=!0}},n52=(fe,ve)=>{ve&&!this._activeKeyModifiers.has(fe)?(r65(),this._activeKeyModifiers.add(fe)):!ve&&this._activeKeyModifiers.has(fe)&&(r65(),this._activeKeyModifiers.delete(fe))};if("key-down"===fe||"key-up"===fe){const _e=ve.key;this._keyModifiers.has(_e)&&n52(_e,"key-down"===fe)}const be=ve.native;n52("Alt",!(!be||!be.altKey)),n52("Control",!(!be||!be.ctrlKey)),n52("Ctrl",!(!be||!be.ctrlKey)),n52("Shift",!(!be||!be.shiftKey)),n52("Meta",!(!be||!be.metaKey)),n52("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new av(((fe,ve,_e)=>this._setLatestPointer(fe,ve,_e))),this._multiTouchHandler=new cv,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],pv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,pv.INTERNAL)}_setPointerCapture(fe,ve,_e,be){const we=fe.name+"-"+ve.priorityIndex,Se=this._pointerCaptures.get(_e.pointerId)||new Set;this._pointerCaptures.set(_e.pointerId,Se),be?(Se.add(we),1===Se.size&&this.eventSource&&this.eventSource.setPointerCapture(_e,!0)):Se.has(we)&&(Se.delete(we),0===Se.size&&(this._pointerCaptures.delete(_e.pointerId),this.eventSource&&this.eventSource.setPointerCapture(_e,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((fe=>!fe.removed)),this.updateDependencies()}_emitInputEventFromSource(fe,ve,_e,be){this._emitInputEvent(0,fe,ve,_e,be)}_emitInputEvent(fe,ve,_e,be,we,Se){const Te=void 0!==be?be:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),Ee=void 0!==we&&we,Ce={event:new hv(ve,_e,Te,Se||this._activeKeyModifiers,Ee),priorityIndex:fe};this._currentPropagation?this._currentPropagation.events.push(Ce):this._doNewPropagation(Ce)}_doNewPropagation(fe){this._currentPropagation={events:new el,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:fe.event.timestamp},this._currentPropagation.events.push(fe),this._continuePropagation()}_continuePropagation(){var fe,ve,_e;this._paused=!1;const be=this._currentPropagation;if(be){for(;be.events.length>0;){const{event:we,priorityIndex:Se}=be.events.pop(),Te=null==(fe=we.data)?void 0:fe.eventId;if(null==Te||!this._stoppedPropagationEventIds.has(Te))for(be.currentHandler=this._handlersPriority[Se];be.currentHandler;){if(be.currentHandler.removed)be.needsHandlerGarbageCollect=!0;else{if(be.currentHandler.active&&!we.shouldStopPropagation()&&(null==(_e=(ve=be.currentHandler).eventCallback)||_e.call(ve,we)),we.shouldStopPropagation()){null!=Te&&this._stoppedPropagationEventIds.add(Te);break}if(we.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:we,priorityIndex:be.currentHandler.priorityIndex+1})}be.currentHandler=this._handlersPriority[be.currentHandler.priorityIndex+1]}}be.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(fe){const ve=new el;ve.push(fe);const _e=this._currentPropagation;if(_e){for(;_e.events.length;)ve.push(_e.events.pop());_e.events=ve,_e.currentHandler=null,this._paused=!0}}_compareHandlerPriority(fe,ve){if(fe.handler.hasSideEffects!==ve.handler.hasSideEffects)return fe.handler.hasSideEffects?1:-1;if(fe.groupPriority!==ve.groupPriority)return fe.groupPriority>ve.groupPriority?-1:1;for(const _e of fe.handler.incomingEventMatches)for(const fe of ve.handler.incomingEventMatches){if(_e.eventType!==fe.eventType)continue;const ve=_e.keyModifiers.filter((ve=>fe.keyModifiers.includes(ve)));if(ve.length===_e.keyModifiers.length!=(ve.length===fe.keyModifiers.length))return _e.keyModifiers.length>fe.keyModifiers.length?-1:1}return fe.priorityIndex>ve.priorityIndex?-1:1}_sortHandlersPriority(fe){const ve=[];for(const _e of fe){let fe=0;for(;fe<ve.length&&this._compareHandlerPriority(_e,ve[fe])>=0;)fe++;ve.splice(fe,0,_e)}return ve}get debug(){const e76=fe=>{const ve=this._setPointerCapture;this._setPointerCapture=()=>{},fe(),this._setPointerCapture=ve};return{injectEvent:(fe,ve)=>{e76((()=>{this._onEventReceived(fe,ve)}))},disablePointerCapture:e76}}};e$4o([y$2v({readOnly:!0})],uv.prototype,"hasPendingInputs",null),e$4o([y$2v({constructOnly:!0})],uv.prototype,"eventSource",void 0),e$4o([y$2v({constructOnly:!0})],uv.prototype,"recognizers",void 0),e$4o([y$2v()],uv.prototype,"_latestPointerType",void 0),e$4o([y$2v()],uv.prototype,"latestPointerType",null),e$4o([y$2v()],uv.prototype,"multiTouchActive",null),e$4o([y$2v({readOnly:!0})],uv.prototype,"latestPointerLocation",void 0),e$4o([y$2v()],uv.prototype,"_paused",void 0),e$4o([y$2v({readOnly:!0})],uv.prototype,"updating",null),uv=e$4o([a$4y("esri.views.input.InputManager")],uv);let hv=class u2{constructor(fe,ve,_e,be,we){this.type=fe,this.data=ve,this.timestamp=_e,this.modifiers=be,this.cancelable=we,this._propagationState=dv.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=dv.STOPPED}shouldStopPropagation(){return!!(this._propagationState&dv.STOPPED)}async(fe){this._propagationState|=dv.PAUSED;const t84=(fe,ve)=>{this._propagationState&=~dv.PAUSED;const _e=this._resumeCallback;if(this._resumeCallback=null,_e&&_e(),ve)throw fe;return fe};return("function"==typeof fe?fe():fe).then((fe=>t84(fe,!1)),(fe=>t84(fe,!0)))}shouldPausePropagation(fe){return!!(this._propagationState&dv.PAUSED)&&(this._resumeCallback=fe,!0)}preventDefault(){this.data.native.preventDefault()}};var dv;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.STOPPED=1]="STOPPED",fe[fe.PAUSED=2]="PAUSED"}(dv||(dv={}));const pv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};const fv=class g2{};function m$32(fe){return null!=fe&&"open"in fe&&"declaredClass"in fe}function f$2w(fe){return null!=fe&&"declaredClass"in fe&&"dockOptions"in fe}const y$1Q=fe=>{let ve=class extends fe{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([d$3d((()=>[this.ui,this.popup]),(([fe,ve],_e)=>{const be="popup";if(_e){const[fe,ve]=_e;fe&&m$32(ve)&&(ve.view=null,f$2w(ve)&&fe.remove(ve,be))}fe&&m$32(ve)&&(ve.view=this,f$2w(ve)&&fe.add(ve,{key:be,position:"manual",internal:!0}))}),Xa),this.on("click",(fe=>{this.popup&&this.popupEnabled&&("mouse"!==fe.pointerType||0===fe.button)&&(m$32(this.popup)?this.popup.viewModel.handleViewClick(fe):fe.async((async()=>{await this.setupPopup(),m$32(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(fe)})))}),pv.WIDGET)]),w$1T((()=>this.ready&&this.popupEnabled&&!this.updating)).then((()=>{zt((()=>import("./Popup-BfGhmo2X.js")),__vite__mapDeps([64,1,65,66,4,67,34,18,19,32,33,68]))}))}destroy(){this.destroyed||this.closePopup()}async openPopup(fe){if(m$32(this.popup))return this.popup.open(fe);try{if(await this.setupPopup(),!this.popup)return void ar.getLogger(this).error(new Ir("view:null-popup","Popup is null and can't be opened"));this.popup.open(fe)}catch{}}closePopup(){var fe;null==(fe=this._popupSetupTask)||fe.abort(),m$32(this.popup)&&this.popup.close()}async fetchPopupFeatures(fe,ve){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(fe,ve),ve)}async setupPopup(){var fe;if(null==(fe=this._popupSetupTask)||fe.abort(),this.popup&&!m$32(this.popup))return this._popupSetupTask=d$3e((async fe=>{const{default:ve}=await zt((()=>import("./Popup-BfGhmo2X.js")),__vite__mapDeps([64,1,65,66,4,67,34,18,19,32,33,68]));if(s$4o(fe),!this.popup||m$32(this.popup))return;const _e=this.popup;delete _e.open,delete _e.close,this.popup=new ve(_e)})),this._popupSetupTask.promise}async _popupHitsToFeatures({location:fe,hits:ve},_e){const be=[],we=[];let Se=!1;const Te=function E$1Q(fe,ve){const _e=new AbortController,be=setTimeout((()=>_e.abort()),ve);return m$3R(fe,(()=>{_e.abort(),clearTimeout(be)})),{...fe,signal:_e.signal}}(_e,has("popup-view-fetch-timeout")??yv),c50=fe=>{const ve=we.at(-1);return ve&&ve.layerView===fe&&!Se?ve:(fe=>{const ve=new mv(fe);return we.push(ve),be.push(ve.promise),ve})(fe)};for(const Ce of ve)"graphic"in Ce?(c50(Ce.layerView).graphics.push(Ce.graphic),Se=!1):(be.push(Ce.layerView.fetchPopupFeaturesAtLocation(Ce.mapPoint,Te)),Se=!0);we.map((fe=>fe.resolve(Te)));const Ee=g$2F(be).then((fe=>fe.filter((fe=>!!fe)).flat()));return{pendingFeatures:be,allGraphicsPromise:Ee,location:fe}}async _getPopupHits(fe,ve){const{hits:_e,location:be}=await this.popupHitTest(fe);s$4o(ve);const we=[];for(const Se of _e)if("graphic"in Se){if(this._isValidPopupGraphic(Se.graphic,ve)){const fe=this._isValidPopupGraphicsLayerView(Se.layerView)?Se.layerView:void 0;we.push({graphic:Se.graphic,layerView:fe})}}else this._isValidPopupLocationLayerView(Se.layerView)&&we.push({mapPoint:Se.mapPoint,layerView:Se.layerView});return{hits:we,location:be}}_isValidPopupGraphic(fe,ve){return fe&&!!fe.getEffectivePopupTemplate(null==ve?void 0:ve.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(fe){return!fe||(!("layer"in fe)||!fe.suspended)&&"fetchPopupFeaturesFromGraphics"in fe}_isValidPopupLocationLayerView(fe){return(!("layer"in fe)||!fe.suspended)&&"fetchPopupFeaturesAtLocation"in fe}};return e$4o([y$2v({cast(fe){return!fe||m$32(fe)||"object"==typeof fe&&(fe.open=fe=>(a$4K(ar.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(fe)),fe.close=()=>(a$4K(ar.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),fe}})],ve.prototype,"popup",void 0),e$4o([y$2v()],ve.prototype,"popupEnabled",void 0),ve=e$4o([a$4y("esri.views.PopupView")],ve),ve};let mv=class g3{constructor(fe){this.layerView=fe,this._resolver=L$1h(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(fe){const{layerView:ve,graphics:_e,_resolver:be}=this;if(!ve)return be.resolve(_e),be.promise;let we;return ve.fetchPopupFeaturesFromGraphics(_e,fe).catch((fe=>(we=fe,null))).then((fe=>{fe?be.resolve(fe):be.reject(we)})),be.promise}};const yv=5e3;var gv,vv;(vv=gv||(gv={}))[vv.PENDING=0]="PENDING",vv[vv.RESOLVED=1]="RESOLVED",vv[vv.REJECTED=2]="REJECTED";let _v=class h2{constructor(){this._resolver=L$1h(),this._status=gv.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=gv.RESOLVED,this._cleanUp()}),(()=>{this._status=gv.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(fe){this._resolvingPromises.push(fe),this._tryResolve()}isResolved(){return this._status===gv.RESOLVED}isRejected(){return this._status===gv.REJECTED}isFulfilled(){return this._status!==gv.PENDING}abort(){this._resolver.reject(u$47())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const fe=L$1h(),ve=[...this._resolvingPromises,fe.promise],_e=this._allPromise=Promise.all(ve);_e.then((()=>{this.isFulfilled()||this._allPromise!==_e||this._resolver.resolve()}),(fe=>{this.isFulfilled()||this._allPromise!==_e||b$2g(fe)||this._resolver.reject(fe)})),fe.resolve()}};const n$3T=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this._promiseProps=new _v,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(fe,ve){return this._promiseProps.promise.then((()=>this)).then(fe,ve)}catch(fe){return this.when(null,fe)}addResolvingPromise(fe){fe&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in fe?fe.when():fe)}};return ve=e$4o([a$4y("esri.core.Promise")],ve),ve};let $v=class m6 extends(n$3T(zi)){};$v=e$4o([a$4y("esri.core.Promise")],$v);const bv="loaded",u$3c=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((fe=>{const ve=this.load.bind(this);this.load=_e=>{const be=new Promise(((fe,ve)=>{const be=w$22(_e,ve);this.destroyed&&ve(new Ir("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(fe,ve).finally((()=>{be&&be.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const fe=this._loadController=new AbortController;ve({signal:fe.signal})}return fe(),be}}))),this.when((()=>{this._set("loadStatus",bv),this._loadController=null}),(fe=>{this._set("loadStatus","failed"),this._set("loadError",fe),this._loadController=null}))}destroy(){this._loadController&&(this._loadController=e$4f(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===bv}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var fe;return this.isFulfilled()||(this._set("loadError",new Ir("load:cancelled","Cancelled")),null==(fe=this._loadController)||fe.abort(),this._promiseProps.abort()),this}};return e$4o([y$2v({readOnly:!0})],ve.prototype,"loaded",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"loadError",void 0),e$4o([y$2v({clonable:!1})],ve.prototype,"loadStatus",void 0),e$4o([y$2v({type:[Mi],readOnly:!0})],ve.prototype,"loadWarnings",null),ve=e$4o([a$4y("esri.core.Loadable")],ve),ve};let wv=class p2 extends(u$3c($v)){};var xv;wv=e$4o([a$4y("esri.core.Loadable")],wv),(xv=wv||(wv={})).LoadableMixin=u$3c,xv.isLoadable=function t84(fe){return!(!fe||!fe.load)};const Sv=wv;async function t$3u(fe,ve){return await fe.load(),a$3S(fe,ve)}async function a$3S(fe,ve){const _e=[],c50=(...fe)=>{for(const ve of fe)null!=ve&&(Array.isArray(ve)?c50(...ve):Wa.isCollection(ve)?ve.forEach((fe=>c50(fe))):Sv.isLoadable(ve)&&_e.push(ve))};ve(c50);let be=null;if(await async function p$4K(fe,ve,_e){return(await v$28(fe.map(((fe,be)=>ve.apply(_e,[fe,be]))))).map((fe=>fe.value))}(_e,(async fe=>{const ve=await _$1s(function i$3P(fe){return"loadAll"in fe&&"function"==typeof fe.loadAll}(fe)?fe.loadAll():fe.load());!1!==ve.ok||be||(be=ve)})),be)throw be.error;return fe}let Tv;var Ev;const Pv=new An({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Cv=Ev=class extends zi{constructor(fe){super(fe),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(fe){"asc"!==fe&&"desc"!==fe||this._set("sortOrder",fe)}clone(){return new Ev({categories:this.categories?a$4H(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(fe,ve){let _e=[];this.categories&&(_e=this.categories.map((fe=>Array.isArray(fe)?JSON.stringify(fe):fe)));let be="";if(this.extent){const fe=g$2s(this.extent,zo.WGS84);null!=fe&&(be=`${fe.xmin},${fe.ymin},${fe.xmax},${fe.ymax}`)}let we=this.query;!this.disableExtraQuery&&fe.extraQuery&&(we="("+we+")"+fe.extraQuery);const Se={categories:_e,bbox:be,q:we,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(Se.sortField=this.sortField.split(",").map((fe=>Pv.toJSON(fe.trim()))).join(","),Se.sortOrder=this.sortOrder),{query:{...ve,...Se}}}};e$4o([y$2v()],Cv.prototype,"categories",void 0),e$4o([y$2v()],Cv.prototype,"disableExtraQuery",void 0),e$4o([y$2v({type:aa})],Cv.prototype,"extent",void 0),e$4o([y$2v()],Cv.prototype,"filter",void 0),e$4o([y$2v()],Cv.prototype,"num",void 0),e$4o([y$2v()],Cv.prototype,"query",void 0),e$4o([y$2v()],Cv.prototype,"sortField",void 0),e$4o([y$2v()],Cv.prototype,"sortOrder",null),e$4o([y$2v()],Cv.prototype,"start",void 0),Cv=Ev=e$4o([a$4y("esri.portal.PortalQueryParams")],Cv);const Ov=Cv;var Av;let Mv=Av=class extends Pn{constructor(fe){super(fe),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var fe;const ve=this.url,_e=this.thumbnail;return ve&&_e&&this.portal?null==(fe=this.portal)?void 0:fe.normalizeUrl(`${ve}/info/${_e}?f=json`):null}get url(){var fe;const ve=null==(fe=this.portal)?void 0:fe.restUrl;return ve?ve+"/community/groups/"+this.id:null}fetchCategorySchema(fe){return this.portal.request(this.url+"/categorySchema",fe).then((ve=>{const _e=ve.categorySchema||[];return _e.some((fe=>"contentCategorySetsGroupQuery.LivingAtlas"===fe.source))?this._fetchCategorySchemaSet("LivingAtlas",fe):_e}))}fetchMembers(fe){return this.portal.request(this.url+"/users",fe)}getThumbnailUrl(fe){let ve=this.thumbnailUrl;return ve&&fe&&(ve+=`&w=${fe}`),ve}toJSON(){throw new Ir("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(fe){if(!fe)return null;if(fe.declaredClass)throw new Error("JSON object is already hydrated");const ve=new Av({sourceJSON:fe});return ve.read(fe),ve}queryItems(fe,ve){let _e=b$2d(Ov,fe);const be=this.portal;return parseFloat(be.currentVersion)>5?(_e=_e||new Ov,be.queryPortal(`/content/groups/${this.id}/search`,_e,"PortalItem",ve)):(_e=_e?_e.clone():new Ov,_e.query="group:"+this.id+(_e.query?" "+_e.query:""),be.queryItems(_e,ve))}_fetchCategorySchemaSet(fe,ve){const _e=this.portal;return _e.fetchSelf(_e.authMode,!0,ve).then((fe=>{const be=fe.contentCategorySetsGroupQuery;if(be){const fe=new Ov({disableExtraQuery:!0,num:1,query:be});return _e.queryGroups(fe,ve)}throw new Ir("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((_e=>{if(_e.total){const be=_e.results[0],we=new Ov({num:1,query:`typekeywords:"${fe}"`});return be.queryItems(we,ve)}throw new Ir("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((fe=>fe.total?fe.results[0].fetchData("json",ve).then((fe=>{const ve=null==fe?void 0:fe.categorySchema;return(null==ve?void 0:ve.length)?ve:[]})):[]))}};e$4o([y$2v()],Mv.prototype,"access",void 0),e$4o([y$2v({type:Date})],Mv.prototype,"created",void 0),e$4o([y$2v()],Mv.prototype,"description",void 0),e$4o([y$2v()],Mv.prototype,"id",void 0),e$4o([y$2v()],Mv.prototype,"isInvitationOnly",void 0),e$4o([y$2v({type:Date})],Mv.prototype,"modified",void 0),e$4o([y$2v()],Mv.prototype,"owner",void 0),e$4o([y$2v()],Mv.prototype,"portal",void 0),e$4o([y$2v()],Mv.prototype,"snippet",void 0),e$4o([y$2v()],Mv.prototype,"sortField",void 0),e$4o([y$2v()],Mv.prototype,"sortOrder",void 0),e$4o([y$2v()],Mv.prototype,"sourceJSON",void 0),e$4o([y$2v()],Mv.prototype,"tags",void 0),e$4o([y$2v()],Mv.prototype,"thumbnail",void 0),e$4o([y$2v({readOnly:!0})],Mv.prototype,"thumbnailUrl",null),e$4o([y$2v()],Mv.prototype,"title",void 0),e$4o([y$2v({readOnly:!0})],Mv.prototype,"url",null),Mv=Av=e$4o([a$4y("esri.portal.PortalGroup")],Mv);const Rv=Mv;let Iv=class e6 extends zi{constructor(fe){super(fe),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};e$4o([y$2v()],Iv.prototype,"nextQueryParams",void 0),e$4o([y$2v()],Iv.prototype,"queryParams",void 0),e$4o([y$2v()],Iv.prototype,"results",void 0),e$4o([y$2v()],Iv.prototype,"total",void 0),Iv=e$4o([a$4y("esri.portal.PortalQueryResult")],Iv);const Lv=Iv;let Dv=class p3 extends Pn{constructor(fe){super(fe),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var fe;const ve=null==(fe=this.portal)?void 0:fe.restUrl;return ve?`${ve}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Ir("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};e$4o([y$2v({type:Date})],Dv.prototype,"created",void 0),e$4o([y$2v()],Dv.prototype,"id",void 0),e$4o([y$2v()],Dv.prototype,"portal",void 0),e$4o([y$2v()],Dv.prototype,"title",void 0),e$4o([y$2v({readOnly:!0})],Dv.prototype,"url",null),e$4o([y$2v()],Dv.prototype,"username",void 0),Dv=e$4o([a$4y("esri.portal.PortalFolder")],Dv);const Nv=Dv;var Fv;let zv=Fv=class extends Pn{constructor(fe){super(fe),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const fe=this.url,ve=this.thumbnail;return fe&&ve?this.portal.normalizeUrl(`${fe}/info/${ve}?f=json`):null}get userContentUrl(){var fe;const ve=null==(fe=this.portal)?void 0:fe.restUrl;return ve?`${ve}/content/users/${this.username}`:null}get url(){var fe;const ve=null==(fe=this.portal)?void 0:fe.restUrl;return ve?`${ve}/community/users/${this.username}`:null}addItem(fe){const ve=fe&&fe.item,_e=null==fe?void 0:fe.data,be=null==fe?void 0:fe.folder,we={method:"post"};ve&&(we.query=ve.createPostQuery(),null!=_e&&("string"==typeof _e?we.query.text=_e:"object"==typeof _e&&(we.query.text=JSON.stringify(_e))));let Se=this.userContentUrl;return be&&(Se+="/"+("string"==typeof be?be:be.id)),this.portal.request(Se+"/addItem",we).then((fe=>(ve.id=fe.id,ve.portal=this.portal,ve.loaded?ve.reload():ve.load())))}async deleteItem(fe,ve=!1){let _e=this.userContentUrl;fe.ownerFolder&&(_e+="/"+fe.ownerFolder);const be=ve?{permanentDelete:!0}:{};await this.portal.request(_e+`/items/${fe.id}/delete`,{method:"post",query:be}),fe.id=null,fe.portal=null}async deleteItems(fe,ve=!1){fe=fe.concat();const _e=this.userContentUrl+"/deleteItems",be=[],we=fe.map((fe=>fe.id));if(we.length){const Se={method:"post",query:{items:we.join(","),permanentDelete:ve}},Te=await this.portal.request(_e,Se);for(const ve of Te.results){const _e=fe.find((fe=>ve.itemId===fe.id)),we=ve.success;let Se=null;we?(_e.id=null,_e.portal=null):ve.error&&(Se=new Ir("portal:delete-item-failed",ve.error.message,ve.error)),be.push({item:_e,success:we,error:Se})}}return be}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then((fe=>{let ve;return ve=fe&&fe.folders?fe.folders.map((fe=>{const ve=Nv.fromJSON(fe);return ve.portal=this.portal,ve})):[],ve}))}fetchGroups(){return this.portal.request(this.url??"").then((fe=>{let ve;return ve=fe&&fe.groups?fe.groups.map((fe=>{const ve=Rv.fromJSON(fe);return ve.portal=this.portal,ve})):[],ve}))}async fetchItems(fe){fe??(fe={});let ve=this.userContentUrl??"";fe.folder&&(ve+="/"+fe.folder.id);const{default:_e}=await zt((()=>Promise.resolve().then((()=>s_))),void 0),be={folders:!1,inRecycleBin:!!fe.inRecycleBin||null,foldersContent:!(fe.folder||!fe.includeSubfolderItems)||null,num:fe.num||10,start:fe.start||1,sortField:fe.sortField||"created",sortOrder:fe.sortOrder||"asc"},we=await this.portal.request(ve,{query:be});let Se;return(null==we?void 0:we.items)?(Se=we.items.map((fe=>{const ve=_e.fromJSON(fe);return ve.portal=this.portal,ve})),await Promise.all(Se.map((fe=>fe.load()))),{items:Se,nextStart:we.nextStart,total:we.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then((fe=>fe.tags))}getThumbnailUrl(fe){let ve=this.thumbnailUrl;return ve&&fe&&(ve+=`&w=${fe}`),ve}queryFavorites(fe){return this.favGroupId?(this._favGroup||(this._favGroup=new Rv({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(fe)):Promise.reject(new Ir("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(fe,ve){const _e=this.userContentUrl,be=ve?{folderID:"string"==typeof ve?ve:ve.id}:null;await this.portal.request(_e+`/items/${fe.id}/restore`,{method:"post",query:be})}toJSON(){throw new Ir("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(fe){if(!fe)return null;if(fe.declaredClass)throw new Error("JSON object is already hydrated");const ve=new Fv({sourceJSON:fe});return ve.read(fe),ve}};e$4o([y$2v()],zv.prototype,"access",void 0),e$4o([y$2v({type:Date})],zv.prototype,"created",void 0),e$4o([y$2v()],zv.prototype,"culture",void 0),e$4o([y$2v()],zv.prototype,"description",void 0),e$4o([y$2v()],zv.prototype,"email",void 0),e$4o([y$2v()],zv.prototype,"favGroupId",void 0),e$4o([y$2v()],zv.prototype,"fullName",void 0),e$4o([y$2v({type:Date})],zv.prototype,"modified",void 0),e$4o([y$2v()],zv.prototype,"orgId",void 0),e$4o([y$2v()],zv.prototype,"portal",void 0),e$4o([y$2v()],zv.prototype,"preferredView",void 0),e$4o([y$2v()],zv.prototype,"privileges",void 0),e$4o([y$2v()],zv.prototype,"region",void 0),e$4o([y$2v()],zv.prototype,"role",void 0),e$4o([y$2v()],zv.prototype,"roleId",void 0),e$4o([y$2v()],zv.prototype,"sourceJSON",void 0),e$4o([y$2v()],zv.prototype,"thumbnail",void 0),e$4o([y$2v({readOnly:!0})],zv.prototype,"thumbnailUrl",null),e$4o([y$2v()],zv.prototype,"units",void 0),e$4o([y$2v({readOnly:!0})],zv.prototype,"userContentUrl",null),e$4o([y$2v({readOnly:!0})],zv.prototype,"url",null),e$4o([y$2v()],zv.prototype,"username",void 0),e$4o([y$2v()],zv.prototype,"userLicenseTypeId",void 0),e$4o([y$2v()],zv.prototype,"userType",void 0),zv=Fv=e$4o([a$4y("esri.portal.PortalUser")],zv);const kv=zv;var Uv;let Vv;const Bv={PortalGroup:()=>Promise.resolve({default:Rv}),PortalItem:()=>zt((()=>Promise.resolve().then((()=>s_))),void 0),PortalUser:()=>Promise.resolve({default:kv})};let jv=Uv=class extends(u$3V(Sv)){constructor(fe){super(fe),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ir.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(fe){return"string"==typeof fe?{url:fe}:fe}destroy(){Hv.unregister(this),this.defaultBasemap=u$4d(this.defaultBasemap),this.defaultDevBasemap=u$4d(this.defaultDevBasemap),this.defaultVectorBasemap=u$4d(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=l$4E(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(fe){if(fe)for(const ve of fe)ir.request.trustedServers.includes(ve)||ir.request.trustedServers.push(ve);return fe}readDefaultBasemap(fe){return this._readBasemap(fe)}readDefaultDevBasemap(fe){return this._readBasemap(fe)}readDefaultVectorBasemap(fe){return this._readBasemap(fe)}get extraQuery(){var fe;const ve=!(null==(fe=this.user)?void 0:fe.orgId)||this.canSearchPublic;return this.id&&!ve?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let fe=this.url;if(fe){const ve=fe.indexOf("/sharing");fe=ve>0?fe.substring(0,ve):this.url.replace(/\/+$/,""),fe+="/sharing/rest"}return fe}get thumbnailUrl(){const fe=this.restUrl,ve=this.thumbnail;return fe&&ve?this._normalizeSSL(fe+"/portals/self/resources/"+ve):null}readUrlKey(fe){return fe?fe.toLowerCase():fe}readUser(fe){let ve=null;return fe&&(ve=kv.fromJSON(fe),ve.portal=this),ve}load(fe){const ve=zt((()=>Promise.resolve().then((()=>v_))),void 0).then((({default:ve})=>{s$4o(fe),Vv=ve})).then((()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,fe))).then((fe=>{var ve;if(Ts){const fe=Ts;this.credential=fe.findCredential(this.restUrl),this.credential||this.authMode!==Uv.AUTH_MODE_AUTO&&this.authMode!==Uv.AUTH_MODE_NO_PROMPT||(null==(ve=this._esriIdCredentialCreateHandle)||ve.remove(),this._esriIdCredentialCreateHandle=fe.on("credential-create",function w$1w(fe){const ve=Ts;return()=>{const _e=fe.deref();_e&&ve.findCredential(_e.restUrl)&&_e.signIn().catch((()=>{}))}}(new WeakRef(this))),Hv.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=fe,this.read(fe)}));return this.addResolvingPromise(ve),Promise.resolve(this)}async createElevationLayers(){await this.load();const fe=this._getHelperService("defaultElevationLayers"),ve=(await zt((async()=>{const{default:fe}=await import("./ElevationLayer-Cl972X1d.js");return{default:fe}}),__vite__mapDeps([69,70,71]))).default;return fe?fe.map((fe=>new ve({id:fe.id,url:fe.url}))):[]}async fetchBasemaps(fe,ve){const _e=await this._fetchBasemaps(fe,ve);if(!0===(null==ve?void 0:ve.include3d)&&!1!==this.use3dBasemaps){const be=await this._fetchBasemaps3D(fe,ve);_e.unshift(...be)}return _e}fetchCategorySchema(fe){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",fe).then((fe=>fe.categorySchema)):c$4_(fe)?Promise.reject(u$47()):Promise.resolve([])}fetchFeaturedGroups(fe){const ve=this.featuredGroups,_e=new Ov({num:100,sortField:"title"});if(null==ve?void 0:ve.length){const be=[];for(const fe of ve)be.push(`(title:"${fe.title}" AND owner:${fe.owner})`);return _e.query=be.join(" OR "),this.queryGroups(_e,fe).then((fe=>fe.results))}return c$4_(fe)?Promise.reject(u$47()):Promise.resolve([])}fetchRegions(fe){var ve;const _e=(null==(ve=this.user)?void 0:ve.culture)||this.culture||c$4r();return this.request(this.restUrl+"/portals/regions",{...fe,query:{culture:_e}})}fetchSettings(fe){var ve;const _e=(null==(ve=this.user)?void 0:ve.culture)||this.culture||c$4r();return this.request(this.restUrl+"/portals/self/settings",{...fe,query:{culture:_e}})}static getDefault(){return function n$3S(fe){return Tv&&!Tv.destroyed||(Tv=fe()),Tv}((()=>new Uv))}queryGroups(fe,ve){return this.queryPortal("/community/groups",fe,"PortalGroup",ve)}queryItems(fe,ve){return this.queryPortal("/search",fe,"PortalItem",ve)}queryUsers(fe,ve){return fe.sortField||(fe.sortField="username"),this.queryPortal("/community/users",fe,"PortalUser",ve)}fetchSelf(fe=this.authMode,ve=!1,_e){const be=this.restUrl+"/portals/self",we={authMode:fe,query:{culture:c$4r().toLowerCase()},withCredentials:!0,..._e};return"auto"===we.authMode&&(we.authMode="no-prompt"),ve&&(we.query.default=!0),this.request(be,we)}queryPortal(fe,ve,_e,be){const we=b$2d(Ov,ve),i52=ve=>this.request(this.restUrl+fe,{...we.toRequestOptions(this),...be}).then((fe=>{const _e=we.clone();return _e.start=fe.nextStart,new Lv({nextQueryParams:_e,queryParams:we,total:fe.total,results:Uv._resultsToTypedArray(ve,{portal:this},fe,be)})})).then((fe=>Promise.all(fe.results.map((ve=>"function"==typeof ve.when?ve.when():fe))).then((()=>fe),(ve=>(a$4D(ve),fe)))));return _e&&Bv[_e]?Bv[_e]().then((({default:fe})=>(s$4o(be),i52(fe)))):i52()}signIn(){if(this.authMode===Uv.AUTH_MODE_ANONYMOUS||this.authMode===Uv.AUTH_MODE_NO_PROMPT&&!Ts)return Promise.reject(new Ir("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e76=fe=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(fe||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=fe,this.fetchSelf("immediate")))):this.user&&this.credential===fe?null:(this.credential=fe,this.fetchSelf("immediate")))).then((fe=>{fe&&(this.sourceJSON=fe,this.read(fe))}));return Ts?Ts.getCredential(this.restUrl,{prompt:this.authMode!==Uv.AUTH_MODE_NO_PROMPT}).then((fe=>e76(fe))):e76(this.credential)}normalizeUrl(fe){var ve;const _e=null==(ve=this.credential)?void 0:ve.token;return this._normalizeSSL(_e?fe+(fe.includes("?")?"&":"?")+"token="+_e:fe)}requestToTypedArray(fe,ve,_e){return this.request(fe,ve).then((fe=>{const ve=Uv._resultsToTypedArray(_e,{portal:this},fe);return Promise.all(ve.map((ve=>"function"==typeof ve.when?ve.when():fe))).then((()=>ve),(()=>ve))}))}request(fe,ve={}){const _e={f:"json",...ve.query},{authMode:be=(this.authMode===Uv.AUTH_MODE_ANONYMOUS||this.authMode===Uv.AUTH_MODE_NO_PROMPT?this.authMode:"auto"),body:we=null,cacheBust:Se=!1,method:Te="auto",responseType:Ee="json",signal:Ce}=ve,Oe={authMode:be,body:we,cacheBust:Se,method:Te,query:_e,responseType:Ee,timeout:0,signal:Ce};return ve.withCredentials&&(Oe.withCredentials=!0),U$1a(this._normalizeSSL(fe),Oe).then((fe=>fe.data))}toJSON(){throw new Ir("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(fe){if(!fe)return null;if(fe.declaredClass)throw new Error("JSON object is already hydrated");return new Uv({sourceJSON:fe})}_getHelperService(fe){const ve=this.helperServices&&this.helperServices[fe];if(!ve)throw new Ir("portal:service-not-found",`The \`helperServices\` do not include an entry named "${fe}"`);return ve}async _fetchBasemaps(fe,ve){const _e=new Ov;_e.query=fe||(ir.apiKey&&c$4K(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),_e.disableExtraQuery=!0;const be=await this.queryGroups(_e,ve);if(!be.total)return[];const we=be.results[0];_e.num=100,_e.query='type:"Web Map" -type:"Web Application"',_e.sortField=we.sortField||"name",_e.sortOrder=we.sortOrder||"desc";const Se=await we.queryItems(_e,ve);return Se.total?Se.results.filter((fe=>"Web Map"===fe.type)).map((fe=>new Vv({portalItem:fe}))):[]}async _fetchBasemaps3D(fe,ve){const _e=fe||this.basemapGalleryGroupQuery3D;if(!_e)return[];const be=new Ov({query:_e,disableExtraQuery:!0}),we=await this.queryGroups(be,ve);if(!we.total)return[];const Se=we.results[0];be.num=100,be.query='type:"Web Scene"',be.sortField=Se.sortField||"name",be.sortOrder=Se.sortOrder||"desc";const Te=await Se.queryItems(be,ve);return Te.total?Te.results.filter((fe=>"Web Scene"===fe.type)).map((fe=>new Vv({portalItem:fe}))):[]}_normalizeSSL(fe){return fe.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(fe){if(fe){const ve=Vv.fromJSON(fe);return ve.portalItem={portal:this},ve}return null}static _resultsToTypedArray(fe,ve,_e,be){let we;if(_e){const Se=null!=be?be.signal:null;we=_e.listings||_e.notifications||_e.userInvitations||_e.tags||_e.items||_e.groups||_e.comments||_e.provisions||_e.results||_e.relatedItems||_e,(fe||ve)&&(we=we.map((_e=>{const be=Object.assign(fe?fe.fromJSON(_e):_e,ve);return"function"==typeof be.load&&be.load(Se),be})))}else we=[];return we}};jv.AUTH_MODE_ANONYMOUS="anonymous",jv.AUTH_MODE_AUTO="auto",jv.AUTH_MODE_IMMEDIATE="immediate",jv.AUTH_MODE_NO_PROMPT="no-prompt",e$4o([y$2v()],jv.prototype,"access",void 0),e$4o([y$2v()],jv.prototype,"allSSL",void 0),e$4o([y$2v()],jv.prototype,"authMode",void 0),e$4o([y$2v()],jv.prototype,"authorizedCrossOriginDomains",void 0),e$4o([o$40("authorizedCrossOriginDomains")],jv.prototype,"readAuthorizedCrossOriginDomains",null),e$4o([y$2v()],jv.prototype,"basemapGalleryGroupQuery",void 0),e$4o([y$2v({json:{name:"3DBasemapGalleryGroupQuery"}})],jv.prototype,"basemapGalleryGroupQuery3D",void 0),e$4o([y$2v()],jv.prototype,"bingKey",void 0),e$4o([y$2v()],jv.prototype,"canListApps",void 0),e$4o([y$2v()],jv.prototype,"canListData",void 0),e$4o([y$2v()],jv.prototype,"canListPreProvisionedItems",void 0),e$4o([y$2v()],jv.prototype,"canProvisionDirectPurchase",void 0),e$4o([y$2v()],jv.prototype,"canSearchPublic",void 0),e$4o([y$2v()],jv.prototype,"canShareBingPublic",void 0),e$4o([y$2v()],jv.prototype,"canSharePublic",void 0),e$4o([y$2v()],jv.prototype,"canSignInArcGIS",void 0),e$4o([y$2v()],jv.prototype,"canSignInIDP",void 0),e$4o([y$2v()],jv.prototype,"colorSetsGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"commentsEnabled",void 0),e$4o([y$2v({type:Date})],jv.prototype,"created",void 0),e$4o([y$2v()],jv.prototype,"credential",void 0),e$4o([y$2v()],jv.prototype,"culture",void 0),e$4o([y$2v()],jv.prototype,"currentVersion",void 0),e$4o([y$2v()],jv.prototype,"customBaseUrl",void 0),e$4o([y$2v()],jv.prototype,"defaultBasemap",void 0),e$4o([o$40("defaultBasemap")],jv.prototype,"readDefaultBasemap",null),e$4o([y$2v()],jv.prototype,"defaultDevBasemap",void 0),e$4o([o$40("defaultDevBasemap")],jv.prototype,"readDefaultDevBasemap",null),e$4o([y$2v({type:aa})],jv.prototype,"defaultExtent",void 0),e$4o([y$2v()],jv.prototype,"defaultVectorBasemap",void 0),e$4o([o$40("defaultVectorBasemap")],jv.prototype,"readDefaultVectorBasemap",null),e$4o([y$2v()],jv.prototype,"description",void 0),e$4o([y$2v()],jv.prototype,"devBasemapGalleryGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"eueiEnabled",void 0),e$4o([y$2v({readOnly:!0})],jv.prototype,"extraQuery",null),e$4o([y$2v()],jv.prototype,"featuredGroups",void 0),e$4o([y$2v()],jv.prototype,"featuredItemsGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"galleryTemplatesGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"layoutGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"livingAtlasGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"hasCategorySchema",void 0),e$4o([y$2v()],jv.prototype,"helpBase",void 0),e$4o([y$2v()],jv.prototype,"helperServices",void 0),e$4o([y$2v()],jv.prototype,"helpMap",void 0),e$4o([y$2v()],jv.prototype,"homePageFeaturedContent",void 0),e$4o([y$2v()],jv.prototype,"homePageFeaturedContentCount",void 0),e$4o([y$2v()],jv.prototype,"httpPort",void 0),e$4o([y$2v()],jv.prototype,"httpsPort",void 0),e$4o([y$2v()],jv.prototype,"id",void 0),e$4o([y$2v()],jv.prototype,"ipCntryCode",void 0),e$4o([y$2v({readOnly:!0})],jv.prototype,"isOrganization",null),e$4o([y$2v()],jv.prototype,"isPortal",void 0),e$4o([y$2v()],jv.prototype,"isReadOnly",void 0),e$4o([y$2v({readOnly:!0})],jv.prototype,"itemPageUrl",null),e$4o([y$2v()],jv.prototype,"layerTemplatesGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"maxTokenExpirationMinutes",void 0),e$4o([y$2v({type:Date})],jv.prototype,"modified",void 0),e$4o([y$2v()],jv.prototype,"name",void 0),e$4o([y$2v()],jv.prototype,"portalHostname",void 0),e$4o([y$2v()],jv.prototype,"portalMode",void 0),e$4o([y$2v()],jv.prototype,"portalProperties",void 0),e$4o([y$2v()],jv.prototype,"region",void 0),e$4o([y$2v()],jv.prototype,"recycleBinEnabled",void 0),e$4o([y$2v({readOnly:!0})],jv.prototype,"restUrl",null),e$4o([y$2v()],jv.prototype,"rotatorPanels",void 0),e$4o([y$2v()],jv.prototype,"showHomePageDescription",void 0),e$4o([y$2v()],jv.prototype,"sourceJSON",void 0),e$4o([y$2v()],jv.prototype,"staticImagesUrl",void 0),e$4o([y$2v({json:{name:"2DStylesGroupQuery"}})],jv.prototype,"stylesGroupQuery2d",void 0),e$4o([y$2v({json:{name:"stylesGroupQuery"}})],jv.prototype,"stylesGroupQuery3d",void 0),e$4o([y$2v()],jv.prototype,"supportsHostedServices",void 0),e$4o([y$2v()],jv.prototype,"symbolSetsGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"templatesGroupQuery",void 0),e$4o([y$2v()],jv.prototype,"thumbnail",void 0),e$4o([y$2v({readOnly:!0})],jv.prototype,"thumbnailUrl",null),e$4o([y$2v()],jv.prototype,"units",void 0),e$4o([y$2v()],jv.prototype,"url",void 0),e$4o([y$2v()],jv.prototype,"urlKey",void 0),e$4o([o$40("urlKey")],jv.prototype,"readUrlKey",null),e$4o([y$2v()],jv.prototype,"user",void 0),e$4o([o$40("user")],jv.prototype,"readUser",null),e$4o([y$2v()],jv.prototype,"use3dBasemaps",void 0),e$4o([y$2v()],jv.prototype,"useStandardizedQuery",void 0),e$4o([y$2v()],jv.prototype,"useVectorBasemaps",void 0),e$4o([y$2v()],jv.prototype,"vectorBasemapGalleryGroupQuery",void 0),jv=Uv=e$4o([a$4y("esri.portal.Portal")],jv);const Gv=jv,Hv=new FinalizationRegistry((fe=>{fe.remove()}));let qv=class c5 extends zi{constructor(fe){super(fe),this.portalItem=null}normalizeCtorArgs(fe){return(null==fe?void 0:fe.portalItem)&&fe.path?{...fe,path:n$3R(fe.path,fe.portalItem)}:fe}set path(fe){null!=fe&&Y$F(fe)?ar.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",fe)}_castPath(fe){return n$3R(fe,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(fe="json",ve){const _e=this.cdnUrl;if(null==_e)throw new Ir("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(_e,{responseType:fe,query:{token:this.portalItem.apiKey},signal:null==ve?void 0:ve.signal})}async update(fe,ve){const{addOrUpdateResources:_e}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);return await _e(this.portalItem,[{resource:this,content:fe,compress:null==ve?void 0:ve.compress,access:null==ve?void 0:ve.access}],"update",ve),this}hasPath(){return null!=this.path}};function n$3R(fe,ve){return null==fe?fe:(fe=fe.replace(/^\/+/,""),null!=ve&&Y$F(fe)&&(fe=G$_(fe,ve.itemUrl)),null==fe?void 0:fe.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}e$4o([y$2v()],qv.prototype,"portalItem",void 0),e$4o([y$2v({type:String,value:null})],qv.prototype,"path",null),e$4o([s$4b("path")],qv.prototype,"_castPath",null),e$4o([y$2v({type:String,readOnly:!0})],qv.prototype,"url",null),e$4o([y$2v({type:String,readOnly:!0})],qv.prototype,"cdnUrl",null),e$4o([y$2v({type:String,readOnly:!0})],qv.prototype,"itemRelativeUrl",null),qv=e$4o([a$4y("esri.portal.PortalItemResource")],qv);const Wv=qv;let Yv=class e7 extends zi{constructor(fe){super(fe),this.created=null,this.rating=null}};e$4o([y$2v()],Yv.prototype,"created",void 0),e$4o([y$2v()],Yv.prototype,"rating",void 0),Yv=e$4o([a$4y("esri.portal.PortalRating")],Yv);const Zv=Yv;function u$37(fe,ve){var _e;const be=null==(_e=null==ve?void 0:ve.url)?void 0:_e.path;if(fe&&be&&(fe=_$1x(fe,be,{preserveProtocolRelative:!0}),ve.portalItem&&ve.readResourcePaths)){const _e=G$_(fe,ve.portalItem.itemUrl);null!=_e&&Jv.test(_e)&&ve.readResourcePaths.push(ve.portalItem.resourceFromPath(_e).path)}return(fe=x$1m(fe,null==ve?void 0:ve.portal))&&Xv.test(fe)?I$1j(fe):fe}function m$2_(fe,ve,_e=Qv.YES){var be,we;if(null==(fe=fe&&Xv.test(fe)?O$19(fe):fe))return fe;!Y$F(fe)&&(null==ve?void 0:ve.blockedRelativeUrls)&&ve.blockedRelativeUrls.push(fe);let Se=_$1x(fe);if(ve){const _e=(null==(be=ve.verifyItemRelativeUrls)?void 0:be.rootPath)||(null==(we=ve.url)?void 0:we.path);if(_e){const be=x$1m(_e,ve.portal),we=x$1m(Se,ve.portal);Se=G$_(we,be,be),null!=Se&&Se!==we&&Se!==fe&&ve.verifyItemRelativeUrls&&ve.verifyItemRelativeUrls.writtenUrls.push(Se)}}return Se=U$X(Se,null==ve?void 0:ve.portal),Y$F(Se)&&(Se=K$I(Se)),(null==ve?void 0:ve.resources)&&(null==ve?void 0:ve.portalItem)&&!Y$F(Se)&&!tt$k(Se)&&_e===Qv.YES&&ve.resources.toKeep.push({resource:ve.portalItem.resourceFromPath(Se),compress:!1}),Se}function p$4e(fe,ve,_e){return u$37(fe,_e)}function f$2v(fe,ve,_e,be){const we=m$2_(fe,be);void 0!==we&&(ve[_e]=we)}const Xv=/\/items\/([^/]+)\/resources\/(.*)/,Jv=/^\.\/resources\//;function g$1Z(fe){const ve=(null==fe?void 0:fe.match(Xv))??null;return(null==ve?void 0:ve[1])??null}function v$1z(fe){const ve=(null==fe?void 0:fe.match(Xv))??null;if(null==ve)return null;const _e=ve[2],be=_e.lastIndexOf("/");if(-1===be){const{path:fe,extension:ve}=Tt$7(_e);return{prefix:null,filename:fe,extension:ve}}const{path:we,extension:Se}=Tt$7(_e.slice(be+1));return{prefix:_e.slice(0,be),filename:we,extension:Se}}function U$X(fe,ve){return ve&&!ve.isPortal&&ve.urlKey&&ve.customBaseUrl?At$5(fe,`${ve.urlKey}.${ve.customBaseUrl}`,ve.portalHostname):fe}function x$1m(fe,ve){if(!ve||ve.isPortal||!ve.urlKey||!ve.customBaseUrl)return fe;const _e=`${ve.urlKey}.${ve.customBaseUrl}`,be=C$1q();return F$1a(be,`${be.scheme}://${_e}`)?At$5(fe,ve.portalHostname,_e):At$5(fe,_e,ve.portalHostname)}function I$1j(fe){if(!fe)return fe||null;let ve=fe;return ve&&Ts&&!Ts.findCredential(ve)&&(ve=Ts._normalizeAGOLorgDomain(ve),ve=ve.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),ve=ve.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),ve=ve.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),ve}function O$19(fe){if(!fe)return fe||null;let ve=fe;return ve=ve.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),ve=ve.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),ve=ve.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),ve&&Ts&&!Ts.findCredential(ve)&&(ve=Ts._normalizeAGOLorgDomain(ve)),ve}var Qv;!function(fe){fe[fe.YES=0]="YES",fe[fe.NO=1]="NO"}(Qv||(Qv={}));const Kv=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return Qv},ensureMainOnlineDomain:U$X,fromCDNUrl:O$19,fromJSON:u$37,itemIdFromResourceUrl:g$1Z,prefixAndFilenameFromResourceUrl:v$1z,read:p$4e,toCDNUrl:I$1j,toJSON:m$2_,write:f$2v},Symbol.toStringTag,{value:"Module"}));var e_;const t_=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),r_=new Set(["KML","GeoJson","CSV"]);let i_=e_=class extends(u$3V(Sv)){static from(fe){return g$2C(e_,fe)}constructor(fe){super(fe),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const fe=this.type,ve=this.typeKeywords||[];let _e=fe;return"Feature Service"===fe||"Feature Collection"===fe?_e=ve.includes("Table")?"Table":ve.includes("Route Layer")?"Route Layer":ve.includes("Markup")?"Markup":"Feature Layer":"Image Service"===fe?_e=ve.includes("Elevation 3D Layer")?"Elevation Layer":ve.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===fe?_e="Scene Layer":"Video Service"===fe?_e="Video Layer":"Scene Package"===fe?_e="Scene Layer Package":"Stream Service"===fe?_e="Feature Layer":"Geoprocessing Service"===fe?_e=ve.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===fe?_e="GeoEnrichment Service":"Geocoding Service"===fe?_e="Locator":"Microsoft Powerpoint"===fe?_e="Microsoft PowerPoint":"GeoJson"===fe?_e="GeoJSON":"Globe Service"===fe?_e="Globe Layer":"Vector Tile Service"===fe?_e="Tile Layer":"netCDF"===fe?_e="NetCDF":"Map Service"===fe?_e=ve.includes("Spatiotemporal")||!ve.includes("Hosted Service")&&!ve.includes("Tiled")||ve.includes("Relational")?"Map Image Layer":"Tile Layer":(null==fe?void 0:fe.toLowerCase().includes("add in"))?_e=fe.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===fe?_e="Big Data File Share":"Compact Tile Package"===fe?_e="Tile Package (tpkx)":"Raster function template"===fe?_e="Raster Function Template":"OGCFeatureServer"===fe?_e="OGC Feature Layer":"web mapping application"===fe&&ve.includes("configurableApp")?_e="Instant App":"Insights Page"===fe?_e="Insights Report":"Excalibur Imagery Project"===fe?_e="Excalibur Project":"3DTiles Service"===fe?_e="3D tiles layer":"3DTiles Package"===fe&&(_e="3D tiles package"),_e}readExtent(fe){return fe&&fe.length?new aa(fe[0][0],fe[0][1],fe[1][0],fe[1][1]):null}get iconUrl(){var fe;const ve=(null==(fe=this.type)?void 0:fe.toLowerCase())||"",_e=this.typeKeywords||[];let be,we=!1,Se=!1,Te=!1,Ee=!1,Ce=!1,Oe=!1,Re=!1,De=!1;return ve.indexOf("service")>0||"feature collection"===ve||"kml"===ve||"wms"===ve||"wmts"===ve||"wfs"===ve?(we=_e.includes("Hosted Service"),"feature service"===ve||"feature collection"===ve||"kml"===ve||"wfs"===ve?(Se=_e.includes("Table"),Te=_e.includes("Route Layer"),Ee=_e.includes("Markup"),Ce=_e.includes("Spatiotemporal"),Oe=_e.includes("UtilityNetwork"),be=Ce&&Se?"spatiotemporaltable":Se?"table":Te?"routelayer":Ee?"markup":Ce?"spatiotemporal":Oe?"utilitynetwork":we?"featureshosted":"features"):"map service"===ve||"wms"===ve||"wmts"===ve?(Ce=_e.includes("Spatiotemporal"),Re=_e.includes("Relational"),be=Ce||Re?"mapimages":we||_e.includes("Tiled")||"wmts"===ve?"maptiles":"mapimages"):be="scene service"===ve?_e.includes("Line")?"sceneweblayerline":_e.includes("3DObject")?"sceneweblayermultipatch":_e.includes("Point")?"sceneweblayerpoint":_e.includes("IntegratedMesh")?"sceneweblayermesh":_e.includes("PointCloud")?"sceneweblayerpointcloud":_e.includes("Polygon")?"sceneweblayerpolygon":_e.includes("Building")?"sceneweblayerbuilding":_e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===ve?_e.includes("Elevation 3D Layer")?"elevationlayer":_e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===ve?"streamlayer":"vector tile service"===ve?"vectortile":"datastore catalog service"===ve?"datastorecollection":"geocoding service"===ve?"geocodeservice":"video service"===ve?_e.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===ve?_e.includes("Web Tool")?"tool":"layers":"geodata service"===ve?"geodataservice":"3dtiles service"===ve?_e.includes("3DObject")?"3dobjecttileslayer":_e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===ve||"cityengine web scene"===ve?be="maps":"web scene"===ve?be=_e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===ve&&_e.includes("configurableApp")?be="instantapps":"web mapping application"===ve||"mobile application"===ve||"application"===ve||"operation view"===ve||"desktop application"===ve?be="apps":"map document"===ve||"map package"===ve||"published map"===ve||"scene document"===ve||"globe document"===ve||"basemap package"===ve||"mobile basemap package"===ve||"mobile map package"===ve||"project package"===ve||"project template"===ve||"pro map"===ve||"layout"===ve||"layer"===ve&&_e.includes("ArcGIS Pro")||"explorer map"===ve&&_e.indexOf("Explorer Document")?be="mapsgray":"service definition"===ve||"shapefile"===ve||"cad drawing"===ve||"geojson"===ve||"netcdf"===ve||"administrative report"===ve?be="datafiles":"360 vr experience"===ve?be="360vr":"explorer add in"===ve||"desktop add in"===ve||"windows viewer add in"===ve||"windows viewer configuration"===ve?be="appsgray":"arcgis pro add in"===ve||"arcgis pro configuration"===ve?be="addindesktop":"pdf"===ve?be="pdf":"microsoft word"===ve?be="word":"microsoft excel"===ve?be="excel":"microsoft powerpoint"===ve?be="ppt":"rule package"===ve||"file geodatabase"===ve||"sqlite geodatabase"===ve||"csv collection"===ve||"kml collection"===ve||"windows mobile package"===ve||"map template"===ve||"desktop application template"===ve||"gml"===ve||"arcpad package"===ve||"code sample"===ve||"document link"===ve||"earth configuration"===ve||"operations dashboard add in"===ve||"rules package"===ve||"workflow manager package"===ve||"explorer map"===ve&&_e.includes("Explorer Mapping Application")||_e.includes("Document")?be="datafilesgray":"network analysis service"===ve||"geoprocessing service"===ve||"geodata service"===ve||"geometry service"===ve||"geoprocessing package"===ve||"locator package"===ve||"geoprocessing sample"===ve||"workflow manager service"===ve?be="toolsgray":"layer"===ve||"layer package"===ve||"explorer layer"===ve?be="layersgray":"analysis model"===ve?be="analysismodel":"scene package"===ve?be="scenepackage":"3dtiles package"===ve?be="3dtileslayerpackage":"3dtiles service"===ve?be="3dtileslayer":"mobile scene package"===ve?be="mobilescenepackage":"tile package"===ve||"compact tile package"===ve?be="tilepackage":"task file"===ve?be="taskfile":"report template"===ve?be="report-template":"statistical data collection"===ve?be="statisticaldatacollection":"insights workbook"===ve?be="workbook":"insights model"===ve?be="insightsmodel":"insights page"===ve?be="insightspage":"insights theme"===ve?be="insightstheme":"hub initiative"===ve?be="hubinitiative":"hub page"===ve?be="hubpage":"hub site application"===ve?be="hubsite":"hub event"===ve?be="hubevent":"hub project"===ve?be="hubproject":"relational database connection"===ve?be="relationaldatabaseconnection":"big data file share"===ve?be="datastorecollection":"image collection"===ve?be="imagecollection":"desktop style"===ve?be="desktopstyle":"style"===ve?be=_e.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===ve?be="dashboard":"raster function template"===ve?be="rasterprocessingtemplate":"vector tile package"===ve?be="vectortilepackage":"ortho mapping project"===ve?be="orthomappingproject":"ortho mapping template"===ve?be="orthomappingtemplate":"solution"===ve?be="solutions":"geopackage"===ve?be="geopackage":"deep learning package"===ve?be="deeplearningpackage":"real time analytic"===ve?be="realtimeanalytics":"big data analytic"===ve?be="bigdataanalytics":"feed"===ve?be="feed":"excalibur imagery project"===ve?be="excaliburimageryproject":"notebook"===ve?be="notebook":"storymap"===ve?be="storymap":"survey123 add in"===ve?be="survey123addin":"mission"===ve?be="mission":"mission report"===ve?be="missionreport":"mission template"===ve?be="missiontemplate":"quickcapture project"===ve?be="quickcaptureproject":"pro report"===ve?be="proreport":"pro report template"===ve?be="proreporttemplate":"urban model"===ve?be="urbanmodel":"web experience"===ve?be="experiencebuilder":"web experience template"===ve?be="webexperiencetemplate":"experience builder widget"===ve?be="experiencebuilderwidget":"experience builder widget package"===ve?be="experiencebuilderwidgetpackage":"workflow"===ve?be="workflow":"kernel gateway connection"===ve?be="kernelgatewayconnection":"insights script"===ve?be="insightsscript":"hub initiative template"===ve?be="hubinitiativetemplate":"storymap theme"===ve?be="storymaptheme":"knowledge graph"===ve?be="knowledgegraph":"knowledge graph layer"===ve?be="knowledgegraphlayer":"knowledge studio project"===ve?be="knowledgestudio":"native application"===ve?be="nativeapp":"native application installer"===ve?be="nativeappinstaller":"web link chart"===ve?be="linkchart":"knowledge graph web investigation"===ve?be="investigation":"ogcfeatureserver"===ve?be="features":"pro project"===ve?be="proproject":"insights workbook package"===ve?be="insightsworkbookpackage":"apache parquet"===ve?be="apacheparquet":"notebook code snippet library"===ve?be="notebookcodesnippets":"suitability model"===ve?be="suitabilitymodel":"esri classifier definition"===ve?be="classifierdefinition":"esri classification schema"===ve?be="classificationschema":"insights data engineering workbook"===ve?be="dataengineeringworkbook":"insights data engineering model"===ve?be="dataengineeringmodel":"deep learning studio project"===ve?be="deeplearningproject":"discussion"===ve?be="discussion":"allsource project"===ve?be="allsourceproject":"api key"===ve?be="apikey":"data pipeline"===ve?be="datapipelines":"group layer"===ve?(De=_e.includes("Map"),be=De?"layergroup2d":"layergroup"):be="media layer"===ve?"onlinemedialayer":"form"===ve?_e.includes("Survey123")?"survey":"datafilesgray":"csv"===ve?"csv":"image"===ve?"image":"maps",be?n$4t("esri/images/portal/"+be+"16.png"):null}get isLayer(){return null!=this.type&&t_.has(this.type)}get itemCdnUrl(){return I$1j(this.itemUrl)}get itemPageUrl(){var fe;const ve=null==(fe=this.portal)?void 0:fe.itemPageUrl;return ve&&this.id?`${ve}?id=${this.id}`:null}get itemUrl(){var fe;const ve=null==(fe=this.portal)?void 0:fe.restUrl;return ve&&this.id?`${ve}/content/items/${this.id}`:null}get thumbnailUrl(){var fe;const ve=this.itemUrl,_e=this.thumbnail;return ve&&_e?(null==(fe=this.portal)?void 0:fe.normalizeUrl(`${ve}/info/${_e}?f=json`))??null:null}get userItemUrl(){var fe,ve,_e;const be=null==(fe=this.portal)?void 0:fe.restUrl;if(!be)return null;const we=this.owner||(null==(_e=null==(ve=this.portal)?void 0:ve.user)?void 0:_e.username);return we?`${be}/content/users/${this.ownerFolder?`${we}/${this.ownerFolder}`:we}/items/${this.id}`:null}load(fe){const ve=this.portal??(this.portal=Gv.getDefault()),_e=ve.load(fe).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?ve.request(this.itemUrl,{signal:null!=fe?fe.signal:null,query:{token:this.apiKey}}):{})).then((fe=>{this.sourceJSON=fe,this.read(fe)}));return this.addResolvingPromise(_e),Promise.resolve(this)}async addRating(fe){const ve={method:"post",query:{}};return fe instanceof Zv&&(fe=fe.rating),null==fe||isNaN(fe)||"number"!=typeof fe||(ve.query.rating=fe),this.portal?(await this.portal.request(this.itemUrl+"/addRating",ve),new Zv({rating:fe,created:new Date})):null}clone(){const fe={access:this.access,accessInformation:this.accessInformation,applicationProxies:a$4H(this.applicationProxies),avgRating:this.avgRating,categories:a$4H(this.categories),created:a$4H(this.created),culture:this.culture,description:this.description,extent:a$4H(this.extent),groupCategories:a$4H(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:a$4H(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:a$4H(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:a$4H(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:a$4H(this.typeKeywords),url:this.url};this.loaded&&(fe.loadStatus="loaded");const ve=new e_({sourceJSON:this.sourceJSON}).set(fe);return ve._set("isOrgItem",this.isOrgItem),ve}createPostQuery(){var fe;const ve=this.toJSON();for(const be of["tags","typeKeywords","categories"])ve[be]=null==(fe=ve[be])?void 0:fe.join(", ");const{extent:_e}=ve;return _e&&(ve.extent=JSON.stringify(_e)),ve}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(fe="json",ve){return this.portal.request(this.itemUrl+"/data",{responseType:fe,...ve,query:{token:this.apiKey}})}async fetchRating(fe){const ve=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...fe});return null!=ve.rating?(ve.created=new Date(ve.created),new Zv(ve)):null}fetchRelatedItems(fe,ve){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...fe,token:this.apiKey},...ve},e_)}getThumbnailUrl(fe){let ve=this.thumbnailUrl;return ve&&fe&&(ve+=`&w=${fe}`),ve}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((fe=>(this.sourceJSON=fe,this.read(fe),this)))}update(fe){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const ve=null==fe?void 0:fe.data,_e={method:"post"};_e.query=this.createPostQuery();for(const fe in _e.query)null===_e.query[fe]&&(_e.query[fe]="");return _e.query.clearEmptyFields=!0,null!=ve&&("string"==typeof ve?_e.query.text=ve:"object"==typeof ve&&(_e.query.text=JSON.stringify(ve))),this.portal.request(`${this.userItemUrl}/update`,_e).then((()=>this.reload()))})):Promise.reject(new Ir("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(fe){if(!this.id)throw new Ir("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:ve,itemUrl:_e}=this;await ve.signIn();const{copyResources:be,folder:we,tags:Se,title:Te}=fe||{},Ee={method:"post",query:{copyPrivateResources:"all"===be,folder:"string"==typeof we?we:null==we?void 0:we.id,includeResources:!!be,tags:null==Se?void 0:Se.join(","),title:Te}},{itemId:Ce}=await ve.request(`${_e}/copy`,Ee);return new e_({id:Ce,portal:ve})}updateThumbnail(fe){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const ve=fe.thumbnail,_e=fe.filename,be={method:"post"};if("string"==typeof ve)tt$k(ve)?be.query={data:ve}:be.query={url:_$1x(ve)},null!=_e&&(be.query.filename=_e);else{const fe=new FormData;null!=_e?fe.append("file",ve,_e):fe.append("file",ve),be.body=fe}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,be).then((()=>this.reload()))})):Promise.reject(new Ir("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(fe={},ve){const{fetchResources:_e}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);return _e(this,fe,ve)}async addResource(fe,ve,_e){const{addOrUpdateResources:be}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);return fe.portalItem=this,await be(this,[{resource:fe,content:ve,compress:null==_e?void 0:_e.compress,access:null==_e?void 0:_e.access}],"add",_e),fe}async removeResource(fe,ve){const{removeResource:_e}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);if(fe.portalItem&&fe.portalItem.itemUrl!==this.itemUrl)throw new Ir("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return _e(this,fe,ve)}async removeAllResources(fe){const{removeAllResources:ve}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);return ve(this,fe)}resourceFromPath(fe){return new Wv({portalItem:this,path:fe})}toJSON(){var fe,ve;const _e=this.extent;return l$4G({accessInformation:this.accessInformation,categories:a$4H(this.categories),created:null==(fe=this.created)?void 0:fe.getTime(),description:this.description,extent:_e&&[[_e.xmin,_e.ymin],[_e.xmax,_e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:null==(ve=this.modified)?void 0:ve.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:a$4H(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:a$4H(this.typeKeywords),url:this.url})}static fromJSON(fe){if(!fe)return null;if(fe.declaredClass)throw new Error("JSON object is already hydrated");return new e_({sourceJSON:fe})}_getPostQuery(){const fe=this.toJSON();for(const ve in fe)"tags"===ve&&null!==fe[ve]&&(fe[ve]=fe[ve].join(", ")),"typeKeywords"===ve&&null!==fe[ve]&&(fe[ve]=fe[ve].join(", ")),"extent"===ve&&fe[ve]&&(fe[ve]=JSON.stringify(fe[ve]));return fe}};e$4o([y$2v({type:["private","shared","org","public"]})],i_.prototype,"access",void 0),e$4o([y$2v()],i_.prototype,"accessInformation",void 0),e$4o([y$2v({type:String})],i_.prototype,"apiKey",void 0),e$4o([y$2v({json:{read:{source:"appProxies"}}})],i_.prototype,"applicationProxies",void 0),e$4o([y$2v()],i_.prototype,"avgRating",void 0),e$4o([y$2v()],i_.prototype,"categories",void 0),e$4o([y$2v({type:Date})],i_.prototype,"created",void 0),e$4o([y$2v()],i_.prototype,"culture",void 0),e$4o([y$2v()],i_.prototype,"description",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"displayName",null),e$4o([y$2v({type:aa})],i_.prototype,"extent",void 0),e$4o([o$40("extent")],i_.prototype,"readExtent",null),e$4o([y$2v()],i_.prototype,"groupCategories",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"iconUrl",null),e$4o([y$2v()],i_.prototype,"id",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"isLayer",null),e$4o([y$2v({type:Boolean,readOnly:!0})],i_.prototype,"isOrgItem",void 0),e$4o([y$2v()],i_.prototype,"itemControl",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"itemPageUrl",null),e$4o([y$2v({readOnly:!0})],i_.prototype,"itemUrl",null),e$4o([y$2v()],i_.prototype,"licenseInfo",void 0),e$4o([y$2v({type:Date})],i_.prototype,"modified",void 0),e$4o([y$2v()],i_.prototype,"name",void 0),e$4o([y$2v()],i_.prototype,"numComments",void 0),e$4o([y$2v()],i_.prototype,"numRatings",void 0),e$4o([y$2v()],i_.prototype,"numViews",void 0),e$4o([y$2v()],i_.prototype,"owner",void 0),e$4o([y$2v()],i_.prototype,"ownerFolder",void 0),e$4o([y$2v({type:Gv})],i_.prototype,"portal",void 0),e$4o([y$2v()],i_.prototype,"screenshots",void 0),e$4o([y$2v()],i_.prototype,"size",void 0),e$4o([y$2v()],i_.prototype,"snippet",void 0),e$4o([y$2v()],i_.prototype,"sourceJSON",void 0),e$4o([y$2v({type:String})],i_.prototype,"sourceUrl",void 0),e$4o([y$2v({type:String})],i_.prototype,"spatialReference",void 0),e$4o([y$2v()],i_.prototype,"tags",void 0),e$4o([y$2v()],i_.prototype,"thumbnail",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"thumbnailUrl",null),e$4o([y$2v()],i_.prototype,"title",void 0),e$4o([y$2v()],i_.prototype,"type",void 0),e$4o([y$2v()],i_.prototype,"typeKeywords",void 0),e$4o([y$2v({type:String,json:{read(fe,ve){var _e;if(r_.has(ve.type)){const ve=null==(_e=this.portal)?void 0:_e.restUrl;fe||(fe=ve&&this.id?`${ve}/content/items/${this.id}/data`:null)}return fe}}})],i_.prototype,"url",void 0),e$4o([y$2v({readOnly:!0})],i_.prototype,"userItemUrl",null),i_=e_=e$4o([a$4y("esri.portal.PortalItem")],i_);const n_=i_,s_=Object.freeze(Object.defineProperty({__proto__:null,default:n_},Symbol.toStringTag,{value:"Module"}));const o_={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return n$4t("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return n$4t("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return n$4t("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return n$4t("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return n$4t("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return n$4t("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return n$4t("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return n$4t("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return n$4t("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return n$4t("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return n$4t("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},a_=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let l_=class c6 extends zi{constructor(fe){super(fe),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const fe=c$4r().toLowerCase();switch(fe){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const ve=a$4d(fe);return"pt"===ve?"pt-BR":ve&&a_.has(ve)?ve:"global"}};e$4o([y$2v()],l_.prototype,"id",void 0),e$4o([y$2v()],l_.prototype,"language",void 0),e$4o([y$2v()],l_.prototype,"places",void 0),e$4o([y$2v()],l_.prototype,"serviceUrl",void 0),e$4o([y$2v()],l_.prototype,"worldview",void 0),l_=e$4o([a$4y("esri.support.BasemapStyle")],l_);const c_=l_,u_=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),h_=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function p$4c(fe,ve){if(ve.restrictedWebMapWriting){const _e=function d$2K(fe){return"basemap"===fe.layerContainerType?u_:"operational-layers"===fe.layerContainerType?h_:null}(ve);return null==_e||_e.has(fe.type)&&!w$1G(fe)}return!0}function c$3Y(fe,ve){"maxScale"in fe&&(ve.maxScale=y$2t(fe.maxScale)??void 0),"minScale"in fe&&(ve.minScale=y$2t(fe.minScale)??void 0)}function m$2Z(fe,ve){if(function u$36(fe,ve){var _e;if(ve)if(w$1G(fe)){const be=t$4s("featureCollection.layers",ve),we=null==(_e=null==be?void 0:be[0])?void 0:_e.layerDefinition;we&&c$3Y(fe,we)}else"group"!==fe.type&&c$3Y(fe,ve)}(fe,ve),ve&&(ve.id=fe.id,"blendMode"in fe&&(ve.blendMode=fe.blendMode,"normal"===ve.blendMode&&delete ve.blendMode),ve.opacity=y$2t(fe.opacity)??void 0,ve.title=fe.title||"Layer",ve.visibility=fe.visible,"legendEnabled"in fe&&"wmts"!==fe.type))if(w$1G(fe)){const _e=ve.featureCollection;_e&&(_e.showLegend=fe.legendEnabled)}else ve.showLegend=fe.legendEnabled}function f$2t(fe,ve,_e){if(!fe.persistenceEnabled)return null;if(!("write"in fe)||!fe.write)return(null==_e?void 0:_e.messages)&&_e.messages.push(new Ir("layer:unsupported",`Layers (${fe.title}, ${fe.id}) of type '${fe.declaredClass}' cannot be persisted`,{layer:fe})),null;if(w$1G(fe)&&!fe.isTable)ve=fe.resourceInfo;else if(p$4c(fe,_e)){const ve={};return fe.write(ve,_e)?ve:null}return null!=ve&&m$2Z(fe,ve=a$4H(ve)),ve}var d_;let p_=0,f_=d_=class extends(u$3V(Sv)){constructor(fe){super(fe),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+p_++,this.baseLayers=new Wa,this.referenceLayers=new Wa;const r65=fe=>{fe.parent&&fe.parent!==this&&"remove"in fe.parent&&fe.parent.remove(fe),fe.parent=this,"elevation"===fe.type&&ar.getLogger(this).error(`Layer '${fe.title}, id:${fe.id}' of type '${fe.type}' is not supported as a basemap layer and will therefore be ignored.`)},s84=fe=>{fe.parent=null};this.addHandles([this.baseLayers.on("after-add",(fe=>r65(fe.item))),this.referenceLayers.on("after-add",(fe=>r65(fe.item))),this.baseLayers.on("after-remove",(fe=>s84(fe.item))),this.referenceLayers.on("after-remove",(fe=>s84(fe.item)))])}initialize(){this.when().catch((fe=>{ar.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,fe)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const fe=this.baseLayers.toArray();for(const _e of fe)_e.destroy();const ve=this.referenceLayers.toArray();for(const _e of ve)_e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=u$4d(this.portalItem)}normalizeCtorArgs(fe){return fe&&"resourceInfo"in fe&&(this._set("resourceInfo",fe.resourceInfo),delete(fe={...fe}).resourceInfo),fe}set baseLayers(fe){this._set("baseLayers",n$4c(fe,this._get("baseLayers")))}_writeBaseLayers(fe,ve,_e){const be=[];fe?(_e={..._e,layerContainerType:"basemap"},this.baseLayers.forEach((fe=>{const ve=f$2t(fe,_e.webmap?_e.webmap.getLayerJSONFromResourceInfo(fe):null,_e);null!=ve&&be.push(ve)})),this.referenceLayers.forEach((fe=>{const ve=f$2t(fe,_e.webmap?_e.webmap.getLayerJSONFromResourceInfo(fe):null,_e);null!=ve&&("scene"!==fe.type&&(ve.isReference=!0),be.push(ve))})),ve.baseMapLayers=be):ve.baseMapLayers=be}set referenceLayers(fe){this._set("referenceLayers",n$4c(fe,this._get("referenceLayers")))}writeTitle(fe,ve){ve.title=fe||"Basemap"}load(fe){return this.addResolvingPromise(this._loadFromSource(fe)),Promise.resolve(this)}loadAll(){return t$3u(this,(fe=>{fe(this.baseLayers,this.referenceLayers)}))}clone(){const fe={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((fe=>y$2B(fe)?fe.clone():fe)),referenceLayers:this.referenceLayers.map((fe=>y$2B(fe)?fe.clone():fe))};return this.loaded&&(fe.loadStatus="loaded"),new d_({resourceInfo:this.resourceInfo}).set(fe)}read(fe,ve){this.resourceInfo||this._set("resourceInfo",{data:fe,context:ve}),super.read(fe,ve)}write(fe,ve){var _e;return fe=fe||{},(null==ve?void 0:ve.origin)||(ve={origin:"web-map",...ve}),super.write(fe,ve),!this.loaded&&(null==(_e=this.resourceInfo)?void 0:_e.data.baseMapLayers)&&(fe.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((fe=>{const ve=a$4H(fe);return ve.url&&pt$9(ve.url)&&(ve.url=`https:${ve.url}`),ve.templateUrl&&pt$9(ve.templateUrl)&&(ve.templateUrl=`https:${ve.templateUrl}`),ve}))),fe}async _loadFromSource(fe){const{resourceInfo:ve,portalItem:_e,style:be}=this;s$4o(fe);const we=[];if(ve){const _e=ve.context?ve.context.url:null;if(we.push(this._loadLayersFromJSON(ve.data,_e,fe)),ve.data.id&&!ve.data.title){const fe=ve.data.id;we.push(async function a$3Q(fe){if(!fe)return;const ve=fe.includes("-vector")?fe.slice(0,fe.indexOf("-vector")):fe.includes("-3d")?fe.slice(0,fe.indexOf("-3d")):fe,_e=await h$2D("esri/t9n/basemaps");return _e[fe]||_e[ve]}(fe).then((fe=>{fe&&this.read({title:fe},ve.context)})))}}else _e?we.push(this._loadFromItem(_e,fe)):be&&we.push(this._loadFromStylesService(be,fe));await Promise.all(we)}async _loadLayersFromJSON(fe,ve,_e){var be,we;const Se=null==(be=this.resourceInfo)?void 0:be.context,Te=(null==(we=this.portalItem)?void 0:we.portal)||(null==Se?void 0:Se.portal)||null,Ee=y_[(null==Se?void 0:Se.origin)||""]??"web-map",{populateOperationalLayers:Ce}=await zt((async()=>{const{populateOperationalLayers:fe}=await import("./layersCreator-CnQujQsO.js");return{populateOperationalLayers:fe}}),__vite__mapDeps([72,73,74])),Oe=[];if(s$4o(_e),fe.baseMapLayers&&Array.isArray(fe.baseMapLayers)){const _e={context:{...Se,origin:Ee,url:ve,portal:Te,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},l49=fe=>"web-scene"===Ee&&"ArcGISSceneServiceLayer"===fe.layerType||fe.isReference,be=Ce(this.baseLayers,fe.baseMapLayers.filter((fe=>!l49(fe))),_e);Oe.push(be);const we=Ce(this.referenceLayers,fe.baseMapLayers.filter(l49),_e);Oe.push(we)}await Promise.allSettled(Oe)}async _loadFromItem(fe,ve){const _e=await fe.load(ve),be=await _e.fetchData("json",ve),we=I$1E(fe.itemUrl??"");return this._set("resourceInfo",{data:be.baseMap??{},context:{origin:m_[fe.type||""]??"web-map",portal:fe.portal||Gv.getDefault(),url:we}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:be.spatialReference},this.resourceInfo.context),this.read({title:fe.title,thumbnailUrl:fe.thumbnailUrl},{origin:"portal-item",portal:fe.portal||Gv.getDefault(),url:we}),this._loadLayersFromJSON(this.resourceInfo.data,we,ve)}async _loadFromStylesService(fe,ve){const _e=`${fe.serviceUrl}/${fe.id}`,be=(await U$1a(_e,{query:{language:fe.getLanguageParamValue(),places:fe.places,worldview:fe.worldview},signal:null==ve?void 0:ve.signal})).data,we=I$1E(_e);return this._set("resourceInfo",{data:be.baseMap??{},context:{origin:"web-map",url:we}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:be.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,we,ve)}static fromId(fe){const ve=o_[fe];return ve?ve.itemId?new d_({portalItem:{id:ve.itemId,portal:{url:"https://www.arcgis.com"}}}):d_.fromJSON(ve,{origin:ve.is3d?"web-scene":"web-map"}):null}};e$4o([y$2v({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(fe,ve,_e,be){this._writeBaseLayers(fe,ve,be)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Wa}},writer(fe,ve,_e,be){this._writeBaseLayers(fe,ve,be)}}}}}})],f_.prototype,"baseLayers",null),e$4o([y$2v({type:String,json:{origins:{"web-scene":{write:!0}}}})],f_.prototype,"id",void 0),e$4o([y$2v({type:n_})],f_.prototype,"portalItem",void 0),e$4o([y$2v()],f_.prototype,"referenceLayers",null),e$4o([y$2v({readOnly:!0})],f_.prototype,"resourceInfo",void 0),e$4o([y$2v({type:zo})],f_.prototype,"spatialReference",void 0),e$4o([y$2v({type:c_})],f_.prototype,"style",void 0),e$4o([y$2v()],f_.prototype,"thumbnailUrl",void 0),e$4o([y$2v({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],f_.prototype,"title",void 0),e$4o([r$3s("title")],f_.prototype,"writeTitle",null),f_=d_=e$4o([a$4y("esri.Basemap")],f_);const m_={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},y_={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},g_=f_,v_=Object.freeze(Object.defineProperty({__proto__:null,default:g_},Symbol.toStringTag,{value:"Module"})),__={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function r$2V(fe){return!!__[fe]||!!__[fe.toLowerCase()]}function l$3F(fe){return __[fe]??__[fe.toLowerCase()]}function n$3Q(fe,ve,_e){_e<0&&++_e,_e>1&&--_e;const be=6*_e;return be<1?fe+(ve-fe)*be:2*_e<1?ve:3*_e<2?fe+(ve-fe)*(2/3-_e)*6:fe}function o$3j(fe,ve,_e,be=1){const we=(fe%360+360)%360/360,Se=_e<=.5?_e*(ve+1):_e+ve-_e*ve,Te=2*_e-Se;return[Math.round(255*n$3Q(Te,Se,we+1/3)),Math.round(255*n$3Q(Te,Se,we)),Math.round(255*n$3Q(Te,Se,we-1/3)),be]}function a$3O(fe){return e$3Y(s$4m(fe),0,255)}function e$3q(fe,ve,_e){return fe=Number(fe),isNaN(fe)?_e:fe<ve?ve:fe>_e?_e:fe}function o$3i(fe,ve){const _e=fe.toString(16).padStart(2,"0");return ve?_e.substring(0,1):_e}let $_=class h3{static blendColors(fe,ve,_e,be=new h3){return be.r=Math.round(fe.r+(ve.r-fe.r)*_e),be.g=Math.round(fe.g+(ve.g-fe.g)*_e),be.b=Math.round(fe.b+(ve.b-fe.b)*_e),be.a=fe.a+(ve.a-fe.a)*_e,be._sanitize()}static fromRgb(fe,ve){const _e=fe.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(_e){const fe=_e[2].split(/\s*,\s*/),be=_e[1];if("rgb"===be&&3===fe.length||"rgba"===be&&4===fe.length){const _e=fe[0];if("%"===_e.charAt(_e.length-1)){const _e=fe.map((fe=>2.56*parseFloat(fe)));return 4===fe.length&&(_e[3]=parseFloat(fe[3])),h3.fromArray(_e,ve)}return h3.fromArray(fe.map((fe=>parseFloat(fe))),ve)}if("hsl"===be&&3===fe.length||"hsla"===be&&4===fe.length)return h3.fromArray(o$3j(parseFloat(fe[0]),parseFloat(fe[1])/100,parseFloat(fe[2])/100,parseFloat(fe[3])),ve)}return null}static fromHex(fe,ve=new h3){if("#"!==fe[0]||isNaN(Number(`0x${fe.substring(1)}`)))return null;switch(fe.length){case 4:case 5:{const _e=parseInt(fe.substring(1,2),16),be=parseInt(fe.substring(2,3),16),we=parseInt(fe.substring(3,4),16),Se=5===fe.length?15:parseInt(fe.substring(4),16);return h3.fromArray([_e+16*_e,be+16*be,we+16*we,(Se+16*Se)/255],ve)}case 7:case 9:{const _e=parseInt(fe.substring(1,3),16),be=parseInt(fe.substring(3,5),16),we=parseInt(fe.substring(5,7),16),Se=7===fe.length?255:parseInt(fe.substring(7),16);return h3.fromArray([_e,be,we,Se/255],ve)}default:return null}}static fromArray(fe,ve=new h3){return ve._set(Number(fe[0]),Number(fe[1]),Number(fe[2]),Number(fe[3])),isNaN(ve.a)&&(ve.a=1),ve._sanitize()}static fromString(fe,ve){const _e=r$2V(fe)?l$3F(fe):null;return _e&&h3.fromArray(_e,ve)||h3.fromRgb(fe,ve)||h3.fromHex(fe,ve)}static fromJSON(fe){return null!=fe?new h3([fe[0],fe[1],fe[2],(fe[3]??255)/255]):void 0}static toUnitRGB(fe){return null!=fe?[fe.r/255,fe.g/255,fe.b/255]:null}static toUnitRGBA(fe){return null!=fe?[fe.r/255,fe.g/255,fe.b/255,null!=fe.a?fe.a:1]:null}constructor(fe){this.r=255,this.g=255,this.b=255,this.a=1,fe&&this.setColor(fe)}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(fe){return"string"==typeof fe?h3.fromString(fe,this):Array.isArray(fe)?h3.fromArray(fe,this):(this._set(fe.r??0,fe.g??0,fe.b??0,fe.a??1),fe instanceof h3||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(fe){const ve=(null==fe?void 0:fe.capitalize)??!1,_e=(null==fe?void 0:fe.digits)??6,be=3===_e||4===_e,we=4===_e||8===_e,Se=`#${o$3i(this.r,be)}${o$3i(this.g,be)}${o$3i(this.b,be)}${we?o$3i(Math.round(255*this.a),be):""}`;return ve?Se.toUpperCase():Se}toCss(fe=!1){const ve=this.r+", "+this.g+", "+this.b;return fe?`rgba(${ve}, ${this.a})`:`rgb(${ve})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(fe=h3.AlphaMode.ALWAYS){const ve=a$3O(this.r),_e=a$3O(this.g),be=a$3O(this.b);return fe===h3.AlphaMode.ALWAYS||1!==this.a?[ve,_e,be,a$3O(255*this.a)]:[ve,_e,be]}clone(){return new h3(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(fe){return null!=fe&&fe.r===this.r&&fe.g===this.g&&fe.b===this.b&&fe.a===this.a}_sanitize(){return this.r=Math.round(e$3q(this.r,0,255)),this.g=Math.round(e$3q(this.g,0,255)),this.b=Math.round(e$3q(this.b,0,255)),this.a=e$3q(this.a,0,1),this}_set(fe,ve,_e,be){this.r=fe,this.g=ve,this.b=_e,this.a=be}};$_.prototype.declaredClass="esri.Color",function(fe){var ve;(ve=fe.AlphaMode||(fe.AlphaMode={}))[ve.ALWAYS=0]="ALWAYS",ve[ve.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}($_||($_={}));const b_=$_;function n$3P(fe){}function o$3g(fe,ve={}){const _e=fe instanceof An?fe:new An(fe,ve),be={type:(null==ve?void 0:ve.ignoreUnknown)??1?_e.apiValues:String,json:{type:_e.jsonValues,read:!(null==ve?void 0:ve.readOnly)&&{reader:_e.read},write:{writer:_e.write}}};return void 0!==(null==ve?void 0:ve.readOnly)&&(be.readOnly=!!ve.readOnly),void 0!==(null==ve?void 0:ve.default)&&(be.json.default=ve.default),void 0!==(null==ve?void 0:ve.name)&&(be.json.name=ve.name),void 0!==(null==ve?void 0:ve.nonNullable)&&(be.nonNullable=ve.nonNullable),y$2v(be)}var w_;let x_=w_=class extends Pn{constructor(fe){super(fe),this.type="none"}clone(){return new w_({type:this.type})}};function n$3O(fe){const ve=s$4m(100*(1-fe));return Math.max(0,Math.min(ve,100))}function r$2U(fe){const ve=1-fe/100;return Math.max(0,Math.min(ve,1))}var S_;e$4o([o$3g({none:"none",stayAbove:"stay-above"})],x_.prototype,"type",void 0),x_=w_=e$4o([a$4y("esri.ground.NavigationConstraint")],x_);let T_=S_=class extends(u$3V(Sv)){constructor(fe){super(fe),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Wa;const e76=fe=>{fe.parent&&fe.parent!==this&&"remove"in fe.parent&&fe.parent.remove(fe),fe.parent=this,"elevation"!==fe.type&&"base-elevation"!==fe.type&&ar.getLogger(this).error(`Layer '${fe.title}, id:${fe.id}' of type '${fe.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.addHandles([this.layers.on("after-add",(fe=>e76(fe.item))),this.layers.on("after-remove",(fe=>(fe=>{fe.parent=null})(fe.item)))])}initialize(){this.when().catch((fe=>{b$2g(fe)||ar.getLogger(this).error("#load()","Failed to load ground",fe)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const fe=this.layers.removeAll();for(const ve of fe)u$4d(ve);this.layers.destroy()}normalizeCtorArgs(fe){return fe&&"resourceInfo"in fe&&(this._set("resourceInfo",fe.resourceInfo),delete(fe={...fe}).resourceInfo),fe}set layers(fe){this._set("layers",n$4c(fe,this._get("layers")))}writeLayers(fe,ve,_e,be){const we=[];fe?(be={...be,layerContainerType:"ground"},fe.forEach((fe=>{if("write"in fe){const ve={};(function o$3h(fe){return()=>fe})(fe)().write(ve,be)&&we.push(ve)}else(null==be?void 0:be.messages)&&be.messages.push(new Ir("layer:unsupported",`Layers (${fe.title}, ${fe.id}) of type '${fe.declaredClass}' cannot be persisted in the ground`,{layer:fe}))})),ve.layers=we):ve.layers=we}load(fe){return this.addResolvingPromise(this._loadFromSource(fe)),Promise.resolve(this)}loadAll(){return t$3u(this,(fe=>{fe(this.layers)}))}async queryElevation(fe,ve){await this.load({signal:null==ve?void 0:ve.signal});const{ElevationQuery:_e}=await zt((()=>import("./ElevationQuery-BMwebHth.js")),[]);s$4o(ve);const be=new _e,we=this.layers.filter(L$Z).toArray();return be.queryAll(we,fe,ve)}async createElevationSampler(fe,ve){await this.load({signal:null==ve?void 0:ve.signal});const{ElevationQuery:_e}=await zt((()=>import("./ElevationQuery-BMwebHth.js")),[]);s$4o(ve);const be=new _e,we=this.layers.filter(L$Z).toArray();return be.createSamplerAll(we,fe,ve)}clone(){const fe={opacity:this.opacity,surfaceColor:a$4H(this.surfaceColor),navigationConstraint:a$4H(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(fe.loadStatus="loaded"),new S_({resourceInfo:this.resourceInfo}).set(fe)}read(fe,ve){this.resourceInfo||this._set("resourceInfo",{data:fe,context:ve}),super.read(fe,ve)}_loadFromSource(fe){const ve=this.resourceInfo;return ve?this._loadLayersFromJSON(ve.data,ve.context,fe):Promise.resolve()}async _loadLayersFromJSON(fe,ve,_e){const be=(null==ve?void 0:ve.origin)||"web-scene",we=(null==ve?void 0:ve.portal)||null,Se=(null==ve?void 0:ve.url)||null,{populateOperationalLayers:Te}=await zt((async()=>{const{populateOperationalLayers:fe}=await import("./layersCreator-CnQujQsO.js");return{populateOperationalLayers:fe}}),__vite__mapDeps([72,73,74]));s$4o(_e);const Ee=[];if(fe.layers&&Array.isArray(fe.layers)){const ve={context:{origin:be,url:Se,portal:we,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};Ee.push(Te(this.layers,fe.layers,ve))}await Promise.allSettled(Ee)}};function L$Z(fe){return"elevation"===fe.type||function I$1i(fe){return fe&&"createElevationSampler"in fe}(fe)}e$4o([y$2v({json:{read:!1}})],T_.prototype,"layers",null),e$4o([r$3s("layers")],T_.prototype,"writeLayers",null),e$4o([y$2v({readOnly:!0})],T_.prototype,"resourceInfo",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ci,read:{reader:r$2U,source:"transparency"},write:{writer:(fe,ve)=>{ve.transparency=n$3O(fe)},target:"transparency"}}})],T_.prototype,"opacity",void 0),e$4o([y$2v({type:b_,json:{type:[Ci],write:(fe,ve)=>{ve.surfaceColor=fe.toJSON().slice(0,3)}}})],T_.prototype,"surfaceColor",void 0),e$4o([y$2v({type:x_,json:{write:!0}})],T_.prototype,"navigationConstraint",void 0),T_=S_=e$4o([a$4y("esri.Ground")],T_);const E_=T_;let P_=class i7 extends Wa{constructor(fe){super(fe),this.getCollections=null}initialize(){this.addHandles(i$4J((()=>this._refresh())))}destroy(){this.getCollections=null}_refresh(){const fe=null!=this.getCollections?this.getCollections():null;if(null==fe)return void this.removeAll();let ve=0;for(const _e of fe)null!=_e&&(ve=this._processCollection(ve,_e));this.splice(ve,this.length)}_createNewInstance(fe){return new Wa(fe)}_processCollection(fe,ve){if(!ve)return fe;const _e=this.itemFilterFunction??(fe=>!!fe);for(const be of ve)if(be){if(_e(be)){const ve=this.indexOf(be,fe);ve>=0?ve!==fe&&this.reorder(be,fe):this.add(be,fe),++fe}if(this.getChildrenFunction){const ve=this.getChildrenFunction(be);if(Array.isArray(ve))for(const _e of ve)fe=this._processCollection(fe,_e);else fe=this._processCollection(fe,ve)}}return fe}};e$4o([y$2v()],P_.prototype,"getCollections",void 0),e$4o([y$2v()],P_.prototype,"getChildrenFunction",void 0),e$4o([y$2v()],P_.prototype,"itemFilterFunction",void 0),P_=e$4o([a$4y("esri.core.CollectionFlattener")],P_);const C_=P_,O_=new WeakMap;function a$3N(fe){return!fe.destroyed&&(O_.has(fe)||fe.addHandles([d$3d((()=>{const ve=fe.parent;return!(!ve||!("type"in ve))&&("catalog-dynamic-group"===ve.type||a$3N(ve))}),(ve=>O_.set(fe,ve)),Ja),e$4e((()=>O_.delete(fe)))]),O_.get(fe))}function e$3p(fe){var ve,_e;return!(!function n$3N(fe){return"object"==typeof fe&&null!=fe&&"loaded"in fe&&!0===fe.loaded&&"type"in fe}(fe)||!(null==(_e=null==(ve=O$1g(fe))?void 0:ve.operations)?void 0:_e.supportsEditing)||"editingEnabled"in fe&&!B$W(fe)||a$3N(fe))}function e$3o(){const fe=new Float32Array(16);return fe[0]=1,fe[5]=1,fe[10]=1,fe[15]=1,fe}const A_=e$3o();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:A_,clone:function r$2S(fe){const ve=new Float32Array(16);return ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[2],ve[3]=fe[3],ve[4]=fe[4],ve[5]=fe[5],ve[6]=fe[6],ve[7]=fe[7],ve[8]=fe[8],ve[9]=fe[9],ve[10]=fe[10],ve[11]=fe[11],ve[12]=fe[12],ve[13]=fe[13],ve[14]=fe[14],ve[15]=fe[15],ve},create:e$3o,createView:function n$3M(fe,ve){return new Float32Array(fe,ve,16)},fromValues:function t$3s(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je){const Qe=new Float32Array(16);return Qe[0]=fe,Qe[1]=ve,Qe[2]=_e,Qe[3]=be,Qe[4]=we,Qe[5]=Se,Qe[6]=Te,Qe[7]=Ee,Qe[8]=Ce,Qe[9]=Oe,Qe[10]=Re,Qe[11]=De,Qe[12]=Be,Qe[13]=Ze,Qe[14]=Xe,Qe[15]=Je,Qe}},Symbol.toStringTag,{value:"Module"}));let M_=class c7{constructor(fe,ve,_e){this.strength=fe,this.radius=ve,this.threshold=_e,this.type="bloom"}interpolate(fe,ve,_e){this.strength=M$19(fe.strength,ve.strength,_e),this.radius=M$19(fe.radius,ve.radius,_e),this.threshold=M$19(fe.threshold,ve.threshold,_e)}clone(){return new c7(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:y$1P(this.radius),strength:this.strength,threshold:this.threshold}}},R_=class l3{constructor(fe){this.radius=fe,this.type="blur"}interpolate(fe,ve,_e){this.radius=Math.round(M$19(fe.radius,ve.radius,_e))}clone(){return new l3(this.radius)}toJSON(){return{type:"blur",radius:y$1P(this.radius)}}},I_=class p4{constructor(fe,ve){this.type=fe,this.amount=ve,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(fe,ve,_e){this.amount=M$19(fe.amount,ve.amount,_e),this._updateMatrix()}clone(){return new p4(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const fe=this._colorMatrix||e$3o();switch(this.type){case"brightness":this._colorMatrix=((fe,ve)=>{const _e=r$3a(fe,ve,0,0,0,0,ve,0,0,0,0,ve,0,0,0,0,1);return s$3L(_e,_e)})(fe,this.amount);break;case"contrast":this._colorMatrix=((fe,ve)=>{const _e=r$3a(fe,ve,0,0,.5-.5*ve,0,ve,0,.5-.5*ve,0,0,ve,.5-.5*ve,0,0,0,1);return s$3L(_e,_e)})(fe,this.amount);break;case"grayscale":this._colorMatrix=((fe,ve)=>{const _e=1-ve,be=r$3a(fe,.2126+.7874*_e,.7152-.7152*_e,.0722-.0722*_e,0,.2126-.2126*_e,.7152+.2848*_e,.0722-.0722*_e,0,.2126-.2126*_e,.7152-.7152*_e,.0722+.9278*_e,0,0,0,0,1);return s$3L(be,be)})(fe,this.amount);break;case"invert":this._colorMatrix=((fe,ve)=>{const _e=1-2*ve,be=r$3a(fe,_e,0,0,ve,0,_e,0,ve,0,0,_e,ve,0,0,0,1);return s$3L(be,be)})(fe,this.amount);break;case"saturate":this._colorMatrix=((fe,ve)=>{const _e=r$3a(fe,.213+.787*ve,.715-.715*ve,.072-.072*ve,0,.213-.213*ve,.715+.285*ve,.072-.072*ve,0,.213-.213*ve,.715-.715*ve,.072+.928*ve,0,0,0,0,1);return s$3L(_e,_e)})(fe,this.amount);break;case"sepia":this._colorMatrix=((fe,ve)=>{const _e=1-ve,be=r$3a(fe,.393+.607*_e,.769-.769*_e,.189-.189*_e,0,.349-.349*_e,.686+.314*_e,.168-.168*_e,0,.272-.272*_e,.534-.534*_e,.131+.869*_e,0,0,0,0,1);return s$3L(be,be)})(fe,this.amount)}}},L_=class d5{constructor(fe,ve,_e,be){this.offsetX=fe,this.offsetY=ve,this.blurRadius=_e,this.color=be,this.type="drop-shadow"}interpolate(fe,ve,_e){this.offsetX=M$19(fe.offsetX,ve.offsetX,_e),this.offsetY=M$19(fe.offsetY,ve.offsetY,_e),this.blurRadius=M$19(fe.blurRadius,ve.blurRadius,_e),this.color[0]=Math.round(M$19(fe.color[0],ve.color[0],_e)),this.color[1]=Math.round(M$19(fe.color[1],ve.color[1],_e)),this.color[2]=Math.round(M$19(fe.color[2],ve.color[2],_e)),this.color[3]=M$19(fe.color[3],ve.color[3],_e)}clone(){return new d5(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const fe=[...this.color];return fe[3]*=255,{type:"drop-shadow",xoffset:y$1P(this.offsetX),yoffset:y$1P(this.offsetY),blurRadius:y$1P(this.blurRadius),color:fe}}},D_=class m7{constructor(fe){this.angle=fe,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(fe,ve,_e){this.angle=M$19(fe.angle,ve.angle,_e),this._updateMatrix()}clone(){return new m7(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const fe=this._colorMatrix||e$3o();this._colorMatrix=((fe,ve)=>{const _e=Math.sin(ve*Math.PI/180),be=Math.cos(ve*Math.PI/180),we=r$3a(fe,.213+.787*be-.213*_e,.715-.715*be-.715*_e,.072-.072*be+.928*_e,0,.213-.213*be+.143*_e,.715+.285*be+.14*_e,.072-.072*be-.283*_e,0,.213-.213*be-.787*_e,.715-.715*be+.715*_e,.072+.928*be+.072*_e,0,0,0,0,1);return s$3L(we,we)})(fe,this.angle)}},N_=class f3{constructor(fe){this.amount=fe,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(fe,ve,_e){this.amount=M$19(fe.amount,ve.amount,_e)}clone(){return new f3(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function M$19(fe,ve,_e){return fe+(ve-fe)*_e}function y$1P(fe){return Math.round(1e3*e$3N(fe))/1e3}function x$1k(fe){switch(fe.type){case"grayscale":case"sepia":case"invert":return new I_(fe.type,0);case"saturate":case"brightness":case"contrast":return new I_(fe.type,1);case"opacity":return new N_(1);case"hue-rotate":return new D_(0);case"blur":return new R_(0);case"drop-shadow":return new L_(0,0,0,[...l$3F("transparent")]);case"bloom":return new M_(0,0,1)}}function t$3r(fe,ve){const _e=fe.length>ve.length?fe:ve;return(fe.length>ve.length?ve:fe).every(((fe,ve)=>fe.type===_e[ve].type))}function e$3m(fe,ve){const _e=fe.length>ve.length?fe:ve,be=fe.length>ve.length?ve:fe;for(let we=be.length;we<_e.length;we++)be.push(x$1k(_e[we]))}const p$49=()=>ar.getLogger("esri.support.basemapUtils");function S$1u(fe,ve){var _e,be,we,Se;return(null==(be=null==(_e=fe.basemap)?void 0:_e.referenceLayers)?void 0:be.some((fe=>fe.uid===ve)))||(null==(Se=null==(we=fe.basemap)?void 0:we.baseLayers)?void 0:Se.some((fe=>fe.uid===ve)))}function t$3q(fe){return new C_({getCollections:()=>[fe.tables,fe.layers],getChildrenFunction:fe=>{const ve=[];return"tables"in fe&&ve.push(fe.tables),"layers"in fe&&ve.push(fe.layers),ve},itemFilterFunction:fe=>{const ve=fe.parent;return!!ve&&"tables"in ve&&ve.tables.includes(fe)}})}function n$3K(fe){for(const ve of fe.values())null==ve||ve.destroy();fe.clear()}const F_={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};const z_={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function o$3d(fe,ve,_e,be=xu){const we=new IANAZone(F$16(be)),Se=DateTime.fromJSDate(fe,{zone:we}),Te="decades"===_e||"centuries"===_e?"year":T$13(_e);return"decades"===_e&&(ve*=10),"centuries"===_e&&(ve*=100),Se.plus({[Te]:ve}).toJSDate()}function i$3J(fe,ve,_e="milliseconds"){const be=fe.getTime(),we=m$2W(ve,_e,"milliseconds");return new Date(be+we)}function c$3V(fe,ve,_e=xu){const be=new IANAZone(F$16(_e)),we=DateTime.fromJSDate(fe,{zone:be});if("decades"===ve||"centuries"===ve){const fe=we.startOf("year"),{year:_e}=fe,be=_e-_e%("decades"===ve?10:100);return fe.set({year:be}).toJSDate()}const Se=T$13(ve);return we.startOf(Se).toJSDate()}function m$2W(fe,ve,_e){return 0===fe?0:fe*z_[ve]/z_[_e]}function g$1Y(fe,ve){return fe&&ve?fe.intersection(ve):fe||ve}function T$13(fe){switch(fe){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var k_;let U_=k_=class extends Pn{static get allTime(){return V_}static get empty(){return B_}static fromArray(fe){return new k_({start:null!=fe[0]?new Date(fe[0]):fe[0],end:null!=fe[1]?new Date(fe[1]):fe[1]})}constructor(fe){super(fe),this.end=null,this.start=null}readEnd(fe,ve){return null!=ve.end?new Date(ve.end):null}writeEnd(fe,ve){ve.end=(null==fe?void 0:fe.getTime())??null}get isAllTime(){return this.equals(k_.allTime)}get isEmpty(){return this.equals(k_.empty)}readStart(fe,ve){return null!=ve.start?new Date(ve.start):null}writeStart(fe,ve){ve.start=(null==fe?void 0:fe.getTime())??null}clone(){return new k_({end:this.end,start:this.start})}equals(fe){var ve,_e,be,we;if(!fe)return!1;const Se=(null==(ve=this.start)?void 0:ve.getTime())??this.start,Te=(null==(_e=this.end)?void 0:_e.getTime())??this.end,Ee=(null==(be=fe.start)?void 0:be.getTime())??fe.start,Ce=(null==(we=fe.end)?void 0:we.getTime())??fe.end;return Se===Ee&&Te===Ce}expandTo(fe,ve=xu){if(this.isEmpty||this.isAllTime)return this.clone();let _e=this.start;_e&&(_e=c$3V(_e,fe,ve));let be=this.end;if(be){const _e=c$3V(be,fe,ve);be=be.getTime()===_e.getTime()?_e:o$3d(_e,1,fe,ve)}return new k_({start:_e,end:be})}intersection(fe){var ve,_e,be,we;if(!fe)return this.clone();if(this.isEmpty||fe.isEmpty)return k_.empty;if(this.isAllTime)return fe.clone();if(fe.isAllTime)return this.clone();const Se=(null==(ve=this.start)?void 0:ve.getTime())??-1/0,Te=(null==(_e=this.end)?void 0:_e.getTime())??1/0,Ee=(null==(be=fe.start)?void 0:be.getTime())??-1/0,Ce=(null==(we=fe.end)?void 0:we.getTime())??1/0;let Oe,Re;return Ee>=Se&&Ee<=Te?Oe=Ee:Se>=Ee&&Se<=Ce&&(Oe=Se),Te>=Ee&&Te<=Ce?Re=Te:Ce>=Se&&Ce<=Te&&(Re=Ce),null==Oe||null==Re||isNaN(Oe)||isNaN(Re)?k_.empty:new k_({start:Oe===-1/0?null:new Date(Oe),end:Re===1/0?null:new Date(Re)})}offset(fe,ve,_e=xu){if(this.isEmpty||this.isAllTime)return this.clone();const be=new k_,{start:we,end:Se}=this;return null!=we&&(be.start=o$3d(we,fe,ve,_e)),null!=Se&&(be.end=o$3d(Se,fe,ve,_e)),be}toArray(){var fe,ve;return this.isEmpty?[void 0,void 0]:[(null==(fe=this.start)?void 0:fe.getTime())??null,(null==(ve=this.end)?void 0:ve.getTime())??null]}union(fe){if(!fe||fe.isEmpty)return this.clone();if(this.isEmpty)return fe.clone();if(this.isAllTime||fe.isAllTime)return V_.clone();const ve=null!=this.start&&null!=fe.start?new Date(Math.min(this.start.getTime(),fe.start.getTime())):null,_e=null!=this.end&&null!=fe.end?new Date(Math.max(this.end.getTime(),fe.end.getTime())):null;return new k_({start:ve,end:_e})}};e$4o([y$2v({type:Date,json:{write:{allowNull:!0}}})],U_.prototype,"end",void 0),e$4o([o$40("end")],U_.prototype,"readEnd",null),e$4o([r$3s("end")],U_.prototype,"writeEnd",null),e$4o([y$2v({readOnly:!0,json:{read:!1}})],U_.prototype,"isAllTime",null),e$4o([y$2v({readOnly:!0,json:{read:!1}})],U_.prototype,"isEmpty",null),e$4o([y$2v({type:Date,json:{write:{allowNull:!0}}})],U_.prototype,"start",void 0),e$4o([o$40("start")],U_.prototype,"readStart",null),e$4o([r$3s("start")],U_.prototype,"writeStart",null),U_=k_=e$4o([a$4y("esri.TimeExtent")],U_);const V_=new U_,B_=new U_({start:void 0,end:void 0}),j_=U_;let G_=0;const s$3x=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+G_++})}};return ve=e$4o([a$4y("esri.core.Identifiable")],ve),ve},i$3I=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:G_++})}};return ve=e$4o([a$4y("esri.core.Identifiable.NumericIdentifiable")],ve),ve};let H_=class o3 extends(s$3x(class{})){};H_=e$4o([a$4y("esri.core.Identifiable")],H_);let q_=0,W_=class b3 extends(La.EventedMixin(s$3x(Sv))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new aa(-180,-90,180,90,zo.WGS84),this.id=Date.now().toString(16)+"-layer-"+q_++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=zo.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(fe){const ve="string"==typeof fe?{url:fe}:fe;return(await zt((async()=>{const{fromUrl:fe}=await import("./arcgisLayers-CGTLBiNd.js");return{fromUrl:fe}}),__vite__mapDeps([75,74]))).fromUrl(ve)}static fromPortalItem(fe){return async function o$3b(fe){var ve;const _e="portalItem"in fe?fe:{portalItem:fe},{fromItem:be}=await zt((async()=>{const{fromItem:fe}=await import("./portalLayers-CiL_1SNh.js").then((fe=>fe.p));return{fromItem:fe}}),__vite__mapDeps([73,74]));try{return await be(_e)}catch(we){const fe=null==_e?void 0:_e.portalItem,be=(null==fe?void 0:fe.id)||"unset",Se=(null==(ve=null==fe?void 0:fe.portal)?void 0:ve.url)||ir.portalUrl;throw ar.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+Se+"', id: '"+be+"')",we),we}}(fe)}initialize(){this.when().catch((fe=>{b$2g(fe)||ar.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:fe})}))}destroy(){const fe=this.parent;if(fe){const ve=this;"layers"in fe&&fe.layers.includes(ve)?fe.layers.remove(ve):"tables"in fe&&fe.tables.includes(ve)?fe.tables.remove(ve):"baseLayers"in fe&&fe.baseLayers.includes(ve)?fe.baseLayers.remove(ve):"referenceLayers"in fe&&fe.referenceLayers.includes(ve)&&fe.referenceLayers.remove(ve),this._set("parent",null)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){return I$1E(this.url)}async fetchAttributionData(){const fe=this.attributionDataUrl;if(this.hasAttributionData&&fe)return(await U$1a(fe,{query:{f:"json"},responseType:"json"})).data;throw new Ir("layer:no-attribution-data","Layer does not have attribution data")}};e$4o([y$2v({type:String})],W_.prototype,"attributionDataUrl",void 0),e$4o([y$2v({type:aa})],W_.prototype,"fullExtent",void 0),e$4o([y$2v({readOnly:!0})],W_.prototype,"hasAttributionData",null),e$4o([y$2v({type:String,clonable:!1})],W_.prototype,"id",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0})],W_.prototype,"legendEnabled",void 0),e$4o([y$2v({type:["show","hide","hide-children"]})],W_.prototype,"listMode",void 0),e$4o([y$2v({type:Number,range:{min:0,max:1},nonNullable:!0})],W_.prototype,"opacity",void 0),e$4o([y$2v({clonable:!1})],W_.prototype,"parent",void 0),e$4o([y$2v({readOnly:!0})],W_.prototype,"parsedUrl",null),e$4o([y$2v({type:Boolean,readOnly:!0})],W_.prototype,"persistenceEnabled",void 0),e$4o([y$2v({type:Boolean})],W_.prototype,"popupEnabled",void 0),e$4o([y$2v({type:Boolean})],W_.prototype,"attributionVisible",void 0),e$4o([y$2v({type:zo})],W_.prototype,"spatialReference",void 0),e$4o([y$2v({type:String})],W_.prototype,"title",void 0),e$4o([y$2v({readOnly:!0,json:{read:!1}})],W_.prototype,"type",void 0),e$4o([y$2v()],W_.prototype,"url",void 0),e$4o([y$2v({type:j_})],W_.prototype,"visibilityTimeExtent",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0})],W_.prototype,"visible",void 0),W_=e$4o([a$4y("esri.layers.Layer")],W_);const Y_=W_;function d$2H(fe,ve,_e){let be,we;if(fe)for(let Se=0,Te=fe.length;Se<Te;Se++){if(be=fe.at(Se),(null==be?void 0:be[ve])===_e)return be;if("group"===(null==be?void 0:be.type)&&(we=d$2H(be.layers,ve,_e),we))return we}}const l$3B=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.layers=new Wa;const o39=fe=>{fe.parent=this,this.layerAdded(fe),"elevation"!==fe.type&&"base-elevation"!==fe.type||ar.getLogger(this).error(`Layer 'title:${fe.title}, id:${fe.id}' of type '${fe.type}' is not supported as an operational layer and will therefore be ignored.`)},a55=fe=>{fe.parent=null,this.layerRemoved(fe)};this.addHandles([this.layers.on("before-add",(fe=>{if(fe.item===this)return fe.preventDefault(),void ar.getLogger(this).error("#add()","Cannot add layer to itself.");(fe=>{fe.parent&&"remove"in fe.parent&&fe.parent.remove(fe)})(fe.item)})),this.layers.on("after-add",(fe=>o39(fe.item))),this.layers.on("after-remove",(fe=>a55(fe.item)))])}destroy(){const fe=this.layers.toArray();for(const ve of fe)ve.destroy();this.layers.destroy()}set layers(fe){this._set("layers",n$4c(fe,this._get("layers")))}add(fe,ve){const _e=this.layers;if(ve=_e.getNextIndex(ve),fe instanceof Y_){const be=fe;be.parent===this?this.reorder(be,ve):_e.add(be,ve)}else S$1T(fe)?fe.then((fe=>{this.destroyed||this.add(fe,ve)})):ar.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(fe,ve){const _e=this.layers;let be=_e.getNextIndex(ve);fe.slice().forEach((fe=>{fe.parent!==this?(_e.add(fe,be),be+=1):this.reorder(fe,be)}))}findLayerById(fe){return d$2H(this.layers,"id",fe)}findLayerByUid(fe){return d$2H(this.layers,"uid",fe)}remove(fe){return this.layers.remove(fe)}removeMany(fe){return this.layers.removeMany(fe)}removeAll(){return this.layers.removeAll()}reorder(fe,ve){return this.layers.reorder(fe,ve)}layerAdded(fe){}layerRemoved(fe){}};return e$4o([y$2v()],ve.prototype,"layers",null),ve=e$4o([a$4y("esri.support.LayersMixin")],ve),ve};function a$3L(fe,ve,_e){if(fe)for(let be=0,we=fe.length;be<we;be++){const we=fe.at(be);if(we[ve]===_e)return we;if("group"===(null==we?void 0:we.type)){const fe=a$3L(we.tables,ve,_e);if(fe)return fe}}}const n$3J=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.tables=new Wa,this.addHandles([this.tables.on("after-add",(fe=>{const ve=fe.item;ve.parent&&ve.parent!==this&&"tables"in ve.parent&&ve.parent.tables.remove(ve),ve.parent=this,"feature"!==ve.type&&ar.getLogger(this).error(`Layer 'title:${ve.title}, id:${ve.id}' of type '${ve.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(fe=>{fe.item.parent=null}))])}destroy(){const fe=this.tables.toArray();for(const ve of fe)ve.destroy();this.tables.destroy()}set tables(fe){this._set("tables",n$4c(fe,this._get("tables")))}findTableById(fe){return a$3L(this.tables,"id",fe)}findTableByUid(fe){return a$3L(this.tables,"uid",fe)}};return e$4o([y$2v()],ve.prototype,"tables",null),ve=e$4o([a$4y("esri.support.TablesMixin")],ve),ve};let Z_=class j2 extends(n$3J(l$3B(La.EventedMixin(zi)))){constructor(fe){super(fe),this.allLayers=new C_({getCollections:()=>{var fe,ve,_e;return[null==(fe=this.basemap)?void 0:fe.baseLayers,null==(ve=this.ground)?void 0:ve.layers,this.layers,null==(_e=this.basemap)?void 0:_e.referenceLayers]},getChildrenFunction:fe=>"layers"in fe?fe.layers:null}),this.allTables=t$3q(this),this.basemap=null,this.editableLayers=new C_({getCollections:()=>[this.allLayers],itemFilterFunction:e$3p}),this.ground=new E_,this._basemapCache={}}destroy(){(function m$2X(fe){for(const ve in fe)u$4d(fe[ve]),delete fe[ve]})(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=u$4d(this.basemap),u$4d(this.ground),this._set("ground",null)}castBasemap(fe){return function b$1J(fe,ve){let _e;if("string"==typeof fe){const be=fe in o_,we=!be&&fe.includes("/");if(!be&&!we){const ve=Object.entries(o_).filter((([fe,ve])=>ir.apiKey&&!ve.classic||!ir.apiKey&&(ve.classic||ve.is3d))).map((([fe])=>`"${fe}"`)).sort().join(", ");return p$49().warn(`Unable to find basemap definition for: ${fe}. Try one of these: ${ve}`),null}ve&&(_e=ve[fe]),_e||(_e=be?g_.fromId(fe):new g_({style:{id:fe}}),ve&&(ve[fe]=_e))}else _e=b$2d(g_,fe);return(null==_e?void 0:_e.destroyed)&&(p$49().warn("The provided basemap is already destroyed",{basemap:_e}),_e=null),_e}(fe,this._basemapCache)}castGround(fe){const ve=function t$3p(fe){let ve=null;"string"==typeof fe?fe in F_?ve=new E_({resourceInfo:{data:{layers:[F_[fe]]}}}):ar.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${fe}. Try "world-elevation"`):ve=b$2d(E_,fe);return ve}(fe);return ve??this._get("ground")}findLayerById(fe){return this.allLayers.find((ve=>ve.id===fe))}findTableById(fe){return this.allTables.find((ve=>ve.id===fe))}};e$4o([y$2v({readOnly:!0,dependsOn:[]})],Z_.prototype,"allLayers",void 0),e$4o([y$2v({readOnly:!0})],Z_.prototype,"allTables",void 0),e$4o([y$2v({type:g_,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Z_.prototype,"basemap",void 0),e$4o([s$4b("basemap")],Z_.prototype,"castBasemap",null),e$4o([y$2v({readOnly:!0})],Z_.prototype,"editableLayers",void 0),e$4o([y$2v({type:E_,nonNullable:!0})],Z_.prototype,"ground",void 0),e$4o([s$4b("ground")],Z_.prototype,"castGround",null),e$4o([y$2v()],Z_.prototype,"undoRedo",void 0),Z_=e$4o([a$4y("esri.Map")],Z_);const X_=Z_;async function e$3l(fe,ve){const{WhereClause:_e}=await zt((()=>import("./WhereClause-DYd7Xwn9.js").then((fe=>fe.W))),__vite__mapDeps([20,21]));return _e.create(fe,ve)}function n$3I(fe,ve){return"1=1"===fe?ve??fe:"1=1"===ve?fe??ve:null!=fe&&""!==fe?null!=ve&&""!==ve?`(${fe}) AND (${ve})`:fe:ve}function n$3H(fe){return"number"==typeof fe}function t$3o(fe){return"string"==typeof fe||fe instanceof String}const J_="yyyy-MM-dd";var Q_;!function(fe){fe.HM="HH:mm",fe.HMS="HH:mm:ss",fe.HMS_MS="HH:mm:ss.SSS"}(Q_||(Q_={}));const K_=[Q_.HMS_MS,Q_.HMS,Q_.HM,"TT"];function E$1o(fe){if(!fe||!t$3o(fe))return null;const ve=DateTime.fromFormat(fe,J_);return ve.isValid?ve:null}function J$x(fe){return fe&&t$3o(fe)?function f$3x(fe,ve){let _e;return fe.some(((fe,be)=>(_e=ve(fe,be),null!=_e))),_e??void 0}(K_,(ve=>{const _e=DateTime.fromFormat(fe,ve);return _e.isValid?_e:null}))??null:null}function R$10(fe){if(!fe||!t$3o(fe))return null;const ve=DateTime.fromISO(fe);return ve.isValid?ve:null}var e$;!function(fe){fe.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",fe.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(e$||(e$={}));const t$=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function a$3K(fe){return null!=fe&&("date-only"===fe.type||"esriFieldTypeDateOnly"===fe.type)}function u$32(fe){return null!=fe&&("timestamp-offset"===fe.type||"esriFieldTypeTimestampOffset"===fe.type)}function o$3a(fe){return null!=fe&&("time-only"===fe.type||"esriFieldTypeTimeOnly"===fe.type)}function m$2U(fe,ve){const _e=null==fe?void 0:fe.domain;if(!_e||"range"!==_e.type)return;const be="range"in _e?_e.range[0]:_e.minValue,we="range"in _e?_e.range[1]:_e.maxValue,Se=function r$2P(fe){return null!=fe&&t$.has(fe.type)}(fe);return a$3K(fe)||o$3a(fe)||u$32(fe)?{...d$2G(fe,we,be),isInteger:Se}:{min:null!=be&&"number"==typeof be?be:null,max:null!=we&&"number"==typeof we?we:null,rawMin:be,rawMax:we,isInteger:Se}}function d$2G(fe,ve,_e){var be,we,Se,Te,Ee,Ce;return a$3K(fe)?{min:null==(be=E$1o(_e))?void 0:be.toMillis(),max:null==(we=E$1o(ve))?void 0:we.toMillis(),rawMin:_e,rawMax:ve}:o$3a(fe)?{min:null==(Se=J$x(_e))?void 0:Se.toMillis(),max:null==(Te=J$x(ve))?void 0:Te.toMillis(),rawMin:_e,rawMax:ve}:u$32(fe)?{min:null==(Ee=R$10(_e))?void 0:Ee.toMillis(),max:null==(Ce=R$10(ve))?void 0:Ce.toMillis(),rawMin:_e,rawMax:ve}:{max:null,min:null}}let r$;function i$3H(){return r$||(r$=(async()=>{const fe=await zt((()=>import("./arcadeUtils-CHsZDnQG.js").then((fe=>fe.aN))),__vite__mapDeps([76,21,77,24,78]));return{arcade:fe.arcade,arcadeUtils:fe,Dictionary:fe.Dictionary,Feature:fe.arcadeFeature}})()),r$}const o$39=(fe,ve,_e)=>i$.create(fe,ve,_e,null,["$feature","$view"],[]);let i$=class p5{constructor(fe,ve,_e,be,we,Se,Te){this.services=null,this.script=fe,this.evaluate=be;const Ee=Array.isArray(Se)?Se:null==Se?void 0:Se.fields;this.fields=Ee??[],this._syntaxTree=_e,this._arcade=ve,this._arcadeFeature=we,this._spatialReference=Te,this._referencesGeometry=ve.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(fe,ve,_e,be,we,Se){const{arcade:Te,Feature:Ee,Dictionary:Ce}=await i$3H(),Oe=zo.fromJSON(ve);let Re;try{Re=Te.parseScript(fe,Se)}catch(St){return ar.getLogger("esri.support.arcadeOnDemand").error(new Ir("arcade-bad-expression","Failed to parse arcade script",{script:fe,error:St})),null}const De=we.reduce(((fe,ve)=>({...fe,[ve]:null})),{});let Be=null;null!=be&&(Be=new Ce(be),Be.immutable=!0,De.$config=null);const Ze=Te.scriptUsesGeometryEngine(Re),Xe=Ze&&Te.enableGeometrySupport(),Je=Te.scriptUsesFeatureSet(Re)&&Te.enableFeatureSetSupport(),Qe=Te.scriptIsAsync(Re),dt=Qe&&Te.enableAsyncSupport(),$t={vars:De,spatialReference:Oe,useAsync:!!dt};await Promise.all([Xe,Je,dt]);const bt=new Set;await Te.loadDependentModules(bt,Re,null,Qe,Ze);const wt=new Ce;wt.immutable=!1,wt.setField("scale",0);const xt=Te.compileScript(Re,$t);return new p5(fe,Te,Re,((fe,ve)=>{var _e;const be=null==(_e=fe.$view)?void 0:_e.timeZone;return"$view"in fe&&fe.$view&&(wt.setField("scale","object"==typeof fe.$view&&"scale"in fe.$view?fe.$view.scale:void 0),fe.$view=wt),Be&&(fe.$config=Be),xt({vars:fe,spatialReference:Oe,services:ve,timeZone:be})}),new Ee,_e,Oe)}repurposeFeature(fe){return fe.geometry&&!fe.geometry.spatialReference&&(fe.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(fe.geometry,fe.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const n$=/^([0-9_])/,s$=/[^a-z0-9_\u0080-\uffff]+/gi;function c$3S(fe){return null==fe?null:fe.trim().replaceAll(s$,"_").replace(n$,"F$1")||null}const o$=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],a$=["field","normalizationField"];function p$46(fe,ve){if(null!=fe&&null!=ve)for(const _e of Array.isArray(fe)?fe:[fe])if(y$1N(o$,_e,ve),"visualVariables"in _e&&_e.visualVariables)for(const fe of _e.visualVariables)y$1N(a$,fe,ve)}function y$1N(fe,ve,_e){if(fe)for(const be of fe){const fe=t$4s(be,ve),we=fe&&"function"!=typeof fe&&_e.get(fe);we&&e$4h(be,we.name,ve)}}function g$1X(fe,ve){var _e;if(null!=fe&&(null==(_e=null==ve?void 0:ve.fields)?void 0:_e.length))if("startField"in fe){const _e=ve.get(fe.startField),be=ve.get(fe.endField);fe.startField=(null==_e?void 0:_e.name)??null,fe.endField=(null==be?void 0:be.name)??null}else{const _e=ve.get(fe.startTimeField),be=ve.get(fe.endTimeField);fe.startTimeField=(null==_e?void 0:_e.name)??null,fe.endTimeField=(null==be?void 0:be.name)??null}}const l$=new Set;function I$1h(fe,ve){return fe&&ve?(l$.clear(),b$1H(l$,fe,ve),Array.from(l$).sort()):[]}function b$1H(fe,ve,_e){var be;if(_e)if(null==(be=null==ve?void 0:ve.fields)?void 0:be.length)if(_e.includes("*"))for(const{name:we}of ve.fields)fe.add(we);else for(const we of _e)w$1u(fe,ve,we);else{if(_e.includes("*"))return fe.clear(),void fe.add("*");for(const ve of _e)null!=ve&&fe.add(ve)}}function w$1u(fe,ve,_e){if("string"==typeof _e)if(ve){const be=ve.get(_e);be&&fe.add(be.name)}else fe.add(_e)}function x$1j(fe,ve){return null==ve||null==fe?[]:ve.includes("*")?(fe.fields??[]).map((fe=>fe.name)):ve}async function h$2h(fe,ve,_e){var be;if(!_e)return;const{arcadeUtils:we}=await i$3H(),Se=we.extractFieldNames(_e,null==(be=null==ve?void 0:ve.fields)?void 0:be.map((fe=>fe.name)));for(const Te of Se)w$1u(fe,ve,Te)}async function E$1n(fe,ve,_e){if(_e&&"1=1"!==_e){const be=await e$3l(_e,ve);if(!be.isStandardized)throw new Ir("fieldUtils:collectFilterFields","Where clause is not standardized",{where:_e});b$1H(fe,ve,be.fieldNames)}}function S$1s(fe,ve){for(const _e of fe)if((null==_e?void 0:_e.valueType)&&_e.valueType===ve)return _e.name;return null}async function v$1v(fe,ve){var _e;if(!ve)return;const be=null==(_e=ve.elevationInfo)?void 0:_e.featureExpressionInfo;return be?be.collectRequiredFields(fe,ve.fieldsIndex):void 0}async function L$X(fe,ve,_e){if(!ve||!_e||!("fields"in _e))return;const be=[],we=_e.popupTemplate;be.push(async function D$Z(fe,ve,_e){const be=[];(null==_e?void 0:_e.expressionInfos)&&be.push(..._e.expressionInfos.map((_e=>h$2h(fe,ve.fieldsIndex,_e.expression))));const we=null==_e?void 0:_e.content;if(Array.isArray(we))for(const Se of we)"expression"===Se.type&&Se.expressionInfo&&be.push(h$2h(fe,ve.fieldsIndex,Se.expressionInfo.expression));await Promise.all(be)}(fe,ve,we)),_e.fields&&be.push(..._e.fields.map((async _e=>function $$v(fe,ve,_e){_e.onStatisticExpression?h$2h(fe,ve,_e.onStatisticExpression.expression):fe.add(_e.onStatisticField)}(fe,ve.fieldsIndex,_e)))),await Promise.all(be)}async function M$17(fe,ve,_e){ve&&(ve.timeInfo&&(null==_e?void 0:_e.timeExtent)&&b$1H(fe,ve.fieldsIndex,[ve.timeInfo.startField,ve.timeInfo.endField]),ve.floorInfo&&b$1H(fe,ve.fieldsIndex,[ve.floorInfo.floorField]),null!=(null==_e?void 0:_e.where)&&await E$1n(fe,ve.fieldsIndex,_e.where))}async function O$17(fe,ve,_e){ve&&_e&&await Promise.all(_e.map((_e=>async function V$X(fe,ve,_e){ve&&_e&&(_e.valueExpression?await h$2h(fe,ve.fieldsIndex,_e.valueExpression):_e.field&&w$1u(fe,ve.fieldsIndex,_e.field))}(fe,ve,_e))))}const c$=new Set(["oid","global-id","guid"]),u$=new Set(["oid","global-id"]),h$=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function X$o(fe){const ve=new Set;P$11(fe).forEach((fe=>ve.add(fe))),function R$$(fe){if(!fe)return[];const ve=fe.geometryFieldsInfo;return ve?I$1h(fe.fieldsIndex,[ve.shapeAreaField,ve.shapeLengthField]):[]}(fe).forEach((fe=>ve.add(fe.toLowerCase())));const _e=fe&&"infoFor3D"in fe?fe.infoFor3D:void 0;return _e&&(Object.values(_e.assetMapFieldRoles).forEach((fe=>ve.add(fe.toLowerCase()))),Object.values(_e.transformFieldRoles).forEach((fe=>ve.add(fe.toLowerCase())))),Array.from(ve)}function z$T(fe){if(!fe)return[];const ve="editFieldsInfo"in fe&&fe.editFieldsInfo;if(!ve)return[];const{creationDateField:_e,creatorField:be,editDateField:we,editorField:Se}=ve;return[_e,be,we,Se].filter(Boolean)}function P$11(fe){return z$T(fe).map((fe=>fe.toLowerCase()))}function q$M(fe,ve){var _e;return fe.editable&&!c$.has(fe.type)&&!P$11(ve).includes((null==(_e=fe.name)?void 0:_e.toLowerCase())??"")}async function J$w(fe,ve){const{labelingInfo:_e,fieldsIndex:be}=ve;(null==_e?void 0:_e.length)&&await Promise.all(_e.map((ve=>async function W$B(fe,ve,_e){if(!_e)return;const be=_e.getLabelExpression(),we=_e.where;if("arcade"===be.type)await h$2h(fe,ve,be.expression);else{const _e=be.expression.match(/{[^}]*}/g);_e&&_e.forEach((_e=>{w$1u(fe,ve,_e.slice(1,-1))}))}await E$1n(fe,ve,we)}(fe,be,ve))))}function H$T(fe){const ve=fe.defaultValue;return void 0!==ve&&re$c(fe,ve)?ve:fe.nullable?null:void 0}function K$u(fe){const ve="string"==typeof fe?{type:fe}:fe;return ye$6(ve)?255:"esriFieldTypeDate"===ve.type||"date"===ve.type?8:void 0}function Q$w(fe){return"number"==typeof fe&&!isNaN(fe)&&isFinite(fe)}function Z$u(fe){return null===fe||Q$w(fe)}function ee$e(fe){return null===fe||Number.isInteger(fe)}function ne$d(fe){return null!=fe&&"string"==typeof fe}function ie$c(fe){return null===fe||ne$d(fe)}function te$d(){return!0}function re$c(fe,ve){let _e;switch(fe.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":_e=fe.nullable?ee$e:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":_e=fe.nullable?Z$u:Q$w;break;case"string":case"esriFieldTypeString":_e=fe.nullable?ie$c:ne$d;break;default:_e=te$d}return 1===arguments.length?_e:_e(ve)}const d$=o$4d(new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]),new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]));function pe$a(fe){return null!=fe&&d$.has(fe.type)}function ye$6(fe){return null!=fe&&("string"===fe.type||"esriFieldTypeString"===fe.type)}function ge$6(fe){return null!=fe&&("date"===fe.type||"esriFieldTypeDate"===fe.type)}function Fe$1(fe){return null!=fe&&("date-only"===fe.type||"esriFieldTypeDateOnly"===fe.type)}function Ie$4(fe){return null!=fe&&("timestamp-offset"===fe.type||"esriFieldTypeTimestampOffset"===fe.type)}function be$3(fe){return null!=fe&&("time-only"===fe.type||"esriFieldTypeTimeOnly"===fe.type)}function we$2(fe){return null!=fe&&("oid"===fe.type||"esriFieldTypeOID"===fe.type)}function xe(fe){return null!=fe&&("global-id"===fe.type||"esriFieldTypeGlobalID"===fe.type)}function Te$2(fe,ve){return null===Ae$1(fe,ve)}var p$,f$;function _e$5(fe){return null==fe||"number"==typeof fe&&isNaN(fe)?null:fe}function Ae$1(fe,ve){return null==fe||fe.nullable&&null===ve?null:pe$a(fe)&&!function Se$4(fe,ve){const _e="string"==typeof fe?ve$2(fe):fe;if(!_e)return!1;const be=_e.min,we=_e.max;return _e.isInteger?Number.isInteger(ve)&&ve>=be&&ve<=we:ve>=be&&ve<=we}(fe.type,Number(ve))?p$.OUT_OF_RANGE:re$c(fe,ve)?fe.domain?function s$3w(fe,ve,_e){const be=null==fe?void 0:fe.domain;if(!be)return null;switch(be.type){case"range":{const{min:_e,max:be}=m$2U(fe);if(null!=_e&&+ve<_e||null!=be&&+ve>be)return e$.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==be.codedValues||be.codedValues.every((fe=>null==fe||fe.code!==ve)))return e$.INVALID_CODED_VALUE}return null}(fe,ve):null:f$.INVALID_TYPE}function ve$2(fe){switch(fe){case"esriFieldTypeSmallInteger":case"small-integer":return m$;case"esriFieldTypeInteger":case"integer":return y$;case"esriFieldTypeBigInteger":case"big-integer":return g$;case"esriFieldTypeSingle":case"single":return v$;case"esriFieldTypeDouble":case"double":return _$}}(p$||(p$={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",(f$||(f$={})).INVALID_TYPE="type-validation-error::invalid-type";const m$={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},y$={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},g$={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},v$={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},_$={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Ue$1(fe,ve,_e){switch(fe){case e$.INVALID_CODED_VALUE:return`Value ${_e} is not in the coded domain - field: ${ve.name}, domain: ${JSON.stringify(ve.domain)}`;case e$.VALUE_OUT_OF_RANGE:return`Value ${_e} is out of the range of valid values - field: ${ve.name}, domain: ${JSON.stringify(ve.domain)}`;case f$.INVALID_TYPE:return`Value ${_e} is not a valid value for the field type - field: ${ve.name}, type: ${ve.type}, nullable: ${ve.nullable}`;case p$.OUT_OF_RANGE:{const{min:fe,max:be}=ve$2(ve.type);return`Value ${_e} is out of range for the number type - field: ${ve.name}, type: ${ve.type}, value range is ${fe} to ${be}`}}}function je(fe,ve){return!Re$1(fe,ve,null)}function Re$1(fe,ve,_e){if(!(null==ve?void 0:ve.attributes)||!fe){if(null!=_e)for(const ve of fe??[])_e.add(ve);return!0}const be=new Set(Object.keys(ve.attributes));let we=!1;for(const Se of fe)if(!be.has(Se)){if(we=!0,null==_e)break;_e.add(Se)}return we}function Ge$2(fe){return!!fe&&["raster.itempixelvalue","raster.servicepixelvalue"].some((ve=>fe.toLowerCase().startsWith(ve)))}function Xe$1(fe){const ve=null==fe?void 0:fe.match(/{[^}]+}/g);return ve?ve.map((fe=>fe.slice(1,-1).split(":")[0].trim())):[]}let $$=class e8 extends Pn{constructor(fe){super(fe),this.type=null}};e$4o([y$2v({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],$$.prototype,"type",void 0),$$=e$4o([a$4y("esri.popup.content.Content")],$$);const b$=$$;var w$;let x$=w$=class extends b${constructor(fe){super(fe),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new w$({description:this.description,displayType:this.displayType,title:this.title})}};e$4o([y$2v({type:String,json:{write:!0}})],x$.prototype,"description",void 0),e$4o([y$2v({type:["auto","preview","list"],json:{write:!0}})],x$.prototype,"displayType",void 0),e$4o([y$2v({type:String,json:{write:!0}})],x$.prototype,"title",void 0),e$4o([y$2v({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],x$.prototype,"type",void 0),x$=w$=e$4o([a$4y("esri.popup.content.AttachmentsContent")],x$);const S$=x$;var T$;let E$=T$=class extends b${constructor(fe){super(fe),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new T$({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?a$4H(this.outFields):null})}};e$4o([y$2v()],E$.prototype,"creator",void 0),e$4o([y$2v()],E$.prototype,"destroyer",void 0),e$4o([y$2v()],E$.prototype,"outFields",void 0),e$4o([y$2v({type:["custom"],readOnly:!0})],E$.prototype,"type",void 0),E$=T$=e$4o([a$4y("esri.popup.content.CustomContent")],E$);const P$=E$;var C$;let O$=C$=class extends Pn{constructor(fe){super(fe),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new C$({title:this.title,expression:this.expression})}};e$4o([y$2v({type:String,json:{write:!0}})],O$.prototype,"title",void 0),e$4o([y$2v({type:String,json:{write:!0}})],O$.prototype,"expression",void 0),e$4o([y$2v({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],O$.prototype,"returnType",void 0),O$=C$=e$4o([a$4y("esri.popup.ElementExpressionInfo")],O$);const A$=O$;var M$;let R$=M$=class extends b${constructor(fe){super(fe),this.expressionInfo=null,this.type="expression"}clone(){var fe;return new M$({expressionInfo:null==(fe=this.expressionInfo)?void 0:fe.clone()})}};e$4o([y$2v({type:A$,json:{write:!0}})],R$.prototype,"expressionInfo",void 0),e$4o([y$2v({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],R$.prototype,"type",void 0),R$=M$=e$4o([a$4y("esri.popup.content.ExpressionContent")],R$);const I$=R$;let L$=class i8 extends(i$4F(Pn)){constructor(fe){super(fe),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};e$4o([o$3g(Uu)],L$.prototype,"dateFormat",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],L$.prototype,"digitSeparator",void 0),e$4o([y$2v({type:Ci,json:{write:!0}})],L$.prototype,"places",void 0),L$=e$4o([a$4y("esri.popup.support.FieldInfoFormat")],L$);const D$=L$;var N$;let F$=N$=class extends Pn{constructor(fe){super(fe),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var fe;return new N$({fieldName:this.fieldName,format:null==(fe=this.format)?void 0:fe.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};e$4o([y$2v({type:String,json:{write:!0}})],F$.prototype,"fieldName",void 0),e$4o([y$2v({type:D$,json:{write:!0}})],F$.prototype,"format",void 0),e$4o([y$2v({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],F$.prototype,"isEditable",void 0),e$4o([y$2v({type:String,json:{write:!0}})],F$.prototype,"label",void 0),e$4o([o$3g(new An({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],F$.prototype,"stringFieldOption",void 0),e$4o([y$2v({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],F$.prototype,"statisticType",void 0),e$4o([y$2v({type:String,json:{write:!0}})],F$.prototype,"tooltip",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],F$.prototype,"visible",void 0),F$=N$=e$4o([a$4y("esri.popup.FieldInfo")],F$);const z$=F$;var k$;let U$=k$=class extends b${constructor(fe){super(fe),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(fe,ve){ve.fieldInfos=fe&&fe.map((fe=>fe.toJSON()))}clone(){return new k$(a$4H({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};e$4o([y$2v({type:Object,json:{write:!0}})],U$.prototype,"attributes",void 0),e$4o([y$2v({type:String,json:{write:!0}})],U$.prototype,"description",void 0),e$4o([y$2v({type:[z$]})],U$.prototype,"fieldInfos",void 0),e$4o([r$3s("fieldInfos")],U$.prototype,"writeFieldInfos",null),e$4o([y$2v({type:String,json:{write:!0}})],U$.prototype,"title",void 0),e$4o([y$2v({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],U$.prototype,"type",void 0),U$=k$=e$4o([a$4y("esri.popup.content.FieldsContent")],U$);const V$=U$;let B$=class s15 extends Pn{constructor(fe){super(fe),this.altText=null,this.caption="",this.title="",this.type=null}};e$4o([y$2v({type:String,json:{write:!0}})],B$.prototype,"altText",void 0),e$4o([y$2v({type:String,json:{write:!0}})],B$.prototype,"caption",void 0),e$4o([y$2v({type:String,json:{write:!0}})],B$.prototype,"title",void 0),e$4o([y$2v({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],B$.prototype,"type",void 0),B$=e$4o([a$4y("esri.popup.content.mixins.MediaInfo")],B$);const j$=B$;var G$;let H$=G$=class extends zi{constructor(fe){super(fe),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var fe;return new G$({color:null==(fe=this.color)?void 0:fe.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};e$4o([y$2v()],H$.prototype,"color",void 0),e$4o([y$2v()],H$.prototype,"fieldName",void 0),e$4o([y$2v()],H$.prototype,"tooltip",void 0),e$4o([y$2v()],H$.prototype,"value",void 0),H$=G$=e$4o([a$4y("esri.popup.content.support.ChartMediaInfoValueSeries")],H$);const q$=H$;var W$;let Y$=W$=class extends Pn{constructor(fe){super(fe),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new W$({colors:a$4H(this.colors),fields:a$4H(this.fields),normalizeField:this.normalizeField,series:a$4H(this.series),tooltipField:this.tooltipField})}};e$4o([y$2v({type:[b_],json:{type:[[Ci]],write:!0}})],Y$.prototype,"colors",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],Y$.prototype,"fields",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Y$.prototype,"normalizeField",void 0),e$4o([y$2v({type:[q$],json:{read:!1}})],Y$.prototype,"series",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Y$.prototype,"tooltipField",void 0),Y$=W$=e$4o([a$4y("esri.popup.content.support.ChartMediaInfoValue")],Y$);const Z$=Y$;let X$=class p6 extends j${constructor(fe){super(fe),this.type=null,this.value=void 0}};e$4o([y$2v({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],X$.prototype,"type",void 0),e$4o([y$2v({type:Z$,json:{write:!0}})],X$.prototype,"value",void 0),X$=e$4o([a$4y("esri.popup.content.mixins.ChartMediaInfo")],X$);const J$=X$,Q$=i$4y()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var K$;let eb=K$=class extends J${constructor(fe){super(fe),this.type="bar-chart"}clone(){var fe;return new K$({altText:this.altText,title:this.title,caption:this.caption,value:null==(fe=this.value)?void 0:fe.clone()})}};e$4o([y$2v({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:Q$.write}})],eb.prototype,"type",void 0),eb=K$=e$4o([a$4y("esri.popup.content.BarChartMediaInfo")],eb);const tb=eb;var rb;let ib=rb=class extends J${constructor(fe){super(fe),this.type="column-chart"}clone(){var fe;return new rb({altText:this.altText,title:this.title,caption:this.caption,value:null==(fe=this.value)?void 0:fe.clone()})}};e$4o([y$2v({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:Q$.write}})],ib.prototype,"type",void 0),ib=rb=e$4o([a$4y("esri.popup.content.ColumnChartMediaInfo")],ib);const nb=ib;var sb;let ob=sb=class extends Pn{constructor(fe){super(fe),this.linkURL=null,this.sourceURL=null}clone(){return new sb({linkURL:this.linkURL,sourceURL:this.sourceURL})}};e$4o([y$2v({type:String,json:{write:!0}})],ob.prototype,"linkURL",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ob.prototype,"sourceURL",void 0),ob=sb=e$4o([a$4y("esri.popup.content.support.ImageMediaInfoValue")],ob);const ab=ob;var lb;let cb=lb=class extends j${constructor(fe){super(fe),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var fe;return new lb({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:null==(fe=this.value)?void 0:fe.clone()})}};e$4o([y$2v({type:Number,json:{write:!0}})],cb.prototype,"refreshInterval",void 0),e$4o([y$2v({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],cb.prototype,"type",void 0),e$4o([y$2v({type:ab,json:{write:!0}})],cb.prototype,"value",void 0),cb=lb=e$4o([a$4y("esri.popup.content.ImageMediaInfo")],cb);const ub=cb;var hb;let db=hb=class extends J${constructor(fe){super(fe),this.type="line-chart"}clone(){var fe;return new hb({altText:this.altText,title:this.title,caption:this.caption,value:null==(fe=this.value)?void 0:fe.clone()})}};e$4o([y$2v({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:Q$.write}})],db.prototype,"type",void 0),db=hb=e$4o([a$4y("esri.popup.content.LineChartMediaInfo")],db);const pb=db;var fb;let mb=fb=class extends J${constructor(fe){super(fe),this.type="pie-chart"}clone(){var fe;return new fb({altText:this.altText,title:this.title,caption:this.caption,value:null==(fe=this.value)?void 0:fe.clone()})}};e$4o([y$2v({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:Q$.write}})],mb.prototype,"type",void 0),mb=fb=e$4o([a$4y("esri.popup.content.PieChartMediaInfo")],mb);const yb=mb,gb={base:j$,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":tb,"column-chart":nb,"line-chart":pb,"pie-chart":yb,image:ub}};var vb;let _b=vb=class extends b${constructor(fe){super(fe),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(fe){return fe&&fe.map((fe=>"image"===fe.type?ub.fromJSON(fe):"barchart"===fe.type?tb.fromJSON(fe):"columnchart"===fe.type?nb.fromJSON(fe):"linechart"===fe.type?pb.fromJSON(fe):"piechart"===fe.type?yb.fromJSON(fe):void 0)).filter(Boolean)}writeMediaInfos(fe,ve){ve.mediaInfos=fe&&fe.map((fe=>fe.toJSON()))}clone(){return new vb(a$4H({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};e$4o([y$2v()],_b.prototype,"activeMediaInfoIndex",void 0),e$4o([y$2v({type:Object,json:{write:!0}})],_b.prototype,"attributes",void 0),e$4o([y$2v({type:String,json:{write:!0}})],_b.prototype,"description",void 0),e$4o([y$2v({types:[gb]})],_b.prototype,"mediaInfos",void 0),e$4o([o$40("mediaInfos")],_b.prototype,"readMediaInfos",null),e$4o([r$3s("mediaInfos")],_b.prototype,"writeMediaInfos",null),e$4o([y$2v({type:String,json:{write:!0}})],_b.prototype,"title",void 0),e$4o([y$2v({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],_b.prototype,"type",void 0),_b=vb=e$4o([a$4y("esri.popup.content.MediaContent")],_b);const $b=_b;var bb;let wb=bb=class extends Pn{constructor(fe){super(fe),this.field=null,this.order=null}clone(){return new bb({field:this.field,order:this.order})}};e$4o([y$2v({type:String,json:{write:!0}})],wb.prototype,"field",void 0),e$4o([y$2v({type:["asc","desc"],json:{write:!0}})],wb.prototype,"order",void 0),wb=bb=e$4o([a$4y("esri.popup.support.RelatedRecordsInfoFieldOrder")],wb);const xb=wb;let Sb=class n7 extends(i$4F(b$)){constructor(fe){super(fe),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};e$4o([y$2v({type:String,json:{write:!0}})],Sb.prototype,"description",void 0),e$4o([y$2v({type:Number,json:{type:Ci,write:!0}})],Sb.prototype,"displayCount",void 0),e$4o([y$2v({type:["list"],json:{write:!0}})],Sb.prototype,"displayType",void 0),e$4o([y$2v({type:[xb],json:{write:!0}})],Sb.prototype,"orderByFields",void 0),e$4o([y$2v({type:Number,json:{type:Ci,write:!0}})],Sb.prototype,"relationshipId",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Sb.prototype,"title",void 0),e$4o([y$2v({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Sb.prototype,"type",void 0),Sb=e$4o([a$4y("esri.popup.content.RelationshipContent")],Sb);const Tb=Sb;var Eb;let Pb=Eb=class extends b${constructor(fe){super(fe),this.text=null,this.type="text"}clone(){return new Eb({text:this.text})}};e$4o([y$2v({type:String,json:{write:!0}})],Pb.prototype,"text",void 0),e$4o([y$2v({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],Pb.prototype,"type",void 0),Pb=Eb=e$4o([a$4y("esri.popup.content.TextContent")],Pb);const Cb=Pb,Ob={base:null,key:"type",typeMap:{attachment:S$,media:$b,text:Cb,expression:I$,field:V$,relationship:Tb}};var Ab;let Mb=Ab=class extends Pn{constructor(fe){super(fe),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Ab({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e$4o([y$2v({type:String,json:{write:!0}})],Mb.prototype,"name",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Mb.prototype,"title",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Mb.prototype,"expression",void 0),e$4o([y$2v({type:["string","number"],json:{write:!0}})],Mb.prototype,"returnType",void 0),Mb=Ab=e$4o([a$4y("esri.popup.ExpressionInfo")],Mb);const Rb=Mb;var Ib;let Lb=Ib=class extends Pn{constructor(fe){super(fe),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Ib({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],Lb.prototype,"returnTopmostRaster",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],Lb.prototype,"showNoDataRecords",void 0),Lb=Ib=e$4o([a$4y("esri.popup.LayerOptions")],Lb);const Db=Lb;var Nb;let Fb=Nb=class extends Pn{constructor(fe){super(fe),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Nb({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?a$4H(this.orderByFields):null})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],Fb.prototype,"showRelatedRecords",void 0),e$4o([y$2v({type:[xb],json:{write:!0}})],Fb.prototype,"orderByFields",void 0),Fb=Nb=e$4o([a$4y("esri.popup.RelatedRecordsInfo")],Fb);const zb=Fb;var kb;let Ub=kb=class extends(s$3x(zi)){constructor(fe){super(fe),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new kb({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};e$4o([y$2v()],Ub.prototype,"active",void 0),e$4o([y$2v()],Ub.prototype,"className",void 0),e$4o([y$2v()],Ub.prototype,"disabled",void 0),e$4o([y$2v()],Ub.prototype,"icon",void 0),e$4o([y$2v()],Ub.prototype,"id",void 0),e$4o([y$2v()],Ub.prototype,"indicator",void 0),e$4o([y$2v()],Ub.prototype,"title",void 0),e$4o([y$2v()],Ub.prototype,"type",void 0),e$4o([y$2v()],Ub.prototype,"visible",void 0),Ub=kb=e$4o([a$4y("esri.support.actions.ActionBase")],Ub);const Vb=Ub;var Bb;let jb=Bb=class extends Vb{constructor(fe){super(fe),this.image=null,this.type="button"}clone(){return new Bb({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};e$4o([y$2v()],jb.prototype,"image",void 0),jb=Bb=e$4o([a$4y("esri.support.actions.ActionButton")],jb);const Gb=jb;var Hb;let qb=Hb=class extends Vb{constructor(fe){super(fe),this.image=null,this.type="toggle",this.value=!1}clone(){return new Hb({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};e$4o([y$2v()],qb.prototype,"image",void 0),e$4o([y$2v()],qb.prototype,"value",void 0),qb=Hb=e$4o([a$4y("esri.support.actions.ActionToggle")],qb);const Wb=qb,Yb="relationships/",Zb="expression/",Xb=Wa.ofType({key:"type",defaultKeyValue:"button",base:Vb,typeMap:{button:Gb,toggle:Wb}}),Jb={base:b$,key:"type",typeMap:{media:$b,custom:P$,text:Cb,attachments:S$,fields:V$,expression:I$,relationship:Tb}},Qb=new Set(["attachments","fields","media","text","expression","relationship"]);let Kb=class P extends(i$4F(Pn)){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(fe){return Array.isArray(fe)?fe.map((fe=>T$1p(Jb,fe))):"string"==typeof fe||"function"==typeof fe||fe instanceof HTMLElement||S$1T(fe)?fe:(ar.getLogger(this).error("content error","unsupported content value",{value:fe}),null)}readContent(fe,ve){const{popupElements:_e}=ve;return Array.isArray(_e)&&_e.length>0?this._readPopupInfoElements(ve.description,ve.mediaInfos,_e):this._readPopupInfo(ve)}writeContent(fe,ve,_e,be){"string"!=typeof fe?Array.isArray(fe)&&(ve.popupElements=fe.filter((fe=>Qb.has(fe.type))).map((fe=>null==fe?void 0:fe.toJSON(be))),ve.popupElements.forEach((fe=>{"attachments"===fe.type?this._writeAttachmentContent(ve):"media"===fe.type?this._writeMediaContent(fe,ve):"text"===fe.type?this._writeTextContent(fe,ve):"relationship"===fe.type&&this._writeRelationshipContent(fe,ve)}))):ve.description=fe}writeFieldInfos(fe,ve,_e,be){const{content:we}=this,Se=Array.isArray(we)?we:null;if(fe){const _e=Se?Se.filter((fe=>"fields"===fe.type)):[],we=_e.length&&_e.every((fe=>{var ve;return null==(ve=fe.fieldInfos)?void 0:ve.length}));ve.fieldInfos=fe.filter(Boolean).map((fe=>{const ve=fe.toJSON(be);return we&&(ve.visible=!1),ve}))}if(Se)for(const Te of Se)"fields"===Te.type&&this._writeFieldsContent(Te,ve)}writeLayerOptions(fe,ve,_e,be){ve[_e]=!fe||null===fe.showNoDataRecords&&null===fe.returnTopmostRaster?null:fe.toJSON(be)}writeTitle(fe,ve){ve.title=fe||""}async collectRequiredFields(fe,ve){const _e=this.expressionInfos||[];await this._collectExpressionInfoFields(fe,ve,[..._e,...this._getContentExpressionInfos(this.content,_e)]),b$1H(fe,ve,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(fe){const ve=new Set;return await this.collectRequiredFields(ve,fe),[...ve].sort()}_writeFieldsContent(fe,ve){if(!Array.isArray(fe.fieldInfos)||!fe.fieldInfos.length)return;const _e=a$4H(fe.fieldInfos);Array.isArray(ve.fieldInfos)?_e.forEach((fe=>{const _e=ve.fieldInfos.find((ve=>{var _e,be;return(null==(_e=ve.fieldName)?void 0:_e.toLowerCase())===(null==(be=fe.fieldName)?void 0:be.toLowerCase())}));_e?_e.visible=!0:ve.fieldInfos.push(fe)})):ve.fieldInfos=_e}_writeAttachmentContent(fe){fe.showAttachments||(fe.showAttachments=!0)}_writeRelationshipContent(fe,ve){var _e,be;const we=(null==(_e=fe.orderByFields)?void 0:_e.map((ve=>this._toFieldOrderJSON(ve,fe.relationshipId))))||[],Se=[...(null==(be=ve.relatedRecordsInfo)?void 0:be.orderByFields)||[],...we];ve.relatedRecordsInfo={showRelatedRecords:!0,...(null==Se?void 0:Se.length)&&{orderByFields:Se}}}_writeTextContent(fe,ve){!ve.description&&fe.text&&(ve.description=fe.text)}_writeMediaContent(fe,ve){if(!Array.isArray(fe.mediaInfos)||!fe.mediaInfos.length)return;const _e=a$4H(fe.mediaInfos);Array.isArray(ve.mediaInfos)?ve.mediaInfos=[...ve.mediaInfos,..._e]:ve.mediaInfos=_e}_readPopupInfoElements(fe,ve,_e){const be={description:!1,mediaInfos:!1};return _e.map((_e=>"media"===_e.type?(_e.mediaInfos||!ve||be.mediaInfos||(_e.mediaInfos=ve,be.mediaInfos=!0),$b.fromJSON(_e)):"text"===_e.type?(_e.text||!fe||be.description||(_e.text=fe,be.description=!0),Cb.fromJSON(_e)):"attachments"===_e.type?S$.fromJSON(_e):"fields"===_e.type?V$.fromJSON(_e):"expression"===_e.type?I$.fromJSON(_e):"relationship"===_e.type?Tb.fromJSON(_e):void 0)).filter(Boolean)}_toRelationshipContent(fe){const{field:ve,order:_e}=fe;if(!(null==ve?void 0:ve.startsWith(Yb)))return null;const be=ve.replace(Yb,"").split("/");if(2!==be.length)return null;const we=parseInt(be[0],10),Se=be[1];return"number"==typeof we&&Se?Tb.fromJSON({relationshipId:we,orderByFields:[{field:Se,order:_e}]}):null}_toFieldOrderJSON(fe,ve){const{order:_e,field:be}=fe;return{field:`${Yb}${ve}/${be}`,order:_e}}_readPopupInfo({description:fe,mediaInfos:ve,showAttachments:_e,relatedRecordsInfo:be={showRelatedRecords:!1}}){const we=[];fe?we.push(new Cb({text:fe})):we.push(new V$),Array.isArray(ve)&&ve.length&&we.push($b.fromJSON({mediaInfos:ve})),_e&&we.push(S$.fromJSON({displayType:"auto"}));const{showRelatedRecords:Se,orderByFields:Te}=be;return Se&&(null==Te?void 0:Te.length)&&Te.forEach((fe=>{const ve=this._toRelationshipContent(fe);ve&&we.push(ve)})),we.length?we:fe}_getContentElementFields(fe){const ve=null==fe?void 0:fe.type;if("attachments"===ve)return[...this._extractFieldNames(fe.title),...this._extractFieldNames(fe.description)];if("custom"===ve)return fe.outFields||[];if("fields"===ve)return[...this._extractFieldNames(fe.title),...this._extractFieldNames(fe.description),...this._getFieldInfoFields(fe.fieldInfos??this.fieldInfos)];if("media"===ve){const ve=fe.mediaInfos||[];return[...this._extractFieldNames(fe.title),...this._extractFieldNames(fe.description),...ve.reduce(((fe,ve)=>[...fe,...this._getMediaInfoFields(ve)]),[])]}return"text"===ve?this._extractFieldNames(fe.text):[]}_getMediaInfoFields(fe){const{caption:ve,title:_e,value:be}=fe,we=be||{},{fields:Se,normalizeField:Te,tooltipField:Ee,sourceURL:Ce,linkURL:Oe}=we,Re=[...this._extractFieldNames(_e),...this._extractFieldNames(ve),...this._extractFieldNames(Ce),...this._extractFieldNames(Oe),...Se??[]];return Te&&Re.push(Te),Ee&&Re.push(Ee),Re}_getContentExpressionInfos(fe,ve){return Array.isArray(fe)?fe.reduce(((fe,ve)=>[...fe,..."expression"===ve.type&&ve.expressionInfo?[ve.expressionInfo]:[]]),ve):[]}_getContentFields(fe){return"string"==typeof fe?this._extractFieldNames(fe):Array.isArray(fe)?fe.reduce(((fe,ve)=>[...fe,...this._getContentElementFields(ve)]),[]):[]}async _collectExpressionInfoFields(fe,ve,_e){_e&&await Promise.all(_e.map((_e=>h$2h(fe,ve,_e.expression))))}_getFieldInfoFields(fe){return fe?fe.filter((({fieldName:fe,visible:ve})=>!(void 0!==ve&&!ve||!fe||fe.startsWith(Yb)||fe.startsWith(Zb)))).map((fe=>fe.fieldName)):[]}_getActionsFields(fe){return fe?fe.toArray().reduce(((fe,ve)=>[...fe,...this._getActionFields(ve)]),[]):[]}_getActionFields(fe){const{className:ve,title:_e,type:be}=fe,we="button"===be||"toggle"===be?fe.image:"";return[...this._extractFieldNames(_e),...this._extractFieldNames(ve),...this._extractFieldNames(we)]}_getTitleFields(fe){return"string"==typeof fe?this._extractFieldNames(fe):[]}_extractFieldNames(fe){return Xe$1(fe).filter((fe=>!(0===fe.indexOf(Yb)||0===fe.indexOf(Zb))))}};e$4o([y$2v({type:Xb})],Kb.prototype,"actions",void 0),e$4o([y$2v()],Kb.prototype,"content",void 0),e$4o([s$4b("content")],Kb.prototype,"castContent",null),e$4o([o$40("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Kb.prototype,"readContent",null),e$4o([r$3s("content",{popupElements:{type:Wa.ofType(Ob)},showAttachments:{type:Boolean},mediaInfos:{type:Wa.ofType(gb)},description:{type:String},relatedRecordsInfo:{type:zb}})],Kb.prototype,"writeContent",null),e$4o([y$2v({type:[Rb],json:{write:!0}})],Kb.prototype,"expressionInfos",void 0),e$4o([y$2v({type:[z$]})],Kb.prototype,"fieldInfos",void 0),e$4o([r$3s("fieldInfos")],Kb.prototype,"writeFieldInfos",null),e$4o([y$2v({type:Db})],Kb.prototype,"layerOptions",void 0),e$4o([r$3s("layerOptions")],Kb.prototype,"writeLayerOptions",null),e$4o([y$2v({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Kb.prototype,"lastEditInfoEnabled",void 0),e$4o([y$2v()],Kb.prototype,"outFields",void 0),e$4o([y$2v()],Kb.prototype,"overwriteActions",void 0),e$4o([y$2v()],Kb.prototype,"returnGeometry",void 0),e$4o([y$2v({json:{type:String}})],Kb.prototype,"title",void 0),e$4o([r$3s("title")],Kb.prototype,"writeTitle",null),Kb=e$4o([a$4y("esri.PopupTemplate")],Kb);const ew=Kb,tw=new An({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let rw=0,iw=class c8 extends Pn{constructor(fe){super(fe),this.id="sym"+rw++,this.type=null,this.color=new b_([0,0,0,1])}readColor(fe){return null!=(null==fe?void 0:fe[0])?[fe[0],fe[1],fe[2],fe[3]/255]:fe}async collectRequiredFields(fe,ve){}hash(){return JSON.stringify(this.toJSON())}clone(){}};e$4o([y$2v({type:tw.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:tw.write}}})],iw.prototype,"type",void 0),e$4o([y$2v({type:b_,json:{write:{allowNull:!0}}})],iw.prototype,"color",void 0),e$4o([o$40("color")],iw.prototype,"readColor",null),iw=e$4o([a$4y("esri.symbols.Symbol")],iw);const nw=iw;var sw;let ow=sw=class extends nw{constructor(fe){super(fe),this.data=null,this.type="cim"}readData(fe,ve){return ve}writeData(fe,ve){Object.assign(ve,fe)}async collectRequiredFields(fe,ve){var _e;if("CIMSymbolReference"===(null==(_e=this.data)?void 0:_e.type)){const _e=this.data.primitiveOverrides;if(_e){const be=_e.map((_e=>{const be=_e.valueExpressionInfo;return be?h$2h(fe,ve,be.expression):null}));await Promise.all(be)}}}clone(){return new sw({data:a$4H(this.data)})}hash(){return l$4F(JSON.stringify(this.data)).toString()}};e$4o([y$2v({json:{write:!1}})],ow.prototype,"color",void 0),e$4o([y$2v({json:{write:!0}})],ow.prototype,"data",void 0),e$4o([o$40("data",["symbol"])],ow.prototype,"readData",null),e$4o([r$3s("data",{})],ow.prototype,"writeData",null),e$4o([o$3g({CIMSymbolReference:"cim"},{readOnly:!0})],ow.prototype,"type",void 0),ow=sw=e$4o([a$4y("esri.symbols.CIMSymbol")],ow);const aw=ow;let lw=class p7 extends Pn{constructor(fe){super(fe),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(fe,ve,_e){fe||(ve[_e]=fe)}};e$4o([y$2v({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],lw.prototype,"enabled",void 0),e$4o([r$3s("enabled")],lw.prototype,"writeEnabled",null),e$4o([y$2v({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],lw.prototype,"type",void 0),lw=e$4o([a$4y("esri.symbols.Symbol3DLayer")],lw);const cw=lw;const uw={type:b_,json:{type:[Ci],default:null,read:{source:["color","transparency"],reader:function s$3o(fe,ve){const _e=null!=ve.transparency?r$2U(ve.transparency):1,be=ve.color;return be&&Array.isArray(be)?new b_([be[0]||0,be[1]||0,be[2]||0,_e]):null}},write:{target:{color:{type:[Ci]},transparency:{type:Ci}},writer:function c$3G(fe,ve){ve.color=fe.toJSON().slice(0,3);const _e=n$3O(fe.a);0!==_e&&(ve.transparency=_e)}}}},hw={type:Number,cast:o$3L,json:{write:!0}};let dw=class l4 extends Pn{constructor(fe){super(fe),this.color=new b_([0,0,0,1]),this.extensionLength=0,this.size=e$3N(1)}clone(){}cloneProperties(){return{color:a$4H(this.color),size:this.size,extensionLength:this.extensionLength}}};e$4o([y$2v({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],dw.prototype,"type",void 0),e$4o([y$2v(uw)],dw.prototype,"color",void 0),e$4o([y$2v({...hw,json:{write:{overridePolicy:fe=>({enabled:!!fe})}}})],dw.prototype,"extensionLength",void 0),e$4o([y$2v(hw)],dw.prototype,"size",void 0),dw=e$4o([a$4y("esri.symbols.edges.Edges3D")],dw);const pw=dw;var fw;let mw=fw=class extends pw{constructor(fe){super(fe),this.type="sketch"}clone(){return new fw(this.cloneProperties())}};e$4o([o$3g({sketch:"sketch"},{readOnly:!0})],mw.prototype,"type",void 0),mw=fw=e$4o([a$4y("esri.symbols.edges.SketchEdges3D")],mw);const yw=mw;var gw;let vw=gw=class extends pw{constructor(fe){super(fe),this.type="solid"}clone(){return new gw(this.cloneProperties())}};e$4o([o$3g({solid:"solid"},{readOnly:!0})],vw.prototype,"type",void 0),vw=gw=e$4o([a$4y("esri.symbols.edges.SolidEdges3D")],vw);const _w=vw,$w={types:{key:"type",base:pw,typeMap:{solid:_w,sketch:yw}},json:{write:!0}};var bw;let ww=bw=class extends Pn{constructor(fe){super(fe),this.color=null}clone(){const fe={color:null!=this.color?this.color.clone():null};return new bw(fe)}};var xw;e$4o([y$2v(uw)],ww.prototype,"color",void 0),ww=bw=e$4o([a$4y("esri.symbols.support.Symbol3DMaterial")],ww);let Sw=xw=class extends cw{constructor(fe){super(fe),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var fe,ve;return new xw({edges:null==(fe=this.edges)?void 0:fe.clone(),enabled:this.enabled,material:null==(ve=this.material)?void 0:ve.clone(),castShadows:this.castShadows,size:this.size})}};e$4o([o$3g({Extrude:"extrude"},{readOnly:!0})],Sw.prototype,"type",void 0),e$4o([y$2v({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Sw.prototype,"size",void 0),e$4o([y$2v({type:ww,json:{write:!0}})],Sw.prototype,"material",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Sw.prototype,"castShadows",void 0),e$4o([y$2v($w)],Sw.prototype,"edges",void 0),Sw=xw=e$4o([a$4y("esri.symbols.ExtrudeSymbol3DLayer")],Sw);const Tw=Sw;let Ew=class p8 extends nw{constructor(fe){super(fe),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};e$4o([o$3g({esriSLS:"simple-line"},{readOnly:!0})],Ew.prototype,"type",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],Ew.prototype,"width",void 0),Ew=e$4o([a$4y("esri.symbols.LineSymbol")],Ew);const Pw=Ew,Cw=["arrow","circle","square","diamond","cross","x"];var Ow;let Aw=Ow=class extends Pn{constructor(fe){super(fe),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(fe,ve,_e,be){ve[_e]="web-map"===(null==be?void 0:be.origin)?"arrow":fe}set color(fe){this._set("color",fe)}readColor(fe){return null!=(null==fe?void 0:fe[0])?[fe[0],fe[1],fe[2],fe[3]/255]:fe}writeColor(fe,ve,_e,be){"web-map"===(null==be?void 0:be.origin)||(ve[_e]=fe)}clone(){return new Ow({color:a$4H(this.color),placement:this.placement,style:this.style})}hash(){var fe;return`${this.placement}.${null==(fe=this.color)?void 0:fe.hash()}.${this.style}`}};e$4o([y$2v({type:["begin","end","begin-end"],json:{write:!0}})],Aw.prototype,"placement",void 0),e$4o([o$3g({"line-marker":"line-marker"},{readOnly:!0}),y$2v({json:{origins:{"web-map":{write:!1}}}})],Aw.prototype,"type",void 0),e$4o([y$2v({type:Cw})],Aw.prototype,"style",void 0),e$4o([r$3s("style")],Aw.prototype,"writeStyle",null),e$4o([y$2v({type:b_,value:null,json:{write:{allowNull:!0}}})],Aw.prototype,"color",null),e$4o([o$40("color")],Aw.prototype,"readColor",null),e$4o([r$3s("color")],Aw.prototype,"writeColor",null),Aw=Ow=e$4o([a$4y("esri.symbols.LineSymbolMarker")],Aw);const Mw=Aw;var Rw;const Iw=new An({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Lw=Rw=class extends Pw{constructor(...fe){super(...fe),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(fe,ve,_e,be,we,Se){if(fe&&"string"!=typeof fe)return fe;const Te={};return null!=fe&&(Te.style=fe),null!=ve&&(Te.color=ve),null!=_e&&(Te.width=o$3L(_e)),null!=be&&(Te.cap=be),null!=we&&(Te.join=we),null!=Se&&(Te.miterLimit=o$3L(Se)),Te}clone(){var fe;return new Rw({color:a$4H(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:null==(fe=this.marker)?void 0:fe.clone()})}hash(){var fe,ve;return`${super.hash()}.${null==(fe=this.color)?void 0:fe.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${null==(ve=this.marker)?void 0:ve.hash()}`}};e$4o([o$3g({esriSLS:"simple-line"},{readOnly:!0})],Lw.prototype,"type",void 0),e$4o([y$2v({type:Iw.apiValues,json:{read:Iw.read,write:Iw.write}})],Lw.prototype,"style",void 0),e$4o([y$2v({type:["butt","round","square"],json:{write:{overridePolicy:(fe,ve,_e)=>({enabled:"round"!==fe&&null==(null==_e?void 0:_e.origin)})}}})],Lw.prototype,"cap",void 0),e$4o([y$2v({type:["miter","round","bevel"],json:{write:{overridePolicy:(fe,ve,_e)=>({enabled:"round"!==fe&&null==(null==_e?void 0:_e.origin)})}}})],Lw.prototype,"join",void 0),e$4o([y$2v({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Mw}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Lw.prototype,"marker",void 0),e$4o([y$2v({type:Number,json:{read:!1,write:!1}})],Lw.prototype,"miterLimit",void 0),Lw=Rw=e$4o([a$4y("esri.symbols.SimpleLineSymbol")],Lw);const Dw=Lw;let Nw=class l5 extends nw{constructor(fe){super(fe),this.outline=null,this.type=null}hash(){var fe;return`${this.type}.${null==(fe=this.outline)?void 0:fe.hash()}`}};e$4o([y$2v({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Dw}},json:{default:null,write:!0}})],Nw.prototype,"outline",void 0),e$4o([y$2v({type:["simple-fill","picture-fill"],readOnly:!0})],Nw.prototype,"type",void 0),Nw=e$4o([a$4y("esri.symbols.FillSymbol")],Nw);const Fw=Nw;let zw=class t13 extends Pn{constructor(fe){super(fe)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};e$4o([y$2v({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],zw.prototype,"type",void 0),zw=e$4o([a$4y("esri.symbols.patterns.LinePattern3D")],zw);const kw=zw;var Uw;const Vw=i$4y()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let Bw=Uw=class extends kw{constructor(fe){super(fe),this.type="style",this.style="solid"}clone(){const fe={style:this.style};return new Uw(fe)}};e$4o([y$2v({type:["style"]})],Bw.prototype,"type",void 0),e$4o([o$3g(Vw),y$2v({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"]})],Bw.prototype,"style",void 0),Bw=Uw=e$4o([a$4y("esri.symbols.patterns.LineStylePattern3D")],Bw);const jw=Bw;let Gw=class t14 extends Pn{constructor(fe){super(fe),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};e$4o([y$2v({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Gw.prototype,"type",void 0),Gw=e$4o([a$4y("esri.symbols.patterns.Pattern3D")],Gw);const Hw=Gw;var qw;let Ww=qw=class extends Hw{constructor(fe){super(fe),this.type="style",this.style="solid"}clone(){return new qw({style:this.style})}};e$4o([y$2v({type:["style"]})],Ww.prototype,"type",void 0),e$4o([y$2v({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],Ww.prototype,"style",void 0),Ww=qw=e$4o([a$4y("esri.symbols.patterns.StylePattern3D")],Ww);const Yw=Ww,Zw={types:{key:"type",base:Hw,typeMap:{style:Yw}},json:{write:!0}},Xw={types:{key:"type",base:kw,typeMap:{style:jw}},json:{write:!0}},Jw=new b_("white");new b_("black");const Qw=new b_([255,255,255,0]);var Kw;let ex=Kw=class extends ww{constructor(fe){super(fe),this.colorMixMode=null}clone(){const fe={color:null!=this.color?this.color.clone():null,colorMixMode:this.colorMixMode};return new Kw(fe)}};function i$3t(fe=ix){return[fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]]}function a$3w(fe,ve,_e,be,we,Se,Te=i$3t()){return Te[0]=fe,Te[1]=ve,Te[2]=_e,Te[3]=be,Te[4]=we,Te[5]=Se,Te}function e$3c(fe,ve){const _e=isFinite(fe[2])||isFinite(fe[5]);return new aa(_e?{xmin:fe[0],xmax:fe[3],ymin:fe[1],ymax:fe[4],zmin:fe[2],zmax:fe[5],spatialReference:ve}:{xmin:fe[0],xmax:fe[3],ymin:fe[1],ymax:fe[4],spatialReference:ve})}function o$35(fe,ve){fe[0]=Math.min(fe[0],ve[0]),fe[1]=Math.min(fe[1],ve[1]),fe[2]=Math.min(fe[2],ve[2]),fe[3]=Math.max(fe[3],ve[3]),fe[4]=Math.max(fe[4],ve[4]),fe[5]=Math.max(fe[5],ve[5])}function f$2p(fe,ve){fe[0]=Math.min(fe[0],ve[0]),fe[1]=Math.min(fe[1],ve[1]),fe[3]=Math.max(fe[3],ve[2]),fe[4]=Math.max(fe[4],ve[3])}function h$2e(fe,ve){fe[0]=Math.min(fe[0],ve[0]),fe[1]=Math.min(fe[1],ve[1]),fe[2]=Math.min(fe[2],ve[2]),fe[3]=Math.max(fe[3],ve[0]),fe[4]=Math.max(fe[4],ve[1]),fe[5]=Math.max(fe[5],ve[2])}function c$3A(fe,ve,_e=0,be=ve.length/3){let we=fe[0],Se=fe[1],Te=fe[2],Ee=fe[3],Ce=fe[4],Oe=fe[5];for(let Re=0;Re<be;Re++)we=Math.min(we,ve[_e+3*Re]),Se=Math.min(Se,ve[_e+3*Re+1]),Te=Math.min(Te,ve[_e+3*Re+2]),Ee=Math.max(Ee,ve[_e+3*Re]),Ce=Math.max(Ce,ve[_e+3*Re+1]),Oe=Math.max(Oe,ve[_e+3*Re+2]);fe[0]=we,fe[1]=Se,fe[2]=Te,fe[3]=Ee,fe[4]=Ce,fe[5]=Oe}function x$1i(fe,ve,_e){const be=ve.length;let we=fe[0],Se=fe[1],Te=fe[2],Ee=fe[3],Ce=fe[4],Oe=fe[5];if(_e)for(let Re=0;Re<be;Re++){const fe=ve[Re];we=Math.min(we,fe[0]),Se=Math.min(Se,fe[1]),Te=Math.min(Te,fe[2]),Ee=Math.max(Ee,fe[0]),Ce=Math.max(Ce,fe[1]),Oe=Math.max(Oe,fe[2])}else for(let Re=0;Re<be;Re++){const fe=ve[Re];we=Math.min(we,fe[0]),Se=Math.min(Se,fe[1]),Ee=Math.max(Ee,fe[0]),Ce=Math.max(Ce,fe[1])}fe[0]=we,fe[1]=Se,fe[2]=Te,fe[3]=Ee,fe[4]=Ce,fe[5]=Oe}function s$3m(fe){return fe[0]>=fe[3]?0:fe[3]-fe[0]}function I$1f(fe){return fe[1]>=fe[4]?0:fe[4]-fe[1]}function N$W(fe){return fe[2]>=fe[5]?0:fe[5]-fe[2]}function T$12(fe){const ve=s$3m(fe),_e=N$W(fe),be=I$1f(fe);return Math.sqrt(ve*ve+_e*_e+be*be)}function E$1m(fe,ve=[0,0,0]){return ve[0]=fe[0]+s$3m(fe)/2,ve[1]=fe[1]+I$1f(fe)/2,ve[2]=fe[2]+N$W(fe)/2,ve}function F$V(fe,ve=[0,0,0]){return ve[0]=s$3m(fe),ve[1]=I$1f(fe),ve[2]=N$W(fe),ve}function y$1M(fe,ve){return ve[0]>=fe[0]&&ve[1]>=fe[1]&&ve[2]>=fe[2]&&ve[0]<=fe[3]&&ve[1]<=fe[4]&&ve[2]<=fe[5]}function b$1F(fe,ve){return ve[0]>=fe[0]&&ve[1]>=fe[1]&&ve[2]>=fe[2]&&ve[3]<=fe[3]&&ve[4]<=fe[4]&&ve[5]<=fe[5]}function z$S(fe,ve){return Math.max(ve[0],fe[0])<=Math.min(ve[3],fe[3])&&Math.max(ve[1],fe[1])<=Math.min(ve[4],fe[4])&&Math.max(ve[2],fe[2])<=Math.min(ve[5],fe[5])}function V$W(fe,ve){return null==ve||z$S(fe,ve)}function Y$s(fe,ve,_e,be,we=fe){return we[0]=fe[0]+ve,we[1]=fe[1]+_e,we[2]=fe[2]+be,we[3]=fe[3]+ve,we[4]=fe[4]+_e,we[5]=fe[5]+be,we}function _$16(fe,ve,_e=fe){const be=fe[0]+s$3m(fe)/2,we=fe[1]+I$1f(fe)/2,Se=fe[2]+N$W(fe)/2;return _e[0]=be+(fe[0]-be)*ve,_e[1]=we+(fe[1]-we)*ve,_e[2]=Se+(fe[2]-Se)*ve,_e[3]=be+(fe[3]-be)*ve,_e[4]=we+(fe[4]-we)*ve,_e[5]=Se+(fe[5]-Se)*ve,_e}function R$_(fe,ve){return ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[2],ve}function A$1h(fe,ve,_e=fe){return _e[0]=ve[0],_e[1]=ve[1],_e[2]=ve[2],_e!==fe&&(_e[3]=fe[3],_e[4]=fe[4],_e[5]=fe[5]),_e}function G$F(fe,ve,_e=fe){return _e[3]=ve[0],_e[4]=ve[1],_e[5]=ve[2],_e!==fe&&(_e[0]=fe[0],_e[1]=fe[1],_e[2]=fe[2]),fe}function O$16(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe[4]=ve[4],fe[5]=ve[5],fe}function P$$(fe){return fe?O$16(fe,rx):i$3t(rx)}function S$1r(fe,ve){return ve||(ve=u$3J()),ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[3],ve[3]=fe[4],ve}function Z$t(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=Number.NEGATIVE_INFINITY,fe[3]=ve[2],fe[4]=ve[3],fe[5]=Number.POSITIVE_INFINITY,fe}function d$2A(fe,ve,_e,be,we){return fe[0]=ve,fe[1]=_e,fe[2]=Number.NEGATIVE_INFINITY,fe[3]=be,fe[4]=we,fe[5]=Number.POSITIVE_INFINITY,fe}function q$L(fe){return 6===fe.length}function w$1t(fe){return 0===s$3m(fe)&&0===I$1f(fe)&&0===N$W(fe)}function B$N(fe,ve,_e){if(null==fe||null==ve)return fe===ve;if(!q$L(fe)||!q$L(ve))return!1;if(_e){for(let be=0;be<fe.length;be++)if(!_e(fe[be],ve[be]))return!1}else for(let be=0;be<fe.length;be++)if(fe[be]!==ve[be])return!1;return!0}e$4o([o$3g({multiply:"multiply",replace:"replace",tint:"tint"})],ex.prototype,"colorMixMode",void 0),ex=Kw=e$4o([a$4y("esri.symbols.support.Symbol3DFillMaterial")],ex);const tx=[-1/0,-1/0,-1/0,1/0,1/0,1/0],rx=[1/0,1/0,1/0,-1/0,-1/0,-1/0],ix=[0,0,0,0,0,0],nx=i$3t();function t$3f(fe,{isPrimitive:ve,width:_e,depth:be,height:we}){const Se=ve?10:1;if(null==_e&&null==we&&null==be)return[Se*fe[0],Se*fe[1],Se*fe[2]];const Te=r$3y(_e,be,we);let Ee;for(let Ce=0;Ce<3;Ce++){const ve=Te[Ce];if(null!=ve){Ee=ve/fe[Ce];break}}for(let Ce=0;Ce<3;Ce++)null==Te[Ce]&&(Te[Ce]=fe[Ce]*Ee);return Te}const sx=a$3w(-.5,-.5,-.5,.5,.5,.5),ox=a$3w(-.5,-.5,0,.5,.5,1),ax=a$3w(-.5,-.5,0,.5,.5,.5);function c$3z(fe){switch(fe){case"sphere":case"cube":case"diamond":return sx;case"cylinder":case"cone":case"inverted-cone":return ox;case"tetrahedron":return ax;default:return}}const lx=["butt","square","round"],cx=[...lx,"none"],ux=["miter","bevel","round"];var hx;let dx=hx=class extends Pn{constructor(fe){super(fe),this.color=new b_([0,0,0,1]),this.size=e$3N(1),this.pattern=null,this.patternCap="butt"}clone(){const fe={color:null!=this.color?this.color.clone():null,size:this.size,pattern:null!=this.pattern?this.pattern.clone():null,patternCap:this.patternCap};return new hx(fe)}};var px;e$4o([y$2v(uw)],dx.prototype,"color",void 0),e$4o([y$2v(hw)],dx.prototype,"size",void 0),e$4o([y$2v(Xw)],dx.prototype,"pattern",void 0),e$4o([y$2v({type:lx,json:{default:"butt",write:{overridePolicy(){return{enabled:null!=this.pattern}}}}})],dx.prototype,"patternCap",void 0),dx=hx=e$4o([a$4y("esri.symbols.support.Symbol3DOutline")],dx);let fx=px=class extends cw{constructor(fe){super(fe),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const fe={edges:null!=this.edges?this.edges.clone():null,enabled:this.enabled,material:null!=this.material?this.material.clone():null,pattern:null!=this.pattern?this.pattern.clone():null,castShadows:this.castShadows,outline:null!=this.outline?this.outline.clone():null};return new px(fe)}static fromSimpleFillSymbol(fe){var ve,_e,be;const we=fe.outline&&fe.outline.style&&"solid"!==fe.outline.style?new jw({style:fe.outline.style}):null,Se={size:(null==(ve=fe.outline)?void 0:ve.width)??0,color:((null==(_e=fe.outline)?void 0:_e.color)??Jw).clone(),pattern:we};return we&&(null==(be=fe.outline)?void 0:be.cap)&&(Se.patternCap=fe.outline.cap),new px({material:new ex({color:(fe.color??Qw).clone()}),pattern:fe.style&&"solid"!==fe.style?new Yw({style:fe.style}):null,outline:Se})}};e$4o([o$3g({Fill:"fill"},{readOnly:!0})],fx.prototype,"type",void 0),e$4o([y$2v({type:ex,json:{write:!0}})],fx.prototype,"material",void 0),e$4o([y$2v(Zw)],fx.prototype,"pattern",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],fx.prototype,"castShadows",void 0),e$4o([y$2v({type:dx,json:{write:!0}})],fx.prototype,"outline",void 0),e$4o([y$2v($w)],fx.prototype,"edges",void 0),fx=px=e$4o([a$4y("esri.symbols.FillSymbol3DLayer")],fx);const mx=fx,yx={type:Number,cast:fe=>{const ve=a$4C(fe);return 0===ve?1:e$3Y(ve,.1,4)},nonNullable:!0},gx={type:["left","right","center"],nonNullable:!0},vx={type:["baseline","top","middle","bottom"],nonNullable:!0};var _x;let $x=_x=class extends Pn{constructor(fe){super(fe),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(fe){return o$3L(fe)}clone(){return new _x({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};e$4o([y$2v({type:["none","underline","line-through"],json:{default:"none",write:!0}})],$x.prototype,"decoration",void 0),e$4o([y$2v({type:String,json:{write:!0}})],$x.prototype,"family",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy:(fe,ve,_e)=>({enabled:!_e||!_e.textSymbol3D})}}})],$x.prototype,"size",void 0),e$4o([s$4b("size")],$x.prototype,"castSize",null),e$4o([y$2v({type:["normal","italic","oblique"],json:{default:"normal",write:!0}})],$x.prototype,"style",void 0),e$4o([y$2v({type:["normal","lighter","bold","bolder"],json:{default:"normal",write:!0}})],$x.prototype,"weight",void 0),$x=_x=e$4o([a$4y("esri.symbols.Font")],$x);const bx=$x;var wx;const xx=i$4y()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Sx=wx=class extends Pn{constructor(fe){super(fe)}readHref(fe,ve,_e){return fe?u$37(fe,_e):ve.dataURI}writeHref(fe,ve,_e,be){fe&&(tt$k(fe)?ve.dataURI=fe:(ve.href=m$2_(fe,be),Y$F(ve.href)&&(ve.href=K$I(ve.href))))}clone(){return new wx({href:this.href,primitive:this.primitive})}};e$4o([y$2v({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Sx.prototype,"href",void 0),e$4o([o$40("href")],Sx.prototype,"readHref",null),e$4o([r$3s("href",{href:{type:String},dataURI:{type:String}})],Sx.prototype,"writeHref",null),e$4o([o$3g(xx)],Sx.prototype,"primitive",void 0),Sx=wx=e$4o([a$4y("esri.symbols.support.IconSymbol3DLayerResource")],Sx);var Tx;let Ex=Tx=class extends zi{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Tx({x:this.x,y:this.y})}};var Px;e$4o([y$2v({type:Number})],Ex.prototype,"x",void 0),e$4o([y$2v({type:Number})],Ex.prototype,"y",void 0),Ex=Tx=e$4o([a$4y("esri.symbols.support.Symbol3DAnchorPosition2D")],Ex);let Cx=Px=class extends Pn{constructor(fe){super(fe),this.color=new b_([0,0,0,1]),this.size=e$3N(1)}clone(){const fe={color:null!=this.color?this.color.clone():null,size:this.size};return new Px(fe)}};var Ox;e$4o([y$2v(uw)],Cx.prototype,"color",void 0),e$4o([y$2v(hw)],Cx.prototype,"size",void 0),Cx=Px=e$4o([a$4y("esri.symbols.support.Symbol3DIconOutline")],Cx);const Ax="esri.symbols.IconSymbol3DLayer";let Mx=Ox=class extends cw{constructor(fe){super(fe),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Ox({anchor:this.anchor,anchorPosition:a$4H(this.anchorPosition),enabled:this.enabled,material:a$4H(this.material),outline:a$4H(this.outline),resource:a$4H(this.resource),size:this.size})}static fromSimpleMarkerSymbol(fe){const ve=fe.color||Jw,_e=g$1W(fe),be=fe.outline&&fe.outline.width>0?{size:fe.outline.width,color:(fe.outline.color||Jw).clone()}:null;return new Ox({size:fe.size,resource:{primitive:S$1q(fe.style)},material:{color:ve},outline:be,anchor:_e?"relative":void 0,anchorPosition:_e})}static fromPictureMarkerSymbol(fe){const ve=!fe.color||function t$3g(fe){return 0===fe.r&&0===fe.g&&0===fe.b}(fe.color)?Jw:fe.color,_e=g$1W(fe);return new Ox({size:fe.width<=fe.height?fe.height:fe.width,resource:{href:fe.url},material:{color:ve.clone()},anchor:_e?"relative":void 0,anchorPosition:_e})}static fromCIMSymbol(fe){return new Ox({resource:{href:st$k({mediaType:"application/json",data:JSON.stringify(fe.data)})}})}};e$4o([y$2v({type:ww,json:{write:!0}})],Mx.prototype,"material",void 0),e$4o([y$2v({type:Sx,json:{write:!0}})],Mx.prototype,"resource",void 0),e$4o([o$3g({Icon:"icon"},{readOnly:!0})],Mx.prototype,"type",void 0),e$4o([y$2v(hw)],Mx.prototype,"size",void 0),e$4o([o$3g({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),y$2v({json:{default:"center"}})],Mx.prototype,"anchor",void 0),e$4o([y$2v({type:Ex,json:{type:[Number],read:{reader:fe=>new Ex({x:fe[0],y:fe[1]})},write:{writer:(fe,ve)=>{ve.anchorPosition=[fe.x,fe.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],Mx.prototype,"anchorPosition",void 0),e$4o([y$2v({type:Cx,json:{write:!0}})],Mx.prototype,"outline",void 0),Mx=Ox=e$4o([a$4y(Ax)],Mx);const Rx=Mx;function g$1W(fe){const ve="width"in fe?fe.width:fe.size,_e="height"in fe?fe.height:fe.size,be=v$1t(fe.xoffset),we=v$1t(fe.yoffset);return(be||we)&&ve&&_e?{x:-be/ve,y:we/_e}:null}function v$1t(fe){return isFinite(fe)?fe:0}const Ix={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function S$1q(fe){return Ix[fe]||(ar.getLogger(Ax).warn(`${fe} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let Lx=class n8 extends(i$4F(Pn)){constructor(fe){super(fe),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(fe){return null!=fe&&fe.placement===this.placement&&fe.style===this.style&&(null==this.color&&null==fe.color||null!=this.color&&null!=fe.color&&this.color.toJSON()===fe.color.toJSON())}};e$4o([y$2v({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Lx.prototype,"type",void 0),e$4o([y$2v({type:["begin","end","begin-end"],json:{default:"begin-end",write:!0}})],Lx.prototype,"placement",void 0),e$4o([y$2v({type:Cw,json:{default:"arrow",write:!0}})],Lx.prototype,"style",void 0),e$4o([y$2v({type:b_,json:{type:[Ci],default:null,write:!0}})],Lx.prototype,"color",void 0),Lx=e$4o([a$4y("esri.symbols.LineStyleMarker3D")],Lx);const Dx=Lx;var Nx;let Fx=Nx=class extends cw{constructor(fe){super(fe),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=e$3N(1),this.pattern=null,this.marker=null}clone(){const fe={enabled:this.enabled,material:null!=this.material?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:null!=this.pattern?this.pattern.clone():null,marker:null!=this.marker?this.marker.clone():null};return new Nx(fe)}static fromSimpleLineSymbol(fe){var ve;const _e={enabled:!0,size:fe.width??e$3N(1),cap:fe.cap||"butt",join:fe.join||"miter",pattern:fe.style?new jw({style:fe.style}):null,material:new ww({color:(fe.color||Jw).clone()}),marker:fe.marker?new Dx({placement:fe.marker.placement,style:fe.marker.style,color:(null==(ve=fe.marker.color)?void 0:ve.clone())??null}):null};return new Nx(_e)}};e$4o([y$2v({type:ww,json:{write:!0}})],Fx.prototype,"material",void 0),e$4o([o$3g({Line:"line"},{readOnly:!0})],Fx.prototype,"type",void 0),e$4o([y$2v({type:ux,json:{write:!0,default:"miter"}})],Fx.prototype,"join",void 0),e$4o([y$2v({type:lx,json:{write:!0,default:"butt"}})],Fx.prototype,"cap",void 0),e$4o([y$2v(hw)],Fx.prototype,"size",void 0),e$4o([y$2v(Xw)],Fx.prototype,"pattern",void 0),e$4o([y$2v({types:{key:"type",base:Dx,typeMap:{style:Dx}},json:{write:!0}})],Fx.prototype,"marker",void 0),Fx=Nx=e$4o([a$4y("esri.symbols.LineSymbol3DLayer")],Fx);const zx=Fx;var kx;const Ux=i$4y()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let Vx=kx=class extends Pn{clone(){return new kx({href:this.href,primitive:this.primitive})}};e$4o([y$2v({type:String,json:{read:p$4e,write:f$2v}})],Vx.prototype,"href",void 0),e$4o([o$3g(Ux)],Vx.prototype,"primitive",void 0),Vx=kx=e$4o([a$4y("esri.symbols.support.ObjectSymbol3DLayerResource")],Vx);const Bx="sphere";var jx;let Gx=jx=class extends zi{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new jx({x:this.x,y:this.y,z:this.z})}};var Hx;e$4o([y$2v({type:Number})],Gx.prototype,"x",void 0),e$4o([y$2v({type:Number})],Gx.prototype,"y",void 0),e$4o([y$2v({type:Number})],Gx.prototype,"z",void 0),Gx=jx=e$4o([a$4y("esri.symbols.support.Symbol3DAnchorPosition3D")],Gx);let qx=Hx=class extends cw{constructor(fe){super(fe),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var fe,ve,_e;return new Hx({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:null==(fe=this.anchorPosition)?void 0:fe.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:(null==(ve=this.material)?void 0:ve.clone())??null,castShadows:this.castShadows,resource:null==(_e=this.resource)?void 0:_e.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};e$4o([y$2v({type:ww,json:{write:!0}})],qx.prototype,"material",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],qx.prototype,"castShadows",void 0),e$4o([y$2v({type:Vx,json:{write:!0}})],qx.prototype,"resource",void 0),e$4o([o$3g({Object:"object"},{readOnly:!0})],qx.prototype,"type",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"width",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"height",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"depth",void 0),e$4o([o$3g({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),y$2v({json:{default:"origin"}})],qx.prototype,"anchor",void 0),e$4o([y$2v({type:Gx,json:{type:[Number],read:{reader:fe=>new Gx({x:fe[0],y:fe[1],z:fe[2]})},write:{writer:(fe,ve)=>{ve.anchorPosition=[fe.x,fe.y,fe.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],qx.prototype,"anchorPosition",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"heading",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"tilt",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qx.prototype,"roll",void 0),e$4o([y$2v({readOnly:!0})],qx.prototype,"isPrimitive",null),qx=Hx=e$4o([a$4y("esri.symbols.ObjectSymbol3DLayer")],qx);const Wx=qx;var Yx;let Zx=Yx=class extends cw{constructor(fe){super(fe),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(fe,ve){return null!=fe?fe:null==ve.height&&null!=ve.size?ve.size:void 0}readHeight(fe,ve){return null!=fe?fe:null==ve.width&&null!=ve.size?ve.size:void 0}clone(){return new Yx({enabled:this.enabled,material:null!=this.material?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};e$4o([y$2v({type:ww,json:{write:!0}})],Zx.prototype,"material",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Zx.prototype,"castShadows",void 0),e$4o([o$3g({Path:"path"},{readOnly:!0})],Zx.prototype,"type",void 0),e$4o([y$2v({type:["circle","quad"],json:{write:!0,default:"circle"}})],Zx.prototype,"profile",void 0),e$4o([y$2v({type:ux,json:{write:!0,default:"miter"}})],Zx.prototype,"join",void 0),e$4o([y$2v({type:cx,json:{write:!0,default:"butt"}})],Zx.prototype,"cap",void 0),e$4o([y$2v({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Zx.prototype,"width",void 0),e$4o([o$40("width",["width","size","height"])],Zx.prototype,"readWidth",null),e$4o([y$2v({type:Number,json:{write:!0}})],Zx.prototype,"height",void 0),e$4o([o$40("height",["height","size","width"])],Zx.prototype,"readHeight",null),e$4o([y$2v({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Zx.prototype,"anchor",void 0),e$4o([y$2v({type:["heading","all"],json:{write:!0,default:"all"}})],Zx.prototype,"profileRotation",void 0),Zx=Yx=e$4o([a$4y("esri.symbols.PathSymbol3DLayer")],Zx);const Xx=Zx;var Jx;let Qx=Jx=class extends Pn{constructor(){super(...arguments),this.color=new b_([0,0,0,1]),this.size=0}clone(){const fe={color:a$4H(this.color),size:this.size};return new Jx(fe)}};e$4o([y$2v(uw)],Qx.prototype,"color",void 0),e$4o([y$2v(hw)],Qx.prototype,"size",void 0),Qx=Jx=e$4o([a$4y("esri.symbols.support.Symbol3DHalo")],Qx);let Kx=class c9 extends(i$4F(Pn)){constructor(fe){super(fe),this.color=null}};var eS;e$4o([y$2v(uw)],Kx.prototype,"color",void 0),Kx=e$4o([a$4y("esri.symbols.support.Symbol3DTextBackground")],Kx);let tS=eS=class extends cw{constructor(fe){super(fe),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(fe){null!=fe&&null!=this._userSize&&(fe.size=this._userSize),this._set("font",fe)}writeFont(fe,ve,_e,be){const we={...be,textSymbol3D:!0};ve.font=fe.write({},we),delete ve.font.size}get size(){var fe;return null!=this._userSize?this._userSize:null!=(null==(fe=this.font)?void 0:fe.size)?this.font.size:9}set size(fe){this._userSize=fe,null!=this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const fe=new eS({enabled:this.enabled,font:this.font&&a$4H(this.font),halo:this.halo&&a$4H(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:null!=this.material?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:a$4H(this.background)});return fe._userSize=this._userSize,fe}static fromTextSymbol(fe){return new eS({font:null!=fe.font?fe.font.clone():new bx,halo:d$2t(fe.haloColor,fe.haloSize),horizontalAlignment:fe.horizontalAlignment,lineHeight:fe.lineHeight,material:fe.color?new ww({color:fe.color.clone()}):null,text:fe.text,verticalAlignment:fe.verticalAlignment,background:fe.backgroundColor?new Kx({color:fe.backgroundColor.clone()}):null})}};function d$2t(fe,ve){return fe&&null!=ve&&ve>0?new Qx({color:a$4H(fe),size:ve}):null}e$4o([y$2v({type:bx,json:{write:!0}})],tS.prototype,"font",null),e$4o([r$3s("font")],tS.prototype,"writeFont",null),e$4o([y$2v({type:Qx,json:{write:!0}})],tS.prototype,"halo",void 0),e$4o([y$2v({...gx,json:{default:"center",write:!0}})],tS.prototype,"horizontalAlignment",void 0),e$4o([y$2v({...yx,json:{default:1,write:!0}})],tS.prototype,"lineHeight",void 0),e$4o([y$2v({type:ww,json:{write:!0}})],tS.prototype,"material",void 0),e$4o([y$2v({type:Kx,json:{write:!0}})],tS.prototype,"background",void 0),e$4o([y$2v(hw)],tS.prototype,"size",null),e$4o([y$2v({type:String,json:{write:!0}})],tS.prototype,"text",void 0),e$4o([o$3g({Text:"text"},{readOnly:!0})],tS.prototype,"type",void 0),e$4o([y$2v({...vx,json:{default:"baseline",write:!0}})],tS.prototype,"verticalAlignment",void 0),tS=eS=e$4o([a$4y("esri.symbols.TextSymbol3DLayer")],tS);const rS=tS;var iS;let nS=iS=class extends cw{constructor(fe){super(fe),this.color=oS.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new iS({color:a$4H(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};e$4o([y$2v({type:b_,nonNullable:!0,json:{type:[Ci],write:(fe,ve,_e)=>ve[_e]=fe.toArray(b_.AlphaMode.UNLESS_OPAQUE),default:()=>oS.clone(),defaultEquals:fe=>fe.toCss(!0)===oS.toCss(!0)}})],nS.prototype,"color",void 0),e$4o([o$3g({Water:"water"},{readOnly:!0})],nS.prototype,"type",void 0),e$4o([y$2v({type:["small","medium","large"],json:{write:!0,default:"medium"}})],nS.prototype,"waterbodySize",void 0),e$4o([y$2v({type:Number,json:{write:!0,default:null}})],nS.prototype,"waveDirection",void 0),e$4o([y$2v({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],nS.prototype,"waveStrength",void 0),nS=iS=e$4o([a$4y("esri.symbols.WaterSymbol3DLayer")],nS);const sS=nS,oS=new b_([0,119,190]);var aS;let lS=aS=class extends zi{constructor(fe){super(fe),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new aS({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};e$4o([y$2v({type:String})],lS.prototype,"name",void 0),e$4o([y$2v({type:String})],lS.prototype,"styleUrl",void 0),e$4o([y$2v({type:String})],lS.prototype,"styleName",void 0),e$4o([y$2v({type:Gv})],lS.prototype,"portal",void 0),lS=aS=e$4o([a$4y("esri.symbols.support.StyleOrigin")],lS);const cS=lS;var uS;let hS=uS=class extends zi{constructor(){super(...arguments),this.url=""}clone(){return new uS({url:this.url})}};e$4o([y$2v({type:String})],hS.prototype,"url",void 0),hS=uS=e$4o([a$4y("esri.symbols.support.Thumbnail")],hS);const dS={icon:Rx,object:Wx,line:zx,path:Xx,fill:mx,extrude:Tw,text:rS,water:sS},pS=Wa.ofType({base:cw,key:"type",typeMap:dS,errorContext:"symbol-layer"});let fS=class T2 extends nw{constructor(fe){super(fe),this.styleOrigin=null,this.thumbnail=null,this.type=null;const ve=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,_e=(null==ve?void 0:ve.type)||Wa;this._set("symbolLayers",new _e)}get color(){return null}set color(fe){this.constructed&&ar.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(fe){n$4c(fe,this._get("symbolLayers"))}readStyleOrigin(fe,ve,_e){if(fe.styleUrl&&fe.name){const ve=u$37(fe.styleUrl,_e);return new cS({styleUrl:ve,name:fe.name})}if(fe.styleName&&fe.name)return new cS({portal:(null==_e?void 0:_e.portal)||Gv.getDefault(),styleName:fe.styleName,name:fe.name});(null==_e?void 0:_e.messages)&&_e.messages.push(new Mi("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:_e,definition:fe}))}writeStyleOrigin(fe,ve,_e,be){if(fe.styleUrl&&fe.name){let _e=m$2_(fe.styleUrl,be);Y$F(_e)&&(_e=K$I(_e)),ve.styleOrigin={styleUrl:_e,name:fe.name}}else fe.styleName&&fe.name&&(fe.portal&&(null==be?void 0:be.portal)&&!N$1a(fe.portal.restUrl,be.portal.restUrl)?(null==be?void 0:be.messages)&&be.messages.push(new Mi("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):ve.styleOrigin={styleName:fe.styleName,name:fe.name})}normalizeCtorArgs(fe){return fe instanceof cw||fe&&dS[fe.type]?{symbolLayers:[fe]}:Array.isArray(fe)?{symbolLayers:fe}:fe}};e$4o([y$2v({json:{read:!1,write:!1}})],fS.prototype,"color",null),e$4o([y$2v({type:pS,nonNullable:!0,json:{write:!0}}),s$4b(t$3R)],fS.prototype,"symbolLayers",null),e$4o([y$2v({type:cS})],fS.prototype,"styleOrigin",void 0),e$4o([o$40("styleOrigin")],fS.prototype,"readStyleOrigin",null),e$4o([r$3s("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],fS.prototype,"writeStyleOrigin",null),e$4o([y$2v({type:hS,json:{read:!1}})],fS.prototype,"thumbnail",void 0),e$4o([y$2v({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],fS.prototype,"type",void 0),fS=e$4o([a$4y("esri.symbols.Symbol3D")],fS);const mS=fS;let yS=class t15 extends Pn{constructor(fe){super(fe),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};e$4o([y$2v({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],yS.prototype,"type",void 0),e$4o([y$2v({readOnly:!0})],yS.prototype,"visible",void 0),yS=e$4o([a$4y("esri.symbols.callouts.Callout3D")],yS);const gS=yS;var vS;let _S=vS=class extends Pn{constructor(fe){super(fe),this.color=new b_("white")}clone(){return new vS({color:a$4H(this.color)})}};e$4o([y$2v(uw)],_S.prototype,"color",void 0),_S=vS=e$4o([a$4y("esri.symbols.callouts.LineCallout3DBorder")],_S);const $S=_S;var bS;let wS=bS=class extends gS{constructor(fe){super(fe),this.type="line",this.color=new b_([0,0,0,1]),this.size=e$3N(1),this.border=null}get visible(){return this.size>0&&null!=this.color&&this.color.a>0}clone(){return new bS({color:a$4H(this.color),size:this.size,border:a$4H(this.border)})}};e$4o([o$3g({line:"line"})],wS.prototype,"type",void 0),e$4o([y$2v(uw)],wS.prototype,"color",void 0),e$4o([y$2v(hw)],wS.prototype,"size",void 0),e$4o([y$2v({type:$S,json:{write:!0}})],wS.prototype,"border",void 0),e$4o([y$2v({readOnly:!0})],wS.prototype,"visible",null),wS=bS=e$4o([a$4y("esri.symbols.callouts.LineCallout3D")],wS);const xS=wS;function e$38(fe){if(!fe)return!1;const ve=fe.verticalOffset;return!!ve&&!(ve.screenLength<=0||null!=ve.maxWorldLength&&ve.maxWorldLength<=0)}function r$2J(fe){if(!fe)return!1;if(!fe.supportsCallout||!fe.supportsCallout())return!1;const ve=fe.callout;return!!ve&&!!ve.visible&&!!e$38(fe)}function o$33(fe){return"point-3d"===fe.type||"label-3d"===fe.type}function l$3d(fe){return"center"===fe.horizontalAlignment}const SS={types:{key:"type",base:gS,typeMap:{line:xS}},json:{write:!0}};var TS;let ES=TS=class extends Pn{constructor(fe){super(fe),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new TS({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};e$4o([y$2v(hw)],ES.prototype,"screenLength",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0,default:0}})],ES.prototype,"minWorldLength",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],ES.prototype,"maxWorldLength",void 0),ES=TS=e$4o([a$4y("esri.symbols.support.Symbol3DVerticalOffset")],ES);const PS=ES;var CS;const OS=Wa.ofType({base:null,key:"type",typeMap:{text:rS}});let AS=CS=class extends mS{constructor(fe){super(fe),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new OS,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return r$2J(this)}hasVisibleVerticalOffset(){return e$38(this)}clone(){return new CS({styleOrigin:a$4H(this.styleOrigin),symbolLayers:a$4H(this.symbolLayers),thumbnail:a$4H(this.thumbnail),callout:a$4H(this.callout),verticalOffset:a$4H(this.verticalOffset)})}static fromTextSymbol(fe){return new CS({symbolLayers:new Wa([rS.fromTextSymbol(fe)])})}};e$4o([y$2v({type:PS,json:{write:!0}})],AS.prototype,"verticalOffset",void 0),e$4o([y$2v(SS)],AS.prototype,"callout",void 0),e$4o([y$2v({json:{read:!1,write:!1}})],AS.prototype,"styleOrigin",void 0),e$4o([y$2v({type:OS})],AS.prototype,"symbolLayers",void 0),e$4o([o$3g({LabelSymbol3D:"label-3d"},{readOnly:!0})],AS.prototype,"type",void 0),AS=CS=e$4o([a$4y("esri.symbols.LabelSymbol3D")],AS);const MS=AS;var RS;const IS=Wa.ofType({base:null,key:"type",typeMap:{line:zx,path:Xx}}),LS=Wa.ofType({base:null,key:"type",typeMap:{line:zx,path:Xx}});let DS=RS=class extends mS{constructor(fe){super(fe),this.symbolLayers=new IS,this.type="line-3d"}clone(){return new RS({styleOrigin:a$4H(this.styleOrigin),symbolLayers:a$4H(this.symbolLayers),thumbnail:a$4H(this.thumbnail)})}static fromSimpleLineSymbol(fe){return new RS({symbolLayers:new Wa([zx.fromSimpleLineSymbol(fe)])})}};e$4o([y$2v({type:IS,json:{type:LS}})],DS.prototype,"symbolLayers",void 0),e$4o([o$3g({LineSymbol3D:"line-3d"},{readOnly:!0})],DS.prototype,"type",void 0),DS=RS=e$4o([a$4y("esri.symbols.LineSymbol3D")],DS);const NS=DS;let FS=class p9 extends nw{constructor(fe){super(fe),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};e$4o([y$2v({type:Number,json:{read:fe=>fe&&-1*fe,write:(fe,ve)=>ve.angle=fe&&-1*fe}})],FS.prototype,"angle",void 0),e$4o([y$2v({type:["simple-marker","picture-marker"],readOnly:!0})],FS.prototype,"type",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],FS.prototype,"xoffset",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],FS.prototype,"yoffset",void 0),e$4o([y$2v({type:Number,cast:fe=>"auto"===fe?fe:o$3L(fe),json:{write:!0}})],FS.prototype,"size",void 0),FS=e$4o([a$4y("esri.symbols.MarkerSymbol")],FS);const zS=FS;var kS;const US=Wa.ofType({base:null,key:"type",typeMap:{fill:mx}});let VS=kS=class extends mS{constructor(fe){super(fe),this.symbolLayers=new US,this.type="mesh-3d"}clone(){return new kS({styleOrigin:a$4H(this.styleOrigin),symbolLayers:a$4H(this.symbolLayers),thumbnail:a$4H(this.thumbnail)})}static fromSimpleFillSymbol(fe){return new kS({symbolLayers:new Wa([mx.fromSimpleFillSymbol(fe)])})}};e$4o([y$2v({type:US})],VS.prototype,"symbolLayers",void 0),e$4o([o$3g({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],VS.prototype,"type",void 0),VS=kS=e$4o([a$4y("esri.symbols.MeshSymbol3D")],VS);const BS=VS;function o$32(fe,ve){if(!Y$F(fe)){const _e=function p$3t(fe){var ve,_e;if(!fe)return null;const{origin:be,layer:we}=fe;if("service"!==be&&"portal-item"!==be)return null;const Se=null==we?void 0:we.type;return"feature"===Se||"stream"===Se?null==(ve=we.parsedUrl)?void 0:ve.path:"map-image"===Se||"tile"===Se?null==(_e=fe.url)?void 0:_e.path:null}(ve);if(_e)return V$19(_e,"images",fe)}return u$37(fe,ve)}const jS={json:{read:{source:["imageData","url"],reader:function l$3b(fe,ve,_e){return ve.imageData?st$k({mediaType:ve.contentType||"image/png",isBase64:!0,data:ve.imageData}):o$32(ve.url,_e)}},write:{writer(fe,ve,_e,be){!function s$3j(fe,ve,_e,be){if(tt$k(fe)){const we=ot$i(fe);if(!we)return;ve.contentType=we.mediaType,ve.imageData=we.data,_e&&_e.imageData===ve.imageData&&_e.url&&f$2v(_e.url,ve,"url",be)}else f$2v(fe,ve,"url",be)}(fe,ve,this.source,be)}}}},GS={readOnly:!0,json:{read:{source:["imageData","url"],reader(fe,ve,_e){const be={};return ve.imageData&&(be.imageData=ve.imageData),ve.contentType&&(be.contentType=ve.contentType),ve.url&&(be.url=o$32(ve.url,_e)),be}}}};var HS;let qS=HS=class extends Fw{constructor(...fe){super(...fe),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(fe,ve,_e,be){if(fe&&"string"!=typeof fe&&null==fe.imageData)return fe;const we={};return fe&&(we.url=fe),ve&&(we.outline=ve),null!=_e&&(we.width=o$3L(_e)),null!=be&&(we.height=o$3L(be)),we}clone(){const fe=new HS({color:a$4H(this.color),height:this.height,outline:a$4H(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return fe._set("source",a$4H(this.source)),fe}hash(){var fe;return`${super.hash()}.${null==(fe=this.color)?void 0:fe.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};e$4o([o$3g({esriPFS:"picture-fill"},{readOnly:!0})],qS.prototype,"type",void 0),e$4o([y$2v(jS)],qS.prototype,"url",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qS.prototype,"xscale",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],qS.prototype,"yscale",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],qS.prototype,"width",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],qS.prototype,"height",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],qS.prototype,"xoffset",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],qS.prototype,"yoffset",void 0),e$4o([y$2v(GS)],qS.prototype,"source",void 0),qS=HS=e$4o([a$4y("esri.symbols.PictureFillSymbol")],qS);const WS=qS;var YS;let ZS=YS=class extends zS{constructor(...fe){super(...fe),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(fe,ve,_e){if(fe&&"string"!=typeof fe&&null==fe.imageData)return fe;const be={};return fe&&(be.url=fe),null!=ve&&(be.width=o$3L(ve)),null!=_e&&(be.height=o$3L(_e)),be}readHeight(fe,ve){return ve.size||fe}readWidth(fe,ve){return ve.size||fe}clone(){const fe=new YS({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return fe._set("source",a$4H(this.source)),fe}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};e$4o([y$2v({json:{write:!1}})],ZS.prototype,"color",void 0),e$4o([o$3g({esriPMS:"picture-marker"},{readOnly:!0})],ZS.prototype,"type",void 0),e$4o([y$2v(jS)],ZS.prototype,"url",void 0),e$4o([y$2v(GS)],ZS.prototype,"source",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],ZS.prototype,"height",void 0),e$4o([o$40("height",["height","size"])],ZS.prototype,"readHeight",null),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],ZS.prototype,"width",void 0),e$4o([y$2v({json:{write:!1}})],ZS.prototype,"size",void 0),ZS=YS=e$4o([a$4y("esri.symbols.PictureMarkerSymbol")],ZS);const XS=ZS;var JS;const QS=Wa.ofType({base:null,key:"type",typeMap:{icon:Rx,object:Wx,text:rS}});let KS=JS=class extends mS{constructor(fe){super(fe),this.verticalOffset=null,this.callout=null,this.symbolLayers=new QS,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const fe of this.symbolLayers.items)switch(fe.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return r$2J(this)}hasVisibleVerticalOffset(){return e$38(this)}clone(){return new JS({verticalOffset:a$4H(this.verticalOffset),callout:a$4H(this.callout),styleOrigin:a$4H(this.styleOrigin),symbolLayers:a$4H(this.symbolLayers),thumbnail:a$4H(this.thumbnail)})}static fromSimpleMarkerSymbol(fe){return new JS({symbolLayers:new Wa([Rx.fromSimpleMarkerSymbol(fe)])})}static fromPictureMarkerSymbol(fe){return new JS({symbolLayers:new Wa([Rx.fromPictureMarkerSymbol(fe)])})}static fromCIMSymbol(fe){var ve,_e;if("CIMPointSymbol"!==(null==(_e=null==(ve=fe.data)?void 0:ve.symbol)?void 0:_e.type))return null;const be=fe.data.symbol;return new JS((null==be?void 0:be.callout)?{symbolLayers:new Wa([Rx.fromCIMSymbol(fe)]),callout:new xS({size:.5,color:new b_([0,0,0])}),verticalOffset:new PS({screenLength:40})}:{symbolLayers:new Wa([Rx.fromCIMSymbol(fe)])})}static fromTextSymbol(fe){return new JS({symbolLayers:new Wa([rS.fromTextSymbol(fe)])})}};e$4o([y$2v({type:PS,json:{write:!0}})],KS.prototype,"verticalOffset",void 0),e$4o([y$2v(SS)],KS.prototype,"callout",void 0),e$4o([y$2v({type:QS,json:{origins:{"web-scene":{write:!0}}}})],KS.prototype,"symbolLayers",void 0),e$4o([o$3g({PointSymbol3D:"point-3d"},{readOnly:!0})],KS.prototype,"type",void 0),KS=JS=e$4o([a$4y("esri.symbols.PointSymbol3D")],KS);const eT=KS;var tT;const rT=Wa.ofType({base:null,key:"type",typeMap:{extrude:Tw,fill:mx,icon:Rx,line:zx,object:Wx,text:rS,water:sS}});let iT=tT=class extends mS{constructor(fe){super(fe),this.symbolLayers=new rT,this.type="polygon-3d"}initialize(){const o39=fe=>{"line"===fe.type&&a$4K(ar.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),"text"===fe.type&&a$4K(ar.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const fe of this.symbolLayers)o39(fe);this.addHandles(v$1W((()=>this.symbolLayers),"after-add",(({item:fe})=>o39(fe)),Za))}clone(){return new tT({styleOrigin:a$4H(this.styleOrigin),symbolLayers:a$4H(this.symbolLayers),thumbnail:a$4H(this.thumbnail)})}static fromJSON(fe){var ve;const _e=new tT;if(_e.read(fe),2===_e.symbolLayers.length&&"fill"===_e.symbolLayers.at(0).type&&"line"===_e.symbolLayers.at(1).type){const be=_e.symbolLayers.at(0),we=_e.symbolLayers.at(1);!we.enabled||(null==(ve=fe.symbolLayers)?void 0:ve[1])&&!1===fe.symbolLayers[1].enable||(be.outline={size:we.size,color:null!=we.material?we.material.color:null}),_e.symbolLayers.removeAt(1)}return _e}static fromSimpleFillSymbol(fe){return new tT({symbolLayers:new Wa([mx.fromSimpleFillSymbol(fe)])})}};e$4o([y$2v({type:rT,json:{write:!0}})],iT.prototype,"symbolLayers",void 0),e$4o([o$3g({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],iT.prototype,"type",void 0),iT=tT=e$4o([a$4y("esri.symbols.PolygonSymbol3D")],iT);const nT=iT;var sT;const oT=new An({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let aT=sT=class extends Fw{constructor(...fe){super(...fe),this.color=new b_([0,0,0,.25]),this.outline=new Dw,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(fe,ve,_e){if(fe&&"string"!=typeof fe)return fe;const be={};return fe&&(be.style=fe),ve&&(be.outline=ve),_e&&(be.color=_e),be}clone(){return new sT({color:a$4H(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};e$4o([y$2v()],aT.prototype,"color",void 0),e$4o([y$2v()],aT.prototype,"outline",void 0),e$4o([o$3g({esriSFS:"simple-fill"},{readOnly:!0})],aT.prototype,"type",void 0),e$4o([y$2v({type:oT.apiValues,json:{read:oT.read,write:oT.write}})],aT.prototype,"style",void 0),aT=sT=e$4o([a$4y("esri.symbols.SimpleFillSymbol")],aT);const lT=aT;var cT;const uT=new An({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let hT=cT=class extends zS{constructor(...fe){super(...fe),this.color=new b_([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Dw}normalizeCtorArgs(fe,ve,_e,be){if(fe&&"string"!=typeof fe)return fe;const we={};return fe&&(we.style=fe),null!=ve&&(we.size=o$3L(ve)),_e&&(we.outline=_e),be&&(we.color=be),we}writeColor(fe,ve){fe&&"x"!==this.style&&"cross"!==this.style&&(ve.color=fe.toJSON()),null===fe&&(ve.color=null)}set path(fe){this.style="path",this._set("path",fe)}clone(){return new cT({angle:this.angle,color:a$4H(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var fe;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${null==(fe=this.outline)?void 0:fe.hash()}`}};e$4o([y$2v()],hT.prototype,"color",void 0),e$4o([r$3s("color")],hT.prototype,"writeColor",null),e$4o([o$3g({esriSMS:"simple-marker"},{readOnly:!0})],hT.prototype,"type",void 0),e$4o([y$2v()],hT.prototype,"size",void 0),e$4o([y$2v({type:uT.apiValues,json:{read:uT.read,write:uT.write}})],hT.prototype,"style",void 0),e$4o([y$2v({type:String,json:{write:!0}})],hT.prototype,"path",null),e$4o([y$2v({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Dw}},json:{default:null,write:!0}})],hT.prototype,"outline",void 0),hT=cT=e$4o([a$4y("esri.symbols.SimpleMarkerSymbol")],hT);const dT=hT;var pT;let fT=pT=class extends nw{constructor(...fe){super(...fe),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new bx,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(fe,ve,_e){if(fe&&"string"!=typeof fe)return fe;const be={};return fe&&(be.text=fe),ve&&(be.font=ve),_e&&(be.color=_e),be}writeLineWidth(fe,ve,_e,be){be&&"string"!=typeof be?be.origin:ve[_e]=fe}castLineWidth(fe){return o$3L(fe)}writeLineHeight(fe,ve,_e,be){be&&"string"!=typeof be?be.origin:ve[_e]=fe}clone(){return new pT({angle:this.angle,backgroundColor:a$4H(this.backgroundColor),borderLineColor:a$4H(this.borderLineColor),borderLineSize:this.borderLineSize,color:a$4H(this.color),font:this.font&&this.font.clone(),haloColor:a$4H(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var fe,ve,_e;return`${null==(fe=this.backgroundColor)?void 0:fe.hash()}.${this.borderLineColor}.${this.borderLineSize}.${null==(ve=this.color)?void 0:ve.hash()}.${this.font&&this.font.hash()}.${null==(_e=this.haloColor)?void 0:_e.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};e$4o([y$2v({type:b_,json:{write:!0}})],fT.prototype,"backgroundColor",void 0),e$4o([y$2v({type:b_,json:{write:!0}})],fT.prototype,"borderLineColor",void 0),e$4o([y$2v({type:Number,json:{write:!0},cast:o$3L})],fT.prototype,"borderLineSize",void 0),e$4o([y$2v({type:bx,json:{write:!0}})],fT.prototype,"font",void 0),e$4o([y$2v({...gx,json:{write:!0}})],fT.prototype,"horizontalAlignment",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],fT.prototype,"kerning",void 0),e$4o([y$2v({type:b_,json:{write:!0}})],fT.prototype,"haloColor",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],fT.prototype,"haloSize",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],fT.prototype,"rightToLeft",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],fT.prototype,"rotated",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fT.prototype,"text",void 0),e$4o([o$3g({esriTS:"text"},{readOnly:!0})],fT.prototype,"type",void 0),e$4o([y$2v({...vx,json:{write:!0}})],fT.prototype,"verticalAlignment",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],fT.prototype,"xoffset",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],fT.prototype,"yoffset",void 0),e$4o([y$2v({type:Number,json:{read:fe=>fe&&-1*fe,write:(fe,ve)=>ve.angle=fe&&-1*fe}})],fT.prototype,"angle",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],fT.prototype,"width",void 0),e$4o([y$2v({type:Number})],fT.prototype,"lineWidth",void 0),e$4o([r$3s("lineWidth")],fT.prototype,"writeLineWidth",null),e$4o([s$4b("lineWidth")],fT.prototype,"castLineWidth",null),e$4o([y$2v(yx)],fT.prototype,"lineHeight",void 0),e$4o([r$3s("lineHeight")],fT.prototype,"writeLineHeight",null),fT=pT=e$4o([a$4y("esri.symbols.TextSymbol")],fT);const mT=fT;var yT;let gT=yT=class extends nw{constructor(fe){super(fe),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const fe=null!=this.portal?this.portal:Gv.getDefault(),ve=fe.user?fe.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${ve}:${fe.url}`}read(fe,ve){this.portal=null==ve?void 0:ve.portal,super.read(fe,ve)}clone(){return new yT({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(fe){return this._fetchSymbol("webRef",fe)}fetchCIMSymbol(fe){return this._fetchSymbol("cimRef",fe)}async _fetchSymbol(fe,ve){const _e=null!=ve?ve.cache:null,be=_e?this._fetchCacheKey:null;if(null!=_e){const fe=be&&_e.get(be);if(fe)return fe.clone()}const{resolveWebStyleSymbol:we}=await zt((()=>Promise.resolve().then((()=>die))),void 0);s$4o(ve);const Se=we(this,{portal:this.portal},fe,ve);Se.catch((fe=>{ar.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",fe)}));const Te=await Se;return"webRef"===fe&&"point-3d"===Te.type||"cimRef"===fe&&"cim"===Te.type?(null!=_e&&_e.set(be,Te.clone()),Te):null}};e$4o([y$2v({json:{write:!1}})],gT.prototype,"color",void 0),e$4o([y$2v({type:String,json:{write:!0}})],gT.prototype,"styleName",void 0),e$4o([y$2v({type:Gv,json:{write:!1}})],gT.prototype,"portal",void 0),e$4o([y$2v({type:String,json:{read:p$4e,write:f$2v}})],gT.prototype,"styleUrl",void 0),e$4o([y$2v({type:hS,json:{read:!1}})],gT.prototype,"thumbnail",void 0),e$4o([y$2v({type:String,json:{write:!0}})],gT.prototype,"name",void 0),e$4o([o$3g({styleSymbolReference:"web-style"},{readOnly:!0})],gT.prototype,"type",void 0),e$4o([y$2v()],gT.prototype,"_fetchCacheKey",null),gT=yT=e$4o([a$4y("esri.symbols.WebStyleSymbol")],gT);const vT=gT;function S$1n(fe){if(!fe)return!1;switch(fe.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function x$1h(fe){if(!fe)return!1;switch(fe.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const _T={base:nw,key:"type",typeMap:{"simple-fill":lT,"picture-fill":WS,"picture-marker":XS,"simple-line":Dw,"simple-marker":dT,text:mT,"label-3d":MS,"line-3d":NS,"mesh-3d":BS,"point-3d":eT,"polygon-3d":nT,"web-style":vT,cim:aw},errorContext:"symbol"},$T={base:nw,key:"type",typeMap:{"picture-marker":XS,"simple-marker":dT,"point-3d":eT,cim:aw},errorContext:"symbol"},bT={base:nw,key:"type",typeMap:{"simple-line":Dw,"line-3d":NS,cim:aw},errorContext:"symbol"},wT={base:nw,key:"type",typeMap:{"simple-fill":lT,"picture-fill":WS,"polygon-3d":nT,cim:aw},errorContext:"symbol"},xT={base:nw,key:"type",typeMap:{"picture-marker":XS,"simple-marker":dT,text:mT,"web-style":vT,cim:aw},errorContext:"symbol"},ST=u$41({types:_T}),TT={base:nw,key:"type",typeMap:{"simple-fill":lT,"picture-fill":WS,"picture-marker":XS,"simple-line":Dw,"simple-marker":dT,text:mT,"line-3d":NS,"mesh-3d":BS,"point-3d":eT,"polygon-3d":nT,"web-style":vT,cim:aw},errorContext:"symbol"},ET={base:nw,key:"type",typeMap:{text:mT,"label-3d":MS},errorContext:"symbol"},PT={base:nw,key:"type",typeMap:{"line-3d":NS,"mesh-3d":BS,"point-3d":eT,"polygon-3d":nT,"web-style":vT,cim:aw},errorContext:"symbol"},CT={base:nw,key:"type",typeMap:{"label-3d":MS},errorContext:"symbol"},OT=T$1p(_T);var AT;function f$2l(fe){if(null==fe)return null;const ve={};for(const _e in fe){const be=fe[_e];be&&(ve[_e]=be.toJSON())}return 0!==Object.keys(ve).length?ve:null}let MT=AT=class extends(i$4F(Pn)){constructor(fe){super(fe),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:e$44(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&function o$4y(fe,ve,_e={}){has("esri-deprecation-warnings")&&a$4K(fe,`Multiple argument constructor: ${ve}`,{warnOnce:!0,replacement:`new ${ve}({ <your properties here> })`,..._e})}(ar.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(fe){const ve=this._get("aggregateGeometries");JSON.stringify(ve)!==JSON.stringify(fe)&&this._set("aggregateGeometries",fe)}set attributes(fe){const ve=this._get("attributes");ve!==fe&&(this._set("attributes",fe),this._notifyLayer("attributes",ve,fe))}set geometry(fe){const ve=this._get("geometry");ve!==fe&&(this._set("geometry",fe),"mesh"!==(null==fe?void 0:fe.type)&&this._notifyLayer("geometry",ve,fe))}set symbol(fe){const ve=this._get("symbol");ve!==fe&&(this._set("symbol",fe),this._notifyLayer("symbol",ve,fe))}set visible(fe){const ve=this._get("visible");ve!==fe&&(this._set("visible",fe),this._notifyLayer("visible",ve,fe))}cloneShallow(){return new AT({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(fe=!1){if(this.popupTemplate)return this.popupTemplate;const ve=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const _e of[ve,this.sourceLayer,this.layer])if(_e){if("popupTemplate"in _e&&_e.popupTemplate)return _e.popupTemplate;if(fe&&"defaultPopupTemplate"in _e&&null!=_e.defaultPopupTemplate)return _e.defaultPopupTemplate}return null}getAttribute(fe){var ve;return null==(ve=this.attributes)?void 0:ve[fe]}setAttribute(fe,ve){if(this.attributes){const _e=this.getAttribute(fe);this.attributes[fe]=ve,this._notifyLayer("attributes",_e,ve,fe)}else this.attributes={[fe]:ve},this._notifyLayer("attributes",void 0,ve,fe)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var fe;return{aggregateGeometries:f$2l(this.aggregateGeometries),geometry:null!=this.geometry?this.geometry.toJSON():null,symbol:null!=this.symbol?this.symbol.toJSON():null,attributes:a$4s(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:(null==(fe=this.popupTemplate)?void 0:fe.toJSON())??null}}notifyMeshTransformChanged(fe={}){const{geometry:ve}=this;if("mesh"===(null==ve?void 0:ve.type)){const _e={origin:ve.origin,transform:ve.transform};this._notifyLayer("origin-transform",_e,_e,fe.action)}}_notifyLayer(fe,ve,_e,be){if(!this.layer||!("graphicChanged"in this.layer))return;const we={graphic:this,property:fe,oldValue:ve,newValue:_e};"origin-transform"===fe&&(we.action=be),"attributes"===fe&&(we.attributeName=be),this.layer.graphicChanged(we)}_watchMeshGeometryChanges(){this.addHandles([p$4J((()=>{var fe,ve;return"mesh"===(null==(fe=this.geometry)?void 0:fe.type)&&this.geometry.vertexSpace.origin?{localMatrix:null==(ve=this.geometry.transform)?void 0:ve.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0}),(({localMatrix:fe,origin:ve})=>{this._lastMeshTransform.localMatrix===fe&&this._lastMeshTransform.origin===ve||(this._lastMeshTransform.localMatrix=fe,this._lastMeshTransform.origin=ve,this.notifyMeshTransformChanged())})),p$4J((()=>{var fe;return"mesh"===(null==(fe=this.geometry)?void 0:fe.type)?{vertexAttributes:this.geometry.vertexAttributes}:void 0}),(()=>{var fe;const ve=this.geometry;"mesh"===(null==ve?void 0:ve.type)&&ve.vertexSpace.origin?(this._lastMeshTransform.localMatrix=null==(fe=ve.transform)?void 0:fe.localMatrix,this._lastMeshTransform.origin=ve.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)}),{equals:(fe,ve)=>fe===ve,sync:!0})])}};e$4o([y$2v({value:null,json:{read:function c$3l(fe){if(!fe)return null;const ve={};for(const _e in fe){const be=y$2e(fe[_e]);be&&(ve[_e]=be)}return 0!==Object.keys(ve).length?ve:null}}})],MT.prototype,"aggregateGeometries",null),e$4o([y$2v({value:null})],MT.prototype,"attributes",null),e$4o([y$2v({value:null,types:Oa,json:{read:y$2e}})],MT.prototype,"geometry",null),e$4o([y$2v({type:Boolean})],MT.prototype,"isAggregate",void 0),e$4o([y$2v({clonable:"reference"})],MT.prototype,"layer",void 0),e$4o([y$2v({clonable:"reference"})],MT.prototype,"origin",void 0),e$4o([y$2v({type:ew})],MT.prototype,"popupTemplate",void 0),e$4o([y$2v({clonable:"reference"})],MT.prototype,"sourceLayer",void 0),e$4o([y$2v({value:null,types:_T})],MT.prototype,"symbol",null),e$4o([y$2v({type:Boolean,value:!0})],MT.prototype,"visible",null),MT=AT=e$4o([a$4y("esri.Graphic")],MT),(MT||(MT={})).generateUID=e$44;const RT=MT;let IT=class c10 extends $h{_own(fe){fe.layer&&"remove"in fe.layer&&fe.layer!==this.owner&&fe.layer.remove(fe),fe.layer=this.owner}_release(fe){fe.layer===this.owner&&(fe.layer=null)}};e$4o([n$4l({Type:RT,ensureType:b$2d(RT)})],IT.prototype,"itemType",void 0),IT=e$4o([a$4y("esri.support.GraphicsCollection")],IT);let LT=class n9 extends zi{constructor(fe){super(fe),this.view=null,this.baseLayerViews=new Wa,this.referenceLayerViews=new Wa,this._loadingHandle=d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.basemap}),(fe=>{fe&&fe.load().catch((()=>{}))}),Xa)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const fe of this.baseLayerViews)fe.destroy();this.baseLayerViews.length=0;for(const fe of this.referenceLayerViews)fe.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var fe,ve,_e;if(null==(fe=this.view)?void 0:fe.suspended)return!1;const be=null==(_e=null==(ve=this.view)?void 0:ve.map)?void 0:_e.basemap;return!!be&&!!be.loaded&&(this.baseLayerViews.some((fe=>fe.updating))||this.referenceLayerViews.some((fe=>fe.updating)))}};function v$1r(fe){return null!=fe&&"object"==typeof fe&&"layerViews"in fe}e$4o([y$2v({constructOnly:!0})],LT.prototype,"view",void 0),e$4o([y$2v({readOnly:!0})],LT.prototype,"baseLayerViews",void 0),e$4o([y$2v({readOnly:!0})],LT.prototype,"referenceLayerViews",void 0),e$4o([y$2v({readOnly:!0})],LT.prototype,"suspended",null),e$4o([y$2v({type:Boolean,readOnly:!0})],LT.prototype,"updating",null),LT=e$4o([a$4y("esri.views.BasemapView")],LT);let DT=class L{constructor(fe,ve,_e){this.layer=fe,this.view=ve,this.layerViewImporter=_e,this._controller=new AbortController,this._deferred=L$1h(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,m$3R(this._controller.signal,(()=>{const ve=new Ir("cancelled:layerview-create","layerview creation cancelled",{layer:fe});this._deferred.reject(ve)}))}tryRecycle(fe){if(!this.done||!this.layerView||!function V$V(fe){return"tryRecycleWith"in fe}(this.layerView))return null;const ve=this.layer.type,_e=this._controller.signal;for(let be=0;be<fe.length;be++){const we=fe[be];if(we.type!==ve)continue;const Se=this.layerView.tryRecycleWith(we,{signal:_e});if(Se){fe.splice(be,1),this.layer=we;const ve=this.layerView,_e=ve.view;return this.promise=Promise.race([Se.then((()=>(s$4o(this._controller.signal),we.emit("layerview-destroy",{view:_e,layerView:ve}),_e.emit("layerview-destroy",{view:_e,layerView:ve}),we.emit("layerview-create",{view:_e,layerView:ve}),_e.emit("layerview-create",{view:_e,layerView:ve}),ve))),new Promise(((fe,ve)=>m$3R(this._controller.signal,(()=>ve(u$47())))))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:fe}=this;if(fe){const{layer:ve,view:_e}=this;ve.emit("layerview-destroy",{view:_e,layerView:fe}),_e.emit("layerview-destroy",{layer:ve,layerView:fe})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var fe,ve;if(this._started)return;this._started=!0;const{_controller:{signal:_e},layer:be,view:we}=this;this._map=we.map;try{let Se,Te;if(await be.load({signal:_e}),be.prefetchResources&&await be.prefetchResources({signal:_e}),function C$16(fe){return"createLayerView"in fe&&null!=fe.createLayerView}(be))Se=await be.createLayerView(we,{signal:_e});else{if(!this.layerViewImporter.hasLayerViewModule(be))throw new Ir("layer:view-not-supported","No layerview implementation was found");const fe=await this.layerViewImporter.importLayerView(be);s$4o(_e),Se="default"in fe?new fe.default({layer:be,view:we}):new fe({layer:be,view:we})}const n52=()=>{Te=l$4E(Te),Se.destroyed||Se.destroy(),Se.layer=null,Se.parent=null,Se.view=null,this.done=!0};Te=m$3R(_e,n52),s$4o(_e);try{await Se.when()}catch(vv){throw n52(),vv}if(!(null==(ve=null==(fe=this._map)?void 0:fe.allLayers)?void 0:ve.includes(be)))return n52(),void this._deferred.reject(new Ir("view:no-layerview-for-layer","The layer has been removed from the map",{layer:be}));this.layerView=Se,be.emit("layerview-create",{view:we,layerView:Se}),we.emit("layerview-create",{layer:be,layerView:Se}),this.done=!0,this._deferred.resolve(Se)}catch(vv){be.emit("layerview-create-error",{view:we,error:vv}),we.emit("layerview-create-error",{layer:be,error:vv}),this.done=!0,this._deferred.reject(new Ir("layerview:create-error","layerview creation failed",{layer:be,error:vv}))}}},NT=class M extends zi{constructor(fe){super(fe),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Up,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var fe;const ve=null==(fe=this.view.map)?void 0:fe.allLayers;if(ve)for(const _e of ve)this.layerViewImporter.hasLayerViewModule(_e)&&this.layerViewImporter.importLayerView(_e)},this._reschedule=()=>this.destroyed?Promise.reject():(null==this._workPromise&&(this._workPromise=L$1h(),this._workPromise.promise.catch((()=>{}))),this.removeHandles("reschedule"),this.addHandles(v$27(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var fe,ve,_e;if(this.destroyed)return;const be=this.view.map;if(this._map!==be&&(this.clear(),this._map=be),null==this._workPromise)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const we=new Set,Se=[],Te=this.view.ready,s84=fe=>{if(null!=fe)for(const ve of fe)if(ve){we.add(ve);const fe=this._layerLayerViewInfoMap.get(ve);fe&&Te?fe.start():fe||this._recyclingInfoMap.has(ve)||Se.push(ve),"layers"in ve&&ve.layers&&s84(ve.layers)}};for(const Ce of this._rootCollectionNames)s84(o$4m(this,Ce));for(const[Ce,Oe]of this._layerLayerViewInfoMap)if(!we.has(Ce)){this._layerLayerViewInfoMap.delete(Oe.layer);const fe=Oe.tryRecycle(Se);fe?(this.notifyChange("updating"),this._recyclingInfoMap.set(Oe.layer,Oe),fe.then((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(Oe.layer),this._layerLayerViewInfoMap.set(Oe.layer,Oe),this._reschedule()})).catch((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(Oe.layer),Oe.destroy(),this._reschedule()}))):Oe.destroy()}for(const[Ce,Oe]of this._recyclingInfoMap)we.has(Ce)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(Oe.layer),Oe.destroy());for(const Ce of Se)this._createLayerView(Ce);this._refreshCollections();const Ee=[null==(fe=null==be?void 0:be.ground)?void 0:fe.layers,null==(ve=null==be?void 0:be.basemap)?void 0:ve.baseLayers,null==(_e=null==be?void 0:be.basemap)?void 0:_e.referenceLayers,null==be?void 0:be.layers].filter((fe=>!!fe));we.forEach((fe=>"layers"in fe&&Ee.push(fe.layers))),this.addHandles(Ee.map((fe=>this._watchUpdatingTracking.addOnCollectionChange((()=>fe),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([v$1W((()=>{var fe,ve;return null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.allLayers}),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),d$3d((()=>{const fe=this.view,ve=null==fe?void 0:fe.map;return[null==ve?void 0:ve.basemap,null==ve?void 0:ve.ground,null==ve?void 0:ve.layers,null==fe?void 0:fe.ready]}),(()=>this._reschedule()),Ja)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),n$3K(this._recyclingInfoMap),n$3K(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,null!=this._workPromise&&(this._workPromise.reject(u$47()),this._workPromise=null)}get _layersToLayerViews(){const fe=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&fe.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(fe)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return null!=this._workPromise||this._watchUpdatingTracking.updating||n$4E(this._layerLayerViewInfoMap,(fe=>!fe.done))||this._recyclingInfoMap.size>0}get updatingRemaining(){let fe=0;for(const ve of this._layerLayerViewInfoMap.values())ve.done||++fe;return fe}clear(){this.destroyed||(n$3K(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(fe){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(fe)){if(this._recyclingInfoMap.has(fe))return this._recyclingInfoMap.get(fe).promise;throw new Ir("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:fe})}return this._layerLayerViewInfoMap.get(fe).promise}isCreatingLayerViewsForLayer(fe,ve){var _e;this.commitProperty("updatingRemaining");const be=this._layerLayerViewInfoMap.get(fe);if(!(null==be?void 0:be.done))return!0;const we=be.layerView;return!(!we||!ve||we.parent===ve)||!!(be.done&&we&&"layers"in fe&&(null==(_e=fe.layers)?void 0:_e.length))&&fe.layers.some((fe=>this.isCreatingLayerViewsForLayer(fe,we)))}_refreshCollections(){for(const[fe,ve]of this._layersToLayerViews)this._populateLayerViewsOwners(o$4m(this,fe),o$4m(this,ve),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(fe,ve,_e){if(!fe||!ve)return void(ve&&ve.removeAll());let be=0;for(const we of fe){const fe=this._layerLayerViewInfoMap.get(we);if(!(null==fe?void 0:fe.layerView))continue;const Se=fe.layerView;Se.layer=we,Se.parent=_e,ve.at(be)!==Se&&ve.splice(be,0,Se),"layers"in we&&v$1r(Se)&&this._populateLayerViewsOwners(we.layers,Se.layerViews,Se),be+=1}be<ve.length&&ve.splice(be,ve.length)}_createLayerView(fe){fe.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(fe)&&this.layerViewImporter.importLayerView(fe);const ve=new DT(fe,this.view,this.layerViewImporter);ve.promise.then((()=>this._refreshCollections()),(ve=>{ve&&(b$2g(ve)||"cancelled:layerview-create"===ve.name)||ar.getLogger(this).error(`Failed to create layerview for layer title:'${fe.title??"no title"}', id:'${fe.id??"no id"}' of type '${fe.type}'.`,{layer:fe,error:ve}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(fe,ve),this.view.ready&&ve.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};e$4o([y$2v()],NT.prototype,"_workPromise",void 0),e$4o([y$2v({readOnly:!0})],NT.prototype,"_watchUpdatingTracking",void 0),e$4o([y$2v({readOnly:!0})],NT.prototype,"_layersToLayerViews",null),e$4o([y$2v({readOnly:!0})],NT.prototype,"_rootCollectionNames",null),e$4o([y$2v()],NT.prototype,"layerViewImporter",void 0),e$4o([y$2v()],NT.prototype,"supportsGround",void 0),e$4o([y$2v({readOnly:!0})],NT.prototype,"updating",null),e$4o([y$2v({readOnly:!0})],NT.prototype,"updatingRemaining",null),e$4o([y$2v({constructOnly:!0})],NT.prototype,"view",void 0),NT=e$4o([a$4y("esri.views.LayerViewManager")],NT);const FT=NT;let zT=class i9 extends zi{constructor(fe){super(fe),this.factor=1.5,this.offset=c$4u(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};e$4o([y$2v({type:Number})],zT.prototype,"factor",void 0),e$4o([y$2v({nonNullable:!0})],zT.prototype,"offset",void 0),e$4o([y$2v()],zT.prototype,"position",void 0),e$4o([y$2v({type:Number,range:{min:0}})],zT.prototype,"size",void 0),e$4o([y$2v()],zT.prototype,"maskUrl",void 0),e$4o([y$2v()],zT.prototype,"maskEnabled",void 0),e$4o([y$2v()],zT.prototype,"overlayUrl",void 0),e$4o([y$2v()],zT.prototype,"overlayEnabled",void 0),e$4o([y$2v({readOnly:!0})],zT.prototype,"version",null),e$4o([y$2v({type:Boolean})],zT.prototype,"visible",void 0),zT=e$4o([a$4y("esri.views.Magnifier")],zT);const kT=zT;let UT=class s16{constructor(fe){this._observable=new Fa,this._map=new Map(fe)}get size(){return s$4u(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(fe){const ve=this._map.delete(fe);return ve&&this._observable.notify(),ve}entries(){return s$4u(this._observable),this._map.entries()}forEach(fe,ve){s$4u(this._observable),this._map.forEach(((_e,be)=>fe.call(ve,_e,be,this)),ve)}get(fe){return s$4u(this._observable),this._map.get(fe)}has(fe){return s$4u(this._observable),this._map.has(fe)}keys(){return s$4u(this._observable),this._map.keys()}set(fe,ve){return this._map.set(fe,ve),this._observable.notify(),this}values(){return s$4u(this._observable),this._map.values()}[Symbol.iterator](){return s$4u(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var VT;let BT=VT=class extends Pn{constructor(fe){super(fe),this.name=null,this.code=null}clone(){return new VT({name:this.name,code:this.code})}};e$4o([y$2v({type:String,json:{write:!0}})],BT.prototype,"name",void 0),e$4o([y$2v({type:[String,Number],json:{write:!0}})],BT.prototype,"code",void 0),BT=VT=e$4o([a$4y("esri.layers.support.CodedValue")],BT);const jT=new An({inherited:"inherited",codedValue:"coded-value",range:"range"});let GT=class a3 extends Pn{constructor(fe){super(fe),this.name=null,this.type=null}};e$4o([y$2v({type:String,json:{write:!0}})],GT.prototype,"name",void 0),e$4o([o$3g(jT)],GT.prototype,"type",void 0),GT=e$4o([a$4y("esri.layers.support.Domain")],GT);const HT=GT;var qT;let WT=qT=class extends HT{constructor(fe){super(fe),this.codedValues=null,this.type="coded-value"}getName(fe){let ve=null;if(this.codedValues){const _e=String(fe);this.codedValues.some((fe=>(String(fe.code)===_e&&(ve=fe.name),!!ve)))}return ve}clone(){return new qT({codedValues:a$4H(this.codedValues),name:this.name})}};e$4o([y$2v({type:[BT],json:{write:!0}})],WT.prototype,"codedValues",void 0),e$4o([o$3g({codedValue:"coded-value"})],WT.prototype,"type",void 0),WT=qT=e$4o([a$4y("esri.layers.support.CodedValueDomain")],WT);const YT=WT;var ZT;let XT=ZT=class extends HT{constructor(fe){super(fe),this.type="inherited"}clone(){return new ZT}};e$4o([o$3g({inherited:"inherited"})],XT.prototype,"type",void 0),XT=ZT=e$4o([a$4y("esri.layers.support.InheritedDomain")],XT);const JT=XT;var QT;let KT=QT=class extends HT{constructor(fe){super(fe),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new QT({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};e$4o([y$2v({json:{type:[Number],read:{source:"range",reader:(fe,ve)=>{var _e;return null==(_e=ve.range)?void 0:_e[1]}},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(fe,ve,_e){ve[_e]=[this.minValue||0,fe]}}}})],KT.prototype,"maxValue",void 0),e$4o([y$2v({json:{type:[Number],read:{source:"range",reader:(fe,ve)=>{var _e;return null==(_e=ve.range)?void 0:_e[0]}},write:{target:"range",writer(fe,ve,_e){ve[_e]=[fe,this.maxValue||0]}}}})],KT.prototype,"minValue",void 0),e$4o([o$3g({range:"range"})],KT.prototype,"type",void 0),KT=QT=e$4o([a$4y("esri.layers.support.RangeDomain")],KT);const eE=KT,tE={key:"type",base:HT,typeMap:{range:eE,"coded-value":YT,inherited:JT}};function i$3h(fe){if(!(null==fe?void 0:fe.type))return null;switch(fe.type){case"range":return eE.fromJSON(fe);case"codedValue":return YT.fromJSON(fe);case"inherited":return JT.fromJSON(fe)}return null}const rE=new An({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var iE;const nE=new An({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let sE=iE=class extends Pn{constructor(fe){super(fe),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(fe,{description:ve}){let _e=null;try{_e=ve?JSON.parse(ve):null}catch(Dr){}return(null==_e?void 0:_e.value)??null}readValueType(fe,{description:ve}){let _e=null;try{_e=ve?JSON.parse(ve):null}catch(Dr){}return _e?nE.fromJSON(_e.fieldValueType):null}clone(){var fe;return new iE({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:(null==(fe=this.domain)?void 0:fe.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};e$4o([y$2v({type:String,json:{write:!0}})],sE.prototype,"alias",void 0),e$4o([y$2v({type:[String,Number],json:{write:{allowNull:!0}}})],sE.prototype,"defaultValue",void 0),e$4o([y$2v()],sE.prototype,"description",void 0),e$4o([o$40("description")],sE.prototype,"readDescription",null),e$4o([y$2v({types:tE,json:{read:{reader:i$3h},write:!0}})],sE.prototype,"domain",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],sE.prototype,"editable",void 0),e$4o([y$2v({type:Ci,json:{write:{overridePolicy:fe=>({enabled:Number.isFinite(fe)})}}})],sE.prototype,"length",void 0),e$4o([y$2v({type:String,json:{write:!0}})],sE.prototype,"name",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],sE.prototype,"nullable",void 0),e$4o([o$3g(rE)],sE.prototype,"type",void 0),e$4o([y$2v()],sE.prototype,"valueType",void 0),e$4o([o$40("valueType",["description"])],sE.prototype,"readValueType",null),e$4o([y$2v({type:Boolean,json:{read:!1}})],sE.prototype,"visible",void 0),sE=iE=e$4o([a$4y("esri.layers.support.Field")],sE);const oE=sE;var aE;let lE=aE=class extends Pn{constructor(fe){super(fe),this.type="map-layer"}clone(){const{mapLayerId:fe,gdbVersion:ve}=this;return new aE({mapLayerId:fe,gdbVersion:ve})}};var cE;e$4o([o$3g({mapLayer:"map-layer"})],lE.prototype,"type",void 0),e$4o([y$2v({type:Ci,json:{write:!0}})],lE.prototype,"mapLayerId",void 0),e$4o([y$2v({type:String,json:{write:!0}})],lE.prototype,"gdbVersion",void 0),lE=aE=e$4o([a$4y("esri.layers.support.source.MapLayerSource")],lE);let uE=cE=class extends Pn{constructor(fe){super(fe),this.type="query-table"}clone(){const{workspaceId:fe,query:ve,oidFields:_e,spatialReference:be,geometryType:we}=this,Se={workspaceId:fe,query:ve,oidFields:_e,spatialReference:(null==be?void 0:be.clone())??void 0,geometryType:we};return new cE(Se)}};var hE;e$4o([o$3g({queryTable:"query-table"})],uE.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],uE.prototype,"workspaceId",void 0),e$4o([y$2v({type:String,json:{write:!0}})],uE.prototype,"query",void 0),e$4o([y$2v({type:String,json:{write:!0}})],uE.prototype,"oidFields",void 0),e$4o([y$2v({type:zo,json:{write:!0}})],uE.prototype,"spatialReference",void 0),e$4o([o$3g(Ea)],uE.prototype,"geometryType",void 0),uE=cE=e$4o([a$4y("esri.layers.support.source.QueryTableDataSource")],uE);let dE=hE=class extends Pn{constructor(fe){super(fe),this.type="raster"}clone(){const{workspaceId:fe,dataSourceName:ve}=this;return new hE({workspaceId:fe,dataSourceName:ve})}};var pE;e$4o([o$3g({raster:"raster"})],dE.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],dE.prototype,"dataSourceName",void 0),e$4o([y$2v({type:String,json:{write:!0}})],dE.prototype,"workspaceId",void 0),dE=hE=e$4o([a$4y("esri.layers.support.source.RasterDataSource")],dE);let fE=pE=class extends Pn{constructor(fe){super(fe),this.type="table"}clone(){const{workspaceId:fe,gdbVersion:ve,dataSourceName:_e}=this;return new pE({workspaceId:fe,gdbVersion:ve,dataSourceName:_e})}};var mE,yE;e$4o([o$3g({table:"table"})],fE.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fE.prototype,"workspaceId",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fE.prototype,"gdbVersion",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fE.prototype,"dataSourceName",void 0),fE=pE=e$4o([a$4y("esri.layers.support.source.TableDataSource")],fE);const gE=i$4y()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let vE=mE=class extends Pn{constructor(fe){super(fe),this.type="join-table"}readLeftTableSource(fe,ve,_e){return g$1S()(fe,ve,_e)}castLeftTableSource(fe){return T$1p(L$T(),fe)}readRightTableSource(fe,ve,_e){return g$1S()(fe,ve,_e)}castRightTableSource(fe){return T$1p(L$T(),fe)}clone(){const{leftTableKey:fe,rightTableKey:ve,leftTableSource:_e,rightTableSource:be,joinType:we}=this,Se={leftTableKey:fe,rightTableKey:ve,leftTableSource:(null==_e?void 0:_e.clone())??void 0,rightTableSource:(null==be?void 0:be.clone())??void 0,joinType:we};return new mE(Se)}};e$4o([o$3g({joinTable:"join-table"})],vE.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],vE.prototype,"leftTableKey",void 0),e$4o([y$2v({type:String,json:{write:!0}})],vE.prototype,"rightTableKey",void 0),e$4o([y$2v({json:{write:!0}})],vE.prototype,"leftTableSource",void 0),e$4o([o$40("leftTableSource")],vE.prototype,"readLeftTableSource",null),e$4o([s$4b("leftTableSource")],vE.prototype,"castLeftTableSource",null),e$4o([y$2v({json:{write:!0}})],vE.prototype,"rightTableSource",void 0),e$4o([o$40("rightTableSource")],vE.prototype,"readRightTableSource",null),e$4o([s$4b("rightTableSource")],vE.prototype,"castRightTableSource",null),e$4o([o$3g(gE)],vE.prototype,"joinType",void 0),vE=mE=e$4o([a$4y("esri.layers.support.source.JoinTableDataSource")],vE);let _E=null;function g$1S(){return _E||(_E=u$41({types:L$T()})),_E}let $E=null;function L$T(){return $E||($E={key:"type",base:null,typeMap:{"data-layer":wE,"map-layer":lE}}),$E}const bE={key:"type",base:null,typeMap:{"join-table":vE,"query-table":uE,raster:dE,table:fE}};let wE=yE=class extends Pn{constructor(fe){super(fe),this.type="data-layer"}clone(){const{fields:fe,dataSource:ve}=this;return new yE({fields:fe,dataSource:ve})}};e$4o([o$3g({dataLayer:"data-layer"})],wE.prototype,"type",void 0),e$4o([y$2v({type:[oE],json:{write:!0}})],wE.prototype,"fields",void 0),e$4o([y$2v({types:bE,json:{write:!0}})],wE.prototype,"dataSource",void 0),wE=yE=e$4o([a$4y("esri.layers.support.source.DataLayerSource")],wE),wE.from=b$2d(wE);let xE=class p10 extends(i$4F(Pn)){constructor(fe){super(fe),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};e$4o([y$2v({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&this.onFields.length>0}}}}})],xE.prototype,"onFields",void 0),e$4o([y$2v({type:String,json:{write:!0}})],xE.prototype,"operator",void 0),e$4o([y$2v({type:String,json:{write:!0}})],xE.prototype,"searchTerm",void 0),e$4o([y$2v({type:String,json:{write:!0}})],xE.prototype,"searchType",void 0),xE=e$4o([a$4y("esri.rest.support.FullTextSearch")],xE);const SE=xE;var TE;const EE=new An({upperLeft:"upper-left",lowerLeft:"lower-left"});let PE=TE=class extends Pn{constructor(fe){super(fe),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new TE(a$4H({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};e$4o([y$2v({type:aa,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],PE.prototype,"extent",void 0),e$4o([y$2v({type:["view","edit"],json:{write:!0}})],PE.prototype,"mode",void 0),e$4o([y$2v({type:String,json:{read:EE.read,write:EE.write}})],PE.prototype,"originPosition",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],PE.prototype,"tolerance",void 0),PE=TE=e$4o([a$4y("esri.rest.support.QuantizationParameters")],PE);const CE=PE,OE=new An({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var AE;const ME=new An({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let RE=AE=class extends Pn{constructor(fe){super(fe),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(fe,ve){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(ve.statisticParameters=a$4H(fe))}clone(){return new AE({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:a$4H(this.statisticParameters)})}};e$4o([y$2v({type:Number,json:{write:!0}})],RE.prototype,"maxPointCount",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],RE.prototype,"maxRecordCount",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],RE.prototype,"maxVertexCount",void 0),e$4o([y$2v({type:String,json:{write:!0}})],RE.prototype,"onStatisticField",void 0),e$4o([y$2v({type:String,json:{write:!0}})],RE.prototype,"outStatisticFieldName",void 0),e$4o([y$2v({type:String,json:{read:{source:"statisticType",reader:ME.read},write:{target:"statisticType",writer:ME.write}}})],RE.prototype,"statisticType",void 0),e$4o([y$2v({type:Object})],RE.prototype,"statisticParameters",void 0),e$4o([r$3s("statisticParameters")],RE.prototype,"writeStatisticParameters",null),RE=AE=e$4o([a$4y("esri.rest.support.StatisticDefinition")],RE);const IE=RE;var LE;const DE=new An({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let NE=LE=class extends Pn{static from(fe){return g$2C(LE,fe)}constructor(fe){super(fe),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(fe){return"number"==typeof fe||"object"==typeof fe?fe:null}writeHistoricMoment(fe,ve){ve.historicMoment=fe&&fe.getTime()}writeParameterValues(fe,ve){if(fe){const _e={};for(const ve in fe){const be=fe[ve];Array.isArray(be)?_e[ve]=be.map((fe=>fe instanceof Date?fe.getTime():fe)):be instanceof Date?_e[ve]=be.getTime():_e[ve]=be}ve.parameterValues=_e}}writeStart(fe,ve){ve.resultOffset=this.start,ve.resultRecordCount=this.num||10,ve.where="1=1"}writeWhere(fe,ve){ve.where=fe||"1=1"}clone(){return new LE(a$4H({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};NE.MAX_MAX_RECORD_COUNT_FACTOR=5,e$4o([y$2v({json:{write:!0}})],NE.prototype,"aggregateIds",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],NE.prototype,"cacheHint",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"compactGeometryEnabled",void 0),e$4o([y$2v({json:{write:!0}})],NE.prototype,"datumTransformation",void 0),e$4o([s$4b("datumTransformation")],NE.prototype,"castDatumTransformation",null),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"defaultSpatialReferenceEnabled",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy:fe=>({enabled:fe>0})}}})],NE.prototype,"distance",void 0),e$4o([y$2v({type:wE,json:{write:!0}})],NE.prototype,"dynamicDataSource",void 0),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"formatOf3DObjects",void 0),e$4o([y$2v({type:[SE],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&this.fullText.length>0}}}}})],NE.prototype,"fullText",void 0),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"gdbVersion",void 0),e$4o([y$2v({types:Oa,json:{read:y$2e,write:!0}})],NE.prototype,"geometry",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],NE.prototype,"geometryPrecision",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],NE.prototype,"groupByFieldsForStatistics",void 0),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"having",void 0),e$4o([y$2v({type:Date})],NE.prototype,"historicMoment",void 0),e$4o([r$3s("historicMoment")],NE.prototype,"writeHistoricMoment",null),e$4o([y$2v({type:Number,json:{write:!0}})],NE.prototype,"maxAllowableOffset",void 0),e$4o([y$2v({type:Number,cast:fe=>fe<1?1:fe>NE.MAX_MAX_RECORD_COUNT_FACTOR?NE.MAX_MAX_RECORD_COUNT_FACTOR:fe,json:{write:{overridePolicy:fe=>({enabled:fe>1})}}})],NE.prototype,"maxRecordCountFactor",void 0),e$4o([y$2v({type:["xyFootprint"],json:{write:!0}})],NE.prototype,"multipatchOption",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultRecordCount"}}})],NE.prototype,"num",void 0),e$4o([y$2v({json:{write:!0}})],NE.prototype,"objectIds",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],NE.prototype,"orderByFields",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],NE.prototype,"outFields",void 0),e$4o([y$2v({type:zo,json:{name:"outSR",write:!0}})],NE.prototype,"outSpatialReference",void 0),e$4o([y$2v({type:[IE],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],NE.prototype,"outStatistics",void 0),e$4o([y$2v({json:{write:!0}})],NE.prototype,"parameterValues",void 0),e$4o([r$3s("parameterValues")],NE.prototype,"writeParameterValues",null),e$4o([y$2v({type:Yo,json:{write:!0}})],NE.prototype,"pixelSize",void 0),e$4o([y$2v({type:CE,json:{write:!0}})],NE.prototype,"quantizationParameters",void 0),e$4o([y$2v({type:[Object],json:{write:!0}})],NE.prototype,"rangeValues",void 0),e$4o([y$2v({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],NE.prototype,"relationParameter",void 0),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"resultType",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"returnCentroid",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"returnDistinctValues",void 0),e$4o([y$2v({type:Boolean,json:{default:!0,write:!0}})],NE.prototype,"returnExceededLimitFeatures",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],NE.prototype,"returnGeometry",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"returnQueryGeometry",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"returnM",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],NE.prototype,"returnZ",void 0),e$4o([y$2v({type:zo,json:{write:!0}})],NE.prototype,"sourceSpatialReference",void 0),e$4o([o$3g(OE,{ignoreUnknown:!1,name:"spatialRel"})],NE.prototype,"spatialRelationship",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultOffset"}}})],NE.prototype,"start",void 0),e$4o([r$3s("start"),r$3s("num")],NE.prototype,"writeStart",null),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"sqlFormat",void 0),e$4o([y$2v({type:String,json:{write:!0}})],NE.prototype,"text",void 0),e$4o([y$2v({type:j_,json:{write:!0}})],NE.prototype,"timeExtent",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],NE.prototype,"timeReferenceUnknownClient",void 0),e$4o([o$3g(DE,{ignoreUnknown:!1}),y$2v({json:{write:{overridePolicy(fe){return{enabled:!!fe&&null!=this.distance&&this.distance>0}}}}})],NE.prototype,"units",void 0),e$4o([y$2v({type:String,json:{write:{overridePolicy(fe){return{enabled:null!=fe||null!=this.start&&this.start>0}}}}})],NE.prototype,"where",void 0),e$4o([r$3s("where")],NE.prototype,"writeWhere",null),NE=LE=e$4o([a$4y("esri.rest.support.Query")],NE);const FE=NE;function e$37(fe){return!!(null!=fe&&"object"==typeof fe&&"createQuery"in fe&&fe.createQuery&&"on"in fe&&fe.on)}let zE=class y2 extends La.EventedAccessor{constructor(fe){super(fe),this._selectionMap=new UT,this._sources=new Wa,this._trashCan=[],this._layerEditHandles=new Wa,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([d$3d((()=>[this.view,this.showHighlight]),(()=>this._refreshVisualization())),v$1W((()=>this.sources),"change",(fe=>{const ve=this._selectionMap;for(const _e of fe.removed)ve.delete(_e);this._refreshListeners(),this._refreshVisualization()}),{onListenerAdd:()=>this._refreshListeners()})]);const fe=new Wa;this.view.when().then((()=>{this.view.map&&(this.view.map.allLayers.flatten((fe=>"sublayers"in fe&&fe.sublayers?fe.sublayers:null)).forEach((ve=>{(e$37(ve)&&!c$4e(ve)||l$3T(ve))&&fe.add(ve)})),this.sources=fe)}))}destroy(){this._layerEditHandles.drain(l$4E)}get selections(){return Array.from(this._selectionMap.entries()).map((fe=>{const[ve,_e]=fe;return{layer:ve,selection:[..._e.selection]}}))}get count(){let fe=0;for(const ve of this._selectionMap.values())fe+=ve.selection.length;return fe}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(fe){n$4c(fe,this._sources)}async getSelectedFeatures(fe,ve={},_e="layerView"){const{view:be,selections:we}=this,Se=(void 0!==fe?we.filter((ve=>fe.includes(ve.layer))):we).filter((fe=>fe.selection.length>0)).map((async fe=>{const{layer:we,selection:Se}=fe,Te=l$3T(we)?we.parent:we;if(null==Te||!S$1l(Te))return null;if("layer"===_e)return M$13(Te,Se,ve);if(v$1p(Te))return null;const Ee=await be.whenLayerView(Te).catch((()=>null));return Ee?M$13(Ee,Se,ve):null}));return(await Promise.all(Se)).filter((fe=>null!=fe))}updateSelection(fe){const ve=new Map;for(const[we,Se]of this._selectionMap)ve.set(we,[...Se.selection]);let _e=!1;const be=fe.current.concat(fe.added);for(const we of be){const fe=we.sourceLayer,be=we.getObjectId();if(this.sources.includes(fe)&&(e$37(fe)||l$3T(fe))&&null!==be){const we=r$3B(ve,fe,(()=>[]));we.includes(be)||(we.push(be),_e=!0)}}for(const we of fe.removed){const fe=we.sourceLayer,be=we.getObjectId();if(this.sources.includes(fe)&&(e$37(fe)||l$3T(fe))&&null!==be){const we=ve.get(fe),Se=null==we?void 0:we.indexOf(be);void 0!==Se&&Se>=0&&(null==we||we.splice(Se,1),_e=!0)}}if(_e){const{_selectionMap:fe,_trashCan:_e}=this,be=[];for(const[we,Se]of ve){const ve=fe.get(we);void 0!==ve&&_e.push(ve),fe.set(we,{selection:Se}),be.push({layer:we,selection:Se,...g$2J(void 0!==ve?ve.selection:[],Se)})}this._onSelectionChange(be)}}setSelection(fe,ve){this._setSelection(fe,ve)}getSelection(fe){const ve=this._selectionMap.get(fe);return null==ve?void 0:ve.selection}appendToSelection(fe,ve){const _e=this._selectionMap.get(fe),be=void 0!==_e?[..._e.selection]:[];for(const we of ve)be.includes(we)||be.push(we);this._setSelection(fe,be)}removeFromSelection(fe,ve){const _e=this._selectionMap.get(fe);if(!_e)return;const be=[];for(const we of _e.selection)ve.includes(we)||be.push(we);this._setSelection(fe,be)}toggleInSelection(fe,ve){const _e=this._selectionMap.get(fe);if(!_e||0===_e.selection.length)return void this._setSelection(fe,ve);const be=function c$4Y(fe,ve){return i$4L(o$4d(fe,ve),u$44(fe,ve))}(new Set(_e.selection),new Set(ve));this._setSelection(fe,Array.from(be))}clear(){const fe=this._selectionMap.values();this._trashCan.push(...fe);const ve=[];for(const[_e,be]of this._selectionMap.entries())ve.push({layer:_e,added:[],removed:[...be.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(ve)}_onSelectionChange(fe){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:fe})}_refreshVisualization(){var fe;if(null==this.view||null==this.sources)return;for(this._vizTaskId++;this._trashCan.length>0;){const ve=this._trashCan.pop();null==(fe=null==ve?void 0:ve.highlightHandle)||fe.remove()}const{sources:ve,view:_e,_selectionMap:be,showHighlight:we}=this,Se=this._vizTaskId;for(const Te of ve){const fe=be.get(Te),ve=l$3T(Te)?Te.parent:Te;if(null!=ve&&S$1l(ve)){if(v$1p(ve))continue;_e.whenLayerView(ve).then((ve=>{var _e;null==(_e=null==fe?void 0:fe.highlightHandle)||_e.remove(),null!=fe&&we&&Se===this._vizTaskId&&"highlight"in ve&&"function"==typeof ve.highlight&&fe.selection.length>0&&(fe.highlightHandle=ve.highlight(fe.selection,"selection"))})).catch((()=>{var ve;null==(ve=null==fe?void 0:fe.highlightHandle)||ve.remove()}))}}}_refreshListeners(){this._layerEditHandles.drain(l$4E);for(const fe of this.sources){const ve=l$3T(fe)?fe.parent:fe;if(null!=ve&&e$37(ve)){const _e=ve.on("edits",(ve=>{this._handleEditChanges(ve,fe)}));this._layerEditHandles.push(_e)}}}_handleEditChanges(fe,ve){if(void 0!==fe.deletedFeatures&&fe.deletedFeatures.length>0&&this._selectionMap.has(ve)){const _e=fe.deletedFeatures.filter((fe=>null==fe.error)).map((fe=>fe.objectId)).filter(O$1y);this.removeFromSelection(ve,_e)}}_setSelection(fe,ve){if(!this.sources.includes(fe))throw new Error(`Cannot set selection on layer ${fe.title} because it is not in 'sources'`);const _e=this._selectionMap.get(fe);if(void 0===_e||!j$1d(_e,{selection:ve})){void 0!==_e&&this._trashCan.push(_e),this._selectionMap.set(fe,{selection:[...ve]});const be={layer:fe,selection:[...ve],...g$2J(void 0!==_e?_e.selection:[],ve)};this._onSelectionChange([be])}}};e$4o([y$2v({readOnly:!0,nonNullable:!0})],zE.prototype,"selections",null),e$4o([y$2v({readOnly:!0,nonNullable:!0})],zE.prototype,"count",null),e$4o([y$2v({constructOnly:!0,nonNullable:!0})],zE.prototype,"view",void 0),e$4o([y$2v({readOnly:!0,nonNullable:!0})],zE.prototype,"hasSelection",null),e$4o([y$2v()],zE.prototype,"showHighlight",void 0),e$4o([y$2v()],zE.prototype,"sources",null),zE=e$4o([a$4y("esri.views.SelectionManager")],zE);const v$1p=fe=>{var ve;return l$3T(fe)?!0===(null==(ve=fe.parent)?void 0:ve.isTable):fe.isTable},S$1l=fe=>void 0!==(null==fe?void 0:fe.when),j$1d=(fe,ve)=>{if(null==fe&&null==ve)return!0;if(null!=fe&&null==ve||null==fe&&null!=ve)return!1;if(null!=fe&&null!=ve&&null!=fe.selection&&null!=ve.selection){const _e=[...fe.selection],be=[...ve.selection];if(_e.length!==be.length)return!1;_e.sort(),be.sort();for(let fe=0;fe<_e.length;fe++)if(_e[fe]!==be[fe])return!1}return!0},M$13=async(fe,ve,_e={})=>{let be;if((fe=>void 0!==fe.layer)(fe)){const we=fe;be=void 0===we?null:await we.queryFeatures(new FE({..._e,objectIds:ve})).then((ve=>({data:ve,layer:fe.layer})))}else{const we=fe;be=void 0===we?null:await we.queryFeatures(new FE({..._e,objectIds:ve})).then((fe=>({data:fe,layer:we})))}return be},kE=zE;let UE=class p11 extends(i$4F(zi)){constructor(fe){super(fe),this.accentColor=new b_([255,127,0]),this.textColor=new b_([255,255,255])}};e$4o([y$2v({type:b_,nonNullable:!0})],UE.prototype,"accentColor",void 0),e$4o([y$2v({type:b_,nonNullable:!0})],UE.prototype,"textColor",void 0),UE=e$4o([a$4y("esri.views.Theme")],UE);const VE=UE;var BE;!function(fe){fe[fe.Left=0]="Left",fe[fe.Middle=1]="Middle",fe[fe.Right=2]="Right"}(BE||(BE={}));const jE=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],GE={};function s$3f(fe){return!!GE[fe]}jE.forEach((fe=>{GE[fe]=!0}));let HE=class c11{constructor(fe){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=fe,this.inputManager=null}connect(fe){fe&&this.disconnect(),this.inputManager=fe,this._handlers.forEach((({handler:fe,priority:ve},_e)=>{var be;return null==(be=this.inputManager)?void 0:be.installHandlers(_e,[fe],ve)}))}disconnect(){this.inputManager&&this._handlers.forEach(((fe,ve)=>{var _e;return null==(_e=this.inputManager)?void 0:_e.uninstallHandlers(ve)})),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(fe,ve,_e,be){const we=Array.isArray(fe)?fe:fe.split(",");if(!function p$3i(fe){for(const ve of fe)if(!s$3f(ve))return!1;return!0}(we))return we.some(s$3f),null;let Se,Te;Array.isArray(ve)?Te=ve:(Se=ve,Te=[]),"function"==typeof _e?Se=_e:be=_e,be=null!=be?be:pv.DEFAULT;const Ee=this._createUniqueGroupName(),Ce=new qE(this.view,we,Te,Se);this._handlers.set(Ee,{handler:Ce,priority:be});for(const Oe of we){const fe=this._handlerCounts.get(Oe)||0;this._handlerCounts.set(Oe,fe+1)}return this.inputManager&&this.inputManager.installHandlers(Ee,[Ce],be),e$4e((()=>this._removeHandler(Ee,we)))}hasHandler(fe){return!!this._handlerCounts.get(fe)}_removeHandler(fe,ve){if(this._handlers.has(fe)){this._handlers.delete(fe);for(const fe of ve){const ve=this._handlerCounts.get(fe);void 0===ve||(1===ve?this._handlerCounts.delete(fe):this._handlerCounts.set(fe,ve-1))}}this.inputManager&&this.inputManager.uninstallHandlers(fe)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},qE=class l6 extends nv{constructor(fe,ve,_e,be){super(!0),this._latestDragStart=void 0,this.view=fe;for(const we of ve)switch(we){case"click":this.registerIncoming("click",_e,(ve=>be(d$2o(fe,ve))));break;case"double-click":this.registerIncoming("double-click",_e,(ve=>be(g$1Q(fe,ve))));break;case"immediate-click":this.registerIncoming("immediate-click",_e,(ve=>be(y$1D(fe,ve))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",_e,(ve=>be(v$1o(fe,ve))));break;case"hold":this.registerIncoming("hold",_e,(ve=>be(h$22(fe,ve))));break;case"drag":this.registerIncoming("drag",_e,(fe=>{const ve=this._wrapDrag(fe);ve&&be(ve)}));break;case"key-down":this.registerIncoming("key-down",_e,(fe=>be(f$2k(fe))));break;case"key-up":this.registerIncoming("key-up",_e,(fe=>be(k$15(fe))));break;case"pointer-down":this.registerIncoming("pointer-down",_e,(fe=>be(I$1d(fe,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",_e,(fe=>be(I$1d(fe,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",_e,(fe=>be(I$1d(fe,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",_e,(fe=>be(D$W(fe))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",_e,(fe=>be(P$Z(fe))));break;case"pointer-enter":this.registerIncoming("pointer-enter",_e,(fe=>be(I$1d(fe,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",_e,(fe=>be(I$1d(fe,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",_e,(fe=>{be(_$15(fe))}));break;case"focus":this.registerIncoming("focus",_e,(fe=>{be(u$2R(fe))}));break;case"blur":this.registerIncoming("blur",_e,(fe=>{be(m$2w(fe))}))}}_wrapDrag(fe){const ve=fe.data,{x:_e,y:be}=ve.center,{action:we,pointerType:Se,button:Te}=ve;if("start"===we&&(this._latestDragStart=ve),!this._latestDragStart)return;const Ee=ve.pointer.native,Ce=ve.buttons,{cancelable:Oe,timestamp:Re}=fe,De={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return"end"===we&&(this._latestDragStart=void 0),{type:"drag",action:we,x:_e,y:be,origin:De,pointerType:Se,button:Te,buttons:Ce,radius:ve.radius,angle:M$1x(ve.angle),native:Ee,timestamp:Re,cancelable:Oe,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}};function u$2R(fe){return{type:"focus",timestamp:fe.timestamp,native:fe.data.native,cancelable:fe.cancelable,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function m$2w(fe){return{type:"blur",timestamp:fe.timestamp,native:fe.data.native,cancelable:fe.cancelable,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function d$2o(fe,ve){const{pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,eventId:Ce}=ve.data,{cancelable:Oe,timestamp:Re}=ve;return{type:"click",pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,timestamp:Re,screenPoint:c$4u(Se,Te),mapPoint:b$1y(fe,Se,Te),eventId:Ce,cancelable:Oe,stopPropagation:()=>ve.stopPropagation(),async:fe=>ve.async(fe),preventDefault:()=>ve.preventDefault()}}function g$1Q(fe,ve){const{pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,eventId:Ce}=ve.data,{cancelable:Oe,timestamp:Re}=ve;return{type:"double-click",pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,timestamp:Re,mapPoint:b$1y(fe,Se,Te),eventId:Ce,cancelable:Oe,stopPropagation:()=>ve.stopPropagation(),async:fe=>ve.async(fe),preventDefault:()=>ve.preventDefault()}}function y$1D(fe,ve){const{pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,eventId:Ce}=ve.data,Oe=Ee.pointerId,{cancelable:Re,timestamp:De}=ve;return{type:"immediate-click",pointerId:Oe,pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,timestamp:De,mapPoint:b$1y(fe,Se,Te),eventId:Ce,cancelable:Re,stopPropagation:()=>ve.stopPropagation(),async:fe=>ve.async(fe),preventDefault:()=>ve.preventDefault()}}function v$1o(fe,ve){const{pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,eventId:Ce}=ve.data,Oe=Ee.pointerId,{cancelable:Re,timestamp:De}=ve;return{type:"immediate-double-click",pointerId:Oe,pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,timestamp:De,mapPoint:b$1y(fe,Se,Te),eventId:Ce,cancelable:Re,stopPropagation:()=>ve.stopPropagation(),async:fe=>ve.async(fe),preventDefault:()=>ve.preventDefault()}}function h$22(fe,ve){const{pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee}=ve.data,{cancelable:Ce,timestamp:Oe}=ve;return{type:"hold",pointerType:_e,button:be,buttons:we,x:Se,y:Te,native:Ee,timestamp:Oe,mapPoint:b$1y(fe,Se,Te),cancelable:Ce,stopPropagation:()=>ve.stopPropagation(),async:fe=>ve.async(fe),preventDefault:()=>ve.preventDefault()}}function b$1y(fe,ve,_e){return fe.toMap(c$4u(ve,_e),{exclude:[]})}function f$2k(fe){const{key:ve,repeat:_e,native:be}=fe.data,{cancelable:we,timestamp:Se}=fe;return{type:"key-down",key:ve,repeat:_e,native:be,timestamp:Se,cancelable:we,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function k$15(fe){const{key:ve,native:_e}=fe.data,{cancelable:be,timestamp:we}=fe;return{type:"key-up",key:ve,native:_e,timestamp:we,cancelable:be,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function I$1d(fe,ve){const{x:_e,y:be,button:we,buttons:Se,native:Te,eventId:Ee}=fe.data,Ce=Te.pointerId,Oe=Te.pointerType,{cancelable:Re,timestamp:De}=fe;return{type:ve,x:_e,y:be,pointerId:Ce,pointerType:Oe,button:we,buttons:Se,native:Te,timestamp:De,eventId:Ee,cancelable:Re,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function D$W(fe){const{x:ve,y:_e,buttons:be,native:we,eventId:Se}=fe.data.currentEvent,{button:Te}=fe.data.startEvent,Ee=fe.data.startEvent.native.pointerId,Ce=fe.data.startEvent.native.pointerType,Oe=fe.data.action,Re={x:fe.data.startEvent.x,y:fe.data.startEvent.y},{cancelable:De,timestamp:Be}=fe;return{type:"pointer-drag",x:ve,y:_e,pointerId:Ee,pointerType:Ce,button:Te,buttons:be,action:Oe,origin:Re,native:we,timestamp:Be,eventId:Se,cancelable:De,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function P$Z(fe){const{cancelable:ve,data:_e,timestamp:be}=fe,{x:we,y:Se,deltaY:Te,native:Ee}=_e;return{type:"mouse-wheel",x:we,y:Se,deltaY:Te,native:Ee,timestamp:be,cancelable:ve,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}function _$15(fe){const{action:ve,state:_e,device:be}=fe.data,{cancelable:we,timestamp:Se}=fe,{buttons:Te,axes:Ee}=_e;return{type:"gamepad",device:be,timestamp:Se,action:ve,buttons:Te,axes:Ee,cancelable:we,stopPropagation:()=>fe.stopPropagation(),async:ve=>fe.async(ve),preventDefault:()=>fe.preventDefault()}}var WE,YE,ZE;function o$2$(fe){return[fe.on("before-add",(ve=>{const _e=ve.item;if(null==_e||fe.includes(_e))return ar.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void ve.preventDefault();_e.onAdd()})),fe.on("after-remove",(fe=>{const ve=fe.item;ve.active&&(ve.view.activeTool=null),ve.destroy()}))]}function i$3e(fe){return fe.visible&&null!=fe.getEditableFlag&&fe.getEditableFlag(WE.USER)&&fe.getEditableFlag(WE.MANAGER)}function n$3g(fe){return c$4u(fe.x,fe.y)}function c$3c(fe){return i$4i(fe.x,fe.y)}function i$3d(fe,ve){var _e;const be=null==(_e=fe instanceof HTMLElement?fe:fe.surface)?void 0:_e.getBoundingClientRect();return be?c$4u(ve.clientX-be.left,ve.clientY-be.top):c$4u(0,0)}function r$2H(fe,ve){return ve instanceof Event?i$3d(fe,ve):n$3g(ve)}function o$2_(fe){if(fe instanceof Event)return!0;if("object"==typeof fe&&"type"in fe)switch(fe.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}!function(fe){fe[fe.USER=0]="USER",fe[fe.MANAGER=1]="MANAGER"}(WE||(WE={})),function(fe){fe[fe.None=0]="None",fe[fe.Unfocused=1]="Unfocused",fe[fe.Focused=2]="Focused",fe[fe.Unselected=4]="Unselected",fe[fe.Selected=8]="Selected",fe[fe.All=15]="All"}(YE||(YE={})),function(fe){fe[fe.None=0]="None",fe[fe.Custom1=16]="Custom1",fe[fe.Custom2=32]="Custom2",fe[fe.Custom3=64]="Custom3",fe[fe.Custom4=128]="Custom4",fe[fe.Custom5=256]="Custom5",fe[fe.Custom6=512]="Custom6",fe[fe.Custom7=1024]="Custom7",fe[fe.Custom8=2048]="Custom8",fe[fe.Custom9=4096]="Custom9",fe[fe.Custom10=8192]="Custom10",fe[fe.Custom11=16384]="Custom11",fe[fe.Custom12=32768]="Custom12",fe[fe.All=65520]="All"}(ZE||(ZE={}));let XE=class n10{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(fe,ve){const a55=()=>fe.stopPropagation();switch(fe.type){case"pointer-move":p$3h(fe.pointerType)&&this._pointerLocations.set(fe.pointerId,{x:fe.x,y:fe.y,pointerType:fe.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(a55(),"end"===fe.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!u$2P(fe))break;const _e=n$3g(fe),be=l$37(_e,fe.pointerType,ve.forEachTool);if(null==be)break;const we=be.manipulator,Se=be.tool;null==we||null==Se||!we.interactive||we.grabbable&&we.grabbableForEvent(fe)||!we.grabbing||we.dragging||this._releaseManipulatorBeforeDragging(we,fe,ve),null!=we&&null!=Se&&we.interactive&&we.grabbable&&we.grabbableForEvent(fe)&&!we.grabbing&&(this._grabbedManipulators.set(fe.pointerId,{manipulator:we,tool:Se,start:_e,pointerType:fe.pointerType}),1===this._grabbedManipulators.size&&null==ve.activeTool&&(this._revertToNullActiveTool=!0,ve.setActiveTool(be.tool)),we.grabbing=!0,we.events.emit("grab-changed",{action:"start",pointerType:fe.pointerType,screenPoint:_e}),a55());break}case"pointer-up":this._draggedManipulators.has(fe.pointerId)||this._handlePointerEnd(fe,ve);break;case"pointer-drag":{if(!u$2P(fe))break;const _e=this._grabbedManipulators.get(fe.pointerId),be=null==_e?void 0:_e.manipulator,we=null==_e?void 0:_e.tool;if(null==be||null==we)break;const Se=n$3g(fe);Se.x=e$3Y(Se.x,0,ve.view.width),Se.y=e$3Y(Se.y,0,ve.view.height);const Te=_e.start,Ee=this._draggedManipulators.get(fe.pointerId);switch(fe.action){case"start":case"update":"update"!==fe.action&&1!==this._grabbedManipulators.size||(be.dragging=!0,Ee?be.events.emit("drag",{action:"update",start:Te,screenPoint:Se}):be.events.emit("drag",{action:"start",start:Te,screenPoint:Se,pointerType:fe.pointerType}),this._draggedManipulators.set(fe.pointerId,{tool:we,manipulator:be,start:Te}));break;case"end":be.dragging=!1,Ee&&be.events.emit("drag",{action:"end",start:Te,screenPoint:Se}),this._draggedManipulators.delete(fe.pointerId),this._handlePointerEnd(fe,ve)}a55();break}case"immediate-click":{const _e=n$3g(fe),be=l$37(_e,fe.pointerType,ve.forEachTool);if(function c$3b(fe){return!!fe.native.shiftKey}(fe)||ve.forEachTool((fe=>{if((null==be||be.tool!==fe||fe.automaticManipulatorSelection)&&fe.manipulators){let ve=!1;fe.manipulators.forEach((({manipulator:fe})=>{fe.selected&&(fe.selected=!1,ve=!0)})),ve&&fe.onManipulatorSelectionChanged&&fe.onManipulatorSelectionChanged()}})),null==be)break;const{manipulator:we,tool:Se}=be;if(!we.interactive)break;we.selectable&&Se.automaticManipulatorSelection&&(we.selected=!we.selected,Se.onManipulatorSelectionChanged&&Se.onManipulatorSelectionChanged());const Te=fe.native.shiftKey;we.events.emit("immediate-click",{screenPoint:_e,button:fe.button,pointerType:fe.pointerType,shiftKey:Te,stopPropagation:a55}),d$2n(we,a55);break}case"click":{const _e=n$3g(fe),be=l$37(_e,fe.pointerType,ve.forEachTool),we=null==be?void 0:be.manipulator;if(null==we||!we.interactive)break;const Se=fe.native.shiftKey;we.events.emit(fe.type,{screenPoint:_e,button:fe.button,pointerType:fe.pointerType,shiftKey:Se}),a55();break}case"double-click":{const _e=n$3g(fe),be=l$37(_e,fe.pointerType,ve.forEachTool),we=null!=be?be.manipulator:null;if(null==we||!we.interactive)break;const Se=fe.native.shiftKey;we.events.emit("double-click",{screenPoint:_e,button:fe.button,pointerType:fe.pointerType,shiftKey:Se,stopPropagation:a55}),d$2n(we,a55);break}case"immediate-double-click":{const _e=n$3g(fe),be=l$37(_e,fe.pointerType,ve.forEachTool),we=null!=be?be.manipulator:null;if(null==we||!we.interactive)break;const Se=fe.native.shiftKey;we.events.emit("immediate-double-click",{screenPoint:_e,button:fe.button,pointerType:fe.pointerType,shiftKey:Se,stopPropagation:a55}),d$2n(we,a55);break}}this._onFocusChange(ve.forEachTool)}_releaseManipulatorBeforeDragging(fe,ve,_e){fe.grabbing=!1,fe.events.emit("grab-changed",{action:"end",pointerType:ve.pointerType,screenPoint:n$3g(ve)}),this._grabbedManipulators.forEach((({manipulator:ve},_e)=>{ve===fe&&this._grabbedManipulators.delete(_e)})),this._afterManipulatorRelease(_e.setActiveTool)}_handlePointerEnd(fe,ve){var _e;const be=null==(_e=this._grabbedManipulators.get(fe.pointerId))?void 0:_e.manipulator;null!=be&&be.grabbing&&(be.grabbing=!1,be.events.emit("grab-changed",{action:"end",pointerType:fe.pointerType,screenPoint:n$3g(fe)}),this._grabbedManipulators.delete(fe.pointerId),this._afterManipulatorRelease(ve.setActiveTool))}_onFocusChange(fe){this._updateCursor(),this._updateFocusedManipulatorTools(fe)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=s$3e(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=s$3e(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(fe){const ve=new Set,_e=new Set;this._grabbedManipulators.forEach((({tool:fe})=>{ve.add(fe)})),this._hoveredManipulators.forEach((({tool:fe})=>{_e.add(fe)})),fe((fe=>{fe.hasGrabbedManipulators=ve.has(fe),fe.hasHoveredManipulators=_e.has(fe);const be=o$4x(this._grabbedManipulators.values(),(({tool:ve})=>ve===fe));fe.firstGrabbedManipulator=null!=be?be.manipulator:null}))}clearPointers(fe,{forEachTool:ve,setActiveTool:_e},be=!0,we){const r65=(ve,_e)=>ve===fe&&(null==we||we===_e);this._grabbedManipulators.forEach((({tool:fe,manipulator:ve,pointerType:_e},be)=>{r65(fe,ve)&&(this._grabbedManipulators.delete(be),ve.grabbing=!1,ve.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:_e}))})),this._draggedManipulators.forEach((({tool:fe,manipulator:ve},_e)=>{r65(fe,ve)&&(this._draggedManipulators.delete(_e),ve.dragging=!1,ve.events.emit("drag",{action:"cancel"}))})),be&&this._hoveredManipulators.forEach((({tool:fe,manipulator:ve},_e)=>{r65(fe,ve)&&(this._hoveredManipulators.delete(_e),ve.hovering=!1)})),this._afterManipulatorRelease(_e),this._onFocusChange(ve)}updateHoveredStateFromKnownPointers(fe){this._pointerLocations.forEach(((ve,_e)=>{this._updateHoveredStateForPointerAtScreenPosition(c$4u(ve.x,ve.y),_e,ve.pointerType,fe)}))}handleHoverEvent(fe,ve){"pointer-up"!==fe.type&&"immediate-click"!==fe.type&&"pointer-move"!==fe.type||!p$3h(fe.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(n$3g(fe),fe.pointerId,fe.pointerType,ve)}_updateHoveredStateForPointerAtScreenPosition(fe,ve,_e,be){var we;let Se=l$37(fe,_e,be);const Te=null==(we=this._hoveredManipulators.get(ve))?void 0:we.manipulator;null==Se||Se.manipulator.interactive||(Se=null),null!=Se&&Te===Se.manipulator||(null!=Te&&(Te.hovering=!1),null!=Se?(Se.manipulator.hovering=!0,this._hoveredManipulators.set(ve,Se)):this._hoveredManipulators.delete(ve),this._onFocusChange(be))}_afterManipulatorRelease(fe){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(fe(null),this._revertToNullActiveTool=!1)}};function s$3e(fe){let ve=null;return n$4E(fe,(({manipulator:fe})=>!(null==fe||!fe.interactive||(fe.grabbing&&fe.grabCursor?(ve=fe.grabCursor,0):!fe.cursor||(ve=fe.cursor,0))))),ve}function l$37(fe,ve,_e){let be=null;return _e((_e=>{if(null==_e.manipulators||!i$3e(_e))return!1;const we=_e.manipulators.intersect(fe,ve);return null!=we&&(be={tool:_e,manipulator:we},!0)})),be}function p$3h(fe){return"mouse"===fe}function u$2P(fe){return"mouse"!==fe.pointerType||0===fe.button}function d$2n(fe,ve){(null==fe?void 0:fe.consumesClicks)&&ve()}const JE="attached",QE="tools";let KE=class f4 extends zi{constructor(fe){super(fe),this._updatingHandles=new Up,this._clock=Gr,this._manipulatorState=new XE,this.tools=new Wa,this.cursor=null,this._interacting=!1,this._interactingTimeout=1e3,this._interactingTimeoutHandle=null,this._forEachTool=fe=>{for(const ve of this.tools.items)if(fe(ve))return}}initialize(){this.addHandles([this.view.on(jE,(fe=>{this._handleInputEvent(fe)}),pv.TOOL),...o$2$(this.tools),this.tools.on("before-add",(({item:fe})=>{this._updateToolEditableFlag(fe)})),this.tools.on("before-remove",(({item:fe})=>{this._manipulatorState.clearPointers(fe,this._manipulatorStateEventArgs),this._updateCursor()})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.activeTool=null,this.tools.drain((fe=>fe.destroy())),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:fe=>{this.activeTool=fe},view:this.view}}set activeTool(fe){if(null!=fe&&!this.view.ready)return void ar.getLogger(this).error("Cannot set active tool while view is not ready.");if(fe===this.activeTool)return;const ve=this.activeTool;this._set("activeTool",fe),null!=ve&&ve.deactivate(),null!=fe&&fe.activate(),this._removeIncompleteTools(fe);for(const _e of this.tools){this._updateToolEditableFlag(_e);const fe=i$3e(_e);null!=this.activeTool&&fe||this._manipulatorState.clearPointers(_e,this._manipulatorStateEventArgs,!fe)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some((fe=>fe.updating))}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=l$4E(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout((()=>this._interacting=!1),this._interactingTimeout)}attach(){var fe;"3d"===this.view.type?this.addHandles([d$3d((()=>{const{state:fe}=this.view;return"camera"in fe&&fe.camera}),(()=>this._forEachManipulator((fe=>fe.onViewChange())))),null==(fe=this.view.elevationProvider)?void 0:fe.on("elevation-change",(fe=>this._forEachManipulator((ve=>ve.onElevationChange(fe)))))],JE):this.addHandles(d$3d((()=>this.view.extent),(()=>this._forEachManipulator((fe=>fe.onViewChange())))))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(JE),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(fe){this._forEachTool((ve=>{ve.manipulators&&ve.manipulators.forEach((({manipulator:_e})=>fe(_e,ve)))}))}_handleInputEvent(fe){let ve=!1;const _e={...fe,stopPropagation:()=>{ve=!0,fe.stopPropagation()}};null!=this.activeTool?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(_e):this._forEachTool((fe=>{!ve&&fe.visible&&fe.handleInputEvent(_e)})),!ve&&"key-down"===fe.type&&"Escape"===fe.key&&this.activeTool&&(fe.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(_e,this._manipulatorStateEventArgs),ve||null==this.activeTool||this.activeTool.handleInputEventAfter(_e),this._manipulatorState.handleHoverEvent(_e,this._forEachTool),this._updateCursor(),"pointer-move"===fe.type&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(QE),this._forEachTool((fe=>{if(fe instanceof zi){const ve=d$3d((()=>[fe.cursor,fe.visible,fe.editable]),(()=>{i$3e(fe)||this._manipulatorState.clearPointers(fe,this._manipulatorStateEventArgs),this._updateCursor()}));this.addHandles(ve,QE)}fe.manipulators&&this.addHandles([fe.manipulators.on("after-remove",(ve=>{this._manipulatorState.clearPointers(fe,this._manipulatorStateEventArgs,!0,ve.item.manipulator)})),fe.manipulators.on("change",(()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}))],QE)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(fe){var ve;null==(ve=fe.setEditableFlag)||ve.call(fe,WE.MANAGER,null==this.activeTool||fe===this.activeTool)}_updateCursor(){let fe=this._manipulatorState.cursor;null==fe&&this._forEachTool((ve=>!(null==ve.cursor||!ve.visible||(fe=ve.cursor,0)))),this._get("cursor")!==fe&&this._set("cursor",fe)}_removeIncompleteTools(fe){this.tools.filter((ve=>(null==fe||ve!==fe)&&!ve.created&&ve.removeIncompleteOnCancel)).forEach((fe=>{this.tools.remove(fe)}))}get test(){}};e$4o([y$2v({constructOnly:!0,nonNullable:!0})],KE.prototype,"view",void 0),e$4o([y$2v({value:null})],KE.prototype,"activeTool",null),e$4o([y$2v({readOnly:!0,type:Wa})],KE.prototype,"tools",void 0),e$4o([y$2v({readOnly:!0})],KE.prototype,"cursor",void 0),e$4o([y$2v({readOnly:!0})],KE.prototype,"updating",null),e$4o([y$2v()],KE.prototype,"_interacting",void 0),e$4o([y$2v({readOnly:!0})],KE.prototype,"interacting",null),KE=e$4o([a$4y("esri.views.ToolViewManager")],KE);let eP=class n11 extends zi{constructor(fe){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===fe.mapping?this._detectedDeviceType="standard":rP.test(fe.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=fe.index}get native(){const fe=navigator.getGamepads?navigator.getGamepads():[];return null!=this.nativeIndex&&this.nativeIndex<fe.length?fe[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return iP[this.deviceType]}};e$4o([y$2v({nonNullable:!0,readOnly:!0})],eP.prototype,"nativeIndex",void 0),e$4o([y$2v({type:String,readOnly:!0})],eP.prototype,"deviceType",null),e$4o([y$2v({type:Number,readOnly:!0})],eP.prototype,"axisThreshold",null),eP=e$4o([a$4y("esri.views.input.gamepad.GamepadInputDevice")],eP);const tP=eP,rP=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),iP={standard:.15,spacemouse:.025,unknown:0};let nP=class p12 extends zi{constructor(...fe){super(...fe),this.devices=new Wa,this.enabledFocusMode="document"}};e$4o([y$2v({type:Wa.ofType(tP),readOnly:!0})],nP.prototype,"devices",void 0),e$4o([y$2v({type:["document","view","none"]})],nP.prototype,"enabledFocusMode",void 0),nP=e$4o([a$4y("esri.views.input.gamepad.GamepadSettings")],nP);const sP=nP;let oP=class p13 extends zi{constructor(){super(...arguments),this.gamepad=new sP}};e$4o([y$2v({readOnly:!0})],oP.prototype,"gamepad",void 0),oP=e$4o([a$4y("esri.views.input.Input")],oP);const aP=oP,o$2Y=()=>ir.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let lP=class s17 extends zi{constructor(fe){super(fe),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};e$4o([y$2v({type:Boolean,nonNullable:!0})],lP.prototype,"enabled",void 0),e$4o([y$2v({type:tP})],lP.prototype,"device",void 0),e$4o([y$2v({type:["pan","zoom"],nonNullable:!0})],lP.prototype,"mode",void 0),e$4o([y$2v({type:["forward-down","forward-up"],nonNullable:!0})],lP.prototype,"tiltDirection",void 0),e$4o([y$2v({type:Number,nonNullable:!0})],lP.prototype,"velocityFactor",void 0),lP=e$4o([a$4y("esri.views.navigation.gamepad.GamepadSettings")],lP);const cP=lP;let uP=class m8 extends zi{constructor(fe){super(fe),this.browserTouchPanEnabled=!0,this.gamepad=new cP,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!o$2Y()}};e$4o([y$2v({type:Boolean})],uP.prototype,"browserTouchPanEnabled",void 0),e$4o([y$2v({type:cP,nonNullable:!0})],uP.prototype,"gamepad",void 0),e$4o([y$2v({type:Boolean})],uP.prototype,"momentumEnabled",void 0),e$4o([y$2v({type:Boolean})],uP.prototype,"mouseWheelZoomEnabled",void 0),uP=e$4o([a$4y("esri.views.navigation.Navigation")],uP);const hP=uP,dP={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},pP=Object.values(dP),fP=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${pP.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),mP=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${pP.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),yP=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function p$3d(fe){return fP.test(fe)}function d$2m(fe){if(null==fe)return null;const ve=I$1E(fe),_e=(null==ve?void 0:ve.path.match(fP))||(null==ve?void 0:ve.path.match(mP));if(!_e)return null;const[,be,we,Se,Te]=_e,Ee=we.indexOf("/");return{title:m$2u(-1!==Ee?we.slice(Ee+1):we),serverType:dP[Se.toLowerCase()],sublayer:null!=Te&&""!==Te?parseInt(Te,10):null,url:{path:be}}}function h$21(fe){const ve=I$1E(fe).path.match(yP);return ve?{serviceUrl:ve[1],sublayerId:Number(ve[2])}:null}function m$2u(fe){return(fe=fe.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+fe.slice(1)}function w$1n(fe,ve){const _e=[];if(fe){const ve=d$2m(fe);null!=ve&&ve.title&&_e.push(ve.title)}if(ve){const fe=m$2u(ve);_e.push(fe)}if(2===_e.length){if(_e[0].toLowerCase().includes(_e[1].toLowerCase()))return _e[0];if(_e[1].toLowerCase().includes(_e[0].toLowerCase()))return _e[1]}return _e.join(" - ")}function g$1O(fe){let ve=X$B(fe,!0);return!!ve&&(ve=ve.toLowerCase(),ve.endsWith(".arcgis.com")&&(ve.startsWith("services")||ve.startsWith("tiles")||ve.startsWith("features")))}function y$1C(fe,ve){return fe?qt$3(St$4(fe,ve)):fe}function S$1k(fe){let{url:ve}=fe;if(!ve)return{url:ve};ve=St$4(ve,fe.logger);const _e=I$1E(ve),be=d$2m(_e.path);let we;if(null!=be)null!=be.sublayer&&null==fe.layer.layerId&&(we=be.sublayer),ve=be.url.path;else if(fe.nonStandardUrlAllowed){const fe=h$21(_e.path);null!=fe&&(ve=fe.serviceUrl,we=fe.sublayerId)}return{url:qt$3(ve),layerId:we}}function C$15(fe,ve,_e,be,we){f$2v(ve,be,"url",we),be.url&&null!=fe.layerId&&(be.url=V$19(be.url,_e,fe.layerId.toString()))}function b$1x(fe){if(!fe)return!1;const ve=fe.toLowerCase(),_e=ve.includes("/services/"),be=ve.includes("/mapserver/wmsserver"),we=ve.includes("/imageserver/wmsserver"),Se=ve.includes("/wmsserver");return _e&&(be||we||Se)}function a$3d(fe,ve,_e){const be=l$36(fe),we=ve,Se=function o$2W(fe,ve,_e){if(!s$3c(fe)||!s$3c(ve))return gP.Unsupported;if(null==fe||null==ve)return gP.Ok;if(!_e&&fe.heightUnit!==ve.heightUnit)return gP.Units;if(fe.heightModel!==ve.heightModel)return gP.HeightModel;switch(fe.heightModel){case"gravity-related-height":return gP.Ok;case"ellipsoidal":return fe.vertCRS===ve.vertCRS?gP.Ok:gP.CRS;default:return gP.Unsupported}}(be,we,_e);if(be){const ve=Eh.deriveUnitFromSR(be,fe.spatialReference).heightUnit;if(!_e&&ve!==be.heightUnit){const fe=new Ir("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${ve})`,{horizontalUnit:ve});return new Ir("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:be,error:fe})}}if(!function c$39(fe){return"heightModelInfo"in fe&&null!=fe.heightModelInfo||null!=fe.spatialReference||!d$2l(fe)}(fe)||Se===gP.Unsupported)return new Ir("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:be});switch(Se){case gP.Units:{const fe=(null==be?void 0:be.heightUnit)||"unknown",ve=(null==we?void 0:we.heightUnit)||"unknown",_e=new Ir("layerview:incompatible-height-unit",`The vertical units of the layer (${fe}) must match the vertical units of the scene (${ve})`,{layerUnit:fe,sceneUnit:ve});return new Ir("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:be,sceneHeightModelInfo:we,error:_e})}case gP.HeightModel:{const fe=(null==be?void 0:be.heightModel)||"unknown",ve=(null==we?void 0:we.heightModel)||"unknown",_e=new Ir("layerview:incompatible-height-model",`The height model of the layer (${fe}) must match the height model of the scene (${ve})`,{layerHeightModel:fe,sceneHeightModel:ve});return new Ir("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:be,sceneHeightModelInfo:we,error:_e})}case gP.CRS:{const fe=(null==be?void 0:be.vertCRS)||"unknown",ve=(null==we?void 0:we.vertCRS)||"unknown",_e=new Ir("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${fe}) must match the vertical datum of the scene (${ve})`,{layerDatum:fe,sceneDatum:ve});return new Ir("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:be,sceneHeightModelInfo:we,error:_e})}}return null}var gP;function s$3c(fe){return null==fe||null!=fe.heightModel&&null!=fe.heightUnit}function l$36(fe){var ve;if("integrated-mesh-3dtiles"===fe.type)return null;const _e=fe.url?d$2m(fe.url):void 0;return(null!=(null==(ve=fe.spatialReference)?void 0:ve.vcsWkid)||null==_e||"ImageServer"!==_e.serverType)&&h$20(fe)&&fe.heightModelInfo?fe.heightModelInfo:d$2l(fe)?Eh.deriveUnitFromSR(vP,fe.spatialReference):null}function h$20(fe){return"heightModelInfo"in fe}function u$2O(fe){if("unknown"===fe.type||!("capabilities"in fe))return!1;switch(fe.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function d$2l(fe){return u$2O(fe)?!!(fe.capabilities&&fe.capabilities.data&&fe.capabilities.data.supportsZ):f$2h(fe)}function g$1N(fe){return null!=fe.layers||f$2h(fe)||u$2O(fe)||h$20(fe)}function f$2h(fe){switch(fe.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}!function(fe){fe[fe.Ok=0]="Ok",fe[fe.Units=1]="Units",fe[fe.HeightModel=2]="HeightModel",fe[fe.CRS=3]="CRS",fe[fe.Unsupported=4]="Unsupported"}(gP||(gP={}));const vP=new Eh({heightModel:"gravity-related-height"});let _P,$P=null;async function c$38(fe){$P||($P=zt((()=>Promise.resolve().then((()=>Hle))),void 0).then((fe=>_P=fe))),await $P,s$4o(fe)}async function p$3b(fe,ve,_e,be){if(!fe)return null;const we=fe.spatialReference;return _$1p()||J$G(we,ve)?K$D(fe,ve):_P?_P.projectGeometry(fe,ve,_e,be):(await Promise.race([c$38(be),W$J(be)]),p$3b(fe,ve,_e,be))}let bP=class d6 extends zi{constructor(fe){super(fe),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=e$4f(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return null==this.userSpatialReference||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var fe,ve,_e,be;const we=null==(fe=this.map)?void 0:fe.call(this),Se=[];return null!=this.priorityCollection&&Se.push(this.priorityCollection),Se.push({parent:null==we?void 0:we.basemap,layers:null==(ve=null==we?void 0:we.basemap)?void 0:ve.baseLayers},{layers:null==we?void 0:we.layers},{parent:null==we?void 0:we.ground,layers:null==(_e=null==we?void 0:we.ground)?void 0:_e.layers},{parent:null==we?void 0:we.basemap,layers:null==(be=null==we?void 0:we.basemap)?void 0:be.referenceLayers}),Se}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:fe,updating:ve}=this._allLayers;let _e=null;for(const we of fe){const fe=this._getSupportedSpatialReferences(we);if(fe.length>0){const ve=this._narrowDownSpatialReferenceCandidates(_e,fe);null!=ve&&(_e=ve)}if(null!=_e&&1===_e.length)break}if(ve&&(null==_e||1!==_e.length))return{updating:!0};const be=this._pickSpatialReferenceCandidate(_e);return{spatialReference:(null==be?void 0:be.spatialReference)??null,viewingMode:(null==be?void 0:be.viewingMode)??null,updating:!1}}get _tileInfoTask(){var fe,ve,_e,be,we,Se,Te;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:Ee,updating:Ce}=this._collectLayers([{parent:null==(ve=null==(fe=this.map)?void 0:fe.call(this))?void 0:ve.basemap,layers:null==(we=null==(be=null==(_e=this.map)?void 0:_e.call(this))?void 0:be.basemap)?void 0:we.baseLayers},{layers:null==(Te=null==(Se=this.map)?void 0:Se.call(this))?void 0:Te.layers}]);if(Ee&&Ee.length>0&&"tileInfo"in Ee[0]){const fe=Ee[0].tileInfo;return{tileInfo:(null==fe?void 0:fe.spatialReference.equals(this.spatialReference))?fe:null,updating:!1}}return{updating:Ce}}get _heightModelInfoTask(){var fe,ve,_e;if(!this.required.heightModelInfo||this.suspended&&(null==(fe=this._get("_heightModelInfoTask"))?void 0:fe.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:be,updating:we}=this._allLayers;for(const Se of be)if(g$1N(Se)){const fe=l$36(Se);if(fe)return{heightModelInfo:fe,vcsWkid:null==(ve=Se.spatialReference)?void 0:ve.vcsWkid,latestVcsWkid:null==(_e=Se.spatialReference)?void 0:_e.latestVcsWkid,updating:!1}}return{updating:we}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const fe=this._allLayers,ve=fe.updating,_e=[];for(const be of fe.layers){const fe="fullExtents"in be&&be.fullExtents||(null!=be.fullExtent?[be.fullExtent]:[]),ve=this.requiresExtentInSpatialReference?null:fe[0],we=fe.find((fe=>fe.spatialReference.equals(this.spatialReference)))??ve;if(we)return{candidates:[{extent:we,layer:be}],updating:!1};if(this._getSupportedSpatialReferences(be).length>0)for(const Se of fe)_e.push({extent:Se,layer:be})}return{candidates:_e,updating:ve}}get _extentTask(){const{candidates:fe,updating:ve}=this._extentCandidatesTask;if(ve)return{updating:ve};if(null==fe||0===fe.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const _e=this._pickExtentCandidate(fe),be=this.spatialReference;return _e.extent.equals(this._projectExtentTask.input)&&be.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:null!=this._projectExtentTask.task&&!this._projectExtentTask.task.finished}:(null!=this._projectExtentTask.task&&(this._projectExtentTask.task=e$4f(this._projectExtentTask.task)),this._projectExtentTask={input:_e.extent.clone(),output:null,spatialReference:be.clone(),task:d$3e((async fe=>{try{const ve=await p$3b(_e.extent,be,"portalItem"in _e.layer?_e.layer.portalItem:void 0,fe);this._projectExtentTask={...this._projectExtentTask,task:null,output:ve}}catch(ve){if(c$4_(fe))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(fe,ve){if(null==fe)return ve;const _e=new Array;for(const be of fe)for(const fe of ve){if(!be.spatialReference.equals(fe.spatialReference))continue;const ve=h$1$(be.viewingMode,fe.viewingMode);if(!1!==ve){_e.push({spatialReference:be.spatialReference,viewingMode:ve});break}}return _e.length>0?_e:null}_pickSpatialReferenceCandidate(fe){const ve=this.defaultSpatialReference;return null==fe||fe.length<1?ve?{spatialReference:ve,viewingMode:null}:null:(null!=ve&&fe.length>1&&fe.some((({spatialReference:fe})=>fe.equals(ve)))&&(fe=fe.filter((({spatialReference:fe})=>fe.equals(ve)))),fe.length>1&&fe.some((({viewingMode:fe})=>fe!==Wf.Local))&&(fe=fe.filter((({viewingMode:fe})=>fe!==Wf.Local))),fe[0])}_getSupportedSpatialReferences(fe){const ve="supportedSpatialReferences"in fe&&fe.supportedSpatialReferences||(fe.spatialReference?[fe.spatialReference]:[]);if(0===ve.length)return[];const _e=[];for(const be of ve){const ve=this.getSpatialReferenceSupport(be,fe);if(null!=ve){const fe=ve.constraints??[{spatialReference:be,viewingMode:null}];for(const{spatialReference:ve,viewingMode:be}of fe)this.requiresExtentInSpatialReference&&null!=this.userSpatialReference&&!ve.equals(this.userSpatialReference)||_e.push({spatialReference:ve,viewingMode:be})}}return _e}_pickExtentCandidate(fe){const ve=this.spatialReference;return fe.find((({extent:fe})=>ve.equals(fe.spatialReference)))||fe[0]}_collectLayers(fe){var ve;if("loaded"!==this._loadMaybe(null==(ve=this.map)?void 0:ve.call(this)))return{layers:[],updating:!0};const _e=new wP;for(const be of fe)if(this._collectCollection(be,_e),_e.preloading===this.sourcePreloadCount)break;return{layers:_e.layers,updating:_e.updating}}_collectCollection(fe,ve){if(fe.layers){switch(this._loadMaybe(fe.parent)){case"loading":return ve.updating=!0,void++ve.preloading;case"failed":return}for(const _e of fe.layers){switch(this._loadMaybe(_e)){case"failed":continue;case"loading":ve.updating=!0,++ve.preloading;break;case"loaded":ve.updating||ve.layers.push(_e),"layers"in _e&&this._collectCollection({layers:_e.layers},ve)}if(ve.preloading===this.sourcePreloadCount)break}}}_loadMaybe(fe){return fe&&"loadStatus"in fe&&null!=fe.loadStatus?"not-loaded"===fe.loadStatus?(fe.load().catch((fe=>{b$2g(fe)})),"loading"):fe.loadStatus:"loaded"}};e$4o([y$2v()],bP.prototype,"required",void 0),e$4o([y$2v({constructOnly:!0})],bP.prototype,"map",void 0),e$4o([y$2v({constructOnly:!0})],bP.prototype,"getSpatialReferenceSupport",void 0),e$4o([y$2v()],bP.prototype,"defaultSpatialReference",void 0),e$4o([y$2v()],bP.prototype,"userSpatialReference",void 0),e$4o([y$2v()],bP.prototype,"sourcePreloadCount",void 0),e$4o([y$2v()],bP.prototype,"priorityCollection",void 0),e$4o([y$2v()],bP.prototype,"requiresExtentInSpatialReference",void 0),e$4o([y$2v()],bP.prototype,"suspended",void 0),e$4o([y$2v({readOnly:!0})],bP.prototype,"ready",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"heightModelInfoReady",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"spatialReference",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"extent",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"heightModelInfo",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"vcsWkid",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"latestVcsWkid",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"viewingMode",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"tileInfo",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"mapCollections",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"_allLayers",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"_spatialReferenceTask",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"_tileInfoTask",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"_heightModelInfoTask",null),e$4o([y$2v({readOnly:!0})],bP.prototype,"_extentCandidatesTask",null),e$4o([y$2v()],bP.prototype,"_extentTask",null),e$4o([y$2v()],bP.prototype,"_projectExtentTask",void 0),bP=e$4o([a$4y("esri.views.support.DefaultsFromMap")],bP);let wP=class f5{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function h$1$(fe,ve){return null!=fe?null!=ve?fe===ve&&fe:fe:ve}var xP;let SP=xP=class extends(La.EventedMixin(n$3T(zi))){constructor(fe){super(fe),this._userSpatialReference=null,this._cursor=null,this.handles=new jt,this.updatingHandles=new Up,this.allLayerViews=new C_({getCollections:()=>{var fe,ve,_e;return[null==(fe=this.basemapView)?void 0:fe.baseLayerViews,null==(ve=this.groundView)?void 0:ve.layerViews,this.layerViews,null==(_e=this.basemapView)?void 0:_e.referenceLayerViews]},getChildrenFunction:B$L}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new IT,this.analyses=new Fp,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Wa,this.magnifier=new kT,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new aP,this.navigation=new hP,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new HE(this),this.persistableViewModels=new Wa,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(d$3d((()=>this.preconditionsReady),(fe=>{var ve,_e;const be=this.ready;if(fe?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,xP.views.add(this)):(this._lockedSpatialReference=null,xP.views.remove(this)),this.notifyChange("spatialReference"),!fe&&be)null==(ve=this.toolViewManager)||ve.detach(),null!=this.analysisViewManager&&this.analysisViewManager.detach(),null==(_e=this.layerViewManager)||_e.clear(),this._teardown();else if(fe&&!be){try{this._startup()}catch(br){return void queueMicrotask((()=>{this.fatalError=new Ir("startup-error",null,br)}))}null!=this.analysisViewManager&&this.analysisViewManager.attach(),this.toolViewManager.attach()}}),Za))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then((()=>(this._isValid=!0,w$1T((()=>this.ready)))))),this.basemapView=new LT({view:this}),this.layerViewManager=new FT({view:this,layerViewImporter:{importLayerView:fe=>this.importLayerView(fe),hasLayerViewModule:fe=>this.hasLayerViewModule(fe)},supportsGround:this.supportsGround}),this.toolViewManager=new KE({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new kE({view:this}),this.addHandles([d$3d((()=>this.initialExtentRequired),(fe=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:fe}),Ja),d$3d((()=>this.ready),(fe=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=fe,this.defaultsFromMap.userSpatialReference=fe?this.spatialReference:this._userSpatialReference)}),Za),d$3d((()=>this._userSpatialReference),(fe=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=fe)}),Ja)])}_setupSpatialReferenceLogger(){let fe=null;this.addHandles([d$3d((()=>{var fe;return null==(fe=this.defaultsFromMap)?void 0:fe.ready}),(ve=>{var _e;const be=(null==(_e=this.map)?void 0:_e.allLayers.length)>0;if(ve&&!this.spatialReference&&be){if(null!=fe)return;const ve=e$4e((()=>fe=e$4f(fe)));fe=d$3e((async ve=>{try{await A$1J(this.spatialReferenceWarningDelay,null,ve)}catch{return}finally{fe=null}ar.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.addHandles(ve,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")}),{sync:!0})])}destroy(){var fe,ve;this.destroyed||(xP.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=u$4d(this.graphics),this.analyses=u$4d(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),u$4d(this.analysisViewManager),this.toolViewManager=u$4d(this.toolViewManager),this.layerViewManager=u$4d(this.layerViewManager),this.selectionManager=u$4d(this.selectionManager),this.basemapView=u$4d(this.basemapView),null==(fe=this.groundView)||fe.destroy(),null==(ve=this.layerViews)||ve.forEach((fe=>fe.destroy())),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=u$4d(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ar.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var fe;return null==(fe=this.toolViewManager)?void 0:fe.activeTool}set activeTool(fe){this.toolViewManager&&(this.toolViewManager.activeTool=fe)}get animation(){return this._get("animation")}set animation(fe){this._set("animation",fe)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new bP({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(fe,ve)=>this.getSpatialReferenceSupport(fe,ve),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(fe){this._set("extent",fe)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var fe;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Sv.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!(null==(fe=this.defaultsFromMap)?void 0:fe.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(fe){fe!==this._get("map")&&((null==fe?void 0:fe.destroyed)&&(ar.getLogger(this).warn("#map","The provided map is already destroyed",{map:fe}),fe=null),Sv.isLoadable(fe)&&fe.load().catch((()=>{})),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",fe))}get spatialReference(){var fe,ve;const _e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(_e&&(null==(ve=null==(fe=this.defaultsFromMap)?void 0:fe.required)?void 0:ve.heightModelInfo)){const fe=_e.clone();return fe.vcsWkid=this.defaultsFromMap.vcsWkid,fe.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,fe}return _e}set spatialReference(fe){const ve=!G$Y(fe,this._get("spatialReference"));this._set("_userSpatialReference",fe),ve&&(this._set("spatialReference",fe),this._spatialReferenceChanged(fe))}_spatialReferenceChanged(fe){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??xu}set timeZone(fe){const ve=new Set(["etc/utc","etc/gmt","gmt"]),_e=new Set(Intl.supportedValuesOf("timeZone").map((fe=>fe.toLowerCase())));this._userTimeZone=fe,fe===xu||fe===Su||ve.has(fe.toLowerCase())||_e.has(fe.toLowerCase())||ar.getLogger(this).warn("#timeZone",`the parsed value '${fe}' may not be a valid IANA time zone`)}get tools(){var fe;return null==(fe=this.toolViewManager)?void 0:fe.tools}get initialExtent(){var fe;return null==(fe=this.defaultsFromMap)?void 0:fe.extent}get cursor(){var fe;return(null==(fe=this.toolViewManager)?void 0:fe.cursor)??this._cursor??"default"}set cursor(fe){this._cursor=fe,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new VE}whenLayerView(fe){var ve;return(null==(ve=this.layerViewManager)?void 0:ve.whenLayerView(fe))??Promise.reject()}getDefaultSpatialReference(){var fe;return null==(fe=this.defaultsFromMap)?void 0:fe.spatialReference}getDefaultHeightModelInfo(){var fe;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??(null==(fe=this.defaultsFromMap)?void 0:fe.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(fe){throw new Ir("importLayerView() not implemented")}hasLayerViewModule(fe){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(fe){return null!=this.getSpatialReferenceSupport(fe)}when(fe,ve){return this.isResolved()&&!this.ready&&ar.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(fe,ve)}forceReadyCycle(){this.ready&&(p$4J((()=>this.destroyed||!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(fe){this.toolViewManager.tools.add(fe),this.activeTool=fe}tryFatalErrorRecovery(){this.fatalError=null}};SP.views=new Wa,e$4o([y$2v()],SP.prototype,"_userSpatialReference",void 0),e$4o([y$2v()],SP.prototype,"activeTool",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"allLayerViews",void 0),e$4o([y$2v()],SP.prototype,"groundView",void 0),e$4o([y$2v()],SP.prototype,"animation",null),e$4o([y$2v()],SP.prototype,"basemapView",void 0),e$4o([y$2v()],SP.prototype,"center",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"_defaultsFromMapSettings",null),e$4o([y$2v()],SP.prototype,"defaultsFromMap",null),e$4o([y$2v()],SP.prototype,"fatalError",void 0),e$4o([y$2v({type:aa})],SP.prototype,"extent",null),e$4o([y$2v(l$40(IT,"graphics"))],SP.prototype,"graphics",void 0),e$4o([y$2v(l$40(Fp,"analyses"))],SP.prototype,"analyses",void 0),e$4o([y$2v({readOnly:!0,type:Eh})],SP.prototype,"heightModelInfo",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"interacting",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"navigating",null),e$4o([y$2v({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],SP.prototype,"preconditionsReady",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"typeSpecificPreconditionsReady",void 0),e$4o([y$2v({type:Wa,readOnly:!0})],SP.prototype,"layerViews",void 0),e$4o([y$2v()],SP.prototype,"resolution",null),e$4o([y$2v({type:kT})],SP.prototype,"magnifier",void 0),e$4o([y$2v({value:null,type:X_})],SP.prototype,"map",null),e$4o([y$2v()],SP.prototype,"padding",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"ready",void 0),e$4o([y$2v({type:zo})],SP.prototype,"spatialReference",null),e$4o([y$2v()],SP.prototype,"spatialReferenceWarningDelay",void 0),e$4o([y$2v()],SP.prototype,"stationary",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"supportsGround",void 0),e$4o([y$2v({type:j_})],SP.prototype,"timeExtent",void 0),e$4o([y$2v({type:String,nonNullable:!0})],SP.prototype,"timeZone",null),e$4o([y$2v()],SP.prototype,"tools",null),e$4o([y$2v()],SP.prototype,"toolViewManager",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"type",void 0),e$4o([y$2v({type:Number})],SP.prototype,"scale",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"updating",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"initialExtentRequired",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"initialExtent",null),e$4o([y$2v()],SP.prototype,"cursor",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"input",void 0),e$4o([y$2v({type:hP,nonNullable:!0})],SP.prototype,"navigation",void 0),e$4o([y$2v()],SP.prototype,"layerViewManager",void 0),e$4o([y$2v()],SP.prototype,"analysisViewManager",void 0),e$4o([y$2v()],SP.prototype,"selectionManager",void 0),e$4o([y$2v()],SP.prototype,"width",void 0),e$4o([y$2v()],SP.prototype,"height",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"resizing",void 0),e$4o([y$2v({value:null,readOnly:!0})],SP.prototype,"size",null),e$4o([y$2v({readOnly:!0})],SP.prototype,"suspended",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"viewEvents",void 0),e$4o([y$2v({readOnly:!0})],SP.prototype,"persistableViewModels",void 0),e$4o([y$2v()],SP.prototype,"_isValid",void 0),e$4o([y$2v()],SP.prototype,"_readyCycleForced",void 0),e$4o([y$2v()],SP.prototype,"_lockedSpatialReference",void 0),e$4o([y$2v()],SP.prototype,"_userTimeZone",void 0),e$4o([y$2v()],SP.prototype,"_lockedTimeZone",void 0),e$4o([y$2v({type:VE})],SP.prototype,"theme",void 0),e$4o([y$2v({readOnly:!0,type:VE})],SP.prototype,"effectiveTheme",null),SP=xP=e$4o([a$4y("esri.views.View")],SP);const TP=SP;function B$L(fe){return fe.layerViews}let EP=class p14 extends $v{constructor(fe){super(fe),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=L$1h(),this.addResolvingPromise(this._resolver.promise)}get done(){return"finished"===this.state||"stopped"===this.state}stop(){var fe;"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),null==(fe=this._resolver)||fe.reject(new Ir("ViewAnimation stopped")))}finish(){var fe;"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),null==(fe=this._resolver)||fe.resolve())}update(fe,ve){ve||(ve=S$1T(fe)?"waiting-for-target":"running"),this._set("target",fe),this._set("state",ve)}};e$4o([y$2v({readOnly:!0})],EP.prototype,"done",null),e$4o([y$2v({readOnly:!0,type:String})],EP.prototype,"state",void 0),e$4o([y$2v()],EP.prototype,"target",void 0),EP=e$4o([a$4y("esri.views.ViewAnimation")],EP),(EP||(EP={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const PP=EP,r$2F=()=>zt((()=>import("./TileLayerView3D-BkvAktpX.js")),__vite__mapDeps([79,80,81,82,83,84,85,86,87,18,19,88])),a$3b=()=>zt((()=>import("./ElevationLayerView3D-D1kuWQpa.js")),__vite__mapDeps([89,70,71,80,81,83])),CP={"base-dynamic":()=>zt((()=>import("./BaseDynamicLayerView3D-DbAanppG.js")),__vite__mapDeps([90,91,80,92,93,83,84])),"base-elevation":a$3b,"base-tile":r$2F,"bing-maps":r$2F,"building-scene":()=>zt((()=>import("./BuildingSceneLayerView3D-BXyS7FXi.js")),__vite__mapDeps([94,20,21,95,96,97,98,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115,116,117])),catalog:()=>zt((()=>import("./CatalogLayerView3D-CmqZrAt9.js")),__vite__mapDeps([118,80,83])),"catalog-dynamic-group":()=>zt((()=>import("./CatalogDynamicGroupLayerView3D-Ch7uP-FH.js")),__vite__mapDeps([119,80,83])),"catalog-footprint":()=>zt((()=>import("./CatalogFootprintLayerView3D-BZ-DgcyO.js")),__vite__mapDeps([120,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),csv:()=>zt((()=>import("./CSVLayerView3D-Ci3mbuCn.js")),__vite__mapDeps([121,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),dimension:()=>zt((()=>import("./DimensionLayerView3D-DWm0ssSo.js")),__vite__mapDeps([122,80,83])),elevation:a$3b,feature:()=>zt((()=>import("./FeatureLayerView3D-C33G2_Ur.js")),__vite__mapDeps([104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),geojson:()=>zt((()=>import("./GeoJSONLayerView3D-D5fnqN20.js")),__vite__mapDeps([123,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),graphics:()=>zt((()=>import("./GraphicsLayerView3D-B3FxZS09.js")),__vite__mapDeps([124,80,109,125,110,23,15,16,92,83])),group:()=>zt((()=>import("./GroupLayerView-DNsp_O6J.js")),__vite__mapDeps([126,83])),imagery:()=>zt((()=>import("./ImageryLayerView3D-Bbb2O7MC.js")),__vite__mapDeps([127,91,80,92,93,83,84,107])),"integrated-mesh":()=>zt((()=>import("./IntegratedMeshLayerView3D-7o5s9Hf_.js")),__vite__mapDeps([128,95,96,97,98,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115])),"integrated-mesh-3dtiles":()=>zt((()=>import("./IntegratedMesh3DTilesLayerView3D-xPlEfqBo.js")),__vite__mapDeps([129,96,97,62,80,83])),"line-of-sight":()=>zt((()=>import("./LineOfSightLayerView3D-BnaPY1US.js")),__vite__mapDeps([130,80,83])),"map-image":()=>zt((()=>import("./MapImageLayerView3D-B6DELmcb.js")),__vite__mapDeps([131,91,80,92,93,83,84,132,86,88,107,85,87,18,19])),media:()=>zt((()=>import("./MediaLayerView3D-D6RJug-G.js").then((fe=>fe.M))),__vite__mapDeps([133,134,135,19,80,136,137,138,139,9,140,141,86,93,83])),"ogc-feature":()=>zt((()=>import("./OGCFeatureLayerView3D-B1VzOeSO.js")),__vite__mapDeps([142,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),"open-street-map":r$2F,"oriented-imagery":()=>zt((()=>import("./FeatureLayerView3D-C33G2_Ur.js")),__vite__mapDeps([104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),"point-cloud":()=>zt((()=>import("./PointCloudLayerView3D-Cx5jye9T.js")),__vite__mapDeps([143,80,71,49,50,144,83])),voxel:()=>zt((()=>import("./VoxelLayerView3D-DkXg5bU6.js")),__vite__mapDeps([145,80,144,83])),route:()=>zt((()=>import("./RouteLayerView3D-9kb31CFs.js")),__vite__mapDeps([146,147,80,125,110,23,15,16,92,111,83])),scene:fe=>null==fe.profile||"mesh-pyramids"===fe.profile?zt((()=>import("./SceneLayerView3D-Bn1aAvVW.js")),__vite__mapDeps([148,68,20,21,86,95,96,97,98,56,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,17,18,19,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115,149,117,116,144])):zt((()=>import("./SceneLayerGraphicsView3D-DBRckUke.js")),__vite__mapDeps([150,98,97,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,149,117,144])),stream:()=>zt((()=>import("./StreamLayerView3D-Byd3_Wih.js")),__vite__mapDeps([151,46,47,34,18,19,32,33,111,106,107,92,108,109,78,110,23,15,16,86,17,20,21,10,22,3,4,5,6,13,14,80,83])),tile:r$2F,"imagery-tile":()=>zt((()=>import("./ImageryTileLayerView3D-MJ5zBNDs.js")),__vite__mapDeps([152,54,80,81,107,83,84,87])),"vector-tile":()=>zt((()=>import("./VectorTileLayerView3D-hkBK8Xx7.js")),__vite__mapDeps([153,44,33,43,154,80,81,83])),wcs:()=>zt((()=>import("./ImageryTileLayerView3D-MJ5zBNDs.js")),__vite__mapDeps([152,54,80,81,107,83,84,87])),"web-tile":r$2F,wfs:()=>zt((()=>import("./WFSLayerView3D-Craup2MT.js")),__vite__mapDeps([155,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),wms:()=>zt((()=>import("./WMSLayerView3D-BrGZlLgm.js")),__vite__mapDeps([156,91,80,92,93,83,84,157,107])),wmts:()=>zt((()=>import("./WMTSLayerView3D-C7eHNiKi.js")),__vite__mapDeps([158,80,81,82,83,84])),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};const l$35_hasLayerViewModule=fe=>null!=CP[fe.type],l$35_importLayerView=fe=>{const ve=CP[fe.type];if(null==ve)throw function s$3a(fe){const ve=fe.declaredClass?fe.declaredClass.slice(fe.declaredClass.lastIndexOf(".")+1):"Unknown",_e=ve.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Ir(`${_e}:view-not-supported`,`${ve} is not supported in 3D`)}(fe);return ve(fe)},OP="analyses-owner-handles";var AP,MP;!function(fe){fe[fe.PENDING=0]="PENDING",fe[fe.CREATED=1]="CREATED"}(AP||(AP={})),function(fe){fe[fe.ADDED=0]="ADDED",fe[fe.REMOVED=1]="REMOVED"}(MP||(MP={}));let RP=class A2 extends zi{constructor(fe){super(fe),this._allAnalysisViews=new Wa,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=v$1m(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(u$47("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(u$47()),this._attachedToViewResolver=v$1m()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some((fe=>fe.updating))}get testInfo(){}async whenAnalysisView(fe){await this._attachedToViewResolver.promise;const ve=this._items.get(fe);if(null==ve||ve.state.list===MP.REMOVED)throw new Ir("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:fe});return ve.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),OP)}_disconnectOwners(){this.removeHandles(OP),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(fe){for(const be of fe)this._addAnalysis(be);const ve=fe.on("after-add",(fe=>this._addAnalysis(fe.item))),_e=fe.on("after-remove",(fe=>this._removeAnalysis(fe.item)));return e$4e((()=>{ve.remove(),_e.remove();for(const ve of fe)this._removeAnalysis(ve)}))}_addAnalysis(fe){const ve=this._items.get(fe);if(null==ve){const ve={state:{view:AP.PENDING,list:MP.ADDED},analysis:fe,view:null,createAnalysisViewTask:null};this._items.set(fe,ve),ve.createAnalysisViewTask=d$3e((fe=>this._createAnalysisViewPromise(ve,fe)))}else ve.state.list=MP.ADDED}_removeAnalysis(fe){const ve=this._items.get(fe);null!=ve?(ve.state.list=MP.REMOVED,this._scheduleUpdate()):ar.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=v$27((()=>this._update())))}_update(){this._scheduledUpdateHandle=l$4E(this._scheduledUpdateHandle),this._items.forEach((fe=>{if(fe.state.list===MP.REMOVED)switch(this._items.delete(fe.analysis),fe.state.view){case AP.PENDING:fe.createAnalysisViewTask=e$4f(fe.createAnalysisViewTask);break;case AP.CREATED:null!=fe.view&&(this._allAnalysisViews.remove(fe.view),fe.view=u$4d(fe.view),fe.createAnalysisViewTask=null)}}))}async _createAnalysisViewPromise(fe,ve){const _e=fe.analysis,be=_e.type,we=this._analysisModules[be];if(this._creatingViewCount+=1,null==we.module)try{we.module=await this._loadAnalysisModule(be)}catch(xv){throw this._creatingViewCount-=1,xv}if(c$4_(ve))throw this._creatingViewCount-=1,u$47("AnalysisView creation aborted");const Se=new we.module.default({analysis:_e,view:this.view});try{await Se.when()}catch(xv){throw this._creatingViewCount-=1,xv}if(c$4_(ve))throw this._creatingViewCount-=1,Se.destroy(),u$47("AnalysisView creation aborted");return fe.view=Se,fe.state.view=AP.CREATED,this._allAnalysisViews.add(Se),this._creatingViewCount-=1,Se}_loadAnalysisModule(fe){switch(fe){case"area-measurement":return zt((()=>import("./AreaMeasurementAnalysisView3D-4gp_1Skz.js")),__vite__mapDeps([159,160,161,65,162,163,139,9,140,138,164,165,141,166,167]));case"dimension":return zt((()=>import("./DimensionAnalysisView3D-rpfIQ-hz.js")),__vite__mapDeps([168,162,169,161,65,166,167,138,139,9,140,170,171,154,172,173,174,175,137,141,86,136,176,177,165,108,178,93,179,180,181,182,164]));case"direct-line-measurement":return zt((()=>import("./DirectLineMeasurementAnalysisView3D-BfXIjrBJ.js")),__vite__mapDeps([183,160,161,65,162,164,138,139,9,140,166,167,175,172]));case"line-of-sight":return zt((()=>import("./LineOfSightAnalysisView3D-DfHTTTJq.js")),__vite__mapDeps([184,162,185,113,114,164,177,165,141,186,173,167,181,174]));case"slice":return zt((()=>import("./SliceAnalysisView3D-CAKnYQzy.js")),__vite__mapDeps([187,162,188,189,177,165,141,93,113,114,164,167,180,178,181,182]));case"viewshed":return zt((()=>import("./ViewshedAnalysisView3D-CaO3x2iV.js")),__vite__mapDeps([190,162,139,9,140,177,165,141,178,167,189,191,171,154,172,173,181,136,182]))}}};function v$1m(){const fe=L$1h();return fe.promise.catch((()=>{})),fe}e$4o([y$2v()],RP.prototype,"updating",null),e$4o([y$2v({constructOnly:!0})],RP.prototype,"view",void 0),e$4o([y$2v()],RP.prototype,"_allAnalysisViews",void 0),e$4o([y$2v()],RP.prototype,"_creatingViewCount",void 0),RP=e$4o([a$4y("esri.views.3d.analysis.AnalysisViewManager3D")],RP);const IP=RP;let LP=class c12 extends zi{constructor(fe){super(fe),this.collision=new zP,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Wf.Local?null:this._get("altitude")||null}set altitude(fe){this.mode!==Wf.Local?this._set("altitude",fe):ar.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(fe){return this.altitude?e$3Y(fe,this.altitude.min,this.altitude.max):fe}clampTilt(fe,ve){if(!this.tilt)return ve;const _e=this.tilt(fe);return e$3Y(ve,_e.min,_e.max)}clampDistance(fe){return Math.min(fe,this.distance)}createDefaultTilt(){return this.mode===Wf.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(fe){return(ve,_e=FP)=>(_e.min=NP.min,_e.max=fe,_e)}_createDefaultTiltLocal(){const fe=this.collision.enabled?k$1m([[4e3,NP.max],[1e4,h$2U(88)],[6e6,h$2U(88)]]):()=>NP.max;return(ve,_e=FP)=>(_e.min=NP.min,_e.max=fe(ve),_e)}_createDefaultTiltGlobal(){const fe=this.collision.enabled?k$1m([[4e3,NP.max],[5e4,h$2U(88)],[6e6,h$2U(88)],[2e7,NP.min]]):k$1m([[3e5,NP.max],[3e6,h$2U(88)],[6e6,h$2U(88)],[2e7,NP.min]]);return(ve,_e=FP)=>(_e.min=NP.min,_e.max=fe(ve),_e)}};e$4o([y$2v()],LP.prototype,"altitude",null),e$4o([y$2v({readOnly:!0})],LP.prototype,"collision",void 0),e$4o([y$2v()],LP.prototype,"distance",void 0),e$4o([y$2v({readOnly:!0})],LP.prototype,"minimumPoiDistance",void 0),e$4o([y$2v()],LP.prototype,"tilt",void 0),e$4o([y$2v({constructOnly:!0})],LP.prototype,"mode",void 0),LP=e$4o([a$4y("esri.views.3d.state.Constraints")],LP);const DP=function p$38(fe){return{min:-2e5,max:4*fe.radius}}(Rn),NP={min:h$2U(.5),max:h$2U(179.5)},FP={min:0,max:0};let zP=class f6 extends zi{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};e$4o([y$2v({type:Boolean})],zP.prototype,"enabled",void 0),e$4o([y$2v({type:Number})],zP.prototype,"elevationMargin",void 0),zP=e$4o([a$4y("esri.views.3d.state.Constraints.CollisionConstraint")],zP);let kP=class i10 extends ki{constructor(){super(...arguments),this.min=DP.min,this.max=DP.max}};e$4o([y$2v({type:Number})],kP.prototype,"min",void 0),e$4o([y$2v({type:Number})],kP.prototype,"max",void 0),kP=e$4o([a$4y("esri.views.3d.constraints.AltitudeConstraint")],kP);let UP=class o4 extends ki{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(fe){this._set("near",fe),fe>=this._get("far")&&(this.far=fe+1e-9),this.mode="manual"}castNear(fe){return Math.max(1e-8,fe)}get far(){return this._get("far")}set far(fe){this._set("far",fe),fe<=this._get("near")&&(this.near=fe-1e-9),this.mode="manual"}castFar(fe){return Math.max(1e-8,fe)}autoUpdate(fe,ve){"auto"===this.mode&&(this._get("near")!==fe&&this._set("near",fe),this._get("far")!==ve&&this._set("far",ve))}};e$4o([y$2v({type:Number,value:1e-8})],UP.prototype,"near",null),e$4o([s$4b("near")],UP.prototype,"castNear",null),e$4o([y$2v({type:Number,value:1e-8})],UP.prototype,"far",null),e$4o([s$4b("far")],UP.prototype,"castFar",null),e$4o([y$2v({type:["auto","manual"]})],UP.prototype,"mode",void 0),UP=e$4o([a$4y("esri.views.3d.constraints.ClipDistanceConstraint")],UP);const VP={min:M$1x(NP.min),max:M$1x(NP.max)};let BP=class c13 extends ki{constructor(fe){super(fe),this.mode="auto"}get max(){return this._get("max")}set max(fe){this._set("max",fe),this.mode="manual"}castMax(fe){return e$3Y(fe,VP.min,VP.max)}autoUpdate(fe){"auto"===this.mode&&this._get("max")!==fe&&this._set("max",fe)}};e$4o([y$2v({type:["auto","manual"]})],BP.prototype,"mode",void 0),e$4o([y$2v({type:Number,value:VP.max})],BP.prototype,"max",null),e$4o([s$4b("max")],BP.prototype,"castMax",null),BP=e$4o([a$4y("esri.views.3d.constraints.TiltConstraint")],BP);let jP=class c14 extends ki{constructor(){super(...arguments),this.tilt=new BP,this.altitude=new kP,this.clipDistance=new UP}};var GP;e$4o([y$2v({type:BP})],jP.prototype,"tilt",void 0),e$4o([y$2v({type:kP})],jP.prototype,"altitude",void 0),e$4o([y$2v({type:UP})],jP.prototype,"clipDistance",void 0),jP=e$4o([a$4y("esri.views.3d.constraints.Constraints")],jP);let HP=GP=class extends Pn{constructor(fe){super(fe),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(fe,ve){return null!=ve.datetime&&new Date(ve.datetime)||null}writeDate(fe,ve,_e){ve[_e]=fe.getTime()}readDirectShadowsEnabled(fe,ve){return!!ve.directShadows}writedirectShadowsEnabled(fe,ve,_e){fe&&(ve[_e]=fe)}writeDisplayUTCOffset(fe,ve){null!=fe&&(ve.displayUTCOffset=fe)}clone(){return new GP(this.cloneConstructProperties())}cloneConstructProperties(){const fe={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(fe.date=new Date(this.date.getTime())),fe}};e$4o([y$2v({readOnly:!0,type:["sun"],json:{write:!0}})],HP.prototype,"type",void 0),e$4o([y$2v({type:Date,json:{type:Number,write:{target:"datetime"}}})],HP.prototype,"date",void 0),e$4o([o$40("date",["datetime"])],HP.prototype,"readDate",null),e$4o([r$3s("date")],HP.prototype,"writeDate",null),e$4o([y$2v({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],HP.prototype,"directShadowsEnabled",void 0),e$4o([o$40("directShadowsEnabled",["directShadows"])],HP.prototype,"readDirectShadowsEnabled",null),e$4o([r$3s("directShadowsEnabled")],HP.prototype,"writedirectShadowsEnabled",null),e$4o([y$2v({type:Number,json:{write:!0}})],HP.prototype,"displayUTCOffset",void 0),e$4o([r$3s("displayUTCOffset")],HP.prototype,"writeDisplayUTCOffset",null),HP=GP=e$4o([a$4y("esri.webscene.SunLighting")],HP);const qP=HP;var WP;let YP=WP=class extends(La.EventedMixin(qP)){constructor(fe){super(fe),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const ve=(new Date).getFullYear(),_e=new Date("March 15, "+ve+" 12:00:00 UTC");this._set("defaultDate",_e),this._set("date",_e)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(fe){return new WP(fe.cloneConstructProperties())}set defaultDate(fe){const ve=this._get("date")===this._get("defaultDate");fe=new Date(fe.getTime()),this._set("defaultDate",fe),ve&&this._set("date",fe)}set date(fe){null!=fe&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(fe.getTime())))}autoUpdate(fe,ve){const _e=WP.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=ve.hours,this.positionTimezoneInfo.minutes=ve.minutes,this.positionTimezoneInfo.seconds=ve.seconds;let be=null;null!=fe&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(fe.getTime())?(be=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(be=this.date&&this.date.getTime(),this._set("date",new Date(fe.getTime()))));const we=WP.calculateTimezoneOffset(this.positionTimezoneInfo);if(_e!==we&&(ZP.target=this,ZP.timezoneOffset=we,this.emit("timezone-will-change",ZP),ZP.target=null),null!=fe)return isNaN(fe.getTime())||be!==fe.getTime()}clone(){const fe=this._get("date")===this._get("defaultDate"),ve=new WP({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return fe&&ve._set("date",ve._get("defaultDate")),ve.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,ve.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,ve.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,ve.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,ve}cloneWithWebsceneLighting(fe){const ve=this.clone();return null!=fe.date&&(ve.date=fe.date),ve.directShadowsEnabled=fe.directShadowsEnabled,ve.displayUTCOffset=fe.displayUTCOffset,ve}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};e$4o([y$2v({type:Boolean})],YP.prototype,"cameraTrackingEnabled",void 0),e$4o([y$2v({type:Date})],YP.prototype,"defaultDate",null),e$4o([y$2v({type:Date})],YP.prototype,"date",null),YP=WP=e$4o([a$4y("esri.views.3d.environment.SunLighting")],YP),(YP||(YP={})).calculateTimezoneOffset=function t84({hours:fe,minutes:ve,seconds:_e}){return Math.round(fe+ve/60+_e/3600)};const ZP={target:null,timezoneOffset:0},XP=YP;var JP;let QP=JP=class extends Pn{constructor(fe){super(fe),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new JP(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};e$4o([y$2v({readOnly:!0,type:["virtual"],json:{write:!0}})],QP.prototype,"type",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],QP.prototype,"directShadowsEnabled",void 0),QP=JP=e$4o([a$4y("esri.webscene.VirtualLighting")],QP);const KP=QP;var eC;let tC=eC=class extends(La.EventedMixin(KP)){constructor(fe){super(fe),this.cameraTrackingEnabled=!0}clone(){return new eC({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(fe){return new eC(fe.cloneConstructProperties())}cloneWithWebsceneLighting(fe){const ve=this.clone();return ve.directShadowsEnabled=fe.directShadowsEnabled,ve}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};e$4o([y$2v({type:Boolean})],tC.prototype,"cameraTrackingEnabled",void 0),tC=eC=e$4o([a$4y("esri.views.3d.environment.VirtualLighting")],tC);const rC=tC,iC={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:XP,virtual:rC}};var nC;let sC=nC=class extends zi{set quality(fe){["low","high"].includes(fe)&&this._set("quality",fe)}clone(){return new nC({quality:this.quality})}};var oC;e$4o([y$2v({type:["low","high"],value:"low"})],sC.prototype,"quality",null),sC=nC=e$4o([a$4y("esri.views.3d.environment.SceneViewAtmosphere")],sC);let aC=oC=class extends Pn{constructor(fe){super(fe),this.type="sunny",this.cloudCover=.5}clone(){return new oC({cloudCover:this.cloudCover})}};e$4o([o$3g({sunny:"sunny"})],aC.prototype,"type",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],aC.prototype,"cloudCover",void 0),aC=oC=e$4o([a$4y("esri.views.3d.environment.SunnyWeather")],aC);const lC=aC;var cC;let uC=cC=class extends Pn{constructor(fe){super(fe),this.type="cloudy",this.cloudCover=.5}clone(){return new cC({cloudCover:this.cloudCover})}};e$4o([o$3g({cloudy:"cloudy"})],uC.prototype,"type",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uC.prototype,"cloudCover",void 0),uC=cC=e$4o([a$4y("esri.views.3d.environment.CloudyWeather")],uC);const hC=uC;var dC;let pC=dC=class extends Pn{constructor(fe){super(fe),this.type="foggy",this.fogStrength=.5}clone(){return new dC({fogStrength:this.fogStrength})}};e$4o([o$3g({foggy:"foggy"})],pC.prototype,"type",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],pC.prototype,"fogStrength",void 0),pC=dC=e$4o([a$4y("esri.views.3d.environment.FoggyWeather")],pC);const fC=pC;var mC;let yC=mC=class extends Pn{constructor(fe){super(fe),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new mC({cloudCover:this.cloudCover,precipitation:this.precipitation})}};e$4o([o$3g({rainy:"rainy"})],yC.prototype,"type",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yC.prototype,"cloudCover",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yC.prototype,"precipitation",void 0),yC=mC=e$4o([a$4y("esri.views.3d.environment.RainyWeather")],yC);const gC=yC;var vC;let _C=vC=class extends Pn{constructor(fe){super(fe),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new vC({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};e$4o([o$3g({snowy:"snowy"})],_C.prototype,"type",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_C.prototype,"cloudCover",void 0),e$4o([y$2v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_C.prototype,"precipitation",void 0),e$4o([y$2v({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_C.prototype,"snowCover",void 0),_C=vC=e$4o([a$4y("esri.views.3d.environment.SnowyWeather")],_C);const $C={key:"type",base:lC,typeMap:{sunny:lC,cloudy:hC,rainy:gC,snowy:_C,foggy:fC}},bC=Object.keys($C.typeMap);const wC=1e4,xC=1e5,SC={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:qP,virtual:KP}};let TC=class t16 extends Pn{constructor(fe){super(fe)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};e$4o([y$2v({readOnly:!0,json:{read:!1}})],TC.prototype,"type",void 0),TC=e$4o([a$4y("esri.webscene.background.Background")],TC);const EC=TC;var PC;const CC={...uw,nonNullable:!0};let OC=PC=class extends EC{constructor(fe){super(fe),this.type="color",this.color=new b_([0,0,0,1])}clone(){return new PC(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};e$4o([o$3g({color:"color"},{readOnly:!0})],OC.prototype,"type",void 0),e$4o([y$2v(CC)],OC.prototype,"color",void 0),OC=PC=e$4o([a$4y("esri.webscene.background.ColorBackground")],OC);const AC=OC,MC={base:EC,key:"type",typeMap:{color:AC}};const RC={types:MC,json:{read:function t$36(fe){return(ve,_e,be)=>{if(!ve)return ve;for(const we in fe.typeMap)if(ve.type===we){const _e=new fe.typeMap[we];return _e.read(ve,be),_e}}}(MC),write:{overridePolicy:(fe,ve,_e)=>({enabled:!(null==_e?void 0:_e.isPresentation)})}}};var IC;const u$2L=(fe,ve,_e)=>({enabled:!(null==_e?void 0:_e.isPresentation)});let LC=IC=class extends Pn{constructor(fe){super(fe),this.lighting=new qP,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(fe){(function s$35(fe,ve){return!!bC.includes(fe)||(ve.error(`"${fe}" is not a valid weather type`),!1)})(null==fe?void 0:fe.type,ar.getLogger(this))&&this._set("weather",fe)}clone(){return new IC(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?KP.prototype.clone.call(this.lighting):qP.prototype.clone.call(this.lighting),background:a$4H(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};e$4o([y$2v({types:SC,nonNullable:!0,json:{write:!0}})],LC.prototype,"lighting",void 0),e$4o([y$2v(RC)],LC.prototype,"background",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:u$2L}}})],LC.prototype,"atmosphereEnabled",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:u$2L}}})],LC.prototype,"starsEnabled",void 0),e$4o([y$2v({types:$C,nonNullable:!0,json:{write:!0},value:new lC})],LC.prototype,"weather",null),LC=IC=e$4o([a$4y("esri.webscene.Environment")],LC);const DC=LC;var NC;let FC=NC=class extends DC{constructor(fe){super(fe),this.atmosphere=new sC,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(fe){const ve=fe.cloneConstructProperties();return new NC({...ve,lighting:ve.lighting?"virtual"===ve.lighting.type?rC.fromWebsceneLighting(ve.lighting):XP.fromWebsceneLighting(ve.lighting):void 0})}castLighting(fe){return this._convertLightingWithDestroy(fe)}applyLighting(fe){this.lighting=this._convertLightingWithDestroy(fe)}_convertLightingWithDestroy(fe){const ve=this._convertLighting(fe);return ve!==fe&&this.addHandles(l$4D(ve)),ve}_convertLighting(fe){var ve,_e;return fe?fe instanceof XP||fe instanceof rC?fe:fe instanceof qP?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(fe):new XP({...fe.cloneConstructProperties(),...null==(ve=this.lighting)?void 0:ve.cloneNonPersistentConstructProperties()}):fe instanceof KP?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(fe):new rC({...fe.cloneConstructProperties(),...null==(_e=this.lighting)?void 0:_e.cloneNonPersistentConstructProperties()}):T$1p(iC,fe):new XP}clone(){return new NC({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:a$4H(this.background)})}cloneWithWebsceneEnvironment(fe){return new NC({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:a$4H(this.background),...fe.cloneConstructProperties(),lighting:this._getLighting(fe)})}_getLighting(fe){switch(fe.lighting.type){case"sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(fe.lighting):XP.fromWebsceneLighting(fe.lighting);case"virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(fe.lighting):rC.fromWebsceneLighting(fe.lighting);default:return fe.lighting,XP.fromWebsceneLighting(fe.lighting)}}};e$4o([y$2v({type:sC,json:{read:!1},nonNullable:!0})],FC.prototype,"atmosphere",void 0),e$4o([y$2v({nonNullable:!0})],FC.prototype,"lighting",void 0),e$4o([s$4b("lighting")],FC.prototype,"castLighting",null),FC=NC=e$4o([a$4y("esri.views.3d.environment.SceneViewEnvironment")],FC);const zC=FC;function i$2$(fe){return{value:fe}}function a$36(fe,ve){return{type:D$1a(ve),value:fe,unit:ve}}function l$33(fe,ve){return{type:D$1a(ve),value:fe,unit:ve}}function o$2T(fe,ve,_e="arithmetic"){return{type:D$1a(ve),value:fe,unit:ve,rotationType:_e}}function s$34(fe,ve){const _e=f$2c(fe,ve);return"angle"===fe.type?o$2T(_e,ve,fe.rotationType):function r$2D(fe,ve){return{type:D$1a(ve),value:fe,unit:ve}}(_e,ve)}function f$2c(fe,ve){return j$1K(fe.value,fe.unit,ve)}function p$2$(fe,ve){return null==fe?ve:null==ve||fe.value>j$1K(ve.value,ve.unit,fe.unit)?fe:ve}function y$1B(fe,ve){return null==fe?null:{...fe,value:fe.value*ve}}function m$2t(fe,ve,_e){if(ve===_e)return fe;switch(_e){case"arithmetic":case"geographic":return 90-fe}}const kC=a$36(0,"meters"),UC=l$33(0,"square-meters");o$2T(0,"radians");const VC=o$2T(0,"degrees"),BC=o$2T(0,"degrees","geographic");var jC,GC;function o$2S(fe){return"r"in fe&&"g"in fe&&"b"in fe}function u$2K(fe){return"h"in fe&&"s"in fe&&"v"in fe}function e$36(fe){return"l"in fe&&"a"in fe&&"b"in fe}function c$2Z(fe){return"l"in fe&&"c"in fe&&"h"in fe}(GC=jC||(jC={}))[GC.Realistic=0]="Realistic",GC[GC.Local=1]="Local",GC[GC.Mars=2]="Mars",GC[GC.None=3]="None";const HC=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],qC=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function f$2b(fe,ve){const _e=[];let be,we;if(fe[0].length!==ve.length)throw new Error("dimensions do not match");const Se=fe.length,Te=fe[0].length;let Ee=0;for(be=0;be<Se;be++){for(Ee=0,we=0;we<Te;we++)Ee+=fe[be][we]*ve[we];_e.push(Ee)}return _e}function h$1Y(fe){const ve=[fe.r/255,fe.g/255,fe.b/255].map((fe=>fe<=.04045?fe/12.92:((fe+.055)/1.055)**2.4)),_e=f$2b(HC,ve);return{x:100*_e[0],y:100*_e[1],z:100*_e[2]}}function l$32(fe){const ve=f$2b(qC,[fe.x/100,fe.y/100,fe.z/100]).map((fe=>{const ve=fe<=.0031308?12.92*fe:1.055*fe**(1/2.4)-.055;return Math.min(1,Math.max(ve,0))}));return{r:Math.round(255*ve[0]),g:Math.round(255*ve[1]),b:Math.round(255*ve[2])}}function b$1u(fe){const ve=[fe.x/95.047,fe.y/100,fe.z/108.883].map((fe=>fe>(6/29)**3?fe**(1/3):1/3*(29/6)**2*fe+4/29));return{l:116*ve[1]-16,a:500*(ve[0]-ve[1]),b:200*(ve[1]-ve[2])}}function g$1L(fe){const ve=fe.l,_e=[(ve+16)/116+fe.a/500,(ve+16)/116,(ve+16)/116-fe.b/200].map((fe=>fe>6/29?fe**3:3*(6/29)**2*(fe-4/29)));return{x:95.047*_e[0],y:100*_e[1],z:108.883*_e[2]}}function x$1g(fe){return function M$12(fe){const ve=fe.l,_e=fe.a,be=fe.b,we=Math.sqrt(_e*_e+be*be);let Se=Math.atan2(be,_e);return Se=Se>0?Se:Se+2*Math.PI,{l:ve,c:we,h:Se}}(b$1u(h$1Y(fe)))}function k$14(fe){return l$32(g$1L(function m$2s(fe){const ve=fe.l,_e=fe.c,be=fe.h;return{l:ve,a:_e*Math.cos(be),b:_e*Math.sin(be)}}(fe)))}function y$1A(fe){return o$2S(fe)?fe:c$2Z(fe)?k$14(fe):e$36(fe)?function p$2_(fe){return l$32(g$1L(fe))}(fe):function i$2_(fe){return"x"in fe&&"y"in fe&&"z"in fe}(fe)?l$32(fe):u$2K(fe)?function v$1l(fe){const ve=(fe.h+360)%360/60,_e=fe.s/100,be=fe.v/100*255,we=be*_e,Se=we*(1-Math.abs(ve%2-1));let Te;switch(Math.floor(ve)){case 0:Te={r:we,g:Se,b:0};break;case 1:Te={r:Se,g:we,b:0};break;case 2:Te={r:0,g:we,b:Se};break;case 3:Te={r:0,g:Se,b:we};break;case 4:Te={r:Se,g:0,b:we};break;case 5:case 6:Te={r:we,g:0,b:Se};break;default:Te={r:0,g:0,b:0}}return Te.r=Math.round(Te.r+be-we),Te.g=Math.round(Te.g+be-we),Te.b=Math.round(Te.b+be-we),Te}(fe):fe}function z$Q(fe){return u$2K(fe)?fe:function w$1m(fe){const ve=fe.r,_e=fe.g,be=fe.b,we=Math.max(ve,_e,be),Se=we-Math.min(ve,_e,be);let Te=we,Ee=0===Se?0:we===ve?(_e-be)/Se%6:we===_e?(be-ve)/Se+2:(ve-_e)/Se+4,Ce=0===Se?0:Se/Te;return Ee<0&&(Ee+=6),Ee*=60,Ce*=100,Te*=100/255,{h:Ee,s:Ce,v:Te}}(y$1A(fe))}function A$1f(fe){return e$36(fe)?fe:function d$2d(fe){return b$1u(h$1Y(fe))}(y$1A(fe))}function j$1b(fe){return c$2Z(fe)?fe:x$1g(y$1A(fe))}var WC;function G$D(fe,ve=WC.High){return function H$R(fe,ve){const{r:_e,g:be,b:we}=fe;return.2126*_e+.7152*be+.0722*we}(fe)>ve?new b_([0,0,0,fe.a]):new b_([255,255,255,fe.a])}function L$S(fe,ve){const _e=A$1f(fe);_e.l*=1-ve;const be=y$1A(_e),we=fe.clone();return we.setColor(be),we.a=fe.a,we}function R$Y(fe,ve){const _e=fe.clone();return _e.a*=ve,_e}function U$U(fe,ve){const _e=z$Q(fe);_e.s*=ve;const be=y$1A(_e),we=fe.clone();return we.setColor(be),we.a=fe.a,we}function E$1l(fe){return b_.toUnitRGBA(fe)}function P$Y(fe,ve){return fe===ve||null!=fe&&null!=ve&&L$17(fe,ve)}function D$V(fe){return r$35(fe[0],fe[1],fe[2],fe.length>3?fe[3]:1)}function F$T(fe,ve){const _e=b_.toUnitRGBA(fe);return _e[3]*=ve,_e}function r$2C(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe}function o$2R(fe,ve,_e){return fe[0]=ve,fe[1]=_e,fe}function u$2J(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe}function e$35(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe}function c$2Y(fe,ve,_e){return fe[0]=ve[0]*_e[0],fe[1]=ve[1]*_e[1],fe}function a$33(fe,ve,_e){return fe[0]=ve[0]/_e[0],fe[1]=ve[1]/_e[1],fe}function f$2a(fe,ve,_e){return fe[0]=Math.min(ve[0],_e[0]),fe[1]=Math.min(ve[1],_e[1]),fe}function M$11(fe,ve,_e){return fe[0]=Math.max(ve[0],_e[0]),fe[1]=Math.max(ve[1],_e[1]),fe}function l$31(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe}function d$2c(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe}function m$2r(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1];return Math.sqrt(_e*_e+be*be)}function b$1t(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1];return _e*_e+be*be}function q$J(fe){const ve=fe[0],_e=fe[1];return Math.sqrt(ve*ve+_e*_e)}function p$2Z(fe){const ve=fe[0],_e=fe[1];return ve*ve+_e*_e}function x$1f(fe,ve){return fe[0]=-ve[0],fe[1]=-ve[1],fe}function v$1k(fe,ve){const _e=ve[0],be=ve[1];let we=_e*_e+be*be;return we>0&&(we=1/Math.sqrt(we),fe[0]=ve[0]*we,fe[1]=ve[1]*we),fe}function j$1a(fe,ve){return fe[0]*ve[0]+fe[1]*ve[1]}function _$12(fe,ve,_e,be){const we=ve[0],Se=ve[1];return fe[0]=we+be*(_e[0]-we),fe[1]=Se+be*(_e[1]-Se),fe}function P$X(fe,ve,_e){const be=ve[0],we=ve[1];return fe[0]=_e[0]*be+_e[2]*we,fe[1]=_e[1]*be+_e[3]*we,fe}function S$1j(fe,ve,_e){const be=ve[0],we=ve[1];return fe[0]=_e[0]*be+_e[2]*we+_e[4],fe[1]=_e[1]*be+_e[3]*we+_e[5],fe}function I$1c(fe,ve,_e,be){const we=ve[0]-_e[0],Se=ve[1]-_e[1],Te=Math.sin(be),Ee=Math.cos(be);return fe[0]=we*Ee-Se*Te+_e[0],fe[1]=we*Te+Se*Ee+_e[1],fe}function L$R(fe,ve){const _e=fe[0],be=fe[1],we=ve[0],Se=ve[1];let Te=_e*_e+be*be;Te>0&&(Te=1/Math.sqrt(Te));let Ee=we*we+Se*Se;Ee>0&&(Ee=1/Math.sqrt(Ee));const Ce=(_e*we+be*Se)*Te*Ee;return Ce>1?0:Ce<-1?Math.PI:Math.acos(Ce)}function E$1k(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]}function T$_(fe,ve){const _e=fe[0],be=fe[1],we=ve[0],Se=ve[1],Te=e$3_();return Math.abs(_e-we)<=Te*Math.max(1,Math.abs(_e),Math.abs(we))&&Math.abs(be-Se)<=Te*Math.max(1,Math.abs(be),Math.abs(Se))}function k$13(fe,ve,_e,be,we){let Se=ve[0]-_e[0],Te=ve[1]-_e[1];const Ee=(be[0]*Se+be[1]*Te)*(we-1);return Se=be[0]*Ee,Te=be[1]*Ee,fe[0]=ve[0]+Se,fe[1]=ve[1]+Te,fe}!function(fe){fe[fe.Low=160]="Low",fe[fe.High=225]="High"}(WC||(WC={}));const YC=q$J,ZC=e$35,XC=c$2Y,JC=a$33,QC=m$2r,KC=b$1t,eO=p$2Z;function e$34(fe){const ve=1e5;return e$3Y((fe-ve)/9e5,0,1)}Object.freeze(Object.defineProperty({__proto__:null,add:u$2J,angle:L$R,ceil:function s$32(fe,ve){return fe[0]=Math.ceil(ve[0]),fe[1]=Math.ceil(ve[1]),fe},copy:r$2C,cross:function y$1z(fe,ve,_e){const be=ve[0]*_e[1]-ve[1]*_e[0];return fe[0]=fe[1]=0,fe[2]=be,fe},dist:QC,distance:m$2r,div:JC,divide:a$33,dot:j$1a,equals:T$_,exactEquals:E$1k,floor:function i$2Z(fe,ve){return fe[0]=Math.floor(ve[0]),fe[1]=Math.floor(ve[1]),fe},inverse:function g$1K(fe,ve){return fe[0]=1/ve[0],fe[1]=1/ve[1],fe},len:YC,length:q$J,lerp:_$12,max:M$11,min:f$2a,mul:XC,multiply:c$2Y,negate:x$1f,normalize:v$1k,projectAndScale:k$13,random:function A$1e(fe,ve){ve=ve||1;const _e=2*Yi()*Math.PI;return fe[0]=Math.cos(_e)*ve,fe[1]=Math.sin(_e)*ve,fe},rotate:I$1c,round:function h$1X(fe,ve){return fe[0]=Math.round(ve[0]),fe[1]=Math.round(ve[1]),fe},scale:l$31,scaleAndAdd:d$2c,set:o$2R,sqrDist:KC,sqrLen:eO,squaredDistance:b$1t,squaredLength:p$2Z,str:function O$15(fe){return"vec2("+fe[0]+", "+fe[1]+")"},sub:ZC,subtract:e$35,transformMat2:P$X,transformMat2d:S$1j,transformMat3:function z$P(fe,ve,_e){const be=ve[0],we=ve[1];return fe[0]=_e[0]*be+_e[3]*we+_e[6],fe[1]=_e[1]*be+_e[4]*we+_e[7],fe},transformMat4:function D$U(fe,ve,_e){const be=ve[0],we=ve[1];return fe[0]=_e[0]*be+_e[4]*we+_e[12],fe[1]=_e[1]*be+_e[5]*we+_e[13],fe}},Symbol.toStringTag,{value:"Module"}));const tO=1e4,rO=1e5;const iO=class t17{};function o$2P(fe,...ve){let _e="";for(let be=0;be<ve.length;be++)_e+=fe[be]+ve[be];return _e+=fe[fe.length-1],_e}var nO,sO,oO;function E$1j(fe){return fe===nO.POSITION}function o$2O(fe,ve){switch(ve.textureCoordinateType){case sO.Default:return fe.attributes.add(nO.UV0,"vec2"),fe.varyings.add("vuv0","vec2"),void fe.vertex.code.add(o$2P`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case sO.Compressed:return fe.attributes.add(nO.UV0,"vec2"),fe.varyings.add("vuv0","vec2"),void fe.vertex.code.add(o$2P`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case sO.Atlas:return fe.attributes.add(nO.UV0,"vec2"),fe.varyings.add("vuv0","vec2"),fe.attributes.add(nO.UVREGION,"vec4"),fe.varyings.add("vuvRegion","vec4"),void fe.vertex.code.add(o$2P`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:ve.textureCoordinateType;case sO.None:return void fe.vertex.code.add(o$2P`void forwardTextureCoordinates() {}`);case sO.COUNT:return}}function a$32(fe){fe.code.add(o$2P`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}!function(fe){fe.int=function n52(fe){return Math.round(fe).toString()},fe.float=function o39(fe){return fe.toPrecision(8)}}(o$2P||(o$2P={})),function(fe){fe.POSITION="position",fe.NORMAL="normal",fe.NORMALCOMPRESSED="normalCompressed",fe.UV0="uv0",fe.COLOR="color",fe.SYMBOLCOLOR="symbolColor",fe.SIZE="size",fe.TANGENT="tangent",fe.OFFSET="offset",fe.PERSPECTIVEDIVIDE="perspectiveDivide",fe.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",fe.LENGTH="length",fe.PREVPOSITION="prevPosition",fe.NEXTPOSITION="nextPosition",fe.SUBDIVISIONFACTOR="subdivisionFactor",fe.COLORFEATUREATTRIBUTE="colorFeatureAttribute",fe.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",fe.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",fe.DISTANCETOSTART="distanceToStart",fe.UVMAPSPACE="uvMapSpace",fe.BOUNDINGRECT="boundingRect",fe.UVREGION="uvRegion",fe.PROFILERIGHT="profileRight",fe.PROFILEUP="profileUp",fe.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",fe.FEATUREVALUE="featureValue",fe.INSTANCEMODELORIGINHI="instanceModelOriginHi",fe.INSTANCEMODELORIGINLO="instanceModelOriginLo",fe.INSTANCEMODEL="instanceModel",fe.INSTANCEMODELNORMAL="instanceModelNormal",fe.INSTANCECOLOR="instanceColor",fe.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",fe.LOCALTRANSFORM="localTransform",fe.GLOBALTRANSFORM="globalTransform",fe.BOUNDINGSPHERE="boundingSphere",fe.MODELORIGIN="modelOrigin",fe.MODELSCALEFACTORS="modelScaleFactors",fe.FEATUREATTRIBUTE="featureAttribute",fe.STATE="state",fe.LODLEVEL="lodLevel",fe.POSITION0="position0",fe.POSITION1="position1",fe.NORMAL2COMPRESSED="normal2Compressed",fe.COMPONENTINDEX="componentIndex",fe.VARIANTOFFSET="variantOffset",fe.VARIANTSTROKE="variantStroke",fe.VARIANTEXTENSION="variantExtension",fe.SIDENESS="sideness",fe.START="start",fe.END="end",fe.UP="up",fe.EXTRUDE="extrude",fe.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",fe.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(nO||(nO={})),function(fe){fe[fe.None=0]="None",fe[fe.Default=1]="Default",fe[fe.Atlas=2]="Atlas",fe[fe.Compressed=3]="Compressed",fe[fe.COUNT=4]="COUNT"}(sO||(sO={})),function(fe){fe[fe.Pass=0]="Pass",fe[fe.Draw=1]="Draw"}(oO||(oO={}));let aO=class a4{constructor(fe,ve,_e,be,we=null){if(this.name=fe,this.type=ve,this.arraySize=we,this.bind={[oO.Pass]:null,[oO.Draw]:null},be)switch(_e){case oO.Pass:this.bind[oO.Pass]=be;break;case oO.Draw:this.bind[oO.Draw]=be}}equals(fe){return this.type===fe.type&&this.name===fe.name&&this.arraySize===fe.arraySize}},lO=class e9 extends aO{constructor(fe,ve){super(fe,"vec2",oO.Pass,((_e,be,we)=>_e.setUniform2fv(fe,ve(be,we))))}};function i$2Y(fe){fe.include(a$32),fe.code.add(o$2P`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function c$2X(fe){fe.uniforms.add(new lO("zProjectionMap",((fe,ve)=>function d$2a(fe){const ve=fe.projectionMatrix;return o$2R(cO,ve[14],ve[10])}(ve.camera)))),fe.code.add(o$2P`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),fe.code.add(o$2P`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),fe.code.add(o$2P`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const cO=[0,0];function e$31(fe){fe.fragment.code.add(o$2P`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let uO=class e10 extends aO{constructor(fe,ve){super(fe,"vec3",oO.Pass,((_e,be,we)=>_e.setUniform3fv(fe,ve(be,we))))}};function t$34(fe){fe.uniforms.add(new uO("mainLightDirection",((fe,ve)=>ve.lighting.mainLight.direction)))}function a$2$(fe){fe.uniforms.add(new uO("mainLightIntensity",((fe,ve)=>ve.lighting.mainLight.intensity)))}function o$2N(fe){t$34(fe.fragment),a$2$(fe.fragment),fe.fragment.code.add(o$2P`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let hO=class e11 extends aO{constructor(fe,ve){super(fe,"vec4",oO.Pass,((_e,be,we)=>_e.setUniform4fv(fe,ve(be,we))))}},dO=class o5 extends aO{constructor(fe,ve){super(fe,"float",oO.Pass,((_e,be,we)=>_e.setUniform1f(fe,ve(be,we))))}},pO=class e12 extends aO{constructor(fe,ve){super(fe,"mat4",oO.Pass,((_e,be,we)=>_e.setUniformMatrix4fv(fe,ve(be,we))))}};const fO=[0,0,0,0];let mO=class o6{constructor(fe){this.message=fe}toString(){return`AssertException: ${this.message}`}};function s$31(fe,ve){if(!fe){ve=ve||"Assertion";const fe=new Error(ve).stack;throw new mO(`${ve} at ${fe}`)}}function c$2W(fe,ve){fe||(ve=ve||"")}function i$2X(fe,ve,_e,be){let we,Se=(_e[0]-fe[0])/ve[0],Te=(be[0]-fe[0])/ve[0];Se>Te&&(we=Se,Se=Te,Te=we);let Ee=(_e[1]-fe[1])/ve[1],Ce=(be[1]-fe[1])/ve[1];if(Ee>Ce&&(we=Ee,Ee=Ce,Ce=we),Se>Ce||Ee>Te)return!1;Ee>Se&&(Se=Ee),Ce<Te&&(Te=Ce);let Oe=(_e[2]-fe[2])/ve[2],Re=(be[2]-fe[2])/ve[2];return Oe>Re&&(we=Oe,Oe=Re,Re=we),!(Se>Re||Oe>Te||(Re<Te&&(Te=Re),Te<0))}function f$29(fe,ve,_e,be,we,Se=[0,0]){const Te=(be[we]-_e[we])*(ve[0]-fe[0])-(be[0]-_e[0])*(ve[we]-fe[we]),Ee=(be[0]-_e[0])*(fe[we]-_e[we])-(be[we]-_e[we])*(fe[0]-_e[0]);if(0===Te)return!1;const Ce=Ee/Te;return Se[0]=fe[0]+Ce*(ve[0]-fe[0]),Se[1]=fe[we]+Ce*(ve[we]-fe[we]),!0}function a$2_(fe,ve,_e,be,we){fO[0]=fe[0],fO[1]=fe[1],fO[2]=fe[2],fO[3]=1,z$13(fO,fO,ve),we.length>2&&(we[2]=-fO[2]),z$13(fO,fO,_e),s$31(0!==fO[3]),we[0]=fO[0]/fO[3],we[1]=fO[1]/fO[3],we[2]=fO[2]/fO[3],we[0]=(.5*we[0]+.5)*be[2]+be[0],we[1]=(.5*we[1]+.5)*be[3]+be[1]}function m$2q(fe){return 1===fe[0]&&0===fe[1]&&0===fe[2]&&0===fe[3]&&0===fe[4]&&1===fe[5]&&0===fe[6]&&0===fe[7]&&0===fe[8]&&0===fe[9]&&1===fe[10]&&0===fe[11]&&1===fe[15]}let yO=class i11{constructor(){this._includedModules=new Map}include(fe,ve){this._includedModules.has(fe)?this._includedModules.get(fe):(this._includedModules.set(fe,ve),fe(this.builder,ve))}},gO=class o7 extends yO{constructor(){super(...arguments),this.vertex=new $O,this.fragment=new $O,this.attributes=new bO,this.varyings=new wO,this.extensions=new xO,this.constants=new TO,this.outputs=new SO}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(fe){const ve=this.extensions.generateSource(fe),_e=this.attributes.generateSource(fe),be=this.varyings.generateSource(fe),we="vertex"===fe?this.vertex:this.fragment,Se=we.uniforms.generateSource(),Te=we.code.generateSource(),Ee="vertex"===fe?PO:EO,Ce=this.constants.generateSource().concat(we.constants.generateSource()),Oe=this.outputs.generateSource(fe);return`#version 300 es\n${ve.join("\n")}\n\n${Ee}\n\n${Ce.join("\n")}\n\n${Se.join("\n")}\n\n${_e.join("\n")}\n\n${be.join("\n")}\n\n${Oe.join("\n")}\n\n${Te.join("\n")}`}generateBindPass(fe){const ve=new Map;this.vertex.uniforms.entries.forEach((fe=>{const _e=fe.bind[oO.Pass];_e&&ve.set(fe.name,_e)})),this.fragment.uniforms.entries.forEach((fe=>{const _e=fe.bind[oO.Pass];_e&&ve.set(fe.name,_e)}));const _e=Array.from(ve.values()),be=_e.length;return(ve,we)=>{for(let Se=0;Se<be;++Se)_e[Se](fe,ve,we)}}generateBindDraw(fe){const ve=new Map;this.vertex.uniforms.entries.forEach((fe=>{const _e=fe.bind[oO.Draw];_e&&ve.set(fe.name,_e)})),this.fragment.uniforms.entries.forEach((fe=>{const _e=fe.bind[oO.Draw];_e&&ve.set(fe.name,_e)}));const _e=Array.from(ve.values()),be=_e.length;return(ve,we,Se)=>{for(let Te=0;Te<be;++Te)_e[Te](fe,ve,we,Se)}}},vO=class a5{constructor(fe){this._stage=fe,this._entries=new Map}add(...fe){for(const ve of fe)this._add(ve);return this._stage}get(fe){return this._entries.get(fe)}_add(fe){if(null!=fe){if(this._entries.has(fe.name)&&!this._entries.get(fe.name).equals(fe))throw new Ir(`Duplicate uniform name ${fe.name} for different uniform type`);this._entries.set(fe.name,fe)}else ar.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((fe=>null!=fe.arraySize?`uniform ${fe.type} ${fe.name}[${fe.arraySize}];`:`uniform ${fe.type} ${fe.name};`))}get entries(){return Array.from(this._entries.values())}},_O=class c15{constructor(fe){this._stage=fe,this._entries=new Array}add(fe){return this._entries.push(fe),this._stage}generateSource(){return this._entries}},$O=class u3 extends yO{constructor(){super(...arguments),this.uniforms=new vO(this),this.code=new _O(this),this.constants=new TO}get builder(){return this}},bO=class h4{constructor(){this._entries=new Array}add(fe,ve){this._entries.push([fe,ve])}generateSource(fe){return"fragment"===fe?[]:this._entries.map((fe=>`in ${fe[1]} ${fe[0]};`))}},wO=class m9{constructor(){this._entries=new Map}add(fe,ve){this._entries.has(fe)&&s$31(this._entries.get(fe)===ve),this._entries.set(fe,ve)}generateSource(fe){const ve=new Array;return this._entries.forEach(((_e,be)=>ve.push("vertex"===fe?`out ${_e} ${be};`:`in ${_e} ${be};`))),ve}},xO=class _2{constructor(){this._entries=new Set}add(fe){this._entries.add(fe)}generateSource(fe){const ve="vertex"===fe?_2.ALLOWLIST_VERTEX:_2.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((fe=>ve.includes(fe))).map((fe=>`#extension ${fe} : enable`))}};xO.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],xO.ALLOWLIST_VERTEX=[];let SO=class l7{constructor(){this._entries=new Map}add(fe,ve,_e=0){const be=this._entries.get(_e);be?s$31(be.name===fe&&be.type===ve,`Fragment shader output location ${_e} occupied`):this._entries.set(_e,{name:fe,type:ve})}generateSource(fe){if("vertex"===fe)return[];0===this._entries.size&&this._entries.set(0,{name:l7.DEFAULT_NAME,type:l7.DEFAULT_TYPE});const ve=new Array;return this._entries.forEach(((fe,_e)=>ve.push(`layout(location = ${_e}) out ${fe.type} ${fe.name};`))),ve}};SO.DEFAULT_TYPE="vec4",SO.DEFAULT_NAME="fragColor";let TO=class d7{constructor(){this._entries=new Set}add(fe,ve,_e){let be="ERROR_CONSTRUCTOR_STRING";switch(ve){case"float":be=d7._numberToFloatStr(_e);break;case"int":be=d7._numberToIntStr(_e);break;case"bool":be=_e.toString();break;case"vec2":be=`vec2(${d7._numberToFloatStr(_e[0])},                            ${d7._numberToFloatStr(_e[1])})`;break;case"vec3":be=`vec3(${d7._numberToFloatStr(_e[0])},                            ${d7._numberToFloatStr(_e[1])},                            ${d7._numberToFloatStr(_e[2])})`;break;case"vec4":be=`vec4(${d7._numberToFloatStr(_e[0])},                            ${d7._numberToFloatStr(_e[1])},                            ${d7._numberToFloatStr(_e[2])},                            ${d7._numberToFloatStr(_e[3])})`;break;case"ivec2":be=`ivec2(${d7._numberToIntStr(_e[0])},                             ${d7._numberToIntStr(_e[1])})`;break;case"ivec3":be=`ivec3(${d7._numberToIntStr(_e[0])},                             ${d7._numberToIntStr(_e[1])},                             ${d7._numberToIntStr(_e[2])})`;break;case"ivec4":be=`ivec4(${d7._numberToIntStr(_e[0])},                             ${d7._numberToIntStr(_e[1])},                             ${d7._numberToIntStr(_e[2])},                             ${d7._numberToIntStr(_e[3])})`;break;case"mat2":case"mat3":case"mat4":be=`${ve}(${Array.prototype.map.call(_e,(fe=>d7._numberToFloatStr(fe))).join(", ")})`}return this._entries.add(`const ${ve} ${fe} = ${be};`),this}static _numberToIntStr(fe){return fe.toFixed(0)}static _numberToFloatStr(fe){return Number.isInteger(fe)?fe.toFixed(1):fe.toString()}generateSource(){return Array.from(this._entries)}};const EO="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",PO="precision highp float;\nprecision highp sampler2D;";let CO=class s18 extends aO{constructor(fe,ve){super(fe,"sampler2D",oO.Pass,((_e,be,we)=>_e.bindTexture(fe,ve(be,we))))}};const OO=r$3y(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),AO=r$3y(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),MO=r$3y(parseFloat(Number(OO[0]+AO[0]).toFixed(6)),parseFloat(Number(OO[1]+AO[1]).toFixed(6)),parseFloat(Number(OO[2]+AO[2]).toFixed(6)));function S$1i(fe){const ve=new gO;ve.attributes.add(nO.POSITION,"vec2"),ve.include(o$2O,{textureCoordinateType:sO.Default}),ve.varyings.add("worldRay","vec3"),ve.varyings.add("eyeDir","vec3");const{vertex:_e,fragment:be}=ve;return _e.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix)),new pO("inverseViewMatrix",((fe,ve)=>e$3H(RO,ve.camera.viewMatrix)))),_e.code.add(o$2P`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),be.uniforms.add(new uO("backgroundColor",(fe=>fe.backgroundColor)),new lO("radii",(fe=>fe.radii)),new uO("cameraPosition",((fe,ve)=>ve.camera.eye)),new hO("heightParameters",(fe=>fe.heightParameters)),new dO("innerFadeDistance",(fe=>fe.innerFadeDistance)),new dO("altitudeFade",(fe=>fe.altitudeFade)),new CO("depthTexture",(fe=>fe.depthTexture)),new dO("hazeStrength",(fe=>fe.hazeStrength))),be.constants.add("betaRayleigh","vec3",OO),be.constants.add("betaCombined","vec3",MO),be.constants.add("betaMie","float",3996e-9),be.constants.add("scaleHeight","float",8500),t$34(be),ve.include(e$31),fe.haze&&be.include(c$2X),be.code.add(o$2P`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),be.code.add(o$2P`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),be.code.add(o$2P`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),be.code.add(o$2P`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${fe.haze?o$2P`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${fe.haze?"":o$2P`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${fe.haze?"":o$2P`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${fe.haze?o$2P`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:o$2P`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${fe.haze?"":o$2P`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${fe.haze&&fe.reduced?o$2P`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${fe.haze?o$2P`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${fe.reduced?o$2P`cameraSpaceRay *= -textureBilinear(vuv0);`:o$2P`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:o$2P`${fe.reduced?"":o$2P`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${fe.haze?o$2P`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:o$2P`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${fe.haze?"":o$2P`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),ve}const RO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],IO=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:OO,build:S$1i},Symbol.toStringTag,{value:"Module"}));let LO=class t18{constructor(fe,ve){this._module=fe,this._loadModule=ve}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var DO,NO,FO,zO,kO,UO,VO,BO,jO,GO,HO,qO,WO,YO,ZO,XO,JO,QO,KO,eA,tA;(tA=DO||(DO={}))[tA.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",tA[tA.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",tA[tA.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",function(fe){fe[fe.POINTS=0]="POINTS",fe[fe.LINES=1]="LINES",fe[fe.LINE_LOOP=2]="LINE_LOOP",fe[fe.LINE_STRIP=3]="LINE_STRIP",fe[fe.TRIANGLES=4]="TRIANGLES",fe[fe.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",fe[fe.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(NO||(NO={})),function(fe){fe[fe.ZERO=0]="ZERO",fe[fe.ONE=1]="ONE",fe[fe.SRC_COLOR=768]="SRC_COLOR",fe[fe.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",fe[fe.SRC_ALPHA=770]="SRC_ALPHA",fe[fe.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",fe[fe.DST_ALPHA=772]="DST_ALPHA",fe[fe.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",fe[fe.DST_COLOR=774]="DST_COLOR",fe[fe.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",fe[fe.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",fe[fe.CONSTANT_COLOR=32769]="CONSTANT_COLOR",fe[fe.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",fe[fe.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",fe[fe.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(FO||(FO={})),function(fe){fe[fe.ADD=32774]="ADD",fe[fe.MIN=32775]="MIN",fe[fe.MAX=32776]="MAX",fe[fe.SUBTRACT=32778]="SUBTRACT",fe[fe.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(zO||(zO={})),function(fe){fe[fe.ARRAY_BUFFER=34962]="ARRAY_BUFFER",fe[fe.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",fe[fe.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",fe[fe.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",fe[fe.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",fe[fe.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",fe[fe.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",fe[fe.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(kO||(kO={})),function(fe){fe[fe.FRONT=1028]="FRONT",fe[fe.BACK=1029]="BACK",fe[fe.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(UO||(UO={})),function(fe){fe[fe.CW=2304]="CW",fe[fe.CCW=2305]="CCW"}(VO||(VO={})),function(fe){fe[fe.BYTE=5120]="BYTE",fe[fe.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",fe[fe.SHORT=5122]="SHORT",fe[fe.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",fe[fe.INT=5124]="INT",fe[fe.UNSIGNED_INT=5125]="UNSIGNED_INT",fe[fe.FLOAT=5126]="FLOAT",fe[fe.HALF_FLOAT=5131]="HALF_FLOAT"}(BO||(BO={})),function(fe){fe[fe.NEVER=512]="NEVER",fe[fe.LESS=513]="LESS",fe[fe.EQUAL=514]="EQUAL",fe[fe.LEQUAL=515]="LEQUAL",fe[fe.GREATER=516]="GREATER",fe[fe.NOTEQUAL=517]="NOTEQUAL",fe[fe.GEQUAL=518]="GEQUAL",fe[fe.ALWAYS=519]="ALWAYS"}(jO||(jO={})),function(fe){fe[fe.ZERO=0]="ZERO",fe[fe.KEEP=7680]="KEEP",fe[fe.REPLACE=7681]="REPLACE",fe[fe.INCR=7682]="INCR",fe[fe.DECR=7683]="DECR",fe[fe.INVERT=5386]="INVERT",fe[fe.INCR_WRAP=34055]="INCR_WRAP",fe[fe.DECR_WRAP=34056]="DECR_WRAP"}(GO||(GO={})),function(fe){fe[fe.NEAREST=9728]="NEAREST",fe[fe.LINEAR=9729]="LINEAR",fe[fe.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",fe[fe.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",fe[fe.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",fe[fe.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(HO||(HO={})),function(fe){fe[fe.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",fe[fe.REPEAT=10497]="REPEAT",fe[fe.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(qO||(qO={})),function(fe){fe[fe.TEXTURE_2D=3553]="TEXTURE_2D",fe[fe.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",fe[fe.TEXTURE_3D=32879]="TEXTURE_3D",fe[fe.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",fe[fe.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",fe[fe.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",fe[fe.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",fe[fe.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",fe[fe.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",fe[fe.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(WO||(WO={})),function(fe){fe[fe.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",fe[fe.DEPTH_STENCIL=34041]="DEPTH_STENCIL",fe[fe.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",fe[fe.ALPHA=6406]="ALPHA",fe[fe.RGB=6407]="RGB",fe[fe.RGBA=6408]="RGBA",fe[fe.LUMINANCE=6409]="LUMINANCE",fe[fe.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",fe[fe.RED=6403]="RED",fe[fe.RG=33319]="RG",fe[fe.RED_INTEGER=36244]="RED_INTEGER",fe[fe.RG_INTEGER=33320]="RG_INTEGER",fe[fe.RGB_INTEGER=36248]="RGB_INTEGER",fe[fe.RGBA_INTEGER=36249]="RGBA_INTEGER"}(YO||(YO={})),function(fe){fe[fe.RGBA4=32854]="RGBA4",fe[fe.R16F=33325]="R16F",fe[fe.RG16F=33327]="RG16F",fe[fe.RGB32F=34837]="RGB32F",fe[fe.RGBA16F=34842]="RGBA16F",fe[fe.R32F=33326]="R32F",fe[fe.RG32F=33328]="RG32F",fe[fe.RGBA32F=34836]="RGBA32F",fe[fe.R11F_G11F_B10F=35898]="R11F_G11F_B10F",fe[fe.RGB8=32849]="RGB8",fe[fe.RGBA8=32856]="RGBA8",fe[fe.RGB5_A1=32855]="RGB5_A1",fe[fe.R8=33321]="R8",fe[fe.RG8=33323]="RG8",fe[fe.R8I=33329]="R8I",fe[fe.R8UI=33330]="R8UI",fe[fe.R16I=33331]="R16I",fe[fe.R16UI=33332]="R16UI",fe[fe.R32I=33333]="R32I",fe[fe.R32UI=33334]="R32UI",fe[fe.RG8I=33335]="RG8I",fe[fe.RG8UI=33336]="RG8UI",fe[fe.RG16I=33337]="RG16I",fe[fe.RG16UI=33338]="RG16UI",fe[fe.RG32I=33339]="RG32I",fe[fe.RG32UI=33340]="RG32UI",fe[fe.RGB16F=34843]="RGB16F",fe[fe.RGB9_E5=35901]="RGB9_E5",fe[fe.SRGB8=35905]="SRGB8",fe[fe.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",fe[fe.RGB565=36194]="RGB565",fe[fe.RGBA32UI=36208]="RGBA32UI",fe[fe.RGB32UI=36209]="RGB32UI",fe[fe.RGBA16UI=36214]="RGBA16UI",fe[fe.RGB16UI=36215]="RGB16UI",fe[fe.RGBA8UI=36220]="RGBA8UI",fe[fe.RGB8UI=36221]="RGB8UI",fe[fe.RGBA32I=36226]="RGBA32I",fe[fe.RGB32I=36227]="RGB32I",fe[fe.RGBA16I=36232]="RGBA16I",fe[fe.RGB16I=36233]="RGB16I",fe[fe.RGBA8I=36238]="RGBA8I",fe[fe.RGB8I=36239]="RGB8I",fe[fe.R8_SNORM=36756]="R8_SNORM",fe[fe.RG8_SNORM=36757]="RG8_SNORM",fe[fe.RGB8_SNORM=36758]="RGB8_SNORM",fe[fe.RGBA8_SNORM=36759]="RGBA8_SNORM",fe[fe.RGB10_A2=32857]="RGB10_A2",fe[fe.RGB10_A2UI=36975]="RGB10_A2UI"}(ZO||(ZO={})),function(fe){fe[fe.FLOAT=5126]="FLOAT",fe[fe.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",fe[fe.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",fe[fe.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",fe[fe.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",fe[fe.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",fe[fe.BYTE=5120]="BYTE",fe[fe.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",fe[fe.SHORT=5122]="SHORT",fe[fe.UNSIGNED_INT=5125]="UNSIGNED_INT",fe[fe.INT=5124]="INT",fe[fe.HALF_FLOAT=5131]="HALF_FLOAT",fe[fe.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",fe[fe.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",fe[fe.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",fe[fe.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(XO||(XO={})),function(fe){fe[fe.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",fe[fe.STENCIL_INDEX8=36168]="STENCIL_INDEX8",fe[fe.DEPTH_STENCIL=34041]="DEPTH_STENCIL",fe[fe.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",fe[fe.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",fe[fe.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",fe[fe.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(JO||(JO={})),function(fe){fe[fe.STATIC_DRAW=35044]="STATIC_DRAW",fe[fe.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",fe[fe.STREAM_DRAW=35040]="STREAM_DRAW",fe[fe.STATIC_READ=35045]="STATIC_READ",fe[fe.DYNAMIC_READ=35049]="DYNAMIC_READ",fe[fe.STREAM_READ=35041]="STREAM_READ",fe[fe.STATIC_COPY=35046]="STATIC_COPY",fe[fe.DYNAMIC_COPY=35050]="DYNAMIC_COPY",fe[fe.STREAM_COPY=35042]="STREAM_COPY"}(QO||(QO={})),function(fe){fe[fe.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",fe[fe.VERTEX_SHADER=35633]="VERTEX_SHADER"}(KO||(KO={})),function(fe){fe[fe.FRAMEBUFFER=36160]="FRAMEBUFFER",fe[fe.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",fe[fe.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(eA||(eA={}));const rA=33984;var iA,nA,sA;!function(fe){fe[fe.Texture=0]="Texture",fe[fe.BufferObject=1]="BufferObject",fe[fe.VertexArrayObject=2]="VertexArrayObject",fe[fe.Shader=3]="Shader",fe[fe.Program=4]="Program",fe[fe.FramebufferObject=5]="FramebufferObject",fe[fe.Renderbuffer=6]="Renderbuffer",fe[fe.TransformFeedback=7]="TransformFeedback",fe[fe.Sync=8]="Sync",fe[fe.UNCOUNTED=9]="UNCOUNTED",fe[fe.LinesOfCode=9]="LinesOfCode",fe[fe.Uniform=10]="Uniform",fe[fe.COUNT=11]="COUNT"}(iA||(iA={})),function(fe){fe[fe.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",fe[fe.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",fe[fe.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",fe[fe.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",fe[fe.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",fe[fe.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",fe[fe.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",fe[fe.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",fe[fe.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",fe[fe.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",fe[fe.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",fe[fe.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",fe[fe.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",fe[fe.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",fe[fe.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",fe[fe.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(nA||(nA={})),function(fe){fe[fe.NONE=0]="NONE",fe[fe.BACK=1029]="BACK"}(sA||(sA={}));const oA=33306;var aA,lA,cA,uA,hA,dA,pA;!function(fe){fe[fe.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",fe[fe.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",fe[fe.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",fe[fe.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",fe[fe.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",fe[fe.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",fe[fe.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",fe[fe.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",fe[fe.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",fe[fe.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",fe[fe.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",fe[fe.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",fe[fe.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",fe[fe.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(aA||(aA={})),function(fe){fe[fe.FLOAT=5126]="FLOAT",fe[fe.FLOAT_VEC2=35664]="FLOAT_VEC2",fe[fe.FLOAT_VEC3=35665]="FLOAT_VEC3",fe[fe.FLOAT_VEC4=35666]="FLOAT_VEC4",fe[fe.INT=5124]="INT",fe[fe.INT_VEC2=35667]="INT_VEC2",fe[fe.INT_VEC3=35668]="INT_VEC3",fe[fe.INT_VEC4=35669]="INT_VEC4",fe[fe.BOOL=35670]="BOOL",fe[fe.BOOL_VEC2=35671]="BOOL_VEC2",fe[fe.BOOL_VEC3=35672]="BOOL_VEC3",fe[fe.BOOL_VEC4=35673]="BOOL_VEC4",fe[fe.FLOAT_MAT2=35674]="FLOAT_MAT2",fe[fe.FLOAT_MAT3=35675]="FLOAT_MAT3",fe[fe.FLOAT_MAT4=35676]="FLOAT_MAT4",fe[fe.SAMPLER_2D=35678]="SAMPLER_2D",fe[fe.SAMPLER_CUBE=35680]="SAMPLER_CUBE",fe[fe.UNSIGNED_INT=5125]="UNSIGNED_INT",fe[fe.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",fe[fe.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",fe[fe.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",fe[fe.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",fe[fe.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",fe[fe.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",fe[fe.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",fe[fe.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",fe[fe.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",fe[fe.SAMPLER_3D=35679]="SAMPLER_3D",fe[fe.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",fe[fe.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",fe[fe.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",fe[fe.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",fe[fe.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",fe[fe.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",fe[fe.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",fe[fe.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",fe[fe.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",fe[fe.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",fe[fe.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",fe[fe.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(lA||(lA={})),function(fe){fe[fe.OBJECT_TYPE=37138]="OBJECT_TYPE",fe[fe.SYNC_CONDITION=37139]="SYNC_CONDITION",fe[fe.SYNC_STATUS=37140]="SYNC_STATUS",fe[fe.SYNC_FLAGS=37141]="SYNC_FLAGS"}(cA||(cA={})),function(fe){fe[fe.UNSIGNALED=37144]="UNSIGNALED",fe[fe.SIGNALED=37145]="SIGNALED"}(uA||(uA={})),function(fe){fe[fe.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",fe[fe.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",fe[fe.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",fe[fe.WAIT_FAILED=37149]="WAIT_FAILED"}(hA||(hA={})),function(fe){fe[fe.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(dA||(dA={})),function(fe){fe[fe.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(pA||(pA={}));let fA=class r6{constructor(fe,ve,_e){this.release=_e,this.initializeConfiguration(fe,ve),this._configuration=ve.snapshot(),this._program=this.initializeProgram(fe),this._pipeline=this.initializePipeline(fe)}destroy(){this._program=r$3M(this._program),this._pipeline=this._configuration=null}reload(fe){r$3M(this._program),this._program=this.initializeProgram(fe),this._pipeline=this.initializePipeline(fe)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(fe){this.program.assertCompatibleVertexAttributeLocations(fe)}get primitiveType(){return NO.TRIANGLES}getPipeline(fe,ve,_e){return this._pipeline}initializeConfiguration(fe,ve){}};const mA=new Map([[nO.POSITION,0],[nO.NORMAL,1],[nO.NORMALCOMPRESSED,1],[nO.UV0,2],[nO.COLOR,3],[nO.COLORFEATUREATTRIBUTE,3],[nO.SIZE,4],[nO.TANGENT,4],[nO.CENTEROFFSETANDDISTANCE,5],[nO.SYMBOLCOLOR,5],[nO.FEATUREATTRIBUTE,6],[nO.INSTANCEFEATUREATTRIBUTE,6],[nO.INSTANCECOLOR,7],[nO.OBJECTANDLAYERIDCOLOR,7],[nO.INSTANCEOBJECTANDLAYERIDCOLOR,7],[nO.INSTANCEMODEL,8],[nO.INSTANCEMODELNORMAL,12],[nO.INSTANCEMODELORIGINHI,11],[nO.INSTANCEMODELORIGINLO,15]]);const yA=!!has("enable-feature:webgl-debug");function a$2Y(){return yA}function c$2T(){return yA}function u$2F(fe){if(a$2Y()){const ve=fe.getError();if(ve){const _e=function t$31(fe,ve){switch(ve){case fe.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case fe.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case fe.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case fe.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case fe.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case fe.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(fe,ve),be=(new Error).stack;ar.getLogger("esri.views.webgl.checkWebGLError").error(new Ir("webgl-error","WebGL error occurred",{message:_e,stack:be}))}}}let gA=class r7{constructor(fe,ve,_e){this._context=fe,this._locations=_e,this._textures=new Map,this._freeTextureUnits=new jr({deallocator:null}),this._glProgram=fe.programCache.acquire(ve.generate("vertex"),ve.generate("fragment"),_e),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=ve.generateBindPass(this),this.bindDraw=ve.generateBindDraw(this),this._fragmentUniforms=a$2Y()?ve.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(fe,ve){this._glProgram.setUniform1i(fe,ve?1:0)}setUniform1i(fe,ve){this._glProgram.setUniform1i(fe,ve)}setUniform1f(fe,ve){this._glProgram.setUniform1f(fe,ve)}setUniform2fv(fe,ve){this._glProgram.setUniform2fv(fe,ve)}setUniform3fv(fe,ve){this._glProgram.setUniform3fv(fe,ve)}setUniform4fv(fe,ve){this._glProgram.setUniform4fv(fe,ve)}setUniformMatrix3fv(fe,ve){this._glProgram.setUniformMatrix3fv(fe,ve)}setUniformMatrix4fv(fe,ve){this._glProgram.setUniformMatrix4fv(fe,ve)}setUniform1fv(fe,ve){this._glProgram.setUniform1fv(fe,ve)}setUniform1iv(fe,ve){this._glProgram.setUniform1iv(fe,ve)}setUniform2iv(fe,ve){this._glProgram.setUniform3iv(fe,ve)}setUniform3iv(fe,ve){this._glProgram.setUniform3iv(fe,ve)}setUniform4iv(fe,ve){this._glProgram.setUniform4iv(fe,ve)}assertCompatibleVertexAttributeLocations(fe){fe.locations,this._locations}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(fe,ve){if(null==(null==ve?void 0:ve.glName)){const ve=this._textures.get(fe);return ve&&(this._context.bindTexture(null,ve.unit),this._freeTextureUnit(ve),this._textures.delete(fe)),null}let _e=this._textures.get(fe);return null==_e?(_e=this._allocTextureUnit(ve),this._textures.set(fe,_e)):_e.texture=ve,this._context.useProgram(this),this.setUniform1i(fe,_e.unit),this._context.bindTexture(ve,_e.unit),_e.unit}rebindTextures(){var fe;this._context.useProgram(this),this._textures.forEach(((fe,ve)=>{this._context.bindTexture(fe.texture,fe.unit),this.setUniform1i(ve,fe.unit)})),null==(fe=this._fragmentUniforms)||fe.forEach((fe=>{"sampler2D"!==fe.type&&"samplerCube"!==fe.type||this._textures.has(fe.name)}))}_allocTextureUnit(fe){return{texture:fe,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(fe){this._freeTextureUnits.push(fe.unit)}};var vA,_A,$A,bA,wA,xA,SA,TA,EA;function s$2Z(fe,ve,_e=zO.ADD,be=[0,0,0,0]){return{srcRgb:fe,srcAlpha:fe,dstRgb:ve,dstAlpha:ve,opRgb:_e,opAlpha:_e,color:{r:be[0],g:be[1],b:be[2],a:be[3]}}}function l$2_(fe,ve,_e,be,we=zO.ADD,Se=zO.ADD,Te=[0,0,0,0]){return{srcRgb:fe,srcAlpha:ve,dstRgb:_e,dstAlpha:be,opRgb:we,opAlpha:Se,color:{r:Te[0],g:Te[1],b:Te[2],a:Te[3]}}}!function(fe){fe[fe.None=0]="None",fe[fe.Front=1]="Front",fe[fe.Back=2]="Back",fe[fe.COUNT=3]="COUNT"}(vA||(vA={})),function(fe){fe[fe.Less=0]="Less",fe[fe.Lequal=1]="Lequal",fe[fe.COUNT=2]="COUNT"}(_A||(_A={})),function(fe){fe[fe.BACKGROUND=0]="BACKGROUND",fe[fe.UPDATE=1]="UPDATE"}($A||($A={})),function(fe){fe[fe.NOT_LOADED=0]="NOT_LOADED",fe[fe.LOADING=1]="LOADING",fe[fe.LOADED=2]="LOADED"}(bA||(bA={})),function(fe){fe[fe.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",fe[fe.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(wA||(wA={})),function(fe){fe[fe.Highlight=0]="Highlight",fe[fe.MaskOccludee=1]="MaskOccludee",fe[fe.COUNT=2]="COUNT"}(xA||(xA={})),function(fe){fe[fe.Blend=0]="Blend",fe[fe.Opaque=1]="Opaque",fe[fe.Mask=2]="Mask",fe[fe.MaskBlend=3]="MaskBlend",fe[fe.COUNT=4]="COUNT"}(SA||(SA={})),function(fe){fe[fe.OFF=0]="OFF",fe[fe.ON=1]="ON"}(TA||(TA={})),function(fe){fe.DDS_ENCODING="image/vnd-ms.dds",fe.KTX2_ENCODING="image/ktx2",fe.BASIS_ENCODING="image/x.basis"}(EA||(EA={}));const PA={face:UO.BACK,mode:VO.CCW},CA={face:UO.FRONT,mode:VO.CCW},h$1V=fe=>fe===vA.Back?PA:fe===vA.Front?CA:null,OA={zNear:0,zFar:1},AA={r:!0,g:!0,b:!0,a:!0};function c$2S(fe){return RA.intern(fe)}function d$28(fe){return IA.intern(fe)}function u$2D(fe){return LA.intern(fe)}function f$26(fe){return DA.intern(fe)}function p$2Y(fe){return NA.intern(fe)}function g$1I(fe){return FA.intern(fe)}function v$1j(fe){return zA.intern(fe)}function I$1a(fe){return kA.intern(fe)}function W$y(fe){return UA.intern(fe)}function S$1g(fe){return VA.intern(fe)}let MA=class b4{constructor(fe,ve){this._makeKey=fe,this._makeRef=ve,this._interns=new Map}intern(fe){if(!fe)return null;const ve=this._makeKey(fe),_e=this._interns;return _e.has(ve)||_e.set(ve,this._makeRef(fe)),_e.get(ve)??null}};function T$Y(fe){return"["+fe.join(",")+"]"}const RA=new MA(B$I,(fe=>({__tag:"Blending",...fe})));function B$I(fe){return fe?T$Y([fe.srcRgb,fe.srcAlpha,fe.dstRgb,fe.dstAlpha,fe.opRgb,fe.opAlpha,fe.color.r,fe.color.g,fe.color.b,fe.color.a]):null}const IA=new MA(y$1x,(fe=>({__tag:"Culling",...fe})));function y$1x(fe){return fe?T$Y([fe.face,fe.mode]):null}const LA=new MA(C$12,(fe=>({__tag:"PolygonOffset",...fe})));function C$12(fe){return fe?T$Y([fe.factor,fe.units]):null}const DA=new MA(A$1c,(fe=>({__tag:"DepthTest",...fe})));function A$1c(fe){return fe?T$Y([fe.func]):null}const NA=new MA(k$12,(fe=>({__tag:"StencilTest",...fe})));function k$12(fe){return fe?T$Y([fe.function.func,fe.function.ref,fe.function.mask,fe.operation.fail,fe.operation.zFail,fe.operation.zPass]):null}const FA=new MA(z$N,(fe=>({__tag:"DepthWrite",...fe})));function z$N(fe){return fe?T$Y([fe.zNear,fe.zFar]):null}const zA=new MA(j$19,(fe=>({__tag:"ColorWrite",...fe})));function j$19(fe){return fe?T$Y([fe.r,fe.g,fe.b,fe.a]):null}const kA=new MA(N$S,(fe=>({__tag:"StencilWrite",...fe})));function N$S(fe){return fe?T$Y([fe.mask]):null}const UA=new MA(M$$,(fe=>({__tag:"DrawBuffers",...fe})));function M$$(fe){return fe?T$Y(fe.buffers):null}const VA=new MA((function E$1h(fe){return fe?T$Y([B$I(fe.blending),y$1x(fe.culling),C$12(fe.polygonOffset),A$1c(fe.depthTest),k$12(fe.stencilTest),z$N(fe.depthWrite),j$19(fe.colorWrite),N$S(fe.stencilWrite),M$$(fe.drawBuffers)]):null}),(fe=>({blending:c$2S(fe.blending),culling:d$28(fe.culling),polygonOffset:u$2D(fe.polygonOffset),depthTest:f$26(fe.depthTest),stencilTest:p$2Y(fe.stencilTest),depthWrite:g$1I(fe.depthWrite),colorWrite:v$1j(fe.colorWrite),stencilWrite:I$1a(fe.stencilWrite),drawBuffers:W$y(fe.drawBuffers)})));let BA=class G{constructor(fe){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=fe}setPipeline(fe){(this._pipelineInvalid||fe!==this._pipeline)&&(this._setBlending(fe.blending),this._setCulling(fe.culling),this._setPolygonOffset(fe.polygonOffset),this._setDepthTest(fe.depthTest),this._setStencilTest(fe.stencilTest),this._setDepthWrite(fe.depthWrite),this._setColorWrite(fe.colorWrite),this._setStencilWrite(fe.stencilWrite),this._setDrawBuffers(fe.drawBuffers),this._pipeline=fe),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(fe){this._blending=this._setSubState(fe,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(fe){this._culling=this._setSubState(fe,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(fe){this._polygonOffset=this._setSubState(fe,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(fe){this._depthTest=this._setSubState(fe,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(fe){this._stencilTest=this._setSubState(fe,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(fe){this._depthWrite=this._setSubState(fe,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(fe){this._colorWrite=this._setSubState(fe,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(fe){this._stencilWrite=this._setSubState(fe,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(fe){this._drawBuffers=this._setSubState(fe,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(fe,ve,_e,be){return(_e||fe!==ve)&&(be(fe),this._pipelineInvalid=!0),fe}},jA=class u4 extends iO{constructor(){super(...arguments),this.heightParameters=[0,0,0,0],this.radii=[0,0],this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=[0,0],this.backgroundColor=[0,0,0]}},GA=class p15 extends fA{initializeProgram(fe){return new gA(fe.rctx,p15.shader.get().build(this.configuration),mA)}initializePipeline(){return this.configuration.reduced?S$1g({blending:s$2Z(FO.ONE,FO.ZERO),depthTest:{func:jO.ALWAYS},colorWrite:AA}):this.configuration.haze?S$1g({blending:l$2_(FO.ONE,FO.ZERO,FO.ONE_MINUS_SRC_COLOR,FO.ONE),colorWrite:AA}):S$1g({blending:s$2Z(FO.SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};GA.shader=new LO(IO,(()=>zt((()=>Promise.resolve().then((()=>YMe))),void 0)));let HA=class t19 extends iO{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const fe=this._parameterNames,ve={key:this.key};for(const _e of fe)ve[_e]=this[_e];return ve}};function r$2w(fe={}){return(ve,_e)=>{if(ve._parameterNames=ve._parameterNames??[],ve._parameterNames.push(_e),null!=fe.constValue)Object.defineProperty(ve,_e,{get:()=>fe.constValue});else{const be=ve._parameterNames.length-1,we=fe.count||2,Se=Math.ceil(Math.log2(we)),Te=ve._parameterBits??[0];let Ee=0;for(;Te[Ee]+Se>16;)Ee++,Ee>=Te.length&&Te.push(0);ve._parameterBits=Te;const Ce=Te[Ee],Oe=(1<<Se)-1<<Ce;Te[Ee]+=Se,Object.defineProperty(ve,_e,{get(){return this[be]},set(fe){if(this[be]!==fe&&(this[be]=fe,this._keyDirty=!0,this._parameterBits[Ee]=this._parameterBits[Ee]&~Oe|+fe<<Ce&Oe,"number"!=typeof fe&&"boolean"!=typeof fe))throw new Error("Configuration value for "+_e+" must be boolean or number, got "+typeof fe)}})}}}let qA=class o8 extends HA{constructor(){super(...arguments),this.haze=!1}};e$4o([r$2w()],qA.prototype,"haze",void 0);let WA=class t20 extends qA{constructor(){super(...arguments),this.reduced=!1}};var YA,ZA,XA;e$4o([r$2w()],WA.prototype,"reduced",void 0),(XA=YA||(YA={}))[XA.RED=0]="RED",XA[XA.RG=1]="RG",XA[XA.RGBA4=2]="RGBA4",XA[XA.RGBA=3]="RGBA",XA[XA.RGBA_MIPMAP=4]="RGBA_MIPMAP",XA[XA.R16F=5]="R16F",XA[XA.RGBA16F=6]="RGBA16F",function(fe){fe[fe.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",fe[fe.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(ZA||(ZA={}));let JA=class t21{constructor(fe,ve,_e,be,we,Se=!1,Te=0){this.name=fe,this.count=ve,this.type=_e,this.offset=be,this.stride=we,this.normalized=Se,this.divisor=Te}};new JA(nO.POSITION,3,BO.FLOAT,0,12);const QA=[new JA(nO.POSITION,2,BO.FLOAT,0,8)],KA=[new JA(nO.POSITION,2,BO.FLOAT,0,16),new JA(nO.UV0,2,BO.FLOAT,8,16)];function s$2Y(fe){switch(fe){case BO.BYTE:case BO.UNSIGNED_BYTE:return 1;case BO.SHORT:case BO.UNSIGNED_SHORT:case BO.HALF_FLOAT:return 2;case BO.FLOAT:case BO.INT:case BO.UNSIGNED_INT:return 4}}function o$2E(fe){const ve=fe.gl;switch(ve.getError()){case ve.NO_ERROR:return null;case ve.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case ve.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case ve.INVALID_OPERATION:return"The specified command is not allowed for the current state";case ve.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case ve.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case ve.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function i$2T(fe,ve){return fe.vertexBuffers[ve].usedMemory/function R$U(fe){return fe[0].stride}(fe.layout[ve])}function E$1f(fe,ve,_e,be,we=0){var Se;const Te=fe.gl;fe.bindBuffer(_e);for(const Ee of be){const _e=ve.get(Ee.name);if(void 0===_e)continue;const be=we*Ee.stride;if(Ee.count<=4)Te.vertexAttribPointer(_e,Ee.count,Ee.type,Ee.normalized,Ee.stride,Ee.offset+be),Te.enableVertexAttribArray(_e),Ee.divisor>0&&fe.gl.vertexAttribDivisor(_e,Ee.divisor);else if(9===Ee.count)for(let ve=0;ve<3;ve++)Te.vertexAttribPointer(_e+ve,3,Ee.type,Ee.normalized,Ee.stride,Ee.offset+12*ve+be),Te.enableVertexAttribArray(_e+ve),Ee.divisor>0&&fe.gl.vertexAttribDivisor(_e+ve,Ee.divisor);else if(16===Ee.count)for(let ve=0;ve<4;ve++)Te.vertexAttribPointer(_e+ve,4,Ee.type,Ee.normalized,Ee.stride,Ee.offset+16*ve+be),Te.enableVertexAttribArray(_e+ve),Ee.divisor>0&&(null==(Se=fe.gl)||Se.vertexAttribDivisor(_e+ve,Ee.divisor));if(a$2Y()){o$2E(fe);const ve=s$2Y(Ee.type),_e=Ee.offset;Math.round(ve/_e)}}}function _$_(fe,ve,_e,be){var we,Se,Te;const Ee=fe.gl;fe.bindBuffer(_e);for(const Ce of be){const _e=ve.get(Ce.name);if(Ce.count<=4)Ee.disableVertexAttribArray(_e),Ce.divisor&&Ce.divisor>0&&(null==(we=fe.gl)||we.vertexAttribDivisor(_e,0));else if(9===Ce.count)for(let ve=0;ve<3;ve++)Ee.disableVertexAttribArray(_e+ve),Ce.divisor&&Ce.divisor>0&&(null==(Se=fe.gl)||Se.vertexAttribDivisor(_e+ve,0));else if(16===Ce.count)for(let ve=0;ve<4;ve++)Ee.disableVertexAttribArray(_e+ve),Ce.divisor&&Ce.divisor>0&&(null==(Te=fe.gl)||Te.vertexAttribDivisor(_e+ve,0))}fe.unbindBuffer(kO.ARRAY_BUFFER)}function u$2B(fe){switch(fe){case YO.ALPHA:case YO.LUMINANCE:case YO.RED:case YO.RED_INTEGER:case ZO.R8:case ZO.R8I:case ZO.R8UI:case ZO.R8_SNORM:case JO.STENCIL_INDEX8:return 1;case YO.LUMINANCE_ALPHA:case YO.RG:case YO.RG_INTEGER:case ZO.RGBA4:case ZO.R16F:case ZO.R16I:case ZO.R16UI:case ZO.RG8:case ZO.RG8I:case ZO.RG8UI:case ZO.RG8_SNORM:case ZO.RGB565:case ZO.RGB5_A1:case JO.DEPTH_COMPONENT16:return 2;case YO.DEPTH_COMPONENT:case YO.RGB:case YO.RGB_INTEGER:case ZO.RGB8:case ZO.RGB8I:case ZO.RGB8UI:case ZO.RGB8_SNORM:case ZO.SRGB8:case JO.DEPTH_COMPONENT24:return 3;case YO.DEPTH_STENCIL:case YO.DEPTH24_STENCIL8:case YO.RGBA:case YO.RGBA_INTEGER:case ZO.RGBA8:case ZO.R32F:case ZO.R11F_G11F_B10F:case ZO.RG16F:case ZO.R32I:case ZO.R32UI:case ZO.RG16I:case ZO.RG16UI:case ZO.RGBA8I:case ZO.RGBA8UI:case ZO.RGBA8_SNORM:case ZO.SRGB8_ALPHA8:case ZO.RGB9_E5:case ZO.RGB10_A2UI:case ZO.RGB10_A2:case JO.DEPTH_STENCIL:case JO.DEPTH_COMPONENT32F:case JO.DEPTH24_STENCIL8:return 4;case JO.DEPTH32F_STENCIL8:return 5;case ZO.RGB16F:case ZO.RGB16I:case ZO.RGB16UI:return 6;case ZO.RG32F:case ZO.RG32I:case ZO.RG32UI:case ZO.RGBA16F:case ZO.RGBA16I:case ZO.RGBA16UI:return 8;case ZO.RGB32F:case ZO.RGB32I:case ZO.RGB32UI:return 12;case ZO.RGBA32F:case ZO.RGBA32I:case ZO.RGBA32UI:return 16;case aA.COMPRESSED_RGB_S3TC_DXT1_EXT:case aA.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case aA.COMPRESSED_RGBA_S3TC_DXT3_EXT:case aA.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case aA.COMPRESSED_R11_EAC:case aA.COMPRESSED_SIGNED_R11_EAC:case aA.COMPRESSED_RGB8_ETC2:case aA.COMPRESSED_SRGB8_ETC2:case aA.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case aA.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case aA.COMPRESSED_RG11_EAC:case aA.COMPRESSED_SIGNED_RG11_EAC:case aA.COMPRESSED_RGBA8_ETC2_EAC:case aA.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const n$30=()=>ar.getLogger("esri.views.webgl.VertexArrayObject");let eM=class o9{constructor(fe,ve,_e,be,we=null){this._context=fe,this._locations=ve,this._layout=_e,this._buffers=be,this._indexBuffer=we,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((fe,ve)=>fe+this._buffers[ve].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*tr}dispose(){var fe;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const ve in this._buffers)null==(fe=this._buffers[ve])||fe.dispose(),delete this._buffers[ve];this._indexBuffer=r$3M(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&n$30().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(iA.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:fe}=this._context,ve=fe.createVertexArray();fe.bindVertexArray(ve),this._bindLayout(),fe.bindVertexArray(null),this._glName=ve,this._context.instanceCounter.increment(iA.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:fe,_layout:ve,_indexBuffer:_e}=this;fe||n$30().error("Vertex buffer dictionary is empty!");const be=this._context.gl;for(const we in fe){const _e=fe[we];_e||n$30().error("Vertex buffer is uninitialized!");const be=ve[we];be||n$30().error("Vertex element descriptor is empty!"),E$1f(this._context,this._locations,_e,be)}null!=_e&&be.bindBuffer(be.ELEMENT_ARRAY_BUFFER,_e.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},tM=class r8 extends eM{};const f$25=()=>ar.getLogger("esri.views.webgl.BufferObject");let rM=class c16{static createIndex(fe,ve,_e){return new c16(fe,kO.ELEMENT_ARRAY_BUFFER,ve,_e)}static createVertex(fe,ve,_e){return new c16(fe,kO.ARRAY_BUFFER,ve,_e)}static createUniform(fe,ve,_e){return new c16(fe,kO.UNIFORM_BUFFER,ve,_e)}static createPixelPack(fe,ve=QO.STREAM_READ,_e){const be=new c16(fe,kO.PIXEL_PACK_BUFFER,ve);return _e&&be.setSize(_e),be}static createPixelUnpack(fe,ve=QO.STREAM_DRAW,_e){return new c16(fe,kO.PIXEL_UNPACK_BUFFER,ve,_e)}static createTransformFeedback(fe,ve=QO.STATIC_DRAW,_e){const be=new c16(fe,kO.TRANSFORM_FEEDBACK_BUFFER,ve);return be.setSize(_e),be}constructor(fe,ve,_e,be){this._context=fe,this.bufferType=ve,this.usage=_e,this._glName=null,this._size=-1,this._indexType=void 0,fe.instanceCounter.increment(iA.BufferObject,this),this._glName=this._context.gl.createBuffer(),u$2F(this._context.gl),be&&this.setData(be)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===kO.ELEMENT_ARRAY_BUFFER?this._indexType===BO.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===kO.ELEMENT_ARRAY_BUFFER||this.bufferType===kO.ARRAY_BUFFER}dispose(){var fe;(null==(fe=this._context)?void 0:fe.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(iA.BufferObject,this),this._context=null):this._glName&&f$25().warn("Leaked WebGL buffer object")}setSize(fe,ve=null){if(this.bufferType===kO.ELEMENT_ARRAY_BUFFER&&null!=ve)switch(this._indexType=ve,ve){case BO.UNSIGNED_SHORT:fe*=2;break;case BO.UNSIGNED_INT:fe*=4}this._setBufferData(fe)}setData(fe){if(!fe)return;let ve=fe.byteLength;this.bufferType===kO.ELEMENT_ARRAY_BUFFER&&(i$4W(fe)&&(ve/=2,this._indexType=BO.UNSIGNED_SHORT),f$3z(fe)&&(ve/=4,this._indexType=BO.UNSIGNED_INT)),this._setBufferData(ve,fe)}_setBufferData(fe,ve=null){this._size=fe;const _e=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const be=this._context.gl;null!=ve?be.bufferData(this.bufferType,ve,this.usage):be.bufferData(this.bufferType,fe,this.usage),u$2F(be),this._isVAOAware&&this._context.bindVAO(_e)}setSubData(fe,ve,_e,be){if(!fe)return;const we=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:Se}=this._context;Se.bufferSubData(this.bufferType,ve*fe.BYTES_PER_ELEMENT,fe,_e,be-_e),u$2F(Se),this._isVAOAware&&this._context.bindVAO(we)}getSubData(fe,ve=0,_e,be){if(_e<0||be<0)return;const we=function o$2C(fe){return function m$3W(fe){return fe&&"number"==typeof fe.length}(fe)}(fe)?fe.BYTES_PER_ELEMENT:1;if(we*((_e??0)+(be??0))>fe.byteLength)return;ve+we*(be??0)>this.usedMemory&&f$25().warn("Potential problem getting subdata: requested data exceeds buffer size!");const Se=this._context.gl;this.bufferType===kO.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,kO.TRANSFORM_FEEDBACK_BUFFER),Se.getBufferSubData(kO.TRANSFORM_FEEDBACK_BUFFER,ve,fe,_e,be),this._context.unbindBuffer(kO.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,kO.COPY_READ_BUFFER),Se.getBufferSubData(kO.COPY_READ_BUFFER,ve,fe,_e,be),this._context.unbindBuffer(kO.COPY_READ_BUFFER))}async getSubDataAsync(fe,ve=0,_e,be){await this._context.clientWaitAsync(),this.getSubData(fe,ve,_e,be)}};var iM;!function(fe){fe[fe.Texture=0]="Texture",fe[fe.RenderBuffer=1]="RenderBuffer"}(iM||(iM={}));let nM=class e13{constructor(fe=0,ve=fe){this.width=fe,this.height=ve,this.target=WO.TEXTURE_2D,this.pixelFormat=YO.RGBA,this.dataType=XO.UNSIGNED_BYTE,this.samplingMode=HO.LINEAR,this.wrapMode=qO.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};let sM=class a6 extends nM{constructor(fe,ve){switch(super(),this.context=fe,Object.assign(this,ve),this.internalFormat){case ZO.R16F:case ZO.R16I:case ZO.R16UI:case ZO.R32F:case ZO.R32I:case ZO.R32UI:case ZO.R8_SNORM:case ZO.R8:case ZO.R8I:case ZO.R8UI:this.pixelFormat=YO.RED}}static validate(fe,ve){return new a6(fe,ve)}};let oM=class l8{constructor(fe,ve=null,_e=null){if(this.type=iM.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in fe)this._descriptor=fe,_e=ve;else{const _e=sM.validate(fe,ve);if(!_e)throw new Ir("Texture descriptor invalid");this._descriptor=_e}this._descriptor.target===WO.TEXTURE_CUBE_MAP?this._setDataCubeMap(_e):this.setData(_e)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return function r$2u(fe){return fe.width<=0||fe.height<=0?0:Math.round(fe.width*fe.height*(fe.hasMipmap?4/3:1)*(null==fe.internalFormat?4:u$2B(fe.internalFormat)))}(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(iA.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(fe,ve){const _e=this._descriptor;if(_e.width!==fe||_e.height!==ve){if(this._wasImmutablyAllocated)throw new Ir("Immutable textures can't be resized!");_e.width=fe,_e.height=ve,this._descriptor.target===WO.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(fe=null){for(let ve=WO.TEXTURE_CUBE_MAP_POSITIVE_X;ve<=WO.TEXTURE_CUBE_MAP_NEGATIVE_Z;ve++)this._setData(fe,ve)}setData(fe){this._setData(fe)}_setData(fe,ve){var _e;if(!(null==(_e=this._descriptor.context)?void 0:_e.gl))return;const be=this._descriptor.context.gl;u$2F(be),this._glName||(this._glName=be.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(iA.Texture,this)),void 0===fe&&(fe=null);const we=this._descriptor,Se=ve??we.target,Te=R$T(Se);null===fe&&(we.width=we.width||4,we.height=we.height||4,Te&&(we.depth=we.depth??1));const Ee=this._descriptor.context.bindTexture(this,l8.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(l8.TEXTURE_UNIT_FOR_UPDATES),u$2A(we),this._configurePixelStorage(),u$2F(be);const Ce=this._deriveInternalFormat();if(f$24(fe)){let ve="width"in fe?fe.width:fe.codedWidth,_e="height"in fe?fe.height:fe.codedHeight;const Ee=1;fe instanceof HTMLVideoElement&&(ve=fe.videoWidth,_e=fe.videoHeight),we.width&&we.height,Te&&we.depth,we.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(Se,Ce,we.hasMipmap,ve,_e,Ee),this._texImage(Se,0,Ce,ve,_e,Ee,fe),u$2F(be),we.hasMipmap&&this.generateMipmap(),we.width||(we.width=ve),we.height||(we.height=_e),Te&&!we.depth&&(we.depth=Ee)}else{const{width:ve,height:_e,depth:Ee}=we;if(null==ve||null==_e)throw new Ir("Width and height must be specified!");if(Te&&null==Ee)throw new Ir("Depth must be specified!");if(we.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(Se,Ce,we.hasMipmap,ve,_e,Ee),A$1b(fe)){const Te=fe.levels,Oe=w$1i(Se,ve,_e,Ee),Re=Math.min(Oe-1,Te.length-1);be.texParameteri(we.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,Re);const De=Ce;if(!function M$_(fe){return fe in aA}(De))throw new Ir("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((fe,ve,_e,be)=>{const we=Te[Math.min(fe,Te.length-1)];this._compressedTexImage(Se,fe,De,ve,_e,be,we)}),Re)}else this._texImage(Se,0,Ce,ve,_e,Ee,fe),u$2F(be),we.hasMipmap&&this.generateMipmap()}T$X(be,this._descriptor),g$1H(be,this._descriptor),function E$1e(fe,ve){const _e=fe.capabilities.textureFilterAnisotropic;if(!_e)return;fe.gl.texParameterf(ve.target,_e.TEXTURE_MAX_ANISOTROPY,ve.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),u$2F(be),this._descriptor.context.bindTexture(Ee,l8.TEXTURE_UNIT_FOR_UPDATES)}updateData(fe,ve,_e,be,we,Se,Te=0){this._glName;const Ee=this._descriptor,Ce=this._deriveInternalFormat(),{context:Oe,pixelFormat:Re,dataType:De,target:Be,isImmutable:Ze}=Ee;if(Ze&&!this._wasImmutablyAllocated)throw new Ir("Cannot update immutable texture before allocation!");const Xe=Oe.bindTexture(this,l8.TEXTURE_UNIT_FOR_UPDATES,!0);ve<0||_e<0||ve+be>Ee.width||Ee.height,this._configurePixelStorage();const{gl:Je}=Oe;Te&&Je.pixelStorei(Je.UNPACK_SKIP_ROWS,Te),f$24(Se)?Je.texSubImage2D(Be,fe,ve,_e,be,we,Re,De,Se):A$1b(Se)?Je.compressedTexSubImage2D(Be,fe,ve,_e,be,we,Ce,Se.levels[fe]):Je.texSubImage2D(Be,fe,ve,_e,be,we,Re,De,Se),Te&&Je.pixelStorei(Je.UNPACK_SKIP_ROWS,0),Oe.bindTexture(Xe,l8.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(fe,ve,_e,be,we,Se,Te,Ee){this._glName;const Ce=this._descriptor,Oe=this._deriveInternalFormat(),{context:Re,pixelFormat:De,dataType:Be,isImmutable:Ze,target:Xe}=Ce;if(Ze&&!this._wasImmutablyAllocated)throw new Ir("Cannot update immutable texture before allocation!");R$T(Xe);const Je=Re.bindTexture(this,l8.TEXTURE_UNIT_FOR_UPDATES);Re.setActiveTexture(l8.TEXTURE_UNIT_FOR_UPDATES),ve<0||_e<0||be<0||ve+we>Ce.width||_e+Se>Ce.height||Ce.depth,this._configurePixelStorage();const{gl:Qe}=Re;if(A$1b(Ee))Ee=Ee.levels[fe],Qe.compressedTexSubImage3D(Xe,fe,ve,_e,be,we,Se,Te,Oe,Ee);else{const Ce=Ee;Qe.texSubImage3D(Xe,fe,ve,_e,be,we,Se,Te,De,Be,Ce)}Re.bindTexture(Je,l8.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const fe=this._descriptor;if(!fe.hasMipmap){if(this._wasImmutablyAllocated)throw new Ir("Cannot add mipmaps to immutable texture after allocation");fe.hasMipmap=!0,this._samplingModeDirty=!0,u$2A(fe)}fe.samplingMode===HO.LINEAR?(this._samplingModeDirty=!0,fe.samplingMode=HO.LINEAR_MIPMAP_NEAREST):fe.samplingMode===HO.NEAREST&&(this._samplingModeDirty=!0,fe.samplingMode=HO.NEAREST_MIPMAP_NEAREST);const ve=this._descriptor.context.bindTexture(this,l8.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(l8.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(fe.target),this._descriptor.context.bindTexture(ve,l8.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const fe=this._descriptor;if(fe.hasMipmap){if(this._wasImmutablyAllocated)throw new Ir("Cannot delete mipmaps to immutable texture after allocation");fe.hasMipmap=!1,this._samplingModeDirty=!0,u$2A(fe)}fe.samplingMode===HO.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,fe.samplingMode=HO.LINEAR):fe.samplingMode===HO.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,fe.samplingMode=HO.NEAREST)}setSamplingMode(fe){fe!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=fe,this._samplingModeDirty=!0)}setWrapMode(fe){fe!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=fe,u$2A(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const fe=this._descriptor,ve=fe.context.gl;this._samplingModeDirty&&(T$X(ve,fe),this._samplingModeDirty=!1),this._wrapModeDirty&&(g$1H(ve,fe),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===YO.DEPTH_STENCIL&&(this._descriptor.internalFormat=YO.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case XO.FLOAT:switch(this._descriptor.pixelFormat){case YO.RGBA:return this._descriptor.internalFormat=ZO.RGBA32F;case YO.RGB:return this._descriptor.internalFormat=ZO.RGB32F;default:throw new Ir("Unable to derive format")}case XO.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case YO.RGBA:return this._descriptor.internalFormat=ZO.RGBA8;case YO.RGB:return this._descriptor.internalFormat=ZO.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===YO.DEPTH_STENCIL?YO.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const fe=this._descriptor.context.gl,{unpackAlignment:ve,flipped:_e,preMultiplyAlpha:be}=this._descriptor;fe.pixelStorei(fe.UNPACK_ALIGNMENT,ve),fe.pixelStorei(fe.UNPACK_FLIP_Y_WEBGL,_e?1:0),fe.pixelStorei(fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,be?1:0)}_texStorage(fe,ve,_e,be,we,Se){const{gl:Te}=this._descriptor.context;if(!function x$1d(fe){return fe in ZO}(ve))throw new Ir("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const Ee=_e?w$1i(fe,be,we,Se):1;if(R$T(fe)){if(null==Se)throw new Ir("Missing depth dimension for 3D texture upload");Te.texStorage3D(fe,Ee,ve,be,we,Se)}else Te.texStorage2D(fe,Ee,ve,be,we);this._wasImmutablyAllocated=!0}_texImage(fe,ve,_e,be,we,Se,Te){const Ee=this._descriptor.context.gl,Ce=R$T(fe),{isImmutable:Oe,pixelFormat:Re,dataType:De}=this._descriptor;if(Oe){if(null!=Te){const _e=Te;if(Ce){if(null==Se)throw new Ir("Missing depth dimension for 3D texture upload");Ee.texSubImage3D(fe,ve,0,0,0,be,we,Se,Re,De,_e)}else Ee.texSubImage2D(fe,ve,0,0,be,we,Re,De,_e)}}else{const Oe=Te;if(Ce){if(null==Se)throw new Ir("Missing depth dimension for 3D texture upload");Ee.texImage3D(fe,ve,_e,be,we,Se,0,Re,De,Oe)}else Ee.texImage2D(fe,ve,_e,be,we,0,Re,De,Oe)}}_compressedTexImage(fe,ve,_e,be,we,Se,Te){const Ee=this._descriptor.context.gl,Ce=R$T(fe);if(this._descriptor.isImmutable){if(null!=Te)if(Ce){if(null==Se)throw new Ir("Missing depth dimension for 3D texture upload");Ee.compressedTexSubImage3D(fe,ve,0,0,0,be,we,Se,_e,Te)}else Ee.compressedTexSubImage2D(fe,ve,0,0,be,we,_e,Te)}else if(Ce){if(null==Se)throw new Ir("Missing depth dimension for 3D texture upload");Ee.compressedTexImage3D(fe,ve,_e,be,we,Se,0,Te)}else Ee.compressedTexImage2D(fe,ve,_e,be,we,0,Te)}_forEachMipmapLevel(fe,ve=1/0){let{width:_e,height:be,depth:we,hasMipmap:Se,target:Te}=this._descriptor;const Ee=Te===WO.TEXTURE_3D;if(null==_e||null==be||Ee&&null==we)throw new Ir("Missing texture dimensions for mipmap calculation");for(let Ce=0;fe(Ce,_e,be,we),Se&&(1!==_e||1!==be||Ee&&1!==we)&&!(Ce>=ve);++Ce)_e=Math.max(1,_e>>1),be=Math.max(1,be>>1),Ee&&(we=Math.max(1,we>>1))}};function u$2A(fe){null!=fe.width&&fe.width<0||null!=fe.height&&fe.height<0||null!=fe.depth&&fe.depth}function T$X(fe,ve){let _e=ve.samplingMode,be=ve.samplingMode;_e===HO.LINEAR_MIPMAP_NEAREST||_e===HO.LINEAR_MIPMAP_LINEAR?(_e=HO.LINEAR,ve.hasMipmap||(be=HO.LINEAR)):_e!==HO.NEAREST_MIPMAP_NEAREST&&_e!==HO.NEAREST_MIPMAP_LINEAR||(_e=HO.NEAREST,ve.hasMipmap||(be=HO.NEAREST)),fe.texParameteri(ve.target,fe.TEXTURE_MAG_FILTER,_e),fe.texParameteri(ve.target,fe.TEXTURE_MIN_FILTER,be)}function g$1H(fe,ve){"number"==typeof ve.wrapMode?(fe.texParameteri(ve.target,fe.TEXTURE_WRAP_S,ve.wrapMode),fe.texParameteri(ve.target,fe.TEXTURE_WRAP_T,ve.wrapMode)):(fe.texParameteri(ve.target,fe.TEXTURE_WRAP_S,ve.wrapMode.s),fe.texParameteri(ve.target,fe.TEXTURE_WRAP_T,ve.wrapMode.t))}function A$1b(fe){return null!=fe&&"type"in fe&&"compressed"===fe.type}function f$24(fe){return null!=fe&&!A$1b(fe)&&!function I$19(fe){return null!=fe&&"byteLength"in fe}(fe)}function R$T(fe){return fe===WO.TEXTURE_3D||fe===WO.TEXTURE_2D_ARRAY}function w$1i(fe,ve,_e,be=1){let we=Math.max(ve,_e);return fe===WO.TEXTURE_3D&&(we=Math.max(we,be)),Math.round(Math.log(we)/Math.LN2)+1}function i$2S(fe,ve=QA,_e=mA,be=-1,we=1){let Se=null;return Se=ve===KA?new Float32Array([be,be,0,0,we,be,1,0,be,we,0,1,we,we,1,1]):new Float32Array([be,be,we,be,be,we,we,we]),new tM(fe,_e,{geometry:ve},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,Se)})}oM.TEXTURE_UNIT_FOR_UPDATES=0;function a$2U(fe){const ve=new nM(4);return ve.samplingMode=HO.NEAREST,new oM(fe,ve)}function n$2$(fe){return 16*Math.ceil(fe/16)}function i$2R(fe){return 16*Math.floor(fe/16)}function r$2t(fe,ve){let _e=fe.width*fe.height;if(_e<4096)return fe instanceof ImageData?a$2T(fe):fe;let be=fe.width,we=fe.height;do{be=Math.ceil(be/2),we=Math.ceil(we/2),_e=be*we}while(_e>1048576||null!=ve&&(be>ve||we>ve));return o$2B(fe,be,we)}function o$2B(fe,ve,_e){if(fe instanceof ImageData)return o$2B(a$2T(fe),ve,_e);const be=document.createElement("canvas");return be.width=ve,be.height=_e,be.getContext("2d").drawImage(fe,0,0,be.width,be.height),be}function a$2T(fe){const ve=document.createElement("canvas");ve.width=fe.width,ve.height=fe.height;const _e=ve.getContext("2d");if(null==_e)throw new Ir("Failed to create 2d context from HTMLCanvasElement");return _e.putImageData(fe,0,0),ve}function o$2A(fe,ve=!0){fe.attributes.add(nO.POSITION,"vec2"),ve&&fe.varyings.add("uv","vec2"),fe.vertex.code.add(o$2P`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${ve?o$2P`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let aM=class a7 extends iO{};function n$2_(fe){const ve=new gO;ve.include(o$2A),ve.fragment.uniforms.add(new CO("colorTexture",(fe=>fe.color)),new CO("depthTexture",(fe=>fe.depth)));const _e=fe.haze;return ve.fragment.code.add(o$2P`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${_e?o$2P`== 1.0`:o$2P`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),ve}const lM=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:aM,build:n$2_},Symbol.toStringTag,{value:"Module"}));let cM=class p16 extends fA{initializeProgram(fe){return new gA(fe.rctx,p16.shader.get().build(this.configuration),mA)}initializePipeline(){return this.configuration.haze?S$1g({blending:l$2_(FO.ONE,FO.ZERO,FO.ONE_MINUS_SRC_COLOR,FO.ONE),depthTest:{func:jO.ALWAYS},colorWrite:AA}):S$1g({blending:s$2Z(FO.SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:jO.ALWAYS},colorWrite:AA})}};cM.shader=new LO(lM,(()=>zt((()=>Promise.resolve().then((()=>ZMe))),void 0)));let uM=class B2{constructor(fe,ve){this._view=fe,this._context=ve,this.type=jC.Realistic,this._handles=new jt,this._compositingPassParameters=new aM,this._passParameters=new jA,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Rn.radius,this._fadeHaze=0,this._updateRadius(Rn.radius);const _e=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this._view)?void 0:fe.basemapTerrain)?void 0:ve.rootTileElevationBounds}),(()=>{var fe;return(null==(fe=this._view)?void 0:fe.basemapTerrain)?this._updateRootTileElevationBounds():null})),d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this._view)?void 0:fe.basemapTerrain)?void 0:ve.visibleElevationBounds}),(()=>{var fe;return(null==(fe=this._view)?void 0:fe.basemapTerrain)?this._updateVisibleElevationBounds():null})),d$3d((()=>{var fe;return null==(fe=this._view)?void 0:fe.environment.background}),(fe=>{const ve=fe instanceof AC?E$1l(fe.color):_d;o$44(this._passParameters.backgroundColor,ve[0]*ve[3],ve[1]*ve[3],ve[2]*ve[3])}),Ja)]);const be=new WA;be.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(GA,be),this._compositingTechnique=this._context.techniques.acquire(cM,be),be.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(GA,be),this._compositingHazeTechnique=this._context.techniques.acquire(cM,be),be.reduced=!0,be.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(GA,be),be.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(GA,be),this._vao=i$2S(_e,KA)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(fe,ve){this._render(fe,ve?this._atmosphereTechnique:this._atmosphereReducedTechnique,ve,!1)}renderHaze(fe,ve,_e){this._fadeHaze=ve,this._render(fe,_e?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,_e,!0)}_render(fe,ve,_e,be){const we=fe.bindParameters.mainDepth;if(!we)return;this._update(fe.bindParameters.camera),this._passParameters.depthTexture=we;const Se=fe.rctx.bindTechnique(ve,fe.bindParameters,this._passParameters),Te=fe.offscreenRenderingHelper;if(_e)Te.renderDepthDetached((()=>this._renderCommon(Se,fe)));else{const ve=fe.rctx.getViewport(),_e=s$4g(fe.bindParameters.camera.eye)-Rn.radius;let Ee;if(_e<rO){const fe=Math.min(1,Math.max(0,_e/rO));Ee=be?f$3i(.4,.5,fe):f$3i(.2,.3,fe)}else{const fe=Math.min(1,Math.max(0,(_e-rO)/15e5));Ee=be?f$3i(.5,1,fe):f$3i(.3,.6,fe)}const Ce=n$2$(Math.round(Ee*fe.bindParameters.camera.fullViewport[2])),Oe=n$2$(Math.round(Ee*fe.bindParameters.camera.fullViewport[3]));fe.rctx.setViewport(0,0,Ce,Oe);const Re=Te.renderToCachedFBO(null,be?"chapman haze":"chapman",(()=>this._renderCommon(Se,fe)),[0,0,0,1],YA.RGBA,null,Ce,Oe);fe.rctx.setViewport(ve.x,ve.y,ve.width,ve.height),this._compositingPassParameters.color=Re.getTexture(),this._compositingPassParameters.depth=we;const De=be?this._compositingHazeTechnique:this._compositingTechnique;fe.rctx.bindTechnique(De,fe.bindParameters,this._compositingPassParameters),Te.renderDepthDetached((()=>fe.rctx.screen.draw())),Re.release()}}_renderCommon(fe,ve){null!=this._vao&&(ve.rctx.bindVAO(this._vao),fe.assertCompatibleVertexAttributeLocations(this._vao),ve.rctx.drawArrays(NO.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const fe=this._view.basemapTerrain.rootTileElevationBounds.min;fe!==this._rootTileElevationMin&&(this._rootTileElevationMin=fe,this._lowerBoundEarthRadius=Rn.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const fe=function H$O(fe){return fe*Math.cos(Math.PI/16/16)}(Rn.radius+this._view.basemapTerrain.visibleElevationBounds.min);fe<this._lowerBoundEarthRadius&&this._updateRadius(fe)}_updateRadius(fe){this._lowerBoundEarthRadius=fe,o$2R(this._passParameters.radii,fe,fe+rO),this._passParameters.innerFadeDistance=2*Math.sqrt((2*fe-tO)*tO)}_update(fe){if(!fe)return;const ve=v$22(fe.eye),_e=Math.sqrt(ve),be=ve-this._passParameters.radii[1]*this._passParameters.radii[1],we=e$3Y((_e-this._passParameters.radii[0])/rO,0,1);s$3I(this._passParameters.heightParameters,_e,ve,be,we),this._passParameters.altitudeFade=e$34(_e-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=f$3i(f$3i(.6,1,p$4Y(9500,10500,_e-Rn.radius)),1,this._fadeHaze)}};function e$2T(fe){fe.fragment.code.add(o$2P`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function s$2X(fe,ve){switch(fe.include(o$2O,ve),ve.textureCoordinateType){case sO.Default:case sO.Compressed:return void fe.fragment.code.add(o$2P`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case sO.Atlas:return fe.include(e$2T),void fe.fragment.code.add(o$2P`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:ve.textureCoordinateType;case sO.None:case sO.COUNT:return}}let hM=class o10 extends aO{constructor(fe,ve){super(fe,"vec3",oO.Draw,((_e,be,we,Se)=>_e.setUniform3fv(fe,ve(be,we,Se))))}},dM=class s19 extends aO{constructor(fe,ve){super(fe,"sampler2D",oO.Draw,((_e,be,we)=>_e.bindTexture(fe,ve(be,we))))}},pM=class t22{constructor(fe){this._material=fe.material,this._techniques=fe.techniques,this._output=fe.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(fe,ve){return this._technique=this._techniques.releaseAndAcquire(fe,this._material.getConfiguration(this._output,ve),this._technique),this._technique}ensureResources(fe){return bA.LOADED}},fM=class u5 extends pM{constructor(fe){super(fe),this._numLoading=0,this._disposed=!1,this._textures=fe.textures,this._textureId=fe.textureId,this._acquire(fe.textureId,(fe=>this._texture=fe)),this._acquire(fe.normalTextureId,(fe=>this._textureNormal=fe)),this._acquire(fe.emissiveTextureId,(fe=>this._textureEmissive=fe)),this._acquire(fe.occlusionTextureId,(fe=>this._textureOcclusion=fe)),this._acquire(fe.metallicRoughnessTextureId,(fe=>this._textureMetallicRoughness=fe))}dispose(){this._texture=t$4r(this._texture),this._textureNormal=t$4r(this._textureNormal),this._textureEmissive=t$4r(this._textureEmissive),this._textureOcclusion=t$4r(this._textureOcclusion),this._textureMetallicRoughness=t$4r(this._textureMetallicRoughness),this._disposed=!0}ensureResources(fe){return 0===this._numLoading?bA.LOADED:bA.LOADING}get textureBindParameters(){return new mM(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(fe){null!=this._texture&&fe===this._texture.id||(this._texture=t$4r(this._texture),this._textureId=fe,this._acquire(this._textureId,(fe=>this._texture=fe)))}_acquire(fe,ve){if(null==fe)return void ve(null);const _e=this._textures.acquire(fe);if(S$1T(_e))return++this._numLoading,void _e.then((fe=>{if(this._disposed)return t$4r(fe),void ve(null);ve(fe)})).finally((()=>--this._numLoading));ve(_e)}},mM=class l9 extends iO{constructor(fe=null,ve=null,_e=null,be=null,we=null,Se,Te){super(),this.texture=fe,this.textureNormal=ve,this.textureEmissive=_e,this.textureOcclusion=be,this.textureMetallicRoughness=we,this.scale=Se,this.normalTextureTransformMatrix=Te}};var yM;function l$2X(fe,ve){const _e=fe.fragment,be=ve.hasMetallicRoughnessTexture||ve.hasEmissionTexture||ve.hasOcclusionTexture;if(ve.pbrMode===yM.Normal&&be&&fe.include(s$2X,ve),ve.pbrMode!==yM.Schematic)if(ve.pbrMode!==yM.Disabled){if(ve.pbrMode===yM.Normal){_e.code.add(o$2P`vec3 mrr;
vec3 emission;
float occlusion;`);const fe=ve.pbrTextureBindType;ve.hasMetallicRoughnessTexture&&(_e.uniforms.add(fe===oO.Pass?new CO("texMetallicRoughness",(fe=>fe.textureMetallicRoughness)):new dM("texMetallicRoughness",(fe=>fe.textureMetallicRoughness))),_e.code.add(o$2P`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),ve.hasEmissionTexture&&(_e.uniforms.add(fe===oO.Pass?new CO("texEmission",(fe=>fe.textureEmissive)):new dM("texEmission",(fe=>fe.textureEmissive))),_e.code.add(o$2P`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),ve.hasOcclusionTexture?(_e.uniforms.add(fe===oO.Pass?new CO("texOcclusion",(fe=>fe.textureOcclusion)):new dM("texOcclusion",(fe=>fe.textureOcclusion))),_e.code.add(o$2P`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):_e.code.add(o$2P`float getBakedOcclusion() { return 1.0; }`),fe===oO.Pass?_e.uniforms.add(new uO("emissionFactor",(fe=>fe.emissiveFactor)),new uO("mrrFactors",(fe=>fe.mrrFactors))):_e.uniforms.add(new hM("emissionFactor",(fe=>fe.emissiveFactor)),new hM("mrrFactors",(fe=>fe.mrrFactors))),_e.code.add(o$2P`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${ve.hasMetallicRoughnessTexture?o$2P`applyMetallnessAndRoughness(${ve.hasMetallicRoughnessTextureTransform?o$2P`metallicRoughnessUV`:"vuv0"});`:""}

      ${ve.hasEmissionTexture?o$2P`applyEmission(${ve.hasEmissiveTextureTransform?o$2P`emissiveUV`:"vuv0"});`:""}

      ${ve.hasOcclusionTexture?o$2P`applyOcclusion(${ve.hasOcclusionTextureTransform?o$2P`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else _e.code.add(o$2P`float getBakedOcclusion() { return 1.0; }`);else _e.code.add(o$2P`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function r$2s(fe,ve){const _e=fe.fragment,be=void 0!==ve.lightingSphericalHarmonicsOrder?ve.lightingSphericalHarmonicsOrder:2;0===be?(_e.uniforms.add(new uO("lightingAmbientSH0",((fe,ve)=>o$44(gM,ve.lighting.sh.r[0],ve.lighting.sh.g[0],ve.lighting.sh.b[0])))),_e.code.add(o$2P`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===be?(_e.uniforms.add(new hO("lightingAmbientSH_R",((fe,ve)=>s$3I(vM,ve.lighting.sh.r[0],ve.lighting.sh.r[1],ve.lighting.sh.r[2],ve.lighting.sh.r[3]))),new hO("lightingAmbientSH_G",((fe,ve)=>s$3I(vM,ve.lighting.sh.g[0],ve.lighting.sh.g[1],ve.lighting.sh.g[2],ve.lighting.sh.g[3]))),new hO("lightingAmbientSH_B",((fe,ve)=>s$3I(vM,ve.lighting.sh.b[0],ve.lighting.sh.b[1],ve.lighting.sh.b[2],ve.lighting.sh.b[3])))),_e.code.add(o$2P`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===be&&(_e.uniforms.add(new uO("lightingAmbientSH0",((fe,ve)=>o$44(gM,ve.lighting.sh.r[0],ve.lighting.sh.g[0],ve.lighting.sh.b[0]))),new hO("lightingAmbientSH_R1",((fe,ve)=>s$3I(vM,ve.lighting.sh.r[1],ve.lighting.sh.r[2],ve.lighting.sh.r[3],ve.lighting.sh.r[4]))),new hO("lightingAmbientSH_G1",((fe,ve)=>s$3I(vM,ve.lighting.sh.g[1],ve.lighting.sh.g[2],ve.lighting.sh.g[3],ve.lighting.sh.g[4]))),new hO("lightingAmbientSH_B1",((fe,ve)=>s$3I(vM,ve.lighting.sh.b[1],ve.lighting.sh.b[2],ve.lighting.sh.b[3],ve.lighting.sh.b[4]))),new hO("lightingAmbientSH_R2",((fe,ve)=>s$3I(vM,ve.lighting.sh.r[5],ve.lighting.sh.r[6],ve.lighting.sh.r[7],ve.lighting.sh.r[8]))),new hO("lightingAmbientSH_G2",((fe,ve)=>s$3I(vM,ve.lighting.sh.g[5],ve.lighting.sh.g[6],ve.lighting.sh.g[7],ve.lighting.sh.g[8]))),new hO("lightingAmbientSH_B2",((fe,ve)=>s$3I(vM,ve.lighting.sh.b[5],ve.lighting.sh.b[6],ve.lighting.sh.b[7],ve.lighting.sh.b[8])))),_e.code.add(o$2P`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),ve.pbrMode!==yM.Normal&&ve.pbrMode!==yM.Schematic||_e.code.add(o$2P`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}!function(fe){fe[fe.Disabled=0]="Disabled",fe[fe.Normal=1]="Normal",fe[fe.Schematic=2]="Schematic",fe[fe.Water=3]="Water",fe[fe.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",fe[fe.Simplified=5]="Simplified",fe[fe.TerrainWithWater=6]="TerrainWithWater",fe[fe.COUNT=7]="COUNT"}(yM||(yM={}));const gM=[0,0,0],vM=[0,0,0,0];function t$2X(fe){fe.vertex.code.add(o$2P`const float PI = 3.141592653589793;`),fe.fragment.code.add(o$2P`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var _M,$M;function b$1q(fe=bM){return[fe[0],fe[1],fe[2],fe[3]]}function q$H(fe,ve,_e=b$1q()){return r$3w(_e,fe),_e[3]=ve,_e}function d$26(fe,ve,_e=[0,0,0,0]){return _$1z(_e,fe,ve),z$1d(_e,_e),_e[3]=-w$1_(fe,ve),_e}function k$11(fe,ve=b$1q()){return B$G(ve,M$1x(v$1G(ve,j$1B(wM,fe)))),ve}function U$S(fe,ve,_e=b$1q()){return I$1q(wM,fe,A$1a(fe)),I$1q(xM,ve,A$1a(ve)),x$1u(wM,xM,wM),B$G(_e,M$1x(v$1G(_e,wM)))}function w$1h(fe,ve,_e,be=b$1q()){return q$H(Gi,fe,SM),q$H(Hi,ve,TM),q$H(qi,_e,EM),U$S(SM,TM,SM),U$S(SM,EM,be),be}function y$1w(fe){return fe}function z$M(fe){return fe[3]}function A$1a(fe){return h$2U(fe[3])}function B$G(fe,ve){return fe[3]=ve,fe}!function(fe){fe[fe.RENDERING=0]="RENDERING",fe[fe.FADING=1]="FADING",fe[fe.FINISHED=2]="FINISHED"}(_M||(_M={})),function(fe){fe[fe.RG=0]="RG",fe[fe.BA=1]="BA"}($M||($M={}));const bM=[0,0,1,0],wM=[0,0,0,1],xM=[0,0,0,1];b$1q();const SM=b$1q(),TM=b$1q(),EM=b$1q();var PM;!function(fe){fe[fe.ANIMATING=0]="ANIMATING",fe[fe.INTERACTING=1]="INTERACTING",fe[fe.IDLE=2]="IDLE"}(PM||(PM={}));let CM=class A3{constructor(){this.readChannels=$M.RG,this.renderingStage=_M.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=[0,0,0],this.parallax=new AM,this.parallaxNew=new AM,this.pointOnGround=[0,0,0],this.fadeMode=OM.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(fe){const ve=this.parallax,_e=s$4g(fe.eye);if(ve.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(_e*_e-Rn.radius*Rn.radius,0))/_e,d$26(MM,ve.anchorPointClouds,RM),b$21(ve.transform,dd,RM[3],RM),this.fadeMode===OM.CROSS_FADE){const fe=this.parallaxNew;d$26(MM,fe.anchorPointClouds,RM),b$21(fe.transform,dd,RM[3],RM)}}updateFading(fe,ve,_e,be){this.isFading&&this._advanceFading(_e,be),this._evaluateFading(fe,ve,_e)}_evaluateFading(fe,ve,_e){const be=fe.relativeElevation,we=this._calculateDistanceToAnchorPoint(fe);if((be>17e3||be<-wC||we>FM)&&this.opacity>0)this._setFade(OM.HIDE,_e);else if(!this.isFading)if((be>wC||be<-3500||we>NM)&&this.opacity>0)this._setFade(OM.FADE_OUT,_e);else if(be<=wC&&be>=-3500&&ve===PM.IDLE&&function N$R(fe){return null!=fe&&!fe.running}(this.data)){if(0===this.opacity)return void this._setFade(OM.FADE_IN,_e);(we>DM||this.renderingStage===_M.FADING)&&this._setFade(OM.CROSS_FADE,_e)}}_advanceFading(fe,ve){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(fe,ve)}_advanceFadingFactorAndOpacity(fe,ve){if(this.fadeFactor<1)return this.fadeFactor=ve?e$3Y((fe-this.startTime)/(LM*ve),0,1):1,this.fadeMode===OM.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===OM.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===OM.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===OM.FADE_OUT&&(this.opacity=0),this.fadeMode===OM.FADE_IN&&(this.opacity=1),this.fadeMode===OM.CROSS_FADE&&(this.opacity=1),this.fadeMode=OM.NONE}_switchReadChannels(){const fe=this.fadeMode===OM.CROSS_FADE&&1===this.fadeFactor,ve=this.fadeMode===OM.FADE_IN&&0===this.fadeFactor;this.renderingStage===_M.FADING&&(fe||ve)&&(this.readChannels=1-this.readChannels,this.renderingStage=_M.FINISHED)}_calculateDistanceToAnchorPoint(fe){return z$1d(this.pointOnGround,fe.eye),g$2z(this.pointOnGround,this.pointOnGround,Rn.radius),s$4g(e$3Z(IM,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===OM.CROSS_FADE&&(0===this.fadeFactor&&r$3w(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&r$3w(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===OM.FADE_IN&&0===this.fadeFactor&&r$3w(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(fe,ve){switch(fe){case OM.HIDE:this.opacity=0;break;case OM.FADE_OUT:this.opacity=1;break;case OM.FADE_IN:this.opacity=0;break;case OM.CROSS_FADE:this.opacity=1}this.fadeMode=fe,this.fadeFactor=0,this.startTime=ve}get isFading(){return this.fadeMode===OM.FADE_OUT||this.fadeMode===OM.FADE_IN||this.fadeMode===OM.CROSS_FADE}};var OM;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.HIDE=1]="HIDE",fe[fe.FADE_OUT=2]="FADE_OUT",fe[fe.FADE_IN=3]="FADE_IN",fe[fe.CROSS_FADE=4]="CROSS_FADE"}(OM||(OM={}));let AM=class C2{constructor(){this.anchorPointClouds=[0,0,0],this.radiusCurvatureCorrectionFactor=0,this.transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};const MM=r$3y(0,0,1),RM=b$1q(),IM=[0,0,0],LM=1.25,DM=34e3,NM=64e3,FM=2e5;let zM=class s20 extends aO{constructor(fe,ve){super(fe,"bool",oO.Pass,((_e,be,we)=>_e.setUniform1b(fe,ve(be,we))))}},kM=class s21 extends aO{constructor(fe,ve){super(fe,"samplerCube",oO.Pass,((_e,be,we)=>_e.bindTexture(fe,ve(be,we))))}};function v$1i(fe){const ve=fe.fragment;ve.uniforms.add(new pO("rotationMatrixClouds",((fe,ve)=>ve.cloudsFade.parallax.transform)),new pO("rotationMatrixCloudsCrossFade",((fe,ve)=>ve.cloudsFade.parallaxNew.transform)),new uO("anchorPosition",((fe,ve)=>ve.cloudsFade.parallax.anchorPointClouds)),new uO("anchorPositionCrossFade",((fe,ve)=>ve.cloudsFade.parallaxNew.anchorPointClouds)),new dO("cloudsHeight",(()=>xC)),new dO("radiusCurvatureCorrectionFactor",((fe,ve)=>ve.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new dO("totalFadeInOut",((fe,ve)=>1-ve.cloudsFade.opacity)),new dO("crossFadeAnchorFactor",((fe,ve)=>e$3Y(ve.cloudsFade.fadeFactor,0,1))),new kM("cubeMap",((fe,ve)=>{var _e,be;return(null==(be=null==(_e=ve.cloudsFade.data)?void 0:_e.cubeMap)?void 0:be.colorTexture)??null})),new zM("crossFade",((fe,ve)=>ve.cloudsFade.fadeMode===OM.CROSS_FADE)),new zM("readChannelsRG",((fe,ve)=>ve.cloudsFade.readChannels===$M.RG)),new zM("fadeTextureChannels",((fe,ve)=>ve.cloudsFade.renderingStage===_M.FADING))),ve.constants.add("planetRadius","float",Rn.radius),ve.code.add(o$2P`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),ve.code.add(o$2P`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),ve.code.add(o$2P`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t$34(ve),a$2$(ve),ve.code.add(o$2P`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),ve.code.add(o$2P`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),ve.code.add(o$2P`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),ve.code.add(o$2P`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),ve.code.add(o$2P`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function e$2S(fe){fe.code.add(o$2P`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function v$1h(){const fe=new gO,{attributes:ve,varyings:_e,vertex:be,fragment:we}=fe;return ve.add(nO.POSITION,"vec2"),_e.add("worldRay","vec3"),be.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix)),new pO("inverseViewMatrix",((fe,ve)=>e$3H(UM,ve.camera.viewMatrix)))),be.code.add(o$2P`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),we.include(e$2S),we.include(a$32),fe.include(r$2s,{pbrMode:yM.Disabled,lightingSphericalHarmonicsOrder:2}),fe.include(t$2X),fe.include(e$31),fe.include(o$2N),fe.include(v$1i),we.uniforms.add(new uO("cameraPosition",((fe,ve)=>ve.camera.eye))),we.code.add(o$2P`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),fe}const UM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],VM=Object.freeze(Object.defineProperty({__proto__:null,build:v$1h},Symbol.toStringTag,{value:"Module"}));let BM=class u6 extends fA{constructor(fe){super(fe,new HA,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,u6.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.ONE,FO.ZERO,FO.SRC_ALPHA,FO.ONE),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};BM.shader=new LO(VM,(()=>zt((()=>Promise.resolve().then((()=>XMe))),void 0)));let jM=class m10 extends zi{constructor(fe){super(fe),this._technique=new BM(fe),this._vao=i$2S(fe.rctx)}destroy(){this._technique=t$4r(this._technique),this._vao=r$3M(this._vao)}render(fe){if(!this._technique.compiled)return void this.requestRender();const ve=fe.bindParameters.cloudsFade;if(null==this._vao||null==ve.data)return;const _e=fe.rctx.bindTechnique(this._technique,fe.bindParameters,GM);fe.rctx.bindVAO(this._vao),_e.assertCompatibleVertexAttributeLocations(this._vao),fe.rctx.drawArrays(NO.TRIANGLE_STRIP,0,4)}};e$4o([y$2v({constructOnly:!0})],jM.prototype,"rctx",void 0),e$4o([y$2v({constructOnly:!0})],jM.prototype,"viewingMode",void 0),e$4o([y$2v({constructOnly:!0})],jM.prototype,"planetRadius",void 0),e$4o([y$2v({constructOnly:!0})],jM.prototype,"requestRender",void 0),jM=e$4o([a$4y("esri.views.3d.environment.CloudsComposition")],jM);const GM=new iO;function n$2Y(){return new Float32Array(3)}function t$2W(fe){const ve=new Float32Array(3);return ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[2],ve}function r$2r(fe,ve,_e){const be=new Float32Array(3);return be[0]=fe,be[1]=ve,be[2]=_e,be}function o$2y(){return n$2Y()}function u$2u(){return r$2r(1,1,1)}function c$2O(){return r$2r(1,0,0)}function i$2Q(){return r$2r(0,1,0)}function a$2Q(){return r$2r(0,0,1)}const HM=o$2y(),qM=u$2u(),WM=c$2O(),YM=i$2Q(),ZM=a$2Q();var XM;Object.freeze(Object.defineProperty({__proto__:null,ONES:qM,UNIT_X:WM,UNIT_Y:YM,UNIT_Z:ZM,ZEROS:HM,clone:t$2W,create:n$2Y,createView:function e$2R(fe,ve){return new Float32Array(fe,ve,3)},fromValues:r$2r,ones:u$2u,unitX:c$2O,unitY:i$2Q,unitZ:a$2Q,zeros:o$2y},Symbol.toStringTag,{value:"Module"})),function(fe){fe[fe.SIXTEEN=0]="SIXTEEN",fe[fe.HUNDRED=1]="HUNDRED",fe[fe.TWOHUNDRED=2]="TWOHUNDRED",fe[fe.COUNT=3]="COUNT"}(XM||(XM={}));let JM=class i12 extends HA{constructor(){super(...arguments),this.steps=XM.SIXTEEN,this.writeTextureChannels=$M.RG}};e$4o([r$2w({count:XM.COUNT})],JM.prototype,"steps",void 0),e$4o([r$2w({constValue:has("esri-mobile")?1024:2048})],JM.prototype,"cubeMapSize",void 0),e$4o([r$2w()],JM.prototype,"writeTextureChannels",void 0);let QM=class i13{constructor(fe,ve,_e,be,we,Se,Te,Ee,Ce=.5){this.coverage=fe,this.density=ve,this.absorption=_e,this.cloudSize=be,this.detailSize=we,this.smoothness=Se,this.cloudHeight=Te,this.raymarchingSteps=Ee,this.median=Ce}};const KM=new QM([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],XM.SIXTEEN),eR={sunny:KM,cloudy:new QM([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],XM.TWOHUNDRED,.6),rainy:new QM([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],XM.TWOHUNDRED,.4),snowy:new QM([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],XM.HUNDRED,.65),foggy:new QM([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],XM.SIXTEEN),default:KM},tR=has("esri-mobile")?64:128,rR=tR/128,iR=Math.ceil(Math.sqrt(tR)),nR=(tR+2)*iR,sR=nR/1560;let oR=class e14 extends aO{constructor(fe,ve){super(fe,"mat3",oO.Pass,((_e,be,we)=>_e.setUniformMatrix3fv(fe,ve(be,we))))}},aR=class w extends iO{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=eR.default.raymarchingSteps,this.weatherTile=[0,0],this.viewMatrix=[1,0,0,0,1,0,0,0,1]}};function S$1e(fe){const ve=new gO;ve.include(o$2A,!1);const _e=ve.fragment;return _e.uniforms.add(new dO("cloudRadius",(fe=>fe.cloudRadius)),new dO("power",(fe=>f$3i(35,120,fe.absorption))),new dO("sigmaE",(fe=>1+fe.absorption)),new dO("density",(fe=>f$3i(0,.3,fe.density))),new dO("cloudSize",(fe=>f$3i(0,.02,Math.max(.01,1-fe.cloudSize)))),new dO("detailSize",(fe=>f$3i(0,.2,Math.max(.01,1-fe.detailSize)))),new dO("smoothness",(fe=>f$3i(0,.5,1-fe.smoothness))),new dO("cloudHeight",(fe=>f$3i(0,1500,fe.cloudHeight))),new dO("coverage",(fe=>fe.coverage)),new oR("view",(fe=>fe.viewMatrix)),new CO("cloudShapeTexture",(fe=>null!=fe.noiseTexture?fe.noiseTexture.textureAtlas:null)),new lO("cloudVariables",(fe=>o$2R(lR,fe.coverage,fe.absorption)))),_e.constants.add("halfCubeMapSize","float",.5*fe.cubeMapSize),_e.code.add(o$2P`
    const int STEPS = ${fe.steps===XM.SIXTEEN?o$2P`16`:fe.steps===XM.HUNDRED?o$2P`100`:o$2P`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),_e.code.add(o$2P`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${o$2P.float(nR)};
      const float dataWidth = ${o$2P.float(nR)};
      const float tileRows = ${o$2P.float(iR)};
      const vec3 atlasDimensions = vec3(${o$2P.float(tR)}, ${o$2P.float(tR)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${o$2P.float(rR)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${o$2P.float(sR)} * p) / ${o$2P.float(nR)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),_e.code.add(o$2P`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),_e.code.add(o$2P`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),_e.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      float luminance = 0.0;\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),_e.code.add(o$2P`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),_e.code.add(o$2P`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),_e.code.add(o$2P`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),ve}const lR=[0,0],cR=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:aR,build:S$1e},Symbol.toStringTag,{value:"Module"}));let uR=class d8 extends fA{constructor(fe,ve){super(fe,ve,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,d8.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:s$2Z(FO.CONSTANT_COLOR,FO.ONE_MINUS_CONSTANT_COLOR,zO.ADD,this.configuration.writeTextureChannels===$M.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};var hR;uR.shader=new LO(cR,(()=>zt((()=>Promise.resolve().then((()=>JMe))),void 0))),function(fe){fe[fe.Full=0]="Full",fe[fe.WeatherMap=1]="WeatherMap",fe[fe.COUNT=2]="COUNT"}(hR||(hR={}));let dR=class s22 extends HA{constructor(){super(...arguments),this.mode=hR.Full}};e$4o([r$2w({count:hR.COUNT})],dR.prototype,"mode",void 0);let pR=class s23 extends iO{constructor(){super(...arguments),this.weatherTile=r$36(0,0)}};function u$2t(fe){const ve=new gO;if(ve.include(o$2A,!1),ve.fragment.code.add(o$2P`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),fe.mode===hR.Full){const fe=2,_e=8;ve.fragment.code.add(o$2P`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${o$2P.float(iR)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${o$2P.float(_e)});

      float worley0 = worley(p, ${o$2P.float(fe)} * 2.0);
      float worley1 = worley(p, ${o$2P.float(fe)} * 8.0);
      float worley2 = worley(p, ${o$2P.float(fe)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${o$2P.float(fe)});
      float worley1 = worley(p, ${o$2P.float(fe)} * 2.0);
      float worley2 = worley(p, ${o$2P.float(fe)} * 4.0);
      float worley3 = worley(p, ${o$2P.float(fe)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)}return ve.fragment.uniforms.add(new lO("weatherTile",(fe=>fe.weatherTile))),ve.fragment.code.add(o$2P`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${o$2P.float(128)});

      // Get global coordinates of p
      p += weatherTile * ${o$2P.float(128)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${o$2P.float(1e5)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),ve.fragment.code.add(o$2P`void main() {`),fe.mode===hR.Full&&ve.fragment.code.add(o$2P`
        float padWidth = 1.0;
        float paddedSize = ${o$2P.float(tR)} + 2.0 * padWidth;
        float tileCount = ${o$2P.float(iR)} * ${o$2P.float(iR)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${o$2P.float(tR)};
          }

          if (startPadY) {
            pixel.y += ${o$2P.float(tR)};
          }

          if (endPadX) {
            pixel.x -= ${o$2P.float(tR)};
          }

          if (endPadY) {
            pixel.y -= ${o$2P.float(tR)};
          }

          uv = vec2(pixel.xy / ${o$2P.float(tR)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${o$2P.float(tR)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${o$2P.float(iR)} * ${o$2P.float(iR)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${o$2P.float(iR)} * ${o$2P.float(iR)});
        p = p_;
        p.z /= (${o$2P.float(iR)} * ${o$2P.float(iR)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),ve.fragment.code.add(o$2P`
      vec2 mapUV = ${o$2P.float(128)} * (gl_FragCoord.xy / ${o$2P.float(nR)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${fe.mode===hR.Full?o$2P`fragColor.ba = vec2(0.0, map);`:o$2P`fragColor = vec4(map);`};
    }
  `),ve}const fR=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:pR,build:u$2t},Symbol.toStringTag,{value:"Module"}));let mR=class d9 extends fA{initializeProgram(fe){return new gA(fe.rctx,d9.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:this.configuration.mode===hR.Full?s$2Z(FO.ONE,FO.ZERO):l$2_(FO.ZERO,FO.ONE,FO.ONE,FO.ZERO),depthTest:{func:jO.ALWAYS},colorWrite:AA})}};mR.shader=new LO(fR,(()=>zt((()=>Promise.resolve().then((()=>QMe))),void 0)));let yR=class i14{constructor(fe,ve,_e=ve){this.internalFormat=fe,this.width=ve,this.height=_e,this.multisampled=!1,this.samples=1}};let gR=class s24{constructor(fe,ve){this._context=fe,this._descriptor=ve,this.type=iM.RenderBuffer,this._context.instanceCounter.increment(iA.Renderbuffer,this);const _e=this._context.gl;this.glName=_e.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:be,height:we,internalFormat:Se,multisampled:Te}=ve;Te?_e.renderbufferStorageMultisample(_e.RENDERBUFFER,this.samples,Se,be,we):_e.renderbufferStorage(_e.RENDERBUFFER,Se,be,we),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const fe=this._descriptor.samples,ve=this._context.parameters.maxSamples;return fe?Math.min(fe,ve):ve}get usedMemory(){return function h$1T(fe){return fe.width<=0||fe.height<=0||null==fe.internalFormat?0:fe.width*fe.height*u$2B(fe.internalFormat)}(this._descriptor)}resize(fe,ve){const _e=this._descriptor;if(_e.width===fe&&_e.height===ve)return;_e.width=fe,_e.height=ve;const be=this._context.gl;this._context.bindRenderbuffer(this),_e.multisampled?be.renderbufferStorageMultisample(be.RENDERBUFFER,this.samples,_e.internalFormat,_e.width,_e.height):be.renderbufferStorage(be.RENDERBUFFER,_e.internalFormat,_e.width,_e.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(iA.Renderbuffer,this),this._context=null)}};let vR=class E2{constructor(fe,ve,_e=null){this._context=fe,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,fe.instanceCounter.increment(iA.FramebufferObject,this);const be=x$1a(ve)?ve:new oM(this._context,ve);if(this._colorAttachments.set(nA.COLOR_ATTACHMENT0,be),this._validateTextureDescriptor(be.descriptor),this._validateColorAttachmentPoint(nA.COLOR_ATTACHMENT0),null!=_e)if(function b$1o(fe){return x$1a(fe)||null!=fe&&"pixelFormat"in fe}(_e))this._depthStencilTexture=x$1a(_e)?_e:new oM(this._context,_e),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const fe=function g$1F(fe){return null!=fe&&"type"in fe&&fe.type===iM.RenderBuffer}(_e)?_e:new gR(this._context,_e);this._depthStencilBuffer=fe,this._validateRenderBufferDescriptor(fe.descriptor)}}dispose(){var fe,ve;if(0===this._colorAttachments.size&&!this._glName)return;const _e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((fe,ve)=>{var _e;return null==(_e=this.detachColorTexture(ve))?void 0:_e.dispose()})),null==(fe=this.detachDepthStencilBuffer())||fe.dispose(),null==(ve=this.detachDepthStencilTexture())||ve.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(_e),this._context.instanceCounter.decrement(iA.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(nA.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var fe;const ve=this._colorAttachments.get(nA.COLOR_ATTACHMENT0);return(null==(fe=null==ve?void 0:ve.descriptor)?void 0:fe.width)??0}get height(){var fe;const ve=this._colorAttachments.get(nA.COLOR_ATTACHMENT0);return(null==(fe=null==ve?void 0:ve.descriptor)?void 0:fe.height)??0}get usedMemory(){var fe;return[...this._colorAttachments].reduce(((fe,[ve,_e])=>fe+_e.usedMemory),(null==(fe=this.depthStencil)?void 0:fe.usedMemory)??0)}getColorTexture(fe){const ve=this._colorAttachments.get(fe);return ve&&x$1a(ve)?ve:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(fe,ve=nA.COLOR_ATTACHMENT0){var _e;if(!fe)return;this._validateColorAttachmentPoint(ve);const be=fe.descriptor;this._validateTextureDescriptor(be),null==(_e=this.detachColorTexture(ve))||_e.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(fe.glName,ve)),this._colorAttachments.set(ve,fe)}detachColorTexture(fe=nA.COLOR_ATTACHMENT0){const ve=this._colorAttachments.get(fe);if(ve){if(this._initialized){const ve=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,fe),this._context.bindFramebuffer(ve)}return this._colorAttachments.delete(fe),ve}}setColorTextureTarget(fe,ve=nA.COLOR_ATTACHMENT0){const _e=this._colorAttachments.get(ve);_e&&this._framebufferTexture2D(_e.glName,ve,fe)}attachDepthStencil(fe){if(fe)switch(fe.type){case iM.Texture:return this._attachDepthStencilTexture(fe);case iM.RenderBuffer:return this._attachDepthStencilBuffer(fe)}}_attachDepthStencilTexture(fe){var ve;if(null==fe)return;const _e=fe.descriptor;_e.pixelFormat!==YO.DEPTH_STENCIL&&(_e.pixelFormat,YO.DEPTH24_STENCIL8),_e.dataType,XO.UNSIGNED_INT_24_8,this._validateTextureDescriptor(_e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(fe.glName,oA)),null==(ve=this._depthStencilTexture)||ve.dispose(),this._depthStencilTexture=fe}detachDepthStencilTexture(){const fe=this._depthStencilTexture;if(fe&&this._initialized){const fe=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,oA),this._context.bindFramebuffer(fe)}return this._depthStencilTexture=null,fe}_attachDepthStencilBuffer(fe){if(null==fe)return;const ve=fe.descriptor;if(this._validateRenderBufferDescriptor(ve),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const _e=this._context.gl,be=this._getGLAttachmentPoint(ve);_e.framebufferRenderbuffer(eA.FRAMEBUFFER,be,_e.RENDERBUFFER,fe.glName)}this._depthStencilBuffer=fe}detachDepthStencilBuffer(){const fe=this._depthStencilBuffer;if(fe&&this._initialized){const ve=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const _e=this._context.gl,be=this._getGLAttachmentPoint(fe.descriptor);_e.framebufferRenderbuffer(eA.FRAMEBUFFER,be,_e.RENDERBUFFER,null),this._context.bindFramebuffer(ve)}return this._depthStencilBuffer=null,fe}copyToTexture(fe,ve,_e,be,we,Se,Te){const Ee=Te.descriptor;Te.descriptor.target,WO.TEXTURE_2D,null==(null==Ee?void 0:Ee.width)||null==(null==Ee?void 0:Ee.height)||fe+_e>this.width||ve+be>this.height||we+_e>Ee.width||Ee.height;const Ce=this._context,Oe=Ce.bindTexture(Te,oM.TEXTURE_UNIT_FOR_UPDATES);Ce.setActiveTexture(oM.TEXTURE_UNIT_FOR_UPDATES),Ce.bindFramebuffer(this),Ce.gl.copyTexSubImage2D(WO.TEXTURE_2D,0,we,Se,fe,ve,_e,be),Ce.bindTexture(Oe,oM.TEXTURE_UNIT_FOR_UPDATES)}readPixels(fe,ve,_e,be,we,Se,Te){this._context.bindFramebuffer(this),this._context.gl.readPixels(fe,ve,_e,be,we,Se,Te)}async readPixelsAsync(fe,ve,_e,be,we,Se,Te){const{gl:Ee}=this._context,Ce=rM.createPixelPack(this._context,QO.STREAM_READ,Te.byteLength);this._context.bindBuffer(Ce),this._context.bindFramebuffer(this),Ee.readPixels(fe,ve,_e,be,we,Se,0),this._context.unbindBuffer(kO.PIXEL_PACK_BUFFER),await Ce.getSubDataAsync(Te),Ce.dispose()}resize(fe,ve){var _e,be;if(this.width===fe&&this.height===ve)return;const we={width:fe,height:ve};A$18(we,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((fe=>fe.resize(we.width,we.height))),null==(_e=this._depthStencilTexture)||_e.resize(we.width,we.height),this._initialized&&(A$18(we,this._context.parameters.maxRenderbufferSize),null==(be=this._depthStencilBuffer)||be.resize(we.width,we.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(fe=eA.FRAMEBUFFER){const ve=this._context.gl;if(this._initialized)return void ve.bindFramebuffer(fe,this.glName);this._glName&&ve.deleteFramebuffer(this._glName);const _e=ve.createFramebuffer();if(ve.bindFramebuffer(fe,_e),this._colorAttachments.forEach(((ve,_e)=>this._framebufferTexture2D(ve.glName,_e,S$1d(ve),fe))),this._depthStencilBuffer){const _e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);ve.framebufferRenderbuffer(fe,_e,ve.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,ve.DEPTH_STENCIL_ATTACHMENT,S$1d(this._depthStencilTexture),fe);a$2Y()&&(ve.checkFramebufferStatus(fe),ve.FRAMEBUFFER_COMPLETE),this._glName=_e,this._initialized=!0}_framebufferTexture2D(fe,ve=nA.COLOR_ATTACHMENT0,_e=WO.TEXTURE_2D,be=eA.FRAMEBUFFER,we=0){this._context.gl.framebufferTexture2D(be,ve,_e,fe,we)}_disposeDepthStencilAttachments(){const fe=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const ve=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);fe.framebufferRenderbuffer(eA.FRAMEBUFFER,ve,fe.RENDERBUFFER,null)}this._depthStencilBuffer=r$3M(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,fe.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=r$3M(this._depthStencilTexture))}_validateTextureDescriptor(fe){fe.target!==WO.TEXTURE_2D&&(fe.target,WO.TEXTURE_CUBE_MAP),A$18(fe,this._context.parameters.maxTextureSize),this._validateBufferDimensions(fe)}_validateRenderBufferDescriptor(fe){A$18(fe,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(fe)}_validateBufferDimensions(fe){fe.width<=0&&(fe.width=this.width),fe.height<=0&&(fe.height=this.height),this.width>0&&this.height>0&&this.width===fe.width&&(this.height,fe.height)}_getGLAttachmentPoint(fe){switch(fe.internalFormat){case JO.DEPTH_COMPONENT16:case JO.DEPTH_COMPONENT24:case JO.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case JO.DEPTH24_STENCIL8:case JO.DEPTH32F_STENCIL8:case JO.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case JO.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(fe){if(-1===E2._MAX_COLOR_ATTACHMENTS){const{gl:fe}=this._context;E2._MAX_COLOR_ATTACHMENTS=fe.getParameter(fe.MAX_COLOR_ATTACHMENTS)}const ve=fe-nA.COLOR_ATTACHMENT0;ve+1>E2._MAX_COLOR_ATTACHMENTS&&ar.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${ve+1}. Implementation supports up to ${E2._MAX_COLOR_ATTACHMENTS} color attachments`)}};function x$1a(fe){return null!=fe&&"type"in fe&&fe.type===iM.Texture}function A$18(fe,ve){const _e=Math.max(fe.width,fe.height);if(_e>ve){ar.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${fe.width}x${fe.height} to device limit ${ve}`);const be=ve/_e;return fe.width=Math.round(fe.width*be),fe.height=Math.round(fe.height*be),!1}return!0}function S$1d(fe){return fe.descriptor.target===WO.TEXTURE_CUBE_MAP?WO.TEXTURE_CUBE_MAP_POSITIVE_X:WO.TEXTURE_2D}vR._MAX_COLOR_ATTACHMENTS=-1;let _R=class d10 extends zi{constructor(fe){super(fe),this._needsRender=!0,this._passParameters=new pR,this._fbo=new vR(fe.context.renderContext.rctx,new nM(nR)),this._vao=i$2S(fe.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(hR.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(hR.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(fe){this._passParameters.weatherTile[0]===fe[0]&&this._passParameters.weatherTile[1]===fe[1]||(r$2C(this._passParameters.weatherTile,fe),this._setDirty())}destroy(){this._fullTechniqueCached=t$4r(this._fullTechniqueCached),this._weatherMapTechniqueCached=t$4r(this._weatherMapTechniqueCached),this._fbo=r$3M(this._fbo),this._vao=r$3M(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const fe=new dR;fe.mode=hR.Full,this._fullTechniqueCached=this._techniques.acquire(mR,fe)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const fe=new dR;fe.mode=hR.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(mR,fe)}return this._weatherMapTechniqueCached}_render(fe){if(null==this._vao||null==this._fbo)return null;const ve=fe===hR.Full?this._fullTechnique:this._weatherMapTechnique,_e=this.context.renderContext.rctx,be=_e.getViewport();_e.setViewport(0,0,nR,nR),_e.bindFramebuffer(this._fbo);const we=_e.bindTechnique(ve,null,this._passParameters);return _e.bindVAO(this._vao),we.assertCompatibleVertexAttributeLocations(this._vao),_e.gl.drawArrays(_e.gl.TRIANGLE_STRIP,0,4),_e.setViewport(be.x,be.y,be.width,be.height),this._needsRender=!1,this._fbo.colorTexture}};function a$2O(fe){return fe?{ray:m$3f(fe.ray),c0:fe.c0,c1:fe.c1}:{ray:m$3f(),c0:0,c1:Number.MAX_VALUE}}function y$1t(fe,ve=a$2O()){return b$1Y(fe,ve.ray),ve.c0=0,ve.c1=Number.MAX_VALUE,ve}function j$18(fe,ve){return g$1E(fe,fe.c0,ve)}function p$2U(fe,ve){return g$1E(fe,fe.c1,ve)}function g$1E(fe,ve,_e){return u$3Y(_e,fe.ray.origin,g$2z(_e,fe.ray.direction,ve))}function H$M(fe){return fe?[E$1z(fe[0]),E$1z(fe[1]),E$1z(fe[2]),E$1z(fe[3]),E$1z(fe[4]),E$1z(fe[5])]:[E$1z(),E$1z(),E$1z(),E$1z(),E$1z(),E$1z()]}function I$14(){return[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}function N$P(fe,ve){for(let _e=0;_e<SR;_e++)A$1s(fe[_e],ve[_e]);return fe}function L$P(fe,ve,_e,be=CR){const we=c$4k(Od.get(),ve,fe);h$2A(we,we);for(let Se=0;Se<TR;++Se){const fe=z$13(Cd.get(),ER[Se],we);o$44(be[Se],fe[0]/fe[3],fe[1]/fe[3],fe[2]/fe[3])}P$T(_e,be)}function P$T(fe,ve){b$1Z(ve[bR.FAR_BOTTOM_LEFT],ve[bR.NEAR_BOTTOM_LEFT],ve[bR.NEAR_TOP_LEFT],fe[$R.LEFT]),b$1Z(ve[bR.NEAR_BOTTOM_RIGHT],ve[bR.FAR_BOTTOM_RIGHT],ve[bR.FAR_TOP_RIGHT],fe[$R.RIGHT]),b$1Z(ve[bR.FAR_BOTTOM_LEFT],ve[bR.FAR_BOTTOM_RIGHT],ve[bR.NEAR_BOTTOM_RIGHT],fe[$R.BOTTOM]),b$1Z(ve[bR.NEAR_TOP_LEFT],ve[bR.NEAR_TOP_RIGHT],ve[bR.FAR_TOP_RIGHT],fe[$R.TOP]),b$1Z(ve[bR.NEAR_BOTTOM_LEFT],ve[bR.NEAR_BOTTOM_RIGHT],ve[bR.NEAR_TOP_RIGHT],fe[$R.NEAR]),b$1Z(ve[bR.FAR_BOTTOM_RIGHT],ve[bR.FAR_BOTTOM_LEFT],ve[bR.FAR_TOP_LEFT],fe[$R.FAR])}function s$2N(fe,ve){for(let _e=0;_e<SR;_e++){const be=fe[_e];if(be[0]*ve[0]+be[1]*ve[1]+be[2]*ve[2]+be[3]>=ve[3])return!1}return!0}function m$2j(fe,ve){for(let _e=0;_e<SR;_e++){if(!H$10(fe[_e],ve))return!1}return!0}function a$2N(fe,ve,_e){return p$2T(fe,function m$2k(fe,ve,_e=a$2O()){const be=s$4g(fe.vector);return v$1M(fe.origin,ve,_e.ray),_e.c0=0,_e.c1=be,_e}(ve,_e,PR.get()))}function l$2V(fe,ve){for(let _e=0;_e<SR;_e++)if(V$12(fe[_e],ve)>0)return!1;return!0}function p$2T(fe,ve){for(let _e=0;_e<SR;_e++)if(!G$O(fe[_e],ve))return!1;return!0}var $R,bR,wR;e$4o([y$2v({constructOnly:!0})],_R.prototype,"context",void 0),e$4o([y$2v({readOnly:!0})],_R.prototype,"_techniques",null),_R=e$4o([a$4y("esri.views.3d.environment.NoiseTextureAtlas")],_R),new ad((()=>a$2O())),(wR=$R||($R={}))[wR.LEFT=0]="LEFT",wR[wR.RIGHT=1]="RIGHT",wR[wR.BOTTOM=2]="BOTTOM",wR[wR.TOP=3]="TOP",wR[wR.NEAR=4]="NEAR",wR[wR.FAR=5]="FAR",function(fe){fe[fe.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",fe[fe.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",fe[fe.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",fe[fe.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",fe[fe.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",fe[fe.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",fe[fe.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",fe[fe.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(bR||(bR={}));const xR={bottom:[bR.FAR_BOTTOM_RIGHT,bR.NEAR_BOTTOM_RIGHT,bR.NEAR_BOTTOM_LEFT,bR.FAR_BOTTOM_LEFT],near:[bR.NEAR_BOTTOM_LEFT,bR.NEAR_BOTTOM_RIGHT,bR.NEAR_TOP_RIGHT,bR.NEAR_TOP_LEFT],far:[bR.FAR_BOTTOM_RIGHT,bR.FAR_BOTTOM_LEFT,bR.FAR_TOP_LEFT,bR.FAR_TOP_RIGHT],right:[bR.NEAR_BOTTOM_RIGHT,bR.FAR_BOTTOM_RIGHT,bR.FAR_TOP_RIGHT,bR.NEAR_TOP_RIGHT],left:[bR.FAR_BOTTOM_LEFT,bR.NEAR_BOTTOM_LEFT,bR.NEAR_TOP_LEFT,bR.FAR_TOP_LEFT],top:[bR.FAR_TOP_LEFT,bR.NEAR_TOP_LEFT,bR.NEAR_TOP_RIGHT,bR.FAR_TOP_RIGHT]},SR=6,TR=8,ER=[r$35(-1,-1,-1,1),r$35(1,-1,-1,1),r$35(1,1,-1,1),r$35(-1,1,-1,1),r$35(-1,-1,1,1),r$35(1,-1,1,1),r$35(1,1,1,1),r$35(-1,1,1,1)],PR=new ad(a$2O),CR=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];let OR=class s25{constructor(){this.adds=new jr,this.removes=new jr,this.updates=new jr({allocator:fe=>fe||new AR,deallocator:fe=>(fe.renderGeometry=null,fe)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}},AR=class r9{},MR=class t23{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var RR,IR,LR;function n$2W(fe){const ve=new Map,n52=fe=>{let _e=ve.get(fe);return _e||(_e=new MR,ve.set(fe,_e)),_e};return fe.removes.forAll((fe=>{o$2w(fe)&&n52(fe.material).removes.push(fe)})),fe.adds.forAll((fe=>{o$2w(fe)&&n52(fe.material).adds.push(fe)})),fe.updates.forAll((fe=>{o$2w(fe.renderGeometry)&&n52(fe.renderGeometry.material).updates.push(fe)})),ve}function o$2w(fe){return fe.geometry.indexCount>=1}!function(fe){fe[fe.Default=0]="Default",fe[fe.Screenshot=1]="Screenshot",fe[fe.ObjectAndLayerID=2]="ObjectAndLayerID"}(RR||(RR={})),function(fe){fe[fe.TOP=0]="TOP",fe[fe.RIGHT=1]="RIGHT",fe[fe.BOTTOM=2]="BOTTOM",fe[fe.LEFT=3]="LEFT"}(IR||(IR={}));let DR=LR=class extends zi{constructor(fe){super(fe),this._ray=m$3f(),this._viewport=r$35(0,0,1,1),this._padding=r$35(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=r$36(1,1e3),this._viewDirty=!0,this._viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._viewProjectionDirty=!0,this._viewProjectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._frustumDirty=!0,this._frustum=H$M(),this._fullViewport=[0,0,0,0],this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=[0,0,0],this._up=[0,0,0],this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(fe){this._pixelRatio=fe>0?fe:1}get rows(){return this._rows}set rows(fe){this._rows=Math.max(1,fe)}get columns(){return this._columns}set columns(fe){this._columns=Math.max(1,fe)}get eye(){return this._ray.origin}set eye(fe){this._compareAndSetView(fe,this._ray.origin)}get center(){return this._center}set center(fe){this._compareAndSetView(fe,this._center,"_center")}get ray(){return e$3Z(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(fe){this._compareAndSetView(fe,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(fe){n$48(this._viewMatrix,fe),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),o$44([0,0,0],-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),o$44([0,0,0],this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),o$44([0,0,0],this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(fe){this._nearFar[0]!==fe&&(this._nearFar[0]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(fe){this._nearFar[1]!==fe&&(this._nearFar[1]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(fe){this.x=fe[0],this.y=fe[1],this.width=fe[2],this.height=fe[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const fe=m$3i([0,0,0,0],this._viewport,1/this.pixelRatio),ve=this._get("screenViewport");return ve&&L$17(fe,ve)?ve:fe}get screenPadding(){if(1===this.pixelRatio)return this._padding;const fe=m$3i([0,0,0,0],this._padding,1/this.pixelRatio),ve=this._get("screenPadding");return ve&&L$17(fe,ve)?ve:fe}get x(){return this._viewport[0]}set x(fe){fe+=this._padding[IR.LEFT],this._viewport[0]!==fe&&(this._viewport[0]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(fe){fe+=this._padding[IR.BOTTOM],this._viewport[1]!==fe&&(this._viewport[1]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(fe){this._viewport[2]!==fe&&(this._viewport[2]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(fe){this._viewport[3]!==fe&&(this._viewport[3]=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[IR.RIGHT]+this._padding[IR.LEFT]}set fullWidth(fe){this.width=fe-(this._padding[IR.RIGHT]+this._padding[IR.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[IR.TOP]+this._padding[IR.BOTTOM]}set fullHeight(fe){this.height=fe-(this._padding[IR.TOP]+this._padding[IR.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[IR.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[IR.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(fe){E$1A(this._padding,fe)||(this._viewport[0]+=fe[IR.LEFT]-this._padding[IR.LEFT],this._viewport[1]+=fe[IR.BOTTOM]-this._padding[IR.BOTTOM],this._viewport[2]-=fe[IR.RIGHT]+fe[IR.LEFT]-(this._padding[IR.RIGHT]+this._padding[IR.LEFT]),this._viewport[3]-=fe[IR.TOP]+fe[IR.BOTTOM]-(this._padding[IR.TOP]+this._padding[IR.BOTTOM]),a$42(this._padding,fe),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(c$4k(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return h$2A([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.projectionMatrix)||this._get("inverseProjectionMatrix")||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}get fov(){return this._fov}set fov(fe){this._fov=fe,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function n$2X(fe,ve,_e){return 2*Math.atan(ve*Math.tan(.5*fe)/Math.sqrt(ve*ve+_e*_e))}(this._fov,this.width,this.height)}set fovX(fe){this._fov=function t$2S(fe,ve,_e){return 2*Math.atan(Math.sqrt(ve*ve+_e*_e)*Math.tan(.5*fe)/ve)}(fe,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function r$2p(fe,ve,_e){return 2*Math.atan(_e*Math.tan(.5*fe)/Math.sqrt(ve*ve+_e*_e))}(this._fov,this.width,this.height)}set fovY(fe){this._fov=function a$2M(fe,ve,_e){return 2*Math.atan(Math.sqrt(ve*ve+_e*_e)*Math.tan(.5*fe)/_e)}(fe,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return x$1W(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(h$2A(this._viewInverseTransposeMatrix,this.viewMatrix),s$3L(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(fe){const ve=2*fe-1;return 2*this.near*this.far/(this.far+this.near-ve*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const fe=this.width,ve=this.height,_e=this.near*Math.tan(this.fovY/2)*2,be=_e*this._aspect,we=_e/this.rows,Se=be/this.columns,Te=-be/2+this.column*Se,Ee=Te+Se,Ce=-_e/2+this.row*we,Oe=Ce+we,Re=A$1w([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Te*(1+2*this._padding[IR.LEFT]/fe),Ee*(1+2*this._padding[IR.RIGHT]/fe),Ce*(1+2*this._padding[IR.BOTTOM]/ve),Oe*(1+2*this._padding[IR.TOP]/ve),this.near,this.far),De=this._get("projectionMatrix");return De&&C$1l(De,Re)?De:Re}copyFrom(fe){r$3w(this._ray.origin,fe.eye),this.center=fe.center,this.up=fe.up,a$42(this._viewport,fe.viewport),this.notifyChange("_viewport"),a$42(this._padding,fe.padding),this.notifyChange("_padding"),r$2C(this._nearFar,fe.nearFar),this.notifyChange("_nearFar"),this._fov=fe.fov,this.row=fe.row,this.column=fe.column,this.rows=fe.rows,this.columns=fe.columns,this.relativeElevation=fe.relativeElevation;const ve=fe;return this._viewDirty=ve._viewDirty,this._viewDirty||(n$48(this._viewMatrix,fe.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=ve._frustumDirty,this._frustumDirty||(N$P(this._frustum,fe.frustum),this._frustumDirty=!1),ve._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n$48(this._viewInverseTransposeMatrix,fe.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),a$42(this._fullViewport,fe.fullViewport),this.pixelRatio=fe.pixelRatio,this}copyViewFrom(fe){this.eye=fe.eye,this.center=fe.center,this.up=fe.up}clone(){return(new LR).copyFrom(this)}equals(fe){return G$$(this.eye,fe.eye)&&G$$(this.center,fe.center)&&G$$(this.up,fe.up)&&E$1A(this._viewport,fe.viewport)&&E$1A(this._padding,fe.padding)&&E$1k(this.nearFar,fe.nearFar)&&this._fov===fe.fov&&this.pixelRatio===fe.pixelRatio&&this.relativeElevation===fe.relativeElevation&&this.row===fe.row&&this.column===fe.column&&this.rows===fe.rows&&this.columns===fe.columns}almostEquals(fe){const ve=Math.max(1,1/this.pixelRatio,1/fe.pixelRatio);if(Math.abs(fe.fov-this._fov)>=.001||x$1C(fe.screenPadding,this.screenPadding)>=ve||x$1C(this.screenViewport,fe.screenViewport)>=ve||this.row!==fe.row||this.column!==fe.column||this.rows!==fe.rows||this.columns!==fe.columns)return!1;Ki(kR,fe.eye,fe.center),Ki(UR,this.eye,this.center);const _e=P$1g(kR,UR),be=pn(kR),we=pn(UR),Se=5e-4;return _e*_e>=(1-1e-10)*be*we&&hn(fe.eye,this.eye)<Math.max(be,we)*Se*Se}computeRenderPixelSizeAt(fe){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(fe))}computeRenderPixelSizeAtDist(fe){return fe*this.perRenderPixelRatio}computeScreenPixelSizeAt(fe){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(fe))}_viewDirectionDistance(fe){return Math.abs(a$41(this.viewForward,e$3Z(kR,fe,this.eye)))}computeScreenPixelSizeAtDist(fe){return fe*this.perScreenPixelRatio}computeDistanceFromRadius(fe,ve){return fe/Math.tan(Math.min(this.fovX,this.fovY)/(2*(ve||1)))}getScreenCenter(fe=i$4i()){return fe[0]=(this.padding[IR.LEFT]+this.width/2)/this.pixelRatio,fe[1]=(this.padding[IR.TOP]+this.height/2)/this.pixelRatio,fe}getRenderCenter(fe,ve=.5,_e=.5){return fe[0]=this.padding[IR.LEFT]+this.width*ve,fe[1]=this.padding[IR.BOTTOM]+this.height*_e,fe[2]=.5,fe}setGLViewport(fe){const ve=this.viewport,_e=this.padding;fe.setViewport(ve[0]-_e[3],ve[1]-_e[2],ve[2]+_e[1]+_e[3],ve[3]+_e[0]+_e[2])}applyProjection(fe,ve){fe!==FR&&r$3w(FR,fe),FR[3]=1,z$13(FR,FR,this.projectionMatrix);const _e=Math.abs(FR[3]);g$2z(FR,FR,1/_e);const be=this.fullViewport;ve[0]=f$3i(0,be[0]+be[2],.5+.5*FR[0]),ve[1]=f$3i(0,be[1]+be[3],.5+.5*FR[1]),ve[2]=.5*(FR[2]+1),ve[3]=_e}unapplyProjection(fe,ve){const _e=this.fullViewport;FR[0]=(fe[0]/(_e[0]+_e[2])*2-1)*fe[3],FR[1]=(fe[1]/(_e[1]+_e[3])*2-1)*fe[3],FR[2]=(2*fe[2]-1)*fe[3],FR[3]=fe[3],null!=this.inverseProjectionMatrix&&(z$13(FR,FR,this.inverseProjectionMatrix),ve[0]=FR[0],ve[1]=FR[1],ve[2]=FR[2])}projectToScreen(fe,ve){return this.projectToRenderScreen(fe,VR),this.renderToScreen(VR,ve),ve}projectToRenderScreen(fe,ve){if(FR[0]=fe[0],FR[1]=fe[1],FR[2]=fe[2],FR[3]=1,z$13(FR,FR,this.viewProjectionMatrix),0===FR[3])return null;const _e=FR;g$2z(_e,_e,1/Math.abs(FR[3]));const be=this.fullViewport,we=f$3i(0,be[0]+be[2],.5+.5*_e[0]),Se=f$3i(0,be[1]+be[3],.5+.5*_e[1]);return"x"in ve?(ve.x=we,ve.y=Se):(ve[0]=we,ve[1]=Se,ve.length>2&&(ve[2]=.5*(_e[2]+1))),ve}unprojectFromScreen(fe,ve){return this.unprojectFromRenderScreen(this.screenToRender(fe,VR),ve)}unprojectFromRenderScreen(fe,ve){if(c$4k(zR,this.projectionMatrix,this.viewMatrix),!h$2A(zR,zR))return null;const _e=this.fullViewport;return FR[0]=2*(fe[0]-_e[0])/_e[2]-1,FR[1]=2*(fe[1]-_e[1])/_e[3]-1,FR[2]=2*fe[2]-1,FR[3]=1,z$13(FR,FR,zR),0===FR[3]?null:(ve[0]=FR[0]/FR[3],ve[1]=FR[1]/FR[3],ve[2]=FR[2]/FR[3],ve)}constrainWindowSize(fe,ve,_e,be){const we=fe*this.pixelRatio,Se=ve*this.pixelRatio,Te=Math.max(we-_e/2,0),Ee=Math.max(this.fullHeight-Se-be/2,0),Ce=-Math.min(we-_e/2,0),Oe=-Math.min(this.fullHeight-Se-be/2,0),Re=_e-Ce- -Math.min(this.fullWidth-we-_e/2,0),De=be-Oe- -Math.min(Se-be/2,0);return[Math.round(Te),Math.round(Ee),Math.round(Re),Math.round(De)]}computeUp(fe){fe===Wf.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(fe,ve){const _e=fe[0]*this.pixelRatio,be=this.fullHeight-fe[1]*this.pixelRatio;return ve[0]=_e,ve[1]=be,ve}renderToScreen(fe,ve){const _e=fe[0]/this.pixelRatio,be=(this.fullHeight-fe[1])/this.pixelRatio;ve[0]=_e,ve[1]=be}_computeUpGlobal(){e$3Z(kR,this.center,this.eye);const fe=s$4g(this.center);fe<1?(o$44(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(P$1g(kR,this.center))>.9999*s$4g(kR)*fe||(_$1z(this._up,kR,this.center),_$1z(this._up,this._up,kR),z$1d(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){J$M(kR,this.eye,this.center),Math.abs(kR[2])<=.9999&&(g$2z(kR,kR,kR[2]),o$44(this._up,-kR[0],-kR[1],1-kR[2]),z$1d(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(fe,ve,_e=""){"number"==typeof fe[0]&&isFinite(fe[0])&&"number"==typeof fe[1]&&isFinite(fe[1])&&"number"==typeof fe[2]&&isFinite(fe[2])?G$$(fe,ve)||(r$3w(ve,fe),this._markViewDirty(),_e.length&&this.notifyChange(_e)):ar.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(L$P(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(X$w(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};e$4o([y$2v()],DR.prototype,"_viewport",void 0),e$4o([y$2v()],DR.prototype,"_padding",void 0),e$4o([y$2v()],DR.prototype,"_fov",void 0),e$4o([y$2v()],DR.prototype,"_nearFar",void 0),e$4o([y$2v()],DR.prototype,"_viewDirty",void 0),e$4o([y$2v()],DR.prototype,"_viewMatrix",void 0),e$4o([y$2v()],DR.prototype,"_pixelRatio",void 0),e$4o([y$2v()],DR.prototype,"pixelRatio",null),e$4o([y$2v()],DR.prototype,"row",void 0),e$4o([y$2v()],DR.prototype,"column",void 0),e$4o([y$2v()],DR.prototype,"_rows",void 0),e$4o([y$2v()],DR.prototype,"rows",null),e$4o([y$2v()],DR.prototype,"_columns",void 0),e$4o([y$2v()],DR.prototype,"columns",null),e$4o([y$2v()],DR.prototype,"eye",null),e$4o([y$2v()],DR.prototype,"center",null),e$4o([y$2v()],DR.prototype,"_center",void 0),e$4o([y$2v()],DR.prototype,"up",null),e$4o([y$2v()],DR.prototype,"_up",void 0),e$4o([y$2v()],DR.prototype,"viewMatrix",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"viewForward",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"viewUp",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"viewRight",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"nearFar",null),e$4o([y$2v()],DR.prototype,"near",null),e$4o([y$2v()],DR.prototype,"far",null),e$4o([y$2v()],DR.prototype,"viewport",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"screenViewport",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"screenPadding",null),e$4o([y$2v()],DR.prototype,"x",null),e$4o([y$2v()],DR.prototype,"y",null),e$4o([y$2v()],DR.prototype,"width",null),e$4o([y$2v()],DR.prototype,"height",null),e$4o([y$2v()],DR.prototype,"fullWidth",null),e$4o([y$2v()],DR.prototype,"fullHeight",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"_aspect",null),e$4o([y$2v()],DR.prototype,"padding",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"projectionMatrix",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"inverseProjectionMatrix",null),e$4o([y$2v()],DR.prototype,"fov",null),e$4o([y$2v()],DR.prototype,"fovX",null),e$4o([y$2v()],DR.prototype,"fovY",null),e$4o([y$2v()],DR.prototype,"viewInverseTransposeMatrix",null),e$4o([y$2v({readOnly:!0})],DR.prototype,"_projectionMatrixInternal",null),e$4o([y$2v()],DR.prototype,"relativeElevation",void 0),DR=LR=e$4o([a$4y("esri.views.3d.webgl.RenderCamera")],DR);const NR=DR,FR=[0,0,0,0],zR=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],kR=[0,0,0],UR=[0,0,0],VR=x$1H();var BR,jR;function r$2m(fe){fe.include(c$2X),fe.uniforms.add(new CO("geometryDepthTexture",((fe,ve)=>{var _e;return null==(_e=ve.multipassGeometry.depth)?void 0:_e.attachment}))),fe.code.add(o$2P`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}(jR=BR||(BR={}))[jR.Occluded=0]="Occluded",jR[jR.NotOccluded=1]="NotOccluded",jR[jR.Both=2]="Both",jR[jR.COUNT=3]="COUNT";let GR=class m11{};function a$2L(fe,ve){if(!ve.multipassEnabled)return;fe.fragment.include(c$2X),fe.fragment.uniforms.add(new CO("terrainDepthTexture",((fe,ve)=>{var _e;return null==(_e=ve.multipassTerrain.depth)?void 0:_e.attachment})));const _e=ve.occlusionPass;fe.fragment.code.add(o$2P`
   ${_e?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${_e?o$2P`return fragmentDepth < linearDepth && depth < 1.0;`:o$2P`
          if(fragmentDepth ${ve.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let HR=class o11{constructor(){this.cullAboveGround=!1}};var qR,WR;!function(fe){fe[fe.INTEGRATED_MESH=0]="INTEGRATED_MESH",fe[fe.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",fe[fe.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",fe[fe.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",fe[fe.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",fe[fe.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",fe[fe.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",fe[fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",fe[fe.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",fe[fe.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",fe[fe.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",fe[fe.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",fe[fe.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",fe[fe.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",fe[fe.LASERLINES=14]="LASERLINES",fe[fe.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",fe[fe.HUD_MATERIAL=16]="HUD_MATERIAL",fe[fe.LABEL_MATERIAL=17]="LABEL_MATERIAL",fe[fe.LINE_CALLOUTS=18]="LINE_CALLOUTS",fe[fe.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",fe[fe.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",fe[fe.DRAPED_WATER=21]="DRAPED_WATER",fe[fe.VIEWSHED=22]="VIEWSHED",fe[fe.VOXEL=23]="VOXEL",fe[fe.MAX_SLOTS=24]="MAX_SLOTS"}(qR||(qR={})),function(fe){fe[fe.ColorAlpha=0]="ColorAlpha",fe[fe.FrontFace=1]="FrontFace",fe[fe.NONE=2]="NONE",fe[fe.COUNT=3]="COUNT"}(WR||(WR={}));let YR=class i15{constructor(fe=[0,0,0]){this.intensity=fe}},ZR=class r10{constructor(fe=[0,0,0],ve=r$3y(.57735,.57735,.57735)){this.intensity=fe,this.direction=ve}},XR=class c17{constructor(fe=[0,0,0],ve=r$3y(.57735,.57735,.57735),_e=!0,be=1,we=1){this.intensity=fe,this.direction=ve,this.castShadows=_e,this.specularStrength=be,this.environmentStrength=we}},JR=class n12{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function n$2U(fe,ve,_e){(_e=_e||fe).length=fe.length;for(let be=0;be<fe.length;be++)_e[be]=fe[be]*ve[be];return _e}function e$2N(fe,ve,_e){(_e=_e||fe).length=fe.length;for(let be=0;be<fe.length;be++)_e[be]=fe[be]*ve;return _e}function l$2U(fe,ve,_e){(_e=_e||fe).length=fe.length;for(let be=0;be<fe.length;be++)_e[be]=fe[be]+ve[be];return _e}function u$2r(fe){return(fe+1)*(fe+1)}function m$2h(fe,ve,_e){const be=fe[0],we=fe[1],Se=fe[2],Te=_e||[];return Te.length=u$2r(ve),ve>=0&&(Te[0]=.28209479177),ve>=1&&(Te[1]=.4886025119*be,Te[2]=.4886025119*Se,Te[3]=.4886025119*we),ve>=2&&(Te[4]=1.09254843059*be*we,Te[5]=1.09254843059*we*Se,Te[6]=.31539156525*(3*Se*Se-1),Te[7]=1.09254843059*be*Se,Te[8]=.54627421529*(be*be-we*we)),Te}function b$1m(fe,ve){const _e=function l$2T(fe){return e$3Y(Math.floor(Math.sqrt(fe)-1),0,2)}(ve.r.length);for(const be of fe)j$1O(iI,be.direction),m$2h(iI,_e,tI),n$2U(tI,nI),e$2N(tI,be.intensity[0],rI),l$2U(ve.r,rI),e$2N(tI,be.intensity[1],rI),l$2U(ve.g,rI),e$2N(tI,be.intensity[2],rI),l$2U(ve.b,rI);return ve}function M$Y(fe,ve,_e,be){(function p$2S(fe,ve){const _e=u$2r(fe),be=ve||{r:[],g:[],b:[]};be.r.length=be.g.length=be.b.length=_e;for(let we=0;we<_e;we++)be.r[we]=be.g[we]=be.b[we]=0;return be})(ve,be),o$44(_e.intensity,0,0,0);let we=!1;const Se=QR,Te=KR,Ee=eI;Se.length=0,Te.length=0,Ee.length=0;for(const Ce of fe)Ce instanceof XR&&!we?(r$3w(_e.direction,Ce.direction),r$3w(_e.intensity,Ce.intensity),_e.specularStrength=Ce.specularStrength,_e.environmentStrength=Ce.environmentStrength,_e.castShadows=Ce.castShadows,we=!0):Ce instanceof XR||Ce instanceof ZR?Se.push(Ce):Ce instanceof YR?Te.push(Ce):Ce instanceof JR&&Ee.push(Ce);b$1m(Se,be),function y$1r(fe,ve){m$2h(iI,0,tI);for(const _e of fe)ve.r[0]+=tI[0]*nI[0]*_e.intensity[0]*4*Math.PI,ve.g[0]+=tI[0]*nI[0]*_e.intensity[1]*4*Math.PI,ve.b[0]+=tI[0]*nI[0]*_e.intensity[2]*4*Math.PI;return ve}(Te,be);for(const Ce of Ee)l$2U(be.r,Ce.r),l$2U(be.g,Ce.g),l$2U(be.b,Ce.b)}const QR=[],KR=[],eI=[],tI=[0],rI=[0],iI=[0,0,0],nI=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let sI=class g4{constructor(){this.color=[0,0,0],this.intensity=1}},oI=class m12{constructor(){this.direction=[0,0,0],this.ambient=new sI,this.diffuse=new sI}};const aI=.4;let lI=class _3{constructor(){this._shOrder=2,this._legacy=new oI,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new JR,this._mainLight=new XR([0,0,0],r$3y(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(fe){M$Y(fe,this._shOrder,this._mainLight,this._sphericalHarmonics),r$3w(this._legacy.direction,this._mainLight.direction);const ve=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*ve,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*ve,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*ve,g$2z(this._legacy.diffuse.color,this._mainLight.intensity,ve),r$3w(cI,this._legacy.diffuse.color),g$2z(cI,cI,aI*this.globalFactor),u$3Y(this._legacy.ambient.color,this._legacy.ambient.color,cI)}copyFrom(fe){this._sphericalHarmonics.r=Array.from(fe.sh.r),this._sphericalHarmonics.g=Array.from(fe.sh.g),this._sphericalHarmonics.b=Array.from(fe.sh.b),r$3w(this._mainLight.direction,fe.mainLight.direction),r$3w(this._mainLight.intensity,fe.mainLight.intensity),this._mainLight.castShadows=fe.mainLight.castShadows,this._mainLight.specularStrength=fe.mainLight.specularStrength,this._mainLight.environmentStrength=fe.mainLight.environmentStrength,this.globalFactor=fe.globalFactor,this.noonFactor=fe.noonFactor}lerpLighting(fe,ve,_e){if(A$1G(this._mainLight.intensity,fe.mainLight.intensity,ve.mainLight.intensity,_e),this._mainLight.environmentStrength=f$3i(fe.mainLight.environmentStrength,ve.mainLight.environmentStrength,_e),this._mainLight.specularStrength=f$3i(fe.mainLight.specularStrength,ve.mainLight.specularStrength,_e),r$3w(this._mainLight.direction,ve.mainLight.direction),this._mainLight.castShadows=ve.mainLight.castShadows,this.globalFactor=f$3i(fe.globalFactor,ve.globalFactor,_e),this.noonFactor=f$3i(fe.noonFactor,ve.noonFactor,_e),fe.sh.r.length===ve.sh.r.length)for(let be=0;be<ve.sh.r.length;be++)this._sphericalHarmonics.r[be]=f$3i(fe.sh.r[be],ve.sh.r[be],_e),this._sphericalHarmonics.g[be]=f$3i(fe.sh.g[be],ve.sh.g[be],_e),this._sphericalHarmonics.b[be]=f$3i(fe.sh.b[be],ve.sh.b[be],_e);else for(let be=0;be<ve.sh.r.length;be++)this._sphericalHarmonics.r[be]=ve.sh.r[be],this._sphericalHarmonics.g[be]=ve.sh.g[be],this._sphericalHarmonics.b[be]=ve.sh.b[be]}};const cI=[0,0,0];let uI=class m13{constructor(fe,ve){this.shadowMap=fe,this.slicePlane=ve,this.slot=qR.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=WR.NONE,this.alignPixelEnabled=!1,this.decorations=TA.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new NR,this._inverseViewport=[0,0],this.oldLighting=new lI,this.newLighting=new lI,this._fadedLighting=new lI,this._lighting=this.newLighting,this.ssr=new hI,this.multipassEnabled=!1,this.multipassTerrain=new HR,this.multipassGeometry=new GR,this.hudRenderStyle=BR.Occluded,this.cloudsFade=new CM,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(fe){this._camera=fe,this._inverseViewport[0]=1/fe.fullViewport[2],this._inverseViewport[1]=1/fe.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(fe){const{oldLighting:ve,newLighting:_e}=this;fe>=1?this._lighting=_e:(this._fadedLighting.lerpLighting(ve,_e,fe),this._lighting=this._fadedLighting)}},hI=class d11{constructor(){this.fadeFactor=1,this.reprojectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};const dI=Symbol("Yield");let pI=class i16{constructor(){this._tasks=new Array,this._runningTasks=r$2W(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(fe){if(0===this.length)return dI;for(;!fe.done&&this._process(fe);)fe.madeProgress()}push(fe,ve,_e){return++this._runningTasks.value,new Promise(((be,we)=>this._tasks.push(new fI(be,we,fe,ve,_e)))).finally((()=>--this._runningTasks.value))}unshift(fe,ve,_e){return++this._runningTasks.value,new Promise(((be,we)=>this._tasks.unshift(new fI(be,we,fe,ve,_e)))).finally((()=>--this._runningTasks.value))}_process(fe){var ve;if(0===this._tasks.length)return!1;const _e=this._tasks.shift();try{const be=c$4_(_e.signal);if(be&&!_e.abortCallback)_e.reject(u$47());else{const we=be?null==(ve=_e.abortCallback)?void 0:ve.call(_e,u$47()):_e.callback(fe);S$1T(we)?we.then(_e.resolve,_e.reject):_e.resolve(we)}}catch(br){_e.reject(br)}return!0}cancelAll(){const fe=u$47();for(const ve of this._tasks)if(ve.abortCallback){const _e=ve.abortCallback(fe);ve.resolve(_e)}else ve.reject(fe);this._tasks.length=0}},fI=class a8{constructor(fe,ve,_e,be=void 0,we=void 0){this.resolve=fe,this.reject=ve,this.callback=_e,this.signal=be,this.abortCallback=we}},mI=class e15 extends zi{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};e$4o([y$2v()],mI.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e$4o([y$2v()],mI.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),mI=e$4o([a$4y("esri.views.support.debugFlags")],mI);const yI=new mI;var gI;!function(fe){fe.RESOURCE_CONTROLLER_IMMEDIATE="immediate",fe.RESOURCE_CONTROLLER="schedule",fe.SLIDE="slide",fe.STREAM_DATA_LOADER="stream loader",fe.ELEVATION_QUERY="elevation query",fe.TERRAIN_SURFACE="terrain",fe.SURFACE_GEOMETRY_UPDATES="surface geometry updates",fe.LOD_RENDERER="LoD renderer",fe.GRAPHICS_CORE="Graphics3D",fe.I3S_CONTROLLER="I3S",fe.POINT_CLOUD_LAYER="point cloud",fe.FEATURE_TILE_FETCHER="feature fetcher",fe.OVERLAY="overlay",fe.STAGE="stage",fe.GRAPHICS_DECONFLICTOR="graphics deconflictor",fe.FILTER_VISIBILITY="Graphics3D filter visibility",fe.SCALE_VISIBILITY="Graphics3D scale visibility",fe.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",fe.POINT_OF_INTEREST_FREQUENT="POI frequent",fe.POINT_OF_INTEREST_INFREQUENT="POI infrequent",fe.LABELER="labeler",fe.FEATURE_QUERY_ENGINE="feature query",fe.FEATURE_TILE_TREE="feature tile tree",fe.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",fe.ELEVATION_ALIGNMENT="elevation alignment",fe.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",fe.TEXT_TEXTURE_ATLAS="text texture atlas",fe.TEXTURE_UNLOAD="texture unload",fe.LINE_OF_SIGHT_TOOL="line of sight tool",fe.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",fe.ELEVATION_PROFILE="elevation profile",fe.SNAPPING="snapping",fe.SHADOW_ACCUMULATOR="shadow accumulator",fe.CLOUDS_GENERATOR="clouds generator",fe[fe.NONE=0]="NONE",fe[fe.TEST_PRIO=1]="TEST_PRIO"}(gI||(gI={}));const vI=new Map([[gI.RESOURCE_CONTROLLER_IMMEDIATE,0],[gI.RESOURCE_CONTROLLER,4],[gI.SLIDE,0],[gI.STREAM_DATA_LOADER,0],[gI.ELEVATION_QUERY,0],[gI.TERRAIN_SURFACE,1],[gI.SURFACE_GEOMETRY_UPDATES,1],[gI.LOD_RENDERER,2],[gI.GRAPHICS_CORE,2],[gI.I3S_CONTROLLER,2],[gI.POINT_CLOUD_LAYER,2],[gI.FEATURE_TILE_FETCHER,2],[gI.OVERLAY,4],[gI.STAGE,4],[gI.GRAPHICS_DECONFLICTOR,4],[gI.FILTER_VISIBILITY,4],[gI.SCALE_VISIBILITY,4],[gI.FRUSTUM_VISIBILITY,4],[gI.CLOUDS_GENERATOR,4],[gI.POINT_OF_INTEREST_FREQUENT,6],[gI.POINT_OF_INTEREST_INFREQUENT,30],[gI.LABELER,8],[gI.FEATURE_QUERY_ENGINE,8],[gI.FEATURE_TILE_TREE,16],[gI.FEATURE_TILE_TREE_ACTIVE,0],[gI.ELEVATION_ALIGNMENT,12],[gI.ELEVATION_ALIGNMENT_SCENE,14],[gI.TEXT_TEXTURE_ATLAS,12],[gI.TEXTURE_UNLOAD,12],[gI.LINE_OF_SIGHT_TOOL,16],[gI.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[gI.SNAPPING,0],[gI.SHADOW_ACCUMULATOR,30]]);function f$21(fe){return vI.has(fe)?vI.get(fe):"number"==typeof fe?fe:1}const _I=1e3/30;var $I,bI;!function(fe){fe.Scheduler=class n52{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((fe=>fe.needsUpdate))}constructor(){this._updating=r$2W(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Ur("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new g25,this._state=PM.INTERACTING,this._tasks=new jr,this._runQueue=new jr,this._load=0,this._idleStateCallbacks=new jr,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=d$3d((()=>yI.SCHEDULER_LOG_SLOW_TASKS),(fe=>this._debug=fe),Xa);for(const fe of Object.keys(gI))this.performanceInfo.tasks.set(gI[fe],new Ur(gI[fe]))}destroy(){this._tasks.toArray().forEach((fe=>fe.remove())),this._tasks.clear(),l$4E(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(fe){this._updatingChanged(),fe&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(fe,ve){const _e=new _21(this,fe,ve);return this._tasks.push(_e),this._updatingChanged(),this.performanceInfo.tasks.has(fe)||this.performanceInfo.tasks.set(fe,new Ur(fe)),_e}registerIdleStateCallbacks(fe,ve){const _e={idleBegin:fe,idleEnd:ve};this._idleStateCallbacks.push(_e),this.state===PM.IDLE&&this._idleUpdatesStartFired&&_e.idleBegin();const be=this;return{remove:()=>this._removeIdleStateCallbacks(_e),set idleBegin(fe){be._idleUpdatesStartFired&&(_e.idleEnd(),be._state===PM.IDLE&&fe()),_e.idleBegin=fe},set idleEnd(fe){_e.idleEnd=fe}}}get load(){return this._load}set state(fe){this._state!==fe&&(this._state=fe,this.state!==PM.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((fe=>fe.idleEnd()))))}get state(){return this._state}updateBudget(fe){++this._frameNumber;let ve=6.5,_e=fe.frameDuration,be=1;switch(this.state){case PM.IDLE:ve=0,_e=Math.max(100,fe.frameDuration),be=30;break;case PM.INTERACTING:_e=Math.max(_I,fe.frameDuration);case PM.ANIMATING:}return _e=_e-fe.elapsedFrameTime-ve,this.state!==PM.IDLE&&_e<1&&!this._forceTask?(this._forceTask=!0,!1):(_e=Math.max(_e,be),this._budget.reset(_e,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case PM.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((fe=>fe.idleBegin()))),this._runIdle();break;case PM.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(fe){this._idleUpdatesStartFired&&fe.idleEnd(),this._idleStateCallbacks.removeUnordered(fe)}removeTask(fe){this._tasks.removeUnordered(fe),this._runQueue.removeUnordered(fe),this._updatingChanged()}_updateTask(fe){this._tasks.forAll((ve=>{ve.name===fe&&ve.setPriority(fe)}))}_getState(fe){if(this._runQueue.some((ve=>ve.name===fe)))return bI.SCHEDULED;let ve=bI.IDLE;return this._tasks.forAll((_e=>{_e.name===fe&&_e.needsUpdate&&(_e.schedulePriority<=1?ve=bI.READY:ve!==bI.READY&&(ve=bI.WAITING))})),ve}_getRuntime(fe){let ve=0;return this._tasks.forAll((_e=>{_e.name===fe&&(ve+=_e.runtime)})),ve}_resetRuntimes(){this._tasks.forAll((fe=>fe.runtime=0))}_getRunning(){const fe=new Map;if(this._tasks.forAll((ve=>{ve.needsUpdate&&fe.set(ve.name,(fe.get(ve.name)||0)+1)})),0===fe.size)return null;let ve="";return fe.forEach(((fe,_e)=>{ve+=fe>1?` ${fe}x ${_e}`:` ${_e}`})),ve}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const fe=this._tasks.reduce(((fe,ve)=>ve.needsUpdate?++fe:fe),0);this._load=.9*this._load+fe*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((fe=>!!fe.needsUpdate||(fe.schedulePriority=fe.basePriority,!1))),this._tasks.forAll((fe=>{0===fe.basePriority&&fe.needsUpdate&&!this._runQueue.includes(fe)&&fe.blockFrame!==this._frameNumber&&this._runQueue.unshift(fe)}));0===this._runQueue.length;){let fe=!1,ve=0;if(this._tasks.forAll((_e=>{_e.needsUpdate&&0!==_e.schedulePriority&&0!==_e.basePriority&&_e.blockFrame!==this._frameNumber&&(fe=!0,ve=Math.max(ve,_e.basePriority),1===_e.schedulePriority?(_e.schedulePriority=0,this._runQueue.push(_e)):--_e.schedulePriority)})),!fe)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const fe=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const ve=this._budget.now(),_e=this._runQueue.pop();this._budget.resetProgress();try{_e.task.runTask(this._budget)===dI&&(_e.blockFrame=this._frameNumber)}catch(vv){ar.getLogger("esri.views.support.Scheduler").error(`Exception in task "${_e.name}"`,vv),_e.blockFrame=this._frameNumber}!this._budget.hasProgressed&&_e.blockFrame!==this._frameNumber&&_e.needsUpdate&&(_e.name,gI.I3S_CONTROLLER,_e.blockFrame=this._frameNumber),_e.schedulePriority=_e.basePriority;const be=this._budget.now()-ve;if(_e.runtime+=be,this._frameTaskTimes.set(_e.priority,this._frameTaskTimes.get(_e.priority)+be),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-fe)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-fe)}_startFrameTaskTimes(){for(const fe of Object.keys(gI))this._frameTaskTimes.set(gI[fe],0)}_recordFrameTaskTimes(fe){this._frameTaskTimes.forEach(((fe,ve)=>this.performanceInfo.tasks.get(ve).record(fe))),this.performanceInfo.total.record(fe)}get test(){}};class _21{get task(){return this._task.value}get updating(){return this._queue.running}constructor(fe,ve,_e){this._scheduler=fe,this.name=ve,this.blockFrame=0,this.runtime=0,this._queue=new pI,this._handles=new jt,this._basePriority=f$21(ve),this.schedulePriority=this._basePriority,this._task=r$2W(null!=_e?_e:this._queue),this._handles.add(p$4J((()=>this.task.running),(ve=>fe.taskRunningChanged(ve))))}remove(){this.processQueue(wI),this._scheduler.removeTask(this),this.schedule=xI.schedule,this.reschedule=xI.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(fe){if(this.name===fe)return;this.name=fe;const ve=f$21(fe);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=ve),this._basePriority=ve}get priority(){return this.name}set priority(fe){this.setPriority(fe)}get needsUpdate(){return this.updating||this.task.running}schedule(fe,ve,_e){return this._queue.push(fe,ve,_e)}reschedule(fe,ve,_e){return this._queue.unshift(fe,ve,_e)}processQueue(fe){return this._queue.runTask(fe)}}class g25{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=PM.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(fe){return!this.done&&(!0===fe()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(fe){this._enabled=fe}reset(fe,ve){this._begin=this.now(),this._budget=fe,this._state=ve,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}fe.Budget=g25}($I||($I={})),function(fe){fe.SCHEDULED="s",fe.READY="r",fe.WAITING="w",fe.IDLE="i"}(bI||(bI={}));const wI=(()=>{const fe=new $I.Budget;return fe.enabled=!1,fe})();const xI=new class P2{remove(){}processQueue(){}schedule(fe,ve,_e){try{if(c$4_(ve)){const fe=u$47();return _e?Promise.resolve(_e(fe)):Promise.reject(fe)}return C$1t(fe(wI))}catch(Dr){return Promise.reject(Dr)}}reschedule(fe,ve,_e){return this.schedule(fe,ve,_e)}};let SI=class A4 extends zi{constructor(fe){super(fe),this._techniques=new Array,this._techniqueConfiguration=new JM,this._bindParameters=new uI(null,null),this._passParameters=new aR,this._weatherTile=[0,0],this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=f$3i(eR.default.coverage[0],eR.default.coverage[1],.5),this.density=f$3i(eR.default.density[0],eR.default.density[1],.5),this.absorption=f$3i(eR.default.absorption[0],eR.default.absorption[1],.5),this.cloudSize=f$3i(eR.default.cloudSize[0],eR.default.cloudSize[1],.5),this.detailSize=f$3i(eR.default.detailSize[0],eR.default.detailSize[1],.5),this.smoothness=f$3i(eR.default.smoothness[0],eR.default.smoothness[1],.5),this.cloudHeight=f$3i(eR.default.cloudHeight[0],eR.default.cloudHeight[1],.5),this.raymarchingSteps=eR.default.raymarchingSteps,this._viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._dirty=!1,this.running=!1,this._vao=i$2S(fe.context.renderContext.rctx)}_getTechnique(fe){const ve=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,_e=ve===$M.RG?2*fe:2*fe+1;return this._techniques[_e]||(this._techniqueConfiguration.writeTextureChannels=ve,this._techniqueConfiguration.steps=fe,this._techniques[_e]=new uR({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[_e])}updateWeatherTile(){const fe=this.view.camera.position.latitude,ve=this.view.camera.position.longitude;if(null==fe||null==ve)return;o$2R(this._weatherTile,(fe+90)/180,(ve+180)/360);const _e=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-_e)*this._weatherTile[1]);let be=0,we=0;if(null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date){const fe=new Date(this.view.environment.lighting.date);fe.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),be=31*fe.getUTCMonth()+fe.getUTCDate(),we=fe.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+be)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+we%100)%(4*this._weatherTileCount),T$_(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const fe=s$45(this.view.spatialReference);this._passParameters.cloudRadius=.5*fe.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(gI.CLOUDS_GENERATOR,this),d$3d((()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps]),(()=>this.setDirty()),Xa)])}destroy(){this._techniques.forEach((fe=>t$4r(fe))),this._frameBufferCube=r$3M(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=u$4d(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case XM.SIXTEEN:return 1;case XM.HUNDRED:return 4;case XM.COUNT:case XM.TWOHUNDRED:return 8}}get usedMemory(){var fe,ve,_e;return((null==(fe=this._frameBufferCube)?void 0:fe.usedMemory)??0)+((null==(_e=null==(ve=this._passParameters.noiseTexture)?void 0:ve.textureAtlas)?void 0:_e.usedMemory)??0)}_ensureNoiseTexture(){var fe;return(fe=this._passParameters).noiseTexture??(fe.noiseTexture=new _R({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(fe){if(null==this._frameBufferCube){const ve=new nM(fe);ve.target=WO.TEXTURE_CUBE_MAP,ve.wrapMode=qO.CLAMP_TO_EDGE,this._frameBufferCube=new vR(this.context.renderContext.rctx,ve)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=r$3M(this._frameBufferCube)}applyPreset(fe,ve){const _e=fe.median,r65=fe=>{const be=f$3i(fe[0],fe[1],_e);return ve<.5?f$3i(fe[0],be,2*ve):f$3i(be,fe[1],2*(ve-.5))};this.coverage=r65(fe.coverage),this.density=r65(fe.density),this.absorption=r65(fe.absorption),this.cloudSize=r65(fe.cloudSize),this.detailSize=r65(fe.detailSize),this.smoothness=r65(fe.smoothness),this.cloudHeight=r65(fe.cloudHeight),this.raymarchingSteps=fe.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(fe){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),r$2C(this._passParameters.weatherTile,this._weatherTile));const ve=this._getTechnique(this._passParameters.raymarchingSteps);if(!ve.compiled)return dI;if(this.context.renderContext.bindParameters.cloudsFade.fadeMode===OM.CROSS_FADE||!this._ensureNoiseTexture())return dI;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=_M.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const _e=TI[this._faceIndex],be=EI[this._faceIndex];Y$z(this._viewMatrix,PI,_e,be),n$3X(this._passParameters.viewMatrix,this._viewMatrix);const we=this.context.renderContext.rctx,Se=we.bindTechnique(ve,this._bindParameters,this._passParameters);we.bindVAO(this._vao),Se.assertCompatibleVertexAttributeLocations(this._vao);const Te=we.getViewport(),Ee=ve.configuration.cubeMapSize,Ce=Ee/this._tilesPerFace,Oe=this._tileIndex*Ce;we.setViewport(0,Oe,Ee,Ce);const Re=this._ensureFrameBufferCube(Ee);we.bindFramebuffer(Re);const De=WO.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return Re.setColorTextureTarget(De),we.gl.drawArrays(we.gl.TRIANGLE_STRIP,0,4),we.gl.flush(),we.setViewport(Te.x,Te.y,Te.width,Te.height),this.requestRender(),++this._tileIndex,4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=_M.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),fe.madeProgress(),dI}};e$4o([y$2v({constructOnly:!0})],SI.prototype,"context",void 0),e$4o([y$2v({constructOnly:!0})],SI.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],SI.prototype,"requestRender",void 0),e$4o([y$2v()],SI.prototype,"coverage",void 0),e$4o([y$2v()],SI.prototype,"density",void 0),e$4o([y$2v()],SI.prototype,"absorption",void 0),e$4o([y$2v()],SI.prototype,"cloudSize",void 0),e$4o([y$2v()],SI.prototype,"detailSize",void 0),e$4o([y$2v()],SI.prototype,"smoothness",void 0),e$4o([y$2v()],SI.prototype,"cloudHeight",void 0),e$4o([y$2v()],SI.prototype,"raymarchingSteps",void 0),e$4o([y$2v()],SI.prototype,"running",void 0),SI=e$4o([a$4y("esri.views.3d.environment.CloudsGenerator")],SI);const TI=[r$2r(1,0,0),r$2r(-1,0,0),r$2r(0,1,0),r$2r(0,-1,0),r$2r(0,0,1)],EI=[r$2r(0,1,0),r$2r(0,1,0),r$2r(0,0,-1),r$2r(0,0,1),r$2r(0,1,0)],PI=o$2y();let CI=class u7 extends iO{constructor(){super(...arguments),this.fogColor=[0,0,0],this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function h$1R(){const fe=new gO;fe.attributes.add(nO.POSITION,"vec2"),fe.include(o$2O,{textureCoordinateType:sO.Default}),fe.varyings.add("worldRay","vec3"),fe.varyings.add("eyeDir","vec3");const{vertex:ve,fragment:_e}=fe;return ve.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix)),new pO("inverseViewMatrix",((fe,ve)=>e$3H(OI,ve.camera.viewMatrix)))),ve.code.add(o$2P`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),_e.uniforms.add(new dO("atmosphereC",(fe=>fe.atmosphereC)),new uO("cameraPosition",((fe,ve)=>ve.camera.eye)),new lO("nearFar",((fe,ve)=>ve.camera.nearFar)),new CO("depthTexture",(fe=>fe.depthTexture)),new dO("fogStrength",(fe=>fe.fogStrength)),new dO("fogAmount",(fe=>fe.fogAmount)),new uO("fogColor",(fe=>fe.fogColor))),fe.include(e$31),_e.include(i$2Y),_e.code.add(o$2P`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),_e.code.add(o$2P`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),_e.code.add(o$2P`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),fe}const OI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],AI=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:CI,build:h$1R},Symbol.toStringTag,{value:"Module"}));let MI=class m14 extends fA{constructor(fe){super(fe,new HA,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,m14.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ZERO,FO.ONE_MINUS_SRC_ALPHA,FO.ONE),colorWrite:AA})}};MI.shader=new LO(AI,(()=>zt((()=>Promise.resolve().then((()=>KMe))),void 0)));let RI=class x3 extends zi{constructor(fe){super(fe),this._passParameters=new CI;const ve=fe.context.renderContext.rctx;this._vao=i$2S(ve,KA),this._technique=new MI(fe);const _e=s$45(fe.view.spatialReference);this._planetRadius=_e.radius,this._atmosphereRadius=_e.radius+rO}destroy(){this._technique.release(),this._vao.dispose()}set strength(fe){this._passParameters.fogStrength=fe}get strength(){return this._passParameters.fogStrength}render(fe,ve){if(this._update(fe,ve),this._passParameters.fogAmount<=0)return;const _e=this._technique;if(!_e.compiled)return void this.context.requestRender();const be=fe.offscreenRenderingHelper;be.renderDepthDetached((()=>{this._passParameters.depthTexture=be.depthTexture;const ve=fe.rctx.bindTechnique(_e,fe.bindParameters,this._passParameters);this._renderFog(ve,fe)}))}_renderFog(fe,ve){const _e=ve.rctx;_e.bindVAO(this._vao),fe.assertCompatibleVertexAttributeLocations(this._vao),_e.drawArrays(NO.TRIANGLE_STRIP,0,4)}_update(fe,ve){const _e=fe.bindParameters.camera;z$1d(LI,_e.eye);const be=Math.max(0,P$1g(LI,fe.bindParameters.lighting.mainLight.direction)),we=ve.color;g$2z(DI,we,.1),A$1G(this._passParameters.fogColor,DI,we,be);const Se=s$4g(_e.eye),Te=Se*Se;this._passParameters.atmosphereC=Te-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-p$4Y(9500,1e4,Math.abs(Se-this._planetRadius)))*ve.amount,this._passParameters.fogStrength=ve.strength}};e$4o([y$2v({constructOnly:!0})],RI.prototype,"context",void 0),e$4o([y$2v({constructOnly:!0})],RI.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],RI.prototype,"rctx",void 0),e$4o([y$2v({constructOnly:!0})],RI.prototype,"viewingMode",void 0),RI=e$4o([a$4y("esri.views.3d.environment.Fog")],RI);let II=class y3{constructor(){this.color=[0,0,0],this.strength=0,this.amount=0}};const LI=[0,0,0],DI=[0,0,0];var NI;function r$2k(fe){return fe===NI.Shadow||fe===NI.ShadowHighlight||fe===NI.ShadowExcludeHighlight||fe===NI.ViewshedShadow}function n$2T(fe){return c$2L(fe)||fe===NI.Normal}function h$1Q(fe){return fe===NI.Highlight||fe===NI.ObjectAndLayerIdColor}function e$2L(fe){return fe===NI.Color||h$1Q(fe)}function i$2J(fe){return fe===NI.Color}function d$20(fe){return i$2J(fe)||fe===NI.ObjectAndLayerIdColor}function l$2R(fe){return function u$2p(fe){return i$2J(fe)||fe===NI.Highlight}(fe)||g$1A(fe)}function a$2J(fe){return i$2J(fe)||h$1Q(fe)}function c$2L(fe){return a$2J(fe)||g$1A(fe)}function g$1A(fe){return fe===NI.Depth}function c$2K({code:fe},ve){ve.doublePrecisionRequiresObfuscation?fe.add(o$2P`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):fe.add(o$2P`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}!function(fe){fe[fe.Color=0]="Color",fe[fe.Depth=1]="Depth",fe[fe.Normal=2]="Normal",fe[fe.Shadow=3]="Shadow",fe[fe.ShadowHighlight=4]="ShadowHighlight",fe[fe.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",fe[fe.ViewshedShadow=6]="ViewshedShadow",fe[fe.Highlight=7]="Highlight",fe[fe.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",fe[fe.COUNT=9]="COUNT"}(NI||(NI={}));let FI=class o12 extends aO{constructor(fe,ve){super(fe,"mat4",oO.Draw,((_e,be,we)=>_e.setUniformMatrix4fv(fe,ve(be,we))))}};function f$20(fe,ve){ve.instancedDoublePrecision?fe.constants.add("cameraPosition","vec3",Bi):fe.uniforms.add(new hM("cameraPosition",((fe,ve)=>o$44(kI,ve.camera.viewInverseTransposeMatrix[3]-fe.origin[0],ve.camera.viewInverseTransposeMatrix[7]-fe.origin[1],ve.camera.viewInverseTransposeMatrix[11]-fe.origin[2]))))}function d$1$(fe,ve){if(!ve.instancedDoublePrecision)return void fe.uniforms.add(new pO("proj",((fe,ve)=>ve.camera.projectionMatrix)),new FI("view",((fe,ve)=>i$45(zI,ve.camera.viewMatrix,fe.origin))),new hM("localOrigin",(fe=>fe.origin)));const o39=fe=>o$44(kI,fe.camera.viewInverseTransposeMatrix[3],fe.camera.viewInverseTransposeMatrix[7],fe.camera.viewInverseTransposeMatrix[11]);fe.uniforms.add(new pO("proj",((fe,ve)=>ve.camera.projectionMatrix)),new pO("view",((fe,ve)=>i$45(zI,ve.camera.viewMatrix,o39(ve)))),new uO("localOrigin",((fe,ve)=>o39(ve))))}const zI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],kI=[0,0,0];function p$2Q(fe){fe.uniforms.add(new pO("viewNormal",((fe,ve)=>ve.camera.viewInverseTransposeMatrix)))}function w$1d(fe){fe.uniforms.add(new dO("pixelRatio",((fe,ve)=>ve.camera.pixelRatio/ve.overlayStretch)))}function t$2O(fe,ve,_e){for(let be=0;be<_e;++be)ve[2*be]=fe[be],ve[2*be+1]=fe[be]-ve[2*be]}const UI=new Float32Array(2);let VI=class O3 extends HA{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};e$4o([r$2w()],VI.prototype,"instancedDoublePrecision",void 0),e$4o([r$2w()],VI.prototype,"hasModelTransformation",void 0);const BI=[1,0,0,0,1,0,0,0,1];function N$N(fe,ve){const _e=ve.hasModelTransformation,be=ve.instancedDoublePrecision;_e&&(fe.vertex.uniforms.add(new pO("model",(fe=>fe.modelTransformation??dd))),fe.vertex.uniforms.add(new oR("normalLocalOriginFromModel",(fe=>(j$1r(BI,fe.modelTransformation??dd),BI))))),ve.instanced&&be&&(fe.attributes.add(nO.INSTANCEMODELORIGINHI,"vec3"),fe.attributes.add(nO.INSTANCEMODELORIGINLO,"vec3"),fe.attributes.add(nO.INSTANCEMODEL,"mat3"),fe.attributes.add(nO.INSTANCEMODELNORMAL,"mat3"));const we=fe.vertex;be&&(we.include(c$2K,ve),we.uniforms.add(new hM("viewOriginHi",((fe,ve)=>function o$2q(fe,ve){const _e=fe.length;for(let be=0;be<_e;++be)UI[0]=fe[be],ve[be]=UI[0];return ve}(o$44(jI,ve.camera.viewInverseTransposeMatrix[3],ve.camera.viewInverseTransposeMatrix[7],ve.camera.viewInverseTransposeMatrix[11]),jI))),new hM("viewOriginLo",((fe,ve)=>function r$2j(fe,ve){const _e=fe.length;for(let be=0;be<_e;++be)UI[0]=fe[be],UI[1]=fe[be]-UI[0],ve[be]=UI[1];return ve}(o$44(jI,ve.camera.viewInverseTransposeMatrix[3],ve.camera.viewInverseTransposeMatrix[7],ve.camera.viewInverseTransposeMatrix[11]),jI))))),we.code.add(o$2P`
    vec3 getVertexInLocalOriginSpace() {
      return ${_e?be?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":be?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${be?o$2P`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),we.code.add(o$2P`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${_e?be?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":be?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),ve.output===NI.Normal&&(p$2Q(we),we.code.add(o$2P`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${_e?be?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":be?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),ve.hasVertexTangents&&we.code.add(o$2P`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${_e?be?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":be?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const jI=[0,0,0];let GI=class t24 extends VI{};var HI;e$4o([r$2w({constValue:!0})],GI.prototype,"hasSliceHighlight",void 0),e$4o([r$2w({constValue:!1})],GI.prototype,"hasSliceInVertexProgram",void 0),e$4o([r$2w({constValue:oO.Pass})],GI.prototype,"pbrTextureBindType",void 0),function(fe){fe[fe.Cone=0]="Cone",fe[fe.Cylinder=1]="Cylinder",fe[fe.Underground=2]="Underground",fe[fe.COUNT=3]="COUNT"}(HI||(HI={}));let qI=class i17 extends GI{constructor(){super(...arguments),this.geometry=HI.Cone}};function o$2p(fe){fe.attributes.add(nO.POSITION,"vec3"),fe.vertex.code.add(o$2P`vec3 positionModel() { return position; }`)}e$4o([r$2w({count:HI.COUNT})],qI.prototype,"geometry",void 0);let WI=class o13 extends aO{constructor(fe,ve){super(fe,"mat3",oO.Draw,((_e,be,we)=>_e.setUniformMatrix3fv(fe,ve(be,we))))}};function v$1b(fe,ve){fe.include(o$2p);const _e=fe.vertex;_e.include(c$2K,ve),fe.varyings.add("vPositionWorldCameraRelative","vec3"),fe.varyings.add("vPosition_view","vec3"),_e.uniforms.add(new uO("transformWorldFromViewTH",(fe=>fe.transformWorldFromViewTH)),new uO("transformWorldFromViewTL",(fe=>fe.transformWorldFromViewTL)),new oR("transformViewFromCameraRelativeRS",(fe=>fe.transformViewFromCameraRelativeRS)),new pO("transformProjFromView",(fe=>fe.transformProjFromView)),new WI("transformWorldFromModelRS",(fe=>fe.transformWorldFromModelRS)),new hM("transformWorldFromModelTH",(fe=>fe.transformWorldFromModelTH)),new hM("transformWorldFromModelTL",(fe=>fe.transformWorldFromModelTL))),_e.code.add(o$2P`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),_e.code.add(o$2P`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${ve.spherical?o$2P`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:o$2P`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),fe.fragment.uniforms.add(new uO("transformWorldFromViewTL",(fe=>fe.transformWorldFromViewTL))),_e.code.add(o$2P`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),fe.fragment.code.add(o$2P`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let YI=class F extends iO{constructor(){super(...arguments),this.transformWorldFromViewTH=[0,0,0],this.transformWorldFromViewTL=[0,0,0],this.transformViewFromCameraRelativeRS=[1,0,0,0,1,0,0,0,1],this.transformProjFromView=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},ZI=class W extends iO{constructor(){super(...arguments),this.transformWorldFromModelRS=[1,0,0,0,1,0,0,0,1],this.transformWorldFromModelTH=[0,0,0],this.transformWorldFromModelTL=[0,0,0]}};function t$2M(fe){fe.varyings.add("linearDepth","float")}function i$2H(fe){fe.vertex.uniforms.add(new lO("nearFar",((fe,ve)=>ve.camera.nearFar)))}function d$1_(fe){fe.vertex.code.add(o$2P`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function n$2S(fe,ve){const{vertex:_e}=fe;switch(ve.output){case NI.Color:if(ve.receiveShadows)return t$2M(fe),void _e.code.add(o$2P`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case NI.Shadow:case NI.ShadowHighlight:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:return fe.include(v$1b,ve),t$2M(fe),i$2H(fe),d$1_(fe),void _e.code.add(o$2P`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}_e.code.add(o$2P`void forwardLinearDepth() {}`)}function o$2n(fe){d$1_(fe),fe.vertex.code.add(o$2P`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),fe.vertex.code.add(o$2P`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let XI=class p17 extends iO{constructor(){super(...arguments),this.texV=[0,0],this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new JI}},JI=class u8{constructor(){this.center=[0,0,0],this.v1=[0,0,0],this.v2=[0,0,0]}};function v$1a(fe){const ve=new gO,{vertex:_e,fragment:be}=ve;if(t$34(_e),fe.geometry===HI.Underground)ve.attributes.add(nO.POSITION,"vec2"),ve.varyings.add("color","vec4"),_e.uniforms.add(new uO("cameraPosition",((fe,ve)=>ve.camera.eye)),new dO("undergroundFadeAlpha",(fe=>fe.undergroundFadeAlpha))),_e.code.add(o$2P`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),be.code.add(o$2P`void main() {
fragColor = color;
}`);else{ve.include(o$2n,fe),ve.attributes.add(nO.POSITION,"vec3"),ve.varyings.add("vtc","vec2"),ve.varyings.add("falloff","float");const we=fe.geometry===HI.Cylinder;_e.uniforms.add(new pO("proj",((fe,ve)=>ve.camera.projectionMatrix)),new pO("view",((fe,ve)=>ve.camera.viewMatrix))),we||(ve.varyings.add("innerFactor","float"),_e.uniforms.add(new uO("silCircleCenter",(fe=>fe.silhouette.center))),_e.uniforms.add(new uO("silCircleV1",(fe=>fe.silhouette.v1))),_e.uniforms.add(new uO("silCircleV2",(fe=>fe.silhouette.v2))),_e.uniforms.add(new lO("texV",(fe=>fe.texV))),_e.uniforms.add(new dO("innerScale",(fe=>fe.innerScale))));const Se=6.2831853,Te=1/128;_e.code.add(o$2P`
		void main(void) {
      ${we?o$2P`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:o$2P`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${o$2P.float(Se*Te)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${o$2P.float(Te)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),be.uniforms.add(new CO("tex",(fe=>fe.texture))),we||be.uniforms.add(new dO("altitudeFade",(fe=>fe.altitudeFade))),be.code.add(o$2P`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${we?o$2P`fragColor = atmosphereColor;`:o$2P`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return ve}const QI=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:JI,SimpleAtmospherePassParameters:XI,build:v$1a},Symbol.toStringTag,{value:"Module"}));let KI=class h5 extends fA{initializeProgram(fe){return new gA(fe.rctx,h5.shader.get().build(this.configuration),mA)}initializePipeline(){return this.configuration.geometry===HI.Cylinder?S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),culling:PA,depthTest:{func:jO.LEQUAL},colorWrite:AA}):S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};KI.shader=new LO(QI,(()=>zt((()=>Promise.resolve().then((()=>eRe))),void 0)));const eL=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function t$2L(fe,ve=0){const _e=fe.stride;return Array.from(fe.fields.keys()).map((be=>{var we;const Se=fe.fields.get(be),Te=Se.constructor.ElementCount,Ee=function o$2m(fe){const ve=tL[fe];if(ve)return ve;throw new Error("BufferType not supported in WebGL")}(Se.constructor.ElementType),Ce=Se.offset,Oe=(null==(we=Se.optional)?void 0:we.glNormalized)??!1;return new JA(be,Te,Ee,Ce,_e,Oe,ve)}))}const tL={u8:BO.UNSIGNED_BYTE,u16:BO.UNSIGNED_SHORT,u32:BO.UNSIGNED_INT,i8:BO.BYTE,i16:BO.SHORT,i32:BO.INT,f32:BO.FLOAT};let rL=class t25{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.elementCount=9;const Se=this.TypedArrayConstructor;void 0===be&&(be=9*Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}getMat(fe,ve){let _e=fe*this.typedBufferStride;for(let be=0;be<9;be++)ve[be]=this.typedBuffer[_e++];return ve}setMat(fe,ve){let _e=fe*this.typedBufferStride;for(let be=0;be<9;be++)this.typedBuffer[_e++]=ve[be]}get(fe,ve){return this.typedBuffer[fe*this.typedBufferStride+ve]}set(fe,ve,_e){this.typedBuffer[fe*this.typedBufferStride+ve]=_e}copyFrom(fe,ve,_e){const be=this.typedBuffer,we=ve.typedBuffer;let Se=fe*this.typedBufferStride,Te=_e*ve.typedBufferStride;for(let Ee=0;Ee<9;++Ee)be[Se++]=we[Te++]}get buffer(){return this.typedBuffer.buffer}};rL.ElementCount=9;let iL=class t26{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.elementCount=16;const Se=this.TypedArrayConstructor;void 0===be&&(be=16*Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}getMat(fe,ve){let _e=fe*this.typedBufferStride;for(let be=0;be<16;be++)ve[be]=this.typedBuffer[_e++];return ve}setMat(fe,ve){let _e=fe*this.typedBufferStride;for(let be=0;be<16;be++)this.typedBuffer[_e++]=ve[be]}get(fe,ve){return this.typedBuffer[fe*this.typedBufferStride+ve]}set(fe,ve,_e){this.typedBuffer[fe*this.typedBufferStride+ve]=_e}copyFrom(fe,ve,_e){const be=this.typedBuffer,we=ve.typedBuffer;let Se=fe*this.typedBufferStride,Te=_e*ve.typedBufferStride;for(let Ee=0;Ee<16;++Ee)be[Se++]=we[Te++]}get buffer(){return this.typedBuffer.buffer}};iL.ElementCount=16;let nL=class t27{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.elementCount=1;const Se=this.TypedArrayConstructor;void 0===be&&(be=Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.stride=be,this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}get(fe){return this.typedBuffer[fe*this.typedBufferStride]}set(fe,ve){this.typedBuffer[fe*this.typedBufferStride]=ve}get buffer(){return this.typedBuffer.buffer}};nL.ElementCount=1;let sL=class e16{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.elementCount=2;const Se=this.TypedArrayConstructor;void 0===be&&(be=2*Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}getVec(fe,ve){return fe*=this.typedBufferStride,o$2R(ve,this.typedBuffer[fe],this.typedBuffer[fe+1])}setVec(fe,ve){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve[0],this.typedBuffer[fe]=ve[1]}get(fe,ve){return this.typedBuffer[fe*this.typedBufferStride+ve]}set(fe,ve,_e){this.typedBuffer[fe*this.typedBufferStride+ve]=_e}setValues(fe,ve,_e){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve,this.typedBuffer[fe]=_e}copyFrom(fe,ve,_e){const be=this.typedBuffer,we=ve.typedBuffer;let Se=fe*this.typedBufferStride,Te=_e*ve.typedBufferStride;be[Se++]=we[Te++],be[Se]=we[Te]}get buffer(){return this.typedBuffer.buffer}};sL.ElementCount=2;let oL=class e17{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.elementCount=3;const Se=this.TypedArrayConstructor;void 0===be&&(be=3*Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}getVec(fe,ve){return fe*=this.typedBufferStride,o$44(ve,this.typedBuffer[fe],this.typedBuffer[fe+1],this.typedBuffer[fe+2])}setVec(fe,ve){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve[0],this.typedBuffer[fe++]=ve[1],this.typedBuffer[fe]=ve[2]}get(fe,ve){return this.typedBuffer[fe*this.typedBufferStride+ve]}set(fe,ve,_e){this.typedBuffer[fe*this.typedBufferStride+ve]=_e}setValues(fe,ve,_e,be){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve,this.typedBuffer[fe++]=_e,this.typedBuffer[fe]=be}copyFrom(fe,ve,_e){const be=this.typedBuffer,we=ve.typedBuffer;let Se=fe*this.typedBufferStride,Te=_e*ve.typedBufferStride;be[Se++]=we[Te++],be[Se++]=we[Te++],be[Se]=we[Te]}get buffer(){return this.typedBuffer.buffer}};oL.ElementCount=3;let aL=class e18{constructor(fe,ve,_e=0,be,we){this.TypedArrayConstructor=fe,this.start=_e,this.elementCount=4;const Se=this.TypedArrayConstructor;void 0===be&&(be=4*Se.BYTES_PER_ELEMENT);const Te=0===ve.byteLength?0:_e;this.typedBuffer=null==we?new Se(ve,Te):new Se(ve,Te,(we-_e)/Se.BYTES_PER_ELEMENT),this.typedBufferStride=be/Se.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(fe,ve,_e=this.count-ve){const be=this.typedBuffer.byteOffset+ve*this.stride;return new fe(this.buffer,be,this.stride,be+_e*this.stride)}getVec(fe,ve){return fe*=this.typedBufferStride,s$3I(ve,this.typedBuffer[fe++],this.typedBuffer[fe++],this.typedBuffer[fe++],this.typedBuffer[fe])}setVec(fe,ve){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve[0],this.typedBuffer[fe++]=ve[1],this.typedBuffer[fe++]=ve[2],this.typedBuffer[fe]=ve[3]}get(fe,ve){return this.typedBuffer[fe*this.typedBufferStride+ve]}set(fe,ve,_e){this.typedBuffer[fe*this.typedBufferStride+ve]=_e}setValues(fe,ve,_e,be,we){fe*=this.typedBufferStride,this.typedBuffer[fe++]=ve,this.typedBuffer[fe++]=_e,this.typedBuffer[fe++]=be,this.typedBuffer[fe]=we}copyFrom(fe,ve,_e){const be=this.typedBuffer,we=ve.typedBuffer;let Se=fe*this.typedBufferStride,Te=_e*ve.typedBufferStride;be[Se++]=we[Te++],be[Se++]=we[Te++],be[Se++]=we[Te++],be[Se]=we[Te]}get buffer(){return this.typedBuffer.buffer}};aL.ElementCount=4;let lL=class y4 extends nL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}static fromTypedArray(fe,ve){return new y4(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};lL.ElementType="f32";let cL=class u9 extends sL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}slice(fe,ve){return this.sliceBuffer(u9,fe,ve)}static fromTypedArray(fe,ve){return new u9(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};cL.ElementType="f32";let uL=class i18 extends oL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}slice(fe,ve){return this.sliceBuffer(i18,fe,ve)}static fromTypedArray(fe,ve){return new i18(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};uL.ElementType="f32";let hL=class c18 extends aL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}slice(fe,ve){return this.sliceBuffer(c18,fe,ve)}static fromTypedArray(fe,ve){return new c18(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};hL.ElementType="f32";let dL=class l10 extends rL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}slice(fe,ve){return this.sliceBuffer(l10,fe,ve)}static fromTypedArray(fe,ve){return new l10(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};dL.ElementType="f32";let pL=class a9 extends rL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(a9,fe,ve)}static fromTypedArray(fe,ve){return new a9(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};pL.ElementType="f64";let fL=class p18 extends iL{constructor(fe,ve=0,_e,be){super(Float32Array,fe,ve,_e,be),this.elementType="f32"}slice(fe,ve){return this.sliceBuffer(p18,fe,ve)}static fromTypedArray(fe,ve){return new p18(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};fL.ElementType="f32";let mL=class b5 extends iL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(b5,fe,ve)}static fromTypedArray(fe,ve){return new b5(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};mL.ElementType="f64";let yL=class o14 extends nL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(o14,fe,ve)}static fromTypedArray(fe,ve){return new o14(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};yL.ElementType="f64";let gL=class m15 extends sL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(m15,fe,ve)}static fromTypedArray(fe,ve){return new m15(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};gL.ElementType="f64";let vL=class T3 extends oL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(T3,fe,ve)}static fromTypedArray(fe,ve){return new T3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};vL.ElementType="f64";let _L=class h6 extends aL{constructor(fe,ve=0,_e,be){super(Float64Array,fe,ve,_e,be),this.elementType="f64"}slice(fe,ve){return this.sliceBuffer(h6,fe,ve)}static fromTypedArray(fe,ve){return new h6(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};_L.ElementType="f64";let $L=class d12 extends nL{constructor(fe,ve=0,_e,be){super(Uint8Array,fe,ve,_e,be),this.elementType="u8"}slice(fe,ve){return this.sliceBuffer(d12,fe,ve)}static fromTypedArray(fe,ve){return new d12(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};$L.ElementType="u8";let bL=class A5 extends sL{constructor(fe,ve=0,_e,be){super(Uint8Array,fe,ve,_e,be),this.elementType="u8"}slice(fe,ve){return this.sliceBuffer(A5,fe,ve)}static fromTypedArray(fe,ve){return new A5(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};bL.ElementType="u8";let wL=class O4 extends oL{constructor(fe,ve=0,_e,be){super(Uint8Array,fe,ve,_e,be),this.elementType="u8"}slice(fe,ve){return this.sliceBuffer(O4,fe,ve)}static fromTypedArray(fe,ve){return new O4(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};wL.ElementType="u8";let xL=class x4 extends aL{constructor(fe,ve=0,_e,be){super(Uint8Array,fe,ve,_e,be),this.elementType="u8"}slice(fe,ve){return this.sliceBuffer(x4,fe,ve)}static fromTypedArray(fe,ve){return new x4(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};xL.ElementType="u8";let SL=class g5 extends nL{constructor(fe,ve=0,_e,be){super(Uint16Array,fe,ve,_e,be),this.elementType="u16"}slice(fe,ve){return this.sliceBuffer(g5,fe,ve)}static fromTypedArray(fe,ve){return new g5(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};SL.ElementType="u16";let TL=class w2 extends sL{constructor(fe,ve=0,_e,be){super(Uint16Array,fe,ve,_e,be),this.elementType="u16"}slice(fe,ve){return this.sliceBuffer(w2,fe,ve)}static fromTypedArray(fe,ve){return new w2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};TL.ElementType="u16";let EL=class E3 extends oL{constructor(fe,ve=0,_e,be){super(Uint16Array,fe,ve,_e,be),this.elementType="u16"}slice(fe,ve){return this.sliceBuffer(E3,fe,ve)}static fromTypedArray(fe,ve){return new E3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};EL.ElementType="u16";let PL=class L2 extends aL{constructor(fe,ve=0,_e,be){super(Uint16Array,fe,ve,_e,be),this.elementType="u16"}slice(fe,ve){return this.sliceBuffer(L2,fe,ve)}static fromTypedArray(fe,ve){return new L2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};PL.ElementType="u16";let CL=class B3 extends nL{constructor(fe,ve=0,_e,be){super(Uint32Array,fe,ve,_e,be),this.elementType="u32"}slice(fe,ve){return this.sliceBuffer(B3,fe,ve)}static fromTypedArray(fe,ve){return new B3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};CL.ElementType="u32";let OL=class F2 extends sL{constructor(fe,ve=0,_e,be){super(Uint32Array,fe,ve,_e,be),this.elementType="u32"}slice(fe,ve){return this.sliceBuffer(F2,fe,ve)}static fromTypedArray(fe,ve){return new F2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};OL.ElementType="u32";let AL=class I3 extends oL{constructor(fe,ve=0,_e,be){super(Uint32Array,fe,ve,_e,be),this.elementType="u32"}slice(fe,ve){return this.sliceBuffer(I3,fe,ve)}static fromTypedArray(fe,ve){return new I3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};AL.ElementType="u32";let ML=class U extends aL{constructor(fe,ve=0,_e,be){super(Uint32Array,fe,ve,_e,be),this.elementType="u32"}slice(fe,ve){return this.sliceBuffer(U,fe,ve)}static fromTypedArray(fe,ve){return new U(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};ML.ElementType="u32";let RL=class j3 extends nL{constructor(fe,ve=0,_e,be){super(Int8Array,fe,ve,_e,be),this.elementType="i8"}slice(fe,ve){return this.sliceBuffer(j3,fe,ve)}static fromTypedArray(fe,ve){return new j3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};RL.ElementType="i8";let IL=class V extends sL{constructor(fe,ve=0,_e,be){super(Int8Array,fe,ve,_e,be),this.elementType="i8"}slice(fe,ve){return this.sliceBuffer(V,fe,ve)}static fromTypedArray(fe,ve){return new V(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};IL.ElementType="i8";let LL=class M2 extends oL{constructor(fe,ve=0,_e,be){super(Int8Array,fe,ve,_e,be),this.elementType="i8"}slice(fe,ve){return this.sliceBuffer(M2,fe,ve)}static fromTypedArray(fe,ve){return new M2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};LL.ElementType="i8";let DL=class S2 extends aL{constructor(fe,ve=0,_e,be){super(Int8Array,fe,ve,_e,be),this.elementType="i8"}slice(fe,ve){return this.sliceBuffer(S2,fe,ve)}static fromTypedArray(fe,ve){return new S2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};DL.ElementType="i8";let NL=class k extends nL{constructor(fe,ve=0,_e,be){super(Int16Array,fe,ve,_e,be),this.elementType="i16"}slice(fe,ve){return this.sliceBuffer(k,fe,ve)}static fromTypedArray(fe,ve){return new k(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};NL.ElementType="i16";let FL=class q extends sL{constructor(fe,ve=0,_e,be){super(Int16Array,fe,ve,_e,be),this.elementType="i16"}slice(fe,ve){return this.sliceBuffer(q,fe,ve)}static fromTypedArray(fe,ve){return new q(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};FL.ElementType="i16";let zL=class v4 extends oL{constructor(fe,ve=0,_e,be){super(Int16Array,fe,ve,_e,be),this.elementType="i16"}slice(fe,ve){return this.sliceBuffer(v4,fe,ve)}static fromTypedArray(fe,ve){return new v4(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};zL.ElementType="i16";let kL=class z2 extends aL{constructor(fe,ve=0,_e,be){super(Int16Array,fe,ve,_e,be),this.elementType="i16"}slice(fe,ve){return this.sliceBuffer(z2,fe,ve)}static fromTypedArray(fe,ve){return new z2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};kL.ElementType="i16";let UL=class C3 extends nL{constructor(fe,ve=0,_e,be){super(Int32Array,fe,ve,_e,be),this.elementType="i32"}slice(fe,ve){return this.sliceBuffer(C3,fe,ve)}static fromTypedArray(fe,ve){return new C3(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};UL.ElementType="i32";let VL=class D extends sL{constructor(fe,ve=0,_e,be){super(Int32Array,fe,ve,_e,be),this.elementType="i32"}slice(fe,ve){return this.sliceBuffer(D,fe,ve)}static fromTypedArray(fe,ve){return new D(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};VL.ElementType="i32";let BL=class G2 extends oL{constructor(fe,ve=0,_e,be){super(Int32Array,fe,ve,_e,be),this.elementType="i32"}slice(fe,ve){return this.sliceBuffer(G2,fe,ve)}static fromTypedArray(fe,ve){return new G2(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};BL.ElementType="i32";let jL=class H extends aL{constructor(fe,ve=0,_e,be){super(Int32Array,fe,ve,_e,be),this.elementType="i32"}slice(fe,ve){return this.sliceBuffer(H,fe,ve)}static fromTypedArray(fe,ve){return new H(fe.buffer,fe.byteOffset,ve,fe.byteOffset+fe.byteLength)}};function e$2F(fe){switch(fe){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}jL.ElementType="i32";let GL=class D2{constructor(fe,ve){this.layout=fe,this.buffer="number"==typeof ve?new ArrayBuffer(ve*fe.stride):ve;for(const _e of fe.fields.keys()){const ve=fe.fields.get(_e);this[_e]=new ve.constructor(this.buffer,ve.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(fe,ve){const _e=this[fe];return _e&&_e.elementCount===ve.ElementCount&&_e.elementType===ve.ElementType?_e:null}slice(fe,ve){return new D2(this.layout,this.buffer.slice(fe*this.stride,ve*this.stride))}copyFrom(fe,ve=0,_e=0,be=fe.count){const we=this.stride;if(we%4==0){const Se=new Uint32Array(fe.buffer,ve*we,be*we/4);new Uint32Array(this.buffer,_e*we,be*we/4).set(Se)}else{const Se=new Uint8Array(fe.buffer,ve*we,be*we);new Uint8Array(this.buffer,_e*we,be*we).set(Se)}return this}get usedMemory(){return this.byteLength}dispose(){}},HL=class G3{constructor(fe=null){this._stride=0,this._lastAligned=0,this._fields=new Map,fe&&(this._stride=fe.stride,fe.fields.forEach((fe=>this._fields.set(fe[0],{...fe[1],constructor:N$M(fe[1].constructor)}))))}freeze(){return this}vec2f(fe,ve){return this._appendField(fe,cL,ve),this}vec2f64(fe,ve){return this._appendField(fe,gL,ve),this}vec3f(fe,ve){return this._appendField(fe,uL,ve),this}vec3f64(fe,ve){return this._appendField(fe,vL,ve),this}vec4f(fe,ve){return this._appendField(fe,hL,ve),this}vec4f64(fe,ve){return this._appendField(fe,_L,ve),this}mat3f(fe,ve){return this._appendField(fe,dL,ve),this}mat3f64(fe,ve){return this._appendField(fe,pL,ve),this}mat4f(fe,ve){return this._appendField(fe,fL,ve),this}mat4f64(fe,ve){return this._appendField(fe,mL,ve),this}vec4u8(fe,ve){return this._appendField(fe,xL,ve),this}f32(fe,ve){return this._appendField(fe,lL,ve),this}f64(fe,ve){return this._appendField(fe,yL,ve),this}u8(fe,ve){return this._appendField(fe,$L,ve),this}u16(fe,ve){return this._appendField(fe,SL,ve),this}i8(fe,ve){return this._appendField(fe,RL,ve),this}vec2i8(fe,ve){return this._appendField(fe,IL,ve),this}vec2i16(fe,ve){return this._appendField(fe,FL,ve),this}vec2u8(fe,ve){return this._appendField(fe,bL,ve),this}vec4u16(fe,ve){return this._appendField(fe,PL,ve),this}u32(fe,ve){return this._appendField(fe,CL,ve),this}_appendField(fe,ve,_e){if(this._fields.has(fe))return void s$31(!1,`${fe} already added to vertex buffer layout`);const be=ve.ElementCount*e$2F(ve.ElementType),we=this._stride;this._stride+=be,this._fields.set(fe,{size:be,constructor:ve,offset:we,optional:_e})}createBuffer(fe){return new GL(this,fe)}createView(fe){return new GL(this,fe)}clone(){const fe=new G3;return fe._stride=this._stride,fe._fields=new Map,this._fields.forEach(((ve,_e)=>fe._fields.set(_e,ve))),fe.BufferType=this.BufferType,fe}get stride(){if(this._lastAligned!==this._fields.size){let fe=1;this._fields.forEach((ve=>fe=Math.max(fe,e$2F(ve.constructor.ElementType)))),this._stride=Math.floor((this._stride+fe-1)/fe)*fe,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function H$J(){return new HL}let qL=class I4{constructor(fe){this.fields=new Array,fe.fields.forEach(((fe,ve)=>{const _e={...fe,constructor:K$r(fe.constructor)};this.fields.push([ve,_e])})),this.stride=fe.stride}};const WL=[lL,cL,uL,hL,dL,fL,yL,gL,vL,_L,pL,mL,$L,bL,wL,xL,SL,TL,EL,PL,CL,OL,AL,ML,RL,IL,LL,DL,NL,FL,zL,kL,UL,VL,BL,jL];function K$r(fe){return`${fe.ElementType}_${fe.ElementCount}`}function N$M(fe){return YL.get(fe)}const YL=new Map;function t$2H(fe,ve=!1){return fe<=rr?ve?new Array(fe).fill(0):new Array(fe):new Float64Array(fe)}function e$2E(fe){return(y$2C(fe)?fe.length:fe.byteLength/8)<=rr?Array.from(fe):new Float64Array(fe)}function a$2H(fe,ve,_e){return Array.isArray(fe)?fe.slice(ve,ve+_e):fe.subarray(ve,ve+_e)}function y$1o(fe){return Array.isArray(fe)?new Float64Array(fe):fe}function t$2G(fe,ve=!1){return fe<=rr?ve?new Array(fe).fill(0):new Array(fe):new Float32Array(fe)}function e$2D(fe){return y$2C(fe)?fe.length<rr?fe:new Float32Array(fe):fe.length<rr?Array.from(fe):fe}function a$2G(fe){return(y$2C(fe)?fe.length:fe.byteLength/8)<=rr?Array.from(fe):new Float32Array(fe)}function o$2j(fe,ve,_e){return Array.isArray(fe)?fe.slice(ve,ve+_e):fe.subarray(ve,ve+_e)}function t$2F(fe){if(y$2C(fe)){if(fe.length<rr)return fe}else if(fe.length<rr)return Array.from(fe);let ve=!0,_e=!0;return fe.some(((fe,be)=>(ve=ve&&0===fe,_e=_e&&fe===be,!ve&&!_e))),ve?A$14(fe.length):_e?l$2O(fe.length):y$2C(fe)||fe.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function e$2C(fe){let ve=!0;for(const _e of fe){if(_e>=65536)return y$2C(fe)?new Uint32Array(fe):fe;_e>=256&&(ve=!1)}return ve?new Uint8Array(fe):new Uint16Array(fe)}(fe):fe}function i$2F(fe){return fe<=rr?new Array(fe):fe<=65536?new Uint16Array(fe):new Uint32Array(fe)}WL.forEach((fe=>YL.set(K$r(fe),fe)));let ZL=(()=>{const fe=new Uint32Array(131072);for(let ve=0;ve<fe.length;++ve)fe[ve]=ve;return fe})();const XL=[0],JL=(()=>{const fe=new Uint16Array(65536);for(let ve=0;ve<fe.length;++ve)fe[ve]=ve;return fe})();function l$2O(fe){if(1===fe)return XL;if(fe<rr)return Array.from(new Uint16Array(JL.buffer,0,fe));if(fe<JL.length)return new Uint16Array(JL.buffer,0,fe);if(fe>ZL.length){const ve=Math.max(2*ZL.length,fe);ZL=new Uint32Array(ve);for(let fe=0;fe<ZL.length;fe++)ZL[fe]=fe}return new Uint32Array(ZL.buffer,0,fe)}let QL=new Uint8Array(65536);function A$14(fe){if(1===fe)return XL;if(fe<rr)return new Array(fe).fill(0);if(fe>QL.length){const ve=Math.max(2*QL.length,fe);QL=new Uint8Array(ve)}return new Uint8Array(QL.buffer,0,fe)}var KL,eD;function o$2h(fe){if(fe.length<rr)return Array.from(fe);if(y$2C(fe))return Float64Array.from(fe);if(!("BYTES_PER_ELEMENT"in fe))return Array.from(fe);switch(fe.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(fe);case 2:return i$4W(fe)?Uint16Array.from(fe):Int16Array.from(fe);case 4:return Float32Array.from(fe);default:return Float64Array.from(fe)}}!function(fe){fe.length=function t84(fe,ve){const _e=fe[ve],be=fe[ve+1],we=fe[ve+2];return Math.sqrt(_e*_e+be*be+we*we)},fe.normalize=function c50(fe,ve){const _e=fe[ve],be=fe[ve+1],we=fe[ve+2],Se=1/Math.sqrt(_e*_e+be*be+we*we);fe[ve]*=Se,fe[ve+1]*=Se,fe[ve+2]*=Se},fe.scale=function o39(fe,ve,_e){fe[ve]*=_e,fe[ve+1]*=_e,fe[ve+2]*=_e},fe.add=function r65(fe,ve,_e,be,we,Se=ve){(we=we||fe)[Se]=fe[ve]+_e[be],we[Se+1]=fe[ve+1]+_e[be+1],we[Se+2]=fe[ve+2]+_e[be+2]},fe.subtract=function u30(fe,ve,_e,be,we,Se=ve){(we=we||fe)[Se]=fe[ve]-_e[be],we[Se+1]=fe[ve+1]-_e[be+1],we[Se+2]=fe[ve+2]-_e[be+2]}}(KL||(KL={})),function(fe){fe[fe.Layer=0]="Layer",fe[fe.Object=1]="Object",fe[fe.Mesh=2]="Mesh",fe[fe.Line=3]="Line",fe[fe.Point=4]="Point",fe[fe.Material=5]="Material",fe[fe.Texture=6]="Texture",fe[fe.COUNT=7]="COUNT"}(eD||(eD={}));let tD=class o15{constructor(fe,ve,_e){this.primitiveIndices=fe,this._numIndexPerPrimitive=ve,this.position=_e,this._children=void 0,s$31(fe.length>=1),s$31(3===_e.size||4===_e.size);const{data:be,size:we,indices:Se}=_e;s$31(Se.length%this._numIndexPerPrimitive==0),s$31(Se.length>=fe.length*this._numIndexPerPrimitive);const Te=fe.length;let Ee=we*Se[this._numIndexPerPrimitive*fe[0]];rD.clear(),rD.push(Ee);const Ce=r$3y(be[Ee],be[Ee+1],be[Ee+2]),Oe=t$47(Ce);for(let Be=0;Be<Te;++Be){const ve=this._numIndexPerPrimitive*fe[Be];for(let fe=0;fe<this._numIndexPerPrimitive;++fe){Ee=we*Se[ve+fe],rD.push(Ee);let _e=be[Ee];Ce[0]=Math.min(_e,Ce[0]),Oe[0]=Math.max(_e,Oe[0]),_e=be[Ee+1],Ce[1]=Math.min(_e,Ce[1]),Oe[1]=Math.max(_e,Oe[1]),_e=be[Ee+2],Ce[2]=Math.min(_e,Ce[2]),Oe[2]=Math.max(_e,Oe[2])}}this.bbMin=Ce,this.bbMax=Oe;const Re=A$1G([0,0,0],this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(Oe[0]-Ce[0],Oe[1]-Ce[1]),Oe[2]-Ce[2]);let De=this.radius*this.radius;for(let Be=0;Be<rD.length;++Be){Ee=rD.at(Be);const fe=be[Ee]-Re[0],ve=be[Ee+1]-Re[1],_e=be[Ee+2]-Re[2],we=fe*fe+ve*ve+_e*_e;if(we<=De)continue;const Se=Math.sqrt(we),Te=.5*(Se-this.radius);this.radius=this.radius+Te,De=this.radius*this.radius;const Ce=Te/Se;Re[0]+=fe*Ce,Re[1]+=ve*Ce,Re[2]+=_e*Ce}this.center=Re,rD.clear()}getChildren(){if(this._children||p$4Z(this.bbMin,this.bbMax)<=1)return this._children;const fe=A$1G([0,0,0],this.bbMin,this.bbMax,.5),ve=this.primitiveIndices.length,_e=new Uint8Array(ve),be=new Array(8);for(let Oe=0;Oe<8;++Oe)be[Oe]=0;const{data:we,size:Se,indices:Te}=this.position;for(let Oe=0;Oe<ve;++Oe){let ve=0;const Ee=this._numIndexPerPrimitive*this.primitiveIndices[Oe];let Ce=Se*Te[Ee],Re=we[Ce],De=we[Ce+1],Be=we[Ce+2];for(let fe=1;fe<this._numIndexPerPrimitive;++fe){Ce=Se*Te[Ee+fe];const ve=we[Ce],_e=we[Ce+1],be=we[Ce+2];ve<Re&&(Re=ve),_e<De&&(De=_e),be<Be&&(Be=be)}Re<fe[0]&&(ve|=1),De<fe[1]&&(ve|=2),Be<fe[2]&&(ve|=4),_e[Oe]=ve,++be[ve]}let Ee=0;for(let Oe=0;Oe<8;++Oe)be[Oe]>0&&++Ee;if(Ee<2)return;const Ce=new Array(8);for(let Oe=0;Oe<8;++Oe)Ce[Oe]=be[Oe]>0?new Uint32Array(be[Oe]):void 0;for(let Oe=0;Oe<8;++Oe)be[Oe]=0;for(let Oe=0;Oe<ve;++Oe){const fe=_e[Oe];Ce[fe][be[fe]++]=this.primitiveIndices[Oe]}this._children=new Array;for(let Oe=0;Oe<8;++Oe)void 0!==Ce[Oe]&&this._children.push(new o15(Ce[Oe],this._numIndexPerPrimitive,this.position));return this._children}static prune(){rD.prune()}};const rD=new jr({deallocator:null});let iD=class r11{constructor(){this.id=e$44()}};function S$19(fe,ve,_e){const be=ve[0]-fe[0],we=ve[1]-fe[1],Se=_e[0]-fe[0],Te=_e[1]-fe[1];return.5*Math.abs(be*Te-we*Se)}function d$1Y(fe,ve,_e){return e$3Z(nD,ve,fe),e$3Z(sD,_e,fe),.5*s$4g(_$1z(nD,nD,sD))}new ad(v$1Q),new ad((()=>function j$14(fe){return fe?{p0:t$47(fe.p0),p1:t$47(fe.p1),p2:t$47(fe.p2)}:{p0:[0,0,0],p1:[0,0,0],p2:[0,0,0]}}()));const nD=[0,0,0],sD=[0,0,0];const oD=[0,0,0],aD=[0,0,0],lD=[0,0,0],cD=[0,0,0];let uD=class r12{constructor(fe){this.channel=fe,this.id=e$44()}};function n$2P(fe,ve){return null==fe&&(fe=[]),fe.push(ve),fe}function r$2f(fe,ve){if(null==fe)return null;const _e=fe.filter((fe=>fe!==ve));return 0===_e.length?null:_e}const hD=[0,0,0],dD=new Float32Array(6);let pD=class I5 extends iD{constructor(fe,ve,_e=null,be=eD.Mesh,we=null,Se=-1){super(),this.material=fe,this.mapPositions=_e,this.type=be,this.objectAndLayerIdColor=we,this.edgeIndicesLength=Se,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[Te,Ee]of ve)this._attributes.set(Te,{...Ee,indices:t$2F(Ee.indices)}),Te===nO.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(Te).indices.length:this.edgeIndicesLength)}instantiate(fe={}){const ve=new I5(fe.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((fe,_e)=>{fe.exclusive=!1,ve._attributes.set(_e,fe)})),ve._boundingInfo=this._boundingInfo,ve.transformation=fe.transformation||this.transformation,ve}get attributes(){return this._attributes}getMutableAttribute(fe){let ve=this._attributes.get(fe);return ve&&!ve.exclusive&&(ve={...ve,exclusive:!0,data:o$2h(ve.data)},this._attributes.set(fe,ve)),ve}setAttributeData(fe,ve){const _e=this._attributes.get(fe);_e&&this._attributes.set(fe,{..._e,exclusive:!0,data:ve})}get indexCount(){const fe=this._attributes.values().next().value.indices;return(null==fe?void 0:fe.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(fe){return!!(this.type===eD.Mesh?this._computeAttachmentOriginTriangles(fe):this.type===eD.Line?this._computeAttachmentOriginLines(fe):this._computeAttachmentOriginPoints(fe))&&(null!=this._transformation&&O$1v(fe,fe,this._transformation),!0)}_computeAttachmentOriginTriangles(fe){return function i$2E(fe,ve){if(!fe)return!1;const{size:_e,data:be,indices:we}=fe;o$44(ve,0,0,0),o$44(cD,0,0,0);let Se=0,Te=0;for(let Ee=0;Ee<we.length-2;Ee+=3){const fe=we[Ee]*_e,Ce=we[Ee+1]*_e,Oe=we[Ee+2]*_e;o$44(oD,be[fe],be[fe+1],be[fe+2]),o$44(aD,be[Ce],be[Ce+1],be[Ce+2]),o$44(lD,be[Oe],be[Oe+1],be[Oe+2]);const Re=d$1Y(oD,aD,lD);Re?(u$3Y(oD,oD,aD),u$3Y(oD,oD,lD),g$2z(oD,oD,1/3*Re),u$3Y(ve,ve,oD),Se+=Re):(u$3Y(cD,cD,oD),u$3Y(cD,cD,aD),u$3Y(cD,cD,lD),Te+=3)}return!(0===Te&&0===Se||(0!==Se?(g$2z(ve,ve,1/Se),0):0===Te||(g$2z(ve,cD,1/Te),0)))}(this.attributes.get(nO.POSITION),fe)}_computeAttachmentOriginLines(fe){const ve=this.attributes.get(nO.POSITION);return function f$1_(fe,ve,_e){if(!fe)return!1;o$44(_e,0,0,0),o$44(cD,0,0,0);let be=0,we=0;const{size:Se,data:Te,indices:Ee}=fe,Ce=Ee.length-1,Oe=Ce+(ve?2:0);for(let Re=0;Re<Oe;Re+=2){const fe=Re<Ce?Re+1:0,ve=Ee[Re<Ce?Re:Ce]*Se,Oe=Ee[fe]*Se;oD[0]=Te[ve],oD[1]=Te[ve+1],oD[2]=Te[ve+2],aD[0]=Te[Oe],aD[1]=Te[Oe+1],aD[2]=Te[Oe+2],g$2z(oD,u$3Y(oD,oD,aD),.5);const De=nn(oD,aD);De>0?(u$3Y(_e,_e,g$2z(oD,oD,De)),be+=De):0===be&&(u$3Y(cD,cD,oD),we++)}return 0!==be?(g$2z(_e,_e,1/be),!0):0!==we&&(g$2z(_e,cD,1/we),!0)}(ve,function _$W(fe,ve){return!(!("isClosed"in fe)||!fe.isClosed)&&ve.indices.length>2}(this.material.parameters,ve),fe)}_computeAttachmentOriginPoints(fe){return function c$2I(fe,ve){if(!fe)return!1;const{size:_e,data:be,indices:we}=fe;o$44(ve,0,0,0);let Se=-1,Te=0;for(let Ee=0;Ee<we.length;Ee++){const fe=we[Ee]*_e;Se!==fe&&(ve[0]+=be[fe],ve[1]+=be[fe+1],ve[2]+=be[fe+2],Te++),Se=fe}return Te>1&&g$2z(ve,ve,1/Te),Te>0}(this.attributes.get(nO.POSITION),fe)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const fe=this.attributes.get(nO.POSITION);if(!fe||0===fe.indices.length)return null;const ve=this.type===eD.Mesh?3:1;s$31(fe.indices.length%ve==0,"Indexing error: "+fe.indices.length+" not divisible by "+ve);const _e=l$2O(fe.indices.length/ve);return new tD(_e,ve,fe)}get transformation(){return this._transformation??dd}set transformation(fe){this._transformation=fe&&fe!==dd?r$39(fe):null}addHighlight(){const fe=new uD(xA.Highlight);return this.highlights=n$2P(this.highlights,fe),fe}removeHighlight(fe){this.highlights=r$2f(this.highlights,fe)}};const fD=KL,mD=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],yD=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],gD=[0,0,1,0,1,1,0,1],vD=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],_D=new Array(36);for(let NRe=0;NRe<6;NRe++)for(let fe=0;fe<6;fe++)_D[6*NRe+fe]=NRe;const $D=new Array(36);for(let NRe=0;NRe<6;NRe++)$D[6*NRe]=0,$D[6*NRe+1]=1,$D[6*NRe+2]=2,$D[6*NRe+3]=2,$D[6*NRe+4]=3,$D[6*NRe+5]=0;const bD=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],wD=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],xD=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],SD=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];const TD=r$2r(-.5,0,-.5),ED=r$2r(.5,0,-.5),PD=r$2r(0,0,.5),CD=r$2r(0,.5,0),OD=n$2Y(),AD=n$2Y(),MD=n$2Y(),RD=n$2Y(),ID=n$2Y();e$3Z(OD,TD,CD),e$3Z(AD,TD,ED),_$1z(MD,OD,AD),z$1d(MD,MD),e$3Z(OD,ED,CD),e$3Z(AD,ED,PD),_$1z(RD,OD,AD),z$1d(RD,RD),e$3Z(OD,PD,CD),e$3Z(AD,PD,TD),_$1z(ID,OD,AD),z$1d(ID,ID);const LD=[TD,ED,PD,CD],DD=[0,-1,0,MD[0],MD[1],MD[2],RD[0],RD[1],RD[2],ID[0],ID[1],ID[2]],ND=[0,1,2,3,1,0,3,2,1,3,0,2],FD=[0,0,0,1,1,1,2,2,2,3,3,3];function st$e(fe,ve,_e,be,we={uv:!0}){const Se=-Math.PI,Te=2*Math.PI,Ee=-Math.PI/2,Ce=Math.PI,Oe=Math.max(3,Math.floor(_e)),Re=Math.max(2,Math.floor(be)),De=(Oe+1)*(Re+1),Be=t$2G(3*De),Ze=t$2G(3*De),Xe=t$2G(2*De),Je=[];let Qe=0;for(let bt=0;bt<=Re;bt++){const fe=[],_e=bt/Re,be=Ee+_e*Ce,we=Math.cos(be);for(let Ee=0;Ee<=Oe;Ee++){const Ce=Ee/Oe,Re=Se+Ce*Te,De=Math.cos(Re)*we,Je=Math.sin(be),dt=-Math.sin(Re)*we;Be[3*Qe]=De*ve,Be[3*Qe+1]=Je*ve,Be[3*Qe+2]=dt*ve,Ze[3*Qe]=De,Ze[3*Qe+1]=Je,Ze[3*Qe+2]=dt,Xe[2*Qe]=Ce,Xe[2*Qe+1]=_e,fe.push(Qe),++Qe}Je.push(fe)}const dt=new Array;for(let bt=0;bt<Re;bt++)for(let fe=0;fe<Oe;fe++){const ve=Je[bt][fe],_e=Je[bt][fe+1],be=Je[bt+1][fe+1],we=Je[bt+1][fe];0===bt?(dt.push(ve),dt.push(be),dt.push(we)):bt===Re-1?(dt.push(ve),dt.push(_e),dt.push(be)):(dt.push(ve),dt.push(_e),dt.push(be),dt.push(be),dt.push(we),dt.push(ve))}const $t=[[nO.POSITION,new Om(Be,dt,3,!0)],[nO.NORMAL,new Om(Ze,dt,3,!0)]];return we.uv&&$t.push([nO.UV0,new Om(Xe,dt,2,!0)]),we.offset&&($t[0][0]=nO.OFFSET,$t.push([nO.POSITION,new Om(Float64Array.from(we.offset),A$14(dt.length),3,!0)])),new pD(fe,$t)}function lt$b(fe,ve,_e){const be=fe;let we,Se;if(_e)we=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Se=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const fe=be*(1+Math.sqrt(5))/2;we=[-be,fe,0,be,fe,0,-be,-fe,0,be,-fe,0,0,-be,fe,0,be,fe,0,-be,-fe,0,be,-fe,fe,0,-be,fe,0,be,-fe,0,-be,-fe,0,be],Se=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let Ce=0;Ce<we.length;Ce+=3)fD.scale(we,Ce,fe/fD.length(we,Ce));let Te={};function h33(ve,_e){ve>_e&&([ve,_e]=[_e,ve]);const be=ve.toString()+"."+_e.toString();if(Te[be])return Te[be];let Se=we.length;return we.length+=3,fD.add(we,3*ve,we,3*_e,we,Se),fD.scale(we,Se,fe/fD.length(we,Se)),Se/=3,Te[be]=Se,Se}for(let Ce=0;Ce<ve;Ce++){const fe=Se.length,ve=new Array(4*fe);for(let _e=0;_e<fe;_e+=3){const fe=Se[_e],be=Se[_e+1],we=Se[_e+2],Te=h33(fe,be),Ee=h33(be,we),Ce=h33(we,fe),Oe=4*_e;ve[Oe]=fe,ve[Oe+1]=Te,ve[Oe+2]=Ce,ve[Oe+3]=be,ve[Oe+4]=Ee,ve[Oe+5]=Te,ve[Oe+6]=we,ve[Oe+7]=Ce,ve[Oe+8]=Ee,ve[Oe+9]=Te,ve[Oe+10]=Ee,ve[Oe+11]=Ce}Se=ve,Te={}}const Ee=a$2G(we);for(let Ce=0;Ce<Ee.length;Ce+=3)fD.normalize(Ee,Ce);return[[nO.POSITION,new Om(a$2G(we),Se,3,!0)],[nO.NORMAL,new Om(Ee,Se,3,!0)]]}function ht$a(fe,ve,_e,be,we,Se,Te,Ee,Ce=null){const Oe=_e?t$47(_e):[0,0,0],Re=ve?t$47(ve):r$3y(0,0,1);Te??(Te=[0,0]);const De=be?[255*be[0],255*be[1],255*be[2],be.length>3?255*be[3]:255]:[255,255,255,255],Be=null!=we&&2===we.length?we:[1,1],Ze=A$14(1),Xe=[[nO.POSITION,new Om(Oe,Ze,3,!0)],[nO.NORMAL,new Om(Re,Ze,3,!0)],[nO.UV0,new Om(Te,Ze,Te.length)],[nO.COLOR,new Om(De,Ze,4,!0)],[nO.SIZE,new Om(Be,Ze,2)]];if(null!=Se&&(Se=[Se[0],Se[1],Se[2],Se[3]],Xe.push([nO.CENTEROFFSETANDDISTANCE,new Om(Se,Ze,4)])),Ee){const fe=[Ee[0],Ee[1],Ee[2],Ee[3]];Xe.push([nO.FEATUREATTRIBUTE,new Om(fe,Ze,4)])}return new pD(fe,Xe,null,eD.Point,Ce)}const zD=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function ct$a(fe,ve=zD){const _e=new Array(12);for(let Te=0;Te<4;Te++)for(let fe=0;fe<3;fe++)_e[3*Te+fe]=ve[Te][fe];const be=[0,1,2,2,3,0],we=[0,0,0,0,0,0],Se=[[nO.POSITION,new Om(_e,be,3,!0)],[nO.NORMAL,new Om([0,0,1],we,3,!0)],[nO.UV0,new Om([0,0,1,0,1,1,0,1],be,2,!0)],[nO.COLOR,new Om([255,255,255,255],we,4,!0)]];return new pD(fe,Se)}function at$d(fe,ve,_e,be,we,Se=!0,Te=!0){let Ee=0;const Ce=_e,Oe=ve;let Re=r$2r(0,Ee,0),De=r$2r(0,Ee+Oe,0),Be=r$2r(0,-1,0),Ze=r$2r(0,1,0);we&&(Ee=Oe,De=r$2r(0,0,0),Re=r$2r(0,Ee,0),Be=r$2r(0,1,0),Ze=r$2r(0,-1,0));const Xe=[De,Re],Je=[Be,Ze],Qe=be+2,dt=Math.sqrt(Oe*Oe+Ce*Ce);if(we)for(let Et=be-1;Et>=0;Et--){const fe=Et*(2*Math.PI/be),ve=r$2r(Math.cos(fe)*Ce,Ee,Math.sin(fe)*Ce);Xe.push(ve);const _e=r$2r(Oe*Math.cos(fe)/dt,-Ce/dt,Oe*Math.sin(fe)/dt);Je.push(_e)}else for(let Et=0;Et<be;Et++){const fe=Et*(2*Math.PI/be),ve=r$2r(Math.cos(fe)*Ce,Ee,Math.sin(fe)*Ce);Xe.push(ve);const _e=r$2r(Oe*Math.cos(fe)/dt,Ce/dt,Oe*Math.sin(fe)/dt);Je.push(_e)}const $t=new Array,bt=new Array;if(Se){for(let fe=3;fe<Xe.length;fe++)$t.push(1),$t.push(fe-1),$t.push(fe),bt.push(0),bt.push(0),bt.push(0);$t.push(Xe.length-1),$t.push(2),$t.push(1),bt.push(0),bt.push(0),bt.push(0)}if(Te){for(let fe=3;fe<Xe.length;fe++)$t.push(fe),$t.push(fe-1),$t.push(0),bt.push(fe),bt.push(fe-1),bt.push(1);$t.push(0),$t.push(2),$t.push(Xe.length-1),bt.push(1),bt.push(2),bt.push(Je.length-1)}const wt=t$2G(3*Qe);for(let Et=0;Et<Qe;Et++)wt[3*Et]=Xe[Et][0],wt[3*Et+1]=Xe[Et][1],wt[3*Et+2]=Xe[Et][2];const xt=t$2G(3*Qe);for(let Et=0;Et<Qe;Et++)xt[3*Et]=Je[Et][0],xt[3*Et+1]=Je[Et][1],xt[3*Et+2]=Je[Et][2];const St=[[nO.POSITION,new Om(wt,$t,3,!0)],[nO.NORMAL,new Om(xt,bt,3,!0)]];return new pD(fe,St)}function ft$8(fe,ve,_e,be,we,Se,Te){const Ee=we?t$2W(we):r$2r(1,0,0),Ce=Se?t$2W(Se):r$2r(0,0,0);Te??(Te=!0);const Oe=n$2Y();z$1d(Oe,Ee);const Re=n$2Y();g$2z(Re,Oe,Math.abs(ve));const De=n$2Y();g$2z(De,Re,-.5),u$3Y(De,De,Ce);const Be=r$2r(0,1,0);Math.abs(1-P$1g(Oe,Be))<.2&&o$44(Be,0,0,1);const Ze=n$2Y();_$1z(Ze,Oe,Be),z$1d(Ze,Ze),_$1z(Be,Ze,Oe);const Xe=2*be+(Te?2:0),Je=be+(Te?2:0),Qe=t$2G(3*Xe),dt=t$2G(3*Je),$t=t$2G(2*Xe),bt=new Array(3*be*(Te?4:2)),wt=new Array(3*be*(Te?4:2));Te&&(Qe[3*(Xe-2)]=De[0],Qe[3*(Xe-2)+1]=De[1],Qe[3*(Xe-2)+2]=De[2],$t[2*(Xe-2)]=0,$t[2*(Xe-2)+1]=0,Qe[3*(Xe-1)]=Qe[3*(Xe-2)]+Re[0],Qe[3*(Xe-1)+1]=Qe[3*(Xe-2)+1]+Re[1],Qe[3*(Xe-1)+2]=Qe[3*(Xe-2)+2]+Re[2],$t[2*(Xe-1)]=1,$t[2*(Xe-1)+1]=1,dt[3*(Je-2)]=-Oe[0],dt[3*(Je-2)+1]=-Oe[1],dt[3*(Je-2)+2]=-Oe[2],dt[3*(Je-1)]=Oe[0],dt[3*(Je-1)+1]=Oe[1],dt[3*(Je-1)+2]=Oe[2]);const V9=(fe,ve,_e)=>{bt[fe]=ve,wt[fe]=_e};let xt=0;const St=n$2Y(),Et=n$2Y();for(let Ot=0;Ot<be;Ot++){const fe=Ot*(2*Math.PI/be);g$2z(St,Be,Math.sin(fe)),g$2z(Et,Ze,Math.cos(fe)),u$3Y(St,St,Et),dt[3*Ot]=St[0],dt[3*Ot+1]=St[1],dt[3*Ot+2]=St[2],g$2z(St,St,_e),u$3Y(St,St,De),Qe[3*Ot]=St[0],Qe[3*Ot+1]=St[1],Qe[3*Ot+2]=St[2],$t[2*Ot]=Ot/be,$t[2*Ot+1]=0,Qe[3*(Ot+be)]=Qe[3*Ot]+Re[0],Qe[3*(Ot+be)+1]=Qe[3*Ot+1]+Re[1],Qe[3*(Ot+be)+2]=Qe[3*Ot+2]+Re[2],$t[2*(Ot+be)]=Ot/be,$t[2*Ot+1]=1;const ve=(Ot+1)%be;V9(xt++,Ot,Ot),V9(xt++,Ot+be,Ot),V9(xt++,ve,ve),V9(xt++,ve,ve),V9(xt++,Ot+be,Ot),V9(xt++,ve+be,ve)}if(Te){for(let fe=0;fe<be;fe++){const ve=(fe+1)%be;V9(xt++,Xe-2,Je-2),V9(xt++,fe,Je-2),V9(xt++,ve,Je-2)}for(let fe=0;fe<be;fe++){const ve=(fe+1)%be;V9(xt++,fe+be,Je-1),V9(xt++,Xe-1,Je-1),V9(xt++,ve+be,Je-1)}}const Pt=[[nO.POSITION,new Om(Qe,bt,3,!0)],[nO.NORMAL,new Om(dt,wt,3,!0)],[nO.UV0,new Om($t,bt,2,!0)]];return new pD(fe,Pt)}function pt$8(fe,ve,_e,be,we,Se){be=be||10,we=null==we||we,s$31(ve.length>1);const Te=[],Ee=[];for(let Ce=0;Ce<be;Ce++){Te.push([0,-Ce-1,-(Ce+1)%be-1]);const fe=Ce/be*2*Math.PI;Ee.push([Math.cos(fe)*_e,Math.sin(fe)*_e])}return it$c(fe,Ee,ve,[[0,0,0]],Te,we,Se)}function it$c(fe,ve,_e,be,we,Se,Te=r$2r(0,0,0)){const Ee=ve.length,Ce=t$2G(_e.length*Ee*3+(6*be.length||0)),Oe=t$2G(_e.length*Ee*3+(be?6:0)),Re=new Array,De=new Array;let Be=0,Ze=0;const Xe=[0,0,0],Je=[0,0,0],Qe=[0,0,0],dt=[0,0,0],$t=[0,0,0],bt=[0,0,0],wt=[0,0,0],xt=[0,0,0],St=[0,0,0],Et=[0,0,0],Pt=[0,0,0],Ot=[0,0,0],At=[0,0,0],Mt=E$1z();o$44(St,0,1,0),e$3Z(Je,_e[1],_e[0]),z$1d(Je,Je),Se?(u$3Y(xt,_e[0],Te),z$1d(Qe,xt)):o$44(Qe,0,0,1),At$4(Je,Qe,St,St,$t,Qe,kD),r$3w(dt,Qe),r$3w(Ot,$t);for(let jt=0;jt<be.length;jt++)g$2z(bt,$t,be[jt][0]),g$2z(xt,Qe,be[jt][2]),u$3Y(bt,bt,xt),u$3Y(bt,bt,_e[0]),Ce[Be++]=bt[0],Ce[Be++]=bt[1],Ce[Be++]=bt[2];Oe[Ze++]=-Je[0],Oe[Ze++]=-Je[1],Oe[Ze++]=-Je[2];for(let jt=0;jt<we.length;jt++)Re.push(we[jt][0]>0?we[jt][0]:-we[jt][0]-1+be.length),Re.push(we[jt][1]>0?we[jt][1]:-we[jt][1]-1+be.length),Re.push(we[jt][2]>0?we[jt][2]:-we[jt][2]-1+be.length),De.push(0),De.push(0),De.push(0);let Rt=be.length;const Nt=be.length-1;for(let jt=0;jt<_e.length;jt++){let fe=!1;jt>0&&(r$3w(Xe,Je),jt<_e.length-1?(e$3Z(Je,_e[jt+1],_e[jt]),z$1d(Je,Je)):fe=!0,u$3Y(Et,Xe,Je),z$1d(Et,Et),u$3Y(Pt,_e[jt-1],dt),j$1w(_e[jt],Et,Mt),S$1E(Mt,l$3V(Pt,Xe),xt)?(e$3Z(xt,xt,_e[jt]),z$1d(Qe,xt),_$1z($t,Et,Qe),z$1d($t,$t)):At$4(Et,dt,Ot,St,$t,Qe,kD),r$3w(dt,Qe),r$3w(Ot,$t)),Se&&(u$3Y(xt,_e[jt],Te),z$1d(At,xt));for(let be=0;be<Ee;be++)if(g$2z(bt,$t,ve[be][0]),g$2z(xt,Qe,ve[be][1]),u$3Y(bt,bt,xt),z$1d(wt,bt),Oe[Ze++]=wt[0],Oe[Ze++]=wt[1],Oe[Ze++]=wt[2],u$3Y(bt,bt,_e[jt]),Ce[Be++]=bt[0],Ce[Be++]=bt[1],Ce[Be++]=bt[2],!fe){const fe=(be+1)%Ee;Re.push(Rt+be),Re.push(Rt+Ee+be),Re.push(Rt+fe),Re.push(Rt+fe),Re.push(Rt+Ee+be),Re.push(Rt+Ee+fe);for(let ve=0;ve<6;ve++){const fe=Re.length-6;De.push(Re[fe+ve]-Nt)}}Rt+=Ee}const Ft=_e[_e.length-1];for(let jt=0;jt<be.length;jt++)g$2z(bt,$t,be[jt][0]),g$2z(xt,Qe,be[jt][1]),u$3Y(bt,bt,xt),u$3Y(bt,bt,Ft),Ce[Be++]=bt[0],Ce[Be++]=bt[1],Ce[Be++]=bt[2];const zt=Ze/3;Oe[Ze++]=Je[0],Oe[Ze++]=Je[1],Oe[Ze++]=Je[2];const kt=Rt-Ee;for(let jt=0;jt<we.length;jt++)Re.push(we[jt][0]>=0?Rt+we[jt][0]:-we[jt][0]-1+kt),Re.push(we[jt][2]>=0?Rt+we[jt][2]:-we[jt][2]-1+kt),Re.push(we[jt][1]>=0?Rt+we[jt][1]:-we[jt][1]-1+kt),De.push(zt),De.push(zt),De.push(zt);const Bt=[[nO.POSITION,new Om(Ce,Re,3,!0)],[nO.NORMAL,new Om(Oe,De,3,!0)]];return new pD(fe,Bt)}function gt$9(fe,ve,_e,be){s$31(ve.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),s$31(3===ve[0].length,"createPolylineGeometry(): malformed vertex"),s$31(null==_e||_e.length===ve.length,"createPolylineGeometry: need same number of points and normals"),s$31(null==_e||3===_e[0].length,"createPolylineGeometry(): malformed normal");const we=t$2H(3*ve.length),Se=new Array(2*(ve.length-1));let Te=0,Ee=0;for(let Oe=0;Oe<ve.length;Oe++){for(let fe=0;fe<3;fe++)we[Te++]=ve[Oe][fe];Oe>0&&(Se[Ee++]=Oe-1,Se[Ee++]=Oe)}const Ce=[[nO.POSITION,new Om(we,Se,3,!0)]];if(_e){const fe=t$2G(3*_e.length);let be=0;for(let we=0;we<ve.length;we++)for(let ve=0;ve<3;ve++)fe[be++]=_e[we][ve];Ce.push([nO.NORMAL,new Om(fe,Se,3,!0)])}return be&&Ce.push([nO.COLOR,new Om(be,l$2O(be.length/4),4)]),new pD(fe,Ce,null,eD.Line)}function wt$6(fe,ve,_e,be,we,Se=0){const Te=new Array(18),Ee=[[-_e,Se,we/2],[be,Se,we/2],[0,ve+Se,we/2],[-_e,Se,-we/2],[be,Se,-we/2],[0,ve+Se,-we/2]];for(let Ce=0;Ce<6;Ce++)Te[3*Ce]=Ee[Ce][0],Te[3*Ce+1]=Ee[Ce][1],Te[3*Ce+2]=Ee[Ce][2];return new pD(fe,[[nO.POSITION,new Om(Te,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function mt$7(fe,ve){const _e=fe.getMutableAttribute(nO.POSITION).data;for(let be=0;be<_e.length;be+=3){const fe=_e[be],we=_e[be+1],Se=_e[be+2];o$44(UD,fe,we,Se),O$1v(UD,UD,ve),_e[be]=UD[0],_e[be+1]=UD[1],_e[be+2]=UD[2]}}function Mt$6(fe,ve,_e,be,we){return!(Math.abs(P$1g(ve,fe))>we||(_$1z(_e,fe,ve),z$1d(_e,_e),_$1z(be,_e,fe),z$1d(be,be),0))}function At$4(fe,ve,_e,be,we,Se,Te){return Mt$6(fe,ve,we,Se,Te)||Mt$6(fe,_e,we,Se,Te)||Mt$6(fe,be,we,Se,Te)}const kD=.99619469809,UD=[0,0,0];let VD=class A6{constructor(fe,ve){this.type=jC.Local,this._configuration=new qI,this._passParameters=new XI,this._configuration.geometry=HI.Cylinder,this._technique=ve.techniques.acquire(KI,this._configuration);const _e=ve.renderContext.rctx;this._vao=function y$1m(fe){const ve=lt$b(1,2,!1),{data:_e,indices:be}=ve[0][1],we=jD.createBuffer(be.length),Se=we.position;for(let Te=0;Te<be.length;++Te){const fe=3*be[Te%3==0?Te+2:Te%3==2?Te-2:Te];Se.set(Te,0,_e[fe]),Se.set(Te,1,_e[fe+1]),Se.set(Te,2,_e[fe+2])}return new tM(fe,mA,{geometry:t$2L(jD)},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,we.buffer)})}(_e),this._vaoCount=i$2T(this._vao,"geometry");const be=new nM;be.wrapMode=qO.CLAMP_TO_EDGE,be.flipped=!0,be.width=1,be.height=512,this._passParameters.texture=new oM(_e,be,eL)}destroy(){this._passParameters.texture=r$3M(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(fe){const ve=fe.rctx,_e=ve.bindTechnique(this._technique,fe.bindParameters,this._passParameters);(function T$U(fe,ve){n$48(fe,ve),fe[12]=0,fe[13]=0,fe[14]=0,fe[15]=1})(BD,fe.bindParameters.camera.viewMatrix),_e.setUniformMatrix4fv("view",BD),ve.bindVAO(this._vao),_e.assertCompatibleVertexAttributeLocations(this._vao),ve.drawArrays(NO.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};const BD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jD=H$J().vec3f(nO.POSITION),GD=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),HD=128,qD=-tO,WD=k$1m([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let YD=class z3{constructor(fe,ve){this.view=fe,this.type=jC.Mars,this._passParameters=new XI,this._vaoCount=0,this._texV1=1;const _e=s$45(fe.spatialReference);this._planetRadius=_e.radius,this._outerRimWidth=_e.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+qD)/this._planetRadius,this._middleRimFactor=(this._planetRadius+0)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=0/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=ve.techniques;const be=ve.renderContext.rctx;this._cameraChangeHandle=d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.camera}),(()=>ve.requestRender()),Ja),this._vao=this._createRibbon(be),this._vaoCount=i$2T(this._vao,"geometry"),this._fadeVao=i$2S(be),this._fadeVaoCount=i$2T(this._fadeVao,"geometry");const we=new nM;we.wrapMode=qO.CLAMP_TO_EDGE,we.flipped=!0,we.width=1,we.height=512,this._passParameters.texture=new oM(be,we,GD);const Se=new qI;Se.geometry=HI.Cone,this._coneTechnique=this._techniques.acquire(KI,Se),Se.geometry=HI.Underground,this._undergroundTechnique=this._techniques.acquire(KI,Se)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=r$3M(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(fe){const ve=fe.bindParameters.camera;this._update(ve);const _e=fe.rctx;this._passParameters.undergroundFadeAlpha<1&&(_e.bindTechnique(this._coneTechnique,fe.bindParameters,this._passParameters),_e.bindVAO(this._vao),_e.drawArrays(NO.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(_e.bindTechnique(this._undergroundTechnique,fe.bindParameters,this._passParameters),_e.bindVAO(this._fadeVao),_e.drawArrays(NO.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(fe){const ve=[0,0,0],_e=this._planetRadius,be=s$4g(fe.eye),we=be-_e;if(we<0){const fe=Math.min(-we/5e3,1);this._passParameters.undergroundFadeAlpha=fe}else this._passParameters.undergroundFadeAlpha=0;const Se=Math.max(50,we),Te=_e+qD;this._passParameters.innerScale=function Y$p(fe,ve,_e){return fe*fe/(Math.sqrt(fe*fe-ve*ve)*Math.sqrt(fe*fe-_e*_e)+ve*_e)}(_e+Se,_e,Te)-1,this._passParameters.altitudeFade=e$34(we),g$2z(ve,fe.eye,(_e+50)/be),J$r(ve,fe.center,fe.up,_e,this._passParameters.silhouette);const Ee=this._computeScreenRimWidth(fe,ve,fe.up,this._passParameters.silhouette),Ce=1-511/512,Oe=WD(we);let Re=this._texV0+Ce*this._texVScale,De=this._texV0+Ee*Oe*this._texVScale;if(we>50){J$r(fe.eye,fe.center,fe.up,_e,this._passParameters.silhouette);const ve=e$3Y((this._computeScreenRimWidth(fe,fe.eye,fe.up,this._passParameters.silhouette)-1.5)/(Ee-1.5),0,1);Re=this._texV0+ve*Ce*this._texVScale,De=this._texV0+f$3i(this._texV1,Ee*Oe,ve)*this._texVScale}o$2R(this._passParameters.texV,Re,De)}_createRibbon(fe){const ve=t$2G(1155),_e=new Uint32Array(1920);ve[0]=0,ve[1]=0,ve[2]=-1;for(let Se=0;Se<HD;Se++){const fe=9*Se+3;ve[fe]=Se,ve[fe+1]=this._innerRimFactor,ve[fe+2]=-1,ve[fe+3]=Se,ve[fe+4]=this._middleRimFactor,ve[fe+5]=0,ve[fe+6]=Se,ve[fe+7]=this._outerRimFactor,ve[fe+8]=1;const be=3*Se+1,we=127===Se?1:be+3,Te=15*Se;_e[Te]=be,_e[Te+1]=be+1,_e[Te+2]=we+1,_e[Te+3]=we+1,_e[Te+4]=we,_e[Te+5]=be,_e[Te+6]=be+1,_e[Te+7]=be+2,_e[Te+8]=we+2,_e[Te+9]=we+2,_e[Te+10]=we+1,_e[Te+11]=be+1,_e[Te+12]=be,_e[Te+13]=we,_e[Te+14]=0}const be=QD.createBuffer(_e.length),we=be.position;for(let Se=0;Se<_e.length;++Se){const fe=3*_e[Se];we.set(Se,0,ve[fe]),we.set(Se,1,ve[fe+1]),we.set(Se,2,ve[fe+2])}return new tM(fe,mA,{geometry:t$2L(QD)},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,be.buffer)})}_computeScreenRimWidth(fe,ve,_e,be){return u$3Y(XD,be.center,be.v2),g$2z(JD,XD,this._outerRimFactor),X$w(ZD,ve,XD,_e),a$2_(XD,ZD,fe.projectionMatrix,fe.viewport,XD),a$2_(JD,ZD,fe.projectionMatrix,fe.viewport,JD),x$1W(XD,JD)/fe.height}};function J$r(fe,ve,_e,be,we){const Se=s$4g(fe),Te=be*Math.sqrt(Se*Se-be*be)/Se,Ee=Math.sqrt(be*be-Te*Te),Ce=we.v1,Oe=we.v2;return g$2z(we.center,fe,Ee/Se),_$1z(Ce,fe,ve),v$22(Ce)<1&&_$1z(Ce,fe,_e),g$2z(Ce,Ce,Te/s$4g(Ce)),_$1z(Oe,Ce,fe),g$2z(Oe,Oe,Te/s$4g(Oe)),Te}const ZD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],XD=[0,0,0],JD=[0,0,0];const QD=H$J().vec3f(nO.POSITION);var KD;!function(fe){fe[fe.Rain=0]="Rain",fe[fe.Snow=1]="Snow",fe[fe.COUNT=2]="COUNT"}(KD||(KD={}));let eN=class i19 extends HA{constructor(){super(...arguments),this.type=KD.Rain}};function h$1L(fe){const ve=new gO;return ve.attributes.add(nO.POSITION,"vec3"),ve.attributes.add(nO.INSTANCEFEATUREATTRIBUTE,"float"),ve.vertex.uniforms.add(new uO("cameraPosition",((fe,ve)=>ve.camera.eye))),ve.vertex.uniforms.add(new uO("offset",((fe,ve)=>function g$1y(fe,ve){const _e=ve.camera.eye,be=.5*fe.width,we=1/fe.width,Se=M$1y(tN,o$44(tN,(_e[0]+be)*we,(_e[1]+be)*we,(_e[2]+be)*we));return Ki(Se,_e,g$2z(Se,Se,fe.width))}(fe,ve)))),ve.vertex.uniforms.add(new dO("width",(fe=>fe.width))),ve.vertex.uniforms.add(new pO("proj",((fe,ve)=>ve.camera.projectionMatrix))),ve.vertex.uniforms.add(new pO("view",((fe,ve)=>ve.camera.viewMatrix))),ve.vertex.uniforms.add(new dO("time",(fe=>fe.time))),ve.varyings.add("vUv","vec2"),ve.vertex.code.add(o$2P`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${fe.type===KD.Rain?o$2P`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:o$2P`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),ve.fragment.uniforms.add(new dO("opacity",(fe=>fe.opacity)),new uO("particleColor",((ve,_e)=>function w$1b(fe,ve){const _e=ve.type===KD.Rain?nN:iN,be=g$2z(tN,_e,sN),we=fe.camera.eye;z$1d(rN,we);const Se=Math.max(0,P$1g(rN,fe.lighting.mainLight.direction));return A$1G(be,be,_e,Se)}(_e,fe)))),ve.fragment.code.add(o$2P`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${fe.type===KD.Rain?o$2P`d = 0.35 * smoothstep(0.5, 0.0, d);`:o$2P`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),ve}e$4o([r$2w({count:KD.COUNT})],eN.prototype,"type",void 0);const tN=[0,0,0],rN=[0,0,0],iN=r$3y(1,1,1),nN=r$3y(.85,.85,.85),sN=.7,oN=Object.freeze(Object.defineProperty({__proto__:null,build:h$1L},Symbol.toStringTag,{value:"Module"}));let aN=class g6 extends iO{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},lN=class d13 extends fA{initializeProgram(fe){return new gA(fe.rctx,d13.shader.get().build(this.configuration),cN)}initializePipeline(){return S$1g({blending:l$2_(FO.ONE,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};lN.shader=new LO(oN,(()=>zt((()=>Promise.resolve().then((()=>tRe))),void 0)));const cN=new Map([[nO.POSITION,0],[nO.INSTANCEFEATUREATTRIBUTE,1]]);let uN=class e19{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:fe,fixedTime:ve}){return null!=ve?this._time!==ve&&(this._time=ve,!0):(this._time=this._time+fe,0!==fe)}},hN=class i20{constructor(fe,ve){this.deltaTime=fe,this.fixedTime=ve}},dN=class g7 extends zi{constructor(fe){super(fe),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new aN,this._animation=new uN,this._passParameters.time=0,this._passParameters.radius=s$45(fe.view.spatialReference).radius,this._techniques=fe.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=t$4r(this._snowTechniqueCached),this._rainTechniqueCached=t$4r(this._rainTechniqueCached),this._vao=r$3M(this._vao),this._instanceIdBuffer=r$3M(this._instanceIdBuffer)}get _rainTechnique(){if(null==this._rainTechniqueCached){const fe=new eN;fe.type=KD.Rain,this._rainTechniqueCached=this._techniques.acquire(lN,fe)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const fe=new eN;fe.type=KD.Snow,this._snowTechniqueCached=this._techniques.acquire(lN,fe)}return this._snowTechniqueCached}update(fe){return this._animation.advance(fe)}render(fe,ve,_e){const be="rainy"===_e?this._rainTechnique:this._snowTechnique;if(!be.compiled)return void this.context.requestRender();const we=fe.rctx;if(this._ensureResources(we),null==be||null==this._vao||null==this._instanceIdBuffer)return;if(null!=fe.bindParameters.cloudsFade.data&&(this._passParameters.opacity=fe.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0)return;ve=ve<.5?f$3i(0,.35,2*ve):f$3i(.35,1,2*(ve-.5)),this._passParameters.time=("rainy"===_e?this._rainSpeed:this._snowSpeed)*u$46(this._animation.time)%1e5;const Se=we.bindTechnique(be,fe.bindParameters,this._passParameters);we.bindVAO(this._vao),Se.assertCompatibleVertexAttributeLocations(this._vao),E$1f(we,cN,this._instanceIdBuffer,fN,0),we.drawArraysInstanced(NO.TRIANGLES,0,3,this._numParticles*ve),_$_(we,cN,this._instanceIdBuffer,fN)}_ensureResources(fe){null==this._vao&&(this._vao=function P$N(fe){const ve=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new tM(fe,cN,{geometry:t$2L(pN)},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,ve)})}(fe)),null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(fe))}_createInstanceIndices(fe){const ve=[];for(let _e=0;_e<this._numParticles;_e++)ve.push(_e);return rM.createVertex(fe,QO.STATIC_DRAW,new Float32Array(ve))}};e$4o([y$2v({constructOnly:!0})],dN.prototype,"context",void 0),e$4o([y$2v({constructOnly:!0})],dN.prototype,"view",void 0),dN=e$4o([a$4y("esri.views.3d.environment.Precipitation")],dN);const pN=H$J().vec3f(nO.POSITION),fN=t$2L(H$J().f32(nO.INSTANCEFEATUREATTRIBUTE),1);function d$1W(){const fe=new gO;return fe.attributes.add(nO.POSITION,"vec3"),fe.attributes.add(nO.COLOR,"vec4"),fe.attributes.add(nO.SIZE,"float"),fe.varyings.add("vcolor","vec4"),fe.varyings.add("vsize","float"),fe.vertex.uniforms.add(new pO("transform",((fe,ve)=>function c$2H(fe,ve){const _e=24e-8;return n$48(mN,ve.camera.projectionMatrix),mN[10]=_e-1,mN[11]=-1,mN[14]=(_e-2)*ve.camera.near,c$4k(mN,mN,ve.camera.viewMatrix),c$4k(mN,mN,fe.modelMatrix)}(fe,ve))),new hO("viewport",((fe,ve)=>ve.camera.fullViewport)),new dO("pixelRatio",((fe,ve)=>ve.camera.pixelRatio))),fe.vertex.code.add(o$2P`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),fe.fragment.code.add(o$2P`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),fe}const mN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],yN=Object.freeze(Object.defineProperty({__proto__:null,build:d$1W},Symbol.toStringTag,{value:"Module"}));let gN=class u10 extends iO{constructor(){super(...arguments),this.modelMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},vN=class h7 extends fA{constructor(fe){super(fe,new HA,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,h7.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:jO.LEQUAL},colorWrite:AA})}};vN.shader=new LO(yN,(()=>zt((()=>Promise.resolve().then((()=>rRe))),void 0)));let _N=class x5 extends zi{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(fe){super(fe),this._loadDataTask=null,this._numPoints=0,this._passParameters=new gN,this._updatingTracking=new Up}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=e$4f(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=t$4r(this._technique),this._vao=r$3M(this._vao),TN=null}render(fe){const{rctx:ve}=fe;if(this._ensureResources(ve),null==this._technique||null==this._vao)return;if(!this._technique.compiled)return void this.requestRender();const _e=ve.bindTechnique(this._technique,fe.bindParameters,this._passParameters);ve.bindVAO(this._vao),_e.assertCompatibleVertexAttributeLocations(this._vao),ve.drawArrays(NO.POINTS,0,this._numPoints)}_ensureResources(fe){if(null!=this._technique||null==TN)return;this._technique=new vN({rctx:fe,viewingMode:this.view.state.viewingMode}),this._numPoints=TN.byteLength/xN;const ve=new Float32Array(TN,0,2*this._numPoints),_e=new Uint8Array(TN,2*this._numPoints*4,this._numPoints);this._vao=function A$10(fe,ve,_e,be){const we=SN.createBuffer(be),Se=we.position,Te=we.color,Ee=we.size;for(let Ce=0;Ce<be;Ce++){const fe=ve[2*Ce],be=ve[2*Ce+1];Se.set(Ce,0,-Math.cos(fe)*Math.sin(be)),Se.set(Ce,1,-Math.sin(fe)*Math.sin(be)),Se.set(Ce,2,-Math.cos(be));const we=O$V(_e[Ce]),Oe=M$V($N[we[1]]);Te.set(Ce,0,255*Oe[0]),Te.set(Ce,1,255*Oe[1]),Te.set(Ce,2,255*Oe[2]),Te.set(Ce,3,255),Ee.set(Ce,we[0])}return new tM(fe,mA,{geometry:t$2L(SN)},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,we.buffer)})}(fe,ve,_e,this._numPoints),this._updatingTracking.add((()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null),(fe=>this._update(fe)),Xa)}_update(fe){if(!fe)return;const ve=(fe.getHours()/12+fe.getMinutes()/60*(2/24)+fe.getSeconds()/60*(2/1440)-.9972222)%2,_e=2*function I$_(fe){const ve=fe,_e=new Date(fe.getFullYear(),0,1,11,58,56);return(+ve-+_e)/(+new Date(fe.getFullYear()+1,0,1,11,58,55)-+_e)}(fe),be=n$48(this._passParameters.modelMatrix,wN);x$1E(be,be,-_e*Math.PI),c$4k(be,bN,be),x$1E(be,be,-ve*Math.PI),this.requestRender()}_createLoadDataTask(){if(null!=TN)return null;const fe=d$3e((async fe=>{const{data:ve}=await function i$4u(fe,ve){return U$1a(n$4t(fe),ve)}("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:fe});(function L$L(fe){if(!fe)throw new Ir("stars:no-data-received","Failed to create stars because star catalogue is missing");const ve=fe.byteLength/xN;if(ve%1!=0||ve>5e4||ve<5e3)throw new Ir("stars:invalid-data","Failed to create stars because star catalogue data is invalid")})(ve),TN=ve}));return fe.promise.catch((fe=>{b$2g(fe)||ar.getLogger(this).error(fe)})).then((()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))})),fe}};function M$V(fe){return[parseInt(fe.substring(0,2),16),parseInt(fe.substring(2,4),16),parseInt(fe.substring(4,6),16)]}function O$V(fe){return fe>=192?[2.9,fe-192]:fe>=160?[2.5,fe-160]:fe>=128?[2,fe-128]:fe>=96?[1.5,fe-96]:fe>=64?[1,fe-64]:fe>=32?[.7,fe-32]:[.4,fe]}e$4o([y$2v({constructOnly:!0})],_N.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],_N.prototype,"requestRender",void 0),e$4o([y$2v({readOnly:!0})],_N.prototype,"updating",null),e$4o([y$2v()],_N.prototype,"_loadDataTask",void 0),e$4o([y$2v()],_N.prototype,"_updatingTracking",void 0),_N=e$4o([a$4y("esri.views.3d.environment.Stars")],_N);const $N=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],bN=t$3N(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),wN=t$3N(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),xN=9,SN=H$J().vec3f(nO.POSITION).vec4u8(nO.COLOR).f32(nO.SIZE);let TN=null;const EN={required:[]},PN={required:[NI.Depth]};let CN=class s26 extends zi{consumes(){return EN}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(fe){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(fe){return!1}},ON=class u11 extends CN{},AN=class c19 extends CN{constructor(){super(...arguments),this.drapedPriority=0}},MN=class i21 extends CN{},RN=class d14 extends CN{};function a$2C(fe){return"prepareTechnique"in fe}function l$2L(fe){return"prepareTechniques"in fe}var IN;!function(fe){fe[fe.Immediate=0]="Immediate",fe[fe.Faded=1]="Faded"}(IN||(IN={}));let LN=class U2 extends ON{constructor(fe){super(fe),this.produces=new Map([[qR.OPAQUE_ENVIRONMENT,()=>!(null===this._atmosphere&&null===this._stars)],[qR.TRANSPARENT_ENVIRONMENT,()=>!(null===this._atmosphere)]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new DN,this._newWeatherParameters=new DN,this._fadedWeatherParameters=new DN,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var fe;this.removeHandles(),this.uninitializeRenderContext(),null!=(null==(fe=this.view)?void 0:fe._stage)&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:jC.None}consumes(){return this._atmosphereType===jC.Realistic?PN:EN}updateAnimation(fe){return null!=this._precipitation&&this._precipitation.update(fe)}get updating(){return null!=this._stars&&this._stars.updating||null!=this._clouds&&this._clouds.running}get weatherVisible(){return s$4g(this.view.state.camera.eye)-s$45(this.view.spatialReference).radius<=wC}get usedMemory(){var fe;return(null==(fe=this._clouds)?void 0:fe.usedMemory)??0}get _stars(){var fe;const ve=this.view,_e=(null==(fe=ve.environment)?void 0:fe.starsEnabled)??!1,be=this._get("_stars");return _e&&null!=this._context?null!=be?be:new _N({view:ve,requestRender:()=>this._setNeedsRender()}):(u$4d(be),null)}get _precipitation(){const fe=this._get("_precipitation");if(!this._precipitationEnabled||null==this._context)return u$4d(fe),null;const ve=this.view,_e=this._context;return null!=fe&&fe.context===_e?fe:(u$4d(fe),new dN({context:_e,view:ve}))}get _clouds(){const fe=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return u$4d(fe),null;if(null!=fe)return fe;const ve=this.view,_e=this._context;return u$4d(fe),new SI({context:_e,view:ve,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const fe=this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return u$4d(fe),null;const ve=this.view.state.viewingMode,_e=this._context.renderContext.rctx,be=s$45(this.view.spatialReference).radius;return null!=fe&&fe.viewingMode===ve&&fe.planetRadius===be?fe:(u$4d(fe),new jM({rctx:_e,viewingMode:ve,planetRadius:be,requestRender:()=>this._setNeedsRender()}))}get _fog(){const fe=this._get("_fog");if(!this.weatherEnabled||null==this._context)return u$4d(fe),null;if(null!=fe)return fe;const ve=this.view,_e=this._context,be=this._context.renderContext.rctx,we=this.view.state.viewingMode;return new RI({context:_e,view:ve,rctx:be,viewingMode:we})}get weatherEnabled(){var fe,ve;return!!(null==(ve=null==(fe=this.view)?void 0:fe.environmentManager)?void 0:ve.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(fe=null){this._context=fe;const t84=()=>this._setNeedsRender();this.addHandles([d$3d((()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled})),(fe=>this._updateAtmosphere(fe)),Ja),d$3d((()=>this._stars),t84),d$3d((()=>this._precipitation),t84),d$3d((()=>this._clouds),(()=>this._updateWeather()),Xa),d$3d((()=>this._fog),(()=>this._updateFogHaze()),Xa),d$3d((()=>this.view.state.mode),(()=>this._setNeedsRender()),Za),d$3d((()=>this._weatherUpdateParameters),(()=>{this._updateWeather(),this._updateFogHaze()}),Ja)])}uninitializeRenderContext(){this._context=null,this._atmosphere=u$4d(this._atmosphere),this._set("_stars",u$4d(this._stars)),this._set("_precipitation",u$4d(this._precipitation)),this._set("_clouds",u$4d(this._clouds)),this._set("_cloudsComposition",u$4d(this._cloudsComposition)),this._set("_fog",u$4d(this._fog))}prepareRender(fe){var ve;fe.bindParameters.cloudsFade.data=function I$18(fe){return null!=(null==fe?void 0:fe.cubeMap)}(this._clouds)?this._clouds:null,"local"!==this.view.viewingMode&&null!=(null==(ve=fe.bindParameters.cloudsFade.data)?void 0:ve.cubeMap)&&(this._updateWeatherFading(fe.bindParameters,fe.time),fe.bindParameters.cloudsFade.renderingStage===_M.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),fe.bindParameters.cloudsFade.data=null))}renderNode(fe){var ve,_e,be,we,Se,Te,Ee,Ce;switch(fe.bindParameters.slot){case qR.OPAQUE_ENVIRONMENT:null==(ve=this._stars)||ve.render(fe),null!=this.atmosphere&&(this.atmosphere.render(fe,null==(we=null==(be=null==(_e=this.view)?void 0:_e._stage)?void 0:be.renderer)?void 0:we.fullResolutionAtmosphere),this._cloudsComposition&&null!=fe.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(fe)),fe.bindParameters.cloudsFade.isFading&&this._context&&null!=(null==(Se=fe.bindParameters.cloudsFade.data)?void 0:Se.cubeMap)&&this._context.requestRender());break;case qR.TRANSPARENT_ENVIRONMENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(fe,this._weatherParameters.hazeAmount,null==(Ce=null==(Ee=null==(Te=this.view)?void 0:Te._stage)?void 0:Ee.renderer)?void 0:Ce.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&null!=this._fog&&this._fog.render(fe,this._weatherParameters.fog),this._precipitation)){const ve=this.view.environment.weather;"rainy"!==ve.type&&"snowy"!==ve.type||this._precipitation.render(fe,ve.precipitation,ve.type)}}}updateLightSources(fe,ve,_e,be){if(null!=this._context){const we=this._context.renderContext;we.bindParameters.oldLighting.copyFrom(we.bindParameters.lighting),we.bindParameters.newLighting.noonFactor=ve,we.bindParameters.newLighting.globalFactor=_e,we.bindParameters.newLighting.set(fe),be===IN.Faded||we.bindParameters.weatherFading?we.bindParameters.fadeLighting(0):we.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const fe=this.weatherEnabled?this.view.environment.weather:null;return null==fe?null:"rainy"===fe.type||"snowy"===fe.type?{type:fe.type,weatherAdjustment:fe.cloudCover,effect:fe.precipitation}:{type:fe.type,weatherAdjustment:"foggy"===fe.type?fe.fogStrength:fe.cloudCover}}_updateWeatherFading(fe,ve){fe.cloudsFade.updateFading(fe.camera,this.view.state.mode,ve,this.view.qualitySettings.fadeDuration),fe.cloudsFade.updateParallax(fe.camera),fe.weatherFading&&(function V$P(fe){fe.cloudsFade.fadeMode!==OM.CROSS_FADE&&fe.cloudsFade.fadeMode!==OM.FADE_IN?fe.fadeLighting(0):fe.fadeLighting(fe.cloudsFade.fadeFactor)}(fe),this._updateFogAtmoshpere(fe))}_updateFogAtmoshpere(fe){fe.cloudsFade.fadeMode!==OM.CROSS_FADE&&fe.cloudsFade.fadeMode!==OM.FADE_IN?this._fadeWeather(0):this._fadeWeather(fe.cloudsFade.fadeFactor)}_fadeWeather(fe){const{_newWeatherParameters:ve,_oldWeatherParameters:_e}=this;fe>=1?this._weatherParameters=ve:(this._fadedWeatherParameters.lerp(_e,ve,fe),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const fe=this._weatherUpdateParameters;null!=fe&&null!=this._clouds&&(this._clouds.applyPreset(eR[fe.type],fe.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const fe=this._weatherUpdateParameters;if(null==this._fog||null==fe||null==this._context)return;const ve=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),fe.type){case"foggy":this._newWeatherParameters.fog.strength=f$3i(3e-5,.005,fe.weatherAdjustment**3),r$3w(this._newWeatherParameters.fog.color,FN),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=f$3i(4e-6,2e-4,(fe.effect??0)**3),r$3w(this._newWeatherParameters.fog.color,NN),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=f$3i(4e-6,2e-4,(fe.effect??0)**3),r$3w(this._newWeatherParameters.fog.color,FN),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}ve.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(fe){const ve=this._selectAtmosphereType(fe);if(ve!==jC.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==ve){this._atmosphere=u$4d(this._atmosphere);const fe=this._getAtmosphereClass(ve);fe&&(this._atmosphere=new fe(this.view,this._context))}}else this._atmosphere=u$4d(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(fe){switch(fe){case jC.Realistic:return uM;case jC.Local:return VD;case jC.Mars:return YD;default:case jC.None:return null}}_selectAtmosphereType(fe){const{enabled:ve,viewingMode:_e}=fe;return!ve||p$4U(this.view.spatialReference)?jC.None:_e===Wf.Local?jC.Local:null!=this._context&&P$1b(this.view.spatialReference)?jC.Realistic:f$3b(this.view.spatialReference)?jC.Mars:jC.None}get test(){}};e$4o([y$2v({constructOnly:!0})],LN.prototype,"view",void 0),e$4o([y$2v({readOnly:!0})],LN.prototype,"atmosphere",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_atmosphereType",null),e$4o([y$2v({type:Boolean,readOnly:!0})],LN.prototype,"updating",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"weatherVisible",null),e$4o([y$2v()],LN.prototype,"_context",void 0),e$4o([y$2v()],LN.prototype,"_atmosphere",void 0),e$4o([y$2v({readOnly:!0})],LN.prototype,"_stars",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_precipitation",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_clouds",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_cloudsComposition",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_fog",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"weatherEnabled",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_precipitationEnabled",null),e$4o([y$2v({readOnly:!0})],LN.prototype,"_weatherUpdateParameters",null),LN=e$4o([a$4y("esri.views.3d.environment.EnvironmentRenderer")],LN);let DN=class I6{constructor(){this.fog=new II,this.hazeAmount=1}copyFrom(fe){this.fog.amount=fe.fog.amount,this.hazeAmount=fe.hazeAmount,this.fog.strength=fe.fog.strength,r$3w(this.fog.color,fe.fog.color)}lerp(fe,ve,_e){this.fog.amount=f$3i(fe.fog.amount,ve.fog.amount,_e),this.hazeAmount=f$3i(fe.hazeAmount,ve.hazeAmount,_e),this.fog.strength=f$3i(fe.fog.strength,ve.fog.strength,_e),A$1G(this.fog.color,fe.fog.color,ve.fog.color,_e)}};const NN=r$3y(.5,.5,.5),FN=r$3y(1.5,1.5,1.5);var zN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o$2e(fe){return fe&&fe.__esModule&&Object.prototype.hasOwnProperty.call(fe,"default")?fe.default:fe}var kN,UN,VN,BN={exports:{}};kN=BN,UN=function(){var fe=Math.PI,ve=Math.sin,_e=Math.cos,be=Math.tan,we=Math.asin,Se=Math.atan2,Te=Math.acos,Ee=fe/180,Ce=864e5,Oe=2440588,Re=2451545,De={dec:0,ra:0};function v17(fe){return new Date((fe+.5-Oe)*Ce)}function M10(fe){return function p48(fe){return fe.valueOf()/Ce-.5+Oe}(fe)-Re}var Be=23.4397*Ee;function h33(fe,we){return Se(ve(fe)*_e(Be)-be(we)*ve(Be),_e(fe))}function x16(fe,be){return we(ve(be)*_e(Be)+_e(be)*ve(Be)*ve(fe))}function N14(fe,we,Te){return Se(ve(fe),_e(fe)*ve(we)-be(Te)*_e(we))}function P9(fe,be,Se){return we(ve(be)*ve(Se)+_e(be)*_e(Se)*_e(fe))}function m39(fe,ve){return Ee*(280.16+360.9856235*fe)-ve}function E12(fe){return Ee*(357.5291+.98560028*fe)}function I12(fe){return Ee*(1.9148*ve(fe)+.02*ve(2*fe)+3e-4*ve(3*fe))}function g25(ve,_e){return ve+_e+102.9372*Ee+fe}function O16(fe,ve){var _e=E12(fe),be=g25(_e,I12(_e));return ve||(ve={dec:0,ra:0}),ve.dec=x16(be,0),ve.ra=h33(be,0),ve}var Ze={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(fe,ve,_e,be){var we=Ee*-_e,Se=Ee*ve,Te=M10(fe),Ce=O16(Te,De),Oe=m39(Te,we)-Ce.ra;return be||(be={azimuth:0,altitude:0}),be.azimuth=N14(Oe,Se,Ce.dec),be.altitude=P9(Oe,Se,Ce.dec),be}},Xe=[[-.83,"sunrise","sunset"]];Ze.addTime=function(fe,ve,_e){Xe.push([fe,ve,_e])};var Je=9e-4;function R10(ve,_e,be){return Je+(ve+_e)/(2*fe)+be}function _21(fe,_e,be){return Re+fe+.0053*ve(_e)-.0069*ve(2*be)}function z10(fe){var be=Ee*(134.963+13.064993*fe),we=Ee*(93.272+13.22935*fe),Se=Ee*(218.316+13.176396*fe)+6.289*Ee*ve(be),Te=5.128*Ee*ve(we),Ce=385001-20905*_e(be);return{ra:h33(Se,Te),dec:x16(Se,Te),dist:Ce}}return Ze.getTimes=function(be,we,Se){var Ce=Ee*-Se,Oe=Ee*we,Re=function L10(ve,_e){return Math.round(ve-Je-_e/(2*fe))}(M10(be),Ce),De=R10(0,Ce,Re),Be=E12(De),Qe=I12(Be),dt=g25(Be,Qe),$t=x16(dt,0),bt=_21(De,Be,dt);function N15(fe){return _21(R10(function G10(fe,be,we){return Te((ve(fe)-ve(be)*ve(we))/(_e(be)*_e(we)))}(fe,Oe,$t),Ce,Re),Be,dt)}var wt,xt,St,Et,Pt,Ot={solarNoon:v17(bt),nadir:v17(bt-.5),polarException:Ze.PolarException.NORMAL};for(wt=0,xt=Xe.length;wt<xt;wt+=1)Pt=bt-((Et=N15((St=Xe[wt])[0]*Ee))-bt),Ot[St[1]]=v17(Pt),Ot[St[2]]=v17(Et);return Ot.polarException=function P10(fe){var be=(ve(fe)-ve(Oe)*ve($t))/(_e(Oe)*_e($t));return be<-1?Ze.PolarException.MIDNIGHT_SUN:be>1?Ze.PolarException.POLAR_NIGHT:Ze.PolarException.NORMAL}(Xe[0][0]*Ee),Ot},Ze.getMoonPosition=function(fe,ve,_e){var we=Ee*-_e,Se=Ee*ve,Te=M10(fe),Ce=z10(Te),Oe=m39(Te,we)-Ce.ra,Re=P9(Oe,Se,Ce.dec);return Re+=.017*Ee/be(Re+10.26*Ee/(Re+5.1*Ee)),{azimuth:N14(Oe,Se,Ce.dec),altitude:Re,distance:Ce.dist}},Ze.getMoonFraction=function(fe){var be=M10(fe),we=O16(be),Ee=z10(be),Ce=149598e3,Oe=Te(ve(we.dec)*ve(Ee.dec)+_e(we.dec)*_e(Ee.dec)*_e(we.ra-Ee.ra)),Re=Se(Ce*ve(Oe),Ee.dist-Ce*_e(Oe));return(1+_e(Re))/2},Ze},void 0!==(VN=UN())&&(kN.exports=VN);const jN=o$2e(BN.exports),GN={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let HN=class j4{constructor(fe,ve){this.direct=fe,this.ambient=ve}};function S$17(fe,ve,_e,be,we,Se){o$44(Se.ambient.color,1,1,1),Se.ambient.intensity=GN.global.ambient,o$44(Se.direct.color,1,1,1),Se.direct.intensity=GN.global.direct;const Te=ve[2],Ee=e$3Y((Math.abs(Te)-GN.local.altitude)/(GN.global.altitude-GN.local.altitude),0,1);let Ce;if(Se.globalFactor=Ee,null!=fe&&(Ce=jN.getTimes(fe,ve[1],ve[0])),Ee<1){let ve;if(null!=fe)ve=function ot$b(fe,ve,_e){const be=fe.valueOf();let we,Se;ve.polarException===jN.PolarException.MIDNIGHT_SUN?(we=be-60*(fe.getHours()+48)*60*1e3-60*fe.getMinutes()*1e3,Se=we+432e6):ve.polarException===jN.PolarException.POLAR_NIGHT?(we=be-2,Se=be-1):(we=ve.sunrise.valueOf(),Se=ve.sunset.valueOf());const Te=Se-we,Ee=we+Te/2,Ce=Te/4,Oe=Ee-Ce,Re=Ee+Ce,De=.06*Te,Be=we-De/2,Ze=we+De/2,Xe=Se-De/2,Je=Se+De/2,Qe=[0,0],dt=[0,0,0],$t=[0,0,0];let bt="";if(be<Be||be>Je)r$2C(Qe,nF),r$3w(dt,XN),r$3w($t,eF),bt="night";else if(be<Ze){const fe=(be-Be)/(Ze-Be);_$12(Qe,nF,sF,fe),A$1G(dt,XN,JN,fe),A$1G($t,eF,tF,fe),bt="sun rising"}else if(be<Oe){const fe=(be-Ze)/(Oe-Ze);_$12(Qe,sF,oF,fe),A$1G(dt,JN,QN,fe),A$1G($t,tF,rF,fe),bt="early morning"}else if(be<Ee){const fe=(be-Oe)/(Ee-Oe);_$12(Qe,oF,aF,fe),A$1G(dt,QN,KN,fe),A$1G($t,rF,iF,fe),bt="late morning"}else if(be<Re){const fe=(be-Ee)/(Re-Ee);_$12(Qe,aF,lF,fe),A$1G(dt,KN,cF,fe),A$1G($t,iF,uF,fe),bt="early afternoon"}else if(be<Xe){const fe=(be-Re)/(Xe-Re);_$12(Qe,lF,hF,fe),A$1G(dt,cF,dF,fe),A$1G($t,uF,pF,fe),bt="late afternoon"}else if(be<Je){const fe=(be-Xe)/(Je-Xe);_$12(Qe,hF,nF,fe),A$1G(dt,dF,XN,fe),A$1G($t,pF,eF,fe),bt="sun setting"}let wt=0;switch(_e){case"rainy":case"foggy":wt=.8;break;case"snowy":wt=.5}wt>0&&(R$Q(dt,wt),R$Q($t,wt));const xt=L$K(_e);return{direct:{intensity:Qe[0]*xt.direct,color:dt},ambient:{intensity:Qe[1]*xt.ambient,color:$t},timeOfDay:bt}}(fe,Ce,be);else{const fe=L$K(be);ve={direct:{intensity:GN.local.directAtNoon*fe.direct,color:r$3y(1,1,1)},ambient:{intensity:GN.local.ambientAtNoon*fe.ambient,color:r$3y(1,1,1)},timeOfDay:"early afternoon"}}A$1G(Se.ambient.color,ve.ambient.color,Se.ambient.color,Ee),Se.ambient.intensity=f$3i(ve.ambient.intensity,Se.ambient.intensity,Ee),A$1G(Se.direct.color,ve.direct.color,Se.direct.color,Ee),Se.direct.intensity=f$3i(ve.direct.intensity,Se.direct.intensity,Ee),Se.specularStrength="rainy"===be||"snowy"===be||"foggy"===be?0:1,Se.environmentStrength="rainy"===be?.7:"snowy"===be||"foggy"===be?.75:1}Se.noonFactor=null!=fe?function F$J(fe,ve){const _e=fe.valueOf();let be,we;ve.polarException===jN.PolarException.MIDNIGHT_SUN?(be=_e-60*(fe.getHours()+48)*60*1e3-60*fe.getMinutes()*1e3,we=be+432e6):ve.polarException===jN.PolarException.POLAR_NIGHT?(be=_e-2,we=_e-1):(be=ve.sunrise.valueOf(),we=ve.sunset.valueOf());const Se=be+(we-be)/2;return 1-e$3Y(Math.abs(_e-Se)/432e5,0,1)}(fe,Ce):1,null!=fe?function P$M(fe,ve,_e,be){const we=ZN,Se=o$3E(YN);if(_e===Wf.Global)jN.getPosition(fe,0,0,we),o$44(be,0,0,-1),l$3_(Se,Se,-we.azimuth),m$3m(Se,Se,-we.altitude),O$1v(be,be,Se);else{const _e=GN.planarDirection,Te=_e.globalAngles,Ee=ve[2];let Ce=(Math.abs(Ee)-_e.localAltitude)/(_e.globalAltitude-_e.localAltitude);Ce=e$3Y(Ce,0,1),Ce<1?(jN.getPosition(fe,ve[1],ve[0],we),we.azimuth=(1-Ce)*we.azimuth+Ce*Te.azimuth,we.altitude=(1-Ce)*we.altitude+Ce*Te.altitude):(we.azimuth=Te.azimuth,we.altitude=Te.altitude),o$44(be,0,-1,0),x$1E(Se,Se,-we.azimuth),l$3_(Se,Se,-we.altitude),O$1v(be,be,Se)}}(fe,ve,_e,Se.direct.directionToLightSource):O$U(we,_e,Se.direct.directionToLightSource)}function O$U(fe,ve,_e){ve===Wf.Global?z$1d(mF,fe.eye):o$44(mF,0,0,1),g$2z(yF,fe.viewForward,-1);const be=v$1O(yF,mF),we=Math.max(be-2*vF,0),Se=.85*we/(we+1),Te=Math.max(vF,be-vF-Se);p$4z(fF,-Te,fe.viewRight),O$1v(_e,yF,fF),u$3Y(_e,_e,g$2z(gF,fe.viewRight,_F)),z$1d(_e,_e)}const qN=r$3y(.5773502691896258,-.5773502691896258,.5773502691896258);let WN=class I7{constructor(){this.ambient={color:r$3y(1,1,1),intensity:.55},this.direct={color:r$3y(1,1,1),intensity:.55,directionToLightSource:t$47(qN)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const YN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ZN={azimuth:0,altitude:0};function L$K(fe){switch(fe){case"disabled":case"sunny":case"cloudy":return new HN(1,1);case"rainy":return new HN(.4,1.2);case"snowy":return new HN(.5,1.3);case"foggy":return new HN(.2,1.6)}}function R$Q(fe,ve){const _e=(fe[0]+fe[1]+fe[2])/3;fe[0]+=(_e-fe[0])*ve,fe[1]+=(_e-fe[1])*ve,fe[2]+=(_e-fe[2])*ve}const XN=r$3y(.01,.01,.01),JN=r$3y(1,.6,.5),QN=r$3y(1,.98,.98),KN=r$3y(1,1,1),eF=r$3y(.8,.8,1),tF=r$3y(.8,.8,1),rF=r$3y(.98,.98,1),iF=r$3y(1,1,1),nF=r$36(.01,GN.local.ambientAtNight),sF=r$36(GN.local.directAtTwilight,GN.local.ambientAtTwilight),oF=r$36(.9*GN.local.directAtNoon,GN.local.ambientAtNoon),aF=r$36(GN.local.directAtNoon,GN.local.ambientAtNoon),lF=oF,cF=QN,uF=rF,hF=sF,dF=JN,pF=tF;const fF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mF=[0,0,0],yF=[0,0,0],gF=[0,0,0],vF=.25,_F=.2;function l$2K(fe){return P$1b(fe)?C$1p(fe)||w$1X(fe)||k$1w(fe)||A$1A(fe)?_p:fe:a$40(fe)}var $F;function f$1Y(fe){return function p$2N(fe,ve){const{hasZ:_e,spatialReference:be}=fe,we=l$2K(be);let Se=0;const Te=Z$H(we);if(null==Te)return null;const Ee=ve===$F.Direct?Z$p:j$11;for(const Ce of fe.paths){if(Ce.length<2)continue;const fe=Ce.length-1;for(let ve=0;ve<fe;++ve){const fe=Ce[ve];bF[0]=fe[0],bF[1]=fe[1],bF[2]=_e?fe[2]:0;const we=Ce[ve+1];wF[0]=we[0],wF[1]=we[1],wF[2]=_e?we[2]:0;const Te=Ee(bF,wF,be);if(null==Te)return null;Se+=Te.value}}return a$36(Se,Te)}(fe,$F.Horizontal)}function h$1I(fe,ve){const{spatialReference:_e}=fe;return G$Y(_e,ve.spatialReference)?(bF[0]=fe.x,bF[1]=fe.y,bF[2]=fe.hasZ?fe.z:0,wF[0]=ve.x,wF[1]=ve.y,wF[2]=ve.hasZ?ve.z:0,function x$13(fe,ve,_e){const be=V$N(fe,ve,_e);return null!=be?{direct:a$36(be.direct,be.unit),horizontal:a$36(be.horizontal,be.unit),vertical:a$36(be.vertical,be.unit)}:null}(bF,wF,_e)):null}function m$2a(fe,ve){const{spatialReference:_e}=fe;return G$Y(_e,ve.spatialReference)?(bF[0]=fe.x,bF[1]=fe.y,bF[2]=fe.hasZ?fe.z:0,wF[0]=ve.x,wF[1]=ve.y,wF[2]=ve.hasZ?ve.z:0,Z$p(bF,wF,_e)):null}function z$H(fe,ve){const{spatialReference:_e}=fe;return G$Y(_e,ve.spatialReference)?(bF[0]=fe.x,bF[1]=fe.y,bF[2]=fe.hasZ?fe.z:0,wF[0]=ve.x,wF[1]=ve.y,wF[2]=ve.hasZ?ve.z:0,j$11(bF,wF,_e)):null}function y$1k(fe,ve){const{spatialReference:_e}=fe;return G$Y(_e,ve.spatialReference)?(bF[0]=fe.x,bF[1]=fe.y,bF[2]=fe.hasZ?fe.z:0,wF[0]=ve.x,wF[1]=ve.y,wF[2]=ve.hasZ?ve.z:0,g$1v(bF,wF,_e)):null}function R$P(fe){return null!=fe?v$15(fe.hasZ?fe.z:0,fe.spatialReference):null}function v$15(fe,ve){const _e=ee$g(ve);return null!=_e?a$36(fe??0,_e):null}function Z$p(fe,ve,_e){const be=V$N(fe,ve,_e,$F.Direct);return null!=be?a$36(be.direct,be.unit):null}function j$11(fe,ve,_e){const be=V$N(fe,ve,_e,$F.Horizontal);return null!=be?a$36(be.horizontal,be.unit):null}function g$1v(fe,ve,_e){const be=V$N(fe,ve,_e,$F.Vertical);return null!=be?a$36(be.verticalSigned,be.unit):null}function V$N(fe,ve,_e,be){const we=l$2K(_e),Se=Z$H(we);if(null==Se)return null;const Te=ve[2]-fe[2];if(be===$F.Vertical)return{verticalSigned:Te,unit:Se};if(!n$3Y(fe,_e,xF,we)||!n$3Y(ve,_e,SF,we))return null;if(be===$F.Direct)return{direct:x$1W(SF,xF),unit:Se};if(o$44(TF,fe[0],fe[1],ve[2]),!n$3Y(TF,_e,TF,we))return null;const Ee=x$1W(TF,SF);return be===$F.Horizontal?{horizontal:Ee,unit:Se}:{direct:x$1W(SF,xF),horizontal:Ee,vertical:Math.abs(Te),unit:Se}}!function(fe){fe[fe.Direct=0]="Direct",fe[fe.Horizontal=1]="Horizontal",fe[fe.Vertical=2]="Vertical"}($F||($F={}));const bF=[0,0,0],wF=[0,0,0],xF=[0,0,0],SF=[0,0,0],TF=[0,0,0];let EF=class L3 extends La.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new XR,this._ambientLight=new YR,this._moonLight=new ZR,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var fe;return null==(fe=this._renderer)?void 0:fe.view}get updating(){var fe;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!(null==(fe=this._renderer)?void 0:fe.updating))}get weatherEnabled(){var fe,ve,_e;return(null==(fe=this._view)?void 0:fe.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(_e=null==(ve=this._view)?void 0:ve.state)?void 0:_e.viewingMode)===Wf.Global&&P$1b(this._view.spatialReference)}get weatherVisible(){var fe;return this.weatherEnabled&&(null==(fe=this._renderer)?void 0:fe.weatherVisible)}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(fe){if(this._renderer)return;this._renderer=new LN({view:fe});const t84=()=>this._updateRenderParameters(),i52=()=>this._cameraHandler();this.addHandles([d$3d((()=>fe.environment.lighting),(fe=>this._updateLightingHandler(fe)),Za),d$3d((()=>"virtual"!==fe.environment.lighting.type?fe.environment.lighting.date:null),(fe=>this._lightingDateHandler(fe)),Za),d$3d((()=>fe.stationary),(()=>this._interactingStationaryHandler())),d$3d((()=>fe.environment.lighting.directShadowsEnabled),t84,Za),d$3d((()=>fe.qualitySettings.ambientOcclusion),t84,Za),d$3d((()=>fe.qualitySettings.reflections),t84,Za),d$3d((()=>fe.spatialReference),(()=>this._resetReferencePosition(!0)),Za),d$3d((()=>fe.environment.weather.type),(()=>this._updateLighting(null,IN.Faded)),Za),d$3d((()=>this.weatherEnabled),(()=>this._updateLighting(null,IN.Faded)),Za),d$3d((()=>fe.viewingMode),(()=>this._resetReferencePosition(!0)),Ja),d$3d((()=>"virtual"!==fe.environment.lighting.type&&fe.environment.lighting.cameraTrackingEnabled),(fe=>this._updateCameraTracking(fe)),Ja),d$3d((()=>fe.state.camera),i52,Ja),d$3d((()=>this.disableQueries),i52)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=u$4d(this._renderer)}_updateLightingHandler(fe){this._updateCameraTracking("virtual"!==fe.type&&fe.cameraTrackingEnabled),this._lightingDateHandler("virtual"!==fe.type?fe.date:null),this._updateRenderParameters()}_updateCameraTracking(fe){if(this._trackingEnabled=fe,fe)this._cameraHandler();else{const fe=this._view.environment.lighting;"virtual"!==(null==fe?void 0:fe.type)&&(fe.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(fe){const ve=this._view.environment.lighting;if("virtual"!==(null==ve?void 0:ve.type)){if(fe){if(!ve.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!J$G(this._view.spatialReference,zo.WGS84)){const fe=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(fe))return void this._requestReferencePositionUpdate(fe)}if(this._preupdateTracking(fe),null!=this._referencePositionGeographic){const fe=c$45(this._referencePositionGeographic,AF);null!=fe&&(ve.autoUpdate(null,fe),this._trackingEnabled&&(ve.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(fe)}}else this._updateLighting()}_preupdateTracking(fe){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(fe)}_cameraHandler(fe=null){const ve=this._view;if(!ve.ready)return;const _e=ve.stateManager.camera;_e&&(this._cameraHandlerClientSide(_e,fe)||this._cameraHandlerServerSide(_e))}_cameraHandlerClientSide(fe,ve){const _e=P$1b(this._view.spatialReference);if(_e&&!J$G(this._view.spatialReference,zo.WGS84))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;const be=fe.position;return this._referencePositionGeographic??(this._referencePositionGeographic=[0,0,0]),_e?c$4l(be,this._referencePositionGeographic,zo.WGS84):o$44(this._referencePositionGeographic,be.longitude??0,be.latitude??0,be.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,ve)||this._updateLighting(ve),!0}_cameraHandlerServerSide(fe){const ve=fe.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(ve))&&this._requestReferencePositionUpdate(ve,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(ve.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(fe,ve=IN.Immediate){const _e=this._view;fe=fe||("virtual"===_e.environment.lighting.type?null:_e.environment.lighting.date);const be=this._referencePositionGeographic,we=be?PF:CF,Se=this.weatherVisible?_e.environment.weather.type:"disabled";null!=be?S$17(fe,be,_e.state.viewingMode,Se,_e.state.camera,we):"virtual"===_e.environment.lighting.type&&O$U(_e.state.camera,_e.state.viewingMode,we.direct.directionToLightSource);const Te=this._mainLight,Ee=we.direct;g$2z(Te.intensity,Ee.color,Ee.intensity*Math.PI),r$3w(Te.direction,Ee.directionToLightSource),Te.specularStrength=we.specularStrength,Te.environmentStrength=we.environmentStrength;const Ce=this._ambientLight;g$2z(Ce.intensity,we.ambient.color,we.ambient.intensity);const Oe=this._moonLight;A$1G(Oe.intensity,MF,RF,we.globalFactor);const Re=(1-.5*we.globalFactor)*(1-.4*we.noonFactor*(1-we.globalFactor));g$2z(Oe.intensity,Oe.intensity,Re),r$3w(Oe.direction,Ee.directionToLightSource),this._renderer.updateLightSources([Te,Ce,Oe],we.noonFactor,we.globalFactor,ve),this._updateRenderParameters()}_autoUpdateTimezone(fe,ve=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==fe)return!1;const _e=OF;_e.setTime((ve||this._view.environment.lighting.date).getTime());const be=c$45(fe,AF);if(null==be)return!1;let we=this._view.environment.lighting.positionTimezoneInfo;if(we.autoUpdated){if(we.hours===be.hours&&we.minutes===be.minutes&&we.seconds===be.seconds)return!1}else we=be;const Se=_e.getUTCHours()-(be.hours-we.hours),Te=_e.getUTCMinutes()-(be.minutes-we.minutes),Ee=_e.getUTCSeconds()-(be.seconds-we.seconds);return _e.setUTCHours(Se),_e.setUTCMinutes(Te),_e.setUTCSeconds(Ee),!ve&&this._view.environment.lighting.autoUpdate(_e,be)}_updateRenderParameters(){const fe=this._view._stage;if(!fe)return;const ve=null==this._referencePositionGeographic||function z$I(fe,ve){if(ve===Wf.Global)return!0;const _e=GN.planarDirection;return Math.abs(fe)<_e.localAltitude}(this._referencePositionGeographic[2],this._view.state.viewingMode);fe.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&ve,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(fe=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),fe&&this._cameraHandler()}_requestReferencePositionUpdate(fe,ve=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(fe):this._referencePosMapCoordsRequested=fe.clone(),this._referencePosResetPreserveAbsoluteTime=!!ve,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const fe=this._referencePosUpdateQuery=A$1J(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===fe){const t86=()=>this._referencePosUpdateQuery!==fe;return this._doReferencePositionUpdateQuery(t86)}})).catch((fe=>{"mapcoordshelper:missing-geometry-service"===fe.name&&(this.disableQueries=!0)})).then((()=>{this._referencePosUpdateQuery===fe&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))})),ve=this._referencePosUpdateTimer=A$1J(this._referencePointUpdateInterval).then((()=>{this._referencePosUpdateTimer===ve&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())}));this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(fe){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const ve=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!fe()&&!isNaN(ve[0])&&!isNaN(ve[1])){const fe=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?o$44(this._referencePositionGeographic,ve[0],ve[1],fe):this._referencePositionGeographic=r$3y(ve[0],ve[1],fe),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const fe=this._referencePosMapCoordsRequested;fe&&this._requestReferencePositionUpdate(fe,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(fe){const ve=this._referencePosMapCoords;if(null==ve)return!0;const _e=m$2a(ve,fe);return null==_e||s$34(_e,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const fe=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,fe}get test(){}};e$4o([y$2v({type:Boolean,readOnly:!0})],EF.prototype,"updating",null),e$4o([y$2v()],EF.prototype,"disableQueries",void 0),e$4o([y$2v()],EF.prototype,"_disableWeather",void 0),e$4o([y$2v()],EF.prototype,"weatherEnabled",null),e$4o([y$2v()],EF.prototype,"weatherVisible",null),e$4o([y$2v()],EF.prototype,"referencePositionGeographic",null),e$4o([y$2v()],EF.prototype,"_renderer",void 0),e$4o([y$2v()],EF.prototype,"_referencePositionGeographic",void 0),EF=e$4o([a$4y("esri.views.3d.environment.SceneViewEnvironmentManager")],EF);const PF=new WN,CF=new WN,OF=new Date,AF={hours:0,minutes:0,seconds:0},MF=r$3y(.22,.22,.33),RF=r$3y(.22,.22,.22);var IF,LF,DF,NF,FF;(LF=IF||(IF={}))[LF.NONE=0]="NONE",LF[LF.TILT=1]="TILT",LF[LF.ALTITUDE=2]="ALTITUDE",LF[LF.DISTANCE=4]="DISTANCE",LF[LF.COLLISION=8]="COLLISION",LF[LF.ALL=15]="ALL",LF[LF.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION",(NF=DF||(DF={}))[NF.NONE=0]="NONE",NF[NF.ZOOM=1]="ZOOM",NF[NF.TUMBLE=2]="TUMBLE",NF[NF.LOOK_AROUND=3]="LOOK_AROUND",NF[NF.PAN=4]="PAN",NF[NF.ASCEND=5]="ASCEND",function(fe){fe[fe.TUMBLE=0]="TUMBLE",fe[fe.LOOK_AROUND=1]="LOOK_AROUND"}(FF||(FF={}));let zF=class r13{constructor(fe=IF.ALL,ve=DF.NONE,_e=0,be=null,we=null,Se=FF.TUMBLE){this.selection=fe,this.interactionType=ve,this.interactionFactor=_e,this.interactionStartCamera=be,this.interactionDirection=we,this.tiltMode=Se}};function o$2c(fe,ve){return!!(fe&ve)}function r$2c(fe,ve,_e,be,we,Se){0!==fe&&(_e?(Se.min=Math.min(Se.min,ve),Se.max=Math.max(Se.max,ve)):null!=be?(Se.min-=Math.max(0,(ve-Se.min)*(1-be)),Se.max+=Math.max(0,(ve-Se.max)*(1-be))):we&&(Se.min-=Math.max(0,ve-Se.min-we),Se.max+=Math.max(0,ve-Se.max-we)))}const kF=new zF(IF.NONE);function x$12(fe,ve,_e,be){return r$3w(be,ve=ve||fe.viewForward),g$2z(be,be,Math.sign(P$1g(ve,_e))),be}function g$1u(fe,ve,_e,be){return function h$1H(fe,ve,_e,be){be.clip[0]=0,be.clip[1]=_e?be.len:Number.MAX_VALUE;for(let we=0;we<fe.length;we++)if(!x$11(fe[we],ve,be))return!1;return!0}(fe,ve,_e,function v$14(fe,ve,_e,be){const we=UF;return fe?(_e&&be&&(we.len=x$1W(ve,_e)),r$3w(we.dir,fe)):(we.len=x$1W(ve,_e),e$3Z(we.dir,_e,ve),g$2z(we.dir,we.dir,1/we.len)),we}(be,ve,_e,!0))}const UF={dir:[0,0,0],len:0,clip:[0,0]};function x$11(fe,ve,_e){const be=P$1g(fe,_e.dir),we=-V$12(fe,ve);if(we<0&&be>=0)return!1;if(be>-1e-6&&be<1e-6)return we>0;if((we<0||be<0)&&!(we<0&&be<0))return!0;const Se=we/be;return be>0?Se<_e.clip[1]&&(_e.clip[1]=Se):Se>_e.clip[0]&&(_e.clip[0]=Se),_e.clip[0]<=_e.clip[1]}function p$2M(fe,ve,_e=kF){if(!function d$1U(fe,ve){const _e=fe.state.constraints.altitude;return!(!fe.state.isGlobal||!_e||ve.interactionType===DF.TUMBLE&&o$2c(ve.selection,IF.TILT))}(fe,_e)||!fe.state.constraints.altitude)return 0;const be=function x$10(fe,ve){return ve.min=fe.min,ve.max=fe.max,ve}(fe.state.constraints.altitude,VF);!function y$1j(fe,ve,_e){const be=ve.interactionType;if(be===DF.NONE)return;const{min:we,max:Se}=_e,{interactionStartCamera:Te,interactionFactor:Ee}=ve;if(!Te)return;const Ce=be===DF.TUMBLE||be===DF.ZOOM,Oe=p$2M(fe,Te),Re=0===Oe?0:fe.renderCoordsHelper.getAltitude(Te.eye);_e.min=we,_e.max=Se,r$2c(Oe,Re,Ce,Ee,.05*Re,_e)}(fe,_e,be);const we=fe.renderCoordsHelper.getAltitude(ve.eye),Se=e$3Y(we,be.min,be.max)-we;return Math.abs(Se)<=1e-6?0:Se}const VF={min:0,max:0},BF=[0,0,0],jF=[0,0,0],GF=[0,0,0],HF=[0,0,0];function d$1T(fe,ve,_e=kF){if(!fe.state.isLocal)return 0;const be=fe.state.constraints.distance;if(!fe.pointsOfInterest.surfaceOrigin.renderLocation||be===1/0)return 0;qF.min=0,qF.max=be,function l$2I(fe,ve,_e){const be=ve.interactionType;if(be===DF.NONE)return;const{min:we,max:Se}=_e,{interactionStartCamera:Te,interactionFactor:Ee}=ve;if(!Te)return;const Ce=be===DF.ZOOM||be===DF.PAN,Oe=d$1T(fe,Te),Re=0===Oe?0:O$R(fe,Te);_e.min=we,_e.max=Se,r$2c(Oe,Re,Ce,Ee,.05*Re,_e)}(fe,_e,qF);const we=O$R(fe,ve),Se=qF.max-we;return Se>=-1e-6?0:Se}function O$R(fe,ve){const _e=fe.pointsOfInterest.surfaceOrigin;return _e.renderLocation?x$1W(ve.eye,_e.renderLocation):0}const qF={min:0,max:0},WF=[0,0,0],YF=[0,0,0],ZF=[0,0,0],XF=[0,0,0],JF=[0,0,0];function s$2I(fe,ve,_e=QF.EYE){const be=fe.state.constraints;if(!be.collision.enabled)return!1;const we=f$2B(fe,ve.eye),Se=fe.renderCoordsHelper.getAltitude(ve.eye),Te=we+be.collision.elevationMargin;if(Se>=Te)return!1;const Ee=s$4g(ve.eye);if(e$3Z(KF,ve.center,ve.eye),ve.eye=fe.renderCoordsHelper.setAltitude(ez,Te,ve.eye),_e===QF.EYE_AND_CENTER)ve.center=u$3Y(KF,ve.eye,KF);else if(_e===QF.EYE_AND_CENTER_SCALE){const fe=(Ee-Se+Te)/Ee;ve.center=g$2z(KF,ve.center,fe)}return!0}var QF;!function(fe){fe[fe.EYE=0]="EYE",fe[fe.EYE_AND_CENTER=1]="EYE_AND_CENTER",fe[fe.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(QF||(QF={}));const KF=[0,0,0],ez=[0,0,0];function c$2E(fe,ve,_e){fe.worldUpAtPosition(ve,tz),e$3Z(rz,_e,ve);const be=s$4g(rz);return 0===be?0:m$3J(P$1g(rz,tz)/be)}const tz=[0,0,0],rz=[0,0,0];function U$K(fe,ve,_e,be=kF,we){if(!fe.state.constraints.tilt)return 0;const Se=ve.distance,Te=fe.state.constraints.tilt(Se,az);return function k$T(fe,ve,_e){if(ve.interactionType===DF.NONE)return;const{interactionStartCamera:be,interactionFactor:we}=ve;if(!be)return;const{min:Se,max:Te}=_e,Ee=U$K(fe,be,kF,ve),Ce=0===Ee?0:c$2E(fe.renderCoordsHelper,be.center,be.eye);_e.min=Se,_e.max=Te,ve.interactionType===DF.TUMBLE?(o$2c(ve.selection,IF.ALTITUDE)&&B$A(fe,be,_e),r$2c(Ee,Ce,!0,we,oz,_e)):r$2c(Ee,Ce,!1,we,oz,_e)}(fe,_e,Te),be.interactionType===DF.TUMBLE&&o$2c(be.selection,IF.ALTITUDE)&&B$A(fe,be.interactionStartCamera,Te),_e.tiltMode===FF.LOOK_AROUND||be.tiltMode===FF.LOOK_AROUND?function L$G(fe,ve,_e,be){switch(be&&(be.requiresTwoSteps=!1),fe.viewingMode){case"global":return function q$B(fe,ve,_e,be){const we=function b$1e(fe,ve,_e){const be=fe.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,we=be+s$45(fe.spatialReference).radius,Se=fe.renderCoordsHelper.intersectManifold(ve.ray,be,sz);return _e.eyeCenterDistance=ve.distance,_e.centerIsOnSurface=!1,null!=Se?(_e.eyeCenterDistance=x$1W(ve.eye,Se),_e.tiltAtCenter=c$2E(fe.renderCoordsHelper,Se,ve.eye),_e.centerIsOnSurface=!0):fe.state.isLocal?_e.tiltAtCenter=c$2E(fe.renderCoordsHelper,ve.center,ve.eye):(J$C(L$15(Ap,we),ve.ray,sz),_e.eyeCenterDistance=x$1W(ve.eye,sz),_e.tiltAtCenter=m$3J(-P$1g(ve.viewForward,z$1d(sz,sz)))),_e.radius=we,_e.eyeRadius=s$4g(ve.eye),_e.constraints=fe.state.constraints,_e}(fe,ve,lz),Se=e$3Y(we.tiltAtCenter,_e.min,_e.max);if(!v$13(we.tiltAtCenter-Se))return 0;let Te,Ee;return we.centerIsOnSurface?(Te=function H$E(fe){const{constraints:ve,eyeCenterDistance:_e,tiltAtCenter:be}=fe;let we=be,Se=ve.clampTilt(_e,be);const Te=E$14(fe,Se);if(ve.clampTilt(Te,be)===Se)return Se;let Ee=0;for(;Ee<10&&v$13(Se-we);){const _e=(we+Se)/2,be=E$14(fe,_e);v$13(ve.clampTilt(be,_e)-_e)?we=_e:Se=_e,Ee++}return Se}(we),Ee=function F$I(fe,ve){const _e=l$4n(fe.radius/fe.eyeRadius*Math.sin(fe.tiltAtCenter)),be=l$4n(fe.radius/fe.eyeRadius*Math.sin(ve));return fe.eyeRadius>fe.radius?_e-be:be-_e}(we,Te)):(Te=we.constraints.clampTilt(we.eyeCenterDistance,we.tiltAtCenter),be&&Te<Math.PI/2&&(be.requiresTwoSteps=!0,Te=Math.PI/2-1e-5),Ee=function N$K(fe,ve){return fe.tiltAtCenter-Math.PI/2-(ve-Math.PI/2)}(we,Te)),be&&(be.eyeCenterDistance=E$14(we,Te)),Ee}(fe,ve,_e,be);case"local":return function g$1r(fe,ve,_e,be){const we=c$2E(fe.renderCoordsHelper,ve.center,ve.eye),Se=e$3Y(we,_e.min,_e.max),Te=we-Se;if(!v$13(Te))return 0;if(be){const _e=fe.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,we=fe.renderCoordsHelper.getAltitude(ve.eye)-_e,Te=Math.cos(Se);Math.abs(Te)>1e-4?be.eyeCenterDistance=we/Te:be.eyeCenterDistance=ve.distance}return Te}(fe,ve,_e,be)}}(fe,ve,Te,we):function P$L(fe,ve,_e){const be=c$2E(fe.renderCoordsHelper,ve.center,ve.eye),we=be-e$3Y(be,_e.min,_e.max);return v$13(we)?we:0}(fe,ve,Te)}function v$13(fe){return Math.abs(fe)>1e-9}function E$14(fe,ve){if(!fe.centerIsOnSurface)return fe.eyeCenterDistance;const _e=Math.PI-e$3Y(ve,0,Math.PI),be=l$4n(fe.radius/fe.eyeRadius*Math.sin(_e)),we=Math.PI-_e-be,Se=Math.sin(we)/Math.sin(_e);if(fe.eyeRadius<fe.radius&&Se>1){const ve=Math.PI-be,we=Math.PI-_e-ve;return Math.sin(we)/Math.sin(_e)*fe.eyeRadius}return Se*fe.eyeRadius}function B$A(fe,ve,_e){const be=fe.state.constraints;if(fe.state.isLocal||!be.altitude||!ve)return;const we=v$22(ve.center),Se=Math.sqrt(we),Te=ve.distance,Ee=s$45(fe.spatialReference).radius,Ce=be.altitude.min+Ee,Oe=be.altitude.max+Ee,Re=(Ce*Ce-Te*Te-we)/(-2*Se*Te),De=(Oe*Oe-Te*Te-we)/(-2*Se*Te);_e.min=Math.max(_e.min,Math.min(Math.PI-m$3J(De),_e.max)),_e.max=Math.min(_e.max,Math.PI-m$3J(Re))}const iz=[0,0,0],nz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sz=[0,0,0],oz=h$2U(5),az={min:0,max:0},lz={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},cz={eyeCenterDistance:0,requiresTwoSteps:!1},u$2h=fe=>fe*fe,o$2b=fe=>1-u$2h(1-fe),n$2N=fe=>fe*fe*fe,c$2D=fe=>1-n$2N(1-fe),a$2A=fe=>fe<.5?n$2N(2*fe)/2:(c$2D(2*(fe-.5))+1)/2,s$2H=fe=>fe*fe*fe*fe,q$A=fe=>1-s$2H(1-fe),e$2u=fe=>fe*fe*fe*fe*fe,b$1d=fe=>1-e$2u(1-fe),h$1F=fe=>1-Math.cos(fe*Math.PI/2),p$2L=fe=>1-h$1F(1-fe),M$S=fe=>2**(10*(fe-1)),f$1X=fe=>1-M$S(1-fe),I$W=fe=>-(Math.sqrt(1-fe*fe)-1),P$K=fe=>1-I$W(1-fe);function j$Z(fe){const ve=2*(fe-Math.sqrt((fe-1)*fe)),_e=ve/2/fe;return be=>be<_e?fe*be*be:ve*be-ve+1}function k$S(fe,ve){return(_e,be)=>_e<ve?ve*fe(_e/ve,be):1-fe((1-_e)/(1-ve),be)*(1-ve)}const uz=k$S(j$Z(1),1),hz=k$S(j$Z(1),0),dz=k$S(j$Z(1),.5),pz=k$S(j$Z(2),1),fz=k$S(j$Z(2),0),mz=k$S(j$Z(2),.5),yz=k$S(j$Z(3),1),gz=k$S(j$Z(3),0),vz=k$S(j$Z(3),.5),_z=k$S(j$Z(4),1),$z=k$S(j$Z(4),0),bz=k$S(j$Z(4),.5),wz={linear:fe=>fe,"in-quad":u$2h,"out-quad":o$2b,"in-out-quad":fe=>fe<.5?u$2h(2*fe)/2:(o$2b(2*(fe-.5))+1)/2,"in-coast-quad":uz,"out-coast-quad":hz,"in-out-coast-quad":dz,"in-cubic":n$2N,"out-cubic":c$2D,"in-out-cubic":a$2A,"in-coast-cubic":pz,"out-coast-cubic":fz,"in-out-coast-cubic":mz,"in-quart":s$2H,"out-quart":q$A,"in-out-quart":fe=>fe<.5?s$2H(2*fe)/2:(q$A(2*(fe-.5))+1)/2,"in-coast-quart":yz,"out-coast-quart":gz,"in-out-coast-quart":vz,"in-quint":e$2u,"out-quint":b$1d,"in-out-quint":fe=>fe<.5?e$2u(2*fe)/2:(b$1d(2*(fe-.5))+1)/2,"in-coast-quint":_z,"out-coast-quint":$z,"in-out-coast-quint":bz,"in-sine":h$1F,"out-sine":p$2L,"in-out-sine":fe=>fe<.5?h$1F(2*fe)/2:(p$2L(2*(fe-.5))+1)/2,"in-expo":M$S,"out-expo":f$1X,"in-out-expo":fe=>fe<.5?M$S(2*fe)/2:(f$1X(2*(fe-.5))+1)/2,"in-circ":I$W,"out-circ":P$K,"in-out-circ":fe=>fe<.5?I$W(2*fe)/2:(P$K(2*(fe-.5))+1)/2};function E$12(fe,ve,_e=Sz,be=ve){be!==ve&&be.copyFrom(ve),be.computeUp(fe.state.viewingMode);let we=!1;for(let Ee=0;Ee<Tz;Ee++){let ve=0;for(const Se of xz)if(o$2c(_e.selection,Se.type)){const Te=Math.abs(Se.error(fe,be,_e));Se.apply(fe,be,_e)&&(we=!0,ve+=Te)}if(0===ve)break}const Se=o$2c(_e.selection,IF.COLLISION),Te=function u$2g(fe,ve){switch(fe){case DF.PAN:return QF.EYE_AND_CENTER;case DF.ASCEND:return ve.state.isGlobal?QF.EYE_AND_CENTER_SCALE:QF.EYE_AND_CENTER;default:return QF.EYE}}(_e.interactionType,fe);return Se&&s$2I(fe,be,Te)&&(we=!0),we&&be.computeUp(fe.state.viewingMode),we}function y$1g(fe){const ve=Math.min(1,fe/150);return a$2A(ve)}const xz=[{type:IF.TILT,error:function T$S(fe,ve,_e){return U$K(fe,ve,_e)*ve.distance},apply:function w$1a(fe,ve,_e,be=!0){cz.eyeCenterDistance=0,cz.requiresTwoSteps=!1;const we=U$K(fe,ve,_e,kF,cz);if(0===we)return!1;switch(p$4z(nz,-we,ve.viewRight),_e.tiltMode){case FF.LOOK_AROUND:O$1v(iz,ve.viewForward,nz),g$2z(iz,iz,cz.eyeCenterDistance),ve.center=u$3Y(sz,ve.eye,iz);break;case FF.TUMBLE:e$3Z(iz,ve.center,ve.eye),O$1v(iz,iz,nz),ve.eye=e$3Z(sz,ve.center,iz);break;default:_e.tiltMode}return ve.up=O$1v(sz,ve.up,nz),!cz.requiresTwoSteps||!be||w$1a(fe,ve,_e,!1)}},{type:IF.ALTITUDE,error:p$2M,apply:function l$2J(fe,ve,_e=kF){const be=p$2M(fe,ve,_e);if(0===be)return!1;const we=fe.renderCoordsHelper,Se=we.getAltitude(ve.eye)+be,Te=x$12(ve,_e.interactionDirection,function j$$(fe,ve,_e,be){return fe.renderCoordsHelper.worldUpAtPosition(ve.eye,be),g$2z(be,be,_e),be}(fe,ve,Math.sign(be),jF),BF),Ee=r$3w(GF,ve.viewForward),Ce=we.intersectInfiniteManifold(l$3V(ve.eye,Te),Se,HF);return ve.eye=null!=Ce?Ce:we.setAltitude(HF,Se,ve.eye),ve.center=function j$10(fe,ve,_e,be){return u$3Y(fe,ve,g$2z(fe,_e,P$1g(_e,e$3Z(fe,be,ve))))}(HF,ve.eye,Ee,ve.center),!0}},{type:IF.DISTANCE,error:d$1T,apply:function y$1i(fe,ve,_e=kF){const be=d$1T(fe,ve,_e);if(0===be)return!1;const we=fe.pointsOfInterest.surfaceOrigin;if(!we.renderLocation)return!1;const Se=O$R(fe,ve)+be,Te=r$3w(WF,ve.eye),Ee=x$12(ve,_e.interactionDirection,function g$1s(fe,ve,_e){return J$M(_e,fe.eye,ve)}(ve,we.renderLocation,XF),ZF);if(!X$t(k$1i(we.renderLocation,Se),l$3V(ve.eye,Ee),JF))return!1;ve.eye=JF;const Ce=e$3Z(YF,ve.eye,Te);ve.center=u$3Y(JF,ve.center,Ce);const Oe=fe.renderCoordsHelper.getAltitude(ve.center),Re=fe.renderCoordsHelper.intersectInfiniteManifold(ve.ray,Oe,JF);return null!=Re&&(ve.center=Re),!0}}],Sz=new zF,Tz=5;let Ez=class P3{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(fe){this.viewingMode=fe,this.center=[0,0,0],this._pitch=0,this._yaw=0,this._distance=0,this.direction=t$47(Lz),this._fov=55,this._size=1}pixelsPerPanAtZoom(fe){return this._size/2/(this._zoomToPanScale*fe)}zoomAtPixelsPerPan(fe){return this._size/2/(this._zoomToPanScale*fe)}pixelsPerRotateAtZoom(){const fe=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/fe}compareTo(fe,ve){if(this.viewingMode===Wf.Global){const _e=(s$4g(this.center)+s$4g(fe.center))/2;ve.pan=v$1O(this.center,fe.center)*_e}else ve.pan=x$1W(this.center,fe.center);let _e=Math.abs(fe._yaw-this._yaw);_e>=Math.PI&&(_e=2*Math.PI-_e);const be=Math.abs(fe._pitch-this._pitch);ve.rotate=Math.max(_e,be),ve.fov=fe.fov-this.fov,ve.sourceZoom=this._distance,ve.targetZoom=fe._distance}interpolate(fe,ve,_e){this.viewingMode===Wf.Global?q$V(fe.center,ve.center,_e.pan,this.center):A$1G(this.center,fe.center,ve.center,_e.pan),this._distance=isFinite(ve.distance)?f$3i(fe.distance,ve.distance+_e.zoomOffset,_e.zoom):fe.distance,this._pitch=f$3i(fe.pitch,ve.pitch,_e.rotate);let be=fe._yaw;const we=ve._yaw;Math.abs(we-be)>=Math.PI&&(be+=2*(be<we?1:-1)*Math.PI),this._yaw=f$3i(be,we,_e.rotate),this._fov=f$3i(fe.fov,ve.fov,_e.fov)}copyFrom(fe){r$3w(this.center,fe.center),this._pitch=fe.pitch,this._yaw=fe.yaw,this._distance=fe.distance,r$3w(this.direction,fe.direction),this._size=fe.size,this._fov=fe.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=fe.viewingMode}copyFromRenderCamera(fe){const ve=this._lookAtOrientation(fe.center,Nz);r$3w(this.center,fe.center),e$3Z(Az,fe.center,fe.eye),S$1P(Az,Az,ve),S$1P(Mz,fe.up,ve),this._distance=s$4g(Az),0!==this._distance&&(Az[0]/=this._distance,Az[1]/=this._distance,Az[2]/=this._distance),this._pitch=this._eyeUpToPitch(Az),this._yaw=function z$E(fe,ve){const _e=Rz;return Math.abs(ve[2])<.5?(r$3w(_e,ve),fe[2]>0&&g$2z(_e,_e,-1)):r$3w(_e,fe),_$1z(Cz,_e,Iz),z$1d(Cz,Cz),v$1O(Dz,Cz,Iz)}(Az,Mz),this._size=Math.sqrt(fe.width*fe.width+fe.height*fe.height),this._fov=fe.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(fe){const ve=this._lookAtOrientation(this.center,Nz);u$3n(ve,ve),this._axisAngleVec3(Dz,this._pitch-Math.PI/2,Lz,Az),this._axisAngleVec3(Iz,this._yaw,Az,Az),this._axisAngleVec3(Dz,this._pitch-Math.PI/2,Iz,Mz),this._axisAngleVec3(Iz,this._yaw,Mz,Mz),g$2z(Az,Az,this._distance),S$1P(Az,Az,ve),S$1P(Mz,Mz,ve),fe.center=this.center,fe.eye=e$3Z(Az,this.center,Az),fe.up=Mz,fe.fov=this._fov}_axisAngleVec3(fe,ve,_e,be){const we=Math.cos(ve),Se=Math.sin(ve);return g$2z(Pz,_e,we),_$1z(Cz,fe,_e),g$2z(Cz,Cz,Se),g$2z(Oz,fe,(1-we)*P$1g(fe,_e)),u$3Y(be,u$3Y(be,Pz,Cz),Oz)}_lookAtOrientation(fe,ve=[1,0,0,0,1,0,0,0,1]){return this._upAtLookAt(fe,Oz),_$1z(Pz,this.direction,Oz),z$1d(Pz,Pz),0===Pz[0]&&0===Pz[1]&&0===Pz[2]&&r$3w(Pz,Dz),_$1z(Cz,Oz,Pz),z$1d(Cz,Cz),ve[0]=Pz[0],ve[1]=Cz[0],ve[2]=Oz[0],ve[3]=Pz[1],ve[4]=Cz[1],ve[5]=Oz[1],ve[6]=Pz[2],ve[7]=Cz[2],ve[8]=Oz[2],ve}_upAtLookAt(fe,ve){return this.viewingMode===Wf.Local?r$3w(ve,Iz):z$1d(ve,fe)}_eyeUpToPitch(fe){return Math.PI-v$1O(Iz,fe)}};const Pz=[0,0,0],Cz=[0,0,0],Oz=[0,0,0],Az=[0,0,0],Mz=[0,0,0],Rz=[0,0,0],Iz=qi,Lz=Hi,Dz=Gi,Nz=[1,0,0,0,1,0,0,0,1];let Fz=class t28{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const zz=2,kz=500,Uz=8e3;let Vz=class s27{constructor(fe){this._createCamera=fe,this.compared=new Fz,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:zz},this.source=fe(),this.target=fe()}clone(){const fe=new s27(this._createCamera);return fe.copyFrom(this),fe}copyFrom(fe){this.update(fe.source,fe.target,fe.settings)}update(fe,ve,_e){this.source!==fe&&this.source.copyFrom(fe),this.target!==ve&&this.target.copyFrom(ve),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=_e.desiredScreenFlow?_e.desiredScreenFlow:zz,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(fe){const ve=this.target.pixelsPerPanAtZoom(fe);return this.halfWindowSize/ve}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>e$3_()}get hasFov(){return Math.abs(this.compared.fov)>e$3_()}get hasRotate(){return this.compared.rotate>e$3_()}},Bz=class e20{constructor(){this.segments=new Array}get time(){return this.segments.reduce(((fe,ve)=>fe+ve.time),0)}interpolateComponentsAt(fe,ve){fe=Math.min(Math.max(fe,0),1),fe*=this.time;let _e=0,be=0;const we=this.definition,Se=this.segments.reduce(((fe,ve)=>fe||ve.definition.hasZoom),!1);for(let Te=0;Te<this.segments.length;Te++){const Ee=this.segments[Te],Ce=Ee.definition;if(fe<=Ee.time||Te===this.segments.length-1){if(this.segmentInterpolateComponentsAt(Ee,0===Ee.time?0:fe/Ee.time,ve),we.hasPan&&!isNaN(ve.pan)&&isFinite(we.compared.pan)?ve.pan=(_e+Ce.compared.pan*ve.pan)/we.compared.pan:ve.pan=1,we.hasRotate&&!isNaN(ve.rotate)&&isFinite(we.compared.rotate)?ve.rotate=(be+Ce.compared.rotate*ve.rotate)/we.compared.rotate:ve.rotate=1,Se&&!isNaN(ve.zoom)&&isFinite(Ce.compared.targetZoom)){const{sourceZoom:fe,targetZoom:_e}=Ce.compared,be=ve.zoom*(_e-fe)+fe,we=this.segments[0].definition.compared.sourceZoom,Se=this.segments[this.segments.length-1].definition.compared.targetZoom,Te=Math.abs(_e-we)>Math.abs(fe-we)?_e:fe;ve.zoomOffset=Te-Se,ve.zoom=(be-we)/(Te-we)}else ve.zoom=1;return ve}fe-=Ee.time,_e+=Ce.compared.pan,be+=Ce.compared.rotate}}segmentInterpolateComponentsAt(fe,ve,_e){fe.interpolateComponentsAt(ve,_e)}},jz=class o16{get time(){return this._time}constructor(fe){fe&&this.update(fe)}update(fe){fe&&(this.definition?this.definition.copyFrom(fe):this.definition=fe.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const fe=this.definition,ve=fe.compared,_e=ve.sourceZoom,be=ve.targetZoom;this._zoomSign=_e>be?1:-1,this._panPixelsAtSource=ve.pan*fe.source.pixelsPerPanAtZoom(_e);const we=(fe.source.pixelsPerRotateAtZoom(_e)+fe.target.pixelsPerRotateAtZoom(be))/2;this._rotatePixels=ve.rotate*we}_updatePixelFlow(){const fe=this.definition.compared.sourceZoom,ve=this.definition.compared.targetZoom,{hasZoom:_e,hasPan:be,hasRotate:we}=this.definition;let Se=0,Te=0;_e&&(be&&(Se=(ve/fe-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),we&&(Te=this._zoomSign*(Math.log(fe/ve)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const Ee=this.definition.desiredPixelFlow;if(_e&&be&&we){const fe=Se+Te+Se*Te;this._zoomPixelFlow=Se*Te/fe*Ee,this._panPixelFlow=Te/fe*Ee,this._rotatePixelFlow=Se/fe*Ee}else if(_e&&be){const fe=1+Se;this._zoomPixelFlow=Se/fe*Ee,this._panPixelFlow=1/fe*Ee}else if(_e&&we){const fe=1+Te;this._zoomPixelFlow=Te/fe*Ee,this._rotatePixelFlow=1/fe*Ee}else if(be&&we){const fe=this._panPixelsAtSource/this._rotatePixels,ve=1+fe;this._panPixelFlow=fe/ve*Ee,this._rotatePixelFlow=1/ve*Ee}else be?this._panPixelFlow=Ee:_e?this._zoomPixelFlow=Ee:we&&(this._rotatePixelFlow=Ee);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/Gz:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const fe=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,ve=fe*this._panPixelsAtSource;return Math.log(ve*(this._zoomPixelFlow/this._panPixelFlow)+1)/(fe*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(fe){if(0===fe||1===fe)return fe;if(this.definition.hasZoom){const ve=this.definition.compared.sourceZoom,_e=this.definition.compared.targetZoom;return(ve*(ve/_e)**-fe-ve)/(_e-ve)}return fe}_interpolateComponentsFov(fe){if(0===fe)return this.definition.segmentStart;if(1===fe)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:ve,segmentEnd:_e}=this.definition;return ve+fe*(_e-ve)}return this.definition.segmentStart}_interpolateComponentsPan(fe){if(0===fe||1===fe)return fe;if(this.definition.hasPan&&this.definition.hasZoom){const ve=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(ve*fe*this._time)-1))/(ve*Math.LN2)}return fe}_interpolateComponentsRotate(fe){return fe}interpolateComponentsAt(fe,ve){fe=Math.min(Math.max(fe,0),1),ve.zoom=this._interpolateComponentsZoom(fe),ve.pan=this._interpolateComponentsPan(fe),ve.rotate=this._interpolateComponentsRotate(fe),ve.zoomOffset=0,ve.fov=this._interpolateComponentsFov(fe)}};const Gz=h$2U(90);function o$28(fe,ve,_e){const be=ve-fe.compared.sourceZoom,we=fe.halfWindowPanAtZoom(be);return-fe.halfWindowSize*(_e.ascensionFactor*Math.LN2*fe.compared.pan+we)*Math.log(fe.compared.sourceZoom/ve)/(fe.desiredPixelFlow*Math.LN2*we)}function e$2r(fe,ve,_e){const be=1/ve,we=Math.log(fe.compared.sourceZoom*be),Se=1/fe.desiredPixelFlow,Te=1/Math.LN2,Ee=ve-fe.compared.sourceZoom,Ce=1/Ee,Oe=(_e.ascensionFactor*Math.LN2*fe.compared.pan+fe.halfWindowPanAtZoom(Ee))/fe.halfWindowPanAtZoom(1);return fe.halfWindowSize*be*Se*Te*Ce*Oe-fe.halfWindowSize*we*Se*Te*Ce+fe.halfWindowSize*we*Se*Te*Oe/(Ee*Ee)}function a$2z(fe,ve,_e){const be=ve-fe.compared.sourceZoom,we=1/be,Se=1/ve,Te=Math.log(fe.compared.sourceZoom*Se),Ee=(_e.ascensionFactor*Math.LN2*fe.compared.pan+fe.halfWindowPanAtZoom(be))/fe.halfWindowPanAtZoom(1);return fe.halfWindowSize*we*(-2*we*Se*Ee+2*we*Te+2*Se-2*Te*Ee/(be*be)-Ee/(ve*ve))/(fe.desiredPixelFlow*Math.LN2)}function n$2M(fe,ve){return-fe.halfWindowSize*Math.log(fe.compared.sourceZoom/ve)/(fe.desiredPixelFlow*Math.LN2)}function t$2y(fe,ve){return fe.halfWindowSize/(ve*fe.desiredPixelFlow*Math.LN2)}function i$2y(fe,ve){return-fe.halfWindowSize/(ve*ve*fe.desiredPixelFlow*Math.LN2)}function l$2F(fe,ve,_e){return fe.halfWindowSize*(-fe.halfWindowPanAtZoom(ve)-_e.descensionFactor*Math.LN2*fe.compared.pan+fe.halfWindowPanAtZoom(fe.compared.targetZoom))*Math.log(ve/fe.compared.targetZoom)/(fe.desiredPixelFlow*Math.LN2*fe.halfWindowPanAtZoom(-ve+fe.compared.targetZoom))}function m$27(fe,ve,_e){const be=Math.log(ve/fe.compared.targetZoom),we=1/fe.desiredPixelFlow,Se=1/Math.LN2,Te=-ve+fe.compared.targetZoom,Ee=1/Te,Ce=(-fe.halfWindowPanAtZoom(ve)-_e.descensionFactor*Math.LN2*fe.compared.pan+fe.halfWindowPanAtZoom(fe.compared.targetZoom))/fe.halfWindowPanAtZoom(1);return-fe.halfWindowSize*be*we*Se*Ee+fe.halfWindowSize*be*we*Se*Ce/(Te*Te)+fe.halfWindowSize*we*Se*Ee*Ce/ve}function h$1E(fe,ve,_e){const be=ve-fe.compared.targetZoom,we=1/be,Se=1/ve,Te=Math.log(ve/fe.compared.targetZoom),Ee=(fe.halfWindowPanAtZoom(ve)+_e.descensionFactor*Math.LN2*fe.compared.pan-fe.halfWindowPanAtZoom(fe.compared.targetZoom))/fe.halfWindowPanAtZoom(1);return fe.halfWindowSize*we*(-2*we*Se*Ee-2*we*Te+2*Se+2*Te*Ee/(be*be)-Ee/(ve*ve))/(fe.desiredPixelFlow*Math.LN2)}function s$2F(fe,ve){return fe.halfWindowSize*Math.log(ve/fe.compared.targetZoom)/(fe.desiredPixelFlow*Math.LN2)}function f$1W(fe,ve){return fe.halfWindowSize/(ve*fe.desiredPixelFlow*Math.LN2)}function w$18(fe,ve){return-fe.halfWindowSize/(ve*ve*fe.desiredPixelFlow*Math.LN2)}function f$1V(fe,ve){let _e=function D$I(fe,ve){const _e=Math.max(fe.compared.sourceZoom,fe.compared.targetZoom),be=fe.source.zoomAtPixelsPerPan(fe.desiredPixelFlow/fe.compared.pan)/2;return be<_e?null!=ve.maximumDistance?_e+(ve.maximumDistance-_e)/2:1.5*_e:ve.maximumDistance?Math.min(ve.maximumDistance,be):be}(fe,ve);const be={ascensionFactor:null!=ve.ascensionFactor?ve.ascensionFactor:.5,descensionFactor:null!=ve.descensionFactor?ve.descensionFactor:.5},we=0===be.ascensionFactor,Se=0===be.descensionFactor,Te=we?n$2M:o$28,Ee=we?t$2y:e$2r,Ce=we?i$2y:a$2z,Oe=Se?s$2F:l$2F,Re=Se?f$1W:m$27,De=Se?w$18:h$1E,A16=ve=>Te(fe,ve,be)+function r$2a(fe,ve,_e){return-fe.compared.pan*fe.halfWindowSize*(_e.ascensionFactor+_e.descensionFactor-1)/(fe.desiredPixelFlow*fe.halfWindowPanAtZoom(ve))}(fe,ve,be)+Oe(fe,ve,be),I12=ve=>Ee(fe,ve,be)+function d$1R(fe,ve,_e){return fe.compared.pan*fe.halfWindowSize*(_e.ascensionFactor+_e.descensionFactor-1)/(fe.desiredPixelFlow*fe.halfWindowPanAtZoom(ve*ve))}(fe,ve,be)+Re(fe,ve,be),S14=ve=>Ce(fe,ve,be)+function c$2C(fe,ve,_e){return-2*fe.compared.pan*fe.halfWindowSize*(_e.ascensionFactor+_e.descensionFactor-1)/(fe.desiredPixelFlow*fe.halfWindowPanAtZoom(ve*ve*ve))}(fe,ve,be)+De(fe,ve,be);let Be=A16(_e);const Ze=function p$2K(fe){const ve=fe.compared.sourceZoom-fe.compared.targetZoom;if(0===ve)return fe.compared.pan*fe.halfWindowSize/(fe.desiredPixelFlow*fe.halfWindowPanAtZoom(fe.compared.sourceZoom));const _e=Math.LN2*fe.compared.pan,be=ve,we=fe.halfWindowPanAtZoom(be),Se=fe.halfWindowSize*Math.log(fe.compared.sourceZoom/fe.compared.targetZoom)/(fe.desiredPixelFlow*Math.LN2*we);return fe.compared.sourceZoom<=fe.compared.targetZoom?Se*(_e-we):Se*(_e+we)}(fe);let Xe;const Je=ve.maximumIterations||20,Qe=null!=ve.maximumDistance?ve.maximumDistance:1/0;for(Xe=0;Xe<Je;Xe++){const be=ve.desiredSlope??1e-6;let we=I12(_e);Math.abs(we)>be&&(we+=be);const Se=we/S14(_e);if(isNaN(Se)||_e>=Qe&&Se<0){if(!isFinite(Qe))return null;_e=Qe,Be=A16(_e);break}if(_e-=Se,_e<fe.compared.sourceZoom||_e<fe.compared.targetZoom)return null;const Te=A16(_e);if(Math.abs(Te-Be)/Be<=.005)break;Be=Te}return Be>.7*Ze||_e<fe.compared.sourceZoom||_e<fe.compared.targetZoom?null:_e}let Hz=class s28 extends Bz{constructor(fe,ve){super(),this._preallocSegments=[new jz,new jz,new jz],this._ascensionSegment=null,this._descensionSegment=null,this.update(fe,ve)}update(fe,ve){if(!fe)return;this.definition?this.definition.copyFrom(fe):this.definition=fe.clone();const _e=(null==ve?void 0:ve.apex)?f$1V(fe,ve.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,_e?this._updateWithApex(_e,null==ve?void 0:ve.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(fe,ve,_e){fe.interpolateComponentsAt(ve,_e),fe===this._ascensionSegment?_e.zoom=o$2b(_e.zoom):fe===this._descensionSegment&&(_e.zoom=u$2h(_e.zoom))}_updateWithApex(fe,ve){const[_e,be,we]=this._preallocSegments,Se=(null==ve?void 0:ve.ascensionFactor)??.5,Te=Math.min(1-Se,null!=(null==ve?void 0:ve.ascensionFactor)&&null!=ve.descensionFactor?ve.descensionFactor:.5),Ee=1-Se-Te;_e.definition?_e.definition.copyFrom(this.definition):_e.definition=this.definition.clone(),_e.definition.compared.targetZoom=fe,_e.definition.compared.pan=this.definition.compared.pan*Se,_e.definition.compared.rotate=this.definition.compared.rotate*Se,_e.definition.segmentEnd=Se,_e.update(),this._ascensionSegment=_e,this.segments.push(_e),Ee>0&&(be.definition?be.definition.copyFrom(this.definition):be.definition=this.definition.clone(),be.definition.copyFrom(this.definition),be.definition.compared.sourceZoom=fe,be.definition.compared.targetZoom=fe,be.definition.compared.pan=this.definition.compared.pan*Ee,be.definition.compared.rotate=this.definition.compared.rotate*Ee,be.definition.segmentStart=_e.definition.segmentEnd,be.definition.segmentEnd=_e.definition.segmentEnd+Ee,be.update(),this.segments.push(be)),we.definition?we.definition.copyFrom(this.definition):we.definition=this.definition.clone(),we.definition.compared.sourceZoom=fe,we.definition.compared.pan=this.definition.compared.pan*Te,we.definition.compared.rotate=this.definition.compared.rotate*Te,we.definition.segmentStart=Se+Ee,we.update(),this._descensionSegment=we,this.segments.push(we)}_updateWithoutApex(){const[fe]=this._preallocSegments;fe.update(this.definition),this.segments.push(fe)}};const qz=new class t29{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};let Wz=class p19{get time(){return this._time}get isLinear(){return 1===this.path.segments.length}constructor(fe){this._time=0,this._easing=dz,this.definition=new Vz(fe),this.path=new Hz}update(fe,ve,_e){this.definition.update(fe,ve,_e),this.path.update(this.definition,_e),this._time=this._applyTimeSettings(r$3D(isFinite(this.path.time)?this.path.time:0),_e),this._easing=_e.easing??(this._time>=1e3?dz:f$1X)}cameraAt(fe,ve){fe=Math.min(Math.max(0,fe),1),fe=this._normalizedEasing(fe);const _e=this.path.interpolateComponentsAt(fe,qz);ve.interpolate(this.definition.source,this.definition.target,_e)}_normalizedEasing(fe){const ve=this._easing(0,this._time),_e=this._easing(1,this._time);return(this._easing(fe,this._time)-ve)/(_e-ve)}_applyTimeSettings(fe,ve){const _e=null!=ve.speedFactor?ve.speedFactor:1,be=ve.minDuration??kz/_e,we=ve.maxDuration??Uz/_e;return null!=ve.duration?ve.duration:Math.min(Math.max(fe/_e,be),we)}},Yz=class c20{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(fe){this.currentTime=0,this._animation=new Wz((()=>new Ez(fe))),this._current=new Ez(fe)}update(fe,ve,_e){const{source:be,target:we}=this._animation.definition,Se=e$3Z(Zz,ve.center,fe.center),Te=s$4g(Se);Te>=1e-5?(Se[0]/=Te,Se[1]/=Te,Se[2]/=Te):(Se[0]=0,Se[1]=1,Se[0]=0),r$3w(be.direction,Se),r$3w(we.direction,Se),be.copyFromRenderCamera(fe),we.copyFromRenderCamera(ve),this._current.copyFrom(be),this._animation.update(be,we,_e),this.currentTime=0,fe.almostEquals(ve)&&(this.currentTime=this._animation.time)}cameraAt(fe,ve){return this._animation.cameraAt(fe,this._current),ve=ve||new NR,this._current.copyToRenderCamera(ve),ve}step(fe,ve){return this.finished||(this.currentTime=this.currentTime+r$3D(fe),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,ve)}};const Zz=[0,0,0];var Xz;!function(fe){fe[fe.Ready=0]="Ready",fe[fe.Rejected=1]="Rejected",fe[fe.Running=2]="Running",fe[fe.Stopped=3]="Stopped",fe[fe.Finished=4]="Finished"}(Xz||(Xz={}));let Jz=class n13 extends zi{constructor(fe){super(fe),this.state=Xz.Ready}get active(){return this.state===Xz.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Xz.Stopped,!0)}finishController(){this.state=Xz.Finished}get steppingFinished(){return!1}};e$4o([y$2v({constructOnly:!0})],Jz.prototype,"view",void 0),e$4o([y$2v({readOnly:!0})],Jz.prototype,"active",null),e$4o([y$2v()],Jz.prototype,"state",void 0),e$4o([y$2v({readOnly:!0})],Jz.prototype,"isInteractive",null),Jz=e$4o([a$4y("esri.views.3d.state.controllers.CameraController")],Jz);let Qz=class a10 extends Jz{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(fe){this._asyncResult&&(this._asyncResult.reject(u$47()),this._asyncResult=null),this.state===Xz.Finished||this.state===Xz.Stopped?(n$4O(fe),this.state===Xz.Finished?fe.resolve():fe.reject(u$47())):this._asyncResult=fe}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Xz.Running,null!=this.viewAnimation&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()))}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==Xz.Ready&&this.state!==Xz.Running||(this.viewAnimation.state===PP.State.FINISHED?this.finish():this.viewAnimation.state===PP.State.STOPPED&&(this.state=Xz.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===Xz.Finished?this.viewAnimation.finish():this.state===Xz.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Xz.Finished?this._asyncResult.resolve():this._asyncResult.reject(u$47()))}finish(){this.finishController()}};Qz=e$4o([a$4y("esri.views.3d.state.controllers.AnimationController")],Qz);let Kz=class h8 extends Qz{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(fe){super(fe),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Yz(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new PP}get isInteractive(){return"interaction"===this.mode}begin(fe,ve){this._hasTarget=!0;const _e=this.animationSettings(ve);ek.copyFrom(this.view.state.camera);const be=T$15(this.view.state.viewingMode);this.intersectionHelper.intersectRay(ek.ray,be,tk)&&(ek.center=tk),this.animation.update(ek,fe,_e),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(fe,ve){this._hasTarget&&this.animation.step(fe,ve)}onControllerEnd(fe){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,fe),this.animation.currentTime=this.animation.time),super.onControllerEnd(fe)}animationSettings(fe={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...fe,easing:"string"==typeof fe.easing?wz[fe.easing]:fe.easing}}};e$4o([y$2v({constructOnly:!0})],Kz.prototype,"mode",void 0),e$4o([y$2v({readOnly:!0})],Kz.prototype,"isInteractive",null),Kz=e$4o([a$4y("esri.views.3d.state.controllers.PointToPointAnimationController")],Kz);const ek=new NR,tk=[0,0,0];function s$2C(fe=rk){return[fe[0],fe[1],fe[2],fe[3]]}function m$26(fe,ve){return function g$1p(fe,ve,_e,be,we=s$2C()){return we[0]=fe,we[1]=ve,we[2]=_e,we[3]=be,we}(fe[0],fe[1],fe[2],ve,Cd.get())}function l$2D(fe,ve,_e){return _$1z(_e,fe,ve),z$1d(_e,_e),_e[3]=f$2J(fe,ve),_e}const rk=[0,0,1,0];function m$25(fe,ve,_e=m$3f()){return g$1o(fe,d$3c(ve),_e),z$1d(_e.direction,_e.direction),_e}function g$1o(fe,ve,_e){return l$2C(fe,fe.screenToRender(ve,Pd.get()),_e)}function l$2C(fe,ve,_e){const be=r$2C(Pd.get(),ve);if(be[2]=0,!fe.unprojectFromRenderScreen(be,_e.origin))return null;const we=r$2C(Pd.get(),ve);we[2]=1;const Se=fe.unprojectFromRenderScreen(we,Pd.get());return null==Se?null:(e$3Z(_e.direction,Se,_e.origin),_e)}function p$2H(fe,ve,_e){return f$1U(fe,fe.screenToRender(ve,Pd.get()),_e)}function f$1U(fe,ve,_e){r$3w(_e.origin,fe.eye);const be=o$44(Pd.get(),ve[0],ve[1],1),we=fe.unprojectFromRenderScreen(be,Pd.get());return null==we?null:(e$3Z(_e.direction,we,_e.origin),_e)}function s$2B(fe,ve,_e,be){return X$t(fe,p$2H(ve,_e,ik),be)}const ik=m$3f();var nk;!function(fe){fe[fe.Ellipsoid=0]="Ellipsoid",fe[fe.Silhouette=1]="Silhouette"}(nk||(nk={}));const sk=[1,3e8],ak=1508e5,lk={exclude:new Set([Ny])};function it$a(fe,ve,_e){return _e[0]=ve[0]/(fe.fullWidth/fe.pixelRatio),_e[1]=ve[1]/(fe.fullHeight/fe.pixelRatio),_e}function st$c(fe){for(;fe>Math.PI;)fe-=2*Math.PI;for(;fe<-Math.PI;)fe+=2*Math.PI;return fe}function ct$8(fe,ve,_e){const be=p$4z(Od.get(),_e[3],_e);null==be||B$11(be,dd)||(e$3Z(Ik,fe.eye,ve),O$1v(Ik,Ik,be),fe.eye=u$3Y(Ik,Ik,ve),e$3Z(Ik,fe.center,ve),O$1v(Ik,Ik,be),fe.center=u$3Y(Ik,Ik,ve),fe.up=O$1v(Ik,fe.up,be))}function mt$6(fe,ve,_e,be){return S$1E(fe,p$2H(ve,_e,zk),be)}function ut$8(fe,ve,_e,be){const we=Pd.get();let Se=1-_e;e$3Z(we,ve,fe.eye);const Te=s$4g(we);let Ee=Te*(1-Se);Se>=0&&Ee<be&&(Ee=be,Se=-(Ee-Te)/Te),Math.abs(Te-Ee)<1e-6||(g$2z(we,we,Se),fe.eye=u$3Y(Ik,fe.eye,we),fe.center=A$1G(Ik,fe.center,ve,Se))}function ft$7(fe,ve,_e){ve.getScreenCenter(ck),s$2B(fe,ve,ck,Ik)&&(ve.center=Ik);const be=ve.distance,we=be*_e;if(Math.abs(be-we)<1e-6)return;const Se=g$2z(Pd.get(),ve.viewForward,we);ve.eye=e$3Z(Ik,ve.center,Se)}const ck=i$4i();function ht$9(fe,ve){o$44(ve,0,0,0);for(const _e of fe)u$3Y(ve,ve,_e);g$2z(ve,ve,1/fe.length)}function Mt$5(fe,ve,_e,be){return Math.sin(fe/s$4g(ve))*(_e+be.radius)}function gt$8(fe,ve,_e,be){return Mt$5(Math.PI/2,ve,_e,be)+(fe-Math.PI/2)}var uk;!function(fe){fe[fe.Vertical=0]="Vertical",fe[fe.Horizontal=1]="Horizontal"}(uk||(uk={}));const hk={Elevation:3e4,Angle:h$2U(16)},dk={Pole:.95,Angle:h$2U(18),Tilt:45},pk=h$2U(80);function jt$4(fe,ve,_e,be,we,Se){const Te=[0,0,0],Ee=[0,0,0,0];let Ce=!0,Oe=!0;return fe.intersectScreen(_e,Te,Se)?Ee[3]=s$4g(Te):(Oe=!1,ve.aboveGround&&we!==nk.Ellipsoid?Ee[3]=Math.max(s$4g(ve.center),.9*be.radius):Ee[3]=s$4g(ve.eye)-ve.relativeElevation,we===nk.Silhouette?wt$5(Ee,ve,_e,Te):Ce=s$2B(Ee,ve,_e,Te)),{sphere:Ee,scenePickPoint:Ce?Te:null,hasGeometryIntersection:Oe}}function vt$2(fe,ve,_e,be){const we=fe.relativeElevation;if(we>hk.Elevation&&"global"===be)return uk.Horizontal;p$2H(fe,ve,kk);return-Math.sign(we)*P$1g(_e.worldUpAtPosition(fe.eye,Ik),kk.direction)<Math.sin(hk.Angle)*s$4g(kk.direction)?uk.Vertical:uk.Horizontal}function zt$2(fe,ve,_e){e$3Z(fk,_e,ve),fe.eye=e$3Z(Ik,fe.eye,fk),fe.center=e$3Z(Ik,fe.center,fk)}const fk=[0,0,0];function wt$5(fe,ve,_e,be){const we=p$2H(ve,_e,zk);return!(null==we||(J$C(fe,we,mk),X$t(fe,we,be)?p$4Z(mk,we.origin)<p$4Z(be,we.origin)&&(r$3w(be,mk),1):(e$3Z(yk,ve.eye,ve.center),z$1d(yk,yk),_$1k(yk,-P$1g(z$1d(yk,yk),mk),gk),S$1E(gk,we,be),1)))}const mk=[0,0,0],yk=[0,0,0],gk=E$1z();function Et$3(fe,ve,_e,be,we,Se){let Te=0;if(_$1z(Nk,fe,ve),e$3Z(Lk,fe,ve),s$4g(fe)<=we||!be.aboveGround){_$1z(_e,Lk,be.eye);const Ee=P$1g(fe,ve)/(s$4g(fe)*s$4g(ve));if(Ee<.9999)Te=m$3J(Ee);else{Te=l$4n(s$4g(_$1z([0,0,0],fe,ve))/(s$4g(fe)*s$4g(ve)))}const Ce=Math.cos(e$3Y(wn.normalize(h$2U(Se)),0,pk));Te=-Te-Math.max(0,s$4g(ve)-we)/(Ce*we)}else e$3Z(vk,be.eye,be.center),_$1z(_e,Lk,vk),Te=-s$4g(Lk)/we;return z$1d(_e,_e),g$2z(_e,_e,s$4g(Nk)),Te}const vk=[0,0,0];function Ut$1(fe,ve,_e,be){let we,Se;const Te=Math.cos(e$3Y(wn.normalize(h$2U(be)),0,pk));return we=ve>_e?-(ve-_e)/(Te*_e):ve<-_e?Math.PI-(ve+_e)/(Te*_e):m$3J(ve/_e),Se=fe>_e?-(fe-_e)/(Te*_e):fe<-_e?Math.PI-(fe+_e)/(Te*_e):m$3J(fe/_e),(Se-we)*_e}function Gt$3(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){_$1z(Nk,fe,ve),w$1H(Se.up,Se.eye,wk,xk,Sk),w$1H([0,0,1],Se.eye,_k,$k,bk),r$3w(_e,$k),r$3w(be,_k),z$1d(_e,_e),g$2z(_e,_e,s$4g(Nk)),q$S(fe,z$1d(xk,xk),z$1d(Sk,Sk),z$1d(wk,wk),Tk),q$S(ve,xk,Sk,wk,Ek),function Ht$1(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){const Re=Ut$1(fe[2],ve[2],Se[3],Ee),De=Ce?Ut$1(fe[0],ve[0],Se[3],180):ve[0]-fe[0],Be=Math.sin(Te)*De-Math.cos(Te)*Re,Ze=Math.cos(Te)*De+Math.sin(Te)*Re;z$1d(Ik,we),o$2R(Oe,Ce?Be/Math.sqrt(Math.abs(Se[3]**2-P$1g(_e,Ik)**2)):Be/Se[3],Ze/Math.sqrt(Math.abs(Se[3]**2-P$1g(_e,be)**2)))}(Tk,Ek,fe,_k,$k,Te,Ee,Ce,Oe,we)}function Rt$2(fe,ve,_e,be,we,Se,Te){p$4z(Ok,we,be),p$4z(Ak,Te,Se),c$4k(Mk,Ok,Ak),e$3Z(ve,fe,_e),O$1v(ve,ve,Mk),u$3Y(ve,ve,_e)}function qt$2(fe,ve,_e,be,we,Se){p$4z(Ok,be,_e),p$4z(Ak,Se,we),c$4k(Mk,Ok,Ak),e$3Z(Ik,fe.eye,ve),O$1v(Ik,Ik,Mk),fe.eye=u$3Y(Ik,Ik,ve),e$3Z(Ik,fe.center,ve),O$1v(Ik,Ik,Mk),fe.center=u$3Y(Ik,Ik,ve),e$3Z(Ik,fe.up,ve),O$1v(Ik,Ik,Mk),fe.up=u$3Y(Ik,Ik,ve)}function Ct$4(fe,ve,_e,be,we,Se){return(Math.abs(be)>Math.PI-dk.Angle||Math.abs(be)<dk.Angle)&&(Math.abs(fe[2])<_e*dk.Pole||Math.abs(ve)>_e)&&Se.aboveGround&&we<dk.Tilt}function Ft$2(fe,ve,_e,be,we,Se){if(Se)l$2D(_e,be,Ck),ct$8(ve,fe,Ck);else{const Se=Et$3(_e,be,Fk,ve,fe[3],we);ct$8(ve,fe,m$26(Fk,Se))}}function Vt$2(fe,ve,_e,be,we,Se,Te){const Ee=Te?20:1;let Ce,Oe;r$3w(Rk,be),Dk.copyFrom(ve);for(let Re=0;Re<Ee&&p$4Z(_e,Rk)>1e-12&&(Ce=p$4Z(_e,Rk),Gt$3(_e,Rk,$k,_k,Pk,Dk,fe,we,Se,Te),qt$2(Dk,fe,_k,Pk[1],$k,Pk[0]),Rt$2(Rk,Rk,fe,_k,Pk[1],$k,Pk[0]),Oe=p$4Z(_e,Rk),Oe<Ce||0===Re);Re++)ve.copyFrom(Dk)}function Bt$3(fe,ve,_e,be,we,Se,Te,Ee,Ce){Ct$4(fe.center,P$1g(fe.up,fe.center),s$4g(fe.center),-wn.normalize(h$2U(Se)),Te,ve)?function Ot$3(fe,ve,_e,be,we,Se){const{eye:Te}=fe;w$1H([0,0,1],Te,_k,$k,bk);const Ee=ve.translation[0]*_e.pan,Ce="zoom"===we.mode?0:ve.translation[1]*_e.pan,Oe=Math.max(Math.sqrt(Math.abs(1-P$1g(fe.center,_k)**2/s$4g(fe.center)**2)),.5),Re=(Math.sin(Se)*Ce+Math.cos(Se)*Ee)/Oe,De=-Math.cos(Se)*Ce+Math.sin(Se)*Ee;switch(b$21(be.pan.matrix,be.pan.matrix,Re,_k),be.pan.enabled=!0,we.mode){case"pan":b$21(be.pan.matrix,be.pan.matrix,De,$k),be.pan.enabled=!0;break;case"zoom":be.zoom=-ve.translation[1]*_e.zoom}}(ve,_e,be,Ee,Ce,-wn.normalize(h$2U(we))):function Wt$1(fe,ve,_e,be,we){const{eye:Se,viewRight:Te}=fe,Ee=_$1z(Pd.get(),Te,Se),Ce=ve.translation[0]*_e.pan;switch(0!==Ce&&(b$21(be.pan.matrix,be.pan.matrix,-Ce,Ee),be.pan.enabled=!0),we.mode){case"pan":{const fe=ve.translation[1]*_e.pan;0!==fe&&(b$21(be.pan.matrix,be.pan.matrix,fe,Te),be.pan.enabled=!0);break}case"zoom":be.zoom=-ve.translation[1]*_e.zoom}}(ve,_e,be,Ee,Ce)}const _k=[0,0,0],$k=[0,0,0],bk=[0,0,0],wk=[0,0,0],xk=[0,0,0],Sk=[0,0,0],Tk=[0,0,0],Ek=[0,0,0],Pk=[0,0],Ck=s$2C(),Ok=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ak=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Mk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Rk=[0,0,0],Ik=[0,0,0],Lk=[0,0,0],Dk=new NR,Nk=[0,0,0],Fk=[0,0,0],zk={origin:[0,0,0],direction:[0,0,0]},kk={origin:[0,0,0],direction:[0,0,0]};let Uk=class A7 extends Kz{constructor(){super(...arguments),this._zoomLocation=[0,0,0],this._tmpCamera=new NR,this._tmpViewDir=[0,0,0],this._tmpRayDir={origin:[0,0,0],direction:[0,0,0]},this._targetOnSphere=[0,0,0],this._tmpCenter=[0,0,0],this._beginCamera=new NR,this._constraintOptions=new zF(IF.ALL_EXCEPT_COLLISION,DF.ZOOM,null,this._beginCamera),this._sphere=[0,0,0,0]}initialize(){this._intersector=T$15(this.view.state.viewingMode)}zoomStep(fe,ve){if(!this.active)return;const _e=this.view.state;this.animation.finished?this._beginCamera.copyFrom(_e.camera):this.animation.cameraAt(1,this._beginCamera);let be=!1,we=!1;this.intersectionHelper.intersectScreen(ve,this._zoomLocation,0===this.view.map.ground.opacity?lk:{})&&(be=fe>0,we=!0),this._tmpCamera.copyFrom(_e.camera),be?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:r$3w(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,fe,this._zoomLocation,ve,we),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:f$1X}}_updateCamera(fe,ve,_e,be,we){const Se=vt$2(fe,be,this.view.renderCoordsHelper,this.view.viewingMode),Te=Math.abs(this.view.camera.position.z);z$1d(Bk,fe.eye),g$2z(Bk,Bk,-1),p$2H(fe,be,this._tmpRayDir),z$1d(this._tmpRayDir.direction,this._tmpRayDir.direction);const Ee=e$3Y(Math.min(8,1/Math.abs(P$1g(Bk,this._tmpRayDir.direction)))*Te,200,ak);if(Se===uk.Horizontal){let we=.6**ve;this._sphere[3]=s$4g(_e),e$3Z(this._tmpViewDir,fe.center,fe.eye);const Se=Math.min(s$4g(this._tmpViewDir),Ee);let Te=Se*we;if(we<=1&&Te<4&&(Te=4,we=Te/Se),Math.abs(Se-Te)<1e-6)return;const Ce=s$4g(fe.center);if(this._sphere[3]!==Ce){const ve=this._sphere[3]+we*(Ce-this._sphere[3]);fe.center=g$2z(Vk,fe.center,ve/Ce)}g$2z(this._tmpViewDir,this._tmpViewDir,-we),fe.eye=u$3Y(Vk,fe.center,this._tmpViewDir),E$12(this.view,fe,this._constraintOptions),p$4Z(_e,fe.center)>1e-12&&s$2B(this._sphere,fe,be,this._targetOnSphere)&&function Tt$6(fe,ve,_e,be,we,Se,Te){Ct$4(_e,P$1g(ve.up,_e),fe[3],-wn.normalize(h$2U(we)),Se,ve)?Vt$2(fe,ve,_e,be,-wn.normalize(h$2U(we)),Se,Te):Ft$2(fe,ve,_e,be,Se,Te)}(this._sphere,fe,_e,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let Se=.6**Math.abs(ve);const Te=ve>0?1:-1;e$3Z(this._tmpViewDir,_e,fe.eye);const Ce=s$4g(this._tmpViewDir),Oe=this.view._stage.renderView.getMinimalDepthForArea(null,be[0],be[1],this.view.state.camera,60);let Re=null!=Oe?Oe:Ee;Re=we&&ve>0?Math.min(Re,Ce):Re,g$2z(this._tmpRayDir.direction,this._tmpRayDir.direction,Re),u$3Y(_e,this._tmpRayDir.origin,this._tmpRayDir.direction);let De=Re*Se;const Be=Math.max(4,1.01*fe.nearFar[0]);if(ve>0&&De<Be&&(De=Be,Se=De/Re),Math.abs(Re-De)<1e-6)return;g$2z(this._tmpRayDir.direction,this._tmpRayDir.direction,Te*(1-Se)),fe.eye=u$3Y(Vk,fe.eye,this._tmpRayDir.direction),fe.center=u$3Y(Vk,fe.center,this._tmpRayDir.direction)}s$2I(this.view,fe)}};Uk=e$4o([a$4y("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],Uk);const Vk=[0,0,0],Bk=[0,0,0];let jk,Gk=null;const Hk=new Map;async function l$2B(fe){null==Gk&&(null==jk&&(jk=zt((()=>import("./VoxelWasmPerSceneView-BgbgOgWs.js")),[])),Gk=await jk);const ve=fe.view;let _e=Hk.get(ve);return _e||(_e=new Gk.default({view:ve}),Hk.set(ve,_e)),_e.addVoxelLayer(fe)}function o$27(fe){return Hk.get(fe)}function i$2x(fe){const ve=fe.view,_e=Hk.get(ve);_e&&_e.removeVoxelLayer(fe)<1&&(Hk.delete(ve),0===Hk.size&&(jk=null,Gk=null))}let qk=class U3 extends Kz{constructor(){super(...arguments),this._zoomLocation=[0,0,0],this._tmpCamera=new NR,this._tmpRayDir=[0,0,0],this._tmpCenter=[0,0,0],this._beginCamera=new NR,this._constraintOptions=new zF(IF.ALL,DF.ZOOM,null,this._beginCamera)}zoomStep(fe,ve){if(!this.active)return;const _e=this.view.state;this.animation.finished?this._beginCamera.copyFrom(_e.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(_e.camera);const be=T$15(this.view.state.viewingMode);let we=!1;fe>0?(we=this.intersectionHelper.intersectScreenFreePointFallback(ve,this._zoomLocation,0===this.view.map.ground.opacity?lk:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,be,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,be,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:r$3w(this._zoomLocation,this._tmpCamera.center);const Se=.6**fe;let Te=this.view._stage.renderView.getMinimalDepthForArea(o$27(this.view),ve[0],ve[1],this.view.state.camera,60);e$3Z(Zk,this._tmpCamera.eye,this._zoomLocation),z$1d(Zk,Zk);const Ee=e$3Y(Math.min(8,1/Math.abs(P$1g(Yk,Zk)))*Math.abs(this.view.camera.position.z),200,ak);if(Te=null!=Te?Te:Ee,Te){const fe=[0,0,0];e$3Z(fe,this._zoomLocation,this._tmpCamera.eye),(Te<s$4g(fe)||!we)&&(z$1d(fe,fe),u$3Y(this._zoomLocation,this._tmpCamera.eye,g$2z(fe,fe,Te)))}this._updateCamera(this._tmpCamera,Se,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:f$1X}}_updateCamera(fe,ve,_e){e$3Z(this._tmpRayDir,_e,fe.eye);const be=s$4g(this._tmpRayDir);let we=be*ve;const Se=ve<=1,Te=Math.max(4,1.01*fe.nearFar[0]);0!==we&&(Se&&we<Te&&(we=Te,ve=we/be),Math.abs(be-we)<1e-6||(g$2z(this._tmpRayDir,this._tmpRayDir,ve),fe.eye=e$3Z(Wk,_e,this._tmpRayDir),fe.center=A$1G(Wk,fe.center,_e,1-ve),E$12(this.view,fe,this._constraintOptions)))}};qk=e$4o([a$4y("esri.views.3d.state.controllers.ZoomStepControllerLocal")],qk);const Wk=[0,0,0],Yk=r$3y(0,0,1),Zk=[0,0,0];function r$29(fe,ve){if("touch"===fe.pointerType)return!1;switch(ve){case"primary":return 0===fe.button;case"secondary":return 2===fe.button;case"tertiary":return 1===fe.button}}let Xk=class s29 extends nv{constructor(fe,ve){super(!0),this._view=fe,this.registerIncoming("double-click",ve,(fe=>this._handleDoubleClick(fe)))}_handleDoubleClick(fe){const ve=fe.data;if(function t$2w(fe,ve){switch(ve){case"primary":return"touch"===fe.pointerType||0===fe.button;case"secondary":return"touch"!==fe.pointerType&&2===fe.button;case"tertiary":return"touch"!==fe.pointerType&&1===fe.button}}(ve,"primary")){const _e=this._view.state.isGlobal?new Uk({view:this._view,mode:"animation"}):new qk({view:this._view,mode:"animation"});this._view.state.switchCameraController(_e),_e.zoomStep(Math.log(.5)/Math.log(.6),i$4i(ve.x,ve.y)),fe.stopPropagation()}}};let Jk=class u12{constructor(fe,ve){this._elevationProvider=fe,this._referenceEllipsoid=s$45(ve),this._unitInMeters=W$L(ve,this._referenceEllipsoid.metersPerDegree)}compute(fe,ve,_e,be,we){var Se;we||(we={near:0,far:0});let Te=fe[2]*this._unitInMeters;const Ee=Te,Ce=Te-be,Oe=null==(Se=this._elevationProvider)?void 0:Se.visibleElevationBounds;Oe&&(Te=Ce>=0?Ee-this._unitInMeters*Oe.min:this._unitInMeters*Oe.max-Ee);const Re={x:(_e=null!=_e?_e:new aa({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-_e.xmin,y:_e.ymax-_e.ymin,z:4*Math.max(_e.xmax-_e.xmin,_e.ymax-_e.ymin)},De=Math.max(Re.x,Re.y,Re.z);e$3Z(nU,ve,fe),iU[0]=nU[0]>0?_e.xmax:_e.xmin,iU[1]=nU[1]>0?_e.ymax:_e.ymin,iU[2]=nU[2]>0?De/2:-De/2,e$3Z(iU,iU,fe),z$1d(nU,nU);const Be=1.1*P$1g(iU,nU)*this._unitInMeters,Ze=Math.sqrt(Te*(Te+2*this._referenceEllipsoid.radius)),Xe=Math.max(_e.xmax-_e.xmin,_e.ymax-_e.ymin),Je=Xe*tU*this._unitInMeters,Qe=Xe*rU*this._unitInMeters,dt=e$3Y((Te-Qe)/(Je-Qe),0,1)**3,$t=Math.min(f$3i(Ze,Be,dt),Ze)*Math.max(Math.log(Math.abs(Ce)),1);return f$1T(Math.min($t,Math.max(34064e4,De))/this._unitInMeters,Kk,this._unitInMeters,we)}},Qk=class M3{constructor(fe){this._referenceEllipsoid=s$45(fe)}compute(fe,ve,_e,be,we){we||(we={near:0,far:0});const Se=s$4g(fe),Te=Se-this._referenceEllipsoid.radius,Ee=this._referenceEllipsoid.radius+Math.min(0,be),Ce=Math.abs(Te-be),Oe=Math.max(Ce,Math.abs(Te));return f$1T(1.2*f$3i(Math.sqrt(Oe*(Oe+2*Ee)),Se+this._referenceEllipsoid.radius,e$34(Oe)),e$3Y(2e4-(Math.log(Oe)-7.983)/9.011*19900,100,2e4),1,we)}};function f$1T(fe,ve,_e,be){const we=eU/_e;return fe/ve>we?(be.far=fe,be.near=be.far/ve):(be.near=we,be.far=be.near*ve),be}const Kk=2e4,eU=2,tU=.001,rU=1e-4,iU=[0,0,0],nU=[0,0,0];let sU=class n14 extends zi{constructor(fe){super(fe)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",(fe=>this._handleElevationChangeEvent(fe))))}_handleElevationChangeEvent(fe){if(this.view.state.cameraController)return;const ve=this.view.state.camera;null!=fe.spatialReference&&u$3k(this.view,ve,fe.extent,fe.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera((fe=>s$2I(this.view,fe,QF.EYE_AND_CENTER)))}};e$4o([y$2v({constructOnly:!0})],sU.prototype,"view",void 0),sU=e$4o([a$4y("esri.views.3d.state.SurfaceCollisionConstraint")],sU);let oU=class _4 extends zi{constructor(fe){super(fe),this.nearFarHeuristic=function c$2A(fe,ve,_e){return fe===Wf.Global?new Qk(_e):new Jk(ve,_e)}(fe.view.state.viewingMode,fe.view.basemapTerrain,fe.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([d$3d((()=>{var fe,ve,_e,be;return[null==(ve=null==(fe=this.view.constraints)?void 0:fe.clipDistance)?void 0:ve.near,null==(be=null==(_e=this.view.constraints)?void 0:_e.clipDistance)?void 0:be.far]}),(()=>this._clipDistanceNearFarChanged())),d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this.view.constraints)?void 0:fe.clipDistance)?void 0:ve.mode}),(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(fe=>this._updateCameraNearFar(fe))),d$3d((()=>this.view.renderDataExtent),(()=>this._updateNearFar()),Za),d$3d((()=>{var fe,ve,_e,be;return[null==(ve=null==(fe=this.view.constraints)?void 0:fe.altitude)?void 0:ve.min,null==(be=null==(_e=this.view.constraints)?void 0:_e.altitude)?void 0:be.max]}),(()=>this._updateAltitude()),Za),d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this.view.constraints)?void 0:fe.tilt)?void 0:ve.max}),(()=>this._updateTiltMax()),Za),d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this.view.constraints)?void 0:fe.tilt)?void 0:ve.mode}),(()=>this._updateTilt()),Za),d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.camera}),(()=>this._updateTiltAutoMax()),Za),d$3d((()=>{var fe,ve,_e,be,we,Se;return[null==(_e=null==(ve=null==(fe=this.view.map)?void 0:fe.ground)?void 0:ve.navigationConstraint)?void 0:_e.type,null==(Se=null==(we=null==(be=this.view.state)?void 0:be.constraints)?void 0:we.collision)?void 0:Se.enabled]}),(()=>this._updateCollision()),Za)]),this.view.state.isLocal&&this.addHandles(d$3d((()=>this.view.renderDataExtent),(fe=>this._updateLocalSurfaceDistance(fe)),Xa)),this._updateNearFar(),this.view.state.viewingMode!==Wf.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new sU({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var fe;const ve=null==(fe=this.view.constraints)?void 0:fe.clipDistance;ve&&"auto"!==ve.mode&&this.view.state.updateCamera((fe=>C$T(fe,ve)))}_updateNearFar(){this.view.state.updateCamera((fe=>this._updateCameraNearFar(fe)))}_updateCameraNearFar(fe){const ve=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(ve?ve.mode:"auto")?C$T(fe,ve):this._updateCameraNearFarAuto(fe,ve)}_updateCameraNearFarAuto(fe,ve){this.nearFarHeuristic.compute(fe.eye,fe.center,this.view.renderDataExtent,f$2B(this.view,fe.eye),fe),ve&&ve.autoUpdate(fe.near,fe.far)}_updateCollision(){var fe,ve,_e;const be=null==(_e=null==(ve=null==(fe=this.view.map)?void 0:fe.ground)?void 0:ve.navigationConstraint)?void 0:_e.type,we=!be||"stay-above"===be,Se=this.view.state.constraints.collision;if(we!==Se.enabled){Se.enabled=we,we&&this._reapplyConstraints(IF.COLLISION);const fe=this.view.constraints&&this.view.constraints.tilt;fe&&"auto"!==fe.mode||this._updateTiltAuto()}}_updateAltitude(){const fe=this.view.constraints&&this.view.constraints.altitude;fe&&this.view.state.viewingMode!==Wf.Local?this.view.state.constraints.altitude={min:fe.min,max:fe.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const fe=this.view.constraints&&this.view.constraints.tilt;fe&&"auto"!==fe.mode&&(this._updateTiltManual(fe),this._reapplyConstraints())}_updateTilt(){const fe=this.view.constraints&&this.view.constraints.tilt;"manual"===(fe?fe.mode:"auto")?this._updateTiltManual(fe):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(fe){const ve=this.view.state.constraints;ve.tilt=ve.createConstantMaxTilt(h$2U(fe.max))}_updateTiltAuto(){const fe=this.view.state.constraints;fe.tilt=fe.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const fe=this.view.constraints&&this.view.constraints.tilt;if(!fe||"auto"!==fe.mode)return;const ve=this.view.state.constraints;if(ve.tilt){const _e=ve.tilt(this.view.state.camera.distance).max;fe.autoUpdate(M$1x(_e))}}_updateLocalSurfaceDistance(fe){if(null==fe)return;let ve=Math.max(fe.width,fe.height);if(ve<=0)return;null!=fe.zmax&&null!=fe.zmin&&(ve=Math.max(ve,fe.zmax-fe.zmin));const _e=this.view.state,be=3*ve/Math.atan(_e.camera.fov/2);be!==_e.constraints.distance&&(_e.constraints.distance=be)}_reapplyConstraints(fe=IF.ALL){this.view.state.updateCamera((ve=>E$12(this.view,ve,new zF(fe,DF.NONE,null))))}};function C$T(fe,ve){ve&&(fe.near=ve.near,fe.far=ve.far)}e$4o([y$2v({constructOnly:!0})],oU.prototype,"view",void 0),e$4o([y$2v({readOnly:!0})],oU.prototype,"surfaceCollisionConstraint",void 0),oU=e$4o([a$4y("esri.views.3d.state.ConstraintsManager")],oU);let aU=class c21{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(fe){this.renderCoordsHelper=fe,this.frustum=H$M(),this._points=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.lines=new Array(12),this._origin=[0,0,0],this._direction=[0,0,0],this._altitude=null;for(let ve=0;ve<12;ve++)this.lines[ve]={origin:null,direction:[0,0,0],endpoint:null}}update(fe){L$P(fe.viewMatrix,fe.projectionMatrix,this.frustum,this._points),r$3w(this._origin,fe.eye),r$3w(this._direction,fe.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(fe){for(let ve=0;ve<this._points.length;ve++)r$3w(this._points[ve],fe[ve]);P$T(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(fe){return s$2N(this.frustum,fe)}intersectsRay(fe){return function u$2s(fe,ve){return p$2T(fe,y$1t(ve,PR.get()))}(this.frustum,fe)}intersectsLineSegment(fe,ve){return a$2N(this.frustum,fe,ve)}intersectsPoint(fe){return l$2V(this.frustum,fe)}_updateLines(){const fe=this._points;for(let ve=0;ve<4;ve++){const _e=ve+4;d$1P(this.lines[ve],fe[ve],fe[_e]),d$1P(this.lines[ve+4],fe[ve],3===ve?fe[0]:fe[ve+1]),d$1P(this.lines[ve+8],fe[_e],3===ve?fe[4]:fe[_e+1])}}};function d$1P(fe,ve,_e){fe.origin=ve,fe.endpoint=_e,J$M(fe.direction,ve,_e)}aU.planePointIndices=xR,aU.nearFarLineIndices=[[bR.NEAR_BOTTOM_LEFT,bR.FAR_BOTTOM_LEFT],[bR.NEAR_BOTTOM_RIGHT,bR.FAR_BOTTOM_RIGHT],[bR.NEAR_TOP_RIGHT,bR.FAR_TOP_RIGHT],[bR.NEAR_TOP_LEFT,bR.FAR_TOP_LEFT]];let lU=class l11 extends Jz{set desiredCamera(fe){this._set("desiredCamera",fe.clone())}constructor(fe){super(fe)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Xz.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",(fe=>this._handleElevationChangeEvent(fe)))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(fe){(null==fe.spatialReference||u$3k(this.view,this.desiredCamera,fe.extent,fe.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera((fe=>{fe.copyViewFrom(this.desiredCamera),s$2I(this.view,fe,QF.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Xz.Stopped)}))}};e$4o([y$2v({constructOnly:!0})],lU.prototype,"desiredCamera",null),lU=e$4o([a$4y("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],lU);const cU=.66;function st$b(fe){return 360-xn.normalize(fe)}function ct$7(fe){return xn.normalize(360-fe)}function lt$8(fe,ve,_e){const be=ve.camera;if(null!=be)return function ut$7(fe,ve){const _e=fe.position;let be;try{be=H$13(_e,ve)}catch(Se){return null}if(!be)return null;const we=fe.clone();return we.position=be.clone(),we}(be,W$C(fe));const{targetGeometry:we}=ve;if(null==we)return null;const{camera:Se,mode:Te}=pt$6(fe,ve.rotation,_e);if("point"===we.type)return function gt$7(fe,ve,_e,be,we){const Se=fe.spatialReference;let Te;try{Te=H$13(_e.clone(),Se)}catch(jR){return null}if(!Te)return null;const Ee=null!=ve.scale?$$w(fe,ve.scale,Te.latitude):fe.state.camera.distance;return function te$e(fe,ve,_e,be,we,Se){return Ue$2(fe,ce$b(fe,be.heading,be.tilt,ve,_e,we),be.fov,Se)}(fe,Te,Ee,be,we)}(fe,ve,we,Se,Te);const Ee=we.extent;return null==Ee?null:we$3(fe,Ee,Se.heading,Se.tilt,Te)}async function mt$5(fe,ve,_e,be){const we=ve.camera;if(null!=we)return async function ft$6(fe,ve,_e){const be=fe.position,we=await I$1u(be,ve,{signal:_e});s$4o(_e);const Se=fe.clone();return Se.position=we.clone(),Se}(we,W$C(fe),be);const{targetGeometry:Se}=ve;if(null==Se)throw new Error("Viewpoint has no targetGeometry!");const{camera:Te,mode:Ee}=pt$6(fe,ve.rotation,_e);if("point"===Se.type)return async function yt$4(fe,ve,_e,be,we,Se){const Te=fe.spatialReference,Ee=await I$1u(_e.clone(),Te,{signal:Se});s$4o(Se);const Ce=null!=ve.scale?$$w(fe,ve.scale,Ee.latitude):fe.state.camera.distance;return ne$e(fe,Ee,Ce,be,we,Se)}(fe,ve,Se,Te,Ee,be);const Ce=Se.extent;if(null==Ce)throw new Error("Target geometry has no extent!");return ve$3(fe,Ce,Te.heading,Te.tilt,Ee,be)}function pt$6(fe,ve,_e){const be=Q$y(fe,fe.state.camera);let we=Pg.ADJUST;return null!=ve&&(be.heading=st$b(ve),we=Pg.LOCKED),null!=_e&&(be.tilt=_e),{camera:be,mode:we}}async function dt$5(fe,ve,_e){const be=function Ot$2(fe,ve){if(!ve||!fe.spatialReference)return null;const _e={target:void 0};return"declaredClass"in ve||Array.isArray(ve)?_e.target=ve:(Object.assign(_e,ve),!_e.target&&"center"in ve&&ve.center&&(_e.target=ve.center)),_e}(fe,ve);if(!be)throw new Ir("viewpointutils-create:no-target","Missing target for creating viewpoint");const we=new Xo({fov:fe.camera.fov}),Se=new Ra({camera:we});if(be.target instanceof Ra)return Pt$2(await async function Gt$2(fe,ve,_e,be,we){if(ve.camera)return St$2(fe,ve.camera,be,we);we.scale=ve.scale,we.rotation=ve.rotation,we.targetGeometry=null!=ve.targetGeometry?ve.targetGeometry.clone():null,we.camera=null,null!=_e.heading?we.rotation=ct$7(_e.heading):null!=_e.rotation&&(we.rotation=_e.rotation);const Se=wt$4(fe,_e);return null!=Se&&(we.scale=Se),we.camera=await mt$5(fe,we,_e.tilt,be),we}(fe,be.target,be,_e,Se));if(be.target instanceof Xo)return Pt$2(await St$2(fe,be.target,_e,Se));const Te=null!=be.scale||null!=be.zoom;if(be.target instanceof aa){const ve=be.target.xmin===be.target.xmax||be.target.ymin===be.target.ymax;return Pt$2(Te||ve?await Tt$5(fe,be,be.target.center,we,_e,Se):await async function At$2(fe,ve,_e,be,we,Se){Se.targetGeometry=_e.clone();const Te=g$22(fe);Q$y(fe,Te,be);const Ee=jt$3(be,ve)?Pg.LOCKED:Pg.ADJUST;return Se.camera=await ve$3(fe,_e,be.heading,be.tilt,Ee,we),Se}(fe,be,be.target,we,_e,Se))}const Ee=new Ut,Ce=Te?function xt$3(fe,ve){const _e=wt$4(fe,ve);return _e?function u$3q(fe){return fe/(bo*Dp)}(_e):void 0}(fe,be):void 0;if(await zt$1(fe,be.target,Ce,Ee,_e),isFinite(Ee.boundingBox[0])){let ve;if(E$1m(Ee.boundingBox,uU),_U.x=uU[0],_U.y=uU[1],_U.z=uU[2],_U.spatialReference=fe.spatialReference,isFinite(_U.z)&&Ee.hasZ?ve=w$1t(Ee.boundingBox):(_U.z=void 0,ve=function H$15(fe){return!(0!==M$1o(fe)&&isFinite(fe[0])||0!==s$41(fe)&&isFinite(fe[1]))}(S$1r(Ee.boundingBox,fU))),Te||ve)return Pt$2(await Tt$5(fe,be,_U,we,_e,Se));const Ce=function Dt(fe,ve){const _e=cU;if(!ve.length)return _e;let be=Number.NEGATIVE_INFINITY;for(let we=0;we<ve.length;we++){const fe=ve[we].screenSpaceBoundingRect;be=Math.max(be,Math.abs(fe[0]),Math.abs(fe[1]),Math.abs(fe[2]),Math.abs(fe[3]))}return _e-be/Math.min(fe.width,fe.height)*2}(fe,Ee.screenSpaceObjects);return Pt$2(await async function Ft$1(fe,ve,_e,be,we,Se,Te,Ee){Ee.targetGeometry=_e.clone();const Ce=g$22(fe),Oe=function Et$2(fe,ve,_e,be,we){let Se=0;null!=_e.z?Se=_e.z:fe.basemapTerrain&&fe.elevationProvider&&(Se=a$3U(fe.elevationProvider,_e)),o$44(uU,_e.x,_e.y,Se),u$3m(fe.spatialReference,uU,hU,fe.renderSpatialReference),n$3X(dU,hU),u$3n(dU,dU),P$$(pU);const Te=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let Xe=0;Xe<Te.length;Xe++){const ve=Te[Xe];let _e=be[ve[2]];isFinite(_e)||(_e=Se),o$44(uU,be[ve[0]],be[ve[1]],_e),n$3Y(uU,fe.spatialReference,uU,fe.renderSpatialReference),h$2e(pU,S$1P(uU,uU,dU))}const Ee=s$3m(pU),Ce=N$W(pU),Oe=I$1f(pU),Re=1/Math.tan(ve.fovX/2),De=1/Math.tan(ve.fovY/2),Be=.5*Math.sqrt(Ee*Ee+Oe*Oe)*Math.max(De,Re)+.5*Ce,Ze=.5*Ce*De+.5*Math.max(Ee,Oe);return Math.max(Be,Ze)/we}(fe,Ce,_e,be,we);Q$y(fe,Ce,Se);const Re=jt$3(Se,ve)?Pg.LOCKED:Pg.ADJUST;return Ee.scale=_$1b(fe,Oe,Ee.targetGeometry.latitude),Ee.camera=await ee$f(fe,Ee.targetGeometry,Ee.scale,Se,Re,Te),Ee}(fe,be,_U,Ee.boundingBox,Ce,we,_e,Se))}return be.position?Pt$2(await async function Mt$4(fe,ve,_e,be,we){const Se=g$22(fe);r$3w(mU,Se.viewForward),re$d(fe,Se.eye,mU,Se.up,vU);const Te=fe.spatialReference,{position:Ee}=ve;if(Ee){const fe=await I$1u(Ee,Te,{signal:we});_e.position=fe}else _e.position=new Yo;return _e.heading=null!=ve.heading?ve.heading:vU.heading,_e.tilt=null!=ve.tilt?ve.tilt:vU.tilt,vt$1(fe,null,_e,be)}(fe,be,we,Se,_e)):Pt$2(await async function Zt(fe,ve,_e,be,we){if(null!=ve.heading||null!=ve.rotation||null!=ve.scale||null!=ve.tilt||null!=ve.zoom||null!=ve.zoomFactor){const Se=g$22(fe),{spatialReference:Te,renderSpatialReference:Ee}=fe,Ce=new Yo({spatialReference:Te});return t$3D(Se.center,Ee,Ce)?Tt$5(fe,ve,Ce,_e,be,we):we}return we.scale=fe.scale,we.camera=fe.camera.clone(),jt$3(we.camera,ve),we}(fe,be,we,_e,Se))}function wt$4(fe,ve){return null==ve.scale&&null!=ve.zoom?Ae$2(fe,ve.zoom):ve.scale}function jt$3(fe,ve){let _e=!1;return null!=ve.heading?(fe.heading=ve.heading,_e=!0):null!=ve.rotation&&(fe.heading=st$b(ve.rotation),_e=!0),null!=ve.tilt&&(fe.tilt=ve.tilt,_e=!0),null!=ve.fov&&(fe.fov=ve.fov),_e}function vt$1(fe,ve,_e,be){const we=fe.spatialReference||zo.WGS84;if(ve??(ve=Z$v(fe,_e)),null==ve)return be;const Se=new Yo({spatialReference:we});if(!t$3D(ve.center,fe.renderSpatialReference,Se))return be;be.targetGeometry=Se;const{latitude:Te}=Se;return be.scale=null!=Te?_$1b(fe,ve.distance,Te):De$3(fe,ve),be.rotation=ct$7(_e.heading),be.camera=_e,be}async function bt$3(fe,ve,_e,be){var we;const r65=()=>new Ir("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!ve)throw r65();"mesh"===ve.type&&(ve=ve.extent);const Se=fe.basemapTerrain.spatialReference;if(!ve.hasZ&&fe.basemapTerrain){let _e;switch(ve.type){case"point":_e=ve;break;case"multipoint":case"polyline":_e=null==(we=ve.extent)?void 0:we.center;break;case"extent":_e=ve.center;break;case"polygon":_e=ve.centroid}null!=_e&&Se&&fe.elevationProvider?(_e=await I$1u(_e,Se,{signal:be}),uU[2]=a$3U(fe.elevationProvider,_e)??0):uU[2]=0}const Te=$U[ve.type],Ee=new Array;if(Te(ve,ve.hasZ?fe=>{Ee.push([fe[0],fe[1],fe[2]])}:fe=>{Ee.push([fe[0],fe[1]])},uU),0===Ee.length)throw r65();const Ce=ve.spatialReference,Oe=fe.spatialReference,Re=await I$1u(new ua({spatialReference:Ce,hasZ:ve.hasZ,hasM:!1,points:Ee}),Oe,{signal:be});if(ve.hasZ&&(_e.hasZ=!0),ve.hasZ)for(const[De,Be,Ze]of Re.points)uU[0]=De,uU[1]=Be,uU[2]=Ze,h$2e(_e.boundingBox,uU);else for(const[De,Be]of Re.points)uU[0]=De,uU[1]=Be,h$2e(_e.boundingBox,uU)}async function zt$1(fe,ve,_e,be,we){var Se;if(Array.isArray(ve)&&2===ve.length){const _e=ve[0],Te=ve[1];if("number"==typeof _e&&"number"==typeof Te)return _U.x=_e,_U.y=Te,_U.z=void 0,_U.spatialReference=(null==(Se=fe.spatialReference)?void 0:Se.isGeographic)?fe.spatialReference:zo.WGS84,void(await bt$3(fe,_U,be,we))}ve&&"map"in ve&&"function"==typeof ve.map?await Promise.allSettled(ve.map((ve=>zt$1(fe,ve,_e,be,we)))):ve instanceof Uo?await bt$3(fe,ve,be,we):ve instanceof RT&&await async function Rt$1(fe,ve,_e,be,we){const Se=await _$1s(fe.whenViewForGraphic(ve));if(!1===Se.ok||null==Se.value||!("whenGraphicBounds"in Se.value))return void(await bt$3(fe,ve.geometry,be,we));const Te=Se.value,Ee=await _$1s(Te.whenGraphicBounds(ve,{minDemResolution:_e}));if(!1===Ee.ok||!Ee.value)return void(await bt$3(fe,ve.geometry,be,we));const{screenSpaceObjects:Ce,boundingBox:Oe}=Ee.value;o$35(be.boundingBox,Oe),Ce&&Ce.forEach((fe=>{be.screenSpaceObjects.push(fe)})),isFinite(Oe[2])&&(be.hasZ=!0)}(fe,ve,_e,be,we)}async function St$2(fe,ve,_e,be){const we=fe.spatialReference,Se=await I$1u(ve.position,we,{signal:_e}),Te=ve.clone();return Te.position=Se,vt$1(fe,null,Te,be)}async function Tt$5(fe,ve,_e,be,we,Se){Se.targetGeometry=_e.clone();const Te=g$22(fe);if(ve.position)return async function Bt$2(fe,ve,_e,be,we,Se,Te){const Ee=fe.renderSpatialReference;return await i$47(ve,gU,Ee,0,{signal:Te}),await i$47(_e,yU,Ee,0,{signal:Te}),Se.targetGeometry=new Yo(ve),we.position=new Yo(_e),e$3Z(mU,gU,yU),re$d(fe,yU,mU,be.up,we),Se.scale=_$1b(fe,x$1W(yU,gU),Se.targetGeometry.latitude),Se.rotation=ct$7(we.heading),Se.camera=we,Se}(fe,Se.targetGeometry,ve.position,Te,be,Se,we);if(ve.zoomFactor){const be=Te.distance/ve.zoomFactor,we=g$2z(uU,Te.viewForward,-be);Te.eye=u$3Y(uU,Te.center,we),Se.scale=_$1b(fe,be,_e.latitude)}Q$y(fe,Te,be);const Ee=jt$3(be,ve)?Pg.LOCKED:Pg.ADJUST;if(!ve.zoomFactor){const Ce=wt$4(fe,ve);null==Ce?(await i$47(_e,uU,fe.renderSpatialReference,0,{signal:we}),l$2V(Te.frustum,uU)?Se.scale=_$1b(fe,x$1W(Te.eye,uU),_e.latitude):Se.scale=De$3(fe,Te)):Se.scale=Ce,Se.camera=await ee$f(fe,Se.targetGeometry,Se.scale,be,Ee,we)}return Se}function Pt$2(fe){return null!=(null==fe?void 0:fe.camera)&&(fe.rotation=ct$7(fe.camera.heading)),fe}class Ut{constructor(){this.hasZ=!1,this.boundingBox=P$$(),this.screenSpaceObjects=new Array}}const uU=[0,0,0],hU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dU=[1,0,0,0,1,0,0,0,1],pU=i$3t(),fU=u$3J(),mU=[0,0,0],yU=[0,0,0],gU=[0,0,0],vU={heading:0,tilt:0},_U=new Yo,$U={point(fe,ve,_e){_e[0]=fe.x,_e[1]=fe.y,null!=fe.z&&(_e[2]=fe.z),ve(_e)},polygon(fe,ve,_e){const be=fe.hasZ;for(let we=0;we<fe.rings.length;we++){const Se=fe.rings[we];for(let fe=0;fe<Se.length;fe++)_e[0]=Se[fe][0],_e[1]=Se[fe][1],be&&(_e[2]=Se[fe][2]),ve(_e)}},polyline(fe,ve,_e){const be=fe.hasZ;for(let we=0;we<fe.paths.length;we++){const Se=fe.paths[we];for(let fe=0;fe<Se.length;fe++)_e[0]=Se[fe][0],_e[1]=Se[fe][1],be&&(_e[2]=Se[fe][2]),ve(_e)}},multipoint(fe,ve,_e){const be=fe.points,we=fe.hasZ;for(let Se=0;Se<be.length;Se++)_e[0]=be[Se][0],_e[1]=be[Se][1],we&&(_e[2]=be[Se][2]),ve(_e)},extent(fe,ve,_e){null!=fe.zmin&&null!=fe.zmax?(ve(o$44(_e,fe.xmin,fe.ymin,fe.zmin)),ve(o$44(_e,fe.xmax,fe.ymin,fe.zmin)),ve(o$44(_e,fe.xmin,fe.ymax,fe.zmin)),ve(o$44(_e,fe.xmax,fe.ymax,fe.zmin)),ve(o$44(_e,fe.xmin,fe.ymin,fe.zmax)),ve(o$44(_e,fe.xmax,fe.ymin,fe.zmax)),ve(o$44(_e,fe.xmin,fe.ymax,fe.zmax)),ve(o$44(_e,fe.xmax,fe.ymax,fe.zmax))):(ve(o$44(_e,fe.xmin,fe.ymin,_e[2])),ve(o$44(_e,fe.xmax,fe.ymin,_e[2])),ve(o$44(_e,fe.xmin,fe.ymax,_e[2])),ve(o$44(_e,fe.xmax,fe.ymax,_e[2])))}};let bU=class f7{constructor(fe,ve,_e){this._target=fe,this._options=ve,this.view=_e,this.state="pending",this._animationController=null,this.promise=new Promise(((fe,ve)=>{this._resolveCallback=fe,this._rejectCallback=ve;const _e=new AbortController;null!=this._options.signal&&m$3R(this._options.signal,(()=>{this.abort()})),this._abortController=_e,this._waitForReady()}))}_resolve(fe){if("finished"!==this.state)return this.state="finished",this._resolveCallback(fe)}_reject(fe){if("finished"!==this.state)return this.state="finished",this._rejectCallback(fe)}abort(fe=!1){this._abortController.abort(),"wait-for-animation-finish"===this.state&&!fe&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(u$47())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await w$1T((()=>this.view.ready),this._abortController.signal)}catch(t84){return this._reject(t84)}this._createViewPoint()}async _createViewPoint(){if("finished"!==this.state){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const fe=await dt$5(this.view,this._target,this._abortController.signal);if("finished"===this.state)return;const ve=fe?this._getCameraFromViewpoint(fe):null;if(null==ve)return;if(this._options.animate){if(null==this._animationController)return;this._startAnimation(ve,this._animationController)}else this.view.stateManager.setStateCamera(ve.camera,{applyConstraints:!ve.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(t84){this._reject(t84)}}}_getCameraFromViewpoint(fe){var ve;const _e=!!(this._target instanceof Ra&&this._target.camera||this._target instanceof Xo),be=fe.camera;if(null==be)return null;if(!this.view.stateManager.isCompatible(be)){const fe=be.position,_e=fe&&fe.spatialReference,we=_e?_e.wkid:"none",Se=null==(ve=this.view.spatialReference)?void 0:ve.wkid;return this._reject(new Ir("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${we}, view: ${Se})`,{camera:be})),null}const we=Z$v(this.view,be);return null==we?(this._reject(new Ir("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:fe,camera:we,isFullySpecified:_e}}_startAnimation(fe,ve){this.state="wait-for-animation-finish";const _e=ve.viewAnimation;if(null==_e)return void this._reject(new Ir("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(_e.update(fe.viewpoint,"running"),!ve.active||null==ve.viewAnimation||ve.viewAnimation.target!==fe.viewpoint||this.view.state.cameraController!==ve)return this.abort();let be;fe.isFullySpecified?(be=new lU({view:this.view,desiredCamera:fe.camera}),s$2I(this.view,fe.camera,QF.EYE_AND_CENTER)):E$12(this.view,fe.camera),ve.begin(fe.camera,this._options);const w9=fe=>{if(null!=this.view.state)switch(ve.state){case Xz.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Xz.Ready:case Xz.Rejected:case Xz.Running:case Xz.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(fe)}}};_e.when((()=>{const _e=this.view.state.cameraController;be&&(_e&&_e.active?_e instanceof Kz&&null!=_e.viewAnimation&&_e.viewAnimation.target===fe.viewpoint&&(this.view.state.cameraController=be):null!=ve.viewAnimation&&ve.viewAnimation.target===fe.viewpoint&&ve.state===Xz.Finished&&(this.view.state.cameraController=be))}),(fe=>w9(fe))),ve.asyncResult={resolve:()=>w9(),reject:fe=>w9(fe)}}_getAnimationController(){let fe=null,ve=null;const _e=this.view.state.cameraController;return _e instanceof Kz&&(_e.updateStateFromViewAnimation(),_e.active&&(fe=_e,ve=fe.viewAnimation)),null!=fe||(fe=new Kz({view:this.view,mode:"animation"}),ve=fe.viewAnimation,this.view.state.switchCameraController(fe))?fe:(null!=ve&&ve.stop(),this._reject(new Ir("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},wU=class t30{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(fe,ve){var _e;return null==(_e=this._outer.get(fe))?void 0:_e.get(ve)}set(fe,ve,_e){const be=this._outer.get(fe);be?be.set(ve,_e):this._outer.set(fe,new Map([[ve,_e]]))}delete(fe,ve){const _e=this._outer.get(fe);_e&&(_e.delete(ve),0===_e.size&&this._outer.delete(fe))}forEach(fe){this._outer.forEach(((ve,_e)=>fe(ve,_e)))}};var xU;function s$2z(fe=!has("disable-feature:high-quality-idle"),ve=null){const _e=new wU;return fe?(_e.set(PM.IDLE,xU.Antialiasing,"low"!==ve),_e.set(PM.IDLE,xU.HighResolutionAtmosphere,"low"!==ve),_e.set(PM.IDLE,xU.HighQualityTransparency,!0),_e.set(PM.IDLE,xU.SSAO,!0),_e.set(PM.IDLE,xU.WaterReflection,!0),_e.set(PM.IDLE,xU.PhysicalPixelRendering,!0)):(_e.set(PM.ANIMATING,xU.HighResolutionShadows,!0),_e.set(PM.ANIMATING,xU.HighResolutionViewshed,!0),_e.set(PM.INTERACTING,xU.HighResolutionShadows,!0),_e.set(PM.INTERACTING,xU.HighResolutionViewshed,!0)),_e.set(PM.IDLE,xU.HighResolutionShadows,!0),_e.set(PM.IDLE,xU.HighResolutionViewshed,!0),_e.set(PM.IDLE,xU.HighResolutionVoxel,!0),_e}!function(fe){fe[fe.Antialiasing=0]="Antialiasing",fe[fe.HighQualityTransparency=1]="HighQualityTransparency",fe[fe.HighResolutionVoxel=2]="HighResolutionVoxel",fe[fe.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",fe[fe.SSAO=4]="SSAO",fe[fe.WaterReflection=5]="WaterReflection",fe[fe.HighResolutionShadows=6]="HighResolutionShadows",fe[fe.HighResolutionViewshed=7]="HighResolutionViewshed",fe[fe.PhysicalPixelRendering=8]="PhysicalPixelRendering"}(xU||(xU={}));let SU=class Q extends zi{constructor(fe){super(fe),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=LU,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:fe=>this._devicePixelRatioOverride=fe,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=this.renderState},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(fe){this.viewStateManager._idleTimeout=fe?LU:0}},this._propertiesPool=new ev({frustum:aU},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new TU}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([v$1W((()=>this.view.state.events),"before-camera-change",(fe=>fe&&this._updateElevation(fe))),d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.camera}),((fe,ve)=>this._cameraChangedHandler(fe,ve)),Za)]),p$4J((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.camera}),(fe=>this._updateElevation(fe)),{once:!0,sync:!0}),this.addHandles([A$1I({prepare:()=>this._prepareFrame()}),d$3d((()=>this.view.state.cameraController),(()=>{this._cameraSetByUser=!0,this.removeHandles(RU)})),v$1W((()=>this.view.state.events),"camera-projection-changed",(()=>this.notifyChange("scale")))])}destroy(){this.exit(),this._propertiesPool=u$4d(this._propertiesPool)}get camera(){const fe=this._get("camera");if(!this.ready)return fe;const ve=Q$y(this.view,this.view.state.camera,OU);return ve&&fe&&ve.equals(fe)?fe:ve.clone()}set camera(fe){var ve,_e;this._updatePropertyBeforeReady("camera",fe)||(null==(ve=this.view.elevationProvider)||ve.enableCache(!0),this.setStateCamera(Z$v(this.view,fe),{applyConstraints:!1})||ar.getLogger(this).error("#camera=","Invalid camera",fe),null==(_e=this.view.elevationProvider)||_e.enableCache(!1))}get contentCamera(){const fe=this._get("contentCamera");if(!this.ready)return fe;const ve=Q$y(this.view,this.view.state.contentCamera,OU);return ve&&fe&&ve.equals(fe)?fe:ve.clone()}set contentCamera(fe){if(this._updatePropertyBeforeReady("contentCamera",fe))return;const ve=Z$v(this.view,fe);null!=ve?(this._updateElevation(ve),this.view.state.contentCamera=ve):this.view.state.contentCamera=null}installContentCameraReset(fe){if(this.removeHandles(IU),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const ve=this.zoom,_e=this.view.state.camera.distance**2,be=e$3$(this.view.state.camera.center),we=fe.sticky?this.contentCamera.clone():null;return this.addHandles([d$3d((()=>this.contentCamera),(()=>{fe.sticky||(this.removeHandles(IU),this.test.contentCameraResetState.clear())})),d$3d((()=>this.zoom),(fe=>{void 0!==fe&&void 0!==ve&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(fe-ve)/2),Math.abs(fe-ve)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=we))})),d$3d((()=>this.view.state.camera),(fe=>{const ve=p$4Z(be,fe.center);this.test.contentCameraResetState.set("camera.center",ve/_e),ve>_e?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=we)}))],IU),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(fe){var ve;this._updatePropertyBeforeReady("center",fe)||(fe?this.isCompatible(fe)?this.setStateCamera(this._centerToCamera(fe),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ar.getLogger(this).error("#center=","Invalid center",fe):ar.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(fe.spatialReference?fe.spatialReference.wkid:"none")+", view: "+(null==(ve=this.view.spatialReference)?void 0:ve.wkid)+")",fe):ar.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const fe=this.view,ve=Re$2(fe,fe.state.camera,fe.pointsOfInterest.centerOnContent.renderLocation);return null!=ve?ve:this._get("extent")}set extent(fe){var ve;this._updatePropertyBeforeReady("extent",fe)||(fe?this.isCompatible(fe)?this.setStateCamera(this._extentToCamera(fe),{applyConstraints:!0})||ar.getLogger(this).error("#extent=","Invalid extent",fe):ar.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(fe.spatialReference?fe.spatialReference.wkid:"none")+", view: "+(null==(ve=this.view.spatialReference)?void 0:ve.wkid)+")",fe):ar.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const fe=this._propertiesPool.get("frustum");return fe.renderCoordsHelper=this.view.renderCoordsHelper,fe.update(this.view.state.camera),fe}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var fe;const ve=this.view.map;return ve&&"initialViewProperties"in ve?null==(fe=ve.initialViewProperties)?void 0:fe.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const fe=this.view.pointsOfInterest.centerOnContent;return _$1b(this.view,fe.distance,fe.location.latitude)}return this._get("scale")}set scale(fe){this._updatePropertyBeforeReady("scale",fe)||this.setStateCamera(this._scaleToCamera(fe),{applyConstraints:!0})||ar.getLogger(this).error("#scale=","Invalid scale",fe)}get terrainScale(){if(!this.ready)return this._get("scale");const fe=this.view,ve=fe.basemapTerrain.tilingScheme,_e=fe.pointsOfInterest.cameraOnSurface.scale;if(!ve||!_e)return this._get("scale");const be=fe.state.contentCamera;let we=re$d(fe,be.eye,be.viewForward,be.up).tilt;we>90&&(we=180-we);const Se=2*(we/90)**2,Te=ve.levelAtScale(_e)-Se;return Te<0?this._get("scale"):ve.scaleAtLevel(Te)}get padding(){if(!this.ready)return this._get("padding");const fe=this.view.state.camera,ve=fe.padding,_e=fe.pixelRatio,be=this._get("padding"),we=Math.round(ve[IR.TOP]/_e),Se=Math.round(ve[IR.RIGHT]/_e),Te=Math.round(ve[IR.BOTTOM]/_e),Ee=Math.round(ve[IR.LEFT]/_e);return null!=be&&be.top===we&&be.right===Se&&be.bottom===Te&&be.left===Ee?be:{top:we,right:Se,bottom:Te,left:Ee}}set padding(fe){this._updatePropertyBeforeReady("padding",fe)||(this._paddingToArray(fe,this.view.state.camera.pixelRatio,MU),this.view.state.updateCamera((fe=>fe.padding=MU)))}_paddingToArray(fe,ve,_e){fe?s$3I(_e,fe.top||0,fe.right||0,fe.bottom||0,fe.left||0):s$3I(_e,0,0,0,0);for(let be=0;be<4;be++)_e[be]=Math.round(_e[be]*ve)}get screenCenter(){const fe=this.padding;return c$4u((this.view.width-(fe.left+fe.right))/2+fe.left,(this.view.height-(fe.top+fe.bottom))/2+fe.top)}get viewpoint(){return this.ready?function ht$8(fe,ve,_e=null){return null==_e&&(_e=new Ra),vt$1(fe,null,ve.clone(),_e)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(fe){var ve;if(!this._updatePropertyBeforeReady("viewpoint",fe))if(fe)if(this.isCompatible(fe))this.setStateCamera(this._viewpointToCamera(fe),{applyConstraints:!fe.camera})||ar.getLogger(this).error("#viewpoint=","Invalid viewpoint",fe);else{const _e=null!=fe.camera?fe.camera.position:fe.targetGeometry,be=null!=_e&&_e.spatialReference;ar.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(be?be.wkid:"none")+", view: "+(null==(ve=this.view.spatialReference)?void 0:ve.wkid)+")",fe)}else ar.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?function Pe$2(fe,ve){var _e;const be=null==(_e=fe.basemapTerrain)?void 0:_e.tilingScheme;if(be)return be.levelAtScale(ve);H$U().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}(this.view,this.scale):this._get("zoom")}set zoom(fe){this._updatePropertyBeforeReady("zoom",fe)||void 0===fe||this.setStateCamera(this._zoomToCamera(fe),{applyConstraints:!0})||ar.getLogger(this).error("#zoom=","Invalid zoom",fe)}_computeCanvasSize(){var fe;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const ve=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),_e=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:ve)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*_e),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*_e);const be=null==(fe=this.view._stage.renderView.renderingContext)?void 0:fe.parameters.maxTextureSize;return be&&A$18(this._tmpCanvasSize,be),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:_e,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var fe,ve;return(null==(ve=null==(fe=this.view)?void 0:fe._stage)?void 0:ve.renderer.isFeatureEnabled(xU.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var fe,ve;const _e=null==(ve=null==(fe=this.view)?void 0:fe._stage)?void 0:ve.renderer;return _e&&(_e.isFeatureEnabled(xU.PhysicalPixelRendering,PM.IDLE)||_e.isFeatureEnabled(xU.PhysicalPixelRendering,PM.INTERACTING)||_e.isFeatureEnabled(xU.PhysicalPixelRendering,PM.ANIMATING))}preinit(fe){var ve,_e,be;return!(this._isOverridden("center")&&!B$12(this.center.spatialReference,fe)||this._isOverridden("camera")&&!B$12(this.camera.position.spatialReference,fe)||this._isOverridden("extent")&&!B$12(this.extent.spatialReference,fe)||!(!this._isOverridden("viewpoint")||B$12(null==(ve=this.viewpoint.targetGeometry)?void 0:ve.spatialReference,fe)&&B$12(null==(be=null==(_e=this.viewpoint.camera)?void 0:_e.position)?void 0:be.spatialReference,fe)))}init(){this._constraintsManager=new oU({view:this.view}),this._prepareFrame();const fe=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const ve of fe)this.set(ve.name,ve.value);if(!this._cameraSetByUser){const fe=this._initialViewpoint||this.view.initialExtent;fe&&this.isCompatible(fe)?this._setInitialView(fe):this.view.state.viewingMode===Wf.Local&&this.addHandles(p$4J((()=>this.view.basemapTerrain.ready),(()=>{this.removeHandles(RU),this._setInitialView(this.view.dataExtent)}),{once:!0,initial:!0}),RU)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(RU),this._constraintsManager=u$4d(this._constraintsManager))}async goTo(fe,ve){return ve={animate:!0,...ve},null!=this._gotoOperation&&this._gotoOperation.abort(ve.animate),this._gotoOperation=new bU(fe,ve,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(g$22(this.view),{applyConstraints:!1})}step(fe){const ve=this.view.state,_e=null==ve?void 0:ve.cameraController;_e&&(ve.updateCamera((ve=>_e.stepController(fe,ve))),_e.steppingFinished&&_e.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const fe=new Set,ve=[];for(const{propertyName:_e,overrides:be}of PU){const we=fe.has(_e),Se=this._isOverridden(_e);!we&&Se&&ve.push({name:_e,value:this._get(_e)}),this._clearOverride(_e),(we||Se)&&be.forEach((ve=>fe.add(ve)))}return ve}_setInitialView(fe){if(null==fe||this._cameraSetByUser)return;if(fe instanceof Xo)return void this.setStateCamera(Z$v(this.view,fe),{applyConstraints:!1});if(fe instanceof Ra){if(fe.targetGeometry instanceof aa){const ve=we$3(this.view,fe.targetGeometry,0,.5,Pg.LOCKED);return void(null!=ve&&this.setStateCamera(Z$v(this.view,ve),{applyConstraints:!0}))}const ve={applyConstraints:!fe.camera},_e=this._viewpointToCamera(fe);return void this.setStateCamera(_e,ve)}const ve=we$3(this.view,fe,0,.5,Pg.LOCKED);null!=ve&&this.setStateCamera(Z$v(this.view,ve),{applyConstraints:!0})}_updatePropertyBeforeReady(fe,ve){return!this.ready&&(this._override(fe,ve),ve&&EU.has(fe)&&this._override("hasInitialView",!0),!0)}isCompatible(fe){return null!=fe&&(fe instanceof Ra?fe.camera?this.isCompatible(fe.camera):this.isCompatible(fe.targetGeometry):fe instanceof Xo?this.isCompatible(fe.position):fe.spatialReference&&!U$15(fe.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(fe=CU){return this._cameraSetByUser?(fe.heading=this.camera.heading,fe.tilt=this.camera.tilt):(fe.heading=0,fe.tilt=.5),fe}_centerPointAtDistanceToCamera(fe,ve,_e=AU){const{heading:be,tilt:we}=this._getPreservingHeadingTilt(),Se=ce$b(this.view,be,we,fe,ve,Pg.ADJUST);return null==Se?null:(_e.copyFrom(this.view.state.camera),_e.eye=Se.eye,_e.center=Se.center,_e.up=Se.up,_e)}_centerToCamera(fe){const ve=this.view.pointsOfInterest.centerOnContent;ve.runTask();const _e=ve.distance;return this._centerPointAtDistanceToCamera(fe,_e)}_extentToCamera(fe){const{heading:ve,tilt:_e}=this._getPreservingHeadingTilt(),be=we$3(this.view,fe,ve,_e,Pg.ADJUST,OU);return be?Z$v(this.view,be):null}_scaleToCamera(fe){if(null==fe)return null;const ve=this.view.pointsOfInterest.centerOnContent;ve.runTask();const _e=ve.renderLocation,be=ve.location.latitude,we=$$w(this.view,fe,be);return this._centerPointAtDistanceToCamera(_e,we)}_zoomToCamera(fe){return this._scaleToCamera(Ae$2(this.view,fe))}_viewpointToCamera(fe){return Z$v(this.view,lt$8(this.view,fe))}setStateCamera(fe,ve){return!(null==fe||!this.view.state.stopActiveCameraController()||(this._cameraSetByUser=!0,ve.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera((_e=>{ve.positionAndOrientationOnly?(_e.eye=fe.eye,_e.center=fe.center,_e.up=fe.up,_e.fov=fe.fov):_e.copyFrom(fe),ve.applyConstraints&&E$12(this.view,_e)})),ve.applyConstraints||(this.view.state.cameraController=new lU({view:this.view,desiredCamera:fe})),0))}_prepareFrame(){const{surface:fe,canvas:ve}=this.view;if(!fe||!ve)return;this._windowDevicePixelRatio=window.devicePixelRatio;const _e=this._computeCanvasSize();if(0!==_e.width&&0!==_e.height&&(ve.width===_e.width&&ve.height===_e.height||(ve.width=_e.width,ve.height=_e.height),this.view.state)){const fe=this.view.state.camera;fe.fullWidth===_e.width&&fe.fullHeight===_e.height&&fe.pixelRatio===_e.pixelRatio||(AU.copyFrom(fe),AU.pixelRatio!==_e.pixelRatio&&(this._paddingToArray(this.padding,_e.pixelRatio,MU),AU.padding=MU),AU.fullWidth=_e.width,AU.fullHeight=_e.height,AU.pixelRatio=_e.pixelRatio,this.view.state.camera=AU),this._updateViewState()}}_updateElevation(fe){var ve,_e;const be=null==(ve=this.view.basemapTerrain)?void 0:ve.spatialReference,we=(null==(_e=this.view.renderCoordsHelper)?void 0:_e.getAltitude(fe.eye))??0,Se=be?f$2B(this.view,fe.eye):0;fe.relativeElevation=we-Se}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=PM.ANIMATING:this.view.interacting?this.view.state.mode=PM.INTERACTING:(this.view.state.mode===PM.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=PM.INTERACTING:this.view.state.mode=PM.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(fe,ve){fe&&ve&&fe.almostEquals(ve)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};e$4o([y$2v({type:Xo,dependsOn:["view.state.camera","ready"]})],SU.prototype,"camera",null),e$4o([y$2v({type:Xo,dependsOn:["view.state.contentCamera","ready"]})],SU.prototype,"contentCamera",null),e$4o([y$2v({type:Yo})],SU.prototype,"center",null),e$4o([y$2v({type:aa})],SU.prototype,"extent",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"frustum",null),e$4o([y$2v()],SU.prototype,"_constraintsManager",void 0),e$4o([y$2v({readOnly:!0})],SU.prototype,"constraintsManager",null),e$4o([y$2v()],SU.prototype,"_initialViewpoint",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"hasInitialView",null),e$4o([y$2v({readOnly:!0,type:Boolean})],SU.prototype,"ready",void 0),e$4o([y$2v({type:Number})],SU.prototype,"scale",null),e$4o([y$2v({type:Number})],SU.prototype,"terrainScale",null),e$4o([y$2v()],SU.prototype,"padding",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"screenCenter",null),e$4o([y$2v({constructOnly:!0})],SU.prototype,"view",void 0),e$4o([y$2v({type:Ra})],SU.prototype,"viewpoint",null),e$4o([y$2v({type:Number})],SU.prototype,"zoom",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"_rasterPixelRatio",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"_usePhysicalPixelRendering",null),e$4o([y$2v({readOnly:!0})],SU.prototype,"_usePhysicalPixelRenderingAny",null),e$4o([y$2v()],SU.prototype,"_windowDevicePixelRatio",void 0),e$4o([y$2v()],SU.prototype,"_devicePixelRatioOverride",void 0),SU=e$4o([a$4y("esri.views.3d.state.ViewStateManager")],SU);let TU=class X{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const EU=new Set(["camera","viewpoint","extent","scale","center","zoom"]),PU=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],CU={heading:0,tilt:0},OU=new Xo,AU=new NR,MU=[0,0,0,0],RU="pending-initial-view",IU="content-camera-reset",LU=300;let DU=class n15 extends Jz{constructor(){super(...arguments),this.startCamera=new NR,this.currentCamera=new NR,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<100}stepController(fe,ve){ve.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(ve)}onControllerStart(fe){this.state=Xz.Running,this.startCamera.copyFrom(fe),this.currentCamera.copyFrom(fe)}onControllerEnd(fe){fe.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout((()=>this.notifyChange("isInteractive")),100),this.view.state.updateCamera((fe=>this.stepController(0,fe))),this.steppingFinished&&this.finishController()}};var NU;e$4o([y$2v({readOnly:!0})],DU.prototype,"isInteractive",null),e$4o([y$2v()],DU.prototype,"_lastInteraction",void 0),DU=e$4o([a$4y("esri.views.3d.state.controllers.InteractiveController")],DU),function(fe){fe[fe.CENTER=0]="CENTER",fe[fe.EYE=1]="EYE"}(NU||(NU={}));let FU=class H2 extends DU{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(fe){super(fe),this.pivot=NU.CENTER,this._rotScale=0,this._lastPoint=[0,0],this._tmpWorldUp=[0,0,0],this._tmpViewDir=[0,0,0],this._tmpRotCurPoint=[0,0],this._tmpTransf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._tmpAxis=[0,0,0],this._tmpPivotPoint=[0,0,0],this._pivotPos=[0,0,0],this._constraintOptions=new zF(IF.ALL,DF.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===NU.CENTER?3:1.5}begin(fe){if(this.active){switch(this.pivot){case NU.EYE:r$3w(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=DF.LOOK_AROUND,this._constraintOptions.tiltMode=FF.LOOK_AROUND,this._constraintOptions.selection=IF.NONE;break;case NU.CENTER:{const ve=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?lk:{});ve||r$3w(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(fe,ve),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=DF.TUMBLE,this._constraintOptions.tiltMode=FF.TUMBLE,this._constraintOptions.selection=IF.ALL&~IF.DISTANCE;break}}it$a(this.startCamera,fe,this._lastPoint)}}_constrainPivotPoint(fe,ve){const _e=this.startCamera,be=[0,0,0];e$3Z(be,this._pivotPos,_e.eye);const we=s$4g(be),Se=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(_e.eye,kU);let Te=Math.max(Math.min(5,1/Math.abs(P$1g(kU,_e.viewForward)))*Se,10);ve&&(Te=Math.min(we,Te));const Ee=i$4i(_e.width/_e.pixelRatio*.5,_e.height/_e.pixelRatio*.5),Ce=vt$2(this.startCamera,Ee,this.view.renderCoordsHelper,this.view.viewingMode);let Oe=this.view._stage.renderView.getMinimalDepthForArea(o$27(this.view),_e.fullWidth/_e.pixelRatio*.5,_e.fullHeight/_e.pixelRatio*.5,_e,225,90),Re=this.view._stage.renderView.getMinimalDepthForArea(o$27(this.view),fe[0],fe[1],_e,90);null==Oe&&null==Re||(Oe=Oe??Re??0,Re=null==Re||Ce===uk.Horizontal?Oe:Re,Te=Oe>Re?Re:Oe,Te=ve?Math.min(Te,we):Te),z$1d(be,be),r$3w(this._pivotPos,u$3Y(this._tmpPivotPoint,_e.eye,g$2z(this._tmpPivotPoint,be,Te)))}update(fe){if(this.active){switch(this.pivot){case NU.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,fe,this.currentCamera.center,this._pivotPos);break;case NU.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,fe,this.currentCamera.eye,this._pivotPos)}E$12(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(fe,ve,_e,be){this.view.renderCoordsHelper.worldUpAtPosition(be,this._tmpWorldUp),it$a(fe,ve,this._tmpRotCurPoint);let we=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,Se=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;e$3Z(this._tmpViewDir,_e,be);const Te=s$4g(this._tmpViewDir),Ee=m$3J(P$1g(this._tmpViewDir,this._tmpWorldUp)/Te);if(this.pivot===NU.EYE){we*=-.5;const fe=.5*Math.PI-Ee,ve=.5*Math.PI*.99;we=fe-Math.max(-ve,Math.min(ve,fe+we))}return we=e$3Y(we+Ee,NP.min,NP.max)-Ee,_$1z(this._tmpAxis,fe.up,this._tmpViewDir),this.pivot===NU.CENTER&&(Se=-Se),p$4z(this._tmpTransf,Se,this._tmpWorldUp),b$21(this._tmpTransf,this._tmpTransf,we,this._tmpAxis),O$1v(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),fe.up=O$1v(zU,fe.up,this._tmpTransf),u$3Y(zU,be,this._tmpViewDir),r$2C(this._lastPoint,this._tmpRotCurPoint),zU}};e$4o([y$2v()],FU.prototype,"pivot",void 0),FU=e$4o([a$4y("esri.views.3d.state.controllers.RotateController")],FU);const zU=[0,0,0],kU=[0,0,0];let UU=class a11 extends nv{constructor(fe,ve,_e,be){super(!0),this._view=fe,this.pointerAction=ve,this._pivot=_e,this.registerIncoming("drag",be,(fe=>this._handleDrag(fe)))}_handleDrag(fe){const ve=fe.data;if(ve.pointers.size>1)return;if(!r$29(fe.data,this.pointerAction))return;const _e=i$4i(ve.center.x,ve.center.y);switch(ve.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new FU({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(_e);break;case"update":this._cameraController&&this._cameraController.update(_e);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}fe.stopPropagation()}},VU=class B4 extends DU{constructor(){super(...arguments),this._pickPoint=[0,0,0],this._tmpP0=[0,0],this._panAxisAngle=s$2C(),this._tmpRayDir=[0,0,0],this._tmpRayDirPick=[0,0,0],this._targetOnSphere=[0,0,0],this._navMode=uk.Horizontal,this._tmpRay={origin:[0,0,0],direction:[0,0,0]},this.dragBeginPoint=i$4i(),this._normalizedAnchorPoint=[0,0],this._constraintOptions=new zF(IF.ALL_EXCEPT_COLLISION,DF.ZOOM,0,this.startCamera),this._sphere=[0,0,0,0],this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(fe){if(!this.active)return;r$2C(this.dragBeginPoint,fe),it$a(this.startCamera,fe,this._normalizedAnchorPoint);const ve=s$45(this.view.spatialReference),_e=jt$4(this._intersectionHelper,this.startCamera,fe,ve,nk.Ellipsoid,0===this.view.map.ground.opacity?lk:{});if(this._navMode=vt$2(this.startCamera,fe,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===uk.Horizontal)this._hasPickPoint=!!_e.scenePickPoint,this._pickPoint=_e.scenePickPoint??this._pickPoint,this._sphere=_e.sphere;else{let ve;p$2H(this.startCamera,fe,this._tmpRay),z$1d(this._tmpRay.direction,this._tmpRay.direction),null!=_e.scenePickPoint&&(e$3Z(this._tmpRayDirPick,this.startCamera.eye,_e.scenePickPoint),ve=s$4g(this._tmpRayDirPick));const be=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,jU);let we=e$3Y(Math.min(30,1/Math.abs(P$1g(jU,this._tmpRay.direction)))*be,sk[0],sk[1]);const Se=this.view._stage.renderView.getMinimalDepthForArea(null,fe[0],fe[1],this.view.state.camera,80);we=null!=Se?Se:we,we=null!=ve?Math.min(we,ve):we,this._hasPickPoint=!0,g$2z(this._tmpRay.direction,this._tmpRay.direction,we),u$3Y(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(fe){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===uk.Horizontal){e$3Z(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const ve=s$4g(this._tmpRayDir);it$a(this.currentCamera,fe,this._tmpP0);const _e=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let be=ve*2**_e;const we=this.view.state.constraints.minimumPoiDistance;if(_e<0&&be<we&&(be=we),Math.abs(ve-be)<1e-6)return;if(this._hasPickPoint&&be<ve){const fe=1-(1-be/ve)*(1-this._sphere[3]/s$4g(this.currentCamera.center));this.currentCamera.center=g$2z(BU,this.currentCamera.center,fe)}g$2z(this._tmpRayDir,this._tmpRayDir,-be/ve),this.currentCamera.eye=u$3Y(BU,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=y$1g(m$2r(this.dragBeginPoint,fe)),E$12(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(wt$5(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),l$2D(this._pickPoint,this._targetOnSphere,this._panAxisAngle),ct$8(this.currentCamera,this._sphere,this._panAxisAngle))}else{const ve=s$4g(this._tmpRay.direction);it$a(this.currentCamera,fe,this._tmpP0);const _e=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let be=ve*2**_e;const we=this.view.state.constraints.minimumPoiDistance;if(_e<0&&be<we&&(be=we),Math.abs(ve-be)<1e-6)return;g$2z(this._tmpRayDir,this._tmpRay.direction,1-be/ve),this.currentCamera.eye=u$3Y(BU,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=u$3Y(BU,this.currentCamera.center,this._tmpRayDir)}s$2I(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};VU=e$4o([a$4y("esri.views.3d.state.controllers.ZoomControllerGlobal")],VU);const BU=[0,0,0],jU=[0,0,0];let GU=class z4 extends DU{constructor(){super(...arguments),this._tmpP=[0,0,0],this._tmpDir=[0,0,0],this._tmpN=[0,0,0],this._tmpP0=[0,0],this._tmpPoi=[0,0,0],this._tmpRayDir=[0,0,0],this.dragBeginPoint=i$4i(),this._normalizedAnchorPoint=[0,0],this._constraintOptions=new zF(IF.ALL,DF.ZOOM,0,this.startCamera,[0,0,0]),this._plane=E$1z()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(fe){if(!this.active)return;r$2C(this.dragBeginPoint,fe),it$a(this.startCamera,fe,this._normalizedAnchorPoint);const ve=this._intersectionHelper.intersectScreenFreePointFallback(fe,this._tmpP,0===this.view.map.ground.opacity?lk:{});e$3Z(this._tmpDir,this._tmpP,this.startCamera.eye);const _e=s$4g(this._tmpDir);z$1d(this._tmpDir,this._tmpDir);const be=Math.abs(this.view.camera.position.z);let we=e$3Y(Math.min(30,1/Math.abs(P$1g(qU,this._tmpDir)))*be,sk[0],sk[1]);const Se=this.view._stage.renderView.getMinimalDepthForArea(o$27(this.view),fe[0],fe[1],this.view.state.camera,80);we=null!=Se?Se:we,we=ve?Math.min(we,_e):we,g$2z(this._tmpDir,this._tmpDir,we),u$3Y(this._tmpP,this.startCamera.eye,this._tmpDir),e$3Z(this._tmpN,this.startCamera.eye,this.startCamera.center),z$1d(this._tmpN,this._tmpN),this._tmpN[1]<0&&j$1O(this._tmpN,this._tmpN),j$1w(this._tmpP,this._tmpN,this._plane)}update(fe){if(!this.active)return;(function lt$9(fe,ve,_e,be){return S$1E(fe,g$1o(ve,_e,zk),be)})(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||r$3w(this._tmpPoi,this.currentCamera.center),it$a(this.currentCamera,fe,this._tmpP0);let ve=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);r$2C(this._normalizedAnchorPoint,this._tmpP0),e$3Z(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const _e=s$4g(this._tmpRayDir);let be=_e*(1-ve);this._constraintOptions.interactionDirection&&(r$3w(this._constraintOptions.interactionDirection,this._tmpRayDir),g$2z(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(ve)/_e));const we=this.view.state.constraints.minimumPoiDistance;ve>=0&&be<we&&(be=we,ve=-(be-_e)/_e),Math.abs(_e-be)<1e-6||(g$2z(this._tmpRayDir,this._tmpRayDir,ve),this.currentCamera.eye=u$3Y(HU,this.currentCamera.eye,this._tmpRayDir),A$1G(HU,this.currentCamera.center,this._tmpPoi,ve),this._tmpPoi[2]>this.startCamera.center[2]?HU[2]=Math.max(this.startCamera.center[2],HU[2]):HU[2]=Math.min(this.startCamera.center[2],HU[2]),this.currentCamera.center=HU,this._constraintOptions.interactionFactor=y$1g(m$2r(this.dragBeginPoint,fe)),E$12(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};GU=e$4o([a$4y("esri.views.3d.state.controllers.ZoomControllerLocal")],GU);const HU=[0,0,0],qU=r$3y(0,0,1);let WU=class s30 extends nv{constructor(fe,ve,_e){super(!0),this._view=fe,this.pointerAction=ve,this.registerIncoming("drag",_e,(fe=>this._handleDrag(fe)))}_handleDrag(fe){const ve=fe.data;if(ve.pointers.size>1)return;if(!r$29(fe.data,this.pointerAction))return;const _e=i$4i(ve.center.x,ve.center.y);switch(ve.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new VU({view:this._view}):this._cameraController=new GU({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(_e);break;case"update":this._cameraController&&this._cameraController.update(_e);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}fe.stopPropagation()}};function n$2H(fe){let ve=fe*fe;return fe<0&&(ve*=-1),ve}function i$2w(fe,ve,_e){const be=_e,we=fe.state,Se=fe.device,Te="forward-down"===ve.tiltDirection?1:-1;return"standard"===Se.deviceType?(be.translation[0]=n$2H(we.axes[0]),be.translation[1]=n$2H(we.axes[1]),be.translation[2]=n$2H(we.buttons[7])-n$2H(we.buttons[6]),be.heading=n$2H(we.axes[2]),be.tilt=n$2H(we.axes[3])):"spacemouse"===Se.deviceType&&(be.translation[0]=1.2*n$2H(we.axes[0]),be.translation[1]=1.2*n$2H(we.axes[1]),be.translation[2]=2*-n$2H(we.axes[2]),be.heading=1.2*n$2H(we.axes[5]),be.tilt=1.2*n$2H(we.axes[3])),be.tilt*=Te,g$2z(be.translation,be.translation,1),be}function o$25(fe,ve){const _e=ve;return _e.translation[0]=fe[1]-fe[0],_e.translation[1]=fe[3]-fe[2],_e.translation[2]=fe[4]-fe[5],_e.heading=fe[7]-fe[6],_e.tilt=fe[8]-fe[9],_e.zoom=fe[10]-fe[11],_e}function s$2x(fe){return 0===fe.translation[0]&&0===fe.translation[1]&&0===fe.translation[2]&&0===fe.heading&&0===fe.tilt&&0===fe.zoom}let YU=class J extends DU{constructor(fe){super(fe),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new NR,this._headingStart=0,this._constraintOptions=new zF(IF.ALL,DF.NONE,0,new NR,null,FF.LOOK_AROUND)}handleEventGamepad(fe){const ve=i$2w(fe,this.view.navigation.gamepad,this._transformation);("end"===fe.action||s$2x(ve))&&this.finishController()}activateDirection(fe){this._keysButtonState[fe]=1,o$25(this._keysButtonState,this._transformation)}deactivateDirection(fe){this._keysButtonState[fe]=0;s$2x(o$25(this._keysButtonState,this._transformation))&&this.finishController()}onControllerStart(fe){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(fe)}_updateFilteredSurfaceElevation(fe){const ve=this.view.pointsOfInterest.cameraOnSurface.location.z;this._filteredSurfaceElevation+=1*(ve-this._filteredSurfaceElevation)*fe}stepController(fe,ve){var _e;this._updateStartHeading(),this._updateFilteredSurfaceElevation(fe),this.currentCamera.copyViewFrom(ve),this._updateCameraCenter(),null==(_e=this._constraintOptions.interactionStartCamera)||_e.copyFrom(this.currentCamera),this._calculateControlTransformation(fe,this.currentCamera,rV),this._applyDisabledMovementTypes(rV),this._applyPan(rV.pan),this._applyRotate(rV.rotate),this._applyZoom(rV.zoom),this._applyAscend(rV.ascend),this._constraintOptions.interactionType=DF.NONE,this._constraintOptions.selection=IF.COLLISION,E$12(this.view,this.currentCamera,this._constraintOptions),super.stepController(fe,ve)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(fe){if(!fe.enabled)return;const ve=this.currentCamera;e$3Z(iV,ve.center,ve.eye),O$1v(iV,iV,fe.matrix),ve.center=u$3Y(iV,iV,ve.eye),ve.up=O$1v(iV,ve.up,fe.matrix),this._constraintOptions.interactionType=DF.LOOK_AROUND,this._constraintOptions.selection=IF.ALL_EXCEPT_COLLISION,E$12(this.view,ve,this._constraintOptions)}_applyPan(fe,ve=this.currentCamera){fe.enabled&&(ve.eye=O$1v(iV,ve.eye,fe.matrix),ve.center=O$1v(iV,ve.center,fe.matrix),this.view.state.isGlobal&&(ve.up=O$1v(iV,ve.up,fe.matrix)),this._constraintOptions.interactionType=DF.PAN,this._constraintOptions.selection=IF.ALL,E$12(this.view,ve,this._constraintOptions))}_applyZoom(fe){if(!fe)return;const ve=this.currentCamera.viewForward;this.currentCamera.eye=u$3Y(iV,this.currentCamera.eye,g$2z(Pd.get(),ve,fe)),r$3w(nV,ve),j$1O(nV,nV),this._constraintOptions.interactionDirection=nV,this._constraintOptions.interactionType=DF.ZOOM,this._constraintOptions.selection=IF.ALL_EXCEPT_COLLISION,E$12(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(fe){if(!fe)return;const ve=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Pd.get());if(this._constraintOptions.interactionDirection=r$3w(nV,ve),this.view.state.isGlobal){const ve=s$4g(this.currentCamera.eye),_e=(ve+fe)/ve;this.currentCamera.eye=g$2z(iV,this.currentCamera.eye,_e),this.currentCamera.center=g$2z(iV,this.currentCamera.center,_e)}else{const _e=g$2z(Pd.get(),ve,fe);this.currentCamera.eye=u$3Y(iV,this.currentCamera.eye,_e),this.currentCamera.center=u$3Y(iV,this.currentCamera.center,_e)}this._updateCameraCenter(),this._constraintOptions.interactionType=DF.ASCEND,this._constraintOptions.selection=IF.COLLISION,E$12(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=IF.ALL_EXCEPT_COLLISION,E$12(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(fe,ve,_e){!function nt$9(fe){fe.zoom=0,fe.ascend=0,fe.pan.enabled=!1,o$3E(fe.pan.matrix),fe.rotate.enabled=!1,o$3E(fe.rotate.matrix)}(_e);const be=this._computeVelocities(fe);this.view.state.isLocal?this._calculateControlTransformationLocal(be,ve,_e):this._calculateControlTransformationGlobal(be,ve,_e)}_updateCameraCenter(){const fe=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,ve=this.view.renderCoordsHelper,_e=this.currentCamera.ray;this.currentCamera.center=ve.intersectManifoldClosestSilhouette(_e,fe,iV)}_calculateControlTransformationLocal(fe,ve,_e){const{viewRight:be,viewForward:we}=ve,Se=this._transformation,Te=this.view.navigation.gamepad,Ee=o$44(Pd.get(),we[0],we[1],0);z$1d(Ee,Ee);const Ce=Se.translation[0]*fe.pan;if(0!==Ce){const fe=g$2z(Pd.get(),be,Ce);i$45(_e.pan.matrix,_e.pan.matrix,fe),_e.pan.enabled=!0}switch(Te.mode){case"pan":{const ve=-Se.translation[1]*fe.pan;if(0!==ve){const fe=g$2z(Pd.get(),Ee,ve);i$45(_e.pan.matrix,_e.pan.matrix,fe),_e.pan.enabled=!0}_e.zoom=Se.zoom*fe.zoom;break}case"zoom":_e.zoom=(-Se.translation[1]+Se.zoom)*fe.zoom;break;default:Te.mode}const Oe=Se.translation[2]*fe.ascend;_e.ascend=Oe;const Re=-Se.heading*fe.rotate;0!==Re&&(b$21(_e.rotate.matrix,_e.rotate.matrix,Re,this.view.renderCoordsHelper.worldUpAtPosition(ve.eye,Pd.get())),_e.rotate.enabled=!0);const De=Se.tilt*fe.rotate,Be=c$2E(this.view.renderCoordsHelper,ve.center,ve.eye),Ze=e$3Y(Be+De,NP.min,NP.max)-Be;Ze&&(b$21(_e.rotate.matrix,_e.rotate.matrix,Ze,be),_e.rotate.enabled=!0)}_calculateControlTransformationGlobal(fe,ve,_e){const{eye:be,viewRight:we}=ve,Se=this._transformation,Te=this.view.navigation.gamepad,Ee=_$1z(Pd.get(),we,be);z$1d(Ee,Ee),j$1O(Ee,Ee),Bt$3(this.startCamera,ve,Se,fe,this.view.camera.heading,this._headingStart,this.view.camera.tilt,_e,Te),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(rV.pan,this._tmpCamera);const Ce=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,Oe=Se.translation[2]*fe.ascend;_e.ascend=Oe;const Re=-Se.heading*fe.rotate;0!==Re&&(b$21(_e.rotate.matrix,_e.rotate.matrix,Re,this._tmpCamera.eye),_e.rotate.enabled=!0);const De=Se.tilt*fe.rotate,Be=this._clampTiltDeltaGlobalToValidRange(De,ve.ray,Ce);0!==Be&&(b$21(_e.rotate.matrix,_e.rotate.matrix,Be,this._tmpCamera.viewRight),_e.rotate.enabled=!0),_e.zoom+=Se.zoom*fe.zoom}_clampTiltDeltaGlobalToValidRange(fe,ve,_e){const be=s$45(this.view.spatialReference),we=Mt$5(NP.min,ve.origin,_e,be);let Se=0,Te=0;const Ee=Pd.get();if(this.view.renderCoordsHelper.intersectManifold(ve,_e,Ee)){Se=Mt$5(c$2E(this.view.renderCoordsHelper,Ee,ve.origin),ve.origin,_e,be),Te=Mt$5(NP.max,ve.origin,_e,be)}else{J$C(L$15(Ap,_e+be.radius),ve,Ee);Se=gt$8(Math.PI+f$2J(ve.direction,Ee),ve.origin,_e,be),Te=gt$8(NP.max,ve.origin,_e,be)}return e$3Y(Se+fe,we,Te)-Se}_getPointAbsoluteSurfaceElevation(fe,ve,_e){const{renderCoordsHelper:be}=this.view,we=be.getAltitude(fe),Se=ve+Math.abs(we-ve);return be.setAltitude(_e,Se,fe),Se}_clampedDistanceToSurface(fe,ve){const{renderCoordsHelper:_e}=this.view,{camera:be}=this.view.state,{direction:we}=N$X(this.view,ve,0,XU,sV),Se=x$1W(ve,_e.intersectManifoldClosestSilhouette(l$3V(ve,we),fe,Pd.get())),Te=x$1W(ve,_e.intersectManifoldClosestSilhouette(l$3V(ve,J$M(Pd.get(),ve,be.center)),fe,Pd.get()));return Math.min(Se,Te)}_computeHeadingRotateRadius(fe){const{renderCoordsHelper:ve,state:_e}=this.view,{camera:be,isGlobal:we}=_e,Se=ve.intersectManifoldClosestSilhouette(be.ray,this._filteredSurfaceElevation,Pd.get());if(we){const ve=e$3Z(Pd.get(),fe,Se),_e=s$4g(ve);g$2z(ve,ve,1/_e);const be=m$3J(P$1g(z$1d(Pd.get(),fe),ve));return _e*Math.sin(Math.min(JU,be))}{const _e=r$3w(Pd.get(),fe);return ve.setAltitude(_e,this._filteredSurfaceElevation),x$1W(Se,_e)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:KU}_computeVelocities(fe){const ve=this._filteredSurfaceElevation,_e=ve+s$45(this.view.spatialReference).radius,{camera:be,isGlobal:we}=this.view.state,Se=Pd.get(),Te=this._getPointAbsoluteSurfaceElevation(be.eye,ve,Se),Ee=this._clampedDistanceToSurface(ve,Se),Ce=be.width/2,Oe=QU*be.width,Re=QU*be.width,De=Ee*Math.tan(.5*be.fovX)/Ce,Be=De/_e,Ze=De/this._computeHeadingRotateRadius(Se),Xe=Te-ve;return{pan:(we?Be:De)*Oe*fe,ascend:Math.max(this._minimumAscendVelocity()*fe,2**(Oe*fe/Ce)*Xe-Xe),zoom:2**(Oe*fe/Ce)*Ee-Ee,rotate:e$3Y(Ze*Re,eV,tV)*fe}}_applyDisabledMovementTypes(fe){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(fe.zoom=this.disableMovements.zoom?0:fe.zoom,fe.ascend=this.disableMovements.ascend?0:fe.ascend,fe.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&o$3E(fe.pan.matrix),fe.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&o$3E(fe.rotate.matrix))}static activatesFor(fe,ve){const _e=i$2w(ve,fe.navigation.gamepad,ZU);return!("end"===ve.action||s$2x(_e))}};e$4o([y$2v({constructOnly:!0})],YU.prototype,"gamepadDevice",void 0),e$4o([y$2v({constructOnly:!0})],YU.prototype,"disableMovements",void 0),YU=e$4o([a$4y("esri.views.3d.state.controllers.GamepadKeyboardController")],YU);const ZU={translation:[0,0,0],heading:0,tilt:0,zoom:0},XU=80,JU=h$2U(XU),QU=.75,KU=5,eV=h$2U(30),tV=h$2U(80),rV={zoom:0,ascend:0,pan:{enabled:!1,matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},rotate:{enabled:!1,matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},iV=[0,0,0],nV=[0,0,0],sV={direction:[0,0,0],up:[0,0,0]};let oV=class n16 extends nv{constructor(fe){super(!0),this._view=fe,this._watchHandles=new jt,this._handle=this.registerIncoming("gamepad",(fe=>this._handleEventGamepad(fe))),this._handle.pause()}onInstall(fe){super.onInstall(fe),this._watchHandles.add([d$3d((()=>this._view.navigation.gamepad.enabled),(fe=>{fe?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))}),Xa),d$3d((()=>this._view.navigation.gamepad.device),(fe=>{this._cameraControllerGamepad&&fe&&this._cameraControllerGamepad.gamepadDevice!==fe&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)}))])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(fe){var ve;const _e=this._view.navigation.gamepad.device;if(_e&&fe.data.device!==_e)return;const be=null==(ve=this._cameraControllerGamepad)?void 0:ve.active;if(be||YU.activatesFor(this._view,fe.data)){if(!be){const ve=new YU({view:this._view,gamepadDevice:fe.data.device});this._view.state.switchCameraController(ve)&&(this._cameraControllerGamepad=ve)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===fe.data.device&&this._cameraControllerGamepad.handleEventGamepad(fe.data)}}};var aV;!function(fe){fe[fe.LEFT=0]="LEFT",fe[fe.RIGHT=1]="RIGHT",fe[fe.FORWARD=2]="FORWARD",fe[fe.BACKWARD=3]="BACKWARD",fe[fe.UP=4]="UP",fe[fe.DOWN=5]="DOWN",fe[fe.HEADINGLEFT=6]="HEADINGLEFT",fe[fe.HEADINGRIGHT=7]="HEADINGRIGHT",fe[fe.TILTUP=8]="TILTUP",fe[fe.TILTDOWN=9]="TILTDOWN",fe[fe.ZOOMIN=10]="ZOOMIN",fe[fe.ZOOMOUT=11]="ZOOMOUT"}(aV||(aV={}));let lV=class i22 extends nv{constructor(fe,ve){super(!0),this._view=fe,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Wf.Local},this._keyToNumber={[ve.left]:aV.LEFT,[ve.right]:aV.RIGHT,[ve.forward]:aV.FORWARD,[ve.backward]:aV.BACKWARD,[ve.up]:aV.UP,[ve.down]:aV.DOWN,[ve.headingLeft]:aV.HEADINGLEFT,[ve.headingRight]:aV.HEADINGRIGHT,[ve.tiltUp]:aV.TILTUP,[ve.tiltDown]:aV.TILTDOWN,[ve.zoomIn]:aV.ZOOMIN,[ve.zoomOut]:aV.ZOOMOUT},this.registerIncoming("key-down",null,(fe=>this._handleKeyDown(fe))),this.registerIncoming("key-up",null,(fe=>this._handleKeyUp(fe))),this.registerIncoming("blur",null,(()=>this._handleStop())),this._visibilityHandle=function i$2v(fe){const t84=()=>fe("visible"===document.visibilityState);return document.addEventListener("visibilitychange",t84),e$4e((()=>document.removeEventListener("visibilitychange",t84)))}((fe=>fe?null:this._handleStop()))}onUninstall(){var fe;null==(fe=this._visibilityHandle)||fe.remove(),this._handleStop()}_handleKeyDown(fe){if(fe.data.native.ctrlKey||fe.data.native.metaKey)return;const ve=this._keyToNumber[fe.data.key];null!=ve&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new YU({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(ve),fe.stopPropagation()))}_handleStop(){var fe;(null==(fe=this._cameraControllerKeyboard)?void 0:fe.active)&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(fe){var ve;if(fe.data.native.ctrlKey||fe.data.native.metaKey)return;const _e=this._keyToNumber[fe.data.key];null!=_e&&(null==(ve=this._cameraControllerKeyboard)?void 0:ve.active)&&(this._cameraControllerKeyboard.deactivateDirection(_e),fe.stopPropagation())}},cV=class i23 extends nv{constructor(fe,ve){super(!0),this._view=fe,this.registerIncoming("mouse-wheel",ve,(fe=>this._handleMouseWheel(fe)))}_handleMouseWheel(fe){if(!this._view.navigation.mouseWheelZoomEnabled)return;const ve=fe.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new Uk({view:this._view,mode:"interaction"}):new qk({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*ve.deltaY,i$4i(ve.x,ve.y)),fe.preventDefault(),fe.stopPropagation()}},uV=class t31{constructor(fe){this._gain=fe}reset(fe){this._value=fe}set gain(fe){this._gain=fe}get value(){return void 0===this._value?0:this._value}update(fe){void 0===this._value?this._value=fe:this._value=this._gain*fe+(1-this._gain)*this._value}},hV=class p20 extends Qz{constructor(){super(...arguments),this._beginCamera=new NR,this._elapsedTimeSec=0,this.constraintOptions=new zF(IF.ALL,DF.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new PP}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(fe){this._beginCamera.copyFrom(fe),super.onControllerStart(fe)}stepController(fe,ve){ve.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=fe,this.momentumStep(this._elapsedTimeSec,ve),E$12(this.view,ve,this.constraintOptions)}};hV=e$4o([a$4y("esri.views.3d.state.controllers.momentum.MomentumController")],hV);let dV=class c22 extends hV{constructor(fe){super(fe),this.interactionType=DF.PAN,this._tmpPan=[0,0,0]}momentumStep(fe,ve){const _e=this.momentum.value(fe);g$2z(this._tmpPan,this.momentum.direction,_e),ve.eye=e$3Z(pV,ve.eye,this._tmpPan),ve.center=e$3Z(pV,ve.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};e$4o([y$2v({constructOnly:!0})],dV.prototype,"momentum",void 0),dV=e$4o([a$4y("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],dV);const pV=[0,0,0],fV=[0,0,0],mV=[0,0,0];let yV=class l12 extends hV{constructor(fe){super(fe),this.interactionType=DF.PAN}momentumStep(fe,ve){const _e=this.momentum.value1(fe),be=this.momentum.value2(fe);r$3w(mV,ve.eye),z$1d(mV,mV),_$1z(this.momentum.axis2,mV,this.momentum.axis1),qt$2(ve,fV,this.momentum.axis1,_e,this.momentum.axis2,be)}};e$4o([y$2v({constructOnly:!0})],yV.prototype,"momentum",void 0),yV=e$4o([a$4y("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],yV);let gV=class c23 extends hV{set center(fe){this._set("center",t$47(fe))}set axis(fe){this._set("axis",t$47(fe))}constructor(fe){super(fe),this.interactionType=DF.TUMBLE}momentumStep(fe,ve){const _e=this.momentum.value(fe);ct$8(ve,this.center,m$26(this.axis,_e))}};e$4o([y$2v({constructOnly:!0})],gV.prototype,"momentum",void 0),e$4o([y$2v({constructOnly:!0})],gV.prototype,"center",null),e$4o([y$2v({constructOnly:!0})],gV.prototype,"axis",null),gV=e$4o([a$4y("esri.views.3d.state.controllers.momentum.RotationMomentumController")],gV);let vV=class p21 extends hV{set zoomCenter(fe){this._set("zoomCenter",t$47(fe))}constructor(fe){super(fe),this.interactionType=DF.ZOOM,this.constraintOptions.interactionDirection=[0,0,0]}momentumStep(fe,ve){const{interactionDirection:_e}=this.constraintOptions;if(!_e)return;r$3w(_e,ve.eye);const be=this.momentum.valueDelta(0,fe);ut$8(ve,this.zoomCenter,be,this.view.state.constraints.minimumPoiDistance),J$M(_e,ve.eye,_e)}};e$4o([y$2v({constructOnly:!0})],vV.prototype,"momentum",void 0),e$4o([y$2v({constructOnly:!0})],vV.prototype,"zoomCenter",null),vV=e$4o([a$4y("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],vV);let _V=class C4 extends hV{set screenCenter(fe){this._set("screenCenter",i$4i(fe[0],fe[1]))}set sceneCenter(fe){this._set("sceneCenter",t$47(fe))}constructor(fe){super(fe),this.interactionType=DF.ZOOM,this.radius=0,this._tmpSceneCenter=[0,0,0],this._tmpZoomAxisAngle=s$2C(),this._sphere=[0,0,0,0]}initialize(){this._sphere[3]=this.radius}momentumStep(fe,ve){const _e=this.momentum.valueDelta(0,fe);ft$7(this._sphere,ve,_e),this.constraintOptions.interactionType=DF.ZOOM,E$12(this.view,ve,this.constraintOptions),wt$5(this._sphere,ve,this.screenCenter,this._tmpSceneCenter),l$2D(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),ct$8(ve,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=DF.PAN}};e$4o([y$2v({constructOnly:!0})],_V.prototype,"momentum",void 0),e$4o([y$2v({constructOnly:!0})],_V.prototype,"screenCenter",null),e$4o([y$2v({constructOnly:!0})],_V.prototype,"sceneCenter",null),e$4o([y$2v({constructOnly:!0})],_V.prototype,"radius",void 0),_V=e$4o([a$4y("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],_V);let $V=class t32{constructor(fe){this._gain=fe,this.lastValue=void 0,this.filteredDelta=void 0}update(fe){if(this.hasLastValue()){const ve=this.computeDelta(fe);this._updateDelta(ve)}this.lastValue=fe}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(fe){return void 0===this.lastValue?NaN:fe-this.lastValue}_updateDelta(fe){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*fe:this.filteredDelta=fe}},bV=class t33{constructor(fe,ve,_e){this._initialVelocity=fe,this._stopVelocity=ve,this._friction=_e,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(fe){return fe>this.duration}get friction(){return this._friction}value(fe){return this.valueFromInitialVelocity(this._initialVelocity,fe)}valueDelta(fe,ve){const _e=this.value(fe);return this.value(fe+ve)-_e}valueFromInitialVelocity(fe,ve){ve=Math.min(ve,this.duration);const _e=1-this.friction;return fe*(_e**ve-1)/Math.log(_e)}},wV=class l13 extends bV{constructor(fe,ve,_e,be,we){super(fe,ve,_e),this._sceneVelocity=be,this.direction=we}value(fe){return super.valueFromInitialVelocity(this._sceneVelocity,fe)}},xV=class c24{constructor(fe=300,ve=12,_e=.84){this._minimumInitialVelocity=fe,this._stopVelocity=ve,this._friction=_e,this.enabled=!0,this._time=new $V(.6),this._screen=[new $V(.4),new $V(.4)],this._scene=[new $V(.6),new $V(.6),new $V(.6)],this._tmpDirection=[0,0,0]}add(fe,ve,_e){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(_e)<.015)return;this._screen[0].update(fe[0]),this._screen[1].update(fe[1]),this._scene[0].update(ve[0]),this._scene[1].update(ve[1]),this._scene[2].update(ve[2]),this._time.update(_e)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const fe=this._screen[0].filteredDelta,ve=this._screen[1].filteredDelta,_e=null==fe||null==ve?0:Math.sqrt(fe*fe+ve*ve),be=this._time.filteredDelta,we=null==be||null==_e?0:_e/be;return Math.abs(we)<this._minimumInitialVelocity?null:this.createMomentum(we,this._stopVelocity,this._friction)}createMomentum(fe,ve,_e){o$44(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const be=s$4g(this._tmpDirection);be>0&&g$2z(this._tmpDirection,this._tmpDirection,1/be);const we=this._time.filteredDelta;return new wV(fe,ve,_e,null==we?0:be/we,this._tmpDirection)}},SV=class e21{constructor(fe){this._gain=fe}update(fe){void 0!==this.filteredValue?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*fe:this.filteredValue=fe}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}};const TV=1e-5;let EV=class u13 extends bV{constructor(fe,ve,_e,be,we,Se=0,Te){super(fe,ve,_e),this._angularVelocity1=be,this.axis1=we,this.angularVelocity2=Se,this.axis2=Te}value1(fe){return super.valueFromInitialVelocity(this._angularVelocity1,fe)}value2(fe){return super.valueFromInitialVelocity(this.angularVelocity2,fe)}},PV=class o17{constructor(fe=300,ve=12,_e=.84){this._minimumInitialVelocity=fe,this._stopVelocity=ve,this._friction=_e,this.enabled=!0,this._tmpAxis1=[0,0,0],this._tmpAxis2=[0,0,0],this._tmpAngles=[0,0],this._time=new $V(.3),this._screen=[new $V(.4),new $V(.4)],this._angle1=new SV(.6),this._angle2=new SV(.6),this._axis1=[0,0,0],this._axis2=[0,0,0],this._lastScene=[0,0,0]}addMomentumDirectRotation(fe,ve,_e,be,we,Se){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(_e)<.01)return;let fe=Et$3(this._lastScene,ve,this._tmpAxis2,be,we,Se);this._angle2.update(0),v$22(this._tmpAxis2)<TV?fe=0:z$1d(this._axis1,this._tmpAxis2),this._angle1.update(fe),r$3w(this._lastScene,ve)}this._screen[0].update(fe[0]),this._screen[1].update(fe[1]),this._time.update(_e)}}addMomentumPreserveHeading(fe,ve,_e,be,we,Se,Te){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(_e)<.01)return;Gt$3(this._lastScene,ve,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,be,we,Se,Te,!1),v$22(this._tmpAxis2)<TV?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),z$1d(this._axis1,this._tmpAxis1),z$1d(this._axis2,this._tmpAxis2)),r$3w(this._lastScene,ve)}this._screen[0].update(fe[0]),this._screen[1].update(fe[1]),this._time.update(_e)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const fe=this._screen[0].filteredDelta,ve=this._screen[1].filteredDelta,_e=null==fe||null==ve?null:Math.sqrt(fe*fe+ve*ve),be=this._time.filteredDelta,we=null==_e||null==be?0:_e/be;return Math.abs(we)<this._minimumInitialVelocity?null:this.createMomentum(we,this._stopVelocity,this._friction)}createMomentum(fe,ve,_e){const be=this._time.filteredDelta,we=this._angle1.filteredValue,Se=this._angle2.filteredValue,Te=null==be||null==Se?0:Se/be;return new EV(fe,ve,_e,null==be||null==we?0:we/be,this._axis1,Te,this._axis2)}},CV=class s31{constructor(fe=2.5,ve=.01,_e=.95,be=12){this._minimumInitialVelocity=fe,this._stopVelocity=ve,this._friction=_e,this._maxVelocity=be,this.enabled=!0,this.value=new $V(.8),this.time=new $V(.3)}add(fe,ve){if(this.enabled&&null!=ve){if(this.time.hasLastValue()){if(this.time.computeDelta(ve)<.01)return;if(this.value.hasFilteredDelta()){const ve=this.value.computeDelta(fe);this.value.filteredDelta*ve<0&&this.value.reset()}}this.time.update(ve),this.value.update(fe)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let fe=this.value.filteredDelta/this.time.filteredDelta;return fe=e$3Y(fe,-this._maxVelocity,this._maxVelocity),Math.abs(fe)<this._minimumInitialVelocity?null:this.createMomentum(fe,this._stopVelocity,this._friction)}createMomentum(fe,ve,_e){return new bV(fe,ve,_e)}},OV=class a12 extends CV{constructor(fe=3,ve=.01,_e=.95,be=12){super(fe,ve,_e,be)}add(fe,ve){const _e=this.value.lastValue;if(null!=_e){let ve=fe-_e;for(;ve>Math.PI;)ve-=2*Math.PI;for(;ve<-Math.PI;)ve+=2*Math.PI;fe=_e+ve}super.add(fe,ve)}},AV=class r14 extends bV{constructor(fe,ve,_e){super(fe,ve,_e)}value(fe){const ve=super.value(fe);return Math.exp(ve)}valueDelta(fe,ve){const _e=super.value(fe),be=super.value(fe+ve)-_e;return Math.exp(be)}},MV=class s32 extends CV{constructor(fe=2.5,ve=.01,_e=.95,be=12){super(fe,ve,_e,be)}add(fe,ve){super.add(Math.log(fe),ve)}createMomentum(fe,ve,_e){return new AV(fe,ve,_e)}},RV=class rt2 extends DU{constructor(){super(...arguments),this._smoothRotation=new uV(.05),this._rotationAxis=[0,0,0],this._beginAngle=0,this._beginHeading=0,this._panningPlane=E$1z(),this._beginRadius=0,this._smoothScaling=new uV(.05),this._zoomCenterScreen=i$4i(),this._zoomMomentumEstimator=new MV,this._rotationMomentumEstimator=new OV,this._panSphericalMomentumEstimator=new PV,this._panPlanarMomentumEstimator=new xV,this._adjustedSphere=[0,0,0,0],this._tmp3d=[0,0,0],this._tmpScreenPointArray=i$4i(),this._beginScreenPoint=i$4i(),this._beginScenePoint=[0,0,0],this._screenPickPoint=i$4i(),this._scenePickPoint=[0,0,0],this._navMode=uk.Horizontal,this._sphere=[0,0,0,0],this._pointerCount=0,this._tmpInteractionDirection=[0,0,0],this._beginCamera=new NR,this._constraintOptions=new zF(IF.ALL,DF.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(fe){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-wn.normalize(h$2U(this.view.camera.heading)),this._beginRadius=fe.radius,this._pointerCount=fe.pointers.size,this._beginAngle=fe.angle,this._smoothRotation.reset(),d$3c(fe.center,this._screenPickPoint),r$2C(this._beginScreenPoint,this._screenPickPoint);const ve=s$45(this.view.spatialReference),_e=jt$4(this._intersectionHelper,this.startCamera,this._screenPickPoint,ve,nk.Silhouette,0===this.view.map.ground.opacity?lk:{});null!=_e.scenePickPoint&&(this._scenePickPoint=_e.scenePickPoint,this._sphere=_e.sphere,r$3w(this._beginScenePoint,this._scenePickPoint),this._navMode=vt$2(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===uk.Vertical&&this._preparePlanarPanMode(fe,_e.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(fe){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const ve=fe.pointers.size>1;this._navMode===uk.Horizontal?(ve&&this._zoomSpherical(fe),this._panningSpherical(fe),ve&&this._rotateSpherical(fe)):(ve&&this._zoomPlanar(fe),this._panningPlanar(fe),ve&&this._rotatePlanar(fe)),this.commitCamera()}end(fe){fe.pointers.size===this._pointerCount&&this.update(fe),this.finishController();const ve=this._zoomMomentumEstimator.evaluateMomentum();if(ve)return this._navMode===uk.Horizontal?new _V({view:this.view,momentum:ve,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new vV({view:this.view,momentum:ve,zoomCenter:this._beginScenePoint});const _e=this._rotationMomentumEstimator.evaluateMomentum();if(_e)return new gV({view:this.view,momentum:_e,center:this._sphere,axis:this._rotationAxis});if(this._navMode===uk.Horizontal){const fe=this._panSphericalMomentumEstimator.evaluateMomentum();if(fe)return new yV({view:this.view,momentum:fe})}else{const fe=this._panPlanarMomentumEstimator.evaluateMomentum();if(fe)return new dV({view:this.view,momentum:fe})}return null}_preparePlanarPanMode(fe,ve){const _e=j$1O(this._tmp3d,this.startCamera.viewForward);j$1w(this._scenePickPoint,_e,this._panningPlane);const be=i$4i(this._screenPickPoint[0],0),we=[0,0,0],Se=s$4g(this.startCamera.eye);this._adjustedSphere[3]=Se<this._sphere[3]?Se-100:this._sphere[3],wt$5(this._adjustedSphere,this.startCamera,be,we);const Te=x$1H();this.startCamera.projectToRenderScreen(we,Te);const Ee=[0,0,0],Ce=[0,0,0],Oe=[0,0,0];e$3Z(Ee,this._scenePickPoint,this.currentCamera.eye);const Re=s$4g(Ee);z$1d(Ee,Ee);const De=5*Math.max(Math.abs(this.view.camera.position.z),50),Be=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,80);let Ze=null!=Be?Be:De;Ze=ve?Math.min(Ze,Re):Ze,r$3w(Oe,u$3Y(Ce,this.currentCamera.eye,g$2z(Ce,Ee,Ze))),this._panningPlane[3]=-P$1g(this._panningPlane,Oe),this.startCamera.center=u$3Y(Ce,this.startCamera.eye,g$2z(Ce,this.startCamera.viewForward,Ze));const Xe=d$3c(fe.center,this._tmpScreenPointArray);mt$6(this._panningPlane,this.startCamera,Xe,this._beginScenePoint)}_zoomSpherical(fe){const ve=this._beginRadius/fe.radius,_e=.001875*Math.min(Math.max(fe.radius,40),120);this._smoothScaling.gain=_e,this._smoothScaling.update(ve),ft$7(this._sphere,this.currentCamera,this._smoothScaling.value),d$3c(fe.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*fe.timestamp),this._constraintOptions.interactionType=DF.ZOOM,this._constraintOptions.interactionFactor=y$1g(fe.radius-this._beginRadius),E$12(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(fe){const ve=d$3c(fe.center,this._tmpScreenPointArray);wt$5(this._sphere,this.currentCamera,ve,this._tmp3d),Ct$4(this._beginScenePoint,P$1g(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Vt$2(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(ve,this._tmp3d,.001*fe.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Ft$2(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(ve,this._tmp3d,.001*fe.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=DF.PAN,this._constraintOptions.interactionFactor=y$1g(m$2r(this._screenPickPoint,ve)),E$12(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(fe){z$1d(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||j$1O(this._rotationAxis,this._rotationAxis);const ve=this._smoothRotation.value,_e=ve+st$c(fe.angle-ve),be=.00125*Math.min(Math.max(fe.radius,40),120);this._smoothRotation.gain=be,this._smoothRotation.update(_e);const we=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(we,.001*fe.timestamp),ct$8(this.currentCamera,this._sphere,m$26(this._rotationAxis,we)),this._constraintOptions.interactionType=DF.TUMBLE,this._constraintOptions.interactionFactor=y$1g(fe.radius*_e),E$12(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(fe){const ve=d$3c(fe.center,this._tmpScreenPointArray);mt$6(this._panningPlane,this.currentCamera,ve,this._tmp3d)&&(zt$2(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(ve,this._tmp3d,.001*fe.timestamp),this._constraintOptions.interactionType=DF.PAN,this._constraintOptions.interactionFactor=y$1g(m$2r(this._beginScreenPoint,ve)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),E$12(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(fe){const ve=this._beginRadius/fe.radius,_e=.001875*Math.min(Math.max(fe.radius,40),120);this._smoothScaling.gain=_e,this._smoothScaling.update(ve),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*fe.timestamp),ut$8(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=DF.ZOOM,this._constraintOptions.interactionFactor=y$1g(fe.radius-this._beginRadius),E$12(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(fe){r$3w(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||j$1O(this._rotationAxis,this._rotationAxis);const ve=this._smoothRotation.value;let _e=fe.angle-ve;_e=st$c(_e);const be=ve+_e,we=.00125*Math.min(Math.max(fe.radius,40),120);this._smoothRotation.gain=we,this._smoothRotation.update(be);const Se=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(Se,.001*fe.timestamp),ct$8(this.currentCamera,this._sphere,m$26(this._rotationAxis,Se)),this._constraintOptions.interactionType=DF.TUMBLE,this._constraintOptions.interactionFactor=y$1g(fe.radius*Se),E$12(this.view,this.currentCamera,this._constraintOptions)}};RV=e$4o([a$4y("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],RV);const IV=r$3y(0,0,1);let LV=class K extends DU{constructor(){super(...arguments),this._rotationValueSmooth=new uV(.05),this._scalingValueSmooth=new uV(.05),this._planeHorizontal=E$1z(),this._planeVertical=E$1z(),this._rotationMomentumEstimator=new OV,this._panMomentumEstimator=new xV(300,12,.9),this._zoomMomentumEstimator=new MV,this._beginRadius=0,this._beginCenter=[0,0,0],this._beginAngle=0,this._tmpPoints=[],this._navMode=uk.Horizontal,this._beginCenterScreen=i$4i(),this._tmpCentroid3d=[0,0,0],this._tmpCentroid2d=i$4i(),this._tmp2d=i$4i(),this._pointerCount=0,this._beginCamera=new NR,this._constraintOptions=new zF(IF.ALL,DF.NONE,0,this._beginCamera)}begin(fe){if(!this.active)return;const ve=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=ve,this._rotationMomentumEstimator.enabled=ve,this._panMomentumEstimator.enabled=ve,this._beginRadius=fe.radius,this._pointerCount=fe.pointers.size,this._beginAngle=fe.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),d$3c(fe.center,this._beginCenterScreen),_$1k(IV,0,this._planeHorizontal);const _e=[0,0,0],be=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,_e,0===this.view.map.ground.opacity?lk:{}),we=[0,0,0];j$1O(we,this.startCamera.viewForward);const Se=[0,0,0];r$3w(Se,IV);const Te=P$1g(we,Se);this._navMode=vt$2(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const Ee=Math.min(5,1/Math.abs(P$1g(Se,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),50);O$1j(this._planeHorizontal,this._planeHorizontal,_e),this.startCamera.aboveGround||q$U(this._planeHorizontal,this._planeHorizontal);const Ce=[0,0,0],Oe=[0,0,0],Re=[0,0,0];e$3Z(Ce,_e,this.currentCamera.eye);const De=s$4g(Ce);if(z$1d(Ce,Ce),this._navMode===uk.Vertical){g$2z(Se,Se,Te),e$3Z(this._planeVertical,we,Se),z$1d(this._planeVertical,this._planeVertical),O$1j(this._planeVertical,this._planeVertical,_e);const ve=this.view._stage.renderView.getMinimalDepthForArea(o$27(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,80);let Be=null!=ve?ve:Ee;Be=be?Math.min(Be,De):Be,r$3w(Re,u$3Y(Oe,this.currentCamera.eye,g$2z(Oe,Ce,Be))),this._planeVertical[3]=-P$1g(this._planeVertical,Re),this._computePlanePoints(fe.pointers,this._planeVertical,this.startCamera,this._tmpPoints),ht$9(this._tmpPoints,this._beginCenter)}else{const ve=be?De:Ee;r$3w(Re,u$3Y(Oe,this.currentCamera.eye,g$2z(Oe,Ce,ve))),this._planeHorizontal[3]=-P$1g(this._planeHorizontal,Re),this._computePlanePoints(fe.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),ht$9(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(fe){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const ve=fe.pointers.size>1,_e=this._navMode===uk.Horizontal?this._planeHorizontal:this._planeVertical,be=this._beginCenter;if(ve){const ve=this._beginRadius/fe.radius,_e=.001875*Math.min(Math.max(fe.radius,40),120);this._scalingValueSmooth.gain=_e,this._scalingValueSmooth.update(ve),ut$8(this.currentCamera,be,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*fe.timestamp),this._constraintOptions.interactionType=DF.ZOOM,this._constraintOptions.interactionFactor=y$1g(Math.abs(fe.radius-this._beginRadius)),E$12(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(fe.pointers,_e,this.currentCamera,this._tmpPoints),ht$9(this._tmpPoints,this._tmpCentroid3d),d$3c(fe.center,this._tmpCentroid2d),zt$2(this.currentCamera,be,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*fe.timestamp),this._constraintOptions.interactionType=DF.PAN,this._constraintOptions.interactionFactor=y$1g(m$2r(this._beginCenterScreen,this._tmpCentroid2d)),E$12(this.view,this.currentCamera,this._constraintOptions),ve){const ve=be,_e=this._rotationValueSmooth.value,we=_e+st$c(fe.angle-_e),Se=.00125*Math.min(Math.max(fe.radius,40),120);this._rotationValueSmooth.gain=Se,this._rotationValueSmooth.update(we);const Te=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(Te,.001*fe.timestamp);const Ee=this._planeHorizontal;ct$8(this.currentCamera,ve,m$26(Ee,Te)),this._constraintOptions.interactionType=DF.TUMBLE,this._constraintOptions.interactionFactor=y$1g(Math.abs(fe.radius*Te)),E$12(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(fe){fe.pointers.size===this._pointerCount&&this.update(fe),this.finishController();const ve=this._zoomMomentumEstimator.evaluateMomentum();if(ve)return new vV({view:this.view,momentum:ve,zoomCenter:this._beginCenter});const _e=this._rotationMomentumEstimator.evaluateMomentum();if(_e)return new gV({view:this.view,momentum:_e,center:this._beginCenter,axis:this._planeHorizontal});const be=this._panMomentumEstimator.evaluateMomentum();return be?new dV({view:this.view,momentum:be}):null}_computePlanePoints(fe,ve,_e,be){be.length=fe.size;const we=this._tmp2d;let Se=0;return fe.forEach((fe=>{we[0]=fe.x,we[1]=fe.y,void 0===be[Se]&&(be[Se]=[0,0,0]),mt$6(ve,_e,we,be[Se]),Se+=1})),be}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};LV=e$4o([a$4y("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],LV);let DV=class i24 extends nv{constructor(fe,ve,_e){super(!0),this._view=fe,this.pointerAction=ve,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",_e,(fe=>this._handleDrag(fe)))}_handleDrag(fe){if("mouse"===fe.data.pointerType&&!r$29(fe.data,this.pointerAction))return;const ve=fe.timestamp-this._lastEndTimestamp,_e=this._momentum&&this._momentum.active&&ve<40;switch(fe.data.action){case"start":case"update":if(_e)break;this._controller&&this._controller.active?fe.data.timestamp-this._lastTimestamp>2&&(this._controller.update(fe.data),this._lastTimestamp=fe.timestamp):this._startController(fe);break;case"end":case"removed":this._endController(fe,!0);break;case"added":this._endController(fe,!1),this._startController(fe)}fe.stopPropagation()}_endController(fe,ve){var _e;if(null==(_e=this._controller)?void 0:_e.active){this._lastEndTimestamp=fe.timestamp;const _e=this._controller.end(fe.data);ve&&_e&&(this._momentum=_e,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(fe){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(fe.data),this._lastTimestamp=fe.timestamp}_createController(){return this._view.state.isGlobal?new RV({view:this._view}):new LV({view:this._view})}},NV=class e22 extends nv{constructor(fe,ve){super(!0),this.view=fe,this.registerIncoming("pointer-down",ve,(()=>this.view.state.stopActiveCameraController()))}},FV=class e23 extends nv{constructor(fe,ve){super(!0),this.key=fe,this.registerIncoming("key-down",ve,(fe=>this._handleKeyDown(fe)))}_handleKeyDown(fe){fe.data.key===this.key&&(this.activate(),fe.stopPropagation())}},zV=class t34 extends FV{constructor(fe,ve,_e){super(ve,_e),this.view=fe}activate(){this.view.goTo({heading:0}).catch((()=>{}))}},kV=class e24 extends FV{constructor(fe,ve,_e){super(ve,_e),this.view=fe}activate(){this.view.goTo({tilt:0}).catch((()=>{}))}},UV=class o18 extends nv{constructor(fe,ve=!1){super(!0),this._view=fe,this._invert=ve,this.registerIncoming("vertical-two-finger-drag",(fe=>this._handleTwoFinger(fe)))}_handleTwoFinger(fe){var ve,_e,be;const we=this._invert?-1:1,Se=i$4i(0,fe.data.delta*we);switch(fe.data.action){case"begin":null==(ve=this._cameraController)||ve.end(),this._cameraController=new FU({view:this._view,pivot:NU.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(Se);break;case"update":null==(_e=this._cameraController)||_e.update(Se);break;case"end":null==(be=this._cameraController)||be.end(),this._cameraController=null}}};function t$2q(fe){const ve=fe.native;return ve?{buttons:ve.buttons.map((fe=>fe.pressed?fe.value||1:0)),axes:ve.axes.map((ve=>function s$2u(fe,ve){const _e=Math.abs(fe);return _e<ve?0:Math.sign(fe)*(_e-ve)/(1-ve)}(ve,fe.axisThreshold)))}:{buttons:[],axes:[]}}let VV=class a13{constructor(fe,ve){this._element=fe,this._input=ve,this._hasEventListeners=!1,this._onConnectGamepad=fe=>{this._connectGamepad(fe.gamepad)},this._onDisconnectGamepad=fe=>{const ve=fe.gamepad,_e=ve.index,be=this._inputDevices[_e];be&&(this._emitGamepadEvent(ve,t$2q(be),!1),this._inputDevices.splice(_e,1),this._latestUpdate.splice(_e,1),this._input.gamepad.devices.remove(be),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const _e="getGamepads"in window.navigator,be=window.isSecureContext;this.supported=_e&&be,this.supported&&(d$1O((fe=>this._connectGamepad(fe))),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(fe){this._hasEventListeners!==fe&&(this._hasEventListeners=fe,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(fe){this._callback=fe}_connectGamepad(fe){const ve=new tP(fe);"unknown"!==ve.deviceType&&(this._inputDevices[fe.index]=ve,this._input.gamepad.devices.add(ve)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=A$1I({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const fe=document.hasFocus(),ve=this._element.contains(document.activeElement),_e="document"===this._input.gamepad.enabledFocusMode&&!fe||"view"===this._input.gamepad.enabledFocusMode&&!ve;d$1O((fe=>{const ve=this._inputDevices[fe.index];if(!ve)return;const be=this._latestUpdate[fe.index],we=t$2q(ve),Se=_e||function e$2l(fe){for(let ve=0;ve<fe.axes.length;ve++)if(0!==fe.axes[ve])return!1;for(let ve=0;ve<fe.buttons.length;ve++)if(0!==fe.buttons[ve])return!1;return!0}(we);if(be){if(be.timestamp===fe.timestamp)return;if(!be.active&&Se)return;if(function n$2F(fe,ve){if(fe.axes.length!==ve.axes.length)return!1;if(fe.buttons.length!==ve.buttons.length)return!1;for(let _e=0;_e<fe.axes.length;_e++)if(fe.axes[_e]!==ve.axes[_e])return!1;for(let _e=0;_e<fe.buttons.length;_e++)if(fe.buttons[_e]!==ve.buttons[_e])return!1;return!0}(be.state,we))return}this._emitGamepadEvent(fe,we,!Se)}))}_emitGamepadEvent(fe,ve,_e){const be=this._latestUpdate[fe.index],we=be&&be.active;if(!we&&!_e)return;const Se=!we&&_e?"start":we&&_e?"update":"end";this._latestUpdate[fe.index]={timestamp:fe.timestamp,state:ve,active:_e},this._callback&&this._callback({device:this._inputDevices[fe.index],state:ve,action:Se})}};function o$22(fe){if(!fe)return!1;if(!fe.connected)return!1;for(let ve=0;ve<fe.axes.length;ve++)if(isNaN(fe.axes[ve]))return!1;return!0}function d$1O(fe){const ve=window.navigator.getGamepads();for(let _e=0;_e<ve.length;_e++){const be=ve[_e];o$22(be)&&fe(be)}}const BV=has("edge"),jV=has("chrome"),GV=has("ff"),HV=has("safari"),qV="esri-view-surface",WV={touchNone:`${qV}--touch-none`,touchPan:`${qV}--touch-pan`};let YV=class l14{constructor(fe,ve){this._input=ve,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=fe,fe.getAttribute("tabindex")||fe.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new VV(fe,this._input),this._gamepadSource.onEvent=fe=>this._callback("gamepad",fe)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach((fe=>{this._releasePointerCaptureSafe(fe)})),this._gamepadSource=u$4d(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(fe){this._browserTouchPanningEnabled=fe,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(fe){this._callback=fe}set activeEvents(fe){for(const ve in this._active)if(!fe||!fe.has(ve)){const fe=this._active[ve];this._element.removeEventListener(ZV[ve],fe),delete this._active[ve]}fe&&fe.forEach((fe=>{if(!this._active[fe]&&ZV[fe]){const ve=(this._eventHandlers[fe]||this._handleDefault).bind(this,fe);this._element.addEventListener(ZV[fe],ve),this._active[fe]=ve}})),this._gamepadSource.hasEventListeners=(null==fe?void 0:fe.has("gamepad"))??!1}setPointerCapture(fe,ve){ve?this._setPointerCatpureSafe(fe.pointerId):(this._releasePointerCaptureSafe(fe.pointerId),this._activePointerCaptures.delete(fe.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?WV.touchNone:WV.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?WV.touchPan:WV.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(WV.touchNone),this._element.classList.remove(WV.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(fe){try{this._element.setPointerCapture(fe),this._activePointerCaptures.add(fe)}catch{}}_releasePointerCaptureSafe(fe){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(fe))return;this._element.releasePointerCapture(fe)}catch(t84){}}_updateNormalizedPointerLikeEvent(fe,ve){const _e=i$3d(this._element,fe);return l14.test.disableSubpixelCoordinates&&(_e.x=Math.round(_e.x),_e.y=Math.round(_e.y)),ve.x=_e.x,ve.y=_e.y,ve}_handleKey(fe,ve){const{key:_e}=ve;_e&&"key-up"===fe&&this._keyDownState.delete(_e);const be={native:ve,key:_e,repeat:!!_e&&this._keyDownState.has(_e)};_e&&"key-down"===fe&&this._keyDownState.add(be.key),this._callback(fe,be)}_handlePointer(fe,ve){const _e=this._updateNormalizedPointerLikeEvent(ve,{native:ve,x:0,y:0,pointerType:ve.pointerType,button:ve.button,buttons:ve.buttons,eventId:this._eventId++});this._callback(fe,_e)}_handlePointerPreventDefault(fe,ve){const _e=this._updateNormalizedPointerLikeEvent(ve,{native:ve,x:0,y:0,pointerType:ve.pointerType,button:ve.button,buttons:ve.buttons,eventId:this._eventId++});ve.preventDefault(),this._callback(fe,_e)}_handleMouseWheel(fe,ve){let _e=ve.deltaY;switch(ve.deltaMode){case 0:BV&&(_e=_e/document.documentElement.clientHeight*600);break;case 1:_e*=30;break;case 2:_e*=900}BV?_e*=.7:jV||HV?_e*=.6:GV&&(_e*=1.375);const be=Math.abs(_e);if(be>100){const fe=.02;_e=_e/be*200/(1+Math.exp(-fe*(be-100)))}const we=this._updateNormalizedPointerLikeEvent(ve,{native:ve,x:0,y:0,deltaY:_e});this._callback(fe,we)}_handlePointerCaptureLost(fe,ve){this._activePointerCaptures.delete(ve.pointerId),this._handleDefault(fe,ve)}_handleDefault(fe,ve){const _e={native:ve};ve.preventDefault(),this._callback(fe,_e)}_preventAltKeyDefault(fe){"Alt"===fe.key&&fe.preventDefault()}_preventMultiTouchPanning(fe){fe.touches.length>1&&fe.preventDefault()}};YV.test={disableSubpixelCoordinates:!1};const ZV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let XV=class e25 extends nv{constructor(){super(!0),this.registerIncoming("context-menu",(fe=>{fe.data.native.preventDefault()}))}};const JV=300,QV=1.5,KV=6,eB=6,tB=500,rB=250,iB=10,nB=350,sB=35;function n$2E(fe,ve){return Math.abs(ve.x-fe.x)+Math.abs(ve.y-fe.y)}function u$2c(fe){const{native:ve}=fe,{pointerId:_e,button:be,pointerType:we}=ve;return"mouse"===we?`${_e}:${be}`:`${we}`}let oB=class s33 extends nv{constructor(fe){super(!1),this._navigationTouch=fe,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(fe,ve,_e,be){return{action:fe,pointerType:this._pointerType,button:this._mouseButton,buttons:ve.buttons,timestamp:be,pointers:o$1$(this._activePointerMap),pointer:ve,angle:_e.angle,radius:_e.radius,center:_e.center}}_addPointer(fe){const ve=fe.native.pointerId,_e=a$2s(this._activePointerMap).angle,be={event:fe,initialAngle:0,lastAngle:0};this._activePointerMap.set(ve,be);const we=h$1z(be,r$24(this._activePointerMap));be.initialAngle=we,be.lastAngle=we,this._updatePointerAngles(_e)}_updatePointer(fe){if(fe&&null==fe.x&&null==fe.y)return;const ve=fe.native.pointerId,_e=this._activePointerMap.get(ve);_e?_e.event=fe:this._addPointer(fe)}_removePointer(fe){const ve=a$2s(this._activePointerMap).angle;this._activePointerMap.delete(fe),this._updatePointerAngles(ve)}_updatePointerAngles(fe){const ve=a$2s(this._activePointerMap);this._activePointerMap.forEach((_e=>{_e.initialAngle=h$1z(_e,ve)-fe,_e.lastAngle=h$1z(_e,ve)-fe}))}_emitEvent(fe,ve,_e){const be=a$2s(this._activePointerMap);this._drag.emit(this._createPayload(fe,ve,be,_e),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(fe){const ve=fe.data.native.pointerId,_e=fe.timestamp;this._activePointerMap.get(ve)&&(1===this._activePointerMap.size?(this._updatePointer(fe.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",fe.data,_e),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(ve)):(this._removePointer(ve),this._emitEvent("removed",fe.data,fe.timestamp)))}_handlePointerDrag(fe){const ve=fe.data,_e=ve.currentEvent,be=fe.timestamp;switch(ve.action){case"start":case"update":this._isDragging?this._activePointerMap.has(_e.native.pointerId)?(this._updatePointer(_e),!this._isCurrentDragSuppressed&&this._emitEvent("update",_e,be)):(this._addPointer(_e),this._emitEvent("added",_e,be),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(_e),this._pointerType=fe.data.startEvent.pointerType,this._mouseButton=fe.data.startEvent.button,this._startStateModifiers=fe.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",_e,be))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}};function r$24(fe){const ve=[];return fe.forEach((fe=>{ve.push(c$4u(fe.event.x,fe.event.y))})),function o$20(fe,ve){if(ve?(ve.radius=0,ve.center.x=0,ve.center.y=0):ve={radius:0,center:c$4u()},0===fe.length)return ve;if(1===fe.length)return ve.center.x=fe[0].x,ve.center.y=fe[0].y,ve;if(2===fe.length){const[_e,be]=fe,[we,Se]=[be.x-_e.x,be.y-_e.y];return ve.radius=Math.sqrt(we*we+Se*Se)/2,ve.center.x=(_e.x+be.x)/2,ve.center.y=(_e.y+be.y)/2,ve}let _e=0,be=0;for(let bt=0;bt<fe.length;bt++)_e+=fe[bt].x,be+=fe[bt].y;_e/=fe.length,be/=fe.length;const we=fe.map((fe=>fe.x-_e)),Se=fe.map((fe=>fe.y-be));let Te=0,Ee=0,Ce=0,Oe=0,Re=0,De=0,Be=0;for(let bt=0;bt<we.length;bt++){const fe=we[bt],ve=Se[bt],_e=fe*fe,be=ve*ve;Te+=_e,Ee+=be,Ce+=fe*ve,Oe+=_e*fe,Re+=be*ve,De+=fe*be,Be+=ve*_e}const Ze=.5*(Oe+De),Xe=.5*(Re+Be),Je=Te*Ee-Ce*Ce,Qe=(Ze*Ee-Xe*Ce)/Je,dt=(Te*Xe-Ce*Ze)/Je,$t=c$4u(Qe+_e,dt+be);return{radius:Math.sqrt(Qe*Qe+dt*dt+(Te+Ee)/fe.length),center:$t}}(ve)}function a$2s(fe){const ve=r$24(fe);let _e=0;return fe.forEach((fe=>{let be=h$1z(fe,ve),we=be-fe.lastAngle;for(;we>Math.PI;)we-=2*Math.PI;for(;we<-Math.PI;)we+=2*Math.PI;be=fe.lastAngle+we,fe.lastAngle=be;const Se=be-fe.initialAngle;_e+=Se})),_e/=fe.size||1,{angle:_e,radius:ve.radius,center:ve.center}}function o$1$(fe){const ve=new Map;return fe.forEach(((fe,_e)=>ve.set(_e,fe.event))),ve}function h$1z(fe,ve){const _e=fe.event,be=_e.x-ve.center.x,we=_e.y-ve.center.y;return Math.atan2(we,be)}var aB;!function(fe){fe[fe.Left=0]="Left",fe[fe.Middle=1]="Middle",fe[fe.Right=2]="Right",fe[fe.Back=3]="Back",fe[fe.Forward=4]="Forward",fe[fe.Undefined=-1]="Undefined"}(aB||(aB={}));let lB=class m16 extends nv{constructor(fe=rB,ve=iB,_e=nB,be=sB,we=Gr){super(!1),this._maximumDoubleClickDelay=fe,this._maximumDoubleClickDistance=ve,this._maximumDoubleTouchDelay=_e,this._maximumDoubleTouchDistance=be,this._clock=we,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach((fe=>{fe.immediateDoubleClick&&fe.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(fe){const ve=fe.data,_e=u$2c(ve);if(!this._pointerState.has(_e)){const fe={downButton:ve.native.button,x:ve.x,y:ve.y,immediateDoubleClick:null};this._pointerState.set(_e,fe),this.startCapturingPointer(ve.native)}}_handlePointerUp(fe){const ve=fe.data,_e=u$2c(ve),be=this._pointerState.get(_e);if(be&&be.downButton===ve.native.button){const _e=be.immediateDoubleClick,we="touch"===fe.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;_e?(_e.timeoutHandle.remove(),n$2E(_e,fe.data)>we?this._startImmediateDoubleClick(fe,be):(this._immediateDoubleClick.emit(fe.data,void 0,_e.modifiers),this._removeState(ve))):n$2E(be,fe.data)>we?this._removeState(ve):this._startImmediateDoubleClick(fe,be)}}_startImmediateDoubleClick(fe,ve){const _e="touch"===fe.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;ve.immediateDoubleClick={x:fe.data.x,y:fe.data.y,modifiers:fe.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(fe.data)),_e)}}_removeState(fe){const ve=u$2c(fe);this._pointerState.delete(ve),this.stopCapturingPointer(fe.native),this.refreshHasPendingInputs()}},cB=class r15 extends nv{constructor(fe=JV,ve=QV,_e=KV,be=eB,we=tB,Se=Gr){super(!1),this._maximumClickDelay=fe,this._movementUntilMouseDrag=ve,this._movementUntilPenDrag=_e,this._movementUntilTouchDrag=be,this._holdDelay=we,this._clock=Se,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(fe=>{this._handlePointerLoss(fe,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(fe=>{this._handlePointerLoss(fe,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(fe=>{this._handlePointerLoss(fe,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((fe=>{fe.holdTimeout=l$4E(fe.holdTimeout)})),super.onUninstall()}_handlePointerDown(fe){const ve=fe.data,_e=ve.native.pointerId;let be=null;0===this._pointerState.size&&(be=this._clock.setTimeout((()=>{const ve=this._pointerState.get(_e);if(ve){if(!ve.isDragging){const _e=ve.previousEvent;this._pointerHold.emit(_e,void 0,fe.modifiers),ve.holdEmitted=!0}ve.holdTimeout=null}}),this._holdDelay));const we={startEvent:ve,previousEvent:ve,startTimestamp:fe.timestamp,isDragging:!1,downButton:ve.native.button,holdTimeout:be,modifiers:new Set};this._pointerState.set(_e,we),this.startCapturingPointer(ve.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(fe)}_handlePointerMove(fe){const ve=fe.data,_e=ve.native.pointerId,be=this._pointerState.get(_e);be&&(be.isDragging?this._pointerDrag.emit(s$2r("update",be,ve),void 0,be.modifiers):function r$25(fe,ve){const _e=ve.x-fe.x,be=ve.y-fe.y;return Math.sqrt(_e*_e+be*be)}(ve,be.startEvent)>this._getDragThreshold(ve.native.pointerType)&&this._startDragging(fe),be.previousEvent=ve)}_getDragThreshold(fe){switch(fe){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(fe){const ve=fe.data,_e=ve.native.pointerId;this._pointerState.forEach((be=>{null!=be.holdTimeout&&(be.holdTimeout.remove(),be.holdTimeout=null),be.isDragging||(be.modifiers=fe.modifiers,be.isDragging=!0,_e===be.startEvent.native.pointerId?this._pointerDrag.emit(s$2r("start",be,ve)):this._pointerDrag.emit(s$2r("start",be,be.previousEvent),fe.timestamp))}))}_handlePointerLoss(fe,ve){const _e=fe.data,be=_e.native.pointerId,we=this._pointerState.get(be);we&&(null!=we.holdTimeout&&(we.holdTimeout.remove(),we.holdTimeout=null),we.isDragging?this._pointerDrag.emit(s$2r("end",we,"pointer-up"===ve?_e:we.previousEvent),void 0,we.modifiers):"pointer-up"===ve&&we.downButton===_e.native.button&&fe.timestamp-we.startTimestamp<=this._maximumClickDelay&&!we.holdEmitted&&this._immediateClick.emit(_e),this._pointerState.delete(be),this.stopCapturingPointer(_e.native),0===this._pointerState.size&&this._moveHandle.pause())}};function s$2r(fe,ve,_e){return{action:fe,startEvent:ve.startEvent,previousEvent:ve.previousEvent,currentEvent:_e}}let uB=class r16 extends nv{constructor(fe=rB,ve=iB,_e=nB,be=sB,we=Gr){super(!1),this._maximumDoubleClickDelay=fe,this._maximumDoubleClickDistance=ve,this._maximumDoubleTouchDelay=_e,this._maximumDoubleTouchDistance=be,this._clock=we,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach((fe=>fe.doubleClickTimer=l$4E(fe.doubleClickTimer)))}get hasPendingInputs(){return n$4E(this._pointerState,(fe=>null!=fe.doubleClickTimer))}_clearDoubleClickTimer(fe,ve){const _e=this._pointerState.get(fe);_e&&(_e.doubleClickTimer=l$4E(_e.doubleClickTimer),ve&&this._click.emit(_e.event.data,void 0,_e.event.modifiers),this._pointerState.delete(fe),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(fe){const ve=this._pointerState.get(fe);1===ve.pointerDownCount&&this._click.emit(ve.event.data,void 0,ve.event.modifiers),ve.doubleClickTimer=null,this._pointerState.delete(fe),this.refreshHasPendingInputs()}_handleImmediateClick(fe){const ve=fe.data,{pointerType:_e}=ve.native,be=function c$2u(fe){const{pointerId:ve,pointerType:_e,button:be}=fe.native;return"mouse"===_e?`${ve}:${be}`:`${_e}`}(ve);if(!this._pointerState.has(be))return void this._startClick(fe);const we=this._pointerState.get(be),{data:Se,modifiers:Te}=we.event,Ee="touch"===_e?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n$2E(Se,ve)>Ee?(this._clearDoubleClickTimer(be,!0),this._startClick(fe)):(this._clearDoubleClickTimer(be,!1),2===we.pointerDownCount&&this._doubleClick.emit(Se,void 0,Te))}_handlePointerDown(fe){const ve=u$2c(fe.data),_e=this._pointerState.get(ve);_e&&(_e.pointerDownCount+=1)}_startClick(fe){const{data:ve}=fe,{native:{pointerType:_e}}=ve,be=u$2c(ve),we="touch"===_e?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,Se=this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(be)),we);this._pointerState.set(be,{event:fe,doubleClickTimer:Se,pointerDownCount:1}),this.refreshHasPendingInputs()}};let hB=class t35{constructor(fe){this._callbacks=fe,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(fe){const ve=fe.data,_e=ve.pointers.size;switch(ve.action){case"start":this._currentCount=_e,this._emitStart(fe);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=_e,this._emitStart(fe);break;case"update":this._emitUpdate(fe);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=_e,this._emitStart(fe);break;case"end":this._emitEnd(fe),this._currentCount=0}this._previousEvent=fe}_emitStart(fe){var ve,_e;this._startEvent=fe,(null==(_e=(ve=this._callbacks).condition)?void 0:_e.call(ve,this._currentCount,fe))&&this._callbacks.start(this._currentCount,fe,this._startEvent)}_emitUpdate(fe){var ve,_e;(null==(_e=(ve=this._callbacks).condition)?void 0:_e.call(ve,this._currentCount,fe))&&this._callbacks.update(this._currentCount,fe,this._startEvent)}_emitEnd(fe){var ve,_e;(null==(_e=(ve=this._callbacks).condition)?void 0:_e.call(ve,this._currentCount,fe))&&this._callbacks.end(this._currentCount,fe,this._startEvent),this._startEvent=null}},dB=class a14 extends nv{constructor(fe=20,ve=40){super(!1),this._threshold=fe,this._maxDelta=ve,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new hB({start:(fe,ve)=>this._observeStart(fe,ve),update:(fe,ve,_e)=>this._observeUpdate(fe,ve,_e),end:(fe,ve)=>this._observeEnd(ve)}),this.registerIncoming("drag",(fe=>this._dragEventSeparator.handle(fe)))}get failed(){return"failed"===this._state}_observeStart(fe,ve){1===fe&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:ve.data.button,buttons:ve.data.buttons,pointerType:ve.data.pointerType,timestamp:ve.data.timestamp,pointers:ve.data.pointers,pointer:ve.data.pointer,angle:ve.data.angle,radius:ve.data.radius,center:ve.data.center}),ve.stopPropagation()),this._state=2===fe?"ready":"failed"}_observeUpdate(fe,ve,_e){if("failed"!==this._state&&2===fe)return"active"===this._state?(this._vertical.emit({delta:ve.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void ve.stopPropagation()):void(this._checkMovementWithinLimits(ve.data,_e.data)?this._checkVerticalThresholdReached(ve.data,_e.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=ve.data.center,this._artificalDrag.emit({action:"end",button:ve.data.button,buttons:ve.data.buttons,pointerType:ve.data.pointerType,timestamp:ve.data.timestamp,pointers:ve.data.pointers,pointer:ve.data.pointer,angle:ve.data.angle,radius:ve.data.radius,center:ve.data.center}),this._vertical.emit({delta:ve.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),ve.stopPropagation()):this._state="failed")}_observeEnd(fe){"active"===this._state&&(this._vertical.emit({delta:fe.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",fe.stopPropagation())}_checkMovementWithinLimits(fe,ve){let _e=-1/0,be=1/0,we=-1/0,Se=1/0;for(const{x:Xe,y:Je}of ve.pointers.values())_e=Math.max(_e,Xe),be=Math.min(be,Xe),we=Math.max(we,Je),Se=Math.min(Se,Je);let Te=-1/0,Ee=1/0,Ce=-1/0,Oe=1/0;for(const{x:Xe,y:Je}of fe.pointers.values())Te=Math.max(Te,Xe),Ee=Math.min(Ee,Xe),Ce=Math.max(Ce,Je),Oe=Math.min(Oe,Je);const Re=_e-be,De=we-Se,Be=Te-Ee,Ze=Ce-Oe;return Math.abs(fe.center.x-ve.center.x)<this._threshold&&Math.abs(Be-Re)<=this._maxDelta&&Math.abs(Ze-De)<=this._maxDelta}_checkVerticalThresholdReached(fe,ve){let _e=Math.abs(fe.center.y-ve.center.y);return fe.pointers.forEach(((fe,be)=>{const we=ve.pointers.get(be);_e=Math.min(_e,Math.abs(fe.y-we.y))})),_e>=this._threshold}},pB=class b6 extends zi{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(fe){"pan"!==fe&&"rotate"!==fe||fe===this._get("primaryDragAction")||(this._set("primaryDragAction",fe),this._updateMode())}get mode(){return this._get("mode")}set mode(fe){"default"!==fe&&"pro"!==fe||fe===this._get("mode")||(this._set("mode",fe),this._updateMode())}get updating(){var fe;return!!(null==(fe=this._inputManager)?void 0:fe.updating)}get latestPointerType(){var fe;return null==(fe=this._inputManager)?void 0:fe.latestPointerType}get latestPointerLocation(){var fe;return null==(fe=this._inputManager)?void 0:fe.latestPointerLocation}get multiTouchActive(){var fe;return(null==(fe=this._inputManager)?void 0:fe.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=u$4d(this._inputManager)}connect(){const fe=this.view;this._source=new YV(this.view.surface,fe.input);const ve=[new lB,new cB,new uB,new oB(this.view.navigation),new dB],_e=new uv({eventSource:this._source,recognizers:ve});this._inputManager=_e,_e.installHandlers("prevent-context-menu",[new XV],pv.INTERNAL),this._modeDragPan=new DV(fe,"primary"),this._modeDragRotate=new UU(fe,"secondary",NU.CENTER),this._modeDragZoom=new WU(fe,"tertiary");const be="b",we={left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},Se="n",Te="p";_e.installHandlers("navigation",[new NV(fe),new Xk(fe),new oV(fe),new lV(fe,we),new cV(fe),new kV(fe,Te),new zV(fe,Se),new UU(fe,"primary",NU.EYE,[be]),new UU(fe,"secondary",NU.CENTER,[be]),new DV(fe,"tertiary",[be]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new UV(fe)],pv.INTERNAL),this.view.viewEvents.connect(_e),this._updateMode(),this.addHandles(d$3d((()=>{var fe;return null==(fe=this.view.navigation)?void 0:fe.browserTouchPanEnabled}),(fe=>{this._source.browserTouchPanningEnabled=!fe}),Xa))}isModifierKeyDown(fe){var ve;return(null==(ve=this._inputManager)?void 0:ve.isModifierKeyDown(fe))??!1}_updateMode(){var fe;const ve=this.mode,_e=this.primaryDragAction,be=null==(fe=fB.get(ve))?void 0:fe.get(_e);be&&(this._modeDragPan&&(this._modeDragPan.pointerAction=be.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=be.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=be.zoom))}get test(){}};e$4o([y$2v()],pB.prototype,"view",void 0),e$4o([y$2v({value:"pan"})],pB.prototype,"primaryDragAction",null),e$4o([y$2v({value:"default"})],pB.prototype,"mode",null),e$4o([y$2v({readOnly:!0})],pB.prototype,"updating",null),e$4o([y$2v()],pB.prototype,"latestPointerType",null),e$4o([y$2v()],pB.prototype,"latestPointerLocation",null),e$4o([y$2v()],pB.prototype,"multiTouchActive",null),e$4o([y$2v()],pB.prototype,"_inputManager",void 0),pB=e$4o([a$4y("esri.views.3d.input.SceneInputManager")],pB);const fB=new Map,mB=new Map,yB=new Map;mB.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),mB.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),yB.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),yB.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),fB.set("default",mB),fB.set("pro",yB);const gB=pB;let vB=class T4 extends zi{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};e$4o([y$2v()],vB.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),e$4o([y$2v()],vB.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),e$4o([y$2v()],vB.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),e$4o([y$2v()],vB.prototype,"DECONFLICTOR_SHOW_GRID",void 0),e$4o([y$2v()],vB.prototype,"LABELS_SHOW_BORDER",void 0),e$4o([y$2v()],vB.prototype,"TEXT_SHOW_BASELINE",void 0),e$4o([y$2v()],vB.prototype,"TEXT_SHOW_BORDER",void 0),e$4o([y$2v()],vB.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),e$4o([y$2v()],vB.prototype,"OVERLAY_SHOW_CENTER",void 0),e$4o([y$2v()],vB.prototype,"SHOW_POI",void 0),e$4o([y$2v()],vB.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),e$4o([y$2v()],vB.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),e$4o([y$2v()],vB.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),e$4o([y$2v()],vB.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),e$4o([y$2v()],vB.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),e$4o([y$2v()],vB.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),e$4o([y$2v()],vB.prototype,"I3S_TREE_SHOW_TILES",void 0),e$4o([y$2v()],vB.prototype,"I3S_SHOW_MODIFICATIONS",void 0),e$4o([y$2v()],vB.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),e$4o([y$2v()],vB.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),e$4o([y$2v()],vB.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),e$4o([y$2v()],vB.prototype,"LINE_WIREFRAMES",void 0),vB=e$4o([a$4y("esri.views.3d.support.debugFlags")],vB);const _B=new vB;let $B,bB,wB=!1,xB=!1,SB=!1,TB=!1,EB=null;function r$21(fe){SB=_B.DECONFLICTOR_SHOW_VISIBLE,TB=_B.DECONFLICTOR_SHOW_INVISIBLE,wB=SB||TB,xB=_B.DECONFLICTOR_SHOW_GRID,EB=null,wB||xB?EB=()=>function p$2B(fe){null==$B&&($B=document.createElement("canvas"),$B.setAttribute("id","debugCanvas2d"),fe.surface.parentElement.style.position="relative",fe.surface.parentElement.appendChild($B));const{state:ve}=fe,{camera:_e,pixelRatio:be}=ve,{width:we,height:Se}=_e,Te=we*be,Ee=Se*be;$B.setAttribute("width",`${Te}px`),$B.setAttribute("height",`${Ee}px`),$B.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${we}px;height:${Se}px`),bB=$B.getContext("2d"),bB.clearRect(0,0,we,Se),bB.font="12px Arial"}(fe):$B&&($B.parentElement.removeChild($B),$B=null)}function u$2b(){EB&&(EB(),EB=null)}function h$1y(fe,ve,_e,be,we){u$2b();const Se=$B.height,Te=bB;Te.beginPath(),Te.lineWidth=1,Te.strokeStyle=we,Te.moveTo(fe,Se-_e),Te.lineTo(ve,Se-_e),Te.stroke(),Te.lineTo(ve,Se-be),Te.stroke(),Te.lineTo(ve,Se-_e),Te.stroke(),Te.lineTo(fe,Se-_e),Te.stroke(),Te.lineTo(fe,Se-_e),Te.stroke(),Te.closePath()}function f$1R(fe,ve){wB&&(ve&&SB||!ve&&TB)&&h$1y(fe.aabr[0],fe.aabr[2],fe.aabr[1],fe.aabr[3],ve?"green":"red")}var PB,CB;function n$2C(fe,ve){return new OB(fe,AB,ve)}function l$2v(fe,ve,_e){const be=_e.parameters;return RB.scale=Math.min(be.divisor/(ve-be.offset),1),RB.factor=function c$2s(fe){return Math.abs(fe*fe*fe)}(fe),RB}function s$2p(fe,ve){return f$3i(fe*Math.max(ve.scale,ve.minScaleFactor),fe,ve.factor)}function u$2a(fe,ve,_e,be){be.scale=function o$1Z(fe,ve,_e){const be=l$2v(fe,ve,_e);return be.minScaleFactor=0,s$2p(1,be)}(fe,ve,_e),be.factor=0,be.minScaleFactor=_e.minScaleFactor}function f$1Q(fe,ve,_e=[0,0]){const be=Math.min(Math.max(ve.scale,ve.minScaleFactor),1);return _e[0]=fe[0]*be,_e[1]=fe[1]*be,_e}!function(fe){fe[fe.USER=1]="USER",fe[fe.SCALE_RANGE=2]="SCALE_RANGE",fe[fe.FILTER=4]="FILTER",fe[fe.DECONFLICTION=8]="DECONFLICTION",fe[fe.ALL_GRAPHIC=15]="ALL_GRAPHIC",fe[fe.ALL_LABEL=255]="ALL_LABEL"}(PB||(PB={})),function(fe){fe[fe.GRAPHIC=1]="GRAPHIC",fe[fe.LABEL=16]="LABEL"}(CB||(CB={}));let OB=class h9{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(fe,ve,_e,be={camera:{distance:0,fovY:0},divisor:0,offset:0},we){this._viewingMode=fe,this._description=ve,this._ellipsoidRadius=_e,this.parameters=be,this._fontHeight=we,this._viewingMode===Wf.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(fe){return!(this.parameters&&this.parameters.camera.fovY===fe.fovY&&this.parameters.camera.distance===fe.distance||(this._calculateParameters(fe,this._ellipsoidRadius,this.parameters),0))}overrideFontHeight(fe){return fe!==this._fontHeight?new h9(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,fe):this}_calculateParameters(fe,ve,_e){const{scaleStart:be,scaleFallOffRange:we}=this._description,{fovY:Se,distance:Te}=fe,Ee=this._calculateCurvatureDependentParameters(fe,ve),Ce=this._coverageCompensation(fe,ve,Ee),{tiltAngle:Oe,scaleFallOffFactor:Re}=Ee,De=Math.sin(Oe)*Te,Be=.5*Math.PI-Oe-Se*(.5-be*Ce),Ze=De/Math.cos(Be),Xe=Be+Se*we*Ce,Je=(Ze-Re*(De/Math.cos(Xe)))/(1-Re);return _e.camera.fovY=fe.fovY,_e.camera.distance=fe.distance,_e.offset=Je,_e.divisor=Ze-Je,_e}_calculateCurvatureDependentParametersLocal(fe,ve,_e=IB){return _e.tiltAngle=this._description.curvatureDependent.min.tiltAngle,_e.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,_e}_calculateCurvatureDependentParametersGlobal(fe,ve,_e=IB){const be=this._description.curvatureDependent,we=1+fe.distance/ve,Se=Math.sqrt(we*we-1),[Te,Ee]=[be.min.curvature,be.max.curvature],Ce=e$3Y((Se-Te)/(Ee-Te),0,1),[Oe,Re]=[be.min,be.max];return _e.tiltAngle=f$3i(Oe.tiltAngle,Re.tiltAngle,Ce),_e.scaleFallOffFactor=f$3i(Oe.scaleFallOffFactor,Re.scaleFallOffFactor,Ce),_e}_surfaceCoverageCompensationLocal(fe,ve,_e){return(fe.fovY-_e.tiltAngle)/fe.fovY}_surfaceCoverageCompensationGlobal(fe,ve,_e){const be=ve*ve,we=_e.tiltAngle+.5*Math.PI,{fovY:Se,distance:Te}=fe,Ee=Te*Te+be-2*Math.cos(we)*Te*ve,Ce=Math.sqrt(Ee),Oe=Math.sqrt(Ee-be);return(Math.acos(Oe/Ce)-Math.asin(ve/(Ce/Math.sin(we)))+.5*Se)/Se}};const AB={curvatureDependent:{min:{curvature:h$2U(10),tiltAngle:h$2U(12),scaleFallOffFactor:.5},max:{curvature:h$2U(70),tiltAngle:h$2U(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},MB={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};const RB={scale:0,factor:0,minScaleFactor:0},IB={tiltAngle:0,scaleFallOffFactor:0};function t$2m(fe){return function n$2B(fe){return fe instanceof Float32Array&&fe.length>=16}(fe)||function r$20(fe){return Array.isArray(fe)&&fe.length>=16}(fe)}const LB={unknown:1,inches:j$1K(1,"meters","inches"),feet:j$1K(1,"meters","feet"),"us-feet":j$1K(1,"meters","us-feet"),yards:j$1K(1,"meters","yards"),miles:j$1K(1,"meters","miles"),"nautical-miles":j$1K(1,"meters","nautical-miles"),millimeters:j$1K(1,"meters","millimeters"),centimeters:j$1K(1,"meters","centimeters"),decimeters:j$1K(1,"meters","decimeters"),meters:j$1K(1,"meters","meters"),kilometers:j$1K(1,"meters","kilometers"),"decimal-degrees":1/G$W(1,"meters",Rn.radius)};var DB,NB;!function(fe){fe[fe.Undefined=0]="Undefined",fe[fe.DefinedSize=1]="DefinedSize",fe[fe.DefinedScale=2]="DefinedScale"}(DB||(DB={})),function(fe){fe[fe.Undefined=0]="Undefined",fe[fe.DefinedAngle=1]="DefinedAngle"}(NB||(NB={}));let FB=class x6{constructor(fe){this.field=fe}},zB=class g8 extends FB{constructor(fe){super(fe),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[DB.Undefined,DB.Undefined,DB.Undefined]}},kB=class b7 extends FB{constructor(fe){super(fe),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},UB=class C5 extends FB{constructor(fe){super(fe),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},VB=class U4{};function w$17(fe){return null!=fe}function V$H(fe){return"number"==typeof fe}function M$P(fe){return"string"==typeof fe}function T$O(fe,ve,_e,be,we){var Se;const Te=fe.minSize,Ee=fe.maxSize;if(fe.useSymbolValue){const fe=be.symbolSize[_e];return ve.minSize[_e]=fe,ve.maxSize[_e]=fe,ve.offset[_e]=ve.minSize[_e],ve.factor[_e]=0,ve.type[_e]=DB.DefinedSize,!0}if(w$17(fe.field))return w$17(fe.stops)?!(2!==fe.stops.length||!V$H(fe.stops[0].size)||!V$H(fe.stops[1].size))&&(F$D(fe.stops[0].size,fe.stops[1].size,fe.stops[0].value,fe.stops[1].value,ve,_e),ve.type[_e]=DB.DefinedSize,!0):V$H(Te)&&V$H(Ee)&&w$17(fe.minDataValue)&&w$17(fe.maxDataValue)?(F$D(Te,Ee,fe.minDataValue,fe.maxDataValue,ve,_e),ve.type[_e]=DB.DefinedSize,!0):"unknown"!==fe.valueUnit&&(null!=LB[fe.valueUnit]&&(ve.minSize[_e]=-1/0,ve.maxSize[_e]=1/0,ve.offset[_e]=0,ve.factor[_e]=1/LB[fe.valueUnit],ve.type[_e]=DB.DefinedSize,!0));if(!w$17(fe.field)){if((null==(Se=fe.stops)?void 0:Se[0])&&V$H(fe.stops[0].size))return ve.minSize[_e]=fe.stops[0].size,ve.maxSize[_e]=fe.stops[0].size,ve.offset[_e]=ve.minSize[_e],ve.factor[_e]=0,ve.type[_e]=DB.DefinedSize,!0;if(V$H(Te))return ve.minSize[_e]=Te,ve.maxSize[_e]=Te,ve.offset[_e]=Te,ve.factor[_e]=0,ve.type[_e]=DB.DefinedSize,!0}return!1}function F$D(fe,ve,_e,be,we,Se){const Te=Math.abs(be-_e)>0?(ve-fe)/(be-_e):0;we.minSize[Se]=Te>0?fe:ve,we.maxSize[Se]=Te>0?ve:fe,we.offset[Se]=fe-_e*Te,we.factor[Se]=Te}function P$I(fe,ve,_e,be){if(fe.normalizationField||fe.valueRepresentation)return null;if(!function j$X(fe){return null==fe||M$P(fe)}(fe.field))return null;if(ve.size){if(fe.field)if(ve.size.field){if(fe.field!==ve.size.field)return null}else ve.size.field=fe.field}else ve.size=new zB(fe.field);let we;switch(fe.axis){case"width":return we=T$O(fe,ve.size,0,_e),we?ve:null;case"height":return we=T$O(fe,ve.size,2,_e),we?ve:null;case"depth":return we=T$O(fe,ve.size,1,_e),we?ve:null;case"width-and-depth":return we=T$O(fe,ve.size,0,_e),we&&T$O(fe,ve.size,1,_e),we?ve:null;case null:case void 0:case"all":return we=T$O(fe,ve.size,0,_e),we=we&&T$O(fe,ve.size,1,_e),we=we&&T$O(fe,ve.size,2,_e),we?ve:null;default:return fe.axis,null}}function k$M(fe,ve,_e){fe[4*ve]=_e.r/255,fe[4*ve+1]=_e.g/255,fe[4*ve+2]=_e.b/255,fe[4*ve+3]=_e.a}function q$z(fe,ve,_e){const be=2===_e&&"arithmetic"===fe.rotationType;ve.offset[_e]=be?90:0,ve.factor[_e]=be?-1:1,ve.type[_e]=1}let BB=class B5{constructor(fe,ve=[1,1,1],_e=[1,1,1],be=1,we=[0,0,0],Se=[1,1,1],Te=[0,0,0]){this.supports=fe,this.modelSize=ve,this.symbolSize=_e,this.unitInMeters=be,this.anchor=we,this.scale=Se,this.rotation=Te}};function L$D(fe,ve,_e){if(!fe)return null;const be=fe.reduce(((fe,_e)=>{if(!fe)return fe;if(_e.valueExpression)return null;switch(_e.type){case"size":return ve.supports.size?P$I(_e,fe,ve):fe;case"color":return ve.supports.color?function E$_(fe,ve,_e){if(fe.normalizationField)return null;if(M$P(fe.field)){if(!fe.stops)return null;{if(fe.stops.length>8)return null;ve.color=new kB(fe.field);const _e=fe.stops;for(let fe=0;fe<8;++fe){const be=_e[Math.min(fe,_e.length-1)];ve.color.values[fe]=be.value,k$M(ve.color.colors,fe,be.color)}}}else{if(!(fe.stops&&fe.stops.length>=0))return null;{const _e=fe.stops&&fe.stops.length>=0&&fe.stops[0].color;ve.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let fe=0;fe<8;fe++)ve.color.values[fe]=1/0,k$M(ve.color.colors,fe,_e)}}return ve}(_e,fe):fe;case"opacity":return ve.supports.opacity?function _$P(fe,ve,_e){if(fe.normalizationField)return null;if(M$P(fe.field)){if(!fe.stops)return null;{if(fe.stops.length>8)return null;ve.opacity=new UB(fe.field);const _e=fe.stops;for(let fe=0;fe<8;++fe){const be=_e[Math.min(fe,_e.length-1)];ve.opacity.values[fe]=be.value,ve.opacity.opacityValues[fe]=be.opacity}}}else{if(!(fe.stops&&fe.stops.length>=0))return null;{const _e=fe.stops&&fe.stops.length>=0?fe.stops[0].opacity:0;ve.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let fe=0;fe<8;fe++)ve.opacity.values[fe]=1/0,ve.opacity.opacityValues[fe]=_e}}return ve}(_e,fe):null;case"rotation":return ve.supports.rotation?function $$o(fe,ve,_e){if(!M$P(fe.field))return null;if(ve.rotation){if(fe.field)if(ve.rotation.field){if(fe.field!==ve.rotation.field)return null}else ve.rotation.field=fe.field}else ve.rotation={field:fe.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(fe.axis){case"tilt":return q$z(fe,ve.rotation,0),ve;case"roll":return q$z(fe,ve.rotation,1),ve;case null:case void 0:case"heading":return q$z(fe,ve.rotation,2),ve;default:return fe.axis,null}}(_e,fe):fe;default:return null}}),new VB);return!(fe.length>0&&be)||be.size||be.color||be.opacity||be.rotation?(null==be?void 0:be.size)&&!function R$O(fe,ve,_e){for(let we=0;we<3;++we){let _e=ve.unitInMeters;fe.type[we]===DB.DefinedSize&&(_e*=ve.modelSize[we],fe.type[we]=DB.DefinedScale),fe.minSize[we]=fe.minSize[we]/_e,fe.maxSize[we]=fe.maxSize[we]/_e,fe.offset[we]=fe.offset[we]/_e,fe.factor[we]=fe.factor[we]/_e}let be;if(fe.type[0]!==DB.Undefined)be=0;else if(fe.type[1]!==DB.Undefined)be=1;else{if(fe.type[2]===DB.Undefined)return!1;be=2}for(let we=0;we<3;++we)fe.type[we]===DB.Undefined&&(fe.minSize[we]=fe.minSize[be],fe.maxSize[we]=fe.maxSize[be],fe.offset[we]=fe.offset[be],fe.factor[we]=fe.factor[be],fe.type[we]=fe.type[be]);return!0}(be.size,ve)?null:be:null}let jB=class N2{constructor(fe,ve,_e){this.visualVariables=fe,this.materialParameters=ve,this.requiresShaderTransformation=_e}};function O$O(fe,ve){if(!fe)return null;if(_B.TESTS_DISABLE_FAST_UPDATES)return null;const _e=L$D(fe.visualVariables,ve);return _e?new jB(_e,K$l(_e,ve),!!_e.size):null}function G$r(fe,ve,_e){if(!ve||!fe)return!1;const be=fe.visualVariables,we=L$D(ve.visualVariables,_e);return!!we&&!!(H$A(be.size,we.size,"size")&&H$A(be.color,we.color,"color")&&H$A(be.rotation,we.rotation,"rotation")&&H$A(be.opacity,we.opacity,"opacity"))&&(fe.visualVariables=we,fe.materialParameters=K$l(we,_e),fe.requiresShaderTransformation=!!we.size,!0)}function H$A(fe,ve,_e){if(!!fe!=!!ve)return!1;if(fe&&fe.field!==(null==ve?void 0:ve.field))return!1;if(fe&&"rotation"===_e){const _e=fe,be=ve;for(let fe=0;fe<3;fe++)if(_e.type[fe]!==be.type[fe]||_e.offset[fe]!==be.offset[fe]||_e.factor[fe]!==be.factor[fe])return!1}return!0}let GB=class J2 extends iO{constructor(fe){super(),this.vvSize=(null==fe?void 0:fe.size)??null,this.vvColor=(null==fe?void 0:fe.color)??null,this.vvOpacity=(null==fe?void 0:fe.opacity)??null}};function K$l(fe,ve){const _e=new GB(fe);return _e.vvSize&&(_e.vvSymbolAnchor=ve.anchor,o$3E(WB),function I$T(fe,ve,_e,be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const we=fe||0,Se=ve||0,Te=_e||0;return 0!==we&&x$1E(be,be,-we/180*Math.PI),0!==Se&&l$3_(be,be,Se/180*Math.PI),0!==Te&&m$3m(be,be,Te/180*Math.PI),be}(ve.rotation[2],ve.rotation[0],ve.rotation[1],WB),_e.vvSymbolRotationMatrix=_e.vvSymbolRotationMatrix||[1,0,0,0,1,0,0,0,1],n$3X(_e.vvSymbolRotationMatrix,WB)),_e}function W$t(fe,ve,_e){if(!ve.vvSize)return o$44(fe,1,1,1),fe;for(let be=0;be<3;++be){const we=ve.vvSize.offset[be]+_e[0]*ve.vvSize.factor[be];fe[be]=e$3Y(we,ve.vvSize.minSize[be],ve.vvSize.maxSize[be])}return fe}function X$h(fe,ve){const _e=null==fe?0:ve.attributes[fe];return"number"==typeof _e&&isFinite(_e)?_e:0}const HB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qB=[0,0,0],WB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function s$2o(fe){fe.vertex.code.add(o$2P`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),fe.vertex.code.add(o$2P`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),fe.vertex.code.add(o$2P`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),fe.vertex.code.add(o$2P`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),fe.vertex.code.add(o$2P`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),fe.vertex.code.add(o$2P`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function o$1Y(fe){fe.uniforms.add(new uO("screenSizePerspectiveAlignment",(fe=>i$2o(fe.screenSizePerspectiveAlignment||fe.screenSizePerspective))))}function i$2o(fe){return o$44(YB,fe.parameters.divisor,fe.parameters.offset,fe.minScaleFactor)}const YB=[0,0,0];function a$2p(fe,ve){const _e=fe.vertex;ve.hasVerticalOffset?(f$1P(_e),ve.hasScreenSizePerspective&&(fe.include(s$2o),o$1Y(_e),f$20(fe.vertex,ve)),_e.code.add(o$2P`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${ve.spherical?o$2P`vec3 worldNormal = normalize(worldPos + localOrigin);`:o$2P`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${ve.hasScreenSizePerspective?o$2P`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:o$2P`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):_e.code.add(o$2P`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const ZB=[0,0,0,0];function f$1P(fe){fe.uniforms.add(new hO("verticalOffset",((fe,ve)=>{const{minWorldLength:_e,maxWorldLength:be,screenLength:we}=fe.verticalOffset,Se=Math.tan(.5*ve.camera.fovY)/(.5*ve.camera.fullViewport[3]),Te=ve.camera.pixelRatio||1;return s$3I(ZB,we*Te,Se,_e,be)})))}const XB=.5;function d$1M(fe,ve){fe.include(s$2o),fe.attributes.add(nO.POSITION,"vec3"),fe.attributes.add(nO.NORMAL,"vec3"),fe.attributes.add(nO.CENTEROFFSETANDDISTANCE,"vec4");const _e=fe.vertex;d$1$(_e,ve),f$20(_e,ve),_e.uniforms.add(new hO("viewport",((fe,ve)=>ve.camera.fullViewport)),new dO("polygonOffset",(fe=>fe.shaderPolygonOffset)),new dO("cameraGroundRelative",((fe,ve)=>ve.camera.aboveGround?1:-1))),ve.hasVerticalOffset&&f$1P(_e),_e.constants.add("smallOffsetAngle","float",.984807753012208),_e.code.add(o$2P`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),_e.code.add(o$2P`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${ve.multipassEnabled?o$2P.float(0):o$2P`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),ve.draped&&!ve.hasVerticalOffset||p$2Q(_e),ve.draped||(_e.uniforms.add(new dO("perDistancePixelRatio",((fe,ve)=>Math.tan(ve.camera.fovY/2)/(ve.camera.fullViewport[2]/2)))),_e.code.add(o$2P`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${o$2P.float(XB)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),ve.screenCenterOffsetUnitsEnabled&&w$1d(_e),ve.hasScreenSizePerspective&&o$1Y(_e),_e.code.add(o$2P`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${ve.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${ve.hasScreenSizePerspective&&(ve.hasVerticalOffset||ve.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${ve.hasVerticalOffset?ve.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${ve.hasVerticalOffset?o$2P`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${ve.screenCenterOffsetUnitsEnabled?"":o$2P`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${ve.screenCenterOffsetUnitsEnabled?ve.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${ve.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function o$1X(fe,ve,_e,be,we){let Se=(_e.screenLength||0)*fe.pixelRatio;null!=we&&(Se=function m$21(fe,ve,_e,be){return s$2p(fe,l$2v(ve,_e,be))}(Se,be,ve,we));return e$3Y(Se*Math.tan(.5*fe.fovY)/(.5*fe.fullHeight)*ve,_e.minWorldLength||0,null!=_e.maxWorldLength?_e.maxWorldLength:1/0)}function e$2i(fe,ve){const _e=ve?e$2i(ve):{};for(const be in fe){let ve=fe[be];(null==ve?void 0:ve.forEach)&&(ve=l$2u(ve)),null==ve&&be in _e||(_e[be]=ve)}return _e}function i$2n(fe,ve){let _e=!1;for(const be in ve){const we=ve[be];void 0!==we&&(Array.isArray(we)?null===fe[be]?(fe[be]=we.slice(),_e=!0):a$4J(fe[be],we)&&(_e=!0):fe[be]!==we&&(_e=!0,fe[be]=we))}return _e}function l$2u(fe){const ve=[];return fe.forEach((fe=>ve.push(fe))),ve}const JB={multiply:1,ignore:2,replace:3,tint:4};let QB=class c25 extends iD{constructor(fe,ve){super(),this.type=eD.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=mA,this._pp0=r$3y(0,0,1),this._pp1=r$3y(0,0,0),this._parameters=e$2i(fe,ve),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(fe){return!1}setParameters(fe,ve=!0){i$2n(this._parameters,fe)&&(this.validateParameters(this._parameters),ve&&this.parametersChanged())}validateParameters(fe){}get visible(){return this._visible}set visible(fe){fe!==this._visible&&(this._visible=fe,this.parametersChanged())}shouldRender(fe){return this.isVisible()&&this.isVisibleForOutput(fe.output)&&(!this.parameters.isDecoration||fe.bindParameters.decorations===TA.ON)&&!!(this.parameters.renderOccluded&fe.renderOccludedMask)}isVisibleForOutput(fe){return!0}get renderPriority(){return this._renderPriority}set renderPriority(fe){fe!==this._renderPriority&&(this._renderPriority=fe,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var fe;null==(fe=this.repository)||fe.materialChanged(this)}queryRenderOccludedState(fe){return this.isVisible()&&this.parameters.renderOccluded===fe}intersectDraped(fe,ve,_e,be,we,Se){return this._pp0[0]=this._pp1[0]=be[0],this._pp0[1]=this._pp1[1]=be[1],this.intersect(fe,ve,_e,this._pp0,this._pp1,we)}},KB=class d15 extends hN{constructor(fe,ve,_e){super(ve,_e),this.camera=fe}};var ej;!function(fe){fe[fe.None=0]="None",fe[fe.Occlude=1]="Occlude",fe[fe.Transparent=2]="Transparent",fe[fe.OccludeAndTransparent=4]="OccludeAndTransparent",fe[fe.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",fe[fe.Opaque=16]="Opaque"}(ej||(ej={}));let tj=class u14 extends iO{constructor(){super(...arguments),this.renderOccluded=ej.Occlude,this.isDecoration=!1}},rj=class t36{constructor(){this.factor=new ij,this.factorAlignment=new ij}},ij=class c26{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function d$1K(fe,ve,_e,be=1){const{data:we,indices:Se}=fe,Te=ve.typedBuffer,Ee=ve.typedBufferStride,Ce=Se.length;if(_e*=Ee,1===be)for(let Oe=0;Oe<Ce;++Oe)Te[_e]=we[Se[Oe]],_e+=Ee;else for(let Oe=0;Oe<Ce;++Oe){const fe=we[Se[Oe]];for(let ve=0;ve<be;ve++)Te[_e]=fe,_e+=Ee}}function u$28(fe,ve,_e){const{data:be,indices:we}=fe,Se=ve.typedBuffer,Te=ve.typedBufferStride,Ee=we.length;_e*=Te;for(let Ce=0;Ce<Ee;++Ce){const fe=2*we[Ce];Se[_e]=be[fe],Se[_e+1]=be[fe+1],_e+=Te}}function a$2o(fe,ve,_e,be){const{data:we,indices:Se}=fe,Te=ve.typedBuffer,Ee=ve.typedBufferStride,Ce=Se.length;if(_e*=Ee,null==be||1===be)for(let Oe=0;Oe<Ce;++Oe){const fe=3*Se[Oe];Te[_e]=we[fe],Te[_e+1]=we[fe+1],Te[_e+2]=we[fe+2],_e+=Ee}else for(let Oe=0;Oe<Ce;++Oe){const fe=3*Se[Oe];for(let ve=0;ve<be;++ve)Te[_e]=we[fe],Te[_e+1]=we[fe+1],Te[_e+2]=we[fe+2],_e+=Ee}}function p$2y(fe,ve,_e,be=1){const{data:we,indices:Se}=fe,Te=ve.typedBuffer,Ee=ve.typedBufferStride,Ce=Se.length;if(_e*=Ee,1===be)for(let Oe=0;Oe<Ce;++Oe){const fe=4*Se[Oe];Te[_e]=we[fe],Te[_e+1]=we[fe+1],Te[_e+2]=we[fe+2],Te[_e+3]=we[fe+3],_e+=Ee}else for(let Oe=0;Oe<Ce;++Oe){const fe=4*Se[Oe];for(let ve=0;ve<be;++ve)Te[_e]=we[fe],Te[_e+1]=we[fe+1],Te[_e+2]=we[fe+2],Te[_e+3]=we[fe+3],_e+=Ee}}function y$1d(fe,ve,_e){const be=fe.typedBuffer,we=fe.typedBufferStride;ve*=we;for(let Se=0;Se<_e;++Se)be[ve]=0,be[ve+1]=0,be[ve+2]=0,be[ve+3]=0,ve+=we}function b$19(fe,ve,_e,be,we=1){if(!ve)return void a$2o(fe,_e,be,we);const{data:Se,indices:Te}=fe,Ee=_e.typedBuffer,Ce=_e.typedBufferStride,Oe=Te.length,Re=ve[0],De=ve[1],Be=ve[2],Ze=ve[4],Xe=ve[5],Je=ve[6],Qe=ve[8],dt=ve[9],$t=ve[10],bt=ve[12],wt=ve[13],xt=ve[14];be*=Ce;let St=0,Et=0,Pt=0;const Ot=H$12(ve)?fe=>{St=Se[fe]+bt,Et=Se[fe+1]+wt,Pt=Se[fe+2]+xt}:fe=>{const ve=Se[fe],_e=Se[fe+1],be=Se[fe+2];St=Re*ve+Ze*_e+Qe*be+bt,Et=De*ve+Xe*_e+dt*be+wt,Pt=Be*ve+Je*_e+$t*be+xt};if(1===we)for(let At=0;At<Oe;++At)Ot(3*Te[At]),Ee[be]=St,Ee[be+1]=Et,Ee[be+2]=Pt,be+=Ce;else for(let At=0;At<Oe;++At){Ot(3*Te[At]);for(let fe=0;fe<we;++fe)Ee[be]=St,Ee[be+1]=Et,Ee[be+2]=Pt,be+=Ce}}function O$N(fe,ve,_e,be,we=1){if(!ve)return void a$2o(fe,_e,be,we);const{data:Se,indices:Te}=fe,Ee=ve,Ce=_e.typedBuffer,Oe=_e.typedBufferStride,Re=Te.length,De=Ee[0],Be=Ee[1],Ze=Ee[2],Xe=Ee[4],Je=Ee[5],Qe=Ee[6],dt=Ee[8],$t=Ee[9],bt=Ee[10],wt=!G$Q(Ee),xt=1e-6,St=1-xt;be*=Oe;let Et=0,Pt=0,Ot=0;const At=H$12(Ee)?fe=>{Et=Se[fe],Pt=Se[fe+1],Ot=Se[fe+2]}:fe=>{const ve=Se[fe],_e=Se[fe+1],be=Se[fe+2];Et=De*ve+Xe*_e+dt*be,Pt=Be*ve+Je*_e+$t*be,Ot=Ze*ve+Qe*_e+bt*be};if(1===we)if(wt)for(let Mt=0;Mt<Re;++Mt){At(3*Te[Mt]);const fe=Et*Et+Pt*Pt+Ot*Ot;if(fe<St&&fe>xt){const ve=1/Math.sqrt(fe);Ce[be]=Et*ve,Ce[be+1]=Pt*ve,Ce[be+2]=Ot*ve}else Ce[be]=Et,Ce[be+1]=Pt,Ce[be+2]=Ot;be+=Oe}else for(let Mt=0;Mt<Re;++Mt)At(3*Te[Mt]),Ce[be]=Et,Ce[be+1]=Pt,Ce[be+2]=Ot,be+=Oe;else for(let Mt=0;Mt<Re;++Mt){if(At(3*Te[Mt]),wt){const fe=Et*Et+Pt*Pt+Ot*Ot;if(fe<St&&fe>xt){const ve=1/Math.sqrt(fe);Et*=ve,Pt*=ve,Ot*=ve}}for(let fe=0;fe<we;++fe)Ce[be]=Et,Ce[be+1]=Pt,Ce[be+2]=Ot,be+=Oe}}function S$12(fe,ve,_e,be,we=1){const{data:Se,indices:Te}=fe,Ee=_e.typedBuffer,Ce=_e.typedBufferStride,Oe=Te.length;if(be*=Ce,ve!==Se.length||4!==ve)if(1!==we)if(4!==ve)for(let Re=0;Re<Oe;++Re){const fe=3*Te[Re];for(let ve=0;ve<we;++ve)Ee[be]=Se[fe],Ee[be+1]=Se[fe+1],Ee[be+2]=Se[fe+2],Ee[be+3]=255,be+=Ce}else for(let Re=0;Re<Oe;++Re){const fe=4*Te[Re];for(let ve=0;ve<we;++ve)Ee[be]=Se[fe],Ee[be+1]=Se[fe+1],Ee[be+2]=Se[fe+2],Ee[be+3]=Se[fe+3],be+=Ce}else{if(4===ve){for(let fe=0;fe<Oe;++fe){const ve=4*Te[fe];Ee[be]=Se[ve],Ee[be+1]=Se[ve+1],Ee[be+2]=Se[ve+2],Ee[be+3]=Se[ve+3],be+=Ce}return}for(let fe=0;fe<Oe;++fe){const ve=3*Te[fe];Ee[be]=Se[ve],Ee[be+1]=Se[ve+1],Ee[be+2]=Se[ve+2],Ee[be+3]=255,be+=Ce}}else{Ee[be]=Se[0],Ee[be+1]=Se[1],Ee[be+2]=Se[2],Ee[be+3]=Se[3];const fe=new Uint32Array(_e.typedBuffer.buffer,_e.start),ve=Ce/4,Te=fe[be/=4];be+=ve;const Re=Oe*we;for(let _e=1;_e<Re;++_e)fe[be]=Te,be+=ve}}function R$N(fe,ve,_e,be,we=1){const Se=ve.typedBuffer,Te=ve.typedBufferStride;if(be*=Te,1===we)for(let Ee=0;Ee<_e;++Ee)Se[be]=fe[0],Se[be+1]=fe[1],Se[be+2]=fe[2],Se[be+3]=fe[3],be+=Te;else for(let Ee=0;Ee<_e;++Ee)for(let ve=0;ve<we;++ve)Se[be]=fe[0],Se[be+1]=fe[1],Se[be+2]=fe[2],Se[be+3]=fe[3],be+=Te}function E$Z(fe,ve,_e,be,we,Se){var Te;for(const Ee of ve.fields.keys()){const ve=fe.attributes.get(Ee),Ce=null==ve?void 0:ve.indices;if(ve&&Ce)A$V(Ee,ve,_e,be,we,Se);else if(Ee===nO.OBJECTANDLAYERIDCOLOR&&null!=fe.objectAndLayerIdColor){const ve=null==(Te=fe.attributes.get(nO.POSITION))?void 0:Te.indices;if(ve){const _e=ve.length,be=we.getField(Ee,xL);R$N(fe.objectAndLayerIdColor,be,_e,Se)}}}}function A$V(fe,ve,_e,be,we,Se){switch(fe){case nO.POSITION:{s$31(3===ve.size);const be=we.getField(fe,uL);s$31(!!be,`No buffer view for ${fe}`),be&&b$19(ve,_e,be,Se);break}case nO.NORMAL:{s$31(3===ve.size);const _e=we.getField(fe,uL);s$31(!!_e,`No buffer view for ${fe}`),_e&&O$N(ve,be,_e,Se);break}case nO.NORMALCOMPRESSED:{s$31(2===ve.size);const _e=we.getField(fe,FL);s$31(!!_e,`No buffer view for ${fe}`),_e&&u$28(ve,_e,Se);break}case nO.UV0:{s$31(2===ve.size);const _e=we.getField(fe,cL);s$31(!!_e,`No buffer view for ${fe}`),_e&&u$28(ve,_e,Se);break}case nO.COLOR:case nO.SYMBOLCOLOR:{const _e=we.getField(fe,xL);s$31(!!_e,`No buffer view for ${fe}`),s$31(3===ve.size||4===ve.size),!_e||3!==ve.size&&4!==ve.size||S$12(ve,ve.size,_e,Se);break}case nO.COLORFEATUREATTRIBUTE:{const _e=we.getField(fe,lL);s$31(!!_e,`No buffer view for ${fe}`),s$31(1===ve.size),_e&&1===ve.size&&function N$G(fe,ve,_e){const{data:be,indices:we}=fe,Se=ve.typedBuffer,Te=ve.typedBufferStride,Ee=we.length,Ce=be[0];_e*=Te;for(let Oe=0;Oe<Ee;++Oe)Se[_e]=Ce,_e+=Te}(ve,_e,Se);break}case nO.TANGENT:{s$31(4===ve.size);const be=we.getField(fe,hL);s$31(!!be,`No buffer view for ${fe}`),be&&function h$1u(fe,ve,_e,be,we=1){if(!ve)return void p$2y(fe,_e,be,we);const{data:Se,indices:Te}=fe,Ee=ve,Ce=_e.typedBuffer,Oe=_e.typedBufferStride,Re=Te.length,De=Ee[0],Be=Ee[1],Ze=Ee[2],Xe=Ee[4],Je=Ee[5],Qe=Ee[6],dt=Ee[8],$t=Ee[9],bt=Ee[10],wt=!G$Q(Ee),xt=1e-6,St=1-xt;if(be*=Oe,1===we)for(let Et=0;Et<Re;++Et){const fe=4*Te[Et],ve=Se[fe],_e=Se[fe+1],we=Se[fe+2],Ee=Se[fe+3];let Re=De*ve+Xe*_e+dt*we,Pt=Be*ve+Je*_e+$t*we,Ot=Ze*ve+Qe*_e+bt*we;if(wt){const fe=Re*Re+Pt*Pt+Ot*Ot;if(fe<St&&fe>xt){const ve=1/Math.sqrt(fe);Re*=ve,Pt*=ve,Ot*=ve}}Ce[be]=Re,Ce[be+1]=Pt,Ce[be+2]=Ot,Ce[be+3]=Ee,be+=Oe}else for(let Et=0;Et<Re;++Et){const fe=4*Te[Et],ve=Se[fe],_e=Se[fe+1],Ee=Se[fe+2],Re=Se[fe+3];let Pt=De*ve+Xe*_e+dt*Ee,Ot=Be*ve+Je*_e+$t*Ee,At=Ze*ve+Qe*_e+bt*Ee;if(wt){const fe=Pt*Pt+Ot*Ot+At*At;if(fe<St&&fe>xt){const ve=1/Math.sqrt(fe);Pt*=ve,Ot*=ve,At*=ve}}for(let Se=0;Se<we;++Se)Ce[be]=Pt,Ce[be+1]=Ot,Ce[be+2]=At,Ce[be+3]=Re,be+=Oe}}(ve,_e,be,Se);break}case nO.PROFILERIGHT:case nO.PROFILEUP:case nO.PROFILEVERTEXANDNORMAL:case nO.FEATUREVALUE:{s$31(4===ve.size);const _e=we.getField(fe,hL);s$31(!!_e,`No buffer view for ${fe}`),_e&&p$2y(ve,_e,Se)}}}let nj=class u15 extends iO{constructor(fe){super(),this.slicePlaneLocalOrigin=fe}};function _$O(fe,ve){m$1$(fe,ve,new uO("slicePlaneOrigin",((fe,_e)=>H$z(ve,fe,_e))),new uO("slicePlaneBasis1",((fe,_e)=>{var be;return I$S(ve,fe,_e,null==(be=_e.slicePlane)?void 0:be.basis1)})),new uO("slicePlaneBasis2",((fe,_e)=>{var be;return I$S(ve,fe,_e,null==(be=_e.slicePlane)?void 0:be.basis2)})))}function P$H(fe,ve){m$1$(fe,ve,new hM("slicePlaneOrigin",((fe,_e)=>H$z(ve,fe,_e))),new hM("slicePlaneBasis1",((fe,_e)=>{var be;return I$S(ve,fe,_e,null==(be=_e.slicePlane)?void 0:be.basis1)})),new hM("slicePlaneBasis2",((fe,_e)=>{var be;return I$S(ve,fe,_e,null==(be=_e.slicePlane)?void 0:be.basis2)})))}function m$1$(fe,ve,..._e){if(!ve.hasSlicePlane){const _e=o$2P`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return ve.hasSliceInVertexProgram&&fe.vertex.code.add(_e),void fe.fragment.code.add(_e)}ve.hasSliceInVertexProgram&&fe.vertex.uniforms.add(..._e),fe.fragment.uniforms.add(..._e);const be=o$2P`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,we=o$2P`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,Se=ve.hasSliceHighlight?o$2P`
        ${we}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:o$2P`#define highlightSlice(_color_, _pos_) (_color_)`;ve.hasSliceInVertexProgram&&fe.vertex.code.add(be),fe.fragment.code.add(be),fe.fragment.code.add(Se)}function h$1t(fe,ve,_e){return fe.instancedDoublePrecision?o$44(sj,_e.camera.viewInverseTransposeMatrix[3],_e.camera.viewInverseTransposeMatrix[7],_e.camera.viewInverseTransposeMatrix[11]):ve.slicePlaneLocalOrigin}function p$2x(fe,ve){return null!=fe?e$3Z(oj,ve.origin,fe):ve.origin}function g$1l(fe,ve,_e){return fe.hasSliceTranslatedView?null!=ve?i$45(lj,_e.camera.viewMatrix,ve):_e.camera.viewMatrix:null}function H$z(fe,ve,_e){if(null==_e.slicePlane)return Bi;const be=h$1t(fe,ve,_e),we=p$2x(be,_e.slicePlane),Se=g$1l(fe,be,_e);return null!=Se?O$1v(oj,we,Se):we}function I$S(fe,ve,_e,be){if(null==be||null==_e.slicePlane)return Bi;const we=h$1t(fe,ve,_e),Se=p$2x(we,_e.slicePlane),Te=g$1l(fe,we,_e);return null!=Te?(u$3Y(aj,be,Se),O$1v(oj,Se,Te),O$1v(aj,aj,Te),e$3Z(aj,aj,oj)):be}const sj=[0,0,0],oj=[0,0,0],aj=[0,0,0],lj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function d$1J(fe,ve){const _e=ve.output===NI.ObjectAndLayerIdColor,be=ve.objectAndLayerIdColorInstanced;_e&&(fe.varyings.add("objectAndLayerIdColorVarying","vec4"),be?fe.attributes.add(nO.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):fe.attributes.add(nO.OBJECTANDLAYERIDCOLOR,"vec4")),fe.vertex.code.add(o$2P`
     void forwardObjectAndLayerIdColor() {
      ${_e?be?o$2P`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:o$2P`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:o$2P``} }`),fe.fragment.code.add(o$2P`
      void outputObjectAndLayerIdColor() {
        ${_e?o$2P`fragColor = objectAndLayerIdColorVarying;`:o$2P``} }`)}function o$1W(fe){fe.uniforms.add(new zM("alignPixelEnabled",((fe,ve)=>ve.alignPixelEnabled))),fe.code.add(o$2P`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),fe.code.add(o$2P`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function i$2m(fe,ve){const{vertex:_e,fragment:be}=fe;_e.include(o$1W),ve.multipassEnabled&&fe.varyings.add("depth","float"),_e.code.add(o$2P`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${ve.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),fe.include(a$2L,ve),be.code.add(o$2P`
  void main() {
    fragColor = vec4(1);
    ${ve.multipassEnabled?o$2P`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function t$2j(fe){fe.vertex.uniforms.add(new dO("renderTransparentlyOccludedHUD",((fe,ve)=>ve.hudRenderStyle===BR.Occluded?1:ve.hudRenderStyle===BR.NotOccluded?0:.75)),new hO("viewport",((fe,ve)=>ve.camera.fullViewport)),new CO("hudVisibilityTexture",((fe,ve)=>{var _e;return null==(_e=ve.hudVisibility)?void 0:_e.getTexture()}))),fe.vertex.include(o$1W),fe.vertex.code.add(o$2P`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const cj=r$35(1,1,0,1),uj=r$35(1,0,1,1);function a$2n(fe){fe.fragment.uniforms.add(new CO("depthTexture",((fe,ve)=>ve.mainDepth))),fe.fragment.constants.add("occludedHighlightFlag","vec4",cj).add("unoccludedHighlightFlag","vec4",uj),fe.fragment.code.add(o$2P`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let hj=class e26 extends aO{constructor(fe,ve,_e){super(fe,"vec4",oO.Pass,((_e,be,we)=>_e.setUniform4fv(fe,ve(be,we))),_e)}},dj=class o19 extends aO{constructor(fe,ve,_e){super(fe,"float",oO.Pass,((_e,be,we)=>_e.setUniform1fv(fe,ve(be,we))),_e)}},pj=class t37 extends GB{constructor(){super(...arguments),this.renderOccluded=ej.Occlude,this.isDecoration=!1}};const fj=8;function l$2t(fe,ve){const{vertex:_e,attributes:be}=fe;ve.hasVvInstancing&&(ve.vvSize||ve.vvColor)&&be.add(nO.INSTANCEFEATUREATTRIBUTE,"vec4"),ve.vvSize?(_e.uniforms.add(new uO("vvSizeMinSize",(fe=>fe.vvSize.minSize))),_e.uniforms.add(new uO("vvSizeMaxSize",(fe=>fe.vvSize.maxSize))),_e.uniforms.add(new uO("vvSizeOffset",(fe=>fe.vvSize.offset))),_e.uniforms.add(new uO("vvSizeFactor",(fe=>fe.vvSize.factor))),_e.uniforms.add(new oR("vvSymbolRotationMatrix",(fe=>fe.vvSymbolRotationMatrix))),_e.uniforms.add(new uO("vvSymbolAnchor",(fe=>fe.vvSymbolAnchor))),_e.code.add(o$2P`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),_e.code.add(o$2P`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${ve.hasVvInstancing?o$2P`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):_e.code.add(o$2P`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),ve.vvColor?(_e.constants.add("vvColorNumber","int",fj),_e.uniforms.add(new dj("vvColorValues",(fe=>fe.vvColor.values),fj),new hj("vvColorColors",(fe=>fe.vvColor.colors),fj)),_e.code.add(o$2P`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${ve.hasVvInstancing?o$2P`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):_e.code.add(o$2P`vec4 vvColor() { return vec4(1.0); }`)}const mj=.1,yj=.001;function F$C(fe){const ve=new gO,_e=fe.signedDistanceFieldEnabled;if(ve.include(d$1M,fe),ve.include(P$H,fe),fe.occlusionPass)return ve.include(i$2m,fe),ve;const{vertex:be,fragment:we}=ve;ve.include(s$2o),we.include(a$32),we.include(e$2S),ve.include(l$2t,fe),ve.include(d$1J,fe),ve.include(t$2j),ve.varyings.add("vcolor","vec4"),ve.varyings.add("vtc","vec2"),ve.varyings.add("vsize","vec2"),ve.varyings.add("voccluded","float"),be.uniforms.add(new hO("viewport",((fe,ve)=>ve.camera.fullViewport)),new lO("screenOffset",((fe,ve)=>o$2R(gj,2*fe.screenOffset[0]*ve.camera.pixelRatio,2*fe.screenOffset[1]*ve.camera.pixelRatio))),new lO("anchorPosition",(fe=>D$G(fe))),new hO("materialColor",(fe=>fe.color))),w$1d(be),_e&&(be.uniforms.add(new hO("outlineColor",(fe=>fe.outlineColor))),we.uniforms.add(new hO("outlineColor",(fe=>L$C(fe)?fe.outlineColor:_d)),new dO("outlineSize",(fe=>L$C(fe)?fe.outlineSize:0)))),fe.pixelSnappingEnabled&&be.include(o$1W),fe.hasScreenSizePerspective&&(function t$2l(fe){fe.uniforms.add(new uO("screenSizePerspective",(fe=>i$2o(fe.screenSizePerspective))))}(be),o$1Y(be)),fe.debugDrawLabelBorder&&ve.varyings.add("debugBorderCoords","vec4"),ve.attributes.add(nO.UV0,"vec2"),ve.attributes.add(nO.COLOR,"vec4"),ve.attributes.add(nO.SIZE,"vec2"),ve.attributes.add(nO.FEATUREATTRIBUTE,"vec4"),be.code.add(o$2P`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${fe.hasScreenSizePerspective?o$2P`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:o$2P`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${fe.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const Se=o$2P`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,Te=fe.pixelSnappingEnabled?_e?o$2P`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:o$2P`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:o$2P`posProj += quadOffset;`;be.code.add(o$2P`
    ${fe.occlusionTestEnabled?"if (visible) {":""}
    ${Se}
    ${fe.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${o$2P.float(yj)};
    ${_e?`alphaDiscard = alphaDiscard && outlineColor.a < ${o$2P.float(yj)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${Te}
      gl_Position = posProj;
    }

    vtc = uv;

    ${fe.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${fe.occlusionTestEnabled?o$2P`} else { vtc = vec2(0.0);
      ${fe.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),we.uniforms.add(new CO("tex",(fe=>fe.texture)));const Ee=fe.debugDrawLabelBorder?o$2P`(isBorder > 0.0 ? 0.0 : ${o$2P.float(mj)})`:o$2P.float(mj),Ce=o$2P`
    ${fe.debugDrawLabelBorder?o$2P`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${fe.sampleSignedDistanceFieldTexelCenter?o$2P`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:o$2P`
      vec2 samplePos = vtc;
      `}

    ${_e?o$2P`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${Ee} ||
          fillPixelColor.a + outlinePixelColor.a < ${o$2P.float(yj)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${Ee}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:o$2P`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${Ee}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${fe.debugDrawLabelBorder?o$2P`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(fe.output){case NI.Color:fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),we.code.add(o$2P`
        void main() {
          ${Ce}
          ${fe.transparencyPassType===WR.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${fe.transparencyPassType===WR.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case NI.ObjectAndLayerIdColor:we.code.add(o$2P`
        void main() {
          ${Ce}
          outputObjectAndLayerIdColor();
        }`);break;case NI.Highlight:we.constants.add("occludedHighlightFlag","vec4",cj),we.constants.add("unoccludedHighlightFlag","vec4",uj),we.code.add(o$2P`
        void main() {
          ${Ce}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return ve}function L$C(fe){return fe.outlineColor[3]>0&&fe.outlineSize>0}function D$G(fe,ve=gj){return fe.textureIsSignedDistanceField?function B$v(fe,ve,_e){null!=ve?o$2R(_e,fe[0]*(ve[2]-ve[0])+ve[0],fe[1]*(ve[3]-ve[1])+ve[1]):o$2R(_e,0,0)}(fe.anchorPosition,fe.distanceFieldBoundingBox,ve):r$2C(ve,fe.anchorPosition),ve}const gj=[0,0],vj=Object.freeze(Object.defineProperty({__proto__:null,build:F$C,calculateAnchorPosForRendering:D$G},Symbol.toStringTag,{value:"Module"})),_j=l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),$j=l$2_(FO.ONE,FO.ZERO,FO.ONE,FO.ONE_MINUS_SRC_ALPHA);function c$2o(fe){return fe===WR.FrontFace?null:$j}function l$2s(fe){return fe===WR.FrontFace?OA:null}const bj=5e5,wj={factor:-1,units:-2};function _$N(fe){return fe?wj:null}function f$1O(fe,ve=jO.LESS){return fe===WR.NONE||fe===WR.FrontFace?ve:jO.LEQUAL}function s$2m(fe){return fe===WR.ColorAlpha?{buffers:[nA.COLOR_ATTACHMENT0,nA.COLOR_ATTACHMENT1]}:null}let xj=class b8 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global}initializeProgram(fe){return new gA(fe.rctx,b8.shader.get().build(this.configuration),mA)}initializePipeline(){const fe=this.configuration.transparencyPassType,ve=this.configuration,_e=fe===WR.NONE,be=fe===WR.FrontFace,we=this.configuration.hasPolygonOffset?Sj:null,Se=ve.draped?null:(_e||be)&&ve.output!==NI.Highlight&&(ve.depthEnabled||ve.occlusionPass)?OA:null;return S$1g({blending:ve.output===NI.Color||ve.output===NI.Highlight?_e?Tj:c$2o(fe):null,depthTest:ve.draped?null:{func:jO.LEQUAL},depthWrite:Se,drawBuffers:s$2m(fe),colorWrite:AA,polygonOffset:we})}get primitiveType(){return this.configuration.occlusionPass?NO.POINTS:NO.TRIANGLES}};xj.shader=new LO(vj,(()=>zt((()=>Promise.resolve().then((()=>iRe))),void 0)));const Sj={factor:0,units:-4},Tj=s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA);let Ej=class r17 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.transparencyPassType=WR.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};e$4o([r$2w({count:NI.COUNT})],Ej.prototype,"output",void 0),e$4o([r$2w({count:WR.COUNT})],Ej.prototype,"transparencyPassType",void 0),e$4o([r$2w()],Ej.prototype,"screenCenterOffsetUnitsEnabled",void 0),e$4o([r$2w()],Ej.prototype,"spherical",void 0),e$4o([r$2w()],Ej.prototype,"occlusionTestEnabled",void 0),e$4o([r$2w()],Ej.prototype,"signedDistanceFieldEnabled",void 0),e$4o([r$2w()],Ej.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),e$4o([r$2w()],Ej.prototype,"vvSize",void 0),e$4o([r$2w()],Ej.prototype,"vvColor",void 0),e$4o([r$2w()],Ej.prototype,"hasVerticalOffset",void 0),e$4o([r$2w()],Ej.prototype,"hasScreenSizePerspective",void 0),e$4o([r$2w()],Ej.prototype,"debugDrawLabelBorder",void 0),e$4o([r$2w()],Ej.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Ej.prototype,"hasPolygonOffset",void 0),e$4o([r$2w()],Ej.prototype,"depthEnabled",void 0),e$4o([r$2w()],Ej.prototype,"pixelSnappingEnabled",void 0),e$4o([r$2w()],Ej.prototype,"draped",void 0),e$4o([r$2w()],Ej.prototype,"multipassEnabled",void 0),e$4o([r$2w()],Ej.prototype,"cullAboveGround",void 0),e$4o([r$2w()],Ej.prototype,"occlusionPass",void 0),e$4o([r$2w()],Ej.prototype,"objectAndLayerIdColorInstanced",void 0),e$4o([r$2w({constValue:!0})],Ej.prototype,"hasSliceInVertexProgram",void 0),e$4o([r$2w({constValue:!1})],Ej.prototype,"hasVvInstancing",void 0);let Pj=class Q2 extends QB{constructor(fe){super(fe,new Ae),this._configuration=new Ej,this.produces=new Map([[qR.HUD_MATERIAL,fe=>a$2J(fe)&&!this.parameters.drawInSecondSlot],[qR.LABEL_MATERIAL,fe=>a$2J(fe)&&this.parameters.drawInSecondSlot],[qR.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[qR.DRAPED_MATERIAL,fe=>a$2J(fe)]])}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=ve.slot===qR.OCCLUSION_PIXELS&&this.parameters.occlusionTest,fe===NI.Color&&(this._configuration.debugDrawLabelBorder=!!_B.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration}intersect(fe,ve,_e,be,we,Se){if(!(_e.options.selectionMode&&_e.options.hud&&fe.visible&&_e.point))return;const Te=this.parameters,Ee=_e.point,Ce=_e.camera;let{scaleX:Oe,scaleY:Re}=this._getScreenScale(fe);Oe*=Ce.pixelRatio,Re*=Ce.pixelRatio,n$3X(Dj,ve),fe.attributes.has(nO.FEATUREATTRIBUTE)&&function re$9(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3],Se=fe[4],Te=fe[5],Ee=fe[6],Ce=fe[7],Oe=fe[8],Re=1/Math.sqrt(ve*ve+_e*_e+be*be),De=1/Math.sqrt(we*we+Se*Se+Te*Te),Be=1/Math.sqrt(Ee*Ee+Ce*Ce+Oe*Oe);return fe[0]=ve*Re,fe[1]=_e*Re,fe[2]=be*Re,fe[3]=we*De,fe[4]=Se*De,fe[5]=Te*De,fe[6]=Ee*Be,fe[7]=Ce*Be,fe[8]=Oe*Be,fe}(Dj);const De=fe.attributes.get(nO.POSITION),Be=fe.attributes.get(nO.SIZE),Ze=fe.attributes.get(nO.NORMAL),Xe=fe.attributes.get(nO.CENTEROFFSETANDDISTANCE);s$31(De.size>=3);const Je=D$G(Te),Qe="screen"===this.parameters.centerOffsetUnits;for(let dt=0;dt<De.data.length/De.size;dt++){const fe=dt*De.size;o$44(Aj,De.data[fe],De.data[fe+1],De.data[fe+2]),O$1v(Aj,Aj,ve);const be=dt*Be.size;Gj[0]=Be.data[be]*Oe,Gj[1]=Be.data[be+1]*Re,O$1v(Aj,Aj,Ce.viewMatrix);const we=dt*Xe.size;if(o$44(zj,Xe.data[we],Xe.data[we+1],Xe.data[we+2]),!Qe&&(Aj[0]+=zj[0],Aj[1]+=zj[1],0!==zj[2])){const fe=zj[2];z$1d(zj,Aj),e$3Z(Aj,Aj,g$2z(zj,zj,fe))}const $t=dt*Ze.size;if(o$44(Mj,Ze.data[$t],Ze.data[$t+1],Ze.data[$t+2]),te$a(Mj,Dj,Ce,Vj),this._applyVerticalOffsetTransformationView(Aj,Vj,Ce,Oj),Ce.applyProjection(Aj,Rj),Rj[0]>-1){Qe&&(zj[0]||zj[1])&&(Rj[0]+=zj[0]*Ce.pixelRatio,0!==zj[1]&&(Rj[1]+=s$2p(zj[1],Oj.factorAlignment)*Ce.pixelRatio),Ce.unapplyProjection(Rj,Aj)),Rj[0]+=this.parameters.screenOffset[0]*Ce.pixelRatio,Rj[1]+=this.parameters.screenOffset[1]*Ce.pixelRatio,Rj[0]=Math.floor(Rj[0]),Rj[1]=Math.floor(Rj[1]),f$1Q(Gj,Oj.factor,Gj);const fe=Bj*Ce.pixelRatio;let ve=0;if(Te.textureIsSignedDistanceField&&(ve=Te.outlineSize*Ce.pixelRatio/2),se$a(Ee,Rj[0],Rj[1],Gj,fe,ve,Te,Je)){const fe=_e.ray;if(O$1v(Lj,Aj,h$2A(Fj,Ce.viewMatrix)),Rj[0]=Ee[0],Rj[1]=Ee[1],Ce.unprojectFromRenderScreen(Rj,Aj)){const ve=[0,0,0];r$3w(ve,fe.direction);const _e=1/s$4g(ve);g$2z(ve,ve,_e),Se(x$1W(fe.origin,Aj)*_e,ve,-1,!0,1,Lj)}}}}}intersectDraped(fe,ve,_e,be,we,Se){const Te=fe.attributes.get(nO.POSITION),Ee=fe.attributes.get(nO.SIZE),Ce=this.parameters,Oe=D$G(Ce);let{scaleX:Re,scaleY:De}=this._getScreenScale(fe);Re*=fe.screenToWorldRatio,De*=fe.screenToWorldRatio;const Be=jj*fe.screenToWorldRatio;for(let Ze=0;Ze<Te.data.length/Te.size;Ze++){const ve=Ze*Te.size,_e=Te.data[ve],Xe=Te.data[ve+1],Je=Ze*Ee.size;Gj[0]=Ee.data[Je]*Re,Gj[1]=Ee.data[Je+1]*De;let Qe=0;Ce.textureIsSignedDistanceField&&(Qe=Ce.outlineSize*fe.screenToWorldRatio/2),se$a(be,_e,Xe,Gj,Be,Qe,Ce,Oe)&&we(Se.dist,Se.normal,-1,!1)}}createBufferWriter(){return new Yj(this)}_updateScaleInfo(fe,ve,_e){const be=this.parameters;null!=be.screenSizePerspective?u$2a(_e,ve,be.screenSizePerspective,fe.factor):(fe.factor.scale=1,fe.factor.factor=0,fe.factor.minScaleFactor=0),null!=be.screenSizePerspectiveAlignment?u$2a(_e,ve,be.screenSizePerspectiveAlignment,fe.factorAlignment):(fe.factorAlignment.factor=fe.factor.factor,fe.factorAlignment.scale=fe.factor.scale,fe.factorAlignment.minScaleFactor=fe.factor.minScaleFactor)}applyShaderOffsetsView(fe,ve,_e,be,we,Se,Te){const Ee=te$a(ve,_e,we,Vj);return this._applyVerticalGroundOffsetView(fe,Ee,we,Te),this._applyVerticalOffsetTransformationView(Te,Ee,we,Se),this._applyPolygonOffsetView(Te,Ee,be[3],we,Te),this._applyCenterOffsetView(Te,be,Te),Te}applyShaderOffsetsNDC(fe,ve,_e,be,we){return this._applyCenterOffsetNDC(fe,ve,_e,be),null!=we&&r$3w(we,be),this._applyPolygonOffsetNDC(be,ve,_e,be),be}_applyPolygonOffsetView(fe,ve,_e,be,we){const Se=be.aboveGround?1:-1;let Te=Math.sign(_e);0===Te&&(Te=Se);const Ee=Se*Te;if(this.parameters.shaderPolygonOffset<=0)return r$3w(we,fe);const Ce=e$3Y(Math.abs(ve.cosAngle),.01,1),Oe=1-Math.sqrt(1-Ce*Ce)/Ce/be.viewport[2];return g$2z(we,fe,Ee>0?Oe:1/Oe),we}_applyVerticalGroundOffsetView(fe,ve,_e,be){const we=s$4g(fe),Se=_e.aboveGround?1:-1,Te=_e.computeRenderPixelSizeAtDist(we)*XB;return u$3Y(be,fe,g$2z(Aj,ve.normal,Se*Te)),be}_applyVerticalOffsetTransformationView(fe,ve,_e,be){var we;const Se=this.parameters;if(!(null==(we=Se.verticalOffset)?void 0:we.screenLength)){if(Se.screenSizePerspective||Se.screenSizePerspectiveAlignment){const _e=s$4g(fe);this._updateScaleInfo(be,_e,ve.cosAngle)}else be.factor.scale=1,be.factorAlignment.scale=1;return fe}const Te=s$4g(fe),Ee=Se.screenSizePerspectiveAlignment??Se.screenSizePerspective,Ce=o$1X(_e,Te,Se.verticalOffset,ve.cosAngle,Ee);return this._updateScaleInfo(be,Te,ve.cosAngle),g$2z(ve.normal,ve.normal,Ce),u$3Y(fe,fe,ve.normal)}_applyCenterOffsetView(fe,ve,_e){const be="screen"!==this.parameters.centerOffsetUnits;return _e!==fe&&r$3w(_e,fe),be&&(_e[0]+=ve[0],_e[1]+=ve[1],ve[2]&&(z$1d(Mj,_e),u$3Y(_e,_e,g$2z(Mj,Mj,ve[2])))),_e}_applyCenterOffsetNDC(fe,ve,_e,be){const we="screen"!==this.parameters.centerOffsetUnits;return be!==fe&&r$3w(be,fe),we||(be[0]+=ve[0]/_e.fullWidth*2,be[1]+=ve[1]/_e.fullHeight*2),be}_applyPolygonOffsetNDC(fe,ve,_e,be){const we=this.parameters.shaderPolygonOffset;if(fe!==be&&r$3w(be,fe),we){const fe=_e.aboveGround?1:-1,Se=fe*Math.sign(ve[3]);be[2]-=(Se||fe)*we}return be}createGLMaterial(fe){return new Cj(fe)}calculateRelativeScreenBounds(fe,ve,_e=u$3J()){return function ee$a(fe,ve,_e,be){be[0]=fe.anchorPosition[0]*-ve[0]+fe.screenOffset[0]*_e,be[1]=fe.anchorPosition[1]*-ve[1]+fe.screenOffset[1]*_e}(this.parameters,fe,ve,_e),_e[2]=_e[0]+fe[0],_e[3]=_e[1]+fe[1],_e}_getScreenScale(fe){const ve=fe.attributes.get(nO.FEATUREATTRIBUTE);if(null==ve)return{scaleX:1,scaleY:1};const _e=e$3C(ve.data,Uj),[be,we]=W$t(kj,this.parameters,_e);return{scaleX:be,scaleY:we}}},Cj=class $ extends fM{constructor(fe){super({...fe,...fe.material.parameters})}selectProgram(fe){return this.ensureTechnique(xj,fe)}beginSlot(fe){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(fe)}};function te$a(fe,ve,_e,be){return t$2m(ve)&&(ve=n$3X(Nj,ve)),S$1P(be.normal,fe,ve),O$1v(be.normal,be.normal,_e.viewInverseTransposeMatrix),be.cosAngle=P$1g(Ij,Hj),be}function se$a(fe,ve,_e,be,we,Se,Te,Ee){let Ce=ve-we-(Ee[0]>0?be[0]*Ee[0]:0),Oe=Ce+be[0]+2*we,Re=_e-we-(Ee[1]>0?be[1]*Ee[1]:0),De=Re+be[1]+2*we;const Be=Te.distanceFieldBoundingBox;return Te.textureIsSignedDistanceField&&null!=Be&&(Ce+=be[0]*Be[0],Re+=be[1]*Be[1],Oe-=be[0]*(1-Be[2]),De-=be[1]*(1-Be[3]),Ce-=Se,Oe+=Se,Re-=Se,De+=Se),fe[0]>Ce&&fe[0]<Oe&&fe[1]>Re&&fe[1]<De}const Oj=new rj,Aj=[0,0,0],Mj=[0,0,0],Rj=[0,0,0,0],Ij=[0,0,0],Lj=[0,0,0],Dj=[1,0,0,0,1,0,0,0,1],Nj=[1,0,0,0,1,0,0,0,1],Fj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zj=[0,0,0],kj=[0,0,0],Uj=[0,0,0,0],Vj={normal:Ij,cosAngle:0},Bj=1,jj=2,Gj=[0,0],Hj=r$3y(0,0,1);class Ae extends mM{constructor(){super(...arguments),this.renderOccluded=ej.Occlude,this.isDecoration=!1,this.color=r$35(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=r$36(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=r$35(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const qj=H$J().vec3f(nO.POSITION).vec3f(nO.NORMAL).vec2f(nO.UV0).vec4u8(nO.COLOR).vec2f(nO.SIZE).vec4f(nO.CENTEROFFSETANDDISTANCE).vec4f(nO.FEATUREATTRIBUTE),Wj=qj.clone().vec4u8(nO.OBJECTANDLAYERIDCOLOR);let Yj=class Ie{constructor(fe){this._material=fe,this.vertexBufferLayout=has("enable-feature:objectAndLayerId-rendering")?Wj:qj}elementCount(fe){return 6*fe.attributes.get(nO.POSITION).indices.length}write(fe,ve,_e,be,we){var Se;b$19(_e.attributes.get(nO.POSITION),fe,be.position,we,6),O$N(_e.attributes.get(nO.NORMAL),ve,be.normal,we,6);const Te=_e.attributes.get(nO.UV0).data;let Ee,Ce,Oe,Re;if(null==Te||Te.length<4){const fe=this._material.parameters;Ee=0,Ce=0,Oe=fe.texCoordScale[0],Re=fe.texCoordScale[1]}else Ee=Te[0],Ce=Te[1],Oe=Te[2],Re=Te[3];Oe=Math.min(1.99999,Oe+1),Re=Math.min(1.99999,Re+1);let De=_e.attributes.get(nO.POSITION).indices.length,Be=we;const Ze=be.uv0;for(let dt=0;dt<De;++dt)Ze.set(Be,0,Ee),Ze.set(Be,1,Ce),Be++,Ze.set(Be,0,Oe),Ze.set(Be,1,Ce),Be++,Ze.set(Be,0,Oe),Ze.set(Be,1,Re),Be++,Ze.set(Be,0,Oe),Ze.set(Be,1,Re),Be++,Ze.set(Be,0,Ee),Ze.set(Be,1,Re),Be++,Ze.set(Be,0,Ee),Ze.set(Be,1,Ce),Be++;S$12(_e.attributes.get(nO.COLOR),4,be.color,we,6);const{data:Xe,indices:Je}=_e.attributes.get(nO.SIZE);De=Je.length;const Qe=be.size;Be=we;for(let dt=0;dt<De;++dt){const fe=Xe[2*Je[dt]],ve=Xe[2*Je[dt]+1];for(let _e=0;_e<6;++_e)Qe.set(Be,0,fe),Qe.set(Be,1,ve),Be++}if(_e.attributes.get(nO.CENTEROFFSETANDDISTANCE)?p$2y(_e.attributes.get(nO.CENTEROFFSETANDDISTANCE),be.centerOffsetAndDistance,we,6):y$1d(be.centerOffsetAndDistance,we,6*De),_e.attributes.get(nO.FEATUREATTRIBUTE)?p$2y(_e.attributes.get(nO.FEATUREATTRIBUTE),be.featureAttribute,we,6):y$1d(be.featureAttribute,we,6*De),null!=_e.objectAndLayerIdColor){const fe=null==(Se=_e.attributes.get(nO.POSITION))?void 0:Se.indices;if(fe){const ve=fe.length,Se=be.getField(nO.OBJECTANDLAYERIDCOLOR,xL);R$N(_e.objectAndLayerIdColor,Se,ve,we,6)}}}};const Zj=[0,0,0],Xj=[0,0,0,0],Jj=[0,0,0,0],Qj=[0,0,0],Kj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],eG=[0,0,0,0],tG=m$3f(),rG=[0,0,0],iG=u$3J();class ii{constructor(){this.aabr=u$3J(),this.distance=0,this.culled=!1,this.visible=!1}}class ti{constructor(fe,ve){this.graphics3DGraphic=fe,this.slicePlaneEnabled=ve,this.info={}}}var nG;!function(fe){fe[fe.Idle=0]="Idle",fe[fe.Process=1]="Process",fe[fe.Sort=2]="Sort",fe[fe.Deconflict=3]="Deconflict",fe[fe.NumStates=4]="NumStates"}(nG||(nG={}));class ei{constructor(){this.camera=new NR,this.slicePlane=W$H(),this.slicePlaneEnabled=!1}copyFrom(fe){this.camera.copyFrom(fe.camera),Z$A(fe.slicePlane,this.slicePlane),this.slicePlaneEnabled=fe.slicePlaneEnabled}}let sG=class extends zi{get dirty(){return this._dirty}get state(){return this._state}constructor(fe){super(fe),this._dirty=!1,this._viewState=new ei,this._state=nG.Idle,this._active=new Map,this._visible=new Map,this._iterators=new li,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==nG.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const fe=this._state/nG.NumStates;return this._dirty?.5*fe:fe}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(fe){switch(this._state){case nG.Idle:this._startUpdate(),fe.madeProgress();case nG.Process:if(this._state=nG.Process,!this._processActiveGraphics(fe))return;case nG.Sort:if(this._state=nG.Sort,!this._sortVisibleGraphics(fe))return;case nG.Deconflict:if(this._state=nG.Deconflict,!this._deconflictVisibleGraphics(fe))return;default:(function c$2t(fe,ve){if(!xB||!bB)return;u$2b();const _e=bB;let be=0;for(let we=0;we<fe.accBinsNumX;we++)for(let ve=0;ve<fe.accBinsNumY;ve++){const Se=fe.accBins[we][fe.accBinsNumY-1-ve];be+=Se.length;const Te=we*fe.accBinsSizeX,Ee=(we+1)*fe.accBinsSizeX,Ce=ve*fe.accBinsSizeY,Oe=(ve+1)*fe.accBinsSizeY;_e.fillText(Se.length.toFixed(),Te+5,Ce+15),h$1y(Te,Ee,Ce,Oe,"blue")}_e.fillText("total totalShownLabels: "+be,70,40),_e.fillText("total visible labels: "+ve.size,70,50),_e.fillText("total numTests: "+fe.accNumTests,70,30)})(this,this._visible),this._state=nG.Idle,this.notifyChange("updating")}}modifyGraphics(fe,ve){ve?fe.forEach((fe=>this.addToActiveGraphics(fe))):fe.forEach((fe=>this.removeFromActiveGraphics(fe))),this.setDirty()}layerSupportsDeconfliction(fe){if(null==fe||"object3d"!==fe.type)return!1;const ve=fe.stageObject;if(1!==((null==ve?void 0:ve.geometries.length)??0))return!1;const _e=null==ve?void 0:ve.geometries[0];return(null==_e?void 0:_e.material)instanceof Pj}_startUpdate(){r$21(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:fe,fullHeight:ve}=this._viewState.camera;this._initBins(fe,ve),this._resetIterators()}addToActiveGraphics(fe){fe.info[this.visibilityGroup]=new ii,this._active.set(fe.graphics3DGraphic.graphic.uid,fe),this.setDirty()}removeFromActiveGraphics(fe){this._visible.delete(fe.graphics3DGraphic.graphic.uid),function ai(fe,ve){const _e=fe.graphics3DGraphic;_e.destroyed||_e.setVisibilityFlag(ve,PB.DECONFLICTION,!0)}(fe,this.visibilityGroup),delete fe.info[this.visibilityGroup],this._active.delete(fe.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(fe){const ve=this._ensureActiveGraphicsIterator(),_e=e$3H(Kj,this._viewState.camera.projectionMatrix),be="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._viewState.camera.relativeElevation>0?eG:null;let we=0;for(null!=be&&(O$1v(be,Bi,this._viewState.camera.viewMatrix),be[3]=s$45(this.view.spatialReference).radius,we=W$G(be,Bi));!fe.done;){fe.madeProgress();const Se=ve.next();if(!0===Se.done)return this._resetActiveGraphicsIterator(),!0;const Te=Se.value,Ee=null==Te?void 0:Te.info[this.visibilityGroup];Ee&&(this._collectGraphics3DGraphics(Te,_e,be,we),Ee.culled?this._visible.delete(Te.graphics3DGraphic.graphic.uid):this._visible.set(Te.graphics3DGraphic.graphic.uid,Te))}return!1}_sortVisibleGraphics(fe){const ve=this._ensureSortGraphicsIterator();for(;!fe.done;){const _e=ve.next();if(fe.madeProgress(),!0===_e.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(fe){const ve=this._ensureVisibleGraphicsIterator(),_e=this.visibilityGroup===CB.LABEL;for(;!fe.done;){fe.madeProgress();const be=ve.next();if(!0===be.done)return this._resetVisibleGraphicsIterator(),!0;const we=be.value,Se=we.info[this.visibilityGroup];if(!Se||Se.culled){this._setGraphicVisibility(we,!1);continue}const Te=we.graphics3DGraphic,Ee=!_e||Te.isVisible();Se.visible=Ee&&!this._isConflicted(we),Se.visible&&this._addToBins(we),this._setGraphicVisibility(we,Se.visible),f$1R(Se,Se.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=oi(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=oi(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=function*ci(fe,ve,_e){ve.clear(),fe.forEach(((fe,be)=>{var we;const Se=ve.pushNew();Se.id=be,Se.visible=fe.graphics3DGraphic.getVisibilityFlag(_e,PB.DECONFLICTION);const Te=null==(we=fe.info)?void 0:we[_e];Se.prio=fe.graphics3DGraphic.deconflictionPriority,Se.distance=Te?Te.distance:Number.MAX_VALUE})),yield;const be=ve.iterableSort(((fe,ve)=>fe.prio!==ve.prio?ve.prio-fe.prio:fe.distance!==ve.distance?fe.distance-ve.distance:fe.visible!==ve.visible?fe.visible?-1:1:fe.id-ve.id));for(let we=be.next();!we.done;we=be.next())yield;ve.forAll((ve=>{const _e=fe.get(ve.id);_e&&(fe.delete(ve.id),fe.set(ve.id,_e))})),ve.clear()}(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(fe,ve,_e,be){const we=fe.graphics3DGraphic;if(we.destroyed)return;const Se=fe.info[this.visibilityGroup];if(!we.isVisible(CB.GRAPHIC,PB.DECONFLICTION))return void(Se.culled=!0);const Te=this.getGraphicsLayers(we);D$19(Se.aabr);let Ee=null;for(const Ce of Te){if(!this.layerSupportsDeconfliction(Ce))continue;const we=Ce.stageObject.geometries[0].material;if(null==Ee&&(Ee=aG,this._getProjectionInfo(Ce,ve,Ee),Ee.isOutsideScreen||this._isCulledBySlice(fe,Zj)||null!=_e&&ui(Ee,_e,be)))return void(Se.culled=!0);this._expandBoundingRect(Se,Ce,we,Ee)}null==Ee?Se.culled=!0:(Se.distance=Ee.distance,Se.culled=!1)}_getProjectionInfo(fe,ve,_e){const be=this._viewState.camera,we=fe.stageObject,Se=we.geometries[0],Te=Se.material,Ee=we.boundingVolumeWorldSpace.bounds;O$1v(Zj,Ee,be.viewMatrix);const Ce=Se.attributes,Oe=Ce.get(nO.NORMAL).data,Re=Ce.get(nO.CENTEROFFSETANDDISTANCE).data;Te.applyShaderOffsetsView(Zj,Oe,we.transformation,Re,be,_e.scaleInfo,Zj),s$3I(Xj,Zj[0],Zj[1],Zj[2],1),z$13(Jj,Xj,be.projectionMatrix),g$2z(_e.positionNDC,Jj,1/Jj[3]),Te.applyShaderOffsetsNDC(_e.positionNDC,Re,be,_e.positionNDC,Qj),_e.distanceWithoutPolygonOffset=be.depthNDCToWorld(Qj[2]),_e.distance=Qj[2]===_e.positionNDC[2]?_e.distanceWithoutPolygonOffset:be.depthNDCToWorld(_e.positionNDC[2]),s$3I(Jj,_e.positionNDC[0],_e.positionNDC[1],_e.positionNDC[2],1),z$13(Xj,Jj,ve),m$3i(Xj,Xj,1/Xj[3]),o$44(_e.positionView,Zj[0],Zj[1],Zj[2])}_isCulledBySlice(fe,ve){return fe.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&us(this._viewState.slicePlane,ve)}_expandBoundingRect(fe,ve,_e,{positionNDC:be,scaleInfo:we}){const Se=this._viewState.camera,Te=ve.getScreenSize(oG);f$1Q(Te,we.factor,Te),Te[0]*=Se.pixelRatio,Te[1]*=Se.pixelRatio;const Ee=z$16(_e.calculateRelativeScreenBounds(Te,we.factorAlignment.scale,iG),f$3i(0,Se.fullWidth,.5+.5*be[0]),f$3i(0,Se.fullHeight,.5+.5*be[1])),Ce=this.marginFactor;if(0!==Ce){const fe=Ce*Math.min(M$1o(Ee),s$41(Ee));Ee[0]-=fe,Ee[1]-=fe,Ee[2]+=fe,Ee[3]+=fe}m$3A(fe.aabr,Ee,fe.aabr)}_isConflicted(fe){const ve=fe.graphics3DGraphic.graphic.uid,_e=fe.info[this.visibilityGroup];let be=!0;for(let we=Math.floor(_e.aabr[0]/this._accBinsSizeX);we<=Math.floor(_e.aabr[2]/this._accBinsSizeX);we++)if(!(we<0||we>=this._accBinsNumX))for(let fe=Math.floor(_e.aabr[1]/this._accBinsSizeY);fe<=Math.floor(_e.aabr[3]/this._accBinsSizeY);fe++){if(fe<0||fe>=this._accBinsNumY)continue;be=!1;const Se=this._accBins[we][fe];for(let fe=0;fe<Se.length;fe++){const be=Se.data[fe],we=be.info[this.visibilityGroup];if(we&&we.visible&&be.graphics3DGraphic.graphic.uid!==ve&&(this.accNumTests++,E$1H(we.aabr,_e.aabr)))return!0}}return be}_initBins(fe,ve){if(null==this._accBins){this._accBins=[];for(let fe=0;fe<this._accBinsNumX;fe++){this._accBins.push([]);const fe=this._accBins[this._accBins.length-1];for(let ve=0;ve<this._accBinsNumY;ve++)fe.push(new jr)}}else for(let _e=0;_e<this._accBinsNumX;_e++)for(let fe=0;fe<this._accBinsNumY;fe++)this._accBins[_e][fe].clear();this._accBinsSizeX=fe/this._accBinsNumX,this._accBinsSizeY=ve/this._accBinsNumY,this.accNumTests=0}_addToBins(fe){const ve=fe.info[this.visibilityGroup],_e=Math.floor(ve.aabr[0]/this._accBinsSizeX),be=Math.floor(ve.aabr[2]/this._accBinsSizeX),we=Math.floor(ve.aabr[1]/this._accBinsSizeY),Se=Math.floor(ve.aabr[3]/this._accBinsSizeY);for(let Te=_e;Te<=be;Te++)if(!(Te<0||Te>=this._accBinsNumX))for(let ve=we;ve<=Se;ve++)ve<0||ve>=this._accBinsNumY||this._accBins[Te][ve].push(fe)}_setGraphicVisibility(fe,ve){const _e=fe.graphics3DGraphic;_e.destroyed||(_e.setVisibilityFlag(this.visibilityGroup,PB.DECONFLICTION,ve),this.visibilityGroup===CB.LABEL&&this.view.labeler.setLabelGraphicVisibility(_e,ve))}};function*oi(fe){if(Map.prototype.entries){const ve=fe.entries();for(let fe=ve.next();!fe.done;fe=ve.next())yield fe.value[1]}else yield*fe.values()}e$4o([y$2v({constructOnly:!0})],sG.prototype,"view",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],sG.prototype,"updating",null),sG=e$4o([a$4y("esri.views.3d.layers.graphics.Deconflictor")],sG);class ni{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class li{constructor(fe=null,ve=null,_e=null){this.active=fe,this.visible=ve,this.sort=_e,this.sortArray=new jr({allocator:fe=>fe||new ni})}}const oG=[0,0];function ui(fe,ve,_e){return r$3w(tG.direction,fe.positionView),o$44(tG.origin,0,0,0),!!X$t(ve,tG,rG)&&fe.distanceWithoutPolygonOffset>_e}const aG=new class pi{constructor(){this.positionView=[0,0,0],this.positionNDC=[0,0,0],this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new rj}get isOutsideScreen(){const fe=this.positionNDC;return fe[0]<-1||fe[1]<-1||fe[2]<-1||fe[0]>=1||fe[1]>=1}};let lG=class p22 extends sG{constructor(fe){super(fe),this.visibilityGroup=CB.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(fe){if(this.parent.running)return dI;const ve=performance.now();if(fe.state!==PM.IDLE&&ve-this._lastDeconfliction<2e3)return dI;super.runTask(fe),this.state===nG.Idle&&(this._lastDeconfliction=ve)}enabledChanged(fe,ve){this.modifyGraphics(ve,fe.labelsEnabled)}getGraphicsLayers(fe){return fe.labelLayers}};e$4o([y$2v({constructOnly:!0})],lG.prototype,"parent",void 0),lG=e$4o([a$4y("esri.views.3d.layers.graphics.LabelDeconflictor")],lG);let cG=class u16 extends sG{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=CB.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:fe=>{this._marginFactor=fe,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([d$3d((()=>{var fe,ve;return null==(ve=null==(fe=this.view)?void 0:fe.state)?void 0:ve.camera}),(()=>{this._updateViewState(),this.setDirty()})),d$3d((()=>{var fe,ve,_e;return null==(_e=null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.ground)?void 0:_e.opacity}),((fe,ve)=>{1!==fe&&1!==ve||this.setDirty()})),d$3d((()=>{var fe;return null==(fe=this.view)?void 0:fe.slicePlane}),(()=>{this._updateSlicePlane(),this._slicePlaneChanged()}),Xa)]),this._frameTask=this.view.resourceController.scheduler.registerTask(gI.GRAPHICS_DECONFLICTOR,this),this._labels=new lG({view:this.view,parent:this})}destroy(){this._labels=u$4d(this._labels),this._frameTask=l$4E(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(fe){super.runTask(fe),this.running||this._labels.setDirty()}_updateViewState(){var fe;(null==(fe=this.view)?void 0:fe.state)&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const fe=this.view?this.view.slicePlane:null;null!=fe&&ls(fe,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=null!=fe}_slicePlaneChanged(){n$4E(this._contexts,((fe,ve)=>ve.symbolCreationContext.slicePlaneEnabled))&&this.setDirty()}addGraphicsOwner(fe){const ve=this._getGraphicsContext(fe);return{addGraphic:_e=>this._addGraphic(fe,ve,_e),removeGraphic:fe=>this._removeGraphic(ve,fe),labelingInfoChange:()=>this._labels.enabledChanged(fe,ve),featureReductionChange:()=>this.enabledChanged(fe,ve),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(fe,ve),clear:()=>ve.forEach((fe=>this._removeGraphic(ve,fe.graphics3DGraphic))),remove:()=>this._removeGraphicsOwner(fe),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(fe){const ve=this._contexts.get(fe);ve&&(ve.forEach((fe=>this._removeGraphic(ve,fe.graphics3DGraphic))),this._contexts.delete(fe),this.setDirty())}_addGraphic(fe,ve,_e){const be=_e.graphic.uid,we=new ti(_e,fe.symbolCreationContext.slicePlaneEnabled);ve.set(be,we),_$M(fe)&&this.addToActiveGraphics(we),fe.labelsEnabled&&this._labels.addToActiveGraphics(we);const Se=!this._graphicSupportsDeconfliction(_e)||!_$M(fe);_e.setVisibilityFlag(CB.GRAPHIC,PB.DECONFLICTION,Se)}_removeGraphic(fe,ve){const _e=ve.graphic.uid,be=fe.get(_e);be&&(this.removeFromActiveGraphics(be),this._labels.removeFromActiveGraphics(be),fe.delete(_e),this.setDirty())}enabledChanged(fe,ve){const _e=_$M(fe);_e||function g$1k(fe){const ve=fe.graphics3DGraphics;ve&&ve.forEach((fe=>fe.setVisibilityFlag(CB.GRAPHIC,PB.DECONFLICTION,!0)))}(fe),this.modifyGraphics(ve,_e)}_slicePlaneEnabledChanged(fe,ve){const _e=fe.symbolCreationContext.slicePlaneEnabled;ve.forEach((fe=>fe.slicePlaneEnabled=_e)),this.setDirty()}getGraphicsLayers(fe){return fe.layers}_graphicSupportsDeconfliction(fe){if(fe.isDraped)return!1;const ve=fe.layers;if(!(null==ve?void 0:ve.length))return!1;for(const _e of ve)if(this.layerSupportsDeconfliction(_e))return!0;return!1}_getGraphicsContext(fe){const ve=this._contexts.get(fe);if(ve)return ve;const _e=new Map;return this._contexts.set(fe,_e),this.setDirty(),_e}};function _$M(fe){const ve=fe.layer;return!(!(null==ve?void 0:ve.featureReduction)||"selection"!==ve.featureReduction.type)}function o$1T(fe){return"declaredClass"in fe}function m$1_(fe){return"declaredClass"in fe}function c$2m(fe,ve){return fe?function l$2r(fe){return"declaredClass"in fe}(fe)?fe:new RT({layer:ve,sourceLayer:ve,visible:fe.visible,symbol:a$4H(fe.symbol),attributes:a$4H(fe.attributes),geometry:u$25(fe.geometry)}):null}function u$25(fe){return null==fe?null:o$1T(fe)?fe:y$2e(function f$1N(fe){const{wkid:ve,wkt:_e,wkt2:be,latestWkid:we}=fe.spatialReference,Se={wkid:ve,wkt:_e,wkt2:be,latestWkid:we};switch(fe.type){case"point":{const{x:ve,y:_e,z:be,m:we}=fe;return{x:ve,y:_e,z:be,m:we,spatialReference:Se}}case"polygon":{const{rings:ve,hasZ:_e,hasM:be}=fe;return{rings:p$2v(ve),hasZ:_e,hasM:be,spatialReference:Se}}case"polyline":{const{paths:ve,hasZ:_e,hasM:be}=fe;return{paths:p$2v(ve),hasZ:_e,hasM:be,spatialReference:Se}}case"extent":{const{xmin:ve,xmax:_e,ymin:be,ymax:we,zmin:Te,zmax:Ee,mmin:Ce,mmax:Oe,hasZ:Re,hasM:De}=fe;return{xmin:ve,xmax:_e,ymin:be,ymax:we,zmin:Te,zmax:Ee,mmin:Ce,mmax:Oe,hasZ:Re,hasM:De,spatialReference:Se}}case"multipoint":{const{points:ve,hasZ:_e,hasM:be}=fe;return{points:d$1H(ve)?h$1s(ve):ve,hasZ:_e,hasM:be,spatialReference:Se}}default:return}}(fe))}function p$2v(fe){return function y$1c(fe){for(const ve of fe)if(0!==ve.length)return d$1H(ve);return!1}(fe)?fe.map((fe=>h$1s(fe))):fe}function h$1s(fe){return fe.map((fe=>Array.from(fe)))}function d$1H(fe){return fe.length>0&&(s$4z(fe[0])||m$3V(fe[0]))}function x$V(fe,ve){if(!fe)return null;let _e;if(m$1_(fe)){if(null==ve)return fe.clone();if(m$1_(ve))return ve.copy(fe)}return null!=ve?(_e=ve,_e.x=fe.x,_e.y=fe.y,_e.spatialReference=fe.spatialReference,fe.hasZ?(_e.z=fe.z,_e.hasZ=fe.hasZ):(_e.z=void 0,_e.hasZ=!1),fe.hasM?(_e.m=fe.m,_e.hasM=!0):(_e.m=void 0,_e.hasM=!1)):(_e=e$3y(fe.x,fe.y,fe.z,fe.spatialReference),fe.hasM&&(_e.m=fe.m,_e.hasM=!0)),_e}function k$K(fe){const{wkid:ve,wkt:_e,wkt2:be,latestWkid:we}=fe,Se={wkid:ve,wkt:_e,wkt2:be,latestWkid:we};return zo.fromJSON(Se)}cG=e$4o([a$4y("esri.views.3d.layers.graphics.GraphicsDeconflictor")],cG);const uG="__begin__",hG="__end__",dG=new RegExp(uG,"ig"),pG=new RegExp(hG,"ig"),fG=new RegExp("^"+uG,"i"),mG=new RegExp(hG+"$","i"),yG='"',gG=yG+" + ",vG=" + "+yG;function p$2u(fe){return fe.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function x$U(fe){const ve={expression:"",type:"none"};return fe.labelExpressionInfo?fe.labelExpressionInfo.value?(ve.expression=fe.labelExpressionInfo.value,ve.type="conventional"):fe.labelExpressionInfo.expression&&(ve.expression=fe.labelExpressionInfo.expression,ve.type="arcade"):null!=fe.labelExpression&&(ve.expression=p$2u(fe.labelExpression),ve.type="conventional"),ve}function g$1j(fe){const ve=x$U(fe);if(!ve)return null;switch(ve.type){case"conventional":return function $$l(fe){const ve=null==fe?void 0:fe.match(_G);return(null==ve?void 0:ve[1].trim())||null}(ve.expression);case"arcade":return _$L(ve.expression)}return null}function E$X(fe){let ve;return fe?(ve=r$3O(fe,(fe=>uG+'$feature["'+fe+'"]'+hG)),ve=fG.test(ve)?ve.replace(fG,""):yG+ve,ve=mG.test(ve)?ve.replace(mG,""):ve+yG,ve=ve.replaceAll(dG,gG).replaceAll(pG,vG)):ve='""',ve}const _G=/^\s*\{([^}]+)\}\s*$/i;const $G=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,bG=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,wG=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function _$L(fe){if(!fe)return null;let ve=$G.exec(fe)||bG.exec(fe);return ve?ve[1]||ve[3]:(ve=wG.exec(fe),ve?ve[2]:null)}const m$1Y=()=>ar.getLogger("esri.layers.support.labelFormatUtils"),xG={type:"simple",evaluate:()=>null},SG={getAttribute:(fe,ve)=>fe.field(ve)};async function w$15(fe,ve,_e){if(!fe||!fe.symbol||!ve)return xG;const be=fe.where,we=x$U(fe);let Se;if("arcade"===we.type){const fe=await((fe,ve,_e)=>i$.create(fe,ve,_e,null,["$feature","$view"],[]))(we.expression,_e,ve);if(null==fe)return xG;Se={type:"arcade",evaluate(ve,_e){try{const be="attributes"in ve?fe.repurposeFeature(ve):ve;be.contextTimeZone=_e??null;const we=fe.evaluate({$view:{timeZone:_e},$feature:be},fe.services);if(null!=we)return we.toString()}catch(be){m$1Y().error(new Ir("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:be,feature:ve,expression:we}))}return null},needsHydrationToEvaluate:()=>null==_$L(we.expression)}}else Se={type:"simple",evaluate:fe=>we.expression.replaceAll(/{[^}]*}/g,(_e=>{const be=_e.slice(1,-1),we=ve.get(be);if(!we)return _e;let Se=null;return"attributes"in fe?fe&&fe.attributes&&(Se=fe.attributes[we.name]):Se=fe.field(we.name),null==Se?"":g$1i(Se,we)}))};if(be){let fe;try{fe=await e$3l(be,ve)}catch(vv){return m$1Y().error(new Ir("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:be,error:vv})),xG}const _e=Se.evaluate;Se.evaluate=(ve,we)=>{const Se="attributes"in ve?void 0:SG;try{if(fe.testFeature(ve,Se))return _e(ve,we)}catch(vv){m$1Y().error(new Ir("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:be,feature:ve,error:vv}))}return null}}return Se}function g$1i(fe,ve){if(null==fe)return"";const _e=ve.domain;if(_e)if("codedValue"===_e.type||"coded-value"===_e.type){const ve=fe;for(const fe of _e.codedValues)if(fe.code===ve)return fe.name}else if("range"===_e.type){const{max:be,min:we}=m$2U(ve),Se=+fe;if(null!=we&&null!=be&&we<=Se&&Se<=be)return _e.name}let be=fe;return ge$6(ve)?be=j$1E(be,E$1D("short-date")):pe$a(ve)&&(be=l$43(+be)),be||""}function u$23(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re){const De=PG[Re.mode];let Be,Ze,Xe=0;if(n$49(fe,ve,_e,be,Ce.spatialReference,we,Ee))return De.requiresAlignment(Re)?(Xe=De.applyElevationAlignmentBuffer(be,we,Se,Te,Ee,Ce,Oe,Re),Be=Se,Ze=Te):(Be=be,Ze=we),n$49(Be,Ce.spatialReference,Ze,Se,Oe.spatialReference,Te,Ee)?Xe:void 0}function c$2k(fe,ve,_e,be,we){const Se=(t$3z(fe)?fe.z:t$3y(fe)?fe.array[fe.offset+2]:fe[2])||0;switch(_e.mode){case"on-the-ground":{const _e=a$3U(ve,fe,"ground")??0;return we.verticalDistanceToGround=0,we.sampledElevation=_e,void(we.z=_e)}case"relative-to-ground":{const Te=a$3U(ve,fe,"ground")??0,Ee=_e.geometryZWithOffset(Se,be);return we.verticalDistanceToGround=Ee,we.sampledElevation=Te,void(we.z=Ee+Te)}case"relative-to-scene":{const Te=a$3U(ve,fe,"scene")??0,Ee=_e.geometryZWithOffset(Se,be);return we.verticalDistanceToGround=Ee,we.sampledElevation=Te,void(we.z=Ee+Te)}case"absolute-height":{const Te=_e.geometryZWithOffset(Se,be),Ee=a$3U(ve,fe,"ground")??0;return we.verticalDistanceToGround=Te-Ee,we.sampledElevation=Ee,void(we.z=Te)}default:return void(we.z=0)}}function f$1L(fe,ve,_e,be){return c$2k(fe,ve,_e,be,OG),OG.z}function m$1X(fe,ve,_e){return"on-the-ground"===ve&&"on-the-ground"===_e?fe.staysOnTheGround:ve===_e||"on-the-ground"!==ve&&"on-the-ground"!==_e?null==ve||null==_e?fe.definedChanged:EG.UPDATE:fe.onTheGroundChanged}function d$1F(fe){return"relative-to-ground"===fe||"relative-to-scene"===fe}function g$1h(fe){return"absolute-height"!==fe}function p$2s(fe,ve,_e,be,we){c$2k(ve,_e,we,be,OG),E$W(fe,OG.verticalDistanceToGround);const Se=OG.sampledElevation,Te=n$48(CG,fe.transformation);return AG[0]=ve.x,AG[1]=ve.y,AG[2]=OG.z,u$3m(ve.spatialReference,AG,Te,be.spatialReference)&&(fe.transformation=Te),Se}function E$W(fe,ve){for(let _e=0;_e<fe.geometries.length;++_e){const be=fe.geometries[_e].getMutableAttribute(nO.CENTEROFFSETANDDISTANCE);be&&be.data[3]!==ve&&(be.data[3]=ve,fe.geometryVertexAttributeUpdated(fe.geometries[_e],nO.CENTEROFFSETANDDISTANCE))}}let TG=class R{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var EG;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.UPDATE=1]="UPDATE",fe[fe.RECREATE=2]="RECREATE"}(EG||(EG={}));const PG={"absolute-height":{applyElevationAlignmentBuffer:function y$1b(fe,ve,_e,be,we,Se,Te,Ee){const Ce=Ee.calculateOffsetRenderUnits(Te),Oe=Ee.featureExpressionInfoContext;ve*=3,be*=3;for(let Re=0;Re<we;++Re){const we=fe[ve],Se=fe[ve+1],Te=fe[ve+2];_e[be]=we,_e[be+1]=Se,_e[be+2]=null==Oe?Te+Ce:Ce,ve+=3,be+=3}return 0},requiresAlignment:function T$L(fe){const ve=fe.meterUnitOffset,_e=fe.featureExpressionInfoContext;return 0!==ve||null!=_e}},"on-the-ground":{applyElevationAlignmentBuffer:function v$Z(fe,ve,_e,be,we,Se){let Te=0;const Ee=Se.spatialReference;ve*=3,be*=3;for(let Ce=0;Ce<we;++Ce){const we=fe[ve],Ce=fe[ve+1],Oe=fe[ve+2],Re=Se.getElevation(we,Ce,Oe,Ee,"ground")??0;Te+=Re,_e[be]=we,_e[be+1]=Ce,_e[be+2]=Re,ve+=3,be+=3}return Te/we},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function h$1r(fe,ve,_e,be,we,Se,Te,Ee){let Ce=0;const Oe=Ee.calculateOffsetRenderUnits(Te),Re=Ee.featureExpressionInfoContext,De=Se.spatialReference;ve*=3,be*=3;for(let Be=0;Be<we;++Be){const we=fe[ve],Te=fe[ve+1],Ee=fe[ve+2],Be=Se.getElevation(we,Te,Ee,De,"ground")??0;Ce+=Be,_e[be]=we,_e[be+1]=Te,_e[be+2]=null==Re?Ee+Be+Oe:Be+Oe,ve+=3,be+=3}return Ce/we},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function A$T(fe,ve,_e,be,we,Se,Te,Ee){let Ce=0;const Oe=Ee.calculateOffsetRenderUnits(Te),Re=Ee.featureExpressionInfoContext,De=Se.spatialReference;ve*=3,be*=3;for(let Be=0;Be<we;++Be){const we=fe[ve],Te=fe[ve+1],Ee=fe[ve+2],Be=Se.getElevation(we,Te,Ee,De,"scene")??0;Ce+=Be,_e[be]=we,_e[be+1]=Te,_e[be+2]=null==Re?Ee+Be+Oe:Be+Oe,ve+=3,be+=3}return Ce/we},requiresAlignment:()=>!0}},CG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],OG=new TG,AG=[0,0,0];function e$2f(fe){return null!=fe.mapPositions}function u$22(fe,ve,_e,be,we){const Se=fe.stageObject,Te=Se.geometries;let Ee=0;for(const Ce of Te){if(!e$2f(Ce))continue;const{update:fe,averageGeometrySampledElevation:Te}=M$O(Ce,ve,_e,be,we);Ee+=Te,fe&&Se.geometryVertexAttributeUpdated(Ce,nO.POSITION)}return Ee/Te.length}function p$2r(fe,ve,_e,be,we,Se){const Te=fe.stageObject,Ee=ve.centerPointInElevationSR;let Ce=0;Te.usesVerticalDistanceToGround?(be(Ee,zG),E$W(Te,zG.verticalDistanceToGround),Ce=zG.sampledElevation):(be(Ee,zG),"absolute-height"!==ve.mode&&(Ce=zG.sampledElevation));const Oe=n$48(MG,Se??Te.transformation),Re=o$44(FG,Oe[12],Oe[13],Oe[14]);_B.TESTS_DISABLE_OPTIMIZATIONS?(IG[0]=Ee.x,IG[1]=Ee.y,IG[2]=zG.z,u$3m(Ee.spatialReference,IG,Oe,we.spatialReference)&&(Se?n$48(Se,Oe):Te.transformation=Oe)):we.setAltitudeOfTransformation(zG.z,Oe);const De=RG/we.unitInMeters;return(Math.abs(Oe[12]-Re[0])>=De||Math.abs(Oe[13]-Re[1])>=De||Math.abs(Oe[14]-Re[2])>=De)&&(Se?n$48(Se,Oe):Te.transformation=Oe),Ce}const MG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function b$14(fe,ve,_e,be,we){const Se=fe.graphics3DSymbolLayer.lodRenderer;if(null==Se)return 0;const Te=ve.centerPointInElevationSR;be(Te,zG);const Ee="absolute-height"!==ve.mode?zG.sampledElevation:0,Ce=Se.instanceData,Oe=fe.instanceIndex,Re=NG;Ce.getGlobalTransform(Oe,Re);const De=o$44(FG,Re[12],Re[13],Re[14]);_B.TESTS_DISABLE_OPTIMIZATIONS?(IG[0]=Te.x,IG[1]=Te.y,IG[2]=zG.z,u$3m(Te.spatialReference,IG,Re,we.spatialReference)&&Ce.setGlobalTransform(Oe,Re)):we.setAltitudeOfTransformation(zG.z,Re);const Be=RG/we.unitInMeters;return(_B.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(Re[12]-De[0])>=Be||Math.abs(Re[13]-De[1])>=Be||Math.abs(Re[14]-De[2])>=Be)&&Ce.setGlobalTransform(Oe,Re),Ee}function I$R(fe,ve,_e,be,we){const Se=fe.stageObject,Te=Se.geometries;if(0===Te.length)return 0;let Ee=0,Ce=null,Oe=0,Re=!1;for(const De of Te){if(!e$2f(De))continue;const fe=De.attributes.get(nO.POSITION);if(fe!==Ce){const{update:Se,averageGeometrySampledElevation:Te}=M$O(De,ve,_e,be,we);Oe=Te,Ce=fe,Re=Se}Re&&Se.geometryVertexAttributeUpdated(De,nO.POSITION),Ee+=Oe}return Ee/Te.length}const RG=.01,IG=[0,0,0],LG=[0,0,0],DG=[0,0,0],NG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FG=[0,0,0],zG=new TG;function M$O(fe,ve,_e,be,we){let Se=!1;const Te=fe.transformation,Ee=ve.requiresSampledElevationInfo;LG[0]=Te[12],LG[1]=Te[13],LG[2]=Te[14],fe.invalidateBoundingInfo();const Ce=fe.getMutableAttribute(nO.POSITION),Oe=Ce.data,Re=Ce.size,De=Oe.length/Re,Be=new mg(fe.mapPositions,_e);let Ze=0,Xe=0;for(let Je=0;Je<De;Je++){if(DG[0]=Oe[Ze],DG[1]=Oe[Ze+1],DG[2]=Oe[Ze+2],be(Be,zG),Ee&&(Xe+=zG.sampledElevation),_B.TESTS_DISABLE_OPTIMIZATIONS)Oe[Ze]=Be.array[Be.offset],Oe[Ze+1]=Be.array[Be.offset+1],Oe[Ze+2]=zG.z,n$49(Oe,_e,Ze,Oe,we.spatialReference,Ze,1),Oe[Ze]-=LG[0],Oe[Ze+1]-=LG[1],Oe[Ze+2]-=LG[2],Se=!0;else{IG[0]=Oe[Ze]+LG[0],IG[1]=Oe[Ze+1]+LG[1],IG[2]=Oe[Ze+2]+LG[2],we.setAltitude(IG,zG.z),Oe[Ze]=IG[0]-LG[0],Oe[Ze+1]=IG[1]-LG[1],Oe[Ze+2]=IG[2]-LG[2];const fe=RG/we.unitInMeters;(Math.abs(DG[0]-Oe[Ze])>=fe||Math.abs(DG[1]-Oe[Ze+1])>=fe||Math.abs(DG[2]-Oe[Ze+2])>=fe)&&(Se=!0)}Ze+=Re,Be.offset+=3}return Xe/=De,{update:Se,averageGeometrySampledElevation:Xe}}function r$1Y(fe){return 1/(LB[fe]||1)}const kG=function e$2e(){const fe=Object.keys(LB);return fe.sort(),fe}();function u$21(fe){const ve=null==fe?void 0:fe.expression;if("string"==typeof ve){const fe=m$1W(ve);if(null!=fe)return{cachedResult:fe}}return null}async function a$2l(fe,ve,_e,be){const we=null==fe?void 0:fe.expression;if("string"!=typeof we)return null;const Se=m$1W(we);if(null!=Se)return{cachedResult:Se};const Te=await i$3H();s$4o(_e);const Ee=Te.arcadeUtils,Ce=Ee.createSyntaxTree(we);return Ee.dependsOnView(Ce)?(null!=be&&be.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:Ee.createFunction(Ce),context:Ee.createExecContext(null,{sr:ve}),modules:Te}}}function s$2k(fe,ve,_e){return fe.arcadeUtils.createFeature(ve.attributes,ve.geometry,_e)}function l$2p(fe,ve){if(null!=fe&&!p$2q(fe)){if(!ve||!fe.arcade)return void ar.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided");const _e=ve;_e._geometry&&(_e._geometry=u$25(_e._geometry)),fe.arcade.modules.arcadeUtils.updateExecContext(fe.arcade.context,ve)}}function d$1D(fe,ve=!1){let _e=null==fe?void 0:fe.featureExpressionInfo;const be=null==_e?void 0:_e.expression;return ve||"0"===be||(_e=null),_e??null}const UG={cachedResult:0};function p$2q(fe){return null!=fe.cachedResult}function m$1W(fe){return"0"===fe?0:null}let VG=class o20{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(fe){this._unit=fe,this._metersPerElevationInfoUnit=r$1Y(fe)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(fe){this._meterUnitOffset=fe,this._renderUnitOffset=0}set offsetElevationInfoUnits(fe){this._meterUnitOffset=fe*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(fe){this._renderUnitOffset+=fe}geometryZWithOffset(fe,ve){const _e=this.calculateOffsetRenderUnits(ve);return null!=this.featureExpressionInfoContext?_e:fe+_e}calculateOffsetRenderUnits(fe){let ve=this._meterUnitOffset;const _e=this.featureExpressionInfoContext;return null!=_e&&(ve+=function i$2k(fe){if(null!=fe){if(p$2q(fe))return fe.cachedResult;const ve=fe.arcade;let _e=null==ve?void 0:ve.modules.arcadeUtils.executeFunction(ve.func,ve.context);return"number"!=typeof _e&&(fe.cachedResult=0,_e=0),_e}return 0}(_e)*this._metersPerElevationInfoUnit),ve/fe.unitInMeters+this._renderUnitOffset}setFromElevationInfo(fe){this.mode=fe.mode,this.unit=function n$2y(fe){return!!fe&&null!=LB[fe]}(fe.unit)?fe.unit:"meters",this.offsetElevationInfoUnits=fe.offset??0}updateFeatureExpressionInfoContext(fe,ve,_e){if(null==fe)return void(this._featureExpressionInfoContext=null);const be=null==fe?void 0:fe.arcade;be&&null!=ve&&null!=_e?(this._featureExpressionInfoContext=function o$1Q(fe){return{cachedResult:fe.cachedResult,arcade:fe.arcade?{func:fe.arcade.func,context:fe.arcade.modules.arcadeUtils.createExecContext(null,{sr:fe.arcade.context.spatialReference}),modules:fe.arcade.modules}:null}}(fe),l$2p(this._featureExpressionInfoContext,s$2k(be.modules,ve,_e))):this._featureExpressionInfoContext=fe}static fromElevationInfo(fe){const ve=new o20;return null!=fe&&ve.setFromElevationInfo(fe),ve}},BG=class r18{constructor(fe,ve,_e){this.graphic=fe,this.renderingInfo=ve,this.layer=_e}};function b$13(fe,ve){if("point"===fe.type)return M$N(fe,ve,!1);if(o$1T(fe))switch(fe.type){case"extent":return M$N(fe.center,ve,!1);case"polygon":return M$N(fe.centroid,ve,!1);case"polyline":return M$N(w$14(fe),ve,!0);case"mesh":return M$N(fe.origin,ve,!1)}else switch(fe.type){case"extent":return M$N(function z$B(fe){return e$3y(.5*(fe.xmax+fe.xmin),.5*(fe.ymax+fe.ymin),null!=fe.zmin&&null!=fe.zmax&&isFinite(fe.zmin)&&isFinite(fe.zmax)?.5*(fe.zmax+fe.zmin):void 0,fe.spatialReference)}(fe),ve,!0);case"polygon":return M$N(function R$K(fe){const ve=fe.rings[0];if(!ve||0===ve.length)return null;const _e=o$3S(fe.rings,!!fe.hasZ);return e$3y(_e[0],_e[1],_e[2],fe.spatialReference)}(fe),ve,!0);case"polyline":return M$N(w$14(fe),ve,!0)}}function w$14(fe){const ve=fe.paths[0];if(!ve||0===ve.length)return null;const _e=p$4P(ve,h$2L(ve)/2);return e$3y(_e[0],_e[1],_e[2],fe.spatialReference)}function M$N(fe,ve,_e){const be=_e?fe:x$V(fe);return ve&&fe?$$D(fe,be,ve)?be:null:be}function P$G(fe,ve,_e,be=0){if(fe){ve||(ve=u$3J());const we=fe;let Se=.5*we.width*(_e-1),Te=.5*we.height*(_e-1);return we.width<1e-7*we.height?Se+=Te/20:we.height<1e-7*we.width&&(Te+=Se/20),s$3I(ve,we.xmin-Se-be,we.ymin-Te-be,we.xmax+Se+be,we.ymax+Te+be),ve}return null}function F$B(fe,ve,_e=null){const be=t$3J($d);return null!=fe&&(be[0]=fe[0],be[1]=fe[1],be[2]=fe[2]),null!=ve?be[3]=ve:null!=fe&&fe.length>3&&(be[3]=fe[3]),_e&&(be[0]*=_e,be[1]*=_e,be[2]*=_e,be[3]*=_e),be}function A$S(fe,ve,_e,be,we,Se=[0,0,0,0]){for(let Te=0;Te<3;++Te)Se[Te]=null!=(null==fe?void 0:fe[Te])?fe[Te]:null!=(null==_e?void 0:_e[Te])?_e[Te]:we[Te];return Se[3]=null!=ve?ve:null!=be?be:we[3],Se}function B$u(fe=ji,ve,_e,be=1){const we=new Array(3);if(null==ve||null==_e)we[0]=1,we[1]=1,we[2]=1;else{let be,Se=0;for(let Te=2;Te>=0;Te--){const Ee=fe[Te];let Ce;const Oe=null!=Ee,Re=0===Te&&!be&&!Oe,De=_e[Te];"symbol-value"===Ee||Re?Ce=0!==De?ve[Te]/De:1:Oe&&"proportional"!==Ee&&isFinite(Ee)&&(Ce=0!==De?Ee/De:1),null!=Ce&&(we[Te]=Ce,be=Ce,Se=Math.max(Se,Math.abs(Ce)))}for(let fe=2;fe>=0;fe--)null==we[fe]?we[fe]=be:0===we[fe]&&(we[fe]=.001*Se)}for(let Se=2;Se>=0;Se--)we[Se]/=be;return e$3$(we)}function I$Q(fe){return S$$(function D$E(fe){return null!=fe.isPrimitive}(fe)?[fe.width,fe.depth,fe.height]:fe)?null:"Symbol sizes may not be negative values"}function S$$(fe){const n52=fe=>null==fe||fe>=0;return Array.isArray(fe)?fe.every(n52):n52(fe)}function k$J(fe,ve,_e){if(null!=_e.minDemResolution)return _e.minDemResolution;const be=W$L(ve),we=s$3m(fe)*be,Se=I$1f(fe)*be,Te=N$W(fe)*(ve.isGeographic?1:be);return 0===we&&0===Se&&0===Te?_e.minDemResolutionForPoints:.01*Math.max(we,Se,Te)}var jG,GG;(GG=jG||(jG={}))[GG.INVISIBLE=0]="INVISIBLE",GG[GG.TRANSPARENT=1]="TRANSPARENT",GG[GG.OPAQUE=2]="OPAQUE";let HG=class j5{constructor(fe,ve,_e){this.baseMaterial=fe,this.edgeMaterials=ve,this.properties=_e}},qG=class p23{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(fe,ve,_e,be,we,Se,Te,Ee=null){this.graphics3DSymbolLayer=fe,this.stageObject=ve,this._uniqueGeometries=_e,this._uniqueMaterials=be,this._sharedResource=we,this.elevationAligner=Se,this.elevationContext=Te,this._edgeState=Ee,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(fe){this._stageLayer=fe;const ve=fe.stage;ve.addMany(this._uniqueMaterials),ve.addMany(this._uniqueGeometries),ve.add(this.stageObject)}destroy(){var fe,ve;if(!this._stageLayer)return;const _e=this._stageLayer.stage;_e.removeMany(this._uniqueMaterials),_e.removeMany(this._uniqueGeometries),_e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),null==(fe=_e.renderer.edgeView)||fe.removeObject(this.stageObject),this.stageObject.dispose(),null==(ve=this._sharedResource)||ve.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(fe,ve){const{stageObject:_e,_edgeState:be,_stageLayer:we}=this;if(null==be)return;const Se=v$X(be.baseMaterial);let Te=!1;for(const Ee of be.edgeMaterials)Ee.objectTransparency!==Se&&(Ee.objectTransparency=Se,Te=!0);Te&&this.resetEdgeObject(ve),we.stage.renderer.withEdgeView((ve=>{ve.updateAllComponentOpacities(_e,[fe])}))}slicePlaneEnabledChanged(fe,ve){const{stageObject:_e,_edgeState:be,_stageLayer:we}=this;null!=be&&we.stage.renderer.withEdgeView((we=>{we.updateAllComponentMaterials(_e,be.edgeMaterials,{hasSlicePlane:fe},!ve),be.properties.hasSlicePlane=fe}))}setVisibility(fe){const{_edgeState:ve,stageObject:_e,_stageLayer:be}=this;null!=be&&this.visible!==fe&&(this._visible=fe,_e.visible=fe,fe&&!this._addedToStage&&(be.add(_e),this._addedToStage=!0),null!=ve&&be.stage.renderer.withEdgeView((be=>{be.hasObject(_e)?be.updateObjectVisibility(_e,fe):fe&&this._addOrUpdateEdgeObject(ve,be,!1)})))}get visible(){return this._visible}alignWithElevation(fe,ve,_e,be){if(null==this.elevationAligner)return;null!=_e&&l$2p(this.elevationContext.featureExpressionInfoContext,_e);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,fe.spatialReference,((_e,be)=>c$2k(_e,fe,this.elevationContext,ve,be)),ve),this.resetEdgeObject(be)}alignWithAbsoluteElevation(fe,ve,_e){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((ve,_e)=>{_e.sampledElevation=fe,_e.verticalDistanceToGround=0,_e.z=fe}),ve),this.resetEdgeObject(_e)}getCenterObjectSpace(fe=[0,0,0]){return r$3w(fe,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(fe=i$3t()){const ve=this.stageObject.boundingVolumeObjectSpace;return A$1h(fe,ve.min),G$F(fe,ve.max),fe}computeAttachmentOrigin(fe){const ve=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)fe.render.origin[0]+=ve[12],fe.render.origin[1]+=ve[13],fe.render.origin[2]+=ve[14],fe.render.num++;else for(const _e of this.stageObject.geometries)_e.computeAttachmentOrigin(ZG)&&(O$1v(ZG,ZG,ve),u$3Y(fe.render.origin,fe.render.origin,ZG),fe.render.num++)}async getProjectedBoundingBox(fe,ve,_e,be,we){const Se=this.getBoundingBoxObjectSpace(we),Te=XG,Ee=w$1t(Se)?1:Te.length;for(let Re=0;Re<Ee;Re++){const fe=Te[Re];YG[0]=Se[fe[0]],YG[1]=Se[fe[1]],YG[2]=Se[fe[2]],O$1v(YG,YG,this.stageObject.transformation),WG[3*Re]=YG[0],WG[3*Re+1]=YG[1],WG[3*Re+2]=YG[2]}if(!fe(WG,0,Ee))return null;P$$(Se);let Ce=null;this.calculateRelativeScreenBounds&&(Ce=this.calculateRelativeScreenBounds());for(let Re=0;Re<3*Ee;Re+=3){for(let fe=0;fe<3;fe++)Se[fe]=Math.min(Se[fe],WG[Re+fe]),Se[fe+3]=Math.max(Se[fe+3],WG[Re+fe]);Ce&&_e.push({location:WG.slice(Re,Re+3),screenSpaceBoundingRect:Ce})}if((null==ve?void 0:ve.service)&&"absolute-height"!==this.elevationContext.mode){E$1m(Se,ZG);const fe="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let _e=0;if(ve.useViewElevation)_e=ve.service.getElevation(ZG[0],ZG[1],fe)??0;else try{const we=k$J(Se,ve.service.spatialReference,ve);_e=await ve.service.queryElevation(ZG[0],ZG[1],be,we,fe)??0}catch(Oe){}Y$s(Se,0,0,-this.alignedSampledElevation+_e)}return Se}addObjectState(fe,ve){fe===xA.Highlight&&ve.addObject(this.stageObject,this.stageObject.highlight()),fe===xA.MaskOccludee&&ve.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(fe){fe.removeObject(this.stageObject)}resetEdgeObject(fe){const{_edgeState:ve,stageObject:_e,_stageLayer:be,_visible:we}=this;null!=ve&&be.stage.renderer.withEdgeView((be=>{we?this._addOrUpdateEdgeObject(ve,be,fe):be.removeObject(_e)}))}_addOrUpdateEdgeObject(fe,ve,_e){const be=v$X(fe.baseMaterial);for(const we of fe.edgeMaterials)we.objectTransparency=be;ve.addOrUpdateObject3D(this.stageObject,fe.edgeMaterials,fe.properties,!_e).then((()=>{var fe;return null==(fe=this._stageLayer)?void 0:fe.sync()}))}};function v$X(fe){return fe.isVisible()?fe.parameters.transparent?jG.TRANSPARENT:jG.OPAQUE:jG.INVISIBLE}const WG=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],YG=[0,0,0],ZG=[0,0,0],XG=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let JG=class t38{constructor(fe,ve=null){this.labelText=ve,this.elevationOffset=fe??0}};const QG=3,KG=3,eH=10;let tH=class s34{constructor(fe,ve=null){this.geometry=fe,this.textures=ve}},rH=class r19{constructor(fe,ve,_e){this.components=fe,this.minScreenSpaceRadius=ve,this.pivotOffset=_e;const be=this.geometries;this.numVertices=be.reduce(((fe,ve)=>fe+ve.attributes.get(nO.POSITION).indices.length),0)}get geometries(){return s$4A(this.components.map((fe=>fe.geometry)))}},iH=class n17{constructor(fe){this.levels=fe,this.levels.sort(((fe,ve)=>fe.minScreenSpaceRadius===ve.minScreenSpaceRadius?fe.numVertices-ve.numVertices:fe.minScreenSpaceRadius-ve.minScreenSpaceRadius))}};function c$2h(fe){const ve=[];return fe.levels.forEach((fe=>fe.components.forEach((fe=>ve.push(fe.geometry.material))))),s$4A(ve)}function o$1N(fe){const ve=new Array;return fe.levels.forEach((fe=>fe.components.forEach((fe=>{null!=fe.textures&&ve.push(...fe.textures)})))),s$4A(ve)}function i$2j(fe){const ve=new Array;return fe.levels.forEach((fe=>fe.components.forEach((fe=>ve.push(fe.geometry))))),s$4A(ve)}function S$_(fe,ve){const m39=(fe,ve,_e=!1)=>new iH(fe.map((fe=>{const be=ve(fe.tesselation);return _e&&function Ot$4(fe,ve=fe){const _e=fe.attributes,be=_e.get(nO.POSITION).data,we=_e.get(nO.NORMAL).data;if(we){const fe=ve.getMutableAttribute(nO.NORMAL).data;for(let ve=0;ve<we.length;ve+=3){const _e=we[ve+1];fe[ve+1]=-we[ve+2],fe[ve+2]=_e}}if(be){const fe=ve.getMutableAttribute(nO.POSITION).data;for(let ve=0;ve<be.length;ve+=3){const _e=be[ve+1];fe[ve+1]=-be[ve+2],fe[ve+2]=_e}}}(be),new rH([new tH(be)],fe.minScreenSpaceRadius)})));switch(fe){case"sphere":return m39([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(fe=>function rt$d(fe,ve,_e,be){const we=lt$b(ve,_e,be);return new pD(fe,we)}(ve,.5,fe,!0)));case"cube":return m39([{tesselation:0,minScreenSpaceRadius:0}],(()=>function G$w(fe,ve){Array.isArray(ve)||(ve=[ve,ve,ve]);const _e=new Array(24);for(let be=0;be<8;be++)_e[3*be]=mD[be][0]*ve[0],_e[3*be+1]=mD[be][1]*ve[1],_e[3*be+2]=mD[be][2]*ve[2];return new pD(fe,[[nO.POSITION,new Om(_e,vD,3,!0)],[nO.NORMAL,new Om(yD,_D,3)],[nO.UV0,new Om(gD,$D,2)]])}(ve,1)));case"cone":return m39(nH,(fe=>at$d(ve,1,.5,fe,!1)),!0);case"inverted-cone":return m39(nH,(fe=>at$d(ve,1,.5,fe,!0)),!0);case"cylinder":return m39(nH,(fe=>ft$8(ve,1,.5,fe,[0,0,1],[0,0,.5])));case"tetrahedron":return m39([{tesselation:0,minScreenSpaceRadius:0}],(()=>function ot$c(fe,ve){Array.isArray(ve)||(ve=[ve,ve,ve]);const _e=new Array(12);for(let be=0;be<4;be++)_e[3*be]=LD[be][0]*ve[0],_e[3*be+1]=LD[be][1]*ve[1],_e[3*be+2]=LD[be][2]*ve[2];return new pD(fe,[[nO.POSITION,new Om(_e,ND,3,!0)],[nO.NORMAL,new Om(DD,FD,3)]])}(ve,1)),!0);case"diamond":return m39([{tesselation:0,minScreenSpaceRadius:0}],(()=>function z$K(fe,ve){Array.isArray(ve)||(ve=[ve,ve,ve]);const _e=new Array(18);for(let be=0;be<6;be++)_e[3*be]=bD[be][0]*ve[0],_e[3*be+1]=bD[be][1]*ve[1],_e[3*be+2]=bD[be][2]*ve[2];return new pD(fe,[[nO.POSITION,new Om(_e,xD,3,!0)],[nO.NORMAL,new Om(wD,SD,3)]])}(ve,1)),!0);default:return}}const nH=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let sH=class e27{constructor(fe){this.estimated=!1,this.verticesPerFeature=fe.verticesPerFeature??0,this.verticesPerCoordinate=fe.verticesPerCoordinate??0,this.drawCallsPerFeature=fe.drawCallsPerFeature??0,this.memory=fe.memory??new cH}},oH=class t39 extends sH{constructor(fe){super(fe),this.estimated=!0}},aH=class s35 extends sH{constructor(fe,ve){super(ve),this.numComplexities=fe}},lH=class r20 extends oH{constructor(fe,ve){super(ve),this.numComplexities=fe}},cH=class a15{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function o$1M(fe,ve,_e=0){const be=e$3Y(fe,0,dH);for(let we=0;we<4;we++)ve[_e+we]=Math.floor(256*l$2n(be*uH[we]))}function r$1U(fe,ve=0){let _e=0;for(let be=0;be<4;be++)_e+=fe[ve+be]*hH[be];return _e}const uH=[1,256,65536,16777216],hH=[1/256,1/65536,1/16777216,1/4294967296],dH=r$1U(new Uint8ClampedArray([255,255,255,255]));function l$2n(fe){return fe-Math.floor(fe)}var pH;function e$2a(fe){switch(fe){case"multiply":default:return pH.Multiply;case"ignore":return pH.Ignore;case"replace":return pH.Replace;case"tint":return pH.Tint}}function r$1T(fe,ve,_e){if(null==fe||ve===pH.Ignore)return _e[0]=255,_e[1]=255,_e[2]=255,void(_e[3]=255);const be=e$3Y(Math.round(fe[3]*mH),0,mH),we=0===be||ve===pH.Tint?0:ve===pH.Replace?yH:gH;_e[0]=e$3Y(Math.round(fe[0]*fH),0,fH),_e[1]=e$3Y(Math.round(fe[1]*fH),0,fH),_e[2]=e$3Y(Math.round(fe[2]*fH),0,fH),_e[3]=be+we}!function(fe){fe[fe.Multiply=1]="Multiply",fe[fe.Ignore=2]="Ignore",fe[fe.Replace=3]="Replace",fe[fe.Tint=4]="Tint"}(pH||(pH={}));const fH=255,mH=85,yH=mH,gH=2*mH;function e$29(fe){fe.vertex.code.add(o$2P`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${o$2P.int(pH.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${o$2P.int(pH.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${o$2P.int(pH.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${o$2P.int(pH.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let vH=class o21 extends aO{constructor(fe,ve){super(fe,"vec4",oO.Draw,((_e,be,we)=>_e.setUniform4fv(fe,ve(be,we))))}},_H=class o22 extends aO{constructor(fe,ve){super(fe,"int",oO.Draw,((_e,be,we)=>_e.setUniform1i(fe,ve(be,we))))}};var $H;!function(fe){fe[fe.Uniform=0]="Uniform",fe[fe.Varying=1]="Varying",fe[fe.COUNT=2]="COUNT"}($H||($H={}));const bH=429496.7296;function C$O(fe,ve){o$1M(fe/bH*.5+.5,ve)}function m$1V(fe,ve){switch(ve.componentData){case $H.Varying:return function f$1H(fe,ve){const{vertex:_e,fragment:be}=fe;_e.include(a$32),_e.uniforms.add(new dM("componentColorTex",(fe=>fe.componentParameters.texture.texture))),fe.attributes.add(nO.COMPONENTINDEX,"float"),fe.varyings.add("vExternalColorMixMode","mediump float"),fe.varyings.add("vExternalColor","vec4");const we=ve.output===NI.ObjectAndLayerIdColor;we&&fe.varyings.add("vObjectAndLayerIdColor","vec4"),fe.include(e$29),_e.constants.add("elevationScale","float",2*bH),_e.constants.add("stride","float",has("enable-feature:objectAndLayerId-rendering")?3:2),_e.code.add(o$2P`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),_e.code.add(o$2P`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${we?o$2P`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:o$2P`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),be.code.add(o$2P`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${we?o$2P`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(fe,ve);case $H.Uniform:return function u$1$(fe,ve){const{vertex:_e,fragment:be}=fe;_e.uniforms.add(new vH("externalColor",(fe=>fe.componentParameters.externalColor))),be.uniforms.add(new _H("externalColorMixMode",(fe=>fe.componentParameters.externalColorMixMode))),fe.varyings.add("vExternalColor","vec4"),_e.code.add(o$2P`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const we=ve.output===NI.ObjectAndLayerIdColor;be.code.add(o$2P`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${we?o$2P`fragColor = vec4(0,0,0,0);`:""}
 }
`)}(fe,ve);case $H.COUNT:return;default:ve.componentData}}function t$2b(fe,ve){switch(ve.normalType){case wH.Compressed:fe.attributes.add(nO.NORMALCOMPRESSED,"vec2"),fe.vertex.code.add(o$2P`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case wH.Attribute:fe.attributes.add(nO.NORMAL,"vec3"),fe.vertex.code.add(o$2P`vec3 normalModel() {
return normal;
}`);break;case wH.ScreenDerivative:fe.fragment.code.add(o$2P`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:ve.normalType;case wH.COUNT:case wH.Ground:}}var wH,xH,SH;function v$W(fe,ve){const _e=fe.vertex;_e.include(a$32),fe.include(t$2b,ve),_e.uniforms.add(new dO("distanceFalloffFactor",(fe=>fe.distanceFalloffFactor))),_e.code.add(o$2P`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),_e.uniforms.add(new dM("componentDataTex",(fe=>fe.componentDataTexture))),fe.attributes.add(nO.COMPONENTINDEX,"float"),_e.constants.add("componentColorFieldOffset","float",0),_e.constants.add("componentOtherFieldOffset","float",1),_e.constants.add("componentVerticalOffsetFieldOffset","float",2),_e.constants.add("componentFieldCount","float",3),_e.constants.add("lineWidthFractionFactor","float",8),_e.constants.add("extensionLengthOffset","float",128),_e.constants.add("verticalOffsetScale","float",2*bH),_e.code.add(o$2P`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${ve.silhouette?o$2P`decompressNormal(normal2Compressed)`:o$2P`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),ve.legacy?_e.code.add(o$2P`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(_e.uniforms.add(new WI("transformNormalGlobalFromModel",(fe=>fe.transformNormalGlobalFromModel))),_e.code.add(o$2P`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),ve.silhouette?(fe.attributes.add(nO.NORMAL2COMPRESSED,"vec2"),_e.code.add(o$2P`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):_e.code.add(o$2P`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),ve.legacy?_e.code.add(o$2P`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(_e.include(c$2K,ve),_e.uniforms.add(new oR("transformViewFromCameraRelativeRS",(fe=>fe.transformViewFromCameraRelativeRS)),new WI("transformWorldFromModelRS",(fe=>fe.transformWorldFromModelRS)),new hM("transformWorldFromModelTL",(fe=>fe.transformWorldFromModelTL)),new hM("transformWorldFromModelTH",(fe=>fe.transformWorldFromModelTH)),new uO("transformWorldFromViewTL",(fe=>fe.transformWorldFromViewTL)),new uO("transformWorldFromViewTH",(fe=>fe.transformWorldFromViewTH))),_e.code.add(o$2P`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${ve.spherical?o$2P`normalize(transformWorldFromModelTL + rotatedModelPosition);`:o$2P`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),_e.uniforms.add(new pO("transformProjFromView",((fe,ve)=>ve.camera.projectionMatrix))),_e.code.add(o$2P`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),_e.code.add(o$2P`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function u$1_(fe){return fe===xH.Sketch||fe===xH.Mixed}function a$2i(fe,ve){return f$1G(function u$1Z(fe){return fe&&fe.enabled&&fe.edges||null}(fe),ve)}function f$1G(fe,ve){if(null==fe)return null;const _e=null!=fe.color?e$3C(b_.toUnitRGBA(fe.color)):r$35(0,0,0,0),be=u$3E(fe.size),we=u$3E(fe.extensionLength);switch(fe.type){case"solid":return g$1f({color:_e,size:be,extensionLength:we,...ve});case"sketch":return function p$2n(fe){return{...EH,...fe,type:xH.Sketch}}({color:_e,size:be,extensionLength:we,...ve});default:return}}function g$1f(fe){return{...TH,...fe,type:xH.Solid}}!function(fe){fe[fe.Attribute=0]="Attribute",fe[fe.Compressed=1]="Compressed",fe[fe.Ground=2]="Ground",fe[fe.ScreenDerivative=3]="ScreenDerivative",fe[fe.COUNT=4]="COUNT"}(wH||(wH={})),function(fe){fe[fe.Solid=0]="Solid",fe[fe.Sketch=1]="Sketch",fe[fe.Mixed=2]="Mixed",fe[fe.COUNT=3]="COUNT"}(xH||(xH={})),function(fe){fe[fe.REGULAR=0]="REGULAR",fe[fe.SILHOUETTE=1]="SILHOUETTE"}(SH||(SH={}));const TH={color:r$35(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jG.OPAQUE,hasSlicePlane:!1},EH={color:r$35(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jG.OPAQUE,hasSlicePlane:!1};function e$28(fe,ve){const _e=fe.fragment;switch(_e.code.add(o$2P`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),ve.doubleSidedMode){case PH.None:_e.code.add(o$2P`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case PH.View:_e.code.add(o$2P`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case PH.WindingOrder:_e.code.add(o$2P`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:ve.doubleSidedMode;case PH.COUNT:}}var PH;!function(fe){fe[fe.None=0]="None",fe[fe.View=1]="View",fe[fe.WindingOrder=2]="WindingOrder",fe[fe.COUNT=3]="COUNT"}(PH||(PH={}));let CH=class m17{constructor(fe=!1,ve=!0){this.isVerticalRay=fe,this.normalRequired=ve}};const OH=i$3t();function p$2m(fe,ve,_e,be,we,Se){if(!fe.visible)return;const Te=Ki(kH,be,_e),a55=(fe,ve,_e)=>{Se(fe,_e,ve,!1)},Ee=new CH(!1,ve.options.normalRequired);if(fe.boundingInfo){s$31(fe.type===eD.Mesh);const be=ve.tolerance;b$12(fe.boundingInfo,_e,Te,be,we,Ee,a55)}else{const ve=fe.attributes.get(nO.POSITION),be=ve.indices;V$G(_e,Te,0,be.length/3,be,ve.data,ve.stride,we,Ee,a55)}}const AH=[0,0,0];function b$12(fe,ve,_e,be,we,Se,Te){if(null==fe)return;const Ee=function C$N(fe,ve){return o$44(ve,1/fe[0],1/fe[1],1/fe[2])}(_e,AH);if(A$1h(OH,fe.bbMin),G$F(OH,fe.bbMax),null!=we&&we.applyToAabb(OH),k$I(OH,ve,Ee,be)){const{primitiveIndices:Ee,position:Ce}=fe,Oe=Ee?Ee.length:Ce.indices.length/3;if(Oe>FH){const Ee=fe.getChildren();if(void 0!==Ee){for(const fe of Ee)b$12(fe,ve,_e,be,we,Se,Te);return}}!function T$J(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re){const De=fe[0],Be=fe[1],Ze=fe[2],Xe=ve[0],Je=ve[1],Qe=ve[2],{normalRequired:dt}=Oe;for(let $t=_e;$t<be;++$t){const fe=Ee[$t],ve=3*fe,_e=Te*we[ve];let be=Se[_e],Oe=Se[_e+1],bt=Se[_e+2];const wt=Te*we[ve+1];let xt=Se[wt],St=Se[wt+1],Et=Se[wt+2];const Pt=Te*we[ve+2];let Ot=Se[Pt],At=Se[Pt+1],Mt=Se[Pt+2];null!=Ce&&([be,Oe,bt]=Ce.applyToVertex(be,Oe,bt,$t),[xt,St,Et]=Ce.applyToVertex(xt,St,Et,$t),[Ot,At,Mt]=Ce.applyToVertex(Ot,At,Mt,$t));const Rt=xt-be,Nt=St-Oe,Ft=Et-bt,zt=Ot-be,kt=At-Oe,Bt=Mt-bt,jt=Je*Bt-kt*Qe,Gt=Qe*zt-Bt*Xe,Ht=Xe*kt-zt*Je,qt=Rt*jt+Nt*Gt+Ft*Ht;if(Math.abs(qt)<=zH)continue;const Wt=De-be,Yt=Be-Oe,Xt=Ze-bt,Jt=Wt*jt+Yt*Gt+Xt*Ht;if(qt>0){if(Jt<0||Jt>qt)continue}else if(Jt>0||Jt<qt)continue;const Qt=Yt*Ft-Nt*Xt,Kt=Xt*Rt-Ft*Wt,er=Wt*Nt-Rt*Yt,tr=Xe*Qt+Je*Kt+Qe*er;if(qt>0){if(tr<0||Jt+tr>qt)continue}else if(tr>0||Jt+tr<qt)continue;const rr=(zt*Qt+kt*Kt+Bt*er)/qt;rr>=0&&Re(rr,fe,dt?I$P(Rt,Nt,Ft,zt,kt,Bt,MH):null)}}(ve,_e,0,Oe,Ce.indices,Ce.data,Ce.stride,Ee,we,Se,Te)}}const MH=[0,0,0];function x$Q(fe,ve,_e,be,we,Se,Te,Ee,Ce){const{data:Oe,stride:Re}=Se;V$G(fe,Ki(kH,ve,fe),_e,be,we,Oe,Re,Te,Ee,Ce)}function g$1e(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe=null,Re=0){const De=fe[0],Be=fe[1],Ze=fe[2],Xe=ve[0],Je=ve[1],Qe=ve[2];for(let dt=_e;dt<be;++dt){const fe=Re+(Oe?Oe[dt]:dt),ve=3*fe,_e=Te*we[ve],be=Se[_e],$t=Se[_e+1],bt=Se[_e+2],wt=Te*we[ve+1],xt=Se[wt],St=Se[wt+1],Et=Se[wt+2],Pt=Te*we[ve+2],Ot=xt-be,At=St-$t,Mt=Et-bt,Rt=Se[Pt]-be,Nt=Se[Pt+1]-$t,Ft=Se[Pt+2]-bt,zt=Je*Ft-Nt*Qe,kt=Qe*Rt-Ft*Xe,Bt=Xe*Nt-Rt*Je,jt=Ot*zt+At*kt+Mt*Bt;if(Math.abs(jt)<=zH)continue;const Gt=De-be,Ht=Be-$t,qt=Ze-bt,Wt=Gt*zt+Ht*kt+qt*Bt;if(jt>0){if(Wt<0||Wt>jt)continue}else if(Wt>0||Wt<jt)continue;const Yt=Ht*Mt-At*qt,Xt=qt*Ot-Mt*Gt,Jt=Gt*At-Ot*Ht,Qt=Xe*Yt+Je*Xt+Qe*Jt;if(jt>0){if(Qt<0||Wt+Qt>jt)continue}else if(Qt>0||Wt+Qt<jt)continue;const Kt=(Rt*Yt+Nt*Xt+Ft*Jt)/jt;Kt>=0&&Ce(Kt,fe,Ee?I$P(Ot,At,Mt,Rt,Nt,Ft,MH):null)}}function V$G(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){const Re=ve,De=UH,Be=Math.abs(Re[0]),Ze=Math.abs(Re[1]),Xe=Math.abs(Re[2]),Je=Be>=Ze?Be>=Xe?0:2:Ze>=Xe?1:2,Qe=Je,dt=Re[Qe]<0?2:1,$t=(Je+dt)%3,bt=(Je+(3-dt))%3,wt=Re[$t]/Re[Qe],xt=Re[bt]/Re[Qe],St=1/Re[Qe],Et=RH,Pt=IH,Ot=LH,{normalRequired:At}=Ce;for(let Mt=_e;Mt<be;++Mt){const ve=3*Mt,_e=Te*we[ve];o$44(De[0],Se[_e+0],Se[_e+1],Se[_e+2]);const be=Te*we[ve+1];o$44(De[1],Se[be+0],Se[be+1],Se[be+2]);const Ce=Te*we[ve+2];o$44(De[2],Se[Ce+0],Se[Ce+1],Se[Ce+2]),Ee&&(r$3w(De[0],Ee.applyToVertex(De[0][0],De[0][1],De[0][2],Mt)),r$3w(De[1],Ee.applyToVertex(De[1][0],De[1][1],De[1][2],Mt)),r$3w(De[2],Ee.applyToVertex(De[2][0],De[2][1],De[2][2],Mt))),Ki(Et,De[0],fe),Ki(Pt,De[1],fe),Ki(Ot,De[2],fe);const Re=Et[$t]-wt*Et[Qe],Be=Et[bt]-xt*Et[Qe],Ze=Pt[$t]-wt*Pt[Qe],Xe=Pt[bt]-xt*Pt[Qe],Je=Ot[$t]-wt*Ot[Qe],dt=Ot[bt]-xt*Ot[Qe],Rt=Je*Xe-dt*Ze,Nt=Re*dt-Be*Je,Ft=Ze*Be-Xe*Re;if((Rt<0||Nt<0||Ft<0)&&(Rt>0||Nt>0||Ft>0))continue;const zt=Rt+Nt+Ft;if(0===zt)continue;const kt=Rt*(St*Et[Qe])+Nt*(St*Pt[Qe])+Ft*(St*Ot[Qe]);if(kt*Math.sign(zt)<0)continue;const Bt=kt/zt;Bt>=0&&Oe(Bt,Mt,At?R$J(De):null)}}const RH=[0,0,0],IH=[0,0,0],LH=[0,0,0];function I$P(fe,ve,_e,be,we,Se,Te){return o$44(DH,fe,ve,_e),o$44(NH,be,we,Se),_$1z(Te,DH,NH),z$1d(Te,Te),Te}function R$J(fe){return Ki(DH,fe[1],fe[0]),Ki(NH,fe[2],fe[0]),_$1z(MH,DH,NH),z$1d(MH,MH),MH}const DH=[0,0,0],NH=[0,0,0];function k$I(fe,ve,_e,be){return w$13(fe,ve,_e,be,1/0)}function w$13(fe,ve,_e,be,we){const Se=(fe[0]-be-ve[0])*_e[0],Te=(fe[3]+be-ve[0])*_e[0];let Ee=Math.min(Se,Te),Ce=Math.max(Se,Te);const Oe=(fe[1]-be-ve[1])*_e[1],Re=(fe[4]+be-ve[1])*_e[1];if(Ce=Math.min(Ce,Math.max(Oe,Re)),Ce<0)return!1;if(Ee=Math.max(Ee,Math.min(Oe,Re)),Ee>Ce)return!1;const De=(fe[2]-be-ve[2])*_e[2],Be=(fe[5]+be-ve[2])*_e[2];return Ce=Math.min(Ce,Math.max(De,Be)),!(Ce<0)&&(Ee=Math.max(Ee,Math.min(De,Be)),!(Ee>Ce)&&Ee<we)}const FH=1e3,zH=1e-7,kH=[0,0,0],UH=[[0,0,0],[0,0,0],[0,0,0]];let VH=class r21{constructor(fe){this.vertexBufferLayout=fe}elementCount(fe){return fe.attributes.get(nO.POSITION).indices.length}write(fe,ve,_e,be,we){E$Z(_e,this.vertexBufferLayout,fe,ve,be,we)}};function n$2u(fe,ve){switch(ve.normalType){case wH.Attribute:case wH.Compressed:fe.include(t$2b,ve),fe.varyings.add("vNormalWorld","vec3"),fe.varyings.add("vNormalView","vec3"),fe.vertex.uniforms.add(new WI("transformNormalGlobalFromModel",(fe=>fe.transformNormalGlobalFromModel)),new oR("transformNormalViewFromGlobal",(fe=>fe.transformNormalViewFromGlobal))),fe.vertex.code.add(o$2P`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case wH.Ground:fe.include(v$1b,ve),fe.varyings.add("vNormalWorld","vec3"),fe.vertex.code.add(o$2P`
        void forwardNormal() {
          vNormalWorld = ${ve.spherical?o$2P`normalize(vPositionWorldCameraRelative);`:o$2P`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case wH.ScreenDerivative:fe.vertex.code.add(o$2P`void forwardNormal() {}`);break;default:ve.normalType;case wH.COUNT:}}let BH=class f8 extends YI{constructor(){super(...arguments),this.transformNormalViewFromGlobal=[1,0,0,0,1,0,0,0,1]}},jH=class v5 extends ZI{constructor(){super(...arguments),this.transformNormalGlobalFromModel=[1,0,0,0,1,0,0,0,1],this.toMapSpace=[0,0,0,0]}};const GH={func:jO.LESS},HH={func:jO.ALWAYS},qH={mask:255},WH={mask:0},t$2a=fe=>({function:{func:jO.NOTEQUAL,ref:fe,mask:fe},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.KEEP}}),u$1Y=fe=>({function:{func:jO.ALWAYS,ref:fe,mask:fe},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.REPLACE}}),YH={function:{func:jO.ALWAYS,ref:wA.OutlineVisualElementMask,mask:wA.OutlineVisualElementMask},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.ZERO}},ZH={function:{func:jO.ALWAYS,ref:wA.OutlineVisualElementMask,mask:wA.OutlineVisualElementMask},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.REPLACE}},XH={function:{func:jO.EQUAL,ref:wA.OutlineVisualElementMask,mask:wA.OutlineVisualElementMask},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.KEEP}},JH={function:{func:jO.NOTEQUAL,ref:wA.OutlineVisualElementMask,mask:wA.OutlineVisualElementMask},operation:{fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.KEEP}};function u$1X({normalTexture:fe,metallicRoughnessTexture:ve,metallicFactor:_e,roughnessFactor:be,emissiveTexture:we,emissiveFactor:Se,occlusionTexture:Te}){return null==fe&&null==ve&&null==we&&(null==Se||G$$(Se,Bi))&&null==Te&&(null==be||1===be)&&(null==_e||1===_e)}function n$2t({normalTexture:fe,metallicRoughnessTexture:ve,metallicFactor:_e,roughnessFactor:be,emissiveTexture:we,emissiveFactor:Se,occlusionTexture:Te}){return null==fe&&null==ve&&null==we&&(null==Se||G$$(Se,Bi))&&null==Te&&(null==be||1===be)&&(null==_e||1===_e||0===_e)}const QH=[1,1,.5],KH=[0,.6,.2],eq=[0,1,.2];function e$26(fe){fe.vertex.code.add(o$2P`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let tq=class e28 extends aO{constructor(fe,ve){super(fe,"int",oO.Pass,((_e,be,we)=>_e.setUniform1i(fe,ve(be,we))))}};function i$2f(fe,ve){ve.hasSymbolColors?(fe.include(e$29),fe.attributes.add(nO.SYMBOLCOLOR,"vec4"),fe.varyings.add("colorMixMode","mediump float"),fe.vertex.code.add(o$2P`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(fe.fragment.uniforms.add(new tq("colorMixMode",(fe=>JB[fe.colorMixMode]))),fe.vertex.code.add(o$2P`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function e$24(fe,ve){ve.hasVertexColors?(fe.attributes.add(nO.COLOR,"vec4"),fe.varyings.add("vColor","vec4"),fe.vertex.code.add(o$2P`void forwardVertexColor() { vColor = color; }`),fe.vertex.code.add(o$2P`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):fe.vertex.code.add(o$2P`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function a$2h(fe){fe.code.add(o$2P`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function e$23(fe,ve){switch(ve.output){case NI.Shadow:case NI.ShadowHighlight:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:fe.fragment.include(a$2h),fe.fragment.code.add(o$2P`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function d$1z(fe){fe.fragment.code.add(o$2P`
    #define discardOrAdjustAlpha(color) { if (color.a < ${o$2P.float(yj)}) { discard; } }
  `)}let rq=class e29 extends aO{constructor(fe,ve){super(fe,"float",oO.Draw,((_e,be,we)=>_e.setUniform1f(fe,ve(be,we))))}};function s$2f(fe,ve){l$2k(fe,ve,new dO("textureAlphaCutoff",(fe=>fe.textureAlphaCutoff)))}function t$28(fe,ve){l$2k(fe,ve,new rq("textureAlphaCutoff",(fe=>fe.textureAlphaCutoff)))}function l$2k(fe,ve,_e){const be=fe.fragment;switch(ve.alphaDiscardMode!==SA.Mask&&ve.alphaDiscardMode!==SA.MaskBlend||be.uniforms.add(_e),ve.alphaDiscardMode){case SA.Blend:return fe.include(d$1z);case SA.Opaque:be.code.add(o$2P`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case SA.Mask:be.code.add(o$2P`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case SA.MaskBlend:fe.fragment.code.add(o$2P`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function x$P(fe,ve){const{vertex:_e,fragment:be}=fe,we=ve.hasColorTexture&&ve.alphaDiscardMode!==SA.Opaque;switch(ve.output){case NI.Depth:d$1$(_e,ve),fe.include(o$2n,ve),fe.include(P$H,ve),fe.include(o$2O,ve),we&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),_e.code.add(o$2P`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),fe.include(s$2f,ve),be.code.add(o$2P`
          void main(void) {
            discardBySlice(vpos);
            ${we?o$2P`
                    vec4 texColor = texture(tex, ${ve.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case NI.Shadow:case NI.ShadowHighlight:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:case NI.ObjectAndLayerIdColor:d$1$(_e,ve),fe.include(o$2n,ve),fe.include(o$2O,ve),fe.include(l$2t,ve),fe.include(e$23,ve),fe.include(P$H,ve),fe.include(d$1J,ve),i$2H(fe),fe.varyings.add("depth","float"),we&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),_e.code.add(o$2P`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),fe.include(s$2f,ve),be.code.add(o$2P`
          void main(void) {
            discardBySlice(vpos);
            ${we?o$2P`
                    vec4 texColor = texture(tex, ${ve.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${ve.output===NI.ObjectAndLayerIdColor?o$2P`outputObjectAndLayerIdColor();`:o$2P`outputDepth(depth);`}
          }
        `);break;case NI.Normal:{d$1$(_e,ve),fe.include(o$2n,ve),fe.include(t$2b,ve),fe.include(n$2u,ve),fe.include(o$2O,ve),fe.include(l$2t,ve),we&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),ve.normalType===wH.ScreenDerivative&&fe.varyings.add("vPositionView","vec3");const Se=ve.normalType===wH.Attribute||ve.normalType===wH.Compressed;_e.code.add(o$2P`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${Se?o$2P`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:o$2P`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),fe.include(P$H,ve),fe.include(s$2f,ve),be.code.add(o$2P`
          void main() {
            discardBySlice(vpos);
            ${we?o$2P`
                    vec4 texColor = texture(tex, ${ve.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${ve.normalType===wH.ScreenDerivative?o$2P`vec3 normal = screenDerivativeNormal(vPositionView);`:o$2P`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case NI.Highlight:d$1$(_e,ve),fe.include(o$2n,ve),fe.include(o$2O,ve),fe.include(l$2t,ve),we&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),_e.code.add(o$2P`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),fe.include(P$H,ve),fe.include(s$2f,ve),fe.include(a$2n,ve),be.code.add(o$2P`
          void main() {
            discardBySlice(vpos);
            ${we?o$2P`
                    vec4 texColor = texture(tex, ${ve.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function T$I(fe,ve){const _e=fe.fragment;ve.hasVertexTangents?(fe.attributes.add(nO.TANGENT,"vec4"),fe.varyings.add("vTangent","vec4"),ve.doubleSidedMode===PH.WindingOrder?_e.code.add(o$2P`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):_e.code.add(o$2P`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):_e.code.add(o$2P`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),ve.textureCoordinateType!==sO.None&&(fe.include(s$2X,ve),_e.uniforms.add(ve.pbrTextureBindType===oO.Pass?new CO("normalTexture",(fe=>fe.textureNormal)):new dM("normalTexture",(fe=>fe.textureNormal))),ve.hasNormalTextureTransform&&(_e.uniforms.add(new lO("scale",(fe=>fe.scale??yd))),_e.uniforms.add(new oR("normalTextureTransformMatrix",(fe=>fe.normalTextureTransformMatrix??pd)))),_e.code.add(o$2P`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),ve.hasNormalTextureTransform&&_e.code.add(o$2P`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),_e.code.add(o$2P`return tangentSpace * rawNormal;
}`))}let iq=class a16 extends zi{constructor(fe){super(fe),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([d$3d((()=>this.view.ready),(fe=>{var ve;fe&&(null==(ve=this.view._stage)||ve.renderer.addRenderNode(this))}),Xa)])}destroy(){var fe,ve;null==(ve=null==(fe=this.view._stage)?void 0:fe.renderer)||ve.removeRenderNode(this)}render(){throw new Ir("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var fe,ve,_e;const be=null==(ve=null==(fe=this._frameBuffer)?void 0:fe.getTexture())?void 0:ve.descriptor,we=this.view._stage.renderer.fboCache.acquire((null==be?void 0:be.width)??640,(null==be?void 0:be.height)??480,this.produces);return null==(_e=we.fbo)||_e.initializeAndBind(),we}bindRenderTarget(){var fe,ve;return null==(ve=null==(fe=this._frameBuffer)?void 0:fe.fbo)||ve.initializeAndBind(),this._frameBuffer}requestRender(fe){var ve;fe===$A.UPDATE&&(null==(ve=this.view._stage)||ve.renderView.requestRender(fe)),this._dirty=!0}resetWebGLState(){var fe;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(null==(fe=this._frameBuffer)?void 0:fe.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(fe,ve){this._context=ve,this._frameBuffer=fe.find((({name:fe})=>fe===this.produces));try{return this.render(fe)}finally{this._frameBuffer=null}}};e$4o([y$2v({constructOnly:!0})],iq.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],iq.prototype,"consumes",void 0),e$4o([y$2v()],iq.prototype,"produces",void 0),iq=e$4o([a$4y("esri.views.3d.webgl.RenderNode")],iq);const nq=iq,sq=3e5,oq=5e5;let aq=class o23 extends aO{constructor(fe,ve){super(fe,"vec2",oO.Draw,((_e,be,we,Se)=>_e.setUniform2fv(fe,ve(be,we,Se))))}};function f$1D(){const fe=new gO,ve=fe.fragment;fe.include(o$2A);return ve.include(c$2X),ve.uniforms.add(new CO("depthMap",(fe=>fe.depthTexture)),new dM("tex",(fe=>fe.colorTexture)),new aq("blurSize",(fe=>fe.blurSize)),new dO("projScale",((fe,ve)=>{const _e=x$1W(ve.camera.eye,ve.camera.center);return _e>5e4?Math.max(0,fe.projScale-(_e-5e4)):fe.projScale}))),ve.code.add(o$2P`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${o$2P.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),fe.outputs.add("fragBlur","float"),ve.code.add(o$2P`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${o$2P.int(4)}; r <= ${o$2P.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),fe}const lq=Object.freeze(Object.defineProperty({__proto__:null,build:f$1D},Symbol.toStringTag,{value:"Module"}));let cq=class a17 extends fA{initializeProgram(fe){return new gA(fe.rctx,a17.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};cq.shader=new LO(lq,(()=>zt((()=>Promise.resolve().then((()=>nRe))),void 0)));let uq=class r22 extends iO{constructor(){super(...arguments),this.projScale=1}},hq=class t40 extends uq{constructor(){super(...arguments),this.intensity=1}},dq=class c27 extends iO{},pq=class o24 extends dq{constructor(){super(...arguments),this.blurSize=[0,0]}};function f$1C(fe){fe.fragment.uniforms.add(new hO("projInfo",((fe,ve)=>function c$2d(fe){const ve=fe.projectionMatrix;return 0===ve[11]?s$3I(fq,2/(fe.fullWidth*ve[0]),2/(fe.fullHeight*ve[5]),(1+ve[12])/ve[0],(1+ve[13])/ve[5]):s$3I(fq,-2/(fe.fullWidth*ve[0]),-2/(fe.fullHeight*ve[5]),(1-ve[8])/ve[0],(1-ve[9])/ve[5])}(ve.camera)))),fe.fragment.uniforms.add(new lO("zScale",((fe,ve)=>function m$1R(fe){return 0===fe.projectionMatrix[11]?o$2R(mq,0,1):o$2R(mq,1,0)}(ve.camera)))),fe.fragment.code.add(o$2P`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const fq=[0,0,0,0];const mq=[0,0];function f$1B(){const fe=new gO,ve=fe.fragment;return fe.include(o$2A),fe.include(f$1C),ve.include(c$2X),ve.uniforms.add(new dO("radius",((fe,ve)=>d$1y(ve.camera)))).code.add(o$2P`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),ve.code.add(o$2P`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),ve.uniforms.add(new CO("normalMap",(fe=>fe.normalTexture)),new CO("depthMap",(fe=>fe.depthTexture)),new dO("projScale",(fe=>fe.projScale)),new CO("rnm",(fe=>fe.noiseTexture)),new lO("rnmScale",((fe,ve)=>o$2R(yq,ve.camera.fullWidth/fe.noiseTexture.descriptor.width,ve.camera.fullHeight/fe.noiseTexture.descriptor.height))),new dO("intensity",(fe=>fe.intensity)),new lO("screenSize",((fe,ve)=>o$2R(yq,ve.camera.fullWidth,ve.camera.fullHeight)))),fe.outputs.add("fragOcclusion","float"),ve.code.add(o$2P`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${o$2P.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${o$2P.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),fe}function d$1y(fe){return Math.max(10,20*fe.computeScreenPixelSizeAtDist(Math.abs(4*fe.relativeElevation)))}const yq=[0,0],gq=Object.freeze(Object.defineProperty({__proto__:null,build:f$1B,getRadius:d$1y},Symbol.toStringTag,{value:"Module"}));let vq=class l15 extends fA{initializeProgram(fe){return new gA(fe.rctx,l15.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};vq.shader=new LO(gq,(()=>zt((()=>Promise.resolve().then((()=>sRe))),void 0)));const _q=2;let $q=class y5 extends nq{constructor(fe){super(fe),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new hq,this._drawParameters=new pq}initialize(){const fe=Uint8Array.from(atob("eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM"),(fe=>fe.charCodeAt(0))),ve=new nM;ve.wrapMode=qO.CLAMP_TO_EDGE,ve.pixelFormat=YO.RGB,ve.wrapMode=qO.REPEAT,ve.hasMipmap=!0,ve.width=32,ve.height=32,this._passParameters.noiseTexture=new oM(this.renderingContext,ve,fe),this._ssaoTechnique=this.techniques.acquire(vq),this._blurTechnique=this.techniques.acquire(cq),this.addHandles(d$3d((()=>this.isEnabled()),(()=>this._enableTime=0)))}destroy(){this._passParameters.noiseTexture=r$3M(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(fe){const ve=this.bindParameters,_e=fe.find((({name:fe})=>"normals"===fe)),be=null==_e?void 0:_e.getTexture(),we=null==_e?void 0:_e.getTexture(oA),Se=this.fboCache,Te=ve.camera,Ee=Te.fullViewport[2],Ce=Te.fullViewport[3],Oe=Math.round(Ee/_q),Re=Math.round(Ce/_q);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),Se.acquire(Oe,Re,"ssao",YA.RED);0===this._enableTime&&(this._enableTime=performance.now());const De=this.renderingContext,Be=this.view.qualitySettings.fadeDuration,Ze=Te.relativeElevation,Xe=e$3Y((oq-Ze)/(oq-sq),0,1),Je=Be>0?Math.min(Be,performance.now()-this._enableTime)/Be:1,Qe=Je*Xe;this._passParameters.normalTexture=be,this._passParameters.depthTexture=we,this._passParameters.projScale=1/Te.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*bq/d$1y(Te)**6*Qe;const dt=Se.acquire(Ee,Ce,"ssao input",YA.RG);De.unbindTexture(dt.fbo.colorTexture),De.bindFramebuffer(dt.fbo),De.setViewport(0,0,Ee,Ce),De.bindTechnique(this._ssaoTechnique,ve,this._passParameters,this._drawParameters),De.screen.draw();const $t=Se.acquire(Oe,Re,"ssao blur",YA.RED);De.unbindTexture($t.fbo.colorTexture),De.bindFramebuffer($t.fbo),this._drawParameters.colorTexture=dt.getTexture(),o$2R(this._drawParameters.blurSize,0,_q/Ce),De.bindTechnique(this._blurTechnique,ve,this._passParameters,this._drawParameters),De.setViewport(0,0,Oe,Re),De.screen.draw(),dt.release();const bt=Se.acquire(Oe,Re,"ssao",YA.RED);return De.unbindTexture(bt.fbo.colorTexture),De.bindFramebuffer(bt.fbo),De.setViewport(0,0,Ee,Ce),De.setClearColor(1,1,1,0),De.clear(DO.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=$t.getTexture(),o$2R(this._drawParameters.blurSize,_q/Ee,0),De.bindTechnique(this._blurTechnique,ve,this._passParameters,this._drawParameters),De.setViewport(0,0,Oe,Re),De.screen.draw(),De.setViewport4fv(Te.fullViewport),$t.release(),Je<1&&this.requestRender($A.UPDATE),bt}};e$4o([y$2v()],$q.prototype,"consumes",void 0),e$4o([y$2v()],$q.prototype,"produces",void 0),e$4o([y$2v({constructOnly:!0})],$q.prototype,"techniques",void 0),e$4o([y$2v({constructOnly:!0})],$q.prototype,"isEnabled",void 0),$q=e$4o([a$4y("esri.views.3d.webgl-engine.effects.ssao.SSAO")],$q);const bq=.5;function t$26(fe,ve){const _e=fe.fragment;ve.receiveAmbientOcclusion?(_e.uniforms.add(new CO("ssaoTex",((fe,ve)=>{var _e;return null==(_e=ve.ssao)?void 0:_e.getTexture()}))),_e.constants.add("blurSizePixelsInverse","float",1/_q),_e.code.add(o$2P`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):_e.code.add(o$2P`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function t$25(fe){const ve=fe.fragment.code;ve.add(o$2P`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),ve.add(o$2P`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),ve.add(o$2P`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function n$2r(fe,ve){const _e=fe.fragment.code;fe.include(t$2X),ve.pbrMode!==yM.Normal&&ve.pbrMode!==yM.Schematic&&ve.pbrMode!==yM.Simplified&&ve.pbrMode!==yM.TerrainWithWater||(_e.add(o$2P`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),_e.add(o$2P`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),ve.pbrMode!==yM.Normal&&ve.pbrMode!==yM.Schematic||(fe.include(t$25),_e.add(o$2P`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),_e.add(o$2P`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),_e.add(o$2P`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),_e.add(o$2P`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function r$1P(fe,ve){const _e=fe.fragment.code;fe.include(t$2X),_e.add(o$2P`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${ve.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),_e.add(o$2P`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),_e.add(o$2P`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),_e.add(o$2P`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),_e.add(o$2P`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function u$1U(fe){fe.constants.add("ambientBoostFactor","float",aI)}function h$1o(fe){fe.uniforms.add(new dO("lightingGlobalFactor",((fe,ve)=>ve.lighting.globalFactor)))}function p$2l(fe,ve){const _e=fe.fragment;switch(fe.include(t$26,ve),ve.pbrMode!==yM.Disabled&&fe.include(n$2r,ve),fe.include(r$2s,ve),fe.include(t$2X),_e.code.add(o$2P`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${ve.pbrMode===yM.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),u$1U(_e),h$1o(_e),t$34(_e),_e.code.add(o$2P`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${ve.spherical?o$2P`normalize(vPosWorld)`:o$2P`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),a$2$(_e),_e.code.add(o$2P`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),ve.pbrMode){case yM.Disabled:case yM.WaterOnIntegratedMesh:case yM.Water:fe.include(o$2N),_e.code.add(o$2P`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case yM.Normal:case yM.Schematic:_e.code.add(o$2P`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),_e.code.add(o$2P`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),ve.useFillLights?_e.uniforms.add(new zM("hasFillLights",((fe,ve)=>ve.enableFillLights))):_e.constants.add("hasFillLights","bool",!1),_e.code.add(o$2P`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),_e.uniforms.add(new dO("lightingSpecularStrength",((fe,ve)=>ve.lighting.mainLight.specularStrength)),new dO("lightingEnvironmentStrength",((fe,ve)=>ve.lighting.mainLight.environmentStrength))),_e.code.add(o$2P`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),_e.code.add(o$2P`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${ve.pbrMode!==yM.Schematic||ve.hasColorTexture?o$2P`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:o$2P`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case yM.Simplified:case yM.TerrainWithWater:fe.include(o$2N),_e.code.add(o$2P`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:ve.pbrMode;case yM.COUNT:}}let wq=class o25 extends aO{constructor(fe,ve,_e){super(fe,"mat4",oO.Draw,((_e,be,we,Se)=>_e.setUniformMatrix4fv(fe,ve(be,we,Se))),_e)}},xq=class e30 extends aO{constructor(fe,ve,_e){super(fe,"mat4",oO.Pass,((_e,be,we)=>_e.setUniformMatrix4fv(fe,ve(be,we))),_e)}},Sq=class v6 extends iO{constructor(){super(...arguments),this.modelTransformation=dd}},Tq=class h10 extends Sq{constructor(){super(...arguments),this.origin=[0,0,0]}};function m$1P(fe,ve){ve.receiveShadows&&(fe.fragment.uniforms.add(new xq("shadowMapMatrix",((fe,ve)=>ve.shadowMap.getShadowMapMatrices(fe.origin)),4)),f$1A(fe))}function x$O(fe,ve){ve.receiveShadows&&(fe.fragment.uniforms.add(new wq("shadowMapMatrix",((fe,ve)=>ve.shadowMap.getShadowMapMatrices(fe.origin)),4)),f$1A(fe))}function f$1A(fe){const ve=fe.fragment;ve.include(a$2h),ve.uniforms.add(new CO("shadowMap",((fe,ve)=>ve.shadowMap.depthTexture)),new tq("numCascades",((fe,ve)=>ve.shadowMap.numCascades)),new hO("cascadeDistances",((fe,ve)=>ve.shadowMap.cascadeDistances))),ve.code.add(o$2P`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function t$24(fe,ve){ve.hasColorTextureTransform?(fe.vertex.uniforms.add(new oR("colorTextureTransformMatrix",(fe=>fe.colorTextureTransformMatrix??pd))),fe.varyings.add("colorUV","vec2"),fe.vertex.code.add(o$2P`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):fe.vertex.code.add(o$2P`void forwardColorUV(){}`)}function s$2e(fe,ve){ve.hasNormalTextureTransform&&ve.textureCoordinateType!==sO.None?(fe.vertex.uniforms.add(new oR("normalTextureTransformMatrix",(fe=>fe.normalTextureTransformMatrix??pd))),fe.varyings.add("normalUV","vec2"),fe.vertex.code.add(o$2P`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):fe.vertex.code.add(o$2P`void forwardNormalUV(){}`)}function i$2d(fe,ve){ve.hasEmissionTextureTransform&&ve.textureCoordinateType!==sO.None?(fe.vertex.uniforms.add(new oR("emissiveTextureTransformMatrix",(fe=>fe.emissiveTextureTransformMatrix??pd))),fe.varyings.add("emissiveUV","vec2"),fe.vertex.code.add(o$2P`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):fe.vertex.code.add(o$2P`void forwardEmissiveUV(){}`)}function d$1x(fe,ve){ve.hasOcclusionTextureTransform&&ve.textureCoordinateType!==sO.None?(fe.vertex.uniforms.add(new oR("occlusionTextureTransformMatrix",(fe=>fe.occlusionTextureTransformMatrix??pd))),fe.varyings.add("occlusionUV","vec2"),fe.vertex.code.add(o$2P`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):fe.vertex.code.add(o$2P`void forwardOcclusionUV(){}`)}function n$2q(fe,ve){ve.hasMetallicRoughnessTextureTransform&&ve.textureCoordinateType!==sO.None?(fe.vertex.uniforms.add(new oR("metallicRoughnessTextureTransformMatrix",(fe=>fe.metallicRoughnessTextureTransformMatrix??pd))),fe.varyings.add("metallicRoughnessUV","vec2"),fe.vertex.code.add(o$2P`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):fe.vertex.code.add(o$2P`void forwardMetallicRoughnessUV(){}`)}function i$2c(fe){fe.include(e$2S),fe.code.add(o$2P`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${o$2P.int(pH.Multiply)}) {
        return allMixed;
      }
      if (mode == ${o$2P.int(pH.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${o$2P.int(pH.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${o$2P.int(pH.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${o$2P.int(pH.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function H$w(fe){const ve=new gO,{vertex:_e,fragment:be,varyings:we}=ve;if(d$1$(_e,fe),ve.include(o$2p),we.add("vpos","vec3"),ve.include(l$2t,fe),ve.include(N$N,fe),ve.include(a$2p,fe),ve.include(t$24,fe),fe.output===NI.Color){ve.include(s$2e,fe),ve.include(i$2d,fe),ve.include(d$1x,fe),ve.include(n$2q,fe),f$20(_e,fe),ve.include(t$2b,fe),ve.include(o$2n,fe);const Se=fe.normalType===wH.Attribute||fe.normalType===wH.Compressed;Se&&fe.offsetBackfaces&&ve.include(e$26),ve.include(T$I,fe),ve.include(n$2u,fe),fe.instancedColor&&ve.attributes.add(nO.INSTANCECOLOR,"vec4"),we.add("vPositionLocal","vec3"),ve.include(o$2O,fe),ve.include(n$2S,fe),ve.include(i$2f,fe),ve.include(e$24,fe),_e.uniforms.add(new hO("externalColor",(fe=>fe.externalColor))),we.add("vcolorExt","vec4"),fe.multipassEnabled&&we.add("depth","float"),_e.code.add(o$2P`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${fe.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${o$2P.float(yj)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${Se?o$2P`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${fe.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${Se&&fe.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${fe.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),ve.include(P$H,fe),ve.include(p$2l,fe),ve.include(t$26,fe),ve.include(s$2f,fe),ve.include(fe.instancedDoublePrecision?m$1P:x$O,fe),ve.include(a$2L,fe),f$20(be,fe),be.uniforms.add(_e.uniforms.get("localOrigin"),new uO("ambient",(fe=>fe.ambient)),new uO("diffuse",(fe=>fe.diffuse)),new dO("opacity",(fe=>fe.opacity)),new dO("layerOpacity",(fe=>fe.layerOpacity))),fe.hasColorTexture&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),ve.include(l$2X,fe),ve.include(n$2r,fe),be.include(i$2c),ve.include(e$28,fe),u$1U(be),h$1o(be),a$2$(be),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),be.code.add(o$2P`
      void main() {
        discardBySlice(vpos);
        ${fe.multipassEnabled?"terrainDepthTest(depth);":""}
        ${fe.hasColorTexture?o$2P`
                vec4 texColor = texture(tex, ${fe.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                ${fe.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:o$2P`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${fe.normalType===wH.ScreenDerivative?o$2P`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:o$2P`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${fe.pbrMode===yM.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${fe.receiveShadows?"readShadowMap(vpos, linearDepth)":fe.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${fe.hasVertexColors?o$2P`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:o$2P`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${fe.hasNormalTexture?o$2P`
                mat3 tangentSpace = ${fe.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${fe.hasNormalTextureTransform?o$2P`normalUV`:"vuv0"});`:o$2P`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${fe.spherical?o$2P`normalize(posWorld);`:o$2P`vec3(0.0, 0.0, 1.0);`}

        ${fe.snowCover?o$2P`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${fe.pbrMode===yM.Normal||fe.pbrMode===yM.Schematic?o$2P`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${fe.snowCover?o$2P`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:o$2P`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return ve.include(x$P,fe),ve}const Eq=Object.freeze(Object.defineProperty({__proto__:null,build:H$w},Symbol.toStringTag,{value:"Module"}));let Pq=class q2 extends BH{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=e$3$(QH),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=vA.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=r$3y(0,0,0),this.instancedDoublePrecision=!1,this.normalType=wH.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=r$3y(.2,.2,.2),this.diffuse=r$3y(.8,.8,.8),this.externalColor=r$35(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=[0,0,0],this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=_A.Less,this.textureAlphaMode=SA.Blend,this.textureAlphaCutoff=mj,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ej.Occlude,this.isDecoration=!1}},Cq=class E4 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global,ve.doublePrecisionRequiresObfuscation=fe.rctx.driverTest.doublePrecisionRequiresObfuscation.result,ve.textureCoordinateType=ve.hasColorTexture||ve.hasMetallicRoughnessTexture||ve.hasEmissionTexture||ve.hasOcclusionTexture||ve.hasNormalTexture?sO.Default:sO.None,ve.objectAndLayerIdColorInstanced=ve.instanced}initializeProgram(fe){return this._initializeProgram(fe,E4.shader)}_initializeProgram(fe,ve){return new gA(fe.rctx,ve.get().build(this.configuration),mA)}_makePipeline(fe,ve){const _e=this.configuration,be=fe===WR.NONE,we=fe===WR.FrontFace;return S$1g({blending:_e.output===NI.Color&&_e.transparent?be?_j:c$2o(fe):null,culling:R$I(_e)?h$1V(_e.cullFace):null,depthTest:{func:f$1O(fe,I$O(_e.customDepthTest))},depthWrite:(be||we)&&_e.writeDepth?OA:null,drawBuffers:_e.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e.hasOccludees?qH:null,stencilTest:_e.hasOccludees?ve?ZH:YH:null,polygonOffset:be||we?null:_$N(_e.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(fe){return fe?this._occludeePipelineState:super.getPipeline()}};function I$O(fe){return fe===_A.Lequal?jO.LEQUAL:jO.LESS}function R$I(fe){return fe.cullFace!==vA.None||!fe.hasSlicePlane&&!fe.transparent&&!fe.doubleSidedMode}Cq.shader=new LO(Eq,(()=>zt((()=>Promise.resolve().then((()=>oRe))),void 0)));let Oq=class c28 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.alphaDiscardMode=SA.Opaque,this.doubleSidedMode=PH.None,this.pbrMode=yM.Disabled,this.cullFace=vA.None,this.transparencyPassType=WR.NONE,this.normalType=wH.Attribute,this.textureCoordinateType=sO.None,this.customDepthTest=_A.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};function I$N(fe){const ve=new gO,{vertex:_e,fragment:be,varyings:we}=ve;return d$1$(_e,fe),ve.include(o$2p),we.add("vpos","vec3"),ve.include(l$2t,fe),ve.include(N$N,fe),ve.include(a$2p,fe),fe.output===NI.Color&&(f$20(ve.vertex,fe),ve.include(t$2b,fe),ve.include(o$2n,fe),fe.offsetBackfaces&&ve.include(e$26),fe.instancedColor&&ve.attributes.add(nO.INSTANCECOLOR,"vec4"),we.add("vNormalWorld","vec3"),we.add("localvpos","vec3"),fe.multipassEnabled&&we.add("depth","float"),ve.include(o$2O,fe),ve.include(n$2S,fe),ve.include(i$2f,fe),ve.include(e$24,fe),_e.uniforms.add(new hO("externalColor",(fe=>fe.externalColor))),we.add("vcolorExt","vec4"),_e.code.add(o$2P`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${fe.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${o$2P.float(yj)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${fe.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${fe.multipassEnabled?o$2P`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),fe.output===NI.Color&&(ve.include(P$H,fe),ve.include(p$2l,fe),ve.include(t$26,fe),ve.include(s$2f,fe),ve.include(fe.instancedDoublePrecision?m$1P:x$O,fe),ve.include(a$2L,fe),f$20(ve.fragment,fe),t$34(be),u$1U(be),h$1o(be),be.uniforms.add(_e.uniforms.get("localOrigin"),_e.uniforms.get("view"),new uO("ambient",(fe=>fe.ambient)),new uO("diffuse",(fe=>fe.diffuse)),new dO("opacity",(fe=>fe.opacity)),new dO("layerOpacity",(fe=>fe.layerOpacity))),fe.hasColorTexture&&be.uniforms.add(new CO("tex",(fe=>fe.texture))),ve.include(l$2X,fe),ve.include(n$2r,fe),be.include(i$2c),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),a$2$(be),be.code.add(o$2P`
      void main() {
        discardBySlice(vpos);
        ${fe.multipassEnabled?o$2P`terrainDepthTest(depth);`:""}
        ${fe.hasColorTexture?o$2P`
                vec4 texColor = texture(tex, ${fe.hasColorTextureTransform?o$2P`colorUV`:o$2P`vuv0`});
                ${fe.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:o$2P`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${fe.pbrMode===yM.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${fe.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":fe.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${fe.hasVertexColors?o$2P`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:o$2P`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${fe.snowCover?o$2P`albedo = mix(albedo, vec3(1), 0.9);`:o$2P``}
        ${o$2P`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${fe.pbrMode===yM.Normal||fe.pbrMode===yM.Schematic?fe.spherical?o$2P`vec3 normalGround = normalize(vpos + localOrigin);`:o$2P`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:o$2P``}
        ${fe.pbrMode===yM.Normal||fe.pbrMode===yM.Schematic?o$2P`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${fe.snowCover?o$2P`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:o$2P`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),ve.include(x$P,fe),ve}e$4o([r$2w({count:NI.COUNT})],Oq.prototype,"output",void 0),e$4o([r$2w({count:SA.COUNT})],Oq.prototype,"alphaDiscardMode",void 0),e$4o([r$2w({count:PH.COUNT})],Oq.prototype,"doubleSidedMode",void 0),e$4o([r$2w({count:yM.COUNT})],Oq.prototype,"pbrMode",void 0),e$4o([r$2w({count:vA.COUNT})],Oq.prototype,"cullFace",void 0),e$4o([r$2w({count:WR.COUNT})],Oq.prototype,"transparencyPassType",void 0),e$4o([r$2w({count:wH.COUNT})],Oq.prototype,"normalType",void 0),e$4o([r$2w({count:sO.COUNT})],Oq.prototype,"textureCoordinateType",void 0),e$4o([r$2w({count:_A.COUNT})],Oq.prototype,"customDepthTest",void 0),e$4o([r$2w()],Oq.prototype,"spherical",void 0),e$4o([r$2w()],Oq.prototype,"hasVertexColors",void 0),e$4o([r$2w()],Oq.prototype,"hasSymbolColors",void 0),e$4o([r$2w()],Oq.prototype,"hasVerticalOffset",void 0),e$4o([r$2w()],Oq.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Oq.prototype,"hasSliceHighlight",void 0),e$4o([r$2w()],Oq.prototype,"hasColorTexture",void 0),e$4o([r$2w()],Oq.prototype,"hasMetallicRoughnessTexture",void 0),e$4o([r$2w()],Oq.prototype,"hasEmissionTexture",void 0),e$4o([r$2w()],Oq.prototype,"hasOcclusionTexture",void 0),e$4o([r$2w()],Oq.prototype,"hasNormalTexture",void 0),e$4o([r$2w()],Oq.prototype,"hasScreenSizePerspective",void 0),e$4o([r$2w()],Oq.prototype,"hasVertexTangents",void 0),e$4o([r$2w()],Oq.prototype,"hasOccludees",void 0),e$4o([r$2w()],Oq.prototype,"multipassEnabled",void 0),e$4o([r$2w()],Oq.prototype,"hasModelTransformation",void 0),e$4o([r$2w()],Oq.prototype,"offsetBackfaces",void 0),e$4o([r$2w()],Oq.prototype,"vvSize",void 0),e$4o([r$2w()],Oq.prototype,"vvColor",void 0),e$4o([r$2w()],Oq.prototype,"receiveShadows",void 0),e$4o([r$2w()],Oq.prototype,"receiveAmbientOcclusion",void 0),e$4o([r$2w()],Oq.prototype,"textureAlphaPremultiplied",void 0),e$4o([r$2w()],Oq.prototype,"instanced",void 0),e$4o([r$2w()],Oq.prototype,"instancedColor",void 0),e$4o([r$2w()],Oq.prototype,"objectAndLayerIdColorInstanced",void 0),e$4o([r$2w()],Oq.prototype,"instancedDoublePrecision",void 0),e$4o([r$2w()],Oq.prototype,"doublePrecisionRequiresObfuscation",void 0),e$4o([r$2w()],Oq.prototype,"writeDepth",void 0),e$4o([r$2w()],Oq.prototype,"transparent",void 0),e$4o([r$2w()],Oq.prototype,"enableOffset",void 0),e$4o([r$2w()],Oq.prototype,"cullAboveGround",void 0),e$4o([r$2w()],Oq.prototype,"snowCover",void 0),e$4o([r$2w()],Oq.prototype,"hasColorTextureTransform",void 0),e$4o([r$2w()],Oq.prototype,"hasEmissionTextureTransform",void 0),e$4o([r$2w()],Oq.prototype,"hasNormalTextureTransform",void 0),e$4o([r$2w()],Oq.prototype,"hasOcclusionTextureTransform",void 0),e$4o([r$2w()],Oq.prototype,"hasMetallicRoughnessTextureTransform",void 0),e$4o([r$2w({constValue:!1})],Oq.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:!0})],Oq.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!1})],Oq.prototype,"useCustomDTRExponentForWater",void 0),e$4o([r$2w({constValue:!1})],Oq.prototype,"supportsTextureAtlas",void 0),e$4o([r$2w({constValue:!0})],Oq.prototype,"useFillLights",void 0);const Aq=Object.freeze(Object.defineProperty({__proto__:null,build:I$N},Symbol.toStringTag,{value:"Module"}));let Mq=class t41 extends Cq{initializeConfiguration(fe,ve){super.initializeConfiguration(fe,ve),ve.hasMetallicRoughnessTexture=!1,ve.hasEmissionTexture=!1,ve.hasOcclusionTexture=!1,ve.hasNormalTexture=!1,ve.hasModelTransformation=!1,ve.normalType=wH.Attribute,ve.doubleSidedMode=PH.WindingOrder,ve.hasVertexTangents=!1}initializeProgram(fe){return this._initializeProgram(fe,t41.shader)}};Mq.shader=new LO(Aq,(()=>zt((()=>Promise.resolve().then((()=>aRe))),void 0)));let Rq=class j6 extends QB{constructor(fe){super(fe,Lq),this.supportsEdges=!0,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>(n$2T(fe)||r$2k(fe))&&!this.parameters.transparent],[qR.TRANSPARENT_MATERIAL,fe=>(n$2T(fe)||r$2k(fe))&&this.parameters.transparent&&this.parameters.writeDepth],[qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,fe=>(n$2T(fe)||r$2k(fe))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new Oq,this._vertexBufferLayout=function N$D(fe){const ve=H$J().vec3f(nO.POSITION);return fe.normalType===wH.Compressed?ve.vec2i16(nO.NORMALCOMPRESSED,{glNormalized:!0}):ve.vec3f(nO.NORMAL),fe.hasVertexTangents&&ve.vec4f(nO.TANGENT),(fe.textureId||fe.normalTextureId||fe.metallicRoughnessTextureId||fe.emissiveTextureId||fe.occlusionTextureId)&&ve.vec2f(nO.UV0),fe.hasVertexColors&&ve.vec4u8(nO.COLOR),fe.hasSymbolColors&&ve.vec4u8(nO.SYMBOLCOLOR),has("enable-feature:objectAndLayerId-rendering")&&ve.vec4u8(nO.OBJECTANDLAYERIDCOLOR),ve}(this.parameters)}isVisibleForOutput(fe){return fe!==NI.Shadow&&fe!==NI.ShadowExcludeHighlight&&fe!==NI.ShadowHighlight||this.parameters.castShadows}isVisible(){const fe=this.parameters;if(!super.isVisible()||0===fe.layerOpacity)return!1;const{hasInstancedColor:ve,hasVertexColors:_e,hasSymbolColors:be,vvColor:we}=fe,Se="replace"===fe.colorMixMode,Te=fe.opacity>0,Ee=fe.externalColor&&fe.externalColor[3]>0,Ce=ve||we||be;return _e&&Ce?Se||Te:_e?Se?Ee:Te:Ce?Se||Te:Se?Ee:Te}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?vA.None:this.parameters.cullFace,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation,fe===NI.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=PH.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?PH.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?PH.WindingOrder:PH.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&null!=ve.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?yM.Schematic:yM.Normal:yM.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.enableOffset=ve.camera.relativeElevation<bj,this._configuration.snowCover=this.hasSnowCover(ve),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(fe){return null!=fe.weather&&fe.weatherVisible&&"snowy"===fe.weather.type&&"enabled"===fe.weather.snowCover}intersect(fe,ve,_e,be,we,Se){if(null!=this.parameters.verticalOffset){const fe=_e.camera;o$44(Uq,ve[12],ve[13],ve[14]);let Se=null;switch(_e.viewingMode){case Wf.Global:Se=z$1d(zq,Uq);break;case Wf.Local:Se=r$3w(zq,Fq)}let Te=0;const Ee=e$3Z(Vq,Uq,fe.eye),Ce=s$4g(Ee),Oe=g$2z(Ee,Ee,1/Ce);let Re=null;this.parameters.screenSizePerspective&&(Re=P$1g(Se,Oe)),Te+=o$1X(fe,Ce,this.parameters.verticalOffset,Re??0,this.parameters.screenSizePerspective),g$2z(Se,Se,Te),S$1P(kq,Se,_e.transform.inverseRotation),be=e$3Z(Dq,be,kq),we=e$3Z(Nq,we,kq)}p$2m(fe,_e,be,we,d$2R(_e.verticalOffset),Se)}createGLMaterial(fe){return new Iq(fe)}createBufferWriter(){return new VH(this._vertexBufferLayout)}},Iq=class E5 extends fM{constructor(fe){super({...fe,...fe.material.parameters})}_updateShadowState(fe){fe.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:fe.shadowMap.enabled})}_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){this._output===NI.Color&&(this._updateShadowState(fe),this._updateOccludeeState(fe));const ve=this._material.parameters;this.updateTexture(ve.textureId);const _e=fe.camera.viewInverseTransposeMatrix;return o$44(ve.origin,_e[3],_e[7],_e[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ve.treeRendering?Mq:Cq,fe)}};const Lq=new class L4 extends Pq{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Dq=[0,0,0],Nq=[0,0,0],Fq=r$3y(0,0,1),zq=[0,0,0],kq=[0,0,0],Uq=[0,0,0],Vq=[0,0,0],Bq=new oH({});function m$1O(fe){return"web-style"===fe.type?Bq:F$A(fe.symbolLayers.toArray().map((ve=>p$2k(fe,ve))))}function F$A(fe){let ve=0,_e=0,be=0,we=!1,Se=0;const Te=new cH;for(const Ee of fe)null!=Ee&&(ve+=Ee.verticesPerFeature,_e+=Ee.verticesPerCoordinate,be+=Ee.drawCallsPerFeature,Te.bytesPerFeature+=Ee.memory.bytesPerFeature,Te.bytesPerFeatureLabel+=Ee.memory.bytesPerFeatureLabel,Te.resourceBytes+=Ee.memory.resourceBytes,Te.draped.bytesPerFeature+=Ee.memory.bytesPerFeature,Te.draped.bytesPerFeatureLabel+=Ee.memory.bytesPerFeatureLabel,we=we||Ee.estimated,++Se);return we?new lH(Se,{verticesPerFeature:ve,verticesPerCoordinate:_e,drawCallsPerFeature:be,memory:Te}):new aH(Se,{verticesPerFeature:ve,verticesPerCoordinate:_e,drawCallsPerFeature:be,memory:Te})}function d$1w(fe){const ve=F$A(fe);return ve.numComplexities>0&&(ve.verticesPerFeature/=ve.numComplexities,ve.verticesPerCoordinate/=ve.numComplexities,ve.drawCallsPerFeature/=ve.numComplexities,ve.memory.bytesPerFeature/=ve.numComplexities,ve.memory.bytesPerFeatureLabel/=ve.numComplexities,ve.memory.resourceBytes/=ve.numComplexities,ve.memory.draped.bytesPerFeature/=ve.numComplexities,ve.memory.draped.bytesPerFeatureLabel/=ve.numComplexities),ve}const jq={};function p$2k(fe,ve){var _e,be;const we=C$M(fe,ve),Se=function c$2g(fe){return fe&&fe.enabled&&(function e$2c(fe){return"extrude"===fe.type}(fe)||function t$2c(fe){return"fill"===fe.type}(fe))&&null!=fe.edges}(ve)?2:0;switch(ve.type){case"extrude":return new sH({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:Se,memory:we});case"fill":if("mesh-3d"===fe.type)return new sH({drawCallsPerFeature:Se,memory:we});if(null!=ve.outline&&ve.outline.size>0)return new sH({verticesPerFeature:-12,verticesPerCoordinate:9,memory:we});case"water":return new sH({verticesPerFeature:-6,verticesPerCoordinate:3,memory:we});case"line":return new sH({verticesPerFeature:-6,verticesPerCoordinate:6,memory:we});case"object":return(null==(_e=ve.resource)?void 0:_e.href)?new oH({verticesPerFeature:100,memory:we}):{...f$1z((null==(be=ve.resource)?void 0:be.primitive)??Bx),memory:we};case"path":{let fe=0,_e=0;switch(ve.profile){case"circle":fe=eH;break;case"quad":fe=4;break;default:return void ve.profile}switch(ve.join){case"round":_e=QG;break;case"miter":case"bevel":_e=1;break;default:return}const be=2*fe,Se=fe*_e*2,Te=Se+be;let Ee=-2*Se-be;switch(ve.cap){case"none":break;case"butt":case"square":Ee+=2*(fe-1);break;case"round":Ee+=2*(fe*(KG-1)*2+fe);break;default:return}return new sH({verticesPerFeature:Ee,verticesPerCoordinate:Te,memory:we})}case"text":case"icon":return new sH({verticesPerFeature:6,memory:we});default:return}}function C$M(fe,ve){const _e="point-3d"===fe.type;switch(ve.type){case"extrude":return ve.edges&&ve.edges.size>0?Gq.EXTRUDE_EDGES:Gq.EXTRUDE;case"fill":return null!=ve.outline&&ve.outline.size>0?Gq.FILL_OUTLINE:Gq.FILL;case"water":return Gq.FILL;case"line":return"round"===ve.join?Gq.LINE_ROUND:Gq.LINE_MITER;case"path":switch(ve.join){case"round":switch(ve.profile){case"circle":return Gq.PATH_ROUND_CIRCLE;case"quad":return Gq.PATH_ROUND_QUAD;default:return void ve.profile}case"miter":case"bevel":switch(ve.profile){case"circle":return Gq.PATH_MITER_CIRCLE;case"quad":return Gq.PATH_MITER_QUAD;default:return void ve.profile}default:return}case"object":return _e?Gq.OBJECT_POINT:Gq.OBJECT_POLYGON;case"icon":case"text":return _e?Gq.ICON_POINT:Gq.ICON_POLYGON;default:return}}function f$1z(fe){const ve=jq[fe];if(ve)return ve;const _e=w$12(S$_(fe,new Rq({})).levels);return jq[fe]=new sH({verticesPerFeature:_e}),jq[fe]}function w$12(fe){return fe.reduce(((fe,ve,_e)=>fe+ve.numVertices*(1/10**_e)),0)/fe.reduce(((fe,ve,_e)=>fe+1/10**_e),0)}const Gq={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var Hq;!function(fe){fe[fe.RecreateSymbol=0]="RecreateSymbol",fe[fe.RecreateGraphics=1]="RecreateGraphics",fe[fe.FastUpdate=2]="FastUpdate"}(Hq||(Hq={}));let qq=class r23{constructor(fe){this.schedule=fe,this._abortController=null,this._loadStatus=Wq.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(fe,ve){return this._loadStatus===Wq.LOADED?(fe&&fe(),this._loader??Promise.resolve()):this._loadStatus===Wq.FAILED?(ve&&ve(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=Wq.LOADED}),(fe=>{throw this._loadError=fe,this._abortController=null,this._loadStatus=Wq.FAILED,!b$2g(fe)&&this.logger&&fe.message&&this.logger.warn(fe.message),fe}))),this._loader.then(fe,ve).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=e$4f(this._abortController):this._loadStatus===Wq.LOADING&&(this._loadStatus=Wq.FAILED),this._loader=null}};var Wq;!function(fe){fe[fe.LOADING=0]="LOADING",fe[fe.LOADED=1]="LOADED",fe[fe.FAILED=2]="FAILED"}(Wq||(Wq={}));const u$1T=()=>ar.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Yq=class y6 extends qq{constructor(fe,ve,_e,be){super(_e.schedule),this.symbol=fe,this.symbolLayer=ve,this._context=_e,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=u$1T(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=be.renderPriority,this._renderPriorityStep=be.renderPriorityStep,this._elevationContext=new VG,this.complexity=this.computeComplexity(),this.ignoreDrivers=be.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=f$1y(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(fe){if(this.ignoreDrivers)return!1;const ve=this._drivenProperties,_e=f$1y(fe);return _e.color!==ve.color||_e.opacity!==ve.opacity||_e.opacityAlwaysOpaque!==ve.opacityAlwaysOpaque||_e.size!==ve.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(fe,ve,_e,be){const we=fe.projectionSuccess,Se="polygons"in fe?fe.polygons:null,Te=`${be} geometry failed to be created`;we?!this._logGeometryValidationWarnings(ve,_e,be)&&Se&&0===Se.length&&"rings"===_e&&ve.length>0&&ve[0].length>2&&u$1T().warnOncePerTick(`${Te} (filled rings should use clockwise winding - try reversing the order of vertices)`):u$1T().warnOncePerTick(`${Te} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(fe,ve,_e){const be=`${_e} geometry failed to be created`;return!fe.length||1===fe.length&&!fe[0].length?(u$1T().warnOncePerTick(`${be} (no ${ve} were defined)`),!0):!(Array.isArray(fe)&&Array.isArray(fe[0])||(u$1T().warnOncePerTick(`${be} (${ve} should be defined as a 2D array)`),0))}_validateGeometry(fe,ve=null,_e=null){if(null!=ve&&!ve.includes(fe.type))return this.logger.warn("unsupported geometry type for "+_e+` symbol: ${fe.type}`),!1;switch(fe.type){case"point":{const ve=fe;if(!isFinite(ve.x)||!isFinite(ve.y))return u$1T().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":g$2p(fe)&&u$1T().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return Zq}_defaultElevationInfoZ(){return Xq}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(fe){return fe.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(fe,ve=this.getDefaultElevationInfo(fe)){return this._elevationContext.mode||ve.mode}setElevationInfoOverride(fe){this._elevationInfoOverride=fe,this._updateElevationContext()}setGraphicElevationContext(fe,ve=new VG){const _e=fe.geometry,be=this.getDefaultElevationInfo(_e);ve.unit=null!=this._elevationContext.unit?this._elevationContext.unit:be.unit,ve.mode=this.getGeometryElevationMode(_e,be),ve.offsetMeters=this._elevationContext.meterUnitOffset??be.offset??0;const we=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===ve.mode;we&&(ve.mode="relative-to-ground",ve.offsetMeters=0);const Se=we?UG:this._elevationContext.featureExpressionInfoContext;return ve.updateFeatureExpressionInfoContext(Se,fe,this._context.layer),ve}prepareSymbolLayerPatch(fe){}updateGeometry(fe,ve){return!1}updateTransform(fe,ve,_e,be){return!1}onRemoveGraphic(fe){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;return this._context.layer.opacity??1}_getCombinedOpacity(fe,ve=Jq){let _e=1;return this.draped||(_e*=this._getLayerOpacity()),this._drivenProperties.opacity||(null!=fe?_e*=fe.a:ve.hasIntrinsicColor||(_e=0)),_e}_getCombinedOpacityAndColor(fe,ve=Jq){const _e=this._getCombinedOpacity(fe,ve);if(this._drivenProperties.color)return F$B(null,_e);return F$B(null!=fe?b_.toUnitRGB(fe):ji,_e)}_getVertexOpacityAndColor(fe,ve=null){const _e=F$B(this._drivenProperties.color?fe.color:null,this._drivenProperties.opacity?fe.opacity:null);return ve&&(_e[0]*=ve,_e[1]*=ve,_e[2]*=ve,_e[3]*=ve),_e}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return p$2k(this.symbol,this.symbolLayer)}globalPropertyChanged(fe,ve,_e){switch(fe){case"opacity":return this.layerOpacityChanged(ve,_e),!0;case"elevationInfo":{const fe=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(ve,_e,fe)!==EG.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(ve,_e);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(fe,ve,_e){let be=EG.UPDATE;return fe.forEach((fe=>{const we=ve(fe);if(null!=we){const ve=fe.graphic;this.setGraphicElevationContext(ve,we.elevationContext),we.needsElevationUpdates=_e(we.elevationContext.mode)}else be=EG.RECREATE})),be}applyRendererDiff(fe,ve){return Hq.RecreateSymbol}getFastUpdateAttrValues(fe){if(!this._fastUpdates)return null;const ve=this._fastUpdates.visualVariables;return r$35(ve.size?X$h(ve.size.field,fe):0,ve.color?X$h(ve.color.field,fe):0,ve.opacity?X$h(ve.opacity.field,fe):0,0)}get draped(){return this._draped}ensureDrapedStatus(fe){return null==this._draped?(this._draped=fe,!0):(fe!==this.draped&&u$1T().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>{var fe,ve,_e,be,we,Se,Te,Ee;return{size:(null==(ve=null==(fe=this._fastUpdates)?void 0:fe.visualVariables.size)?void 0:ve.field)??null,color:(null==(be=null==(_e=this._fastUpdates)?void 0:_e.visualVariables.color)?void 0:be.field)??null,opacity:(null==(Se=null==(we=this._fastUpdates)?void 0:we.visualVariables.opacity)?void 0:Se.field)??null,rotation:(null==(Ee=null==(Te=this._fastUpdates)?void 0:Te.visualVariables.rotation)?void 0:Ee.field)??null}}}}};function f$1y(fe){const ve={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return fe&&"visualVariables"in fe&&fe.visualVariables&&fe.visualVariables.forEach((fe=>{switch(fe.type){case"color":if(ve.color=!0,fe.stops)for(let _e=0;_e<fe.stops.length;_e++){const be=fe.stops[_e].color;be&&(ve.opacity=!0,be.a<1&&(ve.opacityAlwaysOpaque=!1))}break;case"opacity":ve.opacity=!0,ve.opacityAlwaysOpaque=!1;break;case"size":ve.size=!0}})),ve}const Zq={mode:"on-the-ground",offset:0,unit:"meters"},Xq={mode:"absolute-height",offset:0,unit:"meters"},Jq={hasIntrinsicColor:!1};let Qq=class O5 extends iD{get geometries(){return this._geometries}get transformation(){return this._transformation??dd}set transformation(fe){this._transformation=n$48(this._transformation??[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fe),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(fe){this._shaderTransformation=fe?n$48(this._shaderTransformation??[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fe):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(fe={}){super(),this.type=eD.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=fe.castShadow??!0,this.usesVerticalDistanceToGround=fe.usesVerticalDistanceToGround??!1,this.graphicUid=fe.graphicUid,this.layerUid=fe.layerUid,fe.isElevationSource&&(this.lastValidElevationBB=new Kq),this._geometries=fe.geometries?Array.from(fe.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(fe){s$31(null==this._parentLayer||null==fe,"Object3D can only be added to a single Layer"),this._parentLayer=fe}addGeometry(fe){fe.visible=this._visible,this._geometries.push(fe),this._emit("geometryAdded",{object:this,geometry:fe}),this._invalidateBoundingVolume()}removeGeometry(fe){const ve=this._geometries.splice(fe,1)[0];ve&&(this._emit("geometryRemoved",{object:this,geometry:ve}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(fe,ve,_e=!1){this._emit("attributesChanged",{object:this,geometry:fe,attribute:ve,sync:_e}),E$1j(ve)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(fe){if(this._visible!==fe){this._visible=fe;for(const fe of this._geometries)fe.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const fe=new uD(xA.MaskOccludee);for(const ve of this._geometries)ve.occludees=n$2P(ve.occludees,fe);return this._emit("occlusionChanged",this),fe}removeOcclude(fe){for(const ve of this._geometries)ve.occludees=r$2f(ve.occludees,fe);this._emit("occlusionChanged",this)}highlight(){const fe=new uD(xA.Highlight);for(const ve of this._geometries)ve.highlights=n$2P(ve.highlights,fe);return this._emit("highlightChanged",this),fe}removeHighlight(fe){for(const ve of this._geometries)ve.highlights=r$2f(ve.highlights,fe);this._emit("highlightChanged",this)}getCombinedStaticTransformation(fe,ve){return c$4k(ve,this.transformation,fe.transformation)}getCombinedShaderTransformation(fe,ve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return c$4k(ve,this.effectiveTransformation,fe.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new eW,this._validateBoundingVolume(this._bvWorldSpace,sW.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new eW,this._validateBoundingVolume(this._bvObjectSpace,sW.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(fe,ve){const _e=ve===sW.ObjectSpace;for(const be of this._geometries){const ve=be.boundingInfo;ve&&L$z(ve,fe,_e?be.transformation:this.getCombinedShaderTransformation(be))}A$1G(fe.bounds,fe.min,fe.max,.5);for(const be of this._geometries){const ve=be.boundingInfo;if(null==ve)continue;const we=_e?be.transformation:this.getCombinedShaderTransformation(be),Se=m$3g(we);O$1v(nW,ve.center,we);const Te=x$1W(nW,fe.bounds),Ee=ve.radius*Se;fe.bounds[3]=Math.max(fe.bounds[3],Te+Ee)}}_invalidateBoundingVolume(){var fe;const ve=null==(fe=this._bvWorldSpace)?void 0:fe.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&ve&&this._parentLayer.notifyObjectBBChanged(this,ve)}_emit(fe,ve){this._parentLayer&&this._parentLayer.events.emit(fe,ve)}get test(){}},Kq=class A8{constructor(){this.min=r$3y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=r$3y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},eW=class M4 extends Kq{constructor(){super(...arguments),this.bounds=[0,0,0,0]}};function L$z(fe,ve,_e){const be=fe.bbMin,we=fe.bbMax;if(H$12(_e)){const fe=o$44(tW,_e[12],_e[13],_e[14]);u$3Y(rW,be,fe),u$3Y(iW,we,fe);for(let _e=0;_e<3;++_e)ve.min[_e]=Math.min(ve.min[_e],rW[_e]),ve.max[_e]=Math.max(ve.max[_e],iW[_e])}else if(O$1v(rW,be,_e),G$$(be,we))for(let Se=0;Se<3;++Se)ve.min[Se]=Math.min(ve.min[Se],rW[Se]),ve.max[Se]=Math.max(ve.max[Se],rW[Se]);else{O$1v(iW,we,_e);for(let fe=0;fe<3;++fe)ve.min[fe]=Math.min(ve.min[fe],rW[fe],iW[fe]),ve.max[fe]=Math.max(ve.max[fe],rW[fe],iW[fe]);for(let fe=0;fe<3;++fe){r$3w(rW,be),r$3w(iW,we),rW[fe]=we[fe],iW[fe]=be[fe],O$1v(rW,rW,_e),O$1v(iW,iW,_e);for(let fe=0;fe<3;++fe)ve.min[fe]=Math.min(ve.min[fe],rW[fe],iW[fe]),ve.max[fe]=Math.max(ve.max[fe],rW[fe],iW[fe])}}}const tW=[0,0,0],rW=[0,0,0],iW=[0,0,0],nW=[0,0,0];var sW;function a$2e(fe,ve,_e,be,we){if(u$1S(fe,ve))return null;_e.localOrigin=d$1v(fe,ve);const Se=new Qq({geometries:[_e],castShadow:!1,layerUid:fe.layer.uid,graphicUid:we,usesVerticalDistanceToGround:!0});return{object:Se,sampledElevation:p$2s(Se,ve,fe.elevationProvider,fe.renderCoordsHelper,be)}}function p$2j(fe,ve,_e,be){return u$1S(ve,_e)?null:p$2s(fe,_e,ve.elevationProvider,ve.renderCoordsHelper,be)}function u$1S(fe,ve){const _e=fe.clippingExtent;return!!_e&&(c$4l(ve,oW,fe.elevationProvider.spatialReference),!y$1M(_e,oW))}function m$1M(fe,ve,_e){const be=fe.elevationContext,we=_e.spatialReference;c$4l(ve,oW,we),be.centerPointInElevationSR=e$3y(oW[0],oW[1],ve.hasZ?oW[2]:0,null!=we?we:null)}function f$1x(fe){switch(fe.type){case"point":return fe;case"polygon":case"extent":return b$13(fe);case"polyline":{const ve=fe.paths[0];if(!ve||0===ve.length)return null;const _e=p$4P(ve,h$2L(ve)/2);return e$3y(_e[0],_e[1],_e[2],fe.spatialReference)}case"mesh":return fe.origin}return null}function d$1v(fe,ve){return c$4l(ve,oW,fe.renderCoordsHelper.spatialReference),fe.localOriginFactory.getOrigin(oW)}!function(fe){fe[fe.WorldSpace=0]="WorldSpace",fe[fe.ObjectSpace=1]="ObjectSpace"}(sW||(sW={}));const oW=[0,0,0];function n$2p(){return new Float32Array(2)}function t$22(fe,ve){const _e=new Float32Array(2);return _e[0]=fe,_e[1]=ve,_e}function o$1C(){return n$2p()}function u$1R(){return t$22(1,1)}function c$2b(){return t$22(1,0)}function a$2d(){return t$22(0,1)}const aW=o$1C(),lW=u$1R(),cW=c$2b(),uW=a$2d();function S$Y(fe){const ve=new gO,{vertex:_e,fragment:be}=ve;return _e.include(o$1W),ve.include(d$1M,fe),ve.include(P$H,fe),ve.attributes.add(nO.UV0,"vec2"),_e.uniforms.add(new hO("viewport",((fe,ve)=>ve.camera.fullViewport)),new dO("lineSize",((fe,ve)=>fe.size>0?Math.max(1,fe.size)*ve.camera.pixelRatio:0)),new lO("pixelToNDC",((fe,ve)=>o$2R(hW,2/ve.camera.fullViewport[2],2/ve.camera.fullViewport[3]))),new dO("borderSize",((fe,ve)=>null!=fe.borderColor?ve.camera.pixelRatio:0)),new lO("screenOffset",((fe,ve)=>o$2R(hW,fe.horizontalScreenOffset*ve.camera.pixelRatio,0)))),ve.varyings.add("coverageSampling","vec4"),ve.varyings.add("lineSizes","vec2"),fe.multipassEnabled&&ve.varyings.add("depth","float"),fe.occlusionTestEnabled&&ve.include(t$2j),fe.hasScreenSizePerspective&&o$1Y(_e),_e.code.add(o$2P`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${fe.occlusionTestEnabled?o$2P`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${fe.hasScreenSizePerspective?o$2P`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:o$2P`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${fe.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${fe.depthHudEnabled?fe.depthHudAlignStartEnabled?o$2P`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:o$2P`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${fe.hasScreenSizePerspective?o$2P`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:o$2P`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),be.uniforms.add(new hO("uColor",(fe=>m$1L(fe.color))),new hO("borderColor",(fe=>m$1L(fe.borderColor)))),fe.multipassEnabled&&(be.include(r$2m,fe),be.uniforms.add(new lO("inverseViewport",((fe,ve)=>ve.inverseViewport)))),be.code.add(o$2P`
    void main() {
      ${fe.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${fe.depthHudEnabled?o$2P`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:o$2P`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),ve}function m$1L(fe){return null!=fe?fe:_d}Object.freeze(Object.defineProperty({__proto__:null,ONES:lW,UNIT_X:cW,UNIT_Y:uW,ZEROS:aW,clone:function r$1N(fe){const ve=new Float32Array(2);return ve[0]=fe[0],ve[1]=fe[1],ve},create:n$2p,createView:function e$1Z(fe,ve){return new Float32Array(fe,ve,2)},fromValues:t$22,ones:u$1R,unitX:c$2b,unitY:a$2d,zeros:o$1C},Symbol.toStringTag,{value:"Module"}));const hW=[0,0],dW=Object.freeze(Object.defineProperty({__proto__:null,build:S$Y},Symbol.toStringTag,{value:"Module"}));let pW=class h11 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global}initializeProgram(fe){return new gA(fe.rctx,h11.shader.get().build(this.configuration),mA)}setPipelineState(fe){const ve=fe?jO.ALWAYS:jO.LESS;return this.configuration.depthHudEnabled?S$1g({depthTest:{func:ve},depthWrite:OA}):S$1g({blending:l$2_(FO.ONE,FO.SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),depthTest:{func:ve},colorWrite:AA})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};pW.shader=new LO(dW,(()=>zt((()=>Promise.resolve().then((()=>lRe))),void 0)));let fW=class s36 extends GI{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};e$4o([r$2w()],fW.prototype,"screenCenterOffsetUnitsEnabled",void 0),e$4o([r$2w()],fW.prototype,"spherical",void 0),e$4o([r$2w()],fW.prototype,"occlusionTestEnabled",void 0),e$4o([r$2w()],fW.prototype,"hasVerticalOffset",void 0),e$4o([r$2w()],fW.prototype,"hasScreenSizePerspective",void 0),e$4o([r$2w()],fW.prototype,"depthHudEnabled",void 0),e$4o([r$2w()],fW.prototype,"depthHudAlignStartEnabled",void 0),e$4o([r$2w()],fW.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],fW.prototype,"multipassEnabled",void 0),e$4o([r$2w({constValue:!0})],fW.prototype,"hasSliceInVertexProgram",void 0),e$4o([r$2w({constValue:!1})],fW.prototype,"draped",void 0);let mW=class m18 extends QB{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(fe){super(fe,new gW),this.produces=new Map([[qR.LINE_CALLOUTS,fe=>fe===NI.Color],[qR.LINE_CALLOUTS_HUD_DEPTH,fe=>fe===NI.Color]]),this._configuration=new fW,this._uniqueMaterialIdentifier=m18.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(fe,ve){const _e=(null==ve?void 0:ve.slot)!==qR.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.depthHudEnabled=_e,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration}intersect(){}createGLMaterial(fe){return new yW(fe)}createBufferWriter(){return new $W}validateParameters(fe){const ve=m18.uniqueMaterialIdentifier(fe);ve!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=ve)}static uniqueMaterialIdentifier({renderOccluded:fe,isDecoration:ve,horizontalScreenOffset:_e,color:be,size:we,occlusionTest:Se,shaderPolygonOffset:Te,depthHUDAlignStart:Ee,centerOffsetUnits:Ce,hasSlicePlane:Oe,screenSizePerspective:Re,verticalOffset:De,borderColor:Be}){return f$3y`${fe}:${ve}:${_e}:[${be}]:${we}:${Se}:${Te}:${Ee}:${Ce}:${Oe}:${null!=Re}:{${De.screenLength}:${De.minWorldLength}:${De.maxWorldLength}}:[${Be}]`}},yW=class p24 extends pM{beginSlot(fe){return this.ensureTechnique(pW,fe)}},gW=class g9 extends tj{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const vW=H$J().vec3f(nO.POSITION).vec3f(nO.NORMAL).vec2f(nO.UV0).vec4f(nO.CENTEROFFSETANDDISTANCE),_W=[t$22(0,0),t$22(1,0),t$22(0,1),t$22(1,0),t$22(1,1),t$22(0,1)];let $W=class b9{constructor(){this.vertexBufferLayout=vW}elementCount(fe){return 6*fe.attributes.get(nO.POSITION).indices.length}write(fe,ve,_e,be,we){b$19(_e.attributes.get(nO.POSITION),fe,be.position,we,6),O$N(_e.attributes.get(nO.NORMAL),ve,be.normal,we,6),p$2y(_e.attributes.get(nO.CENTEROFFSETANDDISTANCE),be.centerOffsetAndDistance,we,6);for(let Se=0;Se<_W.length;++Se)be.uv0.setVec(we+Se,_W[Se])}},bW=class E6 extends Yq{constructor(fe,ve){super(fe,null,ve,SW),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new mW(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(fe){const ve=this._materialParameters;return ve.horizontalScreenOffset=fe.horizontalScreenOffset??0,ve.centerOffsetUnits=fe.centerOffsetUnits||"world",ve}get _materialParameters(){var fe;const ve=new gW,_e=this.symbol,be=_e.callout;if(ve.color=null!=be.color?b_.toUnitRGBA(be.color):[0,0,0,0],ve.color[3]*=this._getLayerOpacity(),ve.size=u$3E(be.size||0),_e.verticalOffset){const{screenLength:fe,minWorldLength:be,maxWorldLength:we}=_e.verticalOffset;ve.verticalOffset={screenLength:u$3E(fe),minWorldLength:be||0,maxWorldLength:null!=we?we:1/0}}ve.borderColor=null!=(null==(fe=be.border)?void 0:fe.color)?b_.toUnitRGBA(be.border.color):null;const we="object"===_e.symbolLayers.at(0).type,Se="label-3d"===_e.type;return ve.occlusionTest=!we,ve.shaderPolygonOffset=we?0:void 0,ve.depthHUDAlignStart=Se,ve.hasSlicePlane=this._context.slicePlaneEnabled,ve.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,ve}_defaultElevationInfoNoZ(){return xW}createGraphics3DGraphic(fe){const ve=fe.renderingInfo,_e=fe.graphic,be=this.setGraphicElevationContext(_e,new VG,ve.elevationOffset||0),we=ve.symbol,Se="on-the-ground"===this._elevationContext.mode&&("cim"===we.type||!we.symbolLayers.some((fe=>"object"===fe.type||"text"===fe.type)));if("label-3d"!==we.type&&Se)return null;if("point-3d"===we.type&&we.symbolLayers.every((fe=>"text"===fe.type&&!l$3d(fe))))return null;const Te=b$13(_e.geometry);return null==Te?null:this._createAs3DShape(Te,be,ve,_e.uid)}layerOpacityChanged(){var fe;null==(fe=this._materials[0])||fe.setParameters(this._materialParameters)}layerElevationInfoChanged(fe,ve,_e){const be=this._elevationContext.mode,we=m$1X(E6.elevationModeChangeTypes,_e,be);return we!==EG.UPDATE||fe.forEach((fe=>{const _e=ve(fe);null!=_e&&this.updateGraphicElevationContext(fe.graphic,_e)})),we}slicePlaneEnabledChanged(){var fe;return null==(fe=this._materials[0])||fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(fe,ve,_e=0){return super.setGraphicElevationContext(fe,ve),ve.addOffsetRenderUnits(_e),ve}updateGraphicElevationContext(fe,ve){this.setGraphicElevationContext(fe,ve.elevationContext,null!=ve.metadata?ve.metadata.elevationOffset:0),ve.needsElevationUpdates=d$1F(ve.elevationContext.mode)}computeComplexity(){return new sH({verticesPerFeature:6})}_getOrCreateMaterial(fe){var ve;const _e=this._perInstanceMaterialParameters(fe),be=mW.uniqueMaterialIdentifier(_e);if(be===(null==(ve=this._materials[0])?void 0:ve.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(null!=fe.materialCollection){let ve=fe.materialCollection.get(be);return null==ve&&(ve=new mW(_e),fe.materialCollection.add(be,ve)),{material:ve,isUnique:!1}}return{material:new mW(_e),isUnique:!0}}_createAs3DShape(fe,ve,_e,be){const we=this._context.layer.uid,Se=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:be,layerUid:we}),Te=this._getOrCreateMaterial(_e),Ee=new pD(Te.material,function j$S(fe){const{translation:ve,centerOffset:_e}=fe,be=new Om(ve?[ve[0],ve[1],ve[2]]:[0,0,0],wW,3,!0),we=new Om(_e?[_e[0],_e[1],_e[2],_e[3]]:[0,0,0,1],wW,4,!0);return[[nO.POSITION,be],[nO.NORMAL,new Om([0,0,1],wW,3,!0)],[nO.CENTEROFFSETANDDISTANCE,we]]}(_e),null,eD.Point,Se),Ce=a$2e(this._context,fe,Ee,ve,be);if(null==Ce)return null;const Oe=new qG(this,Ce.object,[Ee],Te.isUnique?[Te.material]:null,null,p$2r,ve);return Oe.metadata=new JG(_e.elevationOffset),Oe.alignedSampledElevation=Ce.sampledElevation,Oe.needsElevationUpdates=d$1F(ve.mode),m$1M(Oe,fe,this._context.elevationProvider),Oe}};bW.elevationModeChangeTypes={definedChanged:EG.UPDATE,staysOnTheGround:EG.UPDATE,onTheGroundChanged:EG.RECREATE};const wW=[0],xW={mode:"relative-to-ground",offset:0},SW={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let TW=class G4{constructor(fe,ve,_e=[0,0,0],be=[0,0,0,0],we=0,Se="world",Te=0,Ee=null){this.renderer=fe,this.symbol=ve,this.translation=_e,this.centerOffset=be,this.horizontalScreenOffset=we,this.centerOffsetUnits=Se,this.elevationOffset=Te,this.materialCollection=Ee}};const t$21=()=>ar.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function e$1Y(fe,ve){if(!o$33(fe))return t$21().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${fe.type}' does not support callouts`),null;if(!fe.callout)return null;const _e=EW[fe.callout.type];return _e?new _e(fe,ve):(t$21().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${fe.callout.type}`),null)}const EW={line:bW};function s$2b(fe){return fe?{originPosition:"upper-left"===fe.originPosition?"upperLeft":"lower-left"===fe.originPosition?"lowerLeft":fe.originPosition,scale:fe.tolerance?[fe.tolerance,fe.tolerance,1,1]:[1,1,1,1],translate:null!=fe.extent?[fe.extent.xmin,fe.extent.ymax,fe.extent.zmin??0,fe.extent.mmin??0]:[0,0,0,0]}:null}function u$1Q(fe){if(function l$2e(fe){return"lowerLeft"===fe.originPosition&&4===fe.scale.length&&4===fe.translate.length}(fe))return fe;const{originPosition:ve,scale:_e,translate:be}=fe,we=_e[0]??1,Se=_e[1]??1;return{originPosition:"lowerLeft",scale:[we,"lowerLeft"===ve?Se:-Se,_e[2]??1,_e[3]??1],translate:[be[0]??0,be[1]??0,be[2]??0,be[3]??0]}}function Z$k({scale:fe,translate:ve},_e){return _e*fe[0]+ve[0]}function y$16({scale:fe,translate:ve},_e){return _e*fe[1]+ve[1]}function z$x({scale:fe,translate:ve},_e){return(_e??0)*fe[2]+ve[2]}function w$10({scale:fe,translate:ve},_e){return _e?_e*fe[3]+ve[3]:0}function P$C(fe,ve){return fe&&ve?A$O:fe&&!ve?E$O:!fe&&ve?L$y:T$G}const T$G=(fe,ve)=>{const _e=new Array(ve.length);if(!ve.length)return _e;const be=ve[0];let we=Z$k(fe,be[0]),Se=y$16(fe,be[1]);_e[0]=[we,Se];const{scale:Te,originPosition:Ee}=fe,Ce=Te[0],Oe="lowerLeft"===Ee?Te[1]:-Te[1];for(let Re=1;Re<ve.length;Re++){const[fe,be]=ve[Re];we+=Ce*fe,Se+=Oe*be,_e[Re]=[we,Se]}return _e},E$O=(fe,ve)=>{const _e=new Array(ve.length);if(!ve.length)return _e;const be=ve[0];let we=Z$k(fe,be[0]),Se=y$16(fe,be[1]);_e[0]=[we,Se,z$x(fe,be[2])];const{scale:Te,originPosition:Ee}=fe,Ce=Te[0],Oe="lowerLeft"===Ee?Te[1]:-Te[1];for(let Re=1;Re<ve.length;Re++){const[be,Te,Ee]=ve[Re];we+=Ce*be,Se+=Oe*Te,_e[Re]=[we,Se,z$x(fe,Ee)]}return _e},L$y=(fe,ve)=>{const _e=new Array(ve.length);if(!ve.length)return _e;const be=ve[0];let we=Z$k(fe,be[0]),Se=y$16(fe,be[1]);_e[0]=[we,Se,w$10(fe,be[2])];const{scale:Te,originPosition:Ee}=fe,Ce=Te[0],Oe="lowerLeft"===Ee?Te[1]:-Te[1];for(let Re=1;Re<ve.length;Re++){const[be,Te,Ee]=ve[Re];we+=Ce*be,Se+=Oe*Te,_e[Re]=[we,Se,w$10(fe,Ee)]}return _e},A$O=(fe,ve)=>{const _e=new Array(ve.length);if(!ve.length)return _e;const be=ve[0];let we=Z$k(fe,be[0]),Se=y$16(fe,be[1]);_e[0]=[we,Se,z$x(fe,be[2]),w$10(fe,be[3])];const{scale:Te,originPosition:Ee}=fe,Ce=Te[0],Oe="lowerLeft"===Ee?Te[1]:-Te[1];for(let Re=1;Re<ve.length;Re++){const[be,Te,Ee,De]=ve[Re];we+=Ce*be,Se+=Oe*Te,_e[Re]=[we,Se,z$x(fe,Ee),w$10(fe,De)]}return _e};function b$$(fe,ve,_e){const be=new Array(_e.length);for(let we=0;we<_e.length;we++)be[we]=ve(fe,_e[we]);return be}function j$R(fe,ve,_e){const be=u$1Q(fe);return ve.x=function i$2a({scale:fe,translate:ve},_e){return Math.round((_e-ve[0])/fe[0])}(be,_e.x),ve.y=function a$2b({scale:fe,translate:ve},_e){return Math.round((_e-ve[1])/fe[1])}(be,_e.y),null!=_e.z&&(ve.z=function c$2a({scale:fe,translate:ve},_e){return Math.round(((_e??0)-ve[2])/fe[2])}(be,_e.z)),null!=_e.m&&(ve.m=function h$1k({scale:fe,translate:ve},_e){return _e?Math.round((_e-ve[3])/fe[3]):0}(be,_e.m)),ve}function B$q(fe,ve,_e,be=(null==_e?void 0:_e.hasZ)??!1,we=(null==_e?void 0:_e.hasM)??!1){if(null!=_e){const Se=u$1Q(fe);ve.points=P$C(be,we)(Se,_e.points),ve.hasZ=be,ve.hasM=we}return ve}function C$K(fe,ve,_e,be=null!=(null==_e?void 0:_e.z),we=null!=(null==_e?void 0:_e.m)){if(null==_e)return ve;const Se=u$1Q(fe);return ve.x=Z$k(Se,_e.x),ve.y=y$16(Se,_e.y),be&&(ve.z=z$x(Se,_e.z)),we&&(ve.m=w$10(Se,_e.m)),ve}function D$C(fe,ve,_e,be=(null==_e?void 0:_e.hasZ)??!1,we=(null==_e?void 0:_e.hasM)??!1){if(null!=_e){const Se=u$1Q(fe);ve.rings=b$$(Se,P$C(be,we),_e.rings),ve.hasZ=be,ve.hasM=we}return ve}function H$u(fe,ve,_e,be=(null==_e?void 0:_e.hasZ)??!1,we=(null==_e?void 0:_e.hasM)??!1){if(null!=_e){const Se=u$1Q(fe);ve.paths=b$$(Se,P$C(be,we),_e.paths),ve.hasZ=be,ve.hasM=we}return ve}let PW=class f9{constructor(fe,ve,_e){this.uid=fe,this.geometry=ve,this.attributes=_e,this.visible=!0,this.objectId=null,this.centroid=null}};function y$15(fe){return null!=fe.geometry}let CW=class g10{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function b$_(fe,ve){var _e;const be=Ea.fromJSON(fe.geometryType),we=zo.fromJSON(fe.spatialReference),Se=fe.transform,Te=fe.objectIdFieldName,Ee=null==ve?void 0:ve.maxStringAttributeLength,Ce=null==ve?void 0:ve.maxStringAttributeFields;let Oe;const Re=fe.features.map((ve=>{const _e=function d$1u(fe,ve,_e,be){return{uid:e$44(),objectId:be&&fe.attributes?fe.attributes[be]:null,attributes:fe.attributes,geometry:x$N(fe.geometry,ve,_e),visible:!0}}(ve,be,we,fe.objectIdFieldName),Re=_e.geometry;if(z$w(_e.attributes,Ce,Ee,(fe=>{Oe??(Oe=[]);const ve=M$K(_e,Te);null!=ve&&Oe.push({objectId:ve,attribute:fe})})),null!=Re&&Se)switch(Re.type){case"point":_e.geometry=C$K(Se,Re,Re);break;case"multipoint":_e.geometry=B$q(Se,Re,Re);break;case"polygon":_e.geometry=D$C(Se,Re,Re);break;case"polyline":_e.geometry=H$u(Se,Re,Re);break;case"extent":case"mesh":_e.geometry=Re}return _e}));return{geometryType:be,features:Re,spatialReference:we,fields:(null==(_e=fe.fields)?void 0:_e.map((fe=>oE.fromJSON(fe))))??[],objectIdFieldName:fe.objectIdFieldName,globalIdFieldName:fe.globalIdFieldName,geohashFieldName:fe.geohashFieldName,geometryProperties:fe.geometryProperties,hasZ:fe.hasZ,hasM:fe.hasM,exceededTransferLimit:fe.exceededTransferLimit,transform:null,missingAttributes:Oe}}function x$N(fe,ve,_e){if(null==fe)return null;switch(ve){case"point":{const ve=fe;return{x:ve.x,y:ve.y,z:ve.z,m:ve.m,hasZ:null!=ve.z,hasM:null!=ve.m,type:"point",spatialReference:_e}}case"polyline":{const ve=fe;return{paths:ve.paths,hasZ:!!ve.hasZ,hasM:!!ve.hasM,type:"polyline",spatialReference:_e}}case"polygon":{const ve=fe;return{rings:ve.rings,hasZ:!!ve.hasZ,hasM:!!ve.hasM,type:"polygon",spatialReference:_e}}case"multipoint":{const ve=fe;return{points:ve.points,hasZ:!!ve.hasZ,hasM:!!ve.hasM,type:"multipoint",spatialReference:_e}}}}function Z$j(fe){let ve=32;return ve+=t$4u(fe.attributes),ve+=3,ve+=8+function j$Q(fe){if(null==fe)return 0;let ve=32;switch(fe.type){case"point":ve+=42;break;case"polyline":case"polygon":{let _e=0;const be=2+(fe.hasZ?1:0)+(fe.hasM?1:0),we="polyline"===fe.type?fe.paths:fe.rings;for(const fe of we)_e+=fe.length;ve+=8*_e*be+64,ve+=128*_e,ve+=34,ve+=32*(we.length+1);break}case"multipoint":{const _e=2+(fe.hasZ?1:0)+(fe.hasM?1:0),be=fe.points.length;ve+=8*be*_e+64,ve+=128*be,ve+=34,ve+=32;break}case"extent":ve+=98,fe.hasM&&(ve+=32),fe.hasZ&&(ve+=32);break;case"mesh":ve+=A$1L(fe.vertexAttributes.position,fe.vertexAttributes.normal,fe.vertexAttributes.uv,fe.vertexAttributes.tangent)}return ve}(fe.geometry),ve}function k$G(fe){if(null==fe)return 0;switch(fe.type){case"point":return 1;case"polyline":{let ve=0;for(const _e of fe.paths)ve+=_e.length;return ve}case"polygon":{let ve=0;for(const _e of fe.rings)ve+=_e.length;return ve}case"multipoint":return fe.points.length;case"extent":return 2;case"mesh":{const ve=fe.vertexAttributes&&fe.vertexAttributes.position;return ve?ve.length/3:0}default:return}}function N$C(fe){if(null==fe)return!1;switch(fe.type){case"extent":case"point":return!0;case"polyline":for(const ve of fe.paths)if(ve.length>0)return!0;return!1;case"polygon":for(const ve of fe.rings)if(ve.length>0)return!0;return!1;case"multipoint":return fe.points.length>0;case"mesh":return!fe.loaded||fe.vertexAttributes.position.length>0}}function F$z(fe,ve){switch(P$$(ve),"mesh"===fe.type&&(fe=fe.extent),fe.type){case"point":ve[0]=ve[3]=fe.x,ve[1]=ve[4]=fe.y,fe.hasZ&&(ve[2]=ve[5]=fe.z);break;case"polyline":for(let _e=0;_e<fe.paths.length;_e++)x$1i(ve,fe.paths[_e],!!fe.hasZ);break;case"polygon":for(let _e=0;_e<fe.rings.length;_e++)x$1i(ve,fe.rings[_e],!!fe.hasZ);break;case"multipoint":x$1i(ve,fe.points,!!fe.hasZ);break;case"extent":ve[0]=fe.xmin,ve[1]=fe.ymin,ve[3]=fe.xmax,ve[4]=fe.ymax,null!=fe.zmin&&(ve[2]=fe.zmin),null!=fe.zmax&&(ve[5]=fe.zmax)}}function M$K(fe,ve){return null!=fe.objectId?fe.objectId:fe.attributes&&ve?fe.attributes[ve]:null}function z$w(fe,ve,_e,be){if((null==ve?void 0:ve.size)&&null!=_e&&fe)for(const we in fe){if(!ve.has(we))continue;const Se=fe[we];"string"==typeof Se&&Se.length>_e&&(be(we),fe[we]="")}}let OW=class e31{constructor(fe=[],ve=[],_e=!1){this.lengths=fe??[],this.coords=ve??[],this.hasIndeterminateRingOrder=_e}static fromJSON(fe){return new e31(fe.lengths,fe.coords,fe.hasIndeterminateRingOrder)}static fromRect(fe){const[ve,_e,be,we]=fe,Se=be-ve,Te=we-_e;return new e31([5],[ve,_e,Se,0,0,Te,-Se,0,0,-Te])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((fe,ve)=>fe+ve))}forEachVertex(fe){let ve=0;this.lengths.length||fe(this.coords[0],this.coords[1]);for(let _e=0;_e<this.lengths.length;_e++){const be=this.lengths[_e];for(let _e=0;_e<be;_e++)fe(this.coords[2*(_e+ve)],this.coords[2*(_e+ve)+1]);ve+=be}}deltaDecode(){const fe=this.clone(),{coords:ve,lengths:_e}=fe;let be=0;for(const we of _e){for(let fe=1;fe<we;fe++)ve[2*(be+fe)]+=ve[2*(be+fe)-2],ve[2*(be+fe)+1]+=ve[2*(be+fe)-1];be+=we}return fe}clone(fe){if(0===this.lengths.length)return new e31([],[this.coords[0],this.coords[1]]);const ve=2*(0===this.lengths.length?1:this.lengths.reduce(((fe,ve)=>fe+ve))),_e=this.coords.slice(0,ve);return fe?(fe.set(_e),new e31(this.lengths,fe,this.hasIndeterminateRingOrder)):new e31(Array.from(this.lengths),Array.from(_e),this.hasIndeterminateRingOrder)}},AW=class e32{constructor(fe=null,ve={},_e,be){this.geometry=fe,this.attributes=ve,this.centroid=_e,this.objectId=be,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(fe,ve){const _e=fe.geometry?OW.fromJSON(fe.geometry):null,be=fe.centroid?OW.fromJSON(fe.centroid):null,we=fe.attributes[ve];return new e32(_e,fe.attributes,be,we)}weakClone(){const fe=new e32(this.geometry,this.attributes,this.centroid,this.objectId);return fe.displayId=this.displayId,fe.geohashX=this.geohashX,fe.geohashY=this.geohashY,fe}clone(){var fe,ve;const _e=null==(fe=this.geometry)?void 0:fe.clone(),be=new e32(_e,{...this.attributes},null==(ve=this.centroid)?void 0:ve.clone(),this.objectId);return be.displayId=this.displayId,be.geohashX=this.geohashX,be.geohashY=this.geohashY,be}};function s$2a(fe){var ve,_e;return!!(null==(_e=null==(ve=fe.geometry)?void 0:ve.coords)?void 0:_e.length)}let MW=class e33{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const fe=new e33;return fe.objectIdFieldName=this.objectIdFieldName,fe.globalIdFieldName=this.globalIdFieldName,fe.geohashFieldName=this.geohashFieldName,fe.geometryProperties=this.geometryProperties,fe.geometryType=this.geometryType,fe.spatialReference=this.spatialReference,fe.hasZ=this.hasZ,fe.hasM=this.hasM,fe.features=this.features,fe.fields=this.fields,fe.transform=this.transform,fe.exceededTransferLimit=this.exceededTransferLimit,fe.uniqueIdField=this.uniqueIdField,fe.queryGeometry=this.queryGeometry,fe.queryGeometryType=this.queryGeometryType,fe}};function d$1t(fe,ve){return fe?ve?4:3:ve?3:2}const m$1J=()=>ar.getLogger("esri.layers.graphics.featureConversionUtils"),RW={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},y$14=(fe,ve,_e,be,we,Se)=>{fe[_e]=we,fe[_e+1]=Se},p$2h=(fe,ve,_e,be,we,Se)=>{fe[_e]=we,fe[_e+1]=Se,fe[_e+2]=ve[be+2]},I$L=(fe,ve,_e,be,we,Se)=>{fe[_e]=we,fe[_e+1]=Se,fe[_e+2]=ve[be+3]},b$Z=(fe,ve,_e,be,we,Se)=>{fe[_e]=we,fe[_e+1]=Se,fe[_e+2]=ve[be+2],fe[_e+3]=ve[be+3]};function M$J(fe,ve,_e,be){if(fe){if(_e)return ve&&be?b$Z:p$2h;if(ve&&be)return I$L}else if(ve&&be)return p$2h;return y$14}function N$B({scale:fe,translate:ve},_e){return Math.round((_e-ve[0])/fe[0])}function w$$({scale:fe,translate:ve},_e){return Math.round((ve[1]-_e)/fe[1])}function F$y({scale:fe,translate:ve},_e,be){return _e*fe[be]+ve[be]}function x$M(fe,ve,_e){return fe?ve?_e?k$F(fe):Z$i(fe):_e?v$Q(fe):P$B(fe):null}function P$B(fe){const ve=fe.coords;return{x:ve[0],y:ve[1]}}function j$P(fe,ve){return fe.coords[0]=ve.x,fe.coords[1]=ve.y,fe}function Z$i(fe){const ve=fe.coords;return{x:ve[0],y:ve[1],z:ve[2]}}function E$N(fe,ve){return fe.coords[0]=ve.x,fe.coords[1]=ve.y,fe.coords[2]=ve.z,fe}function v$Q(fe){const ve=fe.coords;return{x:ve[0],y:ve[1],m:ve[2]}}function z$v(fe,ve){return fe.coords[0]=ve.x,fe.coords[1]=ve.y,fe.coords[2]=ve.m,fe}function k$F(fe){const ve=fe.coords;return{x:ve[0],y:ve[1],z:ve[2],m:ve[3]}}function V$E(fe,ve){return fe.coords[0]=ve.x,fe.coords[1]=ve.y,fe.coords[2]=ve.z,fe.coords[3]=ve.m,fe}function _$J(fe,ve){return fe&&ve?V$E:fe?E$N:ve?z$v:j$P}function O$G(fe,ve,_e=_$J(null!=ve.z,null!=ve.m)){return _e(fe,ve)}function U$C(fe,ve,_e){if(null==fe)return null;const be=d$1t(ve,_e),we=[];for(let Se=0;Se<fe.coords.length;Se+=be){const ve=[];for(let _e=0;_e<be;_e++)ve.push(fe.coords[Se+_e]);we.push(ve)}return ve?_e?{points:we,hasZ:ve,hasM:_e}:{points:we,hasZ:ve}:_e?{points:we,hasM:_e}:{points:we}}function R$G(fe,ve,_e=d$1t(ve.hasZ,ve.hasM)){fe.lengths[0]=ve.points.length;const be=fe.coords;let we=0;for(const Se of ve.points)for(let fe=0;fe<_e;fe++)be[we++]=Se[fe];return fe}function $$k(fe,ve,_e){if(!fe)return null;const be=d$1t(ve,_e),{coords:we,lengths:Se}=fe,Te=[];let Ee=0;for(const Ce of Se){const fe=[];for(let ve=0;ve<Ce;ve++){const ve=[];for(let fe=0;fe<be;fe++)ve.push(we[Ee++]);fe.push(ve)}Te.push(fe)}return ve?_e?{paths:Te,hasZ:ve,hasM:_e}:{paths:Te,hasZ:ve}:_e?{paths:Te,hasM:_e}:{paths:Te}}function C$J(fe,ve,_e=d$1t(ve.hasZ,ve.hasM)){const{lengths:be,coords:we}=fe;let Se=0;for(const Te of ve.paths){for(const fe of Te)for(let ve=0;ve<_e;ve++)we[Se++]=fe[ve];be.push(Te.length)}return fe}function H$t(fe,ve,_e){if(!fe)return null;const be=d$1t(ve,_e),{coords:we,lengths:Se}=fe,Te=[];let Ee=0;for(const Ce of Se){const fe=[];for(let ve=0;ve<Ce;ve++){const ve=[];for(let fe=0;fe<be;fe++)ve.push(we[Ee++]);fe.push(ve)}Te.push(fe)}return ve?_e?{rings:Te,hasZ:ve,hasM:_e}:{rings:Te,hasZ:ve}:_e?{rings:Te,hasM:_e}:{rings:Te}}function K$j(fe,ve,_e=ve.hasZ,be=ve.hasM){return function Q$k(fe,ve,_e,be){const we=d$1t(_e,be),{lengths:Se,coords:Te}=fe;let Ee=0;wt$3(fe);for(const Ce of ve){for(const fe of Ce)for(let ve=0;ve<we;ve++)Te[Ee++]=fe[ve];Se.push(Ce.length)}return fe}(fe,ve.rings,_e,be)}const IW=[],LW=[];function tt$9(fe,ve,_e,be,we){IW[0]=fe;const[Se]=et$7(LW,IW,ve,_e,be,we);return Tt$4(IW),Tt$4(LW),Se}function et$7(fe,ve,_e,be,we,Se){if(Tt$4(fe),!_e){for(const _e of ve){const ve=Se?_e.attributes[Se]:void 0;fe.push(new AW(null,_e.attributes,null,ve))}return fe}switch(_e){case"esriGeometryPoint":return function L$x(fe,ve,_e,be,we){const Se=_$J(_e,be);for(const{geometry:Te,attributes:Ee}of ve){const ve=null!=Te?Se(new OW,Te):null;fe.push(new AW(ve,Ee,null,we?Ee[we]:void 0))}return fe}(fe,ve,be,we,Se);case"esriGeometryMultipoint":return function q$v(fe,ve,_e,be,we){const Se=d$1t(_e,be);for(const{geometry:Te,attributes:Ee}of ve){const ve=null!=Te?R$G(new OW,Te,Se):null;fe.push(new AW(ve,Ee,null,we?Ee[we]:void 0))}return fe}(fe,ve,be,we,Se);case"esriGeometryPolyline":return function B$p(fe,ve,_e,be,we){const Se=d$1t(_e,be);for(const{geometry:Te,attributes:Ee,centroid:Ce}of ve){const ve=null!=Te?C$J(new OW,Te,Se):null,_e=null!=Ce?O$G(new OW,Ce):null;fe.push(new AW(ve,Ee,_e,we?Ee[we]:void 0))}return fe}(fe,ve,be,we,Se);case"esriGeometryPolygon":return function J$j(fe,ve,_e,be,we){for(const{geometry:Se,centroid:Te,attributes:Ee}of ve){const ve=null!=Se?K$j(new OW,Se,_e,be):null,Ce=we?Ee[we]:void 0;null!=Te?fe.push(new AW(ve,Ee,j$P(new OW,Te),Ce)):fe.push(new AW(ve,Ee,null,Ce))}return fe}(fe,ve,be,we,Se);default:m$1J().error("convertToFeatureSet:unknown-geometry",new Ir(`Unable to parse unknown geometry type '${_e}'`)),Tt$4(fe)}return fe}function nt$8(fe,ve,_e,be){LW[0]=fe,ut$6(IW,LW,ve,_e,be);const we=IW[0];return Tt$4(IW),Tt$4(LW),we}function ot$8(fe,ve,_e){if(null==fe)return null;const be=new OW;return"hasZ"in fe&&null==ve&&(ve=fe.hasZ),"hasM"in fe&&null==_e&&(_e=fe.hasM),u$3F(fe)?_$J(null!=ve?ve:null!=fe.z,null!=_e?_e:null!=fe.m)(be,fe):f$2Z(fe)?K$j(be,fe,ve,_e):s$3_(fe)?C$J(be,fe,d$1t(ve,_e)):l$49(fe)?R$G(be,fe,d$1t(ve,_e)):void m$1J().error("convertFromGeometry:unknown-geometry",new Ir(`Unable to parse unknown geometry type '${fe}'`))}function rt$8(fe,ve,_e,be){const we=fe&&("coords"in fe?fe:fe.geometry);if(null==we)return null;switch(ve){case"esriGeometryPoint":{let fe=P$B;return _e&&be?fe=k$F:_e?fe=Z$i:be&&(fe=v$Q),fe(we)}case"esriGeometryMultipoint":return U$C(we,_e,be);case"esriGeometryPolyline":return $$k(we,_e,be);case"esriGeometryPolygon":return H$t(we,_e,be);default:return m$1J().error("convertToGeometry:unknown-geometry",new Ir(`Unable to parse unknown geometry type '${ve}'`)),null}}function ut$6(fe,ve,_e,be,we){if(Tt$4(fe),null==_e)return function st$9(fe,ve){for(const _e of ve)fe.push({attributes:_e.attributes});return fe}(fe,ve);switch(_e){case"esriGeometryPoint":return function Y$j(fe,ve,_e,be){let we=P$B;_e&&be?we=k$F:_e?we=Z$i:be&&(we=v$Q);for(const Se of ve){const{geometry:ve,attributes:_e}=Se,be=null!=ve?we(ve):null;fe.push({attributes:_e,geometry:be})}return fe}(fe,ve,be,we);case"esriGeometryMultipoint":return function S$V(fe,ve,_e,be){for(const{geometry:we,attributes:Se}of ve)fe.push({attributes:Se,geometry:null!=we?U$C(we,_e,be):null});return fe}(fe,ve,be,we);case"esriGeometryPolyline":return function A$N(fe,ve,_e,be){for(const{geometry:we,attributes:Se}of ve)fe.push({attributes:Se,geometry:null!=we?$$k(we,_e,be):null});return fe}(fe,ve,be,we);case"esriGeometryPolygon":return function D$B(fe,ve,_e,be){for(const{geometry:we,attributes:Se,centroid:Te}of ve){const ve=null!=we?H$t(we,_e,be):null;if(null!=Te){const _e=P$B(Te);fe.push({attributes:Se,centroid:_e,geometry:ve})}else fe.push({attributes:Se,geometry:ve})}return fe}(fe,ve,be,we);default:m$1J().error("convertToFeatureSet:unknown-geometry",new Ir(`Unable to parse unknown geometry type '${_e}'`))}return fe}function lt$7(fe){const{objectIdFieldName:ve,spatialReference:_e,transform:be,fields:we,hasM:Se,hasZ:Te,features:Ee,geometryType:Ce,exceededTransferLimit:Oe,uniqueIdField:Re,queryGeometry:De,queryGeometryType:Be}=fe,Ze={features:ut$6([],Ee,Ce,Te,Se),fields:we,geometryType:Ce,objectIdFieldName:ve,spatialReference:_e,uniqueIdField:Re,queryGeometry:rt$8(De,Be,!1,!1)};return be&&(Ze.transform=be),Oe&&(Ze.exceededTransferLimit=Oe),Se&&(Ze.hasM=Se),Te&&(Ze.hasZ=Te),Ze}function ct$6(fe,ve){const _e=new MW,{hasM:be,hasZ:we,features:Se,objectIdFieldName:Te,spatialReference:Ee,geometryType:Ce,exceededTransferLimit:Oe,transform:Re,fields:De}=fe;return De&&(_e.fields=De),_e.geometryType=Ce??null,_e.objectIdFieldName=Te??ve??null,_e.spatialReference=Ee??null,_e.objectIdFieldName?(Se&&et$7(_e.features,Se,Ce,we,be,_e.objectIdFieldName),Oe&&(_e.exceededTransferLimit=Oe),be&&(_e.hasM=be),we&&(_e.hasZ=we),Re&&(_e.transform=Re),_e):(m$1J().error(new Ir("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),_e)}function it$7(fe){const{transform:ve,features:_e,hasM:be,hasZ:we}=fe;if(!ve)return fe;for(const Se of _e)null!=Se.geometry&&pt$5(Se.geometry,Se.geometry,be,we,ve),null!=Se.centroid&&pt$5(Se.centroid,Se.centroid,be,we,ve);return fe.transform=null,fe}function ft$5(fe,ve){const{geometryType:_e,features:be,hasM:we,hasZ:Se}=ve;if(!fe)return ve;for(let Te=0;Te<be.length;Te++){const ve=be[Te],Ee=ve.weakClone();Ee.geometry=new OW,at$9(Ee.geometry,ve.geometry,we,Se,_e,fe),ve.centroid&&(Ee.centroid=new OW,at$9(Ee.centroid,ve.centroid,we,Se,"esriGeometryPoint",fe)),be[Te]=Ee}return ve.transform=fe,ve}function at$9(fe,ve,_e,be,we,Se,Te=_e,Ee=be){if(wt$3(fe),!(null==ve?void 0:ve.coords.length))return null;const Ce=RW[we],{coords:Oe,lengths:Re}=ve,De=d$1t(_e,be),Be=d$1t(_e&&Te,be&&Ee),Ze=M$J(_e,be,Te,Ee);if(!Re.length)return Ze(fe.coords,Oe,0,0,N$B(Se,Oe[0]),w$$(Se,Oe[1])),wt$3(fe,De,0),fe;let Xe,Je,Qe,dt,$t=0,bt=0,wt=bt;for(const xt of Re){if(xt<Ce)continue;let ve=0;bt=wt,Qe=Xe=N$B(Se,Oe[$t]),dt=Je=w$$(Se,Oe[$t+1]),Ze(fe.coords,Oe,bt,$t,Qe,dt),ve++,$t+=De,bt+=Be;for(let _e=1;_e<xt;_e++,$t+=De)Qe=N$B(Se,Oe[$t]),dt=w$$(Se,Oe[$t+1]),Qe===Xe&&dt===Je||(Ze(fe.coords,Oe,bt,$t,Qe-Xe,dt-Je),bt+=Be,ve++,Xe=Qe,Je=dt);ve>=Ce&&(fe.lengths.push(ve),wt=bt)}return Tt$4(fe.coords,wt),fe.coords.length?fe:null}function ht$7(fe,ve,_e,be,we,Se,Te=_e,Ee=be){if(wt$3(fe),!(null==ve?void 0:ve.coords.length))return null;const Ce=RW[we],{coords:Oe,lengths:Re}=ve,De=d$1t(_e,be),Be=d$1t(_e&&Te,be&&Ee),Ze=M$J(_e,be,Te,Ee);if(!Re.length)return Ze(fe.coords,Oe,0,0,Oe[0],Oe[1]),wt$3(fe,De,0),fe;let Xe=0;const Je=Se*Se;for(const Qe of Re){if(Qe<Ce){Xe+=Qe*De;continue}const ve=fe.coords.length/Be,_e=Xe,be=Xe+(Qe-1)*De;Ze(fe.coords,Oe,fe.coords.length,_e,Oe[_e],Oe[_e+1]),mt$4(fe.coords,Oe,De,Je,Ze,_e,be),Ze(fe.coords,Oe,fe.coords.length,be,Oe[be],Oe[be+1]);const we=fe.coords.length/Be-ve;we>=Ce?fe.lengths.push(we):Tt$4(fe.coords,ve*Be),Xe+=Qe*De}return fe.coords.length?fe:null}function dt$4(fe,ve,_e,be){const we=fe[ve],Se=fe[ve+1],Te=fe[_e],Ee=fe[_e+1],Ce=fe[be],Oe=fe[be+1];let Re=Te,De=Ee,Be=Ce-Re,Ze=Oe-De;if(0!==Be||0!==Ze){const fe=((we-Re)*Be+(Se-De)*Ze)/(Be*Be+Ze*Ze);fe>1?(Re=Ce,De=Oe):fe>0&&(Re+=Be*fe,De+=Ze*fe)}return Be=we-Re,Ze=Se-De,Be*Be+Ze*Ze}function mt$4(fe,ve,_e,be,we,Se,Te){let Ee,Ce=be,Oe=0;for(let Re=Se+_e;Re<Te;Re+=_e)Ee=dt$4(ve,Re,Se,Te),Ee>Ce&&(Oe=Re,Ce=Ee);Ce>be&&(Oe-Se>_e&&mt$4(fe,ve,_e,be,we,Se,Oe),we(fe,ve,fe.length,Oe,ve[Oe],ve[Oe+1]),Te-Oe>_e&&mt$4(fe,ve,_e,be,we,Oe,Te))}function gt$6(fe,ve,_e,be){var we;if(!(null==(we=null==ve?void 0:ve.coords)?void 0:we.length))return null;const Se=d$1t(_e,be);let Te=Number.POSITIVE_INFINITY,Ee=Number.POSITIVE_INFINITY,Ce=Number.NEGATIVE_INFINITY,Oe=Number.NEGATIVE_INFINITY;if(ve&&ve.coords){const fe=ve.coords;for(let ve=0;ve<fe.length;ve+=Se){const _e=fe[ve],be=fe[ve+1];Te=Math.min(Te,_e),Ce=Math.max(Ce,_e),Ee=Math.min(Ee,be),Oe=Math.max(Oe,be)}}return q$L(fe)?d$2A(fe,Te,Ee,Ce,Oe):a$4j(Te,Ee,Ce,Oe,fe),fe}function pt$5(fe,ve,_e,be,we){const{coords:Se,lengths:Te}=ve,Ee=d$1t(_e,be);if(!Se.length)return fe!==ve&&wt$3(fe),fe;n$4O(we);const{originPosition:Ce,scale:Oe,translate:Re}=we,De=DW;De.originPosition=Ce;const Be=De.scale;Be[0]=Oe[0]??1,Be[1]=-(Oe[1]??1),Be[2]=Oe[2]??1,Be[3]=Oe[3]??1;const Ze=De.translate;if(Ze[0]=Re[0]??0,Ze[1]=Re[1]??0,Ze[2]=Re[2]??0,Ze[3]=Re[3]??0,!Te.length){for(let ve=0;ve<Ee;++ve)fe.coords[ve]=F$y(De,Se[ve],ve);return fe!==ve&&wt$3(fe,Ee,0),fe}let Xe=0;for(let Je=0;Je<Te.length;Je++){const ve=Te[Je];fe.lengths[Je]=ve;for(let we=0;we<Ee;++we)fe.coords[Xe+we]=F$y(De,Se[Xe+we],we);let _e=fe.coords[Xe],be=fe.coords[Xe+1];Xe+=Ee;for(let we=1;we<ve;we++,Xe+=Ee){_e+=Se[Xe]*Be[0],be+=Se[Xe+1]*Be[1],fe.coords[Xe]=_e,fe.coords[Xe+1]=be;for(let ve=2;ve<Ee;++ve)fe.coords[Xe+ve]=F$y(De,Se[Xe+ve],ve)}}return fe!==ve&&wt$3(fe,Se.length,Te.length),fe}function It$2(fe,ve,_e,be,we,Se){if(wt$3(fe),fe.lengths.push(...ve.lengths),_e===we&&be===Se)for(let Te=0;Te<ve.coords.length;Te++)fe.coords.push(ve.coords[Te]);else{const Te=d$1t(_e,be),Ee=M$J(_e,be,we,Se),Ce=ve.coords;for(let ve=0;ve<Ce.length;ve+=Te)Ee(fe.coords,Ce,fe.coords.length,ve,Ce[ve],Ce[ve+1])}return fe}function Mt$3(fe,ve,_e,be){let we=0,Se=fe[be*ve],Te=fe[be*(ve+1)];for(let Ee=1;Ee<_e;Ee++){const _e=Se+fe[be*(ve+Ee)],Ce=Te+fe[be*(ve+Ee)+1],Oe=(_e-Se)*(Ce+Te);Se=_e,Te=Ce,we+=Oe}return.5*we}function Nt$1(fe,ve){const{coords:_e,lengths:be}=fe;let we=0,Se=0;for(let Te=0;Te<be.length;Te++){const fe=be[Te];Se+=Mt$3(_e,we,fe,ve),we+=fe}return Math.abs(Se)}function wt$3(fe,ve=0,_e=0){Tt$4(fe.lengths,_e),Tt$4(fe.coords,ve)}function Tt$4(fe,ve=0){fe.length!==ve&&(fe.length=ve)}const DW={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},NW=new pr(Array,(fe=>O$16(fe,ix)),null,10,5),FW=u$3J();let zW=class A9{get labelLayers(){return this._labelLayers||Qt}get extent(){return this._extent}get isElevationSource(){return this.layers.some((fe=>null==fe?void 0:fe.isElevationSource))}constructor(fe,ve,_e,be,we){this.graphic=fe,this.graphics3DSymbol=ve,this.layers=_e,this._visibleFlags=PB.ALL_LABEL,this.deconflictionPriority=0,++ve.referenced,this._featureExpressionFeature=we?s$2k(we,fe,be):null}initialize(fe){this._layer=fe,this._forEachSymbolLayerGraphic((ve=>{ve.initialize(fe),ve.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((fe=>fe.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((fe=>fe.destroy())),this._labelLayers=null}addLabelGraphic(fe,ve){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(fe),fe.initialize(ve),fe.setVisibility(this.isVisible(CB.LABEL))}setCalloutGraphic(fe){this._calloutLayer=fe,this._layer&&(fe.initialize(this._layer),fe.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let fe=!1;return this._forEachSymbolLayerGraphic((ve=>{"draped"===ve.type&&(fe=!0)})),fe}isVisible(fe=CB.GRAPHIC,ve){const _e=ve?this._visibleFlags|ve|CB.LABEL*ve:this._visibleFlags;return fe===CB.GRAPHIC?(_e&PB.ALL_GRAPHIC)===PB.ALL_GRAPHIC:(_e&PB.ALL_LABEL)===PB.ALL_LABEL}setVisibilityFlag(fe,ve,_e){const be=this.isVisible(fe);_e?this._visibleFlags|=fe*ve:this._visibleFlags&=~(fe*ve);const we=this.isVisible(fe);if(be===we)return!1;if(fe===CB.LABEL)this._forEachLabelGraphic((fe=>fe.setVisibility(we)));else{this._forEachSymbolLayerGraphic((fe=>fe.setVisibility(we)));const fe=this.isVisible(CB.LABEL);this._forEachLabelGraphic((ve=>ve.setVisibility(fe)))}return!0}getVisibilityFlag(fe,ve){return!!(this._visibleFlags&fe*ve)}computeExtent(fe){if(!this._extent){const ve=this.graphic.geometry;if(null==ve)return!1;this._extent=u$3J(),function I$M(fe,ve){switch(D$19(ve),"mesh"===fe.type&&(fe=fe.extent),fe.type){case"point":ve[0]=ve[2]=fe.x,ve[1]=ve[3]=fe.y;break;case"polyline":for(let _e=0;_e<fe.paths.length;_e++)h$2J(ve,fe.paths[_e]);break;case"polygon":for(let _e=0;_e<fe.rings.length;_e++)h$2J(ve,fe.rings[_e]);break;case"multipoint":h$2J(ve,fe.points);break;case"extent":ve[0]=fe.xmin,ve[1]=fe.ymin,ve[2]=fe.xmax,ve[3]=fe.ymax}}(ve,this._extent);const _e=ve.spatialReference;if(!G$Y(_e,fe)&&!i$48(this._extent,_e,this._extent,fe))return this._extent=null,!1}return!0}getAsOptimizedGeometry(fe,ve){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,fe,ve)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(fe,ve,_e){let be=fe.geometry;return"mesh"!==be.type&&"extent"!==be.type||(be=wa.fromExtent("mesh"===be.type?be.extent:be)),ot$8(be,ve,_e)}get usedMemory(){let fe=t$4u(this.graphic.attributes);return this._forEachSymbolLayerGraphic((ve=>fe+=ve.graphics3DSymbolLayer.usedMemory)),fe}computeAttachmentOrigin(){const fe={render:{origin:[0,0,0],num:0},draped:{origin:[0,0],num:0}};for(const ve of this.layers)null!=ve&&ve.computeAttachmentOrigin(fe);return fe.render.num>1&&g$2z(fe.render.origin,fe.render.origin,1/fe.render.num),fe.draped.num>1&&l$31(fe.draped.origin,fe.draped.origin,1/fe.draped.num),fe}async getProjectedBoundingBox(fe,ve,_e,be,we){return we||(we={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),we.boundingBox?P$$(we.boundingBox):we.boundingBox=P$$(),we.requiresDrapedElevation=!1,await a$4g(this.layers,(async Se=>{if(null==Se)return;const Te="draped"===Se.type?ve:fe,Ee=NW.acquire(),Ce=await Se.getProjectedBoundingBox(Te,_e,we.screenSpaceObjects,be,Ee);isFinite(Ce[2])&&isFinite(Ce[5])||(we.requiresDrapedElevation=!0),Ce&&o$35(we.boundingBox,Ee),NW.release(Ee)})),function l$3m(fe){for(let ve=0;ve<6;ve++)if(!isFinite(fe[ve]))return!1;return!0}(we.boundingBox)||x$1N(S$1r(we.boundingBox,FW))?we:null}needsElevationUpdates(){var fe;for(const ve of this.layers)if(null!=ve&&("object3d"===ve.type||"lod-instance"===ve.type)&&ve.needsElevationUpdates)return!0;return(null==(fe=this._labelLayers)?void 0:fe.some((fe=>(null==fe?void 0:fe.needsElevationUpdates)??!1)))??!1}alignWithElevation(fe,ve,_e){this._forEachRenderedGraphic((be=>{"object3d"!==be.type&&"lod-instance"!==be.type||be.alignWithElevation(fe,ve,this._featureExpressionFeature,_e)}))}alignWithAbsoluteElevation(fe,ve,_e){this._forEachRenderedGraphic((be=>{"object3d"===be.type&&be.alignWithAbsoluteElevation(fe,ve,_e)}))}addObjectStateSet(fe,ve){this._forEachSymbolLayerGraphic((_e=>_e.addObjectState(fe,ve)))}removeObjectState(fe){this._forEachSymbolLayerGraphic((ve=>ve.removeObjectState(fe)))}_forEachGraphicList(fe,ve){null==fe||fe.forEach((fe=>fe&&ve(fe)))}_forEachSymbolLayerGraphic(fe){this._forEachGraphicList(this.layers,fe),this._calloutLayer&&fe(this._calloutLayer)}_forEachLabelGraphic(fe){this._forEachGraphicList(this._labelLayers,fe)}_forEachRenderedGraphic(fe){this._forEachSymbolLayerGraphic(fe),this._forEachLabelGraphic(fe)}get test(){}},kW=class e34{constructor(fe,ve){this.scheduler=fe,this.schedule=ve,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}};var UW,VW,BW,jW={exports:{}};UW=jW,VW=function(){function e76(fe,ve,_e){_e=_e||2;var be,we,Se,Te,Ee,Ce,Oe,Re=ve&&ve.length,De=Re?ve[0]*_e:fe.length,Be=n52(fe,0,De,_e,!0),Ze=[];if(!Be||Be.next===Be.prev)return Ze;if(Re&&(Be=function f31(fe,ve,_e,be){var we,Se,Te,Ee=[];for(we=0,Se=ve.length;we<Se;we++)(Te=n52(fe,ve[we]*be,we<Se-1?ve[we+1]*be:fe.length,be,!1))===Te.next&&(Te.steiner=!0),Ee.push(Z6(Te));for(Ee.sort(o39),we=0;we<Ee.length;we++)_e=t84(_e=p48(Ee[we],_e),_e.next);return _e}(fe,ve,Be,_e)),fe.length>80*_e){be=Se=fe[0],we=Te=fe[1];for(var Xe=_e;Xe<De;Xe+=_e)(Ee=fe[Xe])<be&&(be=Ee),(Ce=fe[Xe+1])<we&&(we=Ce),Ee>Se&&(Se=Ee),Ce>Te&&(Te=Ce);Oe=0!==(Oe=Math.max(Se-be,Te-we))?1/Oe:0}return r65(Be,Ze,_e,be,we,Oe),Ze}function n52(fe,ve,_e,be,we){var Se,Te;if(we===C12(fe,ve,_e,be)>0)for(Se=ve;Se<_e;Se+=be)Te=q8(Se,fe[Se],fe[Se+1],Te);else for(Se=_e-be;Se>=ve;Se-=be)Te=q8(Se,fe[Se],fe[Se+1],Te);if(Te&&m39(Te,Te.next)){var Ee=Te.next;A16(Te),Te=Ee}return Te}function t84(fe,ve){if(!fe)return fe;ve||(ve=fe);var _e,be=fe;do{if(_e=!1,be.steiner||!m39(be,be.next)&&0!==w9(be.prev,be,be.next))be=be.next;else{var we=be.prev;if(A16(be),(be=ve=we)===be.next)break;_e=!0}}while(_e||be!==ve);return ve}function r65(fe,ve,_e,be,we,Se,Te){if(fe){!Te&&Se&&function h33(fe,ve,_e,be){var we=fe;do{null===we.z&&(we.z=c50(we.x,we.y,ve,_e,be)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next}while(we!==fe);we.prevZ.nextZ=null,we.prevZ=null,function s84(fe){var ve,_e,be,we,Se,Te,Ee,Ce,Oe=1;do{for(_e=fe,fe=null,Se=null,Te=0;_e;){for(Te++,be=_e,Ee=0,ve=0;ve<Oe&&(Ee++,be=be.nextZ);ve++);for(Ce=Oe;Ee>0||Ce>0&&be;)0!==Ee&&(0===Ce||!be||_e.z<=be.z)?(we=_e,_e=_e.nextZ,Ee--):(we=be,be=be.nextZ,Ce--),Se?Se.nextZ=we:fe=we,we.prevZ=Se,Se=we;_e=be}Se.nextZ=null,Oe*=2}while(Te>1);return fe}(we)}(fe,be,we,Se);for(var Ee,Ce,Oe=fe;fe.prev!==fe.next;)if(Ee=fe.prev,Ce=fe.next,Se?i52(fe,be,we,Se):x16(fe))ve.push(Ee.i/_e),ve.push(fe.i/_e),ve.push(Ce.i/_e),A16(fe),fe=Ce.next,Oe=Ce.next;else if((fe=Ce)===Oe){Te?1===Te?r65(fe=u30(t84(fe),ve,_e),ve,_e,be,we,Se,2):2===Te&&v17(fe,ve,_e,be,we,Se):r65(t84(fe),ve,_e,be,we,Se,1);break}}}function x16(fe){var ve=fe.prev,_e=fe,be=fe.next;if(w9(ve,_e,be)>=0)return!1;for(var we=fe.next.next;we!==fe.prev;){if(g25(ve.x,ve.y,_e.x,_e.y,be.x,be.y,we.x,we.y)&&w9(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function i52(fe,ve,_e,be){var we=fe.prev,Se=fe,Te=fe.next;if(w9(we,Se,Te)>=0)return!1;for(var Ee=we.x<Se.x?we.x<Te.x?we.x:Te.x:Se.x<Te.x?Se.x:Te.x,Ce=we.y<Se.y?we.y<Te.y?we.y:Te.y:Se.y<Te.y?Se.y:Te.y,Oe=we.x>Se.x?we.x>Te.x?we.x:Te.x:Se.x>Te.x?Se.x:Te.x,Re=we.y>Se.y?we.y>Te.y?we.y:Te.y:Se.y>Te.y?Se.y:Te.y,De=c50(Ee,Ce,ve,_e,be),Be=c50(Oe,Re,ve,_e,be),Ze=fe.prevZ,Xe=fe.nextZ;Ze&&Ze.z>=De&&Xe&&Xe.z<=Be;){if(Ze!==fe.prev&&Ze!==fe.next&&g25(we.x,we.y,Se.x,Se.y,Te.x,Te.y,Ze.x,Ze.y)&&w9(Ze.prev,Ze,Ze.next)>=0)return!1;if(Ze=Ze.prevZ,Xe!==fe.prev&&Xe!==fe.next&&g25(we.x,we.y,Se.x,Se.y,Te.x,Te.y,Xe.x,Xe.y)&&w9(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}for(;Ze&&Ze.z>=De;){if(Ze!==fe.prev&&Ze!==fe.next&&g25(we.x,we.y,Se.x,Se.y,Te.x,Te.y,Ze.x,Ze.y)&&w9(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.prevZ}for(;Xe&&Xe.z<=Be;){if(Xe!==fe.prev&&Xe!==fe.next&&g25(we.x,we.y,Se.x,Se.y,Te.x,Te.y,Xe.x,Xe.y)&&w9(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}return!0}function u30(fe,ve,_e){var be=fe;do{var we=be.prev,Se=be.next.next;!m39(we,Se)&&M10(we,be,be.next,Se)&&j13(we,Se)&&j13(Se,we)&&(ve.push(we.i/_e),ve.push(be.i/_e),ve.push(Se.i/_e),A16(be),A16(be.next),be=fe=Se),be=be.next}while(be!==fe);return t84(be)}function v17(fe,ve,_e,be,we,Se){var Te=fe;do{for(var Ee=Te.next.next;Ee!==Te.prev;){if(Te.i!==Ee.i&&d35(Te,Ee)){var Ce=_21(Te,Ee);return Te=t84(Te,Te.next),Ce=t84(Ce,Ce.next),r65(Te,ve,_e,be,we,Se),void r65(Ce,ve,_e,be,we,Se)}Ee=Ee.next}Te=Te.next}while(Te!==fe)}function o39(fe,ve){return fe.x-ve.x}function y16(fe){if(fe.next.prev===fe)return fe;let ve=fe;for(;;){const _e=ve.next;if(_e.prev===ve||_e===ve||_e===fe)break;ve=_e}return ve}function p48(fe,ve){var _e=function a55(fe,ve){var _e,be=ve,we=fe.x,Se=fe.y,Te=-1/0;do{if(Se<=be.y&&Se>=be.next.y&&be.next.y!==be.y){var Ee=be.x+(Se-be.y)*(be.next.x-be.x)/(be.next.y-be.y);if(Ee<=we&&Ee>Te){if(Te=Ee,Ee===we){if(Se===be.y)return be;if(Se===be.next.y)return be.next}_e=be.x<be.next.x?be:be.next}}be=be.next}while(be!==ve);if(!_e)return null;if(we===Te)return _e;var Ce,Oe=_e,Re=_e.x,De=_e.y,Be=1/0;be=_e;do{we>=be.x&&be.x>=Re&&we!==be.x&&g25(Se<De?we:Te,Se,Re,De,Se<De?Te:we,Se,be.x,be.y)&&(Ce=Math.abs(Se-be.y)/(we-be.x),j13(be,fe)&&(Ce<Be||Ce===Be&&(be.x>_e.x||be.x===_e.x&&l49(_e,be)))&&(_e=be,Be=Ce)),be=be.next}while(be!==Oe);return _e}(fe,ve);if(!_e)return ve;var be=_21(_e,fe),we=t84(_e,_e.next);let Se=y16(be);return t84(Se,Se.next),we=y16(we),y16(ve===_e?we:ve)}function l49(fe,ve){return w9(fe.prev,fe,ve.prev)<0&&w9(ve.next,fe,fe.next)<0}function c50(fe,ve,_e,be,we){return(fe=1431655765&((fe=858993459&((fe=252645135&((fe=16711935&((fe=32767*(fe-_e)*we)|fe<<8))|fe<<4))|fe<<2))|fe<<1))|(ve=1431655765&((ve=858993459&((ve=252645135&((ve=16711935&((ve=32767*(ve-be)*we)|ve<<8))|ve<<4))|ve<<2))|ve<<1))<<1}function Z6(fe){var ve=fe,_e=fe;do{(ve.x<_e.x||ve.x===_e.x&&ve.y<_e.y)&&(_e=ve),ve=ve.next}while(ve!==fe);return _e}function g25(fe,ve,_e,be,we,Se,Te,Ee){return(we-Te)*(ve-Ee)-(fe-Te)*(Se-Ee)>=0&&(fe-Te)*(be-Ee)-(_e-Te)*(ve-Ee)>=0&&(_e-Te)*(Se-Ee)-(we-Te)*(be-Ee)>=0}function d35(fe,ve){return fe.next.i!==ve.i&&fe.prev.i!==ve.i&&!function k9(fe,ve){var _e=fe;do{if(_e.i!==fe.i&&_e.next.i!==fe.i&&_e.i!==ve.i&&_e.next.i!==ve.i&&M10(_e,_e.next,fe,ve))return!0;_e=_e.next}while(_e!==fe);return!1}(fe,ve)&&(j13(fe,ve)&&j13(ve,fe)&&function H7(fe,ve){var _e=fe,be=!1,we=(fe.x+ve.x)/2,Se=(fe.y+ve.y)/2;do{_e.y>Se!=_e.next.y>Se&&_e.next.y!==_e.y&&we<(_e.next.x-_e.x)*(Se-_e.y)/(_e.next.y-_e.y)+_e.x&&(be=!be),_e=_e.next}while(_e!==fe);return be}(fe,ve)&&(w9(fe.prev,fe,ve.prev)||w9(fe,ve.prev,ve))||m39(fe,ve)&&w9(fe.prev,fe,fe.next)>0&&w9(ve.prev,ve,ve.next)>0)}function w9(fe,ve,_e){return(ve.y-fe.y)*(_e.x-ve.x)-(ve.x-fe.x)*(_e.y-ve.y)}function m39(fe,ve){return fe.x===ve.x&&fe.y===ve.y}function M10(fe,ve,_e,be){var we=b21(w9(fe,ve,_e)),Se=b21(w9(fe,ve,be)),Te=b21(w9(_e,be,fe)),Ee=b21(w9(_e,be,ve));return we!==Se&&Te!==Ee||!(0!==we||!z10(fe,_e,ve))||!(0!==Se||!z10(fe,be,ve))||!(0!==Te||!z10(_e,fe,be))||!(0!==Ee||!z10(_e,ve,be))}function z10(fe,ve,_e){return ve.x<=Math.max(fe.x,_e.x)&&ve.x>=Math.min(fe.x,_e.x)&&ve.y<=Math.max(fe.y,_e.y)&&ve.y>=Math.min(fe.y,_e.y)}function b21(fe){return fe>0?1:fe<0?-1:0}function j13(fe,ve){return w9(fe.prev,fe,fe.next)<0?w9(fe,ve,fe.next)>=0&&w9(fe,fe.prev,ve)>=0:w9(fe,ve,fe.prev)<0||w9(fe,fe.next,ve)<0}function _21(fe,ve){var _e=new B11(fe.i,fe.x,fe.y),be=new B11(ve.i,ve.x,ve.y),we=fe.next,Se=ve.prev;return fe.next=ve,ve.prev=fe,_e.next=we,we.prev=_e,be.next=_e,_e.prev=be,Se.next=be,be.prev=Se,be}function q8(fe,ve,_e,be){var we=new B11(fe,ve,_e);return be?(we.next=be.next,we.prev=be,be.next.prev=we,be.next=we):(we.prev=we,we.next=we),we}function A16(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function B11(fe,ve,_e){this.i=fe,this.x=ve,this.y=_e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C12(fe,ve,_e,be){for(var we=0,Se=ve,Te=_e-be;Se<_e;Se+=be)we+=(fe[Te]-fe[Se])*(fe[Se+1]+fe[Te+1]),Te=Se;return we}return e76.deviation=function(fe,ve,_e,be){var we=ve&&ve.length,Se=we?ve[0]*_e:fe.length,Te=Math.abs(C12(fe,0,Se,_e));if(we)for(var Ee=0,Ce=ve.length;Ee<Ce;Ee++){var Oe=ve[Ee]*_e,Re=Ee<Ce-1?ve[Ee+1]*_e:fe.length;Te-=Math.abs(C12(fe,Oe,Re,_e))}var De=0;for(Ee=0;Ee<be.length;Ee+=3){var Be=be[Ee]*_e,Ze=be[Ee+1]*_e,Xe=be[Ee+2]*_e;De+=Math.abs((fe[Be]-fe[Xe])*(fe[Ze+1]-fe[Be+1])-(fe[Be]-fe[Ze])*(fe[Xe+1]-fe[Be+1]))}return 0===Te&&0===De?0:Math.abs((De-Te)/Te)},e76.flatten=function(fe){for(var ve=fe[0][0].length,_e={vertices:[],holes:[],dimensions:ve},be=0,we=0;we<fe.length;we++){for(var Se=0;Se<fe[we].length;Se++)for(var Te=0;Te<ve;Te++)_e.vertices.push(fe[we][Se][Te]);we>0&&(be+=fe[we-1].length,_e.holes.push(be))}return _e},e76},void 0!==(BW=VW())&&(UW.exports=BW);const GW=o$2e(jW.exports);function t$1_(fe,ve,_e){e$1T(fe.typedBuffer,ve.typedBuffer,_e,fe.typedBufferStride,ve.typedBufferStride)}function e$1T(fe,ve,_e,be=3,we=be){if(fe.length/be!==Math.ceil(ve.length/we))return fe;const Se=fe.length/be,Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=_e[4],Re=_e[5],De=_e[6],Be=_e[8],Ze=_e[9],Xe=_e[10],Je=_e[12],Qe=_e[13],dt=_e[14];let $t=0,bt=0;for(let wt=0;wt<Se;wt++){const _e=ve[$t],Se=ve[$t+1],wt=ve[$t+2];fe[bt]=Te*_e+Oe*Se+Be*wt+Je,fe[bt+1]=Ee*_e+Re*Se+Ze*wt+Qe,fe[bt+2]=Ce*_e+De*Se+Xe*wt+dt,$t+=we,bt+=be}return fe}function r$1L(fe,ve,_e){f$1u(fe.typedBuffer,ve.typedBuffer,_e,fe.typedBufferStride,ve.typedBufferStride)}function f$1u(fe,ve,_e,be=3,we=be){if(fe.length/be!==Math.ceil(ve.length/we))return;const Se=fe.length/be,Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=_e[3],Re=_e[4],De=_e[5],Be=_e[6],Ze=_e[7],Xe=_e[8];let Je=0,Qe=0;for(let dt=0;dt<Se;dt++){const _e=ve[Je],Se=ve[Je+1],dt=ve[Je+2];fe[Qe]=Te*_e+Oe*Se+Be*dt,fe[Qe+1]=Ee*_e+Re*Se+Ze*dt,fe[Qe+2]=Ce*_e+De*Se+Xe*dt,Je+=we,Qe+=be}}function n$2n(fe,ve,_e){o$1B(fe.typedBuffer,ve.typedBuffer,_e,fe.typedBufferStride,ve.typedBufferStride)}function o$1B(fe,ve,_e,be=3,we=be){const Se=Math.min(fe.length/be,ve.length/we);let Te=0,Ee=0;for(let Ce=0;Ce<Se;Ce++)fe[Ee]=_e*ve[Te],fe[Ee+1]=_e*ve[Te+1],fe[Ee+2]=_e*ve[Te+2],Te+=we,Ee+=be;return fe}function i$28(fe,ve,_e,be=3,we=be){const Se=fe.length/be;if(Se!==Math.ceil(ve.length/we))return fe;let Te=0,Ee=0;for(let Ce=0;Ce<Se;Ce++)fe[Ee]=ve[Te]+_e[0],fe[Ee+1]=ve[Te+1]+_e[1],fe[Ee+2]=ve[Te+2]+_e[2],Te+=we,Ee+=be;return fe}function u$1P(fe,ve){l$2d(fe.typedBuffer,ve.typedBuffer,fe.typedBufferStride,ve.typedBufferStride)}function l$2d(fe,ve,_e=3,be=_e){const we=Math.min(fe.length/_e,ve.length/be);let Se=0,Te=0;for(let Ee=0;Ee<we;Ee++){const we=ve[Se],Ee=ve[Se+1],Ce=ve[Se+2],Oe=we*we+Ee*Ee+Ce*Ce;if(Oe>0){const ve=1/Math.sqrt(Oe);fe[Te]=ve*we,fe[Te+1]=ve*Ee,fe[Te+2]=ve*Ce}Se+=be,Te+=_e}}function t$1Z(fe,ve,_e){return{objectId:fe,target:ve,distance:_e,type:"vertex"}}function e$1S(fe,ve,_e,be,we,Se=!1){return{objectId:fe,target:ve,distance:_e,type:"edge",start:be,end:we,draped:Se}}var HW,qW;function e$1R(fe){return fe&&"esri.renderers.visualVariables.SizeVariable"===fe.declaredClass}function l$2c(fe){return null!=fe&&!isNaN(fe)&&isFinite(fe)}function t$1Y(fe){return fe.valueExpression?HW.Expression:fe.field&&"string"==typeof fe.field?HW.Field:HW.Unknown}Object.freeze(Object.defineProperty({__proto__:null,normalize:l$2d,normalizeView:u$1P,scale:o$1B,scaleView:n$2n,shiftRight:function a$2a(fe,ve,_e){const be=Math.min(fe.count,ve.count),we=fe.typedBuffer,Se=fe.typedBufferStride,Te=ve.typedBuffer,Ee=ve.typedBufferStride;let Ce=0,Oe=0;for(let Re=0;Re<be;Re++)we[Oe]=Te[Ce]>>_e,we[Oe+1]=Te[Ce+1]>>_e,we[Oe+2]=Te[Ce+2]>>_e,Ce+=Ee,Oe+=Se},transformMat3:f$1u,transformMat3View:r$1L,transformMat4:e$1T,transformMat4View:t$1_,translate:i$28},Symbol.toStringTag,{value:"Module"})),function(fe){fe.Unknown="unknown",fe.Expression="expression",fe.Field="field"}(HW||(HW={})),function(fe){fe.Unknown="unknown",fe.Stops="stops",fe.ClampedLinear="clamped-linear",fe.Proportional="proportional",fe.Additive="additive",fe.Constant="constant",fe.Identity="identity",fe.RealWorldSize="real-world-size"}(qW||(qW={}));const c$29=()=>ar.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u$1O=fe=>c$29().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${fe}`),f$1t=()=>c$29().error("Use of arcade expressions requires an arcade context"),WW=new RT,YW=Math.PI,ZW=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m$1I(fe,ve,_e){const be="visualVariables"in fe&&fe.visualVariables?fe.visualVariables.find((fe=>"color"===fe.type)):fe;if(!be)return;if("esri.renderers.visualVariables.ColorVariable"!==be.declaredClass)return void u$1O("ColorVariable");const we="number"==typeof ve,Se=we?null:ve,Te=null==Se?void 0:Se.attributes;let Ee=we?ve:null;const Ce=be.field,{ipData:Oe,hasExpression:Re}=be.cache;let De=be.cache.compiledFunc;if(!Ce&&!Re){const fe=be.stops;return fe&&fe[0]&&fe[0].color}if("number"!=typeof Ee)if(Re){if(null==(null==_e?void 0:_e.arcade))return void f$1t();const fe={viewingMode:_e.viewingMode,scale:_e.scale,spatialReference:_e.spatialReference},ve=_e.arcade.arcadeUtils,we=ve.getViewInfo(fe),Te=ve.createExecContext(Se,we,_e.timeZone);if(!De){const fe=ve.createSyntaxTree(be.valueExpression);De=ve.createFunction(fe),be.cache.compiledFunc=De}Ee=ve.executeFunction(De,Te)}else Te&&(Ee=Te[Ce]);const Be=be.normalizationField,Ze=null!=Te&&null!=Be?parseFloat(Te[Be]):void 0;if(null!=Ee&&(!Be||we||!isNaN(Ze)&&0!==Ze)){isNaN(Ze)||we||(Ee/=Ze);const fe=U$B(Ee,Oe);if(fe){const ve=fe[0],we=fe[1],Se=ve===we?be.stops[ve].color:b_.blendColors(be.stops[ve].color,be.stops[we].color,fe[2],null!=_e?_e.color:void 0);return new b_(Se)}}}function b$Y(fe,ve,_e){const be="visualVariables"in fe&&fe.visualVariables?fe.visualVariables.find((fe=>"opacity"===fe.type)):fe;if(!be)return;if("esri.renderers.visualVariables.OpacityVariable"!==be.declaredClass)return void u$1O("OpacityVariable");const we="number"==typeof ve,Se=we?null:ve,Te=null==Se?void 0:Se.attributes;let Ee=we?ve:null;const Ce=be.field,{ipData:Oe,hasExpression:Re}=be.cache;let De=be.cache.compiledFunc;if(!Ce&&!Re){const fe=be.stops;return fe&&fe[0]&&fe[0].opacity}if("number"!=typeof Ee)if(Re){if(null==(null==_e?void 0:_e.arcade))return void f$1t();const fe={viewingMode:_e.viewingMode,scale:_e.scale,spatialReference:_e.spatialReference},ve=_e.arcade.arcadeUtils,we=ve.getViewInfo(fe),Te=ve.createExecContext(Se,we,_e.timeZone);if(!De){const fe=ve.createSyntaxTree(be.valueExpression);De=ve.createFunction(fe),be.cache.compiledFunc=De}Ee=ve.executeFunction(De,Te)}else Te&&(Ee=Te[Ce]);const Be=be.normalizationField,Ze=null!=Te&&null!=Be?parseFloat(Te[Be]):void 0;if(null!=Ee&&(!Be||we||!isNaN(Ze)&&0!==Ze)){isNaN(Ze)||we||(Ee/=Ze);const fe=U$B(Ee,Oe);if(fe){const ve=fe[0],_e=fe[1];if(ve===_e)return be.stops[ve].opacity;{const we=be.stops[ve].opacity;return we+(be.stops[_e].opacity-we)*fe[2]}}}}function h$1j(fe,ve,_e){const be="visualVariables"in fe&&fe.visualVariables?fe.visualVariables.find((fe=>"rotation"===fe.type)):fe;if(!be)return;if("esri.renderers.visualVariables.RotationVariable"!==be.declaredClass)return void u$1O("RotationVariable");const we=be.axis||"heading",Se="heading"===we&&"arithmetic"===be.rotationType?90:0,Te="heading"===we&&"arithmetic"===be.rotationType?-1:1,Ee="number"==typeof ve?null:ve,Ce=null==Ee?void 0:Ee.attributes,Oe=be.field,{hasExpression:Re}=be.cache;let De=be.cache.compiledFunc,Be=0;if(!Oe&&!Re)return Be;if(Re){if(null==(null==_e?void 0:_e.arcade))return void f$1t();const fe={viewingMode:_e.viewingMode,scale:_e.scale,spatialReference:_e.spatialReference},ve=_e.arcade.arcadeUtils,we=ve.getViewInfo(fe),Se=ve.createExecContext(Ee,we,_e.timeZone);if(!De){const fe=ve.createSyntaxTree(be.valueExpression);De=ve.createFunction(fe),be.cache.compiledFunc=De}Be=ve.executeFunction(De,Se)}else Ce&&(Be=Ce[Oe]||0);return Be="number"!=typeof Be||isNaN(Be)?null:Se+Te*Be,Be}function y$13(fe,ve,_e){const be="visualVariables"in fe&&fe.visualVariables?fe.visualVariables.find((fe=>"size"===fe.type)):fe;if(!be)return;if("esri.renderers.visualVariables.SizeVariable"!==be.declaredClass)return void u$1O("SizeVariable");const we=k$E(function V$D(fe,ve,_e){const be="number"==typeof ve,we=be?null:ve,Se=null==we?void 0:we.attributes;let Te=be?ve:null;const{isScaleDriven:Ee}=fe.cache;let Ce=fe.cache.compiledFunc;if(Ee){const ve=null!=_e?_e.scale:void 0,be=null!=_e?_e.view:void 0;Te=null==ve||"3d"===be?function x$J(fe){let ve=null,_e=null;const be=fe.stops;return be?(ve=be[0].value,_e=be[be.length-1].value):(ve=fe.minDataValue||0,_e=fe.maxDataValue||0),(ve+_e)/2}(fe):ve}else if(!be)switch(fe.inputValueType){case HW.Expression:{if(null==(null==_e?void 0:_e.arcade))return void f$1t();const ve={viewingMode:_e.viewingMode,scale:_e.scale,spatialReference:_e.spatialReference},be=_e.arcade.arcadeUtils,Se=be.getViewInfo(ve),Ee=be.createExecContext(we,Se,_e.timeZone);if(!Ce){const ve=be.createSyntaxTree(fe.valueExpression);Ce=be.createFunction(ve),fe.cache.compiledFunc=Ce}Te=be.executeFunction(Ce,Ee);break}case HW.Field:Se&&(Te=Se[fe.field]);break;case HW.Unknown:Te=null}if(!l$2c(Te))return null;if(be||!fe.normalizationField)return Te;const Oe=Se?parseFloat(Se[fe.normalizationField]):null;return l$2c(Oe)&&0!==Oe?Te/Oe:null}(be,ve,_e),be,ve,_e,be.cache.ipData);return null==we||isNaN(we)?0:we}function g$17(fe,ve,_e){return null==fe?null:e$1R(fe)?y$13(fe,ve,_e):l$2c(fe)?fe:null}function w$_(fe,ve,_e){return l$2c(_e)&&fe>_e?_e:l$2c(ve)&&fe<ve?ve:fe}function k$E(fe,ve,_e,be,we){switch(ve.transformationType){case qW.Additive:return function z$u(fe,ve,_e,be){return fe+((g$17(ve.minSize,_e,be)||ve.minDataValue)??0)}(fe,ve,_e,be);case qW.Constant:return function F$x(fe,ve,_e){const be=fe.stops;let we=(null==be?void 0:be.length)&&be[0].size;return null==we&&(we=fe.minSize),g$17(we,ve,_e)}(ve,_e,be);case qW.ClampedLinear:return function S$U(fe,ve,_e,be){const we=(fe-ve.minDataValue)/(ve.maxDataValue-ve.minDataValue),Se=g$17(ve.minSize,_e,be),Te=g$17(ve.maxSize,_e,be),Ee=null!=be?be.shape:void 0;if(fe<=ve.minDataValue)return Se;if(fe>=ve.maxDataValue)return Te;if(null==Se||null==Te)return null;if("area"===ve.scaleBy&&Ee){const fe="circle"===Ee,ve=fe?YW*(Se/2)**2:Se*Se,_e=ve+we*((fe?YW*(Te/2)**2:Te*Te)-ve);return fe?2*Math.sqrt(_e/YW):Math.sqrt(_e)}return Se+we*(Te-Se)}(fe,ve,_e,be);case qW.Proportional:return function E$M(fe,ve,_e,be){const we=null!=be?be.shape:void 0,Se=fe/ve.minDataValue,Te=g$17(ve.minSize,_e,be),Ee=g$17(ve.maxSize,_e,be);let Ce=null;return Ce="circle"===we?2*Math.sqrt(Se*(Te/2)**2):"square"===we||"diamond"===we||"image"===we?Math.sqrt(Se*Te**2):Se*Te,w$_(Ce,Te,Ee)}(fe,ve,_e,be);case qW.Stops:return function C$I(fe,ve,_e,be,we){var Se,Te,Ee;const[Ce,Oe,Re]=U$B(fe,we);if(Ce===Oe)return g$17(null==(Se=ve.stops)?void 0:Se[Ce].size,_e,be);{const fe=g$17(null==(Te=ve.stops)?void 0:Te[Ce].size,_e,be);return fe+(g$17(null==(Ee=ve.stops)?void 0:Ee[Oe].size,_e,be)-fe)*Re}}(fe,ve,_e,be,we);case qW.RealWorldSize:return function D$A(fe,ve,_e,be){const we=((null==be?void 0:be.resolution)??1)*LB[ve.valueUnit],Se=g$17(ve.minSize,_e,be),Te=g$17(ve.maxSize,_e,be),{valueRepresentation:Ee}=ve;let Ce=null;return Ce="area"===Ee?2*Math.sqrt(fe/YW)/we:"radius"===Ee||"distance"===Ee?2*fe/we:fe/we,w$_(Ce,Se,Te)}(fe,ve,_e,be);case qW.Identity:return fe;case qW.Unknown:return null}}function R$F(fe,ve,_e){if(!fe.visualVariables)return;const be=[],we=[],Se=[],Te=[],Ee=[];for(const Ce of fe.visualVariables)switch(Ce.type){case"color":we.push(Ce);break;case"opacity":Se.push(Ce);break;case"rotation":Ee.push(Ce);break;case"size":Te.push(Ce)}return we.forEach((fe=>{const we=m$1I(fe,ve,_e);be.push({variable:fe,value:we})})),Se.forEach((fe=>{const we=b$Y(fe,ve,_e);be.push({variable:fe,value:we})})),Ee.forEach((fe=>{const we=h$1j(fe,ve,_e);be.push({variable:fe,value:we})})),Te.forEach((fe=>{const we=y$13(fe,ve,_e);be.push({variable:fe,value:we})})),be.filter((fe=>null!=fe.value))}function U$B(fe,ve){if(!ve)return;let _e=0,be=ve.length-1;return ve.some(((ve,we)=>fe<ve?(be=we,!0):(_e=we,!1))),[_e,be,(fe-ve[_e])/(ve[be]-ve[_e])]}function T$F(fe,ve,_e){const be=["proportional","proportional","proportional"];for(const we of fe){const fe=we.useSymbolValue?"symbol-value":y$13(we,ve,_e);switch(we.axis){case"width":be[0]=fe;break;case"depth":be[1]=fe;break;case"height":be[2]=fe;break;case"width-and-depth":be[0]=fe,be[1]=fe;break;case"all":case void 0:case null:be[0]=fe,be[1]=fe,be[2]=fe;break;default:we.axis}}return be}const XW=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:T$F,getColor:m$1I,getOpacity:b$Y,getRotationAngle:h$1j,getSize:y$13,getSizeForValue:k$E,getSizeFromNumberOrVariable:g$17,getSizeRangeAtScale:function N$A(fe,ve,_e){const{isScaleDriven:be}=fe.cache;if(!(be&&"3d"===_e||ve))return null;const we={scale:ve,view:_e};let Se=g$17(fe.minSize,WW,we),Te=g$17(fe.maxSize,WW,we);if(null!=Se||null!=Te){if(Se>Te){const fe=Te;Te=Se,Se=fe}return{minSize:Se,maxSize:Te}}},getVisualVariableValues:R$F,viewScaleRE:ZW},Symbol.toStringTag,{value:"Module"}));function o$1A(fe,ve){if(!fe||fe.symbol)return null;const _e=null==ve?void 0:ve.renderer;return fe&&null!=_e&&_e.getObservationRenderer?_e.getObservationRenderer(fe):_e}function i$26(fe,ve){const _e=o$1A(fe,ve),be=function r$1K(fe,ve){if(null!=fe.symbol)return fe.symbol;const _e=o$1A(fe,ve);return null!=_e&&"dot-density"!==_e.type?_e.getSymbol(fe,ve):null}(fe,ve);if(null==be)return null;const we={renderer:_e,symbol:be};if(null==_e||!("visualVariables"in _e)||!_e.visualVariables)return we;const Se=R$F(_e,fe,ve)??[],Te=["proportional","proportional","proportional"];for(const{variable:Ee,value:Ce}of Se)switch(Ee.type){case"color":we.color=Ce.toRgba();break;case"size":if("outline"===Ee.target)we.outlineSize=Ce;else{const fe=Ee.axis,ve=Ee.useSymbolValue?"symbol-value":Ce;switch(fe){case"width":Te[0]=ve;break;case"depth":Te[1]=ve;break;case"height":Te[2]=ve;break;case"width-and-depth":Te[0]=Te[1]=ve;break;default:Te[0]=Te[1]=Te[2]=ve}}break;case"opacity":we.opacity=Ce;break;case"rotation":switch(Ee.axis){case"tilt":we.tilt=Ce;break;case"roll":we.roll=Ce;break;default:we.heading=Ce}}return"proportional"===Te[0]&&"proportional"===Te[1]&&"proportional"===Te[2]||(we.size=Te),we}async function l$2b(fe,ve){const _e=o$1A(fe,ve),be=await async function n$2l(fe,ve){if(null!=fe.symbol)return fe.symbol;const _e=o$1A(fe,ve);return null!=_e?_e.getSymbolAsync(fe,ve):null}(fe,ve);if(!be)return null;const we={renderer:_e,symbol:be};if(!_e||!("visualVariables"in _e)||!_e.visualVariables)return we;const Se=R$F(_e,fe,ve)??[],Te=["proportional","proportional","proportional"];for(const{variable:Ee,value:Ce}of Se)if("color"===Ee.type)we.color=b_.toUnitRGBA(Ce);else if("size"===Ee.type)if("outline"===Ee.target)we.outlineSize=Ce;else{const fe=Ee.axis,ve=Ee.useSymbolValue?"symbol-value":Ce;"width"===fe?Te[0]=ve:"depth"===fe?Te[1]=ve:"height"===fe?Te[2]=ve:Te[0]=Te[1]="width-and-depth"===fe?ve:Te[2]=ve}else"opacity"===Ee.type?we.opacity=Ce:"rotation"===Ee.type&&"tilt"===Ee.axis?we.tilt=Ce:"rotation"===Ee.type&&"roll"===Ee.axis?we.roll=Ce:"rotation"===Ee.type&&(we.heading=Ce);return(isFinite(Te[0])||isFinite(Te[1])||isFinite(Te[2]))&&(we.size=Te),we}function c$28(fe,ve,_e){const be=function e$1Q(fe,ve,_e,be){const we=(Te=ve,Array.isArray(Te[0])?(fe,_e)=>ve[fe][_e]:(fe,_e)=>ve[3*fe+_e]),Se=be?W$L(be)/L$1d(be):1;var Te;return X$v(fe,((fe,ve)=>o$44(fe,we(ve,0)*Se,we(ve,1)*Se,we(ve,2))),_e)}(JW,fe,ve,_e)?JW:[0,0,1];return Math.abs(be[2])>Math.cos(h$2U(80))?ha.Z:Math.abs(be[1])>Math.abs(be[0])?ha.Y:ha.X}const JW=E$1z();function p$2f(fe,ve,_e){const be=c$28(fe,(ve.length>0?ve[0]:fe.length/3)-1,_e);if(be!==ha.Z){fe=fe.slice();for(let ve=0;ve<fe.length;ve+=3)fe[ve+be]=fe[ve+2]}return GW(fe,ve,3)}function m$1H(fe){const ve=[[nO.POSITION,new Om(fe.attributeData.position,fe.indices,3,!0)]],_e=A$14(fe.indices.length);return null!=fe.attributeData.colorFeature?ve.push([nO.COLORFEATUREATTRIBUTE,new Om([fe.attributeData.colorFeature],_e,1,!0)]):fe.attributeData.color&&ve.push([nO.COLOR,new Om(fe.attributeData.color,_e,4,!0)]),fe.attributeData.uvMapSpace&&ve.push([nO.UVMAPSPACE,new Om(fe.attributeData.uvMapSpace,fe.indices,4,!0)]),fe.attributeData.boundingRect&&ve.push([nO.BOUNDINGRECT,new Om(fe.attributeData.boundingRect,fe.indices,9,!0)]),new pD(fe.material,ve,fe.mapPositions,eD.Mesh,fe.attributeData.objectAndLayerIdColor)}function l$2a(fe,ve=null){const _e=[[nO.POSITION,new Om(fe.attributeData.position,fe.indices,3,!0)],[nO.UV0,new Om(fe.attributeData.uv0,fe.indices,2,!0)]];return new pD(fe.material,_e,fe.mapPositions,eD.Mesh,ve)}function b$X(fe){switch(fe.type){case"extent":if(fe instanceof aa)return wa.fromExtent(fe);break;case"polygon":return fe}return null}let QW=class g11{constructor(fe,ve,_e){this.renderData=fe,this.layerUid=ve,this.graphicUid=_e,this.outGeometries=new Array}};function e$1P(fe,ve,_e){const be=Array.isArray(fe),we=be?fe.length/ve:fe.byteLength/(4*ve),Se=be?fe:new Uint32Array(fe,0,we*ve),Te=(null==_e?void 0:_e.minReduction)??0,Ee=(null==_e?void 0:_e.originalIndices)||null,Ce=Ee?Ee.length:0,Oe=(null==_e?void 0:_e.componentOffsets)||null;let Re=0;if(Oe)for(let St=0;St<Oe.length-1;St++){const fe=Oe[St+1]-Oe[St];fe>Re&&(Re=fe)}else Re=we;const De=Math.floor(1.1*Re)+1;(null==KW||KW.length<2*De)&&(KW=new Uint32Array(u$3X(2*De)));for(let St=0;St<2*De;St++)KW[St]=0;let Be=0;const Ze=!!Oe&&!!Ee,Xe=Ze?Ce:we;let Je=i$2F(we);const Qe=new Uint32Array(Ce),dt=1.96;let $t=0!==Te?Math.ceil(7.84*dt/(Te*Te)*Te*(1-Te)):Xe,bt=1,wt=Oe?Oe[1]:Xe;for(let St=0;St<Xe;St++){if(St===$t){const fe=1-Be/St;if(fe+dt*Math.sqrt(fe*(1-fe)/St)<Te)return null;$t*=2}if(St===wt){for(let fe=0;fe<2*De;fe++)KW[fe]=0;if(Ee)for(let fe=Oe[bt-1];fe<Oe[bt];fe++)Qe[fe]=Je[Ee[fe]];wt=Oe[++bt]}const fe=Ze?Ee[St]:St,_e=fe*ve,be=f$1r(Se,_e,ve);let we=be%De,Ce=Be;for(;0!==KW[2*we+1];){if(KW[2*we]===be){const fe=KW[2*we+1]-1;if(l$29(Se,_e,fe*ve,ve)){Ce=Je[fe];break}}we++,we>=De&&(we-=De)}Ce===Be&&(KW[2*we]=be,KW[2*we+1]=fe+1,Be++),Je[fe]=Ce}if(0!==Te&&1-Be/we<Te)return null;if(Ze){for(let fe=Oe[bt-1];fe<Qe.length;fe++)Qe[fe]=Je[Ee[fe]];Je=t$2F(Qe)}const xt=be?new Array(Be):new Uint32Array(Be*ve);Be=0;for(let St=0;St<Xe;St++)Je[St]===Be&&(o$1z(Se,(Ze?Ee[St]:St)*ve,xt,Be*ve,ve),Be++);if(Ee&&!Ze){const fe=new Uint32Array(Ce);for(let ve=0;ve<fe.length;ve++)fe[ve]=Je[Ee[ve]];Je=t$2F(fe)}return{buffer:Array.isArray(xt)?xt:xt.buffer,indices:Je,uniqueCount:Be}}function l$29(fe,ve,_e,be){for(let we=0;we<be;we++)if(fe[ve+we]!==fe[_e+we])return!1;return!0}function o$1z(fe,ve,_e,be,we){for(let Se=0;Se<we;Se++)_e[be+Se]=fe[ve+Se]}function f$1r(fe,ve,_e){let be=0;for(let we=0;we<_e;we++)be=fe[ve+we]+be|0,be=be+(be<<11)+(be>>>2)|0;return be>>>0}let KW=null;function f$1q(fe){const ve=a$27(fe.rings,fe.hasZ,eY.CCW_IS_HOLE,fe.spatialReference),_e=new Array;let be=0,we=0;for(const Ee of ve.polygons){const fe=Ee.count,Se=Ee.index,Te=a$2H(ve.position,3*Se,3*fe),Ce=Ee.holeIndices.map((fe=>fe-Se)),Oe=t$2F(GW(Te,Ce,3));_e.push({position:Te,faces:Oe}),be+=Te.length,we+=Oe.length}const Se=function h$1i(fe,ve,_e){if(1===fe.length)return fe[0];const be=t$2H(ve),we=new Array(_e);let Se=0,Te=0,Ee=0;for(const Ce of fe){for(let fe=0;fe<Ce.position.length;fe++)be[Se++]=Ce.position[fe];for(const fe of Ce.faces)we[Te++]=fe+Ee;Ee=Se/3}return{position:be,faces:t$2F(we)}}(_e,be,we),Te=Array.isArray(Se.position)?e$1P(Se.position,3,{originalIndices:Se.faces}):e$1P(Se.position.buffer,6,{originalIndices:Se.faces});return Se.position=e$2E(new Float64Array(Te.buffer)),Se.faces=Te.indices,Se}function a$27(fe,ve,_e,be){const we=fe.length,Se=new Array(we),Te=new Array(we),Ee=new Array(we);let Ce=0;for(let Xe=0;Xe<we;++Xe)Ce+=fe[Xe].length;let Oe=0,Re=0,De=0;const Be=t$2H(3*Ce);let Ze=0;for(let Xe=we-1;Xe>=0;Xe--){const Ce=fe[Xe],Je=_e===eY.CCW_IS_HOLE&&u$1N(Ce,ve,be);if(Je&&1!==we)Se[Oe++]=Ce;else{let fe=Ce.length;for(let ve=0;ve<Oe;++ve)fe+=Se[ve].length;const _e={index:Ze,pathLengths:new Array(Oe+1),count:fe,holeIndices:new Array(Oe)};_e.pathLengths[0]=Ce.length,Ce.length>0&&(Ee[De++]={index:Ze,count:Ce.length}),Ze=Je?g$15(Ce,Ce.length-1,-1,Be,Ze,Ce.length,ve):g$15(Ce,0,1,Be,Ze,Ce.length,ve);for(let be=0;be<Oe;++be){const fe=Se[be];_e.holeIndices[be]=Ze,_e.pathLengths[be+1]=fe.length,fe.length>0&&(Ee[De++]={index:Ze,count:fe.length}),Ze=g$15(fe,0,1,Be,Ze,fe.length,ve)}Oe=0,_e.count>0&&(Te[Re++]=_e)}}for(let Xe=0;Xe<Oe;++Xe){const fe=Se[Xe];fe.length>0&&(Ee[De++]={index:Ze,count:fe.length}),Ze=g$15(fe,0,1,Be,Ze,fe.length,ve)}return Te.length=Re,Ee.length=De,{position:Be,polygons:Te,outlines:Ee}}function g$15(fe,ve,_e,be,we,Se,Te){we*=3;for(let Ee=0;Ee<Se;++Ee){const Se=fe[ve];be[we++]=Se[0],be[we++]=Se[1],be[we++]=Te?Se[2]:0,ve+=_e}return we/3}function u$1N(fe,ve,_e){if(!ve)return!a$4k(fe);switch(c$28(fe,fe.length-1,_e)){case ha.X:return!a$4k(fe,ha.Y,ha.Z);case ha.Y:return!a$4k(fe,ha.X,ha.Z);case ha.Z:return!a$4k(fe,ha.X,ha.Y)}}var eY,tY,rY,iY,nY,sY,oY,aY;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(eY||(eY={})),function(fe){fe[fe.RasterImage=0]="RasterImage",fe[fe.Features=1]="Features"}(tY||(tY={})),function(fe){fe[fe.MapLayer=0]="MapLayer",fe[fe.ViewLayer=1]="ViewLayer",fe[fe.Outline=2]="Outline",fe[fe.SnappingHint=3]="SnappingHint"}(rY||(rY={})),function(fe){fe[fe.WithRasterImage=0]="WithRasterImage",fe[fe.WithoutRasterImage=1]="WithoutRasterImage"}(iY||(iY={})),function(fe){fe[fe.INNER=0]="INNER",fe[fe.OUTER=1]="OUTER"}(nY||(nY={})),function(fe){fe[fe.REGULAR=0]="REGULAR",fe[fe.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",fe[fe.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",fe[fe.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(sY||(sY={})),function(fe){fe[fe.OFF=0]="OFF",fe[fe.ON=1]="ON"}(oY||(oY={})),function(fe){fe[fe.FADING=0]="FADING",fe[fe.IMMEDIATE=1]="IMMEDIATE",fe[fe.UNFADED=2]="UNFADED"}(aY||(aY={}));let lY=class s38{constructor(fe,ve){this.vec3=fe,this.id=ve}};function t$1W(fe,ve,_e,be){return new lY(r$3y(fe,ve,_e),be)}let cY=class n18{constructor(){this._extent=u$3J(),this.resolution=0,this.renderLocalOrigin=t$1W(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new uY}get extent(){return this._extent}setupGeometryViewsCyclical(fe){this.setupGeometryViewsDirect();const ve=.001*fe.range;if(this._extent[0]-ve<=fe.min){const ve=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$16(this._extent,fe.range,0,ve)}if(this._extent[2]+ve>=fe.max){const ve=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$16(this._extent,-fe.range,0,ve)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,e$3R(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let fe=0;fe<this.canvasGeometries.numViews;fe++){const ve=this.canvasGeometries.extents[fe];if(ve[0]!==ve[2]&&ve[1]!==ve[3])return!0}return!1}},uY=class r24{constructor(){this.extents=[u$3J(),u$3J(),u$3J()],this.numViews=0}};var hY;!function(fe){fe[fe.Color=0]="Color",fe[fe.ColorNoRasterImage=1]="ColorNoRasterImage",fe[fe.Highlight=2]="Highlight",fe[fe.WaterNormal=3]="WaterNormal",fe[fe.Occluded=4]="Occluded",fe[fe.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(hY||(hY={}));let dY=class t42{constructor(fe,ve,_e){this._fbos=fe,this._format=ve,this._name=_e}get valid(){var fe;return null!=(null==(fe=this._handle)?void 0:fe.getTexture())}dispose(){this._handle=t$4r(this._handle)}get texture(){var fe;return null==(fe=this._handle)?void 0:fe.getTexture()}bind(fe,ve,_e){var be,we,Se,Te,Ee,Ce;this._handle&&(null==(be=this._handle.fbo)?void 0:be.width)===ve&&(null==(we=this._handle.fbo)?void 0:we.height)===_e||(null==(Se=this._handle)||Se.release(),this._handle=this._fbos.acquire(ve,_e,this._name,this._format)),fe.unbindTexture(null==(Ee=null==(Te=this._handle)?void 0:Te.fbo)?void 0:Ee.colorTexture),fe.bindFramebuffer(null==(Ce=this._handle)?void 0:Ce.fbo)}generateMipMap(){var fe,ve,_e,be,we;(null==(_e=null==(ve=null==(fe=this._handle)?void 0:fe.getTexture())?void 0:ve.descriptor)?void 0:_e.hasMipmap)&&(null==(we=null==(be=this._handle)?void 0:be.getTexture())||we.generateMipmap())}},pY=class a18{constructor(fe,ve,_e,be,we=YA.RGBA_MIPMAP){this.output=_e,this.content=be,this.fbo=new dY(fe,we,ve)}get valid(){return this.fbo.valid}},fY=class s39{constructor(fe){this.targets=[new pY(fe,"overlay color",NI.Color,hY.Color),new pY(fe,"overlay IM color",NI.Color,hY.ColorNoRasterImage),new pY(fe,"overlay highlight",NI.Highlight,hY.Highlight,YA.RGBA4),new pY(fe,"overlay water",NI.Normal,hY.WaterNormal),new pY(fe,"overlay occluded",NI.Color,hY.Occluded)],has("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new pY(fe,"overlay oid",NI.ObjectAndLayerIdColor,hY.ObjectAndLayerIdColor))}getTexture(fe){var ve;return null==(ve=this.targets[fe])?void 0:ve.fbo.texture}dispose(){for(const fe of this.targets)fe.fbo.dispose()}computeValidity(){return this.targets.reduce(((fe,ve,_e)=>ve.valid?fe|=1<<_e:fe),0)}},mY=class e35 extends BH{constructor(){super(...arguments),this.slicePlaneLocalOrigin=[0,0,0],this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var yY;!function(fe){fe[fe.Material=0]="Material",fe[fe.ShadowMap=1]="ShadowMap",fe[fe.Highlight=2]="Highlight",fe[fe.ViewshedShadowMap=3]="ViewshedShadowMap"}(yY||(yY={}));let gY=class h12 extends mY{constructor(){super(...arguments),this.identifier=yY.Material,this.output=NI.Color,this.transparent=!1}},vY=class l16 extends mY{constructor(){super(...arguments),this.identifier=yY.ShadowMap}},_Y=class n19 extends mY{constructor(){super(...arguments),this.identifier=yY.Highlight}},$Y=class c29 extends mY{constructor(){super(...arguments),this.identifier=yY.ViewshedShadowMap}};function o$1w(fe){fe.fragment.code.add(o$2P`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function n$2i(fe){fe.fragment.code.add(o$2P`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function d$1r(fe,ve){const _e=fe.fragment;_e.include(c$2X),_e.uniforms.add(new lO("nearFar",((fe,ve)=>ve.camera.nearFar))),_e.uniforms.add(new CO("depthMap",((fe,ve)=>{var _e;return null==(_e=ve.depth)?void 0:_e.attachment}))),_e.uniforms.add(new pO("proj",((fe,ve)=>ve.camera.projectionMatrix))),_e.uniforms.add(new dO("invResolutionHeight",((fe,ve)=>1/ve.camera.height))),_e.uniforms.add(new pO("reprojectionMatrix",((fe,ve)=>ve.ssr.reprojectionMatrix))),_e.code.add(o$2P`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${ve.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function f$1p(fe,ve){fe.include(r$1P,ve),fe.include(e$31),fe.include(n$2i),ve.hasCloudsReflections&&fe.include(v$1i,ve),ve.hasScreenSpaceReflections&&fe.include(d$1r,ve);const _e=fe.fragment;_e.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",sq).add("ssrHeightFadeEnd","float",oq).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),_e.code.add(o$2P`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),_e.uniforms.add(new dO("lightingSpecularStrength",((fe,ve)=>ve.lighting.mainLight.specularStrength)),new dO("lightingEnvironmentStrength",((fe,ve)=>ve.lighting.mainLight.environmentStrength))),_e.code.add(o$2P`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),ve.hasCloudsReflections&&_e.code.add(o$2P`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),ve.hasScreenSpaceReflections?(_e.uniforms.add(new pO("view",((fe,ve)=>ve.camera.viewMatrix)),new CO("lastFrameColorTexture",((fe,ve)=>{var _e;return null==(_e=ve.ssr.lastFrameColor)?void 0:_e.getTexture()})),new dO("fadeFactorSSR",((fe,ve)=>ve.ssr.fadeFactor))),_e.code.add(o$2P`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):_e.code.add(o$2P`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),ve.hasCloudsReflections?ve.hasScreenSpaceReflections?_e.code.add(o$2P`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):_e.code.add(o$2P`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):_e.code.add(o$2P`return waterRenderedColor;
}`)}var bY;function C$H(fe,ve){const{vertex:_e,fragment:be}=fe;_e.uniforms.add(new vH("overlayTexOffset",((fe,ve)=>function b$W(fe,ve){var _e,be,we,Se;const Te=null==(be=null==(_e=ve.overlay)?void 0:_e.overlays[nY.INNER])?void 0:be.extent;y$2g(Te)&&(xY[0]=fe.toMapSpace[0]/M$1o(Te)-Te[0]/M$1o(Te),xY[1]=fe.toMapSpace[1]/s$41(Te)-Te[1]/s$41(Te));const Ee=null==(Se=null==(we=ve.overlay)?void 0:we.overlays[nY.OUTER])?void 0:Se.extent;return y$2g(Ee)&&(xY[2]=fe.toMapSpace[0]/M$1o(Ee)-Ee[0]/M$1o(Ee),xY[3]=fe.toMapSpace[1]/s$41(Ee)-Ee[1]/s$41(Ee)),xY}(fe,ve))),new vH("overlayTexScale",((fe,ve)=>function M$H(fe,ve){var _e,be,we,Se;const Te=null==(be=null==(_e=ve.overlay)?void 0:_e.overlays[nY.INNER])?void 0:be.extent;y$2g(Te)&&(xY[0]=fe.toMapSpace[2]/M$1o(Te),xY[1]=fe.toMapSpace[3]/s$41(Te));const Ee=null==(Se=null==(we=ve.overlay)?void 0:we.overlays[nY.OUTER])?void 0:Se.extent;return y$2g(Ee)&&(xY[2]=fe.toMapSpace[2]/M$1o(Ee),xY[3]=fe.toMapSpace[3]/s$41(Ee)),xY}(fe,ve)))),be.constants.add("overlayOpacity","float",1),be.uniforms.add(new CO("ovColorTex",((fe,ve)=>O$E(fe,ve)))),T$E(fe,ve)}function g$14(fe,ve){const{vertex:_e,fragment:be}=fe;_e.uniforms.add(new wY("overlayTexOffset"),new wY("overlayTexScale")),be.uniforms.add(new dO("overlayOpacity",(fe=>fe.overlayOpacity)),new CO("ovColorTex",((fe,ve)=>{var _e;return null==(_e=ve.overlay)?void 0:_e.getTexture(fe.overlayContent)}))),T$E(fe,ve)}!function(fe){fe[fe.Disabled=0]="Disabled",fe[fe.Enabled=1]="Enabled",fe[fe.EnabledWithWater=2]="EnabledWithWater",fe[fe.COUNT=3]="COUNT"}(bY||(bY={}));let wY=class h13 extends aO{constructor(fe){super(fe,"vec4")}};function T$E(fe,ve){ve.pbrMode!==yM.Water&&ve.pbrMode!==yM.WaterOnIntegratedMesh&&ve.pbrMode!==yM.TerrainWithWater||fe.include(f$1p,ve);const{vertex:_e,fragment:be}=fe;fe.varyings.add("vtcOverlay","vec4"),_e.code.add(o$2P`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),be.code.add(o$2P`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),be.code.add(o$2P`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),be.code.add(o$2P`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),ve.pbrMode!==yM.Water&&ve.pbrMode!==yM.WaterOnIntegratedMesh&&ve.pbrMode!==yM.TerrainWithWater||(t$34(be),a$2$(be),be.code.add(o$2P`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function O$E(fe,ve){var _e,be,we;return fe.identifier===yY.Material&&fe.output===NI.Color?null==(_e=ve.overlay)?void 0:_e.getTexture(hY.ColorNoRasterImage):fe.identifier===yY.Material&&fe.output===NI.ObjectAndLayerIdColor?null==(be=ve.overlay)?void 0:be.getTexture(hY.ObjectAndLayerIdColor):fe.identifier===yY.Highlight?null==(we=ve.overlay)?void 0:we.getTexture(hY.Highlight):null}const xY=[0,0,0,0];let SY=class a19 extends iO{constructor(){super(...arguments),this.color=r$3y(1,1,1)}};function l$27(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("tex",(fe=>fe.texture)),new uO("uColor",(fe=>fe.color))),fe.fragment.code.add(o$2P`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),fe}const TY=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:SY,build:l$27},Symbol.toStringTag,{value:"Module"}));let EY=class r25{constructor(fe){this._context=fe,this._perConstructorInstances=new wU,this._frameCounter=0,this._keepAliveFrameCount=CY}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((fe=>fe.forEach((fe=>fe.technique.destroy())))),this._perConstructorInstances.clear()}acquire(fe,ve=OY){const _e=ve.key;let be=this._perConstructorInstances.get(fe,_e);if(null==be){const we=new fe(this._context,ve,(()=>this.release(we)));be=new PY(we),this._perConstructorInstances.set(fe,_e,be)}return++be.refCount,be.technique}releaseAndAcquire(fe,ve,_e){if(null!=_e){if(ve.key===_e.key)return _e;this.release(_e)}return this.acquire(fe,ve)}release(fe){if(null==fe||this._perConstructorInstances.empty)return;const ve=this._perConstructorInstances.get(fe.constructor,fe.key);null!=ve&&(--ve.refCount,0===ve.refCount&&(ve.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==CY&&this._perConstructorInstances.forEach(((fe,ve)=>{fe.forEach(((fe,_e)=>{0===fe.refCount&&fe.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(fe.technique.destroy(),this._perConstructorInstances.delete(ve,_e))}))}))}async reloadAll(){const fe=new Array;this._perConstructorInstances.forEach(((ve,_e)=>{fe.push((async(fe,ve)=>{const _e=ve.shader;_e&&(await _e.reload(),fe.forEach((fe=>fe.technique.reload(this._context))))})(ve,_e))})),await Promise.all(fe)}},PY=class s40{constructor(fe){this.technique=fe,this.refCount=0,this.refZeroFrame=0}};const CY=-1,OY=new HA;let AY=class s41{constructor(fe,ve,_e,be){this._textures=fe,this._techniques=ve,this.materialChanged=_e,this.requestRender=be,this._id2glMaterialRef=new wU}dispose(){this._textures.destroy()}acquire(fe,ve,_e){this._ownMaterial(fe);const be=fe.produces.get(ve);if(!(null==be?void 0:be(_e)))return null;let we=this._id2glMaterialRef.get(_e,fe.id);if(null==we){const ve=fe.createGLMaterial({material:fe,techniques:this._techniques,textures:this._textures,output:_e});we=new MY(ve),this._id2glMaterialRef.set(_e,fe.id,we)}return we.ref(),we.glMaterial}release(fe,ve){const _e=this._id2glMaterialRef.get(ve,fe.id);null!=_e&&(_e.unref(),_e.referenced||(r$3M(_e.glMaterial),this._id2glMaterialRef.delete(ve,fe.id)))}_ownMaterial(fe){fe.repository&&fe.repository!==this&&ar.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),fe.repository=this}},MY=class a20{constructor(fe){this.glMaterial=fe,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,s$31(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const RY=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let IY=class b10{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(fe,ve){this.objectToBoundingSphere=fe,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new LY,this._objectCount=0,ve&&(void 0!==ve.maximumObjectsPerNode&&(this._maximumObjectsPerNode=ve.maximumObjectsPerNode),void 0!==ve.maximumDepth&&(this._maximumDepth=ve.maximumDepth))}destroy(){this._degenerateObjects.clear(),LY.clearPool(),zY[0]=null,jY.prune(),ZY.prune()}add(fe,ve=fe.length){this._objectCount+=ve,this._grow(fe,ve);const _e=LY.acquire();for(let be=0;be<ve;be++){const ve=fe[be];this._isDegenerate(ve)?this._degenerateObjects.add(ve):(_e.init(this._root),this._add(ve,_e))}LY.release(_e)}remove(fe,ve=null){this._objectCount-=fe.length;const _e=LY.acquire();for(const be of fe){const fe=ve??T$1d(this.objectToBoundingSphere(be),GY);C$G(fe[3])?(_e.init(this._root),O$D(be,fe,_e)):this._degenerateObjects.delete(be)}LY.release(_e),this._shrink()}update(fe,ve){if(!C$G(ve[3])&&this._isDegenerate(fe))return;const _e=function y$12(fe){return zY[0]=fe,zY}(fe);this.remove(_e,ve),this.add(_e)}forEachAlongRay(fe,ve,_e){const be=l$3V(fe,ve);S$T(this._root,(fe=>{if(!function T$D(fe,ve){return B$o(ve.bounds,2*-ve.halfSize,VY),B$o(ve.bounds,2*ve.halfSize,BY),i$2X(fe.origin,fe.direction,VY,BY)}(be,fe))return!1;const ve=fe.node;return ve.terminals.forAll((fe=>{this._intersectsObject(be,fe)&&_e(fe)})),null!==ve.residents&&ve.residents.forAll((fe=>{this._intersectsObject(be,fe)&&_e(fe)})),!0}))}forEachAlongRayWithVerticalOffset(fe,ve,_e,be){const we=l$3V(fe,ve);S$T(this._root,(fe=>{if(!function z$t(fe,ve,_e){return B$o(ve.bounds,2*-ve.halfSize,VY),B$o(ve.bounds,2*ve.halfSize,BY),_e.applyToMinMax(VY,BY),i$2X(fe.origin,fe.direction,VY,BY)}(we,fe,be))return!1;const ve=fe.node;return ve.terminals.forAll((fe=>{this._intersectsObjectWithOffset(we,fe,be)&&_e(fe)})),null!==ve.residents&&ve.residents.forAll((fe=>{this._intersectsObjectWithOffset(we,fe,be)&&_e(fe)})),!0}))}forEach(fe){S$T(this._root,(ve=>{const _e=ve.node;return _e.terminals.forAll(fe),null!==_e.residents&&_e.residents.forAll(fe),!0})),this._degenerateObjects.forEach(fe)}forEachDegenerateObject(fe){this._degenerateObjects.forEach(fe)}findClosest(fe,ve,_e,be=()=>!0,we=1/0){let Se=1/0,Te=1/0,Ee=null;const Ce=F$w(fe,ve),c50=Ce=>{if(--we,!be(Ce))return;const Oe=this.objectToBoundingSphere(Ce);if(!s$2N(_e,Oe))return;const Re=v$N(fe,ve,Oe),De=Re-Oe[3],Be=Re+Oe[3];De<Se&&(Se=De,Te=Be,Ee=Ce)};return j$O(this._root,(be=>{if(we<=0||!s$2N(_e,be.bounds))return!1;if(g$2z(UY,Ce,be.halfSize),u$3Y(UY,UY,be.bounds),v$N(fe,ve,UY)>Te)return!1;const Se=be.node;return Se.terminals.forAll((fe=>c50(fe))),null!==Se.residents&&Se.residents.forAll((fe=>c50(fe))),!0}),fe,ve),Ee}forEachInDepthRange(fe,ve,_e,be,we,Se,Te){let Ee=-1/0,Ce=1/0;const Oe={setRange:fe=>{_e===b10.DepthOrder.FRONT_TO_BACK?(Ee=Math.max(Ee,fe.near),Ce=Math.min(Ce,fe.far)):(Ee=Math.max(Ee,-fe.far),Ce=Math.min(Ce,-fe.near))}};Oe.setRange(be);const Re=v$N(ve,_e,fe),De=F$w(ve,_e),Be=F$w(ve,-_e),g25=fe=>{if(!Te(fe))return;const be=this.objectToBoundingSphere(fe),De=v$N(ve,_e,be)-Re,Be=De-be[3],Ze=De+be[3];Be>Ce||Ze<Ee||!s$2N(Se,be)||we(fe,Oe)};j$O(this._root,(fe=>{if(!s$2N(Se,fe.bounds))return!1;if(g$2z(UY,De,fe.halfSize),u$3Y(UY,UY,fe.bounds),v$N(ve,_e,UY)-Re>Ce)return!1;if(g$2z(UY,Be,fe.halfSize),u$3Y(UY,UY,fe.bounds),v$N(ve,_e,UY)-Re<Ee)return!1;const be=fe.node;return be.terminals.forAll((fe=>g25(fe))),null!==be.residents&&be.residents.forAll((fe=>g25(fe))),!0}),ve,_e)}forEachNode(fe){S$T(this._root,(ve=>fe(ve.node,ve.bounds,ve.halfSize,ve.depth)))}forEachNeighbor(fe,ve){const _e=N$10(ve),be=ve,i52=ve=>{const we=this.objectToBoundingSphere(ve),Se=N$10(we),Te=_e+Se;return!(p$4Z(we,be)-Te*Te<=0)||fe(ve)};let we=!0;const h33=fe=>{we&&(we=i52(fe))};S$T(this._root,(fe=>{const ve=N$10(fe.bounds),Se=_e+ve;if(p$4Z(fe.bounds,be)-Se*Se>0)return!1;const Te=fe.node;return Te.terminals.forAll(h33),we&&null!==Te.residents&&Te.residents.forAll(h33),we})),we&&this.forEachDegenerateObject(h33)}_intersectsObject(fe,ve){const _e=this.objectToBoundingSphere(ve);return!(_e[3]>0)||H$_(_e,fe)}_intersectsObjectWithOffset(fe,ve,_e){const be=this.objectToBoundingSphere(ve);return!(be[3]>0)||H$_(_e.applyToBoundingSphere(be),fe)}_add(fe,ve){ve.advanceTo(this.objectToBoundingSphere(fe))?ve.node.terminals.push(fe):(ve.node.residents.push(fe),ve.node.residents.length>this._maximumObjectsPerNode&&ve.depth<this._maximumDepth&&this._split(ve))}_split(fe){const ve=fe.node.residents;fe.node.residents=null;for(let _e=0;_e<ve.length;_e++){const be=LY.acquire().init(fe);this._add(ve.at(_e),be),LY.release(be)}}_grow(fe,ve){if(0!==ve&&(D$z(fe,ve,(fe=>this.objectToBoundingSphere(fe)),HY),C$G(HY[3])&&!this._fitsInsideTree(HY)))if(N$z(this._root.node))T$1d(HY,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const fe=this._rootBoundsForRootAsSubNode(HY);this._placingRootViolatesMaxDepth(fe)?this._rebuildTree(HY,fe):this._growRootAsSubNode(fe),LY.release(fe)}}_rebuildTree(fe,ve){r$3w(qY,ve.bounds),qY[3]=ve.halfSize,D$z([fe,qY],2,(fe=>fe),WY);const _e=LY.acquire().init(this._root);this._root.initFrom(null,WY,WY[3]),this._root.increaseHalfSize(1.25),S$T(_e,(fe=>(this.add(fe.node.terminals.data,fe.node.terminals.length),null!==fe.node.residents&&this.add(fe.node.residents.data,fe.node.residents.length),!0))),LY.release(_e)}_placingRootViolatesMaxDepth(fe){const ve=Math.log(fe.halfSize/this._root.halfSize)*Math.LOG2E;let _e=0;return S$T(this._root,(fe=>(_e=Math.max(_e,fe.depth),_e+ve<=this._maximumDepth))),_e+ve>this._maximumDepth}_rootBoundsForRootAsSubNode(fe){const ve=fe[3],_e=fe;let be=-1/0;const we=this._root.bounds,Se=this._root.halfSize;for(let Ee=0;Ee<3;Ee++){const fe=we[Ee]-Se-(_e[Ee]-ve),Te=_e[Ee]+ve-(we[Ee]+Se),Ce=Math.max(0,Math.ceil(fe/(2*Se))),Oe=Math.max(0,Math.ceil(Te/(2*Se)))+1,Re=2**Math.ceil(Math.log(Ce+Oe)*Math.LOG2E);be=Math.max(be,Re),YY[Ee].min=Ce,YY[Ee].max=Oe}for(let Ee=0;Ee<3;Ee++){let fe=YY[Ee].min,ve=YY[Ee].max;const _e=(be-(fe+ve))/2;fe+=Math.ceil(_e),ve+=Math.floor(_e);const Te=we[Ee]-Se-fe*Se*2;kY[Ee]=Te+(ve+fe)*Se}const Te=be*Se;return kY[3]=Te*FY,LY.acquire().initFrom(null,kY,Te,0)}_growRootAsSubNode(fe){const ve=this._root.node;r$3w(HY,this._root.bounds),HY[3]=this._root.halfSize,this._root.init(fe),fe.advanceTo(HY,null,!0),fe.node.children=ve.children,fe.node.residents=ve.residents,fe.node.terminals=ve.terminals}_shrink(){for(;;){const fe=this._findShrinkIndex();if(-1===fe)break;this._root.advance(fe),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let fe=null;const ve=this._root.node.children;let _e=0,be=0;for(;be<ve.length&&null==fe;)_e=be++,fe=ve[_e];for(;be<ve.length;)if(ve[be++])return-1;return _e}_isDegenerate(fe){return!C$G(this.objectToBoundingSphere(fe)[3])}_fitsInsideTree(fe){const ve=this._root.bounds,_e=this._root.halfSize;return fe[3]<=_e&&fe[0]>=ve[0]-_e&&fe[0]<=ve[0]+_e&&fe[1]>=ve[1]-_e&&fe[1]<=ve[1]+_e&&fe[2]>=ve[2]-_e&&fe[2]<=ve[2]+_e}toJSON(){const{maximumDepth:fe,maximumObjectsPerNode:ve,_objectCount:_e}=this,be=this._nodeToJSON(this._root.node);return{maximumDepth:fe,maximumObjectsPerNode:ve,objectCount:_e,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:be}}}_nodeToJSON(fe){var ve,_e;return{children:fe.children.map((fe=>fe?this._nodeToJSON(fe):null)),residents:null==(ve=fe.residents)?void 0:ve.map((fe=>this.objectToBoundingSphere(fe))),terminals:null==(_e=fe.terminals)?void 0:_e.map((fe=>this.objectToBoundingSphere(fe)))}}static fromJSON(fe){const ve=new b10((fe=>fe),{maximumDepth:fe.maximumDepth,maximumObjectsPerNode:fe.maximumObjectsPerNode});return ve._objectCount=fe.objectCount,ve._root.initFrom(fe.root.node,fe.root.bounds,fe.root.halfSize,fe.root.depth),ve}},LY=class g12{constructor(){this.bounds=[0,0,0,0],this.halfSize=0,this.initFrom(null,null,0,0)}init(fe){return this.initFrom(fe.node,fe.bounds,fe.halfSize,fe.depth)}initFrom(fe,ve,_e,be=this.depth){return this.node=null!=fe?fe:g12.createEmptyNode(),ve&&T$1d(ve,this.bounds),this.halfSize=_e,this.depth=be,this}increaseHalfSize(fe){this.halfSize*=fe,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*FY}advance(fe){let ve=this.node.children[fe];ve||(ve=g12.createEmptyNode(),this.node.children[fe]=ve),this.node=ve,this.halfSize/=2,this.depth++;const _e=DY[fe];return this.bounds[0]+=_e[0]*this.halfSize,this.bounds[1]+=_e[1]*this.halfSize,this.bounds[2]+=_e[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(fe,ve,_e=!1){for(;;){if(this.isTerminalFor(fe))return ve&&ve(this,-1),!0;if(this.isLeaf()){if(!_e)return ve&&ve(this,-1),!1;this.node.residents=null}const be=this._childIndex(fe);ve&&ve(this,be),this.advance(be)}}isLeaf(){return null!=this.node.residents}isTerminalFor(fe){return fe[3]>this.halfSize/2}_childIndex(fe){const ve=this.bounds;return(ve[0]<fe[0]?1:0)+(ve[1]<fe[1]?2:0)+(ve[2]<fe[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new jr({shrink:!0}),residents:new jr({shrink:!0})}}static acquire(){return g12._pool.acquire()}static release(fe){g12._pool.release(fe)}static clearPool(){g12._pool.prune()}};function S$T(fe,ve){let _e=LY.acquire().init(fe);const be=[_e];for(;0!==be.length;){if(_e=be.pop(),ve(_e)&&!_e.isLeaf())for(let fe=0;fe<_e.node.children.length;fe++)_e.node.children[fe]&&be.push(LY.acquire().init(_e).advance(fe));LY.release(_e)}}function j$O(fe,ve,_e,be=IY.DepthOrder.FRONT_TO_BACK){let we=LY.acquire().init(fe);const Se=[we];for(function R$E(fe,ve,_e){if(!ZY.length)for(let be=0;be<8;++be)ZY.push({index:0,distance:0});for(let be=0;be<8;++be){const _e=DY[be];ZY.data[be].index=be,ZY.data[be].distance=v$N(fe,ve,_e)}ZY.sort(((fe,ve)=>fe.distance-ve.distance));for(let be=0;be<8;++be)_e[be]=ZY.data[be].index}(_e,be,XY);0!==Se.length;){if(we=Se.pop(),ve(we)&&!we.isLeaf())for(let fe=7;fe>=0;--fe){const ve=XY[fe];we.node.children[ve]&&Se.push(LY.acquire().init(we).advance(ve))}LY.release(we)}}function O$D(fe,ve,_e){jY.clear();const be=_e.advanceTo(ve,((fe,ve)=>{jY.push(fe.node),jY.push(ve)}))?_e.node.terminals:_e.node.residents;if(be.removeUnordered(fe),0===be.length)for(let we=jY.length-2;we>=0&&x$I(jY.data[we],jY.data[we+1]);we-=2);}function x$I(fe,ve){return ve>=0&&(fe.children[ve]=null),!!N$z(fe)&&(null===fe.residents&&(fe.residents=new jr({shrink:!0})),!0)}function N$z(fe){if(0!==fe.terminals.length)return!1;if(null!==fe.residents)return 0===fe.residents.length;for(let ve=0;ve<fe.children.length;ve++)if(fe.children[ve])return!1;return!0}function M$G(fe,ve){fe[0]=Math.min(fe[0],ve[0]-ve[3]),fe[1]=Math.min(fe[1],ve[1]-ve[3]),fe[2]=Math.min(fe[2],ve[2]-ve[3])}function A$K(fe,ve){fe[0]=Math.max(fe[0],ve[0]+ve[3]),fe[1]=Math.max(fe[1],ve[1]+ve[3]),fe[2]=Math.max(fe[2],ve[2]+ve[3])}function B$o(fe,ve,_e){_e[0]=fe[0]+ve,_e[1]=fe[1]+ve,_e[2]=fe[2]+ve}function D$z(fe,ve,_e,be){if(1===ve){T$1d(_e(fe[0]),be)}else{VY[0]=1/0,VY[1]=1/0,VY[2]=1/0,BY[0]=-1/0,BY[1]=-1/0,BY[2]=-1/0;for(let be=0;be<ve;be++){const ve=_e(fe[be]);C$G(ve[3])&&(M$G(VY,ve),A$K(BY,ve))}A$1G(be,VY,BY,.5),be[3]=Math.max(BY[0]-VY[0],BY[1]-VY[1],BY[2]-VY[2])/2}}function F$w(fe,ve){let _e,be=1/0;for(let we=0;we<8;++we){const Se=v$N(fe,ve,NY[we]);Se<be&&(be=Se,_e=NY[we])}return _e}function v$N(fe,ve,_e){return ve*(fe[0]*_e[0]+fe[1]*_e[1]+fe[2]*_e[2])}function C$G(fe){return!isNaN(fe)&&fe!==-1/0&&fe!==1/0&&fe>0}LY._pool=new pr(LY),function(fe){var ve;(ve=fe.DepthOrder||(fe.DepthOrder={}))[ve.FRONT_TO_BACK=1]="FRONT_TO_BACK",ve[ve.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(IY||(IY={}));const DY=[r$3y(-1,-1,-1),r$3y(1,-1,-1),r$3y(-1,1,-1),r$3y(1,1,-1),r$3y(-1,-1,1),r$3y(1,-1,1),r$3y(-1,1,1),r$3y(1,1,1)],NY=[r$3y(-1,-1,-1),r$3y(-1,-1,1),r$3y(-1,1,-1),r$3y(-1,1,1),r$3y(1,-1,-1),r$3y(1,-1,1),r$3y(1,1,-1),r$3y(1,1,1)],FY=Math.sqrt(3),zY=[null];const kY=[0,0,0,0],UY=[0,0,0],VY=[0,0,0],BY=[0,0,0],jY=new jr,GY=[0,0,0,0],HY=[0,0,0,0],qY=[0,0,0,0],WY=[0,0,0,0],YY=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ZY=new jr,XY=[0,0,0,0,0,0,0,0],JY=IY;var QY,KY;(KY=QY||(QY={}))[KY.ASYNC=0]="ASYNC",KY[KY.SYNC=1]="SYNC";let eZ=class a21 extends iD{get objects(){return this._objects}constructor(fe,ve,_e=""){super(),this.stage=fe,this.apiLayerUid=_e,this.type=eD.Layer,this.events=new La,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new jr,this._objectsAdded=new jr,this._handles=new jt,this.apiLayerUid=_e,this.visible=(null==ve?void 0:ve.visible)??!0,this.pickable=(null==ve?void 0:ve.pickable)??!0,this.updatePolicy=(null==ve?void 0:ve.updatePolicy)??QY.ASYNC,this._disableOctree=(null==ve?void 0:ve.disableOctree)??!1,fe.add(this);for(const be of RY)this._handles.add(this.events.on(be,(ve=>fe.handleEvent(be,ve))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(fe){this._objects.push(fe),fe.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:fe}),null!=this._octree&&this._objectsAdded.push(fe)}remove(fe){this._objects.removeUnordered(fe)&&(fe.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:fe}),null!=this._octree&&(this._objectsAdded.removeUnordered(fe)||this._octree.remove([fe])))}addMany(fe){this._objects.pushArray(fe);for(const ve of fe)ve.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:fe}),null!=this._octree&&this._objectsAdded.pushArray(fe)}removeMany(fe){const ve=new Array;if(this._objects.removeUnorderedMany(fe,fe.length,ve),0!==ve.length){for(const fe of ve)fe.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:ve}),null!=this._octree){for(let fe=0;fe<ve.length;)this._objectsAdded.removeUnordered(ve[fe])?(ve[fe]=ve[ve.length-1],ve.length-=1):++fe;this._octree.remove(ve)}}}sync(){this.updatePolicy!==QY.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(fe,ve){null==this._octree||this._objectsAdded.includes(fe)||this._octree.update(fe,ve)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new JY((fe=>fe.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=u$4d(this._octree),this._objectsAdded.clear()}};function n$2g(fe){return null!=fe&&fe.type===eD.Layer}var tZ,rZ;!function(fe){fe[fe.Draped=0]="Draped",fe[fe.Screen=1]="Screen",fe[fe.World=2]="World",fe[fe.COUNT=3]="COUNT"}(tZ||(tZ={})),function(fe){fe[fe.Center=0]="Center",fe[fe.Tip=1]="Tip",fe[fe.COUNT=2]="COUNT"}(rZ||(rZ={}));let iZ=class a22 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.transparencyPassType=WR.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=tZ.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=rZ.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===tZ.Draped}};e$4o([r$2w({count:NI.COUNT})],iZ.prototype,"output",void 0),e$4o([r$2w({count:WR.COUNT})],iZ.prototype,"transparencyPassType",void 0),e$4o([r$2w()],iZ.prototype,"occluder",void 0),e$4o([r$2w()],iZ.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],iZ.prototype,"writeDepth",void 0),e$4o([r$2w({count:tZ.COUNT})],iZ.prototype,"space",void 0),e$4o([r$2w()],iZ.prototype,"hideOnShortSegments",void 0),e$4o([r$2w()],iZ.prototype,"hasCap",void 0),e$4o([r$2w({count:rZ.COUNT})],iZ.prototype,"anchor",void 0),e$4o([r$2w()],iZ.prototype,"hasTip",void 0),e$4o([r$2w()],iZ.prototype,"vvSize",void 0),e$4o([r$2w()],iZ.prototype,"vvColor",void 0),e$4o([r$2w()],iZ.prototype,"vvOpacity",void 0),e$4o([r$2w()],iZ.prototype,"hasOccludees",void 0),e$4o([r$2w()],iZ.prototype,"multipassEnabled",void 0),e$4o([r$2w()],iZ.prototype,"cullAboveGround",void 0),e$4o([r$2w({constValue:!1})],iZ.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:!0})],iZ.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!0})],iZ.prototype,"hasSliceTranslatedView",void 0);const nZ=8;function c$26(fe,ve){const _e=fe.vertex;_e.uniforms.add(new dO("intrinsicWidth",(fe=>fe.width))),ve.vvSize?(fe.attributes.add(nO.SIZEFEATUREATTRIBUTE,"float"),_e.uniforms.add(new uO("vvSizeMinSize",(fe=>fe.vvSize.minSize)),new uO("vvSizeMaxSize",(fe=>fe.vvSize.maxSize)),new uO("vvSizeOffset",(fe=>fe.vvSize.offset)),new uO("vvSizeFactor",(fe=>fe.vvSize.factor))),_e.code.add(o$2P`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(fe.attributes.add(nO.SIZE,"float"),_e.code.add(o$2P`float getSize(){
return intrinsicWidth * size;
}`)),ve.vvOpacity?(fe.attributes.add(nO.OPACITYFEATUREATTRIBUTE,"float"),_e.constants.add("vvOpacityNumber","int",8),_e.uniforms.add(new dj("vvOpacityValues",(fe=>fe.vvOpacity.values),nZ),new dj("vvOpacityOpacities",(fe=>fe.vvOpacity.opacityValues),nZ)),_e.code.add(o$2P`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):_e.code.add(o$2P`vec4 applyOpacity( vec4 color ){
return color;
}`),ve.vvColor?(fe.include(l$2t,ve),fe.attributes.add(nO.COLORFEATUREATTRIBUTE,"float"),_e.code.add(o$2P`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(fe.attributes.add(nO.COLOR,"vec4"),_e.code.add(o$2P`vec4 getColor(){
return applyOpacity(color);
}`))}let sZ=class t43{constructor(fe,ve,_e){this._createTexture=fe,this._parametersKey=ve,this._repository=new Map,this._orphanCache=_e.newCache(`procedural-texture-repository:${e$44()}`,(fe=>fe.dispose()))}destroy(){for(const[fe,{texture:ve}]of this._repository)ve.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(fe,ve=null){const _e=this._acquire(fe);return this.release(ve),_e}release(fe){if(null==fe)return;const ve=this._parametersKey(fe),_e=this._repository.get(ve);if(_e&&(_e.refCount--,0===_e.refCount)){this._repository.delete(ve);const{texture:fe}=_e,be=fe.usedMemory;this._orphanCache.put(ve,fe,be)}}_acquire(fe){if(null==fe)return null;const ve=this._parametersKey(fe),_e=this._repository.get(ve);if(_e)return _e.refCount++,_e.texture;const be=this._orphanCache.pop(ve)??this._createTexture(fe),we=new oZ(be);return this._repository.set(ve,we),be}},oZ=class r26{constructor(fe){this.texture=fe,this.refCount=1}};function u$1M(fe,ve){return new sZ((ve=>{const{encodedData:_e,textureSize:be}=function a$20(fe){const ve=c$25(fe),_e=1/fe.pixelRatio,be=f$1n(fe),we=s$22(fe),Se=(Math.floor(.5*(we-1))+.5)*_e,Te=[];let Ee=1;for(const Be of ve){for(let fe=0;fe<Be;fe++){const ve=Ee*(Math.min(fe,Be-1-fe)+.5)*_e/Se*.5+.5;Te.push(ve)}Ee=-Ee}const Ce=Math.round(ve[0]/2),Oe=[...Te.slice(Ce),...Te.slice(0,Ce)],Re=new Uint8Array(4*be);let De=0;for(const Be of Oe)o$1M(Be,Re,De),De+=4;return{encodedData:Re,textureSize:be}}(ve),we=new nM;return we.internalFormat=YO.RGBA,we.width=be,we.height=1,we.wrapMode=qO.REPEAT,new oM(fe,we,_e)}),(fe=>`${fe.pattern.join(",")}-r${fe.pixelRatio}`),ve)}function c$25(fe){return fe.pattern.map((ve=>Math.round(ve*fe.pixelRatio)))}function f$1n(fe){if(null==fe)return 1;const ve=c$25(fe);return Math.floor(ve.reduce(((fe,ve)=>fe+ve)))}function s$22(fe){return c$25(fe).reduce(((fe,ve)=>Math.max(fe,ve)))}const aZ=[0,0,0,0];function d$1p(fe,ve){fe.constants.add("stippleAlphaColorDiscard","float",.001),fe.constants.add("stippleAlphaHighlightDiscard","float",.5),ve.stippleEnabled?function c$23(fe,ve){const _e=!(ve.draped&&ve.stipplePreferContinuous),{vertex:be,fragment:we}=fe;we.include(a$32),ve.draped||(f$20(be,ve),be.uniforms.add(new dO("worldToScreenPerDistanceRatio",((fe,ve)=>1/ve.camera.perScreenPixelRatio))),be.code.add(o$2P`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),fe.varyings.add("vStippleDistance","float"),fe.varyings.add("vStippleDistanceLimits","vec2"),fe.varyings.add("vStipplePatternStretch","float"),be.code.add(o$2P`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${lZ};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),be.code.add(o$2P`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),be.code.add(o$2P`
    if (segmentLengthPseudoScreen >= ${_e?"patternLength":"1e4"}) {
  `),w$1d(be),be.code.add(o$2P`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),we.uniforms.add(new CO("stipplePatternTexture",(fe=>fe.stippleTexture)),new dO("stipplePatternSDFNormalizer",(fe=>function m$1G(fe){return fe?(Math.floor(.5*(s$22(fe)-1))+.5)/fe.pixelRatio:1}(fe.stipplePattern))),new dO("stipplePatternPixelSizeInv",(fe=>1/S$S(fe)))),we.code.add(o$2P`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),ve.stippleOffColorEnabled?(we.uniforms.add(new hO("stippleOffColor",(fe=>function s$21(fe){return null==fe?_d:4===fe.length?fe:s$3I(aZ,fe[0],fe[1],fe[2],1)}(fe.stippleOffColor)))),we.code.add(o$2P`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):we.code.add(o$2P`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(fe,ve):function f$1m(fe){fe.fragment.code.add(o$2P`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(fe)}function S$S(fe){const ve=fe.stipplePattern;return ve?f$1n(fe.stipplePattern)/ve.pixelRatio:1}const lZ=o$2P.float(.4);async function t$1T(fe,ve){const{data:_e}=await U$1a(fe,{responseType:"image",...ve});return _e}let cZ;var uZ;!function(fe){fe[fe.ETC1_RGB=0]="ETC1_RGB",fe[fe.ETC2_RGBA=1]="ETC2_RGBA",fe[fe.BC1_RGB=2]="BC1_RGB",fe[fe.BC3_RGBA=3]="BC3_RGBA",fe[fe.BC4_R=4]="BC4_R",fe[fe.BC5_RG=5]="BC5_RG",fe[fe.BC7_M6_RGB=6]="BC7_M6_RGB",fe[fe.BC7_M5_RGBA=7]="BC7_M5_RGBA",fe[fe.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",fe[fe.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",fe[fe.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",fe[fe.ATC_RGB=11]="ATC_RGB",fe[fe.ATC_RGBA=12]="ATC_RGBA",fe[fe.FXT1_RGB=17]="FXT1_RGB",fe[fe.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",fe[fe.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",fe[fe.ETC2_EAC_R11=20]="ETC2_EAC_R11",fe[fe.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",fe[fe.RGBA32=13]="RGBA32",fe[fe.RGB565=14]="RGB565",fe[fe.BGR565=15]="BGR565",fe[fe.RGBA4444=16]="RGBA4444"}(uZ||(uZ={}));let hZ=null,dZ=null;async function g$12(){return null==dZ&&(dZ=function i$24(){return cZ??(cZ=(async()=>{const fe=await zt((()=>import("./basis_transcoder-Cv2TSpl7.js")),[]),ve=await fe.default({locateFile:fe=>n$4t(`esri/libs/basisu/${fe}`)});return ve.initializeBasis(),ve})()),cZ}(),hZ=await dZ),dZ}function m$1F(fe,ve,_e,be,we){const Se=u$2B(ve?aA.COMPRESSED_RGBA8_ETC2_EAC:aA.COMPRESSED_RGB8_ETC2),Te=we&&fe>1?(4**fe-1)/(3*4**(fe-1)):1;return Math.ceil(_e*be*Se*Te)}function E$J(fe){return fe.getNumImages()>=1&&!fe.isUASTC()}function T$C(fe){return fe.getFaces()>=1&&fe.isETC1S()}function p$2c(fe,ve,_e,be,we,Se,Te,Ee){const{compressedTextureETC:Ce,compressedTextureS3TC:Oe}=fe.capabilities,[Re,De]=Ce?be?[uZ.ETC2_RGBA,aA.COMPRESSED_RGBA8_ETC2_EAC]:[uZ.ETC1_RGB,aA.COMPRESSED_RGB8_ETC2]:Oe?be?[uZ.BC3_RGBA,aA.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[uZ.BC1_RGB,aA.COMPRESSED_RGB_S3TC_DXT1_EXT]:[uZ.RGBA32,YO.RGBA],Be=ve.hasMipmap?_e:Math.min(1,_e),Ze=[];for(let Xe=0;Xe<Be;Xe++)Ze.push(new Uint8Array(Te(Xe,Re))),Ee(Xe,Re,Ze[Xe]);return ve.internalFormat=De,ve.hasMipmap=Ze.length>1,ve.samplingMode=ve.hasMipmap?HO.LINEAR_MIPMAP_LINEAR:HO.LINEAR,ve.width=we,ve.height=Se,new oM(fe,ve,{type:"compressed",levels:Ze})}const o$1s=()=>ar.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),pZ=542327876,fZ=131072,mZ=4;function s$20(fe){return fe.charCodeAt(0)+(fe.charCodeAt(1)<<8)+(fe.charCodeAt(2)<<16)+(fe.charCodeAt(3)<<24)}const yZ=s$20("DXT1"),gZ=s$20("DXT3"),vZ=s$20("DXT5"),_Z=31,$Z=0,bZ=1,wZ=2,xZ=3,SZ=4,TZ=7,EZ=20,PZ=21;function E$I(fe,ve,_e){const be=function S$R(fe,ve){const _e=new Int32Array(fe,0,_Z);if(_e[$Z]!==pZ)return o$1s().error("Invalid magic number in DDS header"),null;if(!(_e[EZ]&mZ))return o$1s().error("Unsupported format, must contain a FourCC code"),null;const be=_e[PZ];let we,Se;switch(be){case yZ:we=8,Se=aA.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case gZ:we=16,Se=aA.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case vZ:we=16,Se=aA.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return o$1s().error("Unsupported FourCC code:",function u$1J(fe){return String.fromCharCode(255&fe,fe>>8&255,fe>>16&255,fe>>24&255)}(be)),null}let Te=1,Ee=_e[SZ],Ce=_e[xZ];(3&Ee||3&Ce)&&(o$1s().warn("Rounding up compressed texture size to nearest multiple of 4."),Ee=Ee+3&-4,Ce=Ce+3&-4);const Oe=Ee,Re=Ce;let De,Be;_e[wZ]&fZ&&!1!==ve&&(Te=Math.max(1,_e[TZ]));let Ze=_e[bZ]+4;const Xe=[];for(let Je=0;Je<Te;++Je)Be=(Ee+3>>2)*(Ce+3>>2)*we,De=new Uint8Array(fe,Ze,Be),Xe.push(De),Ze+=Be,Ee=Math.max(1,Ee>>1),Ce=Math.max(1,Ce>>1);return{textureData:{type:"compressed",levels:Xe},internalFormat:Se,width:Oe,height:Re}}(_e,ve.hasMipmap??!1);if(null==be)throw new Error("DDS texture data is null");const{textureData:we,internalFormat:Se,width:Te,height:Ee}=be;return ve.samplingMode=we.levels.length>1?HO.LINEAR_MIPMAP_LINEAR:HO.LINEAR,ve.hasMipmap=we.levels.length>1,ve.internalFormat=Se,ve.width=Te,ve.height=Ee,new oM(fe,ve,we)}let CZ=class N3 extends iD{get parameters(){return this._parameters}constructor(fe,ve){super(),this._data=fe,this.type=eD.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new La,this._parameters={...AZ,...ve},this._startPreload(fe)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(fe){null!=fe&&(fe instanceof HTMLVideoElement?(this.frameUpdate=ve=>this._frameUpdate(fe,ve),this._startPreloadVideoElement(fe)):fe instanceof HTMLImageElement&&this._startPreloadImageElement(fe))}_startPreloadVideoElement(fe){if(!(Z$I(fe.src)||"auto"===fe.preload&&fe.crossOrigin)){fe.preload="auto",fe.crossOrigin="anonymous";const ve=!fe.paused;if(fe.src=fe.src,ve&&fe.autoplay){const t85=()=>{fe.removeEventListener("canplay",t85),fe.play()};fe.addEventListener("canplay",t85)}}}_startPreloadImageElement(fe){tt$k(fe.src)||Z$I(fe.src)||fe.crossOrigin||(fe.crossOrigin="anonymous",fe.src=fe.src)}_createDescriptor(fe){const ve=new nM;return ve.wrapMode=this._parameters.wrap??qO.REPEAT,ve.flipped=!this._parameters.noUnpackFlip,ve.samplingMode=this._parameters.mipmap?HO.LINEAR_MIPMAP_LINEAR:HO.LINEAR,ve.hasMipmap=!!this._parameters.mipmap,ve.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,ve.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?fe.parameters.maxMaxAnisotropy:1),ve}get glTexture(){return this._glTexture}get memoryEstimate(){var fe;return(null==(fe=this._glTexture)?void 0:fe.usedMemory)||function C$D(fe,ve){if(null==fe)return 0;if(t$4t(fe)||u$4g(fe))return ve.encoding===EA.KTX2_ENCODING?function c$22(fe,ve){if(null==hZ)return fe.byteLength;const _e=new hZ.KTX2File(new Uint8Array(fe)),be=T$C(_e)?m$1F(_e.getLevels(),_e.getHasAlpha(),_e.getWidth(),_e.getHeight(),ve):0;return _e.close(),_e.delete(),be}(fe,!!ve.mipmap):ve.encoding===EA.BASIS_ENCODING?function u$1K(fe,ve){if(null==hZ)return fe.byteLength;const _e=new hZ.BasisFile(new Uint8Array(fe)),be=E$J(_e)?m$1F(_e.getNumLevels(0),_e.getHasAlpha(),_e.getImageWidth(0,0),_e.getImageHeight(0,0),ve):0;return _e.close(),_e.delete(),be}(fe,!!ve.mipmap):fe.byteLength;const{width:_e,height:be}=fe instanceof Image||fe instanceof ImageData||fe instanceof HTMLCanvasElement||fe instanceof HTMLVideoElement?R$D(fe):ve;return(ve.mipmap?4/3:1)*_e*be*(ve.components||4)||0}(this._data,this._parameters)}load(fe){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const ve=this._data;return null==ve?(this._glTexture=new oM(fe,this._createDescriptor(fe),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof ve?this._loadFromURL(fe,ve):ve instanceof Image?this._loadFromImageElement(fe,ve):ve instanceof HTMLVideoElement?this._loadFromVideoElement(fe,ve):ve instanceof ImageData||ve instanceof HTMLCanvasElement?this._loadFromImage(fe,ve):(t$4t(ve)||u$4g(ve))&&this._parameters.encoding===EA.DDS_ENCODING?this._loadFromDDSData(fe,ve):(t$4t(ve)||u$4g(ve))&&this._parameters.encoding===EA.KTX2_ENCODING?this._loadFromKTX2(fe,ve):(t$4t(ve)||u$4g(ve))&&this._parameters.encoding===EA.BASIS_ENCODING?this._loadFromBasis(fe,ve):u$4g(ve)?this._loadFromPixelData(fe,ve):t$4t(ve)?this._loadFromPixelData(fe,new Uint8Array(ve)):null)}_frameUpdate(fe,ve){return null==this._glTexture||fe.readyState<OZ.HAVE_CURRENT_DATA||ve===fe.currentTime?ve:(this._glTexture.setData(fe),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),fe.currentTime)}_loadFromDDSData(fe,ve){return this._glTexture=E$I(fe,this._createDescriptor(fe),ve),this._glTexture}_loadFromKTX2(fe,ve){return this._loadAsync((()=>async function _$H(fe,ve,_e){null==hZ&&(hZ=await g$12());const be=new hZ.KTX2File(new Uint8Array(_e));if(!T$C(be))return null;be.startTranscoding();const we=p$2c(fe,ve,be.getLevels(),be.getHasAlpha(),be.getWidth(),be.getHeight(),((fe,ve)=>be.getImageTranscodedSizeInBytes(fe,0,0,ve)),((fe,ve,_e)=>be.transcodeImage(_e,fe,0,0,ve,0,-1,-1)));return be.close(),be.delete(),we}(fe,this._createDescriptor(fe),ve).then((fe=>(this._glTexture=fe,fe)))))}_loadFromBasis(fe,ve){return this._loadAsync((()=>async function h$1f(fe,ve,_e){null==hZ&&(hZ=await g$12());const be=new hZ.BasisFile(new Uint8Array(_e));if(!E$J(be))return null;be.startTranscoding();const we=p$2c(fe,ve,be.getNumLevels(0),be.getHasAlpha(),be.getImageWidth(0,0),be.getImageHeight(0,0),((fe,ve)=>be.getImageTranscodedSizeInBytes(0,fe,ve)),((fe,ve,_e)=>be.transcodeImage(_e,0,fe,ve,0,0)));return be.close(),be.delete(),we}(fe,this._createDescriptor(fe),ve).then((fe=>(this._glTexture=fe,fe)))))}_loadFromPixelData(fe,ve){s$31(this._parameters.width>0&&this._parameters.height>0);const _e=this._createDescriptor(fe);return _e.pixelFormat=1===this._parameters.components?YO.LUMINANCE:3===this._parameters.components?YO.RGB:YO.RGBA,_e.width=this._parameters.width??0,_e.height=this._parameters.height??0,this._glTexture=new oM(fe,_e,ve),this._glTexture}_loadFromURL(fe,ve){return this._loadAsync((async _e=>{const be=await t$1T(ve,{signal:_e});return s$4o(_e),this._loadFromImage(fe,be)}))}_loadFromImageElement(fe,ve){return ve.complete?this._loadFromImage(fe,ve):this._loadAsync((async _e=>{const be=await i$4v(ve,ve.src,!1,_e);return s$4o(_e),this._loadFromImage(fe,be)}))}_loadFromVideoElement(fe,ve){return ve.readyState>=OZ.HAVE_CURRENT_DATA?this._loadFromImage(fe,ve):this._loadFromVideoElementAsync(fe,ve)}_loadFromVideoElementAsync(fe,ve){return this._loadAsync((_e=>new Promise(((be,we)=>{const m39=()=>{ve.removeEventListener("loadeddata",h33),ve.removeEventListener("error",_21),l$4E(Se)},h33=()=>{ve.readyState>=OZ.HAVE_CURRENT_DATA&&(m39(),be(this._loadFromImage(fe,ve)))},_21=fe=>{m39(),we(fe||new Ir("Failed to load video"))};ve.addEventListener("loadeddata",h33),ve.addEventListener("error",_21);const Se=m$3R(_e,(()=>_21(u$47())))}))))}_loadFromImage(fe,ve){let _e=ve;if(!(_e instanceof HTMLVideoElement)){const{maxTextureSize:ve}=fe.parameters;_e=this._parameters.downsampleUncompressed?r$2t(_e,ve):function h$1U(fe,ve){const _e=Math.max(fe.width,fe.height);if(_e<=ve)return fe;const be=ve/_e;return o$2B(fe,Math.round(fe.width*be),Math.round(fe.height*be))}(_e,ve)}const be=R$D(_e);this._parameters.width=be.width,this._parameters.height=be.height;const we=this._createDescriptor(fe);return we.pixelFormat=3===this._parameters.components?YO.RGB:YO.RGBA,we.width=be.width,we.height=be.height,this._glTexture=new oM(fe,we,_e),this._glTexture}_loadAsync(fe){const ve=new AbortController;this._loadingController=ve;const _e=fe(ve.signal);this._loadingPromise=_e;const s84=()=>{this._loadingController===ve&&(this._loadingController=null),this._loadingPromise===_e&&(this._loadingPromise=null)};return _e.then(s84,s84),_e}unload(){if(this._glTexture=r$3M(this._glTexture),null!=this._loadingController){const fe=this._loadingController;this._loadingController=null,this._loadingPromise=null,fe.abort()}this.events.emit("unloaded")}};function R$D(fe){return fe instanceof HTMLVideoElement?{width:fe.videoWidth,height:fe.videoHeight}:fe}var OZ;!function(fe){fe[fe.HAVE_NOTHING=0]="HAVE_NOTHING",fe[fe.HAVE_METADATA=1]="HAVE_METADATA",fe[fe.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",fe[fe.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",fe[fe.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(OZ||(OZ={}));const AZ={wrap:{s:qO.REPEAT,t:qO.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},MZ=128,RZ=.5;function a$1_(fe){return"cross"===fe||"x"===fe}function u$1I(fe,ve=MZ,_e=ve*RZ,be=0){const we=c$20(fe,ve,_e,be);return new CZ(we,{mipmap:!1,wrap:{s:qO.CLAMP_TO_EDGE,t:qO.CLAMP_TO_EDGE},width:ve,height:ve,components:4,noUnpackFlip:!0,reloadable:!0})}function c$20(fe,ve=MZ,_e=ve*RZ,be=0){switch(fe){case"circle":default:return function s$1$(fe,ve){const _e=fe/2-.5;return x$H(fe,T$A(_e,_e,ve/2))}(ve,_e);case"square":return function i$22(fe,ve){return p$2a(fe,ve,!1)}(ve,_e);case"cross":return function h$1d(fe,ve,_e=0){return b$U(fe,ve,!1,_e)}(ve,_e,be);case"x":return function M$E(fe,ve,_e=0){return b$U(fe,ve,!0,_e)}(ve,_e,be);case"kite":return function f$1k(fe,ve){return p$2a(fe,ve,!0)}(ve,_e);case"triangle":return function l$24(fe,ve){return x$H(fe,w$W(fe/2,ve,ve/2))}(ve,_e);case"arrow":return function m$1D(fe,ve){const _e=ve,be=ve/2,we=fe/2,Se=.8*_e,Te=T$A(we,(fe-ve)/2-Se,Math.sqrt(Se*Se+be*be)),Ee=w$W(we,_e,be);return x$H(fe,((fe,ve)=>Math.max(Ee(fe,ve),-Te(fe,ve))))}(ve,_e)}}function p$2a(fe,ve,_e){return _e&&(ve/=Math.SQRT2),x$H(fe,((be,we)=>{let Se=be-.5*fe+.25,Te=.5*fe-we-.75;if(_e){const fe=(Se+Te)/Math.SQRT2;Te=(Te-Se)/Math.SQRT2,Se=fe}return Math.max(Math.abs(Se),Math.abs(Te))-.5*ve}))}function b$U(fe,ve,_e,be=0){ve-=be,_e&&(ve*=Math.SQRT2);const we=.5*ve;return x$H(fe,((ve,Se)=>{let Te,Ee=ve-.5*fe,Ce=.5*fe-Se-1;if(_e){const fe=(Ee+Ce)/Math.SQRT2;Ce=(Ce-Ee)/Math.SQRT2,Ee=fe}return Ee=Math.abs(Ee),Ce=Math.abs(Ce),Te=Ee>Ce?Ee>we?Math.sqrt((Ee-we)*(Ee-we)+Ce*Ce):Ce:Ce>we?Math.sqrt(Ee*Ee+(Ce-we)*(Ce-we)):Ee,Te-=be/2,Te}))}function T$A(fe,ve,_e){return(be,we)=>{const Se=be-fe,Te=we-ve;return Math.sqrt(Se*Se+Te*Te)-_e}}function w$W(fe,ve,_e){const be=Math.sqrt(ve*ve+_e*_e);return(we,Se)=>{const Te=Math.abs(we-fe)-_e,Ee=Se-fe+ve/2+.75,Ce=(ve*Te+_e*Ee)/be,Oe=-Ee;return Math.max(Ce,Oe)}}function x$H(fe,ve){const _e=new Uint8Array(4*fe*fe);for(let be=0;be<fe;be++)for(let we=0;we<fe;we++){const Se=we+fe*be;let Te=ve(we,be);Te=Te/fe+.5,o$1M(Te,_e,4*Se)}return _e}const IZ=64,LZ=IZ/2,DZ=LZ/5,NZ=IZ/DZ;function n$2e(fe,ve){const{vertex:_e,constants:be}=fe;be.add("markerSizePerLineWidth","float",NZ),w$1d(_e),null==_e.uniforms.get("markerScale")&&_e.constants.add("markerScale","float",1),_e.code.add(o$2P`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),ve.space===tZ.World&&(_e.constants.add("maxSegmentLengthFraction","float",.45),_e.uniforms.add(new dO("perRenderPixelRatio",((fe,ve)=>ve.camera.perRenderPixelRatio))),_e.code.add(o$2P`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var FZ;!function(fe){fe[fe.BUTT=0]="BUTT",fe[fe.SQUARE=1]="SQUARE",fe[fe.ROUND=2]="ROUND",fe[fe.COUNT=3]="COUNT"}(FZ||(FZ={}));let zZ=class s42 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.capType=FZ.BUTT,this.transparencyPassType=WR.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};e$4o([r$2w({count:NI.COUNT})],zZ.prototype,"output",void 0),e$4o([r$2w({count:FZ.COUNT})],zZ.prototype,"capType",void 0),e$4o([r$2w({count:WR.COUNT})],zZ.prototype,"transparencyPassType",void 0),e$4o([r$2w()],zZ.prototype,"occluder",void 0),e$4o([r$2w()],zZ.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],zZ.prototype,"hasPolygonOffset",void 0),e$4o([r$2w()],zZ.prototype,"writeDepth",void 0),e$4o([r$2w()],zZ.prototype,"draped",void 0),e$4o([r$2w()],zZ.prototype,"stippleEnabled",void 0),e$4o([r$2w()],zZ.prototype,"stippleOffColorEnabled",void 0),e$4o([r$2w()],zZ.prototype,"stipplePreferContinuous",void 0),e$4o([r$2w()],zZ.prototype,"roundJoins",void 0),e$4o([r$2w()],zZ.prototype,"applyMarkerOffset",void 0),e$4o([r$2w()],zZ.prototype,"vvSize",void 0),e$4o([r$2w()],zZ.prototype,"vvColor",void 0),e$4o([r$2w()],zZ.prototype,"vvOpacity",void 0),e$4o([r$2w()],zZ.prototype,"falloffEnabled",void 0),e$4o([r$2w()],zZ.prototype,"innerColorEnabled",void 0),e$4o([r$2w()],zZ.prototype,"hasOccludees",void 0),e$4o([r$2w()],zZ.prototype,"multipassEnabled",void 0),e$4o([r$2w()],zZ.prototype,"cullAboveGround",void 0),e$4o([r$2w()],zZ.prototype,"wireframe",void 0),e$4o([r$2w()],zZ.prototype,"objectAndLayerIdColorInstanced",void 0),e$4o([r$2w({constValue:!1})],zZ.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:!0})],zZ.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!0})],zZ.prototype,"hasSliceTranslatedView",void 0);function y$11(fe){const ve=new gO,{attributes:_e,varyings:be,constants:we,vertex:Se,fragment:Te}=ve;ve.include(t$2X),ve.include(c$26,fe),ve.include(d$1p,fe);const Ee=fe.applyMarkerOffset&&!fe.draped;Ee&&(Se.uniforms.add(new dO("markerScale",(fe=>fe.markerScale))),ve.include(n$2e,{space:tZ.World,draped:!1})),ve.include(d$1J,fe),d$1$(Se,fe),Se.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix)),new lO("nearFar",((fe,ve)=>ve.camera.nearFar)),new dO("miterLimit",(fe=>"miter"!==fe.join?0:fe.miterLimit)),new hO("viewport",((fe,ve)=>ve.camera.fullViewport))),Se.constants.add("LARGE_HALF_FLOAT","float",65500),_e.add(nO.POSITION,"vec3"),_e.add(nO.PREVPOSITION,"vec3"),_e.add(nO.NEXTPOSITION,"vec3"),_e.add(nO.SUBDIVISIONFACTOR,"float"),_e.add(nO.UV0,"vec2"),be.add("vColor","vec4"),be.add("vpos","vec3"),be.add("vLineDistance","float"),be.add("vLineWidth","float");const Ce=fe.multipassEnabled&&fe.output===NI.Color;Ce&&be.add("depth","float");const Oe=fe.stippleEnabled;Oe&&be.add("vLineSizeInv","float"),we.add("aaWidth","float",fe.stippleEnabled?0:1);const Re=fe.capType===FZ.ROUND,De=fe.stippleEnabled&&Re,Be=fe.falloffEnabled||De;Be&&be.add("vLineDistanceNorm","float"),Re&&(be.add("vSegmentSDF","float"),be.add("vReverseSegmentSDF","float")),Se.code.add(o$2P`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),Se.code.add(o$2P`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),Se.code.add(o$2P`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${Ce?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),w$1d(Se),Se.code.add(o$2P`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${Oe?o$2P`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),Ee&&Se.code.add(o$2P`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),Se.code.add(o$2P`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(fe.stippleEnabled||Re)&&Se.code.add(o$2P`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${Re?o$2P`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),Se.code.add(o$2P`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),fe.roundJoins?Se.code.add(o$2P`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${fe.stippleEnabled?o$2P`min(1.0, subdivisionFactor * ${o$2P.float(1.5)})`:o$2P`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):Se.code.add(o$2P`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const Ze=fe.capType!==FZ.BUTT;return Se.code.add(o$2P`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${Ze?o$2P`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),Se.code.add(o$2P`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${Be?o$2P`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),Re&&Se.code.add(o$2P`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),fe.stippleEnabled&&(fe.draped?Se.uniforms.add(new dO("worldToScreenRatio",((fe,ve)=>1/ve.screenToPCSRatio))):Se.code.add(o$2P`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),Se.code.add(o$2P`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),fe.draped?Se.code.add(o$2P`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):Se.code.add(o$2P`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),Se.uniforms.add(new dO("stipplePatternPixelSize",(fe=>S$S(fe)))),Se.code.add(o$2P`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),Se.code.add(o$2P`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${fe.wireframe&&!fe.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),Ce&&ve.include(a$2L,fe),ve.include(P$H,fe),Te.include(e$2S),Te.code.add(o$2P`
  void main() {
    discardBySlice(vpos);
    ${Ce?"terrainDepthTest(depth);":""}
  `),fe.wireframe?Te.code.add(o$2P`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(Re&&Te.code.add(o$2P`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${o$2P.float(yj)}) {
          discard;
        }
      `),De?Te.code.add(o$2P`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${o$2P.float(yj)}, stippleCoverage);
      `):Te.code.add(o$2P`float stippleAlpha = getStippleAlpha();`),fe.output!==NI.ObjectAndLayerIdColor&&Te.code.add(o$2P`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),Te.uniforms.add(new hO("intrinsicColor",(fe=>fe.color))),Te.code.add(o$2P`vec4 color = intrinsicColor * vColor;`),fe.innerColorEnabled&&(Te.uniforms.add(new hO("innerColor",(fe=>fe.innerColor??fe.color)),new dO("innerWidth",((fe,ve)=>fe.innerWidth*ve.camera.pixelRatio))),Te.code.add(o$2P`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),Te.code.add(o$2P`vec4 finalColor = blendStipple(color, stippleAlpha);`),fe.falloffEnabled&&(Te.uniforms.add(new dO("falloff",(fe=>fe.falloff))),Te.code.add(o$2P`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),fe.stippleEnabled||Te.code.add(o$2P`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),Te.code.add(o$2P`
    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${o$2P.float(yj)}) {
      discard;
    }

    ${fe.output===NI.Color?o$2P`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${fe.output===NI.Color&&fe.transparencyPassType===WR.ColorAlpha?o$2P`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${fe.output===NI.Highlight?o$2P`fragColor = vec4(1.0);`:""}
    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`outputObjectAndLayerIdColor();`:""}
  }
  `),ve}const kZ=Object.freeze(Object.defineProperty({__proto__:null,build:y$11,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"})),UZ=new Map([[nO.POSITION,0],[nO.PREVPOSITION,1],[nO.NEXTPOSITION,2],[nO.SUBDIVISIONFACTOR,3],[nO.UV0,4],[nO.COLOR,5],[nO.COLORFEATUREATTRIBUTE,5],[nO.SIZE,6],[nO.SIZEFEATUREATTRIBUTE,6],[nO.OPACITYFEATUREATTRIBUTE,7],[nO.OBJECTANDLAYERIDCOLOR,8]]);let VZ=class j7 extends fA{initializeProgram(fe){return new gA(fe.rctx,j7.shader.get().build(this.configuration),UZ)}_makePipelineState(fe,ve){const _e=this.configuration,be=fe===WR.NONE,we=fe===WR.FrontFace,Se=function t$2P(fe){return r$2k(fe)||fe===NI.Depth||fe===NI.Normal||fe===NI.ObjectAndLayerIdColor}(_e.output);return S$1g({blending:_e.output===NI.Color?be?_j:c$2o(fe):null,depthTest:{func:f$1O(fe)},depthWrite:be?_e.writeDepth||Se?OA:null:l$2s(fe),drawBuffers:_e.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e.hasOccludees?qH:null,stencilTest:_e.hasOccludees?ve?ZH:YH:null,polygonOffset:be||we?_e.hasPolygonOffset?BZ:null:wj})}initializePipeline(){const fe=this.configuration;if(fe.occluder){const ve=fe.hasPolygonOffset?BZ:null;this._occluderPipelineTransparent=S$1g({blending:_j,polygonOffset:ve,depthTest:HH,depthWrite:null,colorWrite:AA,stencilWrite:null,stencilTest:JH,drawBuffers:fe.output===NI.Depth?{buffers:[sA.NONE]}:null}),this._occluderPipelineOpaque=S$1g({blending:_j,polygonOffset:ve,depthTest:HH,depthWrite:null,colorWrite:AA,stencilWrite:WH,stencilTest:XH,drawBuffers:fe.output===NI.Depth?{buffers:[sA.NONE]}:null}),this._occluderPipelineMaskWrite=S$1g({blending:null,polygonOffset:ve,depthTest:GH,depthWrite:null,colorWrite:null,stencilWrite:qH,stencilTest:ZH,drawBuffers:fe.output===NI.Depth?{buffers:[sA.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?NO.LINES:NO.TRIANGLE_STRIP}getPipeline(fe,ve,_e){return fe?this._occludeePipelineState:this.configuration.occluder?_e?this._occluderPipelineTransparent:ve?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};VZ.shader=new LO(kZ,(()=>zt((()=>Promise.resolve().then((()=>cRe))),void 0)));const BZ={factor:0,units:-4};var jZ;!function(fe){fe[fe.LEFT_JOIN_START=-2]="LEFT_JOIN_START",fe[fe.LEFT_JOIN_END=-1]="LEFT_JOIN_END",fe[fe.LEFT_CAP_START=-4]="LEFT_CAP_START",fe[fe.LEFT_CAP_END=-5]="LEFT_CAP_END",fe[fe.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",fe[fe.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",fe[fe.RIGHT_CAP_START=4]="RIGHT_CAP_START",fe[fe.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(jZ||(jZ={}));let GZ=class z6 extends QB{constructor(fe){super(fe,new qZ),this._configuration=new zZ,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>fe===NI.Highlight||fe===NI.ObjectAndLayerIdColor||fe===NI.Color&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.OPAQUE_NO_SSAO_DEPTH,fe=>g$1A(fe)],[qR.OCCLUDER_MATERIAL,fe=>c$2L(fe)&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.TRANSPARENT_OCCLUDER_MATERIAL,fe=>c$2L(fe)&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.TRANSPARENT_MATERIAL,fe=>fe===NI.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==ej.OccludeAndTransparentStencil],[qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,fe=>fe===NI.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==ej.OccludeAndTransparentStencil],[qR.DRAPED_MATERIAL,fe=>e$2L(fe)]]),this._vertexAttributeLocations=UZ}getConfiguration(fe,ve){this._configuration.output=fe,this._configuration.draped=ve.slot===qR.DRAPED_MATERIAL;const _e=null!=this.parameters.stipplePattern&&fe!==NI.Highlight;return this._configuration.stippleEnabled=_e,this._configuration.stippleOffColorEnabled=_e&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=_e&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function q$t(fe){return fe.anchor===rZ.Tip&&fe.hideOnShortSegments&&"begin-end"===fe.placement&&fe.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===ej.OccludeAndTransparentStencil,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(fe,ve,_e,be,we,Se){if(!_e.options.selectionMode)return;const Te=fe.attributes.get(nO.POSITION).data,Ee=fe.attributes.get(nO.SIZE);let Ce=this.parameters.width;if(this.parameters.vvSize){const ve=fe.attributes.get(nO.SIZEFEATUREATTRIBUTE).data[0];Ce*=e$3Y(this.parameters.vvSize.offset[0]+ve*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else Ee&&(Ce*=Ee.data[0]);const Oe=be[0],Re=be[1],De=(Ce/2+4)*fe.screenToWorldRatio;let Be=Number.MAX_VALUE,Ze=0;for(let Xe=0;Xe<Te.length-5;Xe+=3){const fe=Te[Xe],ve=Te[Xe+1],_e=Oe-fe,be=Re-ve,we=Te[Xe+3]-fe,Se=Te[Xe+4]-ve,Ee=e$3Y((we*_e+Se*be)/(we*we+Se*Se),0,1),Ce=we*Ee-_e,De=Se*Ee-be,Je=Ce*Ce+De*De;Je<Be&&(Be=Je,Ze=Xe/3)}Be<De*De&&we(Se.dist,Se.normal,Ze,!1)}intersect(fe,ve,_e,be,we,Se){if(!_e.options.selectionMode||!fe.visible)return;if(!m$2q(ve))return void ar.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const Te=fe.attributes,Ee=Te.get(nO.POSITION).data;let Ce=this.parameters.width;if(this.parameters.vvSize){const fe=Te.get(nO.SIZEFEATUREATTRIBUTE).data[0];Ce*=e$3Y(this.parameters.vvSize.offset[0]+fe*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else Te.has(nO.SIZE)&&(Ce*=Te.get(nO.SIZE).data[0]);const Oe=_e.camera,Re=QZ;r$2C(Re,_e.point);const De=Ce*Oe.pixelRatio/2+4*Oe.pixelRatio;o$44(lX[0],Re[0]-De,Re[1]+De,0),o$44(lX[1],Re[0]+De,Re[1]+De,0),o$44(lX[2],Re[0]+De,Re[1]-De,0),o$44(lX[3],Re[0]-De,Re[1]-De,0);for(let dt=0;dt<4;dt++)if(!Oe.unprojectFromRenderScreen(lX[dt],cX[dt]))return;b$1Z(Oe.eye,cX[0],cX[1],uX),b$1Z(Oe.eye,cX[1],cX[2],hX),b$1Z(Oe.eye,cX[2],cX[3],dX),b$1Z(Oe.eye,cX[3],cX[0],pX);let Be=Number.MAX_VALUE,Ze=0;const Xe=Y$h(this.parameters,Te)?Ee.length-2:Ee.length-5;for(let dt=0;dt<Xe;dt+=3){YZ[0]=Ee[dt]+ve[12],YZ[1]=Ee[dt+1]+ve[13],YZ[2]=Ee[dt+2]+ve[14];const fe=(dt+3)%Ee.length;if(ZZ[0]=Ee[fe]+ve[12],ZZ[1]=Ee[fe+1]+ve[13],ZZ[2]=Ee[fe+2]+ve[14],V$12(uX,YZ)<0&&V$12(uX,ZZ)<0||V$12(hX,YZ)<0&&V$12(hX,ZZ)<0||V$12(dX,YZ)<0&&V$12(dX,ZZ)<0||V$12(pX,YZ)<0&&V$12(pX,ZZ)<0)continue;if(Oe.projectToRenderScreen(YZ,KZ),Oe.projectToRenderScreen(ZZ,eX),KZ[2]<0&&eX[2]>0){e$3Z(XZ,YZ,ZZ);const fe=Oe.frustum,ve=-V$12(fe[$R.NEAR],YZ)/P$1g(XZ,fe[$R.NEAR]);g$2z(XZ,XZ,ve),u$3Y(YZ,YZ,XZ),Oe.projectToRenderScreen(YZ,KZ)}else if(KZ[2]>0&&eX[2]<0){e$3Z(XZ,ZZ,YZ);const fe=Oe.frustum,ve=-V$12(fe[$R.NEAR],ZZ)/P$1g(XZ,fe[$R.NEAR]);g$2z(XZ,XZ,ve),u$3Y(ZZ,ZZ,XZ),Oe.projectToRenderScreen(ZZ,eX)}else if(KZ[2]<0&&eX[2]<0)continue;KZ[2]=0,eX[2]=0;const _e=j$1A(h$2z(KZ,eX,iX),Re);_e<Be&&(Be=_e,r$3w(tX,YZ),r$3w(rX,ZZ),Ze=dt/3)}const Je=_e.rayBegin,Qe=_e.rayEnd;if(Be<De*De){let fe=Number.MAX_VALUE;if(d$31(h$2z(tX,rX,iX),h$2z(Je,Qe,nX),JZ)){e$3Z(JZ,JZ,Je);const ve=s$4g(JZ);g$2z(JZ,JZ,1/ve),fe=ve/x$1W(Je,Qe)}Se(fe,JZ,Ze,!1)}}get _layout(){const fe=H$J().vec3f(nO.POSITION).vec3f(nO.PREVPOSITION).vec3f(nO.NEXTPOSITION).f32(nO.SUBDIVISIONFACTOR).vec2f(nO.UV0);return this.parameters.vvSize?fe.f32(nO.SIZEFEATUREATTRIBUTE):fe.f32(nO.SIZE),this.parameters.vvColor?fe.f32(nO.COLORFEATUREATTRIBUTE):fe.vec4f(nO.COLOR),this.parameters.vvOpacity&&fe.f32(nO.OPACITYFEATUREATTRIBUTE),has("enable-feature:objectAndLayerId-rendering")&&fe.vec4u8(nO.OBJECTANDLAYERIDCOLOR),fe}createBufferWriter(){return new WZ(this._layout,this.parameters)}createGLMaterial(fe){return new HZ(fe)}validateParameters(fe){"miter"!==fe.join&&(fe.miterLimit=0),null!=fe.markerParameters&&(fe.markerScale=fe.markerParameters.width/fe.width)}},HZ=class k2 extends pM{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){this._output===NI.Color&&this._updateOccludeeState(fe);const ve=this._material.parameters.stipplePattern;return this._stipplePattern!==ve&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(ve,this._stipplePattern)}),this._stipplePattern=ve),this.ensureTechnique(VZ,fe)}},qZ=class V2 extends pj{constructor(){super(...arguments),this.width=0,this.color=$d,this.join="miter",this.cap=FZ.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},WZ=class Z{constructor(fe,ve){this.vertexBufferLayout=fe,this._parameters=ve,this.numJoinSubdivisions=0;const _e=ve.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=_e;break;case"round":this.numJoinSubdivisions=1+_e}}_isClosed(fe){return Y$h(this._parameters,fe.attributes)}allocate(fe){return this.vertexBufferLayout.createBuffer(fe)}elementCount(fe){const ve=fe.attributes.get(nO.POSITION).indices.length/2+1,_e=this._isClosed(fe);let be=_e?2:4;return be+=((_e?ve:ve-1)-(_e?0:1))*(2*this.numJoinSubdivisions+4),be+=2,this._parameters.wireframe&&(be=2+4*(be-2)),be}write(fe,ve,_e,be,we){var Se,Te,Ee;const Ce=sX,Oe=oX,Re=aX,De=_e.attributes.get(nO.POSITION),Be=De.indices,Ze=De.data.length/3,Xe=null==(Se=_e.attributes.get(nO.DISTANCETOSTART))?void 0:Se.data;Be&&Be.length;const Je=(null==(Te=_e.attributes.get(nO.SIZEFEATUREATTRIBUTE))?void 0:Te.data[0])??(null==(Ee=_e.attributes.get(nO.SIZE))?void 0:Ee.data[0])??1;let Qe=[1,1,1,1],dt=0;const $t=this.vertexBufferLayout.fields.has(nO.COLORFEATUREATTRIBUTE);$t?dt=_e.attributes.get(nO.COLORFEATUREATTRIBUTE).data[0]:_e.attributes.has(nO.COLOR)&&(Qe=_e.attributes.get(nO.COLOR).data);const bt=has("enable-feature:objectAndLayerId-rendering")?_e.objectAndLayerIdColor:null,wt=this.vertexBufferLayout.fields.has(nO.OPACITYFEATUREATTRIBUTE),xt=wt?_e.attributes.get(nO.OPACITYFEATUREATTRIBUTE).data[0]:0,St=new Float32Array(be.buffer),Et=has("enable-feature:objectAndLayerId-rendering")?new Uint8Array(be.buffer):null,Pt=this.vertexBufferLayout.stride/4;let Ot=we*Pt;const At=Ot;let Mt=0;const Rt=Xe?(fe,ve,_e)=>Mt=Xe[_e]:(fe,ve,_e)=>Mt+=x$1W(fe,ve),Nt=has("enable-feature:objectAndLayerId-rendering"),y16=(fe,ve,_e,be,we,Se,Te)=>{if(St[Ot++]=ve[0],St[Ot++]=ve[1],St[Ot++]=ve[2],St[Ot++]=fe[0],St[Ot++]=fe[1],St[Ot++]=fe[2],St[Ot++]=_e[0],St[Ot++]=_e[1],St[Ot++]=_e[2],St[Ot++]=be,St[Ot++]=Te,St[Ot++]=we,St[Ot++]=Je,$t)St[Ot++]=dt;else{const fe=Math.min(4*Se,Qe.length-4);St[Ot++]=Qe[fe],St[Ot++]=Qe[fe+1],St[Ot++]=Qe[fe+2],St[Ot++]=Qe[fe+3]}wt&&(St[Ot++]=xt),Nt&&(null!=bt&&(Et[4*Ot]=bt[0],Et[4*Ot+1]=bt[1],Et[4*Ot+2]=bt[2],Et[4*Ot+3]=bt[3]),Ot++)};Ot+=Pt,o$44(Oe,De.data[0],De.data[1],De.data[2]),fe&&O$1v(Oe,Oe,fe);const Ft=this._isClosed(_e);if(Ft){const ve=De.data.length-3;o$44(Ce,De.data[ve],De.data[ve+1],De.data[ve+2]),fe&&O$1v(Ce,Ce,fe)}else o$44(Re,De.data[3],De.data[4],De.data[5]),fe&&O$1v(Re,Re,fe),y16(Oe,Oe,Re,1,jZ.LEFT_CAP_START,0,0),y16(Oe,Oe,Re,1,jZ.RIGHT_CAP_START,0,0),r$3w(Ce,Oe),r$3w(Oe,Re);const zt=Ft?0:1,kt=Ft?Ze:Ze-1;for(let Bt=zt;Bt<kt;Bt++){const ve=(Bt+1)%Ze*3;o$44(Re,De.data[ve],De.data[ve+1],De.data[ve+2]),fe&&O$1v(Re,Re,fe),Rt(Ce,Oe,Bt),y16(Ce,Oe,Re,0,jZ.LEFT_JOIN_END,Bt,Mt),y16(Ce,Oe,Re,0,jZ.RIGHT_JOIN_END,Bt,Mt);const _e=this.numJoinSubdivisions;for(let fe=0;fe<_e;++fe){const ve=(fe+1)/(_e+1);y16(Ce,Oe,Re,ve,jZ.LEFT_JOIN_END,Bt,Mt),y16(Ce,Oe,Re,ve,jZ.RIGHT_JOIN_END,Bt,Mt)}y16(Ce,Oe,Re,1,jZ.LEFT_JOIN_START,Bt,Mt),y16(Ce,Oe,Re,1,jZ.RIGHT_JOIN_START,Bt,Mt),r$3w(Ce,Oe),r$3w(Oe,Re)}Ft?(o$44(Re,De.data[3],De.data[4],De.data[5]),fe&&O$1v(Re,Re,fe),Mt=Rt(Ce,Oe,kt),y16(Ce,Oe,Re,0,jZ.LEFT_JOIN_END,zt,Mt),y16(Ce,Oe,Re,0,jZ.RIGHT_JOIN_END,zt,Mt)):(Mt=Rt(Ce,Oe,kt),y16(Ce,Oe,Oe,0,jZ.LEFT_CAP_END,kt,Mt),y16(Ce,Oe,Oe,0,jZ.RIGHT_CAP_END,kt,Mt)),W$n(St,At+Pt,St,At,Pt),Ot=W$n(St,Ot-Pt,St,Ot,Pt),this._parameters.wireframe&&this._addWireframeVertices(be,At,Ot,Pt)}_addWireframeVertices(fe,ve,_e,be){const we=new Float32Array(fe.buffer,_e*Float32Array.BYTES_PER_ELEMENT),Se=new Float32Array(fe.buffer,ve*Float32Array.BYTES_PER_ELEMENT,_e-ve);let Te=0;const o39=fe=>Te=W$n(Se,fe,we,Te,be);for(let Ee=0;Ee<Se.length-1;Ee+=2*be)o39(Ee),o39(Ee+2*be),o39(Ee+1*be),o39(Ee+2*be),o39(Ee+1*be),o39(Ee+3*be)}};function W$n(fe,ve,_e,be,we){for(let Se=0;Se<we;Se++)_e[be++]=fe[ve++];return be}function Y$h(fe,ve){return!!fe.isClosed&&ve.get(nO.POSITION).indices.length>2}const YZ=[0,0,0],ZZ=[0,0,0],XZ=[0,0,0],JZ=[0,0,0],QZ=[0,0,0],KZ=x$1H(),eX=x$1H(),tX=[0,0,0],rX=[0,0,0],iX=v$1Q(),nX=v$1Q(),sX=[0,0,0],oX=[0,0,0],aX=[0,0,0],lX=[x$1H(),x$1H(),x$1H(),x$1H()],cX=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],uX=E$1z(),hX=E$1z(),dX=E$1z(),pX=E$1z();let fX=class _5{constructor(fe){this._originSR=fe,this._rootOriginId="root/"+e$44(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(fe){const ve=this._origins.get(this._rootOriginId);if(null==ve){const ve=t$1W(fe[0]+Math.random()-.5,fe[1]+Math.random()-.5,fe[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,ve),ve}const _e=this._gridSize,be=Math.round(fe[0]/_e),we=Math.round(fe[1]/_e),Se=Math.round(fe[2]/_e),Te=`${be}/${we}/${Se}`;let Ee=this._origins.get(Te);const Ce=.5*_e;if(e$3Z(mX,fe,ve.vec3),mX[0]=Math.abs(mX[0]),mX[1]=Math.abs(mX[1]),mX[2]=Math.abs(mX[2]),mX[0]<Ce&&mX[1]<Ce&&mX[2]<Ce){if(Ee){const ve=Math.max(...mX);if(e$3Z(mX,fe,Ee.vec3),mX[0]=Math.abs(mX[0]),mX[1]=Math.abs(mX[1]),mX[2]=Math.abs(mX[2]),Math.max(...mX)<ve)return Ee}return ve}return Ee||(Ee=t$1W(be*_e,we*_e,Se*_e,Te),this._origins.set(Te,Ee)),Ee}_drawOriginBox(fe,ve=r$35(1,1,0,1)){const _e=window.view,be=_e._stage,we=ve.toString();if(!this._objects.has(we)){this._material=new GZ({width:2,color:ve}),be.add(this._material);const fe=new eZ(be,{pickable:!1}),_e=new Qq({castShadow:!1});be.add(_e),fe.add(_e),this._objects.set(we,_e)}const Se=this._objects.get(we),Te=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],Ee=Te.length,Ce=new Array(3*Ee),Oe=new Array,Re=.5*this._gridSize;for(let Be=0;Be<Ee;Be++)Ce[3*Be]=fe[0]+(1&Te[Be]?Re:-Re),Ce[3*Be+1]=fe[1]+(2&Te[Be]?Re:-Re),Ce[3*Be+2]=fe[2]+(4&Te[Be]?Re:-Re),Be>0&&Oe.push(Be-1,Be);n$49(Ce,this._originSR,0,Ce,_e.renderSpatialReference,0,Ee);const De=new pD(this._material,[[nO.POSITION,new Om(Ce,Oe,3,!0)]],null,eD.Line);be.add(De),Se.addGeometry(De)}get test(){}};const mX=[0,0,0];let yX=class a23{constructor(fe,ve,_e=null){this.rctx=fe,this.sliceHelper=_e,this.lastFrameCamera=new NR,this.output=NI.Color,this.renderOccludedMask=vX,this.bindParameters=new uI(ve,null!=_e?_e.plane:null),this.bindParameters.alignPixelEnabled=!0}},gX=class n20 extends yX{constructor(fe,ve,_e,be){super(fe,_e,be),this.offscreenRenderingHelper=ve,this.sliceHelper=be,this.time=0}};const vX=ej.Occlude|ej.OccludeAndTransparent|ej.OccludeAndTransparentStencil;let _X=class i25 extends NR{constructor(){super(...arguments),this._projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}get projectionMatrix(){return this._projectionMatrix}};var $X;e$4o([y$2v()],_X.prototype,"_projectionMatrix",void 0),e$4o([y$2v({readOnly:!0})],_X.prototype,"projectionMatrix",null),_X=e$4o([a$4y("esri.views.3d.webgl-engine.lib.CascadeCamera")],_X),function(fe){fe[fe.Highlight=0]="Highlight",fe[fe.ExcludeHighlight=1]="ExcludeHighlight"}($X||($X={}));let bX=class q3{constructor(){this.camera=new _X,this.lightMat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},wX=class k3{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},xX=class G5{constructor(fe,ve){this._fbos=fe,this._viewingMode=ve,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new wX,this._projectionView=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._projectionViewInverse=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._modelViewLight=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=[0,0,0,0],this._cascades=[new bX,new bX,new bX,new bX],this._lastOrigin=null,this._maxTextureWidth=Math.min(has("esri-mobile")?4096:16384,fe.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var fe;return null==(fe=this._handle)?void 0:fe.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return s$3I(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=t$4r(this._handle),this._discardSnapshots()}set maxCascades(fe){this.settings.maxNumCascadesHighQuality=e$3Y(Math.floor(fe),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(fe){this._enabled=fe,fe||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let fe=0;fe<this._numCascades;++fe)IX[fe]=this._cascades[fe];return IX.length=this._numCascades,IX}start(fe,ve,_e,be,we){s$31(this.enabled);const{near:Se,far:Te}=function jt$2(fe){let{near:ve,far:_e}=fe;return ve<2&&(ve=2),_e<2&&(_e=2),ve>=_e&&(ve=2,_e=4),{near:ve,far:_e}}(_e);this._computeCascadeDistances(Se,Te,be),this._textureHeight=this._computeTextureHeight(fe,we,be),this._setupMatrices(fe,ve);const{viewMatrix:Ee,projectionMatrix:Ce}=fe;for(let Oe=0;Oe<this._numCascades;++Oe)this._constructCascade(Oe,Ce,Ee,ve);this._lastOrigin=null,this.clear()}finish(){var fe;s$31(this.enabled),null==(fe=this._handle)||fe.detachDepth()}getShadowMapMatrices(fe){if(!this._lastOrigin||!G$$(fe,this._lastOrigin)){this._lastOrigin=this._lastOrigin||[0,0,0],r$3w(this._lastOrigin,fe);for(let ve=0;ve<this._numCascades;++ve){i$45(LX,this._cascades[ve].lightMat,fe);for(let fe=0;fe<16;++fe)DX[16*ve+fe]=LX[fe]}}return DX}moveSnapshot(fe){var ve,_e;s$31(this.enabled),null==(ve=this._handle)||ve.detachDepth(),null==(_e=this._snapshots[fe])||_e.release(),this._snapshots[fe]=this._handle,this._handle=null,this.clear()}copySnapshot(fe){var ve,_e,be,we;const Se=null==(_e=null==(ve=this._handle)?void 0:ve.getTexture())?void 0:_e.descriptor;if(!this.enabled||!Se)return;null==(be=this._snapshots[fe])||be.release();const{width:Te,height:Ee}=Se,Ce=fe===$X.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[fe]=this._fbos.acquire(Te,Ee,Ce,YA.RGBA4);const Oe=this._fbos.rctx;this._bindFbo();const Re=Oe.bindTexture(null==(we=this._snapshots[fe])?void 0:we.getTexture(),oM.TEXTURE_UNIT_FOR_UPDATES);Oe.gl.copyTexSubImage2D(WO.TEXTURE_2D,0,0,0,0,0,Te,Ee),Oe.bindTexture(Re,oM.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(fe){var ve;return this.enabled?null==(ve=this._snapshots[fe])?void 0:ve.getTexture():null}clear(){const fe=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),fe.setClearColor(1,1,1,1),fe.clear(DO.COLOR_BUFFER_BIT|DO.DEPTH_BUFFER_BIT)}_computeTextureHeight(fe,ve,_e){const be=Math.min(window.devicePixelRatio,ve)/fe.pixelRatio,we=_e?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,Se=n$2$(Math.floor(Math.max(fe.fullWidth,fe.fullHeight)*be*we));return i$2R(Math.min(this._maxTextureWidth,this._numCascades*Se)/this._numCascades)}_ensureFbo(){var fe,ve,_e,be,we;(null==(ve=null==(fe=this._handle)?void 0:fe.fbo)?void 0:ve.width)===this._textureWidth&&(null==(_e=this._handle)?void 0:_e.fbo.height)===this._textureHeight||(null==(be=this._handle)||be.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",YA.RGBA4)),null==(we=this._handle)||we.acquireDepth(ZA.DEPTH16_BUFFER)}_discardSnapshot(fe){this._snapshots[fe]=t$4r(this._snapshots[fe])}_discardSnapshots(){for(let fe=0;fe<this._snapshots.length;++fe)this._discardSnapshot(fe);this._snapshots.length=0}_bindFbo(){var fe;const ve=this._fbos.rctx;ve.unbindTexture(this.depthTexture),ve.bindFramebuffer(null==(fe=this._handle)?void 0:fe.fbo)}_constructCascade(fe,ve,_e,be){const we=this._cascades[fe],Se=-this._cascadeDistances[fe],Te=-this._cascadeDistances[fe+1],Ee=(ve[10]*Se+ve[14])/Math.abs(ve[11]*Se+ve[15]),Ce=(ve[10]*Te+ve[14])/Math.abs(ve[11]*Te+ve[15]);s$31(Ee<Ce);for(let Be=0;Be<8;++Be){s$3I(TX,Be%4==0||Be%4==3?-1:1,Be%4==0||Be%4==1?-1:1,Be<4?Ee:Ce,1);const fe=EX[Be];z$13(fe,TX,this._projectionViewInverse),fe[0]/=fe[3],fe[1]/=fe[3],fe[2]/=fe[3]}j$1O(RX,EX[0]),we.camera.viewMatrix=i$45(SX,this._modelViewLight,RX);for(let Be=0;Be<8;++Be)O$1v(EX[Be],EX[Be],we.camera.viewMatrix);let Oe=EX[0][2],Re=EX[0][2];for(let Be=1;Be<8;++Be)Oe=Math.min(Oe,EX[Be][2]),Re=Math.max(Re,EX[Be][2]);Oe-=200,Re+=200,we.camera.near=-Re,we.camera.far=-Oe,function Tt$3(fe,ve,_e,be,we){const Se=1/EX[0][3],Te=1/EX[4][3];s$31(Se<Te);let Ee=Se+Math.sqrt(Se*Te);const Ce=Math.sin(m$3J(fe[2]*ve[0]+fe[6]*ve[1]+fe[10]*ve[2]));Ee/=Ce,function gt$5(fe,ve,_e,be,we,Se,Te,Ee){o$2R(NX,0,0);for(let xt=0;xt<4;++xt)u$2J(NX,NX,fe[xt]);l$31(NX,NX,.25),o$2R(FX,0,0);for(let xt=4;xt<8;++xt)u$2J(FX,FX,fe[xt]);l$31(FX,FX,.25),_$12(zX[0],fe[4],fe[5],.5),_$12(zX[1],fe[5],fe[6],.5),_$12(zX[2],fe[6],fe[7],.5),_$12(zX[3],fe[7],fe[4],.5);let Ce=0,Oe=b$1t(zX[0],NX);for(let xt=1;xt<4;++xt){const fe=b$1t(zX[xt],NX);fe<Oe&&(Oe=fe,Ce=xt)}e$35(kX,zX[Ce],fe[Ce+4]);const Re=kX[0];let De,Be;kX[0]=-kX[1],kX[1]=Re,e$35(UX,FX,NX),j$1a(UX,kX)<0&&x$1f(kX,kX),_$12(kX,kX,UX,_e),v$1k(kX,kX),De=Be=j$1a(e$35(VX,fe[0],NX),kX);for(let xt=1;xt<8;++xt){const ve=j$1a(e$35(VX,fe[xt],NX),kX);ve<De?De=ve:ve>Be&&(Be=ve)}r$2C(be,NX),l$31(VX,kX,De-ve),u$2J(be,be,VX);let Ze=-1,Xe=1,Je=0,Qe=0;for(let xt=0;xt<8;++xt){e$35(BX,fe[xt],be),v$1k(BX,BX);const ve=kX[0]*BX[1]-kX[1]*BX[0];ve>0?ve>Ze&&(Ze=ve,Je=xt):ve<Xe&&(Xe=ve,Qe=xt)}c$2W(Ze>0,"leftArea"),c$2W(Xe<0,"rightArea"),l$31(jX,kX,De),u$2J(jX,jX,NX),l$31(GX,kX,Be),u$2J(GX,GX,NX),HX[0]=-kX[1],HX[1]=kX[0];const dt=f$29(be,fe[Qe],GX,u$2J(VX,GX,HX),1,we),$t=f$29(be,fe[Je],GX,VX,1,Se),bt=f$29(be,fe[Je],jX,u$2J(VX,jX,HX),1,Te),wt=f$29(be,fe[Qe],jX,VX,1,Ee);c$2W(dt,"rayRay"),c$2W($t,"rayRay"),c$2W(bt,"rayRay"),c$2W(wt,"rayRay")}(EX,Ee,Ce,PX,CX,OX,AX,MX),function Ct$2(fe,ve,_e,be,we){e$35(WX,_e,be),l$31(WX,WX,.5),YX[0]=WX[0],YX[1]=WX[1],YX[2]=0,YX[3]=WX[1],YX[4]=-WX[0],YX[5]=0,YX[6]=WX[0]*WX[0]+WX[1]*WX[1],YX[7]=WX[0]*WX[1]-WX[1]*WX[0],YX[8]=1,YX[pt$4(0,2)]=-j$1a(bt$2(YX,0),fe),YX[pt$4(1,2)]=-j$1a(bt$2(YX,1),fe);let Se=j$1a(bt$2(YX,0),_e)+YX[pt$4(0,2)],Te=j$1a(bt$2(YX,1),_e)+YX[pt$4(1,2)],Ee=j$1a(bt$2(YX,0),be)+YX[pt$4(0,2)],Ce=j$1a(bt$2(YX,1),be)+YX[pt$4(1,2)];Se=-(Se+Ee)/(Te+Ce),YX[pt$4(0,0)]+=YX[pt$4(1,0)]*Se,YX[pt$4(0,1)]+=YX[pt$4(1,1)]*Se,YX[pt$4(0,2)]+=YX[pt$4(1,2)]*Se,Se=1/(j$1a(bt$2(YX,0),_e)+YX[pt$4(0,2)]),Te=1/(j$1a(bt$2(YX,1),_e)+YX[pt$4(1,2)]),YX[pt$4(0,0)]*=Se,YX[pt$4(0,1)]*=Se,YX[pt$4(0,2)]*=Se,YX[pt$4(1,0)]*=Te,YX[pt$4(1,1)]*=Te,YX[pt$4(1,2)]*=Te,YX[pt$4(2,0)]=YX[pt$4(1,0)],YX[pt$4(2,1)]=YX[pt$4(1,1)],YX[pt$4(2,2)]=YX[pt$4(1,2)],YX[pt$4(1,2)]+=1,Se=j$1a(bt$2(YX,1),ve)+YX[pt$4(1,2)],Te=j$1a(bt$2(YX,2),ve)+YX[pt$4(2,2)],Ee=j$1a(bt$2(YX,1),_e)+YX[pt$4(1,2)],Ce=j$1a(bt$2(YX,2),_e)+YX[pt$4(2,2)],Se=-.5*(Se/Te+Ee/Ce),YX[pt$4(1,0)]+=YX[pt$4(2,0)]*Se,YX[pt$4(1,1)]+=YX[pt$4(2,1)]*Se,YX[pt$4(1,2)]+=YX[pt$4(2,2)]*Se,Se=j$1a(bt$2(YX,1),ve)+YX[pt$4(1,2)],Te=j$1a(bt$2(YX,2),ve)+YX[pt$4(2,2)],Ee=-Te/Se,YX[pt$4(1,0)]*=Ee,YX[pt$4(1,1)]*=Ee,YX[pt$4(1,2)]*=Ee,we[0]=YX[0],we[1]=YX[1],we[2]=0,we[3]=YX[2],we[4]=YX[3],we[5]=YX[4],we[6]=0,we[7]=YX[5],we[8]=0,we[9]=0,we[10]=1,we[11]=0,we[12]=YX[6],we[13]=YX[7],we[14]=0,we[15]=YX[8]}(PX,CX,AX,MX,we.projectionMatrix),we.projectionMatrix[10]=2/(_e-be),we.projectionMatrix[14]=-(_e+be)/(_e-be)}(_e,be,Oe,Re,we.camera),c$4k(we.lightMat,we.camera.projectionMatrix,we.camera.viewMatrix);const De=this._textureHeight;we.camera.viewport=[fe*De,0,De,De]}_setupMatrices(fe,ve){c$4k(this._projectionView,fe.projectionMatrix,fe.viewMatrix),h$2A(this._projectionViewInverse,this._projectionView);const _e=this._viewingMode===Wf.Global?fe.eye:o$44(RX,0,0,1);X$w(this._modelViewLight,[0,0,0],[-ve[0],-ve[1],-ve[2]],_e)}_computeCascadeDistances(fe,ve,_e){const be=_e?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(function u$2I(fe,ve){return Math.log(fe)/Math.log(ve)}(ve/fe,4)),be);const we=(ve-fe)/this._numCascades,Se=(ve/fe)**(1/this._numCascades);let Te=fe,Ee=fe;for(let Ce=0;Ce<this._numCascades+1;++Ce)this._cascadeDistances[Ce]=f$3i(Te,Ee,this.settings.splitSchemeLambda),Te*=Se,Ee+=we}get test(){}};const SX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TX=[0,0,0,0],EX=[];for(let NRe=0;NRe<8;++NRe)EX.push([0,0,0,0]);const PX=[0,0],CX=[0,0],OX=[0,0],AX=[0,0],MX=[0,0],RX=[0,0,0],IX=[],LX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DX=dd.concat(dd,dd,dd,dd),NX=[0,0],FX=[0,0],zX=[[0,0],[0,0],[0,0],[0,0]],kX=[0,0],UX=[0,0],VX=[0,0],BX=[0,0],jX=[0,0],GX=[0,0],HX=[0,0];function pt$4(fe,ve){return 3*ve+fe}const qX=[0,0];function bt$2(fe,ve){return o$2R(qX,fe[ve],fe[ve+3]),qX}const WX=[0,0],YX=[1,0,0,0,1,0,0,0,1];function n$2c(fe){return o$3p(fe)&&fe.intersector===Zf.TERRAIN&&!!fe.target}let ZX=class i26 extends tm{constructor(fe,ve,_e){super(fe,ve),this.triangleNr=_e}};function o$1q(fe){return o$3p(fe)&&fe.intersector===Zf.OVERLAY&&!!fe.target}var XX,JX;!function(fe){fe[fe.ADD=0]="ADD",fe[fe.UPDATE=1]="UPDATE",fe[fe.REMOVE=2]="REMOVE"}(XX||(XX={})),function(fe){fe[fe.NONE=0]="NONE",fe[fe.VISIBILITY=1]="VISIBILITY",fe[fe.GEOMETRY=2]="GEOMETRY",fe[fe.TRANSFORMATION=4]="TRANSFORMATION",fe[fe.HIGHLIGHT=8]="HIGHLIGHT",fe[fe.OCCLUDEE=16]="OCCLUDEE"}(JX||(JX={}));let QX=class t44{constructor(fe,ve){this._material=fe,this._repository=ve,this._map=new Map}dispose(){this._map.forEach(((fe,ve)=>{null!=fe&&this._repository.release(this._material,ve)}))}load(fe,ve,_e){const be=this._material.produces.get(ve);if(!(null==be?void 0:be(_e)))return null;this._map.has(_e)||this._map.set(_e,this._repository.acquire(this._material,ve,_e));const we=this._map.get(_e);if(null!=we){if(we.ensureResources(fe)===bA.LOADED)return we;this._repository.requestRender()}return null}},KX=class s43 extends jH{constructor(fe=[0,0,0]){super(),this.origin=fe,this.slicePlaneLocalOrigin=this.origin}},eJ=class t45{constructor(fe=0,ve=0){this.from=fe,this.to=ve}get numElements(){return this.to-this.from}};function o$1p(fe){const ve=new Map;fe.forAll((fe=>ve.set(fe.from,fe)));let _e=!0;for(;_e;){_e=!1;for(let be=0;be<fe.length;++be){const we=fe.data[be],Se=ve.get(we.to);if(!Se)return;we.to=Se.to,ve.delete(Se.from),fe.removeUnordered(Se),_e=!0}}}let tJ=class s44 extends eJ{constructor(fe,ve,_e){super(ve,_e),this.geometry=fe}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}},rJ=class t46{constructor(){this.first=0,this.count=0}},iJ=class n21{constructor(){this._numElements=0,this._instances=new Map,this.holes=new jr({allocator:fe=>fe||new eJ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=o$1o(),this.drawCommandsHighlight=o$1o(),this.drawCommandsOccludees=o$1o(),this.drawCommandsShadowHighlightRest=o$1o()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(fe,ve){this.deleteInstance(fe),this._instances.set(fe,ve),this._numElements+=ve.numElements}deleteInstance(fe){const ve=this._instances.get(fe);ve&&(this._numElements-=ve.numElements,this._instances.delete(fe))}updateInstance(fe,ve,_e){const be=this._instances.get(fe);be&&(this._numElements-=be.numElements,be.from=ve,be.to=_e,this._numElements+=be.numElements)}updateDrawState(fe){fe.isVisible?(fe.hasHighlights&&(this.hasHighlights=!0),fe.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(fe){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const ve=this.drawCommandsDefault.pushNew(),_e=this.holes.front();return null!=this.vao&&1===this.holes.length&&_e.to===Math.floor(this.vao.byteSize/fe)?(ve.first=0,void(ve.count=_e.from)):(ve.first=1/0,ve.count=0,this._instances.forEach((fe=>{ve.first=Math.min(ve.first,fe.from),ve.count=Math.max(ve.count,fe.to)})),void(ve.count-=ve.first))}const ve=Array.from(this._instances.values()).sort(((fe,ve)=>fe.from===ve.from?fe.to-ve.to:fe.from-ve.from));for(const _e of ve)_e.isVisible&&(h$1c(_e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,_e),h$1c(_e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,_e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function o$1o(){return new jr({allocator:fe=>fe||new rJ,deallocator:fe=>fe})}function h$1c(fe,ve){const _e=fe.back();if(null==_e){const _e=fe.pushNew();return _e.first=ve.from,void(_e.count=ve.numElements)}if(function r$1F(fe,ve){return fe.first+fe.count>=ve.from}(_e,ve)){const fe=ve.from-_e.first+ve.numElements;_e.count=fe}else{const _e=fe.pushNew();_e.first=ve.from,_e.count=ve.numElements}}let nJ=class s45{constructor(fe){this.origin=fe,this.buffers=new Array}dispose(){this.buffers.forEach((fe=>fe.vao.dispose())),this.buffers.length=0}findBuffer(fe){return this.buffers.find((ve=>ve.instances.has(fe)))}};const sJ=-3;var oJ;!function(fe){fe[fe.ALL=0]="ALL",fe[fe.SOME=1]="SOME"}(oJ||(oJ={}));let aJ=class r27{constructor(fe,ve,_e){this.name=fe,this._storage=ve,this.id=cJ+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),_e&&(this._storage.registerRemoveFunc(this.id,_e),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(fe){return this._storage.getSize(this,fe)}resetHitRate(){this._hit=this._miss=0}put(fe,ve,_e,be=0){this._storage.put(this,fe,ve,_e,be)}pop(fe){const ve=this._storage.pop(this,fe);return void 0===ve?++this._miss:++this._hit,ve}get(fe){const ve=this._storage.get(this,fe);return void 0===ve?++this._miss:++this._hit,ve}peek(fe){return this._storage.peek(this,fe)}updateSize(fe,ve,_e){this._storage.updateSize(this,fe,ve,_e)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},lJ=class h14{get size(){return this._size}constructor(fe=10485760){this._maxSize=fe,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new jr,this._users=new jr}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(fe){this._users.push(fe)}deregister(fe){this._users.removeUnordered(fe)}registerRemoveFunc(fe,ve){this._removeFuncs.push([fe,ve])}deregisterRemoveFunc(fe){this._removeFuncs.filterInPlace((ve=>ve[0]!==fe))}get maxSize(){return this._maxSize}set maxSize(fe){this._maxSize=Math.max(fe,-1),this._checkSize()}getSize(fe,ve){const _e=this._db.get(fe.id+ve);return(null==_e?void 0:_e.size)??0}put(fe,ve,_e,be,we){ve=fe.id+ve;const Se=this._db.get(ve);if(Se&&(this._size-=Se.size,fe.size-=Se.size,this._db.delete(ve),Se.entry!==_e&&this._notifyRemove(ve,Se.entry,Se.size,oJ.ALL)),be>this._maxSize)return void this._notifyRemove(ve,_e,be,oJ.ALL);if(void 0===_e)return;if(!be||be<0)return void this._notifyRemove(ve,_e,0,oJ.ALL);const Te=1+Math.max(we,-4)- -3;this._db.set(ve,new uJ(_e,be,Te)),this._size+=be,fe.size+=be,this._checkSize()}updateSize(fe,ve,_e,be){ve=fe.id+ve;const we=this._db.get(ve);if(we&&we.entry===_e){for(this._size-=we.size,fe.size-=we.size;be>this._maxSize;){const fe=this._notifyRemove(ve,_e,be,oJ.SOME);if(!(null!=fe&&fe>0))return void this._db.delete(ve);be=fe}we.size=be,this._size+=be,fe.size+=be,this._checkSize()}}pop(fe,ve){ve=fe.id+ve;const _e=this._db.get(ve);if(_e)return this._size-=_e.size,fe.size-=_e.size,this._db.delete(ve),++this._hit,_e.entry;++this._miss}get(fe,ve){ve=fe.id+ve;const _e=this._db.get(ve);if(void 0!==_e)return this._db.delete(ve),_e.lives=_e.lifetime,this._db.set(ve,_e),++this._hit,_e.entry;++this._miss}peek(fe,ve){const _e=this._db.get(fe.id+ve);return _e?++this._hit:++this._miss,null==_e?void 0:_e.entry}get performanceInfo(){const fe={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},ve={},_e=new Array;this._db.forEach(((fe,be)=>{const we=fe.lifetime;_e[we]=(_e[we]||0)+fe.size,this._users.forAll((_e=>{const{id:we,name:Se}=_e;if(be.startsWith(we)){const _e=ve[Se]||0;ve[Se]=_e+fe.size}}))}));const be={};this._users.forAll((fe=>{const _e=fe.name;if("hitRate"in fe&&"number"==typeof fe.hitRate&&!isNaN(fe.hitRate)&&fe.hitRate>0){const we=ve[_e]||0;ve[_e]=we,be[_e]=Math.round(100*fe.hitRate)+"%"}else be[_e]="0%"}));const we=Object.keys(ve);we.sort(((fe,_e)=>ve[_e]-ve[fe])),we.forEach((_e=>fe[_e]=Math.round(ve[_e]/2**20)+"MB / "+be[_e]));for(let Se=_e.length-1;Se>=0;--Se){const ve=_e[Se];ve&&(fe["Priority "+(Se+-3-1)]=Math.round(ve/this._size*100)+"%")}return fe}resetStats(){this._hit=this._miss=0,this._users.forAll((fe=>fe.resetHitRate()))}clear(fe){const ve=fe.id;this._db.forEach(((fe,_e)=>{_e.startsWith(ve)&&(this._size-=fe.size,this._db.delete(_e),this._notifyRemove(_e,fe.entry,fe.size,oJ.ALL))})),fe.size=0}clearAll(){this._db.forEach(((fe,ve)=>this._notifyRemove(ve,fe.entry,fe.size,oJ.ALL))),this._users.forAll((fe=>fe.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(fe,ve,_e,be){let we;return this._removeFuncs.some((Se=>{if(fe.startsWith(Se[0])){const fe=Se[1](ve,be,_e);return"number"==typeof fe&&(we=fe),!0}return!1})),we}_checkSize(){this._users.forAll((fe=>this._checkSizeLimits(fe))),this._checkSizeLimits()}_checkSizeLimits(fe){const ve=fe??this;if(ve.maxSize<0||ve.size<=ve.maxSize)return;const _e=null==fe?void 0:fe.id;let be=!0;for(;be;){be=!1;for(const[we,Se]of this._db)if(0===Se.lifetime&&(!_e||we.startsWith(_e))){if(this._purgeItem(we,Se,fe),ve.size<=.9*ve.maxSize)return;be||(be=this._db.has(we))}}for(const[we,Se]of this._db)if((!_e||we.startsWith(_e))&&(this._purgeItem(we,Se,fe),ve.size<=.9*ve.maxSize))return}_purgeItem(fe,ve,_e=this._users.find((ve=>fe.startsWith(ve.id)))){if(this._db.delete(fe),ve.lives<=1){this._size-=ve.size,_e&&(_e.size-=ve.size);const be=this._notifyRemove(fe,ve.entry,ve.size,oJ.SOME);null!=be&&be>0&&(this._size+=be,_e&&(_e.size+=be),ve.lives=ve.lifetime,ve.size=be,this._db.set(fe,ve))}else--ve.lives,this._db.set(fe,ve)}},cJ=0,uJ=class n22{constructor(fe,ve,_e){this.entry=fe,this.size=ve,this.lifetime=_e,this.lives=_e}},hJ=class c30{constructor(fe,ve){this._cache=fe(ve,((fe,ve,_e)=>{switch(ve){case oJ.ALL:return fe.forEach((fe=>fe.dispose())),0;case oJ.SOME:{const ve=fe.shift();return ve&&(_e-=Math.round(ve.usedMemory),ve.dispose()),_e}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(fe){return this._cache.getSize(fe)}pop(fe){const ve=this._cache.peek(fe);if(!ve)return;const _e=ve.pop();if(ve.length>0){if(_e){const be=this._cache.getSize(fe)-Math.round(_e.usedMemory);this._cache.updateSize(fe,ve,be)}}else this._cache.pop(fe);return _e}put(fe,ve,_e=-4){const be=this._cache.peek(fe);if(!be)return void this._cache.put(fe,[ve],ve.usedMemory,_e);be.push(ve);const we=this._cache.getSize(fe)+Math.round(ve.usedMemory);this._cache.updateSize(fe,be,we)}},dJ=class s46{constructor(fe,ve,_e){this._rctx=fe,this._locations=ve,this._layout=_e,this._cache=new hJ(fe.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(fe){const ve=fe.toString();let _e=this._cache.pop(ve);return _e||(_e=new tM(this._rctx,this._locations,{geometry:this._layout},{geometry:rM.createVertex(this._rctx,QO.STATIC_DRAW)}),_e.vertexBuffers.geometry.setSize(fe),_e)}deleteVao(fe){if(null==fe)return;const ve=fe.byteSize.toString();this._cache.put(ve,fe)}},pJ=class S4 extends AN{constructor(fe){super(fe),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=r$3M(this._glMaterials),this._dataByOrigin.forEach((fe=>fe.dispose())),this._dataByOrigin.clear(),this._vaoCache=r$3M(this._vaoCache)}initialize(){this.material.produces.forEach(((fe,ve)=>{this._produces.set(ve,(ve=>!(0===this._dataByOrigin.size||!(ve!==NI.Highlight&&ve!==NI.ShadowHighlight||this._hasHighlights))&&fe(ve)))}))}get produces(){return this._produces}initializeRenderContext(fe,ve){const{rctx:_e}=fe.renderContext;this._glMaterials=new QX(this.material,ve??fe.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new dJ(_e,this.material.vertexAttributeLocations,t$2L(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(fe){return this.material.queryRenderOccludedState(fe)}get materialReference(){return this.material}get numGeometries(){let fe=0;return this._dataByOrigin.forEach((ve=>fe+=ve.buffers.reduce(((fe,ve)=>fe+ve.instances.size),0))),fe}get usedMemory(){let fe=0;return this._dataByOrigin.forEach((ve=>fe+=ve.buffers.reduce(((fe,ve)=>fe+ve.vao.usedMemory),0))),fe}forEachGeometry(fe){this._dataByOrigin.forEach((ve=>ve.buffers.forEach((ve=>ve.instances.forEach((ve=>fe(ve.geometry)))))))}modify(fe){this._updateGeometries(fe.updates),this._addAndRemoveGeometries(fe.adds,fe.removes),this._updateDrawCommands()}_updateGeometries(fe){const ve=this._bufferWriter;if(null===ve)return;const _e=ve.vertexBufferLayout.stride/4;for(const be of fe){const fe=be.renderGeometry,we=this._dataByOrigin.get(fe.localOrigin.id),Se=null==we?void 0:we.findBuffer(fe.id);if(null==Se)return;const Te=Se.instances.get(fe.id);if(be.updateType&(JX.GEOMETRY|JX.TRANSFORMATION)){const be=U$z(ve.elementCount(Te.geometry.geometry)*_e),we=ve.vertexBufferLayout.createView(be.buffer);this._writeGeometry(fe,we,0),Se.vao.vertexBuffers.geometry.setSubData(be,Te.from*_e,0,Te.numElements*_e)}be.updateType&(JX.HIGHLIGHT|JX.OCCLUDEE|JX.VISIBILITY)&&(Se.drawCommandsDirty=!0)}}_computeDeltas(fe,ve){const _e=new wU;for(const be of fe){const fe=be.localOrigin;if(null==fe)continue;let ve=_e.get(fe.id,null);null==ve&&(ve=new fJ(fe.vec3),_e.set(fe.id,null,ve)),ve.changes.push(be)}for(const be of ve){const fe=be.localOrigin;if(null==fe)continue;const ve=this._dataByOrigin.get(fe.id),we=null==ve?void 0:ve.findBuffer(be.id);if(null==we)continue;let Se=_e.get(fe.id,we);null==Se&&(Se=new fJ(fe.vec3),_e.set(fe.id,we,Se)),Se.changes.push(be)}return _e}_addAndRemoveGeometries(fe,ve){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:_e,_dataByOrigin:be}=this,we=_e.vertexBufferLayout.stride/4,Se=this._computeDeltas(fe,ve);Se.forEach(((fe,ve)=>{const Te=fe.get(null),Ee=null!=Te?Te.changes:[];Se.delete(ve,null);let Ce=be.get(ve);if(fe.forEach(((fe,Te)=>{if(Se.delete(ve,Te),null==Te)return void s$31(!1,"No VAO for removed geometries");if(Te.instances.size===fe.changes.length)return this._vaoCache.deleteVao(Te.vao),S$1U(Ce.buffers,Te),void(0===Ce.buffers.length&&0===Ee.length&&be.delete(ve));const Oe=Te.numElements,Re=Te.vao.byteSize/4,De=Ee.reduce(((fe,ve)=>fe+_e.elementCount(ve.geometry)),0),Be=fe.changes.reduce(((fe,ve)=>fe+_e.elementCount(ve.geometry)),0),Ze=Math.min((Oe+De-Be)*we,xJ),Xe=Ze>Re;Ze>_J&&Ze<Re/2?(fe.changes.forEach((({id:fe})=>Te.deleteInstance(fe))),Te.instances.forEach((({geometry:fe})=>Ee.push(fe))),this._vaoCache.deleteVao(Te.vao),S$1U(Ce.buffers,Te)):Xe?this._applyAndRebuild(Te,Ee,fe):this._applyRemoves(Te,fe)})),Ee.length>0)for(null==Ce&&(Ce=new nJ(Te.origin),be.set(ve,Ce)),Ce.buffers.forEach((fe=>this._applyAdds(fe,Ee)));Ee.length>0;)Ce.buffers.push(this._applyAndRebuild(new iJ,Ee,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((fe=>{fe.buffers.forEach((fe=>{fe.drawCommandsDirty&&(fe.hasHiddenInstances=!1,fe.hasHighlights=!1,fe.hasOccludees=!1,n$4E(fe.instances,(ve=>(fe.updateDrawState(ve),fe.hasHiddenInstances&&fe.hasHighlights&&fe.hasOccludees))),fe.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||fe.hasHighlights,this._hasOccludees=this._hasOccludees||fe.hasOccludees}))}))}_applyAndRebuild(fe,ve,_e){if(null!=_e)for(const Ze of _e.changes)fe.deleteInstance(Ze.id);const be=this._bufferWriter,we=be.vertexBufferLayout.stride,Se=we/4,Te=Math.floor(xJ/Se);let Ee=fe.numElements;for(;ve.length>0;){const _e=ve.pop(),we=be.elementCount(_e.geometry);if(Ee+we>Te&&Ee>0){ve.push(_e);break}Ee+=we;const Se=new tJ(_e,0,0);s$31(null==fe.instances.get(_e.id)),fe.addInstance(_e.id,Se)}const Ce=Ee*Se,Oe=U$z(Ce),Re=be.vertexBufferLayout.createView(Oe.buffer);let De=0;fe.hasHiddenInstances=!1,fe.hasHighlights=!1,fe.hasOccludees=!1,fe.instances.forEach(((ve,_e)=>{this._writeGeometry(ve.geometry,Re,De);const we=De;De+=be.elementCount(ve.geometry.geometry),fe.updateInstance(_e,we,De),fe.updateDrawState(ve)})),this._vaoCache.deleteVao(fe.vao),fe.vao=this._vaoCache.newVao(q$r(Ce)),fe.vao.vertexBuffers.geometry.setSubData(Oe,0,0,De*Se),fe.holes.clear();const Be=fe.holes.pushNew();return Be.from=De,Be.to=Math.floor(fe.vao.byteSize/we),fe.updateDrawCommands(we),fe}_applyRemoves(fe,ve){if(0===ve.changes.length||null===this._bufferWriter)return;for(const Te of ve.changes){const ve=Te.id,_e=fe.instances.get(ve);if(!_e)continue;fe.deleteInstance(ve);const be=vJ.back();if(be){if(be.to===_e.from){be.to=_e.to;continue}if(be.from===_e.to){be.from=_e.from;continue}}const we=vJ.pushNew();we.from=_e.from,we.to=_e.to}o$1p(vJ);const _e=this._bufferWriter.vertexBufferLayout.stride/4,be=vJ.reduce(((fe,ve)=>Math.max(fe,ve.numElements)),0)*_e,we=U$z(be);we.fill(0,0,be);const Se=fe.vao.vertexBuffers.geometry;vJ.forAll((fe=>Se.setSubData(we,fe.from*_e,0,fe.numElements*_e))),fe.holes.pushArray(vJ.data,vJ.length),vJ.forAll(((fe,ve)=>vJ.data[ve]=null)),vJ.clear(),fe.drawCommandsDirty=!0}_applyAdds(fe,ve){if(0===ve.length||null===this._bufferWriter)return;if(!function a$1Y(fe){return null!=fe.vao}(fe))return void this._applyAndRebuild(fe,ve,null);const _e=this._bufferWriter,be=_e.vertexBufferLayout.stride/4,we=fe.numElements,Se=ve.reduce(((fe,ve)=>fe+_e.elementCount(ve.geometry)),0),Te=Math.min((we+Se)*be,xJ),Ee=4*Te;if(fe.vao.byteSize<q$r(xJ-_J)&&Ee>fe.vao.byteSize)return void this._applyAndRebuild(fe,ve,null);o$1p(fe.holes);const Ce=new Array;for(const Qe of ve){const ve=_e.elementCount(Qe.geometry),be=M$D(fe.holes,ve);Ce.push(be)}const Oe=fe.vao.vertexBuffers.geometry;let Re=0,De=0,Be=0;const Ze=U$z(Te),Xe=_e.vertexBufferLayout.createView(Ze.buffer);ve.forEach(((ve,we)=>{const Se=Ce[we];if(null==Se)return;if(Be!==Se){const fe=Be-De;fe>0&&Oe.setSubData(Ze,De*be,0,fe*be),De=Se,Re=0}const Te=_e.elementCount(ve.geometry);this._writeGeometry(ve,Xe,Re),Re+=Te,Be=Se+Te;const Ee=new tJ(ve,Se,Se+Te);s$31(null==fe.instances.get(ve.id)),fe.addInstance(ve.id,Ee),fe.drawCommandsDirty=!0}));const Je=Be-De;Je>0&&Oe.setSubData(Ze,De*be,0,Je*be),I$1K(ve,((fe,ve)=>null==Ce[ve]))}_writeGeometry(fe,ve,_e){if(null===this._bufferWriter)return;const be=fe.localOrigin.vec3;!function l$30(fe,ve,_e,be){fe[12]=ve,fe[13]=_e,fe[14]=be}(mJ,-be[0],-be[1],-be[2]);const we=c$4k(yJ,mJ,fe.transformation);h$2A(gJ,we),s$3L(gJ,gJ),this._bufferWriter.write(we,gJ,fe.geometry,ve,_e)}updateAnimation(fe){return this.material.update(fe)}prepareTechnique(fe){if(!this.material.shouldRender(fe))return null;const{output:ve,bindParameters:_e}=fe,be=this.material.produces.get(_e.slot);if(!(null==be?void 0:be(ve)))return null;const we=ve===NI.Highlight||ve===NI.ShadowHighlight;if(we&&!this._hasHighlights)return null;const Se=ve===NI.ShadowExcludeHighlight,Te=!(we||Se);for(const Ee of this._dataByOrigin.values())for(const be of Ee.buffers){if(we&&!be.hasHighlights)continue;const Ee=(we?be.drawCommandsHighlight:Se&&be.needsMultipleCommands()?be.drawCommandsShadowHighlightRest:be.drawCommandsDefault)||null,Ce=Te&&be.drawCommandsOccludees||null;if((null==Ee?void 0:Ee.length)||(null==Ce?void 0:Ce.length)){const be=this._glMaterials.load(fe.rctx,_e.slot,ve),we=null!=be?be.beginSlot(_e):null;if(null!=we)return we}}return null}renderNode(fe,ve){const{output:_e,bindParameters:be}=fe,we=_e===NI.Highlight||_e===NI.ShadowHighlight,Se=_e===NI.ShadowExcludeHighlight,Te=!(we||Se),Ee=be.slot===qR.OCCLUDER_MATERIAL,Ce=be.slot===qR.TRANSPARENT_OCCLUDER_MATERIAL,Oe=fe.rctx;Oe.runAppleAmdDriverHelper(),Oe.bindTechnique(ve,be,this.material.parameters);for(const Re of this._dataByOrigin.values())for(const fe of Re.buffers){if(we&&!fe.hasHighlights)continue;const _e=(we?fe.drawCommandsHighlight:Se&&fe.needsMultipleCommands()?fe.drawCommandsShadowHighlightRest:fe.drawCommandsDefault)||null,De=Te&&fe.drawCommandsOccludees||null;((null==_e?void 0:_e.length)||(null==De?void 0:De.length))&&(ve.program.bindDraw(new KX(Re.origin),be,this.material.parameters),ve.ensureAttributeLocations(fe.vao),Oe.bindVAO(fe.vao),(null==_e?void 0:_e.length)&&(Oe.setPipelineState(ve.getPipeline(!1,Ee,Ce)),_e.forAll((fe=>Oe.drawArrays(ve.primitiveType,fe.first,fe.count)))),(null==De?void 0:De.length)&&(Oe.setPipelineState(ve.getPipeline(!0,Ee,Ce)),De.forAll((fe=>Oe.drawArrays(ve.primitiveType,fe.first,fe.count)))))}}get test(){}};e$4o([y$2v({constructOnly:!0})],pJ.prototype,"material",void 0),pJ=e$4o([a$4y("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],pJ);let fJ=class x7{constructor(fe){this.origin=fe,this.changes=new Array}};function M$D(fe,ve){let _e;if(!fe.some((fe=>!(fe.numElements<ve||(_e=fe,0)))))return null;const be=_e.from;return _e.from+=ve,_e.from>=_e.to&&fe.removeUnordered(_e),be}const mJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],yJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],gJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],vJ=new jr({allocator:fe=>fe||new eJ,deallocator:null}),_J=65536,$J=4*_J,bJ=1024,wJ=16777216,xJ=wJ/4;let SJ=new Float32Array(_J);function U$z(fe){return SJ.length<fe&&(SJ=new Float32Array(fe)),SJ}function q$r(fe){const ve=4*fe;return ve<=bJ?bJ:ve<$J?u$3X(ve):Math.max(Math.min(Math.ceil(1.5*ve/$J)*$J,wJ),ve)}let TJ=class G6 extends zi{constructor(fe){super(fe),this._pending=new EJ,this._changes=new OR,this._materialRenderers=new Map,this._sortedMaterialRenderers=new jr,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((fe=>fe.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return n$4E(this._materialRenderers,(fe=>0!==fe.numGeometries&&!fe.queryRenderOccludedState(ej.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(fe){return this._materialRenderers.get(fe)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const fe=n$2W(this._changes);let ve=!1;return fe.forEach(((fe,_e)=>{let be=this.getMaterialRenderer(_e);if(!be&&fe.adds.length>0){const fe=new pJ({material:_e});fe.initializeRenderContext(this.rendererContext.pluginContext,this._materials),be=fe,this._materialRenderers.set(_e,be),ve=!0}be&&(be.modify(fe),0===be.numGeometries&&(this._materialRenderers.delete(_e),be.destroy(),ve=!0))})),this._changes.clear(),ve&&this._updateSortedMaterialRenderers(),this._hasHighlights=n$4E(this._materialRenderers,(fe=>{const ve=fe.produces.get(qR.DRAPED_MATERIAL);return!!ve&&ve(NI.Highlight)})),this._hasWater=n$4E(this._materialRenderers,(fe=>{const ve=fe.produces.get(qR.DRAPED_WATER);return!!ve&&ve(NI.Normal)})),this.notifyChange("updating"),!0}addGeometries(fe,ve){if(0===fe.length)return;const _e=this._validateRenderGeometries(fe);for(const we of _e)this._geometries.set(we.id,we);const be=this._pending.empty;for(const we of _e)this._pending.adds.add(we);be&&this.notifyChange("updating"),ve===XX.UPDATE&&this._notifyGraphicGeometryChanged(fe)}removeGeometries(fe,ve){const _e=this._pending.empty,be=this._pending.adds;for(const we of fe)be.has(we)?(this._pending.removed.add(we),be.delete(we)):this._pending.removed.has(we)||this._pending.removes.add(we),this._geometries.delete(we.id);_e&&!this._pending.empty&&this.notifyChange("updating"),ve===XX.UPDATE&&this._notifyGraphicGeometryChanged(fe)}modifyGeometries(fe,ve){const _e=0===this._changes.updates.length;for(const be of fe){const fe=this._changes.updates.pushNew();fe.renderGeometry=this._validateRenderGeometry(be),fe.updateType=ve}switch(_e&&this._changes.updates.length>0&&this.notifyChange("updating"),ve){case JX.TRANSFORMATION:case JX.GEOMETRY:return this._notifyGraphicGeometryChanged(fe);case JX.VISIBILITY:return this._notifyGraphicVisibilityChanged(fe)}}updateAnimation(fe){let ve=!1;return this._sortedMaterialRenderers.forAll((_e=>ve=!!_e.updateAnimation&&_e.updateAnimation(fe)||ve)),ve}shouldRender(fe){return this._sortedMaterialRenderers.some((ve=>ve.prepareTechnique(fe)))}render(fe){this._sortedMaterialRenderers.forAll((ve=>{const _e=ve.prepareTechnique(fe);null!=_e&&ve.renderNode(fe,_e)}))}intersect(fe,ve,_e,be,we){return this._geometries.forEach((Se=>{if(be&&!be(Se))return;this._intersectRenderGeometry(Se,_e,ve,0,fe,we);const Te=this.rendererContext.longitudeCyclical;Te&&(Se.boundingSphere[0]-Se.boundingSphere[3]<Te.min&&this._intersectRenderGeometry(Se,_e,ve,Te.range,fe,we),Se.boundingSphere[0]+Se.boundingSphere[3]>Te.max&&this._intersectRenderGeometry(Se,_e,ve,-Te.range,fe,we)),we++})),we}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let fe=0;for(const ve of this._materialRenderers.values())ve.drapedPriority=fe++,this._sortedMaterialRenderers.push(ve);this._sortedMaterialRenderers.sort(((fe,ve)=>{var _e,be,we,Se;return(null==(_e=ve.materialReference)?void 0:_e.renderPriority)===(null==(be=fe.materialReference)?void 0:be.renderPriority)?fe.drapedPriority-ve.drapedPriority:((null==(we=ve.materialReference)?void 0:we.renderPriority)||0)-((null==(Se=fe.materialReference)?void 0:Se.renderPriority)||0)}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let fe=0;fe<this._changes.updates.length;){const ve=this._changes.updates.data[fe];this._pending.has(ve.renderGeometry)?this._changes.updates.removeUnorderedIndex(fe):fe++}this._pending.clear()}_intersectRenderGeometry(fe,ve,_e,be,we,Se){if(!fe.visible)return;let Te=0;be+=fe.transformation[12],Te=fe.transformation[13],PJ[0]=_e[0]-be,PJ[1]=_e[1]-Te,fe.screenToWorldRatio=this.rendererContext.screenToWorldRatio,fe.material.intersectDraped(fe,null,we,PJ,((_e,be,Te)=>{!function C$B(fe,ve,_e,be,we,Se,Te){const Ee=new ZX(Se,Te,ve),h33=ve=>{ve.set(Zf.OVERLAY,Ee,fe.dist,fe.normal,fe.transformation,_e,be)};if((null==we.results.min.drapedLayerOrder||_e>=we.results.min.drapedLayerOrder)&&(null==we.results.min.dist||we.results.ground.dist<=we.results.min.dist)&&h33(we.results.min),we.options.store!==Xf.MIN&&(null==we.results.max.drapedLayerOrder||_e<we.results.max.drapedLayerOrder)&&(null==we.results.max.dist||we.results.ground.dist>we.results.max.dist)&&h33(we.results.max),we.options.store===Xf.ALL){const fe=G$I(we.ray);h33(fe),we.results.all.push(fe)}}(ve,Te,Se,fe.material.renderPriority,we,fe.layerUid,fe.graphicUid)}),ve)}_notifyGraphicGeometryChanged(fe){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let ve;for(const _e of fe){const fe=_e.graphicUid;null!=fe&&fe!==ve&&(this.drapeSource.notifyGraphicGeometryChanged(fe),ve=fe)}}_notifyGraphicVisibilityChanged(fe){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let ve;for(const _e of fe){const fe=_e.graphicUid;null!=fe&&fe!==ve&&(this.drapeSource.notifyGraphicVisibilityChanged(fe),ve=fe)}}_validateRenderGeometries(fe){for(const ve of fe)this._validateRenderGeometry(ve);return fe}_validateRenderGeometry(fe){return null==fe.localOrigin&&(fe.localOrigin=this._localOriginFactory.getOrigin(fe.boundingSphere)),fe}get test(){}};e$4o([y$2v()],TJ.prototype,"drapeSource",void 0),e$4o([y$2v()],TJ.prototype,"updating",null),e$4o([y$2v()],TJ.prototype,"rctx",null),e$4o([y$2v({constructOnly:!0})],TJ.prototype,"rendererContext",void 0),e$4o([y$2v()],TJ.prototype,"_materials",null),e$4o([y$2v()],TJ.prototype,"_localOriginFactory",null),e$4o([y$2v({readOnly:!0})],TJ.prototype,"isEmpty",null),e$4o([y$2v()],TJ.prototype,"_materialRenderers",void 0),e$4o([y$2v()],TJ.prototype,"_geometries",void 0),TJ=e$4o([a$4y("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],TJ);let EJ=class v7{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(fe){return this.adds.has(fe)||this.removes.has(fe)||this.removed.has(fe)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};const PJ=[0,0];let CJ=class m19 extends fA{initializeProgram(fe){return new gA(fe.rctx,m19.shader.get().build(),mA)}initializePipeline(){return this.configuration.hasAlpha?S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA}):S$1g({colorWrite:AA})}};CJ.shader=new LO(TY,(()=>zt((()=>Promise.resolve().then((()=>uRe))),void 0)));let OJ=class r28 extends HA{constructor(){super(...arguments),this.hasAlpha=!1}};e$4o([r$2w()],OJ.prototype,"hasAlpha",void 0);let AJ=class d16 extends iO{constructor(){super(...arguments),this.overlayIndex=nY.INNER,this.opacity=1}};function l$21(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("tex",(fe=>fe.texture))),fe.fragment.uniforms.add(new tq("overlayIdx",(fe=>fe.overlayIndex))),fe.fragment.uniforms.add(new dO("opacity",(fe=>fe.opacity))),fe.fragment.code.add(o$2P`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),fe}const MJ=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:AJ,build:l$21},Symbol.toStringTag,{value:"Module"}));let RJ=class n23 extends fA{initializeProgram(fe){return new gA(fe.rctx,n23.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}};RJ.shader=new LO(MJ,(()=>zt((()=>Promise.resolve().then((()=>hRe))),void 0)));let IJ=class $2 extends ON{constructor(fe){super(fe),this._overlays=null,this._renderTargets=null,this._overlayParameters=new AJ,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new jr,this._passParameters=new SY,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new NR,this.worldToPCSRatio=1,this.events=new La,this.longitudeCyclical=null,this.produces=new Map([[qR.DRAPED_MATERIAL,fe=>fe!==NI.Highlight||this.hasHighlights],[qR.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const fe=this.view._stage.renderer.fboCache,ve=this.view._stage.renderView,{waterTextures:_e,stippleTextures:be,markerTextures:we}=ve;this._techniques=new EY({rctx:this._rctx,viewingMode:Wf.Local,stippleTextures:be,markerTextures:we,waterTextures:_e}),this._renderContext=new yX(this._rctx,new xX(fe,this.view.state.viewingMode),null),this.addHandles([d$3d((()=>_e.updating),(()=>this.events.emit("content-changed")),Ja),d$3d((()=>this.spatialReference),(fe=>this._localOriginFactory=new fX(fe)),Ja),v$1W((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new AY(ve.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=qR.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=WR.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new YR(r$3y(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(gI.STAGE,this))}destroy(){this._renderers.forEach((fe=>fe.destroy())),this._renderers.clear(),this._debugTextureTechnique=t$4r(this._debugTextureTechnique),this._passParameters.texture=r$3M(this._passParameters.texture),this._techniques=u$4d(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(fe){this.pluginContext=fe}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||n$4E(this._renderers,(fe=>fe.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(fe){for(const ve of this._renderers.values()){const _e=ve.getMaterialRenderer(fe);if(_e)return _e}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((fe=>fe.drapeSource.layer)).filter((fe=>!!fe))}createGeometryDrapeSourceRenderer(fe){return this.createDrapeSourceRenderer(fe,TJ)}createDrapeSourceRenderer(fe,ve,_e){const be=this._renderers.get(fe);null!=be&&be.destroy();const we=new ve({..._e,rendererContext:this,drapeSource:fe});return this._renderers.set(fe,we),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in fe&&this.addHandles(d$3d((()=>fe.fullOpacity),(()=>this.events.emit("content-changed"))),fe),we}removeDrapeSourceRenderer(fe){if(null==fe)return;const ve=this._renderers.get(fe);null!=ve&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(fe),this.removeHandles(fe),ve.destroy())}computeValidity(){var fe;return(null==(fe=this._renderTargets)?void 0:fe.computeValidity())??0}releaseRenderTargets(){var fe;null==(fe=this._renderTargets)||fe.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(fe){this._hasTargetWithoutRasterImage=!!this._overlays&&n$4G(fe,(fe=>fe.drapeTargetType===iY.WithoutRasterImage))}ensureDrapeSources(fe){this._overlays?(this._hasDrapedFeatureSource=n$4G(fe,(fe=>fe.drapeSourceType===tY.Features)),this._hasDrapedRasterSource=n$4G(fe,(fe=>fe.drapeSourceType===tY.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(fe,ve,_e=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new fY(this.view._stage.renderer.fboCache),this._overlays=[new cY,new cY]),this.ensureDrapeTargets(fe),this.ensureDrapeSources(ve),this._bindParameters.overlayStretch=_e}disposeOverlays(){this._overlays=null,this._renderTargets=r$3M(this._renderTargets),this.events.emit("textures-disposed")}getTexture(fe){var ve,_e;if(null!=fe)return fe===hY.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null==(ve=this._renderTargets)?void 0:ve.getTexture(hY.Color):null==(_e=this._renderTargets)?void 0:_e.getTexture(fe)}get running(){return this.updating}runTask(fe){this._processDrapeSources(fe,(()=>!0))}_processDrapeSources(fe,ve){let _e=!1;for(const[be,we]of this._renderers){if(fe.done)break;(be.destroyed||ve(be))&&we.commitChanges()&&(_e=!0,fe.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,_e=!0,this._updateSortedDrapeSourceRenderers()),_e&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=n$4E(this._renderers,(fe=>fe.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(wI,(fe=>fe.updatePolicy===QY.SYNC))}get isEmpty(){return!_B.OVERLAY_DRAW_DEBUG_TEXTURE&&!n$4E(this._renderers,(fe=>!fe.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const fe=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=FJ;const ve=this._sortedRenderers.some((({renderer:fe})=>fe.shouldRender(this._renderContext)));return this._renderContext.renderOccludedMask=fe,ve}renders(fe){return _B.OVERLAY_DRAW_DEBUG_TEXTURE&&fe!==hY.Occluded||this._sortedRenderers.some((({renderer:fe})=>fe.shouldRender(this._renderContext)))}get mode(){var fe,ve;return this.isEmpty?bY.Disabled:(null==(fe=this._renderTargets)?void 0:fe.getTexture(hY.WaterNormal))?bY.EnabledWithWater:(null==(ve=this._renderTargets)?void 0:ve.getTexture(hY.Color))?bY.Enabled:bY.Disabled}updateAnimation(fe){let ve=!1;return this._renderers.forEach((_e=>ve=_e.updateAnimation(fe)||ve)),ve}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(fe){if(this._overlays&&this._renderTargets){for(const fe of this._overlays)this.longitudeCyclical?fe.setupGeometryViewsCyclical(this.longitudeCyclical):fe.setupGeometryViewsDirect();for(const ve of this._renderTargets.targets){if(ve.content===hY.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const _e=this._drawTarget(nY.INNER,ve,fe),be=this._drawTarget(nY.OUTER,ve,fe);(_e||be)&&ve.fbo.generateMipMap()}}}_drawTarget(fe,ve,_e){const be=this._overlays[fe],we=be.canvasGeometries;if(0===we.numViews)return!1;const{alignPixelEnabled:Se,contentPixelRatio:Te}=_e;this._screenToWorldRatio=Te*be.mapUnitsPerPixel/this._bindParameters.overlayStretch;const Ee=ve.output;if(this.isEmpty||Ee===NI.Highlight&&!this.hasHighlights||Ee===NI.Normal&&!this.hasWater||!be.hasSomeSizedView())return!1;const Ce=this._rctx;if(this._camera.pixelRatio=be.pixelRatio*Te,this._renderContext.output=Ee,this._bindParameters.alignPixelEnabled=Se,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=Ee===NI.Normal?qR.DRAPED_WATER:qR.DRAPED_MATERIAL,ve.content===hY.Occluded&&(this._renderContext.renderOccludedMask=FJ),!this.renders(ve.content))return this._renderContext.renderOccludedMask=vX,!1;const Oe=be.resolution;this._rctx.setViewport(fe===nY.INNER?0:Oe,0,Oe,Oe);const Re=2*be.resolution,De=be.resolution,Be=ve.fbo;if(Be.bind(Ce,Re,De),fe===nY.INNER&&(Ce.setClearColor(0,0,0,0),Ce.clear(DO.COLOR_BUFFER_BIT)),_B.OVERLAY_DRAW_DEBUG_TEXTURE&&ve.content!==hY.Occluded)for(let Ze=0;Ze<we.numViews;Ze++)this._setViewParameters(we.extents[Ze],be),this._ensureDebugPatternResources(be.resolution,DJ[fe]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((({drapeSource:_e,renderer:Se})=>{if(ve.content===hY.ColorNoRasterImage&&_e.drapeSourceType===tY.RasterImage)return;const{fullOpacity:Te}=_e,Oe=null!=Te&&Te<1&&Ee===NI.Color?this.bindTemporaryFramebuffer(Re,De):null;for(let fe=0;fe<we.numViews;fe++)this._setViewParameters(we.extents[fe],be),Se.render(this._renderContext);if(Oe){Be.bind(Ce,Re,De),this._overlayParameters.texture=Oe.getTexture(),this._overlayParameters.opacity=Te,this._overlayParameters.overlayIndex=fe;const ve=this.pluginContext.techniques.acquire(RJ);this._rctx.bindTechnique(ve,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),ve.release(),Oe.release()}})),Ce.bindFramebuffer(null),this._renderContext.renderOccludedMask=vX,!0}bindTemporaryFramebuffer(fe,ve){var _e;const be=this.view._stage.renderer.fboCache,we=be.acquire(fe,ve,"overlay tmp");return be.rctx.unbindTexture(null==(_e=we.fbo)?void 0:_e.colorTexture),be.rctx.bindFramebuffer(we.fbo),be.rctx.clear(DO.COLOR_BUFFER_BIT),we}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(fe,ve,_e,be){var we;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let Se=0;for(const{renderer:Te}of this._sortedRenderers)Se=(null==(we=Te.intersect)?void 0:we.call(Te,fe,ve,_e,be,Se))??Se}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const fe=this.view.map.allLayers,ve=fe.length;this._renderers.forEach(((_e,be)=>{const we=fe.indexOf(be.layer),Se=we>=0,Te=be.renderGroup??(Se?rY.MapLayer:rY.ViewLayer),Ee=ve*Te+(Se?we:0);this._sortedRenderers.push(new LJ(be,_e,Ee))})),this._sortedRenderers.sort(((fe,ve)=>fe.index-ve.index))}_setViewParameters(fe,ve){const _e=this._camera;_e.viewport=[0,0,ve.resolution,ve.resolution],Q$E(_e.projectionMatrix,0,fe[2]-fe[0],0,fe[3]-fe[1],_e.near,_e.far),q$X(_e.viewMatrix,[-fe[0],-fe[1],0])}_updateHasWater(){const fe=n$4E(this._renderers,(fe=>fe.hasWater));fe!==this._hasWater&&(this._hasWater=fe,this.events.emit("has-water",fe))}_ensureDebugPatternResources(fe,ve){if(o$44(this._passParameters.color,ve[0],ve[1],ve[2]),this._passParameters.texture)return;const _e=new Uint8Array(fe*fe*4);let be=0;for(let Te=0;Te<fe;Te++)for(let ve=0;ve<fe;ve++){const we=Math.floor(ve/10),Se=Math.floor(Te/10);we<2||Se<2||10*we>fe-20||10*Se>fe-20?(_e[be++]=255,_e[be++]=255,_e[be++]=255,_e[be++]=255):(_e[be++]=255,_e[be++]=255,_e[be++]=255,_e[be++]=1&we&&1&Se?1&ve^1&Te?0:255:1&we^1&Se?0:128)}const we=new nM(fe);we.samplingMode=HO.NEAREST,this._passParameters.texture=new oM(this._rctx,we,_e);const Se=new OJ;Se.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(CJ,Se)}get test(){}};e$4o([y$2v()],IJ.prototype,"hasHighlights",void 0),e$4o([y$2v()],IJ.prototype,"_sortedDrapeSourceRenderersDirty",void 0),e$4o([y$2v()],IJ.prototype,"_techniques",void 0),e$4o([y$2v({constructOnly:!0})],IJ.prototype,"view",void 0),e$4o([y$2v()],IJ.prototype,"worldToPCSRatio",void 0),e$4o([y$2v()],IJ.prototype,"spatialReference",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],IJ.prototype,"updating",null),e$4o([y$2v()],IJ.prototype,"isEmpty",null),e$4o([y$2v({readOnly:!0})],IJ.prototype,"rendersOccludedDraped",null),IJ=e$4o([a$4y("esri.views.3d.terrain.OverlayRenderer")],IJ);let LJ=class ee{constructor(fe,ve,_e){this.drapeSource=fe,this.renderer=ve,this.index=_e}};const DJ=[[1,.5,.5],[.5,.5,1]],NJ=-2,FJ=ej.OccludeAndTransparent;function p$28(fe,ve,_e,be){const we=a$27(fe.rings,!!fe.hasZ&&"on-the-ground"!==be.mode,eY.CCW_IS_HOLE,fe.spatialReference),Se=t$2H(we.position.length),Te=u$23(we.position,fe.spatialReference,0,Se,0,we.position,0,we.position.length/3,ve,_e,be),Ee=null!=Te;return new BJ(we.position,Se,u$1H(we.polygons,we.position,Se),l$20(we.outlines,we.position,Se),Ee,Te)}function c$1_(fe,ve){const _e=a$27(fe.rings,!1,eY.CCW_IS_HOLE),be=n$49(_e.position,fe.spatialReference,0,_e.position,ve,0,_e.position.length/3);for(let we=2;we<_e.position.length;we+=3)_e.position[we]=-2;return{position:_e.position,polygons:u$1H(_e.polygons,_e.position),outlines:l$20(_e.outlines,_e.position),projectionSuccess:be}}function l$20(fe,ve,_e=null){return fe.filter((({count:fe})=>fe>1)).map((({index:fe,count:be})=>{const we=3*fe,Se=3*be;return null!=_e?new kJ(fe,be,a$2H(ve,we,Se),a$2H(_e,we,Se)):new zJ(fe,be,a$2H(ve,we,Se))}))}function u$1H(fe,ve,_e=null){const be=new Array;for(const{index:we,count:Se,holeIndices:Te,pathLengths:Ee}of fe){if(Se<=1)continue;const fe=3*we,Ce=3*Se,Oe=Te.map((fe=>fe-we)),Re=null!=_e?new UJ(we,Se,a$2H(ve,3*we,3*Se),a$2H(_e,fe,Ce),Oe,Ee):new VJ(we,Se,a$2H(ve,3*we,3*Se),Oe,Ee);be.push(Re)}return be}let zJ=class h15{constructor(fe,ve,_e){this.index=fe,this.count=ve,this.position=_e}},kJ=class a24 extends zJ{constructor(fe,ve,_e,be){super(fe,ve,_e),this.mapPositions=be}},UJ=class g13 extends kJ{constructor(fe,ve,_e,be,we,Se){super(fe,ve,_e,be),this.holeIndices=we,this.pathLengths=Se}},VJ=class m20 extends zJ{constructor(fe,ve,_e,be,we){super(fe,ve,_e),this.holeIndices=be,this.pathLengths=we}},BJ=class f10{constructor(fe,ve,_e,be,we,Se){this.position=fe,this.mapPositions=ve,this.polygons=_e,this.outlines=be,this.projectionSuccess=we,this.sampledElevation=Se}};function s$1T(fe,ve,_e,be,we,Se=2){const Te=1/(Math.abs(_e)+Math.abs(be)+Math.abs(we)),Ee=_e*Te,Ce=be*Te,Oe=we<=0?(Ee>=0?1:-1)*(1-Math.abs(Ce)):Ee,Re=we<=0?(Ce>=0?1:-1)*(1-Math.abs(Ee)):Ce,De=ve*Se;fe[De]=i$1_(Oe),fe[De+1]=i$1_(Re)}function e$1J(fe){const ve=fe.length/3,_e=new Int16Array(2*ve);let be=0;for(let we=0;we<ve;++we)s$1T(_e,we,fe[be++],fe[be++],fe[be++]);return _e}function c$1Z(fe,ve){const _e=fe.length/3,be=new Int16Array(2*_e);let we=0;const Se=[0,0,0];for(let Te=0;Te<_e;++Te)Se[0]=fe[we++],Se[1]=fe[we++],Se[2]=fe[we++],S$1P(Se,Se,ve),s$1T(be,Te,Se[0],Se[1],Se[2]);return be}function i$1_(fe){return e$3Y(Math.round(32767*fe),-32767,32767)}function u$1G(fe){return e$3Y(fe/32767,-1,1)}const jJ=["polygon","extent"];function rt$6(fe,ve,_e,be,we,Se){const Te=A$14(ve.length),Ee=[[nO.POSITION,new Om(be.positions,ve,3,!0)],[nO.NORMALCOMPRESSED,new Om(be.normals,ve,2,!0)],[nO.COLOR,new Om(we,Te,4,!0)]];return new pD(fe,Ee,be.elevation,eD.Mesh,Se,_e)}function st$7(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be){{const Ze=_e.length/3,Xe=2*be.count;!function ot$6(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe){r$3w(QJ,Je);{const we=Xe>0?1:-1;let Se=3*_e,Te=0,De=3*Te,Be=be,Ze=3*Be;for(let _e=0;_e<be;++_e){const _e=fe[Se],be=fe[Se+1],Je=fe[Se+2];Qe&&(QJ[0]=_e,QJ[1]=be,QJ[2]=Je,z$1d(QJ,QJ)),Ee[De+0]=_e,Ee[De+1]=be,Ee[De+2]=Je;const dt=ve[Se+0],$t=ve[Se+1],bt=ve[Se+2];Ce[De+0]=dt,Ce[De+1]=$t,Ce[De+2]=bt,Oe[De+0]=-we*QJ[0],Oe[De+1]=-we*QJ[1],Oe[De+2]=-we*QJ[2],Re[Te]=0,Ee[Ze+0]=_e+Xe*QJ[0],Ee[Ze+1]=be+Xe*QJ[1],Ee[Ze+2]=Je+Xe*QJ[2],Ce[Ze+0]=dt,Ce[Ze+1]=$t,Ce[Ze+2]=bt,Re[Be]=Xe,De+=3,Ze+=3,Se+=3,Te+=1,Be+=1}}{let fe=3*Se,ve=0,_e=3*Ze;const Ee=Xe<0?tQ:eQ,Ce=Xe<0?eQ:tQ;for(let Se=0;Se<Te;++Se)Be[ve]=we[fe+Ee[0]],Be[ve+1]=we[fe+Ee[1]],Be[ve+2]=we[fe+Ee[2]],De[_e]=we[fe+Ce[0]]+be,De[_e+1]=we[fe+Ce[1]]+be,De[_e+2]=we[fe+Ce[2]]+be,ve+=3,_e+=3,fe+=3}}(fe,ve,be.index,be.count,_e,0,Ze,we,Se,Te,Ee,Ce,Oe,Xe,Re,De,Be)}{let fe=0,ve=2*be.count,_e=0;const Oe=be.pathLengths[0];at$7(we,Se,Ee,Te,fe,Oe,be.count,ve,Ce,_e,Re),ve+=4*Oe,_e+=2*Oe,fe+=Oe;for(let De=1;De<be.pathLengths.length;++De){const Oe=be.pathLengths[De];at$7(we,Se,Ee,Te,fe,Oe,be.count,ve,Ce,_e,Re),ve+=4*Oe,_e+=2*Oe,fe+=Oe}}}function nt$6(fe,ve,_e,be,we,Se,Te){be[Se]=be[Te],Te*=3,fe[Se*=3]=fe[Te],fe[Se+1]=fe[Te+1],fe[Se+2]=fe[Te+2],ve[Se]=ve[Te],ve[Se+1]=ve[Te+1],ve[Se+2]=ve[Te+2],_e[Se]=we[0],_e[Se+1]=we[1],_e[Se+2]=we[2]}const GJ=[0,0,0];function at$7(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re){let De=we,Be=we+1,Ze=we+Te,Xe=we+Te+1,Je=Ee,Qe=Ee+1,dt=Ee+2*Se,$t=Ee+2*Se+1;Re<0&&(De=we+Te+1,Xe=we);let bt=3*Oe;for(let wt=0;wt<Se;++wt)wt===Se-1&&(Be=we,Re>0?Xe=we+Te:De=we+Te),gt$4(fe,De,Be,Ze,GJ),nt$6(fe,ve,be,_e,GJ,Je,De),nt$6(fe,ve,be,_e,GJ,Qe,Be),nt$6(fe,ve,be,_e,GJ,dt,Ze),nt$6(fe,ve,be,_e,GJ,$t,Xe),Ce[bt]=Je,Ce[bt+1]=dt,Ce[bt+2]=$t,Ce[bt+3]=Je,Ce[bt+4]=$t,Ce[bt+5]=Qe,bt+=6,De++,Be++,Ze++,Xe++,Je+=2,Qe+=2,dt+=2,$t+=2}const HJ=[0,0,0],qJ=[0,0,0],WJ=[0,0,0],YJ=[0,0,0],ZJ=[0,0,0];function gt$4(fe,ve,_e,be,we){ve*=3,_e*=3,be*=3,o$44(HJ,fe[ve++],fe[ve++],fe[ve++]),o$44(qJ,fe[_e++],fe[_e++],fe[_e++]),o$44(WJ,fe[be++],fe[be++],fe[be++]),e$3Z(YJ,qJ,HJ),e$3Z(ZJ,WJ,HJ),_$1z(we,ZJ,YJ),z$1d(we,we)}const XJ=[0,0,0];function ft$3(fe,ve,_e){const be=fe.getMutableAttribute(nO.POSITION),we=fe.getMutableAttribute(nO.NORMALCOMPRESSED).data,{topVertexStart:Se,topVertexCount:Te,topFaceStart:Ee,topFaceCount:Ce}=ve,Oe=be.data,Re=Te,De=fe.attributes.get(nO.POSITION).indices,Be=Ee+Ce,Ze=Se+Te,Xe=t$2H(3*Re);for(let wt=0;wt<Re;++wt){const fe=3*wt;Xe[fe+0]=0,Xe[fe+1]=0,Xe[fe+2]=0}const Je=iQ,Qe=nQ,dt=sQ,$t=oQ,bt=QJ;for(let wt=Ee;wt<Be;++wt){const fe=3*wt;for(let ve=0;ve<3;++ve){const be=De[fe+ve];$t[ve]=be;const we=3*be;o$44(JJ,Oe[we+0],Oe[we+1],Oe[we+2]),O$1v(Je[ve],JJ,_e)}Ki(Qe,Je[1],Je[0]),Ki(dt,Je[2],Je[0]),_$1z(bt,Qe,dt),z$1d(bt,bt);for(let ve=0;ve<3;++ve){const fe=3*($t[ve]-Se);Xe[fe+0]+=bt[0],Xe[fe+1]+=bt[1],Xe[fe+2]+=bt[2]}}for(let wt=Se;wt<Ze;++wt){const fe=3*(wt-Se),ve=Xe[fe+0],_e=Xe[fe+1],be=Xe[fe+2],Te=Math.sqrt(ve*ve+_e*_e+be*be);s$1T(we,wt,ve/Te,_e/Te,be/Te)}}const JJ=[0,0,0],QJ=[0,0,0],KJ=new TG,eQ=[0,2,1],tQ=[0,1,2],rQ=.01,iQ=[[0,0,0],[0,0,0],[0,0,0]],nQ=[0,0,0],sQ=[0,0,0],oQ=[0,0,0];var aQ;!function(fe){fe[fe.Main=0]="Main",fe[fe.Bottom=1]="Bottom"}(aQ||(aQ={}));let lQ=class Ct{constructor(fe,ve,_e,be){this.positions=fe,this.elevation=ve,this.normals=_e,this.heights=be}},cQ=class It{constructor(fe,ve,_e,be){this.topVertexStart=fe,this.topVertexCount=ve,this.topFaceStart=_e,this.topFaceCount=be}};const uQ=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["Â«","Â»"],["Â»","Â«"],["â€¹","â€º"],["â€º","â€¹"],["â½","â¾"],["â¾","â½"],["â‚","â‚Ž"],["â‚Ž","â‚"],["â‰¤","â‰¥"],["â‰¥","â‰¤"],["âŒ©","âŒª"],["âŒª","âŒ©"],["ï¹™","ï¹š"],["ï¹š","ï¹™"],["ï¹›","ï¹œ"],["ï¹œ","ï¹›"],["ï¹","ï¹ž"],["ï¹ž","ï¹"],["ï¹¤","ï¹¥"],["ï¹¥","ï¹¤"]],hQ=["Ø¢","Ø£","Ø¥","Ø§"],dQ=["ï»µ","ï»·","ï»¹","ï»»"],pQ=["ï»¶","ï»¸","ï»º","ï»¼"],fQ=["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","ÛŒ","Ø¦","Ø¤"],mQ=["ïº","ïº","ïº•","ïº™","ïº","ïº¡","ïº¥","ïº©","ïº«","ïº­","ïº¯","ïº±","ïºµ","ïº¹","ïº½","ï»","ï»…","ï»‰","ï»","ï»‘","ï»•","ï»™","ï»","ï»¡","ï»¥","ï»©","ï»­","ï»±","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¼","ïº‰","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‰","ïº…"],yQ=["ïºŽ","ïº","ïº–","ïºš","ïºž","ïº¢","ïº¦","ïºª","ïº¬","ïº®","ïº°","ïº²","ïº¶","ïºº","ïº¾","ï»‚","ï»†","ï»Š","ï»Ž","ï»’","ï»–","ï»š","ï»ž","ï»¢","ï»¦","ï»ª","ï»®","ï»²","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯½","ïºŠ","ïº†","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïºŠ","ïº†"],gQ=["ïºŽ","ïº’","ïº˜","ïºœ","ïº ","ïº¤","ïº¨","ïºª","ïº¬","ïº®","ïº°","ïº´","ïº¸","ïº¼","ï»€","ï»„","ï»ˆ","ï»Œ","ï»","ï»”","ï»˜","ï»œ","ï» ","ï»¤","ï»¨","ï»¬","ï»®","ï»´","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯¿","ïºŒ","ïº†","ï¹±","ï¹²","ï¹´","ï¹·","ï¹¹","ï¹»","ï¹½","ï¹¿","ïº€","ïºŒ","ïº†"],vQ=["ïº","ïº‘","ïº—","ïº›","ïºŸ","ïº£","ïº§","ïº©","ïº«","ïº­","ïº¯","ïº³","ïº·","ïº»","ïº¿","ï»ƒ","ï»‡","ï»‹","ï»","ï»“","ï»—","ï»›","ï»Ÿ","ï»£","ï»§","ï»«","ï»­","ï»³","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¾","ïº‹","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‹","ïº…"],_Q=["Ø¡","Ø¢","Ø£","Ø¤","Ø¥","Ø§","Ø©","Ø¯","Ø°","Ø±","Ø²","Ùˆ","Ù‰"],$Q=["Ù‹","Ù‹","ÙŒ","ØŸ","Ù","ØŸ","ÙŽ","ÙŽ","Ù","Ù","Ù","Ù","Ù‘","Ù‘","Ù’","Ù’","Ø¡","Ø¢","Ø¢","Ø£","Ø£","Ø¤","Ø¤","Ø¥","Ø¥","Ø¦","Ø¦","Ø¦","Ø¦","Ø§","Ø§","Ø¨","Ø¨","Ø¨","Ø¨","Ø©","Ø©","Øª","Øª","Øª","Øª","Ø«","Ø«","Ø«","Ø«","Ø¬","Ø¬","Ø¬","Ø¬","Ø­","Ø­","Ø­","Ø­","Ø®","Ø®","Ø®","Ø®","Ø¯","Ø¯","Ø°","Ø°","Ø±","Ø±","Ø²","Ø²","Ø³","Ø³","Ø³","Ø³","Ø´","Ø´","Ø´","Ø´","Øµ","Øµ","Øµ","Øµ","Ø¶","Ø¶","Ø¶","Ø¶","Ø·","Ø·","Ø·","Ø·","Ø¸","Ø¸","Ø¸","Ø¸","Ø¹","Ø¹","Ø¹","Ø¹","Øº","Øº","Øº","Øº","Ù","Ù","Ù","Ù","Ù‚","Ù‚","Ù‚","Ù‚","Ùƒ","Ùƒ","Ùƒ","Ùƒ","Ù„","Ù„","Ù„","Ù„","Ù…","Ù…","Ù…","Ù…","Ù†","Ù†","Ù†","Ù†","Ù‡","Ù‡","Ù‡","Ù‡","Ùˆ","Ùˆ","Ù‰","Ù‰","ÙŠ","ÙŠ","ÙŠ","ÙŠ","ï»µ","ï»¶","ï»·","ï»¸","ï»¹","ï»º","ï»»","ï»¼","ØŸ","ØŸ","ØŸ"],bQ=["Ø¡","Ù"],wQ=["Øº","ÙŠ"],xQ=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],SQ=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],TQ=0,EQ=1,PQ=2,CQ=3,OQ=4,AQ=5,MQ=6,RQ=7,IQ=8,LQ=10,DQ=11,NQ=12,FQ=18,zQ=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],kQ=100,UQ=[kQ+0,TQ,TQ,TQ,TQ,kQ+1,kQ+2,kQ+3,EQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,kQ+4,OQ,OQ,OQ,TQ,OQ,TQ,OQ,TQ,OQ,OQ,OQ,TQ,TQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,OQ,OQ,TQ,TQ,OQ,OQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,kQ+5,RQ,RQ,kQ+6,kQ+7],VQ=[[FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,MQ,AQ,MQ,IQ,AQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,AQ,AQ,AQ,MQ,IQ,OQ,OQ,DQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,LQ,9,LQ,9,9,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,9,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,FQ,FQ,FQ,FQ,FQ,FQ,AQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,9,OQ,DQ,DQ,DQ,DQ,OQ,OQ,OQ,OQ,TQ,OQ,OQ,FQ,OQ,OQ,DQ,DQ,PQ,PQ,OQ,TQ,OQ,OQ,OQ,PQ,TQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ],[TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,EQ,NQ,EQ,NQ,NQ,EQ,NQ,NQ,EQ,NQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,OQ,OQ,OQ,OQ,OQ,EQ,EQ,EQ,EQ,EQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ],[CQ,CQ,CQ,CQ,OQ,OQ,OQ,OQ,RQ,DQ,DQ,RQ,9,RQ,OQ,OQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,RQ,OQ,OQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,CQ,CQ,CQ,CQ,CQ,CQ,CQ,CQ,CQ,CQ,DQ,CQ,CQ,RQ,RQ,RQ,NQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,CQ,OQ,NQ,NQ,NQ,NQ,NQ,NQ,RQ,RQ,NQ,NQ,OQ,NQ,NQ,NQ,NQ,RQ,RQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,RQ,RQ,RQ,RQ,RQ,RQ],[RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,OQ,RQ,RQ,NQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,OQ,OQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,RQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,EQ,EQ,OQ,OQ,OQ,OQ,EQ,OQ,OQ,OQ,OQ,OQ],[IQ,IQ,IQ,IQ,IQ,IQ,IQ,IQ,IQ,IQ,IQ,FQ,FQ,FQ,TQ,EQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,IQ,AQ,13,14,15,16,17,9,DQ,DQ,DQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,9,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,IQ,FQ,FQ,FQ,FQ,FQ,OQ,OQ,OQ,OQ,OQ,FQ,FQ,FQ,FQ,FQ,FQ,PQ,TQ,OQ,OQ,PQ,PQ,PQ,PQ,PQ,PQ,LQ,LQ,OQ,OQ,OQ,TQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,LQ,LQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ],[TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,EQ,NQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,LQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,OQ,EQ,EQ,EQ,EQ,EQ,OQ,EQ,OQ,EQ,EQ,OQ,EQ,EQ,OQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,EQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ],[NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,NQ,NQ,NQ,NQ,NQ,NQ,NQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,9,OQ,9,OQ,OQ,9,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,DQ,OQ,OQ,LQ,LQ,OQ,OQ,OQ,OQ,OQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,RQ,RQ,RQ,RQ,RQ,OQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,RQ,OQ,OQ,FQ],[OQ,OQ,OQ,DQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,LQ,9,LQ,9,9,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,PQ,9,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,TQ,TQ,TQ,TQ,TQ,TQ,OQ,OQ,TQ,TQ,TQ,OQ,OQ,OQ,DQ,DQ,OQ,OQ,OQ,DQ,DQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ,OQ]];let BQ=class C6{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(fe,ve,_e){if(this.sourceToTarget=[],this.targetToSource=[],!fe)return"";if(function ot$5(fe,ve,_e){jQ=[],HQ=[];for(let be=0;be<_e;be++)fe[be]=be,ve[be]=be,jQ[be]=be}(this.sourceToTarget,this.targetToSource,fe.length),!this.checkParameters(ve,_e))return fe;ve=this.inputFormat,_e=this.outputFormat;let be=fe;const we=qQ,Se=rt$5(ve.charAt(1)),Te=rt$5(_e.charAt(1)),Ee=("I"===ve.charAt(0)?"L":ve.charAt(0))+Se,Ce=("I"===_e.charAt(0)?"L":_e.charAt(0))+Te,Oe=ve.charAt(2)+_e.charAt(2);we.defInFormat=Ee,we.defOutFormat=Ce,we.defSwap=Oe;const Re=V$y(fe,Ee,Ce,Oe,we);let De=!1;return"R"===_e.charAt(1)?De=!0:"C"!==_e.charAt(1)&&"D"!==_e.charAt(1)||(De="rtl"===this.checkContextual(Re)),this.sourceToTarget=jQ,this.targetToSource=function it$4(fe){const ve=new Array(fe.length);for(let _e=0;_e<fe.length;_e++)ve[fe[_e]]=_e;return ve}(this.sourceToTarget),GQ=this.targetToSource,be=ve.charAt(3)===_e.charAt(3)?Re:"S"===_e.charAt(3)?function I$H(fe,ve,_e){if(0===ve.length)return"";void 0===fe&&(fe=!0);const be=(ve=String(ve)).split("");let we=0,Se=1,Te=be.length;fe||(we=be.length-1,Se=-1,Te=1);const Ee=function j$K(fe,ve,_e,be,we){let Se=0;const Te=[];let Ee=0;for(let Ce=ve;Ce*_e<be;Ce+=_e)if(Z$f(fe[Ce])||tt$6(fe[Ce])){if("Ù„"===fe[Ce]&&q$p(fe,Ce+_e,_e,be)){fe[Ce]=nt$5(fe[Ce+_e],0===Se?dQ:pQ),Ce+=_e,et$4(fe,Ce,_e,be),Te[Ee]=Ce,Ee++,Se=0;continue}const ve=fe[Ce];1===Se?fe[Ce]=$$g(fe,Ce+_e,_e,be)?Q$h(fe[Ce]):X$c(fe[Ce],yQ):!0===$$g(fe,Ce+_e,_e,be)?fe[Ce]=X$c(fe[Ce],vQ):fe[Ce]=X$c(fe[Ce],mQ),tt$6(ve)||(Se=1),!0===K$f(ve)&&(Se=0)}else Se=0;return Te}(be,we,Se,Te);let Ce="";for(let Oe=0;Oe<be.length;Oe++)W$k(Ee,Ee.length,Oe)>-1?(ut$3(GQ,Oe,!fe,-1),jQ.splice(Oe,1)):Ce+=be[Oe];return Ce}(De,Re):function k$z(fe,ve,_e){if(0===fe.length)return"";void 0===ve&&(ve=!0);let be="";const we=(fe=String(fe)).split("");for(let Se=0;Se<fe.length;Se++){let Te=!1;if(we[Se]>="ï¹°"&&we[Se]<"\ufeff"){const Ee=fe.charCodeAt(Se);we[Se]>="ï»µ"&&we[Se]<="ï»¼"?(ve?(Se>0&&_e&&" "===we[Se-1]?be=be.substring(0,be.length-1)+"Ù„":(be+="Ù„",Te=!0),be+=hQ[(Ee-65269)/2]):(be+=hQ[(Ee-65269)/2],be+="Ù„",Se+1<fe.length&&_e&&" "===we[Se+1]?Se++:Te=!0),Te&&(ut$3(GQ,Se,!0,1),jQ.splice(Se,0,jQ[Se]))):be+=$Q[Ee-65136]}else be+=we[Se]}return be}(Re,De,!0),this.sourceToTarget=jQ,this.targetToSource=GQ,this.levels=HQ,be}_inputFormatSetter(fe){if(!JQ.test(fe))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=fe}_outputFormatSetter(fe){if(!JQ.test(fe))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=fe}checkParameters(fe,ve){return fe?this._inputFormatSetter(fe):fe=this.inputFormat,ve?this._outputFormatSetter(ve):ve=this.outputFormat,fe!==ve}checkContextual(fe){let ve=x$E(fe);if("ltr"!==ve&&"rtl"!==ve){try{ve=document.dir.toLowerCase()}catch(vr){}"ltr"!==ve&&"rtl"!==ve&&(ve="ltr")}return ve}hasBidiChar(fe){return QQ.test(fe)}};function V$y(fe,ve,_e,be,we){const Se=function E$F(fe,ve,_e){if(void 0===ve.inFormat&&(ve.inFormat=_e.defInFormat),void 0===ve.outFormat&&(ve.outFormat=_e.defOutFormat),void 0===ve.swap&&(ve.swap=_e.defSwap),ve.inFormat===ve.outFormat)return ve;const be=ve.inFormat.substring(0,1),we=ve.outFormat.substring(0,1);let Se,Te=ve.inFormat.substring(1,4),Ee=ve.outFormat.substring(1,4);return"C"===Te.charAt(0)&&(Se=x$E(fe),Te="ltr"===Se||"rtl"===Se?Se.toUpperCase():"L"===ve.inFormat.charAt(2)?"LTR":"RTL",ve.inFormat=be+Te),"C"===Ee.charAt(0)&&(Se=x$E(fe),"rtl"===Se?Ee="RTL":"ltr"===Se?(Se=function O$B(fe){const ve=fe.split("");return ve.reverse(),x$E(ve.join(""))}(fe),Ee=Se.toUpperCase()):Ee="L"===ve.outFormat.charAt(2)?"LTR":"RTL",ve.outFormat=we+Ee),ve}(fe,{inFormat:ve,outFormat:_e,swap:be},we);if(Se.inFormat===Se.outFormat)return fe;ve=Se.inFormat,_e=Se.outFormat,be=Se.swap;const Te=ve.substring(0,1),Ee=ve.substring(1,4),Ce=_e.substring(0,1),Oe=_e.substring(1,4);if(we.inFormat=ve,we.outFormat=_e,we.swap=be,"L"===Te&&"VLTR"===_e){if("LTR"===Ee)return we.dir=ZQ,y$10(fe,we);if("RTL"===Ee)return we.dir=XQ,y$10(fe,we)}if("V"===Te&&"V"===Ce)return we.dir="RTL"===Ee?XQ:ZQ,M$B(fe,we);if("L"===Te&&"VRTL"===_e)return"LTR"===Ee?(we.dir=ZQ,fe=y$10(fe,we)):(we.dir=XQ,fe=y$10(fe,we)),M$B(fe);if("VLTR"===ve&&"LLTR"===_e)return we.dir=ZQ,y$10(fe,we);if("V"===Te&&"L"===Ce&&Ee!==Oe)return fe=M$B(fe),"RTL"===Ee?V$y(fe,"LLTR","VLTR",be,we):V$y(fe,"LRTL","VRTL",be,we);if("VRTL"===ve&&"LRTL"===_e)return V$y(fe,"LRTL","VRTL",be,we);if("L"===Te&&"L"===Ce){const ve=we.swap;return we.swap=ve.substr(0,1)+"N","RTL"===Ee?(we.dir=XQ,fe=y$10(fe,we),we.swap="N"+ve.substr(1,2),we.dir=ZQ,fe=y$10(fe,we)):(we.dir=ZQ,fe=y$10(fe,we),we.swap="N"+ve.substr(1,2),fe=V$y(fe,"VLTR","LRTL",we.swap,we)),fe}return fe}function x$E(fe){const ve=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(fe);return ve?ve[0]<="z"?"ltr":"rtl":""}function y$10(fe,ve){const _e=fe.split(""),be=[];return D$w(_e,be,ve),function P$w(fe,ve,_e){if(0!==_e.hiLevel&&_e.swap.substr(0,1)!==_e.swap.substr(1,2))for(let be=0;be<fe.length;be++)1===ve[be]&&(fe[be]=J$g(fe[be]))}(_e,be,ve),G$k(2,_e,be,ve),G$k(1,_e,be,ve),HQ=be,_e.join("")}function D$w(fe,ve,_e){const be=fe.length,we=_e.dir?SQ:xQ;let Se=0,Te=-1;const Ee=[],Ce=[];_e.hiLevel=_e.dir,_e.lastArabic=!1,_e.hasUbatAl=!1,_e.hasUbatB=!1,_e.hasUbatS=!1;for(let Oe=0;Oe<be;Oe++)Ee[Oe]=z$q(fe[Oe]);for(let Oe=0;Oe<be;Oe++){const be=Se,Re=H$p(fe,Ee,Ce,Oe,_e);Ce[Oe]=Re,Se=we[be][Re];const De=240&Se;Se&=15;const Be=we[Se][WQ];if(ve[Oe]=Be,De>0)if(16===De){for(let fe=Te;fe<Oe;fe++)ve[fe]=1;Te=-1}else Te=-1;if(we[Se][YQ])-1===Te&&(Te=Oe);else if(Te>-1){for(let fe=Te;fe<Oe;fe++)ve[fe]=Be;Te=-1}Ee[Oe]===AQ&&(ve[Oe]=0),_e.hiLevel|=Be}_e.hasUbatS&&function Y$f(fe,ve,_e,be){for(let we=0;we<_e;we++)if(fe[we]===MQ){ve[we]=be.dir;for(let _e=we-1;_e>=0&&fe[_e]===IQ;_e--)ve[_e]=be.dir}}(Ee,ve,be,_e)}function z$q(fe){const ve=fe.charCodeAt(0),_e=UQ[ve>>8];return _e<kQ?_e:VQ[_e-kQ][255&ve]}function M$B(fe,ve){const _e=fe.split("");if(ve){const fe=[];D$w(_e,fe,ve),HQ=fe}return _e.reverse(),jQ.reverse(),_e.join("")}function W$k(fe,ve,_e){for(let be=0;be<ve;be++)if(fe[be]===_e)return be;return-1}function Z$f(fe){for(let ve=0;ve<bQ.length;ve++)if(fe>=bQ[ve]&&fe<=wQ[ve])return!0;return!1}function $$g(fe,ve,_e,be){for(;ve*_e<be&&tt$6(fe[ve]);)ve+=_e;return!!(ve*_e<be&&Z$f(fe[ve]))}function q$p(fe,ve,_e,be){for(;ve*_e<be&&tt$6(fe[ve]);)ve+=_e;let we=" ";if(!(ve*_e<be))return!1;we=fe[ve];for(let Se=0;Se<hQ.length;Se++)if(hQ[Se]===we)return!0;return!1}function G$k(fe,ve,_e,be){if(be.hiLevel<fe)return;if(1===fe&&be.dir===XQ&&!be.hasUbatB)return ve.reverse(),void jQ.reverse();const we=ve.length;let Se,Te,Ee,Ce,Oe,Re=0;for(;Re<we;){if(_e[Re]>=fe){for(Se=Re+1;Se<we&&_e[Se]>=fe;)Se++;for(Te=Re,Ee=Se-1;Te<Ee;Te++,Ee--)Ce=ve[Te],ve[Te]=ve[Ee],ve[Ee]=Ce,Oe=jQ[Te],jQ[Te]=jQ[Ee],jQ[Ee]=Oe;Re=Se}Re++}}function H$p(fe,ve,_e,be,we){const Se=ve[be];return{UBAT_L:()=>(we.lastArabic=!1,TQ),UBAT_R:()=>(we.lastArabic=!1,EQ),UBAT_ON:()=>OQ,UBAT_AN:()=>CQ,UBAT_EN:()=>we.lastArabic?CQ:PQ,UBAT_AL:()=>(we.lastArabic=!0,we.hasUbatAl=!0,EQ),UBAT_WS:()=>OQ,UBAT_CS:()=>{let fe,Se;return be<1||be+1>=ve.length||(fe=_e[be-1])!==PQ&&fe!==CQ||(Se=ve[be+1])!==PQ&&Se!==CQ?OQ:(we.lastArabic&&(Se=CQ),Se===fe?Se:OQ)},UBAT_ES:()=>(be>0?_e[be-1]:AQ)===PQ&&be+1<ve.length&&ve[be+1]===PQ?PQ:OQ,UBAT_ET:()=>{if(be>0&&_e[be-1]===PQ)return PQ;if(we.lastArabic)return OQ;let fe=be+1;const Se=ve.length;for(;fe<Se&&ve[fe]===DQ;)fe++;return fe<Se&&ve[fe]===PQ?PQ:OQ},UBAT_NSM:()=>{if("VLTR"===we.inFormat){const _e=ve.length;let we=be+1;for(;we<_e&&ve[we]===NQ;)we++;if(we<_e){const _e=fe[be].charCodeAt(0),Se=_e>=1425&&_e<=2303||64286===_e,Te=ve[we];if(Se&&(Te===EQ||Te===RQ))return EQ}}return be<1||ve[be-1]===AQ?OQ:_e[be-1]},UBAT_B:()=>(we.lastArabic=!0,we.hasUbatB=!0,we.dir),UBAT_S:()=>(we.hasUbatS=!0,OQ),UBAT_LRE:()=>(we.lastArabic=!1,OQ),UBAT_RLE:()=>(we.lastArabic=!1,OQ),UBAT_LRO:()=>(we.lastArabic=!1,OQ),UBAT_RLO:()=>(we.lastArabic=!1,OQ),UBAT_PDF:()=>(we.lastArabic=!1,OQ),UBAT_BN:()=>OQ}[zQ[Se]]()}function J$g(fe){let ve,_e=0,be=uQ.length-1;for(;_e<=be;)if(ve=Math.floor((_e+be)/2),fe<uQ[ve][0])be=ve-1;else{if(!(fe>uQ[ve][0]))return uQ[ve][1];_e=ve+1}return fe}function K$f(fe){for(let ve=0;ve<_Q.length;ve++)if(_Q[ve]===fe)return!0;return!1}function Q$h(fe){for(let ve=0;ve<fQ.length;ve++)if(fe===fQ[ve])return gQ[ve];return fe}function X$c(fe,ve){for(let _e=0;_e<fQ.length;_e++)if(fe===fQ[_e])return ve[_e];return fe}function tt$6(fe){return fe>="Ù‹"&&fe<="Ù•"}function rt$5(fe){return"L"===fe?"LTR":"R"===fe?"RTL":"C"===fe?"CLR":"D"===fe?"CRL":""}function et$4(fe,ve,_e,be){for(;ve*_e<be&&tt$6(fe[ve]);)ve+=_e;return ve*_e<be&&(fe[ve]=" ",!0)}function nt$5(fe,ve){for(let _e=0;_e<hQ.length;_e++)if(fe===hQ[_e])return ve[_e];return fe}function ut$3(fe,ve,_e,be){for(let we=0;we<fe.length;we++)(fe[we]>ve||!_e&&fe[we]===ve)&&(fe[we]+=be)}let jQ=[],GQ=[],HQ=[];const qQ={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},WQ=5,YQ=6,ZQ=0,XQ=1,JQ=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,QQ=/[\u0591-\u06ff\ufb1d-\ufefc]/,KQ=new BQ;let eK=class t47{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(fe,ve){this.tx=fe,this.ty=ve}setTranslateZ(fe){this.tz=fe}setRotateCS(fe,ve){this.rz=void 0,this.rzCos=fe,this.rzSin=ve}setRotate(fe){this.rz=fe,this.rzCos=void 0,this.rzSin=void 0}setRotateY(fe){this.ry=fe}setScale(fe){this.s=fe}setMeasure(fe){this.m=fe}};const tK="arial-unicode-ms",rK="woff2",iK=new Map,nK=new Set;let sK=class s47{constructor(fe,ve){this.fontFace=fe,this.promise=ve}};async function c$1X(fe){const ve=function l$1_(fe){const ve=d$1l(fe)+h$18(fe);return(fe.family||tK)+(ve.length>0?ve:"-regular")}(fe),_e=function f$1f(fe){const ve=d$1l(fe)+h$18(fe);return function u$1F(fe){if(!fe)return tK;const ve=fe.toLowerCase().split(" ").join("-");switch(ve){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return ve}}(fe.family)+(ve.length>0?ve:"-regular")}(fe),be=iK.get(ve);if(be)return be.promise;const we=new FontFace(fe.family,`url('${ir.fontsUrl}/woff2/${_e}.${rK}') format('${rK}')`,{style:fe.style,weight:fe.weight}),Se=document.fonts;if(Se.has(we)&&"loading"===we.status)return we.loaded;const Te=we.load().then((()=>(Se.add(we),we)));return iK.set(ve,new sK(we,Te)),nK.add(we),Te}function d$1l(fe){if(!fe.weight)return"";switch(fe.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function h$18(fe){if(!fe.style)return"";switch(fe.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let oK=class a25{static fromOptimized(fe,ve,_e=!1,be=!1,we=1){return(new aK).initialize(fe,ve,_e,be,we)}static fromJSON(fe,ve=!1,_e=!1){const[be,we]=u$1E(fe);return(new lK).initialize(be,we,ve,_e,1)}static fromOptimizedCIM(fe,ve,_e=!1,be=!1,we=1){return(new cK).initialize(fe,ve,_e,be,we)}static fromJSONCIM(fe,ve=!1,_e=!1,be=1){const[we,Se]=u$1E(fe);return(new uK).initialize(we,Se,ve,_e,be)}static fromFeatureSetReader(fe){const ve=fe.readGeometryForDisplay(),_e=fe.geometryType;return ve&&_e?this.fromOptimized(ve,_e):null}static fromFeatureSetReaderCIM(fe){const ve=fe.readGeometryForDisplay(),_e=fe.geometryType;return ve&&_e?this.fromOptimizedCIM(ve,_e):null}static createEmptyOptimized(fe,ve=!1,_e=!1,be=1){return(new aK).initialize(new OW,fe,ve,_e,be)}static createEmptyJSON(fe,ve=!1,_e=!1){return(new lK).initialize([],fe,ve,_e,1)}static createEmptyOptimizedCIM(fe,ve=!1,_e=!1,be=1){return(new cK).initialize(new OW,fe,ve,_e,be)}static createEmptyJSONCIM(fe,ve=!1,_e=!1,be=1){return(new uK).initialize([],fe,ve,_e,be)}asJSON(){const fe=t$3Y(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:fe[0][0][0],ymin:fe[0][0][1],xmax:fe[0][2][0],ymax:fe[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:fe.flat()}:"esriGeometryPoint"===this.geometryType?{x:fe[0][0][0],y:fe[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:fe}:{paths:fe}}getCurrentRingArea(){if(this.pathSize<3)return 0;let fe,ve,_e=0;if(this.seekPathStart(),!this.nextPoint())return 0;fe=this.x,ve=this.y;const be=fe,we=ve;for(;this.nextPoint();)_e+=(fe-this.x)*(ve+this.y),fe=this.x,ve=this.y;return _e+=(fe-be)*(ve+we),-.5*_e}invertY(){this.yFactor*=-1}},aK=class p25 extends oK{constructor(){super(...arguments),this._end=-1}initialize(fe,ve,_e,be,we){return this.hasZ=_e,this.hasM=be,this.geometryType=ve,this._stride=2+Number(_e)+Number(be),this._geometry=fe,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=we,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(fe){if(fe>=0&&fe<this.totalSize){if(this._pathIndex<fe)for(;this._pathIndex<fe&&this.nextPath(););else if(this._pathIndex>fe)for(;this._pathIndex>fe&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(fe){const ve=this._pathOffset+fe*this._stride;return ve>=0&&ve<this._end&&(this._pointOffset=ve,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}pathLength(){const fe=this._end,ve=this._stride,_e=this._geometry.coords;let be=0;for(let we=this._pathOffset+ve;we<fe;we+=ve){const fe=_e[we-ve],Se=_e[we-ve+1],Te=_e[we]-fe,Ee=_e[we+1]-Se;be+=Math.sqrt(Te*Te+Ee*Ee)}return be}startPath(){this._geometry.lengths.push(0)}pushPath(fe){this.startPath(),this.pushPoints(fe)}pushPoint(fe){for(let ve=0;ve<this._stride;++ve)this._geometry.coords.push(fe[ve]);this._geometry.lengths[this.totalSize-1]++}pushXY(fe,ve){this._geometry.coords.push(fe,ve),this._geometry.lengths[this.totalSize-1]++}pushPoints(fe){for(const ve of fe)for(let fe=0;fe<this._stride;++fe)this._geometry.coords.push(ve[fe]);this._geometry.lengths[this.totalSize-1]+=fe.length}pushCursor(fe){const ve=fe.asOptimized();this._geometry.coords.push(...ve.coords),this._geometry.lengths.push(...ve.lengths)}asOptimized(){const fe=this._geometry.clone();if(1!==this.yFactor)for(let ve=1;ve<fe.coords.length;ve+=this._stride)fe.coords[ve]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(fe.lengths.length=0),fe}isClosed(){const fe=this._geometry.coords,ve=this._pathOffset,_e=this._end-this._stride;for(let be=0;be<this._stride;be++)if(fe[ve+be]!==fe[_e+be])return!1;return!0}clone(){return(new p25).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((fe,ve)=>fe+ve))}get pathSize(){const{lengths:fe}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>fe.length-1?0:fe[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(fe){this._geometry.coords[this._pointOffset]=fe}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(fe){this._geometry.coords[this._pointOffset+1]=this.yFactor*fe}get z(){return this._geometry.coords[this._pointOffset+2]}set z(fe){this._geometry.coords[this._pointOffset+2]=fe}get m(){const fe=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+fe]}set m(fe){this._geometry.coords[this._pointOffset+3]=fe}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function _$D(fe){const ve=[fe.x,fe.y];return fe.z&&ve.push(fe.z),fe.m&&ve.push(fe.m),ve}function u$1E(fe){return f$2Z(fe)?[fe.rings,"esriGeometryPolygon"]:s$3_(fe)?[fe.paths,"esriGeometryPolyline"]:l$49(fe)?[[fe.points],"esriGeometryMultipoint"]:m$3w(fe)?[[[[fe.xmin,fe.ymin],[fe.xmin,fe.ymax],[fe.xmax,fe.ymax],[fe.xmax,fe.ymin],[fe.xmin,fe.ymin]]],"esriGeometryEnvelope"]:u$3F(fe)?[[[_$D(fe)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let lK=class d17 extends oK{initialize(fe,ve,_e,be,we){return this._paths=fe,this.geometryType=ve,this.hasZ=_e,this.hasM=be,this._pathIndex=this._pointIndex=-1,this.yFactor=we,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(fe){return this._pathIndex=fe,this._pointIndex=-1,fe>=0&&fe<this.totalSize&&(this._currentPath=this._paths[fe],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(fe){return fe>=0&&fe<this._currentPath.length&&(this._pointIndex=fe,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const fe=this._currentPath.length,ve=this._currentPath;let _e=0;for(let be=1;be<fe;be++){const fe=ve[be-1],we=ve[be],Se=fe[0],Te=fe[1],Ee=we[0]-Se,Ce=we[1]-Te;_e+=Math.sqrt(Ee*Ee+Ce*Ce)}return _e}startPath(){this._paths.push([])}pushPath(fe){this._paths.push(fe)}pushPoint(fe){this._paths[this.totalSize-1].push(fe)}pushXY(fe,ve){this._paths[this.totalSize-1].push([fe,ve])}pushPoints(fe){this._paths[this.totalSize-1].push(...fe)}pushCursor(fe){const ve=t$3Y(fe);for(const _e of ve)this.pushPath(_e)}asOptimized(){const fe=new OW;if("esriGeometryPoint"===this.geometryType)fe.coords.push(...this._paths[0][0]),fe.lengths.length=0;else for(const ve of this._paths){for(const _e of ve)fe.coords.push(_e[0]),fe.coords.push(_e[1]*this.yFactor),this.hasZ&&fe.coords.push(_e[2]),this.hasM&&fe.coords.push(_e[this._mIndex]);fe.lengths.push(ve.length)}return fe}isClosed(){const fe=this._currentPath[0],ve=this._currentPath[this._currentPath.length-1];for(let _e=0;_e<fe.length;_e++)if(fe[_e]!==ve[_e])return!1;return!0}clone(){return(new d17).initialize(a$4H(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((fe=>fe.length)).reduce(((fe,ve)=>fe+ve))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(fe){this._currentPoint[0]=fe}get y(){return this.yFactor*this._currentPoint[1]}set y(fe){this._currentPoint[1]=this.yFactor*fe}get z(){return this._currentPoint[2]}set z(fe){this._currentPoint[2]=fe}get m(){return this._currentPoint[this._mIndex]}set m(fe){this._currentPoint[this._mIndex]=fe}get pathIndex(){return this._pathIndex}};let cK=class m21 extends aK{initialize(fe,ve,_e,be,we){return super.initialize(fe,ve,_e,be,we),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((fe=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const fe=(new m21).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return fe._controlPoints=this._controlPoints,fe}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(fe){this._controlPoints[this.pathIndex].add(fe)}getControlPointAt(fe){return this._controlPoints[this.pathIndex].has(fe)}},uK=class y7 extends lK{initialize(fe,ve,_e,be,we){return super.initialize(fe,ve,_e,be,we)}clone(){return(new y7).initialize(a$4H(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(fe){this._paths[this.pathIndex][fe][4]=1}getControlPointAt(fe){return 1===this._paths[this.pathIndex][fe][4]}};var hK,dK;!function(fe){fe[fe.Unknown=0]="Unknown",fe[fe.Point=1]="Point",fe[fe.LineString=2]="LineString",fe[fe.Polygon=3]="Polygon"}(hK||(hK={}));let pK=class h16{constructor(fe,ve){this.x=fe,this.y=ve}clone(){return new h16(this.x,this.y)}equals(fe,ve){return fe===this.x&&ve===this.y}isEqual(fe){return fe.x===this.x&&fe.y===this.y}setCoords(fe,ve){return this.x=fe,this.y=ve,this}normalize(){const fe=this.x,ve=this.y,_e=Math.sqrt(fe*fe+ve*ve);return this.x/=_e,this.y/=_e,this}rightPerpendicular(){const fe=this.x;return this.x=this.y,this.y=-fe,this}leftPerpendicular(){const fe=this.x;return this.x=-this.y,this.y=fe,this}move(fe,ve){return this.x+=fe,this.y+=ve,this}assign(fe){return this.x=fe.x,this.y=fe.y,this}assignAdd(fe,ve){return this.x=fe.x+ve.x,this.y=fe.y+ve.y,this}assignSub(fe,ve){return this.x=fe.x-ve.x,this.y=fe.y-ve.y,this}rotate(fe,ve){const _e=this.x,be=this.y;return this.x=_e*fe-be*ve,this.y=_e*ve+be*fe,this}scale(fe){return this.x*=fe,this.y*=fe,this}length(){const fe=this.x,ve=this.y;return Math.sqrt(fe*fe+ve*ve)}sub(fe){return this.x-=fe.x,this.y-=fe.y,this}add(fe){return this.x+=fe.x,this.y+=fe.y,this}static distance(fe,ve){const _e=ve.x-fe.x,be=ve.y-fe.y;return Math.sqrt(_e*_e+be*be)}static add(fe,ve){return new h16(fe.x+ve.x,fe.y+ve.y)}static sub(fe,ve){return new h16(fe.x-ve.x,fe.y-ve.y)}},fK=class n24{constructor(fe,ve,_e){this.ratio=fe,this.x=ve,this.y=_e}},mK=class e36{constructor(fe,ve,_e,be=8,we=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=be,this._pixelMargin=we,this._tileSize=512*be,this._dz=fe,this._yPos=ve,this._xPos=_e}setPixelMargin(fe){fe!==this._pixelMargin&&(this._pixelMargin=fe,this.setExtent(this._extent))}setExtent(fe){this._extent=fe,this._finalRatio=this._tileSize/fe*(1<<this._dz);let ve=this._pixelRatio*this._pixelMargin;ve/=this._finalRatio;const _e=fe>>this._dz;ve>_e&&(ve=_e),this._margin=ve,this._xmin=_e*this._xPos-ve,this._ymin=_e*this._yPos-ve,this._xmax=this._xmin+_e+2*ve,this._ymax=this._ymin+_e+2*ve}reset(fe){this._type=fe,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(fe,ve){this._pushLine(),this._prevIsIn=this._isIn(fe,ve),this._moveTo(fe,ve,this._prevIsIn),this._prevPt=new pK(fe,ve),this._firstPt=new pK(fe,ve),this._dist=0}lineTo(fe,ve){const _e=this._isIn(fe,ve),be=new pK(fe,ve),we=pK.distance(this._prevPt,be);let Se,Te,Ee,Ce,Oe,Re,De,Be;if(_e)this._prevIsIn?this._lineTo(fe,ve,!0):(Se=this._prevPt,Te=be,Ee=this._intersect(Te,Se),this._start=this._dist+we*(1-this._r),this._lineTo(Ee.x,Ee.y,!0),this._lineTo(Te.x,Te.y,!0));else if(this._prevIsIn)Te=this._prevPt,Se=be,Ee=this._intersect(Te,Se),this._lineTo(Ee.x,Ee.y,!0),this._lineTo(Se.x,Se.y,!1);else{const fe=this._prevPt,ve=be;if(fe.x<=this._xmin&&ve.x<=this._xmin||fe.x>=this._xmax&&ve.x>=this._xmax||fe.y<=this._ymin&&ve.y<=this._ymin||fe.y>=this._ymax&&ve.y>=this._ymax)this._lineTo(ve.x,ve.y,!1);else{const _e=[];if((fe.x<this._xmin&&ve.x>this._xmin||fe.x>this._xmin&&ve.x<this._xmin)&&(Ce=(this._xmin-fe.x)/(ve.x-fe.x),Be=fe.y+Ce*(ve.y-fe.y),Be<=this._ymin?Re=!1:Be>=this._ymax?Re=!0:_e.push(new fK(Ce,this._xmin,Be))),(fe.x<this._xmax&&ve.x>this._xmax||fe.x>this._xmax&&ve.x<this._xmax)&&(Ce=(this._xmax-fe.x)/(ve.x-fe.x),Be=fe.y+Ce*(ve.y-fe.y),Be<=this._ymin?Re=!1:Be>=this._ymax?Re=!0:_e.push(new fK(Ce,this._xmax,Be))),(fe.y<this._ymin&&ve.y>this._ymin||fe.y>this._ymin&&ve.y<this._ymin)&&(Ce=(this._ymin-fe.y)/(ve.y-fe.y),De=fe.x+Ce*(ve.x-fe.x),De<=this._xmin?Oe=!1:De>=this._xmax?Oe=!0:_e.push(new fK(Ce,De,this._ymin))),(fe.y<this._ymax&&ve.y>this._ymax||fe.y>this._ymax&&ve.y<this._ymax)&&(Ce=(this._ymax-fe.y)/(ve.y-fe.y),De=fe.x+Ce*(ve.x-fe.x),De<=this._xmin?Oe=!1:De>=this._xmax?Oe=!0:_e.push(new fK(Ce,De,this._ymax))),0===_e.length)Oe?Re?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):Re?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(_e.length>1&&_e[0].ratio>_e[1].ratio)this._start=this._dist+we*_e[1].ratio,this._lineTo(_e[1].x,_e[1].y,!0),this._lineTo(_e[0].x,_e[0].y,!0);else{this._start=this._dist+we*_e[0].ratio;for(let fe=0;fe<_e.length;fe++)this._lineTo(_e[fe].x,_e[fe].y,!0)}this._lineTo(ve.x,ve.y,!1)}}this._dist+=we,this._prevIsIn=_e,this._prevPt=be}close(){if(this._line.length>2){const fe=this._firstPt,ve=this._prevPt;fe.x===ve.x&&fe.y===ve.y||this.lineTo(fe.x,fe.y);const _e=this._line;let be=_e.length;for(;be>=4&&(_e[0].x===_e[1].x&&_e[0].x===_e[be-2].x||_e[0].y===_e[1].y&&_e[0].y===_e[be-2].y);)_e.pop(),_e[0].x=_e[be-2].x,_e[0].y=_e[be-2].y,--be}}result(fe=!0){return this._pushLine(),0===this._lines.length?null:(this._type===hK.Polygon&&fe&&gK.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==hK.LineString)throw new Error("Only valid for lines");this._pushLine();const fe=this._lines,ve=fe.length;if(0===ve)return null;const _e=[];for(let be=0;be<ve;be++)_e.push({line:fe[be],start:this._starts[be]||0});return _e}_isIn(fe,ve){return fe>=this._xmin&&fe<=this._xmax&&ve>=this._ymin&&ve<=this._ymax}_intersect(fe,ve){let _e,be,we;if(ve.x>=this._xmin&&ve.x<=this._xmax)be=ve.y<=this._ymin?this._ymin:this._ymax,we=(be-fe.y)/(ve.y-fe.y),_e=fe.x+we*(ve.x-fe.x);else if(ve.y>=this._ymin&&ve.y<=this._ymax)_e=ve.x<=this._xmin?this._xmin:this._xmax,we=(_e-fe.x)/(ve.x-fe.x),be=fe.y+we*(ve.y-fe.y);else{be=ve.y<=this._ymin?this._ymin:this._ymax,_e=ve.x<=this._xmin?this._xmin:this._xmax;const Se=(_e-fe.x)/(ve.x-fe.x),Te=(be-fe.y)/(ve.y-fe.y);Se<Te?(we=Se,be=fe.y+Se*(ve.y-fe.y)):(we=Te,_e=fe.x+Te*(ve.x-fe.x))}return this._r=we,new pK(_e,be)}_pushLine(){this._line&&(this._type===hK.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===hK.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===hK.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(fe,ve,_e){this._type!==hK.Polygon?_e&&(fe=Math.round((fe-(this._xmin+this._margin))*this._finalRatio),ve=Math.round((ve-(this._ymin+this._margin))*this._finalRatio),this._line.push(new pK(fe,ve))):(_e||(fe<this._xmin&&(fe=this._xmin),fe>this._xmax&&(fe=this._xmax),ve<this._ymin&&(ve=this._ymin),ve>this._ymax&&(ve=this._ymax)),fe=Math.round((fe-(this._xmin+this._margin))*this._finalRatio),ve=Math.round((ve-(this._ymin+this._margin))*this._finalRatio),this._line.push(new pK(fe,ve)),this._isH=!1,this._isV=!1)}_lineTo(fe,ve,_e){let be,we;if(this._type!==hK.Polygon)if(_e){if(fe=Math.round((fe-(this._xmin+this._margin))*this._finalRatio),ve=Math.round((ve-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(be=this._line[this._line.length-1],be.equals(fe,ve)))return;this._line.push(new pK(fe,ve))}else this._line&&this._line.length>0&&this._pushLine();else if(_e||(fe<this._xmin&&(fe=this._xmin),fe>this._xmax&&(fe=this._xmax),ve<this._ymin&&(ve=this._ymin),ve>this._ymax&&(ve=this._ymax)),fe=Math.round((fe-(this._xmin+this._margin))*this._finalRatio),ve=Math.round((ve-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){be=this._line[this._line.length-1];const _e=be.x===fe,Se=be.y===ve;if(_e&&Se)return;this._isH&&_e||this._isV&&Se?(be.x=fe,be.y=ve,we=this._line[this._line.length-2],we.x===fe&&we.y===ve?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(we=this._line[this._line.length-2],this._isH=we.x===fe,this._isV=we.y===ve)):(this._isH=we.x===fe,this._isV=we.y===ve)):(this._line.push(new pK(fe,ve)),this._isH=_e,this._isV=Se)}else this._line.push(new pK(fe,ve))}},yK=class _6{setExtent(fe){this._ratio=4096===fe?1:4096/fe}get validateTessellation(){return this._ratio<1}reset(fe){this._lines=[],this._line=null}moveTo(fe,ve){this._line&&this._lines.push(this._line),this._line=[];const _e=this._ratio;this._line.push(new pK(fe*_e,ve*_e))}lineTo(fe,ve){const _e=this._ratio;this._line.push(new pK(fe*_e,ve*_e))}close(){const fe=this._line;fe&&!fe[0].isEqual(fe[fe.length-1])&&fe.push(fe[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}};!function(fe){fe[fe.sideLeft=0]="sideLeft",fe[fe.sideRight=1]="sideRight",fe[fe.sideTop=2]="sideTop",fe[fe.sideBottom=3]="sideBottom"}(dK||(dK={}));let gK=class x8{static simplify(fe,ve,_e){if(!_e)return;const be=-ve,we=fe+ve,Se=-ve,Te=fe+ve,Ee=[],Ce=[],Oe=_e.length;for(let De=0;De<Oe;++De){const fe=_e[De];if(!fe||fe.length<2)continue;let ve,Oe=fe[0];const Re=fe.length;for(let _e=1;_e<Re;++_e)ve=fe[_e],Oe.x===ve.x&&(Oe.x<=be&&(Oe.y>ve.y?(Ee.push(De),Ee.push(_e),Ee.push(dK.sideLeft),Ee.push(-1)):(Ce.push(De),Ce.push(_e),Ce.push(dK.sideLeft),Ce.push(-1))),Oe.x>=we&&(Oe.y<ve.y?(Ee.push(De),Ee.push(_e),Ee.push(dK.sideRight),Ee.push(-1)):(Ce.push(De),Ce.push(_e),Ce.push(dK.sideRight),Ce.push(-1)))),Oe.y===ve.y&&(Oe.y<=Se&&(Oe.x<ve.x?(Ee.push(De),Ee.push(_e),Ee.push(dK.sideTop),Ee.push(-1)):(Ce.push(De),Ce.push(_e),Ce.push(dK.sideTop),Ce.push(-1))),Oe.y>=Te&&(Oe.x>ve.x?(Ee.push(De),Ee.push(_e),Ee.push(dK.sideBottom),Ee.push(-1)):(Ce.push(De),Ce.push(_e),Ce.push(dK.sideBottom),Ce.push(-1)))),Oe=ve}if(0===Ee.length||0===Ce.length)return;x8.fillParent(_e,Ce,Ee),x8.fillParent(_e,Ee,Ce);const Re=[];x8.calcDeltas(Re,Ce,Ee),x8.calcDeltas(Re,Ee,Ce),x8.addDeltas(Re,_e)}static fillParent(fe,ve,_e){const be=_e.length,we=ve.length;for(let Se=0;Se<we;Se+=4){const we=ve[Se],Te=ve[Se+1],Ee=ve[Se+2],Ce=fe[we][Te-1],Oe=fe[we][Te];let Re=8092,De=-1;for(let ve=0;ve<be;ve+=4){if(_e[ve+2]!==Ee)continue;const be=_e[ve],we=_e[ve+1],Se=fe[be][we-1],Te=fe[be][we];switch(Ee){case dK.sideLeft:case dK.sideRight:if(l$1Y(Ce.y,Se.y,Te.y)&&l$1Y(Oe.y,Se.y,Te.y)){const fe=Math.abs(Te.y-Se.y);fe<Re&&(Re=fe,De=ve)}break;case dK.sideTop:case dK.sideBottom:if(l$1Y(Ce.x,Se.x,Te.x)&&l$1Y(Oe.x,Se.x,Te.x)){const fe=Math.abs(Te.x-Se.x);fe<Re&&(Re=fe,De=ve)}}}ve[Se+3]=De}}static calcDeltas(fe,ve,_e){const be=ve.length;for(let we=0;we<be;we+=4){const be=[],Se=x8.calcDelta(we,ve,_e,be);fe.push(ve[we]),fe.push(ve[we+1]),fe.push(ve[we+2]),fe.push(Se)}}static calcDelta(fe,ve,_e,be){const we=ve[fe+3];if(-1===we)return 0;const Se=be.length;return Se>1&&be[Se-2]===we?0:(be.push(we),x8.calcDelta(we,_e,ve,be)+1)}static addDeltas(fe,ve){const _e=fe.length;let be=0;for(let we=0;we<_e;we+=4){const ve=fe[we+3];ve>be&&(be=ve)}for(let we=0;we<_e;we+=4){const _e=ve[fe[we]],Se=fe[we+1],Te=be-fe[we+3];switch(fe[we+2]){case dK.sideLeft:_e[Se-1].x-=Te,_e[Se].x-=Te,1===Se&&(_e[_e.length-1].x-=Te),Se===_e.length-1&&(_e[0].x-=Te);break;case dK.sideRight:_e[Se-1].x+=Te,_e[Se].x+=Te,1===Se&&(_e[_e.length-1].x+=Te),Se===_e.length-1&&(_e[0].x+=Te);break;case dK.sideTop:_e[Se-1].y-=Te,_e[Se].y-=Te,1===Se&&(_e[_e.length-1].y-=Te),Se===_e.length-1&&(_e[0].y-=Te);break;case dK.sideBottom:_e[Se-1].y+=Te,_e[Se].y+=Te,1===Se&&(_e[_e.length-1].y+=Te),Se===_e.length-1&&(_e[0].y+=Te)}}}};const l$1Y=(fe,ve,_e)=>fe>=ve&&fe<=_e||fe>=_e&&fe<=ve;let vK,_K=class s48{constructor(fe){this._geometry=fe}next(){const fe=this._geometry;return this._geometry=null,fe}};function i$1V(fe,ve){vK||(vK=new mK(0,0,0,1));const _e="esriGeometryPolygon"===fe.geometryType,be=_e?hK.Polygon:hK.LineString,we=_e?3:2;let Se,Te;for(vK.reset(be),vK.setPixelMargin(ve+1),vK.setExtent(512);fe.nextPath();)if(!(fe.pathSize<we)){for(fe.nextPoint(),Se=fe.x,Te=-fe.y,vK.moveTo(Se,Te);fe.nextPoint();)Se=fe.x,Te=-fe.y,vK.lineTo(Se,Te);_e&&vK.close()}const Ee=vK.result(!1);if(Ee){const ve=oK.createEmptyOptimizedCIM(fe.geometryType);for(const fe of Ee){ve.startPath();for(const _e of fe)ve.pushXY(_e.x,-_e.y)}return ve.reset(),ve}return null}let $K=class t48{applyColorSubstituition(fe,ve){if(!ve)return fe;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:_e,height:be}=fe,we=this._rasterizationCanvas,Se=we.getContext("2d",{willReadFrequently:!0});fe!==we&&(we.width=_e,we.height=be,Se.drawImage(fe,0,0,_e,be));const Te=Se.getImageData(0,0,_e,be).data;if(ve)for(const Ce of ve)if(Ce&&Ce.oldColor&&4===Ce.oldColor.length&&Ce.newColor&&4===Ce.newColor.length){const[fe,ve,_e,be]=Ce.oldColor,[we,Se,Ee,Oe]=Ce.newColor;if(fe===we&&ve===Se&&_e===Ee&&be===Oe)continue;for(let Ce=0;Ce<Te.length;Ce+=4)fe===Te[Ce]&&ve===Te[Ce+1]&&_e===Te[Ce+2]&&be===Te[Ce+3]&&(Te[Ce]=we,Te[Ce+1]=Se,Te[Ce+2]=Ee,Te[Ce+3]=Oe)}const Ee=new ImageData(Te,_e,be);return Se.putImageData(Ee,0,0),we}tintImageData(fe,ve){if(!ve||ve.length<4)return fe;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:_e,height:be}=fe,we=this._rasterizationCanvas,Se=we.getContext("2d",{willReadFrequently:!0});fe!==we&&(we.width=_e,we.height=be,Se.drawImage(fe,0,0,_e,be));const Te=Se.getImageData(0,0,_e,be),Ee=new Uint8Array(Te.data),Ce=[ve[0]/255,ve[1]/255,ve[2]/255,ve[3]/255];for(let Re=0;Re<Ee.length;Re+=4)Ee[Re]*=Ce[0],Ee[Re+1]*=Ce[1],Ee[Re+2]*=Ce[2],Ee[Re+3]*=Ce[3];const Oe=new ImageData(new Uint8ClampedArray(Ee.buffer),_e,be);return Se.putImageData(Oe,0,0),we}},bK=class e37{static local(){return null===e37.instance&&(e37.instance=new e37),e37.instance}execute(fe,ve,_e,be,we){return new wK(fe,ve,_e)}};bK.instance=null;let wK=class t49{constructor(fe,ve,_e){this._inputGeometries=fe,this._angleTolerance=void 0!==ve.angleTolerance?ve.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let fe=this._inputGeometries.next();for(;fe;){if("esriGeometryPolygon"===fe.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===fe.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==fe.geometryType){fe=this._inputGeometries.next();continue}if(this._maxCosAngle)return fe;this._isClosed=!0}for(;fe.nextPath();)this._processPath(fe);return fe.reset(),fe}return null}_processPath(fe){if(fe.nextPoint()){const ve=fe.x,_e=fe.y;let be=ve,we=_e,Se=fe.pathSize,Te=0,Ee=0,Ce=0,Oe=0,Re=0,De=0;this._isClosed&&++Se;for(let Be=1;fe.nextPoint()||Be<Se;++Be){let Ze,Xe;this._isClosed&&Be===Se-1?(Ze=ve,Xe=_e):(Ze=fe.x,Xe=fe.y);const Je=Ze-be,Qe=Xe-we,dt=Math.sqrt(Je*Je+Qe*Qe);Be>1&&dt>0&&Ce>0&&(Te*Je+Ee*Qe)/dt/Ce<=this._maxCosAngle&&fe.setControlPointAt(Be-1),1===Be&&(Oe=Je,Re=Qe,De=dt),dt>0&&(be=Ze,we=Xe,Te=Je,Ee=Qe,Ce=dt)}this._isClosed&&Ce>0&&De>0&&(Te*Oe+Ee*Re)/De/Ce<=this._maxCosAngle&&fe.setControlPointAt(0)}}};function r$1z(fe,ve){fe[4]=ve}let xK=class s49{constructor(fe,ve=!0,_e=!0,be=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!ve&&"esriGeometryPolygon"===fe.geometryType||!_e&&"esriGeometryPolyline"===fe.geometryType?null:fe,this.geomUnitsPerPoint=be,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new eK}next(){if(!this.geometryCursor)return null;const fe=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&fe||(this.geometryCursor=null),fe}processMultiPath(fe){for(;this.iteratePath||fe.pathIndex<fe.totalSize-1;){this.iteratePath||fe.nextPath(),this.iterateMultiPath=!0;const ve=this.processPath(fe);if(ve)return ve}return this.iterateMultiPath=!1,null}},SK=class h17{constructor(fe,ve,_e,be=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=fe,this.acceptPolygon=ve,this.acceptPolyline=_e,this.geomUnitsPerPoint=be,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let fe=this.inputGeometries.next();for(;fe&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===fe.geometryType||"esriGeometryEnvelope"===fe.geometryType,this.multiPathCursor=fe,!this.multiPathCursor);)fe=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=i$1V(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const fe=this.processPath(this.multiPathCursor);if(fe)return fe}this.multiPathCursor=null}}isClippingRequired(fe){return!1}};var TK,EK,PK,CK,OK,AK,MK,RK,IK,LK,DK,NK,FK,zK,kK,UK,VK,BK,jK,GK,HK,qK,WK,YK,ZK,XK,JK,QK,KK,e0,t0,r0,i0,n0,s0,o0,a0,l0,c0,u0,h0,d0,p0,f0,m0,y0,g0,v0,_0,$0,b0,w0,x0,S0,T0,E0,P0,C0,O0,A0,M0;!function(fe){fe[fe.BUTT=0]="BUTT",fe[fe.ROUND=1]="ROUND",fe[fe.SQUARE=2]="SQUARE",fe[fe.UNKNOWN=4]="UNKNOWN"}(TK||(TK={})),function(fe){fe[fe.BEVEL=0]="BEVEL",fe[fe.ROUND=1]="ROUND",fe[fe.MITER=2]="MITER",fe[fe.UNKNOWN=4]="UNKNOWN"}(EK||(EK={})),function(fe){fe[fe.SCREEN=0]="SCREEN",fe[fe.MAP=1]="MAP"}(PK||(PK={})),function(fe){fe[fe.Tint=0]="Tint",fe[fe.Ignore=1]="Ignore",fe[fe.Multiply=99]="Multiply"}(CK||(CK={})),function(fe){fe.Both="Both",fe.JustBegin="JustBegin",fe.JustEnd="JustEnd",fe.None="None"}(OK||(OK={})),function(fe){fe[fe.Mosaic=0]="Mosaic",fe[fe.Centered=1]="Centered"}(AK||(AK={})),function(fe){fe[fe.Normal=0]="Normal",fe[fe.Superscript=1]="Superscript",fe[fe.Subscript=2]="Subscript"}(MK||(MK={})),function(fe){fe[fe.MSSymbol=0]="MSSymbol",fe[fe.Unicode=1]="Unicode"}(RK||(RK={})),function(fe){fe[fe.Unspecified=0]="Unspecified",fe[fe.TrueType=1]="TrueType",fe[fe.PSOpenType=2]="PSOpenType",fe[fe.TTOpenType=3]="TTOpenType",fe[fe.Type1=4]="Type1"}(IK||(IK={})),function(fe){fe[fe.Display=0]="Display",fe[fe.Map=1]="Map"}(LK||(LK={})),function(fe){fe.None="None",fe.Loop="Loop",fe.Oscillate="Oscillate"}(DK||(DK={})),function(fe){fe[fe.Z=0]="Z",fe[fe.X=1]="X",fe[fe.Y=2]="Y"}(NK||(NK={})),function(fe){fe[fe.XYZ=0]="XYZ",fe[fe.ZXY=1]="ZXY",fe[fe.YXZ=2]="YXZ"}(FK||(FK={})),function(fe){fe[fe.Rectangle=0]="Rectangle",fe[fe.RoundedRectangle=1]="RoundedRectangle",fe[fe.Oval=2]="Oval"}(zK||(zK={})),function(fe){fe[fe.None=0]="None",fe[fe.Alpha=1]="Alpha",fe[fe.Screen=2]="Screen",fe[fe.Multiply=3]="Multiply",fe[fe.Add=4]="Add"}(kK||(kK={})),function(fe){fe[fe.TTB=0]="TTB",fe[fe.RTL=1]="RTL",fe[fe.BTT=2]="BTT"}(UK||(UK={})),function(fe){fe[fe.None=0]="None",fe[fe.SignPost=1]="SignPost",fe[fe.FaceNearPlane=2]="FaceNearPlane"}(VK||(VK={})),function(fe){fe[fe.Float=0]="Float",fe[fe.String=1]="String",fe[fe.Boolean=2]="Boolean"}(BK||(BK={})),function(fe){fe[fe.Intersect=0]="Intersect",fe[fe.Subtract=1]="Subtract"}(jK||(jK={})),function(fe){fe.OpenEnded="OpenEnded",fe.Block="Block",fe.Crossed="Crossed"}(GK||(GK={})),function(fe){fe.FullGeometry="FullGeometry",fe.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",fe.ReversedFirstSegment="ReversedFirstSegment",fe.PerpendicularToSecondSegment="PerpendicularToSecondSegment",fe.SecondSegmentWithTicks="SecondSegmentWithTicks",fe.DoublePerpendicular="DoublePerpendicular",fe.OppositeToFirstSegment="OppositeToFirstSegment",fe.TriplePerpendicular="TriplePerpendicular",fe.HalfCircleFirstSegment="HalfCircleFirstSegment",fe.HalfCircleSecondSegment="HalfCircleSecondSegment",fe.HalfCircleExtended="HalfCircleExtended",fe.OpenCircle="OpenCircle",fe.CoverageEdgesWithTicks="CoverageEdgesWithTicks",fe.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",fe.GapExtentMidline="GapExtentMidline",fe.Chevron="Chevron",fe.PerpendicularWithArc="PerpendicularWithArc",fe.ClosedHalfCircle="ClosedHalfCircle",fe.TripleParallelExtended="TripleParallelExtended",fe.ParallelWithTicks="ParallelWithTicks",fe.Parallel="Parallel",fe.PerpendicularToFirstSegment="PerpendicularToFirstSegment",fe.ParallelOffset="ParallelOffset",fe.OffsetOpposite="OffsetOpposite",fe.OffsetSame="OffsetSame",fe.CircleWithArc="CircleWithArc",fe.DoubleJog="DoubleJog",fe.PerpendicularOffset="PerpendicularOffset",fe.LineExcludingLastSegment="LineExcludingLastSegment",fe.MultivertexArrow="MultivertexArrow",fe.CrossedArrow="CrossedArrow",fe.ChevronArrow="ChevronArrow",fe.ChevronArrowOffset="ChevronArrowOffset",fe.PartialFirstSegment="PartialFirstSegment",fe.Arch="Arch",fe.CurvedParallelTicks="CurvedParallelTicks",fe.Arc90Degrees="Arc90Degrees",fe.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(HK||(HK={})),function(fe){fe.Mitered="Mitered",fe.Bevelled="Bevelled",fe.Rounded="Rounded",fe.Square="Square",fe.TrueBuffer="TrueBuffer"}(qK||(qK={})),function(fe){fe.ClosePath="ClosePath",fe.ConvexHull="ConvexHull",fe.RectangularBox="RectangularBox"}(WK||(WK={})),function(fe){fe.BeginningOfLine="BeginningOfLine",fe.EndOfLine="EndOfLine"}(YK||(YK={})),function(fe){fe.Mitered="Mitered",fe.Bevelled="Bevelled",fe.Rounded="Rounded",fe.Square="Square"}(ZK||(ZK={})),function(fe){fe.Fast="Fast",fe.Accurate="Accurate"}(XK||(XK={})),function(fe){fe.BeginningOfLine="BeginningOfLine",fe.EndOfLine="EndOfLine"}(JK||(JK={})),function(fe){fe.Sinus="Sinus",fe.Square="Square",fe.Triangle="Triangle",fe.Random="Random"}(QK||(QK={})),function(fe){fe[fe.None=0]="None",fe[fe.Default=1]="Default",fe[fe.Force=2]="Force"}(KK||(KK={})),function(fe){fe[fe.Buffered=0]="Buffered",fe[fe.Left=1]="Left",fe[fe.Right=2]="Right",fe[fe.AlongLine=3]="AlongLine"}(e0||(e0={})),function(fe){fe[fe.Linear=0]="Linear",fe[fe.Rectangular=1]="Rectangular",fe[fe.Circular=2]="Circular",fe[fe.Buffered=3]="Buffered"}(t0||(t0={})),function(fe){fe[fe.Discrete=0]="Discrete",fe[fe.Continuous=1]="Continuous"}(r0||(r0={})),function(fe){fe[fe.AcrossLine=0]="AcrossLine",fe[fe.AloneLine=1]="AloneLine"}(i0||(i0={})),function(fe){fe[fe.Left=0]="Left",fe[fe.Right=1]="Right",fe[fe.Center=2]="Center",fe[fe.Justify=3]="Justify"}(n0||(n0={})),function(fe){fe[fe.Base=0]="Base",fe[fe.MidPoint=1]="MidPoint",fe[fe.ThreePoint=2]="ThreePoint",fe[fe.FourPoint=3]="FourPoint",fe[fe.Underline=4]="Underline",fe[fe.CircularCW=5]="CircularCW",fe[fe.CircularCCW=6]="CircularCCW"}(s0||(s0={})),function(fe){fe.Butt="Butt",fe.Round="Round",fe.Square="Square"}(o0||(o0={})),function(fe){fe.NoConstraint="NoConstraint",fe.HalfPattern="HalfPattern",fe.HalfGap="HalfGap",fe.FullPattern="FullPattern",fe.FullGap="FullGap",fe.Custom="Custom"}(a0||(a0={})),function(fe){fe[fe.None=-1]="None",fe[fe.Custom=0]="Custom",fe[fe.Circle=1]="Circle",fe[fe.OpenArrow=2]="OpenArrow",fe[fe.ClosedArrow=3]="ClosedArrow",fe[fe.Diamond=4]="Diamond"}(l0||(l0={})),function(fe){fe[fe.ExtraLeading=0]="ExtraLeading",fe[fe.Multiple=1]="Multiple",fe[fe.Exact=2]="Exact"}(c0||(c0={})),function(fe){fe.Bevel="Bevel",fe.Round="Round",fe.Miter="Miter"}(u0||(u0={})),function(fe){fe[fe.Default=0]="Default",fe[fe.String=1]="String",fe[fe.Numeric=2]="Numeric"}(h0||(h0={})),function(fe){fe[fe.InsidePolygon=0]="InsidePolygon",fe[fe.PolygonCenter=1]="PolygonCenter",fe[fe.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(d0||(d0={})),function(fe){fe[fe.Tint=0]="Tint",fe[fe.Replace=1]="Replace",fe[fe.Multiply=2]="Multiply"}(p0||(p0={})),function(fe){fe[fe.ClipAtBoundary=0]="ClipAtBoundary",fe[fe.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",fe[fe.DoNotTouchBoundary=2]="DoNotTouchBoundary",fe[fe.DoNotClip=3]="DoNotClip"}(f0||(f0={})),function(fe){fe.NoConstraint="NoConstraint",fe.WithMarkers="WithMarkers",fe.WithFullGap="WithFullGap",fe.WithHalfGap="WithHalfGap",fe.Custom="Custom"}(m0||(m0={})),function(fe){fe.Fixed="Fixed",fe.Random="Random",fe.RandomFixedQuantity="RandomFixedQuantity"}(y0||(y0={})),function(fe){fe.LineMiddle="LineMiddle",fe.LineBeginning="LineBeginning",fe.LineEnd="LineEnd",fe.SegmentMidpoint="SegmentMidpoint"}(g0||(g0={})),function(fe){fe.OnPolygon="OnPolygon",fe.CenterOfMass="CenterOfMass",fe.BoundingBoxCenter="BoundingBoxCenter"}(v0||(v0={})),function(fe){fe[fe.Low=0]="Low",fe[fe.Medium=1]="Medium",fe[fe.High=2]="High"}(_0||(_0={})),function(fe){fe[fe.MarkerCenter=0]="MarkerCenter",fe[fe.MarkerBounds=1]="MarkerBounds"}($0||($0={})),function(fe){fe[fe.None=0]="None",fe[fe.PropUniform=1]="PropUniform",fe[fe.PropNonuniform=2]="PropNonuniform",fe[fe.DifUniform=3]="DifUniform",fe[fe.DifNonuniform=4]="DifNonuniform"}(b0||(b0={})),function(fe){fe.Tube="Tube",fe.Strip="Strip",fe.Wall="Wall"}(w0||(w0={})),function(fe){fe[fe.Random=0]="Random",fe[fe.Increasing=1]="Increasing",fe[fe.Decreasing=2]="Decreasing",fe[fe.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(x0||(x0={})),function(fe){fe[fe.Relative=0]="Relative",fe[fe.Absolute=1]="Absolute"}(S0||(S0={})),function(fe){fe[fe.Normal=0]="Normal",fe[fe.LowerCase=1]="LowerCase",fe[fe.Allcaps=2]="Allcaps"}(T0||(T0={})),function(fe){fe[fe.LTR=0]="LTR",fe[fe.RTL=1]="RTL"}(E0||(E0={})),function(fe){fe.Draft="Draft",fe.Picture="Picture",fe.Text="Text"}(P0||(P0={})),function(fe){fe[fe.Top=0]="Top",fe[fe.Center=1]="Center",fe[fe.Baseline=2]="Baseline",fe[fe.Bottom=3]="Bottom"}(C0||(C0={})),function(fe){fe[fe.Right=0]="Right",fe[fe.Upright=1]="Upright"}(O0||(O0={})),function(fe){fe[fe.Small=0]="Small",fe[fe.Medium=1]="Medium",fe[fe.Large=2]="Large"}(A0||(A0={})),function(fe){fe[fe.Calm=0]="Calm",fe[fe.Rippled=1]="Rippled",fe[fe.Slight=2]="Slight",fe[fe.Moderate=3]="Moderate"}(M0||(M0={}));const R0=.03;let I0=class s50{constructor(fe=0,ve=!1){}isEmpty(fe){if(!fe.nextPoint())return!0;let ve,_e,be,we;for(ve=fe.x,_e=fe.y;fe.nextPoint();ve=_e,_e=we)if(be=fe.x,we=fe.y,be!==ve||we!==_e)return fe.seekPathStart(),!1;return fe.seekPathStart(),!0}normalize(fe){const ve=Math.sqrt(fe[0]*fe[0]+fe[1]*fe[1]);0!==ve&&(fe[0]/=ve,fe[1]/=ve)}getLength(fe,ve,_e,be){const we=_e-fe,Se=be-ve;return Math.sqrt(we*we+Se*Se)}getSegLength(fe){const[[ve,_e],[be,we]]=fe;return this.getLength(ve,_e,be,we)}getCoord2D(fe,ve,_e,be,we){return[fe+(_e-fe)*we,ve+(be-ve)*we]}getSegCoord2D(fe,ve){const[[_e,be],[we,Se]]=fe;return this.getCoord2D(_e,be,we,Se,ve)}getAngle(fe,ve,_e,be,we){const Se=_e-fe,Te=be-ve;return Math.atan2(Te,Se)}getAngleCS(fe,ve,_e,be,we){const Se=_e-fe,Te=be-ve,Ee=Math.sqrt(Se*Se+Te*Te);return Ee>0?[Se/Ee,Te/Ee]:[1,0]}getSegAngleCS(fe,ve){const[[_e,be],[we,Se]]=fe;return this.getAngleCS(_e,be,we,Se,ve)}cut(fe,ve,_e,be,we,Se){return[we<=0?[fe,ve]:this.getCoord2D(fe,ve,_e,be,we),Se>=1?[_e,be]:this.getCoord2D(fe,ve,_e,be,Se)]}getSubCurve(fe,ve,_e){const be=oK.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(be,fe,ve,_e)?be:null}appendSubCurve(fe,ve,_e,be){fe.startPath(),ve.seekPathStart();let we=0,Se=!0;if(!ve.nextPoint())return!1;let Te=ve.x,Ee=ve.y;for(;ve.nextPoint();){const Ce=this.getLength(Te,Ee,ve.x,ve.y);if(0!==Ce){if(Se){if(we+Ce>_e){const Oe=(_e-we)/Ce;let Re=1,De=!1;we+Ce>=be&&(Re=(be-we)/Ce,De=!0);const Be=this.cut(Te,Ee,ve.x,ve.y,Oe,Re);if(Be&&fe.pushPoints(Be),De)break;Se=!1}}else{if(we+Ce>be){const _e=this.cut(Te,Ee,ve.x,ve.y,0,(be-we)/Ce);_e&&fe.pushPoint(_e[1]);break}fe.pushXY(ve.x,ve.y)}we+=Ce,Te=ve.x,Ee=ve.y}else Te=ve.x,Ee=ve.y}return!0}getCIMPointAlong(fe,ve){if(!fe.nextPoint())return null;let _e,be,we,Se,Te=0;for(_e=fe.x,be=fe.y;fe.nextPoint();_e=we,be=Se){we=fe.x,Se=fe.y;const Ee=this.getLength(_e,be,we,Se);if(0!==Ee){if(Te+Ee>ve){const fe=(ve-Te)/Ee;return this.getCoord2D(_e,be,we,Se,fe)}Te+=Ee}}return null}offset(fe,ve,_e,be,we){if(!fe||fe.length<2)return null;let Se=0,Te=fe[Se++],Ee=Se;for(;Se<fe.length;){const ve=fe[Se];ve[0]===Te[0]&&ve[1]===Te[1]||(Se!==Ee&&(fe[Ee]=fe[Se]),Te=fe[Ee++]),Se++}const Ce=fe[0][0]===fe[Ee-1][0]&&fe[0][1]===fe[Ee-1][1];if(Ce&&--Ee,Ee<(Ce?3:2))return null;const Oe=[];Te=Ce?fe[Ee-1]:null;let Re=fe[0];for(let De=0;De<Ee;De++){const we=De===Ee-1?Ce?fe[0]:null:fe[De+1];if(Te)if(we){const fe=[we[0]-Re[0],we[1]-Re[1]];this.normalize(fe);const Se=[Re[0]-Te[0],Re[1]-Te[1]];this.normalize(Se);const Ee=Se[0]*fe[1]-Se[1]*fe[0],Ce=Se[0]*fe[0]+Se[1]*fe[1];if(0===Ee&&1===Ce){Re=we;continue}if(Ee>=0==ve<=0){if(Ce<1){const _e=[fe[0]-Se[0],fe[1]-Se[1]];this.normalize(_e);const we=Math.sqrt((1+Ce)/2);if(we>1/be){const fe=-Math.abs(ve)/we;Oe.push([Re[0]-_e[0]*fe,Re[1]-_e[1]*fe])}}}else switch(_e){case ZK.Mitered:{const _e=Math.sqrt((1+Ce)/2);if(_e>0&&1/_e<be){const be=[fe[0]-Se[0],fe[1]-Se[1]];this.normalize(be);const we=Math.abs(ve)/_e;Oe.push([Re[0]-be[0]*we,Re[1]-be[1]*we]);break}}case ZK.Bevelled:Oe.push([Re[0]+Se[1]*ve,Re[1]-Se[0]*ve]),Oe.push([Re[0]+fe[1]*ve,Re[1]-fe[0]*ve]);break;case ZK.Rounded:if(Ce<1){Oe.push([Re[0]+Se[1]*ve,Re[1]-Se[0]*ve]);const _e=Math.floor(2.5*(1-Ce));if(_e>0){const be=1/_e;let we=be;for(let Te=1;Te<_e;Te++,we+=be){const _e=[Se[1]*(1-we)+fe[1]*we,-Se[0]*(1-we)-fe[0]*we];this.normalize(_e),Oe.push([Re[0]+_e[0]*ve,Re[1]+_e[1]*ve])}}Oe.push([Re[0]+fe[1]*ve,Re[1]-fe[0]*ve])}break;case ZK.Square:default:if(Ee<0)Oe.push([Re[0]+(Se[1]+Se[0])*ve,Re[1]+(Se[1]-Se[0])*ve]),Oe.push([Re[0]+(fe[1]-fe[0])*ve,Re[1]-(fe[0]+fe[1])*ve]);else{const _e=Math.sqrt((1+Math.abs(Ce))/2),be=[fe[0]-Se[0],fe[1]-Se[1]];this.normalize(be);const we=ve/_e;Oe.push([Re[0]-be[0]*we,Re[1]-be[1]*we])}}}else{const fe=[Re[0]-Te[0],Re[1]-Te[1]];this.normalize(fe),Oe.push([Re[0]+fe[1]*ve,Re[1]-fe[0]*ve])}else{const fe=[we[0]-Re[0],we[1]-Re[1]];this.normalize(fe),Oe.push([Re[0]+fe[1]*ve,Re[1]-fe[0]*ve])}Te=Re,Re=we}return Oe.length<(Ce?3:2)?null:(Ce&&Oe.push([Oe[0][0],Oe[0][1]]),Oe)}};const L0=1.7320508075688772,D0=GK.OpenEnded;let N0=class p26{static local(){return null===p26.instance&&(p26.instance=new p26),p26.instance}execute(fe,ve,_e,be,we){return new F0(fe,ve,_e)}};N0.instance=null;let F0=class P4 extends SK{constructor(fe,ve,_e){super(fe,!1,!0),this._curveHelper=new I0,this._width=(void 0!==ve.width?ve.width:5)*_e,this._arrowType=void 0!==ve.geometricEffectArrowType?ve.geometricEffectArrowType:void 0!==ve.arrowType?ve.arrowType:D0,this._offsetFlattenError=R0*_e}processPath(fe){const ve=oK.createEmptyOptimizedCIM(fe.geometryType);switch(this._arrowType){case GK.OpenEnded:default:this._constructSimpleArrow(ve,fe,!0);break;case GK.Block:this._constructSimpleArrow(ve,fe,!1);break;case GK.Crossed:this._constructCrossedArrow(ve,fe)}return ve}_constructSimpleArrow(fe,ve,_e){const be=ve.pathLength();let we=this._width;be<2*we&&(we=be/2);const Se=this._curveHelper.getSubCurve(ve,0,be-we);if(!Se||!Se.nextPath())return;Se.seekPathStart();const Te=we/2;if(this._curveHelper.isEmpty(Se))return;const Ee=n$4p(Se),Ce=this._constructOffset(Ee,-Te);if(!Ce)return;const Oe=this._constructOffset(Ee,Te);if(!Oe)return;const Re=this._constructArrowBasePoint(Ce,-Te/2);if(!Re)return;const De=this._constructArrowBasePoint(Oe,Te/2);if(!De)return;ve.seekInPath(ve.pathSize-1);const Be=[ve.x,ve.y];fe.pushPath(Oe),fe.nextPath(),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(De),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Be),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Re),fe.nextPoint(),fe.setControlPoint(),fe.pushPoints(Ce.reverse()),fe.setControlPoint(),_e||(fe.setControlPointAt(0),fe.setControlPointAt(fe.pathSize-1),fe.pushPoint(Oe[0])),fe.reset()}_constructCrossedArrow(fe,ve){const _e=ve.pathLength();let be=this._width;_e<be*(1+L0+1)&&(be=_e/(1+L0+1)),ve.seekPathStart();const we=this._curveHelper.getSubCurve(ve,0,_e-be*(1+L0));if(!we)return;we.nextPath();const Se=be/2;if(this._curveHelper.isEmpty(we))return;const Te=n$4p(we),Ee=this._constructOffset(Te,Se);if(!Ee)return;const Ce=this._constructOffset(Te,-Se);if(!Ce)return;const Oe=this._curveHelper.getSubCurve(ve,0,_e-be);if(!Oe)return;if(Oe.nextPath(),this._curveHelper.isEmpty(Oe))return;const Re=n$4p(Oe),De=this._constructOffset(Re,Se);if(!De)return;const Be=this._constructOffset(Re,-Se);if(!Be)return;const Ze=De[De.length-1],Xe=this._constructArrowBasePoint(De,Se/2);if(!Xe)return;const Je=Be[Be.length-1],Qe=this._constructArrowBasePoint(Be,-Se/2);if(!Qe)return;ve.seekInPath(ve.pathSize-1);const dt=[ve.x,ve.y];fe.pushPath(Ee),fe.nextPath(),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Je),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Qe),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(dt),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Xe),fe.nextPoint(),fe.setControlPoint(),fe.pushPoint(Ze),fe.nextPoint(),fe.setControlPoint(),fe.pushPoints(Ce.reverse()),fe.nextPoint(),fe.setControlPoint(),fe.reset()}_constructOffset(fe,ve){return this._curveHelper.offset(fe,ve,ZK.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(fe,ve){if(!fe||fe.length<2)return null;const _e=fe[fe.length-2],be=fe[fe.length-1],we=[be[0]-_e[0],be[1]-_e[1]];return this._curveHelper.normalize(we),[be[0]+we[1]*ve,be[1]-we[0]*ve]}},z0=class m22{static local(){return null===m22.instance&&(m22.instance=new m22),m22.instance}execute(fe,ve,_e,be,we,Se){return new k0(fe,ve,_e,be,we,Se)}};z0.instance=null;let k0=class l17{constructor(fe,ve,_e,be,we,Se){this._inputGeometries=fe,this._tileKey=be,this._geometryEngine=we,this._curveHelper=new I0,this._size=(void 0!==ve.size?ve.size:1)*_e,this._maxInflateSize=Se*_e,this._offsetFlattenError=R0*_e}next(){let fe;for(;fe=this._inputGeometries.next();){if(0===this._size)return fe;if("esriGeometryEnvelope"===fe.geometryType)if(this._size>0){const ve=oK.createEmptyOptimizedCIM(fe.geometryType),_e=t$3Y(fe)[0],be=this._curveHelper.offset(_e,this._size,ZK.Rounded,4,this._offsetFlattenError);if(be)return ve.pushPath(be),ve}else if(this._size<0){const ve=fe.asJSON();if(Math.min(ve.xmax-ve.xmin,ve.ymax-ve.ymin)+2*this._size>0)return oK.fromJSONCIM({xmin:ve.xmin-this._size,xmax:ve.xmax+this._size,ymin:ve.ymin-this._size,ymax:ve.ymax+this._size})}const ve=this._geometryEngine;if(null==ve)return null;const _e=this._tileKey?i$1V(fe,this._maxInflateSize):fe;if(!_e)continue;const be=ve.buffer(zo.WebMercator,_e.asJSON(),this._size,1);return be?oK.fromJSONCIM(be):null}return null}},U0=class e38{static local(){return null===e38.instance&&(e38.instance=new e38),e38.instance}execute(fe,ve,_e,be,we){return new V0(fe,ve,_e)}};U0.instance=null;let V0=class r29{constructor(fe,ve,_e){this._defaultPointSize=20,this._inputGeometries=fe,this._geomUnitsPerPoint=_e,this._rule=ve.rule??HK.FullGeometry,this._defaultSize=this._defaultPointSize*_e}next(){let fe;for(;fe=this._inputGeometries.next();){const ve=this._processGeom(t$3Y(fe));if(null==ve?void 0:ve.length)return oK.fromJSONCIM({paths:ve})}return null}_clone(fe){return[fe[0],fe[1]]}_mid(fe,ve){return[(fe[0]+ve[0])/2,(fe[1]+ve[1])/2]}_mix(fe,ve,_e,be){return[fe[0]*ve+_e[0]*be,fe[1]*ve+_e[1]*be]}_add(fe,ve){return[fe[0]+ve[0],fe[1]+ve[1]]}_add2(fe,ve,_e){return[fe[0]+ve,fe[1]+_e]}_sub(fe,ve){return[fe[0]-ve[0],fe[1]-ve[1]]}_dist(fe,ve){return Math.sqrt((fe[0]-ve[0])*(fe[0]-ve[0])+(fe[1]-ve[1])*(fe[1]-ve[1]))}_norm(fe){return Math.sqrt(fe[0]*fe[0]+fe[1]*fe[1])}_normalize(fe,ve=1){const _e=ve/this._norm(fe);fe[0]*=_e,fe[1]*=_e}_leftPerpendicular(fe){const ve=-fe[1],_e=fe[0];fe[0]=ve,fe[1]=_e}_leftPerp(fe){return[-fe[1],fe[0]]}_rightPerpendicular(fe){const ve=fe[1],_e=-fe[0];fe[0]=ve,fe[1]=_e}_rightPerp(fe){return[fe[1],-fe[0]]}_dotProduct(fe,ve){return fe[0]*ve[0]+fe[1]*ve[1]}_crossProduct(fe,ve){return fe[0]*ve[1]-fe[1]*ve[0]}_rotateDirect(fe,ve,_e){const be=fe[0]*ve-fe[1]*_e,we=fe[0]*_e+fe[1]*ve;fe[0]=be,fe[1]=we}_makeCtrlPt(fe){const ve=[fe[0],fe[1]];return r$1z(ve,1),ve}_addAngledTicks(fe,ve,_e,be){const we=this._sub(_e,ve);this._normalize(we);const Se=this._crossProduct(we,this._sub(be,ve));let Te;Te=Se>0?this._rightPerp(we):this._leftPerp(we);const Ee=Math.abs(Se)/2,Ce=[];Ce.push([ve[0]+(Te[0]-we[0])*Ee,ve[1]+(Te[1]-we[1])*Ee]),Ce.push(ve),Ce.push(_e),Ce.push([_e[0]+(Te[0]+we[0])*Ee,_e[1]+(Te[1]+we[1])*Ee]),fe.push(Ce)}_addBezier2(fe,ve,_e,be,we){if(0==we--)return void fe.push(be);const Se=this._mid(ve,_e),Te=this._mid(_e,be),Ee=this._mid(Se,Te);this._addBezier2(fe,ve,Se,Ee,we),this._addBezier2(fe,Ee,Te,be,we)}_addBezier3(fe,ve,_e,be,we,Se){if(0==Se--)return void fe.push(we);const Te=this._mid(ve,_e),Ee=this._mid(_e,be),Ce=this._mid(be,we),Oe=this._mid(Te,Ee),Re=this._mid(Ee,Ce),De=this._mid(Oe,Re);this._addBezier3(fe,ve,Te,Oe,De,Se),this._addBezier3(fe,De,Re,Ce,we,Se)}_add90DegArc(fe,ve,_e,be,we){const Se=we??this._crossProduct(this._sub(_e,ve),this._sub(be,ve))>0,Te=this._mid(ve,_e),Ee=this._sub(Te,ve);Se?this._leftPerpendicular(Ee):this._rightPerpendicular(Ee),Te[0]+=Ee[0],Te[1]+=Ee[1],this._addBezier3(fe,ve,this._mix(ve,.33333,Te,.66667),this._mix(_e,.33333,Te,.66667),_e,4)}_addArrow(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[ve.length-1],Te=this._sub(be,we),Ee=this._norm(Te);this._normalize(Te);const Ce=Math.abs(this._crossProduct(Te,this._sub(Se,we)));let Oe=this._dotProduct(Te,this._sub(Se,we));Oe<.05*Ee?Oe=.05*Ee:Oe>.95*Ee&&(Oe=.95*Ee);const Re=.5*Ce,De=this._leftPerp(Te),Be=[we[0]+Te[0]*Oe,we[1]+Te[1]*Oe],Ze=ve.length-1,Xe=[];Xe.push(_e?[-De[0],-De[1]]:De);let Je=[-Te[0],-Te[1]];for(let Qe=1;Qe<Ze-1;Qe++){const fe=this._sub(ve[Qe+1],ve[Qe]);this._normalize(fe);const _e=this._dotProduct(fe,Je),be=this._crossProduct(fe,Je),we=Math.sqrt((1+_e)/2),Se=this._sub(fe,Je);this._normalize(Se),Se[0]/=we,Se[1]/=we,Xe.push(be<0?[-Se[0],-Se[1]]:Se),Je=fe}Xe.push(this._rightPerp(Je));for(let Qe=Xe.length-1;Qe>0;Qe--)fe.push([ve[Qe][0]+Xe[Qe][0]*Re,ve[Qe][1]+Xe[Qe][1]*Re]);fe.push([Be[0]+Xe[0][0]*Re,Be[1]+Xe[0][1]*Re]),fe.push([Be[0]+Xe[0][0]*Ce,Be[1]+Xe[0][1]*Ce]),fe.push(be),fe.push([Be[0]-Xe[0][0]*Ce,Be[1]-Xe[0][1]*Ce]),fe.push([Be[0]-Xe[0][0]*Re,Be[1]-Xe[0][1]*Re]);for(let Qe=1;Qe<Xe.length;Qe++)fe.push([ve[Qe][0]-Xe[Qe][0]*Re,ve[Qe][1]-Xe[Qe][1]*Re])}_cp2(fe,ve,_e){return fe.length>=2?fe[1]:this._add2(fe[0],ve*this._defaultSize,_e*this._defaultSize)}_cp3(fe,ve,_e,be){if(fe.length>=3)return fe[2];const we=this._mix(fe[0],1-_e,ve,_e),Se=this._sub(ve,fe[0]);return this._normalize(Se),this._rightPerpendicular(Se),[we[0]+Se[0]*be*this._defaultSize,we[1]+Se[1]*be*this._defaultSize]}_arrowPath(fe){if(fe.length>2)return fe;const ve=fe[0],_e=this._cp2(fe,-4,0),be=this._sub(ve,_e);this._normalize(be);const we=this._rightPerp(be);return[ve,_e,[ve[0]+(we[0]-be[0])*this._defaultSize,ve[1]+(we[1]-be[1])*this._defaultSize]]}_arrowLastSeg(fe){const ve=fe[0],_e=this._cp2(fe,-4,0);let be;if(fe.length>=3)be=fe[fe.length-1];else{const fe=this._sub(ve,_e);this._normalize(fe);const we=this._rightPerp(fe);be=[ve[0]+(we[0]-fe[0])*this._defaultSize,ve[1]+(we[1]-fe[1])*this._defaultSize]}return[_e,be]}_processGeom(fe){if(!fe)return null;const ve=[];for(const _e of fe){if(!_e||0===_e.length)continue;const fe=_e.length;let be=_e[0];switch(this._rule){case HK.PerpendicularFromFirstSegment:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,4),Se=[];Se.push(we),Se.push(this._mid(be,fe)),ve.push(Se);break}case HK.ReversedFirstSegment:{const fe=this._cp2(_e,0,-1);ve.push([fe,be]);break}case HK.PerpendicularToSecondSegment:{if(_e.length<3)return[];const fe=this._cp2(_e,-4,1),we=this._cp3(_e,fe,.882353,-1.94),Se=[];Se.push(this._mid(fe,we)),Se.push(be),ve.push(Se);break}case HK.SecondSegmentWithTicks:{if(_e.length<3)return[];const fe=this._cp2(_e,-4,1),we=this._cp3(_e,fe,.882353,-1.94),Se=this._sub(we,fe);let Te;Te=this._crossProduct(Se,this._sub(be,fe))>0?this._rightPerp(Se):this._leftPerp(Se);const Ee=[];Ee.push([fe[0]+(Te[0]-Se[0])/3,fe[1]+(Te[1]-Se[1])/3]),Ee.push(fe),Ee.push(we),Ee.push([we[0]+(Te[0]+Se[0])/3,we[1]+(Te[1]+Se[1])/3]),ve.push(Ee);break}case HK.DoublePerpendicular:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,3),Se=this._mid(be,fe),Te=this._sub(Se,we);this._normalize(Te);const Ee=this._crossProduct(Te,this._sub(be,we));this._leftPerpendicular(Te);const Ce=[];Ce.push(be),Ce.push([we[0]+Te[0]*Ee,we[1]+Te[1]*Ee]),ve.push(Ce);const Oe=[];Oe.push([we[0]-Te[0]*Ee,we[1]-Te[1]*Ee]),Oe.push(fe),ve.push(Oe);break}case HK.OppositeToFirstSegment:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,3),Se=this._mid(be,fe),Te=this._sub(Se,we);this._normalize(Te);const Ee=this._crossProduct(Te,this._sub(be,we));this._leftPerpendicular(Te);const Ce=[];Ce.push([we[0]+Te[0]*Ee,we[1]+Te[1]*Ee]),Ce.push([we[0]-Te[0]*Ee,we[1]-Te[1]*Ee]),ve.push(Ce);break}case HK.TriplePerpendicular:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,4),Se=this._mid(be,fe),Te=this._sub(Se,we);this._normalize(Te);const Ee=this._crossProduct(Te,this._sub(be,we));this._leftPerpendicular(Te);const Ce=[];Ce.push([we[0]+Te[0]*Ee*.8,we[1]+Te[1]*Ee*.8]),Ce.push([Se[0]+.8*(be[0]-Se[0]),Se[1]+.8*(be[1]-Se[1])]),ve.push(Ce),ve.push([we,Se]);const Oe=[];Oe.push([we[0]-Te[0]*Ee*.8,we[1]-Te[1]*Ee*.8]),Oe.push([Se[0]+.8*(fe[0]-Se[0]),Se[1]+.8*(fe[1]-Se[1])]),ve.push(Oe);break}case HK.HalfCircleFirstSegment:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,4),Se=this._mid(be,fe);let Te=this._sub(fe,be);const Ee=Math.cos(Math.PI/18),Ce=Math.sin(Math.PI/18),Oe=Math.sqrt((1+Ee)/2),Re=Math.sqrt((1-Ee)/2),De=[];let Be;this._crossProduct(Te,this._sub(we,be))>0?(De.push(be),Te=this._sub(be,Se),Be=fe):(De.push(fe),Te=this._sub(fe,Se),Be=be),this._rotateDirect(Te,Oe,Re),Te[0]/=Oe,Te[1]/=Oe;for(let ve=1;ve<=18;ve++)De.push(this._add(Se,Te)),this._rotateDirect(Te,Ee,Ce);De.push(Be),ve.push(De);break}case HK.HalfCircleSecondSegment:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,1,-1);let Se=this._sub(be,fe);this._normalize(Se);const Te=this._crossProduct(Se,this._sub(we,fe))/2;this._leftPerpendicular(Se);const Ee=[fe[0]+Se[0]*Te,fe[1]+Se[1]*Te];Se=this._sub(fe,Ee);const Ce=Math.cos(Math.PI/18);let Oe=Math.sin(Math.PI/18);Te>0&&(Oe=-Oe);const Re=[fe];for(let ve=1;ve<=18;ve++)this._rotateDirect(Se,Ce,Oe),Re.push(this._add(Ee,Se));ve.push(Re);break}case HK.HalfCircleExtended:{const we=this._cp2(_e,0,-2),Se=this._cp3(_e,we,1,-1);let Te;if(fe>=4)Te=_e[3];else{const fe=this._sub(be,we);Te=this._add(Se,fe)}const Ee=this._dist(we,Se)/2/.75,Ce=this._sub(we,be);this._normalize(Ce,Ee);const Oe=this._sub(Se,Te);this._normalize(Oe,Ee);const Re=[Te,Se];ve.push(Re);const De=[this._clone(Se)];this._addBezier3(De,Se,this._add(Se,Oe),this._add(we,Ce),we,4),De.push(be),ve.push(De);break}case HK.OpenCircle:{const fe=this._cp2(_e,-2,0),we=this._sub(fe,be),Se=Math.cos(Math.PI/18),Te=-Math.sin(Math.PI/18),Ee=[fe];for(let ve=1;ve<=33;ve++)this._rotateDirect(we,Se,Te),Ee.push(this._add(be,we));ve.push(Ee);break}case HK.CoverageEdgesWithTicks:{const we=this._cp2(_e,0,-1);let Se,Te;if(fe>=3)Se=_e[2];else{const fe=this._sub(we,be),ve=this._leftPerp(fe);Se=[be[0]+ve[0]-.25*fe[0],be[1]+ve[1]-.25*fe[1]]}if(fe>=4)Te=_e[3];else{const fe=this._mid(be,we),ve=this._sub(be,we);this._normalize(ve),this._leftPerpendicular(ve);const _e=this._crossProduct(ve,this._sub(Se,fe));this._rightPerpendicular(ve),Te=[Se[0]+ve[0]*_e*2,Se[1]+ve[1]*_e*2]}const Ee=this._sub(we,be);let Ce,Oe;Ce=this._crossProduct(Ee,this._sub(Se,be))>0?this._rightPerp(Ee):this._leftPerp(Ee),Oe=[],Oe.push(Se),Oe.push(be),Oe.push([be[0]+(Ce[0]-Ee[0])/3,be[1]+(Ce[1]-Ee[1])/3]),ve.push(Oe),Ce=this._crossProduct(Ee,this._sub(Te,we))>0?this._rightPerp(Ee):this._leftPerp(Ee),Oe=[],Oe.push([we[0]+(Ce[0]+Ee[0])/3,we[1]+(Ce[1]+Ee[1])/3]),Oe.push(we),Oe.push(Te),ve.push(Oe);break}case HK.GapExtentWithDoubleTicks:{const we=this._cp2(_e,0,2),Se=this._cp3(_e,we,0,1);let Te;if(fe>=4)Te=_e[3];else{const fe=this._sub(we,be);Te=this._add(Se,fe)}this._addAngledTicks(ve,be,we,this._mid(Se,Te)),this._addAngledTicks(ve,Se,Te,this._mid(be,we));break}case HK.GapExtentMidline:{const we=this._cp2(_e,2,0),Se=this._cp3(_e,we,0,1);let Te;if(fe>=4)Te=_e[3];else{const fe=this._sub(we,be);Te=this._add(Se,fe)}const Ee=[];Ee.push(this._mid(be,Se)),Ee.push(this._mid(we,Te)),ve.push(Ee);break}case HK.Chevron:{const we=this._cp2(_e,-1,-1);let Se;if(fe>=3)Se=_e[2];else{const fe=this._sub(we,be);this._leftPerpendicular(fe),Se=this._add(be,fe)}ve.push([we,this._makeCtrlPt(be),Se]);break}case HK.PerpendicularWithArc:{const we=this._cp2(_e,0,-2),Se=this._cp3(_e,we,.5,-1),Te=this._sub(we,be),Ee=this._norm(Te);Te[0]/=Ee,Te[1]/=Ee;const Ce=this._crossProduct(Te,this._sub(Se,be));let Oe=this._dotProduct(Te,this._sub(Se,be));Oe<.05*Ee?Oe=.05*Ee:Oe>.95*Ee&&(Oe=.95*Ee);const Re=[be[0]+Te[0]*Oe,be[1]+Te[1]*Oe];let De=this._leftPerp(Te),Be=[];if(Be.push([Re[0]-De[0]*Ce,Re[1]-De[1]*Ce]),Be.push([Re[0]+De[0]*Ce,Re[1]+De[1]*Ce]),ve.push(Be),fe>=4){const fe=_e[3];let we=this._dotProduct(Te,this._sub(fe,be));we<.1*Ee?we=.1*Ee:we>.9*Ee&&(we=.9*Ee);const Se=[be[0]+Te[0]*we,be[1]+Te[1]*we],Ce=this._crossProduct(Te,this._sub(fe,be)),Oe=[];Oe.push([Se[0]-De[0]*Ce,Se[1]-De[1]*Ce]),Oe.push([Se[0]+De[0]*Ce,Se[1]+De[1]*Ce]),ve.push(Oe)}const Ze=[we[0]+De[0]*Ce,we[1]+De[1]*Ce];De=this._sub(we,Ze);const Xe=Math.cos(Math.PI/18);let Je=Math.sin(Math.PI/18);Ce<0&&(Je=-Je),Be=[be,we];for(let fe=1;fe<=9;fe++)this._rotateDirect(De,Xe,Je),Be.push(this._add(Ze,De));ve.push(Be);break}case HK.ClosedHalfCircle:{const fe=this._cp2(_e,2,0),we=this._mid(be,fe),Se=this._sub(fe,we),Te=Math.cos(Math.PI/18),Ee=Math.sin(Math.PI/18),Ce=[be,fe];for(let ve=1;ve<=18;ve++)this._rotateDirect(Se,Te,Ee),Ce.push(this._add(we,Se));ve.push(Ce);break}case HK.TripleParallelExtended:{const fe=this._cp2(_e,0,-2),we=this._cp3(_e,fe,1,-2),Se=this._mid(be,fe),Te=this._sub(we,fe);this._normalize(Te);const Ee=Math.abs(this._crossProduct(Te,this._sub(Se,fe)))/2,Ce=this._dist(fe,we),Oe=[fe,be];Oe.push([be[0]+Te[0]*Ce*.5,be[1]+Te[1]*Ce*.5]),ve.push(Oe);const Re=[];Re.push([Se[0]-Te[0]*Ee,Se[1]-Te[1]*Ee]),Re.push([Se[0]+Te[0]*Ce*.375,Se[1]+Te[1]*Ce*.375]),r$1z(Re[Re.length-1],1),Re.push([Se[0]+Te[0]*Ce*.75,Se[1]+Te[1]*Ce*.75]),ve.push(Re);const De=[fe,we];ve.push(De);break}case HK.ParallelWithTicks:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._sub(we,fe);this._normalize(Se);const Te=this._crossProduct(Se,this._sub(we,be));this._leftPerpendicular(Se),this._addAngledTicks(ve,be,fe,we),this._addAngledTicks(ve,this._mix(be,1,Se,Te),this._mix(fe,1,Se,Te),this._mid(be,fe));break}case HK.Parallel:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._sub(fe,be);this._normalize(Se);const Te=this._leftPerp(Se),Ee=this._crossProduct(Se,this._sub(we,be));let Ce=[be,fe];ve.push(Ce),Ce=[],Ce.push([be[0]+Te[0]*Ee,be[1]+Te[1]*Ee]),Ce.push([fe[0]+Te[0]*Ee,fe[1]+Te[1]*Ee]),ve.push(Ce);break}case HK.PerpendicularToFirstSegment:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._mid(be,fe),Te=this._sub(fe,be);this._normalize(Te);const Ee=this._crossProduct(Te,this._sub(we,be));this._leftPerpendicular(Te);const Ce=[];Ce.push([Se[0]-Te[0]*Ee*.25,Se[1]-Te[1]*Ee*.25]),Ce.push([Se[0]+Te[0]*Ee*1.25,Se[1]+Te[1]*Ee*1.25]),ve.push(Ce);break}case HK.ParallelOffset:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._sub(fe,be);this._normalize(Se);const Te=this._crossProduct(Se,this._sub(we,be));this._leftPerpendicular(Se);const Ee=[];Ee.push([be[0]-Se[0]*Te,be[1]-Se[1]*Te]),Ee.push([fe[0]-Se[0]*Te,fe[1]-Se[1]*Te]),ve.push(Ee);const Ce=[];Ce.push([be[0]+Se[0]*Te,be[1]+Se[1]*Te]),Ce.push([fe[0]+Se[0]*Te,fe[1]+Se[1]*Te]),ve.push(Ce);break}case HK.OffsetOpposite:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._sub(fe,be);this._normalize(Se);const Te=this._crossProduct(Se,this._sub(we,be));this._leftPerpendicular(Se);const Ee=[];Ee.push([be[0]-Se[0]*Te,be[1]-Se[1]*Te]),Ee.push([fe[0]-Se[0]*Te,fe[1]-Se[1]*Te]),ve.push(Ee);break}case HK.OffsetSame:{const fe=this._cp2(_e,3,0),we=this._cp3(_e,fe,.5,-1),Se=this._sub(fe,be);this._normalize(Se);const Te=this._crossProduct(Se,this._sub(we,be));this._leftPerpendicular(Se);const Ee=[];Ee.push([be[0]+Se[0]*Te,be[1]+Se[1]*Te]),Ee.push([fe[0]+Se[0]*Te,fe[1]+Se[1]*Te]),ve.push(Ee);break}case HK.CircleWithArc:{let we=this._cp2(_e,3,0);const Se=this._cp3(_e,we,.5,-1);let Te,Ee;if(fe>=4)Te=_e[3],Ee=this._crossProduct(this._sub(Te,we),this._sub(Se,we))>0;else{Te=we,Ee=this._crossProduct(this._sub(Te,be),this._sub(Se,be))>0;const fe=24*this._geomUnitsPerPoint,ve=this._sub(Te,be);this._normalize(ve,fe);const _e=Math.sqrt(2)/2;this._rotateDirect(ve,_e,Ee?_e:-_e),we=this._add(be,ve)}const Ce=this._sub(we,be),Oe=Math.cos(Math.PI/18),Re=Math.sin(Math.PI/18),De=[we];for(let fe=1;fe<=36;fe++)this._rotateDirect(Ce,Oe,Re),De.push(this._add(be,Ce));this._add90DegArc(De,we,Te,Se,Ee),r$1z(De[De.length-8],1),ve.push(De);break}case HK.DoubleJog:{let we,Se=this._cp2(_e,-3,1),Te=this._cp3(_e,Se,-1,-.5);if(fe>=4)we=_e[3];else{const fe=be;be=Se,we=Te;const ve=this._dist(be,fe),_e=this._dist(we,fe);let Ee=30*this._geomUnitsPerPoint;.5*ve<Ee&&(Ee=.5*ve),.5*_e<Ee&&(Ee=.5*_e),Se=this._mix(be,Ee/ve,fe,(ve-Ee)/ve),Te=this._mix(we,Ee/_e,fe,(_e-Ee)/_e)}const Ee=this._mid(be,Se),Ce=this._mid(we,Te),Oe=this._dist(be,Se),Re=this._dist(Te,we);let De=Math.min(Oe,Re)/8;De=Math.min(De,24*this._geomUnitsPerPoint);const Be=Math.cos(Math.PI/4);let Ze=this._sub(be,Se);this._normalize(Ze,De),this._crossProduct(Ze,this._sub(we,Se))>0?this._rotateDirect(Ze,Be,-Be):this._rotateDirect(Ze,Be,Be);let Xe=[];Xe.push(Se),Xe.push(this._add(Ee,Ze)),Xe.push(this._sub(Ee,Ze)),Xe.push(be),ve.push(Xe),Ze=this._sub(we,Te),this._normalize(Ze,De),this._crossProduct(Ze,this._sub(be,Te))<0?this._rotateDirect(Ze,Be,Be):this._rotateDirect(Ze,Be,-Be),Xe=[],Xe.push(Te),Xe.push(this._add(Ce,Ze)),Xe.push(this._sub(Ce,Ze)),Xe.push(we),ve.push(Xe);break}case HK.PerpendicularOffset:{const fe=this._cp2(_e,-4,1),we=this._cp3(_e,fe,.882353,-1.94),Se=this._sub(we,fe);this._crossProduct(Se,this._sub(be,fe))>0?this._rightPerpendicular(Se):this._leftPerpendicular(Se);const Te=[Se[0]/8,Se[1]/8],Ee=this._sub(this._mid(fe,we),Te);ve.push([Ee,be]);break}case HK.LineExcludingLastSegment:{const fe=this._arrowPath(_e),be=[];let we=fe.length-2;for(;we--;)be.push(fe[we]);ve.push(be);break}case HK.MultivertexArrow:{const fe=this._arrowPath(_e),be=[];this._addArrow(be,fe,!1),ve.push(be);break}case HK.CrossedArrow:{const fe=this._arrowPath(_e),be=[];this._addArrow(be,fe,!0),ve.push(be);break}case HK.ChevronArrow:{const[fe,we]=this._arrowLastSeg(_e),Se=10*this._geomUnitsPerPoint,Te=this._sub(be,fe),Ee=this._norm(Te);this._normalize(Te);const Ce=this._crossProduct(Te,this._sub(we,fe));let Oe=this._dotProduct(Te,this._sub(we,fe));Oe<.05*Ee?Oe=.05*Ee:Oe>.95*Ee-Se&&(Oe=.95*Ee-Se);const Re=[fe[0]+Te[0]*Oe,fe[1]+Te[1]*Oe],De=this._leftPerp(Te),Be=[];Be.push([Re[0]+De[0]*Ce+Te[0]*Se,Re[1]+De[1]*Ce+Te[1]*Se]),Be.push(be),Be.push([Re[0]-De[0]*Ce+Te[0]*Se,Re[1]-De[1]*Ce+Te[1]*Se]),ve.push(Be);break}case HK.ChevronArrowOffset:{const[fe,we]=this._arrowLastSeg(_e),Se=this._sub(be,fe),Te=this._norm(Se);this._normalize(Se);const Ee=this._crossProduct(Se,this._sub(we,fe));let Ce=this._dotProduct(Se,this._sub(we,fe));Ce<.05*Te?Ce=.05*Te:Ce>.95*Te&&(Ce=.95*Te);const Oe=[fe[0]+Se[0]*Ce,fe[1]+Se[1]*Ce];this._leftPerpendicular(Se);const Re=[];Re.push([Oe[0]+Se[0]*Ee*.5,Oe[1]+Se[1]*Ee*.5]),Re.push(this._mid(Oe,be)),Re.push([Oe[0]-Se[0]*Ee*.5,Oe[1]-Se[1]*Ee*.5]),ve.push(Re);break}case HK.PartialFirstSegment:{const[fe,we]=this._arrowLastSeg(_e),Se=this._sub(be,fe),Te=this._norm(Se);this._normalize(Se);let Ee=this._dotProduct(Se,this._sub(we,fe));Ee<.05*Te?Ee=.05*Te:Ee>.95*Te&&(Ee=.95*Te);const Ce=[fe[0]+Se[0]*Ee,fe[1]+Se[1]*Ee];ve.push([fe,Ce]);break}case HK.Arch:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,1),Se=this._sub(be,fe),Te=this._mix(we,1,Se,.55),Ee=this._mix(we,1,Se,-.55),Ce=[be];this._addBezier2(Ce,be,Te,we,4),this._addBezier2(Ce,we,Ee,fe,4),ve.push(Ce);break}case HK.CurvedParallelTicks:{const fe=this._cp2(_e,-4,1),we=this._cp3(_e,fe,.882353,-1.94),Se=this._sub(we,fe);this._crossProduct(Se,this._sub(be,fe))>0?this._rightPerpendicular(Se):this._leftPerpendicular(Se);const Te=[Se[0]/8,Se[1]/8],Ee=this._sub(this._mid(fe,we),Te),Ce=this._sub(this._mix(fe,.75,we,.25),Te),Oe=this._sub(this._mix(fe,.25,we,.75),Te),Re=[fe];this._addBezier2(Re,fe,Ce,Ee,3),this._addBezier2(Re,Ee,Oe,we,3),ve.push(Re);for(let _e=0;_e<8;_e++){const fe=Re[2*_e+1],be=[this._clone(fe)];be.push(this._add(fe,[Se[0]/4,Se[1]/4])),ve.push(be)}break}case HK.Arc90Degrees:{const fe=this._cp2(_e,0,-1),we=this._cp3(_e,fe,.5,1),Se=[fe];this._add90DegArc(Se,fe,be,we),ve.push(Se);break}case HK.TipWithPerpendicularAndTicks:{const[fe,we]=this._arrowLastSeg(_e),Se=10*this._geomUnitsPerPoint,Te=this._sub(be,fe),Ee=this._norm(Te);this._normalize(Te);let Ce=this._crossProduct(Te,this._sub(we,fe)),Oe=this._dotProduct(Te,this._sub(we,fe));Oe<.05*Ee?Oe=.05*Ee:Oe>.95*Ee-Se&&(Oe=.95*Ee-Se);const Re=this._leftPerp(Te),De=[be[0]-Te[0]*Se,be[1]-Te[1]*Se],Be=.5*Math.max(Ee-Oe-Se,Se);Ce=Math.abs(Ce);const Ze=[];Ze.push([De[0]+Re[0]*(Ce+Be)-Te[0]*Be,De[1]+Re[1]*(Ce+Be)-Te[1]*Be]),Ze.push([De[0]+Re[0]*Ce,De[1]+Re[1]*Ce]),Ze.push([De[0]-Re[0]*Ce,De[1]-Re[1]*Ce]),Ze.push([De[0]-Re[0]*(Ce+Be)-Te[0]*Be,De[1]-Re[1]*(Ce+Be)-Te[1]*Be]),ve.push(Ze),ve.push([De,be]);break}case HK.FullGeometry:default:ve.push(_e)}}return ve}},B0=class r30{static local(){return null===r30.instance&&(r30.instance=new r30),r30.instance}execute(fe,ve,_e,be,we){return new j0(fe,ve,_e)}};B0.instance=null;let j0=class u17 extends SK{constructor(fe,ve,_e){super(fe,!0,!0),this._curveHelper=new I0,this._beginCut=(void 0!==ve.beginCut?ve.beginCut:1)*_e,this._endCut=(void 0!==ve.endCut?ve.endCut:1)*_e,this._middleCut=(void 0!==ve.middleCut?ve.middleCut:0)*_e,this._invert=void 0!==ve.invert&&ve.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(fe){const{_beginCut:ve,_endCut:_e,_middleCut:be}=this,we=fe.pathLength(),Se=oK.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==ve||0!==_e||0!==be)if(ve+_e+be>=we)for(Se.startPath();fe.nextPoint();)Se.pushXY(fe.x,fe.y);else this._curveHelper.appendSubCurve(Se,fe,0,ve),this._curveHelper.appendSubCurve(Se,fe,.5*(we-be),.5*(we+be)),this._curveHelper.appendSubCurve(Se,fe,we-_e,_e)}else if(0===ve&&0===_e&&0===be)for(Se.startPath();fe.nextPoint();)Se.pushXY(fe.x,fe.y);else ve+_e+be<we&&(0===be?this._curveHelper.appendSubCurve(Se,fe,ve,we-_e):(this._curveHelper.appendSubCurve(Se,fe,ve,.5*(we-be)),this._curveHelper.appendSubCurve(Se,fe,.5*(we+be),we-_e)));return 0===Se.totalSize?null:Se}};let G0=class i27{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(fe,ve,_e=!0){if(this._setEmpty(),!fe||0===fe.length)return!1;for(let be=0;be<fe.length;be++){let ve=Math.abs(fe[be]);_e&&ve<1e-7&&(ve=1e-7),this._values.push(ve),this._length+=ve}return ve&&1&fe.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(fe){const ve=this._values?this._values.length:0;for(let _e=0;_e<ve;++_e)this._values[_e]*=fe;this._length*=fe,this.extPtGap*=fe,this.ctrlPtGap*=fe}addValue(fe){this._length+=fe,this._values.push(fe)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},H0=class h18{constructor(){this.pt=null,this.ca=0,this.sa=0}};var q0;!function(fe){fe[fe.FAIL=0]="FAIL",fe[fe.END=1]="END",fe[fe.CONTINUE=2]="CONTINUE"}(q0||(q0={}));let W0=class a26{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(fe){fe.segment=this.segment,fe.segmentLength=this.segmentLength,fe.abscissa=this.abscissa,fe.isPathEnd=this.isPathEnd,fe.isPartEnd=this.isPartEnd}},Y0=class o26 extends I0{constructor(fe=0,ve=!1){super(fe,ve),this._tolerance=R0,this._currentPosition=new W0}updateTolerance(fe){this._tolerance=R0*fe}init(fe,ve,_e=!0){return _e?(this._patternLength=ve.length(),this._partExtPtGap=ve.extPtGap,this._partCtrlPtGap=ve.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=fe,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(fe,ve=q0.FAIL){const _e=new W0;return!!this._nextPosition(fe,_e,null,ve)&&(_e.copyTo(this._currentPosition),!0)}curPointAndAngle(fe){fe.pt=this._getPoint(this._currentPosition);const[ve,_e]=this._getAngleCS(this._currentPosition);fe.ca=ve,fe.sa=_e}nextPointAndAngle(fe,ve,_e=q0.FAIL){const be=new W0;if(!this._nextPosition(fe,be,null,_e))return!1;be.copyTo(this._currentPosition),ve.pt=this._getPoint(be);const[we,Se]=this._getAngleCS(be);return ve.ca=we,ve.sa=Se,!0}nextCurve(fe){if(0===fe)return null;const ve=oK.createEmptyOptimizedCIM("esriGeometryPolyline");ve.startPath(),ve.nextPath();const _e=new W0;return this._nextPosition(fe,_e,ve,q0.END)?(_e.copyTo(this._currentPosition),ve):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(fe){return this._pathCursor.seekInPath(fe),[this._pathCursor.x,this._pathCursor.y]}getSeg(fe){return[this.getPt(fe),this.getPt(fe+1)]}_nextPosition(fe,ve,_e,be){if(this._currentPosition.isPathEnd)return!1;let we=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(we/=this._currentPosition.segmentLength),this._currentPosition.copyTo(ve);ve.abscissa+fe*this._partLengthRatio>ve.segmentLength+this._tolerance;){if(_e){if(0===_e.pathSize)if(0===we){const fe=ve.segment[0];_e.pushXY(fe[0],fe[1])}else _e.pushPoint(this.getSegCoord2D(ve.segment,we));const fe=ve.segment[1];_e.pushXY(fe[0],fe[1])}if(we=0,fe-=(ve.segmentLength-ve.abscissa)/this._partLengthRatio,this._partSegCount)ve.segment=this._nextSegment(),ve.segmentLength=this.getSegLength(ve.segment),ve.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return be!==q0.FAIL&&(ve.segmentLength=this.getSegLength(ve.segment),ve.isPartEnd=!0,be===q0.END?(ve.abscissa=ve.segmentLength,ve.isPathEnd=!0):ve.abscissa=ve.segmentLength+fe,!0);this._currentPosition.copyTo(ve)}}if(ve.abscissa+=fe*this._partLengthRatio,_e){0===_e.pathSize&&(0===we?_e.pushPoint(ve.segment[0]):_e.pushPoint(this.getSegCoord2D(ve.segment,we)));const fe=ve.abscissa/ve.segmentLength;1===fe?_e.pushPoint(ve.segment[1]):_e.pushPoint(this.getSegCoord2D(ve.segment,fe))}return this._partSegCount||Math.abs(ve.abscissa-ve.segmentLength)<this._tolerance&&(ve.isPathEnd=this._partIsLast,ve.isPartEnd=!0),!0}_getPoint(fe){const ve=fe.segmentLength<=0?0:fe.abscissa/fe.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,ve)}_getAngleCS(fe){const ve=fe.segmentLength<=0?0:fe.abscissa/fe.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,ve)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let fe=this._partSegCount;for(;fe;)this._previousSegment(),--fe;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const ve=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(ve);let _e=ve+this._partSegCount+1;if(_e>=this._pathCursor.pathSize&&(_e=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(_e),this._patternLength>0){const fe=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,ve=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let _e=Math.round((this._partLength-(fe+ve))/this._patternLength);_e<=0&&(_e=fe+ve>0?0:1),this._partLengthRatio=this._partLength/(fe+ve+_e*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const Z0={scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},X0={scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},J0={angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},Q0={capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},K0={offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1};const e1=" /-,\n";function a$1S(fe){let ve=fe.length;for(;ve--;)if(!e1.includes(fe.charAt(ve)))return!1;return!0}function s$1L(fe,ve,_e,be){let we="",Se=null;for(const Te of ve){const[ve,be,Ee]=Te;if(ve)Ee?Se=ve:(Se&&(we+=Se,Se=null),we+=ve);else{let ve=be;null!=_e&&(ve=B$l(be,_e));const Te=fe.attributes[ve];Te&&(Se&&(we+=Se,Se=null),we+=Te)}}return function c$1T(fe,ve){switch("string"!=typeof fe&&(fe=String(fe)),ve){case"LowerCase":return fe.toLowerCase();case"Allcaps":return fe.toUpperCase();default:return fe}}(we,be)}function M$z(fe){return"CIMVectorMarker"===fe.type||"CIMPictureMarker"===fe.type||"CIMBarChartMarker"===fe.type||"CIMCharacterMarker"===fe.type||"CIMPieChartMarker"===fe.type||"CIMStackedBarChartMarker"===fe.type}function m$1u(fe){return"CIMGradientStroke"===fe.type||"CIMPictureStroke"===fe.type||"CIMSolidStroke"===fe.type}function b$R(fe){return null!=fe&&("CIMMarkerPlacementAlongLineRandomSize"===fe.type||"CIMMarkerPlacementAlongLineSameSize"===fe.type||"CIMMarkerPlacementAlongLineVariableSize"===fe.type||"CIMMarkerPlacementAtExtremities"===fe.type||"CIMMarkerPlacementAtMeasuredUnits"===fe.type||"CIMMarkerPlacementAtRatioPositions"===fe.type||"CIMMarkerPlacementOnLine"===fe.type||"CIMMarkerPlacementOnVertices"===fe.type)}const I$F=(fe,ve=0)=>null==fe||isNaN(fe)?ve:fe;function S$N(fe){if(!fe)return"normal";switch(fe.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function g$Z(fe){if(!fe)return"normal";switch(fe.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function P$t(fe){let ve="normal",_e="normal";if(fe){const be=fe.toLowerCase();be.includes("italic")?ve="italic":be.includes("oblique")&&(ve="oblique"),be.includes("bold")?_e="bold":be.includes("light")&&(_e="lighter")}return{style:ve,weight:_e}}function w$S(fe){return fe.underline?"underline":fe.strikethrough?"line-through":"none"}function L$s(fe){if(!fe)return null;switch(fe.type){case"CIMPolygonSymbol":if(fe.symbolLayers)for(const ve of fe.symbolLayers){const fe=L$s(ve);if(null!=fe)return fe}break;case"CIMTextSymbol":return L$s(fe.symbol);case"CIMSolidFill":return fe.color}return null}function N$u(fe){if(fe)switch(fe.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const ve=fe.symbolLayers;if(ve)for(const fe of ve){const ve=N$u(fe);if(null!=ve)return ve}break}case"CIMTextSymbol":return N$u(fe.symbol);case"CIMSolidStroke":return fe.color}}function T$w(fe){if(fe)switch(fe.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(fe.symbolLayers)for(const ve of fe.symbolLayers){const fe=T$w(ve);if(void 0!==fe)return fe}break;case"CIMTextSymbol":return T$w(fe.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return fe.width}}function F$t(fe){return(fe?Object.keys(fe):[]).map((ve=>({name:ve,alias:ve,type:"string"==typeof fe[ve]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const G$i=fe=>fe.includes("data:image/svg+xml");function V$w(fe){if(!fe)return null;switch(fe.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function v$K(fe){return fe?fe.charAt(0).toLowerCase()+fe.substring(1):fe}function z$o(fe,ve,_e,be,we,Se){const{infos:Te}=Se;let Ee=1,Ce=0,Oe=0,Re=0;for(const{offsetX:Ze,offsetY:Xe,rotation:Je,size:Qe,frameHeight:dt,rotateClockWise:$t}of Te)Oe=U$w(Ze,Xe,Ce,Ee,Oe),Re=J$e(Ze,Xe,Ce,Ee,Re),dt&&(Ee*=Qe/dt),Ce=W$i(Je,$t,Ce);const De=U$w(be,we,Ce,Ee,Oe),Be=J$e(be,we,Ce,Ee,Re);return{size:fe*Ee,rotation:W$i(ve,_e,Ce),offsetX:De,offsetY:Be}}function D$u(fe){return(null==fe?void 0:fe.dashTemplate)&&"string"==typeof fe.dashTemplate&&(fe.dashTemplate=fe.dashTemplate.split(" ").map(Number)),fe}function j$I(fe){if(null==fe)return"Normal";switch(fe.type){case"CIMTextSymbol":return fe.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const ve=fe.symbolLayers;if(!ve)return"Normal";for(const fe of ve)if("CIMVectorMarker"===fe.type)return j$I(fe)}break;case"CIMVectorMarker":{const ve=fe.markerGraphics;if(!ve)return"Normal";for(const fe of ve)if(fe.symbol)return j$I(fe.symbol)}}return"Normal"}function B$l(fe,ve){if(null!==ve){const _e=ve.get(fe);return _e?_e.name:fe}return fe}function R$A(fe){return fe.map((fe=>({...fe,propertyName:v$K(fe.propertyName)})))}function H$n(fe){const ve={};for(const _e in fe){const be=fe[_e];ve[v$K(_e)]=be}return ve}function J$e(fe,ve,_e,be,we){const Se=_e*Math.PI/180;if(Se){const _e=Math.cos(Se);return(Math.sin(Se)*fe+_e*ve)*be+we}return ve*be+we}function U$w(fe,ve,_e,be,we){const Se=_e*Math.PI/180;return Se?(Math.cos(Se)*fe-Math.sin(Se)*ve)*be+we:fe*be+we}function W$i(fe,ve,_e){return ve?_e-fe:_e+fe}let t1=class _7{static local(){return null===_7.instance&&(_7.instance=new _7),_7.instance}execute(fe,ve,_e,be,we){return new r1(fe,ve,_e,be)}};t1.instance=null;let r1=class p27 extends SK{constructor(fe,ve,_e,be){super(fe,!0,!0),this._firstCurve=null,this._walker=new Y0,this._walker.updateTolerance(_e),this._endings=ve.lineDashEnding,this._customDashPos=-(ve.offsetAlongLine??0)*_e,this._offsetAtEnd=(ve.customEndingOffset??0)*_e,this._tileKey=be;let we=D$u(ve).dashTemplate;null==we&&(we=[]),we.length%2&&(we=[...we,...we]);let Se=0;for(let Te=0;Te<we.length;Te++){let fe=Math.abs(we[Te]);fe<1e-7&&(fe=1e-7),Se+=fe}this._patternLength=Se,this._numOfDashesPerPattern=we.length/2,this._pattern=new G0,this._pattern.init(we,!0),this._pattern.scale(_e)}processPath(fe){if(0===this._pattern.length()){this.iteratePath=!1;const ve=n$4p(fe);return oK.fromJSONCIM({paths:[ve]})}if(!this.iteratePath){let ve=!0;switch(this._endings){case a0.HalfPattern:case a0.HalfGap:default:this._pattern.extPtGap=0;break;case a0.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case a0.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case a0.NoConstraint:this.isClosed||(ve=!1);break;case a0.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const _e=fe.pathLength();if(this._pattern.isEmpty()||_e<.1*this._pattern.length()){const ve=n$4p(fe);return oK.fromJSONCIM({paths:[ve]})}if(!this._walker.init(fe,this._pattern,ve)){const ve=n$4p(fe);return oK.fromJSONCIM({paths:[ve]})}}let ve;if(this.iteratePath)ve=this._pattern.nextValue();else{let fe;switch(this._endings){case a0.HalfPattern:default:fe=.5*this._pattern.firstValue();break;case a0.HalfGap:fe=.5*-this._pattern.lastValue();break;case a0.FullGap:fe=-this._pattern.lastValue();break;case a0.FullPattern:fe=0;break;case a0.NoConstraint:case a0.Custom:fe=-this._customDashPos}let _e=fe/this._pattern.length();_e-=Math.floor(_e),fe=_e*this._pattern.length(),this._pattern.reset(),ve=this._pattern.nextValue();let be=!1;for(;fe>=ve;)fe-=ve,ve=this._pattern.nextValue(),be=!be;ve-=fe,be?(this._walker.nextPosition(ve),ve=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(ve),ve=this._pattern.nextValue(),this._walker.nextPosition(ve),ve=this._pattern.nextValue())}let _e=this._walker.nextCurve(ve);if(_e)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)_e.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else ve=this._pattern.nextValue(),!this._walker.nextPosition(ve)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(_e.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,_e=this._firstCurve,this._firstCurve=null;return null==_e||_e.reset(),_e}isClippingRequired(fe){const ve=t$3Y(fe);let _e=0;for(const be of ve)_e+=h$2L(be);return Math.round(this._numOfDashesPerPattern*(_e/this._patternLength))>1e3}},i1=class s51{static local(){return null===s51.instance&&(s51.instance=new s51),s51.instance}execute(fe,ve,_e,be,we,Se){return new n1(fe,ve,_e,be,we,Se)}};i1.instance=null;let n1=class r31{constructor(fe,ve,_e,be,we,Se){switch(this._inputGeometries=fe,this._tileKey=be,this._geometryEngine=we,this._maxInflateSize=Se*_e,this._width=(void 0!==ve.width?ve.width:2)*_e,ve.method){case qK.Mitered:case qK.Bevelled:case qK.Rounded:case qK.TrueBuffer:case qK.Square:}this._option=ve.option}next(){let fe;for(;fe=this._inputGeometries.next();){if("esriGeometryEnvelope"===fe.geometryType&&this._width>0){const ve=fe.asJSON();return Math.min(ve.xmax-ve.xmin,ve.ymax-ve.ymin)-2*this._width<0?fe:oK.fromJSONCIM({paths:[[[ve.xmin+this._width,ve.ymin+this._width],[ve.xmax-this._width,ve.ymin+this._width],[ve.xmax-this._width,ve.ymax-this._width],[ve.xmin+this._width,ve.ymax-this._width],[ve.xmin+this._width,ve.ymin+this._width]],[[ve.xmin,ve.ymin],[ve.xmin,ve.ymax],[ve.xmax,ve.ymax],[ve.xmax,ve.ymin],[ve.xmin,ve.ymin]]]})}if("esriGeometryPolygon"===fe.geometryType){if(0===this._width)return fe.clone();const ve=this._geometryEngine;if(null==ve)return null;const _e=this._tileKey?i$1V(fe,this._maxInflateSize):fe.clone();if(!_e)continue;const be=ve.buffer(zo.WebMercator,_e.asJSON(),-this._width,1);if(be)for(const fe of be.rings)if(fe){_e.startPath();for(const ve of fe.reverse())_e.pushXY(ve[0],_e.yFactor*ve[1])}return _e}}return null}},s1=class e39{static local(){return null===e39.instance&&(e39.instance=new e39),e39.instance}execute(fe,ve,_e,be,we){return new o1(fe,ve,_e)}};s1.instance=null;let o1=class n25 extends SK{constructor(fe,ve,_e){super(fe,!1,!0),this._curveHelper=new I0,this._length=(void 0!==ve.length?ve.length:20)*_e,this._angle=void 0!==ve.angle?ve.angle:225,this._position=void 0!==ve.position?ve.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(fe){const ve=oK.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(fe))return null;fe.seekInPath(0);const _e=fe.x,be=fe.y;fe.seekInPath(fe.pathSize-1);const we=fe.x,Se=fe.y,Te=[we-_e,Se-be];this._curveHelper.normalize(Te);const Ee=_e+(we-_e)*this._position/100,Ce=be+(Se-be)*this._position/100,Oe=Math.cos((90-this._angle)/180*Math.PI);let Re=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(Re=-Re),this._mirror=!this._mirror;const De=[Ee-this._length/2*Oe,Ce-this._length/2*Re],Be=[Ee+this._length/2*Oe,Ce+this._length/2*Re];return ve.pushPath([[_e,be],De,Be,[we,Se]]),ve}},a1=class t50{static local(){return null===t50.instance&&(t50.instance=new t50),t50.instance}execute(fe,ve,_e,be,we){return new l1(fe,ve,_e)}};a1.instance=null;let l1=class e40{constructor(fe,ve,_e){this._inputGeometries=fe,this._offsetX=void 0!==ve.offsetX?ve.offsetX*_e:0,this._offsetY=void 0!==ve.offsetY?ve.offsetY*_e:0}next(){let fe=this._inputGeometries.next();for(;fe;){if(fe.totalSize>0)return this._move(fe.clone(),this._offsetX,this._offsetY);fe=this._inputGeometries.next()}return null}_move(fe,ve,_e){for(;fe.nextPath();)for(;fe.nextPoint();)fe.x=fe.x+ve,fe.y=fe.y+_e;return fe.reset(),fe}};let c1=class h19{static local(){return null===h19.instance&&(h19.instance=new h19),h19.instance}execute(fe,ve,_e,be,we,Se){return new u1(fe,ve,_e,be,we,Se)}};c1.instance=null;let u1=class l18{constructor(fe,ve,_e,be,we,Se){this._inputGeometries=fe,this._tileKey=be,this._geometryEngine=we,this._curveHelper=new I0,this._offset=(ve.offset??1)*_e,this._method=ve.method,this._maxInflateSize=Math.max(Math.abs(Se*_e),10),this._option=ve.option,this._offsetFlattenError=R0*_e}next(){let fe;for(;fe=this._inputGeometries.next();){if(0===this._offset)return fe.clone();if("esriGeometryEnvelope"===fe.geometryType){if(this._method===ZK.Rounded&&this._offset>0){const ve=n$4p(fe),_e=this._curveHelper.offset(ve,-this._offset,this._method,4,this._offsetFlattenError);if(_e){const ve=oK.createEmptyOptimizedCIM(fe.geometryType);return ve.pushPath(_e),ve}return null}const ve=fe.asJSON();if(m$3w(ve)&&Math.min(ve.xmax-ve.xmin,ve.ymax-ve.ymin)+2*this._offset>0)return oK.fromJSONCIM({xmin:ve.xmin-this._offset,xmax:ve.xmax+this._offset,ymin:ve.ymin-this._offset,ymax:ve.ymax+this._offset})}const ve=this._geometryEngine;if(null==ve)continue;const _e=this._tileKey?i$1V(fe,this._maxInflateSize):fe.clone();if(!_e)continue;const be=ve.offset(zo.WebMercator,_e.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return be?oK.fromJSONCIM(be):null}return null}},h1=class e41{static local(){return null===e41.instance&&(e41.instance=new e41),e41.instance}execute(fe,ve,_e,be,we){return new d1(fe,ve,_e)}};h1.instance=null;let d1=class t51{constructor(fe,ve,_e){this._inputGeometries=fe,this._reverse=void 0===ve.reverse||ve.reverse}next(){let fe=this._inputGeometries.next();for(;fe;){if(!this._reverse)return fe;if("esriGeometryPolyline"===fe.geometryType)return n$1_(fe.clone());fe=this._inputGeometries.next()}return null}};function n$1_(fe){for(;fe.nextPath();)for(let ve=0;ve<fe.pathSize/2;ve++){fe.seekInPath(ve);const _e=fe.x,be=fe.y;fe.seekInPath(fe.pathSize-ve-1);const we=fe.x,Se=fe.y;fe.x=_e,fe.y=be,fe.seekInPath(ve),fe.x=we,fe.y=Se}return fe.reset(),fe}let p1=class e42{static local(){return null===e42.instance&&(e42.instance=new e42),e42.instance}execute(fe,ve,_e,be,we){return new f1(fe,ve,_e)}};p1.instance=null;let f1=class n26{constructor(fe,ve,_e){this._inputGeometries=fe,this._rotateAngle=void 0!==ve.angle?ve.angle*Math.PI/180:0}next(){let fe=this._inputGeometries.next();for(;fe;){if(0===this._rotateAngle||"esriGeometryPoint"===fe.geometryType)return fe;if(fe.totalSize>0){const ve=c$4y(fe),_e=(ve[2]+ve[0])/2,be=(ve[3]+ve[1])/2;return fe.reset(),this._rotate(fe.clone(),_e,be)}fe=this._inputGeometries.next()}return null}_rotate(fe,ve,_e){const be=Math.cos(this._rotateAngle),we=Math.sin(this._rotateAngle);for(;fe.nextPath();)for(;fe.nextPoint();){const Se=fe.x-ve,Te=fe.y-_e;fe.x=ve+Se*be-Te*we,fe.y=_e+Se*we+Te*be}return fe.reset(),fe}},m1=class e43{static local(){return null===e43.instance&&(e43.instance=new e43),e43.instance}execute(fe,ve,_e,be,we){return new y1(fe,ve,_e)}};m1.instance=null;let y1=class r32{constructor(fe,ve,_e){this._inputGeometries=fe,this._xFactor=void 0!==ve.xScaleFactor?ve.xScaleFactor:1.15,this._yFactor=void 0!==ve.yScaleFactor?ve.yScaleFactor:1.15}next(){const fe=this._inputGeometries.next();if(fe){if(1===this._xFactor&&1===this._yFactor)return fe;if("esriGeometryPoint"===fe.geometryType)return fe;if(fe.totalSize>0){const ve=c$4y(fe),_e=(ve[2]+ve[0])/2,be=(ve[3]+ve[1])/2;return fe.reset(),this._scaleCursor(fe.clone(),_e,be)}}return null}_scaleCursor(fe,ve,_e){for(;fe.nextPath();)for(;fe.nextPoint();)fe.x=ve+(fe.x-ve)*this._xFactor,fe.y=_e+(fe.y-_e)*this._yFactor;return fe.reset(),fe}},g1=class n27{static local(){return null===n27.instance&&(n27.instance=new n27),n27.instance}execute(fe,ve,_e,be,we){return new v1(fe,ve,_e)}};g1.instance=null;let v1=class r33{constructor(fe,ve,_e){this._inputGeometries=fe,this._height=(void 0!==ve.amplitude?ve.amplitude:2)*_e,this._period=(void 0!==ve.period?ve.period:3)*_e,this._style=ve.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new G0,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new Y0,this._walker.updateTolerance(_e)}next(){let fe=this._inputGeometries.next();for(;fe;){if(0===this._height||0===this._period)return fe;const ve=this._processGeom(fe);if(ve)return ve;fe=this._inputGeometries.next()}return null}_processGeom(fe){const ve=oK.createEmptyOptimizedCIM(fe.geometryType);for(;fe.nextPath();){ve.startPath();const _e=fe.pathLength();if(this._walker.init(fe,this._pattern))switch(this._style){case QK.Sinus:default:this._constructCurve(ve,_e,!1);break;case QK.Square:this._constructSquare(ve,_e);break;case QK.Triangle:this._constructTriangle(ve,_e);break;case QK.Random:this._constructCurve(ve,_e,!0)}else for(;fe.nextPoint();)ve.pushXY(fe.x,fe.y)}return ve}_constructCurve(fe,ve,_e){let be=Math.round(ve/this._period);0===be&&(be=1);const we=16*be+1,Se=ve/be,Te=this._period/16,Ee=1/we,Ce=2*Math.PI*ve/Se,Oe=2*Math.PI*Math.random(),Re=2*Math.PI*Math.random(),De=2*Math.PI*Math.random(),Be=.75-Math.random()/2,Ze=.75-Math.random()/2,Xe=new H0;this._walker.curPointAndAngle(Xe),fe.pushPoint(Xe.pt);let Je=0;for(;;){if(!this._walker.nextPointAndAngle(Te,Xe)){fe.pushPoint(this._walker.getPathEnd());break}{const ve=Je;let be;if(Je+=Ee,_e){const fe=this._height/2*(1+.3*Math.sin(Be*Ce*ve+Oe));be=fe*Math.sin(Ce*ve+Re),be+=fe*Math.sin(Ze*Ce*ve+De),be/=2}else be=.5*this._height*Math.sin(.5*Ce*ve);fe.pushXY(Xe.pt[0]-be*Xe.sa,Xe.pt[1]+be*Xe.ca)}}}_constructSquare(fe,ve){Math.round(ve/this._period);let _e=!0;for(;;){let ve=!1;if(this._walker.curPositionIsValid()){const be=new H0;this._walker.curPointAndAngle(be);const we=new H0;if(this._walker.nextPointAndAngle(this._period,we)){const Se=new H0;this._walker.nextPointAndAngle(this._period,Se)&&(_e?(fe.pushPoint(be.pt),_e=!1):fe.pushPoint(be.pt),fe.pushXY(be.pt[0]-this._height/2*be.sa,be.pt[1]+this._height/2*be.ca),fe.pushXY(we.pt[0]-this._height/2*we.sa,we.pt[1]+this._height/2*we.ca),fe.pushXY(we.pt[0]+this._height/2*we.sa,we.pt[1]-this._height/2*we.ca),fe.pushXY(Se.pt[0]+this._height/2*Se.sa,Se.pt[1]-this._height/2*Se.ca),ve=!0)}}if(!ve){fe.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(fe,ve){Math.round(ve/this._period);let _e=!0;for(;;){let ve=!1;if(this._walker.curPositionIsValid()){const be=new H0;this._walker.curPointAndAngle(be);const we=new H0;if(this._walker.nextPointAndAngle(this._period/2,we)){const Se=new H0;this._walker.nextPointAndAngle(this._period,Se)&&(this._walker.nextPosition(this._period/2)&&(_e?(fe.pushPoint(be.pt),_e=!1):fe.pushPoint(be.pt),fe.pushXY(we.pt[0]-this._height/2*we.sa,we.pt[1]+this._height/2*we.ca),fe.pushXY(Se.pt[0]+this._height/2*Se.sa,Se.pt[1]-this._height/2*Se.ca)),ve=!0)}}if(!ve){fe.pushPoint(this._walker.getPathEnd());break}}}},_1=class a27{static local(){return null===a27.instance&&(a27.instance=new a27),a27.instance}execute(fe,ve,_e,be,we){return new $1(fe,ve,_e)}};_1.instance=null;let $1=class r34 extends xK{constructor(fe,ve,_e){super(fe),this._geometryWalker=new Y0,this._geometryWalker.updateTolerance(_e),this._angleToLine=ve.angleToLine??!0,this._offset=(ve.offset?ve.offset:0)*_e,this._originalEndings=ve.endings,this._offsetAtEnd=(ve.customEndingOffset?ve.customEndingOffset:0)*_e,this._position=-(ve.offsetAlongLine?ve.offsetAlongLine:0)*_e,this._pattern=new G0,this._pattern.init(ve.placementTemplate,!1),this._pattern.scale(_e),this._endings=this._originalEndings}processPath(fe){if(this._pattern.isEmpty())return null;let ve;if(this.iteratePath)ve=this._pattern.nextValue();else{this._originalEndings===m0.WithFullGap&&this.isClosed?this._endings=m0.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let _e,be=!0;switch(this._endings){case m0.NoConstraint:_e=-this._position,_e=this._adjustPosition(_e),be=!1;break;case m0.WithHalfGap:default:_e=-this._pattern.lastValue()/2;break;case m0.WithFullGap:_e=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case m0.WithMarkers:_e=0;break;case m0.Custom:_e=-this._position,_e=this._adjustPosition(_e),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(fe,this._pattern,be))return null;this._pattern.reset();let we=0;for(;_e>we;)_e-=we,we=this._pattern.nextValue();we-=_e,ve=we,this.iteratePath=!0}const _e=new H0;return this._geometryWalker.nextPointAndAngle(ve,_e)?this._endings===m0.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===m0.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(_e.pt[0]-this._offset*_e.sa,_e.pt[1]+this._offset*_e.ca),this._angleToLine&&this.internalPlacement.setRotateCS(_e.ca,_e.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(fe){let ve=fe/this._pattern.length();return ve-=Math.floor(ve),ve*this._pattern.length()}},b1=class i28{static local(){return null===i28.instance&&(i28.instance=new i28),i28.instance}execute(fe,ve,_e,be,we){return new w1(fe,ve,_e)}};b1.instance=null;let w1=class r35 extends xK{constructor(fe,ve,_e){super(fe,!1,!0),this._curveHelper=new I0,this._placePerPart=ve.placePerPart??!1,this._angleToLine=void 0===ve.angleToLine||ve.angleToLine,this._offset=void 0!==ve.offset?ve.offset*_e:0,this._type=ve.extremityPlacement,this._position=void 0!==ve.offsetAlongLine?ve.offsetAlongLine*_e:0,this._beginProcessed=!1}processMultiPath(fe){return this._placePerPart?super.processMultiPath(fe):this.processPath(fe)}processPath(fe){let ve;switch(this._type){case OK.Both:default:this._beginProcessed?(ve=this._atExtremities(fe,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(ve=this._atExtremities(fe,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case OK.JustBegin:ve=this._atExtremities(fe,this._position,!0);break;case OK.JustEnd:ve=this._atExtremities(fe,this._position,!1);case OK.None:}return ve}_atExtremities(fe,ve,_e){if(this._placePerPart||(_e?fe.seekPath(0):fe.seekPath(fe.totalSize-1)),_e||fe.seekPathEnd(),_e?fe.nextPoint():fe.prevPoint()){let be=0,[we,Se]=[0,0],[Te,Ee]=[fe.x,fe.y];for(;_e?fe.nextPoint():fe.prevPoint();){we=Te,Se=Ee,Te=fe.x,Ee=fe.y;const _e=this._curveHelper.getLength(we,Se,Te,Ee);if(be+_e>ve){const fe=(ve-be)/_e,[Ce,Oe]=this._curveHelper.getAngleCS(we,Se,Te,Ee,fe),Re=this._curveHelper.getCoord2D(we,Se,Te,Ee,fe);return this.internalPlacement.setTranslate(Re[0]-this._offset*Oe,Re[1]+this._offset*Ce),this._angleToLine&&this.internalPlacement.setRotateCS(-Ce,-Oe),this.internalPlacement}be+=_e}}return null}},x1=class a28{static local(){return null===a28.instance&&(a28.instance=new a28),a28.instance}execute(fe,ve,_e,be,we){return new S1(fe,ve,_e)}};x1.instance=null;let S1=class r36 extends xK{constructor(fe,ve,_e){super(fe),this._walker=new Y0,this._walker.updateTolerance(_e),this._angleToLine=void 0===ve.angleToLine||ve.angleToLine,this._offset=void 0!==ve.offset?ve.offset*_e:0,this._beginGap=void 0!==ve.beginPosition?ve.beginPosition*_e:0,this._endGap=void 0!==ve.endPosition?ve.endPosition*_e:0,this._flipFirst=void 0===ve.flipFirst||ve.flipFirst,this._pattern=new G0,this._pattern.init(ve.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(fe){if(this._pattern.isEmpty())return null;let ve;if(this.iteratePath){const fe=this._pattern.nextValue()*this._subPathLen,_e=this._beginGap+fe;ve=_e-this._prevPos,this._prevPos=_e}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=fe.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(fe,this._pattern,!1))return null;this._pattern.reset();const _e=this._pattern.nextValue()*this._subPathLen,be=this._beginGap+_e;ve=be-this._prevPos,this._prevPos=be,this.iteratePath=!0}const _e=new H0;if(!this._walker.nextPointAndAngle(ve,_e,q0.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(_e.pt[0]-this._offset*_e.sa,_e.pt[1]+this._offset*_e.ca);const be=this._isFirst&&this._flipFirst;let we,Se;return this._angleToLine?(we=_e.ca,Se=_e.sa):(we=1,Se=0),be&&(we=-we,Se=-Se),this.internalPlacement.setRotateCS(we,Se),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}};const T1=512,E1=24,P1=1e-6;let C1=class r37{static local(){return null===r37.instance&&(r37.instance=new r37),r37.instance}execute(fe,ve,_e,be,we){return new O1(fe,ve,_e,be,we)}};C1.instance=null;let O1=class a29{constructor(fe,ve,_e,be,we){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(ve.stepX??16)*_e,this._stepY=Math.abs(ve.stepY??16)*_e,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=ve.gridType??y0.Fixed,this._gridType===y0.Random){const fe=ve.seed??13,_e=1;this._randomLCG=new Gt(fe*_e),this._randomness=(ve.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=ve.gridAngle??0,this._shiftOddRows=ve.shiftOddRows??!1,this._offsetX=(ve.offsetX??0)*_e,this._offsetY=(ve.offsetY??0)*_e,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=be){const[fe,ve,_e,we]=be.split("/"),Se=parseFloat(fe),Te=parseFloat(ve),Ee=parseFloat(_e),Ce=parseFloat(we);this._graphicOriginX=-(Ce*2**Se+Ee)*T1,this._graphicOriginY=Te*T1,this._testInsidePolygon=!0}this._internalPlacement=new eK,this._calculateMinMax(fe),this._geometryCursor=fe}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!a29._randValues){a29._randValues=[];for(let fe=0;fe<E1;fe++)for(let ve=0;ve<E1;ve++)a29._randValues.push(this._randomLCG.getFloat()),a29._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,Ee=Ce=Ze=De=Number.MAX_VALUE,Oe=Re=Xe=Be=-Number.MAX_VALUE;const Je=1!==this._cosAngle;for(fe.reset();fe.nextPath();)for(;fe.nextPoint();)Te=fe.x,Se=fe.y,ve=Te-this._graphicOriginX-this._offsetX,_e=Se-this._graphicOriginY-this._offsetY,Je?(be=this._cosAngle*ve-this._sinAngle*_e,we=this._sinAngle*ve+this._cosAngle*_e):(be=ve,we=_e),Ee=Math.min(Ee,be),Oe=Math.max(Oe,be),Ce=Math.min(Ce,we),Re=Math.max(Re,we),De=Math.min(De,Se),Be=Math.max(Be,Se),Ze=Math.min(Ze,Te),Xe=Math.max(Xe,Te);De=De!==Number.MAX_VALUE?De:-512-this._stepY,Be=Be!==-Number.MAX_VALUE?Be:this._stepY,Ze=Ze!==Number.MAX_VALUE?Ze:-this._stepX,Xe=Xe!==-Number.MAX_VALUE?Xe:T1+this._stepX;const Qe=Be-De,dt=Xe-Ze;if(this._verticalSubdivision=Qe>=dt,this._polygonMin=this._verticalSubdivision?De:Ze,this._testInsidePolygon){let fe=0-this._graphicOriginX-this._offsetX-this._stepX,ve=T1-this._graphicOriginX-this._offsetX+this._stepX,_e=-512-this._graphicOriginY-this._offsetY-this._stepY,be=0-this._graphicOriginY-this._offsetY+this._stepY;if(Je){const we=[[fe,_e],[fe,be],[ve,_e],[ve,be]];fe=_e=Number.MAX_VALUE,ve=be=-Number.MAX_VALUE;for(const Se of we){const we=this._cosAngle*Se[0]-this._sinAngle*Se[1],Te=this._sinAngle*Se[0]+this._cosAngle*Se[1];fe=Math.min(fe,we),ve=Math.max(ve,we),_e=Math.min(_e,Te),be=Math.max(be,Te)}}Ee=Ee!==Number.MAX_VALUE?Math.max(Ee,fe):fe,Ce=Ce!==Number.MAX_VALUE?Math.max(Ce,_e):_e,Oe=Oe!==-Number.MAX_VALUE?Math.min(Oe,ve):ve,Re=Re!==-Number.MAX_VALUE?Math.min(Re,be):be}this._xMin=Math.round(Ee/this._stepX),this._xMax=Math.round(Oe/this._stepX),this._yMin=Math.round(Ce/this._stepY),this._yMax=Math.round(Re/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(fe,Ze,Xe,De,Be)}_buildAccelerationMap(fe,ve,_e,be,we){fe.reset();const Se=new Map,Te=this._verticalSubdivision,Ee=Te?we-be:_e-ve;let Ce=Math.ceil(Ee/10);if(Ce<=1)return;const Oe=Math.floor(Ee/Ce);let Re,De,Be,Ze,Xe,Je,Qe,dt,$t,bt,wt;for(Ce++,this._delta=Oe,Te?($t=-512-2*this._stepY,bt=2*this._stepY,wt=be):($t=-2*this._stepX,bt=T1+2*this._stepX,wt=ve);fe.nextPath();)if(!(fe.pathSize<2)&&fe.nextPoint())for(Re=fe.x,De=fe.y;fe.nextPoint();Re=Be,De=Ze){if(Be=fe.x,Ze=fe.y,Te){if(De===Ze||De<$t&&Ze<$t||De>bt&&Ze>bt)continue;Xe=Math.min(De,Ze),Je=Math.max(De,Ze)}else{if(Re===Be||Re<$t&&Be<$t||Re>bt&&Be>bt)continue;Xe=Math.min(Re,Be),Je=Math.max(Re,Be)}for(;Xe<Je;)Qe=Math.floor((Xe-wt)/Oe),l$1T(Qe,Re,De,Be,Ze,Se),Xe+=Oe;dt=Math.floor((Je-wt)/Oe),dt>Qe&&l$1T(dt,Re,De,Be,Ze,Se)}this._accelerationMap=Se}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let fe=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(fe+=.5*this._stepX);const ve=this._currentY*this._stepY+this._offsetY;let _e,be;if(this._currentX++,this._gridType===y0.Random){const we=(this._currentX%E1+E1)%E1,Se=(this._currentY%E1+E1)%E1;_e=this._graphicOriginX+fe+this._stepX*this._randomness*(.5-a29._randValues[Se*E1+we])*2/3,be=this._graphicOriginY+ve+this._stepY*this._randomness*(.5-a29._randValues[Se*E1+we+1])*2/3}else _e=this._graphicOriginX+this._cosAngle*fe+this._sinAngle*ve,be=this._graphicOriginY-this._sinAngle*fe+this._cosAngle*ve;if(!this._testInsidePolygon||this._isInsidePolygon(_e,be,this._geometryCursor))return this._internalPlacement.setTranslate(_e,be),this._internalPlacement}}_isInsidePolygon(fe,ve,_e){if(null==this._accelerationMap)return function o$1h(fe,ve,_e){let be,we,Se,Te,Ee=0;for(fe+=P1,ve+=P1,_e.reset();_e.nextPath();)if(_e.nextPoint())for(be=_e.x,we=_e.y;_e.nextPoint();be=Se,we=Te)Se=_e.x,Te=_e.y,we>ve!=Te>ve&&((Se-be)*(ve-we)-(Te-we)*(fe-be)>0?Ee++:Ee--);return 0!==Ee}(fe,ve,_e);fe+=P1,ve+=P1;const be=this._verticalSubdivision,we=be?ve:fe,Se=Math.floor((we-this._polygonMin)/this._delta),Te=this._accelerationMap.get(Se);if(!Te)return!1;let Ee,Ce,Oe,Re=0;for(const De of Te){if(Ee=De[0],Ce=De[1],be){if(Ee[1]>ve==Ce[1]>ve)continue;Oe=(Ce[0]-Ee[0])*(ve-Ee[1])-(Ce[1]-Ee[1])*(fe-Ee[0])}else{if(Ee[0]>fe==Ce[0]>fe)continue;Oe=(Ce[1]-Ee[1])*(fe-Ee[0])-(Ce[0]-Ee[0])*(ve-Ee[1])}Oe>0?Re++:Re--}return 0!==Re}};function l$1T(fe,ve,_e,be,we,Se){let Te=Se.get(fe);Te||(Te=[],Se.set(fe,Te)),Te.push([[ve,_e],[be,we]])}let A1=class s52{static local(){return null===s52.instance&&(s52.instance=new s52),s52.instance}execute(fe,ve,_e,be,we){return new M1(fe,ve,_e)}};A1.instance=null;let M1=class r38 extends xK{constructor(fe,ve,_e){super(fe),this._curveHelper=new I0,this._angleToLine=void 0===ve.angleToLine||ve.angleToLine,this._offset=void 0!==ve.offset?ve.offset*_e:0,this._relativeTo=ve.relativeTo,this._position=void 0!==ve.startPointOffset?ve.startPointOffset*_e:0,this._epsilon=.001*_e}processPath(fe){const ve=this._position;if(this._relativeTo===g0.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),fe.nextPoint()){let[ve,_e]=[fe.x,fe.y],[be,we]=[0,0];for(;fe.nextPoint();){be=fe.x,we=fe.y;const Se=this._curveHelper.getLength(ve,_e,be,we);if(Se<this._epsilon){ve=be,_e=we;continue}const Te=.5+this._position/Se,[Ee,Ce]=this._curveHelper.getAngleCS(ve,_e,be,we,Te),Oe=this._curveHelper.getCoord2D(ve,_e,be,we,Te);return this.internalPlacement.setTranslate(Oe[0]-this._offset*Ce,Oe[1]+this._offset*Ee),this._angleToLine&&this.internalPlacement.setRotateCS(Ee,Ce),this.internalPlacement}}return this.iteratePath=!1,null}const _e=this._relativeTo===g0.LineEnd;return this.onLine(fe,ve,_e)}onLine(fe,ve,_e){let be,we=!1;switch(this._relativeTo){case g0.LineMiddle:default:fe.seekPathStart(),be=fe.pathLength()/2+ve;break;case g0.LineBeginning:be=ve;break;case g0.LineEnd:be=ve,we=!0}_e?fe.seekPathEnd():fe.seekPathStart();let Se=0;if(_e?fe.prevPoint():fe.nextPoint()){let[ve,Te]=[fe.x,fe.y],[Ee,Ce]=[0,0];for(;_e?fe.prevPoint():fe.nextPoint();){Ee=fe.x,Ce=fe.y;const _e=this._curveHelper.getLength(ve,Te,Ee,Ce);if(Se+_e>be){const fe=(be-Se)/_e,[Oe,Re]=this._curveHelper.getAngleCS(ve,Te,Ee,Ce,fe),De=this._curveHelper.getCoord2D(ve,Te,Ee,Ce,fe),Be=we?-this._offset:this._offset;return this.internalPlacement.setTranslate(De[0]-Be*Re,De[1]+Be*Oe),this._angleToLine&&(we?this.internalPlacement.setRotateCS(-Oe,-Re):this.internalPlacement.setRotateCS(Oe,Re)),this.internalPlacement}ve=Ee,Te=Ce,Se+=_e}}return null}};let R1=class i29{static local(){return null===i29.instance&&(i29.instance=new i29),i29.instance}execute(fe,ve,_e,be,we){return new I1(fe,ve,_e)}};R1.instance=null;let I1=class n28 extends xK{constructor(fe,ve,_e){super(fe),this._curveHelper=new I0,this._angleToLine=void 0===ve.angleToLine||ve.angleToLine,this._offset=void 0!==ve.offset?ve.offset*_e:0,this._endPoints=void 0===ve.placeOnEndPoints||ve.placeOnEndPoints,this._controlPoints=void 0===ve.placeOnControlPoints||ve.placeOnControlPoints,this._regularVertices=void 0===ve.placeOnRegularVertices||ve.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(fe){if(this.iteratePath||(this._preparePath(fe),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const ve=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(ve[2]);let _e=ve[0],be=ve[1];if(0!==this._offset){const fe=Math.cos(ve[2]),we=Math.sin(ve[2]);_e-=this._offset*we,be+=this._offset*fe}return this.internalPlacement.setTranslate(_e,be),this._tagIterator++,this.internalPlacement}_preparePath(fe){this._tags.length=0,this._tagIterator=0,fe.seekPathStart();const ve=fe.isClosed();let _e=0,be=!1,we=0,Se=0;if(fe.seekPathStart(),fe.nextPoint()){let Te=fe.x,Ee=fe.y,Ce=fe.getControlPoint(),Oe=!0,Re=fe.nextPoint();for(;Re;){const De=fe.x,Be=fe.y,Ze=fe.getControlPoint();(this._angleToLine||0!==this._offset)&&(we=this._curveHelper.getAngle(Te,Ee,De,Be,0)),Oe?(Oe=!1,ve?(_e=we,be=Ce):(this._endPoints||this._controlPoints&&Ce)&&this._tags.push([Te,Ee,we])):Ce?this._controlPoints&&this._tags.push([Te,Ee,o$1g(Se,we)]):this._regularVertices&&this._tags.push([Te,Ee,o$1g(Se,we)]),(this._angleToLine||0!==this._offset)&&(Se=this._curveHelper.getAngle(Te,Ee,De,Be,1)),Re=fe.nextPoint(),Re||(ve?Ze||be?this._controlPoints&&this._tags.push([De,Be,o$1g(Se,_e)]):this._regularVertices&&this._tags.push([De,Be,o$1g(Se,_e)]):(this._endPoints||this._controlPoints&&Ze)&&this._tags.push([De,Be,Se])),Te=De,Ee=Be,Ce=Ze}}this._tagIterator=0}};function o$1g(fe,ve){const _e=Math.PI;for(;Math.abs(ve-fe)>_e+2e-15;)ve-fe>_e?ve-=2*_e:ve+=2*_e;return(fe+ve)/2}function l$1S(fe){if(0===fe.totalSize)return null;const ve=c$4y(fe);if(!ve)return null;const _e=4*(Math.abs(ve[0])+Math.abs(ve[2])+Math.abs(ve[1])+Math.abs(ve[3])+1)*222045e-19;let be=0,we=0;fe.reset();for(let Ot=0;fe.nextPath();Ot++){const ve=fe.getCurrentRingArea();ve>we&&(we=ve,be=Ot)}if(fe.seekPath(be),0===fe.pathSize)return null;fe.seekPathStart();const Se=f$30(fe);if(Math.abs(we)<=2*_e*_e)return[(Se[0]+Se[2])/2,(Se[1]+Se[3])/2];fe.seekPathStart();const Te=function i$4o(fe,ve){let _e=0,be=0,we=0;fe.nextPoint();const Se=fe.pathSize?fe.x:0,Te=fe.pathSize?fe.y:0;for(let Ee=0;Ee<fe.pathSize;Ee++){fe.seekInPath(Ee);const Ce=[fe.x,fe.y];fe.seekInPath((Ee+1)%fe.pathSize);const Oe=[fe.x,fe.y],[Re,De]=Ce,Be=Re-Se,Ze=De-Te,[Xe,Je]=Oe,Qe=Xe-Se,dt=Je-Te,$t=Be*dt-Qe*Ze;we+=$t,_e+=(Be+Qe)*$t,be+=(Ze+dt)*$t,Re<ve[0]&&(ve[0]=Re),Re>ve[1]&&(ve[1]=Re),De<ve[2]&&(ve[2]=De),De>ve[3]&&(ve[3]=De)}return we>0&&(we*=-1),we?(we*=.5,[_e/(6*we)+Se,be/(6*we)+Te,we]):null}(fe,u$3J());if(null===Te)return null;if(fe.totalPoints<4)return Te;const Ee=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],Ce=[NaN,NaN,NaN,NaN],Oe=[NaN,NaN,NaN,NaN];let Re=!1,De=f$1b(Te,fe,!0);0===De.distance&&(Re=!0,Ee[0][0]=Te[0],Ee[0][1]=Te[1],De=f$1b(Te,fe,!1)),Ce[0]=De.distance,Oe[0]=0;const Be=[NaN,NaN];let Ze=!1,Xe=.25,Je=-1,Qe=NaN;do{if(Qe=NaN,Ee[1]=h$10(fe,w$R(Se[0],Se[2],Xe),_e,ve),isNaN(Ee[1][0])||isNaN(Ee[1][1])||(De=f$1b(Ee[1],fe,!1),Qe=De.distance),!isNaN(Qe)&&Qe>_e&&u$1z(Ee[1],fe))Ze=!0,Ce[1]=Qe,Oe[1]=p$22(Ee[1],Te);else if(!isNaN(Qe)&&Qe>Je&&(Je=Qe,Be[0]=Ee[1][0],Be[1]=Ee[1][1]),Xe-=.01,Xe<.1){if(!(Je>=0))break;Ze=!0,Ce[1]=Je,Ee[1][0]=Be[0],Ee[1][1]=Be[1],Oe[1]=p$22(Ee[1],Te)}}while(!Ze);Ze=!1,Xe=.5,Je=-1;let dt=.01,$t=1;do{if(Qe=NaN,Ee[2]=h$10(fe,w$R(Se[0],Se[2],Xe),_e,ve),isNaN(Ee[2][0])||isNaN(Ee[2][1])||(De=f$1b(Ee[2],fe,!1),Qe=De.distance),!isNaN(Qe)&&Qe>_e&&u$1z(Ee[2],fe))Ze=!0,Ce[2]=Qe,Oe[2]=p$22(Ee[2],Te);else if(!isNaN(Qe)&&Qe>Je)Je=Qe,Be[0]=Ee[2][0],Be[1]=Ee[2][1];else if(Qe>Je&&(Je=Qe,Be[0]=Ee[2][0],Be[1]=Ee[2][1]),Xe=.5+dt*$t,dt+=.01,$t*=-1,Xe<.3||Xe>.7){if(!(Je>=0))break;Ze=!0,Ce[2]=Je,Ee[2][0]=Be[0],Ee[2][1]=Be[1],Oe[2]=p$22(Ee[2],Te)}}while(!Ze);Ze=!1,Xe=.75,Je=-1;do{if(Qe=NaN,Ee[3]=h$10(fe,w$R(Se[0],Se[2],Xe),_e,ve),isNaN(Ee[3][0])||isNaN(Ee[3][1])||(De=f$1b(Ee[3],fe,!1),Qe=De.distance),!isNaN(Qe)&&Qe>_e&&u$1z(Ee[3],fe))Ze=!0,Ce[3]=Qe,Oe[3]=p$22(Ee[3],Te);else if(Qe>Je&&(Je=Qe,Be[0]=Ee[3][0],Be[1]=Ee[3][1]),Xe+=.01,Xe>.9){if(!(Je>=0))break;Ze=!0,Ce[3]=Je,Ee[3][0]=Be[0],Ee[3][1]=Be[1],Oe[3]=p$22(Ee[3],Te)}}while(!Ze);const bt=[0,1,2,3],wt=Re?0:1;let xt;for(let Ot=wt;Ot<4;Ot++)for(let fe=wt;fe<3;fe++){const ve=Oe[fe],_e=Oe[fe+1];C$x(ve,_e)>0&&(xt=bt[fe],bt[fe]=bt[fe+1],bt[fe+1]=xt,Oe[fe]=_e,Oe[fe+1]=ve)}let St=wt,Et=0,Pt=0;for(let Ot=wt;Ot<4;Ot++){switch(Ot){case 0:Pt=2*Ce[bt[Ot]];break;case 1:Pt=1.66666666*Ce[bt[Ot]];break;case 2:Pt=1.33333333*Ce[bt[Ot]];break;case 3:Pt=Ce[bt[Ot]]}Pt>Et&&(Et=Pt,St=bt[Ot])}return Ee[St]}function u$1z(fe,ve){let _e,be,we,Se,Te=0;for(ve.reset();ve.nextPath()&&ve.nextPoint();)for(_e=ve.x,be=ve.y;ve.nextPoint();_e=we,be=Se)we=ve.x,Se=ve.y,be>fe[1]!=Se>fe[1]&&((we-_e)*(fe[1]-be)-(Se-be)*(fe[0]-_e)>0?Te++:Te--);return 0!==Te}function f$1b(fe,ve,_e){if(_e&&u$1z(fe,ve))return{coord:fe,distance:0};let be=1/0,we=0,Se=0,Te=[0,0],Ee=[0,0];const Ce=[0,0];for(ve.reset();ve.nextPath()&&ve.nextPoint();)if(!(ve.pathSize<2))for(Te[0]=ve.x,Te[1]=ve.y;ve.nextPoint();Te=Ee){Ee=[ve.x,ve.y],f$33(Ce,fe,Te,Ee);const _e=p$22(fe,Ce);_e<be&&(be=_e,we=Ce[0],Se=Ce[1])}return{coord:[we,Se],distance:Math.sqrt(be)}}function h$10(fe,ve,_e,be){const we=[ve,0];let Se=1/0,Te=1/0,Ee=!1,Ce=!1;const Oe=[[ve,be[1]-1],[ve,be[3]+1]],Re=[0,0],De=[0,0],Be=[0,0],Ze=[[0,0],[0,0]],Xe=u$3J();for(fe.reset();fe.nextPath()&&fe.nextPoint();)if(!(fe.pathSize<2))for(Ze[0][0]=fe.x,Ze[0][1]=fe.y;fe.nextPoint();Ze[0][0]=Ze[1][0],Ze[0][1]=Ze[1][1]){if(Ze[1][0]=fe.x,Ze[1][1]=fe.y,null===x$A(Xe,Ze))continue;if(De[0]=Oe[0][0],De[1]=Oe[0][1],Be[0]=Oe[1][0],Be[1]=Oe[1][1],0===M$y(Xe,De,Be))continue;if(!G$V(Oe[0],Oe[1],Ze[0],Ze[1],Re))continue;const ve=Re[1];Se>Te?ve<Se&&(Se=ve,Ee=!0):ve<Te&&(Te=ve,Ce=!0)}return Ee&&Ce?we[1]=(Se+Te)/2:we[0]=we[1]=NaN,we}function x$A(fe,ve){if(ve.length<2)return null;fe||(fe=u$3J());const[_e,be]=ve[0],[we,Se]=ve[1];return fe[0]=Math.min(_e,we),fe[1]=Math.min(be,Se),fe[2]=Math.max(_e,we),fe[3]=Math.max(be,Se),fe}const L1=1,D1=4,N1=3,F1=12;function M$y(fe,ve,_e){let be=b$Q(ve,fe),we=b$Q(_e,fe);const Se=fe[0],Te=fe[1],Ee=fe[2],Ce=fe[3];if(be&we)return 0;if(!(be|we))return 4;const Oe=(be?1:0)|(we?2:0);do{const Oe=_e[0]-ve[0],Re=_e[1]-ve[1];if(Oe>Re)be&N1?(be&L1?(ve[1]+=Re*(Se-ve[0])/Oe,ve[0]=Se):(ve[1]+=Re*(Ee-ve[0])/Oe,ve[0]=Ee),be=b$Q(ve,fe)):we&N1?(we&L1?(_e[1]+=Re*(Se-_e[0])/Oe,_e[0]=Se):(_e[1]+=Re*(Ee-_e[0])/Oe,_e[0]=Ee),we=b$Q(_e,fe)):be?(be&D1?(ve[0]+=Oe*(Te-ve[1])/Re,ve[1]=Te):(ve[0]+=Oe*(Ce-ve[1])/Re,ve[1]=Ce),be=b$Q(ve,fe)):(we&D1?(_e[0]+=Oe*(Te-_e[1])/Re,_e[1]=Te):(_e[0]+=Oe*(Ce-_e[1])/Re,_e[1]=Ce),we=b$Q(_e,fe));else if(be&F1?(be&D1?(ve[0]+=Oe*(Te-ve[1])/Re,ve[1]=Te):(ve[0]+=Oe*(Ce-ve[1])/Re,ve[1]=Ce),be=b$Q(ve,fe)):we&F1?(we&D1?(_e[0]+=Oe*(Te-_e[1])/Re,_e[1]=Te):(_e[0]+=Oe*(Ce-_e[1])/Re,_e[1]=Ce),we=b$Q(_e,fe)):be?(be&L1?(ve[1]+=Re*(Se-ve[0])/Oe,ve[0]=Se):(ve[1]+=Re*(Ee-ve[0])/Oe,ve[0]=Ee),be=b$Q(ve,fe)):(we&L1?(_e[1]+=Re*(Se-_e[0])/Oe,_e[0]=Se):(_e[1]+=Re*(Ee-_e[0])/Oe,_e[0]=Ee),we=b$Q(_e,fe)),be&we)return 0}while(be|we);return Oe}function b$Q(fe,ve){return(fe[0]<ve[0]?1:0)|(fe[0]>ve[2]?1:0)<<1|(fe[1]<ve[1]?1:0)<<2|(fe[1]>ve[3]?1:0)<<3}function w$R(fe,ve,_e){return fe+(ve-fe)*_e}function p$22(fe,ve){return(fe[0]-ve[0])*(fe[0]-ve[0])+(fe[1]-ve[1])*(fe[1]-ve[1])}function C$x(fe,ve){if(fe<ve)return-1;if(fe>ve)return 1;if(fe===ve)return 0;const _e=isNaN(fe),be=isNaN(ve);return _e<be?-1:_e>be?1:0}let z1=class r39{static local(){return null===r39.instance&&(r39.instance=new r39),r39.instance}execute(fe,ve,_e,be,we){return new k1(fe,ve,_e)}};z1.instance=null;let k1=class i30{constructor(fe,ve,_e){this._geometryCursor=fe,this._offsetX=void 0!==ve.offsetX?ve.offsetX*_e:0,this._offsetY=void 0!==ve.offsetY?ve.offsetY*_e:0,this._method=void 0!==ve.method?ve.method:v0.OnPolygon,this._internalPlacement=new eK}next(){const fe=this._geometryCursor;return this._geometryCursor=null,fe?this._polygonCenter(fe):null}_polygonCenter(fe){let ve=!1;switch(this._method){case v0.CenterOfMass:{const _e=function f$32(fe){let ve=0;for(fe.reset();fe.nextPath();)ve+=fe.getCurrentRingArea();if(ve<1e-6){const ve=I$1z(fe);return ve?[ve[0],ve[1]]:null}const _e=[0,0];if(fe.reset(),!fe.nextPath()||!fe.nextPoint())return null;const be=[fe.x,fe.y];for(fe.reset();fe.nextPath();)x$1O(_e,be,fe);return _e[0]*=1/ve,_e[1]*=1/ve,_e[0]+=be[0],_e[1]+=be[1],_e}(fe);_e&&(this._internalPlacement.setTranslate(_e[0]+this._offsetX,_e[1]+this._offsetY),ve=!0)}break;case v0.BoundingBoxCenter:{const _e=c$4y(fe);_e&&(this._internalPlacement.setTranslate((_e[2]+_e[0])/2+this._offsetX,(_e[3]+_e[1])/2+this._offsetY),ve=!0)}break;case v0.OnPolygon:default:{const _e=l$1S(fe);null!==_e&&(this._internalPlacement.setTranslate(_e[0]+this._offsetX,_e[1]+this._offsetY),ve=!0)}}return ve?this._internalPlacement:null}};function A$E(fe){if(!fe)return null;switch(fe.type){case"CIMGeometricEffectAddControlPoints":return bK.local();case"CIMGeometricEffectArrow":return N0.local();case"CIMGeometricEffectBuffer":return z0.local();case"CIMGeometricEffectControlMeasureLine":return U0.local();case"CIMGeometricEffectCut":return B0.local();case"CIMGeometricEffectDashes":return t1.local();case"CIMGeometricEffectDonut":return i1.local();case"CIMGeometricEffectJog":return s1.local();case"CIMGeometricEffectMove":return a1.local();case"CIMGeometricEffectOffset":return c1.local();case"CIMGeometricEffectReverse":return h1.local();case"CIMGeometricEffectRotate":return p1.local();case"CIMGeometricEffectScale":return m1.local();case"CIMGeometricEffectWave":return g1.local()}return null}function g$Y(fe){if(!fe)return null;switch(fe.type){case"CIMMarkerPlacementAlongLineSameSize":return _1.local();case"CIMMarkerPlacementAtExtremities":return b1.local();case"CIMMarkerPlacementAtRatioPositions":return x1.local();case"CIMMarkerPlacementInsidePolygon":return C1.local();case"CIMMarkerPlacementOnLine":return A1.local();case"CIMMarkerPlacementOnVertices":return R1.local();case"CIMMarkerPlacementPolygonCenter":return z1.local()}return null}function t$1E(fe){const ve=fe.getFrame(0);if(ve instanceof HTMLImageElement||ve instanceof HTMLCanvasElement)return ve;const _e=document.createElement("canvas");_e.width=fe.width,_e.height=fe.height;const be=_e.getContext("2d");return ve instanceof ImageData?be.putImageData(ve,0,0):be.drawImage(ve,0,0),_e}let U1=class t52{constructor(fe=0,ve=0,_e=0,be=0){this.x=fe,this.y=ve,this.width=_e,this.height=be}static fromExtent(fe){return new t52(fe.xmin,-fe.ymax,fe.xmax-fe.xmin,fe.ymax-fe.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(fe){this.x=Math.min(this.x,fe.x),this.y=Math.min(this.y,fe.y),this.width=Math.max(this.width,fe.width),this.height=Math.max(this.height,fe.height)}};function s$1H(fe){return`rgba(${fe.slice(0,3).toString()},${fe[3]})`}let V1=class n29{constructor(fe){fe&&(this._textRasterizationCanvas=fe)}rasterizeText(fe,ve){var _e,be;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const we=this._textRasterizationCanvas,Se=we.getContext("2d",{willReadFrequently:!0});r$1k(Se,ve),this._parameters=ve,this._textLines=fe.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:Te,weight:Ee}=ve.font;this._lineThroughWidthOffset=Te&&"line-through"===Te?.1*this._lineHeight:0;const Ce=null!=ve.backgroundColor||null!=ve.borderLine,Oe=Ce?8:0,Re=this._computeTextWidth(Se,ve)+2*Oe,De=this._lineHeight*this._textLines.length+2*Oe;if(we.width=Re+2*this._lineThroughWidthOffset,we.height=De,0===we.width||0===we.height)return we.width=we.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:we};this._renderedLineHeight=Math.round(this._lineHeight*ve.pixelRatio),this._renderedHaloSize=u$3E(ve.halo.size)*ve.pixelRatio,this._renderedWidth=Re*ve.pixelRatio,this._renderedHeight=De*ve.pixelRatio,this._lineThroughWidthOffset*=ve.pixelRatio;const Be=ve.color??[0,0,0,0],Ze=ve.halo&&ve.halo.color?ve.halo.color:[0,0,0,0];this._fillStyle=s$1H(Be),this._haloStyle=function i$1N(fe){return`rgb(${fe.slice(0,3).toString()})`}(Ze);const Xe=this._renderedLineHeight,Je=this._renderedHaloSize;Se.save(),Se.clearRect(0,0,we.width,we.height),r$1k(Se,ve);const Qe=Oe*ve.pixelRatio,dt=function o$1f(fe,ve){return"center"===fe?.5*ve:"right"===fe?ve:0}(Se.textAlign,this._renderedWidth-2*Qe)+Je+Qe,$t=Je+Qe,bt=Je>0;let wt=this._lineThroughWidthOffset,xt=0;if(Ce){Se.save();const fe=ve.backgroundColor??[0,0,0,0],Te=(null==(_e=ve.borderLine)?void 0:_e.color)??[0,0,0,0],Ee=2*u$3E((null==(be=ve.borderLine)?void 0:be.size)??0);Se.fillStyle=s$1H(fe),Se.strokeStyle=s$1H(Te),Se.lineWidth=Ee,Se.fillRect(0,0,we.width,we.height),Se.strokeRect(0,0,we.width,we.height),Se.restore()}bt&&this._renderHalo(Se,dt,$t,wt,xt,ve),xt+=$t,wt+=dt;for(const Rt of this._textLines)bt?(Se.globalCompositeOperation="destination-out",Se.fillStyle="rgb(0, 0, 0)",Se.fillText(Rt,wt,xt),Se.globalCompositeOperation="source-over",Se.fillStyle=this._fillStyle,Se.fillText(Rt,wt,xt)):(Se.fillStyle=this._fillStyle,Se.fillText(Rt,wt,xt)),Te&&"none"!==Te&&this._renderDecoration(Se,wt,xt,Te,Ee),xt+=Xe;Se.restore();const St=this._renderedWidth+2*this._lineThroughWidthOffset,Et=this._renderedHeight,Pt=Se.getImageData(0,0,St,Et),Ot=new Uint8Array(Pt.data);if(ve.premultiplyColors){let fe;for(let ve=0;ve<Ot.length;ve+=4)fe=Ot[ve+3]/255,Ot[ve]=Ot[ve]*fe,Ot[ve+1]=Ot[ve+1]*fe,Ot[ve+2]=Ot[ve+2]*fe}let At,Mt;switch(ve.horizontalAlignment){case"left":At=-.5;break;case"right":At=.5;break;default:At=0}switch(ve.verticalAlignment){case"bottom":Mt=-.5;break;case"top":Mt=.5;break;case"baseline":Mt=-1/6;break;default:Mt=0}return{size:[St,Et],image:new Uint32Array(Ot.buffer),sdf:!1,simplePattern:!1,anchorX:At,anchorY:Mt,canvas:we}}_renderHalo(fe,ve,_e,be,we,Se){const Te=this._renderedWidth,Ee=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=Te,this._haloRasterizationCanvas.height=Ee;const Ce=this._haloRasterizationCanvas,Oe=Ce.getContext("2d");Oe.clearRect(0,0,Te,Ee),r$1k(Oe,Se);const{decoration:Re,weight:De}=Se.font;Oe.fillStyle=this._haloStyle,Oe.strokeStyle=this._haloStyle,Oe.lineJoin="round",this._renderHaloNative(Oe,ve,_e,Re,De),fe.globalAlpha=this._parameters.halo.color[3],fe.drawImage(Ce,0,0,Te,Ee,be,we,Te,Ee),fe.globalAlpha=1}_renderHaloNative(fe,ve,_e,be,we){const Se=this._renderedLineHeight,Te=this._renderedHaloSize;for(const Ee of this._textLines){const Ce=2*Te,Oe=5,Re=.1;for(let Se=0;Se<Oe;Se++){const Te=(1-(Oe-1)*Re+Se*Re)*Ce;fe.lineWidth=Te,fe.strokeText(Ee,ve,_e),be&&"none"!==be&&this._renderDecoration(fe,ve,_e,be,we,Te)}_e+=Se}}computeTextSize(fe,ve){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const _e=this._textRasterizationCanvas,be=_e.getContext("2d");r$1k(be,ve),this._parameters=ve,this._textLines=fe.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const we=this._computeTextWidth(be,ve),Se=this._lineHeight*this._textLines.length;return _e.width=we,_e.height=Se,[we*ve.pixelRatio,Se*ve.pixelRatio]}_computeTextWidth(fe,ve){let _e=0;for(const we of this._textLines)_e=Math.max(_e,fe.measureText(we).width);const be=ve.font;return("italic"===be.style||"oblique"===be.style||"string"==typeof be.weight&&("bold"===be.weight||"bolder"===be.weight)||"number"==typeof be.weight&&be.weight>600)&&(_e+=.3*fe.measureText("w").width),_e+=2*u$3E(this._parameters.halo.size),Math.round(_e)}_computeLineHeight(){let fe=1.275*this._parameters.size;const ve=this._parameters.font.decoration;return ve&&"underline"===ve&&(fe*=1.3),Math.round(fe+2*u$3E(this._parameters.halo.size))}_renderDecoration(fe,ve,_e,be,we,Se){const Te=.9*this._lineHeight,Ee="bold"===we?.06:"bolder"===we?.09:.04;switch(fe.textAlign){case"center":ve-=this._renderedWidth/2;break;case"right":ve-=this._renderedWidth}const Ce=fe.textBaseline;if("underline"===be)switch(Ce){case"top":_e+=Te;break;case"middle":_e+=Te/2}else if("line-through"===be)switch(Ce){case"top":_e+=Te/1.5;break;case"middle":_e+=Te/3}const Oe=Se?1.5*Se:Math.ceil(Te*Ee);fe.save(),fe.beginPath(),fe.strokeStyle=fe.fillStyle,fe.lineWidth=Oe,fe.moveTo(ve-this._lineThroughWidthOffset,_e),fe.lineTo(ve+this._renderedWidth+2*this._lineThroughWidthOffset,_e),fe.stroke(),fe.restore()}};function r$1k(fe,ve){const _e=Math.max(ve.size,.5),be=ve.font,we=`${be.style} ${be.weight} ${u$3E(_e*ve.pixelRatio).toFixed(1)}px ${be.family}, sans-serif`;let Se;switch(fe.font=we,fe.textBaseline="top",ve.horizontalAlignment){case"left":default:Se="left";break;case"right":Se="right";break;case"center":Se="center"}fe.textAlign=Se}const B1=512,j1=29,G1=24;var H1;!function(fe){fe[fe.FilterFlags=0]="FilterFlags",fe[fe.Animation=1]="Animation",fe[fe.GPGPU=2]="GPGPU",fe[fe.VV=3]="VV",fe[fe.DD0=4]="DD0",fe[fe.DD1=5]="DD1",fe[fe.DD2=6]="DD2"}(H1||(H1={}));const q1=1.05,W1=5,Y1=6,Z1=1.15,X1=2,J1=10,Q1=256,K1=32,Y4=512;function a$1N(fe){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=1,fe[4]=0,fe[5]=0,fe}function u$1y(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5];let Ce=_e*Se-be*we;return Ce?(Ce=1/Ce,fe[0]=Se*Ce,fe[1]=-be*Ce,fe[2]=-we*Ce,fe[3]=_e*Ce,fe[4]=(we*Ee-Se*Te)*Ce,fe[5]=(be*Te-_e*Ee)*Ce,fe):null}function e$1x(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=_e[0],Re=_e[1],De=_e[2],Be=_e[3],Ze=_e[4],Xe=_e[5];return fe[0]=be*Oe+Se*Re,fe[1]=we*Oe+Te*Re,fe[2]=be*De+Se*Be,fe[3]=we*De+Te*Be,fe[4]=be*Ze+Se*Xe+Ee,fe[5]=we*Ze+Te*Xe+Ce,fe}function s$1G(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=Math.sin(_e),Re=Math.cos(_e);return fe[0]=be*Re+Se*Oe,fe[1]=we*Re+Te*Oe,fe[2]=be*-Oe+Se*Re,fe[3]=we*-Oe+Te*Re,fe[4]=Ee,fe[5]=Ce,fe}function i$1M(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=_e[0],Re=_e[1];return fe[0]=be,fe[1]=we,fe[2]=Se,fe[3]=Te,fe[4]=be*Oe+Se*Re+Ee,fe[5]=we*Oe+Te*Re+Ce,fe}function M$x(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=be,fe[1]=_e,fe[2]=-_e,fe[3]=be,fe[4]=0,fe[5]=0,fe}function d$1g(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe[3]=ve[3]-_e[3],fe[4]=ve[4]-_e[4],fe[5]=ve[5]-_e[5],fe}const K4=e$1x,D5=d$1g;function n$1T(){const fe=new Float32Array(6);return fe[0]=1,fe[3]=1,fe}function o$1d(fe,ve,_e,be){const we=ve[be],Se=ve[be+1];fe[be]=_e[0]*we+_e[2]*Se+_e[4],fe[be+1]=_e[1]*we+_e[3]*Se+_e[5]}function a$1M(fe,ve,_e,be=0,we=0,Se=2){const Te=we||ve.length/Se;for(let Ee=be;Ee<Te;Ee++)o$1d(fe,ve,_e,Ee*Se)}Object.freeze(Object.defineProperty({__proto__:null,add:function m$1s(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe[3]=ve[3]+_e[3],fe[4]=ve[4]+_e[4],fe[5]=ve[5]+_e[5],fe},copy:function n$1U(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe[4]=ve[4],fe[5]=ve[5],fe},determinant:function o$1e(fe){return fe[0]*fe[3]-fe[1]*fe[2]},equals:function S$M(fe,ve){const _e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=fe[4],Ee=fe[5],Ce=ve[0],Oe=ve[1],Re=ve[2],De=ve[3],Be=ve[4],Ze=ve[5],Xe=e$3_();return Math.abs(_e-Ce)<=Xe*Math.max(1,Math.abs(_e),Math.abs(Ce))&&Math.abs(be-Oe)<=Xe*Math.max(1,Math.abs(be),Math.abs(Oe))&&Math.abs(we-Re)<=Xe*Math.max(1,Math.abs(we),Math.abs(Re))&&Math.abs(Se-De)<=Xe*Math.max(1,Math.abs(Se),Math.abs(De))&&Math.abs(Te-Be)<=Xe*Math.max(1,Math.abs(Te),Math.abs(Be))&&Math.abs(Ee-Ze)<=Xe*Math.max(1,Math.abs(Ee),Math.abs(Ze))},exactEquals:function y$X(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]&&fe[4]===ve[4]&&fe[5]===ve[5]},frob:function l$1R(fe){return Math.sqrt(fe[0]**2+fe[1]**2+fe[2]**2+fe[3]**2+fe[4]**2+fe[5]**2+1)},fromRotation:M$x,fromScaling:function h$$(fe,ve){return fe[0]=ve[0],fe[1]=0,fe[2]=0,fe[3]=ve[1],fe[4]=0,fe[5]=0,fe},fromTranslation:function f$1a(fe,ve){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=1,fe[4]=ve[0],fe[5]=ve[1],fe},identity:a$1N,invert:u$1y,mul:K4,multiply:e$1x,multiplyScalar:function p$21(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe[3]=ve[3]*_e,fe[4]=ve[4]*_e,fe[5]=ve[5]*_e,fe},multiplyScalarAndAdd:function x$z(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe[3]=ve[3]+_e[3]*be,fe[4]=ve[4]+_e[4]*be,fe[5]=ve[5]+_e[5]*be,fe},rotate:s$1G,scale:function c$1S(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=ve[4],Ce=ve[5],Oe=_e[0],Re=_e[1];return fe[0]=be*Oe,fe[1]=we*Oe,fe[2]=Se*Re,fe[3]=Te*Re,fe[4]=Ee,fe[5]=Ce,fe},set:function r$1j(fe,ve,_e,be,we,Se,Te){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe[4]=Se,fe[5]=Te,fe},str:function b$P(fe){return"mat2d("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+", "+fe[4]+", "+fe[5]+")"},sub:D5,subtract:d$1g,translate:i$1M},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,clone:function t$1C(fe){const ve=new Float32Array(6);return ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[2],ve[3]=fe[3],ve[4]=fe[4],ve[5]=fe[5],ve},create:n$1T,createView:function e$1w(fe,ve){return new Float32Array(fe,ve,6)},fromValues:function r$1i(fe,ve,_e,be,we,Se){const Te=new Float32Array(6);return Te[0]=fe,Te[1]=ve,Te[2]=_e,Te[3]=be,Te[4]=we,Te[5]=Se,Te},transform:o$1d,transformMany:a$1M},Symbol.toStringTag,{value:"Module"}));var Y5,X5;function a$1L(fe){if(!fe)return Y5.Center;switch(fe){case"Left":case"left":return Y5.Left;case"Right":case"right":return Y5.Right;case"Justify":return ar.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Y5.Center;case"Center":case"center":return Y5.Center}}function c$1R(fe){if(!fe)return X5.Center;switch(fe){case"Top":case"top":return X5.Top;case"Center":case"middle":return X5.Center;case"Baseline":case"baseline":return X5.Baseline;case"Bottom":case"bottom":return X5.Bottom}}function s$1F(fe){switch(fe){case Y5.Right:case"right":return-1;case Y5.Center:case"center":return 0;case Y5.Left:case"left":return 1;default:return 0}}function i$1L(fe){switch(fe){case X5.Top:case"top":return 1;case X5.Center:case"middle":return 0;case X5.Bottom:case X5.Baseline:case"baseline":case"bottom":return-1;default:return 0}}!function(fe){fe[fe.Left=-1]="Left",fe[fe.Center=0]="Center",fe[fe.Right=1]="Right"}(Y5||(Y5={})),function(fe){fe[fe.Top=1]="Top",fe[fe.Center=0]="Center",fe[fe.Bottom=-1]="Bottom",fe[fe.Baseline=2]="Baseline"}(X5||(X5={}));const J5=Math.PI/180;let Q5=class K2{constructor(fe){this._t=fe}static createIdentity(){return new K2([1,0,0,0,1,0])}clone(){const fe=this._t;return new K2(fe.slice())}transform(fe){const ve=this._t;return[ve[0]*fe[0]+ve[1]*fe[1]+ve[2],ve[3]*fe[0]+ve[4]*fe[1]+ve[5]]}static createScale(fe,ve){return new K2([fe,0,0,0,ve,0])}scale(fe,ve){const _e=this._t;return _e[0]*=fe,_e[1]*=fe,_e[2]*=fe,_e[3]*=ve,_e[4]*=ve,_e[5]*=ve,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(fe,ve){return new K2([0,0,fe,0,0,ve])}translate(fe,ve){const _e=this._t;return _e[2]+=fe,_e[5]+=ve,this}static createRotate(fe){const ve=Math.cos(fe),_e=Math.sin(fe);return new K2([ve,-_e,0,_e,ve,0])}rotate(fe){return K2.multiply(this,K2.createRotate(fe),this)}angle(){const fe=this._t[0],ve=this._t[3],_e=Math.sqrt(fe*fe+ve*ve);return[fe/_e,ve/_e]}static multiply(fe,ve,_e){const be=fe._t,we=ve._t,Se=be[0]*we[0]+be[3]*we[1],Te=be[1]*we[0]+be[4]*we[1],Ee=be[2]*we[0]+be[5]*we[1]+we[2],Ce=be[0]*we[3]+be[3]*we[4],Oe=be[1]*we[3]+be[4]*we[4],Re=be[2]*we[3]+be[5]*we[4]+we[5],De=_e._t;return De[0]=Se,De[1]=Te,De[2]=Ee,De[3]=Ce,De[4]=Oe,De[5]=Re,_e}invert(){const fe=this._t;let ve=fe[0]*fe[4]-fe[1]*fe[3];if(0===ve)return new K2([0,0,0,0,0,0]);ve=1/ve;const _e=(fe[1]*fe[5]-fe[2]*fe[4])*ve,be=(fe[2]*fe[3]-fe[0]*fe[5])*ve,we=fe[4]*ve,Se=-fe[1]*ve,Te=-fe[3]*ve,Ee=fe[0]*ve;return new K2([we,Se,_e,Te,Ee,be])}},K5=class Q3{constructor(fe,ve){this._resourceManager=fe,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new pr(eK,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(ve||Q5.createIdentity()),this._sizeTransfos.push(ve?ve.scaleRatio():1)}setTransform(fe,ve){this._transfos=[fe||Q5.createIdentity()],this._sizeTransfos=[ve||(fe?fe.scaleRatio():1)]}setGeomUnitsPerPoint(fe){this._geomUnitsPerPoint=fe}transformPt(fe){return this._transfos[this._transfos.length-1].transform(fe)}transformSize(fe){return fe*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(fe){return this._transfos[this._transfos.length-1].invert().transform(fe)}reverseTransformSize(fe){return fe/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(fe){return fe/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(fe,ve){const _e=ve?fe.scaleRatio():1;Q5.multiply(fe,this.back(),fe),this._transfos.push(fe),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*_e)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(fe,ve,_e){if(fe)switch(fe.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(fe,ve);break;case"CIMTextSymbol":this.drawTextSymbol(fe,ve,_e)}}drawMultiLayerSymbol(fe,ve){if(!fe||!ve)return;const _e=fe.symbolLayers;if(!_e)return;const be=fe.effects;if(be&&be.length>0){const fe=this.executeEffects(be,ve);if(fe){let ve=fe.next();for(;ve;)this.drawSymbolLayers(_e,ve.asJSON()),ve=fe.next()}}else this.drawSymbolLayers(_e,ve)}executeEffects(fe,ve){const _e=this._resourceManager.geometryEngine;let be=new _K(oK.fromJSONCIM(ve));for(const we of fe){const fe=A$E(we);fe&&(be=fe.execute(be,we,this.geomUnitsPerPoint(),null,_e))}return be}drawSymbolLayers(fe,ve){let _e=fe.length;for(;_e--;){const be=fe[_e];if(!be||!1===be.enable)continue;const we=be.effects;if(we&&we.length>0){const fe=this.executeEffects(we,ve);if(fe){let ve=null;for(;(ve=fe.next())&&(this.drawSymbolLayer(be,ve.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(be,ve);if(this._earlyReturn)return}}drawSymbolLayer(fe,ve){switch(fe.type){case"CIMSolidFill":this.drawSolidFill(ve,fe.color);break;case"CIMHatchFill":this.drawHatchFill(ve,fe);break;case"CIMPictureFill":this.drawPictureFill(ve,fe);break;case"CIMGradientFill":this.drawGradientFill(ve,fe);break;case"CIMSolidStroke":this.drawSolidStroke(ve,fe.color,fe.width,fe.capStyle,fe.joinStyle,fe.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(ve,fe);break;case"CIMGradientStroke":this.drawGradientStroke(ve,fe);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(fe,ve)}}drawHatchFill(fe,ve){const _e=function et$3(fe,ve,_e){let be=I$F(fe.separation,K0.separation)*_e,we=I$F(fe.rotation);if(0===be)return null;be<0&&(be=-be);let Se=0;const Te=.5*be;for(;Se>Te;)Se-=be;for(;Se<-Te;)Se+=be;const Ee=u$3J();a$4i(Ee,ve),Ee[0]-=Te,Ee[1]-=Te,Ee[2]+=Te,Ee[3]+=Te;const Ce=[[Ee[0],Ee[1]],[Ee[0],Ee[3]],[Ee[2],Ee[3]],[Ee[2],Ee[1]]];for(;we>180;)we-=180;for(;we<0;)we+=180;const Oe=Math.cos(we*J5),Re=Math.sin(we*J5),De=-be*Re,Be=be*Oe;let Ze,Xe,Je,Qe;Se=I$F(fe.offsetX)*_e*Re-I$F(fe.offsetY)*_e*Oe,Ze=Je=Number.MAX_VALUE,Xe=Qe=-Number.MAX_VALUE;for(const Et of Ce){const fe=Et[0],ve=Et[1],_e=Oe*fe+Re*ve,be=-Re*fe+Oe*ve;Ze=Math.min(Ze,_e),Je=Math.min(Je,be),Xe=Math.max(Xe,_e),Qe=Math.max(Qe,be)}Je=Math.floor(Je/be)*be;let dt=Oe*Ze-Re*Je-De*Se/be,$t=Re*Ze+Oe*Je-Be*Se/be,bt=Oe*Xe-Re*Je-De*Se/be,wt=Re*Xe+Oe*Je-Be*Se/be;const xt=1+Math.round((Qe-Je)/be),St=[];for(let Et=0;Et<xt;Et++)dt+=De,$t+=Be,bt+=De,wt+=Be,St.push([[dt,$t],[bt,wt]]);return{paths:St}}(ve,fe,this.geomUnitsPerPoint());_e&&(this.pushClipPath(fe),this.drawMultiLayerSymbol(ve.lineSymbol,_e),this.popClipPath())}drawPictureFill(fe,ve){}drawGradientFill(fe,ve){}drawPictureStroke(fe,ve){}drawGradientStroke(fe,ve){}drawMarkerLayer(fe,ve){const _e=fe.markerPlacement;if(_e){const be=g$Y(_e);if(be){const we="CIMMarkerPlacementInsidePolygon"===_e.type||"CIMMarkerPlacementPolygonCenter"===_e.type&&_e.clipAtBoundary;we&&this.pushClipPath(ve);const Se=be.execute(oK.fromJSONCIM(ve),_e,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(Se){let ve=null;for(;(ve=Se.next())&&(this.drawMarker(fe,ve),!this._earlyReturn););}we&&this.popClipPath()}}else{const _e=this._placementPool.acquire();if(u$3F(ve))_e.tx=ve.x,_e.ty=ve.y,this.drawMarker(fe,_e);else if(f$2Z(ve)){const be=l$4d(ve);be&&([_e.tx,_e.ty]=be,this.drawMarker(fe,_e))}else for(const be of ve.points)if(_e.tx=be[0],_e.ty=be[1],this.drawMarker(fe,_e),this._earlyReturn)break;this._placementPool.release(_e)}}drawMarker(fe,ve){switch(fe.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(fe,ve);break;case"CIMVectorMarker":this.drawVectorMarker(fe,ve)}}drawPictureMarker(fe,ve){if(!fe)return;const _e=this._resourceManager.getResource(fe.url),be=I$F(fe.size,X0.size);if(null==_e||be<=0)return;const we=_e.width,Se=_e.height;if(!we||!Se)return;const Te=we/Se,Ee=I$F(fe.scaleX,1),Ce=Q5.createIdentity(),Oe=fe.anchorPoint;if(Oe){let ve=Oe.x,_e=Oe.y;"Absolute"!==fe.anchorPointUnits&&(ve*=be*Te*Ee,_e*=be),Ce.translate(-ve,-_e)}let Re=I$F(fe.rotation);fe.rotateClockwise&&(Re=-Re),this._mapRotation&&(Re+=this._mapRotation),Re&&Ce.rotate(Re*J5);let De=I$F(fe.offsetX),Be=I$F(fe.offsetY);if(De||Be){if(this._mapRotation){const fe=J5*this._mapRotation,ve=Math.cos(fe),_e=Math.sin(fe),be=De*_e+Be*ve;De=De*ve-Be*_e,Be=be}Ce.translate(De,Be)}const Ze=this.geomUnitsPerPoint();1!==Ze&&Ce.scale(Ze,Ze);const Xe=ve.getAngle();Xe&&Ce.rotate(Xe),Ce.translate(ve.tx,ve.ty),this.push(Ce,!1),this.drawImage(fe,be),this.pop()}drawVectorMarker(fe,ve){if(!fe)return;const _e=fe.markerGraphics;if(!_e)return;const be=I$F(fe.size,Z0.size),we=fe.frame,Se=we?we.ymax-we.ymin:0,Te=be&&Se?be/Se:1,Ee=Q5.createIdentity();we&&Ee.translate(.5*-(we.xmax+we.xmin),.5*-(we.ymax+we.ymin));const Ce=fe.anchorPoint;if(Ce){let ve=Ce.x,_e=Ce.y;"Absolute"!==fe.anchorPointUnits?we&&(ve*=we.xmax-we.xmin,_e*=we.ymax-we.ymin):(ve/=Te,_e/=Te),Ee.translate(-ve,-_e)}1!==Te&&Ee.scale(Te,Te);let Oe=I$F(fe.rotation);fe.rotateClockwise&&(Oe=-Oe),this._mapRotation&&(Oe+=this._mapRotation),Oe&&Ee.rotate(Oe*J5);let Re=I$F(fe.offsetX),De=I$F(fe.offsetY);if(Re||De){if(this._mapRotation){const fe=J5*this._mapRotation,ve=Math.cos(fe),_e=Math.sin(fe),be=Re*_e+De*ve;Re=Re*ve-De*_e,De=be}Ee.translate(Re,De)}const Be=this.geomUnitsPerPoint();1!==Be&&Ee.scale(Be,Be);const Ze=ve.getAngle();Ze&&Ee.rotate(Ze),Ee.translate(ve.tx,ve.ty),this.push(Ee,fe.scaleSymbolsProportionally);for(const Xe of _e){(null==Xe?void 0:Xe.symbol)&&Xe.geometry||ar.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",Xe);let fe=Xe.textString;if("number"==typeof fe&&(fe=fe.toString()),this.drawSymbol(Xe.symbol,Xe.geometry,fe),this._earlyReturn)break}this.pop()}drawTextSymbol(fe,ve,_e){if(!fe)return;if(!u$3F(ve))return;if(I$F(fe.height,J0.height)<=0)return;const be=Q5.createIdentity();let we=I$F(fe.angle);we=-we,we&&be.rotate(we*J5);const Se=I$F(fe.offsetX),Te=I$F(fe.offsetY);(Se||Te)&&be.translate(Se,Te);const Ee=this.geomUnitsPerPoint();1!==Ee&&be.scale(Ee,Ee),be.translate(ve.x,ve.y),this.push(be,!1),this.drawText(fe,_e),this.pop()}},$6=class Z2 extends K5{constructor(fe,ve){super(fe,ve),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new U1(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return a$4j(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(fe){if(fe&&!(this._clipCount>0))if(f$2Z(fe))this._processPath(fe.rings,0);else if(s$3_(fe))this._processPath(fe.paths,0);else if(m$3w(fe)){const ve=ot$4(fe);ve&&this._processPath(ve.rings,0)}}drawSolidStroke(fe,ve,_e){if(!fe||this._clipCount>0||null==_e||_e<=0)return;const be=Math.max(.5*this.transformSize(I$F(_e,Q0.width)),.25);if(f$2Z(fe))this._processPath(fe.rings,be);else if(s$3_(fe))this._processPath(fe.paths,be);else if(m$3w(fe)){const ve=ot$4(fe);ve&&this._processPath(ve.rings,be)}}drawMarkerLayer(fe,ve){f$2Z(ve)&&fe.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===fe.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===fe.markerPlacement.type&&fe.markerPlacement.clipAtBoundary)?this._processPath(ve.rings,0):super.drawMarkerLayer(fe,ve)}drawHatchFill(fe,ve){this.drawSolidFill(fe)}drawPictureFill(fe,ve){this.drawSolidFill(fe)}drawGradientFill(fe,ve){this.drawSolidFill(fe)}drawPictureStroke(fe,ve){this.drawSolidStroke(fe,null,ve.width)}drawGradientStroke(fe,ve){this.drawSolidStroke(fe,null,ve.width)}pushClipPath(fe){this.drawSolidFill(fe),this._clipCount++}popClipPath(){this._clipCount--}drawImage(fe,ve){const{url:_e}=fe,be=I$F(fe.scaleX,1);let we=be*ve,Se=ve;const Te=this._resourceManager.getResource(_e);if(null!=Te){const fe=Te.height/Te.width;we=be*(ve?fe>1?ve:ve/fe:Te.width),Se=ve?fe>1?ve*fe:ve:Te.height}this._merge(this.transformPt([-we/2,-Se/2]),0),this._merge(this.transformPt([-we/2,Se/2]),0),this._merge(this.transformPt([we/2,-Se/2]),0),this._merge(this.transformPt([we/2,Se/2]),0)}drawText(fe,ve){if(!ve||0===ve.length)return;this._textRasterizer||(this._textRasterizer=new V1);const _e=at$5(fe);let[be,we]=this._textRasterizer.computeTextSize(ve,_e);be=e$3N(be),we=e$3N(we);let Se=0;switch(fe.horizontalAlignment){case"Left":Se=be/2;break;case"Right":Se=-be/2}let Te=0;switch(fe.verticalAlignment){case"Bottom":Te=we/2;break;case"Top":Te=-we/2;break;case"Baseline":Te=we/6}this._merge(this.transformPt([-be/2+Se,-we/2+Te]),0),this._merge(this.transformPt([-be/2+Se,we/2+Te]),0),this._merge(this.transformPt([be/2+Se,-we/2+Te]),0),this._merge(this.transformPt([be/2+Se,we/2+Te]),0)}_processPath(fe,ve){if(fe)for(const _e of fe){const fe=_e?_e.length:0;if(fe>1){this._merge(this.transformPt(_e[0]),ve);for(let be=1;be<fe;be++)this._merge(this.transformPt(_e[be]),ve)}}}_merge(fe,ve){fe[0]-ve<this._xmin&&(this._xmin=fe[0]-ve),fe[0]+ve>this._xmax&&(this._xmax=fe[0]+ve),fe[1]-ve<this._ymin&&(this._ymin=fe[1]-ve),fe[1]+ve>this._ymax&&(this._ymax=fe[1]+ve)}},D6=class tt2 extends K5{constructor(fe,ve,_e,be){super(ve,_e),this._applyAdditionalRenderProps=be,this._colorSubstitutionHelper=new $K,this._ctx=fe}drawSolidFill(fe,ve){if(!fe)return;if(f$2Z(fe))this._buildPath(fe.rings,!0);else if(s$3_(fe))this._buildPath(fe.paths,!0);else if(m$3w(fe))this._buildPath(ot$4(fe).rings,!0);else if(!l$49(fe))return;const _e=this._ctx;_e.fillStyle="string"==typeof ve?ve:"rgba("+Math.round(ve[0])+","+Math.round(ve[1])+","+Math.round(ve[2])+","+(ve[3]??255)/255+")",_e.fill("evenodd")}drawSolidStroke(fe,ve,_e,be,we,Se){if(!fe||!ve||0===_e)return;if(f$2Z(fe))this._buildPath(fe.rings,!0);else if(s$3_(fe))this._buildPath(fe.paths,!1);else{if(!m$3w(fe))return;this._buildPath(ot$4(fe).rings,!0)}const Te=this._ctx;Te.strokeStyle="string"==typeof ve?ve:"rgba("+Math.round(ve[0])+","+Math.round(ve[1])+","+Math.round(ve[2])+","+(ve[3]??255)/255+")",Te.lineWidth=Math.max(this.transformSize(_e),.5),this._setCapStyle(be),this._setJoinStyle(we),Te.miterLimit=Se,Te.stroke()}pushClipPath(fe){if(this._ctx.save(),f$2Z(fe))this._buildPath(fe.rings,!0);else if(s$3_(fe))this._buildPath(fe.paths,!0);else{if(!m$3w(fe))return;this._buildPath(ot$4(fe).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(fe,ve){const{colorSubstitutions:_e,url:be,tintColor:we}=fe,Se=I$F(fe.scaleX,1),Te=this._resourceManager.getResource(be);if(null==Te)return;let Ee=ve*(Te.width/Te.height),Ce=ve;ve||(Ee=Te.width,Ce=Te.height);const Oe=G$i(be)||"src"in Te&&G$i(Te.src);let Re="getFrame"in Te?t$1E(Te):Te;_e&&(Re=this._colorSubstitutionHelper.applyColorSubstituition(Re,_e)),this._applyAdditionalRenderProps&&!Oe&&we&&(Re=this._colorSubstitutionHelper.tintImageData(Re,we));const De=this.transformPt([0,0]),[Be,Ze]=this.getTransformAngle(),Xe=this.transformSize(1),Je=this._ctx;Je.save(),Je.setTransform({m11:Se*Xe*Be,m12:Se*Xe*Ze,m21:-Xe*Ze,m22:Xe*Be,m41:De[0],m42:De[1]}),Je.drawImage(Re,-Ee/2,-Ce/2,Ee,Ce),Je.restore()}drawText(fe,ve){if(!ve||0===ve.length)return;this._textRasterizer||(this._textRasterizer=new V1);const _e=at$5(fe);_e.size*=this.transformSize(e$3N(1));const be=this._textRasterizer.rasterizeText(ve,_e);if(!be)return;const{size:we,anchorX:Se,anchorY:Te,canvas:Ee}=be,Ce=we[0]*(Se+.5),Oe=we[1]*(Te-.5),Re=this._ctx,De=this.transformPt([0,0]),[Be,Ze]=this.getTransformAngle();Re.save(),Re.setTransform({m11:1*Be,m12:1*Ze,m21:-1*Ze,m22:1*Be,m41:De[0]-1*Ce,m42:De[1]+1*Oe}),Re.drawImage(Ee,0,0),Re.restore()}drawPictureFill(fe,ve){if(!fe)return;let{colorSubstitutions:_e,height:be,offsetX:we,offsetY:Se,rotation:Te,scaleX:Ee,tintColor:Ce,url:Oe}=ve;const Re=this._resourceManager.getResource(Oe);if(null==Re)return;if(f$2Z(fe))this._buildPath(fe.rings,!0);else if(s$3_(fe))this._buildPath(fe.paths,!0);else if(m$3w(fe))this._buildPath(ot$4(fe).rings,!0);else if(!l$49(fe))return;const De=this._ctx,Be=G$i(Oe)||"src"in Re&&G$i(Re.src);let Ze,Xe="getFrame"in Re?t$1E(Re):Re;if(_e&&(Xe=this._colorSubstitutionHelper.applyColorSubstituition(Xe,_e)),this._applyAdditionalRenderProps){Be||Ce&&(Xe=this._colorSubstitutionHelper.tintImageData(Xe,Ce)),Ze=De.createPattern(Xe,"repeat");const fe=this.transformSize(1);Te||(Te=0),we?we*=fe:we=0,Se?Se*=fe:Se=0,be&&(be*=fe);const ve=be?be/Re.height:1,_e=Ee&&be?Ee*be/Re.width:1;if(0!==Te||1!==ve||1!==_e||0!==we||0!==Se){const fe=new DOMMatrix;fe.rotateSelf(0,0,-Te).translateSelf(we,Se).scaleSelf(_e,ve,1),Ze.setTransform(fe)}}else Ze=De.createPattern(Xe,"repeat");De.save(),De.fillStyle=Ze,De.fill("evenodd"),De.restore()}drawPictureStroke(fe,ve){if(!fe)return;let{colorSubstitutions:_e,capStyle:be,joinStyle:we,miterLimit:Se,tintColor:Te,url:Ee,width:Ce}=ve;const Oe=this._resourceManager.getResource(Ee);if(null==Oe)return;let Re;if(f$2Z(fe))Re=fe.rings;else if(s$3_(fe))Re=fe.paths;else{if(!m$3w(fe))return void l$49(fe);Re=ot$4(fe).rings}Ce||(Ce=Oe.width);const De=G$i(Ee)||"src"in Oe&&G$i(Oe.src);let Be="getFrame"in Oe?t$1E(Oe):Oe;_e&&(Be=this._colorSubstitutionHelper.applyColorSubstituition(Be,_e)),this._applyAdditionalRenderProps&&(De||Te&&(Be=this._colorSubstitutionHelper.tintImageData(Be,Te)));const Ze=Math.max(this.transformSize(u$3E(Ce)),.5),Xe=Ze/Be.width,Je=this._ctx,Qe=Je.createPattern(Be,"repeat-y");let dt,$t;Je.save(),this._setCapStyle(be),this._setJoinStyle(we),void 0!==Se&&(Je.miterLimit=Se),Je.lineWidth=Ze;for(let bt of Re)if(bt=a$4H(bt),ht$3(bt),bt&&!(bt.length<=1)){dt=this.transformPt(bt[0]);for(let fe=1;fe<bt.length;fe++){$t=this.transformPt(bt[fe]);const ve=st$4(dt,$t),_e=new DOMMatrix;_e.translateSelf(0,dt[1]-Ze/2).scaleSelf(Xe,Xe,1).rotateSelf(0,0,90-ve),Qe.setTransform(_e),Je.strokeStyle=Qe,Je.beginPath(),Je.moveTo(dt[0],dt[1]),Je.lineTo($t[0],$t[1]),Je.stroke(),dt=$t}}Je.restore()}_buildPath(fe,ve){const _e=this._ctx;if(_e.beginPath(),fe)for(const be of fe){const fe=be?be.length:0;if(fe>1){let we=this.transformPt(be[0]);_e.moveTo(we[0],we[1]);for(let ve=1;ve<fe;ve++)we=this.transformPt(be[ve]),_e.lineTo(we[0],we[1]);ve&&_e.closePath()}}}_setCapStyle(fe){switch(fe){case o0.Butt:this._ctx.lineCap="butt";break;case o0.Round:this._ctx.lineCap="round";break;case o0.Square:this._ctx.lineCap="square"}}_setJoinStyle(fe){switch(fe){case u0.Bevel:this._ctx.lineJoin="bevel";break;case u0.Round:this._ctx.lineJoin="round";break;case u0.Miter:this._ctx.lineJoin="miter"}}};function st$4(fe,ve){const _e=ve[0]-fe[0],be=ve[1]-fe[1];return 180/Math.PI*Math.atan2(be,_e)}const ot$4=fe=>fe?{spatialReference:fe.spatialReference,rings:[[[fe.xmin,fe.ymin],[fe.xmin,fe.ymax],[fe.xmax,fe.ymax],[fe.xmax,fe.ymin],[fe.xmin,fe.ymin]]]}:null;function at$5(fe,ve=1){var _e;const be=w$S(fe),we=P$t(fe.fontStyleName),Se=fe.fontFamilyName??tK,{weight:Te,style:Ee}=we,Ce=ve*(fe.height||5),Oe=function x$B(fe){switch(fe){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}(fe.horizontalAlignment),Re=function A$F(fe){switch(fe){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}(fe.verticalAlignment),De=L$s(fe),Be=L$s(fe.haloSymbol),Ze=null!=Be?ve*(fe.haloSize??0):0,Xe="CIMBackgroundCallout"===(null==(_e=fe.callout)?void 0:_e.type)?fe.callout.backgroundSymbol:null,Je=L$s(Xe),Qe=T$w(Xe),dt=N$u(Xe);return{color:De,size:Ce,horizontalAlignment:Oe,verticalAlignment:Re,font:{family:Se,style:S$N(Ee),weight:g$Z(Te),decoration:be},halo:{size:Ze||0,color:Be,style:Ee},backgroundColor:Je,borderLine:null!=Qe&&null!=dt?{size:Qe,color:dt}:null,pixelRatio:1,premultiplyColors:!0}}const F6=1e-4;function ht$3(fe){let ve,_e,be,we,Se,Te=fe[0],Ee=1;for(;Ee<fe.length;)ve=fe[Ee][0]-Te[0],_e=fe[Ee][1]-Te[1],we=0!==ve?_e/ve:Math.PI/2,void 0!==be&&we-be<=F6?(fe.splice(Ee-1,1),Te=Se):(Se=Te,Te=fe[Ee],Ee++),be=we}const H6=[252,146,31,255],W6={type:"esriSMS",style:"esriSMSCircle",size:6,color:H6,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Y6={type:"esriSLS",style:"esriSLSSolid",width:.75,color:H6},X6={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},J6=dT.fromJSON(W6),Q6=Dw.fromJSON(Y6),K6=lT.fromJSON(X6),$8=mT.fromJSON({type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0});function J$d(fe){if(null==fe)return null;switch(fe.type){case"mesh":return null;case"point":case"multipoint":return J6;case"polyline":return Q6;case"polygon":case"extent":return K6}return null}dT.fromJSON({type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5}),Dw.fromJSON({type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5}),lT.fromJSON({type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null});const P8=Number.POSITIVE_INFINITY,D8=Math.PI,F8=2*D8,V8=128/D8,H8=256/360,W8=D8/180,Y8=1/Math.LN2;function a$1J(fe,ve){return(fe%=ve)>=0?fe:fe+ve}function f$19(fe){return a$1J(fe*V8,256)}function l$1P(fe){return a$1J(fe*H8,256)}function h$_(fe){return Math.log(fe)*Y8}function p$20(fe,ve,_e){return fe*(1-_e)+ve*_e}function d$1f(fe){return 8+Math.max(16*(fe-14),0)}function N$s(fe,ve,_e,be){let we,Se,Te,Ee;const Ce=be*be;for(const Oe of _e){const _e=Oe.length;if(!(_e<2)){we=Oe[0].x,Se=Oe[0].y;for(let be=1;be<_e;++be){if(Te=Oe[be].x,Ee=Oe[be].y,l$4e(fe,ve,we,Se,Te,Ee)<Ce)return!0;we=Te,Se=Ee}}}return!1}function w$Q(fe,ve,_e,be,we,Se,Te){const Ee=Math.max(be,Math.min(ve,Se))-ve,Ce=Math.max(we,Math.min(_e,Te))-_e;return Ee*Ee+Ce*Ce<=fe*fe}function b$O(fe,ve,_e,be){const we=new pK(fe[0],fe[1]);if(we.scale(be),"viewport"===ve){const fe=-_e*(Math.PI/180),ve=Math.cos(fe),be=Math.sin(fe);we.rotate(ve,be)}return we}const Z8=Math.PI,X8=Z8/2,J8=96/72,O$z=()=>ar.getLogger("esri.symbols.cim.CIMSymbolHelper");function $$d(fe,ve,_e){switch(ve.type){case"CIMSymbolReference":return $$d(fe,ve.symbol,_e);case"CIMPointSymbol":null==_e&&(_e={x:0,y:0}),fe.drawSymbol(ve,_e);break;case"CIMLineSymbol":null==_e&&(_e={paths:[[[0,0],[10,0]]]}),fe.drawSymbol(ve,_e);break;case"CIMPolygonSymbol":null==_e&&(_e={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),fe.drawSymbol(ve,_e);break;case"CIMTextSymbol":{const _e={x:0,y:0};fe.drawSymbol(ve,_e);break}case"CIMVectorMarker":{const _e=new eK;fe.drawMarker(ve,_e);break}}return fe.envelope()}function K$c(fe){if(!fe)return 0;switch(fe.type){case"CIMGeometricEffectArrow":return Math.abs(.5*fe.width);case"CIMGeometricEffectBuffer":return Math.abs(fe.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(fe.length);case"CIMGeometricEffectJog":return Math.abs(.5*fe.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(I$F(fe.offsetX)),Math.abs(I$F(fe.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(fe.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(fe.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(fe.fromWidth),Math.abs(fe.toWidth));case"CIMGeometricEffectWave":return Math.abs(fe.amplitude);case"CIMGeometricEffectDonut":return Math.abs(fe.width)}}function Q$e(fe){if(!fe)return 0;let ve=0;for(const _e of fe)ve+=K$c(_e);return ve}let Q8=class ee2{static getEnvelope(fe,ve,_e){if(!fe)return null;const be=new $6(_e);if(Array.isArray(fe)){let _e;for(const we of fe)_e?_e.union($$d(be,we,ve)):_e=$$d(be,we,ve);return _e}return $$d(be,fe,ve)}static getTextureAnchor(fe,ve){const _e=this.getEnvelope(fe,null,ve);if(!_e)return[0,0,0];const be=(_e.x+.5*_e.width)*J8,we=(_e.y+.5*_e.height)*J8,Se=_e.width*J8+2,Te=_e.height*J8+2;return[-be/Se,-we/Te,Te]}static rasterize(fe,ve,_e,be,we=!0){const Se=_e||this.getEnvelope(ve,null,be);if(!Se)return[null,0,0,0,0];const Te=(Se.x+.5*Se.width)*J8,Ee=(Se.y+.5*Se.height)*J8;fe.width=Se.width*J8,fe.height=Se.height*J8,_e||(fe.width+=2,fe.height+=2);const Ce=fe.getContext("2d",{willReadFrequently:!0}),Oe=Q5.createScale(J8,-J8);Oe.translate(.5*fe.width-Te,.5*fe.height+Ee);const Re=new D6(Ce,be,Oe);switch(ve.type){case"CIMPointSymbol":{const fe={type:"point",x:0,y:0};Re.drawSymbol(ve,fe);break}case"CIMVectorMarker":{const fe=new eK;Re.drawMarker(ve,fe);break}}const De=Ce.getImageData(0,0,fe.width,fe.height),Be=new Uint8Array(De.data);if(we){let fe;for(let ve=0;ve<Be.length;ve+=4)fe=Be[ve+3]/255,Be[ve]=Be[ve]*fe,Be[ve+1]=Be[ve+1]*fe,Be[ve+2]=Be[ve+2]*fe}return[Be,fe.width,fe.height,-Te/fe.width,-Ee/fe.height]}static fromTextSymbol(fe){const{text:ve}=fe;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:ee2.createCIMTextSymbolfromTextSymbol(fe),textString:ve}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(fe){const{height:ve,outline:_e,width:be,xoffset:we,xscale:Se,yoffset:Te,yscale:Ee}=fe,Ce=[],Oe={type:"CIMPolygonSymbol",symbolLayers:Ce};if(_e){const fe=pe$7(_e);fe&&Ce.push(fe)}let Re=fe.url;"esriPFS"===fe.type&&fe.imageData&&(Re=fe.imageData);const De="angle"in fe?fe.angle??0:0,Be=(be??0)*(Se||1),Ze=(ve??0)*(Ee||1);return Ce.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:P0.Picture,tintColor:null,url:Re,height:Ze,width:Be,offsetX:I$F(we),offsetY:I$F(Te),rotation:I$F(-De),colorSubstitutions:null}),Oe}static fromSimpleFillSymbol(fe){const{color:ve,style:_e,outline:be}=fe,we=[],Se={type:"CIMPolygonSymbol",symbolLayers:we};if(be){const fe=pe$7(be);fe&&we.push(fe)}if(_e&&"solid"!==_e&&"none"!==_e&&"esriSFSSolid"!==_e&&"esriSFSNull"!==_e){const fe={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:ie$6(ve),capStyle:o0.Butt,joinStyle:u0.Miter,width:.75}]};let be=0;const Se=e$3N(he$5(_e)?8:10);switch(_e){case"vertical":case"esriSFSVertical":be=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":be=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":be=45;break;case"cross":case"esriSFSCross":be=0}we.push({type:"CIMHatchFill",lineSymbol:fe,offsetX:0,offsetY:0,rotation:be,separation:Se}),"cross"===_e||"esriSFSCross"===_e?we.push({type:"CIMHatchFill",lineSymbol:a$4H(fe),offsetX:0,offsetY:0,rotation:90,separation:Se}):"diagonal-cross"!==_e&&"esriSFSDiagonalCross"!==_e||we.push({type:"CIMHatchFill",lineSymbol:a$4H(fe),offsetX:0,offsetY:0,rotation:45,separation:Se})}else!_e||"solid"!==_e&&"esriSFSSolid"!==_e||we.push({type:"CIMSolidFill",enable:!0,color:ie$6(ve)});return Se}static fromSimpleLineSymbol(fe){const{cap:ve,color:_e,join:be,marker:we,miterLimit:Se,style:Te,width:Ee}=fe;let Ce=null;"solid"!==Te&&"none"!==Te&&"esriSLSSolid"!==Te&&"esriSLSNull"!==Te&&(Ce=[{type:"CIMGeometricEffectDashes",dashTemplate:me$6(Te,ve),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const Oe=[];if(we){let fe;switch(we.placement){case"begin-end":fe=OK.Both;break;case"begin":fe=OK.JustBegin;break;case"end":fe=OK.JustEnd;break;default:fe=OK.None}const ve=ee2.fromSimpleMarker(we,Ee,_e).symbolLayers[0];ve.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:fe,offsetAlongLine:0},Oe.push(ve)}return Oe.push({type:"CIMSolidStroke",color:"none"!==Te&&"esriSLSNull"!==Te?ie$6(_e):[0,0,0,0],capStyle:re$5(ve),joinStyle:oe$8(be),miterLimit:Se,width:Ee,effects:Ce}),{type:"CIMLineSymbol",symbolLayers:Oe}}static fromPictureMarker(fe){const{angle:ve,height:_e,width:be,xoffset:we,yoffset:Se}=fe;let Te=fe.url;return"esriPMS"===fe.type&&fe.imageData&&(Te=fe.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:P0.Picture,tintColor:null,url:Te,size:_e,width:be,offsetX:I$F(we),offsetY:I$F(Se),rotation:I$F(-ve)}]}}static createCIMTextSymbolfromTextSymbol(fe){const{angle:ve,color:_e,font:be,haloColor:we,haloSize:Se,horizontalAlignment:Te,kerning:Ee,lineWidth:Ce,text:Oe,verticalAlignment:Re,xoffset:De,yoffset:Be,backgroundColor:Ze,borderLineColor:Xe,borderLineSize:Je}=fe;let Qe,dt,$t,bt,wt,xt;be&&(Qe=be.family,dt=be.style,$t=be.weight,bt=be.size,wt=be.decoration);let St=!1;return Oe&&(St=function i$1Y(fe){if(null==fe)return["",!1];if(!KQ.hasBidiChar(fe))return[fe,!1];let ve;return ve="rtl"===KQ.checkContextual(fe)?"IDNNN":"ICNNN",[KQ.bidiTransform(fe,ve,"VLYSN"),!0]}(Oe)[1]),(Ze||Je)&&(xt={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:ie$6(Ze)},{type:"CIMSolidStroke",color:ie$6(Xe),width:Je}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:ve,blockProgression:UK.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:MK.Normal,fontEncoding:RK.Unicode,fontFamilyName:Qe||"Arial",fontStyleName:ne$7(dt,$t),fontType:IK.Unspecified,haloSize:Se,height:bt,hinting:KK.Default,horizontalAlignment:ae$7(Te??"center"),kerning:Ee,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:Ce,offsetX:I$F(De),offsetY:I$F(Be),strikethrough:"line-through"===wt,underline:"underline"===wt,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ie$6(_e)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ie$6(we)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:St?E0.RTL:E0.LTR,verticalAlignment:se$7(Re??"baseline"),verticalGlyphOrientation:O0.Right,wordSpacing:100,billboardMode3D:VK.FaceNearPlane,callout:xt}}static createPictureMarkerRasterizationParam(fe){var ve,_e;const{angle:be,height:we,width:Se,xoffset:Te,yoffset:Ee}=fe,Ce=fe.url??(null==(ve=fe.source)?void 0:ve.url)??(null==(_e=fe.source)?void 0:_e.imageData);return Ce?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:P0.Picture,tintColor:null,url:Ce,size:we,width:Se,offsetX:I$F(Te),offsetY:I$F(Ee),rotation:I$F(-be)}}:null}static createPictureFillRasterizationParam(fe){const{width:ve,height:_e,xoffset:be,yoffset:we,url:Se}=fe;return Se?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:P0.Picture,tintColor:null,url:Se,width:ve,height:_e,offsetX:I$F(be),offsetY:I$F(we),rotation:0}}:null}static fromSimpleMarker(fe,ve,_e){const{style:be}=fe,we=fe.color??_e;if("path"===be||"esriSMSPath"===be){const ve=[];if("outline"in fe&&fe.outline){const _e=fe.outline;ve.push({type:"CIMSolidStroke",enable:!0,width:_e.width,color:ie$6(_e.color),path:fe.path})}ve.push({type:"CIMSolidFill",enable:!0,color:ie$6(we),path:fe.path});const[_e,be]=ye$5("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-I$F(fe.angle),size:I$F(fe.size||6),offsetX:I$F(fe.xoffset),offsetY:I$F(fe.yoffset),scaleSymbolsProportionally:!1,frame:_e,markerGraphics:[{type:"CIMMarkerGraphic",geometry:be,symbol:{type:"CIMPolygonSymbol",symbolLayers:ve}}]}]}}const Se=[];let Te,Ee,Ce=fe.size;if("outline"in fe&&fe.outline&&"none"!==fe.outline.style&&"esriSLSNull"!==fe.outline.style){const ve=fe.outline,_e="solid"!==ve.style&&"esriSLSSolid"!==ve.style;[Te,Ee]=_e?ye$5(be,fe.size):ye$5(be);const we=ve.width??Q6.width;if(_e){const ve=we/fe.size,_e=(Te.xmax-Te.xmin)*ve/2,be=(Te.ymax-Te.ymin)*ve/2;Te.xmin-=_e,Te.xmax+=_e,Te.ymin-=be,Te.ymax+=be,Ce&&(Ce+=we)}const Oe="cross"!==fe.style&&"x"!==fe.style||"dot"===(null==fe?void 0:fe.outline.style)||"short-dot"===(null==fe?void 0:fe.outline.style)?a0.HalfGap:a0.FullPattern,Re=_e?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:me$6(ve.style,null).map((fe=>ve.width&&ve.width>0?fe*ve.width:fe)),lineDashEnding:Oe,controlPointEnding:a0.FullPattern}]:void 0;Se.push({type:"CIMSolidStroke",capStyle:_e?o0.Round:o0.Butt,enable:!0,width:we,color:ie$6(ve.color),effects:Re})}else!ve||"line-marker"!==fe.type||"cross"!==fe.style&&"x"!==fe.style?[Te,Ee]=ye$5(be):([Te,Ee]=ye$5(be),Se.push({type:"CIMSolidStroke",enable:!0,width:ve,color:ie$6(we)}));Se.push({type:"CIMSolidFill",enable:!0,color:ie$6(we)});const Oe={type:"CIMPolygonSymbol",symbolLayers:Se};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:I$F(-fe.angle),size:I$F(Ce||6*ve),offsetX:I$F(fe.xoffset),offsetY:I$F(fe.yoffset),scaleSymbolsProportionally:!1,frame:Te,markerGraphics:[{type:"CIMMarkerGraphic",geometry:Ee,symbol:Oe}]}]}}static fromCIMHatchFill(fe,ve){var _e;const be=ve*(fe.separation??K0.separation),we=be/2,Se=a$4H(fe.lineSymbol);null==(_e=Se.symbolLayers)||_e.forEach((fe=>{var _e;switch(fe.type){case"CIMSolidStroke":null!=fe.width&&(fe.width*=ve),null==(_e=fe.effects)||_e.forEach((fe=>{if("CIMGeometricEffectDashes"===fe.type){const _e=fe.dashTemplate;fe.dashTemplate=null==_e?void 0:_e.map((fe=>fe*ve))}}));break;case"CIMVectorMarker":{null!=fe.size&&(fe.size*=ve);const _e=fe.markerPlacement;null!=_e&&"placementTemplate"in _e&&(_e.placementTemplate=_e.placementTemplate.map((fe=>fe*ve)));break}}}));let Te=this._getLineSymbolPeriod(Se)||4;for(;Te<4;)Te*=2;const Ee=Te/2;return{type:"CIMVectorMarker",frame:{xmin:-Ee,xmax:Ee,ymin:-we,ymax:we},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-Ee,0],[Ee,0]]]},symbol:Se}],size:be}}static fetchResources(fe,ve,_e,be=null){return fe&&ve?(te$6(fe,(fe=>{(function ue$7(fe,ve,_e){if(!fe.effects||null!=ve.geometryEngine)return;if(ve.geometryEnginePromise)return void _e.push(ve.geometryEnginePromise);(fe=>{if(!fe)return!1;for(const ve of fe)switch(ve.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(fe.effects)&&(ve.geometryEnginePromise=function k$x(){return zt((()=>import("./geometryEngineJSON-CrXS8d22.js").then((fe=>fe.g))),__vite__mapDeps([8,9,10]))}(),_e.push(ve.geometryEnginePromise),ve.geometryEnginePromise.then((fe=>ve.geometryEngine=fe)))})(fe,ve,_e),"url"in fe&&fe.url&&_e.push(ve.fetchResource(fe.url,{signal:be}))})),_e):_e}static fetchFonts(fe,ve,_e){if(fe&&ve)if("symbolLayers"in fe&&fe.symbolLayers){for(const be of fe.symbolLayers)if("CIMVectorMarker"===be.type&&be.markerGraphics)for(const fe of be.markerGraphics)(null==fe?void 0:fe.symbol)&&ee2.fetchFonts(fe.symbol,ve,_e)}else if("CIMTextSymbol"===fe.type){const{fontFamilyName:be,fontStyleName:we}=fe;if(!be||"calcitewebcoreicons"===be.toLowerCase())return;const{style:Se,weight:Te}=P$t(we),Ee=w$S(fe),Ce=new bx({family:be,style:Se,weight:Te,decoration:Ee});_e.push(ve.loadFont(Ce).catch((()=>{O$z().error(`Unsupported font ${be} in CIM symbol`)})))}}static _getLineSymbolPeriod(fe){if(fe){const ve=this._getEffectsRepeat(fe.effects);if(ve)return ve;if(fe.symbolLayers)for(const _e of fe.symbolLayers)if(_e){const fe=this._getEffectsRepeat(_e.effects);if(fe)return fe;switch(_e.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const fe=this._getPlacementRepeat(_e.markerPlacement);if(fe)return fe}}}}return 0}static _getEffectsRepeat(fe){if(fe)for(const ve of fe)if(ve)switch(ve.type){case"CIMGeometricEffectDashes":{const fe=ve.dashTemplate;if(fe&&fe.length){let ve=0;for(const _e of fe)ve+=_e;return 1&fe.length&&(ve*=2),ve}break}case"CIMGeometricEffectWave":return ve.period;default:O$z().error(`unsupported geometric effect type ${ve.type}`)}return 0}static _getPlacementRepeat(fe){if(fe)switch(fe.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const ve=fe.placementTemplate;if(ve&&ve.length){let fe=0;for(const _e of ve)fe+=+_e;return 1&ve.length&&(fe*=2),fe}break}}return 0}static fromCIMInsidePolygon(fe){const ve=fe.markerPlacement,_e={...fe};_e.markerPlacement=null,_e.anchorPoint=null;const be=Math.abs(ve.stepX),we=Math.abs(ve.stepY),Se=(ve.randomness??100)/100;let Te,Ee,Ce,Oe;if("Random"===ve.gridType){const fe=e$3N(1024),_e=Math.max(Math.floor(fe/be),1),Re=Math.max(Math.floor(fe/we),1);Te=_e*be/2,Ee=Re*we/2,Ce=2*Ee;const De=new Gt(ve.seed),Be=Se*be/1.5,Ze=Se*we/1.5;Oe=[];for(let ve=0;ve<_e;ve++)for(let fe=0;fe<Re;fe++){const _e=ve*be-Te+Be*(.5-De.getFloat()),Se=fe*we-Ee+Ze*(.5-De.getFloat());Oe.push({x:_e,y:Se}),0===ve&&Oe.push({x:_e+2*Te,y:Se}),0===fe&&Oe.push({x:_e,y:Se+2*Ee})}}else!0===ve.shiftOddRows?(Te=be/2,Ee=we,Ce=2*we,Oe=[{x:-Te,y:0},{x:Te,y:0},{x:0,y:Ee},{x:0,y:-Ee}]):(Te=be/2,Ee=we/2,Ce=we,Oe=[{x:-be,y:0},{x:0,y:-we},{x:-be,y:-we},{x:0,y:0},{x:be,y:0},{x:0,y:we},{x:be,y:we},{x:-be,y:we},{x:be,y:-we}]);return{type:"CIMVectorMarker",frame:{xmin:-Te,xmax:Te,ymin:-Ee,ymax:Ee},markerGraphics:Oe.map((fe=>({type:"CIMMarkerGraphic",geometry:fe,symbol:{type:"CIMPointSymbol",symbolLayers:[_e]}}))),size:Ce}}};function te$6(fe,ve){if(fe)switch(fe.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const _e=fe.symbolLayers;if(!_e)return;for(const fe of _e)if(ve(fe),"CIMVectorMarker"===fe.type){const _e=fe.markerGraphics;if(!_e)continue;for(const fe of _e)if(fe){const _e=fe.symbol;_e&&te$6(_e,ve)}}break}}}const re$5=fe=>{if(!fe)return o0.Butt;switch(fe){case"butt":return o0.Butt;case"square":return o0.Square;case"round":return o0.Round}},oe$8=fe=>{if(!fe)return u0.Miter;switch(fe){case"miter":return u0.Miter;case"round":return u0.Round;case"bevel":return u0.Bevel}},ae$7=fe=>{if(null==fe)return"Center";switch(fe){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},se$7=fe=>{if(null==fe)return"Center";switch(fe){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},ie$6=fe=>{if(!fe)return[0,0,0,0];const{r:ve,g:_e,b:be,a:we}=fe;return[ve,_e,be,255*we]},ne$7=(fe,ve)=>{const _e=le$7(ve),be=ce$6(fe);return _e&&be?`${_e}-${be}`:`${_e}${be}`},le$7=fe=>{if(!fe)return"";switch(fe.toLowerCase()){case"bold":case"bolder":return"bold"}return""},ce$6=fe=>{if(!fe)return"";switch(fe.toLowerCase()){case"italic":case"oblique":return"italic"}return""},me$6=(fe,ve)=>{const _e=has("safari")?.001:0,be="butt"===ve;switch(fe){case"dash":case"esriSLSDash":return be?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return be?[4,3,1,3]:[3,4,_e,4];case"dot":case"esriSLSDot":return be?[1,3]:[_e,4];case"long-dash":case"esriSLSLongDash":return be?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return be?[8,3,1,3]:[7,4,_e,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return be?[8,3,1,3,1,3]:[7,4,_e,4,_e,4];case"short-dash":case"esriSLSShortDash":return be?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return be?[4,1,1,1]:[3,2,_e,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return be?[4,1,1,1,1,1]:[3,2,_e,2,_e,2];case"short-dot":case"esriSLSShortDot":return be?[1,1]:[_e,2];case"solid":case"esriSLSSolid":case"none":return O$z().error("Unexpected: style does not require rasterization"),[0,0];default:return O$z().error(`Tried to rasterize SLS, but found an unexpected style: ${fe}!`),[0,0]}},ye$5=(fe,ve=100)=>{const _e=ve/2;let be,we;const Se=fe;if("circle"===Se||"esriSMSCircle"===Se){const fe=.25;let ve=Math.acos(1-fe/_e),Se=Math.ceil(Z8/ve/4);0===Se&&(Se=1),ve=X8/Se,Se*=4;const Te=[];Te.push([_e,0]);for(let be=1;be<Se;be++)Te.push([_e*Math.cos(be*ve),-_e*Math.sin(be*ve)]);Te.push([_e,0]),be={rings:[Te]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e}}else if("cross"===Se||"esriSMSCross"===Se){const fe=0;be={paths:[[[fe,_e],[fe,-_e]],[[_e,fe],[-_e,fe]]]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e}}else if("diamond"===Se||"esriSMSDiamond"===Se)be={rings:[[[-_e,0],[0,_e],[_e,0],[0,-_e],[-_e,0]]]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e};else if("square"===Se||"esriSMSSquare"===Se)be={rings:[[[-_e,-_e],[-_e,_e],[_e,_e],[_e,-_e],[-_e,-_e]]]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e};else if("x"===Se||"esriSMSX"===Se)be={paths:[[[_e,_e],[-_e,-_e]],[[_e,-_e],[-_e,_e]]]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e};else if("triangle"===Se||"esriSMSTriangle"===Se){const fe=.5773502691896257*ve,_e=-fe,Se=2/3*ve,Te=Se-ve;be={rings:[[[_e,Te],[0,Se],[fe,Te],[_e,Te]]]},we={xmin:_e,ymin:Te,xmax:fe,ymax:Se}}else"arrow"===Se&&(be={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},we={xmin:-_e,ymin:-_e,xmax:_e,ymax:_e});return[we,be]},he$5=fe=>"vertical"===fe||"horizontal"===fe||"cross"===fe||"esriSFSCross"===fe||"esriSFSVertical"===fe||"esriSFSHorizontal"===fe;function pe$7(fe){if(!fe)return null;let ve=null;const{cap:_e,color:be,join:we,miterLimit:Se,style:Te,width:Ee}=fe;return"solid"!==Te&&"none"!==Te&&"esriSLSSolid"!==Te&&"esriSLSNull"!==Te&&(ve=[{type:"CIMGeometricEffectDashes",dashTemplate:me$6(Te,_e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==Te&&"none"!==Te?ie$6(be):[0,0,0,0],capStyle:re$5(_e),joinStyle:oe$8(we),miterLimit:Se,width:Ee,effects:ve}}function s$1C(fe,ve,_e,be,we){if(null==fe)return null;const Se=fe.referencesGeometry()&&we?function i$1I(fe,ve,_e){const{transform:be,hasZ:we,hasM:Se}=_e;K8.has(ve)||K8.set(ve,function c$1O(fe){const ve={};switch(fe){case"esriGeometryPoint":return(fe,_e,be,we)=>C$K(_e,ve,fe,be,we);case"esriGeometryPolygon":return(fe,_e,be,we)=>D$C(_e,ve,fe,be,we);case"esriGeometryPolyline":return(fe,_e,be,we)=>H$u(_e,ve,fe,be,we);case"esriGeometryMultipoint":return(fe,_e,be,we)=>B$q(_e,ve,fe,be,we);default:return ar.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Ir("mapview-arcade",`Unable to handle geometryType: ${fe}`)),fe=>fe}}(ve));const Te=K8.get(ve)(fe.geometry,be,we,Se);return{...fe,geometry:Te}}(ve,be,we):ve,Te=fe.repurposeFeature(Se);try{return fe.evaluate({..._e,$feature:Te},fe.services)}catch(jR){return ar.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",jR),null}}const K8=new Map;const m$1r=fe=>{if(!fe)return[0,0,0,0];const{r:ve,g:_e,b:be,a:we}=fe;return[ve,_e,be,255*we]};let $9=class y8{static findApplicableOverrides(fe,ve,_e){if(fe&&ve){if(fe.primitiveName){let be=!1;for(const ve of _e)if(ve.primitiveName===fe.primitiveName){be=!0;break}if(!be)for(const we of ve)we.primitiveName===fe.primitiveName&&_e.push(we)}switch(fe.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(fe.effects)for(const be of fe.effects)y8.findApplicableOverrides(be,ve,_e);if(fe.symbolLayers)for(const be of fe.symbolLayers)y8.findApplicableOverrides(be,ve,_e);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(fe.effects)for(const be of fe.effects)y8.findApplicableOverrides(be,ve,_e);if(fe.markerPlacement&&y8.findApplicableOverrides(fe.markerPlacement,ve,_e),"CIMVectorMarker"===fe.type){if(fe.markerGraphics)for(const be of fe.markerGraphics)y8.findApplicableOverrides(be,ve,_e),y8.findApplicableOverrides(be.symbol,ve,_e)}else"CIMCharacterMarker"===fe.type?y8.findApplicableOverrides(fe.symbol,ve,_e):"CIMHatchFill"===fe.type?y8.findApplicableOverrides(fe.lineSymbol,ve,_e):"CIMPictureMarker"===fe.type&&y8.findApplicableOverrides(fe.animatedSymbolProperties,ve,_e)}}}static findEffectOverrides(fe,ve){if(!fe)return null;if("CIMGeometricEffectDashes"===fe.type&&D$u(fe),!ve||!fe.primitiveName)return{type:"cim-effect-param",effect:fe,overrides:[]};const _e=H$n(fe),be=fe.primitiveName,we=[];for(const Se of ve)Se.primitiveName===be&&we.push(H$n(Se));return{type:"cim-effect-param",effect:_e,overrides:R$A(we)}}static async resolveSymbolOverrides(fe,ve,_e,be,we,Se,Te){if(!(null==fe?void 0:fe.symbol))return null;let{symbol:Ee,primitiveOverrides:Ce}=fe;const Oe=!!Ce;if(!Oe&&!be)return Ee;Ee=a$4H(Ee),Ce=a$4H(Ce);let Re=!0;if(ve||(ve={attributes:{}},Re=!1),Oe){if(Re||(Ce=Ce.filter((fe=>{var ve;return!(null==(ve=fe.valueExpressionInfo)?void 0:ve.expression.includes("$feature"))}))),Te||(Ce=Ce.filter((fe=>{var ve;return!(null==(ve=fe.valueExpressionInfo)?void 0:ve.expression.includes("$view"))}))),Ce.length>0){const fe={spatialReference:_e,fields:F$t(ve.attributes),geometryType:we};await y8.createRenderExpressions(Ce,fe),y8.evaluateOverrides(Ce,ve,we??"esriGeometryPoint",Se,Te)}y8.applyOverrides(Ee,Ce)}return be&&y8.applyDictionaryTextOverrides(Ee,ve,be,null),Ee}static async createRenderExpressions(fe,ve){const _e=[];for(const be of fe){const fe=be.valueExpressionInfo;if(!fe||y8._expressionToRenderExpression.has(fe.expression))continue;const we=o$39(fe.expression,ve.spatialReference,ve.fields);_e.push(we),we.then((ve=>y8._expressionToRenderExpression.set(fe.expression,ve)))}_e.length>0&&await Promise.all(_e)}static evaluateOverrides(fe,ve,_e,be,we){const Se={$view:{scale:null==we?void 0:we.scale}};for(const Te of fe){Te.value&&"object"==typeof Te.value&&o$2S(Te.value)&&("Color"===Te.propertyName||"StrokeColor"===Te.propertyName)&&(Te.value=m$1r(Te.value));const fe=Te.valueExpressionInfo;if(!fe)continue;const we=y8._expressionToRenderExpression.get(fe.expression);we&&(Te.value=s$1C(we,ve,Se,_e,be))}}static applyDictionaryTextOverrides(fe,ve,_e,be,we="Normal"){if(null==fe?void 0:fe.type)switch(fe.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const Se=fe.symbolLayers;if(!Se)return;for(const Te of Se)Te&&"CIMVectorMarker"===Te.type&&y8.applyDictionaryTextOverrides(Te,ve,_e,be,"CIMTextSymbol"===fe.type?fe.textCase:we)}break;case"CIMVectorMarker":{const we=fe.markerGraphics;if(!we)return;for(const fe of we)fe&&y8.applyDictionaryTextOverrides(fe,ve,_e,be)}break;case"CIMMarkerGraphic":{const Se=fe.textString;if(Se&&Se.includes("[")){const Te=function l$1V(fe,ve){const _e=[];let be=0,we=-1;do{if(we=fe.indexOf("[",be),we>=be){if(we>be){const ve=fe.substr(be,we-be);_e.push([ve,null,a$1S(ve)])}if(be=we+1,we=fe.indexOf("]",be),we>=be){if(we>be){const Se=ve[fe.substr(be,we-be)];Se&&_e.push([null,Se,!1])}be=we+1}}}while(-1!==we);if(be<fe.length-1){const ve=fe.substr(be);_e.push([ve,null,a$1S(ve)])}return _e}(Se,_e);fe.textString=s$1L(ve,Te,be,we)}}}}static applyOverrides(fe,ve,_e,be){if(fe.primitiveName)for(const we of ve)if(we.primitiveName===fe.primitiveName){const ve=v$K(we.propertyName);if(be&&be.push({cim:fe,nocapPropertyName:ve,value:fe[ve]}),_e){let ve=!1;for(const be of _e)be.primitiveName===fe.primitiveName&&(ve=!0);ve||_e.push(we)}null!=we.value&&(fe[ve]=we.value)}switch(fe.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(fe.effects)for(const we of fe.effects)y8.applyOverrides(we,ve,_e,be);if(fe.symbolLayers)for(const we of fe.symbolLayers)y8.applyOverrides(we,ve,_e,be);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(fe.effects)for(const we of fe.effects)y8.applyOverrides(we,ve,_e,be);if("CIMVectorMarker"===fe.type&&fe.markerGraphics)for(const we of fe.markerGraphics)y8.applyOverrides(we,ve,_e,be),y8.applyOverrides(we.symbol,ve,_e,be)}}static restoreOverrides(fe){for(const ve of fe)ve.cim[ve.nocapPropertyName]=ve.value}static buildOverrideKey(fe){let ve="";for(const _e of fe)void 0!==_e.value&&(ve+=`${_e.primitiveName}${_e.propertyName}${JSON.stringify(_e.value)}`);return ve}static toValue(fe,ve){if("DashTemplate"===fe)return ve.split(" ").map((fe=>Number(fe)));if("Color"===fe){const fe=new b_(ve).toRgba();return fe[3]*=255,fe}return ve}};function l$1O(fe,ve,_e,be){if(fe)if("CIMTextSymbol"!==fe.type){if(fe.effects)for(const _e of fe.effects)y$T(_e,ve);if(fe.symbolLayers)for(const _e of fe.symbolLayers)switch(_e.type){case"CIMPictureMarker":case"CIMVectorMarker":m$1q(_e,ve,be);break;case"CIMPictureStroke":case"CIMSolidStroke":!(null==be?void 0:be.preserveOutlineWidth)&&_e.width&&(_e.width*=ve);break;case"CIMPictureFill":_e.height&&(_e.height*=ve),_e.offsetX&&(_e.offsetX*=ve),_e.offsetY&&(_e.offsetY*=ve);break;case"CIMHatchFill":l$1O(_e.lineSymbol,ve,!0,{...be,preserveOutlineWidth:!1}),_e.offsetX&&(_e.offsetX*=ve),_e.offsetY&&(_e.offsetY*=ve),_e.separation&&(_e.separation*=ve)}}else null!=fe.height&&(fe.height*=ve)}function m$1q(fe,ve,_e){if(fe&&(fe.markerPlacement&&function M$v(fe,ve){switch(b$R(fe)&&fe.offset&&(fe.offset*=ve),fe.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(fe.customEndingOffset&&(fe.customEndingOffset*=ve),fe.offsetAlongLine&&(fe.offsetAlongLine*=ve),fe.placementTemplate&&fe.placementTemplate.length){const _e=fe.placementTemplate.map((fe=>fe*ve));fe.placementTemplate=_e}break;case"CIMMarkerPlacementAlongLineVariableSize":if(fe.maxRandomOffset&&(fe.maxRandomOffset*=ve),fe.placementTemplate&&fe.placementTemplate.length){const _e=fe.placementTemplate.map((fe=>fe*ve));fe.placementTemplate=_e}break;case"CIMMarkerPlacementOnLine":fe.startPointOffset&&(fe.startPointOffset*=ve);break;case"CIMMarkerPlacementAtExtremities":fe.offsetAlongLine&&(fe.offsetAlongLine*=ve);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":fe.beginPosition&&(fe.beginPosition*=ve),fe.endPosition&&(fe.endPosition*=ve);break;case"CIMMarkerPlacementPolygonCenter":fe.offsetX&&(fe.offsetX*=ve),fe.offsetY&&(fe.offsetY*=ve);break;case"CIMMarkerPlacementInsidePolygon":fe.offsetX&&(fe.offsetX*=ve),fe.offsetY&&(fe.offsetY*=ve),fe.stepX&&(fe.stepX*=ve),fe.stepY&&(fe.stepY*=ve)}}(fe.markerPlacement,ve),fe.offsetX&&(fe.offsetX*=ve),fe.offsetY&&(fe.offsetY*=ve),fe.anchorPoint&&"Absolute"===fe.anchorPointUnits&&(fe.anchorPoint={x:fe.anchorPoint.x*ve,y:fe.anchorPoint.y*ve}),fe.size=null!=fe.size?fe.size*ve:0,"CIMVectorMarker"===fe.type&&fe.markerGraphics))for(const be of fe.markerGraphics)fe.scaleSymbolsProportionally||l$1O(be.symbol,ve,0,_e)}function y$T(fe,ve){switch(fe.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":fe.width&&(fe.width*=ve);break;case"CIMGeometricEffectBuffer":fe.size&&(fe.size*=ve);break;case"CIMGeometricEffectCut":fe.beginCut&&(fe.beginCut*=ve),fe.endCut&&(fe.endCut*=ve),fe.middleCut&&(fe.middleCut*=ve);break;case"CIMGeometricEffectDashes":if(fe.customEndingOffset&&(fe.customEndingOffset*=ve),fe.offsetAlongLine&&(fe.offsetAlongLine*=ve),fe.dashTemplate&&fe.dashTemplate.length){const _e=fe.dashTemplate.map((fe=>fe*ve));fe.dashTemplate=_e}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":fe.length&&(fe.length*=ve);break;case"CIMGeometricEffectMove":fe.offsetX&&(fe.offsetX*=ve),fe.offsetY&&(fe.offsetY*=ve);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":fe.offset&&(fe.offset*=ve);break;case"CIMGeometricEffectRegularPolygon":fe.radius&&(fe.radius*=ve);break;case"CIMGeometricEffectTaperedPolygon":fe.fromWidth&&(fe.fromWidth*=ve),fe.length&&(fe.length*=ve),fe.toWidth&&(fe.toWidth*=ve);break;case"CIMGeometricEffectWave":fe.amplitude&&(fe.amplitude*=ve),fe.period&&(fe.period*=ve)}}function C$w(fe){const ve=[];return u$1u(function y$Z(fe){var ve;return(null==(ve=fe.data)?void 0:ve.symbol)??null}(fe),ve),ve.length?new b_(function f$1d(fe){return fe?[fe[0],fe[1],fe[2],fe[3]/255]:[0,0,0,0]}(ve[0])):null}function u$1u(fe,ve){var _e;if(!fe)return;let be;be="CIMTextSymbol"===fe.type?fe.symbol:fe;const we="CIMPolygonSymbol"===fe.type;if(null==be?void 0:be.symbolLayers)for(const Se of be.symbolLayers)if(!(Se.colorLocked||we&&(m$1u(Se)||M$z(Se)&&Se.markerPlacement&&b$R(Se.markerPlacement))))switch(Se.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":Se.tintColor&&b$N(ve,Se.tintColor);break;case"CIMVectorMarker":null==(_e=Se.markerGraphics)||_e.forEach((fe=>{u$1u(fe.symbol,ve)}));break;case"CIMSolidStroke":case"CIMSolidFill":b$N(ve,Se.color);break;case"CIMHatchFill":u$1u(Se.lineSymbol,ve)}}function b$N(fe,ve){for(const _e of fe)if(_e.join(".")===ve.join("."))return;fe.push(ve)}$9._expressionToRenderExpression=new Map;var M9,R9,D9={exports:{}};R9=function(){function e76(fe,ve,_e,be){var we=Error.call(this,fe);return Object.setPrototypeOf&&Object.setPrototypeOf(we,e76.prototype),we.expected=ve,we.found=_e,we.location=be,we.name="SyntaxError",we}function r65(fe,ve,_e){return _e=_e||" ",fe.length>ve?fe:(ve-=fe.length,fe+(_e+=_e.repeat(ve)).slice(0,ve))}return function t84(fe,ve){function r66(){this.constructor=fe}r66.prototype=ve.prototype,fe.prototype=new r66}(e76,Error),e76.prototype.format=function(fe){var ve="Error: "+this.message;if(this.location){var _e,be=null;for(_e=0;_e<fe.length;_e++)if(fe[_e].source===this.location.source){be=fe[_e].text.split(/\r\n|\n|\r/g);break}var we=this.location.start,Se=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(we):we,Te=this.location.source+":"+Se.line+":"+Se.column;if(be){var Ee=this.location.end,Ce=r65("",Se.line.toString().length," "),Oe=be[we.line-1],Re=(we.line===Ee.line?Ee.column:Oe.length+1)-we.column||1;ve+="\n --\x3e "+Te+"\n"+Ce+" |\n"+Se.line+" | "+Oe+"\n"+Ce+" | "+r65("",we.column-1," ")+r65("",Re,"^")}else ve+="\n at "+Te}return ve},e76.buildMessage=function(fe,ve){var _e={literal:function(fe){return'"'+u30(fe.text)+'"'},class:function(fe){var ve=fe.parts.map((function(fe){return Array.isArray(fe)?a55(fe[0])+"-"+a55(fe[1]):a55(fe)}));return"["+(fe.inverted?"^":"")+ve.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(fe){return fe.description}};function n53(fe){return fe.charCodeAt(0).toString(16).toUpperCase()}function u30(fe){return fe.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(fe){return"\\x0"+n53(fe)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(fe){return"\\x"+n53(fe)}))}function a55(fe){return fe.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(fe){return"\\x0"+n53(fe)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(fe){return"\\x"+n53(fe)}))}function o39(fe){return _e[fe.type](fe)}return"Expected "+function c50(fe){var ve,_e,be=fe.map(o39);if(be.sort(),be.length>0){for(ve=1,_e=1;ve<be.length;ve++)be[ve-1]!==be[ve]&&(be[_e]=be[ve],_e++);be.length=_e}switch(be.length){case 1:return be[0];case 2:return be[0]+" or "+be[1];default:return be.slice(0,-1).join(", ")+", or "+be[be.length-1]}}(fe)+" but "+function i52(fe){return fe?'"'+u30(fe)+'"':"end of input"}(ve)+" found."},{SyntaxError:e76,parse:function n52(fe,ve){var _e,be={},we=(ve=void 0!==ve?ve:{}).grammarSource,Se={start:Lt2},Te=Lt2,Ee="none",Ce=")",Oe=",",Re="(",De="%",Be="px",Ze="cm",Xe="mm",Je="in",Qe="pt",dt="pc",$t="deg",bt="rad",wt="grad",xt="turn",St="#",Et=".",Pt="e",Ot=/^[ \t\n\r]/,At=/^[a-z\-]/,Mt=/^[0-9a-fA-F]/,Rt=/^[+\-]/,Nt=/^[0-9]/,Ft=Bt2("none"),zt=Ut2("none",!1),kt=Ut2(")",!1),Bt=Ut2(",",!1),jt=Bt2("whitespace"),Gt=Ht2([" ","\t","\n","\r"],!1,!1),Ht=Bt2("function"),qt=Ut2("(",!1),Wt=Bt2("identifier"),Yt=Ht2([["a","z"],"-"],!1,!1),Xt=Bt2("percentage"),Jt=Ut2("%",!1),Qt=Bt2("length"),Kt=Ut2("px",!1),er=Ut2("cm",!1),tr=Ut2("mm",!1),rr=Ut2("in",!1),ir=Ut2("pt",!1),nr=Ut2("pc",!1),sr=Bt2("angle"),or=Ut2("deg",!1),ar=Ut2("rad",!1),lr=Ut2("grad",!1),cr=Ut2("turn",!1),ur=Bt2("number"),hr=Bt2("color"),dr=Ut2("#",!1),pr=Ht2([["0","9"],["a","f"],["A","F"]],!1,!1),fr=Ht2(["+","-"],!1,!1),mr=Ht2([["0","9"]],!1,!1),yr=Ut2(".",!1),gr=Ut2("e",!1),st2=function(){return[]},lt2=function(fe,ve){return{type:"function",name:fe,parameters:ve||[]}},ft2=function(fe,ve){return ve.length>0?function se2(fe,ve,_e){return[fe].concat(function ie3(fe,ve){return fe.map((function(fe){return fe[ve]}))}(ve,_e))}(fe,ve,3):[fe]},pt2=function(fe){return{type:"quantity",value:fe.value,unit:fe.unit}},ht2=function(fe){return{type:"color",colorType:fe.type,value:fe.value}},mt2=function(fe){return fe},gt3=function(){return Tt2()},vt2=function(fe){return{value:fe,unit:"%"}},dt2=function(fe){return{value:fe,unit:"px"}},yt2=function(fe){return{value:fe,unit:"cm"}},At2=function(fe){return{value:fe,unit:"mm"}},wt2=function(fe){return{value:fe,unit:"in"}},xt2=function(fe){return{value:fe,unit:"pt"}},bt2=function(fe){return{value:fe,unit:"pc"}},Ct3=function(fe){return{value:fe,unit:"deg"}},Ft2=function(fe){return{value:fe,unit:"rad"}},Et2=function(fe){return{value:fe,unit:"grad"}},jt2=function(fe){return{value:fe,unit:"turn"}},$t2=function(fe){return{value:fe,unit:null}},Ot2=function(){return{type:"hex",value:Tt2()}},kt2=function(fe){return{type:"function",value:fe}},qt2=function(){return{type:"named",value:Tt2()}},St2=function(){return parseFloat(Tt2())},vr=0,_r=0,$r=[{line:1,column:1}],br=0,wr=[],xr=0;if("startRule"in ve){if(!(ve.startRule in Se))throw new Error("Can't start parsing from rule \""+ve.startRule+'".');Te=Se[ve.startRule]}function Tt2(){return fe.substring(_r,vr)}function Ut2(fe,ve){return{type:"literal",text:fe,ignoreCase:ve}}function Ht2(fe,ve,_e){return{type:"class",parts:fe,inverted:ve,ignoreCase:_e}}function Bt2(fe){return{type:"other",description:fe}}function Dt2(ve){var _e,be=$r[ve];if(be)return be;for(_e=ve-1;!$r[_e];)_e--;for(be={line:(be=$r[_e]).line,column:be.column};_e<ve;)10===fe.charCodeAt(_e)?(be.line++,be.column=1):be.column++,_e++;return $r[ve]=be,be}function Gt2(fe,ve,_e){var be=Dt2(fe),Se=Dt2(ve);return{source:we,start:{offset:fe,line:be.line,column:be.column},end:{offset:ve,line:Se.line,column:Se.column}}}function Jt2(fe){vr<br||(vr>br&&(br=vr,wr=[]),wr.push(fe))}function Lt2(){var ve;return(ve=function Qt2(){var ve,_e;return xr++,ve=vr,Zt2(),fe.substr(vr,4)===Ee?(_e=Ee,vr+=4):(_e=be,0===xr&&Jt2(zt)),_e!==be?(Zt2(),_r=ve,ve=st2()):(vr=ve,ve=be),xr--,ve===be&&0===xr&&Jt2(Ft),ve}())===be&&(ve=function Vt2(){var fe,ve;if(fe=[],(ve=Wt2())!==be)for(;ve!==be;)fe.push(ve),ve=Wt2();else fe=be;return fe}()),ve}function Wt2(){var ve,_e,we,Se;return ve=vr,Zt2(),(_e=function te3(){var ve,_e,we;return xr++,ve=vr,(_e=ee4())!==be?(40===fe.charCodeAt(vr)?(we=Re,vr++):(we=be,0===xr&&Jt2(qt)),we!==be?(_r=ve,ve=mt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),xr--,ve===be&&(_e=be,0===xr&&Jt2(Ht)),ve}())!==be?(Zt2(),(we=function Xt2(){var ve,_e,we,Se,Te,Ee,Ce,Re;if(ve=vr,(_e=Yt2())!==be){for(we=[],Se=vr,Te=Zt2(),44===fe.charCodeAt(vr)?(Ee=Oe,vr++):(Ee=be,0===xr&&Jt2(Bt)),Ee===be&&(Ee=null),Ce=Zt2(),(Re=Yt2())!==be?Se=Te=[Te,Ee,Ce,Re]:(vr=Se,Se=be);Se!==be;)we.push(Se),Se=vr,Te=Zt2(),44===fe.charCodeAt(vr)?(Ee=Oe,vr++):(Ee=be,0===xr&&Jt2(Bt)),Ee===be&&(Ee=null),Ce=Zt2(),(Re=Yt2())!==be?Se=Te=[Te,Ee,Ce,Re]:(vr=Se,Se=be);_r=ve,ve=ft2(_e,we)}else vr=ve,ve=be;return ve}())===be&&(we=null),Zt2(),41===fe.charCodeAt(vr)?(Se=Ce,vr++):(Se=be,0===xr&&Jt2(kt)),Se!==be?(Zt2(),_r=ve,ve=lt2(_e,we)):(vr=ve,ve=be)):(vr=ve,ve=be),ve}function Yt2(){var ve,_e;return ve=vr,(_e=function re2(){var ve,_e,we;return xr++,ve=vr,Zt2(),(_e=ce2())!==be?(37===fe.charCodeAt(vr)?(we=De,vr++):(we=be,0===xr&&Jt2(Jt)),we!==be?(_r=ve,ve=vt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),xr--,ve===be&&0===xr&&Jt2(Xt),ve}())===be&&(_e=function ne3(){var ve,_e,we;return xr++,ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===Be?(we=Be,vr+=2):(we=be,0===xr&&Jt2(Kt)),we!==be?(_r=ve,ve=dt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===Ze?(we=Ze,vr+=2):(we=be,0===xr&&Jt2(er)),we!==be?(_r=ve,ve=yt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===Xe?(we=Xe,vr+=2):(we=be,0===xr&&Jt2(tr)),we!==be?(_r=ve,ve=At2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===Je?(we=Je,vr+=2):(we=be,0===xr&&Jt2(rr)),we!==be?(_r=ve,ve=wt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===Qe?(we=Qe,vr+=2):(we=be,0===xr&&Jt2(ir)),we!==be?(_r=ve,ve=xt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,Zt2(),(_e=ce2())!==be?(fe.substr(vr,2)===dt?(we=dt,vr+=2):(we=be,0===xr&&Jt2(nr)),we!==be?(_r=ve,ve=bt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be)))))),xr--,ve===be&&0===xr&&Jt2(Qt),ve}())===be&&(_e=function ue2(){var ve,_e,we;return xr++,ve=vr,(_e=ce2())!==be?(fe.substr(vr,3)===$t?(we=$t,vr+=3):(we=be,0===xr&&Jt2(or)),we!==be?(_r=ve,ve=Ct3(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,(_e=ce2())!==be?(fe.substr(vr,3)===bt?(we=bt,vr+=3):(we=be,0===xr&&Jt2(ar)),we!==be?(_r=ve,ve=Ft2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,(_e=ce2())!==be?(fe.substr(vr,4)===wt?(we=wt,vr+=4):(we=be,0===xr&&Jt2(lr)),we!==be?(_r=ve,ve=Et2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be),ve===be&&(ve=vr,(_e=ce2())!==be?(fe.substr(vr,4)===xt?(we=xt,vr+=4):(we=be,0===xr&&Jt2(cr)),we!==be?(_r=ve,ve=jt2(_e)):(vr=ve,ve=be)):(vr=ve,ve=be)))),xr--,ve===be&&(_e=be,0===xr&&Jt2(sr)),ve}())===be&&(_e=function ae2(){var fe,ve;return xr++,fe=vr,Zt2(),(ve=ce2())!==be?(_r=fe,fe=$t2(ve)):(vr=fe,fe=be),xr--,fe===be&&0===xr&&Jt2(ur),fe}()),_e!==be&&(_r=ve,_e=pt2(_e)),(ve=_e)===be&&(ve=vr,(_e=function oe3(){var ve,_e,we,Se;if(xr++,ve=vr,35===fe.charCodeAt(vr)?(_e=St,vr++):(_e=be,0===xr&&Jt2(dr)),_e!==be){if(we=[],Mt.test(fe.charAt(vr))?(Se=fe.charAt(vr),vr++):(Se=be,0===xr&&Jt2(pr)),Se!==be)for(;Se!==be;)we.push(Se),Mt.test(fe.charAt(vr))?(Se=fe.charAt(vr),vr++):(Se=be,0===xr&&Jt2(pr));else we=be;we!==be?(_r=ve,ve=Ot2()):(vr=ve,ve=be)}else vr=ve,ve=be;return ve===be&&(ve=vr,(_e=Wt2())!==be&&(_r=ve,_e=kt2(_e)),(ve=_e)===be&&(ve=vr,(_e=ee4())!==be&&(_r=ve,_e=qt2()),ve=_e)),xr--,ve===be&&(_e=be,0===xr&&Jt2(hr)),ve}())!==be&&(_r=ve,_e=ht2(_e)),ve=_e),ve}function Zt2(){var ve,_e;for(xr++,ve=[],Ot.test(fe.charAt(vr))?(_e=fe.charAt(vr),vr++):(_e=be,0===xr&&Jt2(Gt));_e!==be;)ve.push(_e),Ot.test(fe.charAt(vr))?(_e=fe.charAt(vr),vr++):(_e=be,0===xr&&Jt2(Gt));return xr--,_e=be,0===xr&&Jt2(jt),ve}function ee4(){var ve,_e,we;if(xr++,ve=vr,_e=[],At.test(fe.charAt(vr))?(we=fe.charAt(vr),vr++):(we=be,0===xr&&Jt2(Yt)),we!==be)for(;we!==be;)_e.push(we),At.test(fe.charAt(vr))?(we=fe.charAt(vr),vr++):(we=be,0===xr&&Jt2(Yt));else _e=be;return _e!==be&&(_r=ve,_e=gt3()),xr--,(ve=_e)===be&&(_e=be,0===xr&&Jt2(Wt)),ve}function ce2(){var ve,_e,we,Se,Te,Ee,Ce;for(ve=vr,Rt.test(fe.charAt(vr))?(fe.charAt(vr),vr++):0===xr&&Jt2(fr),_e=vr,we=[],Nt.test(fe.charAt(vr))?(Se=fe.charAt(vr),vr++):(Se=be,0===xr&&Jt2(mr));Se!==be;)we.push(Se),Nt.test(fe.charAt(vr))?(Se=fe.charAt(vr),vr++):(Se=be,0===xr&&Jt2(mr));if(46===fe.charCodeAt(vr)?(Se=Et,vr++):(Se=be,0===xr&&Jt2(yr)),Se!==be){if(Te=[],Nt.test(fe.charAt(vr))?(Ee=fe.charAt(vr),vr++):(Ee=be,0===xr&&Jt2(mr)),Ee!==be)for(;Ee!==be;)Te.push(Ee),Nt.test(fe.charAt(vr))?(Ee=fe.charAt(vr),vr++):(Ee=be,0===xr&&Jt2(mr));else Te=be;Te!==be?_e=we=[we,Se,Te]:(vr=_e,_e=be)}else vr=_e,_e=be;if(_e===be)if(_e=[],Nt.test(fe.charAt(vr))?(we=fe.charAt(vr),vr++):(we=be,0===xr&&Jt2(mr)),we!==be)for(;we!==be;)_e.push(we),Nt.test(fe.charAt(vr))?(we=fe.charAt(vr),vr++):(we=be,0===xr&&Jt2(mr));else _e=be;if(_e!==be){if(we=vr,101===fe.charCodeAt(vr)?(Se=Pt,vr++):(Se=be,0===xr&&Jt2(gr)),Se!==be){if(Rt.test(fe.charAt(vr))?(Te=fe.charAt(vr),vr++):(Te=be,0===xr&&Jt2(fr)),Te===be&&(Te=null),Ee=[],Nt.test(fe.charAt(vr))?(Ce=fe.charAt(vr),vr++):(Ce=be,0===xr&&Jt2(mr)),Ce!==be)for(;Ce!==be;)Ee.push(Ce),Nt.test(fe.charAt(vr))?(Ce=fe.charAt(vr),vr++):(Ce=be,0===xr&&Jt2(mr));else Ee=be;Ee!==be?we=Se=[Se,Te,Ee]:(vr=we,we=be)}else vr=we,we=be;we===be&&(we=null),_r=ve,ve=St2()}else vr=ve,ve=be;return ve}if((_e=Te())!==be&&vr===fe.length)return _e;throw _e!==be&&vr<fe.length&&Jt2({type:"end"}),function Kt2(fe,ve,_e){return new e76(e76.buildMessage(fe,ve),fe,ve,_e)}(wr,br<fe.length?fe.charAt(br):null,br<fe.length?Gt2(br,br+1):Gt2(br,br))}}},(M9=D9).exports&&(M9.exports=R9());var F9=D9.exports;function y$S(fe){if(!fe||0===fe.length)return null;if("string"==typeof fe){const ve=A$C(fe);return ve&&0!==ve.length?ve:null}const ve=fe.map((fe=>{if(!Number.isFinite(fe.scale)||fe.scale<=0)throw new Ir("effect:invalid-scale","scale must be finite and greater than 0",{stop:fe});return{scale:fe.scale,effects:A$C(fe.value)}}));ve.sort(((fe,ve)=>ve.effects.length-fe.effects.length));for(let _e=0;_e<ve.length-1;_e++){if(!t$3r(ve[_e].effects,ve[_e+1].effects))throw new Ir("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:ve[_e].effects,b:ve[_e+1].effects});e$3m(ve[_e].effects,ve[_e+1].effects)}return ve.sort(((fe,ve)=>ve.scale-fe.scale)),ve}function A$C(fe){let ve;if(!fe)return[];try{ve=F9.parse(fe)}catch(Dr){throw new Ir("effect:invalid-syntax","Invalid effect syntax",{value:fe,error:Dr})}return ve.map((fe=>function w$P(fe){try{switch(fe.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function x$x(fe){let ve=1;return $$c(fe.parameters,1),1===fe.parameters.length&&(ve=P$q(fe.parameters[0])),new I_(fe.name,ve)}(fe);case"opacity":return function b$M(fe){let ve=1;return $$c(fe.parameters,1),1===fe.parameters.length&&(ve=P$q(fe.parameters[0])),new N_(ve)}(fe);case"hue-rotate":return function C$v(fe){let ve=0;return $$c(fe.parameters,1),1===fe.parameters.length&&(ve=function T$v(fe){return function R$y(fe){if("quantity"!==fe.type||!(0===fe.value&&null===fe.unit||fe.unit&&null!=z9[fe.unit]))throw new Ir("effect:type-error",`Expected <angle>, Actual: ${O$y(fe)}`,{term:fe})}(fe),fe.value*z9[fe.unit]||0}(fe.parameters[0])),new D_(ve)}(fe);case"blur":return function F$s(fe){let ve=0;return $$c(fe.parameters,1),1===fe.parameters.length&&(ve=U$u(fe.parameters[0]),k$w(ve,fe.parameters[0])),new R_(ve)}(fe);case"drop-shadow":return function E$D(fe){const ve=[];let _e=null;for(const be of fe.parameters)if("color"===be.type){if(ve.length&&Object.freeze(ve),_e)throw new Ir("effect:type-error","Accepts only one color",{});_e=H$l(be)}else{const fe=U$u(be);if(Object.isFrozen(ve))throw new Ir("effect:type-error","<length> parameters not consecutive",{lengths:ve});ve.push(fe),3===ve.length&&k$w(fe,be)}if(ve.length<2||ve.length>3)throw new Ir("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${ve.length}}`,{lengths:ve});return new L_(ve[0],ve[1],ve[2]||0,_e||_$x("black"))}(fe);case"bloom":return function j$H(fe){let ve=1,_e=0,be=0;return $$c(fe.parameters,3),fe.parameters[0]&&(ve=P$q(fe.parameters[0])),fe.parameters[1]&&(_e=U$u(fe.parameters[1]),k$w(_e,fe.parameters[1])),fe.parameters[2]&&(be=P$q(fe.parameters[2])),new M_(ve,_e,be)}(fe)}}catch(ve){throw ve.details.filter=fe,ve}throw new Ir("effect:unknown-effect",`Effect '${fe.name}' is not supported`,{effect:fe})}(fe)))}function $$c(fe,ve){if(fe.length>ve)throw new Ir("effect:type-error",`Function supports up to ${ve} parameters, Actual: ${fe.length}`,{parameters:fe})}function O$y(fe){if("color"===fe.type)return"<color>";if(fe.unit){if(fe.unit in U9)return"<length>";if(fe.unit in z9)return"<angle>";if("%"===fe.unit)return"<percentage>"}return"<double>"}function k$w(fe,ve){if(fe<0)throw new Ir("effect:type-error",`Negative values are not allowed, Actual: ${fe}`,{term:ve})}const z9={deg:1,grad:.9,rad:180/Math.PI,turn:360};const U9={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function P$q(fe){!function S$J(fe){if("quantity"!==fe.type||null!==fe.unit&&"%"!==fe.unit)throw new Ir("effect:type-error",`Expected <double> or <percentage>, Actual: ${O$y(fe)}`,{term:fe})}(fe);const ve=fe.value;return k$w(ve,fe),"%"===fe.unit?.01*ve:ve}function N$q(fe){return function q$m(fe){if("quantity"!==fe.type||null!==fe.unit)throw new Ir("effect:type-error",`Expected <double>, Actual: ${O$y(fe)}`,{term:fe})}(fe),k$w(fe.value,fe),fe.value}function U$u(fe){return function M$u(fe){if("quantity"!==fe.type||!(0===fe.value&&null===fe.unit||fe.unit&&null!=U9[fe.unit]))throw new Ir("effect:type-error",`Expected <length>, Actual: ${O$y(fe)}`,{term:fe})}(fe),fe.value*U9[fe.unit]||0}function H$l(fe){switch(fe.colorType){case"hex":return function i$3M(fe){const ve=fe.length>5,_e=ve?8:4,be=(1<<_e)-1,we=ve?1:17,Se=ve?9===fe.length:5===fe.length;let Te=Number("0x"+fe.substr(1));if(isNaN(Te))return null;const Ee=[0,0,0,1];let Ce;return Se&&(Ce=Te&be,Te>>=_e,Ee[3]=we*Ce/255),Ce=Te&be,Te>>=_e,Ee[2]=we*Ce,Ce=Te&be,Te>>=_e,Ee[1]=we*Ce,Ce=Te&be,Te>>=_e,Ee[0]=we*Ce,Ee}(fe.value);case"named":return _$x(fe.value);case"function":return function G$h(fe){if($$c(fe.parameters,4),H9.test(fe.name))return[P$q(fe.parameters[0]),P$q(fe.parameters[1]),P$q(fe.parameters[2]),fe.parameters[3]?P$q(fe.parameters[3]):1];if(q9.test(fe.name))return o$3j(N$q(fe.parameters[0]),P$q(fe.parameters[1]),P$q(fe.parameters[2]),fe.parameters[3]?P$q(fe.parameters[3]):1);throw new Ir("effect:syntax-error",`Invalid color function '${fe.name}'`,{colorFunction:fe})}(fe.value)}}function _$x(fe){if(!r$2V(fe))throw new Ir("effect:unknown-color",`color '${fe}' isn't valid`,{namedColor:fe});return function a$3P(fe){return[...l$3F(fe)]}(fe)}const H9=/^rgba?/i,q9=/^hsla?/i;function n$1R(fe,ve,_e){var be;try{return function c$1N(fe){if(!fe||0===fe.length)return null;if(function f$18(fe){const ve=fe[0];return!!ve&&"scale"in ve}(fe)){const ve=[];for(const _e of fe)ve.push({scale:_e.scale,value:i$1H(_e.value)});return ve}return i$1H(fe)}(fe)}catch(vv){null==(be=null==_e?void 0:_e.messages)||be.push(vv)}return null}function a$1I(fe,ve,_e,be){try{const be=function o$1a(fe){const ve=y$S(fe);return ve?function l$3C(fe){const ve=fe[0];return!!ve&&"type"in ve}(ve)?ve.map((fe=>fe.toJSON())):ve.map((({scale:fe,effects:ve})=>({scale:fe,value:ve.map((fe=>fe.toJSON()))}))):null}(fe);e$4h(_e,be,ve)}catch(GC){be.messages&&be.messages.push(GC)}}function i$1H(fe){if(!(null==fe?void 0:fe.length))return"";const ve=[];for(const _e of fe){let fe=[];switch(_e.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":fe=[u$1t(_e,"amount")];break;case"blur":fe=[u$1t(_e,"radius","pt")];break;case"hue-rotate":fe=[u$1t(_e,"angle","deg")];break;case"drop-shadow":fe=[u$1t(_e,"xoffset","pt"),u$1t(_e,"yoffset","pt"),u$1t(_e,"blurRadius","pt"),l$1N(_e,"color")];break;case"bloom":fe=[u$1t(_e,"strength"),u$1t(_e,"radius","pt"),u$1t(_e,"threshold")]}const be=`${_e.type}(${fe.filter(Boolean).join(" ")})`;y$S(be),ve.push(be)}return ve.join(" ")}function u$1t(fe,ve,_e){if(null==fe[ve])throw new Ir("effect:missing-parameter",`Missing parameter '${ve}' in ${fe.type} effect`,{effect:fe});return _e?fe[ve]+_e:""+fe[ve]}function l$1N(fe,ve){if(null==fe[ve])throw new Ir("effect:missing-parameter",`Missing parameter '${ve}' in ${fe.type} effect`,{effect:fe});const _e=fe[ve];return`rgba(${_e[0]||0}, ${_e[1]||0}, ${_e[2]||0}, ${_e[3]/255||0})`}let W9=class e44{constructor(fe,ve){this._storage=new lJ,this.id="",this.name="",this.size=0,this._storage.maxSize=fe,this._storage.register(this),ve&&this._storage.registerRemoveFunc("",ve)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(fe,ve,_e=1){this._storage.put(this,fe,ve,_e,1)}pop(fe){return this._storage.pop(this,fe)}get(fe){return this._storage.get(this,fe)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(fe){this._storage.maxSize=fe}resetHitRate(){}};new W9(1e3),new b_([128,128,128]);const Y9=new b_("white");function y$R(fe){if(null==fe||!("symbolLayers"in fe)||null==fe.symbolLayers)return!1;switch(fe.type){case"point-3d":return fe.symbolLayers.some((fe=>"object"===fe.type));case"line-3d":return fe.symbolLayers.some((fe=>"path"===fe.type));case"polygon-3d":return fe.symbolLayers.some((fe=>"object"===fe.type||"extrude"===fe.type));default:return!1}}function h$Z(fe,ve){if(!fe)return null;let _e=null;return x$1h(fe)?_e=function b$L(fe){const ve=fe.symbolLayers;if(!ve)return null;let _e=null;return ve.forEach((fe=>{var ve;"object"===fe.type&&(null==(ve=fe.resource)?void 0:ve.href)||(_e="water"===fe.type?fe.color:fe.material?fe.material.color:null)})),_e?new b_(_e):null}(fe):S$1n(fe)&&(_e="cim"===fe.type?C$w(fe):fe.color?new b_(fe.color):null),_e?w$O(_e,ve):null}function w$O(fe,ve){if(null==ve||null==fe)return fe;const _e=fe.toRgba();return _e[3]=_e[3]*ve,new b_(_e)}function g$V(fe,ve,_e){fe&&(ve||null!=_e)&&(ve&&(ve=new b_(ve)),x$1h(fe)?function d$1d(fe,ve,_e){const be=fe.symbolLayers;if(!be)return;const n52=fe=>w$O(ve=ve??fe??(null!=_e?Y9:null),_e);be.forEach((fe=>{var be,we;if("object"!==fe.type||!(null==(be=fe.resource)?void 0:be.href)||ve)if("water"===fe.type)fe.color=n52(fe.color);else{const ve=null!=fe.material?fe.material.color:null,be=n52(ve);null==fe.material?fe.material=new ww({color:be}):fe.material.color=be,null!=_e&&"outline"in fe&&null!=(null==(we=fe.outline)?void 0:we.color)&&(fe.outline.color=w$O(fe.outline.color,_e))}}))}(fe,ve,_e):S$1n(fe)&&function j$G(fe,ve,_e){var be;(ve=ve??fe.color)&&(fe.color=w$O(ve,_e)),null!=_e&&"outline"in fe&&(null==(be=fe.outline)?void 0:be.color)&&(fe.outline.color=w$O(fe.outline.color,_e))}(fe,ve,_e))}async function k$v(fe,ve){const _e=fe.symbolLayers;_e&&await a$4g(_e,(async fe=>async function L$q(fe,ve){switch(fe.type){case"extrude":!function x$w(fe,ve){fe.size="number"==typeof ve[2]?ve[2]:0}(fe,ve);break;case"icon":case"line":case"text":!function z$m(fe,ve){const _e=S$I(ve);null!=_e&&(fe.size=_e)}(fe,ve);break;case"path":!function v$I(fe,ve){const _e=E$C(ve,ji,[fe.width,void 0,fe.height]);fe.width=M$t(ve[0],fe.width,1,_e),fe.height=M$t(ve[2],fe.height,1,_e)}(fe,ve);break;case"object":await async function U$t(fe,ve){const{resourceSize:_e,symbolSize:be}=await async function C$u(fe){const{computeObjectLayerResourceSize:ve}=await zt((()=>import("./symbolLayerUtils-DgKotnA0.js")),[]),_e=await ve(fe,10),{width:be,height:we,depth:Se}=fe,Te=[be,Se,we];let Ee=1;for(let Ce=0;Ce<3;Ce++){const fe=Te[Ce];if(null!=fe){Ee=fe/_e[Ce];break}}for(let Ce=0;Ce<3;Ce++)null==Te[Ce]&&(Te[Ce]=_e[Ce]*Ee);return{resourceSize:_e,symbolSize:Te}}(fe),we=E$C(ve,_e,be);fe.width=M$t(ve[0],be[0],_e[0],we),fe.depth=M$t(ve[1],be[1],_e[1],we),fe.height=M$t(ve[2],be[2],_e[2],we)}(fe,ve)}}(fe,ve)))}function S$I(fe){for(const ve of fe)if("number"==typeof ve)return ve;return null}function E$C(fe,ve,_e){for(let be=0;be<3;be++){const we=fe[be];switch(we){case"symbol-value":{const fe=_e[be];return null!=fe?fe/ve[be]:1}case"proportional":break;default:if(we&&ve[be])return we/ve[be]}}return 1}function M$t(fe,ve,_e,be){switch(fe){case"proportional":return _e*be;case"symbol-value":return null!=ve?ve:_e;default:return fe}}async function R$x(fe,ve){if(fe&&ve)return x$1h(fe)?k$v(fe,ve):void(S$1n(fe)&&function O$x(fe,ve){const _e=S$I(ve);if(null!=_e)switch(fe.type){case"simple-marker":fe.size=_e;break;case"picture-marker":{const ve=fe.width/fe.height;ve>1?(fe.width=_e,fe.height=_e*ve):(fe.width=_e*ve,fe.height=_e);break}case"simple-line":fe.width=_e;break;case"text":fe.font.size=_e}}(fe,ve))}function D$s(fe,ve,_e){if(fe&&null!=ve)if(x$1h(fe)){const be=fe.symbolLayers;be&&be.forEach((fe=>{if(fe&&"object"===fe.type)switch(_e){case"tilt":fe.tilt=(fe.tilt??0)+ve;break;case"roll":fe.roll=(fe.roll??0)+ve;break;default:fe.heading=(fe.heading??0)+ve}}))}else S$1n(fe)&&("simple-marker"!==fe.type&&"picture-marker"!==fe.type&&"text"!==fe.type||(fe.angle+=ve))}function J$c(fe){return null!=fe&&"polygon-3d"===fe.type&&fe.symbolLayers.some((fe=>"extrude"===fe.type))}async function N$p(fe,ve){return await fe.fetchSymbol(ve)||fe.fetchCIMSymbol(ve)}const Z9=1.2,X9=_d,J9=4;let Q9=class l19{constructor(fe,ve,_e,be){this.graphics3DSymbolLayer=fe,this.renderGeometries=ve,this.boundingBox=_e,this._drapeSourceRenderer=be,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(fe){this.stage=fe.stage}setVisibility(fe){if(null!=this.stage&&this._visible!==fe){if(this._visible=fe,fe&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,XX.ADD);if(fe||this._addedToStage){for(const fe of this.renderGeometries)fe.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,JX.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,XX.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(fe=[0,0,0]){return o$44(fe,0,0,0)}getBoundingBoxObjectSpace(fe=i$3t()){return P$$(fe)}addObjectState(fe,ve){fe===xA.Highlight&&(this.renderGeometries.forEach((fe=>{const _e=fe.geometry.addHighlight();ve.addRenderGeometry(fe,_e,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,JX.HIGHLIGHT))}removeObjectState(fe){this.renderGeometries.forEach((ve=>{fe.removeRenderGeometry(ve)}))}removeRenderGeometryObjectState(fe,ve){fe.geometry.removeHighlight(ve),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,JX.HIGHLIGHT)}computeAttachmentOrigin(fe){for(const ve of this.renderGeometries)ve.geometry.computeAttachmentOrigin(D7)&&(fe.draped.origin[0]+=D7[0],fe.draped.origin[1]+=D7[1],fe.draped.num++)}async getProjectedBoundingBox(fe,ve,_e,be,we){P$$(we);for(let Se=0;Se<this.renderGeometries.length;Se++){const ve=this.renderGeometries[Se];this._getRenderGeometryProjectedBoundingRect(ve,fe,K9,_e),f$2p(we,K9)}if(ve){let fe;E$1m(we,D7);const _e=k$J(we,ve.service.spatialReference,ve);try{fe=await ve.service.queryElevation(D7[0],D7[1],be,_e,"ground")}catch(GC){}null!=fe&&(we[2]=Math.min(we[2],fe),we[5]=Math.max(we[5],fe))}return we}_getRenderGeometryProjectedBoundingRect(fe,ve,_e,be){if(this.boundingBox)O$16($7,this.boundingBox);else{const ve=fe.boundingSphere,_e=ve[3];$7[0]=ve[0]-_e,$7[1]=ve[1]-_e,$7[2]=ve[2]-_e,$7[3]=ve[0]+_e,$7[4]=ve[1]+_e,$7[5]=ve[2]+_e}return ve($7,0,2),this.calculateRelativeScreenBounds&&be.push({location:E$1m($7),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),S$1r($7,_e)}};const K9=u$3J(),$7=i$3t(),D7=[0,0,0];function a$1G(fe,ve,_e){return fe.canvas||(fe.canvas=document.createElement("canvas")),fe.canvas.width=ve,fe.canvas.height=_e,fe.canvas}function e$1s(fe){const{size:ve}=fe.definition,_e=fe.fontString(ve);let be=W7.get(_e);if(!be){const we=a$1G(Z7,0,0).getContext("2d");fe.setFontProperties(we,ve);const Se=we.measureText(X7);be=new Y7(Se.actualBoundingBoxAscent,Se.actualBoundingBoxDescent),W7.set(_e,be)}return be}const W7=new Map;let Y7=class s53{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(fe,ve){this.maxAscent=fe,this.maxDescent=ve}};const Z7={canvas:null},X7=(()=>{let fe="";for(let ve=32;ve<127;ve++)fe+=String.fromCharCode(ve);return fe})(),J7=1;let Q7=class r40{constructor(fe,ve,_e,be){this.text=fe,this._alignment=ve,this._parameters=_e,this._maxSize=be,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${fe}`,this._lines=fe.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let fe=this._metrics.firstLineAscent;for(let ve=0;ve<this._lines.length-1;ve++)fe+=this._lineSpacing;return fe+=this._metrics.lastLineDescent,Math.ceil(fe+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const fe=a$1G(tee,iee,iee).getContext("2d"),ve=this._parameters.definition.pixelRatio,_e=this._fontSize*ve;this._parameters.setFontProperties(fe,_e);let be=2*this._haloSize;const we=this._parameters.definition.font;"italic"!==we.style&&"oblique"!==we.style&&"bold"!==we.weight&&"bolder"!==we.weight||(be+=.3*fe.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let Se=0,Te=0,Ee=0,Ce=0,Oe=0;this._lines.forEach(((_e,we)=>{const Re=fe.measureText(_e),De=Re.width/ve,Be=De+be;this._textWidths.push(De),this._lineWidths.push(Be),Se=Math.max(Se,Be),Ce=Math.max(Ce,Re.actualBoundingBoxAscent/ve),Oe=Math.max(Oe,Re.actualBoundingBoxDescent/ve),0===we&&(Te=Re.actualBoundingBoxAscent/ve),we===this._lines.length-1&&(Ee=Re.actualBoundingBoxDescent/ve)}));const Re=e$1s(this._parameters),De=Math.max(Ce,Re.maxAscent),Be=Math.max(Oe,Re.maxDescent),Ze=Te,Xe="underline"===this._parameters.definition.font.decoration?Be:Ee,Je=Se;this._metricsCached=new see(Ze,Xe,De,Be,Je)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*ree}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,J7)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const fe=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(fe,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(fe){switch(this._alignment){case eee.Left:return this._horizontalPadding;case eee.Center:return(this.displayWidth-this._lineWidths[fe])/2;case eee.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[fe]}}render(fe,ve,_e){fe.save();const be=ve/=this.renderPixelRatio,we=_e/=this.renderPixelRatio,Se=this._haloSize,Te=this._firstLineYOffset+this._metrics.firstLineAscent;ve+=Se,_e+=Te;const Ee=this._haloSize>0;Ee&&this._renderHalo(fe,be,we,Se,Te),this._parameters.setFontProperties(fe,this._renderedFontSize);for(let Ce=0;Ce<this._lines.length;++Ce){const be=this._lines[Ce],we=this._getLineXOffset(Ce);Ee&&(fe.globalCompositeOperation="destination-out",fe.fillStyle="rgb(0, 0, 0)",this._fillText(fe,be,ve+we,_e),this._renderLineDecoration(fe,ve+we,_e,this._textWidths[Ce])),fe.globalCompositeOperation="source-over",fe.fillStyle=this._parameters.textStyle,this._fillText(fe,be,ve+this._getLineXOffset(Ce),_e),this._renderLineDecoration(fe,ve+we,_e,this._textWidths[Ce]),_e+=this._lineSpacing}if(_B.TEXT_SHOW_BASELINE){fe.strokeStyle=nee,fe.setLineDash([2,2]),fe.lineWidth=1;let ve=we+Te;for(let _e=0;_e<this._lines.length;++_e)this._drawLine(fe,[be,ve],[be+this.displayWidth,ve]),ve+=this._lineSpacing}if(_B.TEXT_SHOW_BORDER&&(fe.strokeStyle=nee,fe.setLineDash([]),fe.lineWidth=1,this._drawBox(fe,[be,we],[this.displayWidth,this.displayHeight])),this._hasBackground){const ve=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(fe,be,we,ve),fe.globalCompositeOperation="destination-over",fe.fillStyle=this._parameters.backgroundStyle,fe.fill()}fe.restore()}_renderLineDecoration(fe,ve,_e,be,we=!1){if("none"===this._parameters.definition.font.decoration||0===be)return;const Se=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":_e+=2*Se;break;case"line-through":_e-=.33*this._midLineAscent}const Te=we?this._haloSize:0;fe.strokeStyle=we?this._parameters.haloStyle:this._parameters.textStyle,fe.lineWidth=this._toRenderUnit(Se+2*Te),fe.beginPath(),fe.moveTo(this._toRenderUnit(ve-Te),this._toRenderUnit(_e)),fe.lineTo(this._toRenderUnit(ve+be+Te),this._toRenderUnit(_e)),fe.stroke()}_roundedRect(fe,ve,_e,be){ve=this._toRenderUnit(ve),_e=this._toRenderUnit(_e);const we=this.renderedWidth,Se=this.renderedHeight;0!==be?(be=e$3Y(be,0,Math.floor(Se/2)),fe.beginPath(),fe.moveTo(ve,_e+be),fe.arcTo(ve,_e,ve+be,_e,be),fe.lineTo(ve+we-be,_e),fe.arcTo(ve+we,_e,ve+we,_e+be,be),fe.lineTo(ve+we,_e+Se-be),fe.arcTo(ve+we,_e+Se,ve+we-be,_e+Se,be),fe.lineTo(ve+be,_e+Se),fe.arcTo(ve,_e+Se,ve,_e+Se-be,be),fe.closePath()):fe.rect(ve,_e,we,Se)}_renderHalo(fe,ve,_e,be,we){const Se=this.renderedWidth,Te=this.renderedHeight,Ee=a$1G(tee,Math.max(Se,iee),Math.max(Te,iee)),Ce=Ee.getContext("2d");Ce.clearRect(0,0,Se,Te),this._parameters.setFontProperties(Ce,this._renderedFontSize),Ce.fillStyle=this._parameters.haloStyle,Ce.strokeStyle=this._parameters.haloStyle;const Oe=this._renderedHaloSize<3;Ce.lineJoin=Oe?"miter":"round",Oe?this._renderHaloEmulated(Ce,be,we):this._renderHaloNative(Ce,be,we);let Re=we;for(let De=0;De<this._lines.length;++De){const fe=this._getLineXOffset(De);this._renderLineDecoration(Ce,be+fe,Re,this._textWidths[De],!0),Re+=this._lineSpacing}fe.globalAlpha=this._parameters.definition.halo.color[3],fe.drawImage(Ee,0,0,Se,Te,this._toRenderUnit(ve),this._toRenderUnit(_e),Se,Te),fe.globalAlpha=1}_renderHaloEmulated(fe,ve,_e){for(let be=0;be<this._lines.length;++be){const we=this._lines[be],Se=this._getLineXOffset(be);for(const[be,Te]of K7)this._fillText(fe,we,ve+Se+this._haloSize*be,_e+this._haloSize*Te);_e+=this._lineSpacing}}_renderHaloNative(fe,ve,_e){const be=2*this._haloSize;for(let we=0;we<this._lines.length;++we){const Se=this._lines[we],Te=this._getLineXOffset(we),Ee=5,Ce=.1;for(let we=0;we<Ee;we++){const Oe=1-(Ee-1)*Ce+we*Ce;fe.lineWidth=this._toRenderUnit(Oe*be),this._strokeText(fe,Se,ve+Te,_e)}_e+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(fe){return fe*this.renderPixelRatio}_toRoundedRenderUnit(fe){return Math.round(fe*this.renderPixelRatio)}_fillText(fe,ve,_e,be){fe.fillText(ve,this._toRenderUnit(_e),this._toRenderUnit(be))}_strokeText(fe,ve,_e,be){fe.strokeText(ve,this._toRenderUnit(_e),this._toRenderUnit(be))}_drawLine(fe,ve,_e){fe.beginPath(),fe.moveTo(this._toRoundedRenderUnit(ve[0])+.5,this._toRoundedRenderUnit(ve[1])+.5),fe.lineTo(this._toRoundedRenderUnit(_e[0])+.5,this._toRoundedRenderUnit(_e[1])+.5),fe.stroke()}_drawBox(fe,ve,_e){const be=this._toRenderUnit(ve[0]),we=this._toRenderUnit(ve[1]),Se=this._toRenderUnit(_e[0]),Te=this._toRenderUnit(_e[1]),Ee=Math.floor(be)+.5,Ce=Math.ceil(be+Se)-.5,Oe=Math.floor(we)+.5,Re=Math.ceil(we+Te)-.5;fe.beginPath(),fe.moveTo(Ee,Oe),fe.lineTo(Ce,Oe),fe.lineTo(Ce,Re),fe.lineTo(Ee,Re),fe.lineTo(Ee,Oe),fe.stroke()}};const K7=[];{const fe=16;for(let ve=0;ve<360;ve+=360/fe)K7.push([Math.cos(Math.PI*ve/180),Math.sin(Math.PI*ve/180)])}var eee;!function(fe){fe[fe.Left=0]="Left",fe[fe.Center=1]="Center",fe[fe.Right=2]="Right"}(eee||(eee={}));const tee={canvas:null},ree=.2,iee=512,nee="rgb(255, 0, 255, 0.5)";let see=class c31{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(fe,ve,_e,be,we){this.firstLineAscent=fe,this.lastLineDescent=ve,this.maxLineAscent=_e,this.maxLineDescent=be,this.displayWidth=we}};const oee=Object.freeze({left:0,center:.5,right:1}),aee=Object.freeze({"bottom-left":r$36(0,0),bottom:r$36(.5,0),"bottom-right":r$36(1,0),left:r$36(0,.5),center:r$36(.5,.5),right:r$36(1,.5),"top-left":r$36(0,1),top:r$36(.5,1),"top-right":r$36(1,1)});function f$16(fe){switch(fe){case"left":return eee.Left;case"right":return eee.Right;default:return eee.Center}}function a$1E(fe){switch(fe){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}let lee=class m23{constructor(fe,ve={}){this.geometry=fe,this.screenToWorldRatio=1,this._transformation=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._shaderTransformation=null,this._boundingSphere=null,this.id=e$44(),this.layerUid=ve.layerUid,this.graphicUid=ve.graphicUid,this.castShadow=ve.castShadow??!1,null!=ve.objectShaderTransformation&&this.objectShaderTransformationChanged(ve.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(fe){n$48(this._transformation,fe),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(fe){null==fe?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c$4k(this._shaderTransformation,fe,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=[0,0,0,0]),O$1v(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*m$3g(this.shaderTransformation)),this._boundingSphere):xp}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(fe){this.geometry.visible=fe}};const cee=r$3y(0,0,1),uee=RZ,hee=[uee/2,uee/2,1-uee/2,1-uee/2],dee=[MZ*uee,MZ*uee];let pee=class he extends Yq{getCachedSize(){return{size:this._getIconSize()}}constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(fe){this._validateOrThrow();const ve=this._prepareMaterialParameters(),_e=this._getPrimitive();if(null!=_e)this._prepareResourcesPrimitive(ve,_e);else{const _e=function p$1$(fe){var ve;return(null==(ve=fe.resource)?void 0:ve.href)??""}(this.symbolLayer),be=de$5(_e);null!=be?await this._prepareResourcesCIM(ve,JSON.parse(be),fe):await this._prepareResourcesHref(ve,_e,fe)}}_validateOrThrow(){if(this._drivenProperties.size)return;const fe=I$Q(this._getIconSize());if(fe)throw new Ir("graphics3diconsymbollayer:invalid-size",fe)}_getIconSize(){const fe=this.symbolLayer,ve=Math.round(null!=fe.size?u$3E(fe.size):16);return this._drivenProperties.size?Math.max(ve,64):ve}_generateTextureCIM(fe){let ve=this._cimData;if(ve&&ve.symbol||this.logger.error("Can't create texture, CIM data is undefined"),ve.primitiveOverrides){ve=a$4H(ve);const _e=ve.primitiveOverrides;$9.evaluateOverrides(_e,fe,this._arcadeInfo.geometryType,null,null),$9.applyOverrides(ve.symbol,_e)}const _e=l$4F(JSON.stringify(ve));let be=this._cimSymbolTextures.get(_e);if(be)return be;const we=this._context.sharedResources.cimSymbolRasterizer,Se=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;Se&&$9.applyDictionaryTextOverrides(ve.symbol,fe,Se,null);const Te=null!=this._cimScaleFactorOrFunction?function n$20(fe,ve,_e,be){return function r$1u(fe){return"function"==typeof fe}(fe)?fe(ve,_e,be):fe}(this._cimScaleFactorOrFunction,fe):1;1!==Te&&ve.symbol&&l$1O(ve.symbol,Te);const Ee=Q8.getEnvelope(ve,null,we.resourceManager);if((null==Ee?void 0:Ee.width)&&Ee.height){const fe=Ee.x+Ee.width/2,_e=Ee.y+Ee.height/2,Se=we.rasterize({type:"cim",data:ve},Ee.width,Ee.height,fe,_e,1,"esriGeometryPoint"),Te=new Ex({x:-Ee.x/Ee.width-.5,y:(Ee.height+Ee.y)/Ee.height-.5});this._cimMaterialParametersInfo.anchorPosition=pe$6("relative",Te),be=new CZ(Se,{width:(null==Se?void 0:Se.width)??1,height:(null==Se?void 0:Se.height)??1,reloadable:!0})}else be=new CZ(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(_e,be),this._context.stage.add(be),be}_prepareMaterialParameters(){const fe={anchorPosition:pe$6(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ve=this.symbol;if(function me$5(fe){return fe&&"point-3d"===fe.type&&fe.hasVisibleVerticalOffset()}(ve)){const{screenLength:_e,minWorldLength:be,maxWorldLength:we}=ve.verticalOffset;fe.verticalOffset={screenLength:u$3E(_e),minWorldLength:be||0,maxWorldLength:null!=we?we:1/0}}return this._context.screenSizePerspectiveEnabled&&(fe.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),fe.occlusionTest=!has("enable-feature:non-occluded-hud"),fe.hasSlicePlane=this._context.slicePlaneEnabled,fe}_prepareResourcesPrimitive(fe,ve){const _e=this._getOutlineSize();if(ue$6(ve)&&0===_e)throw new Error("Nothing to render");if(this._outlineSize=_e,fe.color=this._getFillColor(),fe.outlineColor=this._getOutlineColor(),fe.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){const _e=this._context.sharedResources.textures.fromData(`${ve}-icon`,(()=>u$1I(ve)));this._textureHandle=_e,fe.textureId=_e.texture.id}fe.textureIsSignedDistanceField=!0,fe.sampleSignedDistanceFieldTexelCenter=a$1_(ve),fe.distanceFieldBoundingBox=hee;const be=this._getIconSize();this._size=[be,be],this._symbolTextureRatio=1/uee,this._createMaterialAndAddToStage(fe,this._context.stage)}async _prepareResourcesHref(fe,ve,_e){this._outlineSize=this._getOutlineSize(),fe.color=this._getFillColor(),fe.outlineColor=this._getOutlineColor(),fe.outlineSize=this._outlineSize,fe.textureIsSignedDistanceField=!1;const be=this._getIconSize(),we=be*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){const Se=await _$1s(this._context.sharedResources.textures.fromUrl(ve,we,{signal:_e}));if(!1===Se.ok)throw a$4D(Se.error),new Ir("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ve})`);this._textureHandle=Se.value;const Te=Se.value.texture;this._size=_e$4(Te,be),fe.textureId=Te.id}this._createMaterialAndAddToStage(fe,this._context.stage)}async _prepareResourcesCIM(fe,ve,_e){if(this._cimData=ve,!this._context.sharedResources.cimSymbolRasterizer){const fe=(await zt((async()=>{const{CIMSymbolRasterizer:fe}=await import("./CIMSymbolRasterizer-zQ9L0odH.js");return{CIMSymbolRasterizer:fe}}),[])).CIMSymbolRasterizer;s$4o(_e),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new fe(this._context.renderCoordsHelper.spatialReference))}const be=this._context.sharedResources.cimSymbolRasterizer,we=[],Se=ve,Te=null==Se?void 0:Se.symbol;Q8.fetchResources(Te,be.resourceManager,we,_e),Q8.fetchFonts(Te,be.resourceManager,we);const Ee=this._context.layer.fields?this._context.layer.fields.map((fe=>fe.toJSON())):[],Ce=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:Ce,fields:Ee,geometryType:"esriGeometryPoint"},(null==Se?void 0:Se.primitiveOverrides)&&we.push($9.createRenderExpressions(Se.primitiveOverrides,this._arcadeInfo)),we.length>0&&(await Promise.all(we),s$4o(_e)),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const fe=this._context.renderer;if(fe.scaleExpression){const ve=fe.scaleExpression,_e=await o$39(ve,this._context.layer.spatialReference,Ee);this._cimScaleFactorOrFunction=(fe,ve,be)=>{const we=s$1C(_e,fe,{$view:be},"esriGeometryPoint",ve);return null!==we?we:1}}}s$4o(_e),this._cimMaterialParametersInfo=fe,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){var fe,ve;return(null==(fe=this.symbolLayer.resource)?void 0:fe.href)?null:(null==(ve=this.symbolLayer.resource)?void 0:ve.primitive)??"circle"}_getOutlineSize(){var fe;let ve=0;const _e=this.symbolLayer;return null!=(null==(fe=_e.outline)?void 0:fe.size)?Math.max(u$3E(_e.outline.size),0):(ve=ue$6(this._getPrimitive())?1.5:0,Math.max(ve,0))}_getOutlineColor(){var fe;const ve=this._getLayerOpacity(),_e=this.symbolLayer,be=null==(fe=null==_e?void 0:_e.outline)?void 0:fe.color;if(null!=be){const fe=b_.toUnitRGB(be),_e=be.a*ve;return[fe[0],fe[1],fe[2],_e]}return[0,0,0,0]}_getFillColor(){var fe,ve;if(ue$6(this._getPrimitive()))return X9;const _e=null==this._getPrimitive(),be=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color;return this._getCombinedOpacityAndColor(be,{hasIntrinsicColor:_e})}_createMaterialAndAddToStage(fe,ve){if(this._cimData){this._fastUpdates=null;let _e=fe.textureId?this._cimSymbolMaterials.get(fe.textureId):null;return _e||(_e=new Pj(fe),this._cimSymbolMaterials.set(fe.textureId??0,_e),ve.add(_e)),_e}return this._fastUpdates=O$O(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(fe={...fe,...this._fastUpdates.materialParameters}),this._materials[0]=new Pj(fe),ve.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((fe=>{fe.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=e$4f(this._patchTask),this._forEachMaterial((fe=>this._context.stage.remove(fe))),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((fe=>this._context.stage.remove(fe))),this._cimSymbolTextures.clear(),this._textureHandle=t$4r(this._textureHandle)}_getScaleFactor(fe,ve){if(this._drivenProperties.size&&fe.size){for(let ve=0;ve<3;ve++){const _e=fe.size[ve];_e&&"symbol-value"!==_e&&"proportional"!==_e&&(fe.size[ve]=u$3E(_e))}if("symbol-value"===fe.size[0])return 1;if(isFinite(+fe.size[0]))return+fe.size[0]/ve;if(isFinite(+fe.size[2]))return+fe.size[2]/ve}return 1}createGraphics3DGraphic(fe){var ve;const _e=fe.graphic;if(!this._validateGeometry(_e.geometry))return null;let be,we=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const fe=this._generateTextureCIM(_e),ve={textureId:fe.id,...this._cimMaterialParametersInfo};be=this._createMaterialAndAddToStage(ve,this._context.stage);const Se=window.devicePixelRatio||1;we=[fe.parameters.width/Se,fe.parameters.height/Se]}else we=this._size,be=this._materials[0];const Se=f$1x(_e.geometry);if(null==Se)return this.logger.warn(`unsupported geometry type for icon symbol: ${_e.geometry.type}`),null;const Te=fe.renderingInfo,Ee=this._getVertexOpacityAndColor(Te);let Ce=1;if(!(null==(ve=this._fastUpdates)?void 0:ve.visualVariables.size)){const fe=we[0]>we[1]?we[0]:we[1];Ce=this._getScaleFactor(Te,fe)}Ce*=this._symbolTextureRatio;const Oe=r$36(we[0]*Ce,we[1]*Ce),Re=this.setGraphicElevationContext(_e);return this.ensureDrapedStatus("on-the-ground"===Re.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(_e,Se,be,Ee,Oe,fe.layer.uid):this._createAs3DShape(_e,Se,be,Ee,Oe,Re,_e.uid)}layerOpacityChanged(){const fe=this._getFillColor(),ve=this._getOutlineColor();this._forEachMaterial((_e=>{_e.setParameters({color:fe}),_e.setParameters({outlineColor:ve})}))}updateGeometry(fe,ve){if(this.draped||!this._validateGeometry(ve))return!1;const{elevationContext:_e,stageObject:be}=fe;if(_e.mode!==this.getGeometryElevationMode(ve))return!1;const we=f$1x(ve);if(!we)return!1;const Se=p$2j(be,this._context,we,_e);if(null==Se)return!1;const Te=d$1v(this._context,we);return be.geometries[0].localOrigin===Te&&(fe.alignedSampledElevation=Se,m$1M(fe,we,this._context.elevationProvider),!0)}layerElevationInfoChanged(fe,ve,_e){const be=this._elevationContext.mode,we=m$1X(he.elevationModeChangeTypes,_e,be);if(we!==EG.UPDATE)return we;const Se=d$1F(be)||"absolute-height"===be;return this.updateGraphics3DGraphicElevationInfo(fe,ve,(()=>Se))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((fe=>{fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(fe,ve){var _e;for(const be in fe.diff){if("visualVariables"!==be)return Hq.RecreateSymbol;if(!G$r(this._fastUpdates,ve,this._fastVisualVariableConvertOptions()))return Hq.RecreateSymbol;null==(_e=this._materials[0])||_e.setParameters(this._fastUpdates.materialParameters)}return Hq.FastUpdate}prepareSymbolLayerPatch(fe){var ve;if(null==(ve=this._patchTask)||ve.abort(),"partial"!==fe.diff.type)return;const _e=fe.diff.diff;this._preparePatchResource(fe,_e)}_preparePatchResource(fe,ve){var _e;if(!ve.resource||"partial"!==ve.resource.type)return;const be=ve.resource.diff;if("complete"!==(null==(_e=null==be?void 0:be.href)?void 0:_e.type))return;const we=be.href.newValue,{textures:Se}=this._context.sharedResources;if(null==we||null==Se||null!=de$5(we))return;const Te=this._getIconSize(),Ee=Te*this._context.graphicsCoreOwner.view.state.pixelRatio;fe.symbolLayerStatePatches.push((()=>{this._patchTask=e$4f(this._patchTask),this._patchTask=d$3e((fe=>this._context.schedule((async(fe,ve)=>{const _e=await _$1s(Se.fromUrl(we,Ee,{signal:ve}));s$4o(ve);const be=!_e.ok;if(be&&a$4D(_e.error),this._textureHandle=t$4r(this._textureHandle),this._patchTask=null,be){this._forEachMaterial((fe=>{fe.visible=!1,fe.setParameters({textureId:null})}));const fe=`Failed to load (Request for icon resource failed: ${we})`;return void this.logger.error(new Ir("graphics3diconsymbollayer:request-failed",fe))}this._textureHandle=_e.value;const Ce=_e.value.texture;this._size=_e$4(Ce,Te),this._forEachMaterial((fe=>{fe.setParameters({textureId:Ce.id}),fe.visible=!0}))}),fe)))})),delete be.href}_defaultElevationInfoNoZ(){return fee}_createAs3DShape(fe,ve,_e,be,we,Se,Te){const Ee=this.getFastUpdateAttrValues(fe),Ce=this._context.layer.uid,Oe=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Te,layerUid:Ce}),Re=ht$a(_e,cee,null,be,we,mee,null,Ee,Oe),De=a$2e(this._context,ve,Re,Se,Te);if(null==De)return null;const Be=new qG(this,De.object,[Re],null,null,p$2r,Se);return Be.alignedSampledElevation=De.sampledElevation,Be.needsElevationUpdates=d$1F(Se.mode)||"absolute-height"===Se.mode,Be.getScreenSize=this._createScreenSizeGetter(we,Ee),Be.calculateRelativeScreenBounds=fe=>_e.calculateRelativeScreenBounds(Be.getScreenSize(),1,fe),m$1M(Be,ve,this._context.elevationProvider),Be}_createAsOverlay(fe,ve,_e,be,we,Se){_e.renderPriority=this._renderPriority;const Te=[0,0,0];c$4l(ve,Te,this._context.overlaySR),Te[2]=-2;const Ee=this._context.clippingExtent;if(null!=Ee&&!y$1M(Ee,Te))return null;const Ce=this.getFastUpdateAttrValues(fe),Oe=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:fe.uid,layerUid:this._context.layer.uid}),Re=ht$a(_e,cee,Te,be,we,null,null,Ce,Oe),De=new lee(Re,{layerUid:Se,graphicUid:fe.uid}),Be=new Q9(this,[De],null,this._context.drapeSourceRenderer);return Be.getScreenSize=this._createScreenSizeGetter(we,Ce),Be.calculateRelativeScreenBounds=fe=>_e.calculateRelativeScreenBounds(Be.getScreenSize(),1,fe),Be}_createScreenSizeGetter(fe,ve){const _e=this._outlineSize+2;if(this._fastUpdates&&ve){const be=fe[0]/this._symbolTextureRatio,we=fe[1]/this._symbolTextureRatio;return(fe=[0,0])=>{const[Se,Te]=W$t(yee,this._fastUpdates.materialParameters,ve);return fe[0]=Se*be+_e,fe[1]=Te*we+_e,fe}}const be=fe[0]/this._symbolTextureRatio+_e,we=fe[1]/this._symbolTextureRatio+_e;return(fe=[0,0])=>(fe[0]=be,fe[1]=we,fe)}_fastVisualVariableConvertOptions(){const fe=Math.max(this._size[0],this._size[1]),ve=r$3y(fe,fe,fe),_e=e$3N(1),be=fe*_e,we=r$3y(be,be,be);return new BB({size:!0,color:!0,rotation:!0,opacity:!1},ve,we,_e)}_forEachMaterial(fe){this._materials.forEach(fe),this._cimSymbolMaterials.forEach(fe)}test(){return{...super.test(),material:this._materials[0]}}};function ue$6(fe){return null!=fe&&("cross"===fe||"x"===fe)}function de$5(fe){const ve=ot$i(fe);return"application/json"===(null==ve?void 0:ve.mediaType)?ve.data:void 0}function pe$6(fe,ve){return"relative"===fe?r$36((ve.x||0)+.5,.5-(ve.y||0)):fe in aee?aee[fe]:aee.center}function _e$4({parameters:fe},ve){const _e=(fe.width??1)/(fe.height??1);return _e>1?[ve,Math.round(ve/_e)]:[Math.round(ve*_e),ve]}pee.PRIMITIVE_SIZE=dee,pee.elevationModeChangeTypes={definedChanged:EG.UPDATE,staysOnTheGround:EG.NONE,onTheGroundChanged:EG.RECREATE};const fee={mode:"relative-to-ground",offset:0},mee=r$35(0,0,0,1),yee=[0,0,0];function n$1P(fe){switch(fe){case"butt":return FZ.BUTT;case"square":return FZ.SQUARE;case"round":return FZ.ROUND;default:return null}}function r$1b(fe){return"diamond"===fe?"kite":fe}function b$K(fe,ve,_e=null){const be=[],we=ve.mapPositions;!function g$U(fe,ve){const{attributeData:{position:_e},removeDuplicateStartEnd:be}=fe,we=function A$B(fe){const ve=fe.length;return fe[0]===fe[ve-3]&&fe[1]===fe[ve-2]&&fe[2]===fe[ve-1]}(_e)&&be,Se=_e.length/3-(we?1:0),Te=new Array(2*(Se-1)),Ee=we?_e.slice(0,-3):_e;let Ce=0;for(let Oe=0;Oe<Se-1;Oe++)Te[Ce++]=Oe,Te[Ce++]=Oe+1;ve.push([nO.POSITION,new Om(Ee,Te,3,we)])}(ve,be);const Se=be[0][1].data,Te=A$14(be[0][1].indices.length);return function h$W(fe,ve,_e){if(null!=fe.attributeData.colorFeature)return;const be=fe.attributeData.color;ve.push([nO.COLOR,new Om(be??$d,_e,4)])}(ve,be,Te),function j$F(fe,ve,_e){null==fe.attributeData.sizeFeature&&ve.push([nO.SIZE,new Om([fe.attributeData.size??1],_e,1,!0)])}(ve,be,Te),function T$u(fe,ve,_e){fe.attributeData.normal&&ve.push([nO.NORMAL,new Om(fe.attributeData.normal,_e,3)])}(ve,be,Te),function D$r(fe,ve,_e){null!=fe.attributeData.colorFeature&&ve.push([nO.COLORFEATUREATTRIBUTE,new Om([fe.attributeData.colorFeature],_e,1,!0)])}(ve,be,Te),function w$N(fe,ve,_e){null!=fe.attributeData.sizeFeature&&ve.push([nO.SIZEFEATUREATTRIBUTE,new Om([fe.attributeData.sizeFeature],_e,1,!0)])}(ve,be,Te),function y$Q(fe,ve,_e){null!=fe.attributeData.opacityFeature&&ve.push([nO.OPACITYFEATUREATTRIBUTE,new Om([fe.attributeData.opacityFeature],_e,1,!0)])}(ve,be,Te),function E$B(fe,ve,_e){if(null==fe.overlayInfo||fe.overlayInfo.renderCoordsHelper.viewingMode!==Wf.Global||!fe.overlayInfo.spatialReference.isGeographic)return;const be=t$2H(_e.length),we=s$45(fe.overlayInfo.spatialReference);for(let De=0;De<be.length;De+=3)H$14(_e,De,be,De,we);const Se=_e.length/3,Te=t$2G(Se+1);let Ee=gee,Ce=vee,Oe=0,Re=0;o$2R(Ee,be[Re++],be[Re++]),Re++,Te[0]=0;for(let De=1;De<Se+1;++De)De===Se&&(Re=0),o$2R(Ce,be[Re++],be[Re++]),Re++,Oe+=QC(Ee,Ce),Te[De]=Oe,[Ee,Ce]=[Ce,Ee];ve.push([nO.DISTANCETOSTART,new Om(Te,ve[0][1].indices,1,!0)])}(ve,be,Se),new pD(fe,be,we,eD.Line,_e)}const gee=[0,0],vee=[0,0];function R$w(fe,ve){if(null==fe||0===fe.length)return[];const _e=[];return fe.forEach((fe=>{const be=t$2H(3*fe.length);fe.forEach(((fe,ve)=>{be[3*ve]=fe[0],be[3*ve+1]=fe[1],be[3*ve+2]=fe[2]}));const we={attributeData:{position:be,normal:ve},removeDuplicateStartEnd:!1};_e.push(we)})),_e}function p$1Z(fe,ve,_e,be){const we="polygon"===fe.type?eY.CCW_IS_HOLE:eY.NONE,Se="polygon"===fe.type?fe.rings:fe.paths,{position:Te,outlines:Ee}=a$27(Se,!!fe.hasZ,we,fe.spatialReference),Ce=t$2H(Te.length),Oe=u$23(Te,fe.spatialReference,0,Ce,0,Te,0,Te.length/3,ve,_e,be),Re=null!=Oe;return{lines:Re?c$1K(Ee,Te,Ce):[],projectionSuccess:Re,sampledElevation:Oe}}function l$1J(fe,ve){const _e="polygon"===fe.type?eY.CCW_IS_HOLE:eY.NONE,be="polygon"===fe.type?fe.rings:fe.paths,{position:we,outlines:Se}=a$27(be,!1,_e),Te=n$49(we,fe.spatialReference,0,we,ve,0,we.length/3);for(let Ee=2;Ee<we.length;Ee+=3)we[Ee]=-2;return{lines:Te?c$1K(Se,we):[],projectionSuccess:Te}}function c$1K(fe,ve,_e=null){const be=new Array;for(const{index:we,count:Se}of fe){if(Se<=1)continue;const fe=3*we,Te=3*Se;be.push({position:a$2H(ve,3*we,3*Se),mapPositions:null!=_e?a$2H(_e,fe,Te):void 0})}return be}function C$t(fe){const ve=new gO,_e=fe.multipassEnabled&&fe.output===NI.Color,be=fe.space===tZ.World;ve.include(c$26,fe),ve.include(n$2e,fe);const{vertex:we,fragment:Se}=ve;return Se.include(a$32),d$1$(we,fe),ve.attributes.add(nO.POSITION,"vec3"),ve.attributes.add(nO.PREVPOSITION,"vec3"),ve.attributes.add(nO.UV0,"vec2"),ve.varyings.add("vColor","vec4"),ve.varyings.add("vpos","vec3"),ve.varyings.add("vUV","vec2"),ve.varyings.add("vSize","float"),_e&&ve.varyings.add("depth","float"),fe.hasTip&&ve.varyings.add("vLineWidth","float"),we.uniforms.add(new lO("nearFar",((fe,ve)=>ve.camera.nearFar)),new hO("viewport",((fe,ve)=>ve.camera.fullViewport))),we.code.add(o$2P`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),we.code.add(o$2P`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),be?(ve.attributes.add(nO.NORMAL,"vec3"),p$2Q(we),we.constants.add("tiltThreshold","float",.7),we.code.add(o$2P`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):we.code.add(o$2P`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),we.code.add(o$2P`
      #define vecN ${be?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${be?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${fe.anchor===rZ.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),fe.space===tZ.Screen&&(we.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix))),we.code.add(o$2P`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),we.code.add(o$2P`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),we.uniforms.add(new dO("perScreenPixelRatio",((fe,ve)=>ve.camera.perScreenPixelRatio))),we.code.add(o$2P`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${fe.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),w$1d(we),we.code.add(o$2P`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),be?(fe.hideOnShortSegments&&we.code.add(o$2P`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),we.code.add(o$2P`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(we.code.add(o$2P`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),fe.space===tZ.Screen&&we.code.add(o$2P`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),we.code.add(o$2P`
        ${_e?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${be?"":"vUV *= displacedPosScreen.w;"}

        ${fe.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),_e&&ve.include(a$2L,fe),ve.include(P$H,fe),Se.uniforms.add(new hO("intrinsicColor",(fe=>fe.color)),new CO("tex",(fe=>fe.markerTexture))),Se.include(e$2S),ve.constants.add("texelSize","float",1/IZ),Se.code.add(o$2P`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),fe.hasTip&&(ve.constants.add("relativeMarkerSize","float",LZ/IZ),ve.constants.add("relativeTipLineWidth","float",.25),Se.code.add(o$2P`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${be?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),ve.constants.add("symbolAlphaCutoff","float",yj),Se.code.add(o$2P`
  void main() {
    discardBySlice(vpos);
    ${_e?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${be?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${fe.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${fe.output===NI.Color?o$2P`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${fe.output===NI.Color&&fe.transparencyPassType===WR.ColorAlpha?o$2P`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${fe.output===NI.Highlight?o$2P`fragColor = vec4(1.0);`:""}
  }
  `),ve}const _ee=Object.freeze(Object.defineProperty({__proto__:null,build:C$t},Symbol.toStringTag,{value:"Module"})),$ee=new Map([[nO.POSITION,0],[nO.PREVPOSITION,1],[nO.UV0,2],[nO.NORMAL,3],[nO.COLOR,4],[nO.COLORFEATUREATTRIBUTE,4],[nO.SIZE,5],[nO.SIZEFEATUREATTRIBUTE,5],[nO.OPACITYFEATUREATTRIBUTE,6]]);let bee=class R2 extends fA{initializeProgram(fe){return new gA(fe.rctx,R2.shader.get().build(this.configuration),$ee)}_makePipelineState(fe,ve){const _e=this.configuration,be=fe===WR.NONE;return S$1g({blending:_e.output===NI.Color?be?_j:c$2o(fe):null,depthTest:_e.space===tZ.Draped?null:{func:f$1O(fe)},depthWrite:_e.space===tZ.Draped?null:be?_e.writeDepth?OA:null:l$2s(fe),drawBuffers:_e.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e.hasOccludees?qH:null,stencilTest:_e.hasOccludees?ve?ZH:YH:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=S$1g({blending:_j,depthTest:HH,depthWrite:null,colorWrite:AA,stencilWrite:null,stencilTest:JH}),this._occluderPipelineOpaque=S$1g({blending:_j,depthTest:HH,depthWrite:null,colorWrite:AA,stencilWrite:WH,stencilTest:XH}),this._occluderPipelineMaskWrite=S$1g({blending:null,depthTest:GH,depthWrite:null,colorWrite:null,stencilWrite:qH,stencilTest:ZH})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(fe,ve,_e){return fe?this._occludeePipelineState:this.configuration.occluder?_e?this._occluderPipelineTransparent:ve?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};bee.shader=new LO(_ee,(()=>zt((()=>Promise.resolve().then((()=>dRe))),void 0)));let wee=class O6 extends QB{constructor(fe){super(fe,new See),this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>fe===NI.Highlight||i$2J(fe)&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.OPAQUE_NO_SSAO_DEPTH,fe=>g$1A(fe)],[qR.OCCLUDER_MATERIAL,fe=>l$2R(fe)&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.TRANSPARENT_OCCLUDER_MATERIAL,fe=>l$2R(fe)&&this.parameters.renderOccluded===ej.OccludeAndTransparentStencil],[qR.TRANSPARENT_MATERIAL,fe=>i$2J(fe)&&this.parameters.writeDepth],[qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,fe=>i$2J(fe)&&!this.parameters.writeDepth],[qR.DRAPED_MATERIAL,fe=>fe===NI.Color||fe===NI.Highlight]]),this._vertexAttributeLocations=$ee,this._configuration=new iZ,this._layout=this.createLayout()}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.space=ve.slot===qR.DRAPED_MATERIAL?tZ.Draped:this.parameters.worldSpace?tZ.World:tZ.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==FZ.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===ej.OccludeAndTransparentStencil,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const fe=H$J().vec3f(nO.POSITION).vec3f(nO.PREVPOSITION).vec2f(nO.UV0);return this.parameters.worldSpace&&fe.vec3f(nO.NORMAL),this.parameters.vvSize?fe.f32(nO.SIZEFEATUREATTRIBUTE):fe.f32(nO.SIZE),this.parameters.vvColor?fe.f32(nO.COLORFEATUREATTRIBUTE):fe.vec4f(nO.COLOR),this.parameters.vvOpacity&&fe.f32(nO.OPACITYFEATUREATTRIBUTE),fe}createBufferWriter(){return new Tee(this._layout,this.parameters)}createGLMaterial(fe){return new xee(fe)}},xee=class S5 extends fM{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(fe){const ve=this._material.parameters.markerPrimitive;return ve!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(ve,this._markerPrimitive)}),this._markerPrimitive=ve),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(bee,fe)}_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){return this._output===NI.Color&&this._updateOccludeeState(fe),this._updateParameters(fe)}},See=class g14 extends pj{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=FZ.BUTT,this.anchor=rZ.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Tee=class R3{constructor(fe,ve){this.vertexBufferLayout=fe,this._parameters=ve}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(fe,ve,_e,be,we){const Se=_e.attributes.get(nO.POSITION).data,Te=Se.length/3;let Ee=[1,0,0];const Ce=_e.attributes.get(nO.NORMAL);this._parameters.worldSpace&&null!=Ce&&(Ee=Ce.data);let Oe=1,Re=0;this._parameters.vvSize?Re=_e.attributes.get(nO.SIZEFEATUREATTRIBUTE).data[0]:_e.attributes.has(nO.SIZE)&&(Oe=_e.attributes.get(nO.SIZE).data[0]);let De=[1,1,1,1],Be=0;this._parameters.vvColor?Be=_e.attributes.get(nO.COLORFEATUREATTRIBUTE).data[0]:_e.attributes.has(nO.COLOR)&&(De=_e.attributes.get(nO.COLOR).data);let Ze=0;this._parameters.vvOpacity&&(Ze=_e.attributes.get(nO.OPACITYFEATUREATTRIBUTE).data[0]);const Xe=new Float32Array(be.buffer);let Je=we*(this.vertexBufferLayout.stride/4);const v17=(fe,ve,_e,be)=>{if(Xe[Je++]=fe[0],Xe[Je++]=fe[1],Xe[Je++]=fe[2],Xe[Je++]=ve[0],Xe[Je++]=ve[1],Xe[Je++]=ve[2],Xe[Je++]=_e[0],Xe[Je++]=_e[1],this._parameters.worldSpace&&(Xe[Je++]=Ee[0],Xe[Je++]=Ee[1],Xe[Je++]=Ee[2]),this._parameters.vvSize?Xe[Je++]=Re:Xe[Je++]=Oe,this._parameters.vvColor)Xe[Je++]=Be;else{const fe=Math.min(4*be,De.length-4);Xe[Je++]=De[fe],Xe[Je++]=De[fe+1],Xe[Je++]=De[fe+2],Xe[Je++]=De[fe+3]}this._parameters.vvOpacity&&(Xe[Je++]=Ze)};let Qe;!function(fe){fe[fe.ASCENDING=1]="ASCENDING",fe[fe.DESCENDING=-1]="DESCENDING"}(Qe||(Qe={}));const S14=(ve,_e)=>{const be=o$44(Eee,Se[3*ve],Se[3*ve+1],Se[3*ve+2]),we=Pee;let Ee=ve+_e;do{o$44(we,Se[3*Ee],Se[3*Ee+1],Se[3*Ee+2]),Ee+=_e}while(H$19(be,we)&&Ee>=0&&Ee<Te);fe&&(O$1v(be,be,fe),O$1v(we,we,fe)),v17(be,we,[-1,-1],ve),v17(be,we,[1,-1],ve),v17(be,we,[1,1],ve),v17(be,we,[-1,-1],ve),v17(be,we,[1,1],ve),v17(be,we,[-1,1],ve)},dt=this._parameters.placement;"begin"!==dt&&"begin-end"!==dt||S14(0,Qe.ASCENDING),"end"!==dt&&"begin-end"!==dt||S14(Te-1,Qe.DESCENDING)}};const Eee=[0,0,0],Pee=[0,0,0],Cee={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Oee={dash:Cee.dash,"dash-dot":[...Cee.dash,...Cee.dot],dot:Cee.dot,"long-dash":Cee["long-dash"],"long-dash-dot":[...Cee["long-dash"],...Cee.dot],"long-dash-dot-dot":[...Cee["long-dash"],...Cee.dot,...Cee.dot],none:null,"short-dash":Cee["short-dash"],"short-dash-dot":[...Cee["short-dash"],...Cee["short-dot"]],"short-dash-dot-dot":[...Cee["short-dash"],...Cee["short-dot"],...Cee["short-dot"]],"short-dot":Cee["short-dot"],solid:null},Aee=8;function h$V(fe){return{pattern:[fe,fe],pixelRatio:2}}function n$1O(fe){return null!=fe&&"style"===fe.type?function l$1I(fe){return null!=fe?function s$1y(fe,ve){return null==fe?fe:{pattern:fe.slice(),pixelRatio:ve}}(Oee[fe],Aee):null}(fe.style):null}const Mee=["polyline","polygon","extent"],Ree=new BB({size:!0,color:!0,rotation:!1,opacity:!0});let Iee=class O7 extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be)}async doLoad(){if(this._fastUpdates=O$O(this._context.renderer,Ree),!this._drivenProperties.size&&(null!=this.symbolLayer.size?this.symbolLayer.size:e$3N(1))<0)throw new Ir("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(fe,ve=!1){var _e,be;const we=this._getCombinedOpacityAndColor(ve&&this._markerColor||this._materialColor);this._patternHidesLine&&!ve&&(we[3]=0);const Se={width:this._computeMaterialWidth(null==(_e=this.symbolLayer)?void 0:_e.size),color:we,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:n$1P(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:fe,stipplePattern:n$1O(this.symbolLayer.pattern)};return(null==(be=this._fastUpdates)?void 0:be.visualVariables)?{...Se,...this._fastUpdates.materialParameters}:Se}get _materialColor(){var fe;return null==(fe=this.symbolLayer.material)?void 0:fe.color}get _markerColor(){var fe;return null==(fe=this.symbolLayer.marker)?void 0:fe.color}get _lineMaterial(){return null==this._materials[Dee.Line]&&(this._materials[Dee.Line]=new GZ(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[Dee.Line])),this._materials[Dee.Line]}get _ringMaterial(){return null==this._materials[Dee.Ring]&&(this._materials[Dee.Ring]=new GZ(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[Dee.Ring])),this._materials[Dee.Ring]}get _wireframeLineMaterial(){return null==this._materials[Dee.LineWireframe]&&(this._materials[Dee.LineWireframe]=new GZ({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[Dee.LineWireframe])),this._materials[Dee.LineWireframe]}get _wireframeRingMaterial(){return null==this._materials[Dee.RingWireframe]&&(this._materials[Dee.RingWireframe]=new GZ({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[Dee.RingWireframe])),this._materials[Dee.RingWireframe]}get _markerMaterial(){return null==this._materials[Dee.Marker]&&null!=this.symbolLayer.marker&&(this._materials[Dee.Marker]=new wee({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:r$1b(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[Dee.Marker])),this._materials[Dee.Marker]}destroy(){super.destroy(),this._forEachMaterial((fe=>this._context.stage.remove(fe))),this._materials.length=0}_getDrivenSize(fe){return this._drivenProperties.size&&fe.size?u$3E(function s$28(fe){for(let ve=0;ve<3;ve++){const _e=fe[ve];if("number"==typeof _e)return isFinite(_e)?_e:0}return 0}(fe.size)):1}_getDrivenColor(fe){const ve=r$35(1,1,1,1);return this._drivenProperties.color&&fe.color&&(ve[0]=fe.color[0],ve[1]=fe.color[1],ve[2]=fe.color[2],fe.color.length>0&&(ve[3]=fe.color[3])),this._drivenProperties.opacity&&fe.opacity&&(ve[3]=fe.opacity),ve}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,Mee,this.symbolLayer.type))return null;const _e=this.setGraphicElevationContext(ve);return this.ensureDrapedStatus("on-the-ground"===_e.mode),this.draped?this._createAsOverlay(fe,this._context.layer.uid):this._createAs3DShape(fe,_e,ve.uid)}applyRendererDiff(fe,ve){for(const _e in fe.diff){if("visualVariables"!==_e)return Hq.RecreateSymbol;{const fe=this._fastUpdates;if(!G$r(fe,ve,Ree))return Hq.RecreateSymbol;this._forEachMaterial((ve=>null==ve?void 0:ve.setParameters(fe.materialParameters)))}}return Hq.FastUpdate}prepareSymbolLayerPatch(fe){var ve,_e;if("partial"!==fe.diff.type)return;const be=fe.diff.diff,we={};"complete"===(null==(ve=be.size)?void 0:ve.type)&&(we.width=this._computeMaterialWidth(be.size.newValue),delete be.size),"complete"===(null==(_e=be.cap)?void 0:_e.type)&&(we.cap=n$1P(be.cap.newValue??"butt"),delete be.cap);const Se=this._prepareMarkerPatch(fe,be);this._prepareMaterialPatch(fe,be,Se),fe.symbolLayerStatePatches.push((()=>this._forEachMaterial((fe=>null==fe?void 0:fe.setParameters(we)))))}layerOpacityChanged(){this._forEachMaterial(((fe,ve)=>this._updateMaterialLayerOpacity(fe,ve===Dee.Marker)))}_forEachMaterial(fe){this._materials.forEach(fe)}_updateMaterialLayerOpacity(fe,ve=!1){var _e,be;if(null==fe)return;const we=fe.parameters.color,Se=null==(be=null==(_e=this.symbolLayer)?void 0:_e.material)?void 0:be.color,Te=this._patternHidesLine&&!ve?0:this._getCombinedOpacity(Se),Ee=r$35(we[0],we[1],we[2],Te);fe.setParameters({color:Ee})}layerElevationInfoChanged(fe,ve,_e){const be=this._elevationContext.mode,we=m$1X(O7.elevationModeChangeTypes,_e,be);if(we!==EG.UPDATE)return we;const Se=d$1F(be);return this.updateGraphics3DGraphicElevationInfo(fe,ve,(()=>Se))}slicePlaneEnabledChanged(){const fe={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((ve=>null==ve?void 0:ve.setParameters(fe))),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(fe,ve,_e){const be=V$u(fe.graphic.geometry),we="polygon"===be.type?be.rings:be.paths,Se=new Array,Te=i$3t(),Ee=p$1Z(be,this._context.elevationProvider,this._context.renderCoordsHelper,ve),Ce="polygon"===be.type?"rings":"paths";this._logGeometryCreationWarnings(Ee,we,Ce,"LineSymbol3DLayer");for(let De=0;De<Ee.lines.length;De++){const ve=Ee.lines[De],we=ve.position,Ce=ve.mapPositions;if(null!=this._context.clippingExtent&&(P$$(Te),c$3A(Te,Ce),!V$W(Te,this._context.clippingExtent)))continue;const Oe=this._createGeometry("polygon"===be.type?this._ringMaterial:this._lineMaterial,fe,we,Ce,be.type,Lee.ELEVATED,_e);Se.push(Oe),_B.LINE_WIREFRAMES&&Se.push(Oe.instantiate({material:"polygon"===be.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&Se.push(Oe.instantiate({material:this._markerMaterial}))}if(0===Se.length)return null;const Oe=new Qq({geometries:Se,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:_e}),Re=new qG(this,Oe,Se,null,null,I$R,ve);return Re.alignedSampledElevation=Ee.sampledElevation,Re.needsElevationUpdates=d$1F(ve.mode),Re}_createGeometry(fe,ve,_e,be,we,Se,Te){var Ee,Ce,Oe;const Re=Se===Lee.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,De="polygon"===we,Be=null==(Ee=this._fastUpdates)?void 0:Ee.visualVariables.color,Ze=null==(Ce=this._fastUpdates)?void 0:Ce.visualVariables.size,Xe=null==(Oe=this._fastUpdates)?void 0:Oe.visualVariables.opacity,Je=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Te,layerUid:this._context.layer.uid});return b$K(fe,{overlayInfo:Re,removeDuplicateStartEnd:De,mapPositions:be,attributeData:{position:_e,size:Ze?null:this._getDrivenSize(ve.renderingInfo),color:Be?null:this._getDrivenColor(ve.renderingInfo),sizeFeature:Ze?X$h(Ze.field,ve.graphic):null,colorFeature:Be?X$h(Be.field,ve.graphic):null,opacityFeature:Xe?X$h(Xe.field,ve.graphic):null}},Je)}_createAsOverlay(fe,ve){const _e=fe.graphic,be=V$u(_e.geometry),we="polygon"===be.type?be.rings:be.paths,Se="polygon"===be.type?this._ringMaterial:this._lineMaterial;Se.renderPriority=this._renderPriority;const Te=_B.LINE_WIREFRAMES?"polygon"===be.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,Ee=this._markerMaterial;null!=Te&&(Te.renderPriority=this._renderPriority-.001),null!=Ee&&(Ee.renderPriority=this._renderPriority-.002);const Ce=new Array,Oe=i$3t(),Re=P$$(),De=l$1J(be,this._context.overlaySR),Be="polygon"===be.type?"rings":"paths";this._logGeometryCreationWarnings(De,we,Be,"LineSymbol3DLayer");for(const Ze of De.lines){if(P$$(Oe),c$3A(Oe,Ze.position),!V$W(Oe,this._context.clippingExtent))continue;o$35(Re,Oe);const a56=we=>{const Se=this._createGeometry(we,fe,Ze.position,void 0,be.type,Lee.DRAPED,_e.uid),Te=new lee(Se,{layerUid:ve,graphicUid:_e.uid});Ce.push(Te)};if(null!=Ee){a56(Ee);const fe=this.symbolLayer.marker.placement;"begin"!==fe&&"begin-end"!==fe||c$3A(Oe,Ze.position,0,1),"end"!==fe&&"begin-end"!==fe||c$3A(Oe,Ze.position,Ze.position.length-3,1)}a56(Se),_B.LINE_WIREFRAMES&&a56(Te)}return new Q9(this,Ce,Re,this._context.drapeSourceRenderer)}get _patternHidesLine(){const fe=this.symbolLayer.pattern;return null!=fe&&"style"===fe.type&&"none"===fe.style}_computeMaterialWidth(fe){var ve;return fe=fe??e$3N(1),this._drivenProperties.size?(null==(ve=this._fastUpdates)?void 0:ve.visualVariables.size)?u$3E(1):1:u$3E(fe)}_prepareMaterialPatch(fe,ve,_e){var be,we;const Se=ve.material;if(null==Se)return void(_e.changed&&_e.useMaterialColor&&I$z(this._getCombinedOpacityAndColor(this._materialColor),this._materials[Dee.Marker],fe));if("collection"===Se.type)return;const Te="complete"===Se.type?null==(be=Se.newValue)?void 0:be.color:"complete"===(null==(we=Se.diff.color)?void 0:we.type)?Se.diff.color.newValue:null,Ee=this._getCombinedOpacityAndColor(Te);_e.useMaterialColor&&I$z(t$3J(Ee),this._materials[Dee.Marker],fe),this._patternHidesLine&&(Ee[3]=0),I$z(Ee,this._materials[Dee.Line],fe),delete ve.material}_prepareMarkerPatch(fe,ve){var _e;const be=ve.marker,we=this._markerMaterial;if(null==be||"partial"!==be.type||null==be.diff||null!=be.diff.placement||null!=be.diff.style&&"complete"!==be.diff.style.type||null!=be.diff.color&&"complete"!==be.diff.color.type||null==we)return{changed:!1,useMaterialColor:null==this._markerColor};const Se=be.diff.color,Te=null!=Se,Ee=Te?Se.newValue:null,Ce=null==Ee&&null==this._markerColor;Ee&&I$z(this._getCombinedOpacityAndColor(Ee),we,fe);const Oe=null==(_e=be.diff.style)?void 0:_e.newValue;return Oe&&fe.symbolLayerStatePatches.push((()=>we.setParameters({markerPrimitive:r$1b(Oe)}))),delete ve.marker,{changed:Te,useMaterialColor:Ce}}};function V$u(fe){switch(fe.type){case"extent":if(fe instanceof aa)return wa.fromExtent(fe);break;case"polygon":case"polyline":return fe}return null}function I$z(fe,ve,_e){null!=ve&&_e.symbolLayerStatePatches.push((()=>ve.setParameters({color:fe})))}var Lee,Dee;Iee.elevationModeChangeTypes={definedChanged:EG.RECREATE,staysOnTheGround:EG.NONE,onTheGroundChanged:EG.RECREATE},function(fe){fe[fe.DRAPED=0]="DRAPED",fe[fe.ELEVATED=1]="ELEVATED"}(Lee||(Lee={})),function(fe){fe[fe.Line=0]="Line",fe[fe.Ring=1]="Ring",fe[fe.LineWireframe=2]="LineWireframe",fe[fe.RingWireframe=3]="RingWireframe",fe[fe.Marker=4]="Marker"}(Dee||(Dee={}));let Nee=null,Fee=!0;function s$1x(fe,ve,_e){if(!fe||!ve)throw new Error("Cannot construct image data without dimensions");if(Fee)try{return new ImageData(fe,ve)}catch(GC){Fee=!1}return m$1m(fe,ve,_e)}function m$1m(fe,ve,_e){return _e||(_e=function f$15(){return Nee||(Nee=document.createElement("canvas"),Nee.width=1,Nee.height=1),Nee}()),_e.getContext("2d").createImageData(fe,ve)}async function p$1Y(fe,ve){const{arrayBuffer:_e,mediaType:be}=await async function d$1a(fe,ve){var _e;const be=ot$i(fe);if(null==be?void 0:be.isBase64)return{arrayBuffer:t$41(be.data),mediaType:be.mediaType};const we=await U$1a(fe,{responseType:"array-buffer",...ve});return{arrayBuffer:we.data,mediaType:(null==(_e=we.getHeader)?void 0:_e.call(we,"Content-Type"))??""}}(fe,ve),we="image/png"===be;if("image/gif"===be){const{isAnimatedGIF:fe,parseGif:be}=await zt((()=>import("./gif-CutdzmSz.js")),[]);if(fe(_e))return be(_e,ve)}if(we){const{isAnimatedPNG:fe,parseApng:be}=await zt((()=>import("./apng-BsxBoZZM.js")),[]);if(fe(_e))return be(_e,ve)}return async function u$1q(fe,ve){const _e=window.URL.createObjectURL(fe);try{const{data:fe}=await U$1a(_e,{...ve,responseType:"image"});return fe}catch(xv){if(!b$2g(xv))throw new Ir("invalid-image",`Could not fetch requested image at ${_e}`);throw xv}finally{window.URL.revokeObjectURL(_e)}}(new Blob([_e],{type:be}),ve)}var zee;const kee=new WeakMap;let Uee=0,Vee=zee=class extends Pn{constructor(fe){super(fe),this.wrap="repeat"}get url(){return this._get("url")||null}set url(fe){this._set("url",fe),fe&&this._set("data",null)}get data(){return this._get("data")||null}set data(fe){this._set("data",fe),fe&&this._set("url",null)}writeData(fe,ve,_e,be){if(fe instanceof HTMLImageElement){const we={type:"image-element",src:m$2_(fe.src,be),crossOrigin:fe.crossOrigin};ve[_e]=we}else if(fe instanceof HTMLCanvasElement){const be={type:"canvas-element",imageData:m$1l(fe.getContext("2d").getImageData(0,0,fe.width,fe.height))};ve[_e]=be}else if(fe instanceof HTMLVideoElement){const we={type:"video-element",src:m$2_(fe.src,be),autoplay:fe.autoplay,loop:fe.loop,muted:fe.muted,crossOrigin:fe.crossOrigin,preload:fe.preload};ve[_e]=we}else if(fe instanceof ImageData){const be={type:"image-data",imageData:m$1l(fe)};ve[_e]=be}}readData(fe){switch(fe.type){case"image-element":{const ve=new Image;return ve.src=fe.src,ve.crossOrigin=fe.crossOrigin,ve}case"canvas-element":{const ve=g$S(fe.imageData),_e=document.createElement("canvas");return _e.width=ve.width,_e.height=ve.height,_e.getContext("2d").putImageData(ve,0,0),_e}case"image-data":return g$S(fe.imageData);case"video-element":{const ve=document.createElement("video");return ve.src=fe.src,ve.crossOrigin=fe.crossOrigin,ve.autoplay=fe.autoplay,ve.loop=fe.loop,ve.muted=fe.muted,ve.preload=fe.preload,ve}default:return}}get transparent(){const fe=this.data,ve=this.url;if(fe instanceof HTMLCanvasElement)return f$14(fe.getContext("2d").getImageData(0,0,fe.width,fe.height));if(fe instanceof ImageData)return f$14(fe);if(ve){const fe=ve.substr(ve.length-4,4).toLowerCase(),_e=ve.substr(0,15).toLocaleLowerCase();if(".png"===fe||"data:image/png;"===_e)return!0}return!1}set transparent(fe){this._overrideIfSome("transparent",fe)}get contentHash(){const fe="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e76=(ve="")=>`d:${ve},t:${this.transparent},w:${fe}`;return null!=this.url?e76(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e76(this.data.src):(kee.has(this.data)||kee.set(this.data,++Uee),e76(kee.get(this.data))):e76()}get memoryUsage(){let fe=0;if(fe+=null!=this.url?this.url.length:0,null!=this.data){const ve=this.data;"data"in ve?fe+=ve.data.byteLength:ve instanceof HTMLImageElement?fe+=ve.naturalWidth*ve.naturalHeight*3:ve instanceof HTMLCanvasElement&&(fe+=ve.width*ve.height*3)}return fe}clone(){const fe={url:this.url,data:this.data,wrap:this._cloneWrap()};return new zee(fe)}cloneWithDeduplication(fe){const ve=fe.get(this);if(ve)return ve;const _e=this.clone();return fe.set(this,_e),_e}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(fe){return"string"==typeof fe?new zee({url:fe}):fe instanceof HTMLImageElement||fe instanceof HTMLCanvasElement||fe instanceof ImageData||fe instanceof HTMLVideoElement?new zee({data:fe}):g$2C(zee,fe)}};function m$1l(fe){let ve="";for(let _e=0;_e<fe.data.length;_e++)ve+=String.fromCharCode(fe.data[_e]);return{data:btoa(ve),width:fe.width,height:fe.height}}function g$S(fe){const ve=atob(fe.data),_e=new Uint8ClampedArray(ve.length);for(let be=0;be<ve.length;be++)_e[be]=ve.charCodeAt(be);return function c$1J(fe,ve,_e,be){if(!ve||!_e)throw new Error("Cannot construct image data without dimensions");if(Fee)try{return new ImageData(fe,ve,_e)}catch(br){Fee=!1}const we=m$1m(ve,_e,be);return we.data.set(fe,0),we}(_e,fe.width,fe.height)}function f$14(fe){for(let ve=3;ve<fe.data.length;ve+=4)if(255!==fe.data[ve])return!0;return!1}e$4o([y$2v({type:String,json:{write:f$2v}})],Vee.prototype,"url",null),e$4o([y$2v({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),y$2v()],Vee.prototype,"data",null),e$4o([r$3s("data")],Vee.prototype,"writeData",null),e$4o([o$40("data")],Vee.prototype,"readData",null),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Vee.prototype,"transparent",null),e$4o([y$2v({json:{write:!0}})],Vee.prototype,"wrap",void 0),e$4o([y$2v({readOnly:!0})],Vee.prototype,"contentHash",null),Vee=zee=e$4o([a$4y("esri.geometry.support.MeshTexture")],Vee);const Bee=Vee;let jee=class p28 extends(i$4F(Pn)){constructor(fe){super(fe),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};e$4o([y$2v({type:[Number],nonNullable:!0,json:{write:!0}})],jee.prototype,"offset",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0}})],jee.prototype,"rotation",void 0),e$4o([y$2v({type:[Number],nonNullable:!0,json:{write:!0}})],jee.prototype,"scale",void 0),jee=e$4o([a$4y("esri.geometry.support.MeshTextureTransform")],jee);const Gee=jee;var Hee;let qee=Hee=class extends Pn{constructor(fe){super(fe),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(fe,ve){const _e=null!=fe?fe.get(this):null;if(_e)return _e;const be=new Hee(this.clonePropertiesWithDeduplication(ve));return null!=fe&&fe.set(this,be),be}clonePropertiesWithDeduplication(fe){var ve,_e,be,we;return{color:null!=this.color?this.color.clone():null,colorTexture:null==(ve=this.colorTexture)?void 0:ve.cloneWithDeduplication(fe),normalTexture:null==(_e=this.normalTexture)?void 0:_e.cloneWithDeduplication(fe),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:null==(be=this.colorTextureTransform)?void 0:be.clone(),normalTextureTransform:null==(we=this.normalTextureTransform)?void 0:we.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let fe=0;return fe+=null!=this.color?16:0,null!=this.colorTexture&&(fe+=this.colorTexture.memoryUsage),fe+=null!=this.colorTextureTransform?20:0,null!=this.normalTexture&&(fe+=this.normalTexture.memoryUsage),fe+=null!=this.normalTextureTransform?20:0,fe}};e$4o([y$2v({type:b_,json:{write:!0}})],qee.prototype,"color",void 0),e$4o([y$2v({type:Bee,json:{write:!0}})],qee.prototype,"colorTexture",void 0),e$4o([y$2v({type:Gee,json:{write:!0}})],qee.prototype,"colorTextureTransform",void 0),e$4o([y$2v({type:Bee,json:{write:!0}})],qee.prototype,"normalTexture",void 0),e$4o([y$2v({type:Gee,json:{write:!0}})],qee.prototype,"normalTextureTransform",void 0),e$4o([y$2v({nonNullable:!0,json:{write:!0}})],qee.prototype,"alphaMode",void 0),e$4o([y$2v({nonNullable:!0,json:{write:!0}})],qee.prototype,"alphaCutoff",void 0),e$4o([y$2v({nonNullable:!0,json:{write:!0}})],qee.prototype,"doubleSided",void 0),qee=Hee=e$4o([a$4y("esri.geometry.support.MeshMaterial")],qee);const Wee=qee;var Yee;let Zee=Yee=class extends Wee{constructor(fe){super(fe),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(fe,ve){const _e=null!=fe?fe.get(this):null;if(_e)return _e;const be=new Yee(this.clonePropertiesWithDeduplication(ve));return null!=fe&&fe.set(this,be),be}getMemoryUsage(){let fe=super.getMemoryUsage();return fe+=null!=this.emissiveColor?16:0,null!=this.emissiveTexture&&(fe+=this.emissiveTexture.memoryUsage),fe+=null!=this.emissiveTextureTransform?20:0,null!=this.occlusionTexture&&(fe+=this.occlusionTexture.memoryUsage),fe+=null!=this.occlusionTextureTransform?20:0,null!=this.metallicRoughnessTexture&&(fe+=this.metallicRoughnessTexture.memoryUsage),fe+=null!=this.metallicRoughnessTextureTransform?20:0,fe}clonePropertiesWithDeduplication(fe){var ve,_e,be,we,Se,Te,Ee;return{...super.clonePropertiesWithDeduplication(fe),emissiveColor:null==(ve=this.emissiveColor)?void 0:ve.clone(),emissiveTexture:null==(_e=this.emissiveTexture)?void 0:_e.cloneWithDeduplication(fe),emissiveTextureTransform:null==(be=this.emissiveTextureTransform)?void 0:be.clone(),occlusionTexture:null==(we=this.occlusionTexture)?void 0:we.cloneWithDeduplication(fe),occlusionTextureTransform:null==(Se=this.occlusionTextureTransform)?void 0:Se.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:null==(Te=this.metallicRoughnessTexture)?void 0:Te.cloneWithDeduplication(fe),metallicRoughnessTextureTransform:null==(Ee=this.metallicRoughnessTextureTransform)?void 0:Ee.clone()}}};e$4o([y$2v({type:b_,json:{write:!0}})],Zee.prototype,"emissiveColor",void 0),e$4o([y$2v({type:Bee,json:{write:!0}})],Zee.prototype,"emissiveTexture",void 0),e$4o([y$2v({type:Gee,json:{write:!0}})],Zee.prototype,"emissiveTextureTransform",void 0),e$4o([y$2v({type:Bee,json:{write:!0}})],Zee.prototype,"occlusionTexture",void 0),e$4o([y$2v({type:Gee,json:{write:!0}})],Zee.prototype,"occlusionTextureTransform",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zee.prototype,"metallic",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zee.prototype,"roughness",void 0),e$4o([y$2v({type:Bee,json:{write:!0}})],Zee.prototype,"metallicRoughnessTexture",void 0),e$4o([y$2v({type:Gee,json:{write:!0}})],Zee.prototype,"metallicRoughnessTextureTransform",void 0),Zee=Yee=e$4o([a$4y("esri.geometry.support.MeshMaterialMetallicRoughness")],Zee);const Xee=Zee;var Jee;let Qee=Jee=class extends Pn{constructor(fe){super(fe),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(fe){return c$1H(fe,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},ar.getLogger(this))}castPosition(fe){return fe&&fe instanceof Float32Array&&ar.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),c$1H(fe,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},ar.getLogger(this))}castUv(fe){return c$1H(fe,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},ar.getLogger(this))}castNormal(fe){return c$1H(fe,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},ar.getLogger(this))}castTangent(fe){return c$1H(fe,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},ar.getLogger(this))}clone(){const fe={position:a$4H(this.position),uv:a$4H(this.uv),normal:a$4H(this.normal),tangent:a$4H(this.tangent),color:a$4H(this.color)};return new Jee(fe)}clonePositional(){const fe={position:a$4H(this.position),normal:a$4H(this.normal),tangent:a$4H(this.tangent),uv:this.uv,color:this.color};return new Jee(fe)}get memoryUsage(){let fe=0;return fe+=this.position.byteLength,null!=this.uv&&(fe+=this.uv.byteLength),null!=this.normal&&(fe+=this.normal.byteLength),null!=this.tangent&&(fe+=this.tangent.byteLength),null!=this.color&&(fe+=this.color.byteLength),fe}};function g$R(fe,ve,_e,be){const{loggerTag:we,stride:Se}=ve;return fe.length%Se!=0?(be.error(we,`Invalid array length, expected a multiple of ${Se}`),new _e([])):fe}function c$1H(fe,ve,_e,be,we){if(!fe)return fe;if(fe instanceof ve)return g$R(fe,be,ve,we);for(const Se of _e)if(fe instanceof Se)return g$R(new ve(fe),be,ve,we);if(Array.isArray(fe))return g$R(new ve(fe),be,ve,we);{const be=_e.map((fe=>`'${fe.name}'`));return we.error(`Failed to set property, expected one of ${be}, but got ${fe.constructor.name}`),new ve([])}}function p$1V(fe,ve,_e){ve[_e]=function u$1m(fe){const ve=new Array(fe.length);for(let _e=0;_e<fe.length;_e++)ve[_e]=fe[_e];return ve}(fe)}var Kee;e$4o([y$2v({json:{write:p$1V}})],Qee.prototype,"color",void 0),e$4o([s$4b("color")],Qee.prototype,"castColor",null),e$4o([y$2v({nonNullable:!0,json:{write:p$1V}})],Qee.prototype,"position",void 0),e$4o([s$4b("position")],Qee.prototype,"castPosition",null),e$4o([y$2v({json:{write:p$1V}})],Qee.prototype,"uv",void 0),e$4o([s$4b("uv")],Qee.prototype,"castUv",null),e$4o([y$2v({json:{write:p$1V}})],Qee.prototype,"normal",void 0),e$4o([s$4b("normal")],Qee.prototype,"castNormal",null),e$4o([y$2v({json:{write:p$1V}})],Qee.prototype,"tangent",void 0),e$4o([s$4b("tangent")],Qee.prototype,"castTangent",null),Qee=Jee=e$4o([a$4y("esri.geometry.support.MeshVertexAttributes")],Qee);let ete=Kee=class extends Pn{static from(fe){return g$2C(Kee,fe)}constructor(fe){super(fe),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(fe){return c$1H(fe,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},ar.getLogger(this))}castMaterial(fe){return g$2C(fe&&"object"==typeof fe&&("metallic"in fe||"roughness"in fe||"metallicRoughnessTexture"in fe)?Xee:Wee,fe)}clone(){return new Kee({faces:a$4H(this.faces),shading:this.shading,material:a$4H(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(fe,ve){const _e={faces:a$4H(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(fe,ve):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new Kee(_e)}get memoryUsage(){let fe=0;return null!=this.faces&&(fe+=this.faces.byteLength),null!=this.material&&(fe+=this.material.memoryUsage),fe}};e$4o([y$2v({json:{write:!0}})],ete.prototype,"faces",void 0),e$4o([s$4b("faces")],ete.prototype,"castFaces",null),e$4o([y$2v({type:Wee,json:{write:!0}})],ete.prototype,"material",void 0),e$4o([s$4b("material")],ete.prototype,"castMaterial",null),e$4o([y$2v()],ete.prototype,"name",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ete.prototype,"shading",void 0),e$4o([y$2v({type:Boolean})],ete.prototype,"trustSourceNormals",void 0),ete=Kee=e$4o([a$4y("esri.geometry.support.MeshComponent")],ete);const tte=ete;let rte=class c32 extends(i$4F(Pn)){constructor(fe){super(fe),this.type="georeferenced",this.origin=null}};e$4o([o$3g({georeferenced:"georeferenced"},{readOnly:!0})],rte.prototype,"type",void 0),e$4o([y$2v({type:[Number],nonNullable:!1,json:{write:!0}})],rte.prototype,"origin",void 0),rte=e$4o([a$4y("esri.geometry.support.MeshGeoreferencedVertexSpace")],rte);const ite=rte;let nte=class i31 extends(i$4F(Pn)){constructor(fe){super(fe),this.type="local",this.origin=[0,0,0]}};e$4o([o$3g({local:"local"},{readOnly:!0})],nte.prototype,"type",void 0),e$4o([y$2v({type:[Number],nonNullable:!0,json:{write:!0}})],nte.prototype,"origin",void 0),nte=e$4o([a$4y("esri.geometry.support.MeshLocalVertexSpace")],nte);const ste=nte;function c$1F(){return ar.getLogger("esri.geometry.Mesh")}function a$1B(fe){return null!=fe.origin}function g$Q(fe){return a$1B(fe.vertexSpace)}function u$1k(fe,ve){if(!a$1B(fe))return null;const[_e,be,we]=fe.origin;return new Yo({x:_e,y:be,z:we,spatialReference:ve})}function s$1w(fe,ve){const{x:_e,y:be,z:we,spatialReference:Se}=fe,Te=[_e,be,we??0];return void 0!==(null==ve?void 0:ve.geographic)&&(a$4K(c$1F(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),ve.vertexSpace&&c$1F().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===((null==ve?void 0:ve.vertexSpace)??function l$1G(fe){return null==fe?void 0:fe?"local":"georeferenced"}(null==ve?void 0:ve.geographic)??function f$13(fe){return fe.isGeographic||fe.isWebMercator?"local":"georeferenced"}(Se))?new ste({origin:Te}):new ite({origin:Te})}function m$1j(fe,ve){return fe.type===ve.type&&(fe.origin===ve.origin||null!=fe.origin&&null!=ve.origin&&G$$(fe.origin,ve.origin))}function f$12(fe,ve,_e){n$1L(fe.typedBuffer,ve.typedBuffer,_e,fe.typedBufferStride,ve.typedBufferStride)}function n$1L(fe,ve,_e,be=4,we=be){if(fe.length/be!=ve.length/we)return;const Se=fe.length/be,Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=_e[3],Re=_e[4],De=_e[5],Be=_e[6],Ze=_e[7],Xe=_e[8];let Je=0,Qe=0;for(let dt=0;dt<Se;dt++){const _e=ve[Je],Se=ve[Je+1],dt=ve[Je+2],$t=ve[Je+3];fe[Qe]=Te*_e+Oe*Se+Be*dt,fe[Qe+1]=Ee*_e+Re*Se+Ze*dt,fe[Qe+2]=Ce*_e+De*Se+Xe*dt,fe[Qe+3]=$t,Je+=we,Qe+=be}}function o$15(fe,ve){const _e=Math.min(fe.count,ve.count),be=fe.typedBuffer,we=fe.typedBufferStride,Se=ve.typedBuffer,Te=ve.typedBufferStride;for(let Ee=0;Ee<_e;Ee++){const fe=Ee*we,ve=Ee*Te,_e=Se[ve],Ce=Se[ve+1],Oe=Se[ve+2],Re=_e*_e+Ce*Ce+Oe*Oe;if(Re>0){const ve=1/Math.sqrt(Re);be[fe]=ve*_e,be[fe+1]=ve*Ce,be[fe+2]=ve*Oe}}}function u$1j(fe,ve,_e){s$1v(fe.typedBuffer,ve,_e,fe.typedBufferStride)}function s$1v(fe,ve,_e,be=4){const we=Math.min(fe.length/be,ve.count),Se=ve.typedBuffer,Te=ve.typedBufferStride;let Ee=0,Ce=0;for(let Oe=0;Oe<we;Oe++)fe[Ce]=_e*Se[Ee],fe[Ce+1]=_e*Se[Ee+1],fe[Ce+2]=_e*Se[Ee+2],fe[Ce+3]=_e*Se[Ee+3],Ee+=Te,Ce+=be}Object.freeze(Object.defineProperty({__proto__:null,normalize:o$15,scale:s$1v,scaleView:u$1j,transformMat3:n$1L,transformMat3View:f$12,transformMat4:function r$1a(fe,ve,_e,be=4,we=be){if(fe.length/be!=ve.length/we)return void ar.getLogger("esri.views.3d.support.buffer.math").error("source and destination buffers need to have the same number of elements");const Se=fe.length/be,Te=_e[0],Ee=_e[1],Ce=_e[2],Oe=_e[3],Re=_e[4],De=_e[5],Be=_e[6],Ze=_e[7],Xe=_e[8],Je=_e[9],Qe=_e[10],dt=_e[11],$t=_e[12],bt=_e[13],wt=_e[14],xt=_e[15];let St=0,Et=0;for(let Pt=0;Pt<Se;Pt++){const _e=ve[St],Se=ve[St+1],Pt=ve[St+2],Ot=ve[St+3];fe[Et]=Te*_e+Re*Se+Xe*Pt+$t*Ot,fe[Et+1]=Ee*_e+De*Se+Je*Pt+bt*Ot,fe[Et+2]=Ce*_e+Be*Se+Qe*Pt+wt*Ot,fe[Et+3]=Oe*_e+Ze*Se+dt*Pt+xt*Ot,St+=we,Et+=be}},transformMat4View:function e$1q(fe,ve,_e){if(fe.count!==ve.count)return;const be=fe.count,we=_e[0],Se=_e[1],Te=_e[2],Ee=_e[3],Ce=_e[4],Oe=_e[5],Re=_e[6],De=_e[7],Be=_e[8],Ze=_e[9],Xe=_e[10],Je=_e[11],Qe=_e[12],dt=_e[13],$t=_e[14],bt=_e[15],wt=fe.typedBuffer,xt=fe.typedBufferStride,St=ve.typedBuffer,Et=ve.typedBufferStride;for(let Pt=0;Pt<be;Pt++){const fe=Pt*xt,ve=Pt*Et,_e=St[ve],be=St[ve+1],Ot=St[ve+2],At=St[ve+3];wt[fe]=we*_e+Ce*be+Be*Ot+Qe*At,wt[fe+1]=Se*_e+Oe*be+Ze*Ot+dt*At,wt[fe+2]=Te*_e+Re*be+Xe*Ot+$t*At,wt[fe+3]=Ee*_e+De*be+Je*Ot+bt*At}}},Symbol.toStringTag,{value:"Module"}));const ote="Projection may be possible after calling projection.load().";function S$G(fe,ve,_e,be){fe.error(`Failed to project from (wkid:${ve.wkid}) to (wkid:${_e.wkid}).${be?" ":""}${be}`)}function v$H(fe,ve,_e,be,we){return I$y(lte.TO_PCPF,uL.fromTypedArray(fe),ate.NORMAL,vL.fromTypedArray(ve),vL.fromTypedArray(_e),be,uL.fromTypedArray(we))?we:null}function k$u(fe,ve,_e,be,we){return I$y(lte.FROM_PCPF,uL.fromTypedArray(fe),ate.NORMAL,vL.fromTypedArray(ve),vL.fromTypedArray(_e),be,uL.fromTypedArray(we))?we:null}function w$L(fe,ve,_e){return n$49(fe,ve,0,_e,a$40(ve),0,fe.length/3)?_e:null}function G$f(fe,ve,_e){return n$49(fe,a$40(_e),0,ve,_e,0,fe.length/3)?ve:null}function V$t(fe,ve,_e){return j$1r(dte,_e),f$1u(ve,fe,dte),_$1y(dte)&&l$2d(ve,ve),ve}function B$j(fe,ve,_e){return n$3X(dte,_e),n$1L(ve,fe,dte),_$1y(dte)&&l$2d(ve,ve,4),ve}function U$s(fe,ve,_e,be){const we=ve===ate.NORMAL;return W$f(fe,ve,_e,((fe,ve)=>{const _e=Math.cos(h$2U(fe));ve[0]=we?_e:1/_e,ve[1]=1}),be)}function $$b(fe,ve,_e,be){const we=ve===ate.NORMAL;return W$f(fe,ve,_e,((fe,ve)=>{const _e=Math.cosh(-fe/Rn.radius);ve[0]=1,ve[1]=we?_e:1/_e}),be)}function W$f(fe,ve,_e,be,we){const Se=ve===ate.NORMAL?3:4,Te=[0,0];for(let Ee=0,Ce=1;Ee<fe.length;Ee+=Se,Ce+=3){be(_e[Ce],Te);const ve=fe[Ee]*Te[0],Oe=fe[Ee+1]*Te[1],Re=fe[Ee+2],De=1/Math.sqrt(ve*ve+Oe*Oe+Re*Re);we[Ee]=ve*De,we[Ee+1]=Oe*De,we[Ee+2]=Re*De,4===Se&&(we[Ee+3]=fe[Ee+3])}return we}function Y$a(fe,ve,_e,be,we){if(!I$y(lte.TO_PCPF,uL.fromTypedArray(fe,4*Float32Array.BYTES_PER_ELEMENT),ate.TANGENT,vL.fromTypedArray(ve),vL.fromTypedArray(_e),be,uL.fromTypedArray(we,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let Se=3;Se<fe.length;Se+=4)we[Se]=fe[Se];return we}function q$l(fe,ve,_e,be,we){if(!I$y(lte.FROM_PCPF,uL.fromTypedArray(fe,16),ate.TANGENT,vL.fromTypedArray(ve),vL.fromTypedArray(_e),be,uL.fromTypedArray(we,16)))return null;for(let Se=3;Se<fe.length;Se+=4)we[Se]=fe[Se];return we}var ate,lte;function H$k(fe,ve,_e,be,we){switch(u$3m(be,_e,hte,be),fe===lte.FROM_PCPF&&h$2A(hte,hte),ve){case ate.NORMAL:return j$1r(we,hte);case ate.TANGENT:return n$3X(we,hte)}}function I$y(fe,ve,_e,be,we,Se,Te){if(!ve)return;const Ee=be.count,Ce=a$40(Se);if(function X$a(fe){return fe.isWGS84||k$1w(fe)||f$3b(fe)||p$4U(fe)}(Se))for(let Oe=0;Oe<Ee;Oe++)we.getVec(Oe,cte),ve.getVec(Oe,ute),S$1P(ute,ute,H$k(fe,_e,cte,Ce,dte)),Te.setVec(Oe,ute);else for(let Oe=0;Oe<Ee;Oe++){we.getVec(Oe,cte),ve.getVec(Oe,ute);const Se=f$38(be.get(Oe,1));let Ee=Math.cos(Se);_e===ate.TANGENT!=(fe===lte.TO_PCPF)&&(Ee=1/Ee),H$k(fe,_e,cte,Ce,dte),fe===lte.TO_PCPF?(dte[0]*=Ee,dte[1]*=Ee,dte[2]*=Ee,dte[3]*=Ee,dte[4]*=Ee,dte[5]*=Ee):(dte[0]*=Ee,dte[3]*=Ee,dte[6]*=Ee,dte[1]*=Ee,dte[4]*=Ee,dte[7]*=Ee),S$1P(ute,ute,dte),z$1d(ute,ute),Te.setVec(Oe,ute)}return Te}function J$b(fe){return"local"===fe.vertexSpace.type?function K$b({vertexSpace:fe,transform:ve,inSpatialReference:_e,outSpatialReference:be,localMode:we,outPositions:Se,positions:Te}){const Ee=fe.origin??Bi,Ce=null!=fe.origin?(null==ve?void 0:ve.localMatrix)??dd:dd,Oe=a$40(_e),Re=be.isWebMercator&&we||!J$G(_e,Oe)?_e:Oe;u$3m(_e,Ee,hte,Re),c$4k(hte,hte,Ce);const De=Se??t$2H(Te.length);return e$1T(De,Te,hte),n$49(De,Re,0,De,be,0,De.length/3),De}(fe):function Q$d({vertexSpace:fe,transform:ve,outPositions:_e,positions:be,inSpatialReference:we,outSpatialReference:Se}){const Te=null!=fe.origin?(null==ve?void 0:ve.localMatrix)??dd:dd,Ee=_e??t$2H(be.length);C$1l(Te,dd)?function o$2k(fe,ve){for(let _e=0;_e<ve.length;++_e)fe[_e]=ve[_e];return fe}(Ee,be):e$1T(Ee,be,Te);const Ce=fe.origin??Bi;if(!G$$(Ce,Bi)){const[fe,ve,_e]=Ce;for(let be=0;be<Ee.length;be+=3)Ee[be]+=fe,Ee[be+1]+=ve,Ee[be+2]+=_e}return n$49(Ee,we,0,Ee,Se,0,Ee.length/3)?Ee:null}(fe)}!function(fe){fe[fe.NORMAL=0]="NORMAL",fe[fe.TANGENT=1]="TANGENT"}(ate||(ate={})),function(fe){fe[fe.TO_PCPF=0]="TO_PCPF",fe[fe.FROM_PCPF=1]="FROM_PCPF"}(lte||(lte={}));const cte=[0,0,0],ute=[0,0,0],hte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dte=[1,0,0,0,1,0,0,0,1],pte=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return ate},loadProjectErrorMessage:ote,logProjectionError:S$G,project:J$b,projectFromPCPF:G$f,projectNormalFromPCPF:k$u,projectNormalToPCPF:v$H,projectTangentFromPCPF:q$l,projectTangentToPCPF:Y$a,projectToPCPF:w$L,transformNormal:V$t,transformTangent:B$j,transformVectorENUPlateCarree:U$s,transformVectorWMPlateCarree:$$b},Symbol.toStringTag,{value:"Module"}));var fte;!function(fe){fe[fe.EnableFastUpdates=0]="EnableFastUpdates",fe[fe.DisableFastUpdates=1]="DisableFastUpdates",fe[fe.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(fte||(fte={}));let mte=class t53{constructor(fe){this.data=fe,this.type="encoded-mesh-texture",this.encoding=EA.KTX2_ENCODING}};function r$19(fe){return"encoded-mesh-texture"===(null==fe?void 0:fe.type)}async function n$1K(fe){const ve=new Blob([fe]),_e=await ve.text();return JSON.parse(_e)}function s$1u(fe){if(null==fe)return null;const ve=null!=fe.offset?fe.offset:aW,_e=null!=fe.rotation?fe.rotation:0,be=null!=fe.scale?fe.scale:lW,we=t$3M(1,0,0,0,1,0,ve[0],ve[1],1),Se=[1,0,0,0,1,0,0,0,1];return i$3X(Se,t$3M(Math.cos(_e),-Math.sin(_e),0,Math.sin(_e),Math.cos(_e),0,0,0,1),t$3M(be[0],0,0,0,be[1],0,0,0,1)),i$3X(Se,we,Se),Se}const yte=2e3;let gte=class p29 extends qG{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(fe,ve){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:_e}=this,be=_e.geometries.slice();_e.removeAllGeometries();const we=I$1t(vte,_e.transformation),Se=ve.getOrigin(we);for(const Te of be){const ve=fe(Te.material),be=Te.instantiate({material:ve});be.localOrigin=Se,_e.addGeometry(be)}this._originalGeometries=be}autoDisableFastTransformUpdates(fe){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((()=>{this._autoDisableFastUpdatesTimeoutId=0,fe()}),yte)}updateAutoDisableFastTransformUpdates(fe){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(fe)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(fe){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:ve}=this,_e=ve.geometries.map((ve=>fe(ve.material)));ve.removeAllGeometries();for(let be=0;be<this._originalGeometries.length;be++){const fe=this._originalGeometries[be],we=_e[be];we.setParameters({modelTransformation:null}),we===fe.material?ve.addGeometry(fe):ve.addGeometry(fe.instantiate({material:we}))}this._originalGeometries.length=0}updateFastLocalOrigin(fe,ve,_e){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:be}=this;if(0===be.geometries.length)return;const we=be.geometries[0].localOrigin,Se=I$1t(vte,fe),Te=_e.getOrigin(Se);if(Te===we)return;const Ee=(null==ve?void 0:ve.localMatrix)??dd;be.shaderTransformation=null,be.transformation=fe,be.geometries.forEach((fe=>{fe.transformation=Ee,fe.localOrigin=Te}))}updateTransform(fe,ve,_e){const{stageObject:be}=this,we=(null==ve?void 0:ve.localMatrix)??dd;if(!this._fastTransformUpdatesEnabled)return be.shaderTransformation=null,be.transformation=fe,be.geometries.forEach((fe=>fe.transformation=we)),void this._updateEdgeTransform(_e);const Se=be.transformation,Te=be.geometries[0].transformation,Ee=fe,Ce=we,Oe=c$4k(_te,Se,Te),Re=c$4k($te,Ee,Ce),De=c$4k(wte,Re,h$2A(wte,Te));be.shaderTransformation=De,this._setFastMaterialTransformation({matA:Oe,matB:Re}),this._updateEdgeTransform(_e)}alignWithElevation(fe,ve,_e,be){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(fe,ve,_e,be);null!=_e&&l$2p(this.elevationContext.featureExpressionInfoContext,_e);const{stageObject:we}=this;if(!we.geometries[0].material.parameters.modelTransformation)return;const Se=we.transformation,Te=we.geometries[0].transformation,Ee=c$4k(_te,Se,Te),Ce=we.effectiveTransformation,Oe=n$48(bte,Ce);this.alignedSampledElevation=p$2r(this,this.elevationContext,fe.spatialReference,((_e,be)=>c$2k(_e,fe,this.elevationContext,ve,be)),ve,Oe),we.shaderTransformation=Oe;const Re=we.geometries[0].transformation,De=c$4k($te,Oe,Re);this._setFastMaterialTransformation({matA:Ee,matB:De}),this._updateEdgeTransform(be)}_setFastMaterialTransformation({matA:fe,matB:ve}){const{stageObject:_e}=this;if(0===_e.geometries.length)return;const be=_e.geometries[0].localOrigin,we=q$X(Tte,g$2z(vte,be.vec3,-1)),Se=c$4k(xte,we,fe),Te=c$4k(Ste,we,ve),Ee=h$2A(xte,Se),Ce=c$4k(Ste,Te,Ee);for(const Oe of _e.geometries)Oe.material.setParameters({modelTransformation:Ce})}_updateEdgeTransform(fe){const{stageObject:ve,_stageLayer:_e}=this;_e.stage.renderer.withEdgeView((_e=>{_e.fastUpdateObject3DEdgesTransform(ve)||this.resetEdgeObject(fe)}))}};const vte=[0,0,0],_te=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$te=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ste=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Tte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let Ete=class r41{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(fe,ve,_e){fe.enableFastTransformUpdates((fe=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(fe))return fe;const _e=ve.byMaterial(fe);return this._fastTransformOriginalMaterials.set(fe,_e),ve.delete(fe),fe}const be=new Rq(fe.parameters);return _e.stage.add(be),this._fastTransformClonedMaterials.set(be,fe),be}),_e.localOriginFactory)}disable(fe,ve,_e){const be=new Set,we=new Set;fe.disableFastTransformUpdates((fe=>{if(!this._fastTransformClonedMaterials.has(fe)){const _e=fe,Se=this._fastTransformOriginalMaterials.get(_e);return ve.has(Se.uid)?(be.add(_e),ve.byUid(Se.uid).material):(we.add(_e),Se.material)}const Se=fe,Te=this._fastTransformClonedMaterials.get(Se);return this._fastTransformClonedMaterials.delete(Se),_e.stage.remove(Se),Te}));for(const Se of be)this._fastTransformOriginalMaterials.delete(Se),_e.stage.remove(Se);for(const Se of we){const fe=this._fastTransformOriginalMaterials.get(Se);this._fastTransformOriginalMaterials.delete(Se),ve.set(fe.uid,fe)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(fe,ve,_e){this._graphicReferenceCount--,this.disable(fe,ve,_e)}forEachMaterialInfo(fe){this._fastTransformOriginalMaterials.forEach(fe)}forEachClonedMaterial(fe){this._fastTransformClonedMaterials.forEach(fe)}destroy(fe){fe.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),fe.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(({material:fe})=>fe))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Pte=class t54{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),(fe=>fe.material))}byUid(fe){return this._byUid.get(fe)}byMaterial(fe){return this._byMaterial.get(fe)}set(fe,ve){this._byUid.set(fe,ve),this._byMaterial.set(ve.material,ve)}delete(fe){var ve;const _e=null==(ve=this._byMaterial.get(fe))?void 0:ve.uid;_e&&(this._byUid.delete(_e),this._byMaterial.delete(fe))}has(fe){return this._byUid.has(fe)}forEachMaterialInfo(fe){this._byUid.forEach(fe)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const Cte=H$J().vec3f(nO.POSITION),Ote=H$J().vec3f(nO.POSITION).vec2f(nO.UV0),Ate=H$J().vec3f(nO.POSITION).vec4u8(nO.COLOR),Mte=H$J().vec3f(nO.POSITION).vec2f(nO.UV0).vec4u8(nO.OBJECTANDLAYERIDCOLOR);function u$1h(fe){const ve=new gO,{vertex:_e,fragment:be}=ve;return ve.include(o$2n,fe),ve.include(e$24,fe),d$1$(_e,fe),ve.attributes.add(nO.POSITION,"vec3"),ve.varyings.add("vpos","vec3"),_e.code.add(o$2P`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),fe.output===NI.Highlight&&ve.include(a$2n,fe),ve.include(P$H,fe),be.uniforms.add(new dO("alphaCoverage",((fe,ve)=>Math.min(1,fe.width*ve.camera.pixelRatio)))),fe.hasVertexColors||be.uniforms.add(new hO("constantColor",(fe=>fe.color))),be.code.add(o$2P`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${fe.hasVertexColors?"vColor":"constantColor"};

    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`color.a = 1.0;`:""}

    if (color.a < ${o$2P.float(yj)}) {
      discard;
    }

    ${fe.output===NI.Color?o$2P`fragColor = highlightSlice(color, vpos);`:""}
    ${fe.output===NI.Highlight?o$2P`outputHighlight();`:""}
  }
  `),ve}const Rte=Object.freeze(Object.defineProperty({__proto__:null,build:u$1h},Symbol.toStringTag,{value:"Module"}));let Ite=class S6 extends fA{initializeProgram(fe){return new gA(fe.rctx,S6.shader.get().build(this.configuration),mA)}initializePipeline(){const fe=this.configuration,ve=l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),i52=(ve,_e=null,be=null)=>S$1g({blending:_e,depthTest:GH,depthWrite:be,colorWrite:AA,stencilWrite:fe.hasOccludees?qH:null,stencilTest:fe.hasOccludees?ve?ZH:YH:null});return fe.output===NI.Color?(this._occludeePipelineState=i52(!0,fe.transparent?ve:null,OA),i52(!1,fe.transparent?ve:null,OA)):i52(!1)}get primitiveType(){return NO.LINES}getPipeline(fe){return fe?this._occludeePipelineState:super.getPipeline()}};Ite.shader=new LO(Rte,(()=>zt((()=>Promise.resolve().then((()=>pRe))),void 0)));let Lte=class s54 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};e$4o([r$2w({count:NI.COUNT})],Lte.prototype,"output",void 0),e$4o([r$2w()],Lte.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Lte.prototype,"hasVertexColors",void 0),e$4o([r$2w()],Lte.prototype,"transparent",void 0),e$4o([r$2w()],Lte.prototype,"hasOccludees",void 0);let Dte=class V3 extends QB{constructor(fe){super(fe,new Fte),this._configuration=new Lte,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>fe===NI.Color||fe===NI.Highlight||fe===NI.ObjectAndLayerIdColor]])}getConfiguration(fe){return this._configuration.output=fe,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(fe,ve,_e,be,we,Se){if(!_e.options.selectionMode||!fe.visible)return;if(!m$2q(ve))return void ar.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const Te=fe.attributes.get(nO.POSITION).data,Ee=_e.camera,Ce=Yte;r$2C(Ce,_e.point);o$44(Zte[0],Ce[0]-2,Ce[1]+2,0),o$44(Zte[1],Ce[0]+2,Ce[1]+2,0),o$44(Zte[2],Ce[0]+2,Ce[1]-2,0),o$44(Zte[3],Ce[0]-2,Ce[1]-2,0);for(let Ze=0;Ze<4;Ze++)if(!Ee.unprojectFromRenderScreen(Zte[Ze],Xte[Ze]))return;b$1Z(Ee.eye,Xte[0],Xte[1],Jte),b$1Z(Ee.eye,Xte[1],Xte[2],Qte),b$1Z(Ee.eye,Xte[2],Xte[3],Kte),b$1Z(Ee.eye,Xte[3],Xte[0],ere);let Oe=Number.MAX_VALUE,Re=0;for(let Ze=0;Ze<Te.length-5;Ze+=3){if(zte[0]=Te[Ze]+ve[12],zte[1]=Te[Ze+1]+ve[13],zte[2]=Te[Ze+2]+ve[14],kte[0]=Te[Ze+3]+ve[12],kte[1]=Te[Ze+4]+ve[13],kte[2]=Te[Ze+5]+ve[14],V$12(Jte,zte)<0&&V$12(Jte,kte)<0||V$12(Qte,zte)<0&&V$12(Qte,kte)<0||V$12(Kte,zte)<0&&V$12(Kte,kte)<0||V$12(ere,zte)<0&&V$12(ere,kte)<0)continue;if(Ee.projectToRenderScreen(zte,Bte),Ee.projectToRenderScreen(kte,jte),Bte[2]<0&&jte[2]>0){e$3Z(Ute,zte,kte);const fe=Ee.frustum,ve=-V$12(fe[$R.NEAR],zte)/P$1g(Ute,fe[$R.NEAR]);g$2z(Ute,Ute,ve),u$3Y(zte,zte,Ute),Ee.projectToRenderScreen(zte,Bte)}else if(Bte[2]>0&&jte[2]<0){e$3Z(Ute,kte,zte);const fe=Ee.frustum,ve=-V$12(fe[$R.NEAR],kte)/P$1g(Ute,fe[$R.NEAR]);g$2z(Ute,Ute,ve),u$3Y(kte,kte,Ute),Ee.projectToRenderScreen(kte,jte)}else if(Bte[2]<0&&jte[2]<0)continue;Bte[2]=0,jte[2]=0;const fe=j$1A(h$2z(Bte,jte,qte),Ce);fe<Oe&&(Oe=fe,r$3w(Gte,zte),r$3w(Hte,kte),Re=Ze/3)}const De=_e.rayBegin,Be=_e.rayEnd;if(Oe<4){let fe=Number.MAX_VALUE;if(d$31(h$2z(Gte,Hte,qte),h$2z(De,Be,Wte),Vte)){e$3Z(Vte,Vte,De);const ve=s$4g(Vte);g$2z(Vte,Vte,1/ve),fe=ve/x$1W(De,Be)}Se(fe,Vte,Re,!1)}}intersectDraped(fe,ve,_e,be,we,Se){if(!_e.options.selectionMode)return;const Te=fe.attributes.get(nO.POSITION).data,Ee=fe.attributes.get(nO.SIZE),Ce=Ee?Ee.data[0]:0,Oe=be[0],Re=be[1],De=((Ce+1)/2+4)*fe.screenToWorldRatio;let Be=Number.MAX_VALUE,Ze=0;for(let Xe=0;Xe<Te.length-5;Xe+=3){const fe=Te[Xe],ve=Te[Xe+1],_e=Oe-fe,be=Re-ve,we=Te[Xe+3]-fe,Se=Te[Xe+4]-ve,Ee=e$3Y((we*_e+Se*be)/(we*we+Se*Se),0,1),Ce=we*Ee-_e,De=Se*Ee-be,Je=Ce*Ce+De*De;Je<Be&&(Be=Je,Ze=Xe/3)}Be<De*De&&we(Se.dist,Se.normal,Ze,!1)}createGLMaterial(fe){return new Nte(fe)}createBufferWriter(){const fe=this.parameters.hasVertexColors?Ate:Cte;return new VH(fe)}},Nte=class I8 extends pM{_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){return this._output===NI.Color&&this._updateOccludeeState(fe),this.ensureTechnique(Ite,fe)}},Fte=class U5 extends tj{constructor(){super(...arguments),this.color=$d,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const zte=[0,0,0],kte=[0,0,0],Ute=[0,0,0],Vte=[0,0,0],Bte=x$1H(),jte=x$1H(),Gte=[0,0,0],Hte=[0,0,0],qte=v$1Q(),Wte=v$1Q(),Yte=[0,0,0],Zte=[x$1H(),x$1H(),x$1H(),x$1H()],Xte=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Jte=E$1z(),Qte=E$1z(),Kte=E$1z(),ere=E$1z(),tre=["mesh"];let rre=class Ie2{constructor(fe,ve,_e){this.normals=fe,this.indices=ve,this.didFlipNormals=_e}};function Se$2(fe,ve){return ve.faces??l$2O(fe.vertexAttributes.position.length/3)}function Ue(fe,ve,_e,be){switch(_e.shading||"flat"){default:case"source":return function Fe(fe,ve,_e,be){if(null==ve)return Be$1(fe,be);let we=!1;if(!_e.trustSourceNormals)for(let Se=0;Se<be.length;Se+=3){Le(fe,be,Se,lre);for(let fe=0;fe<3;fe++){const _e=3*be[Se+fe];sre[0]=ve[_e],sre[1]=ve[_e+1],sre[2]=ve[_e+2],P$1g(lre,sre)<0&&(ve[_e]=-ve[_e],ve[_e+1]=-ve[_e+1],ve[_e+2]=-ve[_e+2],we=!0)}}return new rre(ve,be,we)}(fe,ve,_e,be);case"flat":return Be$1(fe,be);case"smooth":return function De$1(fe,ve){const _e={};for(let Se=0;Se<ve.length;Se+=3){const be=Le(fe,ve,Se,lre);for(let fe=0;fe<3;fe++){const we=ve[Se+fe];let Te=_e[we];Te||(Te={normal:[0,0,0],count:0},_e[we]=Te),u$3Y(Te.normal,Te.normal,be),Te.count++}}const be=t$2G(3*ve.length),we=new Array(3*ve.length);for(let Se=0;Se<ve.length;Se++){const fe=_e[ve[Se]];1!==fe.count&&(z$1d(fe.normal,fe.normal),fe.count=1);for(let ve=0;ve<3;ve++)be[3*Se+ve]=fe.normal[ve];we[Se]=Se}return new rre(be,we,!1)}(fe,be)}}function Be$1(fe,ve){const _e=t$2G(ve.length),be=new Array(3*ve.length);for(let we=0;we<ve.length;we+=3){const Se=Le(fe,ve,we,lre);for(let fe=0;fe<3;fe++)_e[we+fe]=Se[fe],be[we+fe]=we/3}return new rre(_e,be,!1)}function Ge$1(fe,ve,_e,be,we,Se){const Te=3*ve[_e],Ee=3*ve[_e+1],Ce=3*ve[_e+2];be[0]=fe[Te],be[1]=fe[Te+1],be[2]=fe[Te+2],we[0]=fe[Ee],we[1]=fe[Ee+1],we[2]=fe[Ee+2],Se[0]=fe[Ce],Se[1]=fe[Ce+1],Se[2]=fe[Ce+2]}function Le(fe,ve,_e,be){return Ge$1(fe,ve,_e,sre,ore,are),e$3Z(ore,ore,sre),e$3Z(are,are,sre),_$1z(sre,ore,are),z$1d(be,sre),be}function $e$1(fe){if(!fe)return null;const{scale:ve,offset:_e,rotation:be}=fe;return{scale:ve,offset:_e,rotation:h$2U(be)}}function He(fe="repeat"){if("string"==typeof fe){const ve=ke(fe);return{s:ve,t:ve}}return{s:ke(fe.horizontal),t:ke(fe.vertical)}}function ke(fe){switch(fe){case"clamp":return qO.CLAMP_TO_EDGE;case"mirror":return qO.MIRRORED_REPEAT;default:return qO.REPEAT}}function Ye(fe){return null==fe?"-":fe instanceof b_?fe.toHex():fe.contentHash}function Je$1(fe){const{offset:ve,scale:_e,rotation:be}=fe??ire;return`${ve[0]},${ve[1]},${be},${_e[0]},${_e[1]}`}const ire=new Gee,nre=[0,0,0],sre=[0,0,0],ore=[0,0,0],are=[0,0,0],lre=[0,0,0],cre=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ure=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],hre=i$3t(),dre=[new tte];var pre;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.RENDER=1]="RENDER"}(pre||(pre={}));let fre=class p30{constructor(fe,ve,_e,be){this.graphics3DSymbolLayer=fe,this.instanceIndex=ve,this.elevationAligner=_e,this.elevationContext=be,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(fe){const ve=this._lodRenderer.instanceData;fe!==ve.getVisible(this.instanceIndex)&&ve.setVisible(this.instanceIndex,fe)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(fe,ve,_e){if(this.elevationAligner){l$2p(this.elevationContext.featureExpressionInfoContext,_e);const n52=(_e,be)=>c$2k(_e,fe,this.elevationContext,ve,be),be=this.elevationAligner(this,this.elevationContext,fe.spatialReference,n52,ve);null!=be&&(this.alignedSampledElevation=be)}}getCenterObjectSpace(fe=[0,0,0]){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,_re),O$1v(fe,this._lodRenderer.baseBoundingSphere.center,_re)}getBoundingBoxObjectSpace(fe=i$3t()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,_re);const ve=this._lodRenderer.baseBoundingBox;P$$(fe);for(let _e=0;_e<8;++_e)o$44(yre,1&_e?ve[3]:ve[0],2&_e?ve[4]:ve[1],4&_e?ve[5]:ve[2]),O$1v(yre,yre,_re),h$2e(fe,yre);return fe}computeAttachmentOrigin(fe){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,_re),fe.render.origin[0]+=_re[12],fe.render.origin[1]+=_re[13],fe.render.origin[2]+=_re[14],fe.render.num++}async getProjectedBoundingBox(fe,ve,_e,be,we){const Se=this.getBoundingBoxObjectSpace(we),Te=vre,Ee=w$1t(Se)?1:Te.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,_re);for(let Re=0;Re<Ee;Re++){const fe=Te[Re];yre[0]=Se[fe[0]],yre[1]=Se[fe[1]],yre[2]=Se[fe[2]],O$1v(yre,yre,_re),mre[3*Re]=yre[0],mre[3*Re+1]=yre[1],mre[3*Re+2]=yre[2]}if(!fe(mre,0,Ee))return null;P$$(Se);let Ce=null;this.calculateRelativeScreenBounds&&(Ce=this.calculateRelativeScreenBounds());for(let Re=0;Re<3*Ee;Re+=3){for(let fe=0;fe<3;fe++)Se[fe]=Math.min(Se[fe],mre[Re+fe]),Se[fe+3]=Math.max(Se[fe+3],mre[Re+fe]);Ce&&_e.push({location:mre.slice(Re,Re+3),screenSpaceBoundingRect:Ce})}if(ve&&(E$1m(Se,gre),"absolute-height"!==this.elevationContext.mode)){let fe;const _e=k$J(Se,ve.service.spatialReference,ve);try{fe=await ve.service.queryElevation(gre[0],gre[1],be,_e,"ground")}catch(Oe){}null!=fe&&Y$s(Se,0,0,-this.alignedSampledElevation+fe)}return Se}addObjectState(fe,ve){if(fe===xA.Highlight){const _e=new uD(fe);this._addHighlightId(_e),ve.addExternal((fe=>{this._removeHighlightId(fe)}),_e)}}removeObjectState(fe){this._highlights.forEach((ve=>fe.remove(ve)))}_addHighlightId(fe){this._highlights.add(fe),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(fe){this._highlights.delete(fe),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const mre=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],yre=[0,0,0],gre=[0,0,0],vre=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],_re=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function n$1J(fe,ve){const _e=fe.stageResources.geometries.map((ve=>new tH(ve,fe.stageResources.textures))),be=null==fe.lodThreshold||0===fe.lodThreshold&&ve>0?function s$1s(fe){const ve=fe.reduce(((fe,{geometry:ve})=>fe+ve.indexCount/3),0);return Math.sqrt(ve*$re/Math.PI)}(_e):fe.lodThreshold;return new rH(_e,be,fe.pivotOffset)}const $re=20;function a$1z(fe,ve){return fe&&(ve=ve||globalThis.location.hostname)?null!=ve.match(bre)||null!=ve.match(xre)?fe.replace("static.arcgis.com","staticdev.arcgis.com"):null!=ve.match(wre)||null!=ve.match(Sre)?fe.replace("static.arcgis.com","staticqa.arcgis.com"):fe:fe}const bre=/^devext\.arcgis\.com$/,wre=/^qaext\.arcgis\.com$/,xre=/^[\w-]*\.mapsdevext\.arcgis\.com$/,Sre=/^[\w-]*\.mapsqa\.arcgis\.com$/,Tre=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,bre,wre,/^jsapps\.esri\.com$/,xre,Sre];function o$12(fe,ve){n$1I(fe.typedBuffer,ve.typedBuffer,fe.typedBufferStride,ve.typedBufferStride)}function n$1I(fe,ve,_e=2,be=_e){const we=ve.length/2;let Se=0,Te=0;if(y$2C(ve)||function l$4H(fe){return m$3V(fe)||s$4z(fe)}(ve)){for(let Ee=0;Ee<we;++Ee)fe[Se]=ve[Te],fe[Se+1]=ve[Te+1],Se+=_e,Te+=be;return}const Ee=function I$1J(fe){return m$3V(fe)?179769e303:s$4z(fe)?3402823e32:f$3z(fe)?4294967295:i$4W(fe)?65535:u$4g(fe)||e$4i(fe)?255:a$4I(fe)?2147483647:c$54(fe)?32767:o$4u(fe)?127:256}(ve);if(function b$2i(fe){return m$3V(fe)||s$4z(fe)||a$4I(fe)||c$54(fe)||o$4u(fe)}(ve))for(let Ce=0;Ce<we;++Ce)fe[Se]=Math.max(ve[Te]/Ee,-1),fe[Se+1]=Math.max(ve[Te+1]/Ee,-1),Se+=_e,Te+=be;else for(let Ce=0;Ce<we;++Ce)fe[Se]=ve[Te]/Ee,fe[Se+1]=ve[Te+1]/Ee,Se+=_e,Te+=be}function l$1E(fe,ve,_e,be){const we=fe.typedBuffer,Se=fe.typedBufferStride,Te=(null==be?void 0:be.count)??fe.count;let Ee=((null==be?void 0:be.dstIndex)??0)*Se;for(let Ce=0;Ce<Te;++Ce)we[Ee]=ve,we[Ee+1]=_e,Ee+=Se}function e$1o(fe,ve){t$1t(fe.typedBuffer,ve.typedBuffer,fe.typedBufferStride,ve.typedBufferStride)}function t$1t(fe,ve,_e=3,be=_e){const we=ve.length/be;let Se=0,Te=0;for(let Ee=0;Ee<we;++Ee)fe[Se]=ve[Te],fe[Se+1]=ve[Te+1],fe[Se+2]=ve[Te+2],Se+=_e,Te+=be}function f$10(fe,ve,_e,be,we){const Se=fe.typedBuffer,Te=fe.typedBufferStride,Ee=(null==we?void 0:we.count)??fe.count;let Ce=((null==we?void 0:we.dstIndex)??0)*Te;for(let Oe=0;Oe<Ee;++Oe)Se[Ce]=ve,Se[Ce+1]=_e,Se[Ce+2]=be,Ce+=Te}function e$1n(fe,ve){t$1s(fe.typedBuffer,ve,fe.typedBufferStride)}function t$1s(fe,ve,_e=4){const be=ve.typedBuffer,we=ve.typedBufferStride,Se=ve.count;let Te=0,Ee=0;for(let Ce=0;Ce<Se;++Ce)fe[Te]=be[Ee],fe[Te+1]=be[Ee+1],fe[Te+2]=be[Ee+2],fe[Te+3]=be[Ee+3],Te+=_e,Ee+=we}function f$$(fe,ve,_e,be,we,Se){const Te=fe.typedBuffer,Ee=fe.typedBufferStride,Ce=(null==Se?void 0:Se.count)??fe.count;let Oe=((null==Se?void 0:Se.dstIndex)??0)*Ee;for(let Re=0;Re<Ce;++Re)Te[Oe]=ve,Te[Oe+1]=_e,Te[Oe+2]=be,Te[Oe+3]=we,Oe+=Ee}Object.freeze(Object.defineProperty({__proto__:null,fill:l$1E,normalizeIntegerBuffer:n$1I,normalizeIntegerBufferView:o$12},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:t$1t,copyView:e$1o,fill:f$10},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:t$1s,copyView:e$1n,fill:f$$},Symbol.toStringTag,{value:"Module"}));let Ere=class n30{constructor(fe){this._streamDataRequester=fe}async loadJSON(fe,ve){return this._load("json",fe,ve)}async loadBinary(fe,ve){return tt$k(fe)?(s$4o(ve),nt$h(fe)):this._load("binary",fe,ve)}async loadImage(fe,ve){return this._load("image",fe,ve)}async _load(fe,ve,_e){if(null==this._streamDataRequester)return(await U$1a(ve,{responseType:Pre[fe]})).data;const be=await _$1s(this._streamDataRequester.request(ve,fe,_e));if(!0===be.ok)return be.value;throw a$4D(be.error),new Ir("",`Request for resource failed: ${be.error}`)}};const Pre={image:"image",binary:"array-buffer",json:"json","image+type":void 0};let Cre=class r42{constructor(fe,ve,_e=""){this.major=fe,this.minor=ve,this._context=_e}lessThan(fe,ve){return this.major<fe||fe===this.major&&this.minor<ve}since(fe,ve){return!this.lessThan(fe,ve)}validate(fe){if(this.major!==fe.major){const ve=this._context&&this._context+":",_e=this._context&&this._context+" ";throw new Ir(ve+"unsupported-version",`Required major ${_e}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:fe})}}clone(){return new r42(this.major,this.minor,this._context)}static parse(fe,ve=""){const[_e,be]=fe.split("."),we=/^\s*\d+\s*$/;if(!(null==_e?void 0:_e.match)||!we.test(_e))throw new Ir((ve&&ve+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:fe});if(!(null==be?void 0:be.match)||!we.test(be))throw new Ir((ve&&ve+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:fe});const Se=parseInt(_e,10),Te=parseInt(be,10);return new r42(Se,Te,ve)}};function e$1m(fe,ve){const _e=fe.count;ve||(ve=new fe.TypedArrayConstructor(_e));for(let be=0;be<_e;be++)ve[be]=fe.get(be);return ve}Object.freeze(Object.defineProperty({__proto__:null,makeDense:e$1m},Symbol.toStringTag,{value:"Module"}));let Ore=class t55{constructor(fe){this._data=fe,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const fe=this._offset4;return this._offset4+=1,this._dataUint32[fe]}readUint8Array(fe){const ve=4*this._offset4;return this._offset4+=fe/4,new Uint8Array(this._data,ve,fe)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var Are,Mre;!function(fe){fe.SCALAR="SCALAR",fe.VEC2="VEC2",fe.VEC3="VEC3",fe.VEC4="VEC4",fe.MAT2="MAT2",fe.MAT3="MAT3",fe.MAT4="MAT4"}(Are||(Are={})),function(fe){fe[fe.ARRAY_BUFFER=34962]="ARRAY_BUFFER",fe[fe.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Mre||(Mre={}));const Rre={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Ire={pbrMetallicRoughness:Rre,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Lre={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},i$1A=(fe={})=>{const ve={...Rre,...fe.pbrMetallicRoughness},_e=function s$1q(fe){switch(fe.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:fe.ESRI_externalColorMixMode="tint"}return fe}({...Lre,...fe.extras});return{...Ire,...fe,pbrMetallicRoughness:ve,extras:_e}};const Dre={magFilter:HO.LINEAR,minFilter:HO.LINEAR_MIPMAP_LINEAR,wrapS:qO.REPEAT,wrapT:qO.REPEAT};const Nre=1179937895,Fre=1313821514,zre=5130562;let kre=class Y{constructor(fe,ve,_e,be){if(this._context=fe,this.uri=ve,this.json=_e,this._glbBuffer=be,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function r$13(fe){let ve,_e;return fe.replace(/^(.*\/)?([^/]*)$/,((fe,be,we)=>(ve=be||"",_e=we||"",""))),{dirPart:ve,filePart:_e}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==_e.scenes)throw new Ir("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==_e.meshes)throw new Ir("gltf-loader-unsupported-feature","Meshes must be defined");if(null==_e.nodes)throw new Ir("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(fe,ve,_e){if(tt$k(ve)){const _e=ot$i(ve);if(_e&&"model/gltf-binary"!==_e.mediaType)try{const be=JSON.parse(_e.isBase64?atob(_e.data):_e.data);return new Y(fe,ve,be)}catch{}const be=nt$h(ve);if(Y._isGLBData(be))return this._fromGLBData(fe,ve,be)}if(Hre.test(ve)||"gltf"===(null==_e?void 0:_e.expectedType)){const be=await fe.loadJSON(ve,_e);return new Y(fe,ve,be)}const be=await fe.loadBinary(ve,_e);if(Y._isGLBData(be))return this._fromGLBData(fe,ve,be);if(qre.test(ve)||"glb"===(null==_e?void 0:_e.expectedType))throw new Ir("gltf-loader-invalid-glb","This is not a valid glb file.");const we=await fe.loadJSON(ve,_e);return new Y(fe,ve,we)}static _isGLBData(fe){if(null==fe)return!1;const ve=new Ore(fe);return ve.remainingBytes()>=4&&ve.readUint32()===Nre}static async _fromGLBData(fe,ve,_e){const be=await Y._parseGLBData(_e);return new Y(fe,ve,be.json,be.binaryData)}static async _parseGLBData(fe){const ve=new Ore(fe);if(ve.remainingBytes()<12)throw new Ir("gltf-loader-error","glb binary data is insufficiently large.");const _e=ve.readUint32(),be=ve.readUint32(),we=ve.readUint32();if(_e!==Nre)throw new Ir("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(fe.byteLength<we)throw new Ir("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==be)throw new Ir("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let Se,Te,Ee=0;for(;ve.remainingBytes()>=8;){const fe=ve.readUint32(),_e=ve.readUint32();if(0===Ee){if(_e!==Fre)throw new Ir("gltf-loader-error","First glb chunk must be JSON.");if(fe<0)throw new Ir("gltf-loader-error","No JSON data found.");Se=await n$1K(ve.readUint8Array(fe))}else if(1===Ee){if(_e!==zre)throw new Ir("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");Te=ve.readUint8Array(fe)}else ar.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");Ee+=1}if(!Se)throw new Ir("gltf-loader-error","No glb JSON chunk detected.");return{json:Se,binaryData:Te}}async getBuffer(fe,ve){const _e=this.json.buffers[fe];if(null==_e.uri){if(null==this._glbBuffer)throw new Ir("gltf-loader-error","glb buffer not present");return this._glbBuffer}const be=await this._getBufferLoader(fe,ve);if(be.byteLength!==_e.byteLength)throw new Ir("gltf-loader-error","Buffer byte lengths should match.");return be}async _getBufferLoader(fe,ve){const _e=this._bufferLoaders.get(fe);if(_e)return _e;const be=this.json.buffers[fe].uri,we=this._context.loadBinary(this._resolveUri(be),ve).then((fe=>new Uint8Array(fe)));return this._bufferLoaders.set(fe,we),we}async getAccessor(fe,ve){if(!this.json.accessors)throw new Ir("gltf-loader-unsupported-feature","Accessors missing.");const _e=this.json.accessors[fe];if(null==(null==_e?void 0:_e.bufferView))throw new Ir("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(_e.type in[Are.MAT2,Are.MAT3,Are.MAT4])throw new Ir("gltf-loader-unsupported-feature",`AttributeType ${_e.type} is not supported`);const be=this.json.bufferViews[_e.bufferView],we=await this.getBuffer(be.buffer,ve),Se=jre[_e.type],Te=Gre[_e.componentType],Ee=Se*Te,Ce=be.byteStride||Ee;return{raw:we.buffer,byteStride:Ce,byteOffset:we.byteOffset+(be.byteOffset||0)+(_e.byteOffset||0),entryCount:_e.count,isDenselyPacked:Ce===Ee,componentCount:Se,componentByteSize:Te,componentType:_e.componentType,min:_e.min,max:_e.max,normalized:!!_e.normalized}}async getIndexData(fe,ve){if(null==fe.indices)return;const _e=await this.getAccessor(fe.indices,ve);if(_e.isDenselyPacked)switch(_e.componentType){case BO.UNSIGNED_BYTE:return new Uint8Array(_e.raw,_e.byteOffset,_e.entryCount);case BO.UNSIGNED_SHORT:return new Uint16Array(_e.raw,_e.byteOffset,_e.entryCount);case BO.UNSIGNED_INT:return new Uint32Array(_e.raw,_e.byteOffset,_e.entryCount)}else switch(_e.componentType){case BO.UNSIGNED_BYTE:return e$1m(Q$b($L,_e));case BO.UNSIGNED_SHORT:return e$1m(Q$b(SL,_e));case BO.UNSIGNED_INT:return e$1m(Q$b(CL,_e))}}async getPositionData(fe,ve){if(null==fe.attributes.POSITION)throw new Ir("gltf-loader-unsupported-feature","No POSITION vertex data found.");const _e=await this.getAccessor(fe.attributes.POSITION,ve);if(_e.componentType!==BO.FLOAT)throw new Ir("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+BO[_e.componentType]);if(3!==_e.componentCount)throw new Ir("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+_e.componentCount.toFixed());return Q$b(uL,_e)}async getNormalData(fe,ve){if(null==fe.attributes.NORMAL)throw new Ir("gltf-loader-error","No NORMAL vertex data found.");const _e=await this.getAccessor(fe.attributes.NORMAL,ve);if(_e.componentType!==BO.FLOAT)throw new Ir("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+BO[_e.componentType]);if(3!==_e.componentCount)throw new Ir("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+_e.componentCount.toFixed());return Q$b(uL,_e)}async getTangentData(fe,ve){if(null==fe.attributes.TANGENT)throw new Ir("gltf-loader-error","No TANGENT vertex data found.");const _e=await this.getAccessor(fe.attributes.TANGENT,ve);if(_e.componentType!==BO.FLOAT)throw new Ir("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+BO[_e.componentType]);if(4!==_e.componentCount)throw new Ir("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+_e.componentCount.toFixed());return new hL(_e.raw,_e.byteOffset,_e.byteStride,_e.byteOffset+_e.byteStride*_e.entryCount)}async getTextureCoordinates(fe,ve){if(null==fe.attributes.TEXCOORD_0)throw new Ir("gltf-loader-error","No TEXCOORD_0 vertex data found.");const _e=await this.getAccessor(fe.attributes.TEXCOORD_0,ve);if(2!==_e.componentCount)throw new Ir("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+_e.componentCount.toFixed());if(_e.componentType===BO.FLOAT)return Q$b(cL,_e);if(!_e.normalized)throw new Ir("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function W$d(fe){switch(fe.componentType){case BO.BYTE:return new IL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount);case BO.UNSIGNED_BYTE:return new bL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount);case BO.SHORT:return new FL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount);case BO.UNSIGNED_SHORT:return new TL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount);case BO.UNSIGNED_INT:return new OL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount);case BO.FLOAT:return new cL(fe.raw,fe.byteOffset,fe.byteStride,fe.byteOffset+fe.byteStride*fe.entryCount)}}(_e)}async getVertexColors(fe,ve){if(null==fe.attributes.COLOR_0)throw new Ir("gltf-loader-error","No COLOR_0 vertex data found.");const _e=await this.getAccessor(fe.attributes.COLOR_0,ve);if(4!==_e.componentCount&&3!==_e.componentCount)throw new Ir("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+_e.componentCount.toFixed());if(4===_e.componentCount){if(_e.componentType===BO.FLOAT)return Q$b(hL,_e);if(_e.componentType===BO.UNSIGNED_BYTE)return Q$b(xL,_e);if(_e.componentType===BO.UNSIGNED_SHORT)return Q$b(PL,_e)}else if(3===_e.componentCount){if(_e.componentType===BO.FLOAT)return Q$b(uL,_e);if(_e.componentType===BO.UNSIGNED_BYTE)return Q$b(wL,_e);if(_e.componentType===BO.UNSIGNED_SHORT)return Q$b(EL,_e)}throw new Ir("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+BO[_e.componentType])}hasPositions(fe){return void 0!==fe.attributes.POSITION}hasNormals(fe){return void 0!==fe.attributes.NORMAL}hasVertexColors(fe){return void 0!==fe.attributes.COLOR_0}hasTextureCoordinates(fe){return void 0!==fe.attributes.TEXCOORD_0}hasTangents(fe){return void 0!==fe.attributes.TANGENT}async getMaterial(fe,ve,_e){var be,we,Se,Te,Ee,Ce,Oe,Re,De,Be;let Ze=fe.material?this._materialCache.get(fe.material):void 0;if(!Ze){const Xe=null!=fe.material?i$1A(this.json.materials[fe.material]):i$1A(),Je=Xe.pbrMetallicRoughness,Qe=this.hasVertexColors(fe),dt=this.getTexture(Je.baseColorTexture,ve),$t=this.getTexture(Xe.normalTexture,ve),bt=_e?this.getTexture(Xe.occlusionTexture,ve):void 0,wt=_e?this.getTexture(Xe.emissiveTexture,ve):void 0,xt=_e?this.getTexture(Je.metallicRoughnessTexture,ve):void 0,St=null!=fe.material?fe.material:-1;Ze={alphaMode:Xe.alphaMode,alphaCutoff:Xe.alphaCutoff,color:Je.baseColorFactor,doubleSided:!!Xe.doubleSided,colorTexture:await dt,normalTexture:await $t,name:Xe.name,id:St,occlusionTexture:await bt,emissiveTexture:await wt,emissiveFactor:Xe.emissiveFactor,metallicFactor:Je.metallicFactor,roughnessFactor:Je.roughnessFactor,metallicRoughnessTexture:await xt,hasVertexColors:Qe,ESRI_externalColorMixMode:Xe.extras.ESRI_externalColorMixMode,colorTextureTransform:null==(we=null==(be=null==Je?void 0:Je.baseColorTexture)?void 0:be.extensions)?void 0:we.KHR_texture_transform,normalTextureTransform:null==(Te=null==(Se=Xe.normalTexture)?void 0:Se.extensions)?void 0:Te.KHR_texture_transform,occlusionTextureTransform:null==(Ce=null==(Ee=Xe.occlusionTexture)?void 0:Ee.extensions)?void 0:Ce.KHR_texture_transform,emissiveTextureTransform:null==(Re=null==(Oe=Xe.emissiveTexture)?void 0:Oe.extensions)?void 0:Re.KHR_texture_transform,metallicRoughnessTextureTransform:null==(Be=null==(De=null==Je?void 0:Je.metallicRoughnessTexture)?void 0:De.extensions)?void 0:Be.KHR_texture_transform,receiveAmbientOcclusion:Xe.extras.ESRI_receiveAmbientOcclusion,receiveShadows:Xe.extras.ESRI_receiveShadows}}return Ze}async getTexture(fe,ve){if(!fe)return;if(0!==(fe.texCoord||0))throw new Ir("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const _e=fe.index,be=this.json.textures[_e],we=(fe=>({...Dre,...fe}))(null!=be.sampler?this.json.samplers[be.sampler]:{}),Se=Z$9(be),Te=this.json.images[Se],Ee=await this._loadTextureImageData(_e,be,ve);return r$3B(this._textureCache,_e,(()=>{const t85=fe=>33071===fe||33648===fe||10497===fe,r65=fe=>{throw new Ir("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${fe}`)};return{data:Ee,wrapS:t85(we.wrapS)?we.wrapS:r65(we.wrapS),wrapT:t85(we.wrapT)?we.wrapT:r65(we.wrapT),minFilter:we.minFilter,name:Te.name,id:_e}}))}getNodeTransform(fe){if(void 0===fe)return Ure;let ve=this._nodeTransformCache.get(fe);if(!ve){const _e=this.getNodeTransform(this._getNodeParent(fe)),be=this.json.nodes[fe];be.matrix?ve=c$4k([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_e,be.matrix):be.translation||be.rotation||be.scale?(ve=r$39(_e),be.translation&&i$45(ve,ve,be.translation),be.rotation&&(Bre[3]=v$1G(Bre,be.rotation),b$21(ve,ve,Bre[3],Bre)),be.scale&&f$2O(ve,ve,be.scale)):ve=r$39(_e),this._nodeTransformCache.set(fe,ve)}return ve}_resolveUri(fe){return _$1x(fe,this._baseUri)}_getNodeParent(fe){return this._nodeParentMap.get(fe)}_checkVersionSupported(){const fe=Cre.parse(this.json.asset.version,"glTF");Vre.validate(fe)}_checkRequiredExtensionsSupported(){const fe=this.json;if(fe.extensionsRequired&&!fe.extensionsRequired.every((fe=>this._supportedExtensions.includes(fe))))throw new Ir("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+fe.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach(((fe,ve)=>{fe.children&&fe.children.forEach((fe=>{this._nodeParentMap.set(fe,ve)}))}))}async _loadTextureImageData(fe,ve,_e){const be=this._textureLoaders.get(fe);if(be)return be;const we=this._createTextureLoader(ve,_e);return this._textureLoaders.set(fe,we),we}async _createTextureLoader(fe,ve){const _e=Z$9(fe),be=this.json.images[_e];if(be.uri){if(be.uri.endsWith(".ktx2")){const fe=await this._context.loadBinary(this._resolveUri(be.uri),ve);return new mte(new Uint8Array(fe))}return this._context.loadImage(this._resolveUri(be.uri),ve)}if(null==be.bufferView)throw new Ir("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==be.mimeType)throw new Ir("gltf-loader-unsupported-feature","Image mimeType must be defined.");const we=this.json.bufferViews[be.bufferView],Se=await this.getBuffer(we.buffer,ve);if(null!=we.byteStride)throw new Ir("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const Te=Se.byteOffset+(we.byteOffset||0);return async function o$14(fe,ve){if(ve===EA.KTX2_ENCODING)return new mte(fe);const _e=new Blob([fe],{type:ve}),be=URL.createObjectURL(_e),we=new Image;if(has("esri-iPhone"))return new Promise(((fe,ve)=>{const r66=()=>{o40(),fe(we)},n53=fe=>{o40(),ve(fe)},o40=()=>{URL.revokeObjectURL(be),we.removeEventListener("load",r66),we.removeEventListener("error",n53)};we.addEventListener("load",r66),we.addEventListener("error",n53),we.src=be}));try{we.src=be,await we.decode()}catch(Te){}return URL.revokeObjectURL(be),we}(new Uint8Array(Se.buffer,Te,we.byteLength),be.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const fe=await g$2F(Array.from(this._bufferLoaders.values())),ve=await g$2F(Array.from(this._textureLoaders.values()));return fe.reduce(((fe,ve)=>fe+((null==ve?void 0:ve.byteLength)??0)),0)+ve.reduce(((fe,ve)=>fe+(ve?r$19(ve)?ve.data.byteLength:ve.width*ve.height*4:0)),0)}};const Ure=g$2c([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Math.PI/2),Vre=new Cre(2,0,"glTF"),Bre=[0,0,0,1],jre={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gre={[BO.BYTE]:1,[BO.UNSIGNED_BYTE]:1,[BO.SHORT]:2,[BO.UNSIGNED_SHORT]:2,[BO.HALF_FLOAT]:2,[BO.FLOAT]:4,[BO.INT]:4,[BO.UNSIGNED_INT]:4};function Q$b(fe,ve){return new fe(ve.raw,ve.byteOffset,ve.byteStride,ve.byteOffset+ve.byteStride*(ve.entryCount-1)+ve.componentByteSize*ve.componentCount)}function Z$9(fe){var ve;if(null!=(null==(ve=fe.extensions)?void 0:ve.KHR_texture_basisu))return fe.extensions.KHR_texture_basisu.source;if(null!==fe.source)return fe.source;throw new Ir("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const Hre=/\.gltf$/i,qre=/\.glb$/i;let Wre=0;async function l$1B(fe,ve,_e={},be=!0){var we,Se;const Te=await kre.load(fe,ve,_e),Ee="gltf_"+Wre++,Ce={lods:[],materials:new Map,textures:new Map,meta:u$1e(Te)},Oe=!(!Te.json.asset.extras||"symbolResource"!==Te.json.asset.extras.ESRI_type),Re=null==(Se=null==(we=Te.json.asset.extras)?void 0:we.ESRI_webstyleSymbol)?void 0:Se.webstyle,De=new Map;await async function c$1C(fe,ve){const _e=fe.json,be=_e.scenes[_e.scene||0].nodes,we=be.length>1,Se=[];for(const Te of be){const fe=_e.nodes[Te];Se.push(n52(Te,0)),m$1g(fe)&&!we&&fe.extensions.MSFT_lod.ids.forEach(((fe,ve)=>n52(fe,ve+1)))}async function n52(be,we){const Te=_e.nodes[be],Ee=fe.getNodeTransform(be);if(null!=Te.weights&&ar.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=Te.mesh){const fe=_e.meshes[Te.mesh];for(const _e of fe.primitives)Se.push(ve(_e,Ee,we,fe.name))}for(const fe of Te.children||[])Se.push(n52(fe,we))}await Promise.all(Se)}(Te,(async(fe,ve,we,Se)=>{var Oe;const Re=De.get(we)??0;De.set(we,Re+1);const Be=void 0!==fe.mode?fe.mode:NO.TRIANGLES,Ze=Be===NO.TRIANGLES||Be===NO.TRIANGLE_STRIP||Be===NO.TRIANGLE_FAN?Be:null;if(null==Ze)return void ar.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+NO[Be]+"). Skipping primitive.");if(!Te.hasPositions(fe))return void ar.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const Xe=Te.getPositionData(fe,_e),Je=Te.getMaterial(fe,_e,be),Qe=Te.hasNormals(fe)?Te.getNormalData(fe,_e):null,dt=Te.hasTangents(fe)?Te.getTangentData(fe,_e):null,$t=Te.hasTextureCoordinates(fe)?Te.getTextureCoordinates(fe,_e):null,bt=Te.hasVertexColors(fe)?Te.getVertexColors(fe,_e):null,wt=Te.getIndexData(fe,_e),xt={name:Se,transform:r$39(ve),attributes:{position:await Xe,normal:Qe?await Qe:null,texCoord0:$t?await $t:null,color:bt?await bt:null,tangent:dt?await dt:null},indices:await wt,primitiveType:Ze,material:d$18(Ce,await Je,Ee)};let St=null;null!=(null==(Oe=Ce.meta)?void 0:Oe.ESRI_lod)&&"screenSpaceRadius"===Ce.meta.ESRI_lod.metric&&(St=Ce.meta.ESRI_lod.thresholds[we]),Ce.lods[we]=Ce.lods[we]||{parts:[],name:Se,lodThreshold:St},Ce.lods[we].parts[Re]=xt}));for(const Ze of Ce.lods)Ze.parts=Ze.parts.filter((fe=>!!fe));const Be=await Te.getLoadedBuffersSize();return{model:Ce,meta:{isEsriSymbolResource:Oe,uri:Te.uri,ESRI_webstyle:Re},customMeta:{},size:Be}}function u$1e(fe){const ve=fe.json;let _e=null;return ve.nodes.forEach((fe=>{const ve=fe.extras;null!=ve&&(ve.ESRI_proxyEllipsoid||ve.ESRI_lod)&&(_e=ve)})),_e}function m$1g(fe){var ve;return(null==(ve=fe.extensions)?void 0:ve.MSFT_lod)&&Array.isArray(fe.extensions.MSFT_lod.ids)}function d$18(fe,ve,_e){const a55=ve=>{const be=`${_e}_tex_${ve&&ve.id}${(null==ve?void 0:ve.name)?"_"+ve.name:""}`;if(ve&&!fe.textures.has(be)){const _e=function l$1D(fe,ve={}){return{data:fe,parameters:{wrap:{s:qO.REPEAT,t:qO.REPEAT,...ve.wrap},noUnpackFlip:!0,mipmap:!1,...ve}}}(ve.data,{wrap:{s:ve.wrapS,t:ve.wrapT},mipmap:Yre.has(ve.minFilter),noUnpackFlip:!0});fe.textures.set(be,_e)}return be},be=`${_e}_mat_${ve.id}_${ve.name}`;if(!fe.materials.has(be)){const _e=function r$15(fe={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...fe}}({color:[ve.color[0],ve.color[1],ve.color[2]],opacity:ve.color[3],alphaMode:ve.alphaMode,alphaCutoff:ve.alphaCutoff,doubleSided:ve.doubleSided,colorMixMode:ve.ESRI_externalColorMixMode,textureColor:ve.colorTexture?a55(ve.colorTexture):void 0,textureNormal:ve.normalTexture?a55(ve.normalTexture):void 0,textureOcclusion:ve.occlusionTexture?a55(ve.occlusionTexture):void 0,textureEmissive:ve.emissiveTexture?a55(ve.emissiveTexture):void 0,textureMetallicRoughness:ve.metallicRoughnessTexture?a55(ve.metallicRoughnessTexture):void 0,emissiveFactor:[ve.emissiveFactor[0],ve.emissiveFactor[1],ve.emissiveFactor[2]],colorTextureTransform:ve.colorTextureTransform,normalTextureTransform:ve.normalTextureTransform,occlusionTextureTransform:ve.occlusionTextureTransform,emissiveTextureTransform:ve.emissiveTextureTransform,metallicRoughnessTextureTransform:ve.metallicRoughnessTextureTransform,metallicFactor:ve.metallicFactor,roughnessFactor:ve.roughnessFactor,receiveShadows:ve.receiveShadows,receiveAmbientOcclustion:ve.receiveAmbientOcclusion});fe.materials.set(be,_e)}return be}const Yre=new Set([HO.LINEAR_MIPMAP_LINEAR,HO.LINEAR_MIPMAP_NEAREST]);function o$11(fe,ve){switch(ve){case NO.TRIANGLES:return function f$_(fe){return"number"==typeof fe?l$2O(fe):u$4g(fe)?new Uint16Array(fe):fe}(fe);case NO.TRIANGLE_STRIP:return function u$1d(fe){const ve="number"==typeof fe?fe:fe.length;if(ve<3)return[];const _e=ve-2,be=i$2F(3*_e);if("number"==typeof fe){let fe=0;for(let ve=0;ve<_e;ve+=1)ve%2==0?(be[fe++]=ve,be[fe++]=ve+1,be[fe++]=ve+2):(be[fe++]=ve+1,be[fe++]=ve,be[fe++]=ve+2)}else{let ve=0;for(let we=0;we<_e;we+=1)we%2==0?(be[ve++]=fe[we],be[ve++]=fe[we+1],be[ve++]=fe[we+2]):(be[ve++]=fe[we+1],be[ve++]=fe[we],be[ve++]=fe[we+2])}return be}(fe);case NO.TRIANGLE_FAN:return function i$1z(fe){const ve="number"==typeof fe?fe:fe.length;if(ve<3)return new Uint16Array(0);const _e=ve-2,be=_e<=65536?new Uint16Array(3*_e):new Uint32Array(3*_e);if("number"==typeof fe){let fe=0;for(let ve=0;ve<_e;++ve)be[fe++]=0,be[fe++]=ve+1,be[fe++]=ve+2;return be}const we=fe[0];let Se=fe[1],Te=0;for(let Ee=0;Ee<_e;++Ee){const ve=fe[Ee+2];be[Te++]=we,be[Te++]=Se,be[Te++]=ve,Se=ve}return be}(fe)}}let Zre=class s55{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Xre=class t56{constructor(fe,ve,_e){this.name=fe,this.lodThreshold=ve,this.pivotOffset=_e,this.stageResources=new Zre,this.numberOfVertices=0}};const v$F=()=>ar.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function A$z(fe,ve){const _e=await async function j$D(fe,ve){const _e=null==ve?void 0:ve.streamDataRequester;if(_e)return async function I$u(fe,ve,_e){const be=await _$1s(ve.request(fe,"json",_e));if(!0===be.ok)return be.value;a$4D(be.error),P$o(be.error.details.url)}(fe,_e,ve);const be=await _$1s(U$1a(fe,ve));if(!0===be.ok)return be.value.data;a$4D(be.error),P$o(be.error)}(fe,ve),be=await async function E$y(fe,ve){const _e=new Array;for(const Se in fe){const be=fe[Se],we=be.images[0].data;if(!we){v$F().warn("Externally referenced texture data is not yet supported");continue}const Te=be.encoding+";base64,"+we,Ee="/textureDefinitions/"+Se,Ce="rgba"===be.channels?be.alphaChannelUsage||"transparency":"none",Oe={noUnpackFlip:!0,wrap:{s:qO.REPEAT,t:qO.REPEAT},preMultiplyAlpha:O$u(Ce)!==SA.Opaque},Re=(null==ve?void 0:ve.disableTextures)?Promise.resolve(null):t$1T(Te,ve);_e.push(Re.then((fe=>({refId:Ee,image:fe,parameters:Oe,alphaChannelUsage:Ce}))))}const be=await Promise.all(_e),we={};for(const Se of be)we[Se.refId]=Se;return we}(_e.textureDefinitions??{},ve);let we=0;for(const Se in be)if(be.hasOwnProperty(Se)){const fe=be[Se];we+=(null==fe?void 0:fe.image)?fe.image.width*fe.image.height*4:0}return{resource:_e,textures:be,size:we+e$4j(_e)}}function P$o(fe){throw new Ir("",`Request for object resource failed: ${fe}`)}function M$s(fe){const ve=fe.params,_e=ve.topology;let be=!0;switch(ve.vertexAttributes||(v$F().warn("Geometry must specify vertex attributes"),be=!1),ve.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const fe=ve.faces;if(fe){if(ve.vertexAttributes)for(const _e in ve.vertexAttributes){const ve=fe[_e];(null==ve?void 0:ve.values)?(null!=ve.valueType&&"UInt32"!==ve.valueType&&(v$F().warn(`Unsupported indexed geometry indices type '${ve.valueType}', only UInt32 is currently supported`),be=!1),null!=ve.valuesPerElement&&1!==ve.valuesPerElement&&(v$F().warn(`Unsupported indexed geometry values per element '${ve.valuesPerElement}', only 1 is currently supported`),be=!1)):(v$F().warn(`Indexed geometry does not specify face indices for '${_e}' attribute`),be=!1)}}else v$F().warn("Indexed geometries must specify faces"),be=!1;break}default:v$F().warn(`Unsupported topology '${_e}'`),be=!1}fe.params.material||(v$F().warn("Geometry requires material"),be=!1);const we=fe.params.vertexAttributes;for(const Se in we)we[Se].values||(v$F().warn("Geometries with externally defined attributes are not yet supported"),be=!1);return be}function U$p(fe){const ve=P$$();return fe.forEach((fe=>{const _e=fe.boundingInfo;null!=_e&&(h$2e(ve,_e.bbMin),h$2e(ve,_e.bbMax))})),ve}function O$u(fe){switch(fe){case"mask":return SA.Mask;case"maskAndTransparency":return SA.MaskBlend;case"none":return SA.Opaque;default:return SA.Blend}}function k$r(fe){const ve=fe.params;return{id:1,material:ve.material,texture:ve.texture,region:ve.texture}}const Jre=new Cre(1,2,"wosr"),Qre=2.1;async function te$4(fe,ve){var _e;const be=re$4(a$1z(fe));if("wosr"===be.fileType){const fe=await(ve.cache?ve.cache.loadWOSR(be.url,ve):A$z(be.url,ve)),{engineResources:_e,referenceBoundingBox:we}=function T$r(fe,ve){var _e,be;const we=new Array,Se=new Array,Te=new Array,Ee=new wU,Ce=fe.resource,Oe=Cre.parse(Ce.version||"1.0","wosr");Jre.validate(Oe);const Re=Ce.model.name,De=Ce.model.geometries,Be=Ce.materialDefinitions??{},Ze=fe.textures;let Xe=0;const Je=new Map;for(let Qe=0;Qe<De.length;Qe++){const fe=De[Qe];if(!M$s(fe))continue;const Ce=k$r(fe),Oe=fe.params.vertexAttributes,Re=[],p49=ve=>{if("PerAttributeArray"===fe.params.topology)return null;const _e=fe.params.faces;for(const fe in _e)if(fe===ve)return _e[fe].values;return null},dt=Oe[nO.POSITION],$t=dt.values.length/dt.valuesPerElement;for(const ve in Oe){const fe=Oe[ve],_e=fe.values,be=p49(ve)??l$2O($t);Re.push([ve,new Om(_e,be,fe.valuesPerElement,!0)])}const bt=Ce.texture,wt=Ze&&Ze[bt];if(wt&&!Je.has(bt)){const{image:fe,parameters:ve}=wt,_e=new CZ(fe,ve);Se.push(_e),Je.set(bt,_e)}const xt=Je.get(bt),St=xt?xt.id:void 0,Et=Ce.material;let Pt=Ee.get(Et,bt);if(null==Pt){const fe=Be[Et.substring(Et.lastIndexOf("/")+1)].params;1===fe.transparency&&(fe.transparency=0);const _e=wt&&wt.alphaChannelUsage,be=fe.transparency>0||"transparency"===_e||"maskAndTransparency"===_e,we=wt?O$u(wt.alphaChannelUsage):void 0,Se={ambient:e$3$(fe.diffuse),diffuse:e$3$(fe.diffuse),opacity:1-(fe.transparency||0),transparent:be,textureAlphaMode:we,textureAlphaCutoff:.33,textureId:St,initTextureTransparent:!0,doubleSided:!0,cullFace:vA.None,colorMixMode:fe.externalColorMixMode||"tint",textureAlphaPremultiplied:(null==wt?void 0:wt.parameters.preMultiplyAlpha)??!1};(null==ve?void 0:ve.materialParameters)&&Object.assign(Se,ve.materialParameters),Pt=new Rq(Se),Ee.set(Et,bt,Pt)}Te.push(Pt);const Ot=new pD(Pt,Re);Xe+=(null==(be=null==(_e=Re.find((fe=>fe[0]===nO.POSITION)))?void 0:_e[1])?void 0:be.indices.length)??0,we.push(Ot)}return{engineResources:[{name:Re,stageResources:{textures:Se,materials:Te,geometries:we},pivotOffset:Ce.model.pivotOffset,numberOfVertices:Xe,lodThreshold:null}],referenceBoundingBox:U$p(we)}}(fe,ve);return{lods:_e,referenceBoundingBox:we,isEsriSymbolResource:!1,isWosr:!0}}const we=await(ve.cache?ve.cache.loadGLTF(be.url,ve,!!ve.usePBR):l$1B(new Ere(ve.streamDataRequester),be.url,ve,ve.usePBR)),Se=null==(_e=we.model.meta)?void 0:_e.ESRI_proxyEllipsoid,Te=we.meta.isEsriSymbolResource&&null!=Se&&"EsriRealisticTreesStyle"===we.meta.ESRI_webstyle;Te&&!we.customMeta.esriTreeRendering&&(we.customMeta.esriTreeRendering=!0,function ae$5(fe,ve){for(let _e=0;_e<fe.model.lods.length;++_e){const be=fe.model.lods[_e];for(const we of be.parts){const be=we.attributes.normal;if(null==be)return;const Se=we.attributes.position,Te=Se.count,Ee=[0,0,0],Ce=[0,0,0],Oe=[0,0,0],Re=new Uint8Array(4*Te),De=new Float64Array(3*Te),Be=h$2A([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],we.transform);let Ze=0,Xe=0;for(let Je=0;Je<Te;Je++){Se.getVec(Je,Ce),be.getVec(Je,Ee),O$1v(Ce,Ce,we.transform),e$3Z(Oe,Ce,ve.center),i$4C(Oe,Oe,ve.radius);const Te=Oe[2],Qe=s$4g(Oe),dt=Math.min(.45+.55*Qe*Qe,1);i$4C(Oe,Oe,ve.radius),null!==Be&&O$1v(Oe,Oe,Be),z$1d(Oe,Oe),_e+1!==fe.model.lods.length&&fe.model.lods.length>1&&A$1G(Oe,Oe,Ee,Te>-1?.2:Math.min(-4*Te-3.8,1)),De[Ze]=Oe[0],De[Ze+1]=Oe[1],De[Ze+2]=Oe[2],Ze+=3,Re[Xe]=255*dt,Re[Xe+1]=255*dt,Re[Xe+2]=255*dt,Re[Xe+3]=255,Xe+=4}we.attributes.normal=new uL(De),we.attributes.color=new xL(Re)}}}(we,Se));const Ee=!!ve.usePBR,Ce=we.meta.isEsriSymbolResource?{usePBR:Ee,isSchematic:!1,treeRendering:Te,mrrFactors:[...eq]}:{usePBR:Ee,isSchematic:!1,treeRendering:!1,mrrFactors:[...QH]},Oe={...ve.materialParameters,treeRendering:Te},{engineResources:Re,referenceBoundingBox:De}=oe$6(we,Ce,Oe,ve.skipHighLods&&null==be.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:be.specifiedLodIndex});return{lods:Re,referenceBoundingBox:De,isEsriSymbolResource:we.meta.isEsriSymbolResource,isWosr:!1}}function re$4(fe){const ve=fe.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return ve?{fileType:"gltf",url:ve[1],specifiedLodIndex:null!=ve[4]?Number(ve[4]):null}:fe.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:fe,specifiedLodIndex:null}:{fileType:"unknown",url:fe,specifiedLodIndex:null}}function oe$6(fe,ve,_e,be){const we=fe.model,Se=new Array,Te=new Map,Ee=new Map,Ce=we.lods.length,Oe=P$$();return we.lods.forEach(((fe,Re)=>{const De=!0===be.skipHighLods&&(Ce>1&&0===Re||Ce>3&&1===Re)||!1===be.skipHighLods&&null!=be.singleLodIndex&&Re!==be.singleLodIndex;if(De&&0!==Re)return;const Be=new Xre(fe.name,fe.lodThreshold,[0,0,0]);fe.parts.forEach((fe=>{const be=De?new Rq({}):function se$5(fe,ve,_e,be,we,Se,Te){var Ee,Ce;const Oe=ve.material+(ve.attributes.normal?"_normal":"")+(ve.attributes.color?"_color":"")+(ve.attributes.texCoord0?"_texCoord0":"")+(ve.attributes.tangent?"_tangent":""),Re=fe.materials.get(ve.material),De=null!=ve.attributes.texCoord0,Be=null!=ve.attributes.normal;if(null==Re)return null;const Ze=function le$5(fe){switch(fe){case"BLEND":return SA.Blend;case"MASK":return SA.Mask;case"OPAQUE":case null:case void 0:return SA.Opaque}}(Re.alphaMode);if(!Se.has(Oe)){if(De){const t85=(ve,_e=!1)=>{if(null!=ve&&!Te.has(ve)){const be=fe.textures.get(ve);if(null!=be){const fe=be.data;Te.set(ve,new CZ(r$19(fe)?fe.data:fe,{...be.parameters,preMultiplyAlpha:!r$19(fe)&&_e,encoding:r$19(fe)&&null!=fe.encoding?fe.encoding:void 0}))}}};t85(Re.textureColor,Ze!==SA.Opaque),t85(Re.textureNormal),t85(Re.textureOcclusion),t85(Re.textureEmissive),t85(Re.textureMetallicRoughness)}const _e=Re.color[0]**(1/Qre),Xe=Re.color[1]**(1/Qre),Je=Re.color[2]**(1/Qre),Qe=Re.emissiveFactor[0]**(1/Qre),dt=Re.emissiveFactor[1]**(1/Qre),$t=Re.emissiveFactor[2]**(1/Qre),bt=null!=Re.textureColor&&De?Te.get(Re.textureColor):null,wt=u$1X({normalTexture:Re.textureNormal,metallicRoughnessTexture:Re.textureMetallicRoughness,metallicFactor:Re.metallicFactor,roughnessFactor:Re.roughnessFactor,emissiveTexture:Re.textureEmissive,emissiveFactor:Re.emissiveFactor,occlusionTexture:Re.textureOcclusion}),xt=null!=(null==(Ee=Re.normalTextureTransform)?void 0:Ee.scale)?null==(Ce=Re.normalTextureTransform)?void 0:Ce.scale:yd;Se.set(Oe,new Rq({...be,transparent:Ze===SA.Blend,customDepthTest:_A.Lequal,textureAlphaMode:Ze,textureAlphaCutoff:Re.alphaCutoff,diffuse:[_e,Xe,Je],ambient:[_e,Xe,Je],opacity:Re.opacity,doubleSided:Re.doubleSided,doubleSidedType:"winding-order",cullFace:Re.doubleSided?vA.None:vA.Back,hasVertexColors:!!ve.attributes.color,hasVertexTangents:!!ve.attributes.tangent,normalType:Be?wH.Attribute:wH.ScreenDerivative,castShadows:!0,receiveShadows:Re.receiveShadows,receiveAmbientOcclusion:Re.receiveAmbientOcclustion,textureId:null!=bt?bt.id:void 0,colorMixMode:Re.colorMixMode,normalTextureId:null!=Re.textureNormal&&De?Te.get(Re.textureNormal).id:void 0,textureAlphaPremultiplied:null!=bt&&!!bt.parameters.preMultiplyAlpha,occlusionTextureId:null!=Re.textureOcclusion&&De?Te.get(Re.textureOcclusion).id:void 0,emissiveTextureId:null!=Re.textureEmissive&&De?Te.get(Re.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=Re.textureMetallicRoughness&&De?Te.get(Re.textureMetallicRoughness).id:void 0,emissiveFactor:[Qe,dt,$t],mrrFactors:wt?[...KH]:[Re.metallicFactor,Re.roughnessFactor,be.mrrFactors[2]],isSchematic:wt,colorTextureTransformMatrix:s$1u(Re.colorTextureTransform),normalTextureTransformMatrix:s$1u(Re.normalTextureTransform),scale:[xt[0],xt[1]],occlusionTextureTransformMatrix:s$1u(Re.occlusionTextureTransform),emissiveTextureTransformMatrix:s$1u(Re.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:s$1u(Re.metallicRoughnessTextureTransform),...we}))}const Xe=Se.get(Oe);if(_e.stageResources.materials.push(Xe),De){const e77=fe=>{null!=fe&&_e.stageResources.textures.push(Te.get(fe))};e77(Re.textureColor),e77(Re.textureNormal),e77(Re.textureOcclusion),e77(Re.textureEmissive),e77(Re.textureMetallicRoughness)}return Xe}(we,fe,Be,ve,_e,Te,Ee),{geometry:Se,vertexCount:Ce}=function ie$5(fe,ve){const _e=fe.attributes.position.count,be=o$11(fe.indices||_e,fe.primitiveType),we=t$2G(3*_e),{typedBuffer:Se,typedBufferStride:Te}=fe.attributes.position;e$1T(we,Se,fe.transform,3,Te);const Ee=[[nO.POSITION,new Om(we,be,3,!0)]];if(null!=fe.attributes.normal){const ve=t$2G(3*_e),{typedBuffer:we,typedBufferStride:Se}=fe.attributes.normal;j$1r(Kre,fe.transform),f$1u(ve,we,Kre,3,Se),_$1y(Kre)&&l$2d(ve,ve),Ee.push([nO.NORMAL,new Om(ve,be,3,!0)])}if(null!=fe.attributes.tangent){const ve=t$2G(4*_e),{typedBuffer:we,typedBufferStride:Se}=fe.attributes.tangent;n$3X(Kre,fe.transform),n$1L(ve,we,Kre,4,Se),_$1y(Kre)&&l$2d(ve,ve,4),Ee.push([nO.TANGENT,new Om(ve,be,4,!0)])}if(null!=fe.attributes.texCoord0){const ve=t$2G(2*_e),{typedBuffer:we,typedBufferStride:Se}=fe.attributes.texCoord0;n$1I(ve,we,2,Se),Ee.push([nO.UV0,new Om(ve,be,2,!0)])}const Ce=fe.attributes.color;if(null!=Ce){const ve=new Uint8Array(4*_e);4===Ce.elementCount?Ce instanceof hL?s$1v(ve,Ce,255):Ce instanceof xL?t$1s(ve,Ce):Ce instanceof PL&&s$1v(ve,Ce,1/256):(ve.fill(255),Ce instanceof uL?o$1B(ve,Ce.typedBuffer,255,4,Ce.typedBufferStride):fe.attributes.color instanceof wL?t$1t(ve,Ce.typedBuffer,4,fe.attributes.color.typedBufferStride):fe.attributes.color instanceof EL&&o$1B(ve,Ce.typedBuffer,1/256,4,Ce.typedBufferStride)),Ee.push([nO.COLOR,new Om(ve,be,4,!0)])}return{geometry:new pD(ve,Ee),vertexCount:_e}}(fe,null!=be?be:new Rq({})),Ze=Se.boundingInfo;null!=Ze&&0===Re&&(h$2e(Oe,Ze.bbMin),h$2e(Oe,Ze.bbMax)),null!=be&&(Be.stageResources.geometries.push(Se),Be.numberOfVertices+=Ce)})),De||Se.push(Be)})),{engineResources:Se,referenceBoundingBox:Oe}}const Kre=[1,0,0,0,1,0,0,0,1];const eie=Object.freeze(Object.defineProperty({__proto__:null,fetch:te$4,gltfToEngineResources:oe$6,parseUrl:re$4},Symbol.toStringTag,{value:"Module"})),e$1l=()=>!!has("enable-feature:force-wosr"),a$1x=()=>!!has("enable-feature:direct-3d-object-feature-layer-display"),r$12=()=>!!has("enable-i3s-patching"),n$1E=()=>!!has("enable-feature:SceneLayer-editing");((fe="i3s-patching")=>{switch(has.add("enable-i3s-patching",!1,!0,!0),has.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),has.add("enable-feature:SceneLayer-editing",!0,!0,!0),fe){case"feature-layer-view":has.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0);break;case"i3s-patching":has.add("enable-i3s-patching",!0,!0,!0)}})("i3s-patching");let tie={};function i$1x(fe,ve,_e){var be;const we=null!=ve.portal?ve.portal:Gv.getDefault();let Se;const Te=`${we.url} - ${null==(be=we.user)?void 0:be.username} - ${fe}`;return tie[Te]||(tie[Te]=function m$1f(fe,ve,_e){return ve.load(_e).then((()=>{const be=new Ov({disableExtraQuery:!0,query:`owner:${rie} AND type:${iie} AND typekeywords:"${fe}"`});return ve.queryItems(be,_e)})).then((({results:ve})=>{var be;let we=null;const Se=fe.toLowerCase();if(ve&&Array.isArray(ve))for(const fe of ve){if((null==(be=fe.typeKeywords)?void 0:be.some((fe=>fe.toLowerCase()===Se)))&&fe.type===iie&&fe.owner===rie){we=fe;break}}if(!we)throw new Ir("symbolstyleutils:style-not-found",`The style '${fe}' could not be found`,{styleName:fe});return we.load(_e)}))}(fe,we,_e).then((fe=>(Se=fe,fe.fetchData()))).then((ve=>({data:ve,baseUrl:Se.itemUrl??"",styleName:fe})))),tie[Te]}function y$P(fe,ve,_e){return null!=(null==fe?void 0:fe.styleUrl)?async function f$Z(fe,ve){try{return{data:(await b$H(fe,ve)).data,baseUrl:Rt$3(fe),styleUrl:fe}}catch(_e){return a$4D(_e),null}}(fe.styleUrl,_e):null!=(null==fe?void 0:fe.styleName)?i$1x(fe.styleName,ve,_e):Promise.reject(new Ir("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p$1P(fe){return null===fe||"CIMSymbolReference"===fe.type?fe:{type:"CIMSymbolReference",symbol:fe}}function d$16(fe,ve,_e=["gltf"]){if("cimRef"===ve)return encodeURI(fe.cimRef);if(fe.formatInfos&&!e$1l())for(const be of _e){const ve=fe.formatInfos.find((fe=>fe.type===be));if(ve)return ve.href}return encodeURI(fe.webRef)}function b$H(fe,ve){const _e={responseType:"json",query:{f:"json"},...ve};return U$1a(K$I(fe),_e)}const rie="esri_en",iie="Style",nie="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",sie=eT.fromSimpleMarkerSymbol(J6),oie=NS.fromSimpleLineSymbol(Q6),aie=nT.fromSimpleFillSymbol(K6),lie=new BS({symbolLayers:new Wa([new mx({material:{color:H6},edges:new _w({size:e$3N(1),color:new b_([153,153,153,255])})})])}),cie=new NS({symbolLayers:new Wa([new zx({material:{color:new b_([0,0,0])},size:e$3N(1)})])}),uie=new nT({symbolLayers:new Wa([new mx({outline:{color:new b_([0,0,0]),size:e$3N(1)}})])});function d$15(fe){if(null==fe)return null;switch(fe.type){case"mesh":return lie;case"point":case"multipoint":return sie;case"polyline":return oie;case"polygon":case"extent":return aie}return null}const hie={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function g$O(fe,ve=hie){var _e,be,we,Se;if(!fe)return{symbol:null};const{retainId:Te=hie.retainId,ignoreDrivers:Ee=hie.ignoreDrivers,hasLabelingContext:Ce=hie.hasLabelingContext,retainCIM:Oe=hie.retainCIM,cimFallbackEnabled:Re=hie.cimFallbackEnabled}=ve;let De=null;if(x$1h(fe)||fe instanceof vT)De=fe.clone();else if("cim"===fe.type){const Te=null==(be=null==(_e=fe.data)?void 0:_e.symbol)?void 0:be.type;switch(Te){case"CIMPointSymbol":De=Oe?fe.clone():eT.fromCIMSymbol(fe);break;case"CIMLineSymbol":Re&&(De=cie.clone(),null==(we=null==ve?void 0:ve.logWarning)||we.call(ve,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":Re&&(De=uie.clone(),null==(Se=null==ve?void 0:ve.logWarning)||Se.call(ve,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!De)return{error:new Ir("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${Te||"unknown"}' is unsupported in 3D`,{symbol:fe})}}else if(fe instanceof Dw)De=NS.fromSimpleLineSymbol(fe);else if(fe instanceof dT)De=eT.fromSimpleMarkerSymbol(fe);else if(fe instanceof XS)De=eT.fromPictureMarkerSymbol(fe);else if(fe instanceof lT)De=ve.geometryType&&"mesh"===ve.geometryType?BS.fromSimpleFillSymbol(fe):nT.fromSimpleFillSymbol(fe);else{if(!(fe instanceof mT))return{error:new Ir("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${fe.type||fe.declaredClass}' is unsupported in 3D`,{symbol:fe})};De=Ce?MS.fromTextSymbol(fe):eT.fromTextSymbol(fe)}return Te&&De&&"cim"!==De.type&&(De.id=fe.id),Ee&&x$1h(De)&&De.symbolLayers.forEach((fe=>fe.ignoreDrivers=!0)),{symbol:De}}function l$1z(fe,ve,_e,be){const we=a$1w(fe,{},{context:be,isLabelSymbol:!1});null!=we&&(ve[_e]=we)}function i$1w(fe,ve,_e,be){const we=a$1w(fe,{},{context:be,isLabelSymbol:!0});null!=we&&(ve[_e]=we)}function m$1e(fe){return fe instanceof mS||fe instanceof vT}function a$1w(fe,ve,_e){if(null==fe)return null;const{context:be,isLabelSymbol:we}=_e,Se=null==be?void 0:be.origin,Te=null==be?void 0:be.messages;if("web-scene"===Se&&!m$1e(fe)){const _e=g$O(fe,{retainCIM:!0,hasLabelingContext:we});return null!=_e.symbol?_e.symbol.write(ve,be):(null==Te||Te.push(new Ir("symbol:unsupported",`Symbols of type '${fe.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:fe,context:be,error:_e.error})),null)}return("web-map"===Se||"portal-item"===Se&&!b$1W(null==be?void 0:be.layer))&&m$1e(fe)?(null==Te||Te.push(new Ir("symbol:unsupported",`Symbols of type '${fe.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:fe,context:be})),null):fe.write(ve,be)}function b$F(fe,ve){return ST(fe,null,ve)}function j$B(fe,ve){return ve.items.find((ve=>ve.name===fe))}function h$R(fe,ve,_e,be,we,Se){var Te,Ee;const Ce=null!=(null==_e?void 0:_e.portal)?_e.portal:Gv.getDefault(),Oe={portal:Ce,url:I$1E(fe.baseUrl),origin:"portal-item"},Re=j$B(ve,fe.data);if(!Re){const fe=`The symbol name '${ve}' could not be found`;return Promise.reject(new Ir("symbolstyleutils:symbol-name-not-found",fe,{symbolName:ve}))}let De=u$37(we(Re,be),Oe),Be=(null==(Te=Re.thumbnail)?void 0:Te.href)??null;const Ze=null==(Ee=Re.thumbnail)?void 0:Ee.imageData;(function c$1E(fe){return fe=fe||globalThis.location.hostname,Tre.some((ve=>null!=(null==fe?void 0:fe.match(ve))))})()&&(De=a$1z(De)??"",Be=a$1z(Be));const Xe={portal:Ce,url:I$1E(Rt$3(De)),origin:"portal-item"};return b$H(De,Se).then((we=>{const Se=b$F("cimRef"===be?p$1P(we.data):we.data,Xe);if(Se&&x$1h(Se)){if(Be){const fe=u$37(Be,Oe);Se.thumbnail=new hS({url:fe})}else Ze&&(Se.thumbnail=new hS({url:`data:image/png;base64,${Ze}`}));fe.styleUrl?Se.styleOrigin=new cS({portal:_e.portal,styleUrl:fe.styleUrl,name:ve}):fe.styleName&&(Se.styleOrigin=new cS({portal:_e.portal,styleName:fe.styleName,name:ve}))}return Se}))}const die=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:h$R,getStyleItemFromStyle:j$B,resolveWebStyleSymbol:function g$N(fe,ve,_e,be){const we=fe.name;return null==we?Promise.reject(new Ir("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):fe.styleName&&"Esri2DPointSymbolsStyle"===fe.styleName?function d$14(fe,ve,_e){const be=nie.replaceAll(/\{SymbolName\}/gi,fe),we=null!=ve.portal?ve.portal:Gv.getDefault();return b$H(be,_e).then((fe=>b$F(p$1P(fe.data),{portal:we,url:I$1E(Rt$3(be)),origin:"portal-item"})))}(we,ve,be):y$P(fe,ve,be).then((fe=>h$R(fe,we,ve,_e,d$16,be)))}},Symbol.toStringTag,{value:"Module"}));let pie=class r43{constructor(fe,ve,_e){this._elementSize=ve,this._buffer=rM.createVertex(fe,QO.STATIC_DRAW),this.resize(_e)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(fe,ve,_e,be=0){const we=new Uint8Array(this.array,fe*this.elementSize,(ve-fe)*this.elementSize);new Uint8Array(_e.array,be*this.elementSize).set(we)}transferAll(){this._buffer.setData(this._array)}transferRange(fe,ve){const _e=fe*this._elementSize,be=ve*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),_e,_e,be)}resize(fe){const ve=fe*this._elementSize,_e=new ArrayBuffer(ve);this._array&&(fe>=this._capacity?new Uint8Array(_e).set(new Uint8Array(this._array)):new Uint8Array(_e).set(new Uint8Array(this._array).subarray(0,fe*this._elementSize))),this._array=_e,this._buffer.setSize(ve),this._capacity=fe}},fie=class c33{constructor(fe){this.modelOriginHi=fe.getField(nO.INSTANCEMODELORIGINHI,uL),this.modelOriginLo=fe.getField(nO.INSTANCEMODELORIGINLO,uL),this.model=fe.getField(nO.INSTANCEMODEL,dL),this.modelNormal=fe.getField(nO.INSTANCEMODELNORMAL,dL),this.featureAttribute=fe.getField(nO.INSTANCEFEATUREATTRIBUTE,hL),this.color=fe.getField(nO.INSTANCECOLOR,xL),this.objectAndLayerIdColor=fe.getField(nO.INSTANCEOBJECTANDLAYERIDCOLOR,xL)}},mie=class f11{constructor(fe,ve){this._rctx=fe,this._instanceBufferLayout=ve,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const fe=this._headIndex,ve=this._tailIndex;return fe>=ve?fe-ve:fe+this._capacity-ve}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var fe;return(null==(fe=this._buffer)?void 0:fe.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){s$31(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){s$31(this._updating,"not updating"),this.size<.5*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){s$31(this._updating,"not updating"),this.isFull&&this._grow();const fe=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=fe,this._captureFirstIndex=!1),this._incrementHead(),s$31(this._headIndex!==this._tailIndex,"invalid pointers"),fe}freeTail(){s$31(this._updating,"not updating"),s$31(this.size>0,"invalid size");const fe=this._tailIndex===this._firstIndex;this._incrementTail(),fe&&(this._firstIndex=this._tailIndex)}_grow(){const fe=Math.max(yie,Math.floor(this._capacity*Ht));this._resize(fe)}_shrink(){const fe=Math.max(yie,Math.floor(this._capacity*qt));this._resize(fe)}_resize(fe){if(s$31(this._updating,"not updating"),fe===this._capacity)return;const ve=new pie(this._rctx,this._instanceBufferLayout.stride,fe);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const fe=this.size,_e=this._compactInstances(ve);s$31(_e===fe,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=_e,this._prevHeadIndex=0}this._resized=!0,this._capacity=fe,this._buffer=ve,this._view=new fie(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(fe){const ve=this._headIndex,_e=this._tailIndex;return _e<ve?(this._buffer.copyRange(_e,ve,fe),ve-_e):_e>ve?(this._buffer.copyRange(_e,this._capacity,fe),ve>0&&this._buffer.copyRange(0,ve,fe,this._capacity-_e),ve+(this._capacity-_e)):0}_incrementHead(fe=1){this._headIndex=(this._headIndex+fe)%this._capacity}_incrementTail(fe=1){this._tailIndex=(this._tailIndex+fe)%this._capacity}_transferRange(fe,ve){fe<ve?this._buffer.transferRange(fe,ve):fe>ve&&(ve>0&&this._buffer.transferRange(0,ve),this._buffer.transferRange(fe,this._capacity))}};const yie=64;var gie;!function(fe){fe[fe.ALLOCATED=1]="ALLOCATED",fe[fe.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",fe[fe.VISIBLE=4]="VISIBLE",fe[fe.HIGHLIGHT=8]="HIGHLIGHT",fe[fe.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",fe[fe.REMOVE=32]="REMOVE",fe[fe.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",fe[fe.ACTIVE=18]="ACTIVE"}(gie||(gie={}));let vie=class R4{constructor(fe){this.localTransform=fe.getField(nO.LOCALTRANSFORM,mL),this.globalTransform=fe.getField(nO.GLOBALTRANSFORM,mL),this.modelOrigin=fe.getField(nO.MODELORIGIN,vL),this.model=fe.getField(nO.INSTANCEMODEL,dL),this.modelNormal=fe.getField(nO.INSTANCEMODELNORMAL,dL),this.modelScaleFactors=fe.getField(nO.MODELSCALEFACTORS,cL),this.boundingSphere=fe.getField(nO.BOUNDINGSPHERE,_L),this.featureAttribute=fe.getField(nO.FEATUREATTRIBUTE,hL),this.color=fe.getField(nO.COLOR,xL),this.objectAndLayerIdColor=fe.getField(nO.OBJECTANDLAYERIDCOLOR,xL),this.state=fe.getField(nO.STATE,$L),this.lodLevel=fe.getField(nO.LODLEVEL,$L)}},_ie=class b11 extends zi{constructor(fe,ve){super(fe),this.events=new La,this._capacity=0,this._size=0,this._next=0,this._layout=function C$s(fe){let ve=H$J().mat4f64(nO.LOCALTRANSFORM).mat4f64(nO.GLOBALTRANSFORM).vec4f64(nO.BOUNDINGSPHERE).vec3f64(nO.MODELORIGIN).mat3f(nO.INSTANCEMODEL).mat3f(nO.INSTANCEMODELNORMAL).vec2f(nO.MODELSCALEFACTORS);return fe.includes(nO.FEATUREATTRIBUTE)&&(ve=ve.vec4f(nO.FEATUREATTRIBUTE)),fe.includes(nO.COLOR)&&(ve=ve.vec4u8(nO.COLOR)),fe.includes(nO.OBJECTANDLAYERIDCOLOR)&&(ve=ve.vec4u8(nO.OBJECTANDLAYERIDCOLOR)),ve=ve.u8(nO.STATE).u8(nO.LODLEVEL),ve}(ve),this._capacity=yie,this._buffer=this._layout.createBuffer(this._capacity),this._view=new vie(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const fe=this._findSlot();return this._view.state.set(fe,gie.ALLOCATED),this._size++,this.events.emit("instances-changed"),fe}removeInstance(fe){const ve=this._view.state;s$31(fe>=0&&fe<this._capacity&&!!(ve.get(fe)&gie.ALLOCATED),"invalid instance handle"),this._getStateFlag(fe,gie.ACTIVE)?this._setStateFlags(fe,gie.REMOVE):this.freeInstance(fe),this.events.emit("instances-changed")}freeInstance(fe){const ve=this._view.state;s$31(fe>=0&&fe<this._capacity&&!!(ve.get(fe)&gie.ALLOCATED),"invalid instance handle"),ve.set(fe,0),this._size--}setLocalTransform(fe,ve,_e=!0){this._view.localTransform.setMat(fe,ve),_e&&this.updateModelTransform(fe)}getLocalTransform(fe,ve){this._view.localTransform.getMat(fe,ve)}setGlobalTransform(fe,ve,_e=!0){this._view.globalTransform.setMat(fe,ve),_e&&this.updateModelTransform(fe)}getGlobalTransform(fe,ve){this._view.globalTransform.getMat(fe,ve)}updateModelTransform(fe){const ve=this._view,_e=$ie,be=bie;ve.localTransform.getMat(fe,wie),ve.globalTransform.getMat(fe,xie);const we=c$4k(xie,xie,wie);o$44(_e,we[12],we[13],we[14]),ve.modelOrigin.setVec(fe,_e),n$3X(be,we),ve.model.setMat(fe,be);const Se=function g$2a(fe,ve){return o$44(fe,Math.sqrt(ve[0]*ve[0]+ve[4]*ve[4]+ve[8]*ve[8]),Math.sqrt(ve[1]*ve[1]+ve[5]*ve[5]+ve[9]*ve[9]),Math.sqrt(ve[2]*ve[2]+ve[6]*ve[6]+ve[10]*ve[10])),fe}($ie,we);Se.sort(),ve.modelScaleFactors.set(fe,0,Se[1]),ve.modelScaleFactors.set(fe,1,Se[2]),s$3F(be,be),u$3n(be,be),ve.modelNormal.setMat(fe,be),this._setStateFlags(fe,gie.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:fe})}getModelTransform(fe,ve){const _e=this._view;_e.model.getMat(fe,bie),_e.modelOrigin.getVec(fe,$ie),ve[0]=bie[0],ve[1]=bie[1],ve[2]=bie[2],ve[3]=0,ve[4]=bie[3],ve[5]=bie[4],ve[6]=bie[5],ve[7]=0,ve[8]=bie[6],ve[9]=bie[7],ve[10]=bie[8],ve[11]=0,ve[12]=$ie[0],ve[13]=$ie[1],ve[14]=$ie[2],ve[15]=1}applyShaderTransformation(fe,ve){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,fe,ve)}getCombinedModelTransform(fe,ve){return this.getModelTransform(fe,ve),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,fe,ve),ve}getCombinedLocalTransform(fe,ve){this._view.localTransform.getMat(fe,ve),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,fe,ve)}getCombinedMaxScaleFactor(fe){let ve=this._view.modelScaleFactors.get(fe,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor($ie,this,fe),ve*=Math.max($ie[0],$ie[1],$ie[2])),ve}getCombinedMedianScaleFactor(fe){let ve=this._view.modelScaleFactors.get(fe,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor($ie,this,fe),ve*=function w$I(fe,ve,_e){return Math.max(Math.min(fe,ve),Math.min(Math.max(fe,ve),_e))}($ie[0],$ie[1],$ie[2])),ve}getModel(fe,ve){this._view.model.getMat(fe,ve)}setFeatureAttribute(fe,ve){this._view.featureAttribute.setVec(fe,ve)}getFeatureAttribute(fe,ve){this._view.featureAttribute.getVec(fe,ve)}setColor(fe,ve){this._view.color.setVec(fe,ve)}setObjectAndLayerIdColor(fe,ve){this._view.objectAndLayerIdColor.setVec(fe,ve)}setVisible(fe,ve){ve!==this.getVisible(fe)&&(this._setStateFlag(fe,gie.VISIBLE,ve),this.events.emit("instance-visibility-changed",{index:fe}))}getVisible(fe){return this._getStateFlag(fe,gie.VISIBLE)}setHighlight(fe,ve){ve!==this.getHighlight(fe)&&(this._setStateFlag(fe,gie.HIGHLIGHT,ve),this.events.emit("instance-highlight-changed"))}getHighlight(fe){return this._getStateFlag(fe,gie.HIGHLIGHT)}getState(fe){return this._view.state.get(fe)}getLodLevel(fe){return this._view.lodLevel.get(fe)}countFlags(fe){let ve=0;for(let _e=0;_e<this._capacity;++_e)this.getState(_e)&fe&&++ve;return ve}_setStateFlags(fe,ve){const _e=this._view.state;ve=_e.get(fe)|ve,_e.set(fe,ve)}_clearStateFlags(fe,ve){const _e=this._view.state;ve=_e.get(fe)&~ve,_e.set(fe,ve)}_setStateFlag(fe,ve,_e){_e?this._setStateFlags(fe,ve):this._clearStateFlags(fe,ve)}_getStateFlag(fe,ve){return!!(this._view.state.get(fe)&ve)}_grow(){this._capacity=Math.max(yie,Math.floor(this._capacity*Ht)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new vie(this._buffer)}_findSlot(){const fe=this._view.state;let ve=this._next;for(;fe.get(ve)&gie.ALLOCATED;)ve=ve+1===this._capacity?0:ve+1;return this._next=ve+1===this._capacity?0:ve+1,ve}};e$4o([y$2v({constructOnly:!0})],_ie.prototype,"shaderTransformation",void 0),e$4o([y$2v()],_ie.prototype,"_size",void 0),e$4o([y$2v({readOnly:!0})],_ie.prototype,"size",null),_ie=e$4o([a$4y("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],_ie);const $ie=[0,0,0],bie=[1,0,0,0,1,0,0,0,1],wie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let Sie=class n31 extends JY{constructor(fe,ve){super((fe=>this._instanceData.view.boundingSphere.getVec(fe,this._tmpSphere)),{maximumDepth:25}),this._instanceData=fe,this._boundingSphere=ve,this._tmpSphere=[0,0,0,0],this._tmpMat4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}addInstance(fe){const ve=this._instanceData.view.boundingSphere,_e=this._instanceData.getCombinedModelTransform(fe,this._tmpMat4);O$1v(this._tmpSphere,this._boundingSphere.center,_e),this._tmpSphere[3]=this._boundingSphere.radius*m$3g(_e),ve.setVec(fe,this._tmpSphere),this.add([fe])}removeInstance(fe){this.remove([fe])}},Tie=class e45{constructor(fe,ve){this._worldSpaceRadius=fe,this._minScreenSpaceRadii=ve}selectLevel(fe,ve,_e){const be=_e.computeScreenPixelSizeAt(fe),we=this._worldSpaceRadius*ve/be;let Se=0;for(let Te=1;Te<this._minScreenSpaceRadii.length;++Te)we>=this._minScreenSpaceRadii[Te]&&(Se=Te);return Se}},Eie=class s56 extends tm{constructor(fe,ve,_e,be,we,Se){super(fe,ve),this.layerUid=fe,this.graphicUid=ve,this.geometryId=_e,this.triangleNr=be,this.baseBoundingSphere=we,this.numLodLevels=Se}};function i$1v(fe){return o$3p(fe)&&fe.intersector===Zf.LOD&&!!fe.target}let Pie=class u18{constructor(fe,ve){const _e=fe.renderContext.rctx,be=ve.geometry;this._materials=fe.materials,be.material.setParameters({instancedDoublePrecision:!0});const we=be.material.createBufferWriter(),Se=we.vertexBufferLayout,Te=we.elementCount(be),Ee=Se.createBuffer(Te);we.write(null,null,be,Ee,0),this.geometry=be,this.material=be.material,this.glMaterials=new QX(be.material,this._materials),this.vertexBufferLayout=Se,this.vbo=rM.createVertex(_e,QO.STATIC_DRAW,Ee.buffer),this.vao=new tM(_e,mA,{geometry:t$2L(Se)},{geometry:this.vbo}),this.vertexCount=Te}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(fe,ve,_e,be,we,Se,Te,Ee){const Ce=this.geometry.id;this.material.intersect(this.geometry,fe.transform.transform,fe,_e,be,((_e,be,Oe,Re,De)=>{if(_e>=0){if(null!=ve&&!ve(fe.rayBegin,fe.rayEnd,_e))return;const Re=new Eie(Se.layerUid,Se.graphicUid(we),Ce,Oe,Te,Ee);if((null==fe.results.min.drapedLayerOrder||De>=fe.results.min.drapedLayerOrder)&&(null==fe.results.min.dist||_e<fe.results.min.dist)&&fe.results.min.set(Zf.LOD,Re,_e,be,fe.transform.transform,De),fe.options.store!==Xf.MIN&&(null==fe.results.max.drapedLayerOrder||De>=fe.results.max.drapedLayerOrder)&&(null==fe.results.max.dist||_e>fe.results.max.dist)&&fe.results.max.set(Zf.LOD,Re,_e,be,fe.transform.transform,De),fe.options.store===Xf.ALL){const ve=G$I(fe.results.min.ray);ve.set(Zf.LOD,Re,_e,be,fe.transform.transform,De),fe.results.all.push(ve)}}}))}},Cie=class a30{static async create(fe,ve,_e){const be=await Promise.allSettled(ve.components.map((ve=>fe.controller.schedule((()=>new Pie(fe,ve)),_e)))),we=be.map((fe=>"fulfilled"===fe.status?fe.value:null)).filter(O$1y);if(c$4_(_e)||we.length!==be.length){we.forEach((fe=>fe.destroy())),s$4o(_e);for(const fe of be)if("rejected"===fe.status)throw fe.reason}return new a30(ve.minScreenSpaceRadius,we)}constructor(fe,ve){this.minScreenSpaceRadius=fe,this.components=ve}destroy(){this.components.forEach((fe=>fe.destroy()))}intersect(fe,ve,_e,be,we,Se,Te){this.components.forEach((Ee=>Ee.intersect(fe,ve,_e,be,we,Se,this.boundingSphere,Te)))}get boundingBox(){if(null==this._boundingBox){const fe=P$$();this.components.forEach((ve=>{null!=ve.boundingInfo&&(h$2e(fe,ve.boundingInfo.bbMin),h$2e(fe,ve.boundingInfo.bbMax))})),this._boundingBox=fe}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const fe=this.boundingBox,ve=[0,0,0];E$1m(fe,ve),this._boundingSphere={center:ve,radius:.5*T$12(fe)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((fe,ve)=>fe+ve.triangleCount),0)}};let Oie=class B6 extends RN{constructor(fe,ve){super(fe),this.type=Zf.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new NR,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>this._produces(fe)],[qR.TRANSPARENT_MATERIAL,fe=>!!this._hasTransparentLevels()&&this._produces(fe)]]),this._instanceData=new _ie({shaderTransformation:fe.shaderTransformation},fe.optionalFields),this.addHandles(ve.registerTask(gI.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=function q$h(fe){let ve=H$J().vec3f(nO.INSTANCEMODELORIGINHI).vec3f(nO.INSTANCEMODELORIGINLO).mat3f(nO.INSTANCEMODEL).mat3f(nO.INSTANCEMODELNORMAL);return null!=fe&&fe.includes("featureAttribute")&&(ve=ve.vec4f(nO.INSTANCEFEATUREATTRIBUTE)),null!=fe&&fe.includes("color")&&(ve=ve.vec4u8(nO.INSTANCECOLOR)),null!=fe&&fe.includes("objectAndLayerIdColor")&&(ve=ve.vec4u8(nO.INSTANCEOBJECTANDLAYERIDCOLOR)),ve}(this.optionalFields),this._glInstanceBufferLayout=t$2L(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:fe})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(fe)})),this._instanceData.events.on("instance-visibility-changed",(({index:fe})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(fe)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(fe){this._slicePlane=fe}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce(((fe,ve)=>ve.reduce(((fe,ve)=>fe+ve.usedMemory),fe)),0)}get renderStats(){const fe=this._instanceData.size,ve=[];return this._levels.forEach(((fe,_e)=>{const be=this._allRenderInstanceData[0][_e].size+this._allRenderInstanceData[1][_e].size,we=fe.triangleCount;ve.push({renderedInstances:be,renderedTriangles:be*we,trianglesPerInstance:we})})),{totalInstances:fe,renderedInstances:ve.reduce(((fe,ve)=>fe+ve.renderedInstances),0),renderedTriangles:ve.reduce(((fe,ve)=>fe+ve.renderedTriangles),0),levels:ve}}async initializeRenderContext(fe,ve){this._context=fe;const _e=fe.renderContext.rctx,be=await Promise.allSettled(this.symbol.levels.map((be=>(this._defaultRenderInstanceData[0].push(new mie(_e,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new mie(_e,this._instanceBufferLayout)),Cie.create(fe,be,ve))))),we=be.map((fe=>"fulfilled"===fe.status?fe.value:null)).filter(O$1y);if(c$4_(ve)||we.length!==be.length){we.forEach((fe=>fe.destroy())),s$4o(ve);for(const fe of be)if("rejected"===fe.status)throw fe.reason}this._levels=we,this._levelSelector=(fe=>{const ve=fe.baseBoundingSphere.radius,_e=fe.levels.map((fe=>fe.minScreenSpaceRadius));return new Tie(ve,_e)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((fe=>fe.destroy())),this._defaultRenderInstanceData[0].forEach((fe=>fe.destroy())),this._highlightRenderInstanceData[0].forEach((fe=>fe.destroy()))}_hasTransparentLevels(){return this._levels.some((fe=>fe.components.some((fe=>{const ve=fe.material.produces.get(qR.TRANSPARENT_MATERIAL);return null==ve?void 0:ve(NI.Color)}))))}hasHighlights(){return this._highlightRenderInstanceData[0].some((fe=>fe.size>0))}_produces(fe){return fe!==NI.Highlight&&fe!==NI.ShadowHighlight||this.hasHighlights()}prepareRender(fe){if(!_B.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const ve=fe.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(fe.bindParameters.contentCamera),ve||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(wI),this._needFullCycle=!1)}}prepareTechniques(fe){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(fe.output))return null;const ve=this._getInstanceDatas(fe.output);if(!ve)return null;const _e=new Array;return ve.forEach((ve=>this.levels.forEach(((be,we)=>{be.components.forEach((be=>_e.push(this._beginComponent(fe,ve[we],be))))})))),_e}renderNode(fe,ve){const _e=this._getInstanceDatas(fe.output);if(!_e||null==ve)return;let be=0;fe.rctx.bindVAO(),_e.forEach((_e=>this.levels.forEach(((we,Se)=>{we.components.forEach((we=>this._renderComponent(fe,ve[be++],_e[Se],we,Se)))}))))}_getInstanceDatas(fe){const ve=fe!==NI.Highlight&&fe!==NI.ShadowHighlight,_e=fe!==NI.ShadowExcludeHighlight;return ve&&_e?this._allRenderInstanceData:ve?this._defaultRenderInstanceData:_e?this._highlightRenderInstanceData:null}intersect(fe,ve,_e,be){if(!this.baseMaterial.isVisible()||null==this._octree)return;const we=[0,0,0];e$3Z(we,be,_e);const n52=we=>{this._instanceData.getCombinedModelTransform(we,Rie),fe.transform.set(Rie),O$1v(Iie,_e,fe.transform.inverse),O$1v(Lie,be,fe.transform.inverse);const Se=this._instanceData.getState(we),Te=this._instanceData.getLodLevel(we),Ee=this._levels.length;s$31(!!(Se&gie.ACTIVE),"invalid instance state"),s$31(Te>=0&&Te<Ee,"invaid lod level"),this._levels[Te].intersect(fe,ve,Iie,Lie,we,this.metadata,Ee)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(n52):this._octree.forEachAlongRay(_e,we,n52)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var fe;if(null==this._octreeCached){const ve=this._instanceData,_e=null==(fe=ve.view)?void 0:fe.state;if(!_e)return null;this._octreeCached=new Sie(ve,this.baseBoundingSphere);for(let fe=0;fe<ve.capacity;++fe)_e.get(fe)&gie.ACTIVE&&this._octreeCached.addInstance(fe)}return this._octreeCached}_invalidateOctree(){this._octreeCached=u$4d(this._octreeCached)}queryDepthRange(fe){if(null==this._octree)return{near:1/0,far:-1/0};const ve=fe.viewForward,_e=this._octree.findClosest(ve,JY.DepthOrder.FRONT_TO_BACK,fe.frustum),be=this._octree.findClosest(ve,JY.DepthOrder.BACK_TO_FRONT,fe.frustum);if(null==_e||null==be)return{near:1/0,far:-1/0};const we=fe.eye,Se=this._instanceData.view;Se.boundingSphere.getVec(_e,Mie),e$3Z(Mie,Mie,we);const Te=P$1g(Mie,ve)-Mie[3];Se.boundingSphere.getVec(be,Mie),e$3Z(Mie,Mie,we);const Ee=P$1g(Mie,ve)+Mie[3];return{near:Math.max(fe.near,Te),far:Math.min(fe.far,Ee)}}_requestUpdateCycle(fe=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,fe&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((fe=>fe.forEach((fe=>fe.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(fe){const{_enableLevelSelection:ve,_camera:_e,_levelSelector:be}=this;this._allRenderInstanceData.forEach((fe=>fe.forEach((fe=>fe.beginUpdate()))));const we=this._instanceData,Se=we.view;let Te=we.size;const Ee=we.capacity;let Ce=this._instanceIndex;const Oe=Math.ceil(Ee/500);for(let Re=0;Re<Te&&!fe.done;++Re){Ce===this._cycleStartIndex&&this._startUpdateCycle();const Re=Se.state.get(Ce);let De=0;if(!(Re&gie.ALLOCATED)){Ce=Ce+1===Ee?0:Ce+1,Te++;continue}const Be=Se.lodLevel.get(Ce);if(Re&gie.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][Be].freeTail(),Re&gie.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][Be].freeTail(),Re&gie.REMOVE)we.freeInstance(Ce);else if(Re&gie.VISIBLE){let fe=0;ve&&(Se.modelOrigin.getVec(Ce,Aie),fe=be.selectLevel(Aie,we.getCombinedMedianScaleFactor(Ce),_e)),De=Re&~(gie.ACTIVE|gie.TRANSFORM_CHANGED),fe>=0&&(Re&gie.HIGHLIGHT?(P$n(this._highlightRenderInstanceData[0][fe],Se,Ce),De|=gie.HIGHLIGHT_ACTIVE):(P$n(this._defaultRenderInstanceData[0][fe],Se,Ce),De|=gie.DEFAULT_ACTIVE)),Se.state.set(Ce,De),Se.lodLevel.set(Ce,fe)}else De=Re&~(gie.ACTIVE|gie.TRANSFORM_CHANGED),Se.state.set(Ce,De);if(null!=this._octreeCached){const fe=!!(Re&gie.ACTIVE),ve=!!(De&gie.ACTIVE);!fe&&ve?this._octreeCached.addInstance(Ce):fe&&!ve?this._octreeCached.removeInstance(Ce):fe&&ve&&Re&gie.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(Ce),this._octreeCached.addInstance(Ce))}Ce=Ce+1===Ee?0:Ce+1,Ce%Oe==0&&fe.madeProgress()}this._instanceIndex=Ce,this._allRenderInstanceData.forEach((fe=>fe.forEach((fe=>fe.endUpdate())))),this._context.requestRender()}_beginComponent(fe,ve,_e){if(0===ve.size)return null;const be=_e.glMaterials.load(fe.rctx,fe.bindParameters.slot,fe.output);return null!=be?be.beginSlot(fe.bindParameters):null}_renderComponent(fe,ve,_e,be,we){if(!ve)return;const{bindParameters:Se,rctx:Te}=fe;Te.runAppleAmdDriverHelper();const Ee=Te.bindTechnique(ve,Se,be.material.parameters,Nie);Te.bindVAO(be.vao),ve.ensureAttributeLocations(be.vao),_B.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&fe.output===NI.Color&&(Ee.setUniform4fv("externalColor",Die[Math.min(we,Die.length-1)]),Ee.setUniform1i("colorMixMode",JB.replace));const Ce=_e.capacity,Oe=_e.headIndex,Re=_e.tailIndex,De=_e.firstIndex,Be=this._glInstanceBufferLayout,m39=(fe,we)=>{E$1f(Te,mA,_e.buffer,Be,fe),Te.drawArraysInstanced(ve.primitiveType,0,be.vertexCount,we-fe),_$_(Te,mA,_e.buffer,Be)};be.material.parameters.transparent&&null!=De?Oe>Re?(s$31(De>=Re&&De<=Oe,"invalid firstIndex"),m39(De,Oe),m39(Re,De)):Oe<Re&&(De<=Oe?(s$31(De>=0&&De<=Oe,"invalid firstIndex"),m39(De,Oe),m39(Re,Ce),m39(0,De)):(s$31(De>=Re&&De<=Ce,"invalid firstIndex"),m39(De,Ce),m39(0,Oe),m39(Re,De))):Oe>Re?m39(Re,Oe):Oe<Re&&(m39(0,Oe),m39(Re,Ce)),Te.bindVAO(null)}};function P$n(fe,ve,_e){const be=fe.allocateHead();!function G$d(fe,ve,_e,be){(function l$2M(fe,ve,_e,be,we){hD[0]=fe.get(ve,0),hD[1]=fe.get(ve,1),hD[2]=fe.get(ve,2),t$2O(hD,dD,3),_e.set(we,0,dD[0]),be.set(we,0,dD[1]),_e.set(we,1,dD[2]),be.set(we,1,dD[3]),_e.set(we,2,dD[4]),be.set(we,2,dD[5])})(fe.modelOrigin,ve,_e.modelOriginHi,_e.modelOriginLo,be),_e.model.copyFrom(be,fe.model,ve),_e.modelNormal.copyFrom(be,fe.modelNormal,ve),fe.color&&_e.color&&_e.color.copyFrom(be,fe.color,ve),fe.objectAndLayerIdColor&&_e.objectAndLayerIdColor&&_e.objectAndLayerIdColor.copyFrom(be,fe.objectAndLayerIdColor,ve),fe.featureAttribute&&_e.featureAttribute&&_e.featureAttribute.copyFrom(be,fe.featureAttribute,ve)}(ve,_e,fe.view,be)}e$4o([y$2v({constructOnly:!0})],Oie.prototype,"symbol",void 0),e$4o([y$2v({constructOnly:!0})],Oie.prototype,"optionalFields",void 0),e$4o([y$2v({constructOnly:!0})],Oie.prototype,"metadata",void 0),e$4o([y$2v({constructOnly:!0})],Oie.prototype,"shaderTransformation",void 0),e$4o([y$2v()],Oie.prototype,"_instanceData",void 0),e$4o([y$2v()],Oie.prototype,"_cycleStartIndex",void 0),e$4o([y$2v({readOnly:!0})],Oie.prototype,"_enableLevelSelection",null),e$4o([y$2v()],Oie.prototype,"_updateCyclesWithStaticCamera",void 0),e$4o([y$2v({readOnly:!0})],Oie.prototype,"running",null),Oie=e$4o([a$4y("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Oie);const Aie=[0,0,0],Mie=[0,0,0,0],Rie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Iie=[0,0,0],Lie=[0,0,0],Die=[r$35(1,0,1,1),r$35(0,0,1,1),r$35(0,1,0,1),r$35(1,1,0,1),r$35(1,0,0,1)],Nie=new class z5 extends jH{constructor(){super(...arguments),this.origin=[0,0,0],this.slicePlaneLocalOrigin=this.origin}};let Fie=class me{constructor(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De){this.lodResources=fe,this.lodRenderer=ve,this.stageResources=_e,this.originalMaterialParameters=be,this.resourceSize=we,this.isEsriSymbolResource=Se,this.isWosr=Te,this.resourceBoundingBox=Ee,this.symbolSize=Ce,this.extentPadding=Oe,this.physicalBasedRenderingEnabled=Re,this.pivotOffset=De}};function ue$5(fe,ve,_e){const be=[0,0,0];switch(_e.anchor){case"center":r$3w(be,E$1m(fe)),j$1O(be,be);break;case"top":{const ve=E$1m(fe);o$44(be,-ve[0],-ve[1],-fe[5]);break}case"bottom":{const ve=E$1m(fe);o$44(be,-ve[0],-ve[1],-fe[2]);break}case"relative":{const ve=E$1m(fe),we=F$V(fe),Se=_e.anchorPosition;c$4P(be,we,Se?r$3y(Se.x,Se.y,Se.z):Bi),u$3Y(be,be,ve),j$1O(be,be);break}default:null!=ve?j$1O(be,ve):r$3w(be,Bi)}return be}function ye$3(fe){return"absolute-height"!==fe.mode}const zie=[0,0,0],kie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Uie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Vie=[0,0,0,0],Bie=new TG;let jie=class r44{constructor(fe,ve,_e,be){this.vertices=fe,this.positionsES=ve,this.offset=be;const we=fe.length,Se=Math.floor(we/2),Te=this.offset+3*Se,Ee=_e[Te],Ce=_e[Te+1],Oe=_e[Te+2];this.origin=r$3y(Ee,Ce,Oe),this.positions=t$2G(3*we);const Re=this.offset+3*we;for(let De=this.offset;De<Re;De+=3)this.positions[De]=_e[De]-Ee,this.positions[De+1]=_e[De+1]-Ce,this.positions[De+2]=_e[De+2]-Oe;this.updatePathVertexInformation()}get usedMemory(){return A$1L(this.positions)}updatePathVertexInformation(){const fe=this.vertices.length,ve=this.vertices[0];let _e=this.offset;const be=this.positions;ve.vRight[0]=be[_e+3]-be[_e],ve.vRight[1]=be[_e+4]-be[_e+1],ve.vRight[2]=be[_e+5]-be[_e+2],_e+=3;let we=s$4g(ve.vRight);ve.vMinSiblingLength=we,z$1d(ve.vRight,ve.vRight);let Se=ve;for(let Te=1;Te<fe;++Te){const ve=this.vertices[Te];if(ve.vLeft=Se.vRight,Te<fe-1){ve.vRight[0]=be[_e+3]-be[_e],ve.vRight[1]=be[_e+4]-be[_e+1],ve.vRight[2]=be[_e+5]-be[_e+2];const fe=s$4g(ve.vRight);ve.vMinSiblingLength=Math.min(we,fe),we=fe,z$1d(ve.vRight,ve.vRight)}else r$3w(ve.vRight,ve.vLeft),ve.vMinSiblingLength=we;Se=ve,_e+=3}}},Gie=class h20{constructor(fe,ve,_e,be,we,Se={}){this.path=fe,this.profile=ve,this.extruder=_e,this.startCap=be,this.endCap=we,this.options=Se,this._extrusionVertexCount=0;const Te=this.path.vertices.length-2;this.numExtrusionProfiles=_e.numProfilesPerJoin()*Te+2,this.numVerticesTotal=ve.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const Ee=this.startCap.numVertices;this.numVerticesTotal+=Ee,this.endCap.vertexBufferStart=this.numVerticesTotal;const Ce=this.endCap.numVertices;this.numVerticesTotal+=Ce,this.pathVertexData=function f$1$(fe){return fe<=rr?new Array(fe):new Uint32Array(fe)}(1*this.numVerticesTotal),this.profileRightAxes=t$2G(4*this.numVerticesTotal),this.profileUpAxes=t$2G(4*this.numVerticesTotal),this.profileVertexAndNormals=t$2G(4*this.numVerticesTotal),this.positions=o$2j(fe.positions,fe.offset,3*fe.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return A$1L(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(fe,ve,_e,be,we){const Se=4*this._extrusionVertexCount;if(this.profileRightAxes[Se]=ve.right[0],this.profileRightAxes[Se+1]=ve.right[1],this.profileRightAxes[Se+2]=ve.right[2],this.profileUpAxes[Se]=ve.up[0],this.profileUpAxes[Se+1]=ve.up[1],this.profileUpAxes[Se+2]=ve.up[2],this.profileVertexAndNormals[Se]=_e[0],this.profileVertexAndNormals[Se+1]=_e[1],this.profileVertexAndNormals[Se+2]=be[0],this.profileVertexAndNormals[Se+3]=be[1],this.pathVertexData[this._extrusionVertexCount]=fe,we){const ve=this.path.vertices[fe],_e=ve.maxStretchDistance;this.profileRightAxes[Se+3]=ve.rotationRight[0]*_e,this.profileUpAxes[Se+3]=ve.rotationRight[1]*_e}else this.profileRightAxes[Se+3]=0,this.profileUpAxes[Se+3]=0;++this._extrusionVertexCount}emitCapVertex(fe,ve,_e,be,we,Se){const Te=4*this._extrusionVertexCount;this.profileRightAxes[Te]=ve.right[0],this.profileRightAxes[Te+1]=ve.right[1],this.profileRightAxes[Te+2]=ve.right[2],this.profileRightAxes[Te+3]=we,this.profileUpAxes[Te]=ve.up[0],this.profileUpAxes[Te+1]=ve.up[1],this.profileUpAxes[Te+2]=ve.up[2],this.profileUpAxes[Te+3]=Se,this.profileVertexAndNormals[Te]=_e[0],this.profileVertexAndNormals[Te+1]=_e[1],this.profileVertexAndNormals[Te+2]=be[0],this.profileVertexAndNormals[Te+3]=be[1],this.pathVertexData[this._extrusionVertexCount]=fe,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:fe,offset:ve,vertices:_e}=this.path;this.positions=o$2j(fe,ve,3*_e.length);let be=0;const h33=(fe,ve,_e,we,Se)=>this.emitCapVertex(be,fe,ve,_e,we,Se),o39=(fe,ve,_e,we)=>this.emitVertex(be,fe,ve,_e,we);for(this.startCap.rebuildConnectingProfileGeometry(_e[be],this.profile,h33),be=1;be<_e.length-1;++be)this.extruder.extrude(_e[be],this.profile,o39);this.endCap.rebuildConnectingProfileGeometry(_e[be],this.profile,h33),be=0,this.startCap.rebuildCapGeometry(_e[be],h33),be=_e.length-1,this.endCap.rebuildCapGeometry(_e[be],h33)}buildTopology(){const fe=this.profile.vertices.length,ve=this.profile.numSegments,_e=this.numExtrusionProfiles-1;let be=ve*_e*2*3;this.startCap.indexBufferStart=be,this.startCap.firstProfileVertexIndex=0,be+=this.startCap.numIndices,this.endCap.indexBufferStart=be,this.endCap.firstProfileVertexIndex=fe*(this.numExtrusionProfiles-1);const we=new Array,Se=new Array,Te=new Array,n52=(fe,ve,_e)=>{we.push(fe),we.push(ve),we.push(_e),Se.push(fe),Se.push(ve),Se.push(_e),Te.push(this.pathVertexData[fe]),Te.push(this.pathVertexData[ve]),Te.push(this.pathVertexData[_e])};for(let Ee=0;Ee<ve;++Ee){const ve=this.profile.indices[2*Ee],be=this.profile.indices[2*Ee+1];for(let we=0;we<_e;++we){const _e=we*fe+ve,Se=(we+1)*fe+be,Te=we*fe+be;n52(_e,(we+1)*fe+ve,Se),n52(_e,Se,Te)}}this.startCap.buildTopology(this.path.vertices[0],n52),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],n52),this.vertexIndices=t$2F(we),this.normalIndices=t$2F(Se),this.pathVertexIndices=t$2F(Te)}onPathChanged(){this._rebuildGeometry()}},Hie=class o27{rebuildConnectingProfileGeometry(fe,ve,_e){for(let be=0;be<ve.vertices.length;++be)_e(fe.frame,ve.vertices[be],ve.normals[be],0,0)}},qie=class l20 extends Hie{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},Wie=class f12 extends Hie{constructor(fe,ve=0,_e=!1){super(),this.profile=fe,this.profilePlaneOffset=ve,this.flip=_e}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(fe,ve,_e){const be=this.profilePlaneOffset;for(let we=0;we<ve.vertices.length;++we)_e(fe.frame,ve.vertices[we],ve.normals[we],be,0)}rebuildCapGeometry(fe,ve){const _e=this.profile,be=this.flip?1:-1,we=this.profilePlaneOffset,Se=Xie;o$2R(Se,0,0);for(let Te=0;Te<_e.vertices.length;++Te)ve(fe.frame,_e.vertices[Te],Se,we,be)}buildTopology(fe,ve){const _e=this.profile,be=this.vertexBufferStart+_e.indices[0];for(let we=1;we<_e.numSegments;++we){const fe=_e.indices[2*we],Se=_e.indices[2*we+1],Te=this.vertexBufferStart+fe,Ee=this.vertexBufferStart+Se;this.flip?ve(Ee,Te,be):ve(be,Te,Ee)}}},Yie=class h21 extends Hie{constructor(fe){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=fe.profile,this.flip=fe.flip,this.sign=this.flip?1:-1,this.breakNormals=fe.breakNormals,this.numSegments=fe.subdivisions}get numVertices(){let fe=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(fe+=this.profile.vertices.length),fe}get numIndices(){let fe=0;const ve=this.profile;fe+=2*ve.numSegments*(this.numSegments-1);for(let _e=0;_e<ve.numSegments;++_e){const be=ve.indices[2*_e],we=ve.indices[2*_e+1];ve.poleIndices[be]===ve.poleIndices[we]?fe+=1:fe+=2}return 3*fe}rebuildCapGeometry(fe,ve){const _e=this.profile,be=fe.frame,we=.5*this.sign,Se=Zie,Te=Xie;o$2R(Te,0,0);for(const Ee of _e.poles)Ee.normal?ve(be,Ee.position,Ee.normal,we,0):ve(be,Ee.position,Te,we,this.sign);if(this.breakNormals)for(let Ee=0;Ee<_e.vertices.length;++Ee)ve(be,_e.vertices[Ee],_e.normals[Ee],0,0);for(let Ee=0;Ee<this.numSegments-1;++Ee){const fe=(1-(Ee+1)/this.numSegments)*Math.PI*.5,Ce=Math.sin(fe),Oe=Math.cos(fe);for(let Ee=0;Ee<_e.vertices.length;++Ee){const fe=_e.poles[_e.poleIndices[Ee]];e$35(Se,_e.vertices[Ee],fe.position),l$31(Se,Se,Ce),fe.normal?(u$2J(Se,Se,fe.position),ve(be,Se,fe.normal,we*Oe,0)):(v$1k(Te,Se),l$31(Te,Te,Ce),u$2J(Se,Se,fe.position),ve(be,Se,Te,we*Oe,this.sign*Oe))}}}buildTopology(fe,ve){const _e=this.profile,be=this.breakNormals?this.vertexBufferStart+_e.poles.length:this.firstProfileVertexIndex,we=this.breakNormals?this.vertexBufferStart+_e.poles.length+_e.vertices.length:this.vertexBufferStart+_e.poles.length;for(let Se=0;Se<_e.numSegments;++Se){const fe=_e.indices[2*Se],Te=_e.indices[2*Se+1],Ee=this.vertexBufferStart+_e.poleIndices[fe],Ce=this.vertexBufferStart+_e.poleIndices[Te];let Oe=be+fe,Re=be+Te;for(let be=0;be<this.numSegments-1;++be){const Se=we+be*_e.vertices.length+fe,Ee=we+be*_e.vertices.length+Te;this.flip?(ve(Se,Re,Oe),ve(Re,Se,Ee)):(ve(Oe,Re,Se),ve(Ee,Se,Re)),Oe=Se,Re=Ee}this.flip?(ve(Ee,Re,Oe),Ee!==Ce&&ve(Ee,Ce,Re)):(ve(Oe,Re,Ee),Ee!==Ce&&ve(Re,Ce,Ee))}}};const Zie=[0,0],Xie=[0,0];let Jie=class c34{numProfilesPerJoin(){return 1}extrude(fe,ve,_e){for(let be=0;be<ve.vertices.length;++be)_e(fe.frame,ve.vertices[be],ve.normals[be],!1)}},Qie=class a31{constructor(fe,ve){this.cutoffAngle=fe,this.numBendSubdivisions=ve}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(fe,ve,_e){const be=rne,{rotationAngle:we,rotationRight:Se,frame:Te}=fe;if(Math.abs(we)>=this.cutoffAngle){const Ee=fe.rotationFrameUp;for(let Ce=0;Ce<this.numBendSubdivisions+1;++Ce){p$4z(tne,.5*-we+Ce*we/this.numBendSubdivisions,Ee),m$1c(be,Te,tne);for(let Ee=0;Ee<ve.vertices.length;++Ee)j$1a(ve.vertices[Ee],Se)*we>=0?_e(be,ve.vertices[Ee],ve.normals[Ee],!1):_e(Te,fe.applyMiterStretch(ene,ve.vertices[Ee]),ve.normals[Ee],!0)}}else for(let Ee=0;Ee<this.numBendSubdivisions+1;++Ee)for(let be=0;be<ve.vertices.length;++be){const Ee=j$1a(ve.vertices[be],Se)*we>=0;_e(Te,fe.applyMiterStretch(ene,ve.vertices[be]),ve.normals[be],!Ee)}}},Kie=class l21{constructor(){this.up=[0,0,0],this.right=[0,0,0]}};function m$1c(fe,ve,_e){O$1v(fe.up,ve.up,_e),O$1v(fe.right,ve.right,_e)}const ene=[0,0],tne=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rne=new Kie;let ine=class e46 extends pD{constructor(fe,ve,_e,be,we,Se){super(fe,ve,null,eD.Mesh,Se),this.path=_e,this.geometrySR=be,this.stencilWidth=we}};var nne;function n$1C(fe){return"path"in fe}!function(fe){fe[fe.World=0]="World",fe[fe.Path=1]="Path"}(nne||(nne={}));let sne=class d18{constructor(fe){this.builder=fe}onPathChanged(fe){this.builder.onPathChanged()}},one=class f13 extends sne{constructor(fe){super(fe),this.vertexAttributeColor=r$35(255,255,255,255),this.size=new Array,this.vertexAttributePosition=t$2G(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(fe){this.vertexAttributeColor[0]=255*fe[0],this.vertexAttributeColor[1]=255*fe[1],this.vertexAttributeColor[2]=255*fe[2],this.vertexAttributeColor[3]=255*(fe.length>3?fe[3]:1)}bake(fe){this.size=fe;const{numVerticesTotal:ve,pathVertexData:_e,path:be,positions:we,profileRightAxes:Se,profileUpAxes:Te,profileVertexAndNormals:Ee}=this.builder;for(let Ce=0;Ce<ve;++Ce){let ve=_e[Ce];const Oe=0===ve||ve===be.vertices.length-1;ve*=3;const Re=dne;let De=0,Be=0;const Ze=4*Ce,Xe=o$44(pne,Se[Ze],Se[Ze+1],Se[Ze+2]),Je=o$44(fne,Te[Ze],Te[Ze+1],Te[Ze+2]),Qe=o$2R(lne,Ee[Ze]*fe[0],Ee[Ze+1]*fe[1]);if(Oe)_$1z(Re,Je,Xe),De=Se[Ze+3]*fe[0],Be=Te[Ze+3];else{const fe=cne,ve=une;o$2R(fe,Se[Ze+3],Te[Ze+3]);const _e=q$J(fe);v$1k(fe,fe);const be=j$1a(Qe,fe);if(Math.abs(be)>_e){o$2R(ve,-fe[1],fe[0]);const we=j$1a(Qe,ve);l$31(fe,fe,_e*Math.sign(be)),l$31(ve,ve,we),u$2J(Qe,fe,ve)}o$44(Re,0,0,0)}const dt=o$44(hne,Xe[0]*Qe[0]+Je[0]*Qe[1],Xe[1]*Qe[0]+Je[1]*Qe[1],Xe[2]*Qe[0]+Je[2]*Qe[1]),$t=3*Ce;this.vertexAttributePosition[$t]=we[ve]+dt[0]+Re[0]*De,this.vertexAttributePosition[$t+1]=we[ve+1]+dt[1]+Re[1]*De,this.vertexAttributePosition[$t+2]=we[ve+2]+dt[2]+Re[2]*De;const bt=o$2R(lne,Ee[Ze+2],Ee[Ze+3]);s$1T(this.vertexAttributeNormal,Ce,Xe[0]*bt[0]+Je[0]*bt[1]+Re[0]*Be,Xe[1]*bt[0]+Je[1]*bt[1]+Re[1]*Be,Xe[2]*bt[0]+Je[2]*bt[1]+Re[2]*Be)}}createGeometryData(){const fe=this.builder.vertexIndices.length,{normalIndices:ve,vertexIndices:_e}=this.builder;return[[nO.POSITION,new Om(this.vertexAttributePosition,_e,3,!0)],[nO.NORMALCOMPRESSED,new Om(this.vertexAttributeNormal,ve,2,!0)],[nO.COLOR,new Om(this.vertexAttributeColor,A$14(fe),4)]]}onPathChanged(fe){super.onPathChanged(fe),this.bake(this.size)}intersect(fe,ve,_e,be){const we=this.builder.vertexIndices,Se=new Cm(this.vertexAttributePosition,3);x$Q(fe,ve,0,we.length/3,we,Se,void 0,_e,((fe,ve,_e)=>{be(fe,_e,ve,!1)}))}},ane=class g15 extends sne{constructor(fe,ve,_e,be){super(fe),this.sizeAttributeValue=ve,this.colorAttributeValue=_e,this.opacityAttributeValue=be,this.vvData=null,this.baked=new one(fe),this.vvData=t$2G(4*this.builder.path.vertices.length);for(let we=0;we<this.builder.path.vertices.length;++we){this.vvData[4*we]=ve,this.vvData[4*we+1]=_e,this.vvData[4*we+2]=be;const fe=0===we||we===this.builder.path.vertices.length-1;this.vvData[4*we+3]=fe?1:0}}createGeometryData(){const{positions:fe,profileRightAxes:ve,profileUpAxes:_e,profileVertexAndNormals:be,pathVertexIndices:we,vertexIndices:Se}=this.builder;return[[nO.POSITION,new Om(fe,we,3,!0)],[nO.PROFILERIGHT,new Om(ve,Se,4,!0)],[nO.PROFILEUP,new Om(_e,Se,4,!0)],[nO.PROFILEVERTEXANDNORMAL,new Om(be,Se,4,!0)],[nO.FEATUREVALUE,new Om(this.vvData,we,4,!0)]]}onPathChanged(fe){super.onPathChanged(fe);const ve=fe.getMutableAttribute(nO.POSITION);ve&&(ve.data=this.builder.positions)}};const lne=[0,0],cne=[0,0],une=[0,0],hne=[0,0,0],dne=[0,0,0],pne=[0,0,0],fne=[0,0,0];const mne=[0,0,0];let yne=class o28{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(fe,ve){return this.vertices.push(t$3K(fe)),this.normals.push(t$3K(ve)),this.vertices.length-1}addPole(fe,ve=null){return this.poles.push({position:t$3K(fe),normal:ve?t$3K(ve):null}),this.poles.length-1}addSegment(fe,ve=null){this.indices.push(fe.v0),this.indices.push(fe.v1),ve&&(this.poleIndices.push(ve.v0),this.poleIndices.push(ve.v1))}get numSegments(){return this.indices.length/2}translate(fe,ve){for(const _e of this.vertices)_e[0]+=fe,_e[1]+=ve;for(const _e of this.poles)_e.position[0]+=fe,_e.position[1]+=ve}get usedMemory(){return this.vertices.length*A$1L(this.vertices[0])*2+A$1L(this.indices)}};const gne={top:[0,-.5],bottom:[0,.5]};function i$1u(fe){const ve=eH,_e=new yne,be={v0:0,v1:0};_e.addPole(r$36(0,0));for(let Se=0;Se<ve;++Se){const fe=2*Se*Math.PI/ve,be=Math.cos(fe),we=Math.sin(fe),Te=r$36(.5*be,.5*we),Ee=r$36(be,we);_e.addVertex(Te,Ee)}for(let Se=0;Se<ve-1;++Se){const fe={v0:Se,v1:Se+1};_e.addSegment(fe,be)}const we={v0:ve-1,v1:0};if(_e.addSegment(we,be),"center"!==fe){const ve=gne[fe];_e.translate(ve[0],ve[1])}return _e}const vne={center:i$1u("center"),top:i$1u("top"),bottom:i$1u("bottom")},_ne={center:c$1x("center"),top:c$1x("top"),bottom:c$1x("bottom")};function c$1x(fe){const ve=new yne,_e=r$36(-.5,-.5),be=r$36(.5,-.5),we=r$36(.5,.5),Se=r$36(-.5,.5),Te=r$36(0,-1),Ee=r$36(1,0),Ce=r$36(0,1),Oe=r$36(-1,0);if(ve.addPole(r$36(0,.5),Ce),ve.addPole(r$36(0,.5)),ve.addPole(r$36(0,-.5)),ve.addPole(r$36(0,-.5),Te),ve.addVertex(_e,Te),ve.addVertex(be,Te),ve.addSegment({v0:0,v1:1},{v0:3,v1:3}),ve.addVertex(be,Ee),ve.addVertex(we,Ee),ve.addSegment({v0:2,v1:3},{v0:2,v1:1}),ve.addVertex(we,Ce),ve.addVertex(Se,Ce),ve.addSegment({v0:4,v1:5},{v0:0,v1:0}),ve.addVertex(Se,Oe),ve.addVertex(_e,Oe),ve.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==fe){const _e=gne[fe];ve.translate(_e[0],_e[1])}return ve}function a$1s(fe,ve,_e,be,we){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe}function s$1n(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=_e[0],Ce=_e[1],Oe=_e[2],Re=_e[3];return fe[0]=be*Ee+Se*Ce,fe[1]=we*Ee+Te*Ce,fe[2]=be*Oe+Se*Re,fe[3]=we*Oe+Te*Re,fe}function p$1O(fe,ve,_e){return fe[0]=ve[0]-_e[0],fe[1]=ve[1]-_e[1],fe[2]=ve[2]-_e[2],fe[3]=ve[3]-_e[3],fe}const $ne=s$1n,bne=p$1O;function e$1h(){return[1,0,0,1]}Object.freeze(Object.defineProperty({__proto__:null,LDU:function m$1b(fe,ve,_e,be){return fe[2]=be[2]/be[0],_e[0]=be[0],_e[1]=be[1],_e[3]=be[3]-fe[2]*_e[1],[fe,ve,_e]},add:function d$11(fe,ve,_e){return fe[0]=ve[0]+_e[0],fe[1]=ve[1]+_e[1],fe[2]=ve[2]+_e[2],fe[3]=ve[3]+_e[3],fe},adjoint:function e$1i(fe,ve){const _e=ve[0];return fe[0]=ve[3],fe[1]=-ve[1],fe[2]=-ve[2],fe[3]=_e,fe},copy:function n$1z(fe,ve){return fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],fe},determinant:function c$1w(fe){return fe[0]*fe[3]-fe[2]*fe[1]},equals:function x$u(fe,ve){const _e=fe[0],be=fe[1],we=fe[2],Se=fe[3],Te=ve[0],Ee=ve[1],Ce=ve[2],Oe=ve[3],Re=e$3_();return Math.abs(_e-Te)<=Re*Math.max(1,Math.abs(_e),Math.abs(Te))&&Math.abs(be-Ee)<=Re*Math.max(1,Math.abs(be),Math.abs(Ee))&&Math.abs(we-Ce)<=Re*Math.max(1,Math.abs(we),Math.abs(Ce))&&Math.abs(Se-Oe)<=Re*Math.max(1,Math.abs(Se),Math.abs(Oe))},exactEquals:function y$N(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]&&fe[3]===ve[3]},frob:function b$D(fe){return Math.sqrt(fe[0]**2+fe[1]**2+fe[2]**2+fe[3]**2)},fromRotation:function l$1v(fe,ve){const _e=Math.sin(ve),be=Math.cos(ve);return fe[0]=be,fe[1]=_e,fe[2]=-_e,fe[3]=be,fe},fromScaling:function M$q(fe,ve){return fe[0]=ve[0],fe[1]=0,fe[2]=0,fe[3]=ve[1],fe},identity:function r$_(fe){return fe[0]=1,fe[1]=0,fe[2]=0,fe[3]=1,fe},invert:function o$Y(fe,ve){const _e=ve[0],be=ve[1],we=ve[2],Se=ve[3];let Te=_e*Se-we*be;return Te?(Te=1/Te,fe[0]=Se*Te,fe[1]=-be*Te,fe[2]=-we*Te,fe[3]=_e*Te,fe):null},mul:$ne,multiply:s$1n,multiplyScalar:function S$C(fe,ve,_e){return fe[0]=ve[0]*_e,fe[1]=ve[1]*_e,fe[2]=ve[2]*_e,fe[3]=ve[3]*_e,fe},multiplyScalarAndAdd:function j$A(fe,ve,_e,be){return fe[0]=ve[0]+_e[0]*be,fe[1]=ve[1]+_e[1]*be,fe[2]=ve[2]+_e[2]*be,fe[3]=ve[3]+_e[3]*be,fe},rotate:function i$1t(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=Math.sin(_e),Ce=Math.cos(_e);return fe[0]=be*Ce+Se*Ee,fe[1]=we*Ce+Te*Ee,fe[2]=be*-Ee+Se*Ce,fe[3]=we*-Ee+Te*Ce,fe},scale:function f$U(fe,ve,_e){const be=ve[0],we=ve[1],Se=ve[2],Te=ve[3],Ee=_e[0],Ce=_e[1];return fe[0]=be*Ee,fe[1]=we*Ee,fe[2]=Se*Ce,fe[3]=Te*Ce,fe},set:a$1s,str:function h$N(fe){return"mat2("+fe[0]+", "+fe[1]+", "+fe[2]+", "+fe[3]+")"},sub:bne,subtract:p$1O,transpose:function u$17(fe,ve){if(fe===ve){const _e=ve[1];fe[1]=ve[2],fe[2]=_e}else fe[0]=ve[0],fe[1]=ve[2],fe[2]=ve[1],fe[3]=ve[3];return fe}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,clone:function r$Z(fe){return[fe[0],fe[1],fe[2],fe[3]]},create:e$1h,createView:function n$1y(fe,ve){return new Float64Array(fe,ve,4)},fromValues:function t$1n(fe,ve,_e,be){return[fe,ve,_e,be]}},Symbol.toStringTag,{value:"Module"}));let wne=class R5{constructor(){this.vLeft=[0,0,0],this.vRight=[0,0,0],this.vMinSiblingLength=0,this.frame=new Kie}setFrameFromUpVector(fe){r$3w(this.frame.up,fe),u$3Y(Ine,this.vLeft,this.vRight),z$1d(Ine,Ine),g$2z(Rne,this.frame.up,P$1g(Ine,this.frame.up)),e$3Z(Lne,Ine,Rne),z$1d(Lne,Lne),_$1z(this.frame.right,Lne,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},xne=class x9 extends wne{get rotationFrameUp(){return this.frame.up}get rotationRight(){return gd}get rotationAngle(){return g$2z(Ane,this.frame.up,P$1g(this.frame.up,this.vLeft)),e$3Z(Ane,this.vLeft,Ane),j$1O(Ane,Ane),z$1d(Ane,Ane),g$2z(Mne,this.frame.up,P$1g(this.frame.up,this.vRight)),e$3Z(Mne,this.vRight,Mne),z$1d(Mne,Mne),_$1z(One,this.rotationFrameUp,this.vLeft),Math.sign(P$1g(One,this.vRight))*(Math.PI-m$3J(P$1g(Ane,Mne)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(fe,ve){const _e=this.rotationAngle;if(Math.abs(_e)<=0)return ve;return o$2R(fe,(b$2b(Math.cos(.5*_e))-1+1)*ve[0],ve[1])}},Sne=class j8 extends wne{get rotationFrameUp(){const fe=Math.sign(P$1g(this.frame.right,this.vRight));return _$1z(Tne,this.vRight,this.vLeft),g$2z(Tne,Tne,fe),z$1d(Tne,Tne)}get rotationRight(){const fe=this.rotationFrameUp,ve=P$1g(fe,this.frame.up),_e=P$1g(fe,this.frame.right);return g$2z(Pne,this.frame.up,-_e),g$2z(Cne,this.frame.right,ve),u$3Y(Pne,Pne,Cne),z$1d(Pne,Pne),function L$n(fe,ve,_e){o$2R(fe,P$1g(_e,ve.right),P$1g(_e,ve.up))}(Ene,this.frame,Pne),Ene}get rotationAngle(){const fe=Math.sign(P$1g(this.frame.right,this.vRight));return j$1O(One,this.vLeft),-fe*(Math.PI-m$3J(P$1g(One,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*b$2b(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(fe,ve){const _e=this.rotationAngle;if(0===Math.abs(_e))return ve;const be=b$2b(Math.cos(.5*_e)),we=this.rotationRight;return P$X(fe,ve,a$1s(Dne,1+(be-1)*we[0]*we[0],(be-1)*we[0]*we[1],(be-1)*we[0]*we[1],1+(be-1)*we[1]*we[1]))}};function A$y(fe){switch(fe){case nne.World:return new xne;case nne.Path:return new Sne}}const Tne=[0,0,0],Ene=[0,0],Pne=[0,0,0],Cne=[0,0,0],One=[0,0,0],Ane=[0,0,0],Mne=[0,0,0],Rne=[0,0,0],Ine=[0,0,0],Lne=[0,0,0],Dne=[1,0,0,1],Nne=8;function f$T(fe,ve){const _e=nO.FEATUREVALUE;fe.attributes.add(_e,"vec4");const be=fe.vertex;be.code.add(o$2P`
  bool isCapVertex() {
    return ${_e}.w == 1.0;
  }
  `),be.uniforms.add(new lO("size",(fe=>fe.size))),ve.vvSize?(be.uniforms.add(new uO("vvSizeMinSize",(fe=>fe.vvSize.minSize)),new uO("vvSizeMaxSize",(fe=>fe.vvSize.maxSize)),new uO("vvSizeOffset",(fe=>fe.vvSize.offset)),new uO("vvSizeFactor",(fe=>fe.vvSize.factor))),be.code.add(o$2P`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${_e}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):be.code.add(o$2P`vec2 getSize(){
return size;
}`),ve.vvOpacity?(be.constants.add("vvOpacityNumber","int",Nne),be.uniforms.add(new dj("vvOpacityValues",(fe=>fe.vvOpacity.values),Nne),new dj("vvOpacityOpacities",(fe=>fe.vvOpacity.opacityValues),Nne)),be.code.add(o$2P`
    vec4 applyOpacity(vec4 color) {
      float value = ${_e}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):be.code.add(o$2P`vec4 applyOpacity(vec4 color){
return color;
}`),ve.vvColor?(be.constants.add("vvColorNumber","int",fj),be.uniforms.add(new dj("vvColorValues",(fe=>fe.vvColor.values),fj),new hj("vvColorColors",(fe=>fe.vvColor.colors),fj)),be.code.add(o$2P`
    vec4 getColor() {
      float value = ${_e}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):be.code.add(o$2P`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),fe.include(o$2p),fe.attributes.add(nO.PROFILERIGHT,"vec4"),fe.attributes.add(nO.PROFILEUP,"vec4"),fe.attributes.add(nO.PROFILEVERTEXANDNORMAL,"vec4"),be.code.add(o$2P`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),be.code.add(o$2P`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),be.code.add(o$2P`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),be.code.add(o$2P`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Fne=class n32 extends pj{constructor(){super(...arguments),this.size=r$36(1,1)}};function r$Y(fe,ve){ve.spherical?fe.vertex.code.add(o$2P`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):fe.vertex.code.add(o$2P`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),ve.spherical?fe.vertex.code.add(o$2P`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):fe.vertex.code.add(o$2P`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function O$s(fe){const ve=new gO,{vertex:_e,fragment:be}=ve;switch(d$1$(_e,fe),ve.varyings.add("vpos","vec3"),ve.include(f$T,fe),fe.output!==NI.Color&&fe.output!==NI.ObjectAndLayerIdColor||(ve.include(o$2n,fe),ve.include(x$O,fe),ve.include(n$2S,fe),ve.include(d$1J,fe),ve.varyings.add("vnormal","vec3"),ve.varyings.add("vcolor","vec4"),fe.multipassEnabled&&ve.varyings.add("depth","float"),_e.code.add(o$2P`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${fe.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${fe.output===NI.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),ve.include(a$2L,fe),fe.output){case NI.Color:ve.include(P$H,fe),ve.include(p$2l,fe),ve.include(t$26,fe),ve.include(x$O,fe),ve.include(e$28,fe),f$20(be,fe),u$1U(be),h$1o(be),be.uniforms.add(_e.uniforms.get("localOrigin"),new uO("ambient",(fe=>fe.ambient)),new uO("diffuse",(fe=>fe.diffuse)),new uO("specular",(fe=>fe.specular)),new dO("opacity",(fe=>fe.opacity))),be.include(e$2S),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),a$2$(be),be.code.add(o$2P`
        void main() {
          discardBySlice(vpos);
          ${fe.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${fe.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":fe.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case NI.Depth:ve.include(o$2n,fe),_e.code.add(o$2P`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),ve.include(P$H,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
}`);break;case NI.Shadow:case NI.ShadowHighlight:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:ve.include(o$2n,fe),i$2H(ve),ve.varyings.add("depth","float"),_e.code.add(o$2P`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),ve.include(P$H,fe),ve.include(e$23,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case NI.ObjectAndLayerIdColor:ve.include(P$H,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case NI.Normal:ve.include(o$2n,fe),ve.include(r$Y,fe),p$2Q(_e),ve.varyings.add("vnormal","vec3"),_e.code.add(o$2P`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),ve.include(P$H,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case NI.Highlight:ve.include(o$2n,fe),ve.include(r$Y,fe),ve.varyings.add("vnormal","vec3"),_e.code.add(o$2P`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),ve.include(P$H,fe),ve.include(a$2n,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return ve}const zne=Object.freeze(Object.defineProperty({__proto__:null,build:O$s},Symbol.toStringTag,{value:"Module"})),kne=new Map([[nO.POSITION,0],[nO.PROFILERIGHT,1],[nO.PROFILEUP,2],[nO.PROFILEVERTEXANDNORMAL,3],[nO.FEATUREVALUE,4],[nO.OBJECTANDLAYERIDCOLOR,5]]);let Une=class L5 extends Fne{constructor(){super(...arguments),this.ambient=r$3y(.2,.2,.2),this.diffuse=r$3y(.8,.8,.8),this.specular=r$3y(0,0,0),this.opacity=1,this.origin=[0,0,0],this.modelTransformation=null}},Vne=class A10 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global,ve.doublePrecisionRequiresObfuscation=fe.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(fe){return new gA(fe.rctx,A10.shader.get().build(this.configuration),kne)}initializePipeline(){const fe=this.configuration.transparencyPassType,ve=this.configuration,_e=fe===WR.NONE,be=fe===WR.FrontFace;return S$1g({blending:ve.output===NI.Color&&ve.transparent?_e?_j:c$2o(fe):null,culling:ve.hasSlicePlane&&!ve.transparent&&ve.doubleSidedMode!==PH.None?CA:null,depthTest:{func:f$1O(fe)},depthWrite:_e||be?OA:null,drawBuffers:ve.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:ve.hasOccludees?qH:null,stencilTest:ve.hasOccludees?YH:null,polygonOffset:_e||be?null:wj})}};Vne.shader=new LO(zne,(()=>zt((()=>Promise.resolve().then((()=>fRe))),void 0)));let Bne=class V4 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.doubleSidedMode=PH.None,this.transparencyPassType=WR.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};e$4o([r$2w({count:NI.COUNT})],Bne.prototype,"output",void 0),e$4o([r$2w({count:PH.COUNT})],Bne.prototype,"doubleSidedMode",void 0),e$4o([r$2w({count:WR.COUNT})],Bne.prototype,"transparencyPassType",void 0),e$4o([r$2w()],Bne.prototype,"spherical",void 0),e$4o([r$2w()],Bne.prototype,"receiveShadows",void 0),e$4o([r$2w()],Bne.prototype,"receiveAmbientOcclusion",void 0),e$4o([r$2w()],Bne.prototype,"vvSize",void 0),e$4o([r$2w()],Bne.prototype,"vvColor",void 0),e$4o([r$2w()],Bne.prototype,"vvOpacity",void 0),e$4o([r$2w()],Bne.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Bne.prototype,"transparent",void 0),e$4o([r$2w()],Bne.prototype,"hasOccludees",void 0),e$4o([r$2w()],Bne.prototype,"multipassEnabled",void 0),e$4o([r$2w()],Bne.prototype,"cullAboveGround",void 0),e$4o([r$2w()],Bne.prototype,"doublePrecisionRequiresObfuscation",void 0),e$4o([r$2w({constValue:!1})],Bne.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:yM.Disabled})],Bne.prototype,"pbrMode",void 0),e$4o([r$2w({constValue:!0})],Bne.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!1})],Bne.prototype,"useCustomDTRExponentForWater",void 0),e$4o([r$2w({constValue:!1})],Bne.prototype,"useFillLights",void 0),e$4o([r$2w({constValue:!1})],Bne.prototype,"hasColorTexture",void 0);let jne=class g16 extends QB{constructor(fe){super(fe,new Hne),this.supportsEdges=!0,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>(this.parameters.castShadows&&r$2k(fe)||n$2T(fe))&&!this.parameters.transparent],[qR.TRANSPARENT_MATERIAL,fe=>(this.parameters.castShadows&&r$2k(fe)||n$2T(fe))&&this.parameters.transparent]]),this._vertexAttributeLocations=kne,this._configuration=new Bne,this._vertexBufferLayout=g16.getVertexBufferLayout()}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,fe===NI.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?PH.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?PH.WindingOrder:PH.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=ve.ssao),this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(fe){return fe!==NI.Shadow&&fe!==NI.ShadowExcludeHighlight&&fe!==NI.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(fe,ve,_e,be,we,Se){const Te=fe;if(!n$1C(Te))return;const Ee=Te.path,Ce=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:fe,factor:ve,minSize:_e,maxSize:be}=this.parameters.vvSize,we=Ee.sizeAttributeValue;Ce[0]*=e$3Y(fe[0]+we*ve[0],_e[0],be[0]),Ce[1]*=e$3Y(fe[2]+we*ve[2],_e[2],be[2])}const Oe=new CH(!1,_e.options.normalRequired),Re=Math.max(Ce[0],Ce[1]),De=fe.boundingInfo;if(null==De)return void O$r(Ee,Ce,be,we,Oe,Se);const Be=a$3w(De.bbMin[0]-Re,De.bbMin[1]-Re,De.bbMin[2]-Re,De.bbMax[0]+Re,De.bbMax[1]+Re,De.bbMax[2]+Re),Ze=[we[0]-be[0],we[1]-be[1],we[2]-be[2]],Xe=Math.sqrt(Ze[0]*Ze[0]+Ze[1]*Ze[1]+Ze[2]*Ze[2]);k$I(Be,be,[Xe/Ze[0],Xe/Ze[1],Xe/Ze[2]],_e.tolerance)&&O$r(Ee,Ce,be,we,Oe,Se)}createBufferWriter(){return new VH(this._vertexBufferLayout)}createGLMaterial(fe){return new Gne(fe)}static getVertexBufferLayout(){const fe=H$J().vec3f(nO.POSITION).vec4f(nO.PROFILERIGHT).vec4f(nO.PROFILEUP).vec4f(nO.PROFILEVERTEXANDNORMAL).vec4f(nO.FEATUREVALUE);return has("enable-feature:objectAndLayerId-rendering")&&fe.vec4u8(nO.OBJECTANDLAYERIDCOLOR),fe}},Gne=class _8 extends pM{_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}_updateShadowState(fe){null!=this.technique&&fe.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:fe.shadowMap.enabled})}beginSlot(fe){return this._output===NI.Color&&(this._updateShadowState(fe),this._updateOccludeeState(fe)),this.ensureTechnique(Vne,fe)}};function O$r(fe,ve,_e,be,we,Se){fe.baked.size&&fe.baked.size[0]===ve[0]&&fe.baked.size[1]===ve[1]||fe.baked.bake(ve),fe.baked.intersect(_e,be,we,Se)}let Hne=class w3 extends Une{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const qne=["polyline"];function ie$4(fe,ve,_e){const{origin:be,positions:we}=fe;let Se=fe.offset;switch(ve){default:case nne.World:for(const ve of fe.vertices)Wne[0]=we[Se++]+be[0],Wne[1]=we[Se++]+be[1],Wne[2]=we[Se++]+be[2],_e.worldUpAtPosition(Wne,Wne),ve.setFrameFromUpVector(Wne);break;case nne.Path:Wne[0]=we[Se]+be[0],Wne[1]=we[Se+1]+be[1],Wne[2]=we[Se+2]+be[2],_e.worldUpAtPosition(Wne,Wne),function l$1w(fe,ve){let _e=null;const be=fe.vertices.length,we=.99619469809,Se=[0,0,0],Te=[0,0,0],Ee=[0,0,0],Ce=[0,0,0],Oe=[0,0,0],Re=[0,0,0],De=E$1z();let Be=fe.vertices[0];r$3w(Te,ve),o$44(Se,0,1,0),At$4(Be.vRight,Te,Se,Se,Ee,Te,we),r$3w(Be.frame.up,Te),r$3w(Be.frame.right,Ee);const Ze=fe.positions;let Xe=fe.offset;_e=Be;for(let Je=1;Je<be;++Je){Be=fe.vertices[Je],u$3Y(Oe,Be.vLeft,Be.vRight);let ve=s$4g(Oe);ve>0?(ve=1/Math.sqrt(ve),Oe[0]=Oe[0]*ve,Oe[1]=Oe[1]*ve,Oe[2]=Oe[2]*ve):(Oe[0]=Be.vRight[0],Oe[1]=Be.vRight[1],Oe[2]=Be.vRight[2]),Re[0]=Ze[Xe]+_e.frame.up[0],Re[1]=Ze[Xe+1]+_e.frame.up[1],Re[2]=Ze[Xe+2]+_e.frame.up[2],Xe+=3,j$1w(o$44(mne,Ze[Xe],Ze[Xe+1],Ze[Xe+2]),Oe,De),S$1E(De,l$3V(Re,Be.vLeft),Ce)?(Ce[0]-=Ze[Xe],Ce[1]-=Ze[Xe+1],Ce[2]-=Ze[Xe+2],z$1d(Te,Ce),_$1z(Ee,Oe,Te),z$1d(Ee,Ee)):At$4(Oe,_e.frame.up,_e.frame.right,Se,Ee,Te,we),r$3w(Be.frame.up,Te),r$3w(Be.frame.right,Ee),_e=Be}}(fe,Wne)}}function re$3(fe,ve,_e){switch(fe){case"symbol-value":return _e;case"proportional":return ve;default:return fe}}function se$4(fe,ve,_e,be){let we=0;const{origin:Se,vertices:Te,positions:Ee,positionsES:Ce}=fe,Oe=fe.offset+3*Te.length;for(let Re=fe.offset;Re<Oe;Re+=3)o$44(Wne,Ce[Re],Ce[Re+1],Ce[Re+2]),_e(Wne,Yne),we+=Yne.sampledElevation,Wne[0]=Ee[Re]+Se[0],Wne[1]=Ee[Re+1]+Se[1],Wne[2]=Ee[Re+2]+Se[2],be.setAltitude(Wne,Yne.z),Ee[Re]=Wne[0]-Se[0],Ee[Re+1]=Wne[1]-Se[1],Ee[Re+2]=Wne[2]-Se[2];return fe.updatePathVertexInformation(),we/Te.length}const Wne=[0,0,0],Yne=new TG;function M$p(fe,ve,_e,be,we=1){o$44(Qne,1,0,0),o$44(Kne,0,1,0),o$44(ese,0,0,1),function D$k(fe,ve){o$44(use,0,0,0);for(let _e=0;_e<ve.length-3;_e+=3)use[0]+=ve[_e],use[1]+=ve[_e+1],use[2]+=ve[_e+2];g$2z(fe,use,1/(ve.length/3-1))}(Zne,_e),function d$2_(fe,ve,_e=!0){const be=ve.length/3;return X$v(fe,((fe,_e)=>o$44(fe,ve[3*_e+0],ve[3*_e+1],ve[3*_e+2])),_e?be-1:be)}(Jne,_e)&&function O$q(fe,ve,_e,be,we,Se){null!=we?(we.basisMatrixAtPosition(Se,ose),o$44(ase,ose[0],ose[1],ose[2]),o$44(lse,ose[4],ose[5],ose[6]),o$44(cse,ose[8],ose[9],ose[10])):(o$44(ase,1,0,0),o$44(lse,0,1,0),o$44(cse,0,0,1));const Te=fe;P$1g(Te,cse)<0&&g$2z(Te,Te,-1),r$3w(be,Te);const Ee=P$1g(Te,lse),Ce=P$1g(Te,ase);Math.abs(Ee)>Math.abs(Ce)?(q$11(ve,ase,Te,-Ce),z$1d(ve,ve),_$1z(_e,ve,Te),z$1d(_e,_e),g$2z(_e,_e,-1)):(q$11(_e,lse,Te,-Ee),z$1d(_e,_e),_$1z(ve,_e,Te),z$1d(ve,ve))}(Jne,Qne,Kne,ese,be,Zne),o$2R(tse,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o$2R(rse,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let Re=0;Re<_e.length;Re+=3){o$44(Xne,_e[Re],_e[Re+1],_e[Re+2]);const fe=P$1g(Qne,Xne),ve=P$1g(Kne,Xne);tse[0]=Math.min(tse[0],fe),tse[1]=Math.min(tse[1],ve),rse[0]=Math.max(rse[0],fe),rse[1]=Math.max(rse[1],ve)}const Se=P$1g(ese,Zne);q$g(ise,tse[0],tse[1],Se,Qne,Kne,ese),q$g(nse,rse[0],tse[1],Se,Qne,Kne,ese),q$g(sse,tse[0],rse[1],Se,Qne,Kne,ese),e$3Z(nse,nse,ise),g$2z(nse,nse,.5),e$3Z(sse,sse,ise),g$2z(sse,sse,.5),u$3Y(ise,ise,nse),u$3Y(ise,ise,sse);const Te=tse[0]%we,Ee=tse[1]%we,Ce=tse[0]-Te,Oe=tse[1]-Ee;for(let Re=0;Re<_e.length;Re+=3){o$44(Xne,_e[Re],_e[Re+1],_e[Re+2]);const be=Re/3,Se=4*be;fe[Se]=(P$1g(Qne,Xne)-Ce)/we,fe[Se+1]=(P$1g(Kne,Xne)-Oe)/we,fe[Se+2]=Ce/we,fe[Se+3]=Oe/we;const Te=9*be;for(let fe=0;fe<3;fe++)ve[Te+fe]=ise[fe],ve[Te+fe+3]=nse[fe],ve[Te+fe+6]=sse[fe]}}const Zne=[0,0,0],Xne=[0,0,0],Jne=E$1z(),Qne=[0,0,0],Kne=[0,0,0],ese=[0,0,0],tse=[0,0],rse=[0,0],ise=[0,0,0],nse=[0,0,0],sse=[0,0,0];const ose=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ase=[0,0,0],lse=[0,0,0],cse=[0,0,0];const use=[0,0,0];function q$g(fe,ve,_e,be,we,Se,Te){o$44(fe,ve*we[0]+_e*Se[0]+be*Te[0],ve*we[1]+_e*Se[1]+be*Te[1],ve*we[2]+_e*Se[2]+be*Te[2])}let hse=class e47 extends QB{intersect(fe,ve,_e,be,we,Se){return p$2m(fe,_e,be,we,void 0,Se)}};function f$S(fe){const ve=new gO,{vertex:_e,fragment:be,attributes:we,varyings:Se}=ve;d$1$(_e,fe),ve.include(o$2n,fe),ve.include(e$24,fe),ve.include(l$2t,fe),ve.include(d$1J,fe),we.add(nO.POSITION,"vec3"),fe.vvColor&&we.add(nO.COLORFEATUREATTRIBUTE,"float"),Se.add("vColor","vec4"),Se.add("vpos","vec3");const Te=fe.multipassEnabled&&fe.output===NI.Color;Te&&Se.add("depth","float"),_e.uniforms.add(new hO("eColor",(fe=>fe.color))),_e.code.add(o$2P`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${fe.hasVertexColors?"vColor *= eColor;":fe.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${Te?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),ve.include(P$H,fe),Te&&ve.include(a$2L,fe),be.include(e$2S);const Ee=fe.output===NI.Highlight;return Ee&&ve.include(a$2n,fe),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),be.code.add(o$2P`
  void main() {
    discardBySlice(vpos);
    ${Te?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`fColor.a = 1.0;`:""}

    if (fColor.a < ${o$2P.float(yj)}) {
      discard;
    }

    ${fe.output===NI.Color?o$2P`fragColor = highlightSlice(fColor, vpos); ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${Ee?o$2P`outputHighlight();`:""};
    ${fe.output===NI.ObjectAndLayerIdColor?o$2P`outputObjectAndLayerIdColor();`:""}
  }
  `),ve}const dse=Object.freeze(Object.defineProperty({__proto__:null,build:f$S},Symbol.toStringTag,{value:"Module"}));let pse=class S7 extends fA{initializeProgram(fe){return new gA(fe.rctx,S7.shader.get().build(this.configuration),mA)}_createPipeline(fe,ve){const _e=this.configuration,be=fe===WR.NONE,we=fe===WR.FrontFace;return S$1g({blending:_e.output===NI.Color&&_e.transparent?be?_j:c$2o(fe):null,culling:h$1V(_e.cullFace),depthTest:_e.draped?null:{func:f$1O(fe)},depthWrite:_e.draped?null:(be||we)&&_e.writeDepth?OA:null,drawBuffers:_e.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e.hasOccludees?qH:null,stencilTest:_e.hasOccludees?ve?ZH:YH:null,polygonOffset:be||we?_e.polygonOffset?fse:null:_$N(_e.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(fe){return fe?this._occludeePipelineState:super.getPipeline()}};pse.shader=new LO(dse,(()=>zt((()=>Promise.resolve().then((()=>mRe))),void 0)));const fse={factor:1,units:1};let mse=class i32 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.cullFace=vA.None,this.transparencyPassType=WR.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};e$4o([r$2w({count:NI.COUNT})],mse.prototype,"output",void 0),e$4o([r$2w({count:vA.COUNT})],mse.prototype,"cullFace",void 0),e$4o([r$2w({count:WR.COUNT})],mse.prototype,"transparencyPassType",void 0),e$4o([r$2w()],mse.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],mse.prototype,"hasVertexColors",void 0),e$4o([r$2w()],mse.prototype,"transparent",void 0),e$4o([r$2w()],mse.prototype,"polygonOffset",void 0),e$4o([r$2w()],mse.prototype,"enableOffset",void 0),e$4o([r$2w()],mse.prototype,"writeDepth",void 0),e$4o([r$2w()],mse.prototype,"hasOccludees",void 0),e$4o([r$2w()],mse.prototype,"multipassEnabled",void 0),e$4o([r$2w()],mse.prototype,"cullAboveGround",void 0),e$4o([r$2w()],mse.prototype,"objectAndLayerIdColorInstanced",void 0),e$4o([r$2w()],mse.prototype,"vvColor",void 0),e$4o([r$2w()],mse.prototype,"draped",void 0),e$4o([r$2w({constValue:!1})],mse.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:!0})],mse.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!1})],mse.prototype,"vvSize",void 0),e$4o([r$2w({constValue:!1})],mse.prototype,"vvOpacity",void 0);let yse=class d19 extends hse{constructor(fe){super(fe,new vse),this.supportsEdges=!0,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>fe===NI.Highlight||d$20(fe)&&!this._isTransparent],[qR.OPAQUE_NO_SSAO_DEPTH,fe=>g$1A(fe)&&this.parameters.writeLinearDepth&&!this._isTransparent],[qR.TRANSPARENT_MATERIAL,fe=>d$20(fe)&&this._isTransparent&&this.parameters.writeDepth],[qR.TRANSPARENT_NO_SSAO_DEPTH,fe=>g$1A(fe)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,fe=>(d$20(fe)||g$1A(fe)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[qR.DRAPED_MATERIAL,fe=>e$2L(fe)]]),this._configuration=new mse}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.enableOffset=ve.camera.relativeElevation<bj,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(fe){return new gse(fe)}createBufferWriter(){const fe=H$J().vec3f(nO.POSITION);return has("enable-feature:objectAndLayerId-rendering")&&fe.vec4u8(nO.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?fe.f32(nO.COLORFEATUREATTRIBUTE):fe.vec4u8(nO.COLOR),new VH(fe)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},gse=class T5 extends pM{_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){return this._output===NI.Color&&this._updateOccludeeState(fe),this.ensureTechnique(pse,fe)}},vse=class g17 extends pj{constructor(){super(...arguments),this.color=_d,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=vA.None,this.hasOccludees=!1,this.draped=!1}};var _se;!function(fe){fe[fe.Horizontal=0]="Horizontal",fe[fe.Vertical=1]="Vertical",fe[fe.Cross=2]="Cross",fe[fe.ForwardDiagonal=3]="ForwardDiagonal",fe[fe.BackwardDiagonal=4]="BackwardDiagonal",fe[fe.DiagonalCross=5]="DiagonalCross",fe[fe.COUNT=6]="COUNT"}(_se||(_se={}));const $se=.70710678118,bse=$se;function S$y(fe){const ve=new gO,_e=fe.multipassEnabled&&fe.output===NI.Color,{vertex:be,fragment:we,attributes:Se,varyings:Te}=ve;d$1$(be,fe),ve.include(o$2n,fe),ve.include(e$24,fe),ve.include(l$2t,fe),ve.include(d$1J,fe),fe.draped?be.uniforms.add(new dO("worldToScreenRatio",((fe,ve)=>1/ve.screenToPCSRatio))):Se.add(nO.BOUNDINGRECT,"mat3"),Se.add(nO.POSITION,"vec3"),Se.add(nO.UVMAPSPACE,"vec4"),fe.vvColor&&Se.add(nO.COLORFEATUREATTRIBUTE,"float"),Te.add("vColor","vec4"),Te.add("vpos","vec3"),Te.add("vuv","vec2"),_e&&Te.add("depth","float"),be.uniforms.add(new hO("uColor",(fe=>fe.color)));const Ee=fe.style===_se.ForwardDiagonal||fe.style===_se.BackwardDiagonal||fe.style===_se.DiagonalCross;return Ee&&be.code.add(o$2P`
      const mat2 rotate45 = mat2(${o$2P.float($se)}, ${o$2P.float(-bse)},
                                 ${o$2P.float(bse)}, ${o$2P.float($se)});
    `),fe.draped||(f$20(be,fe),be.uniforms.add(new dO("worldToScreenPerDistanceRatio",((fe,ve)=>1/ve.camera.perScreenPixelRatio))),be.code.add(o$2P`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),be.code.add(o$2P`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),be.code.add(o$2P`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${o$2P.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),be.code.add(o$2P`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${Ee?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${Ee?" * rotate45":""};

      ${fe.draped?"":o$2P`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${o$2P.float(fe.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),be.code.add(o$2P`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${_e?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${fe.hasVertexColors?"vColor *= uColor;":fe.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),ve.include(P$H,fe),we.include(e$2S),fe.draped&&we.uniforms.add(new dO("texelSize",((fe,ve)=>1/ve.camera.pixelRatio))),fe.output===NI.Highlight&&ve.include(a$2n,fe),_e&&ve.include(a$2L,fe),fe.output!==NI.Highlight&&(we.code.add(o$2P`
      const float lineWidth = ${o$2P.float(fe.lineWidth)};
      const float spacing = ${o$2P.float(fe.patternSpacing)};
      const float spacingINV = ${o$2P.float(1/fe.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),fe.draped||we.code.add(o$2P`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),we.code.add(o$2P`
    void main() {
      discardBySlice(vpos);
      ${_e?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${fe.output!==NI.Highlight?o$2P`color.a *= ${function j$y(fe){function o39(ve){return fe.draped?o$2P`coverage(vuv.${ve}, texelSize)`:o$2P`sampleAA(vuv.${ve})`}switch(fe.style){case _se.ForwardDiagonal:case _se.Horizontal:return o39("y");case _se.BackwardDiagonal:case _se.Vertical:return o39("x");case _se.DiagonalCross:case _se.Cross:return o$2P`
        1.0 - (1.0 - ${o39("x")}) * (1.0 - ${o39("y")})
      `;default:return"0.0"}}(fe)};`:""}

      ${fe.output===NI.ObjectAndLayerIdColor?o$2P`color.a = 1.0;`:""}

      if (color.a < ${o$2P.float(yj)}) {
        discard;
      }

      ${fe.output===NI.Color?o$2P`fragColor = color; ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${fe.output===NI.Highlight?o$2P`outputHighlight();`:""}
      ${fe.output===NI.ObjectAndLayerIdColor?o$2P`outputObjectAndLayerIdColor();`:""}
    }
  `),ve}const wse=Object.freeze(Object.defineProperty({__proto__:null,build:S$y},Symbol.toStringTag,{value:"Module"}));let xse=class N4 extends fA{initializeProgram(fe){return new gA(fe.rctx,N4.shader.get().build(this.configuration),has("enable-feature:objectAndLayerId-rendering")?Pse:Ese)}_setPipelineState(fe,ve){const _e=this.configuration,be=fe===WR.NONE,we=fe===WR.FrontFace;return S$1g({blending:_e.output===NI.Color?be?_j:c$2o(fe):null,culling:h$1V(_e.cullFace),depthTest:_e.draped?null:{func:f$1O(fe)},depthWrite:_e.draped?null:be?OA:l$2s(fe),drawBuffers:_e.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e.hasOccludees?qH:null,stencilTest:_e.hasOccludees?ve?ZH:YH:null,polygonOffset:be||we?_e.polygonOffset?Sse:null:_$N(_e.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(fe){return fe?this._occludeePipelineState:super.getPipeline()}};xse.shader=new LO(wse,(()=>zt((()=>Promise.resolve().then((()=>yRe))),void 0)));const Sse={factor:1,units:1};let Tse=class A11 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.cullFace=vA.None,this.transparencyPassType=WR.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};e$4o([r$2w({count:NI.COUNT})],Tse.prototype,"output",void 0),e$4o([r$2w({count:vA.COUNT})],Tse.prototype,"cullFace",void 0),e$4o([r$2w({count:_se.COUNT})],Tse.prototype,"style",void 0),e$4o([r$2w({count:WR.COUNT})],Tse.prototype,"transparencyPassType",void 0),e$4o([r$2w()],Tse.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Tse.prototype,"hasVertexColors",void 0),e$4o([r$2w()],Tse.prototype,"polygonOffset",void 0),e$4o([r$2w()],Tse.prototype,"hasOccludees",void 0),e$4o([r$2w()],Tse.prototype,"patternSpacing",void 0),e$4o([r$2w()],Tse.prototype,"lineWidth",void 0),e$4o([r$2w()],Tse.prototype,"enableOffset",void 0),e$4o([r$2w()],Tse.prototype,"draped",void 0),e$4o([r$2w()],Tse.prototype,"multipassEnabled",void 0),e$4o([r$2w()],Tse.prototype,"cullAboveGround",void 0),e$4o([r$2w()],Tse.prototype,"vvColor",void 0),e$4o([r$2w({constValue:!0})],Tse.prototype,"writeDepth",void 0),e$4o([r$2w({constValue:!1})],Tse.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:!1})],Tse.prototype,"hasVvInstancing",void 0),e$4o([r$2w({constValue:!1})],Tse.prototype,"vvSize",void 0),e$4o([r$2w({constValue:!1})],Tse.prototype,"vvOpacity",void 0);const Ese=new Map([[nO.POSITION,0],[nO.COLOR,3],[nO.UVMAPSPACE,4],[nO.COLORFEATUREATTRIBUTE,5],[nO.BOUNDINGRECT,6]]),Pse=new Map([[nO.POSITION,0],[nO.COLOR,3],[nO.UVMAPSPACE,4],[nO.COLORFEATUREATTRIBUTE,5],[nO.BOUNDINGRECT,6],[nO.OBJECTANDLAYERIDCOLOR,9]]);let Cse=class v8 extends hse{constructor(fe){super(fe,new Mse),this.supportsEdges=!0,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>h$1Q(fe)],[qR.TRANSPARENT_MATERIAL,fe=>i$2J(fe)],[qR.TRANSPARENT_NO_SSAO_DEPTH,fe=>g$1A(fe)&&this.parameters.writeLinearDepth],[qR.DRAPED_MATERIAL,fe=>this.parameters.draped&&fe===NI.Color||h$1Q(fe)]]),this._vertexAttributeLocations=has("enable-feature:objectAndLayerId-rendering")?Pse:Ese,this._configuration=new Tse}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.enableOffset=ve.camera.relativeElevation<bj,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(fe){return new Ose(fe)}createBufferWriter(){const fe=H$J().vec3f(nO.POSITION).vec4f(nO.UVMAPSPACE);return this.parameters.draped||fe.mat3f(nO.BOUNDINGRECT),this.parameters.vvColor?fe.f32(nO.COLORFEATUREATTRIBUTE):fe.vec4u8(nO.COLOR),has("enable-feature:objectAndLayerId-rendering")&&fe.vec4u8(nO.OBJECTANDLAYERIDCOLOR),new Ase(fe)}},Ose=class E7 extends pM{_updateParameters(fe){return this.ensureTechnique(xse,fe)}_updateOccludeeState(fe){fe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fe.hasOccludees})}beginSlot(fe){return this._output===NI.Color&&this._updateOccludeeState(fe),this._updateParameters(fe)}},Ase=class S8 extends VH{write(fe,ve,_e,be,we){E$Z(_e,this.vertexBufferLayout,fe,ve,be,we);for(const Se of this.vertexBufferLayout.fields.keys()){const ve=_e.attributes.get(Se),Te=null==ve?void 0:ve.indices;if(ve&&Te)switch(Se){case nO.UVMAPSPACE:{s$31(4===ve.size);const fe=be.getField(Se,hL);fe&&p$2y(ve,fe,we);break}case nO.BOUNDINGRECT:{s$31(9===ve.size);const _e=be.getField(Se,dL);_e&&j$x(ve,fe,_e,we);break}}}}};function j$x(fe,ve,_e,be){const{data:we,indices:Se}=fe,Te=ve,Ee=_e.typedBuffer,Ce=_e.typedBufferStride,Oe=Se.length;be*=Ce;for(let Re=0;Re<Oe;++Re){const fe=9*Se[Re],ve=we[fe],_e=we[fe+1],Oe=we[fe+2];Ee[be]=Te[0]*ve+Te[4]*_e+Te[8]*Oe+Te[12],Ee[be+1]=Te[1]*ve+Te[5]*_e+Te[9]*Oe+Te[13],Ee[be+2]=Te[2]*ve+Te[6]*_e+Te[10]*Oe+Te[14];for(let Se=3;Se<9;++Se)Ee[be+Se]=we[fe+Se];be+=Ce}}let Mse=class C7 extends pj{constructor(){super(...arguments),this.color=r$35(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=vA.None,this.hasOccludees=!1,this.style=_se.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function s$1m(fe,ve){const _e=(null==fe?void 0:fe.pattern)??null;return null==_e?new yse(ve):"none"===_e.style||"solid"===_e.style?("none"===_e.style&&(ve.color=r$35(0,0,0,0),ve.forceTransparentMode=!0),new yse(ve)):(ve.style=function l$1u(fe){switch(fe){case"horizontal":return _se.Horizontal;case"vertical":return _se.Vertical;case"cross":return _se.Cross;case"forward-diagonal":return _se.ForwardDiagonal;case"backward-diagonal":return _se.BackwardDiagonal;case"diagonal-cross":return _se.DiagonalCross;default:return}}(_e.style),new Cse(ve))}function u$16(fe,ve){if(function c$1v(fe){return fe.material instanceof Cse&&!fe.material.parameters.draped}(fe)){const _e=fe.attributes.get(nO.POSITION).data;M$p(fe.getMutableAttribute(nO.UVMAPSPACE).data,fe.getMutableAttribute(nO.BOUNDINGRECT).data,_e,ve)}}function m$19(fe,ve,_e,be,we){const Se=u$22(fe,ve,_e,be,we),Te=fe.stageObject.geometries;for(const Ee of Te)u$16(Ee,we);return Se}const Rse=["polyline","polygon","extent"],Ise=new BB({size:!1,color:!0,rotation:!1,opacity:!1});let Lse=class N5 extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._needsUV=!1}async doLoad(){this._fastUpdates=O$O(this._context.renderer,Ise)}_createMaterials(){var fe,ve,_e;if(this._materials.length>0)return;const be=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color,we=this._getCombinedOpacityAndColor(be);this._materials[zse.Fill]=s$1m(this.symbolLayer,{color:we,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...null==(_e=this._fastUpdates)?void 0:_e.materialParameters}),this._needsUV=this._materials[zse.Fill]instanceof Cse;const Se=this.symbolLayer.outline;if(function K$8(fe){return null!=(null==fe?void 0:fe.size)&&fe.size>0&&null!=fe.color&&(null==fe.pattern||"style"!==fe.pattern.type||"none"!==fe.pattern.style)}(Se)){const fe=n$1O(Se.pattern);this._materials[zse.Outline]=new GZ({width:u$3E(Se.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:fe,cap:n$1P(Se.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,Rse,this.symbolLayer.type))return null;const _e=this._getVertexOpacityAndColor(fe.renderingInfo,255),be=this.setGraphicElevationContext(ve);return this.ensureDrapedStatus("on-the-ground"===be.mode),this._createMaterials(),this.draped?this._createAsOverlay(ve,_e):this._createAs3DShape(ve,_e,be)}applyRendererDiff(fe,ve){var _e;for(const be in fe.diff){if("visualVariables"!==be)return Hq.RecreateSymbol;if(!G$r(this._fastUpdates,ve,Ise))return Hq.RecreateSymbol;null==(_e=this._materials[zse.Fill])||_e.setParameters(this._fastUpdates.materialParameters)}return Hq.FastUpdate}layerOpacityChanged(){var fe,ve;if(null!=this._materials[zse.Fill]){const _e=this._materials[zse.Fill].parameters.color,be=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color,we=this._getCombinedOpacity(be);this._materials[zse.Fill].setParameters({color:[_e[0],_e[1],_e[2],we],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[zse.Outline]){const fe=this._materials[zse.Outline].parameters.color;this._materials[zse.Outline].setParameters({color:[fe[0],fe[1],fe[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(fe,ve,_e){const be=this._elevationContext.mode,we=m$1X(N5.elevationModeChangeTypes,_e,be);if(we!==EG.UPDATE)return we;const Se=d$1F(be);return this.updateGraphics3DGraphicElevationInfo(fe,ve,(()=>Se))}slicePlaneEnabledChanged(){var fe;if(null==(fe=this._materials[zse.Fill])||fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[zse.Outline]){const fe={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[zse.Outline].setParameters(fe)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(fe,ve,_e){var be;const we=b$X(fe.geometry);if(!we)return null;const Se=p$28(we,this._context.elevationProvider,this._context.renderCoordsHelper,_e),Te=new Nse(Se,ve,this._context.layer.uid,fe.uid),Ee=Te.renderData.position.length/3;if(this._needsUV&&(Te.uvMapSpace=t$2G(4*Ee,!0),Te.boundingRect=t$2H(9*Ee,!0),M$p(Te.uvMapSpace,Te.boundingRect,Te.renderData.position,this._context.renderCoordsHelper)),Te.objectAndLayerIdColor=null==(be=this._context.stage.renderView)?void 0:be.getObjectAndLayerIdColor(Te),this._createAs3DShapeFill(fe,Te),this._materials[zse.Outline]&&this._createAs3DShapeOutline(Te),this._logGeometryCreationWarnings(Te.renderData,we.rings,"rings","FillSymbol3DLayer"),0===Te.outGeometries.length)return null;const Ce=new Qq({geometries:Te.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:fe.uid}),Oe=new qG(this,Ce,Te.outGeometries,null,null,m$19,_e);return Oe.alignedSampledElevation=Te.renderData.sampledElevation,Oe.needsElevationUpdates=d$1F(_e.mode),Oe}_createAs3DShapeFill(fe,ve){var _e;const be=ve.renderData.polygons;for(const{position:we,mapPositions:Se,holeIndices:Te,index:Ee,count:Ce}of be){if(null!=this._context.clippingExtent&&(P$$(Dse),c$3A(Dse,Se),!V$W(Dse,this._context.clippingExtent)))continue;const be=p$2f(Se,Te,this._context.elevationProvider.spatialReference);if(0===be.length)continue;const Oe=null==(_e=this._fastUpdates)?void 0:_e.visualVariables.color,Re=m$1H({material:this._materials[zse.Fill],indices:be,mapPositions:Se,attributeData:{position:we,color:Oe?null:ve.color,colorFeature:Oe?X$h(Oe.field,fe):null,uvMapSpace:this._needsUV?o$2j(ve.uvMapSpace,4*Ee,4*Ce):null,boundingRect:this._needsUV?a$2H(ve.boundingRect,9*Ee,9*Ce):null,objectAndLayerIdColor:ve.objectAndLayerIdColor}});ve.outGeometries.push(Re)}}_createAs3DShapeOutline(fe){if(null==this._materials[zse.Outline])return;const ve=fe.renderData.outlines;for(const{mapPositions:_e,position:be}of ve){if(null!=this._context.clippingExtent&&(P$$(Dse),c$3A(Dse,_e),!V$W(Dse,this._context.clippingExtent)))continue;const ve=b$K(this._materials[zse.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:_e,attributeData:{position:be}},fe.objectAndLayerIdColor);fe.outGeometries.push(ve)}}_createAsOverlay(fe,ve){var _e;const be=b$X(fe.geometry);if(null==be)return null;this._materials[zse.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[zse.Outline]&&(this._materials[zse.Outline].renderPriority=this._renderPriority);const we=c$1_(be,this._context.overlaySR),Se=new Fse(we,ve,this._context.layer.uid,fe.uid),Te=Se.renderData.position.length/3;return this._needsUV&&(Se.uvMapSpace=t$2G(4*Te,!0),function T$q(fe,ve,_e,be,we=1){if(_e.isGeographic&&be===Wf.Global){const fe=t$2H(ve.length),be=ve.length,we=s$45(_e);for(let _e=0;_e<be;_e+=3)H$14(ve,_e,fe,_e,we);ve=fe}o$2R(tse,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let Oe=0;Oe<ve.length;Oe+=3)tse[0]=Math.min(tse[0],ve[Oe]),tse[1]=Math.min(tse[1],ve[Oe+1]);const Se=tse[0]%we,Te=tse[1]%we,Ee=tse[0]-Se,Ce=tse[1]-Te;for(let Oe=0;Oe<ve.length;Oe+=3){const _e=Oe/3*4;fe[_e]=(ve[Oe]-Ee)/we,fe[_e+1]=(ve[Oe+1]-Ce)/we,fe[_e+2]=Ee/we,fe[_e+3]=Ce/we}}(Se.uvMapSpace,Se.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),Se.outBoundingBox=P$$(),Se.objectAndLayerIdColor=null==(_e=this._context.stage.renderView)?void 0:_e.getObjectAndLayerIdColor(Se),this._createAsOverlayFill(fe,Se),this._materials[zse.Outline]&&this._createAsOverlayOutline(Se),this._logGeometryCreationWarnings(Se.renderData,be.rings,"rings","FillSymbol3DLayer"),0===Se.outGeometries.length?null:new Q9(this,Se.outGeometries,Se.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(fe,ve){var _e;const be=ve.renderData.polygons;for(const{position:we,holeIndices:Se,index:Te,count:Ee}of be){const be=P$$(Dse);if(c$3A(be,we),!V$W(be,this._context.clippingExtent))continue;const Ce=GW(we,Se,3);if(0===Ce.length)continue;o$35(ve.outBoundingBox,be);const Oe=null==(_e=this._fastUpdates)?void 0:_e.visualVariables.color,Re=m$1H({material:this._materials[zse.Fill],indices:Ce,attributeData:{position:we,color:Oe?null:ve.color,colorFeature:Oe?X$h(Oe.field,fe):null,uvMapSpace:this._needsUV?o$2j(ve.uvMapSpace,4*Te,4*Ee):null,objectAndLayerIdColor:ve.objectAndLayerIdColor}});ve.outGeometries.push(new lee(Re,ve))}}_createAsOverlayOutline(fe){if(null==this._materials[zse.Outline])return;const ve=fe.renderData.outlines;for(let _e=0;_e<ve.length;++_e){const{position:be}=ve[_e];if(P$$(Dse),c$3A(Dse,be),!V$W(Dse,this._context.clippingExtent))continue;o$35(fe.outBoundingBox,Dse);const we=b$K(this._materials[zse.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:be}},fe.objectAndLayerIdColor);fe.outGeometries.push(new lee(we,fe))}}_getOutlineOpacity(){var fe,ve;const _e=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.outline)?void 0:ve.color;return(this.draped?1:this._getLayerOpacity())*(null!=_e?_e.a:0)}_getOutlineColor(){var fe,ve;const _e=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.outline)?void 0:ve.color,be=this._getOutlineOpacity();return F$B(null!=_e?b_.toUnitRGB(_e):null,be)}test(){return{...super.test(),createAsOverlay:(fe,ve)=>this._createAsOverlay(fe,ve),createAs3DShape:(fe,ve,_e)=>this._createAs3DShape(fe,ve,_e)}}};Lse.elevationModeChangeTypes={definedChanged:EG.RECREATE,staysOnTheGround:EG.NONE,onTheGroundChanged:EG.RECREATE};const Dse=i$3t();let Nse=class k4 extends QW{constructor(fe,ve,_e,be){super(fe,_e,be),this.color=ve}},Fse=class q4 extends QW{constructor(fe,ve,_e,be){super(fe,_e,be),this.color=ve}};var zse;!function(fe){fe[fe.Fill=0]="Fill",fe[fe.Outline=1]="Outline"}(zse||(zse={}));let kse=class i33{constructor(fe,ve="center",_e=!1,be=[0,0],we=r$35(0,0,0,-1),Se="world",Te=[0,0,0],Ee=0){this.verticalOffset=fe,this.anchor=ve,this.hasLabelVerticalOffset=_e,this.screenOffset=be,this.centerOffset=we,this.centerOffsetUnits=Se,this.translation=Te,this.elevationOffset=Ee}},Use=class r45{constructor(fe,ve="center",_e="center",be=null,we=[0,0]){this.placement=fe,this.horizontalPlacement=ve,this.verticalPlacement=_e,this.text=be,this.displaySize=we}},Vse=class s57{constructor(fe){this.definition=fe,this.key=JSON.stringify(fe),this.haloSize=Math.round(fe.halo.size),this.textStyle=a$1q(fe.color),this.haloStyle=function l$1t(fe){return`rgb(${fe.slice(0,3).map((fe=>Math.floor(255*fe))).toString()})`}(fe.halo.color),this.backgroundStyle=0!==fe.background.color[3]?a$1q(fe.background.color):null}fontString(fe){const ve=this.definition.font;return`${ve.style} ${ve.weight} ${fe}px ${ve.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(fe,ve){fe.font=this.fontString(ve),fe.textAlign="left",fe.textBaseline="alphabetic"}static async fromSymbol(fe,ve){var _e,be,we,Se,Te;const Ee=null==(_e=null==fe?void 0:fe.material)?void 0:_e.color,Ce=b_.toUnitRGBA(Ee)??_d,Oe=null!=fe.size?u$3E(fe.size):12,Re=fe.lineHeight,De=null!=fe.background?b_.toUnitRGBA(fe.background.color):_d,Be={family:(null==(be=fe.font)?void 0:be.family)??"sans-serif",decoration:(null==(we=fe.font)?void 0:we.decoration)??"none",weight:(null==(Se=fe.font)?void 0:Se.weight)??"normal",style:(null==(Te=fe.font)?void 0:Te.style)??"normal"},Ze=fe.halo,Xe=null!=(null==Ze?void 0:Ze.color)&&Ze.size>0?{size:u$3E(Ze.size),color:b_.toUnitRGBA(Ze.color)}:{size:0,color:_d},Je=new s57({color:Ce,size:Oe,background:{color:De,padding:null!=fe.background?[.65*Oe,.5*Oe]:[0,0],borderRadius:null!=fe.background?Oe*(6/16):0},lineSpacingFactor:Re,font:Be,halo:Xe,pixelRatio:ve});if(fe.font){let ve=!1;const _e=Je.fontString(Oe);try{ve=(await document.fonts.load(_e)).some((fe=>!function i$1X(fe){return nK.has(fe)}(fe)))}catch(ro){ar.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${_e}'. Some text symbology may be rendered using the default browser font.`)}if(!ve&&!Bse.has(fe.font.family))try{await c$1X(fe.font)}catch(ro){}}return Je}};function a$1q(fe){return`rgba(${fe.slice(0,3).map((fe=>Math.floor(255*fe))).toString()},${fe[3]})`}const Bse=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),jse=4096;let Gse=class v9 extends zi{constructor(fe){super(fe),this.type=eD.Texture,this.id=e$44(),this.events=new La,this._glTexture=null,this._atlas=new Yse(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=r$3M(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return Xse=0,[jse-Hse-Xse,jse-Hse-Xse-qse]}load(fe){if(this._glTexture)return this._glTexture;const ve=new nM;return ve.wrapMode=qO.CLAMP_TO_EDGE,ve.samplingMode=HO.LINEAR_MIPMAP_LINEAR,ve.hasMipmap=!0,ve.preMultiplyAlpha=!0,ve.maxAnisotropy=fe.parameters.maxMaxAnisotropy,this._glTexture=new oM(fe,ve,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(gI.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=l$4E(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=r$3M(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(fe){this._canvas.setAttribute("width",fe.width.toString()),this._canvas.setAttribute("height",fe.height.toString())}_resizeAtlas(fe,ve){var _e,be;const{width:we,height:Se}=this._atlas;we===fe&&Se===ve||(this._atlas.width=fe,this._atlas.height=ve,null==(_e=this._glTexture)||_e.resize(fe,ve),null==(be=this._glTexture)||be.updateData(0,0,0,we,Se,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((fe=>{const ve=this._stageObjects.get(fe.textRenderer.key);null==ve||ve.forEach((ve=>y$J(ve,fe)))})),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(fe,ve,_e,be){const we=this._atlas;if(we.width<_e||we.height<be)return!1;let Se=we.cursors.get(be);if(!Se){if(we.height<we.nextY+be)return!1;Se=[new Zse(we.nextY)],we.cursors.set(be,Se),we.nextY+=be}let Te=Se.find((fe=>we.width>=fe.x+_e));if(null==Te){if(we.height<we.nextY+be)return!1;Te=new Zse(we.nextY),we.nextY+=be,Se.push(Te)}return fe.setNewPosition(Te),this._elements.set(ve,fe),this._elementsToRender.set(ve,fe),Te.x+=_e,!0}_ensureStageObjects(fe){const ve=this._stageObjects.get(fe);if(ve)return ve;const _e=new Set;return this._stageObjects.set(fe,_e),_e}_addStageObject(fe,ve){this._ensureStageObjects(fe).add(ve)}_removeStageObject(fe,ve){const _e=this._stageObjects.get(fe);(null==_e?void 0:_e.delete(ve))&&(ve.geometries[0].setAttributeData(nO.SIZE,[0,0]),ve.geometryVertexAttributeUpdated(ve.geometries[0],nO.SIZE),this._elementsToRender.delete(fe))}_processAddition(fe){const ve=fe.textRenderer.key;if(this._needsRepack)return void this._elements.set(ve,fe);const _e=this._atlas,be=fe.textRenderer.renderedWidth,we=fe.textRenderer.renderedHeight,Se=be+Hse,Te=we+Hse+qse;if(!this._addAtlasElement(fe,ve,Se,Te)){if(this._canRepack)this._reset();else if(_e.width<Se){const fe=Math.min(n$2$(Math.max(Se,1.5*_e.width)),jse);this._resizeAtlas(fe,_e.height)}else{const fe=_e.nextY+Te,ve=Math.min(n$2$(Math.max(fe,1.5*_e.height)),jse);if(ve>_e.height)this._resizeAtlas(_e.width,ve);else if(_e.width<jse){const fe=Math.min(n$2$(1.5*_e.width),jse);this._resizeAtlas(fe,_e.height)}}this._elements.set(ve,fe)}}_renderElement(fe){const ve=fe.commitNewPosition(),_e=fe.textRenderer;this._ctx.clearRect(ve[0]-Hse,ve[1]-Hse,_e.renderedWidth+2*Hse,_e.renderedHeight+2*Hse),_e.render(this._ctx,ve[0],ve[1]);const be=this._stageObjects.get(_e.key);null==be||be.forEach((ve=>y$J(ve,fe)))}get running(){return this.updating}runTask(fe){if(null==this._glTexture)return dI;for(;this._needsRepack&&(this._canRepack||this._atlas.height<jse&&this._atlas.height<jse);){this._canRepack=this._needsRepack=!1;const ve=this._elements;this._elements=new Map,ve.forEach((fe=>this._processAddition(fe))),fe.madeProgress()}if(this._elementsToRender.size>0){for(const[ve,_e]of this._elementsToRender){if(fe.done)break;this._renderElement(_e),this._elementsToRender.delete(ve),fe.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(fe,ve){const _e=fe.key;this._addStageObject(_e,ve);let be=this._elements.get(_e);null==be&&(be=new Wse(this._atlas,fe),this._processAddition(be),this.setDirty()),function j$w(fe,ve){fe.geometries[0].setAttributeData(nO.SIZE,[ve.textRenderer.displayWidth,ve.textRenderer.displayHeight]),fe.geometryVertexAttributeUpdated(fe.geometries[0],nO.SIZE)}(ve,be),y$J(ve,be)}removeTextTexture(fe,ve){const _e=fe.key;if(!this._elements.get(_e))return;this._removeStageObject(_e,ve);const be=this._stageObjects.get(_e);be&&0!==be.size||this._elements.delete(_e),0===(null==be?void 0:be.size)&&this._stageObjects.delete(_e),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function y$J(fe,ve){fe.geometries[0].setAttributeData(nO.UV0,ve.uv),fe.geometryVertexAttributeUpdated(fe.geometries[0],nO.UV0,!0)}e$4o([y$2v({constructOnly:!0})],Gse.prototype,"view",void 0),e$4o([y$2v({type:Boolean})],Gse.prototype,"updating",void 0),Gse=e$4o([a$4y("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Gse);const Hse=2,qse=2;let Wse=class O8{constructor(fe,ve){this._atlas=fe,this.textRenderer=ve,this._uv=[0,0,0,0],this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return _d;const{renderedWidth:fe,renderedHeight:ve}=this.textRenderer;return s$3I(this._uv,this._xOffset/this._atlas.width,(this._yOffset+ve)/this._atlas.height,(this._xOffset+fe)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(fe){this._newPosition[0]=fe.x,this._newPosition[1]=fe.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},Yse=class E8{constructor(fe,ve){this.width=fe,this.height=ve,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=Xse}},Zse=class k5{constructor(fe){this.y=fe,this.x=Xse}},Xse=0,Jse=class i34{constructor(fe,ve,_e){this._renderer=new Q7(fe,ve,_e,Gse.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const fe=a$1G(Qse,this._renderer.renderedWidth,this._renderer.renderedHeight),ve=fe.getContext("2d");return ve.save(),this._renderer.render(ve,0,0),ve.restore(),new CZ(fe,{wrap:{s:qO.CLAMP_TO_EDGE,t:qO.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Qse={canvas:null},Kse=r$3y(0,0,1);function W$a(fe,ve,_e){fe&&fe.forEach((fe=>{const be=ve(fe);null!=be&&_e(be,fe.graphic)}))}const eoe={mode:"relative-to-ground",offset:0};function u$15(fe){fe.fragment.uniforms.add(new CO("texWaveNormal",(fe=>fe.waveNormal)),new CO("texWavePerturbation",(fe=>fe.wavePerturbation)),new hO("waveParams",(fe=>s$3I(toe,fe.waveStrength,fe.waveTextureRepeat,fe.flowStrength,fe.flowOffset))),new lO("waveDirection",(fe=>o$2R(roe,fe.waveDirection[0]*fe.waveVelocity,fe.waveDirection[1]*fe.waveVelocity)))),fe.include(o$1w),fe.fragment.code.add(o$2P`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const toe=[0,0,0,0],roe=[0,0];function S$v(fe){const ve=new gO,{vertex:_e,fragment:be}=ve;d$1$(_e,fe),ve.include(o$2n,fe),ve.attributes.add(nO.POSITION,"vec3"),ve.attributes.add(nO.UV0,"vec2");const we=new hO("waterColor",(fe=>fe.color));if(fe.output===NI.Color&&fe.draped)return ve.varyings.add("vpos","vec3"),_e.uniforms.add(we),_e.code.add(o$2P`
        void main(void) {
          if (waterColor.a < ${o$2P.float(yj)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),be.uniforms.add(we),be.code.add(o$2P`void main() {
fragColor = waterColor;
}`),ve;switch(fe.output===NI.Color&&(ve.include(r$Y,fe),ve.include(n$2S,fe),ve.varyings.add("vuv","vec2"),ve.varyings.add("vpos","vec3"),ve.varyings.add("vnormal","vec3"),ve.varyings.add("vtbnMatrix","mat3"),fe.multipassEnabled&&ve.varyings.add("depth","float"),_e.uniforms.add(we),_e.code.add(o$2P`
      void main(void) {
        if (waterColor.a < ${o$2P.float(yj)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${fe.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${fe.output===NI.Color?"forwardLinearDepth();":""}
      }
    `)),ve.include(a$2L,fe),fe.output){case NI.Color:ve.include(o$2N),ve.include(r$2s,{pbrMode:yM.Disabled,lightingSphericalHarmonicsOrder:2}),ve.include(u$15),ve.include(P$H,fe),ve.include(x$O,fe),ve.include(f$1p,fe),be.uniforms.add(we,new dO("timeElapsed",(fe=>fe.timeElapsed)),_e.uniforms.get("view"),_e.uniforms.get("localOrigin")),f$20(be,fe),be.include(e$2S),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),t$34(be),a$2$(be),be.code.add(o$2P`
      void main() {
        discardBySlice(vpos);
        ${fe.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${fe.receiveShadows?o$2P`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case NI.Normal:ve.include(r$Y,fe),ve.include(u$15,fe),ve.include(P$H,fe),ve.varyings.add("vpos","vec3"),ve.varyings.add("vuv","vec2"),_e.uniforms.add(we),_e.code.add(o$2P`
        void main(void) {
          if (waterColor.a < ${o$2P.float(yj)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),be.uniforms.add(new dO("timeElapsed",(fe=>fe.timeElapsed))),be.code.add(o$2P`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case NI.Highlight:ve.include(a$2n,fe),ve.varyings.add("vpos","vec3"),_e.uniforms.add(we),_e.code.add(o$2P`
      void main(void) {
        if (waterColor.a < ${o$2P.float(yj)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),ve.include(P$H,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case NI.ObjectAndLayerIdColor:ve.include(d$1J,fe),ve.varyings.add("vpos","vec3"),_e.uniforms.add(we),_e.code.add(o$2P`
      void main(void) {
        if (waterColor.a < ${o$2P.float(yj)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),ve.include(P$H,fe),be.code.add(o$2P`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return ve}const ioe=Object.freeze(Object.defineProperty({__proto__:null,build:S$v},Symbol.toStringTag,{value:"Module"}));let noe=class T6 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global,ve.doublePrecisionRequiresObfuscation=fe.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(fe){return new gA(fe.rctx,T6.shader.get().build(this.configuration),mA)}_setPipelineState(fe){const ve=this.configuration,_e=fe===WR.NONE,be=fe===WR.FrontFace;return S$1g({blending:ve.output!==NI.Normal&&ve.output!==NI.Highlight&&ve.output!==NI.ObjectAndLayerIdColor&&ve.transparent?_e?_j:c$2o(fe):null,depthTest:ve.draped?null:{func:f$1O(fe)},depthWrite:ve.draped?null:_e?ve.writeDepth?OA:null:l$2s(fe),drawBuffers:s$2m(fe),colorWrite:AA,polygonOffset:_e||be?null:_$N(ve.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};noe.shader=new LO(ioe,(()=>zt((()=>Promise.resolve().then((()=>gRe))),void 0)));let soe=class O9 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.transparencyPassType=WR.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};e$4o([r$2w({count:NI.COUNT})],soe.prototype,"output",void 0),e$4o([r$2w({count:WR.COUNT})],soe.prototype,"transparencyPassType",void 0),e$4o([r$2w()],soe.prototype,"spherical",void 0),e$4o([r$2w()],soe.prototype,"receiveShadows",void 0),e$4o([r$2w()],soe.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],soe.prototype,"transparent",void 0),e$4o([r$2w()],soe.prototype,"enableOffset",void 0),e$4o([r$2w()],soe.prototype,"writeDepth",void 0),e$4o([r$2w()],soe.prototype,"hasScreenSpaceReflections",void 0),e$4o([r$2w()],soe.prototype,"doublePrecisionRequiresObfuscation",void 0),e$4o([r$2w()],soe.prototype,"hasCloudsReflections",void 0),e$4o([r$2w()],soe.prototype,"objectAndLayerIdColorInstanced",void 0),e$4o([r$2w()],soe.prototype,"draped",void 0),e$4o([r$2w()],soe.prototype,"multipassEnabled",void 0),e$4o([r$2w()],soe.prototype,"cullAboveGround",void 0),e$4o([r$2w({constValue:!1})],soe.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:yM.Water})],soe.prototype,"pbrMode",void 0),e$4o([r$2w({constValue:!0})],soe.prototype,"useCustomDTRExponentForWater",void 0),e$4o([r$2w({constValue:!0})],soe.prototype,"highStepCount",void 0),e$4o([r$2w({constValue:!1})],soe.prototype,"useFillLights",void 0);let ooe=class s58 extends pM{_updateShadowState(fe){fe.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:fe.shadowMap.enabled})}_updateSSRState(fe){const ve=null!=fe.ssr.lastFrameColor;ve!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:ve})}_updateCloudsReflectionState(fe){const ve=null!=fe.cloudsFade.data;ve!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:ve})}ensureResources(fe){return this._techniques.constructionContext.waterTextures.ensureResources(fe)}beginSlot(fe){return this._output===NI.Color&&(this._updateShadowState(fe),this._updateSSRState(fe),this._updateCloudsReflectionState(fe)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(noe,fe)}},aoe=class _9 extends hse{constructor(fe){super(fe,new loe),this._configuration=new soe,this._animation=new uN,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>i$2J(fe)&&!this.parameters.transparent||h$1Q(fe)],[qR.TRANSPARENT_MATERIAL,fe=>i$2J(fe)&&this.parameters.transparent||h$1Q(fe)],[qR.DRAPED_MATERIAL,fe=>this.parameters.draped&&fe===NI.Color||h$1Q(fe)],[qR.DRAPED_WATER,fe=>fe===NI.Normal]])}getConfiguration(fe,ve){return this._configuration.output=fe,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=ve.transparencyPassType,this._configuration.enableOffset=ve.camera.relativeElevation<bj,this._configuration.multipassEnabled=ve.multipassEnabled,this._configuration.cullAboveGround=ve.multipassTerrain.cullAboveGround,this._configuration}update(fe){const ve=Math.min(fe.camera.relativeElevation,fe.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*ve<coe;const _e=this._animation.advance(fe);return this.setParameters({timeElapsed:u$46(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&_e}createGLMaterial(fe){return new ooe(fe)}createBufferWriter(){return new VH(has("enable-feature:objectAndLayerId-rendering")?Mte:Ote)}get test(){}},loe=class S9 extends tj{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=r$36(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=r$35(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=[0,0,0],this.modelTransformation=null}};const coe=35e3,uoe={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},hoe=["polyline","polygon","extent"];let doe=class B7 extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,hoe,this.symbolLayer.type))return null;const _e=this.setGraphicElevationContext(ve);return this.ensureDrapedStatus("on-the-ground"===_e.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(ve):this._createAs3DShape(ve,_e,ve.uid)}ensureMaterial(){if(this._materials[0])return;const fe=new loe,ve=this.symbolLayer.color;null!=ve&&(fe.color=b_.toUnitRGBA(ve));const _e=this._getCombinedOpacity(ve,{hasIntrinsicColor:!0});fe.color=[fe.color[0],fe.color[1],fe.color[2],_e],fe.transparent=_e<1||this.needsDrivenTransparentPass,fe.waveDirection=null!=this.symbolLayer.waveDirection?B7.headingVectorFromAngle(this.symbolLayer.waveDirection):r$36(0,0);const be=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,we=uoe[be];fe.waveStrength=we.waveStrength,fe.waveTextureRepeat=we.textureRepeat,fe.waveVelocity=we.waveVelocity,fe.flowStrength=we.perturbationStrength,fe.hasSlicePlane=this._context.slicePlaneEnabled,fe.draped=this.draped,this._materials[0]=new aoe(fe),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(null==this._materials[0])return;const fe=this._materials[0].parameters.color,ve=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),_e=ve<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[fe[0],fe[1],fe[2],ve],transparent:_e})}layerElevationInfoChanged(fe,ve,_e){const be=this._elevationContext.mode,we=m$1X(B7.elevationModeChangeTypes,_e,be);if(we!==EG.UPDATE)return we;const Se=d$1F(be);return this.updateGraphics3DGraphicElevationInfo(fe,ve,(()=>Se))}slicePlaneEnabledChanged(){var fe;return null==(fe=this._materials[0])||fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(fe,ve,_e){var be;const we=b$X(fe.geometry);if(null==we)return null;const Se=p$28(we,this._context.elevationProvider,this._context.renderCoordsHelper,ve),Te=Se.position.length/3,Ee=t$2H(2*Te);U$m(Ee,Se.mapPositions,Te,this._context.elevationProvider.spatialReference);const Ce=new goe(Se,Ee,this._context.layer.uid,fe.uid);if(Ce.objectAndLayerIdColor=null==(be=this._context.stage.renderView)?void 0:be.getObjectAndLayerIdColor(Ce),this._create3DShapeGeometries(Ce),this._logGeometryCreationWarnings(Ce.renderData,we.rings,"rings","WaterSymbol3DLayer"),0===Ce.outGeometries.length)return null;const Oe=new Qq({geometries:Ce.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:_e}),Re=new qG(this,Oe,Ce.outGeometries,null,null,u$22,ve);return Re.alignedSampledElevation=Ce.renderData.sampledElevation,Re.needsElevationUpdates=d$1F(ve.mode),Re}_create3DShapeGeometries(fe){const ve=fe.renderData.polygons,_e=fe.uvCoords;for(const{count:be,index:we,position:Se,mapPositions:Te,holeIndices:Ee}of ve){if(null!=this._context.clippingExtent&&(P$$(yoe),c$3A(yoe,Te),!V$W(yoe,this._context.clippingExtent)))continue;const ve=GW(Te,Ee,3);if(0===ve.length)continue;const Ce=a$2H(_e,2*we,2*be),Oe=l$2a({material:this._materials[0],indices:ve,mapPositions:Te,attributeData:{position:Se,uv0:Ce}},fe.objectAndLayerIdColor);fe.outGeometries.push(Oe)}}_createAsOverlay(fe){var ve;const _e=b$X(fe.geometry);if(null==_e)return null;this._materials[0].renderPriority=this._renderPriority;const be=c$1_(_e,this._context.overlaySR),we=be.position.length/3,Se=t$2H(2*we);U$m(Se,be.position,we,this._context.overlaySR);const Te=new voe(be,Se,this._context.layer.uid,fe.uid);return Te.objectAndLayerIdColor=null==(ve=this._context.stage.renderView)?void 0:ve.getObjectAndLayerIdColor(Te),Te.outBoundingBox=P$$(),this._createAsOverlayWater(Te),this._logGeometryCreationWarnings(Te.renderData,_e.rings,"rings","WaterSymbol3DLayer"),0===Te.outGeometries.length?null:new Q9(this,Te.outGeometries,Te.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(fe){const ve=fe.uvCoords,_e=fe.renderData.polygons;for(const{position:be,holeIndices:we,index:Se,count:Te}of _e){if(P$$(yoe),c$3A(yoe,be),!V$W(yoe,this._context.clippingExtent))continue;o$35(fe.outBoundingBox,yoe);const _e=GW(be,we,3);if(0===_e.length)continue;const Ee=a$2H(ve,2*Se,2*Te),Ce=l$2a({material:this._materials[0],indices:_e,attributeData:{position:be,uv0:Ee}},fe.objectAndLayerIdColor);fe.outGeometries.push(new lee(Ce,fe))}}static headingVectorFromAngle(fe){const ve=[0,0],_e=u$3Z(fe);return ve[0]=Math.sin(_e),ve[1]=Math.cos(_e),ve}test(){return{...super.test(),create3DShape:fe=>this._createAs3DShape(fe.graphic,fe.elevationContext,fe.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function U$m(fe,ve,_e,be){const we=W$L(be);D$19(foe);for(let Ee=0;Ee<_e;Ee++)o$2R(moe,ve[3*Ee],ve[3*Ee+1]),f$31(foe,moe);m$3i(foe,foe,we);const Se=foe[0]%doe.unitSizeOfTexture,Te=foe[1]%doe.unitSizeOfTexture;poe[0]=foe[0]-Se,poe[1]=foe[1]-Te;for(let Ee=0;Ee<_e;Ee++)fe[2*Ee]=(ve[3*Ee]*we-poe[0])/doe.unitSizeOfTexture,fe[2*Ee+1]=(ve[3*Ee+1]*we-poe[1])/doe.unitSizeOfTexture}doe.unitSizeOfTexture=100,doe.elevationModeChangeTypes={definedChanged:EG.RECREATE,staysOnTheGround:EG.NONE,onTheGroundChanged:EG.RECREATE};const poe=[0,0],foe=u$3J(),moe=[0,0],yoe=i$3t();let goe=class k6 extends QW{constructor(fe,ve,_e,be){super(fe,_e,be),this.uvCoords=ve}},voe=class F3 extends QW{constructor(fe,ve,_e,be){super(fe,_e,be),this.uvCoords=ve}};function c$1s(fe,ve,_e,be){var we;const Se=(null==(we=$oe[fe.type])?void 0:we[ve.type])||_oe[ve.type];return Se?new Se(fe,ve,_e,be):(ar.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${ve.type}`),null)}const _oe={icon:pee,object:class pe extends Yq{getCachedSize(){const[fe,ve,_e]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:fe,depth:ve,height:_e}}constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=_e.physicalBasedRenderingEnabled}async doLoad(fe){var ve;if(!this._drivenProperties.size&&I$Q(this.symbolLayer))throw new Error;if(this._isPrimitive){const ve=this.symbolLayer.resource,_e=ve&&function d$1C(fe){switch(fe){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}(null==ve?void 0:ve.primitive)?ve.primitive:Bx;this._resources=await this._createResourcesForPrimitive(_e,fe)}else{const _e=await async function r$11(fe){var ve;if(null===fe||null==fe.styleName&&null==fe.styleUrl)return null;const _e=fe.name;if(null==_e)throw new Ir("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const be={portal:fe.portal},we=await y$P(fe,be).catch((()=>null));if(null===we)return null;const Se=j$B(_e,we.data);if(Se&&!(null==(ve=Se.formatInfos)?void 0:ve.some((fe=>"gltf_basisu"===fe.type))))return null;const Te=await h$R(we,_e,be,"webRef",((fe,ve)=>d$16(fe,ve,["gltf_basisu","gltf"]))).catch((()=>null));if(null===Te||"point-3d"!==Te.type)return null;const Ee=Te.symbolLayers.items[0];return"object"===Ee.type?Ee.resource:null}(this.symbol.styleOrigin),be=(null==_e?void 0:_e.href)??(null==(ve=this.symbolLayer.resource)?void 0:ve.href);this._resources=await this._createResourcesForUrl(be,fe)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){var fe;return!(null==(fe=this.symbolLayer.resource)?void 0:fe.href)}get lodRenderer(){var fe;return null==(fe=this._resources)?void 0:fe.lodRenderer}get materials(){var fe;return(null==(fe=this._resources)?void 0:fe.stageResources.materials)??[]}_setMaterialTransparencyParameters(fe,ve=(fe=>null==(fe=(fe=>null==(fe=this.symbolLayer)?void 0:fe.material)())?void 0:fe.color)()){const _e=this._getCombinedOpacity(ve),be=_e<1||this.needsDrivenTransparentPass;return fe.transparent=be,fe.opacity=_e,fe.cullFace=be?vA.None:vA.Back,fe}async _createResourcesForPrimitive(fe,ve){const _e=this.symbolLayer,be=i$3t(c$3z(fe)),we=e$3$(F$V(be)),Se=e$3$(t$3f(we,_e)),Te=s$4g(Se),Ee={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...KH],ambient:ji,diffuse:ji,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},Ce=!!Ee.usePBR;this._setMaterialTransparencyParameters(Ee);const Oe=this.symbol;if("point-3d"===Oe.type&&Oe.verticalOffset){const{screenLength:fe,minWorldLength:ve,maxWorldLength:_e}=Oe.verticalOffset;Ee.verticalOffset={screenLength:u$3E(fe),minWorldLength:ve||0,maxWorldLength:null!=_e?_e:1/0},Ee.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(Ee.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)Ee.externalColor=$d;else{const fe=null!=_e.material?_e.material.color:null,ve=null!=fe?b_.toUnitRGBA(fe):$d;Ee.externalColor=ve}this._fastUpdates=O$O(this._context.renderer,this._fastVisualVariableConvertOptions(be,Se,we,null)),Ee.isInstanced=!0,this._fastUpdates?(Object.assign(Ee,this._fastUpdates.materialParameters),this._optionalFields.push(nO.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(Ee.hasInstancedColor=!0,this._optionalFields.push(nO.COLOR)),has("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(nO.OBJECTANDLAYERIDCOLOR);const Re=S$_(fe,new Rq(Ee));if(!Re)throw new Error(`Unknown object symbol primitive: ${fe}`);const De=c$2h(Re).map((fe=>({opacity:1,transparent:fe.parameters.transparent}))),Be=await this._createStageResources(Re,Ce,ve),Ze=await this._createLodRenderer(Re,ve);return new Fie(Re,Ze,Be,De,we,!1,!1,be,Se,Te,Ce,null)}async _createResourcesForUrl(fe,ve){var _e,be;const we={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=O$O(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(we.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(nO.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(we.materialParameters.hasInstancedColor=!0,this._optionalFields.push(nO.COLOR)),has("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(nO.OBJECTANDLAYERIDCOLOR);const Se=this.symbol;if("point-3d"===Se.type&&Se.verticalOffset){const{screenLength:fe,minWorldLength:ve,maxWorldLength:_e}=Se.verticalOffset;we.materialParameters.verticalOffset={screenLength:u$3E(fe),minWorldLength:ve||0,maxWorldLength:null!=_e?_e:1/0},we.materialParameters.castShadows=!1}const Te=this._context.physicalBasedRenderingEnabled;we.signal=ve,we.usePBR=Te,we.skipHighLods=this._context.skipHighSymbolLods;const Ee=await te$4(fe,we),Ce=Ee.isEsriSymbolResource,Oe=Ee.isWosr,Re=function r$16(fe){return new iH(fe.map(((fe,ve)=>n$1J(fe,ve))))}(Ee.lods),De=this._context,Be=this.symbolLayer.material,Ze=this._getExternalColorParameters(Be),Xe=null==(be=null==(_e=this.symbolLayer)?void 0:_e.material)?void 0:be.color,Je=this._getCombinedOpacity(Xe,{hasIntrinsicColor:!0}),Qe=this.needsDrivenTransparentPass,dt=c$2h(Re),$t=c$2h(Re).map((fe=>({opacity:fe.parameters.opacity||1,transparent:fe.parameters.transparent})));dt.forEach((fe=>{const ve=fe.parameters;fe.setParameters(Ze);const _e=ve.opacity*Je,be=_e<1||Qe||ve.transparent;fe.setParameters({opacity:_e,transparent:be}),De.screenSizePerspectiveEnabled&&fe.setParameters({screenSizePerspective:De.sharedResources.screenSizePerspectiveSettings})}));const bt=Ee.referenceBoundingBox,wt=e$3$(F$V(bt)),xt=e$3$(Re.levels[0].pivotOffset),St=e$3$(t$3f(wt,this.symbolLayer)),Et=s$4g(St),Pt=this._fastUpdates;G$r(Pt,this._context.renderer,this._fastVisualVariableConvertOptions(bt,St,wt,xt))&&dt.forEach((fe=>fe.setParameters(Pt.materialParameters)));const Ot=await this._createStageResources(Re,Te,ve),At=await this._createLodRenderer(Re,ve);return new Fie(Re,At,Ot,$t,wt,Ce,Oe,bt,St,Et,Te,xt)}_addDisposeResource(fe){this._disposeResourceHandles.push(fe)}async _createStageResources(fe,ve,_e){const be=this._context.stage,we=c$2h(fe);ve!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),be.addMany(we),this._addDisposeResource((()=>be.removeMany(we)));const Se=o$1N(fe);be.addMany(Se),this._addDisposeResource((()=>{Se.forEach((fe=>fe.unload())),be.removeMany(Se)})),await Promise.all(Se.map((fe=>this._context.stage.schedule((()=>fe.load(be.renderView.renderingContext)),_e)))),s$4o(_e);const Te=i$2j(fe);return be.addMany(Te),this._addDisposeResource((()=>be.removeMany(Te))),{materials:we,textures:Se,geometries:Te}}async _createLodRenderer(fe,ve){const _e=this._context.stage,be={layerUid:this._context.layer.uid,graphicUid:fe=>this._instanceIndexToGraphicUid.get(fe),notifyGraphicGeometryChanged:fe=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(fe)),notifyGraphicVisibilityChanged:fe=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(fe))},we=this._fastUpdates,Se=we?{applyTransform:(fe,ve,_e)=>{fe.getFeatureAttribute(ve,Vie),n$48(_e,function Q$n(fe,ve,_e){if(!fe.vvSize)return _e;n$48(HB,_e);const be=fe.vvSymbolRotationMatrix;r$3a(WB,be[0],be[1],be[2],0,be[3],be[4],be[5],0,be[6],be[7],be[8],0,0,0,0,1),c$4k(HB,HB,WB);for(let we=0;we<3;++we){const _e=fe.vvSize.offset[we]+ve[0]*fe.vvSize.factor[we];qB[we]=e$3Y(_e,fe.vvSize.minSize[we],fe.vvSize.maxSize[we])}return f$2O(HB,HB,qB),i$45(HB,HB,fe.vvSymbolAnchor),HB}(we.materialParameters,Vie,_e))},scaleFactor:(fe,ve,_e)=>{ve.getFeatureAttribute(_e,Vie),W$t(fe,we.materialParameters,Vie)}}:null,Te=new Oie({symbol:fe,optionalFields:this._optionalFields,metadata:be,shaderTransformation:Se},this._context.scheduler);return Te.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{_e.removeRenderPlugin(Te),Te.destroy()})),await _e.addRenderPlugin(Te,ve),Te}_getExternalColorParameters(fe){const ve={};return this._drivenProperties.color?ve.externalColor=$d:null!=(null==fe?void 0:fe.color)?ve.externalColor=b_.toUnitRGBA(fe.color):(ve.externalColor=$d,ve.colorMixMode="ignore"),ve}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((fe=>fe())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry))return null;const _e=f$1x(ve.geometry);if(null==_e)return this.logger.warn(`unsupported geometry type for icon symbol: ${ve.geometry.type}`),null;const be=this.setGraphicElevationContext(ve),we=fe.renderingInfo;return this._createAs3DShape(ve,_e,we,be,ve.uid,fe.layer.uid)}notifyDestroyGraphicLayer(fe){this._instanceIndexToGraphicUid.delete(fe.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var fe,ve;if(null==this._resources)return;const _e=this._drivenProperties.opacity,be=!this._isPrimitive,we=this._resources.stageResources.materials,Se=this._resources.originalMaterialParameters;for(let Te=0;Te<we.length;Te++){const Ee=we[Te],Ce=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color,Oe=Se[Te],Re=this._getCombinedOpacity(Ce,{hasIntrinsicColor:be})*Oe.opacity,De=Re<1||_e||Oe.transparent;Ee.setParameters({opacity:Re,transparent:De}),this._isPrimitive&&Ee.setParameters({cullFace:De?vA.None:vA.Back})}}layerElevationInfoChanged(fe,ve){return this.updateGraphics3DGraphicElevationInfo(fe,ve,g$1h)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const fe of this._resources.stageResources.materials)fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:fe,isWosr:ve}=this._resources;for(const _e of fe.materials)this._isPrimitive?_e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):ve||_e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(fe,ve){if(null==this._resources)return Hq.RecreateSymbol;const{stageResources:{materials:_e},lodRenderer:be,resourceBoundingBox:we,symbolSize:Se,resourceSize:Te,pivotOffset:Ee}=this._resources;for(const Ce in fe.diff){if("visualVariables"!==Ce)return Hq.RecreateSymbol;if(!G$r(this._fastUpdates,ve,this._fastVisualVariableConvertOptions(we,Se,Te,Ee)))return Hq.RecreateSymbol;for(const fe of _e)fe.setParameters(this._fastUpdates.materialParameters);be.notifyShaderTransformationChanged()}return Hq.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const fe=this._resources.lodResources,ve=w$12(fe.levels),_e=i$2j(fe).reduce(((fe,ve)=>fe+(fe=>Array.from(fe.attributes.values()).reduce(((fe,ve)=>fe+A$1L(ve.data,ve.indices)),0))(ve)),0),be=o$1N(fe).reduce(((fe,ve)=>fe+ve.memoryEstimate),0)+_e,we={...C$M(this.symbol,this.symbolLayer),resourceBytes:be};return new sH({verticesPerFeature:ve,memory:we})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(fe,ve,_e,be,we,Se){if(!this._hasLodRenderer()||null==this._resources)return null;const Te=this.getFastUpdateAttrValues(fe),Ee=this._context.clippingExtent;if(c$4l(ve,zie,this._context.elevationProvider.spatialReference),null!=Ee&&!y$1M(Ee,zie))return null;const Ce=ye$3(be),Oe=this._computeGlobalTransform(ve,be,Uie,Bie),Re=this._computeLocalTransform(this._resources,this.symbolLayer,_e,kie),De=this._resources.lodRenderer.instanceData,Be=De.addInstance();this._instanceIndexToGraphicUid.set(Be,we),De.setLocalTransform(Be,Re,!1),De.setGlobalTransform(Be,Oe),Te&&De.setFeatureAttribute(Be,Te),null==this._fastUpdates&&this._hasPerInstanceColor()&&De.setColor(Be,F$B(_e.color,_e.opacity,255)),null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&De.setObjectAndLayerIdColor(Be,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:we,layerUid:Se}));const Ze=new fre(this,Be,b$14,be);return Ce&&(Ze.alignedSampledElevation=Bie.sampledElevation),Ze.needsElevationUpdates=g$1h(be.mode),m$1M(Ze,ve,this._context.elevationProvider),Ze}_computeGlobalTransform(fe,ve,_e,be){return c$2k(fe,this._context.elevationProvider,ve,this._context.renderCoordsHelper,be),zie[0]=fe.x,zie[1]=fe.y,zie[2]=be.z,u$3m(fe.spatialReference,zie,_e,this._context.renderCoordsHelper.spatialReference),_e}_computeLocalTransform(fe,ve,_e,be){return o$3E(be),this._applyObjectRotation(_e,!1,be),this._applyObjectRotation(ve,!0,be),this._applyObjectScale(fe,_e,be),this._applyAnchor(fe,ve,be),be}_applyObjectScale(fe,ve,_e){var be;if(null==(be=this._fastUpdates)?void 0:be.requiresShaderTransformation)return;const we=B$u(this._drivenProperties.size&&ve.size?ve.size:fe.symbolSize,fe.symbolSize,fe.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===we[0]&&1===we[1]&&1===we[2]||f$2O(_e,_e,we)}prepareSymbolLayerPatch(fe){if("partial"!==fe.diff.type)return;const ve=fe.diff.diff;this._preparePatchTransform(fe,ve),this._preparePatchColor(fe,ve)}updateGeometry(fe,ve){if(null==this._resources)return!0;const _e=ve&&f$1x(ve);if(null==_e)return!1;const be=this.getGeometryElevationMode(ve);return fe.elevationContext.mode===be&&(this._computeGlobalTransform(_e,fe.elevationContext,Uie,Bie),ye$3(fe.elevationContext)&&(fe.alignedSampledElevation=Bie.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(fe.instanceIndex,Uie,!0),m$1M(fe,_e,this._context.elevationProvider),!0)}_preparePatchTransform(fe,ve){if(!(ve.heading||ve.tilt||ve.roll||ve.width||ve.height||ve.depth||ve.anchor||ve.anchorPosition))return;if(null==this._resources)return;const s84=(fe,ve,_e)=>(null!=fe&&"complete"===fe.type?fe.newValue:ve)??_e,_e=s84(ve.heading,this.symbolLayer.heading,0),be=s84(ve.tilt,this.symbolLayer.tilt,0),we=s84(ve.roll,this.symbolLayer.roll,0),Se=s84(ve.width,this.symbolLayer.width,void 0),Te=s84(ve.height,this.symbolLayer.height,void 0),Ee=s84(ve.depth,this.symbolLayer.depth,void 0),Ce=s84(ve.anchor,this.symbolLayer.anchor,void 0),Oe=s84(ve.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete ve.heading,delete ve.tilt,delete ve.roll,delete ve.width,delete ve.height,delete ve.depth,delete ve.anchor,delete ve.anchorPosition;const Re={heading:_e,tilt:be,roll:we,anchor:Ce,anchorPosition:Oe},De=this._resources;this.loadStatus===Wq.LOADED&&fe.symbolLayerStatePatches.push((()=>{De.symbolSize=e$3$(t$3f(De.resourceSize,{width:Se,height:Te,depth:Ee,isPrimitive:this.symbolLayer.isPrimitive}))})),fe.graphics3DGraphicPatches.push(((fe,ve)=>{const _e=this._computeLocalTransform(De,Re,ve,kie),be=fe.instanceIndex;De.lodRenderer.instanceData.setLocalTransform(be,_e,!0)}))}_preparePatchColor(fe,ve){if(!ve.material||"partial"!==ve.material.type)return;const _e=ve.material.diff;if(!_e.color||"complete"!==_e.color.type||null==_e.color.newValue||null==_e.color.oldValue)return;const be=_e.color.newValue,we=null!=be?b_.toUnitRGBA(be):$d;delete _e.color;const Se=this._resources;null!=Se&&fe.graphics3DGraphicPatches.push((fe=>{let ve;this._hasPerInstanceColor()?(Se.lodRenderer.instanceData.setColor(fe.instanceIndex,we),ve=this._setMaterialTransparencyParameters({},be)):ve=this._setMaterialTransparencyParameters({externalColor:we},be);for(const _e of Se.stageResources.materials)_e.setParameters(ve)}))}_applyObjectRotation(fe,ve,_e){var be;if(!(null==(be=this._fastUpdates)?void 0:be.requiresShaderTransformation)||!ve)return function U$F(fe,ve,_e,be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return fe&&x$1E(be,be,-fe/180*Math.PI),ve&&l$3_(be,be,ve/180*Math.PI),_e&&m$3m(be,be,_e/180*Math.PI),be}(fe.heading,fe.tilt,fe.roll,_e)}_applyAnchor(fe,ve,_e){var be;if(null==(be=this._fastUpdates)?void 0:be.requiresShaderTransformation)return;const we=ue$5(fe.resourceBoundingBox,fe.pivotOffset,ve);we&&i$45(_e,_e,we)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(fe,ve,_e,be){const we=null!=fe?e$3$(F$V(fe)):ji,Se=null!=fe?ue$5(fe,be,this.symbolLayer):Bi,Te=this._context.renderCoordsHelper.unitInMeters,Ee=B$u(null!=ve?ve:void 0,ve,_e,Te),Ce=r$3y(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new BB({size:!0,color:!0,rotation:!0,opacity:!1},we,ve??ji,Te,Se,Ee,Ce)}},line:Iee,path:class te extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._intrinsicSize=r$36(1,1),this._upVectorAlignment=nne.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var fe,ve,_e,be,we;const Se=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,Te=null!=this.symbolLayer.height?this.symbolLayer.height:Se;this._vvConvertOptions=new BB({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[Se,1,Te],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=(null==(ve=null==(fe=this._context.renderer)?void 0:fe.visualVariables)?void 0:ve.length)>0?O$O(this._context.renderer,this._vvConvertOptions):null;const Ee=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?nne.World:nne.Path;const Ce=this.symbolLayer.profile||"circle";switch(Ce){default:case"circle":this._profile=vne[Ee];break;case"quad":this._profile=_ne[Ee]}switch(this.symbolLayer.join){case"round":this._extruder=new Qie(0,QG);break;case"bevel":this._extruder=new Qie(0,1);break;case"miter":this._extruder=new Qie(.8*Math.PI,1);break;default:this._extruder=new Jie}const Oe=this.symbolLayer.cap||"butt";switch(Oe){case"none":this._startCap=new qie,this._endCap=new qie;break;case"butt":default:this._startCap=new Wie(this._profile,0),this._endCap=new Wie(this._profile,0,!0);break;case"square":this._startCap=new Wie(this._profile,-.5),this._endCap=new Wie(this._profile,.5,!0);break;case"round":{const fe="quad"===Ce;this._startCap=new Yie({profile:this._profile,flip:!1,breakNormals:fe,subdivisions:KG}),this._endCap=new Yie({profile:this._profile,flip:!0,breakNormals:fe,subdivisions:KG});break}}const Re=null==(be=null==(_e=this.symbolLayer)?void 0:_e.material)?void 0:be.color,De=this._getCombinedOpacityAndColor(Re),Be=e$3$(De),Ze=De[3],Xe=Ze<1||this.needsDrivenTransparentPass,Je={diffuse:Be,ambient:Be,opacity:Ze,transparent:Xe,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:Xe||"none"===Oe?vA.None:vA.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(o$2R(this._intrinsicSize,Se,Te),!S$$(this._intrinsicSize[0])||!S$$(this._intrinsicSize[1])))throw new Ir("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((null==(we=this._fastUpdates)?void 0:we.visualVariables.size)||l$31(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const fe={...Je,...this._fastUpdates.materialParameters,size:e$3D(this._intrinsicSize)};this._materials[0]=new jne(fe)}else Je.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,Je.normalType=wH.Compressed,this._materials[0]=new Rq(Je);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,qne,this.symbolLayer.type))return null;const _e=this.setGraphicElevationContext(ve),be=fe.renderingInfo;return this._createAs3DShape(ve,be,_e,ve.uid)}layerOpacityChanged(){var fe,ve,_e;const be=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color,we=this._getCombinedOpacity(be),Se=we<1||this.needsDrivenTransparentPass;null==(_e=this._materials[0])||_e.setParameters({opacity:we,transparent:Se})}layerElevationInfoChanged(fe,ve){return this.updateGraphics3DGraphicElevationInfo(fe,ve,g$1h)}slicePlaneEnabledChanged(){var fe;return null==(fe=this._materials[0])||fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var fe;return null==(fe=this._materials[0])||fe.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(fe,ve){var _e;for(const be in fe.diff){if("visualVariables"!==be)return Hq.RecreateSymbol;if(!G$r(this._fastUpdates,ve,this._vvConvertOptions))return Hq.RecreateSymbol;null==(_e=this._materials[0])||_e.setParameters(this._fastUpdates.materialParameters)}return Hq.FastUpdate}_getVertexData(fe){let ve=0;const _e=fe.paths,be=[],we=fe.spatialReference,Se=this._context.elevationProvider.spatialReference,Te=this._context.renderCoordsHelper.spatialReference;for(const Re of _e)ve+=Re.length;const Ee=t$2H(3*ve);let Ce,Oe=0;for(const Re of _e){be.push({offset:Oe,numVertices:Re.length});for(const ve of Re)Ee[Oe++]=ve[0],Ee[Oe++]=ve[1],Ee[Oe++]=fe.hasZ?ve[2]:0}return null==Se||we.equals(Se)||n$49(Ee,we,0,Ee,Se,0,ve)?(null==Se||Se.equals(Te)?Ce=e$2E(Ee):(Ce=t$2H(3*ve),n$49(Ee,Se,0,Ce,Te,0,ve)),{pathVertexDataInfos:be,vertexDataES:Ee,vertexDataRS:Ce}):null}_createAs3DShape(fe,ve,_e,be){var we,Se,Te;this.usedMemory=0;const Ee=fe.geometry,Ce=this._getVertexData(Ee);if(null==Ce)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===Ce.pathVertexDataInfos.length)return 0!==Ee.paths.length&&Ee.paths.some((fe=>fe.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const Oe=new Array,Re=Ee.spatialReference,De=i$3t(),Be=this._context.renderCoordsHelper,Ze=new mg(Ce.vertexDataES);for(const Qe of Ce.pathVertexDataInfos){const Ee=Qe.numVertices;if(Ee<2)continue;const Xe=Qe.offset;if(null!=this._context.clippingExtent&&(P$$(De),c$3A(De,Ce.vertexDataES,Xe,Ee),!V$W(De,this._context.clippingExtent)))continue;const Je=new Array,dt=Xe+3*Ee;for(let fe=Xe;fe<dt;fe+=3){Ze.offset=fe;const ve=f$1L(Ze,this._context.elevationProvider,_e,Be);o$44(Wne,Ce.vertexDataRS[fe],Ce.vertexDataRS[fe+1],Ce.vertexDataRS[fe+2]),Be.setAltitude(Wne,ve),Ce.vertexDataRS[fe]=Wne[0],Ce.vertexDataRS[fe+1]=Wne[1],Ce.vertexDataRS[fe+2]=Wne[2],Je.push(A$y(this._upVectorAlignment))}const $t=new jie(Je,Ce.vertexDataES,Ce.vertexDataRS,Xe);ie$4($t,this._upVectorAlignment,this._context.renderCoordsHelper);const bt=new Gie($t,this._profile,this._extruder,this._startCap,this._endCap);let wt=null;if(this._fastUpdates){const ve=this._fastUpdates.visualVariables,_e=X$h(null==(we=ve.size)?void 0:we.field,fe)??0,be=X$h(null==(Se=ve.color)?void 0:Se.field,fe)??0,Ee=X$h(null==(Te=ve.opacity)?void 0:Te.field,fe)??0;wt=new ane(bt,_e,be,Ee)}else{const fe=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const _e=ve.size;fe[0]*=re$3(_e[0],"symbol-value"===_e[2]?this.symbolLayer.height||0:_e[2],this.symbolLayer.width||0),fe[1]*=re$3(_e[2],"symbol-value"===_e[0]?this.symbolLayer.width||0:_e[0],this.symbolLayer.height||0)}let _e;this._drivenProperties.color&&(_e=ve.color),this._drivenProperties.opacity&&null!=ve.opacity&&(_e=_e?[_e[0],_e[1],_e[2],ve.opacity]:[1,1,1,ve.opacity]);const be=new one(bt);be.bake(fe),_e&&be.bakeVertexColors(_e),wt=be}const xt=wt.createGeometryData(),St=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:be,layerUid:this._context.layer.uid}),Et=new ine(this._materials[0],xt,wt,Re,this._stencilWidth,St);Et.transformation=i$45([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dd,bt.path.origin),Oe.push(Et),this.usedMemory+=bt.usedMemory}if(0===Oe.length)return null;const Xe=new Qq({geometries:Oe,layerUid:this._context.layer.uid,graphicUid:be}),Je=new qG(this,Xe,Oe,null,null,((fe,ve,_e,be,we)=>function ae$4(fe,ve,_e,be,we){const Se=fe.stageObject,Te=Se.geometries;let Ee=0;for(const Ce of Te){if(!n$1C(Ce))continue;const fe=Ce.path,Te=fe.builder.path;Ee+=se$4(Te,ve,_e,be),we!==nne.World&&ie$4(Te,we,be),fe.onPathChanged(Ce),Ce.invalidateBoundingInfo(),Se.geometryVertexAttributeUpdated(Ce,nO.POSITION)}return Ee/Te.length}(fe,ve,be,we,this._upVectorAlignment)),_e);return Je.alignedSampledElevation=0,Je.needsElevationUpdates=g$1h(_e.mode),Je}},fill:Lse,extrude:class et extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this.ensureDrapedStatus(!1)}async doLoad(){var fe,ve;if(!this._drivenProperties.size){const fe=I$Q(this._getSymbolSize());if(fe)throw new Ir("graphics3dextrudesymbollayer:invalid-size",fe)}const _e=null==(ve=null==(fe=this.symbolLayer)?void 0:fe.material)?void 0:ve.color,be=this._getCombinedOpacityAndColor(_e),we=e$3$(be),Se=be[3],Te=Se<1||this.needsDrivenTransparentPass,Ee={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:we,ambient:we,opacity:Se,transparent:Te,cullFace:Te?vA.None:vA.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:wH.Compressed};this._materials[aQ.Main]=new Rq(Ee),this._materials[aQ.Bottom]=new Rq({...Ee,cullFace:vA.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,jJ,this.symbolLayer.type))return null;const _e=this._getVertexOpacityAndColor(fe.renderingInfo,255),be=this.setGraphicElevationContext(ve);return this._createAs3DShape(ve,fe.renderingInfo,_e,be,ve.uid)}layerOpacityChanged(fe,ve){var _e,be,we,Se;const Te=null==(be=null==(_e=this.symbolLayer)?void 0:_e.material)?void 0:be.color,Ee=this._getCombinedOpacity(Te),Ce=Ee<1||this.needsDrivenTransparentPass;null==(we=this._materials[aQ.Main])||we.setParameters({opacity:Ee,transparent:Ce}),null==(Se=this._materials[aQ.Bottom])||Se.setParameters({opacity:Ee,transparent:Ce});const Oe=this._getLayerOpacity();fe.forEach((fe=>{const _e=ve(fe);null!=_e&&_e.layerOpacityChanged(Oe,this._context.isAsync)}))}layerElevationInfoChanged(fe,ve){return this.updateGraphics3DGraphicElevationInfo(fe,ve,g$1h)}slicePlaneEnabledChanged(fe,ve){var _e,be;return null==(_e=this._materials[aQ.Main])||_e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),null==(be=this._materials[aQ.Bottom])||be.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),fe.forEach((fe=>{const _e=ve(fe);null!=_e&&_e.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){var fe,ve;const _e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return null==(fe=this._materials[aQ.Main])||fe.setParameters(_e),null==(ve=this._materials[aQ.Bottom])||ve.setParameters(_e),!0}_getExtrusionSize(fe){let ve;return ve=fe.size&&this._drivenProperties.size?function a$28(fe,ve=0){const _e=fe[ve];return"number"==typeof _e&&isFinite(_e)?_e:null}(fe.size,2)??0:this._getSymbolSize(),ve/=this._context.renderCoordsHelper.unitInMeters,ve}applyRendererDiff(fe,ve){return this._drivenPropertiesChanged(ve)?Hq.RecreateSymbol:Hq.RecreateGraphics}async queryForSnapping(fe,ve,_e,be){const we=this._getExtrusionSize(_e)*this._context.renderCoordsHelper.unitInMeters/L$1d(ve),{objectId:Se,target:Te}=fe,Ee=a$4H(Te);switch(Ee.z=(Ee.z??0)+we,fe.type){case"edge":{const{start:ve,end:_e}=fe,be=a$4H(ve),Te=a$4H(_e);return be.z=(be.z??0)+we,Te.z=(Te.z??0)+we,[e$1S(Se,Ee,1/0,be,Te)]}case"vertex":return[t$1Z(Se,Ee,1/0),e$1S(Se,Te,1/0,Te,Ee)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(fe,ve,_e,be,we){const Se=b$X(fe.geometry);if(null==Se)return null;if(0===Se.rings.length||!Se.rings.some((fe=>fe.length>0)))return this._logGeometryValidationWarnings(Se.rings,"rings","ExtrudeSymbol3DLayer"),null;const Te=p$28(Se,this._context.elevationProvider,this._context.renderCoordsHelper,be);this._logGeometryCreationWarnings(Te,Se.rings,"rings","ExtrudeSymbol3DLayer");const Ee=b$13(Se);if(null==Ee)return null;const Ce=new Array,Oe=new Array,Re=i$3t(),De=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Be=[0,0,0],Ze=this._context.renderCoordsHelper.viewingMode===Wf.Global;Ze||this._context.renderCoordsHelper.worldUpAtPosition(null,Be),u$3m(Se.spatialReference,[Ee.x,Ee.y,0],De,this._context.renderCoordsHelper.spatialReference);const Xe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];h$2A(Xe,De);j$1r([1,0,0,0,1,0,0,0,1],Xe);const{polygons:Je,mapPositions:Qe,position:dt}=Te,$t=new Map,bt=this._materials[aQ.Main];for(const Pt of Je){const fe=Pt.count;if(this._context.clippingExtent&&(P$$(Re),c$3A(Re,Pt.mapPositions),!V$W(Re,this._context.clippingExtent)))continue;const be=GW(Pt.mapPositions,Pt.holeIndices,3);if(0===be.length)continue;const Se=be.length,Te=6*fe,Ee=i$2F(Te+Se),Je=i$2F(Se),wt=t$2H(3*Te),xt=t$2H(3*Te),St=t$2H(3*Te),Et=t$2H(Te);st$7(dt,Qe,be,Pt,wt,St,xt,Et,Ee,Je,this._getExtrusionSize(ve),Be,Ze),e$1T(wt,wt,Xe);const Ot=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:we,layerUid:this._context.layer.uid}),At=new lQ(wt,St,e$1J(xt),Et),Mt=rt$6(bt,Ee,Ee.length-Je.length,At,_e,Ot),Rt=fe,Nt=fe,Ft=2*Pt.count,zt=new cQ(Rt,Nt,Ft,Se/3);ft$3(Mt,zt,De),$t.set(Mt,zt),Ce.push(Mt,rt$6(this._materials[aQ.Bottom],Je,0,At,_e,Ot)),Oe.push(At.heights)}if(0===Ce.length)return null;const wt=new Qq({geometries:Ce,layerUid:this._context.layer.uid,graphicUid:we,isElevationSource:!0});wt.transformation=De;const xt=a$2i(this.symbolLayer,{opacity:this._getLayerOpacity()}),St=null!=xt?{baseMaterial:this._materials[aQ.Main],edgeMaterials:[xt],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Et=new qG(this,wt,Ce,null,null,((fe,ve,_e,be,we)=>function ut$4(fe,ve,_e,be,we,Se,Te){const Ee=fe.stageObject,Ce=Ee.geometries,Oe=Ce.length,Re="absolute-height"!==ve.mode;let De=0;const Be=Ee.transformation,Ze=e$3H([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Be);for(let Xe=0;Xe<Oe;Xe+=2){const fe=Ce[Xe];if(!e$2f(fe))continue;const ve=fe.getMutableAttribute(nO.POSITION).data,Oe=Se[Xe/2],Je=new mg(fe.mapPositions),Qe=ve.length/3;let dt=!1,$t=0;{let fe=0;for(let Se=0;Se<Qe;Se++){XJ[0]=ve[fe],XJ[1]=ve[fe+1],XJ[2]=ve[fe+2],be(Je,KJ),Re&&($t+=KJ.sampledElevation),_B.TESTS_DISABLE_OPTIMIZATIONS?(o$44(JJ,Je.array[Je.offset],Je.array[Je.offset+1],KJ.z+Oe[fe/3]),null!=_e&&we.toRenderCoords(JJ,_e,JJ),O$1v(JJ,JJ,Ze)):(o$44(JJ,ve[fe],ve[fe+1],ve[fe+2]),O$1v(JJ,JJ,Be),we.setAltitude(JJ,KJ.z+Oe[fe/3]),O$1v(JJ,JJ,Ze)),ve[fe]=JJ[0],ve[fe+1]=JJ[1],ve[fe+2]=JJ[2];const Se=rQ/we.unitInMeters;(Math.abs(XJ[0]-ve[fe])>=Se||Math.abs(XJ[1]-ve[fe+1])>=Se||Math.abs(XJ[2]-ve[fe+2])>=Se)&&(dt=!0),Je.offset+=3,fe+=3}}if(dt){const ve=Te.get(fe);ve&&ft$3(fe,ve,Be),Ee.geometryVertexAttributeUpdated(Ce[Xe],nO.NORMALCOMPRESSED),fe.invalidateBoundingInfo(),Ee.geometryVertexAttributeUpdated(Ce[Xe],nO.POSITION),Ce[Xe+1].invalidateBoundingInfo(),Ee.geometryVertexAttributeUpdated(Ce[Xe+1],nO.POSITION)}De+=$t/Qe}return De/Oe}(fe,ve,_e,be,we,Oe,$t)),be,St);return Et.alignedSampledElevation=Te.sampledElevation,Et.needsElevationUpdates=g$1h(be.mode),Et}},text:class H3 extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const fe=I$Q(this.symbolLayer.size);if(fe)throw new Ir("graphics3dtextsymbollayer:invalid-size",fe)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const fe=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Vse.fromSymbol(this.symbolLayer,fe)}destroy(){super.destroy()}createGraphics3DGraphic(fe){const ve=fe.graphic,_e=f$1x(ve.geometry);if(null==_e)return this.logger.warn(`unsupported geometry type for text symbol: ${ve.geometry.type}`),null;const be=this.symbolLayer.text;if(null==be||""===be)return null;const we=o$33(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=we&&!l$3d(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:Se}=this.symbolLayer,Te=new kse(we);!function h$X(fe,ve){switch(fe){case"top":return o$2R(ve,0,J7);case"bottom":return o$2R(ve,0,-J7);default:return r$2C(ve,md)}}(Se,Te.screenOffset);const Ee=new Use(Te,this.symbolLayer.horizontalAlignment,function u$1r(fe){return"middle"===fe?"center":fe}(Se));return this._createAs3DShape(ve,_e,be,Ee)}createLabel(fe,ve,_e,be,we){const Se=fe.graphic,Te=f$1x(Se.geometry);if(null==Te)return this.logger.warn(`unsupported geometry type for label: ${Se.geometry.type}`),null;const Ee=ve.text;return!Ee||/^\s+$/.test(Ee)?null:this._createAs3DShape(Se,Te,Ee,ve,_e,be,we)}setGraphicElevationContext(fe,ve,_e=0){return super.setGraphicElevationContext(fe,ve),ve.addOffsetRenderUnits(_e),ve}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(fe,ve){return W$a(fe,ve,((fe,ve)=>{this.updateGraphicElevationContext(ve,fe)})),EG.UPDATE}slicePlaneEnabledChanged(fe,ve){return W$a(fe,ve,(fe=>{for(const ve of fe.stageObject.geometries)ve.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(fe,ve){const _e=ve.elevationContext;this.setGraphicElevationContext(fe,_e,null!=ve.metadata?ve.metadata.elevationOffset:0),ve.needsElevationUpdates=d$1F(_e.mode)||"absolute-height"===_e.mode}updateGeometry(fe,ve){if(this.draped||!this._validateGeometry(ve))return!1;const{elevationContext:_e,stageObject:be}=fe;if(_e.mode!==this.getGeometryElevationMode(ve))return!1;const we=f$1x(ve);if(!we)return!1;const Se=p$2j(be,this._context,we,_e);if(null==Se)return!1;const Te=d$1v(this._context,we);return be.geometries[0].localOrigin===Te&&(fe.alignedSampledElevation=Se,m$1M(fe,we,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return eoe}_createAs3DShape(fe,ve,_e,be,we=null,Se=null,Te=()=>be.placement.elevationOffset){var Ee;const Ce=this.setGraphicElevationContext(fe,new VG,be.placement.elevationOffset),Oe="polyline"===(null==(Ee=fe.geometry)?void 0:Ee.type),Re=fe.uid;let De=null,Be=null;if(null==Se){const fe=f$16(be.horizontalPlacement);De=new Jse(_e,fe,this._textRenderParameters);let ve=null;if(null!=this._context.sharedResources.textures){Be=this._context.sharedResources.textures.fromData(De.key,(()=>De.create())),Be.texture.events.on("unloaded",(()=>ve=t$4r(ve)));const fe=this._context.stage.renderView.textures.acquire(Be.texture.id);if(null==fe||S$1T(fe))return Be.release(),null;ve=fe}}const Ze=function I$q(fe,ve){if("baseline"===ve.verticalPlacement){return r$36(oee[ve.horizontalPlacement],null!=fe?fe.baselineAnchorY:0)}const _e=function m$1o(fe,ve){switch(ve){case"bottom":return"left"===fe?"bottom-left":"right"===fe?"bottom-right":"bottom";case"center":return fe;case"top":return"left"===fe?"top-left":"right"===fe?"top-right":"top"}}(ve.horizontalPlacement,ve.verticalPlacement);return aee[_e]}(De,be),Xe={occlusionTest:!has("enable-feature:non-occluded-hud"),screenOffset:be.placement.screenOffset,anchorPosition:Ze,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:be.placement.centerOffsetUnits,drawInSecondSlot:!0};if(Oe&&(Xe.shaderPolygonOffset=1e-4),Se?Xe.textureId=Se.id:Be&&(Xe.textureId=Be.texture.id),null!=be.placement.verticalOffset){const{screenLength:fe,minWorldLength:ve,maxWorldLength:_e}=be.placement.verticalOffset;Xe.verticalOffset={screenLength:u$3E(fe),minWorldLength:ve||0,maxWorldLength:null!=_e?_e:1/0}}const Je={screenOffset:Xe.screenOffset,anchorPosition:Ze,centerOffsetUnits:Xe.centerOffsetUnits,verticalOffset:Xe.verticalOffset,shaderPolygonOffset:Xe.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:fe,screenSizePerspectiveSettingsLabels:ve}=this._context.sharedResources,_e=e$1s(this._textRenderParameters);Xe.screenSizePerspective=ve.overrideFontHeight(_e.maxHeight),Xe.screenSizePerspectiveAlignment=fe,Je.fontHeight=_e.maxHeight}Xe.hasSlicePlane=this._context.slicePlaneEnabled;const Qe=we?((fe,ve,_e)=>{let be=fe.get(_e);return null==be&&(be=new Pj(ve),fe.add(_e,be)),be})(we,Xe,JSON.stringify(Je)):new Pj(Xe),dt=be.placement.translation,$t=De?r$36(De.displayWidth,De.displayHeight):md,bt=be.placement.centerOffset,wt=ht$a(Qe,Kse,dt,null,$t,bt,[0,0],null),xt=a$2e(this._context,ve,wt,Ce,Re);if(null==xt)return null;const St=new qG(this,xt.object,[wt],null==we?[Qe]:null,Be,((ve,_e,we,Se,Ee,Ce)=>{const Oe=Te()||be.placement.elevationOffset;return p$2r(ve,this.setGraphicElevationContext(fe,_e,Oe),0,Se,Ee,Ce)}),Ce);St.alignedSampledElevation=xt.sampledElevation,St.needsElevationUpdates=d$1F(Ce.mode)||"absolute-height"===Ce.mode,St.getScreenSize=(fe=[0,0])=>(fe[0]=De?De.displayWidth:be.displaySize[0],fe[1]=De?De.displayHeight:be.displaySize[1],fe);const Et=new JG(be.placement.elevationOffset,_e);return St.metadata=Et,m$1M(St,ve,this._context.elevationProvider),St}},water:doe},$oe={"mesh-3d":{fill:class Ne extends Yq{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this._materialInfoCache=new Pte,this._fastUpdateProcessor=new Ete,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){_B.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Dte({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new Dte({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new Dte({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach((fe=>fe.unload())),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(fe){const ve=fe.graphic;if(!this._validateGeometry(ve.geometry,tre,"fill on mesh-3d"))return null;const _e=this.setGraphicElevationContext(ve),be=fe.renderingInfo;return this._createAs3DShape(ve,be,_e,ve.uid)}onRemoveGraphic(fe){this._fastUpdateProcessor.onRemoveGraphic(fe,this._materialInfoCache,this._context)}layerOpacityChanged(fe,ve){const _e=this._getLayerOpacity();this._updateMaterialParameters((fe=>{fe.material.setParameters({layerOpacity:_e});const ve=fe.material.parameters;this._setMaterialTransparentParameter(ve,fe),fe.material.setParameters({transparent:ve.transparent})})),fe.forEach((fe=>{var be;return null==(be=ve(fe))?void 0:be.layerOpacityChanged(_e,this._context.isAsync)}))}layerElevationInfoChanged(fe,ve){return this.updateGraphics3DGraphicElevationInfo(fe,ve,g$1h)}slicePlaneEnabledChanged(fe,ve){return this._updateMaterialParameters((({material:fe})=>{fe.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),fe.forEach((fe=>{var _e;return null==(_e=ve(fe))?void 0:_e.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const fe=this._usePBR();return this._updateMaterialParameters((({material:ve})=>ve.setParameters({usePBR:fe}))),!0}updateTransform(fe,ve,_e,be){if(!fe.fastTransformUpdatesAllowed)return!1;const we=fe.fastTransformUpdatesEnabled;switch(be){case fte.EnableFastUpdates:if(we)return!0;break;case fte.DisableFastUpdates:if(!we)return!0;break;default:if(!we)return!!this.updateTransform(fe,ve,_e,fte.EnableFastUpdates)&&(fe.autoDisableFastTransformUpdates((()=>this.updateTransform(fe,ve,_e,fte.DisableFastUpdates))),!0)}const Se=this._context.renderCoordsHelper.spatialReference,Te=ure,{origin:Ee,transform:Ce}=_e;if(!u$3m(ve,o$44(sre,Ee.x,Ee.y,Ee.z??0),Te,Se))return!1;switch(be){case fte.EnableFastUpdates:this._fastUpdateProcessor.enable(fe,this._materialInfoCache,this._context);break;case fte.DisableFastUpdates:this._fastUpdateProcessor.disable(fe,this._materialInfoCache,this._context);break;case fte.UpdateFastLocalOrigin:fe.updateFastLocalOrigin(Te,Ce,this._context.localOriginFactory)}const{elevationContext:Oe}=fe;Oe.centerPointInElevationSR=this._getCenterPointInElevationSR(Te);const{elevationProvider:Re,renderCoordsHelper:De}=this._context;return fe.alignedSampledElevation=p$2r(fe,Oe,Re.spatialReference,((fe,ve)=>c$2k(fe,Re,Oe,De,ve)),De,Te),fe.updateTransform(Te,Ce,this._context.isAsync),fe.updateAutoDisableFastTransformUpdates((()=>this.updateTransform(fe,ve,_e,fte.DisableFastUpdates))),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(fe,ve){const _e=this._requiresSymbolVertexColors(),be=!!fe.vertexAttributes.color,we=!!fe.vertexAttributes.tangent;return{hasSymbolVertexColors:_e,hasVertexColors:be,hasVertexTangents:we,uid:`vc:${be},vt:${we},vct${ve},svc:${_e}`}}_materialProperties(fe,ve,_e){const be=this._materialPropertiesDefault(fe,_e);if(!ve.material)return be;const{color:we,colorTexture:Se,colorTextureTransform:Te,normalTexture:Ee,normalTextureTransform:Ce,doubleSided:Oe,alphaCutoff:Re,alphaMode:De}=ve.material,Be=Ye(we),Ze=Ye(Se),Xe=Je$1(Te),Je=Ye(Ee),Qe=Je$1(Ce);if(be.color=we,be.colorTexture=Se,be.normalTexture=Ee,be.uid=`${be.uid},cmuid:${Be},ctmuid:${Ze},cttuid:${Xe},ntmuid:${Je},nttuid:${Qe},ds:${Oe},ac:${Re},am:${De}`,ve.material instanceof Xee){const{metallic:fe,roughness:_e,metallicRoughnessTexture:we,metallicRoughnessTextureTransform:Se,emissiveColor:Ee,emissiveTexture:Oe,emissiveTextureTransform:Re,occlusionTexture:De,occlusionTextureTransform:Be}=ve.material,Ze=Ye(we),Xe=Je$1(Se),Je=Ye(Ee),Qe=Ye(Oe),dt=Je$1(Re),$t=Ye(De),bt=Je$1(Be);be.metallic=fe,be.roughness=_e,be.metallicRoughnessTexture=we,be.emissiveColor=Ee,be.emissiveTexture=Oe,be.occlusionTexture=De,be.colorTextureTransform=$e$1(Te),be.normalTextureTransform=$e$1(Ce),be.emissiveTextureTransform=$e$1(Re),be.occlusionTextureTransform=$e$1(Be),be.metallicRoughnessTextureTransform=$e$1(Se),be.uid=`${be.uid},mrm:${fe},mrr:${_e},mrt:${Ze},mrtt:${Xe},emuid:${Je},etmuid:${Qe},ett:${dt},otmuid:${$t},ott:${bt}`}return be}_getInternalTextureId(fe){const ve=this._getInternalTexture(fe,SA.Opaque);return null==ve?void 0:ve.id}_getInternalTexture(fe,ve){const _e=function We$1(fe){return fe.data??fe.url}(fe);if(!_e)return null;const be=`${fe.contentHash}/${ve}`;let we=this._textures.get(be);if(!we){let Se=null;const Te=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,Ee={wrap:He(fe.wrap),noUnpackFlip:!0,maxAnisotropy:Te,mipmap:Te>1};r$19(_e)?(Se=_e.data,Ee.preMultiplyAlpha=!1,Ee.encoding=_e.encoding):(Se=_e,Ee.preMultiplyAlpha=ve!==SA.Opaque,Ee.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),we=new CZ(Se,Ee),this._textures.set(be,we),we.load(this._context.stage.renderView.renderingContext),this._context.stage.add(we)}return we}_setInternalMaterialParameters(fe,ve){var _e,be;if(null!=fe.color&&function ze(fe,ve){ve.diffuse=b_.toUnitRGB(fe),ve.opacity=fe.a}(fe.color,ve),null!=fe.colorTexture){const _e=this._getInternalTexture(fe.colorTexture,ve.textureAlphaMode);_e?(ve.textureId=_e.id,ve.textureAlphaPremultiplied=!!_e.parameters.preMultiplyAlpha):ve.textureId=void 0}fe.normalTexture&&(ve.normalTextureId=this._getInternalTextureId(fe.normalTexture)),fe.emissiveColor&&(ve.emissiveFactor=b_.toUnitRGB(fe.emissiveColor)),fe.emissiveTexture&&(ve.emissiveTextureId=this._getInternalTextureId(fe.emissiveTexture)),fe.occlusionTexture&&(ve.occlusionTextureId=this._getInternalTextureId(fe.occlusionTexture)),fe.metallicRoughnessTexture&&(ve.metallicRoughnessTextureId=this._getInternalTextureId(fe.metallicRoughnessTexture)),ve.colorTextureTransformMatrix=s$1u(fe.colorTextureTransform),ve.normalTextureTransformMatrix=s$1u(fe.normalTextureTransform);const we=null!=(null==(_e=fe.normalTextureTransform)?void 0:_e.scale)?null==(be=fe.normalTextureTransform)?void 0:be.scale:yd;ve.scale=[we[0],we[1]],ve.occlusionTextureTransformMatrix=s$1u(fe.occlusionTextureTransform),ve.emissiveTextureTransformMatrix=s$1u(fe.emissiveTextureTransform),ve.metallicRoughnessTextureTransformMatrix=s$1u(fe.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(fe){var ve,_e;const be=this._drivenProperties.color;let we=(null==(ve=this.symbolLayer.material)?void 0:ve.colorMixMode)??null;if(be)fe.externalColor=$d;else{const ve=(null==(_e=this.symbolLayer.material)?void 0:_e.color)??null;ve?fe.externalColor=b_.toUnitRGBA(ve):(we=null,fe.externalColor=$d)}we&&(fe.colorMixMode=we),fe.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(fe,ve){var _e,be,we;const Se=null==(_e=ve.material)?void 0:_e.color,Te=null==(be=ve.material)?void 0:be.colorTexture,Ee=null==(we=ve.material)?void 0:we.alphaMode,Ce="blend"===Ee,Oe=!("opaque"===Ee)&&(function qe(fe){const ve=fe.vertexAttributes.color;if(null==ve)return!1;for(let _e=3;_e<ve.length;_e+=4)if(255!==ve[_e])return!0;return!1}(fe)||null!=Se&&Se.a<1||(null==Te?void 0:Te.transparent)||Ce),Re=this._materialProperties(fe,ve,Oe),De=this._materialInfoCache.byUid(Re.uid);if(De)return De.material;const Be={uid:Re.uid,material:null,isComponentTransparent:Oe,alphaMode:ve.material?ve.material.alphaMode:"opaque"},Ze=u$1X({normalTexture:Re.normalTexture,metallicRoughnessTexture:Re.metallicRoughnessTexture,metallicFactor:Re.metallic,roughnessFactor:Re.roughness,emissiveTexture:Re.emissiveTexture,emissiveFactor:b_.toUnitRGB(Re.emissiveColor),occlusionTexture:Re.occlusionTexture}),Xe={usePBR:this._usePBR(),isSchematic:Ze,hasVertexColors:Re.hasVertexColors,hasSymbolColors:Re.hasSymbolVertexColors,hasVertexTangents:Re.hasVertexTangents,ambient:Bi,diffuse:ji,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:vA.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Xe.mrrFactors=Ze?[...KH]:[Re.metallic,Re.roughness,QH[2]],ve.material&&(Xe.doubleSided=ve.material.doubleSided,Xe.cullFace=ve.material.doubleSided?vA.None:vA.Back,Xe.textureAlphaCutoff=ve.material.alphaCutoff),this._setExternalMaterialParameters(Xe),this._setMaterialTransparentParameter(Xe,Be),this._setInternalMaterialParameters(Re,Xe);const Je=new Rq(Xe);return Be.material=Je,this._materialInfoCache.set(Re.uid,Be),this._context.stage.add(Je),Je}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(fe,ve){fe.transparent=this.needsDrivenTransparentPass||ve.isComponentTransparent||fe.layerOpacity<1||fe.opacity<1||fe.externalColor&&fe.externalColor[3]<1,"auto"===ve.alphaMode?fe.textureAlphaMode=fe.transparent?SA.MaskBlend:SA.Opaque:fe.textureAlphaMode="opaque"===ve.alphaMode?SA.Opaque:"mask"===ve.alphaMode?SA.Mask:SA.Blend}_createFaceDebugNormals(fe,ve){const _e=ve.length,be=fe.spatialReference.isGeographic?20015077/180:1,we=.1*Math.max(fe.extent.width*be,fe.extent.height*be,fe.extent.zmax-fe.extent.zmin),Se=[],Te=[],Ee=ve[0].transformation,Ce=j$1r([1,0,0,0,1,0,0,0,1],Ee);for(let Oe=0;Oe<_e;Oe++){const fe=ve[Oe].attributes.get(nO.POSITION);if(!fe)continue;const _e=fe.data,be=fe.indices;for(let ve=0;ve<be.length;ve+=3)Le(_e,be,ve,lre),Ge$1(_e,be,ve,sre,ore,are),u$3Y(sre,sre,ore),u$3Y(sre,sre,are),g$2z(sre,sre,1/3),O$1v(sre,sre,Ee),Se.push(...sre),S$1P(lre,lre,Ce),z$1d(lre,lre),q$11(sre,sre,lre,we),Se.push(...sre),Te.push(Te.length),Te.push(Te.length)}return Se.length?new pD(this._debugFaceNormalMaterial,[[nO.POSITION,new Om(Se,Te,3,!0)]],null,eD.Line):null}_createPerVertexDebugVectors(fe,ve,_e,be,we){const Se=ve.length,Te=fe.spatialReference.isGeographic?20015077/180:1,Ee=.1*we*Math.max(fe.extent.width*Te,fe.extent.height*Te,fe.extent.zmax-fe.extent.zmin),Ce=[],Oe=[],Re=ve[0].transformation,De=j$1r([1,0,0,0,1,0,0,0,1],Re);_e===nO.TANGENT&&n$3X(De,Re);for(let Be=0;Be<Se;Be++){const fe=ve[Be],be=fe.attributes.get(nO.POSITION),we=fe.attributes.get(_e);if(!be||!we)continue;const Se=be.data,Te=be.indices,Ze=we.data,Xe=we.indices;for(let ve=0;ve<Te.length;ve++){const fe=3*Te[ve],_e=Xe[ve]*we.stride;o$44(sre,Se[fe+0],Se[fe+1],Se[fe+2]),O$1v(sre,sre,Re),Ce.push(...sre),o$44(ore,Ze[_e+0],Ze[_e+1],Ze[_e+2]),S$1P(ore,ore,De),z$1d(ore,ore),q$11(sre,sre,ore,Ee),Ce.push(...sre),Oe.push(Oe.length),Oe.push(Oe.length)}}return Ce.length?new pD(be,[[nO.POSITION,new Om(Ce,Oe,3,!0)]],null,eD.Line):null}_createAs3DShape(fe,ve,_e,be){const we=fe.geometry;if("mesh"!==we.type)return null;const Se=this._createGeometryInfo(we,ve,be);if(null==Se)return null;const{geometries:Te,objectTransformation:Ee}=Se;if(_B.DRAW_MESH_GEOMETRY_NORMALS){const fe=this._createPerVertexDebugVectors(we,Te,nO.NORMAL,this._debugVertexNormalMaterial,1),ve=this._createPerVertexDebugVectors(we,Te,nO.TANGENT,this._debugTangentNormalMaterial,.5),_e=this._createFaceDebugNormals(we,Te);fe&&Te.push(fe),ve&&Te.push(ve),_e&&Te.push(_e)}const Ce=new Qq({geometries:Te,layerUid:this._context.layer.uid,graphicUid:be,isElevationSource:!0});Ce.transformation=Ee;const Oe=a$2i(this.symbolLayer,{opacity:this._getLayerOpacity()}),Re=Oe?new HG(Te[0].material,[Oe],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,De=new gte(this,Ce,Te,null,null,p$2r,_e,Re);this._fastUpdateProcessor.onAddGraphic(),De.needsElevationUpdates=g$1h(_e.mode),De.useObjectOriginAsAttachmentOrigin=!0,De.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(we),_e.centerPointInElevationSR=this._getCenterPointInElevationSR(Ce.transformation);const{elevationProvider:Be,renderCoordsHelper:Ze}=this._context;return De.alignedSampledElevation=p$2r(De,_e,Be.spatialReference,((fe,ve)=>c$2k(fe,Be,_e,Ze,ve)),Ze),De}_fastTransformUpdatesAllowed(fe){const{vertexSpace:ve,spatialReference:_e}=fe;if(!a$1B(ve))return!1;const{type:be}=ve,{view:we}=this._context.graphicsCoreOwner,{viewingMode:Se}=we.state,Te=we.spatialReference;return Se===Wf.Global&&"local"===be||Se===Wf.Local&&G$Y(Te,_e)&&"georeferenced"===be&&!_e.isGeographic}_getCenterPointInElevationSR(fe){const ve=e$3y(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);return t$3D([fe[12],fe[13],fe[14]],this._context.renderCoordsHelper.spatialReference,ve),ve}_passthroughReprojectionInfo(fe){return fe.reprojection===pre.NONE&&!!fe.objectTransformation}_createPositionBuffer(fe,ve){const _e=fe.vertexAttributes.position;let be=_e,we=null;if(ve.reprojection===pre.NONE)return{position:be,georeferencedPositionBuffer:we};const Se=ve.reprojection===pre.RENDER?ve.transformBeforeProject:null;Se&&(be=e$1T(new Float64Array(be.length),be,Se));const{normal:Te,tangent:Ee}=fe.vertexAttributes;this._passthroughReprojectionInfo(ve)||!Te&&!Ee||(we=be);const Ce=be===_e||be===we?new Float64Array(be.length):be;return n$49(be,fe.spatialReference,0,Ce,this._context.renderCoordsHelper.spatialReference,0,be.length/3),{position:Ce,georeferencedPositionBuffer:we}}_createNormalBuffer(fe,ve,_e,be){const we=fe.vertexAttributes.normal;if(null==we)return null;let Se=we;const Te=be.reprojection===pre.RENDER?be.transformBeforeProject:null;Te&&(Se=V$t(Se,new Float32Array(Se.length),Te));const Ee=this._context.graphicsCoreOwner.view.viewingMode;if(be.reprojection===pre.NONE)return Se;if("local"===Ee){if(!O$1s(this._context.renderCoordsHelper.spatialReference))return Se;if(null==_e)return null;if(fe.spatialReference.isGeographic){const fe=Se===we?new Float32Array(Se.length):Se;return U$s(Se,ate.NORMAL,_e,fe)}if(fe.spatialReference.isWebMercator){const fe=Se===we?new Float32Array(Se.length):Se;return $$b(Se,ate.NORMAL,_e,fe)}return Se}if(null==_e)return null;const Ce=Se===we?new Float32Array(Se.length):Se;return v$H(Se,_e,ve,fe.spatialReference,Ce)}_createTangentBuffer(fe,ve,_e,be){const we=fe.vertexAttributes.tangent;if(null==we)return null;let Se=we;const Te=be.reprojection===pre.RENDER?be.transformBeforeProject:null;Te&&(Se=B$j(Se,new Float32Array(Se.length),Te));const Ee=this._context.graphicsCoreOwner.view.viewingMode;if(be.reprojection===pre.NONE)return Se;if("local"===Ee){if(!O$1s(this._context.renderCoordsHelper.spatialReference))return Se;if(null==_e)return null;if(fe.spatialReference.isGeographic){const fe=Se===we?new Float32Array(Se.length):Se;return U$s(Se,ate.TANGENT,_e,fe)}if(fe.spatialReference.isWebMercator){const fe=Se===we?new Float32Array(Se.length):Se;return $$b(Se,ate.TANGENT,_e,fe)}return Se}if(null==_e)return null;const Ce=Se===we?new Float32Array(Se.length):Se;return Y$a(Se,_e,ve,fe.spatialReference,Ce)}_createSymbolColorBuffer(fe){var ve,_e;if(this._requiresSymbolVertexColors()){const be=this._getVertexOpacityAndColor(fe),we=e$2a(null==(_e=null==(ve=this.symbolLayer)?void 0:ve.material)?void 0:_e.colorMixMode),Se=new Uint8Array(4);return r$1T(be,we,Se),Se}return null}_createBuffers(fe,ve){const _e=fe.vertexAttributes&&fe.vertexAttributes.position;if(!_e)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const be=fe.vertexAttributes.normal,we=fe.vertexAttributes.uv,Se=fe.vertexAttributes.tangent;if(be&&be.length!==_e.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Se&&Se.length/4!=_e.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(we&&we.length/2!=_e.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const Te=this._computeReprojectionInfo(fe),{position:Ee,georeferencedPositionBuffer:Ce}=this._createPositionBuffer(fe,Te),Oe=function Ke(fe){return fe.vertexAttributes.color}(fe),Re=this._createSymbolColorBuffer(ve),De=this._createNormalBuffer(fe,Ee,Ce,Te),Be=this._createTangentBuffer(fe,Ee,Ce,Te),Ze=we,{transformation:Xe,position:Je,normal:Qe,tangent:dt}=this._passthroughReprojectionInfo(Te)?{transformation:Te.objectTransformation,position:Ee,normal:De,tangent:Be}:this._transformOriginLocal(fe,Ee,De,Be);return{positionBuffer:Je,normalBuffer:Qe,tangentBuffer:dt,uvBuffer:Ze,colorBuffer:Oe,symbolColorBuffer:Re,objectTransformation:Xe,geometryTransformation:Te.reprojection===pre.NONE&&Te.geometryTransformation?Te.geometryTransformation:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}_computeReprojectionInfo(fe){var ve;const{vertexSpace:_e}=fe,be="georeferenced"===_e.type?G$Y(this._context.renderCoordsHelper.spatialReference,fe.spatialReference)?pre.NONE:pre.RENDER:pre.NONE;if(function p$1T(fe){return!a$1B(fe)}(_e))return{reprojection:be};const we=_e.origin,Se=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Te=(null==(ve=fe.transform)?void 0:ve.localMatrix)??dd;if(be===pre.NONE)return u$3m(fe.spatialReference,we,Se,this._context.renderCoordsHelper.spatialReference),{reprojection:be,objectTransformation:Se,geometryTransformation:r$39(Te)};const Ee=q$X([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],we);return c$4k(Ee,Ee,Te),{reprojection:be,transformBeforeProject:Ee}}_transformOriginLocal(fe,ve,_e,be){const we=this._context.renderCoordsHelper.spatialReference,Se=fe.anchor;nre[0]=Se.x,nre[1]=Se.y,nre[2]=Se.z??0;const Te=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u$3m(fe.spatialReference,nre,Te,we),h$2A(cre,Te);const{position:Ee,normal:Ce,tangent:Oe}=fe.vertexAttributes,Re=ve===Ee?new Float64Array(ve.length):ve;e$1T(Re,ve,cre);const De=_e?_e===Ce?new Float32Array(_e.length):_e:null,Be=be?be===Oe?new Float32Array(be.length):be:null;return _e&&De&&V$t(_e,De,cre),be&&Be&&B$j(be,Be,cre),{transformation:Te,position:Re,normal:De,tangent:Be}}_validateFaces(fe,ve){const _e=fe.vertexAttributes.position.length/3,be=ve.faces;if(be){let fe=-1;for(let ve=0;ve<be.length;ve++){const _e=be[ve];_e>fe&&(fe=_e)}if(_e<=fe)return this.logger.warn(`Vertex index ${fe} is out of bounds of the mesh position buffer`),!1}else if(_e%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(fe){var ve;if(!this._context.clippingExtent)return!1;const _e=null==(ve=fe.vertexAttributes)?void 0:ve.position;if(!_e)return!1;const be=this._context.elevationProvider.spatialReference,we=J$b({positions:_e,transform:fe.transform,vertexSpace:fe.vertexSpace,inSpatialReference:fe.spatialReference,outSpatialReference:be??fe.spatialReference,localMode:this._context.stage.viewingMode===Wf.Local});if(!we)return!1;const Se=we.length/3;return P$$(hre),c$3A(hre,we,0,Se),!V$W(hre,this._context.clippingExtent)}_createGeometryInfo(fe,ve,_e){if(!J$G(fe.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(fe))return null;if(this._isOutsideClippingArea(fe))return null;const be=this._createBuffers(fe,ve);if(null==be)return null;const{positionBuffer:we,uvBuffer:Se,colorBuffer:Te,symbolColorBuffer:Ee,normalBuffer:Ce,tangentBuffer:Oe,objectTransformation:Re,geometryTransformation:De}=be,Be=function Ve(fe){return fe.components??dre}(fe),Ze=new Array;let Xe=!1;const Je=I$1t(sre,Re),Qe=this._context.localOriginFactory.getOrigin(Je);for(const dt of Be){if(!this._validateFaces(fe,dt))return null;const ve=Se$2(fe,dt);if(0===ve.length)continue;const be=Ue(we,Ce,dt,ve);be.didFlipNormals&&(Xe=!0);const Re=[[nO.POSITION,new Om(we,ve,3,!0)],[nO.NORMAL,new Om(be.normals,be.indices,3,!0)]];Te&&Re.push([nO.COLOR,new Om(Te,ve,4,!0)]),Ee&&Re.push([nO.SYMBOLCOLOR,new Om(Ee,A$14(ve.length),4,!0)]),Se&&Re.push([nO.UV0,new Om(Se,ve,2,!0)]),Oe&&Re.push([nO.TANGENT,new Om(Oe,ve,4,!0)]);const Be=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:_e,layerUid:this._context.layer.uid}),Je=this._getOrCreateMaterial(fe,dt),$t=new pD(Je,Re,null,eD.Mesh,Be);$t.transformation=De,$t.localOrigin=Qe,Ze.push($t)}return Xe&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:Ze,objectTransformation:Re}}_updateMaterialParameters(fe){this._materialInfoCache.forEachMaterialInfo(fe),this._fastUpdateProcessor.forEachMaterialInfo(fe),this._fastUpdateProcessor.forEachClonedMaterial(((fe,ve)=>{ve.setParameters(fe.parameters)}))}_validateVertexSpace(fe){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:ve}}}}}=this,{vertexSpace:_e}=fe;return ve!==Wf.Local||"local"!==_e.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}}};let boe=class c35 extends qq{set symbol(fe){this._symbol=fe,fe.symbolLayers.forEach(((ve,_e)=>{const be=this.symbolLayers[_e];null!=be&&(be.symbol=fe,be.symbolLayer=ve)}))}get symbol(){return this._symbol}constructor(fe,ve,_e){super(ve.schedule),this._symbol=fe,this._context=ve,this._backgroundLayers=_e,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(fe){let ve=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(ve=this._backgroundLayers.concat(ve));const _e=ve.length;for(;this.symbolLayers.length<ve.length;)this.symbolLayers.push(null);this.symbolLayers.length=ve.length;const be=[];for(let we=0;we<_e;we++){const Se=ve.at(we);if(!1===Se.enabled)continue;woe.renderPriority=1-(1+we)/_e,woe.renderPriorityStep=1/_e,woe.ignoreDrivers=Se.ignoreDrivers;const Te=c$1s(this.symbol,Se,this._context,woe),Ee=w$22(fe,(()=>{this.symbolLayers[we]=null,Te.destroy()}));Ee&&be.push(Ee),this.symbolLayers[we]=Te}if(await a$4g(this.symbolLayers,(async(fe,ve)=>{if(null!=fe)try{await fe.load(),this._extentPadding+=Math.max(this._extentPadding,fe.extentPadding)}catch{this.symbolLayers[ve]=null}})),be.forEach((fe=>fe.remove())),s$4o(fe),this.symbolLayers.length&&!this.symbolLayers.some((fe=>!!fe)))throw new Error}getSymbolLayerSize(fe){const ve=this.symbolLayers[fe];return null!=ve?ve.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((fe=>null==fe?void 0:fe.queryForSnapping))}createGraphics3DGraphic(fe,ve){var _e,be;const we=fe.graphic,Se=this.symbolLayers.map((ve=>(null==ve?void 0:ve.createGraphics3DGraphic(fe))??null)),Te=this._context.arcade||(null==(be=null==(_e=this._context.featureExpressionInfoContext)?void 0:_e.arcade)?void 0:be.modules)||null;return new zW(we,ve||this,Se,fe.layer,Te)}get complexity(){return F$A(this.symbolLayers.map((fe=>null!=fe?fe.complexity:null)))}globalPropertyChanged(fe,ve){const _e=this.symbolLayers.length;for(let be=0;be<_e;be++){const _e=this.symbolLayers[be],o39=fe=>{const ve=fe.layers[be];return ve instanceof qG?ve:null};if(null!=_e&&!_e.globalPropertyChanged(fe,ve,o39))return!1}return!0}applyRendererDiff(fe,ve){return this.loadStatus!==Wq.LOADED?Hq.RecreateSymbol:this.symbolLayers.reduce(((_e,be)=>_e!==Hq.RecreateSymbol&&null!=be?Math.min(_e,be.applyRendererDiff(fe,ve)):_e),Hq.FastUpdate)}prepareSymbolPatch(fe){if(this.loadStatus===Wq.FAILED)return;if("partial"!==fe.diff.type)return;const ve=fe.diff.diff;if(!ve.symbolLayers||"partial"!==ve.symbolLayers.type)return;const _e=ve.symbolLayers.diff;this.symbolLayers.forEach(((ve,be)=>{if(null==ve)return;const we=_e[be];if(we){const _e={diff:we,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};ve.prepareSymbolLayerPatch(_e),fe.symbolStatePatches.push(..._e.symbolLayerStatePatches),_e.graphics3DGraphicPatches.length&&fe.graphics3DGraphicPatches.push(((fe,ve)=>{const we=fe.layers[be];null!=we&&_e.graphics3DGraphicPatches.forEach((fe=>fe(we,ve)))}))}}))}updateGeometry(fe,ve){return this._updateGeometryOrTransform(fe,((fe,_e)=>fe.updateGeometry(_e,ve)))}updateTransform(fe,ve,_e,be){return this._updateGeometryOrTransform(fe,((fe,we)=>fe.updateTransform(we,ve,_e,be)))}_updateGeometryOrTransform(fe,ve){for(let _e=0;_e<this.symbolLayers.length;_e++){const be=this.symbolLayers[_e];if(null==be)continue;const we=fe.layers[_e];if(!we||!ve(be,we))return!1}return!0}onRemoveGraphic(fe){for(let ve=0;ve<this.symbolLayers.length;ve++){const _e=this.symbolLayers[ve];if(null==_e)continue;const be=fe.layers[ve];null!=be&&_e.onRemoveGraphic(be)}}getFastUpdateStatus(){let fe=0,ve=0,_e=0;return this.symbolLayers.forEach((be=>{null!=be&&(be.loadStatus===Wq.LOADING?fe++:be.isFastUpdatesEnabled()?_e++:ve++)})),{loading:fe,slow:ve,fast:_e}}async queryForSnapping(fe,ve,_e,be){const we=this.symbolLayers.filter(O$1y).filter((fe=>null!=fe.queryForSnapping)).map((we=>we.queryForSnapping(fe,ve,_e,be))),Se=await Promise.all(we);return s$4o(be),Se.flat()}destroy(){if(!this.destroyed){super.destroy();for(const fe of this.symbolLayers)null!=fe&&fe.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const woe=new class s37{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};let xoe=class i35 extends qq{constructor(fe,ve,_e){super(ve),this.symbol=fe,this._convert=_e,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(fe){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(fe):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(fe){const ve=await this.symbol.fetchSymbol({signal:fe});ve.id=this.symbol.id,this.graphics3DSymbol=this._convert(ve),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(fe){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(fe,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:Bq}globalPropertyChanged(fe,ve){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(fe,ve)}applyRendererDiff(fe,ve){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(fe,ve):Hq.RecreateSymbol}prepareSymbolPatch(fe){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(fe)}updateGeometry(fe,ve){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(fe,ve)}updateTransform(fe,ve,_e,be){var we;return(null==(we=this.graphics3DSymbol)?void 0:we.updateTransform(fe,ve,_e,be))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}};function i$1o(fe){return fe instanceof xoe?fe.graphics3DSymbol:fe instanceof boe?fe:null}const u$14=()=>ar.getLogger("esri.views.3d.layers.graphics.labelPlacement");let Soe=class b12{constructor(fe,ve,_e,be=null){this.graphics3DGraphic=fe,this.labelSymbol=ve,this.labelClass=_e,this.disablePlacement=be}};function h$L(fe){const ve=function C$n(fe){const ve=fe.labelClass.labelPlacement,{labelSymbol:_e,graphics3DGraphic:be}=fe,we=i$1o(be.graphics3DSymbol),Se="point-3d"===(null==we?void 0:we.symbol.type)?we.symbol:null,Te=Toe[ve]||y$I(fe);return null!=Se&&Se.supportsCallout()&&Se.hasVisibleVerticalOffset()&&!be.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Se.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!_e||!_e.hasVisibleVerticalOffset()||null!=Se&&Se.supportsCallout()&&Se.verticalOffset&&!be.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:Te&&function D$j(fe){return"above-center"===fe}(Te.placement)?{placement:"above-center",verticalOffset:_e.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,Te.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u$14().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+ve+" placement)"),null)}(fe);if(null==ve)return null;const _e=function g$I(fe,ve){if(ve.anchor)return ve;const _e=fe.labelClass.labelPlacement,be=Toe[_e],we=be||y$I(fe);return _e&&!be&&u$14().warnOncePerTick(`the requested label placement '${_e}' is currently unsupported in SceneView.`),function d$Y(fe,ve){const _e=ve.graphics3DGraphic.graphic.geometry;if(null==_e)return null;if(null!=ve.disablePlacement)return ve.labelClass.labelPlacement?(u$14().warnOncePerTick(v$A(null==fe?void 0:fe.placement,ve.disablePlacement.logEntityDescription)),y$I(ve)):fe;const be=_e.type;switch(be){case"polyline":case"polygon":case"extent":case"multipoint":if(ve.labelClass.labelPlacement)return u$14().warnOncePerTick(v$A(null==fe?void 0:fe.placement,`'${be}' geometries`)),y$I(ve);break;case"point":case"mesh":return fe}return fe}(we,fe)}(fe,ve);if(null==_e)return null;const be=_e.anchor,we=!!ve.hasLabelVerticalOffset,Se=ve.verticalOffset;return function P$j(fe,ve,_e){const be=_e.graphics3DGraphic.graphic.geometry;if(null==be)return null;switch(be.type){case"point":case"mesh":!function z$f(fe,ve,_e){const be=O$n(_e);if(null==be)return;const we=_e.graphics3DGraphic.layers[0];switch(null!=we?we.getCenterObjectSpace(fe.translation):o$44(fe.translation,0,0,0),be.type){case"icon":case"text":!function L$l(fe,ve,_e,be){const{graphics3DGraphic:we}=_e,Se=null!=be?be.getScreenSize():null;if(we.isDraped||null==Se)fe.hasLabelVerticalOffset||"center"===fe.anchor||(Toe[_e.labelClass.labelPlacement]&&u$14().warnOncePerTick(`the requested placement '${ve.placement}' is currently unsupported for draped graphics`),fe.anchor="center");else{const be=function S$t(fe,ve=Poe){const{graphics3DGraphic:_e}=fe,be=_e.layers[0],we=(null==be?void 0:be.stageObject.geometries[0].material)??null;if(we&&we instanceof Pj){const fe=we.parameters.anchorPosition;ve[0]=2*(fe[0]-.5),ve[1]=2*(fe[1]-.5)}else ve[0]=0,ve[1]=0;return ve}(_e);fe.screenOffset[0]=Se[0]/2*(ve.normalizedOffset[0]-be[0]);const we=Se[1]/2*(ve.normalizedOffset[1]-be[1]);fe.hasLabelVerticalOffset?(fe.centerOffset[1]=we,fe.centerOffsetUnits="screen"):fe.screenOffset[1]=we}}(fe,ve,_e,we);break;case"object":case"fill":j$v(fe,ve,we)}}(fe,ve,_e);break;case"polygon":!function w$C(fe,ve,_e){const be=O$n(_e);if(null!=be)switch(be.type){case"extrude":{const be=_e.graphics3DGraphic.layers[0];null!=be?(be.getBoundingBoxObjectSpace(Coe),E$1m(Coe,fe.translation),fe.translation[2]=N$W(Coe)/2):o$44(fe.translation,0,0,0),j$v(fe,ve,be);break}}}(fe,ve,_e)}const we=J9-J7;return fe.screenOffset[0]+=we*ve.normalizedOffset[0],fe.screenOffset[1]+=we*ve.normalizedOffset[1],fe}(new kse(Se,be,we),_e,fe)}function O$n(fe){const ve=i$1o(fe.graphics3DGraphic.graphics3DSymbol);return null!=ve?ve.symbol.symbolLayers.at(0):null}function v$A(fe,ve){return`the requested label placement '${fe}' is currently unsupported for ${ve} in SceneView.`}function y$I(fe){const ve=fe.graphics3DGraphic.graphic.geometry;if(null==ve)return null;switch(ve.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Bi,anchor:"center"};case"polygon":{const ve=O$n(fe);return null!=ve&&"extrude"===ve.type?Toe["above-center"]:{placement:"center-center",normalizedOffset:Bi,anchor:"center"}}case"point":case"mesh":return Toe["above-center"];default:return}}function j$v(fe,ve,_e){const be=null!=_e?_e.getBoundingBoxObjectSpace(Coe):Coe,we=r$3y(be[3]-be[0],be[4]-be[1],be[5]-be[2]),Se=Math.sqrt(we[0]*we[0]+we[1]*we[1]);fe.centerOffset[0]=Se/2*ve.normalizedOffset[0];const Te=fe.translation[2],Ee=we[2]/2*ve.normalizedOffset[1];fe.translation[2]=0,fe.elevationOffset=Te+Ee;const Ce=s$4g(we);fe.centerOffset[2]=Ce/2*ve.normalizedOffset[2]}const Toe={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Eoe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const NRe in Eoe){const fe=Eoe[NRe],ve=Toe[NRe];fe.forEach((fe=>{Toe[fe]=ve}))}Object.freeze&&(Object.freeze(Toe),Object.keys(Toe).forEach((fe=>{var ve;Object.freeze(Toe[fe]),Object.freeze(null==(ve=Toe[fe])?void 0:ve.normalizedOffset)})));const Poe=[0,0],Coe=i$3t();let Ooe=class s59{constructor(fe){this._stage=fe,this._materials=new Map}get(fe){return this._materials.get(fe)}add(fe,ve){this._materials.set(fe,ve),this._stage.add(ve)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},Aoe=class z7{constructor(fe,ve){this.labelingContext=fe,this.graphics3DGraphic=ve,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Moe=class F4{constructor(fe,ve,_e,be,we){this.labelClass=fe,this.graphics3DSymbol=ve,this.graphics3DCalloutSymbolLayer=_e,this.textRenderParameters=be,this.labelFunction=we,this.calloutSymbolLayerIndex=0}},Roe=class M5{constructor(fe,ve,_e,be,we,Se,Te,Ee){this.layer=ve,this.graphics3DCore=_e,this.scaleVisibility=be,this.emptySymbolLabelSupported=we,this.elevationInfoOverride=Se,this.disablePlacement=Te,this.active=Ee,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new eZ(fe,{pickable:!0,disableOctree:!0},ve.uid)}destroy(){this.stageLayer.destroy()}},Ioe=class V5 extends zi{constructor(fe){super(fe),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.camera}),(()=>this.setDirty())),d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.rasterPixelRatio}),(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask(gI.LABELER,this)]),this._textTextureAtlas=new Gse({view:this.view}),this._hudMaterialCollection=new Ooe(this.view._stage),this._calloutMaterialCollection=new Ooe(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=r$3M(this._textTextureAtlas),this._hudMaterialCollection=r$3M(this._hudMaterialCollection),this._calloutMaterialCollection=r$3M(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Loe.graphic=null,Loe.renderingInfo=null,Loe.layer=null}_activateLabelingContext(fe){fe.graphics.forEach(((ve,_e)=>{const be=new Aoe(fe,ve);this._labels.set(_e,be),fe.labelsToInitialize.set(_e,be),ve.setVisibilityFlag(CB.LABEL,PB.USER,!0)})),fe.active=!0}_deactivateLabelingContext(fe){fe.graphics.forEach(((fe,ve)=>{fe.setVisibilityFlag(CB.LABEL,PB.USER,!1),this.setLabelGraphicVisibility(fe,!1),fe.clearLabelGraphics(),this._labels.delete(ve)})),fe.active=!1}_addLabelTextureToAtlas(fe){for(const ve of fe.graphics3DGraphic.labelLayers){if(!ve._labelClass)continue;const _e=fe.textRenderers[ve._labelIndex];_e&&(this._textTextureAtlas.addTextTexture(_e,ve.stageObject),fe.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(fe){for(const ve of fe.graphics3DGraphic.labelLayers){if(!ve._labelClass)continue;const _e=fe.textRenderers[ve._labelIndex];null!=_e&&(this._textTextureAtlas.removeTextTexture(_e,ve.stageObject),fe.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(fe){return this._updateLabels(fe),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(fe),dI}_updateLabels(fe){if(this._dirty){this._dirty=!1;for(const ve of this._labelingContexts)if(ve.active)if(U$l(ve))this._dirty=!0;else if(k$j(ve.labelClassContexts)){if(null===ve.labelClassContexts){this._deactivateLabelingContext(ve);continue}this._createLabelClassContext(ve),this._dirty=!0}else n$4E(ve.labelsToInitialize,((_e,be)=>(this._ensureGraphics3DResources(_e)&&(this._labels.set(be,_e),this.deconflictor.setDirty(),fe.madeProgress()),(_e.visible&&_e.textInitialized||!_e.visible&&_e.hasGraphics3DResources)&&(ve.labelsToInitialize.delete(be),fe.madeProgress()),fe.done)))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(fe){var ve,_e,be;const we=null==(ve=fe.labelClassAbortController)?void 0:ve.signal;fe.layer.when&&await fe.layer.when(),s$4o(we),null==(_e=fe.scaleVisibility)||_e.updateScaleRangeActive();const Se=fe.graphics3DCore,Te=null==(be=Se.layer.labelingInfo)?void 0:be.filter((fe=>!!fe.symbol));Te&&0!==Te.length&&(await a$4g(Te,(async(ve,_e)=>{const be=ve.symbol,Te=i$1o(Se.getOrCreateGraphics3DSymbol(be));if(null==Te)return void ar.getLogger(this).error("Failed to create Graphics3DSymbol for label");await Te.load(),s$4o(we);let Ee=null;o$33(be)&&be.hasVisibleCallout()&&(Ee=e$1Y(be,Se.symbolCreationContext),await Ee.load(),s$4o(we));const Ce=await _$1s(w$15(ve,fe.layer.fieldsIndex,this.view.spatialReference));if(s$4o(we),!0===Ce.ok){const be=await this._createTextRenderParameters(Te.symbol);s$4o(we),fe.labelClassContexts[_e]=new Moe(ve,Te,Ee,be,Ce.value)}else ar.getLogger(this).error(`Label expression failed to evaluate: ${Ce.error}`)})),s$4o(we))}async _createLabelClassContext(fe){return null==fe.labelClassPromise&&(fe.labelClassPromise=this._createLabelClassContextAsync(fe).catch((ve=>{if(b$2g(ve))throw ve;fe.labelClassContexts.length=0})).then((()=>{fe.labelClassAbortController=null,this.notifyChange("updating")})).catch((()=>{})),this.notifyChange("updating")),fe.labelClassPromise}async _createTextRenderParameters(fe){const ve=fe.symbolLayers.at(0);return"text"!==(null==ve?void 0:ve.type)?null:Vse.fromSymbol(ve,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(fe){for(const _e of fe.labelClassContexts)--_e.graphics3DSymbol.referenced;const ve=fe.labelClassAbortController;fe.labelClassAbortController=new AbortController,e$4f(ve),fe.labelClassContexts.length=0,fe.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(fe,ve,_e,be,we,Se){const Te=new Use(_e,a$1E(_e.anchor),function l$1K(fe){switch(fe){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}(_e.anchor),fe.text,r$36(fe.displayWidth,fe.displayHeight));return Loe.graphic=ve,Loe.renderingInfo=null,Loe.layer=be,we.createLabel(Loe,Te,this._hudMaterialCollection,this._textTextureAtlas,(()=>{const fe=h$L(Se);return fe?fe.elevationOffset:null}))}_createLineCalloutGraphic(fe,ve,_e,be,we){Loe.graphic=fe,Loe.layer=we;const Se=be.screenOffset[0];return Loe.renderingInfo=new TW(null,ve,be.translation,be.centerOffset,Se,be.centerOffsetUnits,be.elevationOffset,this._calloutMaterialCollection),_e.createGraphics3DGraphic(Loe)}_ensureGraphics3DResources(fe){var ve,_e;if(fe.hasGraphics3DResources)return!1;const be=fe.graphics3DGraphic;if(be.destroyed)return!1;this._ensureTextTextureResources(fe);const we=fe.labelingContext,Se=we.labelClassContexts;if(k$j(Se)||!we.emptySymbolLabelSupported&&0===be.layers.length)return!1;let Te=!1;const Ee=be.graphic,Ce=we.layer,Oe=B$f(we.layer);for(let Re=0;Re<Se.length;Re++){const _e=fe.textRenderers[Re],De=fe.textLabelPlacements[Re];if(null==_e||null==De)continue;const Be=Se[Re],Ze=Be.graphics3DSymbol,Xe=Ze.symbol&&"label-3d"===Ze.symbol.type?Ze.symbol:null,Je=Ze.symbolLayers[0];if(!Je)continue;Je.setElevationInfoOverride(we.elevationInfoOverride);const Qe=new Soe(be,Xe,Be.labelClass),dt=this._createTextSymbolGraphic(_e,Ee,De,Ce,Je,Qe);if(null==dt)return!1;dt._labelClass=Be.labelClass,dt._labelIndex=Re,be.addLabelGraphic(dt,we.stageLayer),be.deconflictionPriority=(null==(ve=Be.textRenderParameters)?void 0:ve.definition.size)??0,be.setVisibilityFlag(CB.LABEL,PB.USER,Oe),be.setVisibilityFlag(CB.LABEL,PB.SCALE_RANGE,!0),be.setVisibilityFlag(CB.LABEL,PB.DECONFLICTION,!1),Te=!0;const $t=Be.graphics3DCalloutSymbolLayer;if($t&&De.hasLabelVerticalOffset){$t.setElevationInfoOverride(we.elevationInfoOverride);const fe=this._createLineCalloutGraphic(Ee,Xe,$t,De,Ce);null!=fe&&(Be.calloutSymbolLayerIndex=be.labelLayers.length,be.addLabelGraphic(fe,we.stageLayer))}break}return Te&&(null==(_e=we.scaleVisibility)||_e.updateGraphicLabelScaleVisibility(be)),fe.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(fe){const ve=fe.labelingContext.labelClassContexts;for(const _e of fe.graphics3DGraphic.labelLayers){if(null==_e._labelClass)continue;const fe=ve[_e._labelIndex].graphics3DSymbol.symbolLayers[0];null==fe||fe.onRemoveGraphic(_e)}fe.graphics3DGraphic.deconflictionPriority=0,fe.graphics3DGraphic.clearLabelGraphics(),fe.hasGraphics3DResources=!1}_ensureTextTextureResources(fe){var ve;if(fe.textInitialized)return;const _e=fe.labelingContext,be=_e.labelClassContexts;if(k$j(be))return;const we=fe.graphics3DGraphic.graphic;for(let Se=0;Se<be.length;Se++){const Te=be[Se];if(fe.textRenderers[Se]=null,fe.textLabelPlacements[Se]=null,null==(null==Te?void 0:Te.textRenderParameters))continue;const Ee=Te.labelFunction;let Ce;if("arcade"===Ee.type)try{const fe=Ee.needsHydrationToEvaluate()?c$2m(we,_e.layer):we;Ce=Ee.evaluate(fe)}catch(Yf){Ce=null}else Ce=Ee.evaluate(we);if(null==Ce||""===Ce||/^\s+$/.test(Ce))continue;const Oe=Te.graphics3DSymbol,Re="label-3d"===(null==(ve=Oe.symbol)?void 0:ve.type)?Oe.symbol:null;if(!Oe.symbolLayers[0])continue;const De=h$L({graphics3DGraphic:fe.graphics3DGraphic,labelSymbol:Re,labelClass:Te.labelClass,disablePlacement:_e.disablePlacement});if(null==De)continue;const Be=f$16(a$1E(De.anchor));fe.textRenderers[Se]=new Q7(Ce,Be,Te.textRenderParameters,Gse.maxSize),fe.textLabelPlacements[Se]=De}fe.textInitialized=!0}_destroyTextTextureResources(fe){fe.textInitialized=!1,fe.textRenderers.length=0,fe.textLabelPlacements.length=0}_addGraphic(fe,ve){const _e=ve.graphic.uid;if(fe.graphics.set(_e,ve),fe.active){const be=new Aoe(fe,ve);this._labels.set(_e,be),fe.labelsToInitialize.set(_e,be)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(fe,ve){const _e=ve.graphic.uid,be=this._labels.get(_e);if(!be)return!0;for(const we of be.graphics3DGraphic.labelLayers)if(null!=we._labelClass&&!fe.labelClassContexts[we._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(we,ve.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(fe,ve){const _e=ve.graphic.uid,be=this._labels.get(_e);fe.graphics.delete(_e),be&&(this._destroyGraphic(be,_e),fe.labelsToInitialize.delete(_e),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(fe,ve){this._labels.delete(ve),fe.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(fe),this._destroyTextTextureResources(fe),fe.hasGraphics3DResources&&this._destroyGraphics3DResources(fe)}async _labelingInfoChange(fe,ve){if(!ve)return this._visibilityInfoChange(fe),this._resetLabels(fe),this._createLabelClassContext(fe);for(const _e of ve){const ve=fe.graphics.get(_e);ve&&(this._removeGraphic(fe,ve),this._addGraphic(fe,ve))}}_globalPropertyChanged(fe,ve){for(const _e of ve.labelClassContexts){const be=new Map;ve.graphics.forEach((fe=>be.set(fe.graphic.uid,fe)));const l49=fe=>fe.labelLayers[0];if(_e.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(fe,be,l49),_e.graphics3DCalloutSymbolLayer){const t85=fe=>fe.labelLayers[_e.calloutSymbolLayerIndex];_e.graphics3DCalloutSymbolLayer.globalPropertyChanged(fe,be,t85)}}}_visibilityInfoChange(fe){const ve=B$f(fe.layer);ve&&!fe.active&&this._activateLabelingContext(fe),!ve&&fe.active&&this._deactivateLabelingContext(fe),this.setDirty()}_resetAllLabels(){for(const fe of this._labelingContexts)this._resetLabels(fe)}_resetLabels(fe){fe.graphics.forEach(((ve,_e)=>{const be=this._labels.get(_e);be&&(this._destroyGraphic(be,_e),be.visible=!1,fe.labelsToInitialize.set(_e,be))})),this._destroyLabelClassContext(fe),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(fe){for(const ve of this._labelingContexts)if(ve.graphics3DCore===fe)return ve;return null}addGraphicsOwner(fe,ve,_e){const be=(null==_e?void 0:_e.emptySymbolLabelSupported)||!1,we=(null==_e?void 0:_e.elevationInfoOverride)||null,Se=(null==_e?void 0:_e.disablePlacement)||null;if(this._findLabelingContext(fe))return;const Te=fe.layer,Ee=new Roe(this.view._stage,Te,fe,ve,be,we,Se,B$f(Te));return this._labelingContexts.push(Ee),this.setDirty(),{addGraphic:fe=>this._addGraphic(Ee,fe),removeGraphic:fe=>this._removeGraphic(Ee,fe),updateGraphicGeometry:fe=>this._updateGraphicGeometry(Ee,fe),layerLabelsEnabled:()=>B$f(Ee.layer),labelingInfoChange:fe=>this._labelingInfoChange(Ee,fe),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Ee),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Ee),visibilityInfoChange:()=>this._visibilityInfoChange(Ee),reset:()=>this._resetLabels(Ee),remove:()=>this._removeGraphicsOwner(fe),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(fe){const ve=this._findLabelingContext(fe);if(!ve)return;const _e=this._labelingContexts.indexOf(ve);this._labelingContexts.splice(_e,1),ve.graphics.forEach((fe=>this._removeGraphic(ve,fe))),ve.destroy(),this.setDirty()}setLabelGraphicVisibility(fe,ve){const _e=fe.graphic.uid,be=this._labels.get(_e);be&&be.visible!==ve&&(ve&&!be.addedToTextureAtlas?(this._addLabelTextureToAtlas(be),be.textInitialized||be.labelingContext.labelsToInitialize.set(_e,be)):!ve&&be.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(be),be.visible=ve,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var fe;return this._dirty||(null==(fe=this._textTextureAtlas)?void 0:fe.updating)||this.deconflictor.updating||this._labelingContexts.some((fe=>U$l(fe)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const fe=this._labelingContexts.length>0?this._labelingContexts.reduce(((fe,ve)=>fe+(U$l(ve)?0:1)),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*fe+.5*this.deconflictor.updatingProgress}get test(){}};function U$l(fe){return!!fe.labelClassPromise&&!!fe.labelClassAbortController}function k$j(fe){return!fe||0===fe.length}function B$f(fe){var ve;return!0===fe.labelsVisible&&!!(null==(ve=fe.labelingInfo)?void 0:ve.some((fe=>!!fe.symbol)))}e$4o([y$2v({constructOnly:!0})],Ioe.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],Ioe.prototype,"deconflictor",void 0),e$4o([y$2v()],Ioe.prototype,"_textTextureAtlas",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],Ioe.prototype,"updating",null),Ioe=e$4o([a$4y("esri.views.3d.layers.graphics.Labeler")],Ioe);const Loe=new class S3 extends BG{}(null,null,null);let Doe=class t57{constructor(fe,ve,_e,be=null){this.lij=[0,0,0],this.extent=u$3J(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Noe.VISIBLE_ON_SURFACE,screenRect:u$3J(),distance:0,shouldSplit:!1},this.used=!1,be&&this.acquire(fe,ve,_e,be)}acquire(fe,ve,_e,be){this.tilingScheme=be,this.id=t57.id(fe,ve,_e),this.lij[0]=fe,this.lij[1]=ve,this.lij[2]=_e,be.getExtent(fe,ve,_e,this.extent),this.resolution=be.resolutionAtLevel(fe)}release(){this.tilingScheme=null}getChildren(fe){const ve=this.lij[0]+1,_e=2*this.lij[1],be=2*this.lij[2];return fe?(fe[0].acquire(ve,_e,be,this.tilingScheme),fe[1].acquire(ve,_e+1,be,this.tilingScheme),fe[2].acquire(ve,_e,be+1,this.tilingScheme),fe[3].acquire(ve,_e+1,be+1,this.tilingScheme),fe):[new t57(ve,_e,be,this.tilingScheme),new t57(ve,_e+1,be,this.tilingScheme),new t57(ve,_e,be+1,this.tilingScheme),new t57(ve,_e+1,be+1,this.tilingScheme)]}copyMeasurementsFrom(fe){this.measures.visibility=fe.measures.visibility,this.measures.shouldSplit=fe.measures.shouldSplit,this.measures.distance=fe.measures.distance,e$3R(fe.measures.screenRect,this.measures.screenRect)}static id(fe,ve,_e){return`${fe}/${ve}/${_e}`}};var Noe;!function(fe){fe[fe.INVISIBLE=0]="INVISIBLE",fe[fe.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",fe[fe.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"}(Noe||(Noe={}));const Foe=.5*Math.PI,zoe=Foe/Math.PI*180;let koe=class N6{constructor(fe){this._renderCoordsHelper=fe.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:[0,0,0],direction:[0,0,0]};for(let ve=0;ve<4;ve++)this._extent[ve]={origin:[0,0,0],direction:[0,0,0],cap:{next:null,direction:[0,0,0]}},this._planes[ve]=E$1z();this._planes[$R.NEAR]=E$1z(),this._planes[$R.FAR]=E$1z(),this._planesWithoutFar=this._planes.slice(0,5)}update(fe,ve,_e,be=!0){const we=this._extent;this._toRenderBoundingExtent(fe,ve,_e),u$3Y(this._center.origin,we[0].origin,we[2].origin),g$2z(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),be||g$2z(this._center.direction,this._center.direction,-1);for(let Se=0;Se<4;Se++){const fe=we[Se];this._renderCoordsHelper.worldUpAtPosition(fe.origin,fe.direction);const ve=we[3===Se?0:Se+1];fe.cap.next=ve.origin,J$M(fe.cap.direction,fe.origin,ve.origin),U$13(fe.direction,fe.cap.direction,fe.origin,this._planes[Se]),be||g$2z(fe.direction,fe.direction,-1)}U$13(we[0].cap.direction,we[1].cap.direction,we[0].origin,this._planes[$R.NEAR]),be?q$U(this._planes[$R.NEAR],this._planes[$R.FAR]):(A$1s(this._planes[$R.FAR],this._planes[$R.NEAR]),q$U(this._planes[$R.NEAR],this._planes[$R.NEAR])),this._maxSpan=Math.max(Math.abs(fe[0]-fe[2]),Math.abs(fe[1]-fe[3])),this._maxSpanSpatialReference=ve,this._minGlobalAltitude=.9*s$45(this._maxSpanSpatialReference).radius}isVisibleInFrustum(fe,ve,_e=!1){if(null==fe)return!1;if(this._renderCoordsHelper.viewingMode===Wf.Global){const _e=this._maxSpanSpatialReference.isGeographic?zoe:Foe*ve;if(this._maxSpan>_e)return!0;if(null!=fe.altitude&&fe.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(fe)}if(0===this._maxSpan){const ve=this._extent[0];return!(_e||!fe.intersectsRay(l$3V(ve.origin,ve.direction)))}for(let we=0;we<this._extent.length;we++){const ve=this._extent[we];if(!_e&&fe.intersectsRay(l$3V(ve.origin,ve.direction)))return!0;if(fe.intersectsLineSegment(h$2z(ve.origin,ve.cap.next,qoe),ve.cap.direction))return!0}const be=_e?this._planes:this._planesWithoutFar;for(let we=0;we<fe.lines.length;we++){const ve=fe.lines[we];if(g$1u(be,ve.origin,ve.endpoint,ve.direction))return!0}return!1}_toRenderBoundingExtentGlobal(fe,ve,_e){p$4O(fe,Voe),Voe[2]=_e,u$3m(ve,Voe,Boe,this._renderCoordsHelper.spatialReference),h$2A(joe,Boe),P$$(Goe);for(const{x0:be,x1:we,y0:Se,y1:Te}of Uoe)for(let Ee=0;Ee<5;Ee++){const Ce=Ee/4;Voe[0]=f$3i(fe[be],fe[we],Ce),Voe[1]=f$3i(fe[Se],fe[Te],Ce),Voe[2]=_e,n$3Y(Voe,ve,Voe,this._renderCoordsHelper.spatialReference),O$1v(Voe,Voe,joe),h$2e(Goe,Voe)}o$44(this._extent[0].origin,Goe[0],Goe[1],Goe[2]),o$44(this._extent[1].origin,Goe[3],Goe[1],Goe[2]),o$44(this._extent[2].origin,Goe[3],Goe[4],Goe[2]),o$44(this._extent[3].origin,Goe[0],Goe[4],Goe[2]);for(let be=0;be<4;++be)O$1v(this._extent[be].origin,this._extent[be].origin,Boe)}_toRenderBoundingExtentLocal(fe,ve,_e){i$48(fe,ve,Hoe,this._renderCoordsHelper.spatialReference),o$44(this._extent[0].origin,Hoe[0],Hoe[1],_e),o$44(this._extent[1].origin,Hoe[2],Hoe[1],_e),o$44(this._extent[2].origin,Hoe[2],Hoe[3],_e),o$44(this._extent[3].origin,Hoe[0],Hoe[3],_e)}_toRenderBoundingExtent(fe,ve,_e){switch(this._renderCoordsHelper.viewingMode){case Wf.Global:this._toRenderBoundingExtentGlobal(fe,ve,_e);break;case Wf.Local:this._toRenderBoundingExtentLocal(fe,ve,_e);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(fe){if(V$12(fe.planes[$R.NEAR],this._center.origin)<0&&P$1g(this._center.direction,fe.direction)<0)return!0;for(let ve=0;ve<4;ve++){const _e=this._extent[ve];if(V$12(fe.planes[$R.NEAR],_e.origin)<0&&P$1g(_e.direction,fe.direction)<0)return!0}return!1}};const Uoe=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Voe=[0,0,0],Boe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],joe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Goe=i$3t(),Hoe=u$3J(),qoe=v$1Q();let Woe=class N7{constructor(fe,ve){this._renderCoordsHelper=fe,this._getIsGroundOpaque=ve,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=[0,0,0],this._frustumBoundingSphereRadius=0,this._frustum=new aU(fe),this._extendedFrustum=new aU(fe),this._intersector=new koe({renderCoordsHelper:fe}),this._renderSR=fe.spatialReference;const _e=a$40(this._renderSR);this._renderSREllipsoidRadius=s$45(_e).radius,this._renderCoordsHelper=fe}begin(fe,ve){this._surfaceElevation=ve,this._aboveGround=fe.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(fe),k$h(this._frustum),this._updateExtendedFrustum(fe),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(fe){const ve=this._renderCoordsHelper.viewingMode===Wf.Global&&fe.lij[0]>=Yoe&&fe.lij[0]<Zoe,_e=this._getOrCalculateSingleTileVisibility(fe,!ve);return _e!==Noe.INVISIBLE&&ve?this._calculateAggregatedChildrenVisibility(fe):_e}_calculateAggregatedChildrenVisibility(fe){let ve=Noe.INVISIBLE;const _e=this._cache.get(fe.id);if(null!=_e)return _e;const be=rae.acquire();fe.getChildren(be);for(const we of be){const fe=this.calculate(we);if(fe!==Noe.INVISIBLE&&(ve=fe,fe===Noe.VISIBLE_ON_SURFACE))break}return rae.release(be),this._cache.set(fe.id,ve),ve}_getOrCalculateSingleTileVisibility(fe,ve){const _e=this._cache.get(fe.id);if(null!=_e)return _e;const be=this._calculateSingleTileVisibility(fe);return ve&&this._cache.set(fe.id,be),be}_calculateSingleTileVisibility(fe){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Wf.Global&&fe.lij[0]<Xoe?this._calculateSingleTileVisibilitySided(fe,!1)===Noe.INVISIBLE?this._calculateSingleTileVisibilitySided(fe,!0):void 0:this._calculateSingleTileVisibilitySided(fe,this._aboveGround)}_isTileVisibleInFrustum(fe){return this._renderCoordsHelper.viewingMode===Wf.Local?this._isTileVisibleInFrustumLocal(fe):this._isTileVisibleInFrustumGlobal(fe)}_updateFrustumBoundingSphere(){const fe=this._frustum,ve=fe.origin,_e=yae;z$1d(_e,fe.direction);const be=fe.points,we=gae;Ki(we,be[4],ve);const Se=.5*P$1g(we,we)/P$1g(_e,we);q$11(this._frustumBoundingSphereCenter,ve,_e,Se);const Te=1+Se;this._frustumBoundingSphereRadius=Te}_isTileVisibleInFrustumLocal(fe){const ve=fe.tilingScheme.spatialReference,_e=fe.extent,be=this._renderSR,we=oae;if(we[0]=_e[0],we[1]=_e[1],we[2]=0,we[3]=_e[2],we[4]=_e[3],we[5]=0,!n$49(we,ve,0,we,be,0,2))return!1;const Se=aae;o$44(Se[0],we[0],we[1],0),o$44(Se[1],we[3],we[1],0),o$44(Se[2],we[3],we[4],0),o$44(Se[3],we[0],we[4],0);const Te=lae;o$44(Te,.5*(we[0]+we[3]),.5*(we[1]+we[4]),.5*(we[2]+we[5]));const Ee=cae;o$44(Ee,0,0,1);const Ce=.5*nn(Se[0],Se[2]),Oe=this._frustum,Re=this._frustumBoundingSphereRadius,De=this._frustumBoundingSphereCenter,Be=_ae;Ki(Be,De,Te);const Ze=P$1g(Ee,Be),Xe=vae;if(q$11(Xe,Te,Ee,Ze),nn(Xe,De)>Ce+Re)return!1;const Je=sae,Qe=this._isGroundOpaque&&this._aboveGround,dt=this._isGroundOpaque&&!this._aboveGround,$t=Math.min(dt?Bae:1/0,Ze+Re),bt=Math.max(Qe?-Bae:-1/0,Ze-Re);for(let wt=0;wt<4;++wt)q$11(Je[wt],Se[wt],Ee,$t),q$11(Je[wt+4],Se[wt],Ee,bt);return!J$6(Oe.planes,Je,8)}_isTileVisibleInFrustumGlobal(fe){const ve=fe.tilingScheme.spatialReference,_e=fe.extent,be=this._isGroundOpaque&&this._aboveGround,we=this._isGroundOpaque&&!this._aboveGround;if(fe.lij[0]<nae)return!0;const Se=aae,Te=.5*(_e[0]+_e[2]);if(o$44(Se[0],_e[0],_e[1],0),o$44(Se[1],_e[2],_e[1],0),o$44(Se[2],_e[2],_e[3],0),o$44(Se[3],_e[0],_e[3],0),o$44(Se[4],Te,_e[1],0),o$44(Se[5],Te,_e[3],0),!function e$1e(fe,ve,_e,be,we,Se,Te=1){const Ee=G$S(ve,we,Fh);if(null==Ee)return!1;if(Ee===f$2Q){if(fe===be&&_e===Se)return!0;const ve=_e+Te;for(let we=_e,Te=Se;we<ve;++we,++Te)r$3w(be[Te],fe[we]);return!0}const Ce=_e+Te;for(let Oe=_e,Re=Se;Oe<Ce;++Oe,++Re)Ee(fe[Oe],0,be[Re],0);return!0}(Se,ve,0,Se,this._renderSR,0,6))return!1;const Ee=Se[0][2]>0,Ce=Se[3][2]<0,Oe=Ee||Ce,Re=this._renderSREllipsoidRadius;if(Oe){const fe=r$3y(0,0,1),ve=hae;W$8(ve,fe,Se[0]);const _e=dae;if(W$8(_e,fe,Se[1]),Ee){const be=uae,we=Se[4],Te=pae;W$8(Te,we,fe),W$8(be,Te,we);const Ee=Se[0];_$1z(Ee,ve,be),D$i(Ee,Re);const Ce=Se[1];_$1z(Ce,_e,be),D$i(Ce,Re)}else if(Ce){const be=uae,we=Se[5],Te=pae;W$8(Te,we,fe),W$8(be,we,Te);const Ee=Se[3];_$1z(Ee,be,ve),D$i(Ee,Re);const Ce=Se[2];_$1z(Ce,be,_e),D$i(Ce,Re)}}const De=lae;{const fe=Ki(Sae,Se[3],Se[0]);z$1d(fe,fe);const ve=u$3Y(Tae,Se[0],Se[3]);g$2z(ve,ve,.5);const _e=-P$1g(ve,fe),be=u$3Y(Eae,Se[0],Se[1]);g$2z(be,be,.5);const we=u$3Y(Pae,Se[2],Se[3]);g$2z(we,we,.5);const Te=Ki(Cae,we,be);z$1d(Te,Te);q$11(De,be,Te,-(_e+P$1g(fe,be))/P$1g(fe,Te)),D$i(De,Re)}const Be=this._frustumBoundingSphereRadius,Ze=this._frustumBoundingSphereCenter,Xe=this._frustum,Je=Xe.planes,Qe=fae;z$1d(Qe,De);const dt=P$1g(Se[0],Qe)/dn(Se[0]),$t=Xe.origin,bt=Xe.points;let wt=!1;if(be){{wt=!0;const fe=z$1d([0,0,0],$t);for(let ve=0;ve<4;++ve){const _e=bt[4+ve],be=Ki([0,0,0],_e,$t);z$1d(be,be);const we=_$1z([0,0,0],fe,be);z$1d(we,we);const Se=_$1z([0,0,0],be,we);if(z$1d(Se,Se),P$1g($t,Se)>Re){wt=!1;break}}}if(wt&&P$1g($t,Qe)<Re*dt-Bae)return!1;if(P$1g(z$1d(jae,Xe.origin),Qe)<0)return!1;if(P$1g(z$1d(Gae,Xe.direction),Qe)>Hae)return!1}const xt=Math.sqrt(1-dt*dt);if(xt>.9)return!0;let St=!1;{const fe=P$1g(Qe,Ze),ve=dn(Ze);if(ve<=Be&&!Je.some((fe=>V$12(fe,$ae)>0))){if(!be)return!0;St=!0}const _e=fe/ve;if(!St&&fe<=0&&-fe>Be)return!1;const we=Be/ve;if(Math.sqrt(1-_e*_e)*Math.sqrt(1-we*we)-we*_e>xt)return!1}if(!wt){if(Se.some((fe=>Xe.intersectsPoint(fe))))return!0;if(Xe.intersectsPoint(De))return!0}const Et=bae;Ki(Et,Ze,$ae);const Pt=P$1g(Et,Qe),Ot=mae;g$2z(Ot,Qe,Pt);const At=nn(Ot,Ze),Mt=ve.isWGS84,Rt=fe.lij,Nt=Mt&&Rt[2]===2**Rt[0]-1,Ft=Mt&&0===Rt[2],zt=Ft?zae:Nt?Nae:Lae,kt=Ft?kae:Nt?Fae:Dae;if(!St){const fe=Se,ve=Uae,_e=Oae,be=Aae,we=$ae;for(const Se of zt){const Te=fe[Se];if(z$d(_e,fe[(Se+1)%4],Te),z$d(be,we,Te),W$8(ve,be,_e),Q$9(ve,bt,1))return!1}}let Bt=null;if(!be&&Pt<1.01*Be){const fe=2.5*Be;if(At>dt*fe+Be)return!1;const ve=xae,_e=fe/dt;for(let be=0;be<4;++be)g$2z(ve[be],Se[be],_e/Re);o$44(ve[4],0,0,0),Bt=ve}else{const fe=(we?Re+Bae:Pt+Be)/dt,ve=be?Re-Bae:(Pt-Be)/dt,_e=wae;for(let be=0;be<4;++be){const we=Se[be];g$2z(_e[be],we,ve/Re),g$2z(_e[be+4],we,fe/Re)}Bt=_e}if(J$6(Je,Bt,Bt.length))return!1;const jt=Xe.lines,Gt=Mae,Ht=Rae;for(const qt of jt){z$1d(Ht,qt.direction);for(const fe of kt){const ve=Bt[fe];if(z$1d(Gt,ve),Lt(Ht,Gt,Bt,bt))return!1;const _e=(fe+1)%4;if(be){const fe=Bt[_e];if(Ki(Gt,fe,ve),z$1d(Gt,Gt),Lt(Ht,Gt,Bt,bt))return!1}if(we){const ve=Bt[4+fe],be=Bt[4+_e];if(Ki(Gt,be,ve),z$1d(Gt,Gt),Lt(Ht,Gt,Bt,bt))return!1}}}return!0}_calculateSingleTileVisibilitySided(fe,ve){return this._isTileVisibleInFrustum(fe)?(this._intersector.update(fe.extent,fe.tilingScheme.spatialReference,this._surfaceElevation,ve),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?Noe.VISIBLE_ON_SURFACE:Noe.VISIBLE_WHEN_EXTENDED):Noe.INVISIBLE}_updateExtendedFrustum(fe){this._extendedFrustum.update(fe),k$h(this._extendedFrustum);const ve=this._renderCoordsHelper.worldUpAtPosition(fe.eye,Koe);this._aboveGround||j$1O(ve,ve);const _e=m$3J(-P$1g(ve,fe.viewForward));if(this._hasExtendedFrustum=_e>fe.fovY/2,!this._hasExtendedFrustum)return;const be=this._extendedFrustumParameters(),we=this._extendedFrustum.mutablePoints;for(let Se=0;Se<4;Se++){const fe=be.pointIndices[Se],ve=we[fe],_e=this._renderCoordsHelper.getAltitude(ve);if(be.needsAltitudeAdjustment(_e)){switch(this._renderCoordsHelper.worldUpAtPosition(ve,Koe),fe){case bR.FAR_BOTTOM_LEFT:case bR.FAR_TOP_LEFT:case bR.NEAR_BOTTOM_LEFT:case bR.NEAR_TOP_LEFT:Q$D(this._extendedFrustum.planes[$R.LEFT],Koe,Koe);break;case bR.FAR_BOTTOM_RIGHT:case bR.FAR_TOP_RIGHT:case bR.NEAR_BOTTOM_RIGHT:case bR.NEAR_TOP_RIGHT:Q$D(this._extendedFrustum.planes[$R.RIGHT],Koe,Koe)}g$2z(Koe,Koe,be.direction),this._renderCoordsHelper.intersectInfiniteManifold(l$3V(ve,Koe),be.zWithMargin,ve)}}if(this._extendedFrustum.updatePoints(we),b$1Z(we[bR.NEAR_BOTTOM_LEFT],we[bR.NEAR_BOTTOM_RIGHT],we[bR.NEAR_TOP_RIGHT],eae),b$1Z(we[bR.NEAR_BOTTOM_RIGHT],we[bR.NEAR_TOP_RIGHT],we[bR.NEAR_TOP_LEFT],tae),P$1g(eae,tae)<0){const fe=this._extendedFrustum.mutablePoints;this._aboveGround?[fe[bR.NEAR_BOTTOM_LEFT],fe[bR.NEAR_BOTTOM_RIGHT]]=[fe[bR.NEAR_BOTTOM_RIGHT],fe[bR.NEAR_BOTTOM_LEFT]]:[fe[bR.NEAR_TOP_LEFT],fe[bR.NEAR_TOP_RIGHT]]=[fe[bR.NEAR_TOP_RIGHT],fe[bR.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(fe)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const fe=this._surfaceElevation-Qoe;return{zWithMargin:fe,pointIndices:aU.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:ve=>ve>fe}}_extendedFrustumParametersBelowSurface(){const fe=this._surfaceElevation+Qoe;return{zWithMargin:fe,pointIndices:aU.planePointIndices.top,direction:1,needsAltitudeAdjustment:ve=>ve<fe}}};const Yoe=2,Zoe=6,Xoe=12,Joe=.95,Qoe=1,Koe=[0,0,0],eae=E$1z(),tae=E$1z(),rae=new pr(Array,(fe=>{4!==fe.length&&(fe[0]=new Doe,fe[1]=new Doe,fe[2]=new Doe,fe[3]=new Doe)}),(fe=>{fe[0].release(),fe[1].release(),fe[2].release(),fe[3].release()}));function k$h(fe){const ve=aU.nearFarLineIndices,_e=fe.mutablePoints;for(const be of ve){const[fe,ve]=be,we=_e[fe],Se=_e[ve];e$3Z(Koe,Se,we),g$2z(Koe,Koe,Joe),u$3Y(_e[ve],we,Koe)}fe.updatePoints(_e)}function W$8(fe,ve,_e){return _$1z(fe,ve,_e),z$1d(fe,fe),fe}function z$d(fe,ve,_e){return Ki(fe,ve,_e),z$1d(fe,fe),fe}function D$i(fe,ve){return g$2z(fe,fe,ve/dn(fe)),fe}const iae=[$R.LEFT,$R.RIGHT,$R.BOTTOM,$R.TOP,$R.FAR];function Y$5(fe,ve,_e){for(let be=0;be<_e;++be)if(V$12(fe,ve[be])<=0)return!1;return!0}function J$6(fe,ve,_e){for(const be of iae)if(Y$5(fe[be],ve,_e))return!0;return!1}const nae=4;function Q$9(fe,ve,_e){for(const be of ve)if(P$1g(be,fe)<_e)return!1;return!0}const sae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],oae=[0,0,0,0,0,0],aae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],lae=[0,0,0],cae=[0,0,0],uae=[0,0,0],hae=[0,0,0],dae=[0,0,0],pae=[0,0,0],fae=[0,0,0],mae=[0,0,0],yae=[0,0,0],gae=[0,0,0],vae=[0,0,0],_ae=[0,0,0],$ae=r$3y(0,0,0),bae=[0,0,0],wae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],xae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Sae=[0,0,0],Tae=[0,0,0],Eae=[0,0,0],Pae=[0,0,0],Cae=[0,0,0],Oae=[0,0,0],Aae=[0,0,0],Mae=[0,0,0],Rae=[0,0,0],Iae=[0,0,0],Lae=[0,1,2,3],Dae=[0,1,2,3],Nae=[0,1,3],Fae=[0,1,3],zae=[1,2,3],kae=[1,2,3],Uae=[0,0,0];const Vae=[0,0];function Lt(fe,ve,_e,be){if(0===_e.length||0===be.length)return!0;const we=Iae;W$8(we,fe,ve);const Se=be[0]<_e[0],Te=Se?_e:be,Ee=Vae;return function Vt(fe,ve,_e){let be=1/0,we=-1/0;for(const Se of _e){const fe=P$1g(ve,Se);be=Math.min(be,fe),we=Math.max(we,fe)}fe[0]=be,fe[1]=we}(Ee,we,Se?be:_e),function vt(fe,ve,_e,be){let we=1/0,Se=-1/0;for(const Te of be){const be=P$1g(_e,Te);if(we=Math.min(we,be),Se=Math.max(Se,be),we<=ve&&Se>=fe)return!1}return!0}(Ee[0],Ee[1],we,Te)}const Bae=430,jae=[0,0,0],Gae=[0,0,0],Hae=Math.cos(.25*Math.PI);let qae=class v10{constructor(fe){this._camera=new NR,this._focusOnMap=[0,0],this._screenRect=u$3J(),this._tileSize=fe.tileSize,this._renderCoordsHelper=fe.renderCoordsHelper,this._tilingScheme=fe.tilingScheme,this._visibility=new Woe(fe.renderCoordsHelper,fe.getIsGroundOpaque)}begin(fe,ve,_e){this._camera.copyFrom(fe),this._surfaceElevation=_e,this._focusOnMap[0]=ve.x,this._focusOnMap[1]=ve.y,a$4j(0,0,fe.fullWidth,fe.fullHeight,this._screenRect),this._visibility.begin(this._camera,_e)}end(){this._visibility.end()}updateTile(fe){fe.measures.visibility=this._visibility.calculate(fe),fe.measures.distance=function d$3i(fe,ve){const _e=(fe[0]+fe[2])/2,be=(fe[1]+fe[3])/2,we=Math.max(Math.abs(ve[0]-_e)-M$1o(fe)/2,0),Se=Math.max(Math.abs(ve[1]-be)-s$41(fe)/2,0);return Math.sqrt(we*we+Se*Se)}(fe.extent,this._focusOnMap),fe.measures.visibility!==Noe.INVISIBLE&&this._updateScreenMeasure(fe)}_updateScreenMeasure(fe){const ve=Wae,_e=1<<ve,be=fe.measures.screenRect;D$19(be);let we=0;const Se=fe.lij,Te=Se[0],Ee=Te+ve,Ce=Se[1]<<ve,Oe=Se[2]<<ve,Re=this._tileSizeWithBias(fe),De=Re*Re,Be=this._camera,{frustum:Ze,viewport:Xe}=Be;if(this._renderCoordsHelper.viewingMode===Wf.Local||Te>nae){const ve=Xae;this._tilingScheme.getExtent(Se[0],Se[1],Se[2],ve);const _e=Zae,be=tle,we=D$19();for(let fe=0;fe<4;++fe)this._toRenderCoords(ve,rle[fe][0],rle[fe][1],be[fe]),Be.projectToScreen(be[fe],_e[fe]),f$31(we,_e[fe]);const Te=J$6(Ze,be,4),Ee=we[0]>Xe[2]||we[1]>Xe[3]||we[2]<Xe[0]||we[3]<Xe[1];if(Te||Ee)return void(fe.measures.shouldSplit=!1)}for(let Je=0;Je<_e;Je++)for(let ve=0;ve<_e;ve++)if(we+=this._computeScreenArea(Ee,Ce+Je,Oe+ve,be),we>De)return void(fe.measures.shouldSplit=!0);fe.measures.shouldSplit=!1}_tileSizeWithBias(fe){return fe.measures.visibility===Noe.VISIBLE_WHEN_EXTENDED?this._tileSize*Yae:this._tileSize}_computeScreenArea(fe,ve,_e,be){this._tilingScheme.ensureMaxLod(fe);const we=Xae;this._tilingScheme.getExtent(fe,ve,_e,we);const Se=Qae;return this._toRenderCoords(we,0,3,Se[0]),this._toRenderCoords(we,2,3,Se[1]),this._toRenderCoords(we,2,1,Se[2]),this._toRenderCoords(we,0,1,Se[3]),this._computeTriangleScreenArea([Se[0],Se[1],Se[2]],be)+this._computeTriangleScreenArea([Se[2],Se[1],Se[3]],be)}_computeTriangleScreenArea(fe,ve){const _e=this._camera.frustum[$R.NEAR];let be=0,we=-1,Se=-1;for(let Te=0;Te<3;++Te)V$12(_e,fe[Te])>0?(be++,-1===we&&(we=Te)):-1===Se&&(Se=Te);if(0===be)return this._computeTriangleScreenAreaInside(fe,ve);if(1===be){const be=ele,Se=(we+1)%3,Te=(we+2)%3,Ee=we;r$3w(be[0],fe[Se]),r$3w(be[1],fe[Te]),x$q(be[2],fe[Te],fe[Ee],_e);const Ce=this._computeTriangleScreenAreaInside(be,ve);return x$q(be[1],fe[Se],fe[Ee],_e),Ce+this._computeTriangleScreenAreaInside(be,ve)}if(2===be){const be=ele,we=Se;r$3w(be[0],fe[we]);const Te=(Se+1)%3,Ee=(Se+2)%3;return x$q(be[1],fe[we],fe[Te],_e),x$q(be[2],fe[we],fe[Ee],_e),this._computeTriangleScreenAreaInside(be,ve)}return 0}_computeTriangleScreenAreaInside(fe,ve){for(let _e=0;_e<3;_e++)this._camera.projectToRenderScreen(fe[_e],Kae),this._camera.renderToScreen(Kae,Zae[_e]),m$3A(ve,Zae[_e],ve);return S$19(Zae[0],Zae[1],Zae[2])}_toRenderCoords(fe,ve,_e,be){return Jae[0]=fe[ve],Jae[1]=fe[_e],Jae[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Jae,this._tilingScheme.spatialReference,be),be}};const Wae=2,Yae=5,Zae=[i$4i(),i$4i(),i$4i(),i$4i()],Xae=u$3J(),Jae=[0,0,0],Qae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Kae=x$1H(),ele=[[0,0,0],[0,0,0],[0,0,0]];function x$q(fe,ve,_e,be){const we=V$12(be,ve),Se=V$12(be,_e),Te=Math.abs(Se-we);g$2z(fe,ve,Math.abs(Se)/Te),q$11(fe,fe,_e,Math.abs(we)/Te)}const tle=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],rle=[[0,3],[2,3],[2,1],[0,1]];function m$18(fe,ve,_e){if(null==fe||null==_e)return!1;let be=!0;return ile[0]=null!=fe.xmin?fe.xmin:0,ile[1]=null!=fe.ymin?fe.ymin:0,ile[2]=null!=fe.zmin?fe.zmin:0,be=be&&n$49(ile,fe.spatialReference,0,ve,_e,0,1),ile[0]=null!=fe.xmax?fe.xmax:0,ile[1]=null!=fe.ymax?fe.ymax:0,ile[2]=null!=fe.zmax?fe.zmax:0,be=be&&n$49(ile,fe.spatialReference,0,ve,_e,3,1),null==fe.xmin&&(ve[0]=-1/0),null==fe.ymin&&(ve[1]=-1/0),null==fe.zmin&&(ve[2]=-1/0),null==fe.xmax&&(ve[3]=1/0),null==fe.ymax&&(ve[4]=1/0),null==fe.zmax&&(ve[5]=1/0),be}function u$13(fe,ve,_e){if(null==fe||null==_e)return!1;let be=!0;return ile[0]=null!=fe.xmin?fe.xmin:0,ile[1]=null!=fe.ymin?fe.ymin:0,ile[2]=null!=fe.zmin?fe.zmin:0,be=be&&n$49(ile,fe.spatialReference,0,ile,_e,0,1),ve[0]=ile[0],ve[1]=ile[1],ile[0]=null!=fe.xmax?fe.xmax:0,ile[1]=null!=fe.ymax?fe.ymax:0,ile[2]=null!=fe.zmax?fe.zmax:0,be=be&&n$49(ile,fe.spatialReference,0,ile,_e,0,1),ve[2]=ile[0],ve[3]=ile[1],null==fe.xmin&&(ve[0]=-1/0),null==fe.ymin&&(ve[1]=-1/0),null==fe.xmax&&(ve[2]=1/0),null==fe.ymax&&(ve[3]=1/0),be}const ile=[0,0,0];let nle=class w4 extends zi{get tilingScheme(){const fe=this.tilingSchemeOwner.tilingScheme;return fe?fe.clone():null}set filterExtent(fe){if(null!=fe&&!fe.spatialReference.equals(this.viewState.spatialReference))return void ar.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const ve=this._get("filterExtent");if(ve===fe||null!=ve&&fe&&ve.equals(fe))return;const _e=null!=fe?fe.clone():null;this._set("filterExtent",_e),this._setDirty()}get _filterExtentRect(){if(null==this.filterExtent)return null;const fe=u$3J();return u$13(this.filterExtent,fe,this.tilingScheme.spatialReference),fe}get _rootTileIds(){const{tilingScheme:fe}=this;return this._filterExtentRect&&fe?fe.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(fe){fe!==this._get("suspended")&&(this._set("suspended",fe),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(fe){super(fe),this.tiles=new Wa,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new jr}initialize(){this.addHandles([d$3d((()=>[this.tilingScheme,this.tileSize]),(()=>this._reset()),Za),d$3d((()=>{var fe,ve,_e;return[this.tileSize,null==(fe=this.cameraOnSurface)?void 0:fe.location,this.tilingScheme,null==(ve=this.viewState)?void 0:ve.contentCamera,null==(_e=this.focus)?void 0:_e.location]}),(()=>this._setDirty()),Ja),d$3d((()=>{var fe;return(null==(fe=this.terrain)?void 0:fe.baseOpacity)??1}),(()=>this._setDirty()))]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(gI.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=l$4E(this._frameWorker)}addClient(){const fe=e$44();return this._clients.add(fe),1===this._clients.size&&this._setDirty(),e$4e((()=>this._removeClient(fe)))}_removeClient(fe){this._clients.delete(fe),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(wI))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(fe){this._dirty=!1,this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=gI.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(fe),this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=gI.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new qae({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>{var fe;return 1===((null==(fe=this.terrain)?void 0:fe.baseOpacity)??1)}}));const fe=this.viewState.contentCamera;this._tileMeasurements.begin(fe,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:fe}=this;return this._rootTileIds.map((ve=>new Doe(ve[0],ve[1],ve[2],fe)))}_purgeHorizonTiles(fe){if(fe.sort(((fe,ve)=>{const _e=fe.measures.screenRect,be=ve.measures.screenRect;return _e[1]+_e[3]-(be[1]+be[3])})),!(fe.length>ale))return fe.toArray();D$19(sle);for(let ve=0;ve<fe.length;ve++)if(m$3A(sle,fe.data[ve].measures.screenRect,sle),s$41(sle)>ole)return fe.data.slice(ve,fe.length);return[]}_subdivideTilesForView(fe){if(!this._pendingTiles)return;const{tilingScheme:ve}=this;for(;this._pendingTiles.length>0&&!fe.done;){const _e=this._pendingTiles.pop();fe.madeProgress(),this._filterExtentRect&&!E$1H(this._filterExtentRect,_e.extent)||(this._tileMeasurements.updateTile(_e),_e.measures.visibility!==Noe.INVISIBLE&&(_e.measures.shouldSplit?(ve.ensureMaxLod(_e.lij[0]+1),this._pendingTiles.push(..._e.getChildren())):this._newTiles.push(_e)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(fe){for(const be of this.tiles.items)be.used=!1;const ve=fe.filter((fe=>{const ve=this._idToTile.get(fe.id);return ve?(ve.copyMeasurementsFrom(fe),ve.used=!0):this._idToTile.set(fe.id,fe),!ve})),_e=this.tiles.items.filter((fe=>!fe.used&&(this._idToTile.delete(fe.id),!0)));this.tiles.removeMany(_e),this.tiles.addMany(ve),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((fe,ve)=>fe.measures.visibility!==ve.measures.visibility?fe.measures.visibility===Noe.VISIBLE_ON_SURFACE?-1:1:fe.measures.distance-ve.measures.distance)),this.tiles.forEach(((fe,ve)=>fe.loadPriority=ve))}};e$4o([y$2v({constructOnly:!0})],nle.prototype,"scheduler",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"renderCoordsHelper",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"tilingSchemeOwner",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"cameraOnSurface",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"focus",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"viewState",void 0),e$4o([y$2v({constructOnly:!0})],nle.prototype,"terrain",void 0),e$4o([y$2v()],nle.prototype,"tiles",void 0),e$4o([y$2v()],nle.prototype,"tileSize",void 0),e$4o([y$2v({readOnly:!0})],nle.prototype,"tilingScheme",null),e$4o([y$2v()],nle.prototype,"filterExtent",null),e$4o([y$2v({readOnly:!0})],nle.prototype,"_filterExtentRect",null),e$4o([y$2v({readOnly:!0})],nle.prototype,"_rootTileIds",null),e$4o([y$2v({value:!1})],nle.prototype,"suspended",null),e$4o([y$2v({readOnly:!0})],nle.prototype,"updating",null),nle=e$4o([a$4y("esri.views.3d.layers.support.FeatureTileTree3D")],nle);const sle=u$3J(),ole=10,ale=50;let lle=class _10 extends zi{constructor(){super(...arguments),this._propertiesPool=new ev({camera:NR},this),this._lastSeenCameraProjectionValues=new NR,this.mode=PM.ANIMATING,this._cssCamera=new NR,this._camera=new NR,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new La,this.viewingMode=Wf.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(fe,ve){this._set("viewingMode",fe),this._set("spatialReference",ve),this._set("constraints",new LP({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new ev({camera:NR},this)}destroy(){var fe;this.cameraController=null,null==(fe=this._propertiesPool)||fe.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Wf.Global){const fe=s$45(this.spatialReference).radius;this.camera=new NR({eye:r$3y(4*fe,0,0),center:r$3y(fe,0,0),up:r$3y(0,0,1)})}else this.camera=new NR({eye:r$3y(0,0,100),center:r$3y(0,0,0),up:r$3y(0,1,0)})}get animation(){return this.cameraController instanceof Qz&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const fe=this._cssCamera.copyFrom(this.camera),{height:ve,width:_e,pixelRatio:be}=this.camera;return fe.pixelRatio=1,fe.height=Math.round(ve/be),fe.width=Math.round(_e/be),fe}get camera(){return this._camera}set camera(fe){fe!==ule&&ule.copyFrom(fe),ule.computeUp(this.viewingMode),this.events.emit("before-camera-change",ule);const ve=this._camera;if(function w$y(fe,ve){return fe.fov!==ve.fov||fe.fullViewport[0]!==ve.fullViewport[0]||fe.fullViewport[1]!==ve.fullViewport[1]||fe.fullViewport[2]!==ve.fullViewport[2]||fe.fullViewport[3]!==ve.fullViewport[3]||fe.padding[IR.TOP]!==ve.padding[IR.TOP]||fe.padding[IR.RIGHT]!==ve.padding[IR.RIGHT]||fe.padding[IR.BOTTOM]!==ve.padding[IR.BOTTOM]||fe.padding[IR.LEFT]!==ve.padding[IR.LEFT]}(this._lastSeenCameraProjectionValues,ule)&&(this._lastSeenCameraProjectionValues.copyFrom(ule),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!ve.equals(ule)&&(this._camera=this._propertiesPool.get("camera").copyFrom(ule),this._cameraChanged=!ve.almostEquals(ule),this._cameraChanged)){const fe=U$1d((()=>{this._cameraChanged=!1,fe.remove()}))}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===PM.IDLE}get updating(){return this.mode!==PM.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(fe){this._contentCamera=null!=fe?fe.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===Wf.Global}get isLocal(){return this.viewingMode===Wf.Local}get navigating(){var fe;return!!(null==(fe=this.cameraController)?void 0:fe.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(fe){var ve;this.stopActiveCameraController()?(null==(ve=this.cameraController)||ve.destroy(),fe&&(this.removeHandles(hle),this.addHandles(p$4J((()=>fe.state===Xz.Finished||fe.state===Xz.Stopped),(()=>{this._set("cameraController",null),this.updateCamera((ve=>fe.onControllerEnd(ve)))}),{sync:!0,once:!0}),hle),fe.onControllerStart(this.camera)),this._set("cameraController",fe)):fe&&(fe.state=Xz.Rejected)}switchCameraController(fe){return this.cameraController=fe,fe.state!==Xz.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(fe){this._updateQueue.push(fe),this._processUpdateQueue()}_processUpdateQueue(){if(0===this._updateQueue.length||this._processingUpdates)return;this._processingUpdates=!0;const fe=this._updateQueue.shift();ule.copyFrom(this._get("camera")),fe(ule),this.camera=ule,this._processingUpdates=!1,this._processUpdateQueue()}};e$4o([y$2v()],lle.prototype,"mode",void 0),e$4o([y$2v({readOnly:!0,type:PP})],lle.prototype,"animation",null),e$4o([y$2v({type:NR})],lle.prototype,"cssCamera",null),e$4o([y$2v()],lle.prototype,"_cssCamera",void 0),e$4o([y$2v({type:NR})],lle.prototype,"camera",null),e$4o([y$2v()],lle.prototype,"_camera",void 0),e$4o([y$2v({readOnly:!0})],lle.prototype,"pixelRatio",null),e$4o([y$2v()],lle.prototype,"rasterPixelRatio",void 0),e$4o([y$2v()],lle.prototype,"contentPixelRatio",void 0),e$4o([y$2v({readOnly:!0})],lle.prototype,"alignPixelEnabled",null),e$4o([y$2v({readOnly:!0})],lle.prototype,"updating",null),e$4o([y$2v({})],lle.prototype,"_contentCamera",void 0),e$4o([y$2v({type:NR})],lle.prototype,"contentCamera",null),e$4o([y$2v({readOnly:!0})],lle.prototype,"fixedContentCamera",null),e$4o([y$2v({readOnly:!0})],lle.prototype,"constraints",void 0),e$4o([y$2v({readOnly:!0})],lle.prototype,"events",void 0),e$4o([y$2v({readOnly:!0})],lle.prototype,"isGlobal",null),e$4o([y$2v({readOnly:!0})],lle.prototype,"isLocal",null),e$4o([y$2v({readOnly:!0})],lle.prototype,"viewingMode",void 0),e$4o([y$2v({readOnly:!0})],lle.prototype,"spatialReference",void 0),e$4o([y$2v()],lle.prototype,"navigating",null),e$4o([y$2v()],lle.prototype,"stationary",null),e$4o([y$2v()],lle.prototype,"_cameraChanged",void 0),e$4o([y$2v()],lle.prototype,"cameraController",null),lle=e$4o([a$4y("esri.views.3d.state.ViewState")],lle);const cle=lle;const ule=new NR,hle="ViewStateHandles";function o$X(fe){return fe?dle:ple}function r$W(fe,ve){return(null==ve?void 0:ve.mode)?ve.mode:o$X(fe).mode}function u$12(fe,ve){return null!=ve?ve:o$X(fe)}function i$1n(fe,ve){return r$W(null!=fe&&fe.hasZ,ve)}function s$1h(fe,ve){return u$12(null!=fe&&!!fe.hasZ,ve)}function l$1r(fe){const ve=g$H(fe);return i$1n(fe.geometry,ve)}function a$1p(fe){const ve=g$H(fe),_e=i$1n(fe.geometry,ve);return{mode:_e,offset:null!=ve&&"on-the-ground"!==_e?R$n(ve):0,featureExpressionInfo:null==ve?void 0:ve.featureExpressionInfo}}function c$1q(fe){return v$v(fe)||d$X(fe)}function d$X(fe){var ve;return"0"===(null==(ve=null==fe?void 0:fe.featureExpressionInfo)?void 0:ve.expression)}function v$v(fe){if(!fe)return!1;if("on-the-ground"===fe.mode)return!1;const ve=(null==fe?void 0:fe.featureExpressionInfo)?fe.featureExpressionInfo.expression:null;return!(!ve||"0"===ve)}function g$H(fe){return fe.layer&&"elevationInfo"in fe.layer?fe.layer.elevationInfo:null}function h$K(fe,ve){if(!(null==fe?void 0:fe.offset))return 0;const{offset:_e,unit:be}=fe;if("decimal-degrees"===be)return 0;const we="unknown"!==be&&be?be:"meters",Se=ee$g(ve);return Se?j$1K(_e,we,Se):0}function p$1L(fe,ve,_e){if(!(null==_e?void 0:_e.mode))return;const be=fe.hasZ?fe.z:0,we=h$K(_e,fe.spatialReference);switch(_e.mode){case"absolute-height":return be-we;case"on-the-ground":return 0;case"relative-to-ground":return be-((ve.elevationProvider.getElevation(fe.x,fe.y,be,fe.spatialReference,"ground")??0)+we);case"relative-to-scene":return be-((ve.elevationProvider.getElevation(fe.x,fe.y,be,fe.spatialReference,"scene")??0)+we)}}function m$17(fe,ve,_e,be=null){return E$r(fe,ve.x,ve.y,ve.hasZ?ve.z:0,ve.spatialReference,_e,be)}function x$o(fe,ve,_e,be,we=null){return E$r(fe,ve[0],ve[1],ve.length>2?ve[2]:0,_e,be,we)}function E$r(fe,ve,_e,be,we,Se,Te=null){if(null==Se)return;const Ee=null!=Te?Te.mode:"absolute-height";if("on-the-ground"===Ee)return 0;const{absoluteZ:Ce}=b$z(ve,_e,be,we,fe,Se);return function I$m(fe,ve,_e,be,we,Se,Te,Ee){const Ce=h$K(Te,we);switch(Ee){case"absolute-height":return fe-Ce;case"relative-to-ground":return fe-((Se.elevationProvider.getElevation(ve,_e,be,we,"ground")??0)+Ce);case"relative-to-scene":return fe-((Se.elevationProvider.getElevation(ve,_e,be,we,"scene")??0)+Ce)}}(Ce,ve,_e,be,we,fe,Te,Ee)}function b$z(fe,ve,_e,be,we,Se){const Te=h$K(Se,be);switch(Se.mode){case"absolute-height":return{absoluteZ:_e+Te,elevation:0};case"on-the-ground":{const _e=we.elevationProvider.getElevation(fe,ve,0,be,"ground")??0;return{absoluteZ:_e,elevation:_e}}case"relative-to-ground":{const Se=we.elevationProvider.getElevation(fe,ve,_e,be,"ground")??0;return{absoluteZ:_e+Se+Te,elevation:Se}}case"relative-to-scene":{const Se=we.elevationProvider.getElevation(fe,ve,_e,be,"scene")??0;return{absoluteZ:_e+Se+Te,elevation:Se}}}}function y$F(fe,ve){if(null==ve)return!1;const{mode:_e}=ve;return null!=_e&&("scene"===fe&&"relative-to-scene"===_e||"ground"===fe&&"absolute-height"!==_e)}function Z$7(fe,ve,_e){return _e&&_e.mode!==ve?`${fe} only support ${ve} elevation mode`:null}function P$h(fe,ve,_e){return(null==_e?void 0:_e.mode)===ve?`${fe} do not support ${ve} elevation mode`:null}function w$x(fe,ve){return null!=(null==ve?void 0:ve.featureExpressionInfo)&&"0"!==ve.featureExpressionInfo.expression?`${fe} do not support featureExpressionInfo`:null}function $$7(fe,ve){ve&&fe.warn(".elevationInfo=",ve)}function R$n(fe){return((null==fe?void 0:fe.offset)??0)*r$1Y(null==fe?void 0:fe.unit)}const dle={mode:"absolute-height",offset:0},ple={mode:"on-the-ground",offset:null},fle="OBJECTID";let mle=class s60 extends tm{constructor(fe,ve,_e,be){super(ve,_e),this.point=fe,this.createGraphic=be}};function i$1m(fe){return o$3p(fe)&&fe.intersector===Zf.PCL&&!!fe.target}let yle=class o29 extends em{constructor(fe,ve,_e,be,we){super(fe),this.layerUid=fe,this.sublayerUid=ve,this.nodeIndex=_e,this.componentIndex=be,this.triangleNr=we}},gle=class c36 extends tm{constructor(fe,ve,_e){super(ve,null),this.point=fe,this.createVoxelGraphic=_e}},vle=class l22 extends tm{constructor(fe,ve){super(fe,null),this.createTiles3DGraphic=ve}};function a$1o(fe){return o$3p(fe)&&fe.intersector===Zf.I3S&&!!fe.target}function u$11(fe){return o$3p(fe)&&fe.intersector===Zf.VOXEL&&!!fe.target}function p$1K(fe){return o$3p(fe)&&fe.intersector===Zf.TILES3D&&!!fe.target}function f$Q(fe,ve){var _e,be;return s$3G(fe)||i$3Y(fe)?U$i(null==(_e=fe.target)?void 0:_e.object,ve):n$2c(fe)?null==(be=ve.map)?void 0:be.ground:i$1m(fe)||a$1o(fe)||o$1q(fe)||u$11(fe)?U$i(fe.target,ve):null}function m$16(fe,ve){const _e=h$J(fe,ve);return null!=_e&&"graphic"===_e.type?_e.graphic:null}function h$J(fe,ve){var _e;if(null==fe)return null;if(s$3G(fe)||i$3Y(fe))return d$W(null==(_e=fe.target)?void 0:_e.object,ve);if(i$1m(fe)){const ve=fe.target.createGraphic();return{type:"graphic",graphic:ve,layer:ve.layer}}if(u$11(fe)){const ve=fe.target.createVoxelGraphic();return{type:"graphic",graphic:ve,layer:ve.layer}}if(p$1K(fe)){const ve=fe.target.createTiles3DGraphic();return{type:"graphic",graphic:ve,layer:ve.layer}}return o$1q(fe)||i$1v(fe)?d$W(fe.target,ve):a$1o(fe)?function y$E(fe,ve){const _e=U$i(fe,ve);if(null==_e)return null;const be=ve.allLayerViews.find((fe=>fe.layer===_e));return be&&!be.suspended&&"getGraphicFromIntersectorTarget"in be?function b$y(fe){return null!=fe?{type:"graphic",graphic:fe,layer:fe.layer}:null}(be.getGraphicFromIntersectorTarget(fe)):null}(fe.target,ve):null}function d$W(fe,ve){if(null==(null==fe?void 0:fe.graphicUid))return null;const _e=U$i(fe,ve);if(null==_e)return null;if(_e===ve.graphics)return null==ve.graphicsView||"number"!=typeof fe.graphicUid?null:ve.graphicsView.getHit(fe.graphicUid);const be=ve.allLayerViews.find((fe=>fe.layer===_e));return!be||be.suspended||null==fe.graphicUid?null:"getHit"in be?be.getHit(fe.graphicUid):null}function U$i(fe,ve){return null==(null==fe?void 0:fe.layerUid)?null:null!=ve.graphicsView&&fe.layerUid===ve.graphicsView.processor.layer.id?ve.graphics:ve.map.allLayers.find((ve=>ve.uid===fe.layerUid))}function V$h(fe,ve){if(s$3G(fe)||i$3Y(fe))return N$10(fe.target.object.boundingVolumeWorldSpace.bounds);if(i$1v(fe)){O$1l(_le,fe.transformation);const ve=Math.max(_le[0],_le[1],_le[2]);return fe.target.baseBoundingSphere.radius*ve}if(a$1o(fe)){const _e=function j$s(fe,ve){const _e=U$i(fe,ve);if(null==_e)return null;const be=ve.allLayerViews.find((fe=>fe.layer===_e));return be&&!be.suspended&&"getAABBFromIntersectorTarget"in be?be.getAABBFromIntersectorTarget(fe):null}(fe.target,ve);return _e?.5*T$12(_e):null}return null}function w$w(fe){return!s$3G(fe)&&!i$3Y(fe)&&(i$1v(fe)?fe.target.numLodLevels>1:!!a$1o(fe))}const _le=[0,0,0];async function U$h(fe,ve,_e,be){const we=_e?R$m(fe,_e):be,Se=i$4i(ve.x,ve.y);we.requiresGroundFeedback=!0,we.enableDraped=!0;const Te=T$15(fe.state.viewingMode);Te.options.selectionMode=!0,Te.options.store=Xf.ALL,fe.sceneIntersectionHelper.intersectIntersectorScreen(Se,Te,we);const Ee=function b$x(fe,ve,_e){const be=new Array;let we=null;for(let Se=0;Se<ve.length;Se++){const Te=ve[Se],Ee=f$Q(Te,fe);if(null!=Ee&&(Ee===fe.map.ground||"type"in Ee&&m$3d(Ee.type)))break;const Ce=h$J(Te,fe);if(null==Ce)continue;if("graphic"===Ce.type){if(null==we&&Se!==ve.length-1&&(we=new Set),null!=we){const fe=w$v(Ce.graphic);if(we.has(fe))continue;we.add(fe)}if(!S$s(_e,Ce.graphic))continue}const Oe=j$r(fe,Te),Re=Te.distanceInRenderSpace;if("media"===Ce.type){const fe=Ce.element.toSource(Oe);be.push({...Ce,mapPoint:Oe,distance:Re,sourcePoint:fe})}else be.push({...Ce,mapPoint:Oe,distance:Re})}return be}(fe,Te.results.all,we.graphics),Ce=Te.results.ground,Oe=f$Q(Ce,fe),Re=null!=Oe&&"type"in Oe&&m$3d(Oe.type)?Oe:null,De={screenPoint:ve,results:Ee,ground:{mapPoint:j$r(fe,Ce),distance:o$3p(Ce)?Ce.distanceInRenderSpace:0,layer:Re}};return _B.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(De.intersector=Te),De}function j$r(fe,ve,_e){return ve.getIntersectionPoint($le)?(_e=L$i(fe,$le,_e),ve.intersector===Zf.TERRAIN&&fe.basemapTerrain&&(_e.z=a$3U(fe.basemapTerrain,_e)??0),_e):null}function w$v(fe){var ve;const _e=fe.sourceLayer,be=fe.layer,we=_e&&"objectIdField"in _e?_e:be&&"objectIdField"in be?be:_e;if(we){const _e=we.objectIdField??fle,be=null==(ve=fe.attributes)?void 0:ve[_e];if(be)return`o-${we.id}-${be}`}return`u-${fe.uid}`}function S$s(fe,ve){return x$n(fe,w$v(ve))}function x$n(fe,ve){return null==fe||(null==fe.include||fe.include.has(ve))&&(null==fe.exclude||!fe.exclude.has(ve))}function L$i(fe,ve,_e){let be=fe.spatialReference||zo.WGS84;return n$3Y(ve,fe.renderSpatialReference,$le,be)?ve=$le:(be=zo.WGS84,n$3Y(ve,fe.renderSpatialReference,$le,be)&&(ve=$le)),_e?(_e.x=ve[0],_e.y=ve[1],_e.z=ve[2],_e.spatialReference=be):_e=new Yo(ve,be),_e}function R$m(fe,ve){const _e=C$j(fe,ve.include,ble.INCLUDE),be=C$j(fe,ve.exclude,ble.EXCLUDE);return{include:_e.layerUids,exclude:be.layerUids,graphics:{include:_e.graphicUids,exclude:be.graphicUids},mediaElements:{include:_e.mediaElements,exclude:be.mediaElements}}}function C$j(fe,ve,_e,be={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!ve)return be;if(ve instanceof RT)(function D$h(fe,ve){fe.graphicUids||(fe.graphicUids=new Set),fe.graphicUids.add(ve)})(be,w$v(ve)),_e===ble.INCLUDE&&(null!=fe.graphicsView&&ve.layer===fe?v$u(be,fe.graphicsView.processor.layer.id):ve.layer&&v$u(be,ve.layer.uid));else if("layer"in ve&&"element"in ve)(function N$j(fe,ve){fe.mediaElements||(fe.mediaElements=new Set),fe.mediaElements.add(ve)})(be,ve.element),_e===ble.INCLUDE&&v$u(be,ve.layer.uid);else if(t$4x(ve))for(const we of ve)we===fe.graphics&&null!=fe.graphicsView?v$u(be,fe.graphicsView.processor.layer.id):we===fe.map.ground?v$u(be,Ny):C$j(fe,we,_e,be);else"uid"in ve&&v$u(be,ve.uid);return be}function v$u(fe,ve){fe.layerUids||(fe.layerUids=new Set),fe.layerUids.add(ve)}const $le=[0,0,0];var ble;!function(fe){fe[fe.INCLUDE=0]="INCLUDE",fe[fe.EXCLUDE=1]="EXCLUDE"}(ble||(ble={}));let wle=class U6{constructor(fe,ve,_e){this.viewingMode=fe,this._forEachLayer=ve,this._view=_e,this._externalIntersectionHandlers=new jr,this._tolerance=By,this._tmpRay=m$3f(),this._tmpRegion=u$3J(),this._validateHUDIntersector=T$15(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(fe,ve,_e){return this.intersectRay(this._getPickRay(fe,this._tmpRay),T$j(this.viewingMode),ve,_e)}intersectScreenFreePointFallback(fe,ve,_e){return this.intersectRayFreePointFallback(this._getPickRay(fe,this._tmpRay),ve,_e)}intersectRayFreePointFallback(fe,ve,_e){return this.intersectRay(fe,T$j(this.viewingMode),ve,_e)||this._intersectRayFreePointLocal(fe,ve)}intersectRay(fe,ve,_e,be){return ve.options.selectionMode=!1,ve.options.store=Xf.MIN,this.computeIntersection(fe,ve,be),!!ve.results.min&&ve.results.min.getIntersectionPoint(_e)}getCenterRayWithSubpixelOffset(fe,ve,_e=.5,be=.5){return fe.getRenderCenter(Ale,_e,be),Ale[0]+=.0466,Ale[1]-=.0123,f$1U(fe,Ale,ve)}intersectIntersectorScreen(fe,ve,_e){this.computeIntersection(this._getPickRay(fe,this._tmpRay),ve,_e)}intersectToolIntersectorScreen(fe,ve,_e){const be=this._getPickRay(fe,this._tmpRay);this.intersectToolIntersectorRay(be,ve,_e)}intersectToolIntersectorRay(fe,ve,_e){ve.options.selectionMode=!0,this.computeIntersection(fe,ve,_e);const be=ve.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||o$3p(be)&&be.intersector!==Zf.TERRAIN||(ve.options.selectionMode=!1,this.computeIntersection(fe,ve,_e))}setTolerance(fe=By){this._tolerance=fe}addIntersectionHandler(fe){this._externalIntersectionHandlers.push(fe),this._externalIntersectionHandlers.sort(((fe,ve)=>fe.type===Zf.TERRAIN?1:ve.type===Zf.TERRAIN?-1:0))}removeIntersectionHandler(fe){null!=this._externalIntersectionHandlers.removeUnordered(fe)&&this._externalIntersectionHandlers.sort(((fe,ve)=>fe.type===Zf.TERRAIN?1:ve.type===Zf.TERRAIN?-1:0))}_getPickRay(fe,ve){return g$1o(this._view.state.camera,fe,ve)}_intersectRayFreePointLocal(fe,ve){return this.viewingMode!==Wf.Local||null==fe||u$3Y(ve,fe.origin,z$1d(Pd.get(),fe.direction)),!1}intersectElevationFromScreen(fe,ve,_e=0,be=null){return this._intersectElevation(this._getPickRay(fe,this._tmpRay),ve,_e,be)}_intersectElevation(fe,ve,_e=0,be=null){if(null==fe)return null;const we=this._view,{renderCoordsHelper:Se}=we,Te=L$1d(we.spatialReference),Ee=null!=ve?ve.mode:"absolute-height",Ce=R$n(ve)/Te,Oe=("on-the-ground"!==Ee?Ce+_e:0)*Te/Se.unitInMeters,{camera:Re}=we.state;if("absolute-height"===Ee){const ve=null==Se?void 0:Se.getAltitude(Re.eye),_e=P$1g(z$1d(Cle,fe.direction),Se.worldUpAtPosition(Re.eye,Ole));if(ve<Oe&&_e<0||ve>=Oe&&_e>0)return null;if(Se.intersectInfiniteManifold(fe,Oe,Cle)){const fe=L$i(we,Cle);return fe.z??(fe.z=0),fe.z-=Ce,fe}return null}const De=Pd.get();Re.projectToRenderScreen(fe.origin,De);const Be=new Ple(null,this._forEachLayer),{slicePlane:Ze}=we,Xe=null!=Ze?c$48(Ze):null,Je=T$15(this.viewingMode);Je.options.store=Xf.MIN,Je.options.verticalOffset=Oe,Je.options.normalRequired=!1;const Qe=fe.origin,dt=u$3Y(Pd.get(),Qe,fe.direction);Je.reset(Qe,dt,Re),Je.point=De;const $t=be?"type"in be&&"graphics"===be.type?fe=>fe.layerUid!==be.uid:fe=>fe.graphicUid!==be.uid:null;switch(Ee){case"relative-to-scene":{const e77=fe=>(!$t||$t(fe))&&!!fe.lastValidElevationBB;Je.intersect(Be.layers,De,this._tolerance,null,e77),this._externalIntersectionHandlers.forAll((fe=>{if(fe.type===Zf.I3S||fe.type===Zf.TERRAIN||fe.type===Zf.TILES3D){const ve=fe.slicePlaneEnabled?Xe:null;fe.intersect(Je,ve,Je.rayBegin,Je.rayEnd,De)}}));break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll((fe=>{if(fe.isGround){const ve=fe.slicePlaneEnabled?Xe:null;fe.intersect(Je,ve,Je.rayBegin,Je.rayEnd,De)}}))}if(Je.results.min.getIntersectionPoint(Cle)){const fe=L$i(we,Cle);return fe.z=_e,fe}return null}computeIntersection(fe,ve,_e,be){var we;if(null==fe)return;const Se=this._view.state.camera,Te=Pd.get();Se.projectToRenderScreen(fe.origin,Te);const Ee=new Ple(_e,this._forEachLayer);ve.options.selectOpaqueTerrainOnly=!_e||!("include"in _e||"exclude"in _e);const Ce=fe.origin,Oe=u$3Y(Pd.get(),fe.origin,fe.direction);ve.reset(Ce,Oe,Se),ve.intersect(Ee.layers,Te,this._tolerance);const Re=this._view.slicePlane,De=null!=Re?c$48(Re):null;ve.intersect(Ee.sliceableLayers,Te,this._tolerance,De);const Be=_e&&(_e.requiresGroundFeedback||_e.enableDraped);this._externalIntersectionHandlers.forAll((fe=>{const _e=fe.layerUid,we=Array.isArray(_e),Se=we?_e:[_e];we&&(ve.options.filteredLayerUids=[]);let Re=!1;for(const be of Se)Ee.filterLayerUid(be)?Re=!0:we&&ve.options.filteredLayerUids.push(be);if(ve.options.isFiltered=!Re,fe.isGround&&Be||!ve.options.isFiltered){const _e=fe.slicePlaneEnabled?De:null;fe.intersect(ve,_e,Ce,Oe,Te,be)}}));const Ze=Pd.get(),Xe=this._view.basemapTerrain;if(_e&&_e.enableDraped&&null!=Xe.spatialReference&&ve.results.ground.getIntersectionPoint(Ze)){const fe=Xe.overlayManager.renderer,_e=this._view.renderCoordsHelper.spatialReference,be=Pd.get();this._view.renderCoordsHelper.fromRenderCoords(Ze,be,Xe.spatialReference),be[2]=(null==(we=this._view.elevationProvider)?void 0:we.getElevation(Ze[0],Ze[1],Ze[2],_e,"ground"))??0,fe.intersect(ve,be,ve.results.ground,(fe=>Ee.filterRenderGeometry(fe)))}ve.sortResults(),this._processHUDResults(ve)}_processHUDResults(fe){const ve=fe.results.hud;e$3R(this._tmpRegion,ma);const _e=this._view.state.camera,be=[],we=this._tmpRegion,s84=fe=>{const ve=new Ele(fe);_e.projectToRenderScreen(fe.target.center,ve.screenPoint),ve.screenPoint[0]=Math.floor(ve.screenPoint[0]),ve.screenPoint[1]=Math.floor(ve.screenPoint[1]),be.push(ve),f$31(we,ve.screenPoint)};fe.sortResults(ve.all),null!=ve.min.dist&&s84(ve.min);for(const Je of ve.all)ve.min.target.object!==Je.target.object&&ve.max.target.object!==Je.target.object&&s84(Je);if(null!=ve.max.dist&&ve.max.target.object!==ve.min.target.object&&s84(ve.max),!be.length)return;we[0]===we[2]&&(we[2]+=1),we[1]===we[3]&&(we[3]+=1);const Se=_e.fullWidth,Te=_e.fullHeight,Ee=Math.max(0,we[0]-xle),Ce=Math.max(0,we[1]-xle),Oe=Math.min(M$1o(we)+2*xle,Se-Ee),Re=Math.min(s$41(we)+2*xle,Te-Ce);if(Oe<=0||Re<=0)return;const De=new Uint8Array(Oe*Re*4);this._view._stage.renderer.readHUDVisibility(Ee,Ce,Oe,Re,De);let Be=!0;const Ze=null==fe.results.max.dist;let Xe=0;for(const Je of be)for(const ve of Sle){const _e=4*(Math.min(Je.screenPoint[0]+ve[0],Se)-we[0]+(Math.min(Je.screenPoint[1]+ve[1],Te)-we[1])*Oe);if(!(_e<0||_e>=De.length)&&De[_e]){Be&&(fe.results.min.copy(Je.result),Be=!1),Ze&&fe.results.max.copy(Je.result),fe.options.store===Xf.ALL&&fe.results.all.splice(Xe++,0,Je.result);break}}}};const xle=1,Sle=(()=>{const fe=[],ve=xle;for(let _e=-ve;_e<=ve;_e++)for(let be=-ve;be<=ve;be++)fe.push([be+ve,_e+ve]);return fe})();let Tle,Ele=class H4{constructor(fe){this.result=fe,this.screenPoint=x$1H()}};function T$j(fe){return Tle&&Tle.viewingMode===fe||(Tle=T$15(fe)),Tle}let Ple=class A12{constructor(fe,ve){this.layers=new Array,this.sliceableLayers=new Array,this.include=null==fe?void 0:fe.include,this.exclude=null==fe?void 0:fe.exclude,ve((fe=>{fe.pickable&&this.filterLayerUid(fe.apiLayerUid)&&(fe.sliceable?this.sliceableLayers:this.layers).push(fe)}))}filterLayerUid(fe){const{include:ve,exclude:_e}=this;return null==fe?null==ve&&null==_e:(null==ve||ve.has(fe))&&(null==_e||!_e.has(fe))}filterRenderGeometry(fe){return this.filterLayerUid(fe.layerUid)}};function k$g(fe){return"object"==typeof fe&&"intersect"in fe}const Cle=[0,0,0],Ole=[0,0,0],Ale=x$1H();let Mle=class l23{constructor(fe,ve){this.spatialReference=fe,this._view=ve}getElevation(fe,ve,_e){return this._view.elevationProvider.getElevation(fe,ve,0,this.spatialReference,_e)}async queryElevation(fe,ve,_e,be,we){return this._view.elevationProvider.queryElevation(fe,ve,0,this.spatialReference,we,_e,be)}},Rle=class a32{constructor(fe,ve,_e,be){this.spatialReference=ve,this._getElevationQueryProvider=_e,this._queries=new Array,this._queryOptions={...be,ignoreInvisibleLayers:!0},this._frameTask=fe.registerTask(gI.ELEVATION_QUERY,this)}destroy({completeTasks:fe}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(fe)this.runTask(wI);else for(const ve of this._queries)ve.result.reject(u$47())}queryElevation(fe,ve,_e,be=0){const we=L$1h(),Se={x:fe,y:ve,minDemResolution:be,result:we,signal:_e};return this._queries.push(Se),m$3R(_e,(()=>{L$1i(this._queries,Se),we.reject(u$47())})),we.promise}get running(){return this._queries.length>0}runTask(fe){const ve=this._queries;this._queries=[];const _e=this._getElevationQueryProvider();if(!_e)return ve.forEach((fe=>fe.result.reject())),void fe.madeProgress();const be=ve.map((fe=>[fe.x,fe.y])),we=ve.reduce(((fe,ve)=>Math.min(fe,ve.minDemResolution)),1/0),Se=new ua({points:be,spatialReference:this.spatialReference}),Te=ve.length>1&&ve.some((fe=>!!fe.signal))?new AbortController:null,Ee=null!=Te?Te.signal:ve[0].signal;if(null!=Te){let fe=0;ve.forEach((_e=>m$3R(_e.signal,(()=>{fe++,_e.result.reject(u$47()),fe===ve.length&&Te.abort()}))))}const Ce={...this._queryOptions,minDemResolution:we,signal:Ee};_e.queryElevation(Se,Ce).then((fe=>{ve.forEach(((ve,_e)=>{null!=ve.signal&&ve.signal.aborted?ve.result.reject(u$47()):ve.result.resolve(fe.geometry.points[_e][2])}))})).catch((fe=>{ve.forEach((ve=>ve.result.reject(fe)))})),fe.madeProgress()}get test(){}},Ile=class e48{constructor(fe=1/0,ve=-1/0){this.elevationRangeMin=fe,this.elevationRangeMax=ve}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(fe,ve){this.elevationRangeMin=Math.min(this.elevationRangeMin,fe),this.elevationRangeMax=Math.max(this.elevationRangeMax,ve)}expandElevationRange(fe){this.elevationRangeMin=Math.min(this.elevationRangeMin,fe.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,fe.elevationRangeMax)}setElevationRange(fe){this.elevationRangeMin=fe.elevationRangeMin,this.elevationRangeMax=fe.elevationRangeMax}},Lle=class h22 extends(La.EventedMixin(zi)){get spatialReference(){var fe,ve;return null==(ve=null==(fe=this.view)?void 0:fe.basemapTerrain)?void 0:ve.spatialReference}constructor(fe){super(fe),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=u$4d(this._cachedQuery)}enableCache(fe){fe||(this.lastElevationQuery=null),this._cacheEnabled=fe}getElevation(fe,ve,_e,be,we){if(this._cacheEnabled&&null!=this.lastElevationQuery){const Se=this.lastElevationQuery;if(fe===Se.x&&ve===Se.y&&_e===Se.z&&G$Y(be,Se.spatialReference)&&we===Se.queryContext)return Se.result}let Se=null;return Se=p$1J(Se,this._im,fe,ve,_e,be,we),null==Se&&(Se=p$1J(Se,this._ground,fe,ve,_e,be,we)),"scene"===we&&(Se=p$1J(Se,this._scene,fe,ve,_e,be,we)),this._cacheEnabled&&(this.lastElevationQuery={x:fe,y:ve,z:_e,spatialReference:be,queryContext:we,result:Se}),Se}getSphereElevationBounds(fe,ve,_e){const be=new Ile;function n52(we){for(const Se of we)if(Se.getSphereElevationBounds){const we=Se.getSphereElevationBounds(fe,ve,_e);null!=we&&be.expandElevationRangeValues(we.elevationRangeMin,we.elevationRangeMax)}}return n52(this._ground),n52(this._im),"scene"===_e&&n52(this._scene),be}getRootElevationBounds(){const fe=new Ile;for(const ve of[this._im,this._ground,this._scene])ve.forEach((ve=>{if(ve.getRootElevationBounds){const _e=ve.getRootElevationBounds();null!=_e&&fe.expandElevationRangeValues(_e.elevationRangeMin,_e.elevationRangeMax)}}));return fe}async queryElevation(fe,ve,_e,be,we,Se=null,Te=0){const Ee=this._getElevationQuery(be);try{const Ce=await Ee.queryElevation(fe,ve,Se,Te);return"scene"===we?p$1J(Ce,this._scene,fe,ve,_e,be,we):Ce}catch(jR){return a$4D(jR),this.getElevation(fe,ve,_e,be,we)}}register(fe,ve){this.addHandles(ve.on("elevation-change",(fe=>this.emit("elevation-change",fe))),ve),this._providersFromContext(fe).push(ve)}unregister(fe){this.removeHandles(fe);for(const ve of[this._im,this._ground,this._scene]){const _e=ve.indexOf(fe);_e>-1&&ve.splice(_e,1)}}_providersFromContext(fe){switch(fe){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(fe=this.view.spatialReference){const ve=this._cachedQuery;if(null!=ve&&G$Y(fe,ve.spatialReference))return ve;null==ve||ve.destroy({completeTasks:!0});const{wkid:_e,wkt:be,wkt2:we,latestWkid:Se}=fe,Te=new Rle(this.view.resourceController.scheduler,new zo({wkid:_e,wkt:be,wkt2:we,latestWkid:Se}),(()=>{var fe;return null==(fe=this.view.map)?void 0:fe.ground}),{maximumAutoTileRequests:4});return this._cachedQuery=Te,Te}};function p$1J(fe,ve,_e,be,we,Se,Te){for(const Ee of ve){const ve=Ee.getElevation(_e,be,we,Se,Te);null!=ve&&(fe=null!=fe?Math.max(ve,fe):ve)}return fe}e$4o([y$2v({constructOnly:!0})],Lle.prototype,"view",void 0),e$4o([y$2v()],Lle.prototype,"spatialReference",null),Lle=e$4o([a$4y("esri.views.3d.support.CombinedElevationProvider")],Lle);let Dle=class a33{static isValidProfile(fe){return fe in a33.profiles}static getDefaultProfile(){return has("esri-iPhone")?"low":"medium"}static apply(fe,ve){const _e=a33.profiles[fe];ve.graphics3D.maxTotalNumberOfFeatures=_e.graphics3D.maxTotalNumberOfFeatures,ve.graphics3D.maxNumberOfDrawCalls=_e.graphics3D.maxNumberOfDrawCalls,ve.graphics3D.maxTotalNumberOfVertices=_e.graphics3D.maxTotalNumberOfVertices,ve.graphics3D.polygonLodFactor=_e.graphics3D.polygonLodFactor,ve.graphics3D.polylineLodFactor=_e.graphics3D.polylineLodFactor,ve.graphics3D.snapshotAvailable=_e.graphics3D.snapshotAvailable,ve.graphics3D.skipHighSymbolLods=_e.graphics3D.skipHighSymbolLods,ve.graphics3D.uncompressedTextureDownsamplingEnabled=_e.graphics3D.uncompressedTextureDownsamplingEnabled;const be=ve.sceneService.object,we=_e.sceneService.object;be.lodFactor=we.lodFactor,ve.sceneService.point.lodFactor=_e.sceneService.point.lodFactor,ve.sceneService.integratedMesh.lodFactor=_e.sceneService.integratedMesh.lodFactor,ve.sceneService.pointCloud.lodFactor=_e.sceneService.pointCloud.lodFactor,ve.sceneService.uncompressedTextureDownsamplingEnabled=_e.sceneService.uncompressedTextureDownsamplingEnabled,ve.tiledSurface.lodBias=_e.tiledSurface.lodBias,ve.tiledSurface.angledSplitBias=_e.tiledSurface.angledSplitBias,ve.tiledSurface.vtlContentZoom=_e.tiledSurface.vtlContentZoom,ve.tiledSurface.elevationLevelDelta=_e.tiledSurface.elevationLevelDelta,ve.tiledSurface.reduceTileLevelDifferences=_e.tiledSurface.reduceTileLevelDifferences,ve.heatmap.pixelRatio=_e.heatmap.pixelRatio,ve.heatmap.maxTotalNumberOfFeatures=_e.heatmap.maxTotalNumberOfFeatures,ve.fadeDuration=_e.fadeDuration,ve.antialiasingEnabled=_e.antialiasingEnabled,ve.physicallyBasedRenderingEnabled=_e.physicalBasedRenderingEnabled,ve.highQualityTransparency=_e.highQualityTransparency,ve.highResolutionAtmosphere=_e.highResolutionAtmosphere,ve.reflections=_e.reflections,ve.ambientOcclusion=_e.ambientOcclusion,ve.memoryLimit=_e.memoryLimit,ve.additionalCacheMemory=_e.additionalCacheMemory,ve.frameRate=_e.frameRate,ve.maximumPixelRatio=_e.maximumPixelRatio}};Dle.test={reset(){const fe=o$U();for(const ve of Object.keys(fe))Dle.profiles[ve]=fe[ve]}};const Nle={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function o$U(){const fe=!!has("esri-mobile"),ve=!!has("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+Nle.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:fe?.8:1,polylineLodFactor:fe?1.2:1.5,snapshotAvailable:!ve,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:fe},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:fe},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!has("disable-feature:reduce-map-tile-levels")},fadeDuration:400,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:fe?600+Nle.GalaxyS20:750+Nle.FullHD,additionalCacheMemory:fe?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:fe?1.2:2,polylineLodFactor:fe?1.2:2,snapshotAvailable:!ve,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!has("disable-feature:reduce-map-tile-levels")},fadeDuration:400,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:fe?900+Nle.SurfacePro7:1500+Nle.FullHDRetina,additionalCacheMemory:fe?-150:0,frameRate:0,maximumPixelRatio:fe?1:1/0}}}(Dle||(Dle={})).profiles=o$U();const Fle=Dle,zle=new b_([0,255,255]),kle=new b_([0,0,0]);let Ule=class d20 extends zi{constructor(){super(...arguments),this.color=zle.clone(),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=kle.clone(),this.shadowDifference=.2}};e$4o([y$2v({type:b_})],Ule.prototype,"color",void 0),e$4o([y$2v({type:b_})],Ule.prototype,"haloColor",void 0),e$4o([y$2v()],Ule.prototype,"haloOpacity",void 0),e$4o([y$2v()],Ule.prototype,"fillOpacity",void 0),e$4o([y$2v()],Ule.prototype,"shadowOpacity",void 0),e$4o([y$2v({type:b_})],Ule.prototype,"shadowColor",void 0),e$4o([y$2v()],Ule.prototype,"shadowDifference",void 0),Ule=e$4o([a$4y("esri.views.3d.support.HighlightOptions")],Ule);const Vle=Ule;function i$1k(fe,ve){return ve?{...ve,query:{...fe??{},...ve.query}}:{query:fe}}function f$P(fe){return"string"==typeof fe?I$1E(fe):a$4H(fe)}function s$1f(fe,ve,_e){const be={};for(const we in fe){if("declaredClass"===we)continue;const ve=fe[we];if(null!=ve&&"function"!=typeof ve)if(Array.isArray(ve))be[we]=ve.map((fe=>s$1f(fe)));else if("object"==typeof ve)if(ve.toJSON){const fe=ve.toJSON(null==_e?void 0:_e[we]);be[we]=JSON.stringify(fe)}else be[we]=JSON.stringify(ve);else be[we]=ve}return be}function r$U(fe){return{geometryType:p$4N(fe[0]),geometries:fe.map((fe=>fe.toJSON()))}}function o$T(fe,ve,_e){const be=function G$T(fe){return fe&&Ca[fe]||null}(ve);return fe.map((fe=>{const ve=be.fromJSON(fe);return ve.spatialReference=_e,ve}))}let Ble=class a34 extends Pn{constructor(fe){super(fe),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const fe=this.geometries.map((fe=>fe.toJSON())),ve=this.geometries[0],_e={};return _e.outSR=d$3n(this.outSpatialReference),_e.inSR=d$3n(ve.spatialReference),_e.geometries=JSON.stringify({geometryType:p$4N(ve),geometries:fe}),this.transformation&&(_e.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(_e.transformForward=this.transformForward),_e}};e$4o([y$2v()],Ble.prototype,"geometries",void 0),e$4o([y$2v({json:{read:{source:"outSR"}}})],Ble.prototype,"outSpatialReference",void 0),e$4o([y$2v()],Ble.prototype,"transformation",void 0),e$4o([y$2v()],Ble.prototype,"transformForward",void 0),Ble=e$4o([a$4y("esri.rest.support.ProjectParameters")],Ble);const jle=Ble,Gle=b$2d(jle);async function n$1u(fe,ve,_e){ve=Gle(ve);const be=f$P(fe),we={...be.query,f:"json",...ve.toJSON()},Se=ve.outSpatialReference,Te=p$4N(ve.geometries[0]),Ee=i$1k(we,_e);return U$1a(be.path+"/project",Ee).then((({data:{geometries:fe}})=>o$T(fe,Te,Se)))}async function n$1t(fe=null,ve){var _e,be;if(ir.geometryServiceUrl)return ir.geometryServiceUrl;if(!fe)throw new Ir("internal:geometry-service-url-not-configured");let we;we="portal"in fe?fe.portal||Gv.getDefault():fe,await we.load({signal:ve});const Se=null==(be=null==(_e=we.helperServices)?void 0:_e.geometry)?void 0:be.url;if(!Se)throw new Ir("internal:geometry-service-url-not-configured");return Se}async function a$1k(fe,ve,_e=null,be){const we=await n$1t(_e,be),Se=new jle({geometries:[fe],outSpatialReference:ve}),Te=await n$1u(we,Se,{signal:be});if(Te&&Array.isArray(Te)&&1===Te.length)return Te[0];throw new Ir("internal:geometry-service-projection-failed")}const Hle=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:n$1t,projectGeometry:a$1k},Symbol.toStringTag,{value:"Module"}));let qle=class a35{constructor(fe,ve){this.spatialReference=ve,this.unitInMeters=W$L(this.spatialReference,s$45(this.spatialReference).metersPerDegree);const _e=fe&&"portalItem"in fe?fe.portalItem:void 0;this._geometryServiceURLPromise=n$1t(_e).catch((()=>{throw new Ir("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")}))}async toGeographic(fe){const ve=await this._geometryServiceURLPromise;let _e,be=!0;Array.isArray(fe[0])&&"number"!=typeof fe[0]?_e=fe:(_e=[fe],be=!1);const we=_e.map((fe=>fe instanceof Yo?fe:new Yo(fe,this.spatialReference))),Se=new jle({geometries:we,outSpatialReference:zo.WGS84}),Te=(await n$1u(ve,Se)).map((fe=>"point"===fe.type?[fe.x,fe.y]:void 0)).filter((fe=>!!fe));return be?Te:Te[0]}};var Wle;!function(fe){fe[fe.ELEVATION=0]="ELEVATION",fe[fe.MAP=1]="MAP"}(Wle||(Wle={}));const Yle=[Wle.ELEVATION,Wle.MAP];const Zle=.05;async function t$1j(fe,ve){var _e,be,we,Se,Te;const{results:Ee,ground:Ce}=await async function t$1k(fe,ve){if("2d"===fe.type)return fe.hitTest(ve);const _e=await fe.hitTest(ve);if(0===_e.results.length)return _e;const be=_e.results[0],we=(be.distance??0)*(1+Zle),Se=_e.results.findIndex((fe=>(fe.distance??0)>we));return-1!==Se&&(_e.results=_e.results.slice(0,Se)),be&&_e.ground.distance>we&&(_e.ground.mapPoint=null),_e}(fe,ve),Oe=(!Ce.layer||!m$3d(Ce.layer.type))&&Ce.mapPoint,Re=[],De=function i$1i(fe){const ve=new Map;for(const _e of fe.allLayerViews){const fe=_e.layer.uid;ve.set(fe,_e)}return ve}(fe),Be=Oe?function s$1e(fe,ve){const _e=new Set,be=[];for(let Se=fe.basemapTerrain.numLayers(Wle.MAP)-1;Se>=0;Se--){const ve=fe.basemapTerrain.layerViewByIndex(Se,Wle.MAP);_e.add(ve.layer.uid),be.push(ve)}const we=fe.basemapTerrain.overlayManager.renderer.layers;for(const{uid:Se}of we){const fe=ve.get(Se);fe&&(_e.add(Se),be.push(fe))}return be.reverse(),{layerUids:_e,layerViews:be}}(fe,De):Xle;let Ze=0,Xe=0;const m39=()=>{const fe=Be.layerViews[Xe];Oe&&fe&&"fetchPopupFeaturesAtLocation"in fe&&Re.push({mapPoint:Ce.mapPoint,layerView:fe}),++Xe};let Je=null;for(;Ze<Ee.length||Xe<Be.layerViews.length;){const ve=Ee[Ze];if(ve&&"graphic"!==ve.type)++Ze;else if("scene"!==(null==(_e=null==ve?void 0:ve.layer)?void 0:_e.type)||(null==(be=null==ve?void 0:ve.layer)?void 0:be.parent)!==(null==(we=null==fe?void 0:fe.map)?void 0:we.basemap))if(ve){const fe=null==(Se=ve.layer)?void 0:Se.uid,_e=Be.layerUids.has(fe)&&ve.distance===Ce.distance,be=De.get(null==(Te=ve.layer)?void 0:Te.uid);if(Je??(Je=ve.mapPoint),Xe<Be.layerViews.length&&(_e||(ve.distance??0)>Ce.distance)&&Be.layerViews[Xe]!==be){m39();continue}Re.push({graphic:ve.graphic,layerView:be}),++Ze}else m39();else++Ze}return Je??(Je=Ce.mapPoint),{hits:Re,location:Je}}const Xle={layerUids:new Set,layerViews:[]};let Jle=class r46 extends zi{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};e$4o([y$2v()],Jle.prototype,"minTotalNumberOfFeatures",void 0),e$4o([y$2v()],Jle.prototype,"maxTotalNumberOfFeatures",void 0),e$4o([y$2v()],Jle.prototype,"maxNumberOfDrawCalls",void 0),e$4o([y$2v()],Jle.prototype,"maxTotalNumberOfVertices",void 0),e$4o([y$2v()],Jle.prototype,"snapshotAvailable",void 0),e$4o([y$2v()],Jle.prototype,"polygonLodFactor",void 0),e$4o([y$2v()],Jle.prototype,"polylineLodFactor",void 0),e$4o([y$2v()],Jle.prototype,"skipHighSymbolLods",void 0),e$4o([y$2v()],Jle.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Jle=e$4o([a$4y("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Jle);let Qle=class p31 extends zi{constructor(){super(...arguments),this.lodFactor=1}};e$4o([y$2v()],Qle.prototype,"lodFactor",void 0),Qle=e$4o([a$4y("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Qle);let Kle=class a36 extends zi{constructor(){super(...arguments),this.object=new Qle,this.point=new Qle,this.integratedMesh=new Qle,this.pointCloud=new Qle,this.uncompressedTextureDownsamplingEnabled=!1}};e$4o([y$2v({type:Qle})],Kle.prototype,"object",void 0),e$4o([y$2v({type:Qle})],Kle.prototype,"point",void 0),e$4o([y$2v({type:Qle})],Kle.prototype,"integratedMesh",void 0),e$4o([y$2v({type:Qle})],Kle.prototype,"pointCloud",void 0),e$4o([y$2v()],Kle.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Kle=e$4o([a$4y("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Kle);let ece=class n33 extends zi{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};e$4o([y$2v()],ece.prototype,"lodBias",void 0),e$4o([y$2v()],ece.prototype,"angledSplitBias",void 0),e$4o([y$2v()],ece.prototype,"vtlContentZoom",void 0),e$4o([y$2v()],ece.prototype,"elevationLevelDelta",void 0),e$4o([y$2v()],ece.prototype,"reduceTileLevelDifferences",void 0),ece=e$4o([a$4y("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],ece);let tce=class l24 extends zi{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};e$4o([y$2v()],tce.prototype,"pixelRatio",void 0),e$4o([y$2v()],tce.prototype,"maxTotalNumberOfFeatures",void 0),tce=e$4o([a$4y("esri.views.3d.support.QualitySettings.HeatmapSettings")],tce);let rce=class d21 extends zi{constructor(){super(...arguments),this.graphics3D=new Jle,this.sceneService=new Kle,this.tiledSurface=new ece,this.heatmap=new tce,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};e$4o([y$2v({type:Jle})],rce.prototype,"graphics3D",void 0),e$4o([y$2v({type:Kle})],rce.prototype,"sceneService",void 0),e$4o([y$2v({type:ece})],rce.prototype,"tiledSurface",void 0),e$4o([y$2v({type:tce})],rce.prototype,"heatmap",void 0),e$4o([y$2v()],rce.prototype,"fadeDuration",void 0),e$4o([y$2v()],rce.prototype,"antialiasingEnabled",void 0),e$4o([y$2v()],rce.prototype,"physicallyBasedRenderingEnabled",void 0),e$4o([y$2v()],rce.prototype,"highQualityTransparency",void 0),e$4o([y$2v()],rce.prototype,"highResolutionAtmosphere",void 0),e$4o([y$2v()],rce.prototype,"reflections",void 0),e$4o([y$2v()],rce.prototype,"ambientOcclusion",void 0),e$4o([y$2v()],rce.prototype,"memoryLimit",void 0),e$4o([y$2v()],rce.prototype,"additionalCacheMemory",void 0),e$4o([y$2v()],rce.prototype,"frameRate",void 0),e$4o([y$2v()],rce.prototype,"maximumPixelRatio",void 0),rce=e$4o([a$4y("esri.views.3d.support.QualitySettings")],rce);const ice=rce;let nce=class v11{constructor(fe,ve,_e,be){this.viewingMode=fe,this.spatialReference=ve,this.unitInMeters=_e,this._coordinateSystem=be,this._tmpCoordinateSystem=function h$2w(fe){const{value:ve,operations:_e}=fe;return{operations:_e,value:_e.create(ve)}}(be),this.referenceEllipsoid=s$45(ve),this.sphericalPCPF=a$40(ve)}set extent(fe){fe&&function j$1u(fe,ve,_e){return fe.operations.setExtent(fe.value,ve,_e.value),_e}(this._coordinateSystem,fe,this._coordinateSystem)}getAltitude(fe){return function U$10(fe,ve){return fe.operations.altitudeAt(fe.value,ve)}(this._coordinateSystem,fe)}setAltitude(fe,ve,_e=fe){return G$L(this._coordinateSystem,_e,ve,fe)}setAltitudeOfTransformation(fe,ve){!function O$1h(fe,ve,_e,be){return ve!==be&&n$48(be,ve),o$44(Ip,be[12],be[13],be[14]),G$L(fe,Ip,_e,Ip),be[12]=Ip[0],be[13]=Ip[1],be[14]=Ip[2],be}(this._coordinateSystem,ve,fe,ve)}worldUpAtPosition(fe,ve){return function R$19(fe,ve,_e){return fe.operations.axisAt(fe.value,ve,ha.Z,_e)}(this._coordinateSystem,fe,ve)}worldBasisAtPosition(fe,ve,_e){return function S$1C(fe,ve,_e,be){return fe.operations.axisAt(fe.value,ve,_e,be)}(this._coordinateSystem,fe,ve,_e)}basisMatrixAtPosition(fe,ve){const _e=this.worldBasisAtPosition(fe,ha.X,Pd.get()),be=this.worldBasisAtPosition(fe,ha.Y,Pd.get()),we=this.worldBasisAtPosition(fe,ha.Z,Pd.get());return r$3a(ve,_e[0],_e[1],_e[2],0,be[0],be[1],be[2],0,we[0],we[1],we[2],0,0,0,0,1),ve}headingAtPosition(fe,ve){const _e=this.worldUpAtPosition(fe,Pd.get());return M$1x(m$3h(ve,this.worldBasisAtPosition(fe,ha.Y,Pd.get()),_e))}intersectManifoldClosestSilhouette(fe,ve,_e){return T$1c(this._coordinateSystem,ve,this._tmpCoordinateSystem),function y$1$(fe,ve,_e){return fe.operations.intersectRayClosestSilhouette(fe.value,ve,_e)}(this._tmpCoordinateSystem,fe,_e),_e}intersectManifold(fe,ve,_e){T$1c(this._coordinateSystem,ve,this._tmpCoordinateSystem);const be=Pd.get();return function g$29(fe,ve,_e){return fe.operations.intersectRay(fe.value,ve,_e)}(this._tmpCoordinateSystem,fe,be)?r$3w(_e,be):null}intersectInfiniteManifold(fe,ve,_e){if(this.viewingMode===Wf.Global)return this.intersectManifold(fe,ve,_e);T$1c(this._coordinateSystem,ve,this._tmpCoordinateSystem);const be=this._tmpCoordinateSystem.value,we=Pd.get();return S$1E(be.plane,fe,we)?r$3w(_e,we):null}toRenderCoords(fe,ve,_e){return t$3z(fe)?c$4l(fe,ve,this.spatialReference):n$3Y(fe,ve,_e,this.spatialReference)}fromRenderCoords(fe,ve,_e=null){return t$3z(ve)?(null!=_e&&(ve.spatialReference=_e),t$3D(fe,this.spatialReference,ve)?ve:null):n$3Y(fe,this.spatialReference,ve,_e)?ve:null}static create(fe,ve){switch(fe){case Wf.Local:return new v11(Wf.Local,ve,W$L(ve),function P$16(){return x$1y(mp,H$$([0,0,0],[Rp,0,0],[0,Rp,0]))}());case Wf.Global:return new v11(Wf.Global,ve,1,function A$1r(fe){return x$1y(Mp,Z$z(0,0,0,s$45(fe).radius))}(ve))}}static renderUnitScaleFactor(fe,ve){return z$1a(fe)/z$1a(ve)}};var sce;!function(fe){fe[fe.ELEVATION=0]="ELEVATION",fe[fe.BASEMAP=1]="BASEMAP",fe[fe.I3S_INDEX=2]="I3S_INDEX",fe[fe.I3S_DATA=3]="I3S_DATA",fe[fe.SYMBOLOGY=4]="SYMBOLOGY"}(sce||(sce={}));const oce=(()=>{const fe=new Array;return fe[sce.ELEVATION]=10,fe[sce.BASEMAP]=10,fe[sce.I3S_INDEX]=10,fe[sce.I3S_DATA]=10,fe[sce.SYMBOLOGY]=5,fe})(),ace=30;const lce=.1;let cce=class p32 extends zi{constructor(fe){super(fe),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new lJ,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(A$1I({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(fe){null==fe||fe<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<fe&&this._updateQuality(1),this._maxMemory=fe)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(fe){null!=fe&&(this._additionalCacheMemory=fe)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(fe,ve){return new aJ(fe,this._cacheStorage,ve)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let fe=this._layersUpdating();if(this._memoryPredicted<.6&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1);else if(fe)(this._memoryPredicted>1.1||this._usedMemory>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>.1&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>1)this._stableQuality=0,this._canFastRecover=!1,fe=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<.75&&this._quality<1){this._stableQuality=this._quality;const ve=.05;fe=this._updateQuality(this._quality+ve)}else this._quality<1&&(this._canFastRecover=!0);this._updating=fe}_updateQuality(fe){return(fe=Math.min(Math.max(fe,.1),1))!==this._quality&&(this._quality=fe,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some((fe=>!!fe.updating))}_updateMemory(){var fe,ve,_e,be,we;if(!this.view)return;null==(ve=null==(fe=this.view._stage)?void 0:fe.renderer)||ve.tick();const Se=null==(be=null==(_e=this.view._stage)?void 0:_e.renderer)?void 0:be.usedMemory;let Te=((null==(we=this.view.basemapTerrain)?void 0:we.usedMemory)??0)+(Se?Se.fbos+Se.edges+Se.plugins:0),Ee=0;this.view.allLayerViews&&this.view.allLayerViews.forEach((fe=>{if(function e$1a(fe){return"usedMemory"in fe&&"unloadedMemory"in fe&&"ignoresMemoryFactor"in fe}(fe)){const ve=fe.ignoresMemoryFactor?this._quality:1;Te+=fe.usedMemory*ve,Ee+=fe.unloadedMemory*ve}}));const Ce=null==this._warnMemoryUsage||Math.round(10*Te)!==Math.round(10*this._warnMemoryUsage),Oe=1048576*this.maxMemory;if(Te>Oe&&Ce){this._warnMemoryUsage=Te;const e77=fe=>(fe/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",fe=Math.round(100*this._quality);ar.getLogger(this).warn(`Memory Limit exceeded! Limit: ${e77(Oe)} Current: ${e77(Te)} Projected: ${e77(Te+Ee)} Quality: ${fe}%`)}this._usedMemory=Te/Oe,this._memoryPredicted=(Te+Ee)/Oe;const Re=Oe-Te;this._cacheStorage.maxSize=Math.max(0,Re+1048576*this.additionalCacheMemory)}get test(){}};e$4o([y$2v({constructOnly:!0})],cce.prototype,"view",void 0),e$4o([y$2v()],cce.prototype,"maxMemory",null),e$4o([y$2v()],cce.prototype,"additionalCacheMemory",null),e$4o([y$2v({readOnly:!0})],cce.prototype,"memoryFactor",null),e$4o([y$2v({readOnly:!0})],cce.prototype,"updating",null),e$4o([y$2v({readOnly:!0})],cce.prototype,"usedMemory",null),e$4o([y$2v({readOnly:!0})],cce.prototype,"usedCacheMemory",null),e$4o([y$2v()],cce.prototype,"_quality",void 0),e$4o([y$2v()],cce.prototype,"_usedMemory",void 0),e$4o([y$2v()],cce.prototype,"_updating",void 0),e$4o([y$2v()],cce.prototype,"_stableQuality",void 0),e$4o([y$2v()],cce.prototype,"_maxMemory",void 0),e$4o([y$2v()],cce.prototype,"_additionalCacheMemory",void 0),cce=e$4o([a$4y("esri.views.3d.support.MemoryController")],cce);let uce=class s61{constructor(fe){this.client=fe,this._cancelled=!1,this.size=0,this.duration=0}},hce=class e49{constructor(fe){this.typeWorkerQuota=fe,this.tasks=new Array,this.numWorkers=0,this.statistics=new dce}},dce=class i36{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},pce=class r47{constructor(fe,ve,_e,be){this._workerFunc=fe,this._callbackFunc=ve,this._maxTotalNumWorkers=_e,this._totalNumWorkers=0,this._clients=be.map((fe=>new hce(fe)))}destroy(){this._clients.length=0}hasQuota(fe){const ve=this._clients[fe];return!!ve&&(this._totalNumWorkers<this._maxTotalNumWorkers||ve.numWorkers+ve.tasks.length<ve.typeWorkerQuota)}push(fe){const ve=this._clients[fe.client];ve&&(this._totalNumWorkers<this._maxTotalNumWorkers?(ve.numWorkers++,this._totalNumWorkers++,this._workerFunc(fe,((fe,ve)=>this._taskCallback(fe,ve)))):ve.tasks.push(fe))}cancel(fe){this._taskFinished(fe),fe._cancelled=!0}_taskFinished(fe){const ve=this._clients[fe.client];this._totalNumWorkers--,ve&&(ve.numWorkers--,ve.statistics.requests++,ve.statistics.size+=fe.size||0,ve.statistics.duration+=fe.duration||0,ve.statistics.speed=ve.statistics.duration>0?ve.statistics.size/ve.statistics.duration:0,s$31(ve.numWorkers>=0)),this._next()}_next(){for(const fe of this._clients)if(fe&&fe.numWorkers<fe.typeWorkerQuota&&this._processQueue(fe))return;for(const fe of this._clients)if(fe&&this._processQueue(fe))return}_processQueue(fe){for(;fe.tasks.length>0;)if(this._workerFunc(fe.tasks.shift(),((fe,ve)=>this._taskCallback(fe,ve))))return fe.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(fe,ve){fe._cancelled||(this._callbackFunc(fe,ve),this._taskFinished(fe))}getStatsForType(fe){const ve=this._clients[fe];return ve?{quota:ve.typeWorkerQuota,workers:ve.numWorkers,queueSize:ve.tasks.length,requestStats:ve.statistics}:null}get test(){}},fce=class e50{constructor(fe,ve){this.element=fe,this.type="image+type",this.isOpaque="image/jpeg"===ve}};function t$1i(fe){return null!=fe&&"type"in fe&&"vector-tile"===fe.type}function e$17(fe){return null!=fe&&"type"in fe&&"raster-tile"===fe.type}function n$1o(fe){return null!=fe&&"type"in fe&&"tile-texture"===fe.type}function r$R(fe){return null!=fe&&"type"in fe&&"image+type"===fe.type}let mce=class b13 extends zi{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(fe,ve,_e){this._loadQueue=new pce(((fe,ve)=>this._startLoading(fe,ve)),((fe,ve)=>this._doneLoadingCB(fe,ve)),fe,ve),_e&&(this._frameTask=_e.registerTask(gI.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=l$4E(this._frameTask),this._tasks.forEach((fe=>e$4f(fe.abortController))),this._loadQueue=u$4d(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(fe){return this._loadQueue.hasQuota(fe)}request(fe,ve,_e,be={}){const we=L$1h();we.__signal=null!=be?be.signal:null;const Se=this._createOrUpdateTask(fe,ve,_e,be,we);return m$3R(be,(()=>this._cancelRequest(Se,we))),we.promise}_createTask(fe,ve,_e,be,we,Se){const Te=new gce(fe,ve,_e,be,we);return this._updateTask(Te,Se),this._tasks.set(we,Te),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(Te),Te}_cancelRequest(fe,ve){var _e;S$1U(fe.resolvers,ve),ve.reject(u$47()),0===fe.resolvers.length&&(fe.status===vce.DOWNLOADING&&(fe.status=vce.CANCELLED,this._loadQueue.cancel(fe),null==(_e=fe.abortController)||_e.abort(),fe.request=null,fe.abortController=null),fe.status=vce.CANCELLED,this._tasks.delete(fe.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(fe,ve){fe.resolvers.push(ve)}_createOrUpdateTask(fe,ve,_e,be,we){const Se=function E$n(fe,ve,_e){return`${fe}:${ve}:${_e}`}((null==be?void 0:be.uid)||fe,ve,_e),Te=this._tasks.get(Se);return Te?(this._updateTask(Te,we),Te):this._createTask(fe,be,ve,_e,Se,we)}_doneLoadingCB(fe,ve){this._loadQueue&&(s$31(fe.status===vce.DOWNLOADING),fe.status=vce.DOWNLOADED,this._frameTask?this._doneQueue.push({task:fe,err:ve}):this._doneLoading(fe,ve))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(fe){for(;!fe.done&&this._onLoadQueue.length>0;){const ve=this._onLoadQueue.shift();s$4o(ve.task.abortController),ve.task.abortController=null,ve.callback(ve.task),fe.madeProgress()}for(;!fe.done&&this._doneQueue.length>0;){const ve=this._doneQueue.shift();ve.task.status!==vce.DOWNLOADED&&(ve.err=ve.err||u$47()),this._doneLoading(ve.task,ve.err),fe.madeProgress()}}_doneLoading(fe,ve){if(ve&&!b$2g(ve)&&fe.numRetries>0)return--fe.numRetries,void this._loadQueue.push(fe);let _e=r$R(fe.result)||fe.result instanceof HTMLImageElement?0:fe.resolvers.length;for(const be of fe.resolvers)if(ve)b$2g(ve)?be.reject(ve):be.reject(new Ir("stream-data-loader:request-error",`Failed to request resource at '${fe.url}'. ${ve}`,{url:fe.url,error:ve}));else{--_e;const ve=_e>0?a$4H(fe.result):fe.result;be.resolve(ve)}this._tasks.delete(fe.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(fe,ve){if(fe.status===vce.CANCELLED)return!1;let _e,be;switch(fe.startTime=performance.now(),fe.status=vce.DOWNLOADING,fe.docType){case"binary":be="array-buffer",_e=0;break;case"image":be="image";break;case"image+type":be="array-buffer";break;default:be="json"}fe.abortController=new AbortController;const we=fe.abortController.signal;fe.request=U$1a(fe.url,{...fe.options,responseType:be,timeout:_e,signal:we});const n52=_e=>{fe.duration=performance.now()-fe.startTime,fe.size=_e instanceof ArrayBuffer?_e.byteLength:fe.size||0,fe.result=_e,this._frameTask?this._onLoadQueue.push({callback:ve,task:fe}):(fe.abortController=null,ve(fe))},i52=_e=>{fe.status===vce.DOWNLOADING&&ve(fe,_e)};return"image+type"!==fe.docType?(fe.request.then((fe=>n52(fe.data)),i52),!0):(fe.request.then((ve=>{const Se=ve.data,Te=function A$p(fe){if(fe.byteLength<2)return"unknown";const ve=new Uint8Array(fe,0,fe.byteLength);return 137===ve[0]&&80===ve[1]?"image/png":71===ve[0]&&73===ve[1]?"image/gif":66===ve[0]&&77===ve[1]?"image/bmp":255===ve[0]&&216===ve[1]?"image/jpeg":"unknown"}(Se);if(be="image",fe.size=Se.byteLength,"unknown"===Te)return fe.request=U$1a(fe.url,{responseType:be,timeout:_e,signal:we}),void fe.request.then((fe=>n52(fe.data)),i52);const Ee=new Blob([Se],{type:Te}),Ce=window.URL.createObjectURL(Ee);fe.request=U$1a(Ce,{responseType:be,timeout:_e,signal:we}),fe.request.then((fe=>n52(new fce(fe.data,Te))),i52).finally((()=>window.URL.revokeObjectURL(Ce)))}),i52),!0)}get test(){}};e$4o([y$2v({readOnly:!0})],mce.prototype,"updating",void 0),mce=e$4o([a$4y("esri.views.3d.support.StreamDataLoader")],mce);const yce=0;let gce=class O10 extends uce{constructor(fe,ve,_e,be,we){super(be),this.url=fe,this.options=ve,this.docType=_e,this.key=we,this.result=null,this.status=vce.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=yce}};var vce;!function(fe){fe[fe.QUEUED=1]="QUEUED",fe[fe.DOWNLOADING=2]="DOWNLOADING",fe[fe.DOWNLOADED=3]="DOWNLOADED",fe[fe.CANCELLED=4]="CANCELLED"}(vce||(vce={}));let _ce=class f14 extends zi{constructor(){super(...arguments),this.updating=!1}};e$4o([y$2v({readOnly:!0})],_ce.prototype,"updating",void 0),_ce=e$4o([a$4y("esri.views.3d.support.ResourceController.ResourceControllerMain")],_ce);let $ce=class T7 extends _ce{constructor(){super(...arguments),this._immediateTask=xI,this._normalTask=xI,this._updatingObjects=r$2W([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=function g$1B(){return new $I.Scheduler}(),this._memoryController=function d$T(fe){return new cce({view:fe})}(this.view),this._streamDataLoader=new mce,this._streamDataLoader.setup(30,oce,this._scheduler),this.addHandles([d$3d((()=>{var fe;return null==(fe=this.view.state)?void 0:fe.mode}),(fe=>{null!=fe&&(this._scheduler.state=fe)}),Za),d$3d((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=A$1I({update:fe=>this._frame(fe)}),this._immediateTask=this._scheduler.registerTask(gI.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(gI.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=l$4E(this._frameTask),this._streamDataLoader=u$4d(this._streamDataLoader),this._memoryController=u$4d(this._memoryController),this._scheduler=u$4d(this._scheduler),this.view=null}get updating(){var fe,ve,_e,be;return!!((null==(fe=this._memoryController)?void 0:fe.updating)||(null==(ve=this._streamDataLoader)?void 0:ve.updating)||(null==(_e=this._immediateTask)?void 0:_e.updating))||(null==(be=this._updatingObjects)?void 0:be.value.some((fe=>fe.updating)))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(fe){const ve=this._streamDataLoader;return{request:(_e,be,we)=>ve.request(_e,be,fe,we),get busy(){return!ve.hasDownloadSlots(fe)}}}addUpdatingObject(fe){const ve=this._updatingObjects;return ve.value=[...ve.value,fe],e$4e((()=>{ve.value=ve.value.filter((ve=>ve!==fe))}))}_frame(fe){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(u$46(fe.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(fe)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};var bce;e$4o([y$2v()],$ce.prototype,"view",void 0),e$4o([y$2v()],$ce.prototype,"_scheduler",void 0),e$4o([y$2v()],$ce.prototype,"_memoryController",void 0),e$4o([y$2v()],$ce.prototype,"_streamDataLoader",void 0),e$4o([y$2v()],$ce.prototype,"_immediateTask",void 0),e$4o([y$2v()],$ce.prototype,"_normalTask",void 0),e$4o([y$2v()],$ce.prototype,"_updatingObjects",void 0),e$4o([y$2v({readOnly:!0})],$ce.prototype,"updating",null),$ce=e$4o([a$4y("esri.views.3d.support.ResourceController")],$ce),function(fe){fe[fe.KILOBYTES=1024]="KILOBYTES",fe[fe.MEGABYTES=1048576]="MEGABYTES",fe[fe.GIGABYTES=1073741824]="GIGABYTES"}(bce||(bce={}));let wce=class t58{constructor(fe,ve=0,_e=0,be=0,we=0,Se=null){this.usedMemory=fe,this.displayedFeatures=ve,this.totalFeatures=_e,this.maximumFeatures=be,this.nodes=we,this.core=Se}};let xce=class e51{constructor(fe){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=fe.layer;const ve=fe.performanceInfo;this.memory=ve.usedMemory,this.displayedNumberOfFeatures=ve.displayedFeatures,this.maximumNumberOfFeatures=ve.maximumFeatures,this.totalNumberOfFeatures=ve.totalFeatures}},Sce=class s62{constructor(fe){var ve,_e,be,we;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,null!=fe.resourceController){const ve=fe.resourceController.memoryController;this.totalMemory=(ve.maxMemory??0)*bce.MEGABYTES,this.usedMemory=Math.round(ve.usedMemory*this.totalMemory),this.quality=fe.quality,this.load=fe.resourceController.scheduler.load,this.cachedMemory=ve.usedCacheMemory}this.terrainMemory=(null==(ve=fe.basemapTerrain)?void 0:ve.usedMemory)??0,this.edgesMemory=(null==(_e=fe._stage)?void 0:_e.renderer.usedMemory.edges)??0,this.fboMemory=(null==(be=fe._stage)?void 0:be.renderer.usedMemory.fbos)??0,null==(we=fe.allLayerViews)||we.items.forEach((fe=>{(function e$16(fe){return"performanceInfo"in fe})(fe)&&this.layerPerformanceInfos.push(new xce(fe))})),this.layerPerformanceInfos.sort(((fe,ve)=>ve.memory-fe.memory))}},Tce=class a37{constructor(fe){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=fe("gltf-resources",(()=>{})),this._wosrMemCache=fe("wosr-resources",(()=>{}))}destroy(){this._gltfLoading.forEach((fe=>fe.abortController.abort())),this._wosrLoading.forEach((fe=>fe.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(fe,ve,_e){const be=_e?`gltfPBR:${fe}`:`gltf:${fe}`,we=this._gltfMemCache.get(be);return null!=we?Promise.resolve(we):i$1g(this._gltfLoading,this._gltfMemCache,be,(ve=>l$1B(new Ere(ve.streamDataRequester),fe,ve,_e)),ve)}loadWOSR(fe,ve){const _e=`wosr:${fe}:${ve.disableTextures}`,be=this._wosrMemCache.get(_e);return null!=be?Promise.resolve(be):i$1g(this._wosrLoading,this._wosrMemCache,_e,(ve=>A$z(fe,ve)),ve)}};async function i$1g(fe,ve,_e,be,we){s$4o(we);const Se=m$3R(we,(()=>function n$1n(fe,ve){const _e=fe.get(ve);if(null!=_e&&--_e.refCount>0)return;fe.delete(ve),null!=_e&&_e.abortController.abort()}(fe,_e)));let Te=fe.get(_e);if(Te)Te.refCount++;else{const ve=new AbortController;Te={refCount:1,abortController:ve,promise:be({...we,signal:ve.signal})},fe.set(_e,Te)}try{const be=await Te.promise;return ve.put(_e,be,be.size),fe.delete(_e),s$4o(we),be}finally{l$4E(Se)}}let Ece=class i37 extends zi{constructor(fe,ve){super({}),this._stage=fe,this._textureRequests=new Map,this._frameTask=(null==ve?void 0:ve.registerTask(gI.TEXTURE_UNLOAD))??xI}normalizeCtorArgs(){return{}}destroy(){var fe,ve,_e;super.destroy(),null==(fe=this._frameTask)||fe.remove(),null==(ve=this._textureRequests)||ve.forEach((fe=>this._releaseTextureRequest(fe))),null==(_e=this._textureRequests)||_e.clear()}get updating(){return this._frameTask.updating}fromData(fe,ve){const _e=this.makeUid(fe);let be=this._textureRequests.get(_e);if(!be){const fe=new Cce;fe.texture=ve(),this._stage&&(fe.texture.load(this._stage.renderView.renderingContext),this._stage.add(fe.texture)),this._textureRequests.set(_e,fe),be=fe}return be.referenceCount++,new Pce(_e,be.texture,(()=>this._release(_e)))}_release(fe){const ve=this._textureRequests.get(fe);ve&&(ve.referenceCount,ve.referenceCount--,ve.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(fe))))}get test(){}_releaseNow(fe){var ve;if(!this._textureRequests)return;const _e=this._textureRequests.get(fe);!_e||_e.referenceCount>0||(null==(ve=_e.texture)||ve.unload(),this._releaseTextureRequest(_e),this._textureRequests.delete(fe))}_releaseTextureRequest(fe){var ve;fe.texture?null==(ve=this._stage)||ve.remove(fe.texture):fe.abortController&&(fe.abortController.abort(),fe.abortController=null)}makeUid(fe,ve=null){return null!=ve?`${fe}.${ve}px`:fe}};e$4o([y$2v()],Ece.prototype,"_frameTask",void 0),e$4o([y$2v()],Ece.prototype,"updating",null),Ece=e$4o([a$4y("esri.views.3d.support.TextureCollection")],Ece);let Pce=class n34{constructor(fe,ve,_e){this.uid=fe,this.texture=ve,this.release=_e}},Cce=class a38{constructor(){this.referenceCount=0}},Oce=class a39 extends Ece{constructor(fe,ve,_e){super(ve,_e),this._streamDataRequester=fe}async fromUrl(fe,ve,_e){s$4o(_e);const be=null==_e?void 0:_e.signal,we=this.makeUid(fe,ve);let Se=this._textureRequests.get(we);if(!Se){const _e=new AbortController,be=this._streamDataRequester.request(fe,"image",{uid:we,signal:_e.signal});Se=new Cce,Se.abortController=_e;const Te=Se;this._textureRequests.set(we,Se),Se.textureAsync=be.then((async _e=>{const be=this._createTexture(fe,_e,ve);return Te.texture=be,Te.abortController=null,await be.load(this._stage.renderView.renderingContext),this._stage.add(be),new Pce(we,be,(()=>this._release(we)))}),(fe=>{throw Te.abortController=null,fe}))}Se.referenceCount++;try{return await h$2_(Se.textureAsync,be)}catch(Te){throw this._release(we),Te}}_createTexture(fe,ve,_e){var be;const we={width:ve.width,height:ve.height,wrap:{s:qO.CLAMP_TO_EDGE,t:qO.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Pt$4(fe)){if(_e||0===ve.width&&0===ve.height){const fe=ve.width?ve.height/ve.width:1;_e=_e||64,fe>1?(ve.width=Math.round(_e/fe),ve.height=_e):(ve.width=_e,ve.height=Math.round(_e*fe))}(null==(be=this._stage.renderView)?void 0:be.renderingContext.driverTest.svgPremultipliesAlpha.result)&&(we.preMultiplyAlpha=!1)}return new CZ(ve,we)}},Ace=class S10{constructor(fe){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=fe.viewState,this._view=fe.view,this._pointsOfInterest=fe.pointsOfInterest,this.streamDataRequester=fe.resourceController.createStreamDataRequester(sce.SYMBOLOGY),this.objectResourceCache=new Tce(((ve,_e)=>fe.resourceController.memoryController.newCache(ve,_e))),this.textures=new Oce(this.streamDataRequester,fe.view._stage,fe.resourceController.scheduler);const ve=s$45(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=n$2C(fe.viewingMode,ve),this.screenSizePerspectiveSettingsLabels=function i$2p(fe,ve){const{curvatureDependent:_e,scaleStart:be,scaleFallOffRange:we}=AB;return new OB(fe,{curvatureDependent:{min:{curvature:_e.min.curvature,tiltAngle:_e.min.tiltAngle,scaleFallOffFactor:MB.curvatureDependent.min.scaleFallOffFactor},max:{curvature:_e.max.curvature,tiltAngle:_e.max.tiltAngle,scaleFallOffFactor:MB.curvatureDependent.max.scaleFallOffFactor}},scaleStart:be,scaleFallOffRange:we,minPixelSize:MB.minPixelSize},ve)}(fe.viewingMode,ve)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(fe){if(!fe)return e$4e();this._graphicsOwners.push(fe);const ve=d$3d((()=>{var ve;return null==(ve=fe.layer)?void 0:ve.screenSizePerspectiveEnabled}),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),e$4e((()=>{ve.remove(),S$1U(this._graphicsOwners,fe),this._updateScreenSizePerspectiveEnabled()}))}_updateScreenSizePerspectiveEnabled(){const fe=this._graphicsOwners.some((fe=>{var ve;return!0===(null==(ve=fe.layer)?void 0:ve.screenSizePerspectiveEnabled)}));if(fe&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new jt;const e77=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([d$3d((()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance),e77,Za),this._viewState.events.on("camera-projection-changed",e77)]),this._updateScreenSizePerspectiveSettings()}else fe||(this._screenSizePerspectiveHandles=u$4d(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const fe=this._pointsOfInterest;Mce.distance=fe.centerOnSurfaceInfrequent.distance,Mce.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Mce),this.screenSizePerspectiveSettingsLabels.update(Mce),this._view._stage.renderView.requestRender()}get test(){}};const Mce={distance:0,fovY:0};let Rce=class m24{constructor(fe,ve,_e=""){this.graphics=fe,this._symbol=new eT({symbolLayers:new Wa([new Rx({material:{color:ve},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new rS({text:_e,halo:{color:"white",size:1/.75},material:{color:ve},size:12})])})}show(fe,ve){if(null==ve)return;this.hide();const _e=new Yo({x:fe[0],y:fe[1],z:fe[2],spatialReference:ve});this._graphic=new RT({geometry:_e,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)}},Ice=class e52 extends zi{constructor(fe){super(fe)}};e$4o([y$2v({constructOnly:!0})],Ice.prototype,"renderCoordsHelper",void 0),e$4o([y$2v({constructOnly:!0})],Ice.prototype,"surface",void 0),e$4o([y$2v({constructOnly:!0})],Ice.prototype,"state",void 0),Ice=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.PointOfInterest")],Ice);const Lce=Array;let Dce=class y9 extends Ice{constructor(fe){super(fe),this._dirty=!1,this._propertiesPool=new ev({location:Yo,renderLocation:Lce},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=[0,0,0],this._tmpPoint=new Yo}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const t84=()=>this._setDirty();this.addHandles(v$1W((()=>{var fe,ve;return null==(ve=null==(fe=this.map)?void 0:fe.ground)?void 0:ve.layers}),"change",t84,{onListenerAdd:t84,onListenerRemove:t84}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=u$4d(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const fe=this._propertiesPool.get("location");return fe.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,fe),fe}get scale(){const fe=this._camera,ve=x$1W(fe.eye,this.renderLocation);return _$1b({renderCoordsHelper:this.renderCoordsHelper,state:{camera:fe}},ve,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const fe=this._pendingElevationQueryController;fe&&(this._pendingElevationQueryController=null,fe.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var fe;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!(null==(fe=this.map)?void 0:fe.ground))return this._updateSurfaceAltitude(0),dI;const ve=this.state.spatialReference;this._tmpPoint.spatialReference=ve,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const _e=(this._tmpPoint.z??0)>Fce&&this.renderCoordsHelper.viewingMode===Wf.Global&&(ve.isWGS84||ve.isWebMercator);let be=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:be.signal,cache:this.cache,minDemResolution:_e?zce:0}).then((fe=>this._updateSurfaceAltitude(fe.geometry.z??0))).catch((fe=>{b$2g(fe)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===be&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),be=null})),this._pendingElevationQueryController=be,dI}_updateSurfaceAltitude(fe){this._estimatedSurfaceAltitude!==fe&&(this._estimatedSurfaceAltitude=fe,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Nce,this._estimatedSurfaceAltitude,this._camera.eye),G$$(this._get("renderLocation"),Nce)||(this._set("renderLocation",r$3w(this._propertiesPool.get("renderLocation"),Nce)),this.notifyChange("renderLocation"))}};e$4o([y$2v({constructOnly:!0})],Dce.prototype,"scheduler",void 0),e$4o([y$2v({constructOnly:!0})],Dce.prototype,"cache",void 0),e$4o([y$2v({constructOnly:!0})],Dce.prototype,"task",void 0),e$4o([y$2v()],Dce.prototype,"location",null),e$4o([y$2v({constructOnly:!0})],Dce.prototype,"map",void 0),e$4o([y$2v()],Dce.prototype,"renderLocation",void 0),e$4o([y$2v()],Dce.prototype,"scale",null),e$4o([y$2v()],Dce.prototype,"updating",null),Dce=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],Dce);const Nce=[0,0,0],Fce=1e5,zce=1e6,kce=Array;let Uce=class L6 extends Ice{constructor(fe){super(fe),this._propertiesPool=new ev({location:Yo,renderLocation:kce},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=[0,0,0],this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=l$4E(this._frameWorker),this._propertiesPool=u$4d(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const fe=this._propertiesPool.get("location");return fe.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,fe),fe}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,dI}_updateRenderLocation(){const fe=Bce;let ve=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,fe);const _e=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!ve&&_e&&(ve=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,fe),ve&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const be=jce;ve&&this._latestSurfaceAltitudeChangesDistanceSignificantly(fe,be)&&(r$3w(fe,be),this._currentSurfaceAltitude=this._latestSurfaceAltitude),ve?this.distance=x$1W(this._camera.eye,fe):(g$2z(fe,this._camera.viewForward,this._get("distance")),u$3Y(fe,fe,this._camera.eye)),G$$(this._get("renderLocation"),fe)||this._set("renderLocation",r$3w(this._propertiesPool.get("renderLocation"),fe))}_calculateSurfaceIntersection(fe,ve){var _e,be;const we=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(we.ray,fe,ve))return!1;if(this.state.isGlobal){const _e=s$45(this.renderCoordsHelper.spatialReference).radius,be=_e+fe,Se=v$22(we.eye),Te=Se<be*be,Ee=x$1W(we.eye,ve);if(Te&&Ee>_e/4){const fe=be-Math.sqrt(Se);return g$2z(ve,we.viewForward,fe),u$3Y(ve,ve,we.eye),!0}}else{const fe=(null==(_e=this.surface)?void 0:_e.ready)?this.surface.extent:null;null!=fe&&i$48(fe,null==(be=this.surface)?void 0:be.spatialReference,Gce,this.renderCoordsHelper.spatialReference)&&(ve[0]=e$3Y(ve[0],Gce[0],Gce[2]),ve[1]=e$3Y(ve[1],Gce[1],Gce[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(fe,ve){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==fe)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,ve)){if(_B.TESTS_DISABLE_OPTIMIZATIONS)return!0;const _e=this._camera.eye,be=x$1W(_e,fe),we=x$1W(_e,ve);if(Math.abs(we-be)/be>Vce)return!0}return!1}};e$4o([y$2v({constructOnly:!0})],Uce.prototype,"scheduler",void 0),e$4o([y$2v({constructOnly:!0})],Uce.prototype,"task",void 0),e$4o([y$2v()],Uce.prototype,"distance",void 0),e$4o([y$2v({constructOnly:!0})],Uce.prototype,"estimateSurfaceAltitudeAtCenter",void 0),e$4o([y$2v({readOnly:!0})],Uce.prototype,"location",null),e$4o([y$2v({readOnly:!0})],Uce.prototype,"renderLocation",void 0),e$4o([y$2v()],Uce.prototype,"updating",void 0),Uce=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Uce);const Vce=.05,Bce=[0,0,0],jce=[0,0,0],Gce=u$3J();let Hce=class n35{constructor(fe){this._handles=new jt,this.events=new La,this._contentLayerViews=fe.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",(fe=>this._layerViewsChanged(fe)))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=u$4d(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(fe){fe.added.forEach((fe=>{"esri.views.3d.layers.SceneLayerView3D"===fe.declaredClass&&this._handles.add(fe.on("visible-geometry-changed",(()=>this._contentChanged())),fe.uid)})),fe.removed.forEach((fe=>this._handles.remove(fe.uid)))}_contentChanged(){this.events.emit("request-update",qce)}};const qce={},Wce=Array;let Yce=class O11 extends Ice{constructor(fe){super(fe),this._propertiesPool=new ev({location:Yo,renderLocation:Wce},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([d$3d((()=>this.centerOnSurface.renderLocation),(()=>this.updateRenderLocation())),d$3d((()=>this.state.contentCamera),(()=>this.updateRenderLocation()))]),this.scheduler&&this.addHandles(this.scheduler.registerTask(gI.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=u$4d(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const fe=this._propertiesPool.get("location");return fe.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,fe),fe}get worldUnitsPerContentPixel(){const{camera:fe,contentPixelRatio:ve}=this.state;return fe.computeRenderPixelSizeAt(this.renderLocation)*(fe.pixelRatio/ve)}get running(){return this._dirty}runTask(){const fe=this._get("renderLocation"),ve=this.centerOnSurface.renderLocation,_e=this.renderCoordsHelper,be=this.state.contentCamera;this._dirty=!1,_e.worldUpAtPosition(ve,Zce);const we=Math.max(0,(Math.acos(P$1g(Zce,be.viewForward))-.5*Math.PI)*(be.aboveGround?1:-1));if(Number.isNaN(we)){if(!fe||!H$19(fe,ve)){const fe=this._propertiesPool.get("renderLocation");r$3w(fe,ve),this._set("renderLocation",fe)}return dI}const Se=1-e$3Y(we/(.5*Math.PI),0,1),Te=Se*Se*Se;this._calculateScreenHorizontalEdgeOnSurface(Jce);const Ee=this._propertiesPool.get("renderLocation");return A$1G(Ee,ve,Jce,Te),fe&&H$19(fe,Ee)||this._set("renderLocation",Ee),dI}_calculateScreenHorizontalEdgeOnSurface(fe){const ve=this.state.contentCamera,_e=ve.getRenderCenter(x$1H());if(_e[1]=ve.aboveGround?ve.padding[IR.BOTTOM]:ve.fullHeight-ve.padding[IR.TOP],this.estimateSurfaceIntersectionAtRenderPoint(_e,fe))return fe;const be=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(ve.unprojectFromRenderScreen(_e,Xce)){e$3Z(Xce,Xce,ve.eye);const _e=z$1d(Xce,Xce);if(this.renderCoordsHelper.intersectInfiniteManifold(l$3V(ve.eye,_e),be,fe))return fe}return this.renderCoordsHelper.setAltitude(fe,be,ve.eye)}updateRenderLocation(){this._dirty=!0}};e$4o([y$2v()],Yce.prototype,"_dirty",void 0),e$4o([y$2v({constructOnly:!0})],Yce.prototype,"scheduler",void 0),e$4o([y$2v({constructOnly:!0})],Yce.prototype,"centerOnSurface",void 0),e$4o([y$2v({constructOnly:!0})],Yce.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),e$4o([y$2v()],Yce.prototype,"updating",null),e$4o([y$2v()],Yce.prototype,"location",null),e$4o([y$2v()],Yce.prototype,"renderLocation",void 0),e$4o([y$2v()],Yce.prototype,"worldUnitsPerContentPixel",null),Yce=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.Focus")],Yce);const Zce=[0,0,0],Xce=[0,0,0],Jce=[0,0,0];let Qce=class c37 extends zi{get surface(){var fe;return null==(fe=this.view.map)?void 0:fe.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const fe=[0,0,0];return this.view.renderCoordsHelper.toRenderCoords(this.location,fe),fe}constructor(fe){super(fe),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([d$3d((()=>{var fe,ve;return[null==(fe=this.surfaceView)?void 0:fe.spatialReference,null==(ve=this.surfaceView)?void 0:ve.extent]}),(()=>this._update())),v$1W((()=>{var fe;return null==(fe=this.surface)?void 0:fe.layers}),"change",(()=>this._update()))]),this._update())}_update(){var fe;if(this._updateController&&(this._updateController.abort(),this._updateController=null),null==(null==(fe=this.surfaceView)?void 0:fe.extent)||null==this.surfaceView.spatialReference)return void this._set("location",null);const ve=p$4O(this.surfaceView.extent),_e=new Yo({x:ve[0],y:ve[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(_e,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((fe=>{this._updateController=null,this._set("location",fe.geometry)})).catch((fe=>{}))):this._set("location",_e)}};e$4o([y$2v({constructOnly:!0})],Qce.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],Qce.prototype,"cache",void 0),e$4o([y$2v()],Qce.prototype,"surface",null),e$4o([y$2v()],Qce.prototype,"surfaceView",null),e$4o([y$2v({readOnly:!0})],Qce.prototype,"location",void 0),e$4o([y$2v({readOnly:!0})],Qce.prototype,"renderLocation",null),Qce=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],Qce);let Kce=class u19 extends zi{constructor(fe){super(fe),this._tileGeometryUpdateExtent=D$19(),this._tileGeometryUpdateSpatialReference=null,this.events=new La,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",(fe=>this._tileGeometryChanged(fe))),this.scheduler.registerTask(gI.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",eue),D$19(this._tileGeometryUpdateExtent),this._set("updating",!1),dI):dI}_tileGeometryChanged(fe){this._tileGeometryUpdateSpatialReference=fe.spatialReference,m$3A(this._tileGeometryUpdateExtent,fe.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let fe=this.centerOnSurfaces[0];for(let ve=1;ve<this.centerOnSurfaces.length;ve++){const _e=this.centerOnSurfaces[ve];_e.distance>fe.distance&&(fe=_e)}return fe}_centerIntersectsExtent(fe,ve){const _e=this.state.contentCamera.eye,be=iue,we=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(_e,tue,ve),this.renderCoordsHelper.fromRenderCoords(we.renderLocation,rue,ve),tue[0]<rue[0]?(be[0]=tue[0],be[2]=rue[0]):(be[0]=rue[0],be[2]=tue[0]),tue[1]<rue[1]?(be[1]=tue[1],be[3]=rue[1]):(be[1]=rue[1],be[3]=tue[1]),E$1H(be,fe)}};e$4o([y$2v({constructOnly:!0})],Kce.prototype,"state",void 0),e$4o([y$2v({constructOnly:!0})],Kce.prototype,"centerOnSurfaces",void 0),e$4o([y$2v({constructOnly:!0})],Kce.prototype,"renderCoordsHelper",void 0),e$4o([y$2v({constructOnly:!0})],Kce.prototype,"scheduler",void 0),e$4o([y$2v({constructOnly:!0})],Kce.prototype,"surface",void 0),e$4o([y$2v({readOnly:!0})],Kce.prototype,"updating",void 0),Kce=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Kce);const eue={},tue=[0,0,0],rue=[0,0,0],iue=D$19();let nue=class P5 extends zi{constructor(fe){super(fe),this.renderPointOfView=[0,0,0],this._pois=new Array,this._debugCenters=new Map,this._tmpRay=m$3f(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new ev({renderPointOfView:sue},this)}initialize(){var fe;const{state:ve,basemapTerrain:_e,renderCoordsHelper:be,map:we}=this.view;this._surfaceIntersector=T$15(ve.viewingMode),ve.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Xf.MIN,this._contentIntersector=T$15(ve.viewingMode);const u30=()=>this._estimateSurfaceAltitudeAtCenter(),Se=this.view.resourceController.scheduler,Te=null==(fe=this.view.basemapTerrain)?void 0:fe.elevationQueryCache,Ee={state:ve,scheduler:Se,surface:_e,renderCoordsHelper:be};this._set("centerOnSurfaceInfrequent",new Uce({...Ee,task:gI.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:u30})),this._set("centerOnSurfaceFrequent",new Uce({...Ee,task:gI.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:u30})),this._set("centerOnContent",new Uce({...Ee,task:gI.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Dce({...Ee,cache:Te,task:gI.POINT_OF_INTEREST_INFREQUENT,map:we})),this._set("surfaceGeometryUpdates",new Kce({...Ee,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Hce({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:be})),this._set("surfaceOrigin",new Qce({cache:Te,view:this.view})),this._set("focus",new Yce({state:ve,scheduler:Se,surface:_e,renderCoordsHelper:be,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(fe,ve)=>this._estimateSurfaceIntersectionAtRenderPoint(fe,this.view.state.contentCamera,ve)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const Ce=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Rce(Ce,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Rce(Ce,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Rce(Ce,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Rce(Ce,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new Rce(Ce,"green","Focus")),this.addHandles([d$3d((()=>ve.contentCamera),(fe=>this._cameraChanged(fe)),Za),d$3d((()=>_e.extent),(()=>this._updateCenterPointsOfInterest())),p$4J((()=>!_e.updating),(()=>this._updateCenterPointsOfInterest()),Za),v$1W((()=>this.surfaceGeometryUpdates.events),"request-update",(()=>this._updateCenterPointsOfInterest())),v$1W((()=>this.contentGeometryUpdates.events),"request-update",(()=>this._updateCenterOnContent())),p$4J((()=>_B.SHOW_POI),(fe=>this._setDebug(fe)),Xa)]),this._cameraChanged(this.view.state.contentCamera);for(const Oe of this._pois)Oe.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const fe of this._pois)fe.destroy();this.surfaceOrigin.destroy()}get updating(){var fe;return!(!(null==(fe=this.surfaceGeometryUpdates)?void 0:fe.updating)&&!this._pois.some((fe=>fe.updating)))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const fe=this._centerRay;return null==fe||(this.view.sceneIntersectionHelper.intersectRay(fe,this._contentIntersector,oue,lue)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(oue):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const fe=this._centerRay;if(null==fe)return this._surfaceAltitudeAtCenter;const ve=fe.origin,_e=u$3Y(oue,fe.origin,fe.direction);return this._surfaceIntersector.resetWithRay(fe,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,ve,_e),this._surfaceIntersector.results.min.getIntersectionPoint(oue)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(oue)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(fe,ve,_e){const be=f$1U(ve,fe,aue);if(null==be)return null;const we=be.origin,Se=u$3Y(oue,be.origin,be.direction);return this._surfaceIntersector.resetWithRay(be,ve),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,we,Se),this._surfaceIntersector.results.min.getIntersectionPoint(_e)?_e:null}_cameraChanged(fe){this._updateCenterPointsOfInterest();const ve=fe.eye;G$$(this.renderPointOfView,ve)||this._set("renderPointOfView",r$3w(this._propertiesPool.get("renderPointOfView"),ve))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const fe of this._pois)fe.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(fe){if(!fe)return this._debugCenters.forEach((fe=>fe.hide())),void this.removeHandles("debug");for(const ve of this._pois)this.addHandles(d$3d((()=>ve.renderLocation),(fe=>{var _e;return null==(_e=this._debugCenters.get(ve))?void 0:_e.show(fe,ve.renderCoordsHelper.spatialReference)}),Xa),"debug")}get test(){}};e$4o([y$2v()],nue.prototype,"centerOnContent",void 0),e$4o([y$2v()],nue.prototype,"centerOnSurfaceFrequent",void 0),e$4o([y$2v()],nue.prototype,"centerOnSurfaceInfrequent",void 0),e$4o([y$2v()],nue.prototype,"cameraOnSurface",void 0),e$4o([y$2v()],nue.prototype,"focus",void 0),e$4o([y$2v()],nue.prototype,"renderPointOfView",void 0),e$4o([y$2v()],nue.prototype,"surfaceOrigin",void 0),e$4o([y$2v()],nue.prototype,"contentGeometryUpdates",void 0),e$4o([y$2v()],nue.prototype,"surfaceGeometryUpdates",void 0),e$4o([y$2v({constructOnly:!0})],nue.prototype,"view",void 0),e$4o([y$2v()],nue.prototype,"updating",null),nue=e$4o([a$4y("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],nue);const sue=Array,oue=[0,0,0],aue=m$3f(),lue={exclude:new Set([Ny])};let cue=class t59{constructor(fe){this._store=fe}destroy(){this._store.destroy()}get(fe){return this._store.get(fe)}put(fe,ve){this._store.put(fe,ve,ve.values.byteLength+256)}};function e$13(){const fe=new Float32Array(9);return fe[0]=1,fe[4]=1,fe[8]=1,fe}function r$Q(fe){const ve=new Float32Array(9);return ve[0]=fe[0],ve[1]=fe[1],ve[2]=fe[2],ve[3]=fe[3],ve[4]=fe[4],ve[5]=fe[5],ve[6]=fe[6],ve[7]=fe[7],ve[8]=fe[8],ve}function t$1f(fe,ve,_e,be,we,Se,Te,Ee,Ce){const Oe=new Float32Array(9);return Oe[0]=fe,Oe[1]=ve,Oe[2]=_e,Oe[3]=be,Oe[4]=we,Oe[5]=Se,Oe[6]=Te,Oe[7]=Ee,Oe[8]=Ce,Oe}var uue,hue,due;Object.freeze(Object.defineProperty({__proto__:null,clone:r$Q,create:e$13,createView:function n$1k(fe,ve){return new Float32Array(fe,ve,9)},fromValues:t$1f},Symbol.toStringTag,{value:"Module"})),function(fe){fe[fe.FILL=1]="FILL",fe[fe.LINE=2]="LINE",fe[fe.SYMBOL=3]="SYMBOL",fe[fe.CIRCLE=4]="CIRCLE"}(uue||(uue={})),function(fe){fe[fe.BACKGROUND=0]="BACKGROUND",fe[fe.FILL=1]="FILL",fe[fe.OUTLINE=2]="OUTLINE",fe[fe.LINE=3]="LINE",fe[fe.ICON=4]="ICON",fe[fe.CIRCLE=5]="CIRCLE",fe[fe.TEXT=6]="TEXT",fe[fe.TILEINFO=7]="TILEINFO"}(hue||(hue={})),function(fe){fe[fe.PAINTER_CHANGED=0]="PAINTER_CHANGED",fe[fe.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",fe[fe.LAYER_CHANGED=2]="LAYER_CHANGED",fe[fe.LAYER_REMOVED=3]="LAYER_REMOVED",fe[fe.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(due||(due={}));let pue=class e53{static getId(fe,ve,_e,be){return"object"==typeof fe?`${fe.level}/${fe.row}/${fe.col}/${fe.world}`:`${fe}/${ve}/${_e}/${be}`}constructor(fe,ve,_e,be){this.set(fe,ve,_e,be)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(fe){this.set(fe)}get hash(){const fe=4095&this.row,ve=4095&this.col,_e=63&this.level;return(3&this.world)<<30|ve<<22|fe<<8|_e}acquire(fe,ve,_e,be){this.set(fe,ve,_e,be)}contains(fe){const ve=fe.level-this.level;return ve>=0&&this.row===fe.row>>ve&&this.col===fe.col>>ve&&this.world===fe.world}containsChild(fe){const ve=fe.level-this.level;return ve>0&&this.row===fe.row>>ve&&this.col===fe.col>>ve&&this.world===fe.world}equals(fe){return this.level===fe.level&&this.row===fe.row&&this.col===fe.col&&this.world===fe.world}clone(){return new e53(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(fe,ve,_e,be){if(null==fe)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof fe)this.level=fe.level||0,this.row=fe.row||0,this.col=fe.col||0,this.world=fe.world||0;else if("string"==typeof fe){const[ve,_e,be,we]=fe.split("/");this.level=parseFloat(ve),this.row=parseFloat(_e),this.col=parseFloat(be),this.world=parseFloat(we)}else this.level=+fe,this.row=+ve,this.col=+_e,this.world=+be||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new e53(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(fe,ve){return`${this.level}/${this.row+ve}/${this.col+fe}/${this.world}`}getChildKeys(){const fe=this.level+1,ve=this.row<<1,_e=this.col<<1,be=this.world;return[new e53(fe,ve,_e,be),new e53(fe,ve,_e+1,be),new e53(fe,ve+1,_e,be),new e53(fe,ve+1,_e+1,be)]}compareRowMajor(fe){return this.row<fe.row?-1:this.row>fe.row?1:this.col<fe.col?-1:this.col>fe.col?1:0}};function o$S(fe,ve){return[fe,ve]}function i$1e(fe,ve,_e){return fe[0]=ve,fe[1]=_e,fe}pue.pool=new pr(pue,null,null,25,50);const fue=new pue("0/0/0/0");let mue=class n36{static create(fe,ve,_e=null){const be=s$46(fe.spatialReference),we=ve.origin||o$S(fe.origin.x,fe.origin.y),Se=o$S(fe.size[0]*ve.resolution,fe.size[1]*ve.resolution),Te=o$S(-1/0,-1/0),Ee=o$S(1/0,1/0),Ce=o$S(1/0,1/0);null!=_e&&(i$1e(Te,Math.max(0,Math.floor((_e.xmin-we[0])/Se[0])),Math.max(0,Math.floor((we[1]-_e.ymax)/Se[1]))),i$1e(Ee,Math.max(0,Math.floor((_e.xmax-we[0])/Se[0])),Math.max(0,Math.floor((we[1]-_e.ymin)/Se[1]))),i$1e(Ce,Ee[0]-Te[0]+1,Ee[1]-Te[1]+1));const{cols:Oe,rows:Re}=ve;let De,Be,Ze,Xe;return!_e&&Oe&&Re&&(i$1e(Te,Oe[0],Re[0]),i$1e(Ee,Oe[1],Re[1]),i$1e(Ce,Oe[1]-Oe[0]+1,Re[1]-Re[0]+1)),fe.isWrappable?(De=o$S(Math.ceil(Math.round((be.valid[1]-be.valid[0])/ve.resolution)/fe.size[0]),Ce[1]),Be=o$S(Math.floor((be.origin[0]-we[0])/Se[0]),Te[1]),Ze=o$S(De[0]+Be[0]-1,Ee[1]),Xe=!0):(Be=Te,Ze=Ee,De=Ce,Xe=!1),new n36(ve.level,ve.resolution,ve.scale,we,Te,Ee,Ce,Se,Be,Ze,De,Xe)}constructor(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De){this.level=fe,this.resolution=ve,this.scale=_e,this.origin=be,this.first=we,this.last=Se,this.size=Te,this.norm=Ee,this.worldStart=Ce,this.worldEnd=Oe,this.worldSize=Re,this.wrap=De}normalizeCol(fe){if(!this.wrap)return fe;const ve=this.worldSize[0];return fe<0?ve-1-Math.abs((fe+1)%ve):fe%ve}denormalizeCol(fe,ve){return this.wrap?this.worldSize[0]*ve+fe:fe}getWorldForColumn(fe){return this.wrap?Math.floor(fe/this.worldSize[0]):0}getFirstColumnForWorld(fe){return fe*this.worldSize[0]+this.first[0]}getLastColumnForWorld(fe){return fe*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(fe){return(fe-this.origin[0])/this.norm[0]}getXForColumn(fe){return this.origin[0]+fe*this.norm[0]}getRowForY(fe){return(this.origin[1]-fe)/this.norm[1]}getYForRow(fe){return this.origin[1]-fe*this.norm[1]}getTileBounds(fe,ve,_e=!1){fue.set(ve);const be=_e?fue.col:this.denormalizeCol(fue.col,fue.world),we=fue.row;return function e$11(fe,ve,_e,be,we){return fe[0]=ve,fe[1]=_e,fe[2]=be,fe[3]=we,fe}(fe,this.getXForColumn(be),this.getYForRow(we+1),this.getXForColumn(be+1),this.getYForRow(we)),fe}getTileCoords(fe,ve,_e=!1){fue.set(ve);const be=_e?fue.col:this.denormalizeCol(fue.col,fue.world);return Array.isArray(fe)?i$1e(fe,this.getXForColumn(be),this.getYForRow(fue.row)):(fe.x=this.getXForColumn(be),fe.y=this.getYForRow(fue.row)),fe}},yue=class s63{constructor(){this.spans=[]}acquire(fe){this.lodInfo=fe}release(){this.lodInfo=null,this.spans.length=0}*keys(){const fe=this.lodInfo;for(const{row:ve,colFrom:_e,colTo:be}of this.spans)for(let we=_e;we<=be;we++){const _e=fe.getWorldForColumn(we);yield new pue(fe.level,ve,fe.normalizeCol(we),_e)}}forEach(fe,ve){const{spans:_e,lodInfo:be}=this,{level:we}=be;if(0!==_e.length)for(const{row:Se,colFrom:Te,colTo:Ee}of _e)for(let _e=Te;_e<=Ee;_e++)fe.call(ve,we,Se,be.normalizeCol(_e),be.getWorldForColumn(_e))}};yue.pool=new pr(yue);let gue=class o30{constructor(fe,ve,_e){this.row=fe,this.colFrom=ve,this.colTo=_e}};const vue=new pue("0/0/0/0");let _ue=class n37{static create(fe,ve){fe[1]>ve[1]&&([fe,ve]=[ve,fe]);const[_e,be]=fe,[we,Se]=ve,Te=we-_e,Ee=Se-be,Ce=0!==Ee?Te/Ee:0,Oe=(Math.ceil(be)-be)*Ce,Re=(Math.floor(be)-be)*Ce;return new n37(_e,Math.floor(be),Math.ceil(Se),Ce,Te<0?Oe:Re,Te<0?Re:Oe,Te<0?we:_e,Te<0?_e:we)}constructor(fe,ve,_e,be,we,Se,Te,Ee){this.x=fe,this.ymin=ve,this.ymax=_e,this.invM=be,this.leftAdjust=we,this.rightAdjust=Se,this.leftBound=Te,this.rightBound=Ee}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const $ue=[[0,0],[0,0],[0,0],[0,0]];let bue=class h23{constructor(fe,ve=null,_e=fe.lods[0].level,be=fe.lods[fe.lods.length-1].level){this.tileInfo=fe,this.fullExtent=ve,this.scales=[],this._infoByScale={},this._infoByLevel={};const we=fe.lods.filter((fe=>fe.level>=_e&&fe.level<=be));this.minScale=we[0].scale,this.maxScale=we[we.length-1].scale;const Se=this._lodInfos=we.map((_e=>mue.create(fe,_e,ve)));we.forEach(((fe,ve)=>{this._infoByLevel[fe.level]=Se[ve],this._infoByScale[fe.scale]=Se[ve],this.scales[ve]=fe.scale}),this),this._wrap=fe.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(fe){return this._infoByLevel["number"==typeof fe?fe:fe.level]}getTileBounds(fe,ve,_e=!1){vue.set(ve);const be=this._infoByLevel[vue.level];return be?be.getTileBounds(fe,vue,_e):fe}getTileCoords(fe,ve,_e=!1){vue.set(ve);const be=this._infoByLevel[vue.level];return be?be.getTileCoords(fe,vue,_e):fe}getTileCoverage(fe,ve=192,_e=!0,be="closest"){if(!_e&&(fe.scale>this.minScale||fe.scale<this.maxScale))return null;const we="closest"===be?this.getClosestInfoForScale(fe.scale):this.getSmallestInfoForScale(fe.scale),Se=yue.pool.acquire(we),Te=this._wrap;let Ee,Ce,Oe,Re=1/0,De=-1/0;const Be=Se.spans;$ue[0][0]=$ue[0][1]=$ue[1][1]=$ue[3][0]=-ve,$ue[1][0]=$ue[2][0]=fe.size[0]+ve,$ue[2][1]=$ue[3][1]=fe.size[1]+ve;for(const Qe of $ue)fe.toMap(Qe,Qe),Qe[0]=we.getColumnForX(Qe[0]),Qe[1]=we.getRowForY(Qe[1]);const Ze=[];let Xe=3;for(let Qe=0;Qe<4;Qe++){if($ue[Qe][1]===$ue[Xe][1]){Xe=Qe;continue}const fe=_ue.create($ue[Qe],$ue[Xe]);Re=Math.min(fe.ymin,Re),De=Math.max(fe.ymax,De),void 0===Ze[fe.ymin]&&(Ze[fe.ymin]=[]),Ze[fe.ymin].push(fe),Xe=Qe}if(null==Re||null==De||De-Re>100)return null;let Je=[];for(Ee=Re;Ee<De;){null!=Ze[Ee]&&(Je=Je.concat(Ze[Ee])),Ce=1/0,Oe=-1/0;for(let fe=Je.length-1;fe>=0;fe--){const ve=Je[fe];Ce=Math.min(Ce,ve.getLeftCol()),Oe=Math.max(Oe,ve.getRightCol())}if(Ce=Math.floor(Ce),Oe=Math.floor(Oe),Ee>=we.first[1]&&Ee<=we.last[1])if(Te)if(we.size[0]<we.worldSize[0]){const fe=Math.floor(Oe/we.worldSize[0]);for(let ve=Math.floor(Ce/we.worldSize[0]);ve<=fe;ve++)Be.push(new gue(Ee,Math.max(we.getFirstColumnForWorld(ve),Ce),Math.min(we.getLastColumnForWorld(ve),Oe)))}else Be.push(new gue(Ee,Ce,Oe));else Ce>we.last[0]||Oe<we.first[0]||(Ce=Math.max(Ce,we.first[0]),Oe=Math.min(Oe,we.last[0]),Be.push(new gue(Ee,Ce,Oe)));Ee+=1;for(let fe=Je.length-1;fe>=0;fe--){const ve=Je[fe];ve.ymax>=Ee?ve.incrRow():Je.splice(fe,1)}}return Se}getTileParentId(fe){vue.set(fe);const ve=this._infoByLevel[vue.level],_e=this._lodInfos.indexOf(ve)-1;return _e<0?null:(this._getTileIdAtLOD(vue,this._lodInfos[_e],vue),vue.id)}getTileResolution(fe){const ve=this._infoByLevel["object"==typeof fe?fe.level:fe];return ve?ve.resolution:-1}getTileScale(fe){const ve=this._infoByLevel[fe.level];return ve?ve.scale:-1}intersects(fe,ve){vue.set(ve);const _e=this._infoByLevel[vue.level],be=fe.lodInfo;if(be.resolution>_e.resolution){this._getTileIdAtLOD(vue,be,vue);const ve=be.denormalizeCol(vue.col,vue.world);for(const _e of fe.spans)if(_e.row===vue.row&&_e.colFrom<=ve&&_e.colTo>=ve)return!0}if(be.resolution<_e.resolution){const[ve,we,Se,Te]=fe.spans.reduce(((fe,ve)=>(fe[0]=Math.min(fe[0],ve.row),fe[1]=Math.max(fe[1],ve.row),fe[2]=Math.min(fe[2],ve.colFrom),fe[3]=Math.max(fe[3],ve.colTo),fe)),[1/0,-1/0,1/0,-1/0]),Ee=_e.denormalizeCol(vue.col,vue.world),Ce=be.getColumnForX(_e.getXForColumn(Ee)),Oe=be.getRowForY(_e.getYForRow(vue.row)),Re=be.getColumnForX(_e.getXForColumn(Ee+1))-1,De=be.getRowForY(_e.getYForRow(vue.row+1))-1;return!(Ce>Te||Re<Se||Oe>we||De<ve)}const we=be.denormalizeCol(vue.col,vue.world);return fe.spans.some((fe=>fe.row===vue.row&&fe.colFrom<=we&&fe.colTo>=we))}normalizeBounds(fe,ve,_e){if(fe[0]=ve[0],fe[1]=ve[1],fe[2]=ve[2],fe[3]=ve[3],this._wrap){const ve=s$46(this.tileInfo.spatialReference),be=-_e*(ve.valid[1]-ve.valid[0]);fe[0]+=be,fe[2]+=be}return fe}getSmallestInfoForScale(fe){const ve=this.scales;if(this._infoByScale[fe])return this._infoByScale[fe];if(fe>ve[0])return this._infoByScale[ve[0]];for(let _e=1;_e<ve.length-1;_e++)if(fe>ve[_e]+1e-6)return this._infoByScale[ve[_e-1]];return this._infoByScale[ve[ve.length-1]]}getClosestInfoForScale(fe){const ve=this.scales;return this._infoByScale[fe]||(fe=ve.reduce(((ve,_e)=>Math.abs(_e-fe)<Math.abs(ve-fe)?_e:ve),ve[0])),this._infoByScale[fe]}scaleToLevel(fe){const ve=this.scales;if(this._infoByScale[fe])return this._infoByScale[fe].level;for(let _e=ve.length-1;_e>=0;_e--)if(fe<ve[_e])return _e===ve.length-1?this._infoByScale[ve[ve.length-1]].level:this._infoByScale[ve[_e]].level+(ve[_e]-fe)/(ve[_e]-ve[_e+1]);return this._infoByScale[ve[0]].level}scaleToZoom(fe){return this.tileInfo.scaleToZoom(fe)}zoomToScale(fe){return this.tileInfo.zoomToScale(fe)}_getTileIdAtLOD(fe,ve,_e){const be=this._infoByLevel[_e.level];return fe.set(_e),ve.resolution<be.resolution?null:(ve.resolution===be.resolution||(fe.level=ve.level,fe.col=Math.floor(_e.col*be.resolution/ve.resolution+.01),fe.row=Math.floor(_e.row*be.resolution/ve.resolution+.01)),fe)}},wue=class l25{constructor(fe,ve){this.item=fe,this.controller=ve,this.promise=null}},xue=class _11{constructor(fe){this._schedule=null,this._task=null,this._deferreds=new UT,this._controllers=new UT,this._processingItems=new UT,this._pausedSignal=r$2W(!1),this.concurrency=1,fe.concurrency&&(this.concurrency=fe.concurrency),this._queue=new el(fe.peeker),this.process=fe.process;const ve=fe.scheduler;fe.priority&&ve&&(this._task=ve.registerTask(fe.priority,this))}destroy(){this.clear(),this._schedule=l$4E(this._schedule),this._task=l$4E(this._task)}get updating(){var fe;return!!(null==(fe=this._task)?void 0:fe.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(fe){const ve=this._controllers.get(fe);ve&&ve.abort()}clear(){this._queue.clear();const fe=[];this._controllers.forEach((ve=>fe.push(ve))),this._controllers.clear(),fe.forEach((fe=>fe.abort())),this._processingItems.clear(),this._cancelNext()}forEach(fe){this._deferreds.forEach(((ve,_e)=>fe(_e)))}get(fe){const ve=this._deferreds.get(fe);return ve?ve.promise:void 0}isOngoing(fe){return this._processingItems.has(fe)}has(fe){return this._deferreds.has(fe)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(fe,ve){const _e=this.get(fe);if(_e)return _e;const be=new AbortController;let we=null;ve&&(we=m$3R(ve,(()=>be.abort())));const l49=()=>{Se.remove(),null!=we&&we.remove(),this._removeItem(fe),this._queue.remove(fe),this._scheduleNext()},Se=w$22(be.signal,(()=>{const ve=this._processingItems.get(fe);ve&&ve.controller.abort(),l49(),Te.reject(u$47())})),Te=L$1h();return this._deferreds.set(fe,Te),this._controllers.set(fe,be),Te.promise.then(l49,l49),this._queue.push(fe),this._scheduleNext(),Te.promise}last(){return this._queue.last()}lastPromise(){const fe=this.last();return fe?this.get(fe):null}peek(){return this._queue.peek()}popLast(){var fe;const ve=this._queue.popLast();return ve&&(null==(fe=this._deferreds.get(ve))||fe.reject(u$47("Removed from queue")),this._removeItem(ve)),ve}reset(){const fe=[];this._processingItems.forEach((ve=>fe.push(ve))),this._processingItems.clear();for(const ve of fe)this._queue.push(ve.item),ve.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const fe=[];for(;this._queue.length;)fe.push(this._queue.pop());return this.clear(),fe}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(fe){for(;!fe.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),fe.madeProgress()}_removeItem(fe){this._deferreds.delete(fe),this._controllers.delete(fe),this._processingItems.delete(fe)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=v$27((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(fe,ve){this._canProcessFulfillment(fe)&&(this._scheduleNext(),this._deferreds.get(fe.item).resolve(ve))}_processError(fe,ve){this._canProcessFulfillment(fe)&&(this._scheduleNext(),this._deferreds.get(fe.item).reject(ve))}_canProcessFulfillment(fe){return!!this._deferreds.get(fe.item)&&this._processingItems.get(fe.item)===fe}_process(fe){if(null==fe)return;let ve;const _e=new AbortController,be=new wue(fe,_e);this._processingItems.set(fe,be);try{ve=this.process(fe,_e.signal)}catch(br){this._processError(be,br)}S$1T(ve)?(be.promise=ve,ve.then((fe=>this._processResult(be,fe)),(fe=>this._processError(be,fe)))):this._processResult(be,ve)}get test(){}};const Sue=new Set,Tue=[],Eue=new Map,Pue=[0,0];let Cue=class p33 extends zi{constructor(fe){super(fe),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:fe,process:ve,strategy:_e}=this;this._queue=new xue({concurrency:fe,process:(fe,_e)=>{const be=this._keyToItem.get(fe);return ve(be,{signal:_e})},peeker:"scale-first"===_e?fe=>this._peekByScaleFirst(fe):fe=>this._peekByCenterFirst(fe)})}destroy(){this.clear(),this._queue=u$4d(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(fe){const ve="string"==typeof fe?fe:fe.id;this._queue.abort(ve)}clear(){this._queue.clear(),this._keyToItem.clear()}has(fe){return"string"==typeof fe?this._keyToItem.has(fe):this._keyToItem.has(fe.id)}isOngoing(fe){const ve="string"==typeof fe?fe:fe.id;return this.has(ve)&&this._queue.isOngoing(ve)}pause(){this._queue.pause()}push(fe){const ve=fe.key.id;if(this._queue.has(ve))return this._queue.get(ve);const _e=this._queue.push(ve),r65=()=>{this._keyToItem.delete(ve)};return this._keyToItem.set(ve,fe),_e.then(r65,r65),_e}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(fe){if(!this.state)return fe.values().next().value;const ve=this.tileInfoView;let _e=Number.NEGATIVE_INFINITY,be=Number.POSITIVE_INFINITY;fe.forEach((fe=>{const ve=this._keyToItem.get(fe),we=this.tileInfoView.getTileScale(ve.key);Eue.has(we)||(Eue.set(we,[]),_e=Math.max(we,_e),be=Math.min(we,be)),Eue.get(we).push(ve.key),Sue.add(we)}));let we=this.state.scale;Eue.has(we)||(function c$1l(fe,ve){return fe.length=0,ve.forEach((ve=>fe.push(ve))),fe}(Tue,Sue),Tue.sort(((fe,ve)=>fe-ve)),we=Tue.reduce(((fe,ve)=>Math.abs(ve-we)<Math.abs(fe-we)?ve:fe),Tue[0])),we=Math.min(we,_e),we=Math.max(we,be);const Se=Eue.get(we),Te=ve.getClosestInfoForScale(we),Ee=Te.getColumnForX(this.state.center[0]),Ce=Te.getRowForY(this.state.center[1]);return Se.sort(((fe,ve)=>{const _e=Te.denormalizeCol(fe.col,fe.world),be=Te.denormalizeCol(ve.col,ve.world);return Math.sqrt((Ee-_e)*(Ee-_e)+(Ce-fe.row)*(Ce-fe.row))-Math.sqrt((Ee-be)*(Ee-be)+(Ce-ve.row)*(Ce-ve.row))})),Sue.clear(),Eue.clear(),Se[0].id}_peekByCenterFirst(fe){if(!this.state)return fe.values().next().value;const ve=this.tileInfoView,_e=this.state.center;let be,we=Number.POSITIVE_INFINITY;return fe.forEach((fe=>{const Se=this._keyToItem.get(fe);ve.getTileCoords(Pue,Se.key);const Te=m$2r(Pue,_e);Te<we&&(we=Te,be=Se.key)})),be.id}};e$4o([y$2v({constructOnly:!0})],Cue.prototype,"concurrency",void 0),e$4o([y$2v({constructOnly:!0})],Cue.prototype,"process",void 0),e$4o([y$2v()],Cue.prototype,"state",void 0),e$4o([y$2v({constructOnly:!0})],Cue.prototype,"strategy",void 0),e$4o([y$2v({constructOnly:!0})],Cue.prototype,"tileInfoView",void 0),Cue=e$4o([a$4y("esri.views.2d.tiling.TileQueue")],Cue),new pue(0,0,0,0);let Oue=class t60{constructor(fe,ve){this.sourceTile=ve,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=fe}},Aue=class s64{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function o$Q(fe,ve,_e,be,we,Se){const Te=_e-we;if(Te>=0)return(ve>>Te)+(be-(Se<<Te))*(fe>>Te);const Ee=-Te;return ve-(Se-(be<<Ee))*(fe>>Ee)<<Ee}let Mue=class i38{constructor(fe,ve,_e){this._rows=Math.ceil(ve/_e),this._columns=Math.ceil(fe/_e),this._cellSize=_e,this.cells=new Array(this._rows);for(let be=0;be<this._rows;be++){this.cells[be]=new Array(this._columns);for(let fe=0;fe<this._columns;fe++)this.cells[be][fe]=[]}}getCell(fe,ve){const _e=Math.min(Math.max(Math.floor(ve/this._cellSize),0),this._rows-1),be=Math.min(Math.max(Math.floor(fe/this._cellSize),0),this._columns-1);return this.cells[_e]&&this.cells[_e][be]||null}getCellSpan(fe,ve,_e,be){return[Math.min(Math.max(Math.floor(fe/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(ve/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(_e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(be/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function n$1h(fe,ve,_e,be,we){const Se=fe.layerData.get(we);if(Se.type===uue.SYMBOL){for(const ve of be){const _e=ve.unique;let be;if(ve.selectedForRendering){const ve=_e.parts[0];ve.startOpacity;const we=ve.targetOpacity;fe.allSymbolsFadingOut=fe.allSymbolsFadingOut&&0===we;const Se=we?255:0;be=Se<<24|Se<<16|Se<<8|Se}else be=0;for(const[fe,we]of ve.iconVertexRanges)for(let ve=fe;ve<fe+we;ve+=4)Se.iconOpacity[ve/4]=be;if(ve.selectedForRendering){const ve=_e.parts[1];ve.startOpacity;const we=ve.targetOpacity;fe.allSymbolsFadingOut=fe.allSymbolsFadingOut&&0===we;const Se=we?255:0;be=Se<<24|Se<<16|Se<<8|Se}else be=0;for(const[fe,we]of ve.textVertexRanges)for(let ve=fe;ve<fe+we;ve+=4)Se.textOpacity[ve/4]=be}Se.lastOpacityUpdate=ve,Se.opacityChanged=!0}}function c$1k(fe,ve,_e,be){const we=fe.colliders;let Se,Te,Ee,Ce;for(const Oe of we)if(fe.unique.show&&fe.unique.parts[Oe.partIndex].show&&(Se=Oe.xScreen-be[0]+Oe.dxScreen,Te=Oe.yScreen-be[1]+Oe.dyScreen,Ee=Se+Oe.width,Ce=Te+Oe.height,w$Q(_e,ve.x,ve.y,Se,Te,Ee,Ce)))return!0;return!1}let Rue=class h24{constructor(fe,ve){this.layerUIDs=[],this.isDestroyed=!1,this._data=fe;let _e=1;const be=new Uint32Array(fe);this.layerUIDs=[];const we=be[_e++];for(let Se=0;Se<we;Se++)this.layerUIDs[Se]=be[_e++];this.bufferDataOffset=_e,ve&&(this.layer=ve.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(fe){null!=this._data&&(this.doPrepareForRendering(fe,this._data,this.bufferDataOffset),this._data=null)}},Iue=class f15 extends Rue{constructor(fe,ve){super(fe,ve),this.type=uue.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const _e=new Uint32Array(fe);let be=this.bufferDataOffset;this.lineIndexStart=_e[be++],this.lineIndexCount=_e[be++];const we=_e[be++];if(we>0){this.patternMap=new Map;for(let fe=0;fe<we;fe++){const fe=_e[be++],ve=_e[be++],we=_e[be++];this.patternMap.set(fe,[ve,we])}}this.bufferDataOffset=be}get memoryUsed(){var fe,ve;return((null==(fe=this.data)?void 0:fe.byteLength)??0)+((null==(ve=this.vao)?void 0:ve.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=r$3M(this.vao)}doPrepareForRendering(fe,ve,_e){const be=new Uint32Array(ve),we=new Int32Array(be.buffer),Se=be[_e++],Te=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Se));_e+=Se;const Ee=be[_e++],Ce=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,Ee));_e+=Ee;const Oe=this.layer.lineMaterial;this.vao=new eM(fe,Oe.getAttributeLocations(),Oe.getLayoutInfo(),{geometry:Te},Ce)}},Lue=class l26 extends Rue{constructor(fe,ve){super(fe,ve),this.type=uue.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const _e=new Uint32Array(fe);let be=this.bufferDataOffset;this.fillIndexStart=_e[be++],this.fillIndexCount=_e[be++],this.outlineIndexStart=_e[be++],this.outlineIndexCount=_e[be++];const we=_e[be++];if(we>0){this.patternMap=new Map;for(let fe=0;fe<we;fe++){const fe=_e[be++],ve=_e[be++],we=_e[be++];this.patternMap.set(fe,[ve,we])}}this.bufferDataOffset=be}get memoryUsed(){var fe,ve,_e;return((null==(fe=this.data)?void 0:fe.byteLength)??0)+((null==(ve=this.fillVAO)?void 0:ve.usedMemory)??0)+((null==(_e=this.outlineVAO)?void 0:_e.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=r$3M(this.fillVAO),this.outlineVAO=r$3M(this.outlineVAO)}doPrepareForRendering(fe,ve,_e){const be=new Uint32Array(ve),we=new Int32Array(be.buffer),Se=be[_e++],Te=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Se));_e+=Se;const Ee=be[_e++],Ce=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,Ee));_e+=Ee;const Oe=be[_e++],Re=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Oe));_e+=Oe;const De=be[_e++],Be=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,De));_e+=De;const Ze=this.layer,Xe=Ze.fillMaterial,Je=Ze.outlineMaterial;this.fillVAO=new eM(fe,Xe.getAttributeLocations(),Xe.getLayoutInfo(),{geometry:Te},Ce),this.outlineVAO=new eM(fe,Je.getAttributeLocations(),Je.getLayoutInfo(),{geometry:Re},Be)}},Due=class c38 extends Rue{constructor(fe,ve,_e){super(fe,ve),this.type=uue.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const be=new Uint32Array(fe),we=new Int32Array(fe),Se=new Float32Array(fe);let Te=this.bufferDataOffset;this.isIconSDF=!!be[Te++];const Ee=be[Te++],Ce=be[Te++],Oe=be[Te++],Re=new pue(Ee,Ce,Oe,0),De=be[Te++];for(let Je=0;Je<De;Je++){const fe=be[Te++],ve=be[Te++],_e=be[Te++];this.iconPerPageElementsMap.set(fe,[ve,_e])}const Be=be[Te++];for(let Je=0;Je<Be;Je++){const fe=be[Te++],ve=be[Te++],_e=be[Te++];this.glyphPerPageElementsMap.set(fe,[ve,_e])}const Ze=be[Te++],Xe=be[Te++];this.iconOpacity=new Int32Array(Ze),this.textOpacity=new Int32Array(Xe),Te=function l$1i(fe,ve,_e,be,we,Se,Te){const Ee=ve[be++];for(let Ce=0;Ce<Ee;Ce++){const Ee=new Oue(Se,Te);Ee.xTile=ve[be++],Ee.yTile=ve[be++],Ee.hash=ve[be++],Ee.priority=ve[be++],Ee.featureIndex=ve[be++];const Ce=ve[be++];for(let fe=0;fe<Ce;fe++){const fe=ve[be++],we=ve[be++],Se=ve[be++],Te=ve[be++],Ce=!!ve[be++],Oe=ve[be++],Re=_e[be++],De=_e[be++],Be=ve[be++],Ze=ve[be++];Ee.colliders.push({xTile:fe,yTile:we,dxPixels:Se,dyPixels:Te,hard:Ce,partIndex:Oe,width:Be,height:Ze,minLod:Re,maxLod:De})}const Oe=fe[be++];for(let ve=0;ve<Oe;ve++)Ee.textVertexRanges.push([fe[be++],fe[be++]]);const Re=fe[be++];for(let ve=0;ve<Re;ve++)Ee.iconVertexRanges.push([fe[be++],fe[be++]]);we.push(Ee)}return be}(be,we,Se,Te,this.symbols,_e,Re),this.bufferDataOffset=Te}get memoryUsed(){var fe,ve,_e;return((null==(fe=this.data)?void 0:fe.byteLength)??0)+((null==(ve=this.iconVAO)?void 0:ve.usedMemory)??0)+((null==(_e=this.textVAO)?void 0:_e.usedMemory)??0)+A$1L(this.iconOpacity)+A$1L(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let fe=0;for(const[ve,_e]of this.iconPerPageElementsMap)fe+=_e[1];for(const[ve,_e]of this.glyphPerPageElementsMap)fe+=_e[1];return fe/3}doDestroy(){this.iconVAO=r$3M(this.iconVAO),this.textVAO=r$3M(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const fe=this.iconOpacity,ve=this.iconVAO.vertexBuffers.opacity;fe.length>0&&fe.byteLength===ve.usedMemory&&ve.setSubData(fe,0,0,fe.length);const _e=this.textOpacity,be=this.textVAO.vertexBuffers.opacity;_e.length>0&&_e.byteLength===be.usedMemory&&be.setSubData(_e,0,0,_e.length)}doPrepareForRendering(fe,ve,_e){const be=new Uint32Array(ve),we=new Int32Array(be.buffer),Se=be[_e++],Te=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Se));_e+=Se;const Ee=be[_e++],Ce=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,Ee));_e+=Ee;const Oe=be[_e++],Re=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Oe));_e+=Oe;const De=be[_e++],Be=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,De));_e+=De;const Ze=rM.createVertex(fe,QO.STATIC_DRAW,this.iconOpacity.buffer),Xe=rM.createVertex(fe,QO.STATIC_DRAW,this.textOpacity.buffer),Je=this.layer,Qe=Je.iconMaterial,dt=Je.textMaterial;this.iconVAO=new eM(fe,Qe.getAttributeLocations(),Qe.getLayoutInfo(),{geometry:Te,opacity:Ze},Ce),this.textVAO=new eM(fe,dt.getAttributeLocations(),dt.getLayoutInfo(),{geometry:Re,opacity:Xe},Be)}},Nue=class u20 extends Rue{constructor(fe,ve){super(fe,ve),this.type=uue.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const _e=new Uint32Array(fe);let be=this.bufferDataOffset;this.circleIndexStart=_e[be++],this.circleIndexCount=_e[be++],this.bufferDataOffset=be}get memoryUsed(){var fe,ve;return((null==(fe=this.data)?void 0:fe.byteLength)??0)+((null==(ve=this.vao)?void 0:ve.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=r$3M(this.vao)}doPrepareForRendering(fe,ve,_e){const be=new Uint32Array(ve),we=new Int32Array(be.buffer),Se=be[_e++],Te=rM.createVertex(fe,QO.STATIC_DRAW,new Int32Array(we.buffer,4*_e,Se));_e+=Se;const Ee=be[_e++],Ce=rM.createIndex(fe,QO.STATIC_DRAW,new Uint32Array(be.buffer,4*_e,Ee));_e+=Ee;const Oe=this.layer.circleMaterial;this.vao=new eM(fe,Oe.getAttributeLocations(),Oe.getLayoutInfo(),{geometry:Te},Ce)}};const Fue=!0,zue=200;let kue=class s65 extends La{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(fe){this._clips=fe,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(fe){this._opacity!==fe&&(this._opacity=Math.min(1,Math.max(fe,0)),this.requestRender())}get stage(){return this._stage}set stage(fe){var ve;if(this._stage===fe)return;const _e=this._stage;this._stage=fe,fe?(null==(ve=this._stage)?void 0:ve.untrashDisplayObject(this))||(this.onAttach(),this.emit("attach")):null==_e||_e.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(fe){this._visible!==fe&&(this._visible=fe,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=L$1h(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=L$1h(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var fe,ve;null==(fe=this._fadeInResolver)||fe.call(this),this._fadeInResolver=null,null==(ve=this._fadeOutResolver)||ve.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(fe){this.updateTransitionProperties(fe.deltaTime,fe.state.scale),this.setTransform(fe.state)}afterRender(fe){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var fe;null==(fe=this.parent)||fe.removeChild(this)}setTransform(fe){}processRender(fe){this.stage&&this.computedVisible&&this.doRender(fe)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(fe,ve){const _e=0===has("mapview-transitions-duration")?0:1/has("mapview-transitions-duration");if(this.fadeTransitionEnabled&&0!==_e){const ve=this._fadeOutResolver||!this.visible?0:this.opacity,be=this.computedOpacity;if(be===ve)this.computedVisible=this.visible;else{const we=fe*_e;this.computedOpacity=be>ve?Math.max(ve,be-we):Math.min(ve,be+we),this.computedVisible=this.computedOpacity>0;const Se=ve===this.computedOpacity;this.inFadeTransition=!Se,Se||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(fe){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},Uue=class r48 extends kue{constructor(fe,ve,_e,be,we,Se,Te=we,Ee=Se){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new pue(fe),this.resolution=ve,this.x=_e,this.y=be,this.width=we,this.height=Se,this.rangeX=Te,this.rangeY=Ee}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let fe=this;for(;fe.parent!==this._stage;){if(!fe.parent)return 0;fe=fe.parent}return this._stage.children.indexOf(fe)}setTransform(fe){const ve=this.resolution/(fe.resolution*fe.pixelRatio),_e=this.transforms.tileMat3,[be,we]=fe.toScreenNoRotation([0,0],[this.x,this.y]);r$2_(_e,this.width/this.rangeX*ve,0,0,0,this.height/this.rangeY*ve,0,be,we,1),i$3X(this.transforms.displayViewScreenMat3,fe.displayViewMat3,_e)}get destroyed(){return this._destroyed}},Vue=class d22 extends Uue{constructor(fe,ve,_e,be,we,Se,Te,Ee=null){super(fe,ve,_e,be,we,Se,4096,4096),this.styleRepository=Te,this._memCache=Ee,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=fe.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<zue}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<zue)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(fe){this.changeDataImpl(fe),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(fe){var ve,_e;let be=!1;for(const we of fe){const fe=this.layerData.get(we);fe&&(this._memoryUsedByLayerData-=fe.memoryUsed,fe.type===uue.SYMBOL&&this.symbols.delete(we)&&(be=!0),fe.destroy(),this.layerData.delete(we))}null==(ve=this._memCache)||ve.updateSize(this.key.id,this,this._memoryUsedByLayerData),be&&(null==(_e=this.featureIndex)||_e.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,Bue.delete(this),d22._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(fe){var ve,_e;null==(ve=this.featureIndex)||ve.clear();let be=!1;if(fe){const{bucketsWithData:ve,emptyBuckets:we}=fe,Se=this._createRenderBuckets(ve);if(we&&we.byteLength>0){const fe=new Uint32Array(we);for(const ve of fe)this._deleteLayerData(ve)}for(const[fe,_e]of Se)this._deleteLayerData(fe),_e.type===uue.SYMBOL&&(this.symbols.set(fe,_e.symbols),be=!0),this._memoryUsedByLayerData+=_e.memoryUsed,this.layerData.set(fe,_e);null==(_e=this._memCache)||_e.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[we,Se]of this.layerData)Se.type===uue.SYMBOL&&(this._hasSymbolBuckets=!0);be&&this.emit("symbols-changed")}attachWithContext(fe){this.stage={context:fe,trashDisplayObject(fe){fe.processDetach()},untrashDisplayObject:()=>!1}}setTransform(fe){super.setTransform(fe);const ve=this.resolution/(fe.resolution*fe.pixelRatio),_e=this.width/this.rangeX*ve,be=this.height/this.rangeY*ve,we=[0,0];fe.toScreen(we,[this.x,this.y]);const Se=this.transforms.tileUnitsToPixels;o$3o(Se),M$1f(Se,Se,we),h$2r(Se,Se,Math.PI*fe.rotation/180),f$2D(Se,Se,[_e,be,1])}_createTransforms(){return{displayViewScreenMat3:e$13(),tileMat3:e$13(),tileUnitsToPixels:e$13()}}static _destroyRenderBuckets(fe){if(!fe)return;const ve=new Set;for(const _e of fe.values())ve.has(_e)||(_e.destroy(),ve.add(_e));fe.clear()}_createRenderBuckets(fe){const ve=new Map,_e=new Map;for(const be of fe){const fe=this._deserializeBucket(be,_e);for(const _e of fe.layerUIDs)ve.set(_e,fe)}return ve}_deserializeBucket(fe,ve){let _e=ve.get(fe);if(_e)return _e;switch(new Uint32Array(fe)[0]){case uue.FILL:_e=new Lue(fe,this.styleRepository);break;case uue.LINE:_e=new Iue(fe,this.styleRepository);break;case uue.SYMBOL:_e=new Due(fe,this.styleRepository,this);break;case uue.CIRCLE:_e=new Nue(fe,this.styleRepository)}return ve.set(fe,_e),_e}_deleteLayerData(fe){if(!this.layerData.has(fe))return;const ve=this.layerData.get(fe);this._memoryUsedByLayerData-=ve.memoryUsed,ve.destroy(),this.layerData.delete(fe)}};const Bue=new Map;let jue=class e54{constructor(fe="scene"){this.context=fe,this.extent=D$19()}};const Gue={value:.5,readOnly:!0},Hue={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let que=class s66{constructor(fe=0,ve=0){this.min=fe,this.max=ve,this.level=0,this.hasNoDataValues=!1}copyFrom(fe){this.min=fe.min,this.max=fe.max,this.level=fe.level,this.hasNoDataValues=fe.hasNoDataValues}},Wue=class t61{constructor(fe,ve){this.data=fe,this.safeWidth=.99999999*(fe.width-1),this.dx=(fe.width-1)/(ve[2]-ve[0]),this.dy=(fe.width-1)/(ve[3]-ve[1]),this.x0=ve[0],this.y1=ve[3]}},Yue=class r49{constructor(fe,ve,_e){this.type="elevation",this.level=fe[0],this.i=fe[1],this.j=fe[2],this.extent=ve,this.samplerData=new Wue(_e,ve)}computeMinMaxValue(fe,ve,_e,be){be.min=1/0,be.max=-1/0,be.hasNoDataValues=!1;const we=fe-this.level;if(we<=0)return be;const Se=2**we;if(Math.floor(ve/Se)!==this.i||Math.floor(_e/Se)!==this.j)return be;let Te=1/0,Ee=-1/0;const Ce=this.samplerData.data.width,Oe=this.samplerData.data.values,Re=.5*qg;let De=(Ce-1)/Se,Be=(_e-this.j*Se)*De,Ze=(ve-this.i*Se)*De;if(De<1){const fe=Math.floor(Be),ve=Math.floor(Ze),_e=fe+ve*Ce,we=Oe[_e],Se=Oe[_e+1],Te=Oe[_e+Ce],Ee=Oe[_e+Ce+1];if(we+Se+Te+Ee<Re){const _e=Be-fe,Ce=Ze-ve,Oe=p$4w(we,Se,Te,Ee,_e,Ce),Re=p$4w(we,Se,Te,Ee,_e+De,Ce),Xe=p$4w(we,Se,Te,Ee,_e,Ce+De),Je=p$4w(we,Se,Te,Ee,_e+De,Ce+De);return be.min=Math.min(Oe,Re,Xe,Je),be.max=Math.max(Oe,Re,Xe,Je),be}Be=fe,Ze=ve,De=1}else Be=Math.floor(Be),Ze=Math.floor(Ze),De=Math.ceil(De);for(let Xe=Be;Xe<=Be+De;Xe++)for(let fe=Ze;fe<=Ze+De;fe++){const ve=Oe[Xe+fe*Ce];ve<Re?(Te=Math.min(Te,ve),Ee=Math.max(Ee,ve)):be.hasNoDataValues=!0}return be.min=Te,be.max=Ee,be}};const Zue=.5*qg;function e$Z(fe,ve,_e){if(null==_e)return null;for(const be of _e){if(!be)continue;const _e=be.safeWidth;let we=e$3Y(be.dy*(be.y1-ve),0,_e),Se=e$3Y(be.dx*(fe-be.x0),0,_e);const Te=Math.floor(we),Ee=Math.floor(Se),Ce=be.data.width,Oe=Te*Ce+Ee,Re=be.data.values,De=Re[Oe],Be=Re[Oe+1],Ze=Oe+Ce,Xe=Re[Ze],Je=Re[Ze+1];if(De+Xe+Be+Je<Zue){we-=Te,Se-=Ee;const fe=De+(Be-De)*Se;return fe+(Xe+(Je-Xe)*Se-fe)*we}}return null}var Xue;function o$O(fe){return i$1a(fe)||f$3b(fe)||p$4U(fe)}function i$1a(fe){return C$1p(fe)||k$1w(fe)}!function(fe){fe[fe.NORTH=0]="NORTH",fe[fe.NORTH_EAST=1]="NORTH_EAST",fe[fe.EAST=2]="EAST",fe[fe.SOUTH_EAST=3]="SOUTH_EAST",fe[fe.SOUTH=4]="SOUTH",fe[fe.SOUTH_WEST=5]="SOUTH_WEST",fe[fe.WEST=6]="WEST",fe[fe.NORTH_WEST=7]="NORTH_WEST"}(Xue||(Xue={}));const Jue=[0,0,0],Que=[0,0,0],Kue=[0,0,0],ehe=[0,0,0];function v$q(fe,ve,_e,be){r$3w(Jue,_e),Jue[be]=ve[be];const we=e$3Z(Jue,Jue,ve),Se=P$1g(e$3Z(Que,fe,ve),we),Te=P$1g(we,we);let Ee;Ee=Se<=0?ve:Te<=Se?_e:u$3Y(Jue,ve,g$2z(we,we,Se/Te));const Ce=e$3Z(Jue,fe,Ee);return Math.PI/2-Math.atan(Ce[2]/Math.sqrt(Ce[0]*Ce[0]+Ce[1]*Ce[1]))}const the=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function w$u(fe,ve,_e,be){if(null==fe)return x$1n();const we=fe.spatialReference;if(we.isGeographic&&!i$1a(we))return new Ir("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const Se=Bg.checkUnsupported(fe);if(null!=Se)return Se;if(null==_e)return new Ir("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const Te=function T$e(fe,ve){const _e=fe.lods,be=_e[0].resolution*2**_e[0].level,we=[be*fe.size[0],be*fe.size[1]],Se=[fe.origin.x,fe.origin.y],Te=o$3R(ve),Ee=u$3J();Bg.computeRowColExtent(Te,we,Se,Ee);const Ce=(Ee[2]-Ee[0])*(Ee[3]-Ee[1]);if(Ce>Gg){const ve=_e[0].scale*2**_e[0].level;let we=Math.max((Te[3]-Te[1])/fe.size[1],(Te[2]-Te[0])/fe.size[0])*ve/be;const Se=Math.floor(Math.log(we)/Math.log(10));return we=Math.ceil(we/10**Se)*10**Se,new Ir("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(ve).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+we.toLocaleString()+".",{level0Scale:ve,suggestedLevel0Scale:we,requiredNumRootTiles:Ce,allowedNumRootTiles:Gg})}return null}(fe,_e);return Te||(null==ve||we.equals(ve)||ve.isWGS84&&we.isWebMercator?null:new Ir("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"))},isInsideExtent:function S$o(fe,ve,_e=0){const be=fe.extent;return null!=be&&(0===_e?b$28(be,ve):function q$_(fe,ve,_e){return ve[0]>=fe[0]-_e&&ve[1]>=fe[1]-_e&&ve[0]<=fe[2]+_e&&ve[1]<=fe[3]+_e}(be,ve,_e*Math.min(be[2]-be[0],be[3]-be[1])))},tiltToExtentEdge:function j$n(fe,ve,_e){const be=fe.extent;if(null==be)return 0;Kue[0]=be[0],Kue[1]=be[1],Kue[2]=_e,ehe[0]=be[2],ehe[1]=be[3],ehe[2]=_e;let we=1/0,Se=1/0;return ve[0]<Kue[0]?we=v$q(ve,Kue,ehe,0):ve[0]>ehe[0]&&(we=v$q(ve,ehe,Kue,0)),ve[1]<Kue[1]?Se=v$q(ve,Kue,ehe,1):ve[1]>ehe[1]&&(Se=v$q(ve,ehe,Kue,1)),Math.min(we,Se)}},Symbol.toStringTag,{value:"Module"}));const rhe=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function o$N(fe,ve,_e,be){if(null==fe)return x$1n();const we=(null==fe?void 0:fe.lods.length)-1,Se=fe.spatialReference;if(Se.isWebMercator){if(!Bg.makeWebMercatorAuxiliarySphere(we).compatibleWith(fe,be))return new Ir("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!o$O(Se))return new Ir("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Bg.makeGCSWithTileSize(fe.spatialReference,fe.size[0],we).compatibleWith(fe,be))return fe.spatialReference.isWGS84?new Ir("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new Ir("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==ve||fe.spatialReference.equals(ve)?null:new Ir("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")},isInsideExtent:function l$1g(){return!0},tiltToExtentEdge:function r$L(){return 0}},Symbol.toStringTag,{value:"Module"})),ihe={[Wf.Global]:rhe,[Wf.Local]:the};let nhe=!1,she=!1;function O$j(fe,ve){var _e;if(nhe&&!fe){null==(_e=(new Error).stack)||_e.slice(5);throw new Error("Assertion failed"+(ve?": "+ve:""))}}function y$A(fe){return I$h(fe)?{fullExtent:fe.fullExtent,minScale:fe.layer.minScale,maxScale:fe.layer.maxScale,tilemapCache:null}:fe.layer}function _$n(fe){return"imagery-tile"===(null==fe?void 0:fe.type)||"wcs"===(null==fe?void 0:fe.type)}function I$h(fe){return"imagery-tile-3d"===(null==fe?void 0:fe.type)}function R$j(fe){return"tile-3d"===(null==fe?void 0:fe.type)}function d$P(fe){return"vector-tile-3d"===(null==fe?void 0:fe.type)}function N$i(fe){return"wmts-3d"===(null==fe?void 0:fe.type)}function U$f(fe){return"elevation-3d"===(null==fe?void 0:fe.type)}function x$k(fe){return"group"===(null==fe?void 0:fe.type)}function A$o(fe){return fe&&(R$j(fe)||N$i(fe)||I$h(fe)||d$P(fe))}function h$D(fe){return fe&&(R$j(fe)||I$h(fe)||d$P(fe)||N$i(fe))}function L$d(fe){return h$D(fe)||U$f(fe)}function g$E(fe){var ve;return e$17(null==(ve=null==fe?void 0:fe.sourceLayerInfo)?void 0:ve.data)}function w$t(fe){return v$p(null==fe?void 0:fe.sourceLayerInfo)||!!(null==fe?void 0:fe.isVTLBackground)}function v$p(fe){return t$1i(null==fe?void 0:fe.data)}function b$v(fe){return null!=fe&&"release"in fe&&fe.release(),null}function M$h(fe){return fe.fetchTile&&!1!==fe.hasOverriddenFetchTile}function V$g(fe,ve,_e,be,we){return ihe[be].checkIfTileInfoSupportedForViewSR(fe,_e,ve,we)}function k$f(fe,ve,_e){var be;let we=null,Se=null;if("wmts"===(null==fe?void 0:fe.type)){const be=function F$g(fe,ve,_e){const be=M$1g(fe);if(null!=be){if(!Wa.isCollection(be))return{tileInfo:be.tileInfo,fullExtent:be.fullExtent};{const fe=be.find((fe=>null==V$g(fe.tileInfo,fe.fullExtent,ve,_e)));if(fe)return{tileInfo:fe.tileInfo,fullExtent:fe.fullExtent}}}return{tileInfo:null,fullExtent:null}}(fe,ve,_e);we=be.tileInfo,Se=be.fullExtent}else{Se=_$n(fe)?fe.getCompatibleFullExtent(ve):fe.fullExtent;const be=_e===Wf.Local;we=_$n(fe)?fe.getCompatibleTileInfo(ve,Se,be):"vector-tile"===(null==fe?void 0:fe.type)?be&&!D$f(ve)||ohe.force512VTL?fe.tileInfo:fe.tileInfo.getCompatibleForVTL(256):fe.tileInfo}const Te="tilemapCache"in fe?null==(be=fe.tilemapCache)?void 0:be.effectiveMaxLOD:void 0;return null!=we&&null!=Se&&null==V$g(we,Se,ve,_e,Te)?{tileInfo:we,fullExtent:Se}:null}function D$f(fe){return fe.isWGS84||fe.isWebMercator||k$1w(fe)||!P$1b(fe)}const ohe={force512VTL:!1};function B$d(fe){return"["+fe[0]+","+fe[1]+","+fe[2]+"]"}function P$e(fe){return"("+fe[0]+","+fe[1]+","+fe[2]+")"}function q$d(fe,ve,_e=che){return Math.abs(fe-ve)<_e}function z$b(fe){return fe===Xue.NORTH_EAST?Xue.SOUTH_WEST:fe===Xue.NORTH_WEST?Xue.SOUTH_EAST:fe===Xue.SOUTH_WEST?Xue.NORTH_EAST:Xue.NORTH_WEST}function J$5(fe){return fe===Xue.NORTH?Xue.SOUTH:fe===Xue.EAST?Xue.WEST:fe===Xue.SOUTH?Xue.NORTH:Xue.EAST}function X$6(fe){return fe===Xue.NORTH_WEST||fe===Xue.WEST||fe===Xue.SOUTH_WEST}function Y$4(fe){return fe===Xue.NORTH_EAST||fe===Xue.EAST||fe===Xue.SOUTH_EAST}function Z$6(fe){return fe===Xue.SOUTH_EAST||fe===Xue.SOUTH||fe===Xue.SOUTH_WEST}function $$6(fe){return fe===Xue.NORTH_EAST||fe===Xue.NORTH||fe===Xue.NORTH_WEST}const ahe=[Xue.NORTH,Xue.EAST,Xue.SOUTH,Xue.WEST],lhe=[Xue.NORTH_EAST,Xue.SOUTH_EAST,Xue.SOUTH_WEST,Xue.NORTH_WEST],che=1e-5;let uhe=class x10 extends zi{constructor(fe){super(fe)}initialize(){this.addHandles([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const fe=[];return this.layerViews.forEach((ve=>{const _e=ve.layer;if("operationalLayerType"in _e&&function d$2X(fe){return"IntegratedMeshLayer"===fe||"IntegratedMesh3DTilesLayer"===fe}(_e.operationalLayerType)&&null!=this.viewSpatialReference){const ve=L$c(_e.fullExtent,this.viewSpatialReference);null!=ve&&fe.push(o$3R(ve))}})),fe}};e$4o([y$2v({readOnly:!0})],uhe.prototype,"layerViewsExtent",null),e$4o([y$2v({readOnly:!0})],uhe.prototype,"tiledLayersExtent",null),e$4o([y$2v({readOnly:!0})],uhe.prototype,"stencilEnabledExtents",null),e$4o([y$2v()],uhe.prototype,"viewSpatialReference",void 0),e$4o([y$2v()],uhe.prototype,"tilingScheme",void 0),e$4o([y$2v()],uhe.prototype,"defaultTiledLayersExtent",void 0),e$4o([y$2v({constructOnly:!0})],uhe.prototype,"layers",void 0),e$4o([y$2v({constructOnly:!0})],uhe.prototype,"layerViews",void 0),uhe=e$4o([a$4y("esri.views.3d.terrain.ExtentHelper")],uhe);let hhe=class w5 extends uhe{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Wg:Yg}};hhe=e$4o([a$4y("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],hhe);let dhe=class g18 extends uhe{_computeLayerViewsExtent(){const fe=D$19(),ve=this.viewSpatialReference;this.layerViews.forEach((_e=>{const be=_e.layer;if(_e.isResolved()&&("graphics"!==be.type||!be.internal)){const be=L$c("fullExtentInLocalViewSpatialReference"in _e&&_e.fullExtentInLocalViewSpatialReference||_e.layer.fullExtent,ve);m$3A(fe,be,fe)}}));const _e=x$1N(fe)?fe:null,be=this._get("layerViewsExtent");return I$1y(_e,be)?be:_e}_computeTiledLayersExtent(){const fe=this.tilingScheme;if(!fe)return null;const ve=this.viewSpatialReference,_e=D$19();this.layers.forEach((be=>{var we;if(be.loaded&&y$1_(be)){const Se=k$f(be,ve,Wf.Local);if(null==Se)return;const{tileInfo:Te,fullExtent:Ee}=Se,Ce="tilemapCache"in be?null==(we=be.tilemapCache)?void 0:we.effectiveMaxLOD:void 0;null!=Te&&null!=Ee&&(_$n(be)||fe.compatibleWith(Te,Ce)&&Ee.spatialReference.equals(fe.spatialReference))&&m$3A(_e,Ee,_e)}})),m$3A(_e,this.defaultTiledLayersExtent,_e);const be=x$1N(_e)?_e:null,we=this._get("tiledLayersExtent");return I$1y(be,we)?we:be}};function L$c(fe,ve){return null==fe||fe.spatialReference.equals(ve)?fe:Q$F(fe,fe.spatialReference,ve)}function e$Y(){var fe;const ve=null==(fe=globalThis.require)?void 0:fe.modules;if(ve){const fe=Object.keys(ve);for(const _e of fe)_e.includes(".glsl")&&delete ve[_e]}}dhe=e$4o([a$4y("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],dhe);const phe=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let fhe,mhe=class ne extends zi{constructor(fe){super(fe),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=has("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const fe=this.view;this.renderer=new IJ({view:fe,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),fe._stage.renderer.plugins.add(this.renderer);const t84=()=>this.setDrawTexturesDirty();this._groundIntersector=T$15(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([d$3d((()=>this.renderer.hasHighlights),t84),this.renderer.events.on("has-water",(ve=>{var _e;return null==(_e=fe._stage)?void 0:_e.renderer.setParameters({hasOverlayWater:ve})})),this.renderer.events.on("content-changed",t84),d$3d((()=>fe.state.camera.pixelRatio),t84),d$3d((()=>fe.state.alignPixelEnabled),t84),this.renderer.events.on("textures-disposed",(()=>this.surface.requestRender())),d$3d((()=>{var ve,_e,be;return[null==(ve=fe.pointsOfInterest)?void 0:ve.renderPointOfView,null==(be=null==(_e=fe.pointsOfInterest)?void 0:_e.centerOnSurfaceFrequent)?void 0:be.location]}),(()=>this.setPlacementDirty())),d$3d((()=>{var ve,_e;return[null==(ve=fe.state)?void 0:ve.pixelRatio,null==(_e=fe.state)?void 0:_e.contentPixelRatio]}),(()=>this.setPlacementDirty()),Za),this.surface.on("elevation-change",(()=>this.setPlacementDirty())),fe.on("resize",(()=>this.setPlacementDirty())),fe.resourceController.scheduler.registerTask(gI.OVERLAY,this),fe._stage.renderView.events.on("force-camera-for-screenshot",(fe=>{this._updateOverlays(wI,fe.camera,$A.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays($A.BACKGROUND,fe)}))]),fe._stage.renderer.renderOverlay=fe=>this._renderOverlay(fe)}destroy(){var fe;(null==(fe=this.view)?void 0:fe._stage)&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),fhe&&(fhe.hide(),fhe=null),this.renderer=u$4d(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||_B.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?s$45(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(fe){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(fe),this._drawOverlays($A.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(fe){this._spatialReference=fe,this.renderer.spatialReference=fe,this._longitudeCyclical=null;const ve=this.view.renderSpatialReference;null!=fe&&null!=ve?(this._renderSR=ve,this._overlaySREqualsRenderSR=fe.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=fe.isWebMercator?new $n(-20037508.342787,20037508.342787):new $n(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(fe,ve,_e){this._drapeSources.add(fe),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const be=this.renderer.createDrapeSourceRenderer(fe,ve,_e);return this._updateDrapeSourceExtent(fe),this._setContentDirty(),this.notifyChange("running"),be}registerGeometryDrapeSource(fe){return this.registerDrapeSource(fe,TJ)}_updateDrapeSourceExtent(fe){2===this.renderer.overlays.length&&null!=fe.setDrapingExtent&&null!=this._spatialReference&&fe.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(fe){this._drapeSources.has(fe)&&(this._drapeSources.delete(fe),this.renderer.removeDrapeSourceRenderer(fe),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(fe){this._drapeTargets.add(fe),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(fe){this._drapeTargets.delete(fe),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(fe){return this._updateOverlays(fe,this.view.state.contentCamera,$A.UPDATE)}_updateOverlays(fe,ve,_e){if(!this._spatialReference)return dI;const be=this._computeOverlayResolution(ve);this._computeOverlayExtents(ve,be,vhe),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,vhe.stretch);const we=this._updateOverlay(nY.INNER,vhe.inner,be,1*vhe.pixelRatioAdjustment,vhe.mapUnitsPerPixel),Se=M$1o(vhe.inner)/M$1o(vhe.outer),Te=this._updateOverlay(nY.OUTER,vhe.outer,be,Se*vhe.pixelRatioAdjustment,vhe.mapUnitsPerPixel);we!==whe.EXTENT&&Te!==whe.EXTENT||(this._drapeSources.forEach((fe=>this._updateDrapeSourceExtent(fe))),this.surface.updateTileOverlayParams(_e)),we===whe.NONE&&Te===whe.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,fe.madeProgress()}_computeOverlayResolution(fe){const ve=this.view.state.contentPixelRatio*this.view.resolutionScale,_e=fe.fullWidth/fe.pixelRatio*ve,be=fe.fullHeight/fe.pixelRatio*ve,we=Math.ceil(1.5*Math.max(_e,be));return Math.min(n$2$(we),this._maxResolution)}_updateOverlay(fe,ve,_e,be,we){if(0===this.renderer.overlays.length)return whe.NONE;const Se=this.renderer.overlays[fe],Te=Se.mapUnitsPerPixel;if(Se.mapUnitsPerPixel=we,Se.pixelRatio=be,function oe$4(fe,ve){const _e=1e-5,be=_B.TESTS_DISABLE_OPTIMIZATIONS?0:_e*Math.max(fe[2]-fe[0],fe[3]-fe[1],ve[2]-ve[0],ve[3]-ve[1]);return Math.abs(ve[0]-fe[0])<=be&&Math.abs(ve[1]-fe[1])<=be&&Math.abs(ve[2]-fe[2])<=be&&Math.abs(ve[3]-fe[3])<=be}(ve,Se.extent)&&_e===Se.resolution)return Te===we?whe.NONE:whe.RERENDER_ONLY;e$3R(Se.extent,ve),Se.resolution=_e;const Ee=p$4O(Se.extent);return Se.renderLocalOrigin=t$1W(Ee[0],Ee[1],0,"OV_"+this._latestOriginId++),whe.EXTENT}setTileParameters(fe){const ve=fe.renderData.overlay;if(this.renderer.overlays.length>0){const _e=this.renderer.overlays[nY.INNER],be=this.renderer.overlays[nY.OUTER],we=fe.extent;this._rectInsideRect(_e.extent,we)||this._rectanglesOverlap(we,_e.extent)||this._rectanglesOverlap(we,be.extent)?(this._setTileOverlayData(we,nY.INNER,ve),this._setTileOverlayData(we,nY.OUTER,ve)):(this._clearTileOverlayData(nY.INNER,ve),this._clearTileOverlayData(nY.OUTER,ve))}else this._clearTileOverlayData(nY.INNER,ve),this._clearTileOverlayData(nY.OUTER,ve)}overlayPixelSizeInMapUnits(fe,ve){if(0===this.renderer.overlays.length)return ve();const _e=this.renderer.overlays[nY.INNER],be=this.renderer.overlays[nY.OUTER],we=this._pointIsInExtent(fe,_e.extent)?_e:be;return(we.extent[2]-we.extent[0])/we.resolution}_setTileOverlayData(fe,ve,_e){if(0===this.renderer.overlays.length)return;const be=this.renderer.overlays[ve].extent,we=M$1o(be),Se=s$41(be);let Te=fe[0];if(this._longitudeCyclical){Te=this._longitudeCyclical.minimalMonotonic(be[0],Te);const ve=this._longitudeCyclical.minimalMonotonic(be[0],fe[2]);Te>ve&&(Te=ve-(fe[2]-fe[0]))}_e.setScale(ve,M$1o(fe)/we,s$41(fe)/Se),_e.setOffset(ve,(Te-be[0])/we,(fe[1]-be[1])/Se)}_clearTileOverlayData(fe,ve){ve.setScale(fe,-1,-1),ve.setOffset(fe,-1,-1)}async reloadShaders(){e$Y(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(wI)}_dispatchAnimationUpdate(fe){const ve=fe-this._animationTimeLast;if(ve>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const _e=ve/this.surface.view._stage.renderer.animationTimeDilation,be=new KB(this.view.state.camera,_e,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(be)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=fe}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(fe,ve,_e,be){const we=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(fe,bhe,ve,_e);if(null==we)return!1;const Se=we.origin,Te=u$3Y(ghe,we.origin,we.direction);return this._groundIntersector.reset(Se,Te,fe),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,Se,Te),this._groundIntersector.results.min.getIntersectionPoint(be)}_findHorizonBasedPointOfInterest(fe,ve){let _e=.5;const be=.55,we=this.view.renderCoordsHelper.getAltitude(fe.eye),Se=this.view.pointsOfInterest.centerOnSurfaceFrequent,Te=1e-5,Ee=e$3Y(Se.estimatedSurfaceAltitude,fe.aboveGround?-1/0:we+Te,fe.aboveGround?we-Te:1/0),Ce=fe.aboveGround;if("global"===this.view.viewingMode){const ve=ghe;J$C(L$15(Ap,s$45(this.view.spatialReference).radius+Ee),l$3V(fe.eye,fe.viewForward),ve),e$3Z(ve,ve,fe.eye);const we=wn.normalize(m$3h(fe.viewForward,ve,fe.viewRight))/fe.fovY+.5,Se=we<=0||we>=1?.5:be;_e=Ce?Se*we:we+Se*(1-we)}else{const ve=.5*Math.PI-Math.acos(-fe.viewForward[2]),we=r$35(0,Math.tan(ve),1,0),Se=e$3Y(.5+.5*z$13(we,we,fe.projectionMatrix)[1],0,1);_e=1===Se||0===Se?.5:Ce?Se*be:1-(1-Se)*be}return!!this._intersectGroundFromView(fe,.5,_e,ve)&&hn(ve,fe.eye)<Se.distance*Se.distance}_computeOverlayExtents(fe,ve,_e){var be;const we=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,Se=[0,0,0];this._findHorizonBasedPointOfInterest(fe,Se)||r$3w(Se,we),_B.OVERLAY_SHOW_CENTER?(null==fhe&&(fhe=new Rce(this.view.graphics,"red")),fhe.show(Se,this._renderSR)):null!=fhe&&fhe.hide();const Te=Math.max(.1,x$1W(fe.eye,Se)),Ee=c$2E(this.view.renderCoordsHelper,we,fe.eye);this._overlaySREqualsRenderSR||n$3Y(Se,this._renderSR,Se,this._spatialReference);const Ce=this.surface.extent,Oe=!this._isSpherical&&(null==(be=this._spatialReference)?void 0:be.isGeographic),Re=Oe&&this._spatialReference?1/s$45(this._spatialReference).metersPerDegree:1,De=this.view.state.contentPixelRatio,Be=fe.perScreenPixelRatio/De*Te*Re;_e.mapUnitsPerPixel=Be/this._worldToPCSRatio,_e.stretch=this._overlayStretch;let Ze=ve*Be/2*_e.stretch,Xe=!1,Je=Oe?90:1/0;this._isSpherical&&Ce&&this._spatialReference&&(this._spatialReference.isWebMercator?(Ze/=Math.cos(f$38(Se[1])),Je=Ce[3]):(Xe=!0,Ze/=s$45(this._spatialReference).metersPerDegree,Je=90),Ze>=Je&&(Ze=Je,Se[1]=0,this._spatialReference.isWebMercator&&(Se[0]=0)));let Qe=1;Xe&&(Qe=1/Math.max(.2,Math.cos(Math.abs(h$2U(Se[1])))),Ze*Qe>180&&(Qe=180/Ze),_e.mapUnitsPerPixel*=Qe);const dt=Math.log(2)/12;Ze=Math.exp(Math.round(Math.log(Ze)/dt)*dt);const $t=Ze*Qe,bt=.5*ve/(32*$t),wt=.5*ve/(32*Ze);Se[0]=Math.round(Se[0]*bt)/bt,Se[1]=Math.round(Se[1]*wt)/wt;const xt=_e.inner;xt[0]=Se[0]-$t,xt[1]=Se[1]-Ze,xt[2]=Se[0]+$t,xt[3]=Se[1]+Ze,this._isSpherical&&this._shiftExtentToFitBounds(xt,1/0,Je);const St=_e.outer;if(6*$t>M$1o(Ce))e$3R(St,Ce);else if(Math.PI/2-Math.abs(Ee-Math.PI/2)<=.25*Math.PI)St[0]=xt[0]-$t,St[1]=xt[1]-Ze,St[2]=xt[2]+$t,St[3]=xt[3]+Ze;else{n$3Y(fe.eye,this._renderSR,ghe,this._spatialReference),e$35(yhe,Se,ghe);let ve=-Math.atan2(yhe[1],yhe[0])+.125*Math.PI;ve<0&&(ve+=2*Math.PI);const _e=Math.floor(ve/(.25*Math.PI));m$3i(yhe,phe[_e],2*Ze),yhe[0]*=Qe,yhe[2]*=Qe,o$3x(St,xt,yhe)}if(this._isSpherical)St[0]=this._longitudeCyclical.clamp(St[0]),St[2]=this._longitudeCyclical.clamp(St[2]),St[1]=Math.max(St[1],-Je),St[3]=Math.min(St[3],Je);else{R$1e(U$17(xt,Ce,_he),U$17(St,Ce,$he))&&(St[2]=St[0],St[3]=St[1])}const Et=Math.abs(xt[2]-xt[0])/ve;_e.mapUnitsPerPixel=Math.max(_e.mapUnitsPerPixel,Et),_e.pixelRatioAdjustment=_e.mapUnitsPerPixel/Et}_drawOverlays(fe,ve){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const _e=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const be=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(ve),be!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams($A.UPDATE),_e?(this.surface.requestRender(fe),fe===$A.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender($A.BACKGROUND),this.renderer}_rectanglesOverlap(fe,ve){return null!=fe&&(this._longitudeCyclical?(this._longitudeCyclical.contains(ve[0],ve[2],fe[0])||this._longitudeCyclical.contains(ve[0],ve[2],fe[2])||this._longitudeCyclical.contains(fe[0],fe[2],ve[0]))&&!(fe[1]>ve[3]||fe[3]<ve[1]):E$1H(fe,ve))}_rectInsideRect(fe,ve){return null!=ve&&(this._longitudeCyclical?this._longitudeCyclical.contains(fe[0],fe[2],ve[0])&&this._longitudeCyclical.contains(fe[0],fe[2],ve[2])&&ve[1]>fe[1]&&ve[3]<fe[3]:R$1e(fe,ve))}_pointIsInExtent(fe,ve){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ve[0],ve[2],fe.x)&&fe.y>=ve[1]&&fe.y<=ve[3];const _e=fe.x,be=fe.y;return _e>ve[0]&&_e<ve[2]&&be>ve[1]&&be<ve[3]}_shiftExtentToFitBounds(fe,ve,_e){let be=0,we=0;fe[0]<-ve?be=fe[0]+ve:fe[2]>ve&&(be=ve-fe[2]),fe[1]<-_e?we=fe[1]+_e:fe[3]>_e&&(we=_e-fe[3]),z$16(fe,be,we)}get test(){}};e$4o([y$2v()],mhe.prototype,"_spatialReference",void 0),e$4o([y$2v({readOnly:!0})],mhe.prototype,"running",null),e$4o([y$2v()],mhe.prototype,"_placementDirty",void 0),e$4o([y$2v()],mhe.prototype,"_contentUpdated",void 0),e$4o([y$2v()],mhe.prototype,"_isSpherical",null),e$4o([y$2v()],mhe.prototype,"_worldToPCSRatio",null),e$4o([y$2v()],mhe.prototype,"renderer",void 0),e$4o([y$2v({constructOnly:!0})],mhe.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],mhe.prototype,"surface",void 0),e$4o([y$2v()],mhe.prototype,"suspended",null),e$4o([y$2v()],mhe.prototype,"updating",null),e$4o([y$2v({type:Boolean})],mhe.prototype,"rendersOccludedDraped",null),mhe=e$4o([a$4y("esri.views.3d.terrain.OverlayManager")],mhe);const yhe=[0,0,0,0],ghe=[0,0,0],vhe=new class le{constructor(){this.inner=u$3J(),this.outer=u$3J(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=1.3}},_he=u$3J(),$he=u$3J(),bhe=m$3f();var whe;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.EXTENT=1]="EXTENT",fe[fe.RERENDER_ONLY=2]="RERENDER_ONLY"}(whe||(whe={}));let xhe=class o31{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=P$$(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=t$4r(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,P$$(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(fe){return this.outerEdgesOffsetAndLength[2*fe]}getEdgeCount(fe){return this.outerEdgesOffsetAndLength[2*fe+1]}getEdgeVertexIndex(fe,ve){return this.getEdgeAttributeIndex(fe,ve)}getEdgeVertexPosition(fe,ve,_e,be){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(fe,be),ve),u$3Y(ve,ve,_e)}getEdgeNormal(fe,ve,_e){const{typedBuffer:be,typedBufferStride:we}=this.vertexAttributes.normalCompressed;!function f$1h(fe,ve,_e,be=2){const we=_e*be,Se=u$1G(ve[we]),Te=u$1G(ve[we+1]),Ee=1-Math.abs(Se)-Math.abs(Te);fe[2]=Ee,Ee<0?(fe[0]=(Se>=0?1:-1)*(1-Math.abs(Te)),fe[1]=(Te>=0?1:-1)*(1-Math.abs(Se))):(fe[0]=Se,fe[1]=Te),z$1d(fe,fe)}(ve,be,this.getEdgeAttributeIndex(fe,_e),we)}setEdgeNormalFromValues(fe,ve,_e,be,we){this._setNormal(this.getEdgeAttributeIndex(fe,ve),_e,be,we)}setEdgeVertexFromValuesRawPositionUV(fe,ve,_e,be,we,Se,Te){const Ee=this.getEdgeAttributeIndex(fe,ve);this.vertexAttributes.position.setValues(Ee,_e,be,we),this._setUV(Ee,Se,Te)}setEdgeVertexFromValuesRawPositionUVNormal(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){const Re=this.getEdgeAttributeIndex(fe,ve);this.vertexAttributes.position.setValues(Re,_e,be,we),this._setUV(Re,Se,Te),this._setNormal(Re,Ee,Ce,Oe)}_getEdgeVertexRaw(fe,ve){this.vertexAttributes.position.getVec(fe,ve)}_setNormal(fe,ve,_e,be){const{typedBuffer:we,typedBufferStride:Se}=this.vertexAttributes.normalCompressed;s$1T(we,fe,ve,_e,be,Se)}_setUV(fe,ve,_e){u$X(this.vertexAttributes.uv0,fe,ve,_e)}getEdgeAttributeIndex(fe,ve){return O$j(0<=ve&&ve<this.getEdgeCount(fe)),this.getEdgeFirstVertexIndex(fe)+ve}};const She=16384;function u$X(fe,ve,_e,be){fe.setValues(ve,_e*She,be*She)}let The=class l27{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},Ehe=class i39{constructor(fe){this._getFadeDuration=fe,this._fadeStart=0,this._delayedTime=0}clear(){this._current=u$4d(this._current),this._next=u$4d(this._next),this._waiting=u$4d(this._waiting),this._delayed=u$4d(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){const fe=this._delayed||this._waiting||this._next||this._current;fe!==this._current&&(this._current=null,this.clear(),this._current=fe)}let fe=i39.test.fadeMoment;if(null!=this._delayed&&(fe=fe||performance.now(),fe>=this._delayedTime&&(this._push(this._delayed,Phe.Immediate),this._delayed=null)),null!=this._next){fe=fe||performance.now();const ve=this._fadeDuration,_e=null!=this._current&&this._next.texture===this._current.texture,be=this._next.type!==aY.FADING,we=fe-this._fadeStart>=ve;(_e||be||we)&&(u$4d(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(fe))}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;const fe=i39.test.fadeMoment||performance.now(),ve=Math.max(0,fe-this._fadeStart),_e=this._fadeDuration;return ve>_e?0:1-ve/_e}get isFading(){return null!=this._next||null!=this._delayed}push(fe,ve=Phe.Immediate){this._delayed=u$4d(this._delayed),this._push(fe,ve)}_push(fe,ve){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=fe);const _e=i39.test.fadeMoment||performance.now();return ve!==Phe.Immediate?(this._delayed=fe,void(this._delayedTime=_e+ve)):null==this._next?(this._next=fe,void(this._fadeStart=this._alignFadeStart(_e))):void(null!=fe&&(u$4d(this._waiting),this._waiting=fe))}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(fe){const ve=this._getFadeDuration();return fe+ve-fe%ve}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Phe,Che;Ehe.test={fadeMoment:0},function(fe){fe[fe.Immediate=0]="Immediate",fe[fe.Delayed=5e3]="Delayed"}(Phe||(Phe={})),function(fe){fe[fe.BACK_TO_FRONT=-1]="BACK_TO_FRONT",fe[fe.NONE=0]="NONE",fe[fe.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(Che||(Che={}));let Ohe=class n38{constructor(){this._queue=new jr,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(fe){this._queue.clear(),this._queue.push(fe),this._last=void 0}reset(fe=null){this._queue.clear(),null!=fe&&this._queue.pushArray(fe),this._last=void 0}skipSubtree(){this._last=void 0}next(){var fe;const ve=null==(fe=this._last)?void 0:fe.children;return(null==ve?void 0:ve[0])&&this._queue.pushArray(ve),this._last=this._queue.pop(),this._last}},Ahe=class r50{constructor(){this._q=new jr}get done(){return 0===this._q.length}reset(fe){if(this._q.clear(),null!=fe){this._q.pushArray(fe);for(let fe=0;fe<this._q.length;++fe){const ve=this._q.data[fe];ve.isLeaf||this._q.pushArray(ve.children)}}}next(){return this._q.pop()}};function o$L(fe,ve,_e){if(null==(null==ve?void 0:ve.fullExtent))return!1;const be=ve.fullExtent,we=fe.extent;if(_e){if(we[0]<be.xmin||we[1]<be.ymin||we[2]>be.xmax||we[3]>be.ymax)return!1}else if(be.xmin>we[2]||be.ymin>we[3]||be.xmax<we[0]||be.ymax<we[1])return!1;const Se=fe.surface.tilingScheme.levels[fe.level].scale,Te=ve.minScale;if(Te>0&&Se>1.00000001*Te)return!1;const Ee=ve.maxScale;return!(Ee>0&&Se<.99999999*Ee)}function u$W(fe,ve){const _e=fe.lij,be=ve.lij;return _e[0]-be[0]||_e[1]-be[1]||_e[2]-be[2]}function l$1e(fe,ve,_e=null){null==_e||0===_e.length?fe===Che.BACK_TO_FRONT?ve.sort(c$1i):ve.sort(f$K):ve.sort(((ve,be)=>function a$1b(fe,ve,_e,be){return _$m(fe,be)===_$m(ve,be)?h$B(fe,ve,_e):fe?_e:-_e}(ve,be,fe,_e)))}function c$1i(fe,ve){const _e=ve.screenDepth-fe.screenDepth;if(0!==_e)return _e;const be=fe.lij,we=ve.lij;return be[0]-we[0]||be[1]-we[1]||be[2]-we[2]}function f$K(fe,ve){const _e=fe.screenDepth-ve.screenDepth;if(0!==_e)return _e;const be=fe.lij,we=ve.lij;return be[0]-we[0]||be[1]-we[1]||be[2]-we[2]}function h$B(fe,ve,_e){const be=fe.screenDepth,we=ve.screenDepth;return be<we?-_e:be>we?_e:u$W(fe,ve)}function _$m(fe,ve){for(const _e of ve)if(fe.intersectsExtent(_e))return!0;return!1}function p$1C(fe,ve){const _e=fe.distanceToPOI-ve.distanceToPOI;if(0!==_e)return _e;const be=fe.lij,we=ve.lij;return be[0]-we[0]||be[1]-we[1]||be[2]-we[2]}function x$i(fe,ve){if(!fe||!ve||fe[0]===ve[0])return!1;const _e=fe[0]<ve[0],be=_e?fe:ve,we=_e?ve:fe,Se=1<<we[0]-be[0];return Math.floor(we[1]/Se)===be[1]&&Math.floor(we[2]/Se)===be[2]}let Mhe=class l28{get updating(){return!!this._tileRequested}init(fe,ve,_e,be){this.tile=fe,this._layerIdx=ve,this._layerClass=_e,this._suspended=be,this._tileLayerInfo=fe.getLayerInfo(ve,_e),this._tileRequested=null;const we=this._findAncestorWithData();this._setUpsampleTile(we)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(fe){fe!==this._suspended&&(this._suspended=fe,fe?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const fe=this._findAncestorWithData();return this._setUpsampleTile(fe),this._requestNext()}dataArrived(fe,ve){this._setUpsampleTile(fe,ve),this._tileRequested=null,fe===this.tile?this.tile.updateRenderData(this._layerClass,aY.FADING,ve):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const fe=this._findNextDownload();if(this._tileRequested){if(fe===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return null!=fe?fe.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=fe):this._agentDone(),!!this._tileRequested}_findNextDownload(){const fe=this._layerIdx,ve=this._layerClass,_e=this.tile.surface.layerViewByIndex(fe,ve),be=y$A(_e),{minLevel:we,maxLevel:Se}=_e.dataLevelRange,Te=this._desiredMinLevelDelta,Ee=this._progressiveLevelModulo+Te,Ce=this._scaleRangeEnabled?o$L:()=>!0;let Oe=this.tile;const Re=Oe.level;let De;const Be=this._tileLayerInfo.upsampleInfo,Ze=null!=Be?Be.tile.level:-1,Xe=null!=Be&&Ze-Re>=Te,Je=null==be?void 0:be.tilemapCache,Qe="vector-tile-3d"===_e.type?_e.schemaHelper:null;for(;Oe&&Ce(Oe,be,!1)&&Oe.level>=we;){const _e=Oe.level,be=Re-_e,Ce=Oe.layerInfo[ve][fe];if(Ce.data&&be>=Te){(!Xe||_e>Ze)&&this._setUpsampleTile(Oe),Ce.dataInvalidated&&(De=Oe);break}const Be=(null==Qe?void 0:Qe.getLevelRowColumn(Oe.lij))??Oe.lij;if("unavailable"!==(null==Je?void 0:Je.getAvailability(Be[0],Be[1],Be[2]))&&_e<=Se&&!Ce.data&&!Ce.dataMissing&&((!De||Oe.level===we||_e%2==0||Re-De.level<Te)&&(De=Oe),be>=Ee))break;Oe=Oe.parent}if(null!=De&&Re-De.level<Te)if(Be)De=null;else{const _e=this._findAncestorWithData();null!=_e&&(this._setUpsampleTile(_e),De=_e.layerInfo[ve][fe].dataInvalidated?_e:null)}return De}_findAncestorWithData(){const fe=this.tile.elevationLevel,ve=this._desiredMinLevelDelta;let _e;for(let be=this.tile;be;be=be.parent)if(be.hasLayerData(this._layerIdx,this._layerClass)){if(fe-be.level>=ve)return be;_e=be}return _e}_setUpsampleTile(fe,ve){this._tileLayerInfo.setUpsampleInfo(this.tile,fe),this.tile.updateRenderData(this._layerClass,aY.FADING,ve)}get test(){}};const Rhe=new Error("Abstract method called on TileAgent"),Ihe=new class a40 extends Mhe{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw Rhe}get _progressiveLevelModulo(){throw Rhe}dispose(){}};var Lhe;!function(fe){fe[fe.INSIDE=0]="INSIDE",fe[fe.INTERSECTS=1]="INTERSECTS",fe[fe.OUTSIDE=2]="OUTSIDE"}(Lhe||(Lhe={}));let Dhe=class l29{constructor(){this.waitingAgents=new jr,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(fe){const ve=Nhe.acquire();return ve._init(fe),ve}release(){this.dispose(),Fhe.delete(this),Nhe.release(this)}dispose(){this.loadingAgent=r$3M(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=b$v(this._data)}static prune(){Nhe.prune(0)}_init(fe){this.waitingAgents.clear(),this._data=b$v(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=fe,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=e$4f(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(fe,ve){if(fe!==ve&&null!=ve){if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===ve)return;this._upsampleInfo.tile.unrefMapData()}ve.refMapData(),function m$$(fe,ve,_e){let be=1,we=0,Se=0;for(;fe!==ve;)if(be*=.5,we*=.5,Se*=.5,1&fe.lij[2]&&(we+=.5),1&fe.lij[1]||(Se+=.5),null==(fe=fe.parent))throw new Error("tile was not a descendant of upsampleTile");_e.init(ve,we,Se,be)}(fe,ve,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(fe){b$v(this._data),this._data=fe}};const Nhe=new pr(Dhe,null,(()=>{})),Fhe=new Map;var zhe;!function(fe){fe[fe.NONE=0]="NONE",fe[fe.SPLIT=1]="SPLIT",fe[fe.ELEVATION=2]="ELEVATION",fe[fe.MERGE=4]="MERGE",fe[fe.GEOMETRY=8]="GEOMETRY",fe[fe.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",fe[fe.TEXTURE_FADING=32]="TEXTURE_FADING"}(zhe||(zhe={}));let khe=class ie{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=u$3J(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=u$3J(),this.centerAtSeaLevel=[0,0,0],this._center=[[0,0,0],[0,0,0,0],[0,0,0]],this.up=a$4x(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=[0,0,0],this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){Uhe.prune(0),Vhe.prune(0),Dhe.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[jhe.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const fe=this.parent,ve=(null==fe?void 0:fe.frustumVisibility)??Lhe.INTERSECTS;this._frustumVisibility=ve===Lhe.INSIDE?Lhe.INSIDE:ve===Lhe.OUTSIDE?Lhe.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const _e=this._frustumVisibility!==Lhe.OUTSIDE&&this._intersectsClippingArea;_e!==this._visible&&(this._visible=_e,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const fe=!!this.renderData;return fe!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=fe,this._surface.renderer.setDirty()),fe}init(fe,ve,_e,be,we){this._lij[0]=fe,this._lij[1]=ve,this._lij[2]=_e,this.ellipsoid=s$45(we.tilingScheme.spatialReference),we.tilingScheme.getExtent(fe,ve,_e,this.extent),we.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,we.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[jhe.MIDDLE][3]=0,this.elevationLevel=fe,be&&!Number.isNaN(be.elevationBoundsMin)?(this._elevationBoundsMin=be.elevationBoundsMin,this._elevationBoundsMax=be.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=be,this.unsetChildren(),this._surface=we,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const Se of Yle){const fe=we.numLayers(Se),ve=this.layerInfo[Se];for(const _e of ve)_e.release();ve.length=fe;for(let _e=0;_e<fe;_e++)ve[_e]=Dhe.acquire(this._surface.upsampleInfoPool),Se===Wle.ELEVATION&&this.findElevationBoundsForLayer(_e,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(we.tilingScheme.pixelSize,Hg)}dispose(){this.renderData,this._surface.upsampleMapCache.pop(this.key);for(const fe of Yle){for(const ve of this.layerInfo[fe])ve.release();this.layerInfo[fe].length=0}this._parent=null;for(let fe=0;fe<4;++fe)this._children[fe]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const fe=this._cachedMemory;fe>0&&this._surface.upsampleMapCache.put(this.key,this,fe)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Wle.MAP].reduce(((fe,{data:ve})=>fe+(t$1i(ve)?ve.usedMemory/ve.referenced:0)),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const fe=this._surface.tilingScheme.pixelSize;return fe*fe*4}_ensureUsedMemory(){var fe;if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let ve=0;for(const{data:be}of this.layerInfo[Wle.MAP])t$1i(be)?ve+=this._getTerrainDataMemory(be):this._mapTileMemoryInternal+=this._getTerrainDataMemory(be);const _e=this._cpuImageMemorySize;for(const be of this.layerInfo[Wle.ELEVATION])this._usedMemory+=be.data?_e:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=(null==(fe=this.renderData.texture)?void 0:fe.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+ve),this._usedMemory}getUsedMemoryForLayer(fe,ve){const _e=this.layerInfo[fe][ve];return(null==_e?void 0:_e.data)?fe===Wle.MAP?this._isCached?0:this._getTerrainDataMemory(_e.data):fe===Wle.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(fe){return n$1o(fe)?fe.texture.usedMemory:e$17(fe)?fe.memoryUsage:t$1i(fe)?fe.usedMemory/fe.referenced:r$R(fe)||fe instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(fe){const ve=this._center[jhe.MIDDLE],_e=fe,be=ve[0],we=ve[1],Se=ve[2],Te=_e[2]*be+_e[6]*we+_e[10]*Se+_e[14];this.screenDepth=Te<0?0:Te/(_e[3]*be+_e[7]*we+_e[11]*Se+_e[15])}shouldSplit(fe,ve,_e){if(!this.visible)return zhe.NONE;if(fe.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(fe.frustum)===Lhe.OUTSIDE))return zhe.NONE;const be=this.level;e$3Z(Ghe,this._center[jhe.MIDDLE],ve);let we=v$22(Ghe),Se=Ghe,Te=this._center[jhe.MIDDLE];e$3Z(Hhe,this._center[jhe.TOP],ve);const Ee=v$22(Hhe);Ee<we&&(we=Ee,Se=Hhe,Te=this._center[jhe.TOP]),e$3Z(qhe,this._center[jhe.BOTTOM],ve);const Ce=v$22(qhe);if(Ce<we&&(we=Ce,Se=qhe,Te=this._center[jhe.BOTTOM]),this._edgeLen2>we&&be<fe.maxLod)return zhe.SPLIT;const Oe=Math.sqrt(we),Re=fe.fovX*Oe*2,De=this._edgeLen/Re,A16=()=>{if(be<fe.maxLod)return this.elevationLevel=be,zhe.NONE;const ve=be+Math.ceil(-Math.log2(fe.relativeWidthLimit/De));return ve!==this.elevationLevel?(this.elevationLevel=ve,zhe.ELEVATION):zhe.NONE},Be=null!=_e?_e-be:1/0;if(Be<=.5)return A16();const Ze=P$1g(this.up,Ghe),Xe=this._elevationBoundsMax-this._elevationBoundsMin,Je=Xe/this.edgeLen;if(fe.aboveGround&&Ze>0&&Je<.001&&Ze/Oe-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-Je>0)return zhe.NONE;const Qe=null!=_e?3-Math.min(Be,2):1;if(De*Qe<fe.relativeWidthLimit||be>=fe.maxLod)return A16();if(be<7)return zhe.SPLIT;g$2z(Whe,this.up,Ze),e$3Z(Whe,Whe,Se);const dt=v$22(Whe);if(dt<=this.radius*this.radius)return zhe.SPLIT;g$2z(Whe,Whe,this.radius/Math.sqrt(dt)),u$3Y(Whe,Whe,Te),e$3Z(Whe,ve,Whe);const $t=Math.min(1,(Math.abs(P$1g(Whe,this.up))+.5*Xe+this._curvatureHeight)/s$4g(Whe)),bt=.1/fe.angledSplitBias,wt=fe.fovY*Oe*2;return $t*(this._edgeLen/wt*Qe)<bt*fe.relativeHeightLimit?zhe.NONE:zhe.SPLIT}setChildren(fe,ve,_e,be){const we=this._children;return we[0]=fe,we[1]=ve,we[2]=_e,we[3]=be,we}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var fe;return(null==(fe=this.renderData)?void 0:fe.hasGeometry)??!1}load(){this.refMapData();for(const fe of Yle)this._createOrUpdateAgents(0,fe);this.surface.renderer.loadTile(this)}unload(fe){fe.unloadTile(this);for(const ve of Yle){const fe=this.layerInfo[ve];for(const ve of fe)ve.loadingAgent&&ve.loadingAgent!==Ihe&&(ne$2(ve.loadingAgent),ve.loadingAgent=null),ve.pendingUpdates=0}this.resetPendingUpdate(zhe.GEOMETRY),this.resetPendingUpdate(zhe.TEXTURE_NOFADING),this.resetPendingUpdate(zhe.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const fe=this.layerInfo[Wle.MAP];for(const ve of fe)ve.loadingAgent&&ve.loadingAgent!==Ihe&&(ne$2(ve.loadingAgent),ve.loadingAgent=null),ve.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(fe){if(I$1y(fe,this._clippingArea))return!1;const ve=this._intersectsClippingArea,_e=this._isWithinClippingArea;null!=fe?(this._intersectsClippingArea=this.intersectsExtent(fe),this._isWithinClippingArea=this._isWithinExtent(fe)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=fe,this.updateVisibility();const be=_e&&this._isWithinClippingArea,we=!(_e||ve||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||be||we||this.setPendingUpdate(zhe.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(fe,ve){return this.layerInfo[ve][fe]}hasLayerData(fe,ve){const _e=this.layerInfo[ve][fe];return!(!(null==_e?void 0:_e.data)||_e.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const fe of Yle){const ve=this.layerInfo[fe];for(const fe of ve)if(fe.loadingAgent&&fe.loadingAgent!==Ihe&&fe.loadingAgent.updating)return!0}return!1}_isSuspended(fe){return!!this.hasPendingUpdate(zhe.SPLIT)||fe!==Wle.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(fe){return(this._pendingUpdates&fe)===fe}setPendingUpdate(fe){const ve=this._pendingUpdates;return this._pendingUpdates|=fe,fe===zhe.SPLIT||fe===zhe.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),ve!==this._pendingUpdates}resetPendingUpdate(fe){return!!this.hasPendingUpdate(fe)&&(this._pendingUpdates&=~fe,!0)}requestLayerData(fe,ve,_e){const be=this.layerInfo[ve][fe];if(be.waitingAgents.has(_e))return!0;if(be.waitingAgents.push(_e),be.data&&!be.dataInvalidated){const fe=t$1i(be.data);return _e.dataArrived(this,fe),!0}if(be.requestPromise)return!0;e$4f(be.requestAbort),be.requestAbort=new AbortController;const we=this._surface.requestTileData(this,fe,ve,be.requestAbort);if(!we)return be.requestAbort=null,!1;const a55=()=>{be.requestPromise===we&&(be.requestPromise=null,be.requestAbort=null)};return be.requestPromise=we,we.then(a55,a55),!0}get isLeaf(){return null==this._children[0]}hasLij(fe){return this._lij[0]===fe[0]&&this._lij[1]===fe[1]&&this._lij[2]===fe[2]}findByLij(fe){if(this.hasLij(fe))return this;const ve=this._children;return ve[0]?ve[0].findByLij(fe)||ve[1].findByLij(fe)||ve[2].findByLij(fe)||ve[3].findByLij(fe):null}distanceToSquared(fe){return v$22(e$3Z(Whe,this._center[jhe.MIDDLE],fe))}containsPoint(fe){const ve=this.extent;return fe[0]>=ve[0]&&fe[1]>=ve[1]&&fe[0]<=ve[2]&&fe[1]<=ve[3]}containsPointXY(fe,ve){const _e=this.extent;return fe>=_e[0]&&ve>=_e[1]&&fe<=_e[2]&&ve<=_e[3]}unrequestLayerData(fe,ve,_e){const be=this.layerInfo[ve][fe],we=be.waitingAgents;we.removeUnordered(_e);we.length<1&&(be.abortRequest(),this.setMemoryDirty())}dataArrived(fe,ve,_e){const be=t$1i(_e),we=this.layerInfo[ve][fe];we.data=_e,we.dataInvalidated=!1,we.waitingAgents.forAll((fe=>fe.dataArrived(this,be))),we.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(fe,ve){const _e=this.layerInfo[ve][fe];_e.dataMissing=!0,_e.waitingAgents.forAll((fe=>fe.dataMissing())),_e.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(fe,ve,_e){switch(_e&&this.forEachLoadedNeighbor((_e=>_e.updateRenderData(fe,ve))),fe){case Wle.MAP:return this._updateTexture(ve);case Wle.ELEVATION:return this._updateGeometry()}}_updateTexture(fe){this.renderData&&(this.resetPendingUpdate(fe===aY.FADING?zhe.TEXTURE_NOFADING:zhe.TEXTURE_FADING),this.setPendingUpdate(fe===aY.FADING?zhe.TEXTURE_FADING:zhe.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(zhe.GEOMETRY);for(const fe of this.layerInfo[Wle.ELEVATION])fe.pendingUpdates|=zhe.GEOMETRY}invalidateLayerData(fe,ve){this.layerInfo[ve][fe].invalidateSourceData(),this.restartAgents(ve)}computeElevationBounds(){const fe=this._elevationBoundsMin,ve=this._elevationBoundsMax;let _e=1/0,be=-1/0;const we=this.layerInfo[Wle.ELEVATION];let Se=!0;for(const Te of we)null!=Te.elevationBounds&&(_e=Math.min(_e,Te.elevationBounds.min),be=Math.max(be,Te.elevationBounds.max),Te.elevationBounds.hasNoDataValues||(Se=!1));Se&&(_e=Math.min(_e,0),be=Math.max(be,0)),fe===_e&&ve===be||(this._elevationBoundsMin=_e,this._elevationBoundsMax=be,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const fe=this._elevationBoundsMin,ve=this._elevationBoundsMax,_e=.5*(fe+ve),be=this._center;g$2z(Whe,this.up,_e),u$3Y(be[jhe.MIDDLE],this.centerAtSeaLevel,Whe),g$2z(Whe,this.up,fe),u$3Y(be[jhe.TOP],this.centerAtSeaLevel,Whe),g$2z(Whe,this.up,ve),u$3Y(be[jhe.BOTTOM],this.centerAtSeaLevel,Whe)}findElevationBoundsForLayer(fe,ve){const _e=this.layerInfo[Wle.ELEVATION][fe],be=this.elevationLevelDelta,we=Math.max(this.elevationLevel-be,0),Se=_e.elevationBounds;if(null!=Se&&Se.level>=ve&&Se.level<=we)return;if(!o$L(this,y$A(this._surface.layerViewByIndex(fe,Wle.ELEVATION)),!1))return;const Te=Bhe;let Ee=!1;const Ce=_e.data;if(Ce&&Ce.level<=we){const fe=_e.data;Te.min=fe.samplerData.data.minValue,Te.max=fe.samplerData.data.maxValue,Te.hasNoDataValues=fe.samplerData.data.hasNoDataValues,Te.level=this.level,Ee=!0}else{let ve,_e,Se=0;for(let Te=this._parent;Te&&(!_e||Se<be)&&(Se=this.elevationLevel-Te.level,ve=_e||ve,_e=Te.layerInfo[Wle.ELEVATION][fe].data,!(!_e&&ve&&Te.level<=we));Te=Te.parent);_e=_e||ve,_e&&(_e.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],Te),Te.min!==1/0&&(Te.level=_e.level,Ee=!0))}Ee&&(null==_e.elevationBounds&&(_e.elevationBounds=new que),_e.elevationBounds.copyFrom(Te))}modifyLayers(fe,ve,_e){const be=this.layerInfo[_e];for(const Te of be)Te.loadingAgent&&Te.loadingAgent!==Ihe&&(ne$2(Te.loadingAgent),Te.loadingAgent=null),Te.waitingAgents.clear();for(let Te=0;Te<be.length;++Te)void 0===fe[Te]&&be[Te].release();const we=new Array(...be),Se=ve.length;be.length=Se;for(let Te=0;Te<Se;Te++){const fe=ve[Te];be[Te]=fe>-1?we[fe]:Dhe.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(fe){this.renderData&&(this._createOrUpdateAgents(0,fe),this.updateRenderData(fe,aY.FADING))}updateAgents(fe){if(this.renderData){const ve=this.layerInfo[fe];for(const fe of ve)fe.loadingAgent===Ihe&&(fe.loadingAgent=null);this._createOrUpdateAgents(0,fe)}}updateAgentSuspension(){for(const fe of Yle){const ve=this._isSuspended(fe);for(const _e of this.layerInfo[fe])_e.loadingAgent&&_e.loadingAgent!==Ihe&&(_e.loadingAgent.setSuspension(ve),_e.loadingAgent===Ihe&&this.updateRenderData(fe,aY.FADING))}}removeLayerAgent(fe,ve){const _e=this.layerInfo[ve][fe];_e.loadingAgent&&_e.loadingAgent!==Ihe&&_e.loadingAgent.dispose(),_e.loadingAgent=null}agentDone(fe,ve){const _e=this.layerInfo[ve][fe];_e.loadingAgent=Ihe,_e.data||null!=_e.upsampleInfo||this._createOrUpdateAgents(fe+1,ve)}_hasBlendableAncestor(fe){return"normal"!==fe.blendMode||p$4s(fe.parent)&&this._hasBlendableAncestor(fe.parent)}_hasBlendModes(fe,ve,_e){var be,we,Se;for(let Te=fe;Te<ve;++Te){const fe=this._surface.layerViewByIndex(Te,_e);if(A$o(fe)&&"normal"!==(null==(be=null==fe?void 0:fe.layer)?void 0:be.blendMode)||p$4s(null==(we=null==fe?void 0:fe.layer)?void 0:we.parent)&&this._hasBlendableAncestor(null==(Se=null==fe?void 0:fe.layer)?void 0:Se.parent))return!0}return!1}_createOrUpdateAgents(fe,ve){const _e=this.layerInfo[ve];if(0===_e.length)return;const be=this._isSuspended(ve);for(let we=fe;we<_e.length;++we){const Se=_e[we];let Te=!1;const Ee=this._surface.layerViewByIndex(we,ve),Ce=y$A(Ee);if(Se.loadingAgent?o$L(this,Ce,!1)?(Se.loadingAgent!==Ihe&&Se.loadingAgent.setSuspension(be),Se.loadingAgent!==Ihe&&(Te=Se.loadingAgent.update())):Se.dispose():o$L(this,Ce,!1)&&(Se.loadingAgent=se$2(this,we,ve,be),Te=Se.loadingAgent.startLoading(),Te?Se.loadingAgent===Ihe&&this.setPendingUpdate(zhe.GEOMETRY):(ne$2(Se.loadingAgent),Se.loadingAgent=Ihe)),Se.loadingAgent===Ihe&&this.updateRenderData(ve,aY.FADING),!this._hasBlendModes(fe,_e.length,ve)&&Te&&Ee.isOpaque)return}}_isWithinExtent(fe){const ve=this.extent;return ve[0]>=fe[0]&&fe[2]>=ve[2]&&ve[1]>=fe[1]&&fe[3]>=ve[3]}intersectsExtent(fe){const ve=this.extent;return ve[2]>=fe[0]&&fe[2]>=ve[0]&&ve[3]>=fe[1]&&fe[3]>=ve[1]}getElevationVerticesPerSide(fe){const ve=this.elevationLevel-this.level,_e=Math.max(this.level-fe,this.elevationLevelDelta-ve),be=e$3Y(1+(this.maxTesselation>>_e),2,this.maxTesselation+1),we=this.getDefaultVerticesPerSide();return Math.max(be,we)}_findLIJ(fe,ve){if(!fe)return null;const _e=this.surface.rootTiles;if(null!=_e)for(const be of _e)if(he$2(be,fe)){let _e=be,we=fe[0]-_e.level-1;for(;we>=0&&!_e.isLeaf&&!ve(_e);){const ve=fe[1]>>we&1,be=fe[2]>>we&1;_e=_e.children[2*ve+be],we--}return ve(_e)?_e:null}return null}findNeighborTile(fe,ve){const _e=this._lij,be=this.getNeighborLIJ(_e,fe);return be?ue$3(_e,be)?ve(this)?this:null:this._findLIJ(be,ve):null}findCorner(fe,ve){const _e=fe===Xue.NORTH_EAST?1:fe===Xue.NORTH_WEST?0:fe===Xue.SOUTH_WEST?2:3;let be=this;for(;be.children[0]&&(!ve||!ve(be));)be=be.children[_e];return be}findNeighborCornerTileExact(fe,ve){var _e;return(null==(_e=this.findNeighborTile(fe,(fe=>ve(fe)||fe.level===this.level)))?void 0:_e.findCorner(z$b(fe),ve))||null}forAllSubtreeOnSide(fe,ve){const _e=fe===Xue.NORTH?[0,1]:fe===Xue.NORTH_EAST?[1]:fe===Xue.EAST?[1,3]:fe===Xue.SOUTH_EAST?[3]:fe===Xue.SOUTH?[2,3]:fe===Xue.SOUTH_WEST?[2]:fe===Xue.WEST?[0,2]:[0],s84=fe=>{const be=fe.children;!ve(fe)&&be[0]&&_e.forEach((fe=>s84(be[fe])))};s84(this)}getNeighborEdgeStartVertexIndex(fe,ve){if(!ve)return 0;const _e=this.level-ve.level;if(O$j(!nhe||_e>=0),0===_e)return 0;const be=2**_e,we=!(1&~fe),Se=we?0:1,Te=ve.lij[Se+1]*be,Ee=this._lij[Se+1],Ce=Ee-Te,Oe=we?be-1-Ce:Ce;return nhe&&(O$j(Te<=Ee&&Ee<Te+be),O$j(0<=Oe&&Oe<be)),Oe}forEachLoadedNeighbor(fe){const ve=this.level,i52=fe=>fe.level===ve||fe.isLoaded;ahe.forEach((ve=>{const _e=this.findNeighborTile(ve,i52);null!=_e&&_e!==this&&_e.forAllSubtreeOnSide(J$5(ve),(_e=>!!_e.isLoaded&&(fe(_e,ve),!0)))})),lhe.forEach((ve=>{var _e;const be=null==(_e=this.findNeighborTile(ve,i52))?void 0:_e.findCorner(z$b(ve),(fe=>fe.isLoaded));O$j(!be||ce$3(this,be,ve)),(null==be?void 0:be.isLoaded)&&fe(be,ve)}))}getNeighborLIJ(fe,ve){const _e=$$6(ve)?-1:Z$6(ve)?1:0,be=X$6(ve)?-1:Y$4(ve)?1:0,we=[fe[0],fe[1]+_e,fe[2]+be];return we[1]<0?null:this.surface.isGlobal?this.wrapLIJ(we):we[2]<0?null:we}wrapLIJ(fe){return!fe||fe[1]<0||fe[1]>=2**fe[0]?null:this.surface.wrapEastWest(fe)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this._lij[2]}get isNorthEnd(){return 0===this._lij[1]}get isSouthEnd(){const fe=this.surface.extent,ve=(null==fe?void 0:fe[1])??null;return null!=ve&&this.extent[1]+e$3_()>=ve}checkGeometryWaterproofness(){var fe;she&&(O$j(this.isLoaded),null==(fe=this.renderData)||fe.checkGeometryWaterproofness())}shouldHaveNeighbor(fe){const ve=this.extent,_e=this.surface.rootTilesExtent,be=.25*(ve[2]-ve[0]);if($$6(fe)&&ve[3]+be>=_e[3])return!1;if(Z$6(fe)&&ve[1]-be<=_e[1])return!1;const we=this.surface.isGlobal;return!(!we&&X$6(fe)&&ve[0]-be<=_e[0]||!we&&Y$4(fe)&&ve[2]+be>=_e[2])}updateDistanceToPOI(fe){const ve=this._lastPOI;if(this.distanceToPOI>=0&&ve[0]===fe[0]&&ve[1]===fe[1]&&ve[2]===fe[2])return;r$3w(this._lastPOI,fe);const _e=this._center[jhe.MIDDLE],be=fe[0]-_e[0],we=fe[1]-_e[1],Se=fe[2]-_e[2];this.distanceToPOI=be*be+we*we+Se*Se}get test(){return{cachedMemory:this._cachedMemory}}};function se$2(fe,ve,_e,be){const we=_e===Wle.ELEVATION?Vhe.acquire():Uhe.acquire();return we.init(fe,ve,_e,be),we}function ne$2(fe){fe.dispose(),function l$1c(fe){return"elevation"===fe.type}(fe)?Vhe.release(fe):function s$14(fe){return"map"===fe.type}(fe)&&Uhe.release(fe)}const Uhe=new pr(class t64 extends Mhe{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return 2}}),Vhe=new pr(class t63 extends Mhe{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}),Bhe=new que;var jhe;function he$2(fe,ve){const _e=fe.lij,be=ve[0]-_e[0];return!(be<0)&&ve[1]>>be===_e[1]&&ve[2]>>be===_e[2]}function ue$3(fe,ve){return fe[0]===ve[0]&&fe[1]===ve[1]&&fe[2]===ve[2]}function ce$3(fe,ve,_e){return null!=fe&&null!=ve&&ve!==fe&&(fe.level>=ve.level?ge$2(fe,ve,_e):ge$2(ve,fe,z$b(_e)))}function ge$2(fe,ve,_e){O$j(fe.level>=ve.level);const be=function K$6(fe){return fe===Xue.NORTH_WEST||fe===Xue.SOUTH_WEST}(_e),we=function Q$7(fe){return fe===Xue.NORTH_WEST||fe===Xue.NORTH_EAST}(_e),Se=fe.extent,Te=ve.extent,Ee=[be?Se[0]:Se[2],we?Se[3]:Se[1]],Ce=[be?Te[2]:Te[0],we?Te[1]:Te[3]],Oe=1e-5*(Se[2]-Se[0]),Re=q$d(Ee[0],Ce[0],Oe)||fe.surface.isGlobal&&q$d(Ee[0],-Ce[0],Oe),De=q$d(Ee[1],Ce[1],Oe);if(Re&&De)return!0;if(fe.level===ve.level)return O$j(!1),!1;if(!Re&&!De)return O$j(!1),!1;const Be=Re?pe$3(Te[1],Te[3],Se[1],Se[3],Oe):pe$3(Te[0],Te[2],Se[0],Se[2],Oe);return O$j(Be),Be}function pe$3(fe,ve,_e,be,we){return fe-we<=_e&&_e<=be&&be<=ve+we}!function(fe){fe[fe.TOP=0]="TOP",fe[fe.MIDDLE=1]="MIDDLE",fe[fe.BOTTOM=2]="BOTTOM"}(jhe||(jhe={}));const Ghe=[0,0,0],Hhe=[0,0,0],qhe=[0,0,0],Whe=[0,0,0];let Yhe=class t65{constructor(){this._scales=r$35(-1,-1,-1,-1),this._offsets=r$35(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(fe,ve,_e){this._scales[2*fe]=ve,this._scales[2*fe+1]=_e}setOffset(fe,ve,_e){this._offsets[2*fe]=ve,this._offsets[2*fe+1]=_e}get scales(){return this._scales}get offsets(){return this._offsets}};function e$X(fe,ve){fe.varyings.add("tbnTangent","vec3"),fe.varyings.add("tbnBiTangent","vec3"),ve.spherical?fe.vertex.code.add(o$2P`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):fe.vertex.code.add(o$2P`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),fe.fragment.code.add(o$2P`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function t$16(fe){fe.code.add(o$2P`
    float lineFactorAtPosition(float value) {
      float pos = value * ${o$2P.float(257)};
      if(pos < 0.5 || pos > ${o$2P.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var Zhe;!function(fe){fe[fe.LayerOnly=0]="LayerOnly",fe[fe.ColorComposite=1]="ColorComposite",fe[fe.GridComposite=2]="GridComposite",fe[fe.COUNT=3]="COUNT"}(Zhe||(Zhe={}));let Xhe=class n39 extends Tq{constructor(){super(...arguments),this.overlayOpacity=1}};function s$13(fe,ve){const{vertex:_e,fragment:be,varyings:we}=fe;we.add("vtc","vec2"),_e.uniforms.add(new Khe("texOffsetAndScale")),be.uniforms.add(new ede("tex")),be.uniforms.add(new Qhe("textureOpacities"));const Se=ve.textureFadingEnabled&&!ve.renderOccluded;Se&&(_e.uniforms.add(new Khe("nextTexOffsetAndScale")),we.add("nvtc","vec2"),be.uniforms.add(new ede("texNext")),be.uniforms.add(new Qhe("nextTexOpacities")),be.uniforms.add(new Jhe("fadeFactor")));const Te=ve.tileBlendInput===Zhe.ColorComposite,Ee=ve.tileBlendInput===Zhe.GridComposite;Ee&&be.include(t$16),Te&&be.uniforms.add(new Qhe("backgroundColor")),_e.code.add(o$2P`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${Se?o$2P`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:o$2P``}
  }`),be.code.add(o$2P`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${Ee||Te?o$2P`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${Te?o$2P`backgroundColor`:o$2P`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:o$2P`return color;`}
    }`),Se?be.code.add(o$2P`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):be.code.add(o$2P`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Jhe=class d23 extends aO{constructor(fe){super(fe,"float")}},Qhe=class a41 extends aO{constructor(fe){super(fe,"vec3")}},Khe=class i40 extends aO{constructor(fe){super(fe,"vec4")}},ede=class l30 extends aO{constructor(fe){super(fe,"sampler2D")}},tde=class _12 extends Xhe{};function B$c(fe){const ve=new gO,{vertex:_e,fragment:be,varyings:we}=ve;ve.include(o$2p),ve.include(t$2b,fe),ve.include(o$2O,fe);const q8=()=>{ve.include(r$Y,fe),_e.code.add(o$2P`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};d$1$(_e,fe),ve.include(o$2n,fe);const Se=fe.overlayMode!==bY.Disabled,Te=Se&&fe.invisible;switch(fe.output){case NI.Color:{ve.include(s$13,fe),ve.include(p$2l,fe),Se&&ve.include(g$14,{...fe,pbrMode:fe.pbrMode===yM.Simplified?yM.TerrainWithWater:yM.Water});const Te=fe.overlayMode===bY.EnabledWithWater;Te&&ve.include(e$X,fe),we.add("vnormal","vec3"),we.add("vpos","vec3"),we.add("vup","vec3"),q8(),fe.screenSizePerspective&&p$2Q(_e);const Ee=fe.receiveShadows&&!fe.renderOccluded;Ee&&ve.include(n$2S,fe),fe.screenSizePerspective&&(we.add("screenSizeDistanceToCamera","float"),we.add("screenSizeCosAngle","float")),_e.code.add(o$2P`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${Te?o$2P`forwardVertexTangent(vnormal);`:o$2P``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Se?o$2P`setOverlayVTC(uv);`:""}
          ${fe.tileBorders?o$2P`forwardTextureCoordinates();`:""}

          ${fe.screenSizePerspective?o$2P`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${Ee?o$2P`forwardLinearDepth();`:""}

        }
      `),ve.include(P$H,fe),ve.include(p$2l,fe),ve.include(t$26,fe),ve.include(x$O,fe),f$20(be,fe),u$1U(be),h$1o(be),be.uniforms.add(_e.uniforms.get("localOrigin"),new uO("viewDirection",((fe,ve)=>z$1d(ide,o$44(ide,ve.camera.viewMatrix[12],ve.camera.viewMatrix[13],ve.camera.viewMatrix[14]))))),Te&&be.uniforms.add(new CO("ovWaterTex",((fe,ve)=>{var _e;return null==(_e=ve.overlay)?void 0:_e.getTexture(hY.WaterNormal)})),new FI("view",((fe,ve)=>i$45(rde,ve.camera.viewMatrix,fe.origin)))),be.code.add(o$2P`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),t$34(be),a$2$(be),be.code.add(o$2P`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${fe.receiveShadows&&!fe.renderOccluded?"readShadowMap(vpos, linearDepth)":fe.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Se?o$2P`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${fe.invisible?o$2P`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${fe.pbrMode===yM.Simplified||fe.pbrMode===yM.TerrainWithWater?o$2P`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:o$2P`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${Te?o$2P`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${fe.screenSizePerspective?o$2P`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${fe.visualizeNormals?fe.spherical?o$2P`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:o$2P`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${fe.tileBorders?o$2P`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case NI.Depth:Te&&ve.include(g$14,fe),_e.code.add(o$2P`
              void main(void) {
                ${Te?o$2P`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),be.code.add(o$2P`
              void main() {
                ${Te?o$2P`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case NI.Shadow:case NI.ShadowHighlight:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:ve.include(e$23,fe),t$2M(ve),i$2H(ve),_e.code.add(o$2P`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),be.code.add(o$2P`void main() {
outputDepth(linearDepth);
}`);break;case NI.Normal:Te&&ve.include(g$14,fe),we.add("vnormal","vec3"),p$2Q(_e),q8(),_e.code.add(o$2P`
        void main(void) {
          ${Te?o$2P`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),be.code.add(o$2P`
        void main() {
          ${Te?o$2P`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case NI.Highlight:Se&&ve.include(g$14,fe),_e.code.add(o$2P`
          void main() {
            ${Se?o$2P`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),ve.include(a$2n,fe),be.code.add(o$2P`
          void main() {
            ${Se?o$2P`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return fe.output===NI.ObjectAndLayerIdColor&&(Se?(ve.include(g$14,{...fe,pbrMode:yM.Disabled}),_e.code.add(o$2P`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),be.code.add(o$2P`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(_e.code.add(o$2P`void main(void) {
        ${fe.opaque?o$2P` gl_Position = transformPosition(proj, view, position);`:""}
      }`),be.code.add(o$2P`void main() {
fragColor = vec4(0.0);
}`))),ve}const rde=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ide=[0,0,0],nde=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:tde,build:B$c},Symbol.toStringTag,{value:"Module"}));let sde=class b14 extends fA{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global}initializeProgram(fe){return new gA(fe.rctx,b14.shader.get().build(this.configuration),ode)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(fe){const ve=this.configuration,_e=ve.backfaceCullingEnabled&&!ve.renderOccluded;return S$1g({blending:ve.renderOccluded?s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA):null,culling:_e?PA:null,depthTest:ve.renderOccluded?null:{func:jO.LESS},depthWrite:ve.renderOccluded?null:OA,colorWrite:AA,stencilTest:fe?t$2a(wA.IntegratedMeshMaskExcluded):null,drawBuffers:ve.output===NI.Depth?{buffers:[sA.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};sde.shader=new LO(nde,(()=>zt((()=>Promise.resolve().then((()=>vRe))),void 0)));const ode=new Map([[nO.POSITION,0],[nO.UV0,1],[nO.NORMALCOMPRESSED,2]]);let ade=class G7{constructor(){this.geometry=new xhe,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new Ehe((()=>this.tile.surface.fadeDuration)),this.overlay=new Yhe,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(fe,ve){this.clear(),this._tile=fe,this.geometry.reset(),this.intersectionData=null,this.geometryState=new The,this._localOrigin=ve,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(fe){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(fe),this._geometryStateChangedSinceLastUpdate=!1),nhe&&this.tile.intersectsClippingArea)for(let ve=0;ve<4;++ve)O$j(this.geometry.getEdgeCount(ve)===this.geometryState.edgeResolutions[ve]+1)}_calculateEdgeResolution(fe,ve){var _e;const be=this.tile,we=this.geometryState.numVerticesPerSide-1;if(!be.surface.isGlobal){const ve=be.surface.extent;if(null!=ve&&(0===fe&&be.extent[3]>ve[3]||1===fe&&be.extent[2]>ve[2]||2===fe&&be.extent[1]<ve[1]||3===fe&&be.extent[0]<ve[0]))return we}const Se=be.level,Te=ahe[fe];if(!ve)return O$j(null==(null==(_e=be.surface)?void 0:_e.rootTiles)||be.surface.updatingRootTiles||!be.shouldHaveNeighbor(Te)),we;if(ve.isLoaded){const _e=ve,be=_e.renderData.geometryState,Te=Se-_e.level;if(O$j(Te>=0),0===Te){const fe=be.numVerticesPerSide-1;return Math.max(fe,we)}const Ee=2**Te,Ce=be.edgeResolutions[(fe+2)%4]/Ee;return Math.max(1,Ce)}O$j(!ve.isLeaf);let Ee=we;return ve.forAllSubtreeOnSide(J$5(Te),(fe=>fe===be||(fe.isLoaded?(Ee=Math.max(Ee,2**(fe.level-Se)),!0):(O$j(!fe.isLeaf),!1)))),Ee}updateNeighborData(){var fe;const ve=this.tile;if(!ve.intersectsClippingArea)return;const _e=ve.renderData.geometryState,i52=fe=>(fe.isLoaded||fe.level===ve.level)&&(null==fe?void 0:fe.intersectsClippingArea),be=_e.edgePeerNeighbors,we=_e.edgePeerNeighborSamplerVersions;for(let Se=0;Se<4;++Se){const Te=ve.findNeighborTile(ahe[Se],i52),Ee=W$7(ve,Te),Ce=(null==(fe=null==Ee?void 0:Ee.renderData)?void 0:fe.geometryState.samplerDataVersion)??-1,Oe=be[Se],Re=Ee!==W$7(ve,Oe),De=we[Se]!==Ce;nhe&&Te&&(O$j(ve.level>=Te.level),O$j(ve.level-Te.level<=Zg)),be[Se]=Te,(Re||De)&&(we[Se]=Ce,this._markEdgeDirty(Se));const Be=_e.edgeResolutions[Se],Ze=this._calculateEdgeResolution(Se,Te);O$j(a$4v(Ze)),O$j(Ze>=1),_e.edgeResolutions[Se]=Ze,Be!==Ze&&this._markEdgeResolutionDirty(Se)}for(let Se=0;Se<4;++Se){const fe=ve.findNeighborTile(lhe[Se],i52);_e.cornerPeerNeighbors[Se]=fe;const we=W$7(ve,be[Se]),Te=W$7(ve,be[(Se+1)%4]),Ee=W$7(ve,fe);mde[Se]=Ee,mde[(Se+1)%4]=Te,mde[(Se+2)%4]=ve,mde[(Se+3)%4]=we,O$j(mde.some((fe=>(null==fe?void 0:fe.isLoaded)||fe===ve)));const Ce=mde.reduce(((fe,ve)=>Math.min(fe,(null==ve?void 0:ve.level)??1/0)),1/0);mde.forEach(((fe,ve)=>{fe&&(null==fe?void 0:fe.level)>Ce&&(mde[ve]=null)})),O$j(mde.some((fe=>(null==fe?void 0:fe.isLoaded)||fe===ve)));const Oe=_e.cornerNeighborCornerTiles,Re=_e.cornerNeighborCornerTileSamplerVersions;for(let ve=0;ve<4;++ve){const fe=mde[ve],_e=(null==fe?void 0:fe.renderData.geometryState.samplerDataVersion)??-1,be=4*Se+ve,we=Oe[be]!==fe,Te=!we&&Re[be]!==_e;(we||Te)&&(Oe[be]=fe,Re[be]=_e,this._markCornerDirty(Se))}nhe&&O$j(xde.some((fe=>{var _e;return(null==(_e=Oe[4*Se+fe])?void 0:_e.isLoaded)||Oe[4*Se+fe]===ve})))}nhe&&O$j(this.geometryState.edgeResolutions.every((fe=>fe>0)));for(let Se=0;Se<4;++Se)mde[Se]=null}_updateGeometry(fe){if(!this.tile.intersectsClippingArea)return;nhe&&O$j(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every((fe=>fe>0))),this.intersectionData=null;const{tile:ve,_vao:_e,geometry:be,geometryState:we}=this,Se=!_e||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,Te=0!==this.dirtyEdgeResolutions,Ee=we.edgeResolutions.reduce(((fe,ve)=>fe+ve+1),0),Ce=Se||Te&&Ee>((null==be?void 0:be.maxEdgeVertexCount)??0),Oe=!Ce&&Te,Re=!Oe&&(0!==this.dirtyEdges||Te),De=!Re&&0!==this.dirtyCorners;Ce?(this.releaseGeometry(),this._createGeometry(fe)):Oe?ve.updateEdgeElevationsAndResolutions():Re||De?ve.updateEdgeElevations():De&&ve.updateCornerElevations(),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=r$3M(this._vao),this.geometry.release(),!0)}ensureTexture(fe,ve,_e){const be=ve?YO.RGBA:YO.RGB;return null==this._texture||this._texture.descriptor.width===fe&&this._texture.descriptor.pixelFormat===be||this.releaseTexture(),null==this._texture&&(this._texture=_e(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&yde)}get samplerDataChanged(){return!!(this._modifiedFlags&gde)}get clippingAreaChanged(){return!!(this._modifiedFlags&vde)}get wireframeChanged(){return!!(this._modifiedFlags&_de)}get dirtyEdges(){return this._modifiedFlags>>$de&15}get dirtyCorners(){return this._modifiedFlags>>bde&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>wde&15}_markCornerDirty(fe){const ve=1<<fe<<bde;this._modifiedFlags|=ve}_markEdgeDirty(fe){const ve=1<<fe<<$de;this._modifiedFlags|=ve,this._markCornerDirty((fe+0)%4),this._markCornerDirty((fe+3)%4)}_markEdgeResolutionDirty(fe){const ve=1<<fe<<wde;this._modifiedFlags|=ve,this._markEdgeDirty(fe)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<bde|15<<$de|15<<wde}updateGeometryState(){const fe=this._getElevationInfo(),ve=this.tile,_e=fe.samplerData?ve.getElevationVerticesPerSide(fe.maxTileLevel):ve.getDefaultVerticesPerSide(),be=Math.max(_e,5);let we=ve.clippingArea;ve.intersectsClippingArea&&!ve.isWithinClippingArea||(we=null);const Se=this.geometryState;let Te=!1;Se.numVerticesPerSide!==be&&(this._modifiedFlags|=1,Se.numVerticesPerSide=be,Se.samplerDataVersion++,Te=!0),fe.changed&&(this._modifiedFlags|=2,Se.samplerData=fe.samplerData,Se.samplerDataVersion++,Te=!0),h$30(Se.clippingArea,we)||(this._modifiedFlags=4,Se.clippingArea=we,Te=!0);const Ee=ve.surface.wireframe;return Se.wireframe!==Ee&&(this._modifiedFlags=8,Se.wireframe=Ee,Te=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=Te),Te&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(fe){this.tile.createGeometry();const ve=this.geometry.vertexAttributes,_e=this.geometry.indices,be=fe.gl;this._vao=new tM(fe,ode,{geometry:t$2L(ve.layout)},{geometry:rM.createVertex(fe,be.STATIC_DRAW,ve.buffer)},rM.createIndex(fe,be.STATIC_DRAW,_e)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(fe,ve=Phe.Immediate){null!=fe&&fe.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(fe,ve)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const fe=this.geometryState.samplerData,ve=this.tile.layerInfo[Wle.ELEVATION],_e=ve.length,be=new Array(_e);let we=0,Se=0,Te=!1;for(let Oe=0;Oe<_e;Oe++){const _e=ve[Oe];if(null!=_e.upsampleInfo){const ve=_e.upsampleInfo.tile,Ee=ve.layerInfo[Wle.ELEVATION][Oe].data,Ce=Ee&&Ee.samplerData;fe&&fe[we]===Ce||(Te=!0),be[we++]=Ce,Se=Math.max(Se,ve.lij[0])}else if(_e.data){const ve=this.tile.surface.layerViewByIndex(Oe,Wle.ELEVATION);if(o$L(this.tile,ve.layer,!1)){const ve=_e.data;fe&&fe[we]===ve.samplerData||(Te=!0),be[we++]=ve.samplerData,Se=this.tile.level}}}null!=fe&&fe.length!==we&&(Te=!0);const Ee=we>0,Ce=Ee?be:null;return Ee&&(be.length=we),{changed:Te,samplerData:Ce,maxTileLevel:Se}}get estimatedGeometryMemoryUsage(){var fe,ve,_e;const be=(null==(fe=this.intersectionData)?void 0:fe.estimatedMemoryUsage)??0;return((null==(ve=this.geometry.indices)?void 0:ve.byteLength)??0)+((null==(_e=this.geometry.vertexAttributes)?void 0:_e.byteLength)??0)+be}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!nhe)return;const fe=this.tile;if(!fe.isLoaded||!fe.intersectsClippingArea||0===fe.level)return void O$j(null==fe?void 0:fe.isLoaded);const ve=fe.surface.extent;if(null!=ve&&!fe.intersectsExtent(ve))return;const _e=ahe.map(((_e,be)=>null!=ve&&(be<2?-1:1)*(fe.extent[3-be]-ve[3-be])<0)),be=fe.level;O$j(0===this.dirtyCorners),O$j(0===this.dirtyEdges),O$j(0===this.dirtyEdgeResolutions),O$j(!this.numVerticesPerSideChanged),O$j(!this.samplerDataChanged),O$j(!this.clippingAreaChanged),O$j(!this.wireframeChanged);const we=lhe.map((ve=>fe.findNeighborCornerTileExact(ve,(ve=>!ve.intersectsClippingArea||ve.isLoaded||ve.level===fe.level))??null)).map((fe=>(null==fe?void 0:fe.intersectsClippingArea)?fe:null)),Se=this.geometryState;for(let Te=0;Te<4;++Te){const ve=Se.cornerPeerNeighbors[Te],_e=we[Te];O$j(_e===ve,`Tile[${fe.lij}].corner[${Te}] out of date: cur=[${null==ve?void 0:ve.lij}] exp=[${null==_e?void 0:_e.lij}]`)}ahe.forEach(((ve,we)=>{if(_e[we])return;const Se=fe.findNeighborTile(ve,(fe=>(fe.level===be||(null==fe?void 0:fe.isLoaded))&&(null==fe?void 0:fe.intersectsClippingArea)));if(!Se){return void O$j(!(!fe.surface.updatingRootTiles&&null!=fe.surface.rootTiles&&fe.surface.rootTiles.length>0&&fe.shouldHaveNeighbor(ve)))}O$j(Se.isLoaded||Se.level===fe.level),O$j(Se===this.geometryState.edgePeerNeighbors[we]);const Te=be-Se.level;if(!Se.isLoaded)return O$j(!Se.isLeaf),void O$j(0===Te);const Ee=Se.renderData;O$j(function de$3(fe,ve,_e){if(null==fe||null==ve)return!1;if(0===fe.level&&0===ve.level){if(fe.isEastEnd&&ve.isWestEnd&&_e===Xue.EAST)return!0;if(fe.isWestEnd&&ve.isEastEnd&&_e===Xue.WEST)return!0}const be=Math.max(1e-6*(fe.extent[2]-fe.extent[0]),1);switch(_e){case Xue.NORTH:return q$d(fe.extent[3],ve.extent[1],be);case Xue.SOUTH:return q$d(fe.extent[1],ve.extent[3],be);case Xue.EAST:return q$d(fe.extent[2],ve.extent[0],be)||q$d(fe.extent[2],-ve.extent[0],be);case Xue.WEST:return q$d(fe.extent[0],ve.extent[2],be)||q$d(fe.extent[0],-ve.extent[2],be)}}(fe,Se,ve)),O$j(Te>=0);const Ce=2**Te;if(Te<0)return void O$j(!1);const Oe=fe.renderData,Re=Oe.geometry,De=Oe.localOrigin,Be=Re.getEdgeCount(we),Ze=Re.numVerticesPerSide-1,Xe=Ee.geometry;if(!Xe)return void O$j(!1);const Je=Ee.localOrigin,Qe=this.geometryState.edgePeerNeighbors[we];if(null==Qe?void 0:Qe.isLoaded){const fe=Qe.renderData;O$j(Oe.geometryState.edgePeerNeighborSamplerVersions[we]===fe.geometryState.samplerDataVersion),O$j(this.geometryState.edgePeerNeighborSamplerVersions[we]===fe.geometryState.samplerDataVersion)}const dt=(we+2)%4,$t=Xe.getEdgeCount(dt),bt=Be-1,wt=$t-1;O$j(bt*Ce===wt,`Tile[${fe.lij}]:e${we},res=${bt} edgeRes mismatch with Neighbor[${Se.lij}]:e${dt},res=${wt} (expected:${bt*Ce})`);const xt=fe.extent,St=ve===Xue.NORTH||ve===Xue.SOUTH,Et=$t-1,Pt=Et>>Te,Ot=Be-1;if(Pt<1)return void O$j(1===Ot);O$j(Pt===Ot),O$j(a$4v(Pt));const At=Xe.numVerticesPerSide-1;O$j(Te>0||Pt===Math.max(At,Ze));const Mt=fe.getNeighborEdgeStartVertexIndex(we,Se);O$j(0<=Mt&&Mt<Ce);const Rt=Mt*Pt;O$j(0<=Rt&&Rt<=Et-Pt);let Nt=0,Ft=Rt;Re.getEdgeVertexPosition(we,lde,De,0),Re.getEdgeVertexPosition(we,cde,De,Be-1);const zt=x$1W(lde,cde),kt=Math.max(fde,1e-4*zt);for(let _e=0;_e<=Pt;++_e){Re.getEdgeVertexPosition(we,lde,De,Nt),Xe.getEdgeVertexPosition(dt,cde,Je,Ft);const be=_e/Pt,Te=St?xt[0]+be*(xt[2]-xt[0]):ve===Xue.WEST?xt[0]:xt[2],Ce=St?ve===Xue.SOUTH?xt[1]:xt[3]:xt[1]+be*(xt[3]-xt[1]),Ze=fe.surface.extent;if(null==Ze||w$1U(Ze,Te,Ce)){const ve=nn(lde,cde),_e=dn(lde)-Rn.radius,be=dn(cde)-Rn.radius,Te=ve<kt;if(!Te){const Ce=[0,0,0];e$3Z(Ce,Oe.localOrigin,Ee.localOrigin),dn(Ce),(()=>{const ve=t$47(lde),_e=t$47(cde);fe.updateEdgeElevations(),Se.updateEdgeElevations(),Re.getEdgeVertexPosition(we,lde,De,Nt),Xe.getEdgeVertexPosition(dt,cde,Je,Ft);const be=[0,0,0];Ki(be,lde,ve),dn(be),Ki(be,cde,_e),dn(be)})();const Be=Re.getEdgeCount(we),Ze=Xe.getEdgeCount($t);O$j(Te,`Mismatch in tile [${fe.lij}].edge[${we}][${Nt}/${Be}] vs neighbor [${Se.lij}].edge[${dt}][${Ft}/${Ze}] ${P$e(lde)} vs ${P$e(cde)}  dist=${ve} h(t|n|d)=${_e}|${be}|${be-_e}`)}Re.getEdgeNormal(we,ude,Nt),Xe.getEdgeNormal(dt,hde,Ft),z$1d(dde,ude),z$1d(pde,hde);const Ce=P$1g(dde,pde),Ze=1-Ce<.01||fe===Se;if(!Ze){const ve=[0,0,0];Ki(ve,ude,hde);const r68=()=>`Mismatch in tile edge normal ${B$d(fe.lij)} (${Nt}/${Be-1}) edge ${we} vs neighbor ${B$d(Se.lij)}  (${Ft}/${$t-1}) nedge ${dt} :${P$e(ude)} vs ${P$e(hde)}  dot = ${Ce} : ${P$e(ve)}`;{fe.updateEdgeElevations(),Se.updateEdgeElevations();const ve=[0,0,0],_e=[0,0,0];Re.getEdgeNormal(we,ve,Nt),Xe.getEdgeNormal(dt,_e,Ft),H$19(ude,ve),H$19(hde,_e)}O$j(Ze,r68())}}Nt+=1,Ft+=1}}))}};const lde=[0,0,0],cde=[0,0,0],ude=[0,0,0],hde=[0,0,0],dde=[0,0,0],pde=[0,0,0],fde=1,mde=[null,null,null,null];function W$7(fe,ve){return(null==ve?void 0:ve.isLoaded)||ve===fe?ve:null}const yde=1,gde=2,vde=4,_de=8,$de=4,bde=8,wde=12,xde=[0,1,2,3],Sde=65536;function S$l(fe,ve){const{tile:_e,geometry:be,geometryState:we}=fe,{extentInRadians:Se,surface:Te}=_e,{isWebMercator:Ee,renderer:Ce}=Te,{numVerticesPerSide:Oe,wireframe:Re}=we,De=Oe-1,Be=(Oe-2)**2,Ze=Ee&&(ve===sY.HAS_SOUTH_POLE||ve===sY.HAS_BOTH_POLES),Xe=Ee&&(ve===sY.HAS_NORTH_POLE||ve===sY.HAS_BOTH_POLES),Je=((Ze?1:0)+(Xe?1:0))*Rde*Oe,Qe=fe$2(we),dt=Be+Je+4*Qe,$t=Ce.tileGeometryCache.acquire(dt);be.numVerticesPerSide=Oe,be.vertexAttributes=$t,be.maxEdgeVertexCount=Qe;const{boundingBox:bt}=be;P$$(bt);const wt=O$g(fe);Pde.update(De,Se,wt),function v$o(fe){const{tile:ve}=fe;if(!ve.intersectsClippingArea)return;const{geometry:_e,geometryState:be,localOrigin:we}=fe,{numVerticesPerSide:Se,samplerData:Te}=be,Ee=Se-2,Ce=Se-1,{vertexAttributes:Oe,boundingBox:Re}=_e,De=Oe.position,Be=Oe.uv0,{typedBuffer:Ze,typedBufferStride:Xe}=Oe.normalCompressed,{extent:Je}=ve,Qe=Je[0],dt=Je[2],$t=Je[1],bt=Je[3],wt=ve.ellipsoid.radius,xt=we[0],St=we[1],Et=we[2],Pt=De.typedBuffer,Ot=De.typedBufferStride,At=1/Ce;let Mt=0;if(1<=Ee){const fe=At,ve=$t*(1-fe)+bt*fe,_e=Pde.sinLatLUT[1],be=Pde.cosLatLUT[1];for(let we=1;we<=Ee;we++){const Se=we*At,Ee=Qe*(1-Se)+dt*Se,Ce=Pde.sinLonLUT[we],Oe=Pde.cosLonLUT[we],De=wt+e$Z(Ee,ve,Te),Ze=De*Oe*be-xt,Xe=De*Ce*be-St,Je=De*_e-Et;de$2(Ze,Xe,Je,Re);const $t=(we-1)*Ot;Pt[$t]=Ze,Pt[$t+1]=Xe,Pt[$t+2]=Je,u$X(Be,we-1,Se,fe)}}for(let Rt=1;Rt<=Ee;Rt++){const fe=Rt*At,ve=$t*(1-fe)+bt*fe,_e=Pde.sinLatLUT[Rt],be=Pde.cosLatLUT[Rt],we=Rt+1,Se=we*At,Oe=$t*(1-Se)+bt*Se,De=Pde.sinLatLUT[we],Je=Pde.cosLatLUT[we],Nt=Pde.sinLonLUT[0],Ft=Pde.cosLonLUT[0],zt=wt+e$Z(Qe,ve,Te);let kt=Ft*be*zt-xt,Bt=Nt*be*zt-St,jt=_e*zt-Et;const Gt=Mt*Ot;let Ht=Pt[Gt],qt=Pt[Gt+1],Wt=Pt[Gt+2];for(let bt=1;bt<=Ee;bt++){const fe=bt*At,we=Qe*(1-fe)+dt*fe,Nt=Pde.sinLonLUT[bt],Ft=Pde.cosLonLUT[bt];let zt=0,Gt=0,Yt=0;if(bt<Ee){const fe=(Mt+1)*Ot;zt=Pt[fe],Gt=Pt[fe+1],Yt=Pt[fe+2]}else{const fe=Pde.sinLonLUT[Ce],we=Pde.cosLonLUT[Ce],Se=wt+e$Z(dt,ve,Te);zt=we*be*Se-xt,Gt=fe*be*Se-St,Yt=_e*Se-Et}const Xt=kt,Jt=Bt,Qt=jt;kt=Ht,Bt=qt,jt=Wt,Ht=zt,qt=Gt,Wt=Yt;const Kt=zt-Xt,er=Gt-Jt,tr=Yt-Qt;let rr=0,ir=0,nr=0;if(Rt>1){const fe=(Mt-Ee)*Ot;rr=Pt[fe],ir=Pt[fe+1],nr=Pt[fe+2]}else{const fe=Pde.sinLatLUT[0],ve=Pde.cosLatLUT[0],_e=wt+e$Z(we,$t,Te);rr=Ft*ve*_e-xt,ir=Nt*ve*_e-St,nr=fe*_e-Et}const sr=wt+e$Z(we,Oe,Te),or=Ft*Je*sr-xt,ar=Nt*Je*sr-St,lr=De*sr-Et;if(Rt<Ee){const ve=Mt+Ee,_e=ve*Ot;Pt[_e]=or,Pt[_e+1]=ar,Pt[_e+2]=lr,de$2(or,ar,lr,Re),u$X(Be,ve,fe,Se)}const cr=rr-or,ur=ir-ar,hr=nr-lr;let dr=Ft*be,pr=Nt*be,fr=_e;fr*fr<.999&&(dr=tr*ur-er*hr,pr=Kt*hr-tr*cr,fr=er*cr-Kt*ur);const mr=1/Math.sqrt(dr*dr+pr*pr+fr*fr);s$1T(Ze,Mt,dr*mr,pr*mr,fr*mr,Xe),++Mt}}}(fe),be.poleVerticesStartIndex=Be;const xt=function y$z(fe,ve,_e){const{tile:be,localOrigin:we,geometry:Se}=fe,{extent:Te,ellipsoid:Ee}=be,{boundingBox:Ce,numVerticesPerSide:Oe,vertexAttributes:Re,poleVerticesStartIndex:De}=Se,Be=Oe-1,Ze=we[0],Xe=we[1],Je=we[2],Qe=Ee.radius,dt=Te[1],$t=Te[3],bt=[];let wt=De;const B11=(fe,ve)=>{const _e=ve*Oe;de$2(-Ze,-Xe,fe*Qe-Je,Ce),bt.push(new Tde(1===fe,_e,1===fe?0:2,wt,Rde));const be=P$d(-1===fe?dt:$t,Qe),we=fe*Math.PI/2-be,Se=.99*(1===fe?1:-1),Te=Qe+0,{position:Ee,uv0:De}=Re,{typedBuffer:xt,typedBufferStride:St}=Re.normalCompressed;for(let Oe=1;Oe<=Rde;++Oe){const fe=be+we*(Oe/Rde),ve=Math.cos(fe),_e=Math.sin(fe);for(let be=0;be<=Be;be++){const fe=be/Be,we=Pde.sinLonLUT[be],Oe=Pde.cosLonLUT[be]*ve,Re=we*ve,Qe=_e,dt=Oe*Te-Ze,$t=Re*Te-Xe,bt=Qe*Te-Je;de$2(dt,$t,bt,Ce),Ee.setValues(wt,dt,$t,bt),u$X(De,wt,fe,Se),s$1T(xt,wt,Oe,Re,Qe,St),++wt}}};return ve&&B11(-1,0),_e&&B11(1,Be),bt}(fe,Ze,Xe);be.edgeVerticesStartIndex=Be+Je,X$4(fe),V$f(fe),W$6(be,xt,Re),fe.intersectionData=null}function V$f(fe){fe.tile.intersectsClippingArea&&(C$e(fe),b$t(fe))}function b$t(fe,ve=!1){const{geometry:_e,geometryState:be,tile:we,localOrigin:Se}=fe,{level:Te,extent:Ee,extentInRadians:Ce,ellipsoid:Oe}=we,Re=Oe.radius,De=Ce[0],Be=Ce[2],Ze=Ce[1],Xe=Ce[3],{samplerData:Je}=be,Qe=Ee[0],dt=Ee[2],$t=Ee[1],bt=Ee[3],wt=O$g(fe),{boundingBox:xt,vertexAttributes:St}=_e,Et=Se[0],Pt=Se[1],Ot=Se[2],At=St.position,Mt=At.typedBuffer,Rt=At.typedBufferStride,Nt=St.uv0;for(let Ft=0;Ft<4;++Ft){const Se=1===Ft||3===Ft,Ce=be.edgeResolutions[Ft];O$j(a$4v(Ce));const Oe=Ce+1,St=W$7(we,be.edgePeerNeighbors[Ft]);if(ce$2(we,St,Ft)){Z$4(fe,Ft,St);continue}const At=null!=St;O$j(!At||St.level===we.level),O$j(!At||u$W(we,St)<=0);const zt=null==St?void 0:St.renderData,kt=null==zt?void 0:zt.geometryState;if(nhe){const fe=we.surface;if(!St&&fe&&!fe.updatingRootTiles){const ve=ahe[Ft],_e=we.findNeighborTile(ve,(fe=>fe.isLoaded||fe.isLeaf||fe.level===we.level));_e?_e.intersectsClippingArea&&(O$j(!_e.isLoaded),O$j(!_e.isLeaf),O$j(_e.level===Te)):O$j(null==(null==fe?void 0:fe.rootTiles)||!we.shouldHaveNeighbor(ve))}}const Bt=1===Ft?Ee[2]:Ee[0],jt=null==St?void 0:St.extent,Gt=jt&&Se?1===Ft?jt[0]:jt[2]:Bt,Ht=0===Ft?Ee[3]:Ee[1],qt=1===Ft?1:0,Wt=0===Ft?1:0,Yt=1===Ft?Be:De,Xt=0===Ft?Xe:Ze,Jt=Math.sin(Yt),Qt=Math.cos(Yt),Kt=Math.sin(Xt),er=Math.cos(Xt),tr=null==kt?void 0:kt.samplerData,rr=At?(fe,ve,_e)=>.5*(e$Z(fe,ve,Je)+e$Z(_e,ve,tr)):(fe,ve,_e)=>e$Z(fe,ve,Je),ir=_e.outerEdgesOffsetAndLength[2*Ft+0],nr=ve&&Oe>3?Oe-3:1,sr=null!=Je&&Je.some((fe=>null!=fe)),or=null!=tr&&tr.some((fe=>null!=fe)),ar=sr||or,lr=1/Ce,cr=ir;O$j(!jt||q$d(jt[2]-jt[0],Ee[2]-Ee[0])),(()=>{const fe=1===Ft?-1:3===Ft?1:0,ve=0===Ft?-1:2===Ft?1:0,be=(Ee[2]-Ee[0])*lr,we=fe*be,Te=ve*be,Ce=Se?fe*((Be-De)*lr):0,Ze=Se?0:ve*lr,Xe=Wt,St=Se?Yt+Ce:Yt,zt=Se?Math.sin(St):Jt,kt=Se?Math.cos(St):Qt,jt=Se?Yt-Ce:Yt,ir=Se?Math.sin(jt):Jt,sr=Se?Math.cos(jt):Qt,or=Se?Xt:wt(Xe+Ze),ur=Se?Kt:Math.sin(or),hr=Se?er:Math.cos(or),dr=Se?Xt:wt(Xe-Ze),pr=Se?Kt:Math.sin(dr),fr=Se?er:Math.cos(dr);let mr=0,yr=0,gr=0;{const fe=0*lr,ve=Se?Bt:Qe*(1-fe)+dt*fe,_e=Se?Gt:ve,be=Se?$t*(1-fe)+bt*fe:Ht,we=Se?Yt:De*(1-fe)+Be*fe,Te=Se?Jt:Math.sin(we),Ee=Se?Qt:Math.cos(we),Ce=Se?wt(fe):Xt,Oe=Se?Math.sin(Ce):Kt,Ze=Se?Math.cos(Ce):er,Xe=Re+rr(ve,be,_e);mr=Ee*Ze*Xe,yr=Te*Ze*Xe,gr=Oe*Xe}let vr=0,_r=0,$r=0;{const fe=1*lr,ve=Se?Bt:Qe*(1-fe)+dt*fe,_e=Se?Gt:ve,be=Se?$t*(1-fe)+bt*fe:Ht,we=Se?Yt:De*(1-fe)+Be*fe,Te=Se?Jt:Math.sin(we),Ee=Se?Qt:Math.cos(we),Ce=Se?wt(fe):Xt,Oe=Se?Math.sin(Ce):Kt,Ze=Se?Math.cos(Ce):er,Xe=Re+rr(ve,be,_e);vr=Ee*Ze*Xe,_r=Te*Ze*Xe,$r=Oe*Xe}for(let Ee=1;Ee<Oe-1;Ee+=nr){let fe=0,ve=0,be=0;{const _e=(Ee+1)*lr,we=Se?Bt:Qe*(1-_e)+dt*_e,Te=Se?Gt:we,Ce=Se?$t*(1-_e)+bt*_e:Ht,Oe=Se?Yt:De*(1-_e)+Be*_e,Ze=Se?Jt:Math.sin(Oe),Xe=Se?Qt:Math.cos(Oe),Je=Se?wt(_e):Xt,xt=Se?Math.sin(Je):Kt,St=Se?Math.cos(Je):er,Et=Re+rr(we,Ce,Te);fe=Xe*St*Et,ve=Ze*St*Et,be=xt*Et}const Ce=fe,Oe=ve,Ze=be,Xe=vr,St=_r,jt=$r;vr=Ce,_r=Oe,$r=Ze;{const fe=cr+Ee,ve=fe*Rt,_e=Xe-Et,be=St-Pt,we=jt-Ot;Mt[ve]=_e,Mt[ve+1]=be,Mt[ve+2]=we,de$2(_e,be,we,xt);const Te=Ee*lr;u$X(Nt,fe,Se?qt:Te,Se?Te:Wt)}const nr=mr,or=yr,dr=gr;mr=Xe,yr=St,gr=jt;const br=Xe,wr=St,xr=jt,Sr=1/Math.sqrt(br*br+wr*wr+xr*xr),Tr=xr*Sr;let Er=0,Pr=0,Cr=0;if(ar&&Tr*Tr<.999){let fe=0,ve=0,_e=0;{const be=0===Ft?-1:1;fe=be*(Ce-nr),ve=be*(Oe-or),_e=be*(Ze-dr)}{const be=Ee*lr,Ce=Se?Bt:Qe*(1-be)+dt*be,Oe=Se?Gt:Ce,Ze=Se?$t*(1-be)+bt*be:Ht,Xe=Se?Yt:De*(1-be)+Be*be,xt=Se?Jt:Math.sin(Xe),St=Se?Qt:Math.cos(Xe),Et=Se?wt(be):Xt,Pt=Se?Math.sin(Et):Kt,Ot=Se?Math.cos(Et):er;let Mt=br,Rt=wr,Nt=xr;if(At){const fe=Re+e$Z(Oe-we,Ze-Te,tr),ve=Se?Ot:fr;Mt=(Se?sr:St)*ve*fe,Rt=(Se?ir:xt)*ve*fe,Nt=(Se?Pt:pr)*fe}{const be=Re+e$Z(Ce+we,Ze+Te,Je),Ee=Se?Ot:hr,Oe=(Se?kt:St)*Ee*be,De=(Se?zt:xt)*Ee*be,Be=(Se?Pt:ur)*be;At||(Mt=2*br-Oe,Rt=2*wr-De,Nt=2*xr-Be);const Xe=3===Ft?-1:1,Qe=Xe*(Mt-Oe),dt=Xe*(Rt-De),$t=Xe*(Nt-Be);Er=_e*dt-ve*$t,Pr=fe*$t-_e*Qe,Cr=ve*Qe-fe*dt;const bt=1/Math.sqrt(Er*Er+Pr*Pr+Cr*Cr);Er*=bt,Pr*=bt,Cr*=bt}}}else Er=br*Sr,Pr=wr*Sr,Cr=xr*Sr;_e.setEdgeNormalFromValues(Ft,Ee,Er,Pr,Cr)}})()}}function C$e(fe){$$5(fe)}function P$d(fe,ve){return Math.PI/2-2*Math.atan(Math.exp(-fe/ve))}function O$g(fe){const{tile:ve}=fe;if(ve.surface.isWebMercator){const fe=ve.extent,_e=ve.ellipsoid.radius;return ve=>function A$n(fe,ve,_e,be){return P$d(fe*(1-be)+ve*be,_e)}(fe[1],fe[3],_e,ve)}const _e=ve.extentInRadians;return fe=>function E$g(fe,ve,_e){return fe*(1-_e)+ve*_e}(_e[1],_e[3],fe)}function T$d(fe,ve){const{tile:_e,geometryState:be,geometry:we}=fe,{extent:Se,surface:Te}=_e,{wireframe:Ee}=be,Ce=Se[0],Oe=Se[1],Re=Se[2]-Ce,De=Se[3]-Oe,{numVerticesPerSide:Be,clippingArea:Ze}=be,Xe=null!=Ze?Math.max(0,(Ze[0]-Ce)/Re):0,Je=null!=Ze?Math.max(0,(Ze[1]-Oe)/De):0,Qe=null!=Ze?Math.min(1,(Ze[2]-Ce)/Re):1,dt=null!=Ze?Math.min(1,(Ze[3]-Oe)/De):1,$t=(Be-2)**2,bt=fe$2(be),wt=$t+4*bt,xt=Te.renderer.tileGeometryCache.acquire(wt),{boundingBox:St}=we;P$$(St),we.numVerticesPerSide=Be,we.vertexAttributes=xt,we.maxEdgeVertexCount=bt,we.minu=Xe,we.minv=Je,we.maxu=Qe,we.maxv=dt,function D$e(fe){const ve=fe.tile;if(!ve.intersectsClippingArea)return;const{geometry:_e,geometryState:be,localOrigin:we}=fe,{samplerData:Se,clippingArea:Te,numVerticesPerSide:Ee}=be,{surface:Ce,extent:Oe,ellipsoid:Re}=ve,{isWebMercatorOnPlateCarree:De}=Ce,Be=null!=Te?Te:Cde,Ze=Oe[0],Xe=Oe[1],Je=Oe[2],Qe=Oe[3],dt=Math.max(Ze,Be[0]),$t=Math.min(Je,Be[2]),bt=Math.max(Xe,Be[1]),wt=Math.min(Qe,Be[3]),xt=Re.radius,St=ve.horizontalScale,Et=Ee-1,Pt=Ee-2,{minu:Ot,minv:At,maxu:Mt,maxv:Rt,boundingBox:Nt,vertexAttributes:Ft}=_e,zt=Ft.position,kt=Ft.uv0,{typedBuffer:Bt,typedBufferStride:jt}=Ft.normalCompressed,Gt=we[0],Ht=we[1],qt=we[2],Wt=zt.typedBuffer,Yt=zt.typedBufferStride;let Xt=0;const Jt=e$3Y(Xe,bt,wt),Qt=De?(Math.PI/2-2*Math.atan(Math.exp(-Jt/xt)))*xt:Jt*St,Kt=1/Et,er=e$3Y(Xe*(1-Kt)+Qe*Kt,bt,wt);let tr=Qt,rr=De?(Math.PI/2-2*Math.atan(Math.exp(-er/xt)))*xt:er*St;for(let ir=1;ir<=Pt;ir++){const fe=ir/Et,ve=e$3Y(Xe*(1-fe)+Qe*fe,bt,wt),_e=e$3Y(fe,At,Rt),be=rr,we=(ir-1)/Et,Te=e$3Y(Xe*(1-we)+Qe*we,bt,wt),Ee=tr,Ce=(ir+1)/Et,Oe=e$3Y(Xe*(1-Ce)+Qe*Ce,bt,wt),Re=De?(Math.PI/2-2*Math.atan(Math.exp(-Oe/xt)))*xt:Oe*St,Be=e$3Y(Ce,At,Rt);tr=rr,rr=Re;const Ft=e$3Y(Ze,dt,$t);let zt=Ft*St,Jt=e$Z(Ft,ve,Se);const Qt=1/Et,Kt=e$3Y(Qt,Ot,Mt),er=e$3Y(Ze*(1-Kt)+Je*Kt,dt,$t);let nr=Kt,sr=er,or=er*St,ar=e$Z(er,ve,Se);if(1===ir){const fe=or-Gt,ve=tr-Ht,be=ar-qt,we=0*Yt;Wt[we]=fe,Wt[we+1]=ve,Wt[we+2]=be,de$2(fe,ve,be,Nt);u$X(kt,Xt,e$3Y(Qt,Ot,Mt),_e)}for(let De=1;De<=Pt;De++){const fe=or,we=ar,Ce=(De+1)/Et,Xe=e$3Y(Ce,Ot,Mt),Qe=e$3Y(Ze*(1-Ce)+Je*Ce,dt,$t),bt=sr;sr=Qe;{const fe=Xt+1,we=fe*Yt;if(1===ir||De===Pt){const Te=Qe*St,Ee=e$Z(Qe,ve,Se);if(1===ir&&De<Pt){const ve=Te-Gt,Se=be-Ht,Ce=Ee-qt;Wt[we]=ve,Wt[we+1]=Se,Wt[we+2]=Ce,de$2(ve,Se,Ce,Nt),u$X(kt,fe,Xe,_e)}or=Te,ar=Ee}else or=Wt[we]+Gt,ar=Wt[we+2]+qt}const wt=or,xt=ar,At=zt,Rt=Jt;zt=fe,Jt=we;const Ft=(Xt-Pt)*Yt,Qt=1===ir?e$Z(bt,Te,Se):Wt[Ft+2]+qt,Kt=e$Z(bt,Oe,Se);if(ir<Pt){const ve=Xt+Pt,_e=ve*Yt,be=fe-Gt,we=Re-Ht,Se=Kt-qt;Wt[_e]=be,Wt[_e+1]=we,Wt[_e+2]=Se,de$2(be,we,Se,Nt);const Te=nr;nr=Xe,u$X(kt,ve,Te,Be)}{const fe=wt-At,ve=Ee-Re,_e=ve*(xt-Rt),be=fe*(Qt-Kt),we=-ve*fe,Se=_e*_e+be*be+we*we;if(0===Se)s$1T(Bt,Xt,0,0,1,jt);else{const fe=1/Math.sqrt(Se);s$1T(Bt,Xt,_e*fe,be*fe,we*fe,jt)}}++Xt}}}(fe),we.edgeVerticesStartIndex=$t,X$4(fe),w$r(fe),W$6(we,[],Ee),fe.intersectionData=null}function w$r(fe,ve){fe.tile.intersectsClippingArea&&(F$f(fe),j$l(fe,!1))}function j$l(fe,ve){const{geometry:_e,geometryState:be,localOrigin:we}=fe,Se=fe.tile,{surface:Te,extent:Ee}=Se,{clippingArea:Ce,samplerData:Oe}=be,Re=null!=Ce?Ce:Cde,De=Ee[0],Be=Ee[2],Ze=Ee[1],Xe=Ee[3],Je=[Xe>Re[3],Be>Re[2],Ze<Re[1],De<Re[0]],Qe=Se.horizontalScale,dt=_$k(Te.isWebMercatorOnPlateCarree,Se.ellipsoid.radius,Qe),{minu:$t,minv:bt,maxu:wt,maxv:xt,boundingBox:St}=_e,Et=Math.max(De,Re[0]),Pt=Math.min(Be,Re[2]),Ot=Math.max(Ze,Re[1]),At=Math.min(Xe,Re[3]),Mt=we[0],Rt=we[1],Nt=we[2];for(let Ft=0;Ft<4;++Ft){const we=1===Ft||3===Ft,Ee=be.edgeResolutions[Ft];O$j(a$4v(Ee));const Ce=Ee+1,Re=Je[Ft],zt=W$7(Se,be.edgePeerNeighbors[Ft]);if(!Re&&ce$2(Se,zt,Ft)){Z$4(fe,Ft,zt);continue}const kt=null!=zt&&!Re,Bt=null==zt?void 0:zt.renderData,jt=null==Bt?void 0:Bt.geometryState;if(nhe&&(O$j(!kt||zt.level===Se.level),O$j(!kt||u$W(Se,zt)<=0),Se&&!zt&&!Te.updatingRootTiles)){const fe=ahe[Ft],ve=Se.findNeighborTile(fe,(fe=>fe.isLoaded||fe.isLeaf||fe.level===Se.level));Te.updatingRootTiles||(ve?ve.intersectsClippingArea&&(O$j(!ve.isLoaded),O$j(!ve.isLeaf),O$j(ve.level===Se.level)):O$j(null==(null==Te?void 0:Te.rootTiles)||!Se.shouldHaveNeighbor(fe)))}const Gt=e$3Y(1===Ft?Be:De,Et,Pt),Ht=e$3Y(0===Ft?Xe:Ze,Ot,At),qt=null==jt?void 0:jt.samplerData,Wt=ve&&Ce>3?Ce-3:1,Yt=e$3Y(1===Ft?1:0,$t,wt),Xt=e$3Y(0===Ft?1:0,bt,xt),Jt=kt?(fe,ve)=>.5*(e$Z(fe,ve,qt)+e$Z(fe,ve,Oe)):(fe,ve)=>e$Z(fe,ve,Oe),Qt=(Be-De)/Ee,Kt=we?1===Ft?Qt:-Qt:0,er=we?0:0===Ft?Qt:-Qt,tr=-Kt,rr=-er;let ir=0,nr=0,sr=0;{const fe=0/Ee,ve=we?Gt:e$3Y(De*(1-fe)+Be*fe,Et,Pt),_e=we?e$3Y(Ze*(1-fe)+Xe*fe,Ot,At):Ht,be=Jt(ve,_e);ir=ve*Qe,nr=dt(_e),sr=be}let or=0,ar=0,lr=0;{const fe=1/Ee,ve=we?Gt:e$3Y(De*(1-fe)+Be*fe,Et,Pt),_e=we?e$3Y(Ze*(1-fe)+Xe*fe,Ot,At):Ht,be=Jt(ve,_e);or=ve*Qe,ar=dt(_e),lr=be}for(let fe=1;fe<Ce-1;fe+=Wt){const ve=fe/Ee,be=or,Se=ar,Te=lr;{const Ee=we?Yt:e$3Y(ve,$t,wt),Ce=we?e$3Y(ve,bt,xt):Xt,Oe=be-Mt,Re=Se-Rt,De=Te-Nt;de$2(be,Re,De,St),_e.setEdgeVertexFromValuesRawPositionUV(Ft,fe,Oe,Re,De,Ee,Ce)}{const ve=(fe+1)/Ee,_e=we?Gt:e$3Y(De*(1-ve)+Be*ve,Et,Pt),be=we?e$3Y(Ze*(1-ve)+Xe*ve,Ot,At):Ht,Se=Jt(_e,be);or=_e*Qe,ar=dt(be),lr=Se}const Ce=or,Re=lr,Je=ir,zt=nr,Bt=sr;ir=be,nr=Se,sr=Te;let jt=0,Wt=0,Qt=0;if(we){const fe=ar-Se,_e=Re-Te,we=zt-Se,Ee=Bt-Te,Ce=e$3Y(Ze*(1-ve)+Xe*ve,Ot,At),De=Gt+tr,Be=De*Qe-be,Je=e$Z(De,Ce,Oe)-Te,dt=3===Ft?-1:1;if(jt=dt*(-we+fe)*Je,Wt=dt*Be*(-Ee+_e),Qt=-dt*Be*(-we+fe),kt){const ve=Gt+Kt,Se=ve*Qe-be;jt=(-we+fe)*(Je-(e$Z(ve,Ce,qt)-Te)),Wt=(Be-Se)*(-Ee+_e),Qt=-(Be-Se)*(-we+fe)}}else{const fe=Ce-be,_e=Re-Te,we=Je-be,Ee=Bt-Te,Ze=e$3Y(De*(1-ve)+Be*ve,Et,Pt),Xe=Ht+rr,Qe=e$Z(Ze,Xe,Oe)-Te,$t=dt(Xe)-Se,bt=2===Ft?-1:1;if(jt=bt*$t*(-Ee+_e),Wt=bt*(-we+fe)*Qe,Qt=-bt*$t*(-we+fe),kt){const ve=Ze,be=Ht+er,Ce=dt(be)-Se;jt=(-$t+Ce)*(-Ee+_e),Wt=(-we+fe)*(-Qe+(e$Z(ve,be,qt)-Te)),Qt=-(-$t+Ce)*(-we+fe)}}const cr=1/Math.sqrt(jt*jt+Wt*Wt+Qt*Qt);_e.setEdgeNormalFromValues(Ft,fe,jt*cr,Wt*cr,Qt*cr)}}}function F$f(fe,ve){$$5(fe)}function _$k(fe,ve,_e){return fe?fe=>function H$9(fe,ve){return(Math.PI/2-2*Math.atan(Math.exp(-fe/ve)))*ve}(fe,ve):fe=>function q$9(fe,ve){return fe*ve}(fe,_e)}function W$6(fe,ve,_e){const{numVerticesPerSide:be,vertexAttributes:we,maxEdgeVertexCount:Se}=fe,Te=be-1,Ee=we.count,Ce=2*(be-3)*(be-3),Oe=4*(Te+Se-3),Re=xde.reduce(((ve,_e)=>ve+(Te+fe.getEdgeCount(_e)-3)),0),De=ve.reduce(((fe,ve)=>fe+Te*(2*(ve.latitudeResolution-1)+1)),0),Be=3*(_e?2:1),Ze=(Ce+Oe+De)*Be,Xe=Ee>=Sde?new Uint32Array(Ze):new Uint16Array(Ze);for(let Je=0;Je<Ze;++Je)Xe[Je]=0;fe.indices=Xe,fe.indexCount=(Ce+Re+De)*Be,fe.poleIndicesStartIndex=Ce*Be,fe.edgeIndicesStartIndex=(Ce+De)*Be,_e?(function J$3(fe){const{indices:ve,numVerticesPerSide:_e,vertexAttributes:be}=fe,{position:we}=be,{typedBuffer:Se,typedBufferStride:Te}=we,Ee=_e-2;let Ce=0;for(let Oe=0;Oe<_e-3;++Oe){const fe=Oe*Ee;for(let be=0;be<_e-3;++be){const _e=Oe*Ee+be,we=_e+1,Re=we+Ee,De=Re-1,Be=fe+be,Ze=Be+1,Xe=Ze+Ee;me$1(Be,Ze,Xe,Xe-1,Te,Se)?(ge$1(ve,Ce,_e,we,Re),Ce+=6,ge$1(ve,Ce,Re,De,_e)):(ge$1(ve,Ce,_e,we,De),Ce+=6,ge$1(ve,Ce,De,Re,we)),Ce+=6}}}(fe),function K$4(fe,ve){const{indices:_e,numVerticesPerSide:be,poleIndicesStartIndex:we}=fe,Se=be-1;let Te=we;for(const Ee of ve){const ve=Ee.connectedOuterEdgeOffset;let we=fe.getEdgeVertexIndex(ve,0),Ce=1;for(let fe=0;fe<Ee.latitudeResolution;++fe){const ve=0===fe?Ee.rowOffset:we+be;for(let be=0;be<Se;be++)ge$1(_e,Te,we,we+1,ve+be),Te+=6,fe<Ee.latitudeResolution-1&&(ge$1(_e,Te,we+1,ve+be+1,ve+be),Te+=6),we+=Ce;we=ve,Ce=1}}}(fe,ve),Q$5(fe)):(function G$8(fe){const{numVerticesPerSide:ve,indices:_e,vertexAttributes:be}=fe,{position:we}=be,{typedBuffer:Se,typedBufferStride:Te}=we,Ee=ve-2,Ce=ve-3,Oe=0,Re=ve-3;let De=0;for(let Be=0;Be<Ce;++Be){const fe=Be*Ee;for(let ve=Oe;ve<Re;++ve){const be=fe+ve,we=be+1,Ce=we+Ee,Oe=Ce-1;me$1(be,we,Ce,Oe,Te,Se)?(_e[De]=be,_e[De+1]=we,_e[De+2]=Ce,_e[De+3]=Ce,_e[De+4]=Oe,_e[De+5]=be):(_e[De]=be,_e[De+1]=we,_e[De+2]=Oe,_e[De+3]=Oe,_e[De+4]=we,_e[De+5]=Ce),De+=6}}}(fe),function k$c(fe,ve){const{numVerticesPerSide:_e,indices:be,poleIndicesStartIndex:we}=fe,Se=_e-1;let Te=we;for(const Ee of ve){const ve=Ee.isNorth?1:2,we=Ee.isNorth?2:1,Ce=Ee.isNorth?3:4,Oe=Ee.isNorth?4:3;let Re=fe.getEdgeVertexIndex(Ee.connectedOuterEdgeOffset,0),De=1;for(let fe=0;fe<Ee.latitudeResolution;++fe){const Be=0===fe?Ee.rowOffset:Re+_e;for(let _e=0;_e<Se;_e++){const Se=Be+_e;be[Te]=Re,be[Te+ve]=Re+1,be[Te+we]=Se,fe<Ee.latitudeResolution-1?(be[Te+Ce]=Re+1,be[Te+Oe]=Se+1,be[Te+5]=Se,Te+=6):Te+=3,Re+=De}Re=Be,De=1}}}(fe,ve),z$9(fe))}function z$9(fe){const{indices:ve,numVerticesPerSide:_e,edgeIndicesStartIndex:be}=fe,we=_e-1,Se=we-2;let Te=be;for(let Ee=0;Ee<4;++Ee){const _e=Mde[Ee];let be=0,Ce=0;const Oe=fe.getEdgeCount(Ee),Re=_e.count;O$j(Re===we-1);const De=1===Ee||2===Ee,Be=De?1:2,Ze=De?2:1,Xe=fe.getEdgeFirstVertexIndex(Ee),Je=1,Qe=_e.vertex0Index,dt=_e.stride;for(;be<Oe-1||Ce<Re-1;){const fe=Qe+Ce*dt,_e=Xe+be*Je,Ee=be<Oe-1,De=Ce<Re-1,$t=Ee&&(!De||(Ee?0+we*(be+.5)/(Oe-1):0)<=(De?1+Se*(Ce+.5)/(Re-1):0));$t?++be:++Ce;const bt=$t?_e+Je:fe+dt;ve[Te]=fe,ve[Te+Be]=_e,ve[Te+Ze]=bt,Te+=3}}fe.indexCount=Te}function Q$5(fe){const{indices:ve,numVerticesPerSide:_e,edgeIndicesStartIndex:be}=fe,we=_e-1,Se=we-2;let Te=be;for(let Ee=0;Ee<4;++Ee){const _e=Mde[Ee];let be=0,Ce=0;const Oe=fe.getEdgeCount(Ee),Re=_e.count;O$j(Re===we-1);const De=1===Ee||2===Ee,Be=De?1:3,Ze=De?3:1,Xe=fe.getEdgeFirstVertexIndex(Ee),Je=1,Qe=_e.vertex0Index,dt=_e.stride;for(;be<Oe-1||Ce<Re-1;){const fe=Qe+Ce*dt,_e=Xe+be*Je,Ee=be<Oe-1,De=Ce<Re-1,$t=Ee&&(!De||(Ee?0+we*(be+.5)/(Oe-1):0)<=(De?1+Se*(Ce+.5)/(Re-1):0));$t?++be:++Ce;const bt=$t?_e+Je:fe+dt;ve[Te]=fe,ve[Te+Be]=_e,ve[Te+Be+1]=_e,ve[Te+Ze]=bt,ve[Te+Ze+1]=bt,ve[Te+5]=fe,Te+=6}}fe.indexCount=Te}function X$4(fe){const{geometry:ve,geometryState:_e}=fe,{edgeResolutions:be}=_e,{numVerticesPerSide:we,edgeVerticesStartIndex:Se}=ve,Te=we-2;let Ee=Se;for(let Ce=0;Ce<4;++Ce){{const fe=0===Ce||2===Ce,ve=(0===Ce?Te-1:0)*Te+(1===Ce?Te-1:0),_e=(fe?0:1)*Te+(fe?1:0),be=Mde[Ce];be.vertex0Index=ve,be.stride=_e,be.count=Te}{const fe=be[Ce]+1;ve.outerEdgesOffsetAndLength[2*Ce+0]=Ee,ve.outerEdgesOffsetAndLength[2*Ce+1]=fe,Ee+=fe}}}function Y$2(fe){X$4(fe),fe.geometryState.wireframe?Q$5(fe.geometry):z$9(fe.geometry)}function Z$4(fe,ve,_e){const{geometryState:be,geometry:we,tile:Se,localOrigin:Te}=fe,Ee=1===ve||3===ve,Ce=be.edgeResolutions[ve];O$j(a$4v(Ce));const Oe=Ce+1,{boundingBox:Re,minu:De,minv:Be,maxu:Ze,maxv:Xe,vertexAttributes:Je}=we,Qe=e$3Y(1===ve?1:0,De,Ze),dt=e$3Y(0===ve?1:0,Be,Xe),$t=_e.renderData,bt=$t.geometryState,wt=$t.geometry,xt=(ve+2)%4,St=wt.getEdgeCount(xt),Et=Se.getNeighborEdgeStartVertexIndex(ve,_e)*Ce,Pt=Ce*2**(Se.level-_e.level);O$j(bt.edgeResolutions[xt]===Pt),O$j(St-1===Pt);const Ot=$t.localOrigin[0]-Te[0],At=$t.localOrigin[1]-Te[1],Mt=$t.localOrigin[2]-Te[2],Rt=we.getEdgeFirstVertexIndex(ve),Nt=Je.position,Ft=Nt.typedBuffer,zt=Nt.typedBufferStride,kt=Je.normalCompressed,Bt=kt.typedBuffer,jt=kt.typedBufferStride,Gt=Je.uv0,Ht=wt.vertexAttributes,qt=wt.getEdgeFirstVertexIndex(xt),Wt=Ht.position.typedBuffer,Yt=Ht.position.typedBufferStride,Xt=Ht.normalCompressed.typedBuffer,Jt=Ht.normalCompressed.typedBufferStride;for(let Qt=1;Qt<Oe-1;++Qt){const fe=Rt+Qt,ve=qt+(Et+Qt),_e=fe*zt,be=ve*Yt,we=Wt[be]+Ot,Se=Wt[be+1]+At,Te=Wt[be+2]+Mt;Ft[_e]=we,Ft[_e+1]=Se,Ft[_e+2]=Te,de$2(we,Se,Te,Re);const Oe=fe*jt,Je=ve*Jt;Bt[Oe]=Xt[Je],Bt[Oe+1]=Xt[Je+1];const $t=Qt/Ce;u$X(Gt,fe,Ee?Qe:e$3Y($t,De,Ze),Ee?e$3Y($t,Be,Xe):dt)}}function $$5(fe){var ve;const{geometry:_e,geometryState:be,localOrigin:we}=fe,{clippingArea:Se,samplerData:Te}=be,{minu:Ee,minv:Ce,maxu:Oe,maxv:Re,boundingBox:De,vertexAttributes:Be}=_e,Ze=fe.tile,{surface:Xe,ellipsoid:Je,extent:Qe,extentInRadians:dt,horizontalScale:$t}=Ze,bt="local"===(null==(ve=Xe.view)?void 0:ve.viewingMode),wt=Je.radius;let xt=0,St=0,Et=0;const Pt=bt?(()=>{const fe=Se,ve=null!=fe&&(Qe[3]>fe[3]||Qe[2]>fe[2]||Qe[1]<fe[1]||Qe[0]<fe[0]),_e=_$k(Xe.isWebMercatorOnPlateCarree,wt,$t);return(be,we,Se)=>{const Te=0===be?Qe[0]:Qe[2],Ee=0===we?Qe[1]:Qe[3],Ce=ve?e$3Y(Te,fe[0],fe[2]):Te,Oe=ve?e$3Y(Ee,fe[1],fe[3]):Ee,Re=Se;xt=Ce*$t,St=_e(Oe),Et=Re}})():(fe,ve,_e)=>{const be=dt[0===ve?1:3],we=dt[0===fe?0:2],Se=Math.cos(be),Te=Math.sin(be),Ee=Math.sin(we),Ce=Math.cos(we),Oe=wt+_e;xt=Ce*Se*Oe,St=Ee*Se*Oe,Et=Te*Oe};let Ot=0,At=0,Mt=0,Rt=0,Nt=0,Ft=0,zt=0,kt=0,Bt=0;const jt=bt&&Xe.isWebMercatorOnPlateCarree,q8=(fe,ve,_e,be,we)=>{let Se=0,Te=0,Ee=0;if(bt){const fe=ve*$t,we=jt?(Math.PI/2-2*Math.atan(Math.exp(-_e/wt)))*wt:_e*$t;Se=fe-xt,Te=we-St,Ee=be-Et}else{const we=O$g(fe),Ce=fe.tile,Oe=Ce.extent,Re=Ce.extentInRadians,De=(ve-Oe[0])/(Oe[2]-Oe[0]),Be=(_e-Oe[1])/(Oe[3]-Oe[1]),Ze=Re[0]*(1-De)+Re[2]*De,Xe=we(Be),Je=Math.cos(Xe),Qe=Math.sin(Xe),dt=Math.sin(Ze),$t=Math.cos(Ze),bt=wt+be;Se=$t*Je*bt-xt,Te=dt*Je*bt-St,Ee=Qe*bt-Et}switch(we){case 0:zt+=Se,kt+=Te,Bt+=Ee;break;case 1:Rt-=Se,Nt-=Te,Ft-=Ee;break;case 2:zt-=Se,kt-=Te,Bt-=Ee;break;case 3:Rt+=Se,Nt+=Te,Ft+=Ee}},Gt=Se??Cde,Ht=Qe[0],qt=Qe[2],Wt=Qe[1],Yt=Qe[3],Xt=[Yt>Gt[3],qt>Gt[2],Wt<Gt[1],Ht<Gt[0]],Jt=Math.max(Ht,Gt[0]),Qt=Math.min(qt,Gt[2]),Kt=Math.max(Wt,Gt[1]),er=Math.min(Yt,Gt[3]),$5=fe=>Math.max(Gt[0],Math.min(Gt[2],fe)),te3=fe=>Math.max(Gt[1],Math.min(Gt[3],fe)),ne3=fe=>{const ve=be.cornerNeighborCornerTiles;Ot=0,At=0,Mt=1,Rt=0,Nt=0,Ft=0,zt=0,kt=0,Bt=0;let _e=1/0;for(let be=0;be<4;++be){const we=ve[4*fe+be];_e=Math.min(_e,(null==we?void 0:we.level)??1/0)}for(let be=0;be<4;++be){const we=ve[4*fe+be];Ode[be]=(null==we?void 0:we.level)===_e?we:null}let we=1,Se=0;for(let be=0;be<4;++be){const fe=Ode[be];fe&&(we=Math.max(we,null==fe?void 0:fe.renderData.geometryState.numVerticesPerSide),Se=fe.extent[2]-fe.extent[0])}const Te=Se,Ee=we;O$j(Ee>1);const Ce=Te/Ee;for(let be=0;be<4;++be){const fe=Ode[(be+3)%4],ve=Ode[be%4];if(!fe&&!ve)continue;const _e=0===be?1:1===be?2:2===be?3:0,we=0===be?2:1===be?3:2===be?0:1;if(fe&&ve){const Se=Ede[be][0]*Ce,Te=Ede[be][1]*Ce,Ee=fe.extent,Oe=$5(Ee[0===_e||1===_e?2:0]+Se),Re=te3(Ee[0===_e||3===_e?3:1]+Te),De=ve.extent,Be=$5(De[0===we||1===we?2:0]+Se),Ze=te3(De[0===we||3===we?3:1]+Te),Xe=fe.renderData,Je=ve.renderData,Qe=e$Z(Oe,Re,Xe.geometryState.samplerData),dt=e$Z(Be,Ze,Je.geometryState.samplerData);q8(Xe,Oe,Re,.5*(Qe+dt),be)}else{const Se=fe??ve,Te=fe?_e:we,Ee=Se.extent,Oe=Ede[be],Re=$5(Ee[0===Te||1===Te?2:0]+Oe[0]*Ce),De=te3(Ee[0===Te||3===Te?3:1]+Oe[1]*Ce),Be=Se.renderData,Ze=e$Z(Re,De,Be.geometryState.samplerData);q8(Be,Re,De,Ze,be)}}if(!bt){const fe=Math.sqrt(xt*xt+St*St+Et*Et);Ot=xt/fe,At=St/fe,Mt=Et/fe}if(bt||Mt*Mt<.999){const fe=Math.sqrt(Rt*Rt+Nt*Nt+Ft*Ft);Rt/=fe,Nt/=fe,Ft/=fe;const ve=Math.sqrt(zt*zt+kt*kt+Bt*Bt);zt/=ve,kt/=ve,Bt/=ve,Ot=Ft*kt-Nt*Bt,At=Rt*Bt-Ft*zt,Mt=Nt*zt-Rt*kt;const _e=1/Math.sqrt(Ot*Ot+At*At+Mt*Mt);Ot*=_e,At*=_e,Mt*=_e}},tr=be.cornerNeighborCornerTiles;for(let rr=0;rr<4;++rr){const fe=rr,ve=(rr+1)%4,Se=0===rr||1===rr?1:0,Xe=0===rr||3===rr?1:0,Je=e$3Y(Se,Ee,Oe),Qe=e$3Y(Xe,Ce,Re),dt=_e.getEdgeFirstVertexIndex(fe),$t=_e.getEdgeCount(fe),bt=0===rr||3===rr?$t-1:0,wt=_e.getEdgeFirstVertexIndex(ve),Rt=_e.getEdgeCount(ve),Nt=0===rr||1===rr?Rt-1:0;let Ft=-1;for(let _e=0;_e<4;++_e){const fe=tr[4*rr+_e],ve=tr[4*rr+Ft];fe&&(-1===Ft||u$W(ve,fe)>0)&&(Ft=_e)}const zt=Ft,kt=tr[4*rr+zt];if(kt!==Ze){const fe=Ze.level-kt.level,ve=2**fe,_e=[kt.lij[0]+fe,kt.lij[1]*ve,kt.lij[2]*ve],Se=[_e[1]+ve===Ze.lij[1],0===rr&&(1===zt||0===zt&&kt!==tr[4*rr+3])||1===rr&&(0===zt||1===zt&&kt!==tr[4*rr+2]),_e[1]===Ze.lij[1]+1,2===rr&&(3===zt||2===zt&&kt!==tr[4*rr+1])||3===rr&&(2===zt||3===zt&&kt!==tr[4*rr+0])],Te=Se.reduce(((fe,ve)=>fe+(ve?1:0)),0);O$j(1===Te||2===Te);let Ee=-1,Ce=-1;const Oe=kt.renderData;if(1===Te){const fe=Se.findIndex((fe=>fe));O$j(0<=fe&&fe<=3),Ee=(fe+2)%4;const ve=be.edgeResolutions[fe];Ce=Ze.getNeighborEdgeStartVertexIndex(fe,kt)*ve+ve*(0===fe&&0===rr||1===fe&&0===rr||2===fe&&1===rr||3===fe&&3===rr?1:0)}else{O$j(Se[1]||Se[3]),Ee=Se[1]?3:1;const fe=Oe.geometryState.edgeResolutions[Ee];Ce=0===rr||3===rr?0:fe}const Re=Oe.geometry;{const fe=dt+bt,ve=wt+Nt,_e=Re.getEdgeFirstVertexIndex(Ee)+Ce,be=Re.vertexAttributes,Se=Oe.localOrigin;{const Te=be.position,Ee=Te.typedBuffer,Ce=_e*Te.typedBufferStride,Oe=Ee[Ce]+Se[0]-we[0],Re=Ee[Ce+1]+Se[1]-we[1],Ze=Ee[Ce+2]+Se[2]-we[2];de$2(Oe,Re,Ze,De);const Xe=Be.position,Je=Xe.typedBuffer;{const ve=fe*Xe.typedBufferStride;Je[ve]=Oe,Je[ve+1]=Re,Je[ve+2]=Ze}{const fe=ve*Xe.typedBufferStride;Je[fe]=Oe,Je[fe+1]=Re,Je[fe+2]=Ze}}const Te=Be.uv0;u$X(Te,fe,Je,Qe),u$X(Te,ve,Je,Qe);{const we=be.normalCompressed.typedBuffer,Se=_e*be.normalCompressed.typedBufferStride,Te=Be.normalCompressed,Ee=Te.typedBuffer;{const ve=fe*Te.typedBufferStride;Ee[ve]=we[Se],Ee[ve+1]=we[Se+1]}{const fe=ve*Te.typedBufferStride;Ee[fe]=we[Se],Ee[fe+1]=we[Se+1]}}}}else{let be;if(Xt[fe]||Xt[ve]){be=e$Z(e$3Y(Ht*(1-Se)+qt*Se,Jt,Qt),e$3Y(Wt*(1-Xe)+Yt*Xe,Kt,er),Te)}else be=ee$1(tr,rr);Pt(Se,Xe,be),ne3(rr);const Ee=xt-we[0],Ce=St-we[1],Oe=Et-we[2];de$2(Ee,Ce,Oe,De),_e.setEdgeVertexFromValuesRawPositionUVNormal(fe,bt,Ee,Ce,Oe,Je,Qe,Ot,At,Mt),_e.setEdgeVertexFromValuesRawPositionUVNormal(ve,Nt,Ee,Ce,Oe,Je,Qe,Ot,At,Mt)}}for(let rr=0;rr<4;++rr)Ode[rr]=null}function ee$1(fe,ve){var _e,be;const we=4*ve,Se=xde.reduce(((ve,_e)=>{var be;return Math.min(ve,(null==(be=fe[we+_e])?void 0:be.level)??1/0)}),1/0);nhe&&(O$j(!fe[we+0]||!fe[we+2]||ce$3(fe[we+0],fe[we+2],Xue.SOUTH_WEST)),O$j(!fe[we+1]||!fe[we+3]||ce$3(fe[we+1],fe[we+3],Xue.NORTH_WEST)));let Te=0,Ee=0;for(let Oe=0;Oe<4;++Oe){const ve=fe[we+Oe];if(ve&&ve.level===Se){const fe=0===Oe||1===Oe,we=0===Oe||3===Oe,Se=ve.extent;Ee+=e$Z(Se[fe?0:2],Se[we?1:3],null==(be=null==(_e=ve.renderData)?void 0:_e.geometryState)?void 0:be.samplerData),Te++}}const Ce=Te?Ee/Te:0;return O$j(null!=Ce),Ce}function te$1(fe){const{vao:ve,geometry:_e}=fe,{vertexAttributes:be,edgeVerticesStartIndex:we}=_e,Se=be.position.typedBuffer;ve.vertexBuffers.geometry.setSubData(Se,we,we,Se.length)}function ne$1(fe){const{vao:ve,geometry:_e}=fe,{indices:be,indexCount:we,edgeIndicesStartIndex:Se}=_e;ve.indexBuffer.setSubData(be,Se,Se,we)}let Tde=class oe{constructor(fe,ve,_e,be,we){this.isNorth=fe,this.connectedRowOffset=ve,this.connectedOuterEdgeOffset=_e,this.rowOffset=be,this.latitudeResolution=we}};const Ede=[[0,1],[1,0],[0,-1],[-1,0]],Pde=new class t62{constructor(){this.sinLonLUT=new Array(513),this.cosLonLUT=new Array(513),this.sinLatLUT=new Array(513),this.cosLatLUT=new Array(513)}update(fe,ve,_e){const be=ve[0],we=ve[2];for(let Se=0;Se<=fe;Se++){const ve=Se/fe,Te=be*(1-ve)+we*ve;this.sinLonLUT[Se]=Math.sin(Te),this.cosLonLUT[Se]=Math.cos(Te);const Ee=_e(ve);this.sinLatLUT[Se]=Math.sin(Ee),this.cosLatLUT[Se]=Math.cos(Ee)}}},Cde=a$4j(-1/0,-1/0,1/0,1/0),Ode=[null,null,null,null];function ce$2(fe,ve,_e){if(!ve)return!1;const be=u$W(fe,ve);return be>0||0===be&&_e>=2}let Ade=class le2{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(fe){return O$j(0<=fe&&fe<this.count),this.vertex0Index+this.stride*fe}};const Mde=[new Ade,new Ade,new Ade,new Ade];function de$2(fe,ve,_e,be){fe<be[0]?be[0]=fe:fe>be[3]&&(be[3]=fe),ve<be[1]?be[1]=ve:ve>be[4]&&(be[4]=ve),_e<be[2]?be[2]=_e:_e>be[5]&&(be[5]=_e)}function fe$2(fe){const{edgeResolutions:ve,numVerticesPerSide:_e}=fe,be=1+Math.max(...ve);return Math.max(_e,be)}function me$1(fe,ve,_e,be,we,Se){const Te=fe*we,Ee=Se[Te],Ce=Se[Te+1],Oe=Se[Te+2],Re=ve*we,De=Se[Re],Be=Se[Re+1],Ze=Se[Re+2],Xe=_e*we,Je=Se[Xe],Qe=Se[Xe+1],dt=Se[Xe+2],$t=be*we,bt=Se[$t],wt=Se[$t+1],xt=Se[$t+2];return(De-bt)*(De-bt)+(Be-wt)*(Be-wt)+(Ze-xt)*(Ze-xt)>(Ee-Je)*(Ee-Je)+(Ce-Qe)*(Ce-Qe)+(Oe-dt)*(Oe-dt)}function ge$1(fe,ve,_e,be,we){fe[ve]=_e,fe[ve+1]=be,fe[ve+2]=be,fe[ve+3]=we,fe[ve+4]=we,fe[ve+5]=_e}const Rde=6;let Ide=class _13 extends khe{constructor(fe,ve,_e,be,we){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=u$3J(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(fe,ve,_e,be,we)}init(fe,ve,_e,be,we){super.init(fe,ve,_e,be,we);const Se=we.view.renderSpatialReference,Te=we.spatialReference,Ee=null!=Se&&O$1s(Se)&&null!=Te&&Te.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=Ee;const{isWebMercatorOnPlateCarree:Ce}=we,Oe=this._extentInRenderSR,Re=this.extent;if(Ce){const fe=r$3y(Re[0],Re[1],0);n$3Y(fe,zo.WebMercator,fe,zo.PlateCarree);const ve=r$3y(Re[2],Re[3],0);n$3Y(ve,zo.WebMercator,ve,zo.PlateCarree),Oe[0]=fe[0],Oe[1]=fe[1],Oe[2]=ve[0],Oe[3]=ve[1]}else for(let De=0;De<4;++De)Oe[De]=Re[De]*Ee;this.centerAtSeaLevel[0]=.5*(Oe[0]+Oe[2]),this.centerAtSeaLevel[1]=.5*(Oe[1]+Oe[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(Oe[2]-Oe[0],Oe[3]-Oe[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const fe=this._extentInRenderSR,ve=.5*(fe[2]-fe[0]),_e=.5*(fe[3]-fe[1]),be=Math.sqrt(ve*ve+_e*_e),we=.5*(this.elevationBoundsMax-this.elevationBoundsMin),Se=Math.max(be,we);this._center[jhe.MIDDLE][3]=Se}_calculateFrustumVisibilityStatus(fe){const ve=this._aabb(),_e=ve[0],be=ve[1],we=ve[2],Se=ve[3],Te=ve[4],Ee=ve[5];let Ce=!0;for(let Oe=0;Oe<6;Oe++){const ve=fe[Oe],Re=ve[0],De=ve[1],Be=ve[2],Ze=ve[3];if(Re*(Re>0?_e:Se)+De*(De>0?be:Te)+Be*(Be>0?we:Ee)+Ze>=0)return Lhe.OUTSIDE;Ce=Ce&&Re*(Re<0?_e:Se)+De*(De<0?be:Te)+Be*(Be<0?we:Ee)+Ze<=0}return Ce?Lhe.INSIDE:Lhe.INTERSECTS}_aabb(){const fe=this._extentInRenderSR;return function k$18(fe,ve,_e,be,we,Se){return a$3w(fe,ve,_e,be,we,Se,nx)}(fe[0],fe[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),fe[2],fe[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(fe,ve,_e,be){return Lde[0]=1/ve[0],Lde[1]=1/ve[1],Lde[2]=1/ve[2],w$13(this._aabb(),fe,Lde,_e,be)}createGeometry(){T$d(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const fe=this._subtreeGeometryElevationBoundMin,ve=this._subtreeGeometryElevationBoundMax,_e=this.renderData;let be=fe,we=ve;if(_e){const fe=_e.geometry.boundingBox;be=fe[2],we=fe[5]}else if(!this.isLeaf){be=1/0,we=-1/0;for(const fe of this.children)be=Math.min(be,fe._subtreeGeometryElevationBoundMin),we=Math.max(we,fe._subtreeGeometryElevationBoundMax)}if(be!==this._subtreeGeometryElevationBoundMin||we!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=be,this._subtreeGeometryElevationBoundMax=we;const fe=this.parent;null==fe||fe._updateSubtreeGeometryElevationsBounds()}}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){(function R$i(fe,ve){fe.tile.intersectsClippingArea&&(F$f(fe),j$l(fe,!0),te$1(fe),fe.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){(function N$h(fe,ve){fe.tile.intersectsClippingArea&&(w$r(fe),te$1(fe),fe.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){(function U$d(fe,ve){fe.tile.intersectsClippingArea&&(Y$2(fe),w$r(fe),te$1(fe),ne$1(fe),fe.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const Lde=[0,0,0];let Dde=class l31{constructor(){this.extent=[0,0,0,0],this.minLevel=0,this.maxLevel=0,this.callback=null}},Nde=class a42 extends zi{constructor(){super(...arguments),this._queries=new jr({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new jr({initialSize:30}),this._queryPool=new pr(Dde)}queryVisibleLevelRange(fe,ve,_e,be){const we=this._queryPool.acquire();a$42(we.extent,fe),we.minLevel=ve??-Number.MAX_VALUE,we.maxLevel=_e??Number.MAX_VALUE,we.callback=be,this._queryQueue.push(we),this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const fe=this._queryQueue.pop();this._queries.push(fe)}this._queriesInvPtr=this._queries.length}process(){for(let fe=0;fe<this._queries.length;fe++){const ve=this._queries.data[fe];this._queryPool.release(ve),ve.callback(fe>=this._queriesInvPtr),ve.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(fe){const ve=fe.level;let _e=0;for(;_e<this._queriesInvPtr;){const be=this._queries.data[_e],we=be.extent;ve>=be.minLevel&&ve<=be.maxLevel&&we[0]<=fe.extent[2]&&we[2]>=fe.extent[0]&&we[1]<=fe.extent[3]&&we[3]>=fe.extent[1]?(this._queries.swapElements(_e,this._queriesInvPtr-1),this._queriesInvPtr--):_e++}}};e$4o([y$2v()],Nde.prototype,"updating",null),Nde=e$4o([a$4y("esri.views.3d.terrain.ScaleRangeQueries")],Nde);let Fde=class y10 extends khe{constructor(fe,ve,_e,be,we){super(),this._convexHull=new Array(24),this._boundingSphere=[0,0,0,0],this._baseUsedMemory=1816,this.init(fe,ve,_e,be,we)}init(fe,ve,_e,be,we){super.init(fe,ve,_e,be,we);const Se=this.ellipsoid.radius,Te=this.extentInRadians[0],Ee=this.extentInRadians[1],Ce=this.extentInRadians[2],Oe=this.extentInRadians[3],Re=f$3i(Ee,Oe,.5),De=f$3i(Te,Ce,.5),Be=0===fe?0:Math.min(Math.abs(Ee),Math.abs(Oe));this._edgeLen=(Ce-Te)*Math.cos(Be)*Se,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=Se-Math.sqrt(Se*Se-this._edgeLen2/4),function t$15(fe,ve,_e,be){const we=Math.cos(_e);fe[0]=Math.cos(ve)*we*be,fe[1]=Math.sin(ve)*we*be,fe[2]=Math.sin(_e)*be}(this.centerAtSeaLevel,De,Re,this.ellipsoid.radius),z$1d(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const fe=this._center;if(0===this.lij[0])o$44(fe[jhe.MIDDLE],0,0,0),o$44(fe[jhe.TOP],0,0,0),o$44(fe[jhe.BOTTOM],0,0,0),fe[jhe.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const ve=fe[jhe.MIDDLE],_e=this.convexHull;let be=0;for(let fe=0;fe<8;++fe)be=Math.max(be,L$a(ve,_e,3*fe));fe[jhe.MIDDLE][3]=Math.sqrt(be)}}_calculateFrustumVisibilityStatus(fe){if(!s$2N(fe,this._boundingSphere))return Lhe.OUTSIDE;if(this.lij[0]<10)return Lhe.INTERSECTS;const ve=this.convexHull,_e=this.surface.view.state.camera.near;let be=!0;for(let we=0;we<SR;we++){const Se=we===$R.NEAR,Te=fe[we],Ee=Te[0],Ce=Te[1],Oe=Te[2],Re=Te[3]-(Se?_e:0);let De=!1;for(let fe=0;fe<8;++fe){const _e=3*fe;if(Ee*ve[_e]+Ce*ve[_e+1]+Oe*ve[_e+2]+Re<0){if(De=!0,!be)break}else be=!1}if(!De)return Lhe.OUTSIDE}return be?Lhe.INSIDE:Lhe.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){S$l(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),nhe&&this._checkBVs()}_updateBoundingSphere(){const fe=this._boundingSphere,ve=fe,_e=this.elevationBoundsMin,be=this.elevationBoundsMax,we=this.ellipsoid.radius,Se=be;if(0===this.level)o$44(ve,0,0,0),fe[3]=we+Se;else{const Se=this.extentInRadians,Te=.5*(Se[0]+Se[2]),Ee=Se[1],Ce=Se[3];O$f(Ude,Te,Ee,we),O$f(Vde,Te,Ce,we),u$3Y(ve,Ude,Vde),g$2z(ve,ve,(we+.5*(_e+be))/dn(ve));const Oe=this.convexHull;let Re=0;const f31=(fe,ve)=>{const _e=fe[0]-Oe[3*ve],be=fe[1]-Oe[3*ve+1],we=fe[2]-Oe[3*ve+2];return Math.sqrt(_e*_e+be*be+we*we)};for(let fe=0;fe<8;++fe){const _e=f31(ve,fe);Re=Math.max(Re,_e)}const De=Re;fe[3]=De+2}}_updateConvexHull(){const fe=this.extentInRadians,ve=this.ellipsoid.radius;if(0===this.level)return;const _e=this.elevationBoundsMin,be=this.elevationBoundsMax,we=this._getPatchType(),Se=this.surface.isWebMercator,Te=Se&&we===sY.HAS_NORTH_POLE,Ee=Se&&we===sY.HAS_SOUTH_POLE,Ce=Ee||Te,Oe=Math.PI/2,Re=fe[0],De=fe[2],Be=Ee?-Oe:fe[1],Ze=Te?Oe:fe[3],Xe=.5*(Re+De),Je=_e,Qe=ve+(Ce?Math.min(0,Je-1):Je),B11=(fe,ve,_e)=>O$f(fe,ve,_e,Qe),dt=[0,0,0],$t=[0,0,0],bt=[0,0,0],wt=[0,0,0];B11(dt,Re,Be),B11($t,Re,Ze),B11(bt,De,Ze),B11(wt,De,Be);const R10=(fe,ve)=>{for(let _e=0;_e<3;++_e)this._convexHull[3*ve+_e]=fe[_e]};R10(dt,0),R10($t,1),R10(bt,2),R10(wt,3);const xt=be,St=ve+(Ce?Math.max(0,xt+1):xt),Et=[0,0,0],Pt=[0,0,0],Ot=[0,0,0];O$f(Pt,Xe,Ze,Qe),O$f(Ot,Xe,Be,Qe),u$3Y(Et,Pt,Ot),z$1d(Et,Et);const At=[0,0,0],Mt=[0,0,0],w9=(fe,ve)=>{Ki(Mt,fe,ve),z$1d(Mt,Mt);const _e=-P$1g(fe,At)/P$1g(Mt,At);O$j(_e>=0),g$2z(Mt,Mt,_e),u$3Y(fe,fe,Mt)};if(2**this.lij[0]>2*this.lij[1]){const fe=Ot,ve=[0,0,0];_$1z(ve,kde,fe),z$1d(ve,ve),_$1z(At,fe,ve),z$1d(At,At),O$j(q$d(P$1g(At,fe)/dn(fe),0)),w9(dt,$t),w9(wt,bt),R10(dt,0),R10(wt,3)}else if(2**this.lij[0]!==2*this.lij[1]){const fe=Pt,ve=[0,0,0];_$1z(ve,kde,fe),z$1d(ve,ve),_$1z(At,ve,fe),z$1d(At,At),w9($t,dt),w9(bt,wt),R10($t,1),R10(bt,2)}const q8=(fe,ve)=>{const _e=St/P$1g(ve,Et);for(let be=0;be<3;++be)this._convexHull[3*fe+be]=ve[be]*_e};q8(4,dt),q8(5,$t),q8(6,bt),q8(7,wt)}_getPatchType(){const fe=this.lij[1],ve=0===fe,_e=fe===(1<<this.level)-1;return ve?_e?sY.HAS_BOTH_POLES:sY.HAS_NORTH_POLE:_e?sY.HAS_SOUTH_POLE:sY.REGULAR}intersectsRay(fe,ve,_e,be){const we=this._boundingSphere,Se=we[3]+_e,Te=ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2],Ee=we[0]-fe[0],Ce=we[1]-fe[1],Oe=we[2]-fe[2],Re=(Ee*ve[0]+Ce*ve[1]+Oe*ve[2])/Te,De=ve[0]*Re-Ee,Be=ve[1]*Re-Ce,Ze=ve[2]*Re-Oe;return De*De+Be*Be+Ze*Ze<Se*Se}getDefaultVerticesPerSide(){return this.level<zde.length?zde[this.level]+1:2}updateCornerElevations(){(function I$f(fe){fe.tile.intersectsClippingArea&&(C$e(fe),b$t(fe,!0),te$1(fe),fe.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){(function L$b(fe){fe.tile.intersectsClippingArea&&(V$f(fe),te$1(fe),fe.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){(function B$a(fe){fe.tile.intersectsClippingArea&&(Y$2(fe),V$f(fe),te$1(fe),ne$1(fe),fe.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var fe;if(!nhe)return;if(this.level<=2)return;const ve=this._boundingSphere,_e=ve[3],be=ve,we=[0,0,0],Se=this.ellipsoid.radius,Te=this.elevationBoundsMin,Ee=this.elevationBoundsMax,Ce=Se+Te,Oe=(this._center[jhe.MIDDLE][3],this.convexHull),b21=(fe,ve)=>{for(let _e=0;_e<3;++_e)fe[_e]=Oe[3*ve+_e]};{const fe=[0,0,0],ve=[0,0,0],_e=[0,0,0],be=[0,0,0],we=[0,0,0],a55=(Se,Te,Ee,Ce)=>{b21(ve,Se),b21(_e,Te),b21(be,Ee),Ki(ve,ve,_e),Ki(be,be,_e),_$1z(fe,ve,be),z$1d(fe,fe);const Oe=P$1g(fe,_e);b21(we,Ce);const Re=P$1g(fe,we),De=Math.abs(Re-Oe);O$j(q$d(De,0),`Non coplanar ${Se},${Te},${Ee},${Ce} diff = ${De}`)};a55(0,1,2,3),a55(4,5,6,7),a55(0,1,4,5),a55(1,2,5,6),a55(2,3,6,7),a55(3,0,7,4)}const Re=t$2H(24),De=[0,0,0],Be=[0,0,0],Ze=[0,0,0],Xe=[0,0,0],V9=(fe,ve,_e,be)=>{b21(De,ve),b21(Be,_e),b21(Ze,be),Ki(De,De,Be),z$1d(De,De),Ki(Ze,Ze,Be),z$1d(Ze,Ze),_$1z(Xe,De,Ze),z$1d(Xe,Xe);const we=P$1g(Xe,Be);((fe,ve,_e)=>{const be=4*fe;for(let we=0;we<3;++we)Re[be+we]=ve[we];Re[be+3]=_e})(fe,Xe,we)};V9(0,0,1,2),V9(1,1,0,4),V9(2,1,5,2),V9(3,3,2,6),V9(4,4,0,3),V9(5,4,6,5);const C12=(fe,ve,_e,be)=>{const we=4*fe;return Re[we]*ve+Re[we+1]*_e+Re[we+2]*be-Re[we+3]},F7=(fe,ve,_e,be)=>C12(fe,ve,_e,be)>=-1,N14=(fe,ve)=>F7(fe,ve[0],ve[1],ve[2]),Je=2**this.lij[0]>2*this.lij[1],k9=(fe,ve,we)=>Math.sqrt(R$h(fe,ve,we,be[0],be[1],be[2]))<_e,w9=fe=>k9(fe[0],fe[1],fe[2]),q8=(fe,ve)=>k9(fe[ve],fe[ve+1],fe[ve+2]),Qe=this.extentInRadians,dt=.5*(Qe[0]+Qe[2]),$t=Qe[1],bt=Qe[3],wt=[0,0,0],xt=[0,0,0];O$f(wt,dt,bt,Ce),O$f(xt,dt,$t,Ce);const St=Je?"Upper":"Lower";let Et=!0;for(let qt=0;qt<6;++qt){for(let fe=0;fe<8;++fe){const ve=3*fe,_e=F7(qt,Oe[ve],Oe[ve+1],Oe[ve+2]);Et&&(Et=_e),O$j(_e,`Tile[${this.lij}] Convex hull point ${fe} outside of plane ${qt}`)}O$j(N14(qt,xt),`Tile[${this.lij}] (${St}) bottom mid outside of plane ${qt}`),O$j(N14(qt,wt),`Tile[${this.lij}] (${St}) top mid outside of plane ${qt}`)}O$j(Et,"Not all convex hull points are inside  convex hull polyhedron"),O$j(w9(xt),`Tile[${this.lij}] (${St}) bottom mid outside of bounding sphere`),O$j(w9(wt),`Tile[${this.lij}] (${St}) top mid outside of bounding sphere`);for(let qt=0;qt<8;++qt){O$j(q8(Oe,3*qt),`Tile[${this.lij}] Convex hull point ${qt} outside of bounding sphere`)}for(let qt=0;qt<6;++qt)for(let fe=0;fe<8;++fe){const ve=3*fe;F7(qt,Oe[ve],Oe[ve+1],Oe[ve+2])}const{extentInRadians:Pt}=this,Ot=Math.max(Pt[2]-Pt[0],Pt[3]-Pt[1]),{renderData:At}=(Math.round(Ot*Se),this);if(!At)return;const{geometry:Mt,geometryState:Rt,localOrigin:Nt}=At,Ft=null==(fe=Mt.vertexAttributes)?void 0:fe.position;if(!Ft)return;const zt=[0,0,0],{indices:kt,indexCount:Bt,edgeVerticesStartIndex:jt,poleVerticesStartIndex:Gt}=(Mt.numVerticesPerSide,Mt);if(!kt)return;const Ht=new Set;for(let qt=0;qt<Bt;++qt){const fe=kt[qt];if(Ht.has(fe))continue;Ht.add(fe);const ve=fe>=jt;let Ce=!1,Oe=-1;if(ve){let ve=jt;for(let _e=0;_e<4;++_e){const be=Rt.edgeResolutions[_e];if(fe===ve||fe===ve+be-1){Ce=!0;break}if(ve+=be,fe<ve){Oe=_e;break}}}const Re=ve?Rt.edgePeerNeighbors[Oe]:null;ve&&Re&&u$W(this,Re);Ft.getVec(fe,we),u$3Y(zt,we,Nt);const De=dn(zt)-Se;let Be=0,Ze=!1;const Xe=Te-De,Je=De-Ee,Qe=Xe>1,dt=Je>1,$t=Qe||dt,bt=nn(zt,be);if(bt>=_e+0){$t||(Ze=!0)}for(let _e=0;_e<6;++_e)if(!F7(_e,zt[0],zt[1],zt[2])){C12(_e,zt[0],zt[1],zt[2]);0===_e&&Xe||5===_e&&Je||++Be}if(Ze||Be>0)break}}get convexHull(){return this._convexHull}};const zde=[128,64,64,32,16,8,8,4];function L$a(fe,ve,_e){return R$h(fe[0],fe[1],fe[2],ve[_e],ve[_e+1],ve[_e+2])}function R$h(fe,ve,_e,be,we,Se){const Te=be-fe,Ee=we-ve,Ce=Se-_e;return Te*Te+Ee*Ee+Ce*Ce}const O$f=(fe,ve,_e,be)=>{const we=Math.cos(ve),Se=Math.sin(ve),Te=Math.cos(_e),Ee=Math.sin(_e);fe[0]=be*Te*we,fe[1]=be*Te*Se,fe[2]=be*Ee},kde=[0,0,1],Ude=[0,0,0],Vde=[0,0,0];let Bde=class e55 extends zi{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};e$4o([y$2v()],Bde.prototype,"fovX",void 0),e$4o([y$2v()],Bde.prototype,"fovY",void 0),e$4o([y$2v()],Bde.prototype,"relativeWidthLimit",void 0),e$4o([y$2v()],Bde.prototype,"relativeHeightLimit",void 0),e$4o([y$2v()],Bde.prototype,"maxLod",void 0),e$4o([y$2v()],Bde.prototype,"angledSplitBias",void 0),e$4o([y$2v()],Bde.prototype,"aboveGround",void 0),e$4o([y$2v()],Bde.prototype,"frustum",void 0),Bde=e$4o([a$4y("esri.views.3d.terrain.SplitLimits")],Bde);const jde=H$J().vec3f(nO.POSITION).vec2i16(nO.UV0).vec2i16(nO.NORMALCOMPRESSED,{glNormalized:!0});let Gde=class t66{constructor(fe){this._storage=new hJ(((ve,_e)=>fe.newCache(ve,_e)),"TileGeometry")}acquire(fe){const ve=4*Math.ceil(fe/4),_e=this._storage,be=function o$I(fe){return fe.toString()}(ve),we=_e.pop(be);if(we)return we;const Se=jde.createBuffer(ve);return Se.release=()=>_e.put(be,Se),Se}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};var Hde;!function(fe){fe[fe.Normal=0]="Normal",fe[fe.Average=1]="Average",fe[fe.Lighten=2]="Lighten",fe[fe.Lighter=3]="Lighter",fe[fe.Plus=4]="Plus",fe[fe.Screen=5]="Screen",fe[fe.ColorDodge=6]="ColorDodge",fe[fe.Darken=7]="Darken",fe[fe.Multiply=8]="Multiply",fe[fe.ColorBurn=9]="ColorBurn",fe[fe.Overlay=10]="Overlay",fe[fe.SoftLight=11]="SoftLight",fe[fe.HardLight=12]="HardLight",fe[fe.VividLight=13]="VividLight",fe[fe.Hue=14]="Hue",fe[fe.Saturation=15]="Saturation",fe[fe.Luminosity=16]="Luminosity",fe[fe.Color=17]="Color",fe[fe.DestinationOver=18]="DestinationOver",fe[fe.DestinationAtop=19]="DestinationAtop",fe[fe.DestinationIn=20]="DestinationIn",fe[fe.DestinationOut=21]="DestinationOut",fe[fe.SourceAtop=22]="SourceAtop",fe[fe.SourceIn=23]="SourceIn",fe[fe.SourceOut=24]="SourceOut",fe[fe.Xor=25]="Xor",fe[fe.Difference=26]="Difference",fe[fe.Exclusion=27]="Exclusion",fe[fe.Minus=28]="Minus",fe[fe.Invert=29]="Invert",fe[fe.Reflect=30]="Reflect",fe[fe.COUNT=31]="COUNT"}(Hde||(Hde={}));const qde={normal:Hde.Normal,average:Hde.Average,lighten:Hde.Lighten,lighter:Hde.Lighter,screen:Hde.Screen,plus:Hde.Plus,"color-dodge":Hde.ColorDodge,darken:Hde.Darken,multiply:Hde.Multiply,"color-burn":Hde.ColorBurn,overlay:Hde.Overlay,"soft-light":Hde.SoftLight,"hard-light":Hde.HardLight,"vivid-light":Hde.VividLight,hue:Hde.Hue,saturation:Hde.Saturation,luminosity:Hde.Luminosity,color:Hde.Color,difference:Hde.Difference,exclusion:Hde.Exclusion,minus:Hde.Minus,invert:Hde.Invert,reflect:Hde.Reflect,"destination-over":Hde.DestinationOver,"destination-atop":Hde.DestinationAtop,"destination-in":Hde.DestinationIn,"destination-out":Hde.DestinationOut,"source-atop":Hde.SourceAtop,"source-in":Hde.SourceIn,"source-out":Hde.SourceOut,xor:Hde.Xor};function o$H(fe){return fe===Hde.DestinationOver||fe===Hde.DestinationAtop||fe===Hde.DestinationIn||fe===Hde.DestinationOut||fe===Hde.SourceAtop||fe===Hde.SourceIn||fe===Hde.SourceOut||fe===Hde.Xor}let Wde=class s67 extends HA{constructor(){super(...arguments),this.blendMode=Hde.Normal}};var Yde,Zde,Xde;e$4o([r$2w({count:Hde.COUNT})],Wde.prototype,"blendMode",void 0),function(fe){fe[fe.NotRequired=0]="NotRequired",fe[fe.Required=1]="Required",fe[fe.COUNT=2]="COUNT"}(Yde||(Yde={})),function(fe){fe[fe.Composite=0]="Composite",fe[fe.ColorComposite=1]="ColorComposite",fe[fe.GridComposite=2]="GridComposite",fe[fe.GroupBackgroundComposite=3]="GroupBackgroundComposite",fe[fe.COUNT=4]="COUNT"}(Zde||(Zde={})),function(fe){fe[fe.Off=0]="Off",fe[fe.On=1]="On",fe[fe.COUNT=2]="COUNT"}(Xde||(Xde={}));let Jde=class s68 extends Wde{constructor(){super(...arguments),this.output=Zde.Composite,this.baseOpacityMode=Yde.NotRequired,this.premultipliedSource=Xde.Off}};e$4o([r$2w({count:Zde.COUNT})],Jde.prototype,"output",void 0),e$4o([r$2w({count:Yde.COUNT})],Jde.prototype,"baseOpacityMode",void 0),e$4o([r$2w()],Jde.prototype,"premultipliedSource",void 0);let Qde=class a43 extends iO{constructor(){super(...arguments),this.scale=1,this.offset=md}};function d$L(fe){fe.attributes.add(nO.POSITION,"vec2"),fe.attributes.add(nO.UV0,"vec2"),fe.varyings.add("uv","vec2"),fe.varyings.add("vuv","vec2"),fe.vertex.uniforms.add(new dO("scale",(fe=>fe.scale)),new lO("offset",(fe=>fe.offset))).code.add(o$2P`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function l$18(fe,ve){const _e=ve.blendMode;_e!==Hde.Normal&&(_e===Hde.Reflect&&fe.code.add(o$2P`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),_e!==Hde.ColorDodge&&_e!==Hde.VividLight||fe.code.add(o$2P`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),_e!==Hde.ColorBurn&&_e!==Hde.VividLight||fe.code.add(o$2P`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),_e===Hde.Overlay&&fe.code.add(o$2P`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),_e===Hde.HardLight&&fe.code.add(o$2P`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),_e===Hde.SoftLight&&fe.code.add(o$2P`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),_e===Hde.VividLight&&fe.code.add(o$2P`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),_e!==Hde.Hue&&_e!==Hde.Saturation&&_e!==Hde.Color&&_e!==Hde.Luminosity||(fe.code.add(o$2P`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),_e!==Hde.Hue&&_e!==Hde.Saturation||fe.code.add(o$2P`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),fe.code.add(o$2P`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${_e===Hde.Multiply?o$2P`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Average?o$2P`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Lighten?o$2P`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Darken?o$2P`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Lighter?o$2P`return vec4(cl * ol + cb * ob, ol + ob);`:_e===Hde.Plus?o$2P`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:_e===Hde.Minus?o$2P`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:_e===Hde.Screen?o$2P`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Difference?o$2P`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Invert?o$2P`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:_e===Hde.DestinationOver?o$2P`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:_e===Hde.DestinationAtop?o$2P`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:_e===Hde.DestinationOut?o$2P`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:_e===Hde.SourceAtop?o$2P`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:_e===Hde.SourceOut?o$2P`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:_e===Hde.Xor?o$2P`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:_e===Hde.DestinationIn?o$2P`return vec4(cb * ob * ol, ol * ob);`:_e===Hde.SourceIn?o$2P`return vec4(cl * ol * ob, ol * ob);`:_e===Hde.Hue?o$2P`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Saturation?o$2P`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Color?o$2P`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Luminosity?o$2P`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Exclusion?o$2P`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Reflect?o$2P`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.ColorDodge?o$2P`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.ColorBurn?o$2P`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.Overlay?o$2P`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.SoftLight?o$2P`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.HardLight?o$2P`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_e===Hde.VividLight?o$2P`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:o$2P``}
    }
  `))}function m$_(fe,ve){const _e=ve.output===Zde.GridComposite,be=ve.output===Zde.ColorComposite,we=ve.output===Zde.GroupBackgroundComposite,Se=ve.output===Zde.Composite,Te=ve.baseOpacityMode===Yde.Required,Ee=fe.fragment;Te&&Ee.uniforms.add(new dO("baseOpacity",(fe=>fe.baseOpacity))),_e?Ee.include(t$16):be?Ee.uniforms.add(new uO("backgroundColor",(fe=>fe.backgroundColor))):Se&&Ee.uniforms.add(new CO("fboColor",(fe=>fe.fboTexture)));const Ce=ve.blendMode!==Hde.Normal,Oe=ve.premultipliedSource===Xde.On,Re=!Ce&&!Oe&&(Se&&!Te||we);Ee.include(l$18,ve),Ee.code.add(o$2P`
    vec4 getBackground(vec2 uv) {
      return ${Te?o$2P`baseOpacity *`:""} ${we?o$2P`vec4(0.0, 0.0, 0.0, 0.0)`:be?o$2P`vec4(backgroundColor, 1.0)`:_e?o$2P`vec4(gridColor(uv), 1.0)`:o$2P`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${Ce?o$2P`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:o$2P`
          float composeAlpha = colorLayer.a * opacity;
          ${Re?o$2P`return colorLayer * opacity;`:o$2P`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Kde;function u$V(fe){const ve=new gO,_e=ve.fragment;if(ve.include(d$L),fe.background===Kde.Only){const be=fe.output===Zde.ColorComposite;return be?_e.uniforms.add(new uO("backgroundColor",(fe=>fe.backgroundColor))):_e.include(t$16),_e.code.add(o$2P`
      void main() {
        fragColor = vec4(${be?o$2P`backgroundColor`:o$2P`gridColor(uv)`}, 1.0);
      }
    `),ve}return ve.include(m$_,fe),_e.uniforms.add(new CO("tex",(fe=>fe.texture)),new dO("opacity",(fe=>fe.opacity))).code.add(o$2P`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),ve}!function(fe){fe[fe.BelowLayer=0]="BelowLayer",fe[fe.Only=1]="Only",fe[fe.COUNT=2]="COUNT"}(Kde||(Kde={}));const epe=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Kde},build:u$V},Symbol.toStringTag,{value:"Module"}));let tpe=class b15 extends Qde{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Bi}},rpe=class p34 extends fA{initializeProgram(fe){return new gA(fe.rctx,p34.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}};rpe.shader=new LO(epe,(()=>zt((()=>Promise.resolve().then((()=>_Re))),void 0)));let ipe=class f16 extends Jde{constructor(){super(...arguments),this.background=Kde.BelowLayer}};e$4o([r$2w()],ipe.prototype,"background",void 0);let npe=class s69{constructor(fe,ve,_e,be,we,Se){this.texture=fe,this.type=ve,fe.retain(),this.offsetAndScale=r$35(_e.offset[0],_e.offset[1],_e.scale,_e.scale),this.opacities=r$3y(be,we,Se)}destroy(){this.texture.release()}};var spe,ope,ape,lpe,cpe,upe,hpe,dpe,ppe,fpe,mpe;!function(fe){fe[fe.Stretch=0]="Stretch",fe[fe.Lut=1]="Lut",fe[fe.Hillshade=2]="Hillshade",fe[fe.COUNT=3]="COUNT"}(spe||(spe={})),function(fe){fe[fe.Noop=0]="Noop",fe[fe.PerBand=1]="PerBand",fe[fe.COUNT=2]="COUNT"}(ope||(ope={})),function(fe){fe[fe.BACKGROUND=0]="BACKGROUND",fe[fe.FILL=1]="FILL",fe[fe.LINE=2]="LINE",fe[fe.SYMBOL=3]="SYMBOL",fe[fe.CIRCLE=4]="CIRCLE"}(ape||(ape={})),function(fe){fe[fe.VISIBLE=0]="VISIBLE",fe[fe.NONE=1]="NONE"}(lpe||(lpe={})),function(fe){fe[fe.POINT=0]="POINT",fe[fe.LINE=1]="LINE",fe[fe.LINE_CENTER=2]="LINE_CENTER"}(cpe||(cpe={})),function(fe){fe[fe.MAP=0]="MAP",fe[fe.VIEWPORT=1]="VIEWPORT",fe[fe.AUTO=2]="AUTO"}(upe||(upe={})),function(fe){fe[fe.AUTO=0]="AUTO",fe[fe.LEFT=1]="LEFT",fe[fe.CENTER=2]="CENTER",fe[fe.RIGHT=3]="RIGHT"}(hpe||(hpe={})),function(fe){fe[fe.CENTER=0]="CENTER",fe[fe.LEFT=1]="LEFT",fe[fe.RIGHT=2]="RIGHT",fe[fe.TOP=3]="TOP",fe[fe.BOTTOM=4]="BOTTOM",fe[fe.TOP_LEFT=5]="TOP_LEFT",fe[fe.TOP_RIGHT=6]="TOP_RIGHT",fe[fe.BOTTOM_LEFT=7]="BOTTOM_LEFT",fe[fe.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(dpe||(dpe={})),function(fe){fe[fe.NONE=0]="NONE",fe[fe.UPPERCASE=1]="UPPERCASE",fe[fe.LOWERCASE=2]="LOWERCASE"}(ppe||(ppe={})),function(fe){fe[fe.MAP=0]="MAP",fe[fe.VIEWPORT=1]="VIEWPORT"}(fpe||(fpe={})),function(fe){fe[fe.HORIZONTAL=0]="HORIZONTAL",fe[fe.VERTICAL=1]="VERTICAL"}(mpe||(mpe={}));let ype=class f17{};function i$16(fe,ve,_e,be,we,Se){const{iconRotationAlignment:Te,textRotationAlignment:Ee,iconTranslate:Ce,iconTranslateAnchor:Oe,textTranslate:Re,textTranslateAnchor:De}=be;let Be=0;for(const Ze of fe.colliders){const[fe,be]=0===Ze.partIndex?Ce:Re,Xe=0===Ze.partIndex?Oe:De,Je=Ze.minLod<=Se&&Se<=Ze.maxLod;Be+=Je?0:1,Ze.enabled=Je,Ze.xScreen=Ze.xTile*we[0]+Ze.yTile*we[3]+we[6],Ze.yScreen=Ze.xTile*we[1]+Ze.yTile*we[4]+we[7],Xe===fpe.MAP?(Ze.xScreen+=_e*fe-ve*be,Ze.yScreen+=ve*fe+_e*be):(Ze.xScreen+=fe,Ze.yScreen+=be),upe.VIEWPORT===(0===Ze.partIndex?Te:Ee)?(Ze.dxScreen=Ze.dxPixels,Ze.dyScreen=Ze.dyPixels):(Ze.dxScreen=_e*(Ze.dxPixels+Ze.width/2)-ve*(Ze.dyPixels+Ze.height/2)-Ze.width/2,Ze.dyScreen=ve*(Ze.dxPixels+Ze.width/2)+_e*(Ze.dyPixels+Ze.height/2)-Ze.height/2)}fe.colliders.length>0&&Be===fe.colliders.length&&(fe.unique.show=!1)}ype.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:lpe.VISIBLE}},ype.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:lpe.VISIBLE}},ype.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:lpe.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:TK.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:EK.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},ype.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:lpe.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:cpe.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:dpe.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:upe.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:dpe.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:hpe.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:upe.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:ppe.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[mpe.HORIZONTAL]}},ype.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:lpe.VISIBLE}},ype.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},ype.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:fpe.MAP}},ype.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:fpe.MAP},"line-width":{type:"number",minimum:0,default:1}},ype.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:fpe.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:fpe.MAP}},ype.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},ype.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:fpe.MAP}};let gpe=class l32{constructor(fe,ve,_e,be,we,Se){this._symbols=fe,this._styleRepository=be,this._zoom=we,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new Mue(ve,_e,32),this._si=Math.sin(Math.PI*Se/180),this._co=Math.cos(Math.PI*Se/180);for(const Te of fe)for(const fe of Te.symbols)this._allNeededMatrices.has(fe.tile)||this._allNeededMatrices.set(fe.tile,r$Q(fe.tile.transforms.tileUnitsToPixels))}work(fe){const ve=this._gridIndex;function n52(fe){const _e=fe.xScreen+fe.dxScreen,be=fe.yScreen+fe.dyScreen,we=_e+fe.width,Se=be+fe.height,[Te,Ee,Ce,Oe]=ve.getCellSpan(_e,be,we,Se);for(let Re=Ee;Re<=Oe;Re++)for(let fe=Te;fe<=Ce;fe++){const Te=ve.cells[Re][fe];for(const fe of Te){const ve=fe.xScreen+fe.dxScreen,Te=fe.yScreen+fe.dyScreen,Ee=ve+fe.width,Ce=Te+fe.height;if(!(we<ve||_e>Ee||Se<Te||be>Ce))return!0}}return!1}const _e=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const ve=this._symbols[this._currentLayerCursor],be=this._getProperties(ve.styleLayerUID);for(;this._currentSymbolCursor<ve.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-_e>fe)return!1;const we=ve.symbols[this._currentSymbolCursor];if(!we.unique.show)continue;i$16(we,this._si,this._co,be,this._allNeededMatrices.get(we.tile),this._zoom);const Se=we.unique;if(!Se.show)continue;const{iconAllowOverlap:Te,iconIgnorePlacement:Ee,textAllowOverlap:Ce,textIgnorePlacement:Oe}=be;for(const fe of we.colliders){if(!fe.enabled)continue;const ve=Se.parts[fe.partIndex];ve.show&&(!(fe.partIndex?Ce:Te)&&n52(fe)&&(fe.hard?Se.show=!1:ve.show=!1))}if(Se.show)for(const fe of we.colliders){if(!fe.enabled)continue;if(fe.partIndex?Oe:Ee)continue;if(!Se.parts[fe.partIndex].show)continue;const ve=fe.xScreen+fe.dxScreen,_e=fe.yScreen+fe.dyScreen,be=ve+fe.width,we=_e+fe.height,[Te,Ce,Re,De]=this._gridIndex.getCellSpan(ve,_e,be,we);for(let Se=Ce;Se<=De;Se++)for(let ve=Te;ve<=Re;ve++)this._gridIndex.cells[Se][ve].push(fe)}}}return!0}_getProperties(fe){const ve=this._styleProps.get(fe);if(ve)return ve;const _e=this._zoom,be=this._styleRepository.getStyleLayerByUID(fe),we=be.getLayoutValue("symbol-placement",_e)!==cpe.POINT;let Se=be.getLayoutValue("icon-rotation-alignment",_e);Se===upe.AUTO&&(Se=we?upe.MAP:upe.VIEWPORT);let Te=be.getLayoutValue("text-rotation-alignment",_e);Te===upe.AUTO&&(Te=we?upe.MAP:upe.VIEWPORT);const Ee=be.getPaintValue("icon-translate",_e),Ce=be.getPaintValue("icon-translate-anchor",_e),Oe=be.getPaintValue("text-translate",_e),Re=be.getPaintValue("text-translate-anchor",_e),De={iconAllowOverlap:be.getLayoutValue("icon-allow-overlap",_e),iconIgnorePlacement:be.getLayoutValue("icon-ignore-placement",_e),textAllowOverlap:be.getLayoutValue("text-allow-overlap",_e),textIgnorePlacement:be.getLayoutValue("text-ignore-placement",_e),iconRotationAlignment:Se,textRotationAlignment:Te,iconTranslateAnchor:Ce,iconTranslate:Ee,textTranslateAnchor:Re,textTranslate:Oe};return this._styleProps.set(fe,De),De}};function t$10(fe,ve){if(fe.priority-ve.priority)return fe.priority-ve.priority;const _e=fe.tile.key,be=ve.tile.key;return _e.world-be.world?_e.world-be.world:_e.level-be.level?_e.level-be.level:_e.row-be.row?_e.row-be.row:_e.col-be.col?_e.col-be.col:fe.xTile-ve.xTile?fe.xTile-ve.xTile:fe.yTile-ve.yTile}let vpe=class e56{get running(){return this._running}constructor(fe,ve,_e,be,we,Se){this._visibleTiles=fe,this._symbolRepository=ve,this._createCollisionJob=_e,this._assignTileSymbolsOpacity=be,this._symbolLayerSorter=we,this._isLayerVisible=Se,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(fe,ve){this._screenWidth===fe&&this._screenHeight===ve||this.restart(),this._screenWidth=fe,this._screenHeight=ve}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(fe){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const ve=performance.now();if(!this._selectionJob.work(fe))return!1;if(this._selectionJobCompleted=!0,0===(fe=Math.max(0,fe-(performance.now()-ve))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const ve=performance.now();if(!this._collisionJob.work(fe))return!1;if(this._collisionJobCompleted=!0,0===(fe=Math.max(0,fe-(performance.now()-ve))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const ve=performance.now();if(!this._opacityJob.work(fe))return!1;if(this._opacityJobCompleted=!0,0===(fe=Math.max(0,fe-(performance.now()-ve))))return!1}return this._running=!1,!0}_createSelectionJob(){const fe=this._symbolRepository.uniqueSymbols;for(let Te=0;Te<fe.length;Te++){const ve=fe[Te];for(let fe=0;fe<ve.uniqueSymbols.length;fe++){const _e=ve.uniqueSymbols[fe];for(const fe of _e.tileSymbols)fe.selectedForRendering=!1}}const ve=[];let _e=0,be=0;const we=this._isLayerVisible;const Se=this._symbolLayerSorter;return{work:function r65(Se){let Te;const Ee=performance.now();for(;be<fe.length;be++,_e=0){const Ce=fe[be],Oe=Ce.styleLayerUID;if(!we(Oe)){ve[be]||(ve[be]={styleLayerUID:Oe,symbols:[]});continue}ve[be]=ve[be]||{styleLayerUID:Oe,symbols:[]};const Re=ve[be];for(;_e<Ce.uniqueSymbols.length;_e++){if(Te=Ce.uniqueSymbols[_e],_e%100==99&&performance.now()-Ee>Se)return!1;let fe=null,ve=!1,be=!1;for(const _e of Te.tileSymbols)if(!be||!ve){const we=_e.tile;(!fe||we.isCoverage||we.neededForCoverage&&!ve)&&(fe=_e,(we.neededForCoverage||we.isCoverage)&&(be=!0),we.isCoverage&&(ve=!0))}if(fe.selectedForRendering=!0,be){Re.symbols.push(fe),Te.show=!0;for(const fe of Te.parts)fe.show=!0}else Te.show=!1}}for(const fe of ve)fe.symbols.sort(t$10);return!0},get sortedSymbols(){return ve.sort(Se)}}}_createOpacityJob(){const fe=this._assignTileSymbolsOpacity,ve=this._visibleTiles;let _e=0;function s84(ve,_e){const be=ve.symbols;for(const[fe,we]of be)i$15(we,_e);fe(ve,_e);for(const fe of ve.childrenTiles)s84(fe,_e)}return{work(fe){const be=performance.now();for(;_e<ve.length;_e++){if(performance.now()-be>fe)return!1;const we=ve[_e];null==we.parentTile&&s84(we,performance.now())}return!0}}}};function i$15(fe,ve){for(const _e of fe){const fe=_e.unique;for(const _e of fe.parts){const be=_e.targetOpacity>.5?1:-1;_e.startOpacity+=be*((ve-_e.startTime)/zue),_e.startOpacity=Math.min(Math.max(_e.startOpacity,0),1),_e.startTime=ve,_e.targetOpacity=fe.show&&_e.show?1:0}}}let _pe=class r51{constructor(fe,ve,_e){this.tileCoordRange=fe,this._visibleTiles=ve,this._createUnique=_e,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(fe,ve){this._uniqueSymbolLayerArray=null;let _e=this._tiles.get(fe.id);_e||(_e={symbols:new Map},this._tiles.set(fe.id,_e));const be=new Map;if(ve)for(const Te of ve)_e.symbols.has(Te)&&(be.set(Te,_e.symbols.get(Te)),_e.symbols.delete(Te));else for(const[Te,Ee]of fe.layerData)_e.symbols.has(Te)&&(be.set(Te,_e.symbols.get(Te)),_e.symbols.delete(Te));this._removeSymbols(be);const we=fe.symbols,Se=new Map;for(const[Te,Ee]of we){let fe=Ee.length;if(fe>=32){let ve=this.tileCoordRange;do{ve/=2,fe/=4}while(fe>8&&ve>64);const be=new Mue(this.tileCoordRange,this.tileCoordRange,ve);Se.set(Te,{flat:Ee,index:be}),_e.symbols.set(Te,{flat:Ee,index:be});for(const fe of Ee)be.getCell(fe.xTile,fe.yTile).push(fe)}else Se.set(Te,{flat:Ee}),_e.symbols.set(Te,{flat:Ee})}this._addSymbols(fe.key,we)}deleteStyleLayers(fe){this._uniqueSymbolLayerArray=null;for(const[ve,_e]of this._tiles){const be=new Map;for(const ve of fe)_e.symbols.has(ve)&&(be.set(ve,_e.symbols.get(ve)),_e.symbols.delete(ve));this._removeSymbols(be),0===_e.symbols.size&&this._tiles.delete(ve)}}removeTile(fe){this._uniqueSymbolLayerArray=null;const ve=this._tiles.get(fe.id);if(!ve)return;const _e=new Map;for(const[be,we]of fe.symbols)ve.symbols.has(be)&&(_e.set(be,ve.symbols.get(be)),ve.symbols.delete(be));this._removeSymbols(_e),0===ve.symbols.size&&this._tiles.delete(fe.id)}querySymbols(fe,ve,_e,be){const we=[],Se=this.uniqueSymbols;for(const Te of Se){const be=Te.styleLayerUID,Se=Te.uniqueSymbols;for(const Te of Se){const Se=Te.tileSymbols.find((fe=>fe.selectedForRendering));Se&&c$1k(Se,fe,ve*(window.devicePixelRatio||1),_e)&&we.push({vtlSymbol:Se,styleLayerUID:be,tileKey:Se.tile.key})}}return we}_removeSymbols(fe){for(const[ve,{flat:_e}]of fe)for(const fe of _e){const _e=fe.unique,be=_e.tileSymbols,we=be.length-1;for(let ve=0;ve<we;ve++)if(be[ve]===fe){be[ve]=be[we];break}if(be.length=we,0===we){const fe=this._uniqueSymbolsReferences.get(ve);fe.delete(_e),0===fe.size&&this._uniqueSymbolsReferences.delete(ve)}fe.unique=null}}_addSymbols(fe,ve){if(0===ve.size)return;const _e=this._visibleTiles;for(const be of _e)be.parentTile||be.key.world!==fe.world||be.key.level===fe.level&&!be.key.equals(fe)||this._matchSymbols(be,fe,ve);for(const[be,we]of ve)for(const fe of we)if(null==fe.unique){const ve=this._createUnique();fe.unique=ve,ve.tileSymbols.push(fe);let _e=this._uniqueSymbolsReferences.get(be);_e||(_e=new Set,this._uniqueSymbolsReferences.set(be,_e)),_e.add(ve)}}_matchSymbols(fe,ve,_e){if(fe.key.level>ve.level){const _e=fe.key.level-ve.level;if(fe.key.row>>_e!==ve.row||fe.key.col>>_e!==ve.col)return}if(ve.level>fe.key.level){const _e=ve.level-fe.key.level;if(ve.row>>_e!==fe.key.row||ve.col>>_e!==fe.key.col)return}if(ve.equals(fe.key)){for(const be of fe.childrenTiles)this._matchSymbols(be,ve,_e);return}const be=new Map;for(const[we,Se]of _e){const _e=[];for(const be of Se){const we=o$Q(this.tileCoordRange,be.xTile,ve.level,ve.col,fe.key.level,fe.key.col),Se=o$Q(this.tileCoordRange,be.yTile,ve.level,ve.row,fe.key.level,fe.key.row);we>=0&&we<this.tileCoordRange&&Se>=0&&Se<this.tileCoordRange&&_e.push({symbol:be,xTransformed:we,yTransformed:Se})}const Te=[],Ee=20+(fe.key.level<ve.level?1:1<<fe.key.level-ve.level),Ce=this._tiles.get(fe.id).symbols.get(we);if(Ce){const fe=Ce.flat;for(const ve of _e){let _e,be=!1;const we=ve.xTransformed,Se=ve.yTransformed;_e=null!=Ce.index?Ce.index.getCell(we,Se):fe;const Oe=ve.symbol,Re=Oe.hash;for(const fe of _e)if(Re===fe.hash&&Math.abs(we-fe.xTile)<=Ee&&Math.abs(Se-fe.yTile)<=Ee){const ve=fe.unique;Oe.unique=ve,ve.tileSymbols.push(Oe),be=!0;break}be||Te.push(Oe)}}Te.length>0&&be.set(we,Te)}for(const we of fe.childrenTiles)this._matchSymbols(we,ve,be)}_createUniqueSymbolLayerArray(){const fe=this._uniqueSymbolsReferences,ve=new Array(fe.size);let _e,be=0;for(const[we,Se]of fe){const fe=new Array(Se.size);_e=0;for(const ve of Se)fe[_e++]=ve;ve[be]={styleLayerUID:we,uniqueSymbols:fe},be++}return ve}};function y$x(fe,ve){const _e=fe.transforms.tileUnitsToPixels,be=u$3Z(ve),we=Math.cos(be),Se=Math.sin(be),Te=Math.ceil(512*(Math.abs(Se)+Math.abs(we)));o$3o($pe),M$1f($pe,$pe,[Te/2,Te/2]),h$2r($pe,$pe,be),M$1f($pe,$pe,[-256,-256]),f$2D($pe,$pe,[1/8,1/8,1]),fe.transforms.tileUnitsToPixels=$pe;const Ee=[],Ce=new _pe(4096,Ee,(()=>new Aue)),Oe=new vpe(Ee,Ce,((_e,be,we)=>new gpe(_e,be,we,fe.styleRepository,fe.key.level,ve)),((fe,ve)=>{!function r$O(fe,ve,_e){for(const[be,we]of fe.symbols)n$1h(fe,ve,0,we,be)}(fe,ve)}),(()=>0),(ve=>{const _e=fe.styleRepository.getStyleLayerByUID(ve).getLayoutProperty("visibility");return!_e||_e.getValue()!==lpe.NONE}));Ee.push(fe),Ce.add(fe),Oe.setScreenSize(Te,Te),Oe.continue(1/0),Ce.removeTile(fe),fe.transforms.tileUnitsToPixels=_e}const $pe=e$13();let bpe=class t67 extends Uue{_createTransforms(){return{displayViewScreenMat3:e$13(),tileMat3:e$13()}}},wpe=class s70{constructor(){this._candidateTiles=[]}schedule(fe){this._candidateTiles.includes(fe)||this._candidateTiles.push(fe)}reshuffle(fe){const ve=[];for(const _e of this._candidateTiles)fe>0?(_e.reshuffle(),fe--):ve.push(_e);this._candidateTiles=ve}};let xpe=class f18{constructor(){this._renderParams={reshuffleManager:new wpe,context:null,drawPhase:1,state:new Spe,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new bpe(new pue(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){const Re=this._backgroundTile;this._updateRenderParameters(fe,ve,Re,_e,we,Se,Te,Ee,Ce,Oe),this._renderParams.stencilSymbols=!1,_e.drawBackground(this._renderParams,Re,be)}renderContent(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De){this._declutter(_e),be.forAll((fe=>this._declutter(fe.sourceLayerInfo.data))),this._stencilSymbols(fe,ve,_e,be,we,Se,Te,Math.round(1/Ee),Ce,Oe,Re,De);let Be=1;_e.stencilRef=Be++,fe.setStencilFunction(jO.EQUAL,_e.stencilRef,255),this._render(fe,ve,_e,we,Se,Te,Ee,Ce,Oe,Re,De),be.forAll((ve=>{ve.sourceLayerInfo.data.stencilRef=Be++,this._renderSymbols(fe,ve.sourceLod,ve.sourceLayerInfo.data,we,Se,Te,Math.round(1/Ee),ve.offset,Oe,Re,De)}))}_stencilSymbols(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De){let Be=1;_e.stencilRef=Be++,fe.setDepthTestEnabled(!1),fe.setDepthWriteEnabled(!1),fe.setStencilTestEnabled(!0),fe.setBlendingEnabled(!1),fe.setColorMask(!1,!1,!1,!1),fe.setStencilOp(GO.KEEP,GO.KEEP,GO.REPLACE),fe.setStencilWriteMask(255),fe.setStencilFunction(jO.ALWAYS,_e.stencilRef,255),this._stencilTileSymbols(fe,ve,_e,we,Se,Te,Ee,Ce,Oe,Re,De);for(const Ze of be.toArray()){const{sourceLod:ve,offset:_e,sourceLayerInfo:be}=Ze;be.data.stencilRef=Be++,fe.setStencilFunction(jO.ALWAYS,be.data.stencilRef,255),this._stencilTileSymbols(fe,ve,be.data,we,Se,Te,Ee,_e,Oe,Re,De)}fe.setStencilWriteMask(0),fe.setBlendingEnabled(!0),fe.setDepthTestEnabled(!0),fe.setColorMask(!0,!0,!0,!0)}_renderSymbols(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re){fe.setStencilFunction(jO.EQUAL,_e.stencilRef,255),this._render(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,ape.SYMBOL)}_render(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De){this._updateRenderParameters(fe,ve,_e,be,Se,Te,Ee,Ce,Oe,Re),this._renderParams.stencilSymbols=!1,be.drawTile(this._renderParams,_e,we,De)}_stencilTileSymbols(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re){this._updateRenderParameters(fe,ve,_e,be,Se,Te,Ee,Ce,Oe,Re),this._renderParams.stencilSymbols=!0,_e.triangleCount=0,be.drawSymbols(this._renderParams,_e,we)}_updateRenderParameters(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe){"type"in _e&&"vector-tile"===_e.type&&!_e.stage&&_e.attachWithContext(fe);const Re=ve[0]-we.getLevelShift(ve[0]),De=this._renderParams;De.context=fe,De.painter=be,De.glyphMosaic=be.glyphMosaic,De.spriteMosaic=be.spriteMosaic,De.pixelRatio=Ce*Oe,De.displayLevel=Re,De.requiredLevel=Re;const Be=we.getScale(ve[0]),[Ze,Xe]=we.getOffset(ve,Se*Be),Je=.125*Se*Be/Ee,Qe=_e.transforms.displayViewScreenMat3;Qe[0]=Je,Qe[4]=-Je,Qe[6]=-1-Ze-Te[0]*Se*2,Qe[7]=1+Xe+(1-Te[1])*Se*2-2;const dt=De.state,$t=Ee/Oe;dt.size[0]=$t,dt.size[1]=$t,dt.pixelRatio=Oe,dt.rotation=(360-this._heading)%360;const bt=2/$t;r$2_(dt.displayViewMat3,bt,0,0,0,-bt,0,-1,1,1);const wt=o$3o(dt.displayMat3),xt=u$3Z(this._heading);M$1f(wt,wt,[$t/2,$t/2]),h$2r(wt,wt,xt),M$1f(wt,wt,[-$t/2,-$t/2]),i$3X(wt,dt.displayViewMat3,wt)}updateHeading(fe){this._heading=fe}_declutter(fe){this._declutteredForHeading.get(fe)!==this._heading&&(y$x(fe,(360-this._heading)%360),this._declutteredForHeading.set(fe,this._heading))}},Spe=class g19{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=[1,0,0,0,1,0,0,0,1],this.displayViewMat3=[1,0,0,0,1,0,0,0,1],this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function l$14(fe){fe.fragment.uniforms.add(new CO("u_colormap",(fe=>fe.u_colormap)),new dO("u_colormapOffset",(fe=>fe.colormap.u_colormapOffset)),new dO("u_colormapMaxIndex",(fe=>fe.colormap.u_colormapMaxIndex)),new dO("u_opacity",(fe=>fe.common.u_opacity))),fe.fragment.code.add(o$2P`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function t$Z(fe){fe.fragment.uniforms.add(new CO("u_transformGrid",(fe=>fe.u_transformGrid)),new lO("u_transformSpacing",(fe=>fe.common.u_transformSpacing)),new lO("u_targetImageSize",(fe=>fe.common.u_targetImageSize))),fe.fragment.code.add(o$2P`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let Tpe=class l33 extends Qde{constructor(fe,ve,_e){super(),this.common=fe,this.u_image=ve,this.u_transformGrid=_e}};function i$13(fe,ve){fe.include(t$Z),fe.fragment.uniforms.add(new CO("u_image",(fe=>fe.u_image)),new zM("u_flipY",(fe=>fe.common.u_flipY)),new zM("u_applyTransform",(fe=>fe.common.u_applyTransform)));const{requireBilinearWithNN:_e}=ve;_e&&fe.fragment.uniforms.add(new lO("u_srcImageSize",(fe=>fe.common.u_srcImageSize))),fe.fragment.code.add(o$2P`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),_e?fe.fragment.code.add(o$2P`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):fe.fragment.code.add(o$2P`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let Epe=class v12 extends Tpe{constructor(fe,ve,_e,be,we,Se){super(fe,be,we),this.colormap=ve,this.symbolizer=_e,this.u_colormap=Se,this.backgroundColor=Bi,this.fboTexture=null,this.baseOpacity=1}},Ppe=class _14 extends Epe{},Cpe=class y11 extends Epe{};function h$A(fe){const ve=new gO;return ve.include(d$L),ve.include(i$13,fe),ve.include(l$14,fe),ve.include(m$_,fe),ve.fragment.code.add(o$2P`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),fe.colorizerType===spe.Stretch?function C$d(fe,ve){fe.fragment.uniforms.add(new tq("u_bandCount",(fe=>fe.symbolizer.u_bandCount)),new dj("u_minCutOff",(fe=>fe.symbolizer.u_minCutOff),3),new dj("u_maxCutOff",(fe=>fe.symbolizer.u_maxCutOff),3),new dj("u_factor",(fe=>fe.symbolizer.u_factor),3),new dO("u_minOutput",(fe=>fe.symbolizer.u_minOutput)),new dO("u_maxOutput",(fe=>fe.symbolizer.u_maxOutput)),new zM("u_useGamma",(fe=>fe.symbolizer.u_useGamma)),new dj("u_gamma",(fe=>fe.symbolizer.u_gamma),3),new dj("u_gammaCorrection",(fe=>fe.symbolizer.u_gammaCorrection),3),new dO("u_opacity",(fe=>fe.common.u_opacity))),fe.fragment.code.add(o$2P`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const _e=ve.applyColormap?o$2P`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:o$2P`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;fe.fragment.code.add(o$2P`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${ve.stretchType===ope.Noop?o$2P`
        fragColor = applyBackgroundBlend(currentPixel);`:o$2P`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${_e}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}(ve,fe):fe.colorizerType===spe.Lut?function b$q(fe){fe.fragment.code.add(o$2P`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}(ve):fe.colorizerType===spe.Hillshade&&function w$q(fe,ve){const _e=fe.fragment;_e.uniforms.add(new CO("u_image",(fe=>fe.u_image)),new tq("u_hillshadeType",(fe=>fe.symbolizer.u_hillshadeType)),new dj("u_sinZcosAs",(fe=>fe.symbolizer.u_sinZcosAs),6),new dj("u_sinZsinAs",(fe=>fe.symbolizer.u_sinZsinAs),6),new dj("u_cosZs",(fe=>fe.symbolizer.u_cosZs),6),new dj("u_weights",(fe=>fe.symbolizer.u_weights),6),new lO("u_factor",(fe=>fe.symbolizer.u_factor)),new dO("u_minValue",(fe=>fe.symbolizer.u_minValue)),new dO("u_maxValue",(fe=>fe.symbolizer.u_maxValue)),new lO("u_srcImageSize",(fe=>fe.common.u_srcImageSize))),_e.include(e$2S),_e.code.add(o$2P`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),_e.code.add(o$2P`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const be=ve.applyColormap?o$2P`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:o$2P`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;_e.code.add(o$2P`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${be}
    }
  `)}(ve,fe),ve}const Ope=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Cpe,ColorizerStretchUniforms:Ppe,ColorizerUniforms:Epe,build:h$A},Symbol.toStringTag,{value:"Module"}));let Ape=class u21 extends fA{initializeProgram(fe){return new gA(fe.rctx,u21.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}};Ape.shader=new LO(Ope,(()=>zt((()=>Promise.resolve().then((()=>$Re))),void 0)));let Mpe=class d24 extends Jde{constructor(){super(...arguments),this.colorizerType=spe.Stretch,this.stretchType=ope.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};e$4o([r$2w({count:spe.COUNT})],Mpe.prototype,"colorizerType",void 0),e$4o([r$2w({count:ope.COUNT})],Mpe.prototype,"stretchType",void 0),e$4o([r$2w()],Mpe.prototype,"applyColormap",void 0),e$4o([r$2w()],Mpe.prototype,"requireBilinearWithNN",void 0);let Rpe=class o32{constructor(fe){this._rctx=fe,this._fbos=new Map}get(fe){return this._getPool(fe)}dispose(){this._fbos.forEach((fe=>fe.dispose())),this._fbos.clear()}_getPool(fe){const ve=this._fbos.get(fe);if(ve)return ve;const _e=new vR(this._rctx,new nM(fe),new yR(JO.DEPTH24_STENCIL8,fe));return this._fbos.set(fe,_e),_e}};let Ipe=class L7{constructor(fe,ve){this._rctx=fe,this._techniques=ve,this._fbos=[],this._vectorTileHelper=new xpe,this._bindParameters=new uI(null,null),this._blendLayersTechniqueConfig=new ipe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=i$2S(this._rctx,KA)}dispose(){this._fbos.forEach(r$3M),this._fbos=null,this._vtFBO=r$3M(this._vtFBO),this._vaoQuad=r$3M(this._vaoQuad),this._vectorTileHelper=r$3M(this._vectorTileHelper),this._backgroundTechnique=t$4r(this._backgroundTechnique),this._applyOpacityTechnique=t$4r(this._applyOpacityTechnique),this._blendLayersTechnique=t$4r(this._blendLayersTechnique)}updateHeading(fe){var ve;null==(ve=this._vectorTileHelper)||ve.updateHeading(fe)}_getBlendLayersTechnique(fe,ve,_e,be=Xde.Off,we=Kde.BelowLayer){return this._blendLayersTechniqueConfig.output=ve,this._blendLayersTechniqueConfig.blendMode=fe,this._blendLayersTechniqueConfig.baseOpacityMode=_e,this._blendLayersTechniqueConfig.premultipliedSource=be,this._blendLayersTechniqueConfig.background=we,this._blendLayersTechnique=this._techniques.releaseAndAcquire(rpe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(fe,ve){const _e=this._getBlendLayersTechnique(Hde.Normal,ve?Zde.ColorComposite:Zde.GridComposite,Yde.NotRequired,Xde.Off,Kde.Only),be=this._rctx.bindTechnique(_e,this._bindParameters,fe);this._render(be)}_render(fe){this._rctx.bindVAO(this._vaoQuad),fe.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(NO.TRIANGLE_STRIP,0,i$2T(this._vaoQuad,"geometry"))}drawGroup(fe,ve,_e,be,we=Xde.On){ve===Zde.Composite&&(fe.fboTexture=this._fbos[this.getLastOnHoldId()].get(_e).colorTexture),fe.texture=this.currentFBO(_e).colorTexture,this.closeGroup(_e);const Se=fe.baseOpacity<1?Yde.Required:Yde.NotRequired,Te=this._getBlendLayersTechnique(be,ve,Se,we),Ee=this._rctx.bindTechnique(Te,this._bindParameters,fe);this._render(Ee)}drawImageData(fe,ve,_e,be,we=Xde.Off){if(null==fe.texture)return;const Se=fe.baseOpacity<1?Yde.Required:Yde.NotRequired;fe.fboTexture=ve===Zde.GroupBackgroundComposite||be===Hde.Normal&&Se===Yde.NotRequired&&we===Xde.Off?null:this.switch(_e).colorTexture;const Te=this._getBlendLayersTechnique(be,ve,Se,we),Ee=this._rctx.bindTechnique(Te,this._bindParameters,fe);this._render(Ee)}drawRasterData(fe,ve,_e,be,we){const Se=we.sourceLayerInfo.data;if(!Se.source)return;if(we.tile.surface.layerViewByIndex(we.layerIndex,Wle.MAP).ensureSymbolizerParameters(Se),!Se.bind(this._rctx))return;const Te=fe.baseOpacity<1?Yde.Required:Yde.NotRequired;fe.fboTexture=be===Hde.Normal&&Te===Yde.NotRequired?null:this.switch(_e).colorTexture;const Ee=this._getRasterColorizerTechnique(Se,ve,be,Te);Se.opacity=fe.opacity;const Ce=Se.getUniforms();Ce.scale=we.scale,Ce.offset=we.offset,Ce.backgroundColor=fe.backgroundColor,Ce.fboTexture=fe.fboTexture,Ce.baseOpacity=fe.baseOpacity;const Oe=this._rctx.bindTechnique(Ee,null,Ce);this._render(Oe)}_getRasterColorizerTechnique(fe,ve,_e,be){const we=fe.symbolizerParameters,Se=["stretch","lut","hillshade"].indexOf(we.type);return null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new Mpe,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=ve,this._rasterColorizerConfig.blendMode=_e,this._rasterColorizerConfig.baseOpacityMode=be,this._rasterColorizerConfig.colorizerType=Se,this._rasterColorizerConfig.applyColormap=!!we.colormap,this._rasterColorizerConfig.requireBilinearWithNN=fe.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=fe.hasStretchTypeNone()?ope.Noop:ope.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(Ape,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(fe,ve,_e,be,we,Se,Te,Ee){const Ce=this._rctx,Oe=we.sourceLayerInfo.data,Re=we.tile.surface.layerViewByIndex(we.layerIndex,Wle.MAP),De=fe.baseOpacity<1?Yde.Required:Yde.NotRequired,Be=De===Yde.Required||fe.opacity<1||be!==Hde.Normal||ve!==Zde.Composite,Ze=Be?Xde.On:Xde.Off,Xe=this._getBlendLayersTechnique(be,ve,De,Ze);Ce.setPipelineState(Xe.getPipeline());let Je=null,Qe=null;Be?(Qe=this.currentFBO(_e),null==this._vtFBO&&(this._vtFBO=new Rpe(this._rctx)),Je=this._vtFBO.get(_e),Ce.bindFramebuffer(Je),this._clearCurrentFBO()):Ee&&Ce.clear(DO.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(Ce,we.sourceLod,Re.painter,Re.layer.styleRepository,Re.schemaHelper,Math.round(1/we.scale),we.offset,Te,Se,Re.contentZoom),Oe&&this._vectorTileHelper.renderContent(Ce,we.sourceLod,Oe,we.vtlNeighborInfos,Re.painter,Re.layer.styleRepository,Re.schemaHelper,Math.round(1/we.scale),we.offset,Te,Se,Re.contentZoom)}catch(LF){ar.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",LF)}return null==Je||(Ce.bindFramebuffer(Qe),fe.texture=Je.colorTexture,fe.offset=md,fe.scale=1,this.drawImageData(fe,ve,_e,be,Ze),Ee)}copyFBOToTexture(fe){const ve=this._rctx,_e=ve.bindTexture(fe.texture,oM.TEXTURE_UNIT_FOR_UPDATES),be=fe.descriptor;ve.gl.copyTexImage2D(WO.TEXTURE_2D,0,be.pixelFormat,0,0,be.width,be.height,0),fe.generateMipmap(),ve.bindTexture(_e,oM.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(DO.COLOR_BUFFER_BIT|DO.DEPTH_BUFFER_BIT|DO.STENCIL_BUFFER_BIT)}_initFBO(fe,ve,_e){this._rctx.bindFramebuffer(fe),_e&&(this._rctx.setViewport(0,0,ve,ve),this._clearCurrentFBO())}ensureBuffer(fe){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(fe)}bind(fe,ve=0,_e=!0){if(this._current=ve,ve>=this._fbos.length)for(let be=this._fbos.length;be<=ve;be++)this._fbos.push(new Rpe(this._rctx));this._initFBO(this._fbos[ve].get(fe),fe,_e)}_bindNextFreeBuffer(fe){this._lastUsedIds.length>0?this.bind(fe,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(fe,this._lastCreatedBufferId))}openGroup(fe){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(fe)}switch(fe){const ve=this.currentFBO(fe),_e=this._current;return this._bindNextFreeBuffer(fe),this._lastUsedIds.push(_e),ve}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(fe){const ve=this._current;this._bindNextFreeBuffer(fe),this._lastUsedIds.push(ve),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(fe){return this._fbos[this._current].get(fe)}},Lpe=class t68{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Dpe=class t69{constructor(fe,ve){this._texture=fe,this._cache=ve,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,0===this._refCount)if(this._cache){const fe=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(fe,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},Npe=class j9{constructor(fe,ve,_e,be,we,Se){this.start=fe,this.end=ve,this.blendMode=_e,this.opacity=be,this.output=we,this.baseOpacity=Se}},Fpe=class C8{constructor(fe,ve,_e,be){this._rctx=fe,this.tileSize=ve,this._techniques=_e,this._cache=be,this._passParameters=new tpe,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new Ipe(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=r$3M(this._compositor),this._backgroundTexture=t$4r(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateHeading(fe){var ve;null==(ve=this._compositor)||ve.updateHeading(fe)}updateTileTexture(fe,ve){if(!fe.renderData)return;const _e=fe.surface,be=_e.baseOpacity;let we=0,Se=0,Te=this.tileSize,Ee=!1,Ce=!1;const Oe=_e.view.state.contentPixelRatio;let Re=!1;zpe.clear(),kpe.length=0;const De=fe.layerInfo[Wle.MAP];let Be=0,Ze=null;for(;Be<De.length;Be++){const ve=_e.layerViewByIndex(Be,Wle.MAP),Xe=ve.layer.opacity,Je=ve.fullOpacity;if(Ce=Ce||j$1t(ve.layer),A$o(ve)){let fe="normal"!==ve.layer.blendMode;if(p$4s(ve.layer.parent)){const _e=S$k(ve.layer.parent);null!=_e&&""!==_e&&(fe=B$9(ve.layer.parent)||fe)}fe&&(Re=fe,Ee=!1)}if(0===Xe&&!Re){De[Be].pendingUpdates&=~(zhe.TEXTURE_NOFADING&zhe.TEXTURE_FADING);continue}++Se;const Qe=d$P(ve),dt=N$g(fe,Be,Qe);if(dt){if(De[Be].pendingUpdates&=~(zhe.TEXTURE_NOFADING&zhe.TEXTURE_FADING),p$4s(ve.layer.parent)){const fe=S$k(ve.layer.parent);null!=fe&&""!==fe&&G$7(ve.layer.parent,Be)}Qe?Te=Math.max(Te,this.tileSize*Oe):1===be&&1===Je&&(ve.isOpaque||this._dataToTexture(dt)&&dt.sourceLayerInfo.data.descriptor.isOpaque)&&(Ee=!0),++we,null===Ze&&(Ze=Be)}}const Xe=Te/this.tileSize,Je=this._ensureBackgroundTexture(this.tileSize);0!==we&&null!==Ze?1===we&&!Re&&this._useLayerTexture(fe,Ze)||this._composeLayers(fe,ve,Be-1,Ce,Te,Xe,!Ee||Re,zpe,Re):function F$e(fe,ve,_e,be){const we=fe.renderData,Se=!be&&null!=we.textureReference&&(fe.surface.view.layerViewManager.updating||ve>0)?Phe.Delayed:Phe.Immediate;we.setTextureReference(new npe(_e,aY.FADING,Vpe,fe.surface.baseOpacity,0,1),Se)}(fe,Se,Je,ve!==aY.FADING)}_ensureBackgroundTexture(fe){return null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(fe,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(fe),this._passParameters.offset=md,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,null!=this.backgroundColor),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(fe,ve){const _e=fe.surface.layerViewByIndex(ve,Wle.MAP),be=j$1t(_e.layer),we=be?fe.surface.baseOpacity:1,Se=be?1:fe.surface.baseOpacity,Te=_e.fullOpacity,Ee=N$g(fe,ve,!1);return!!this._dataToTexture(Ee)&&(fe.renderData.setTextureReference(new npe(Ee.sourceLayerInfo.data,aY.FADING,Ee,we,Se,Te)),!0)}_composeLayers(fe,ve,_e,be,we,Se,Te,Ee,Ce){this._compositor.ensureBuffer(we);const Oe=fe.surface.baseOpacity;let Re=!1,De=HO.LINEAR_MIPMAP_LINEAR,Be=!1,Ze=0;for(let dt=_e;dt>=0;dt--){const ve=fe.surface.layerViewByIndex(dt,Wle.MAP),_e=d$P(ve),Xe=N$g(fe,dt,_e),Je=ve.layer.opacity;if(!Xe||0===Je&&!Ce)continue;const Qe=!j$1t(ve.layer)&&!Re;Qe&&(Re=!0);let $t=!1;Ee.forEach((fe=>{fe.start===dt&&(fe.output=be?Zde.Composite:Te&&Qe?this.backgroundIsGrid?Zde.GridComposite:Zde.ColorComposite:Zde.Composite,fe.baseOpacity=Qe?Oe:1,kpe.push(fe),this._compositor.openGroup(we),$t=!0)}));const bt=0===Ze,wt=$t?Zde.GroupBackgroundComposite:Te&&bt?this.backgroundIsGrid?Zde.GridComposite:Zde.ColorComposite:Zde.Composite,xt=qde[A$o(ve)?ve.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=Qe&&!$t&&Oe<1?Oe:1,this._passParameters.opacity=Je,w$t(Xe)?Be=this._compositor.drawVectorData(this._passParameters,wt,we,xt,Xe,Se,this.tileSize,Be):g$E(Xe)?(this._compositor.drawRasterData(this._passParameters,wt,we,xt,Xe),U$c(Xe)&&(De=HO.NEAREST)):this._dataToTexture(Xe)&&(this._passParameters.texture=Xe.sourceLayerInfo.data.texture,this._passParameters.offset=Xe.offset,this._passParameters.scale=Xe.scale,this._compositor.drawImageData(this._passParameters,wt,we,xt));kpe.length>0&&kpe[kpe.length-1].end===dt;){const fe=kpe.pop();this._passParameters.baseOpacity=fe.baseOpacity,this._passParameters.opacity=fe.opacity,this._passParameters.offset=md,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,fe.output,we,qde[fe.blendMode])}Ze++}const Xe=fe.renderData,Je=Ce||Re&&Oe<1,Qe=Xe.ensureTexture(we,Je,(()=>this._buildTexture(we,Je,De)));this._compositor.copyFBOToTexture(Qe),this._compositor.unbind(),Xe.setTextureReference(new npe(Qe,ve,Vpe,Re?1:Oe,0,1))}_dataToTexture(fe){if(function j$m(fe){var ve;const _e=null==(ve=null==fe?void 0:fe.sourceLayerInfo)?void 0:ve.data;return r$R(_e)||_e instanceof HTMLImageElement||_e instanceof HTMLCanvasElement||_e instanceof ImageData}(fe)){const ve=fe.sourceLayerInfo;ve.data=this._buildTexture(ve.data,!0),fe.tile.setMemoryDirty()}return function C$f(fe){var ve;return n$1o(null==(ve=null==fe?void 0:fe.sourceLayerInfo)?void 0:ve.data)}(fe)}setBackground(fe){this._backgroundColor!==fe&&(this._backgroundColor=fe,this._backgroundDirty=!0)}_buildTexture(fe,ve,_e=HO.LINEAR_MIPMAP_LINEAR){if(null==fe)return null;const be=new nM;be.wrapMode=qO.CLAMP_TO_EDGE,be.samplingMode=_e,be.maxAnisotropy=this._maxAnisotropy,be.preMultiplyAlpha=!0,be.flipped=!0,be.hasMipmap=!0,ve||(be.pixelFormat=YO.RGB);const we=this._rctx;let Se;if("number"==typeof fe)be.width=be.height=fe,Se=this._buildTileTexture(be,fe);else if(r$R(fe))be.isOpaque=fe.isOpaque,be.isOpaque&&(be.pixelFormat=YO.RGB),Se=this._buildTileTexture(be,fe.element.width,fe.element);else try{be.width=fe.width,be.height=fe.height,Se=this._buildTileTexture(be,fe.width,fe)}catch(da){Se=new Dpe(a$2U(we))}const Te=we.bindTexture(Se.texture,oM.TEXTURE_UNIT_FOR_UPDATES);return Se.generateMipmap(),we.bindTexture(Te,oM.TEXTURE_UNIT_FOR_UPDATES),Se}_buildTileTexture(fe,ve,_e){const be=`${ve} ${fe.pixelFormat}`,we=this._cache.pop(be);return we?(we.retain(),we.texture.setData(_e),we):new Dpe(new oM(this._rctx,fe,_e),this._cache)}get test(){}};function N$g(fe,ve,_e){Upe.layerIndex=ve,Upe.vtlNeighborInfos.clear();const be=fe.layerInfo[Wle.MAP][ve];if(o$2R(Upe.offset,0,0),Upe.tile=fe,Upe.scale=1,Upe.sourceLod=fe.lij,Upe.sourceLayerInfo=be,Upe.isVTLBackground=_e,be.data)return _e&&fe.forEachLoadedNeighbor(((_e,we)=>{if(_e.level!==fe.level)return;const Se=_e.layerInfo[Wle.MAP][ve];if(!v$p(Se)||be.data===Se.data)return;const Te=Upe.vtlNeighborInfos.pushNew();Te.offset=Bpe[we],Te.sourceLod=_e.lij,Te.sourceLayerInfo=Se})),Upe;const we=be.upsampleInfo;if(we){const fe=we.tile.layerInfo[Wle.MAP][ve];return Upe.tile=we.tile,r$2C(Upe.offset,we.offset),Upe.scale=we.scale,Upe.sourceLod=we.tile.lij,Upe.sourceLayerInfo=fe,Upe}return _e?Upe:null}function S$k(fe){return fe.uid}function U$c(fe){const ve=fe.sourceLayerInfo.data;return!!ve.source&&"nearest"===ve.interpolation}function B$9(fe){let ve="normal"!==fe.blendMode;return p$4s(fe.parent)&&(ve=B$9(fe.parent)||ve),ve}function G$7(fe,ve){p$4s(fe.parent)&&G$7(fe.parent,ve);const _e=S$k(fe);if(null!=_e&&""!==_e){const be=zpe.get(_e);be?be.start=ve:zpe.set(_e,new Npe(ve,ve,fe.blendMode,fe.opacity,Zde.Composite,1))}}const zpe=new Map,kpe=new Array,Upe=new class o33{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new jr({allocator:fe=>fe||new Lpe})}},Vpe={offset:[0,0],scale:1},Bpe=new Array;Bpe[Xue.NORTH]=[0,-1],Bpe[Xue.NORTH_EAST]=[-1,-1],Bpe[Xue.EAST]=[-1,0],Bpe[Xue.SOUTH_EAST]=[-1,1],Bpe[Xue.SOUTH]=[0,1],Bpe[Xue.SOUTH_WEST]=[1,1],Bpe[Xue.WEST]=[1,0],Bpe[Xue.NORTH_WEST]=[1,-1];const jpe=1e-6;let Gpe=class d25{constructor(fe,ve,_e,be,we){this.aabb=fe,this.axis=ve,this.d=_e,this.midStartIndex=be,this.rightStartIndex=we}},Hpe=class f19{constructor(fe,ve,_e,be){this.globalTriangleVertexIndices=fe,this.firstTriangleIndex=ve,this.positions=be,this._rayDirection=[0,0,0],this._callback=R$g,this._intersectionOptions=Xpe,this.bspNodeTree=new Array;const we=_e-ve,Se=new(we<Ype?Uint8Array:we<Zpe?Uint16Array:Uint32Array)(we);this.triangleIndexMap=Se;for(let Te=0;Te<we;++Te)Se[Te]=Te;{const Te=function p$1w(fe,ve,_e,be,we){const Se=_e-ve,Te=new Float32Array(6*Se);for(let Ee=0;Ee<Se;++Ee){const _e=3*(Ee+ve),Se=fe[_e]*we,Ce=fe[_e+1]*we,Oe=fe[_e+2]*we;for(let fe=0;fe<3;++fe){const ve=be[Se+fe],_e=be[Ce+fe],we=be[Oe+fe];Te[6*Ee+fe]=Math.min(ve,_e,we),Te[6*Ee+3+fe]=Math.max(ve,_e,we)}}return Te}(fe,ve,_e,be.data,be.stride),Ee=e$3Y(Math.log2(we/40),2,10),m39=(fe,ve,_e)=>{const be=function x$h(fe,ve,_e,be){if(be<=_e)return a$3w(NaN,NaN,NaN,NaN,NaN,NaN);{const be=6*fe[_e];for(let fe=0;fe<3;++fe)qpe[fe]=ve[be+0+fe],Wpe[fe]=ve[be+3+fe]}for(let we=_e+1;we<be;++we){const _e=6*fe[we];for(let fe=0;fe<3;++fe)qpe[fe]=Math.min(qpe[fe],ve[_e+0+fe]),Wpe[fe]=Math.max(Wpe[fe],ve[_e+3+fe])}return a$3w(qpe[0],qpe[1],qpe[2],Wpe[0],Wpe[1],Wpe[2])}(Se,Te,fe,ve),we=ve-fe;if(we<=40){const _e=new Gpe(be,void 0,0,fe,ve);return this.bspNodeTree.push(_e),_e}const{axis:Ce,midValue:Oe}=function y$v(fe){const ve=fe[3]-fe[0],_e=fe[4]-fe[1],be=fe[5]-fe[2],we=ve>_e?ve>be?0:_e>be?1:2:_e>be?1:be>ve?2:0;return{axis:we,midValue:(fe[we]+fe[we+3])/2}}(be),Re=function g$A(fe,ve,_e,be,we,Se){let Te=_e,Ee=be;for(;Te<Ee;){const _e=fe[Te];ve[6*_e+we+3]<=Se?++Te:(--Ee,fe[Te]=fe[Ee],fe[Ee]=_e)}let Ce=Te;for(Ee=be;Ce<Ee;){const _e=fe[Ee-1];ve[6*_e+we]>=Se?--Ee:(fe[Ee-1]=fe[Ce],fe[Ce]=_e,++Ce)}return{next:Te,mid:Ce}}(Se,Te,fe,ve,Ce,Oe),p48=(fe,ve)=>{if(_e>Ee)return;const be=ve-fe;return be<40||be>=.8*we?void 0:m39(fe,ve,_e+1)},De=new Gpe(be,Ce,Oe,Re.next,Re.mid);return this.bspNodeTree.push(De),De.leftNode=p48(fe,Re.next),De.rightNode=p48(Re.mid,ve),De};m39(0,we,0)}}intersectRayTriangleRange(fe,ve){if(fe>=ve)return;const _e=this.positions;g$1e(this._rayFrom,this._rayDirection,fe,ve,this.globalTriangleVertexIndices,_e.data,_e.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),f19.numFacesTested+=ve-fe}intersectRay(fe,ve,_e,be){f19.numFacesTested=0;const we=fe,Se=ve,Te=Se[0]-we[0],Ee=Se[1]-we[1],Ce=Se[2]-we[2];if(Te*Te+Ee*Ee+Ce*Ce<jpe)return;this._rayFrom=we;const Oe=this._rayDirection;Oe[0]=Te,Oe[1]=Ee,Oe[2]=Ce;const Re=this.triangleIndexMap.length;this._callback=be,this._intersectionOptions=_e,this.intersectRayBSP(this.bspNodeTree[0],0,Re),this._callback=R$g,this._intersectionOptions=Xpe}intersectRayBSP(fe,ve,_e){const be=this._rayFrom,we=this._rayDirection;if(!function l$12(fe,ve,_e){const be=ve,we=_e;let Se=0,Te=1/0;for(let Ee=0;Ee<3;++Ee){{const ve=fe[Ee];if(be[Ee]<ve){if(we[Ee]<=jpe)return!1;const fe=(ve-be[Ee])/we[Ee];Se=Math.max(Se,fe)}else if(we[Ee]<=-jpe){const fe=(ve-be[Ee])/we[Ee];Te=Math.min(Te,fe)}if(Se>Te)return!1}{const ve=fe[Ee+3];if(be[Ee]>ve){if(we[Ee]>=-jpe)return!1;const fe=(ve-be[Ee])/we[Ee];Se=Math.max(Se,fe)}else if(we[Ee]>=jpe){const fe=(ve-be[Ee])/we[Ee];Te=Math.min(Te,fe)}if(Se>Te)return!1}}return!0}(fe.aabb,be,we))return;const Se=fe.axis,Te=fe.d;if(be[Se]<Te||we[Se]<0){const _e=ve,be=fe.midStartIndex;if(_e<be){const ve=fe.leftNode;void 0!==ve?this.intersectRayBSP(ve,_e,be):this.intersectRayTriangleRange(_e,be)}}if(this.intersectRayTriangleRange(fe.midStartIndex,fe.rightStartIndex),be[Se]>Te||we[Se]>0){const ve=fe.rightStartIndex,be=_e;if(ve<be){const _e=fe.rightNode;void 0!==_e?this.intersectRayBSP(_e,ve,be):this.intersectRayTriangleRange(ve,be)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};Hpe.numFacesTested=0;const qpe=[1/0,1/0,1/0],Wpe=[-1/0,-1/0,-1/0];const Ype=255,Zpe=65535,Xpe=new CH,R$g=()=>{};let Jpe=class d26 extends GI{constructor(){super(...arguments),this.output=NI.Color,this.overlayMode=bY.Disabled,this.tileBlendInput=Zhe.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=yM.Simplified}};e$4o([r$2w({count:NI.COUNT})],Jpe.prototype,"output",void 0),e$4o([r$2w({count:bY.COUNT})],Jpe.prototype,"overlayMode",void 0),e$4o([r$2w({count:Zhe.COUNT})],Jpe.prototype,"tileBlendInput",void 0),e$4o([r$2w()],Jpe.prototype,"spherical",void 0),e$4o([r$2w()],Jpe.prototype,"doublePrecisionRequiresObfuscation",void 0),e$4o([r$2w()],Jpe.prototype,"receiveShadows",void 0),e$4o([r$2w()],Jpe.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],Jpe.prototype,"backfaceCullingEnabled",void 0),e$4o([r$2w()],Jpe.prototype,"textureFadingEnabled",void 0),e$4o([r$2w()],Jpe.prototype,"renderOccluded",void 0),e$4o([r$2w()],Jpe.prototype,"hasScreenSpaceReflections",void 0),e$4o([r$2w()],Jpe.prototype,"hasCloudsReflections",void 0),e$4o([r$2w()],Jpe.prototype,"invisible",void 0),e$4o([r$2w()],Jpe.prototype,"opaque",void 0),e$4o([r$2w()],Jpe.prototype,"tileBorders",void 0),e$4o([r$2w()],Jpe.prototype,"visualizeNormals",void 0),e$4o([r$2w()],Jpe.prototype,"screenSizePerspective",void 0),e$4o([r$2w()],Jpe.prototype,"receiveAmbientOcclusion",void 0),e$4o([r$2w({count:yM.COUNT})],Jpe.prototype,"pbrMode",void 0),e$4o([r$2w({constValue:wH.Compressed})],Jpe.prototype,"normalType",void 0),e$4o([r$2w({constValue:sO.Compressed})],Jpe.prototype,"textureCoordinateType",void 0),e$4o([r$2w({constValue:!1})],Jpe.prototype,"highStepCount",void 0),e$4o([r$2w({constValue:!1})],Jpe.prototype,"useCustomDTRExponentForWater",void 0),e$4o([r$2w({constValue:!1})],Jpe.prototype,"useFillLights",void 0),e$4o([r$2w({constValue:!0})],Jpe.prototype,"hasColorTexture",void 0);const Qpe=i$3t();var Kpe;!function(fe){fe[fe.Opaque=0]="Opaque",fe[fe.Semitransparent=1]="Semitransparent",fe[fe.TransparentWithDraped=2]="TransparentWithDraped",fe[fe.Empty=3]="Empty"}(Kpe||(Kpe={}));let efe=class de extends AN{get _isGlobal(){return this._stage.viewingMode===Wf.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(fe,ve,_e,be,we){super({}),this._overlayRenderer=fe,this._stage=ve,this._allTiles=_e,this._ellipsoidRadius=be,this.type=Zf.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Jpe,this._passParameters=new tde,this._drawParameters=new KX,this._renderDataPool=new pr(ade),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Ohe,this._transparencyState=Kpe.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=ej.Occlude,this.produces=new Map([[qR.OPAQUE_TERRAIN,()=>this._produces()],[qR.TRANSPARENT_TERRAIN,()=>this._produces()],[qR.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new hJ(((fe,ve)=>we.newCache(fe,ve)),"TileTexture"),this.tileGeometryCache=new Gde(we)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(d$3d((()=>this._overlayRenderer.rendersOccludedDraped),(fe=>{this.renderOccludedFlags=fe?FJ:ej.Occlude,this.setNeedsRender()}),Za))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?PN:EN}set renderingDisabled(fe){this._set("renderingDisabled",!!fe),this.setDirty()}set visible(fe){this._set("visible",!!fe),this.setDirty()}updateHeading(fe){var ve;null==(ve=this._tileRenderer)||ve.updateHeading(fe)}set transparency(fe){this._transparencyState!==fe&&(this._techniqueConfiguration.invisible=fe===Kpe.TransparentWithDraped||fe===Kpe.Empty,this._techniqueConfiguration.opaque=fe===Kpe.Opaque,this._transparencyState=fe,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(fe){this._techniqueConfiguration.tileBorders!==fe&&(this._techniqueConfiguration.tileBorders=fe,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(fe){this._techniqueConfiguration.visualizeNormals!==fe&&(this._techniqueConfiguration.visualizeNormals=fe,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(fe){this._techniqueConfiguration.backfaceCullingEnabled!==fe&&(this._techniqueConfiguration.backfaceCullingEnabled=fe,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(fe){this._set("renderOrder",fe),this._setSortingDirty()}get layerUid(){return Ny}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(fe){this._techniqueConfiguration.hasSlicePlane!==fe&&(this._techniqueConfiguration.hasSlicePlane=fe,this.setNeedsRender())}set textureFadingEnabled(fe){this._techniqueConfiguration.textureFadingEnabled!==fe&&(this._techniqueConfiguration.textureFadingEnabled=fe,this.setNeedsRender())}set pbrMode(fe){this._techniqueConfiguration.pbrMode!==fe&&(this._techniqueConfiguration.pbrMode=fe,this.setNeedsRender())}setDebugScreenSizePerspective(fe){this._techniqueConfiguration.screenSizePerspective!==fe&&(this._techniqueConfiguration.screenSizePerspective=fe,this.setNeedsRender())}setRootTiles(fe){this._rootTiles=fe,this.setDirty()}setStencilEnabledLayerExtents(fe){this._stencilEnabledLayerExtents=fe,this._setSortingDirty()}setTileSize(fe){this._tileSize=fe,null!=this._tileRenderer&&(this._tileRenderer.tileSize=fe),this.setDirty()}_prepareTileForLoading(fe){fe.renderData||(fe.renderData=this._renderDataPool.acquire(),fe.renderData.init(fe,this._getLocalOriginOfTile(fe)))}loadTile(fe){this._prepareTileForLoading(fe),this.updateTileGeometryState(fe),this.updateTileTexture(fe,zhe.TEXTURE_FADING)}updateTileTexture(fe,ve){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(fe,ve===zhe.TEXTURE_FADING?aY.FADING:aY.UNFADED),this.setNeedsRender(),fe.resetPendingUpdate(ve))}updateTileGeometryState(fe){for(const _e of fe.layerInfo[Wle.ELEVATION])_e.pendingUpdates&=~zhe.GEOMETRY;fe.resetPendingUpdate(zhe.GEOMETRY);const ve=fe.renderData.updateGeometryState();return ve&&this.setDirty(),ve}updateGeometryIfNeeded(fe){fe.isLoaded&&fe.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(fe){const ve=fe.renderData;ve&&(ve.releaseGeometry(),this._renderDataPool.release(ve),ve.clear(),fe.renderData=null,fe.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(fe){const ve=Math.max(0,7*Math.floor((fe.level-3)/7));if(this._isGlobal&&0===ve)return Bi;for(;fe.parent&&fe.level>ve;)fe=fe.parent;return fe.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(fe){this._get("wireframe")!==fe&&(this._set("wireframe",fe),this.setNeedsRender())}setDirty(fe=$A.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(fe)}_setSortingDirty(fe=$A.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(fe)}setNeedsRender(fe=$A.UPDATE){this._context.requestRender(fe)}initializeRenderContext(fe){this._context=fe,this._tileRenderer=new Fpe(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=a$2U(this._rctx)}uninitializeRenderContext(){this._emptyTex=r$3M(this._emptyTex),this._tileRenderer=r$3M(this._tileRenderer)}intersect(fe,ve,_e,be){if(!this._rootTiles||fe.options.selectOpaqueTerrainOnly&&fe.options.selectionMode&&this.transparency!==Kpe.Opaque)return;const we=tfe,Se=rfe;e$3Z(we,be,_e),o$44(Se,1/we[0],1/we[1],1/we[2]);const Te=fe.results.min,Ee=fe.results.max,Ce=fe.results.ground,Oe=fe.options.store===Xf.MIN,Re=!!fe.results.ground.target,De=function I$1n(fe){return null!=fe?(Dy.offset=fe,Dy):null}(fe.verticalOffset),Be=fe.tolerance;let Ze,Xe=Oe&&null!=Te.dist?Te.dist:1/0;const Je=fe.options,Qe=Je.normalRequired||!Je.backfacesTerrain,dt=new CH(!1,Qe),x16=Re=>{const $t=Re.renderData;if(!(null==$t?void 0:$t.vao))return;const bt=$t.geometry;O$16(Qpe,bt.boundingBox);const wt=$t.localOrigin;null!=De&&(De.localOrigin=wt,De.applyToAabb(Qpe));const xt=Qpe;if(ife[0]=_e[0]-wt[0],ife[1]=_e[1]-wt[1],ife[2]=_e[2]-wt[2],!w$13(xt,ife,Se,Be,Xe))return;const w9=(fe,ve,_e)=>{fe.set(this.type,Re,ve,_e,dd),Xe=Oe&&null!=Te.dist?Te.dist:1/0},S14=(Se,Oe,Re)=>{if((!Qe||null!=Re)&&Se>=0&&(Je.backfacesTerrain||P$1g(Re,we)<0)&&(Je.invisibleTerrain||!Je.selectionMode||null==ve||ve(_e,be,Se))){if((null==Ce.dist||Se<Ce.dist)&&w9(Ce,Se,Re),Je.isFiltered)return;Je.store===Xf.ALL&&(null==Ze?(Ze=G$I(fe.ray),w9(Ze,Se,Re),fe.results.all.push(Ze)):Se<Ze.dist&&w9(Ze,Se,Re)),(null==Te.dist||Se<Te.dist)&&w9(Te,Se,Re),Je.store!==Xf.MIN&&(null==Ee.dist||Se>Ee.dist)&&w9(Ee,Se,Re)}},St=nfe;e$3Z(St,be,wt);const{indices:Et,indexCount:Pt}=bt,Ot=bt.vertexAttributes,At=Ot.getField(nO.POSITION,uL),Mt=new Cm(At.typedBuffer,3,Ot.stride/4),Rt=Pt/3;if(!De&&Rt>200){const fe=Re.renderData;null==fe.intersectionData&&(fe.intersectionData=new Hpe(Et,0,Rt,Mt)),fe.intersectionData.intersectRay(ife,St,dt,S14)}else x$Q(ife,St,0,Rt,Et,Mt,De,dt,S14)},$t=this._rootTiles;null!=$t&&(()=>{const ve=this._tileIterator;ve.reset($t);const be=fe.options.invisibleTerrain;for(let fe=ve.next();fe;fe=ve.next())!(fe.visible||be&&fe.intersectsClippingArea)||null==De&&!fe.intersectsRay(_e,we,Be,Xe)||Re&&this._useStencilForTile(fe)?ve.skipSubtree():x16(fe)})()}processScaleRangeQueries(fe,ve){var _e;if(!ve.done)for(this._updatePatchGroups();fe.updating&&!ve.done;){fe.prepare();for(const ve of this._visiblePatchesByOrigin.values())for(const be of ve)null!=(null==(_e=be.renderData)?void 0:_e.textureReference)&&fe.queriesForTile(be);fe.process(),ve.madeProgress()}}prepareTechnique(fe){const ve=has("enable-feature:terrain-shadows")&&fe.bindParameters.shadowMap.enabled;ve!==this._castShadows&&(this._castShadows=ve,this._patchesByOriginDirty=!0);const _e=fe.bindParameters.viewshedEnabled;if(this._inViewshed!==_e&&(this._inViewshed=_e,this._patchesByOriginDirty=!0),fe.bindParameters.slot===qR.OCCLUDED_TERRAIN){if(!(fe.renderOccludedMask&FJ))return null}else{const ve=this.transparency===Kpe.Opaque?qR.OPAQUE_TERRAIN:qR.TRANSPARENT_TERRAIN;if(fe.bindParameters.slot!==ve)return null}if(this.transparency===Kpe.Empty)return null;switch(fe.output){case NI.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=null!=fe.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=fe.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=fe.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=fe.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(NI.Color,fe.bindParameters.slot===qR.OCCLUDED_TERRAIN);case NI.Shadow:case NI.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(NI.Shadow,!1)):null;case NI.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(NI.ViewshedShadow,!1)):null;case NI.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(NI.Depth,!1);case NI.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(NI.Normal,!1);case NI.ObjectAndLayerIdColor:return this._updateTechnique(NI.ObjectAndLayerIdColor,!1);case NI.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(NI.Highlight,!1)):null}return null}renderNode(fe,ve){switch(this._updatePatchGroups(),ve.useStencil=!1,fe.output){case NI.Color:{const _e=fe.bindParameters.slot===qR.OCCLUDED_TERRAIN?hY.Occluded:hY.Color;this._renderMaterialPass(fe,ve,_e);break}case NI.Depth:case NI.Normal:this._renderAuxiliaryPass(fe,ve,hY.Color,this._visiblePatchesByOrigin);break;case NI.Highlight:this._renderAuxiliaryPass(fe,ve,hY.Highlight,this._visiblePatchesByOrigin);break;case NI.Shadow:case NI.ShadowExcludeHighlight:case NI.ViewshedShadow:this._renderAuxiliaryPass(fe,ve,null,this._allPatchesByOrigin);break;case NI.ObjectAndLayerIdColor:this._renderAuxiliaryPass(fe,ve,hY.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(fe){if(null==this._tileRenderer)return;const ve=this._tileRenderer;let _e;if(null!=fe){const ve=b_.toUnitRGBA(fe);_e=r$3y(ve[0]||0,ve[1]||0,ve[2]||0)}ve.setBackground(_e),this._allTiles.forAll((fe=>ve.updateTileTexture(fe,aY.FADING))),this._techniqueConfiguration.tileBlendInput=ve.backgroundIsGrid?Zhe.GridComposite:null!=ve.backgroundColor?Zhe.ColorComposite:Zhe.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==Che.NONE){const fe=Array.from(this._visiblePatchesByOrigin.values()),ve=this._stencilEnabledLayerExtents;for(const _e of fe)l$1e(this.renderOrder,_e,ve);fe.sort(((fe,ve)=>h$B(fe[0],ve[0],this.renderOrder))),this._visiblePatchesByOrigin=new Map(fe.map((fe=>[fe[0].renderData.localOrigin,fe]))),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var fe;const ve=this._rootTiles;if(null!=ve){null==(fe=ve[0])||fe.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const fe of ve)this._rebuildPatchGroupsForRootTile(fe)}}_rebuildPatchGroupsForRootTile(fe){const ve=this._tileIterator;for(ve.resetOne(fe);!ve.done;){const fe=ve.next(),_e=fe.renderData;if(!_e){this._numTilesCulled++;continue}const be=_e.localOrigin;if(this._castShadows||this._inViewshed){let ve=this._allPatchesByOrigin.get(be);ve||(ve=[],this._allPatchesByOrigin.set(be,ve)),ve.push(fe)}if(!fe.visible){this._numTilesCulled++,ve.skipSubtree();continue}let we=this._visiblePatchesByOrigin.get(be);we||(we=[],this._visiblePatchesByOrigin.set(be,we)),we.push(fe),ve.skipSubtree()}}_useStencilForTile(fe){for(const ve of this._stencilEnabledLayerExtents)if(fe.intersectsExtent(ve))return!0;return!1}_renderAuxiliaryPass(fe,ve,_e,be){const we=fe.rctx;this._passParameters.overlayContent=_e,we.bindTechnique(ve,fe.bindParameters,this._passParameters);const Se=this._stencilEnabledLayerExtents.length>0;be.forEach((be=>{this._drawParameters.origin=be[0].renderData.localOrigin,ve.program.bindDraw(this._drawParameters,fe.bindParameters,this._passParameters);for(let we=0;we<be.length;we++)this._renderPatch(fe,ve,be[we],NO.TRIANGLES,Se,_e)})),fe.rctx.bindVAO(null)}_renderMaterialPass(fe,ve,_e){var be;const{rctx:we}=fe;this._passParameters.overlayContent=_e,we.bindTechnique(ve,fe.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const Se=fe.bindParameters.camera,Te=ve.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const fe=n$2C(this._stage.viewingMode,this._ellipsoidRadius),ve=this.pointsOfInterest.centerOnSurfaceFrequent.distance;fe.update({distance:ve,fovY:Se.fovY})}const Ee=this._stencilEnabledLayerExtents.length>0,Ce=_e===hY.Occluded;Ce&&(Te.bindTexture("tex",this._emptyTex),Te.setUniform3fv("textureOpacities",Bi),Te.setUniform4fv("texOffsetAndScale",_d));const Oe=null!=(null==(be=this._tileRenderer)?void 0:be.backgroundColor)?this._tileRenderer.backgroundColor:Bi;this._techniqueConfiguration.tileBlendInput===Zhe.ColorComposite&&Te.setUniform3fv("backgroundColor",Oe);const Re=this.wireframe?NO.LINES:NO.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&Te.bindTexture("texNext",this._emptyTex);const De=this._visiblePatchesByOrigin;for(const Be of De.values()){const be=Be[0].renderData.localOrigin;ve.program.bindDraw(new KX(be),fe.bindParameters,this._passParameters),this._numOriginsRendered++;for(const we of Be){const be=we.renderData,Se=be.textureReference;if(null!=Se){if(!Ce){Te.setUniform4fv("texOffsetAndScale",Se.offsetAndScale),Te.bindTexture("tex",Se.texture.texture);const fe=be.textureFadeFactor,ve=fe<1?be.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&null!=ve&&fe<1?(Te.setUniform1f("fadeFactor",fe),Te.setUniform4fv("nextTexOffsetAndScale",ve.offsetAndScale),Te.setUniform3fv("nextTexOpacities",ve.opacities),Te.bindTexture("texNext",ve.texture.texture)):Te.setUniform1f("fadeFactor",1),be.textureIsFading&&this.setNeedsRender(),Te.setUniform3fv("textureOpacities",Se.opacities)}this._renderPatch(fe,ve,we,Re,Ee,_e),we.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}fe.rctx.bindVAO(null)}_renderPatch(fe,ve,_e,be,we,Se){const Te=_e.renderData,Ee=Te.vao,Ce=null==Ee?void 0:Ee.indexBuffer;if(!Ee||null==Ce)return;const Oe=ve.program;null==Se||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(Oe,Te.overlay),we&&(ve.useStencil=this._useStencilForTile(_e),fe.rctx.setPipelineState(ve.getPipeline()));const Re=Te.geometry.indexCount;fe.rctx.bindVAO(Ee),Oe.assertCompatibleVertexAttributeLocations(Ee),fe.rctx.drawElements(be,Re,Ce.indexType,0)}_bindOverlayPatchData(fe,ve){fe.setUniform4fv("overlayTexOffset",ve.offsets),fe.setUniform4fv("overlayTexScale",ve.scales)}_updateTechnique(fe,ve){return this._techniqueConfiguration.output=fe,this._techniqueConfiguration.renderOccluded=ve,this._shaderTechnique=this._techniques.releaseAndAcquire(sde,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};e$4o([y$2v({readOnly:!0})],efe.prototype,"_isGlobal",null),e$4o([y$2v()],efe.prototype,"renderOccludedFlags",void 0),e$4o([y$2v({value:!1})],efe.prototype,"renderingDisabled",null),e$4o([y$2v({value:!0})],efe.prototype,"visible",null),e$4o([y$2v()],efe.prototype,"renderPatchBorders",null),e$4o([y$2v()],efe.prototype,"visualizeNormals",null),e$4o([y$2v()],efe.prototype,"cullBackFaces",null),e$4o([y$2v({value:Che.FRONT_TO_BACK})],efe.prototype,"renderOrder",null),e$4o([y$2v()],efe.prototype,"wireframe",null),efe=e$4o([a$4y("esri.views.3d.terrain.TerrainRenderer")],efe);const tfe=[0,0,0],rfe=[0,0,0],ife=[0,0,0],nfe=[0,0,0];let sfe=class e57{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},ofe=class m25 extends zi{constructor(fe){super(fe)}initialize(){this.addHandles([this.layers.on("change",(()=>this._update())),d$3d((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let fe;if(this.layers.some((ve=>!(!y$1_(ve)||ve.isRejected()||ve.isFulfilled()&&!function u$R(fe,ve,_e){return null!=k$f(fe,ve,_e)}(ve,this.viewSpatialReference,this.viewingMode)||(fe=ve,"vector-tile"===(null==ve?void 0:ve.type)||_$n(ve))))),fe)if(fe.isResolved()){const ve=k$f(fe,this.viewSpatialReference,this.viewingMode);if(null!=ve){const fe=new Bg(ve.tileInfo);this._lockTilingScheme(fe)}}else this._updateWhen(fe)}_updateWhen(fe){const ve=fe.when().catch((()=>{})).then((()=>{ve!==this._waitTask||this.destroyed||this._update()}));this._waitTask=ve}_lockTilingScheme(fe){if(this.viewingMode===Wf.Global){const ve=fe.levels.length-1,_e=fe.spatialReference;_e.isWebMercator?fe=Bg.makeWebMercatorAuxiliarySphere(ve):i$1a(_e)&&(fe=Bg.makeGCSWithTileSize(fe.spatialReference,fe.pixelSize,ve))}this.tilingSchemeLocked=!0,this.tilingScheme=fe,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(d$3d((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Wf.Global){const fe=this.extentHelper.viewSpatialReference;fe.isWebMercator?this.tilingScheme=Bg.WebMercatorAuxiliarySphere:o$O(fe)&&(this.tilingScheme=Bg.makeGCSWithTileSize(fe,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const fe=this.extentHelper.layerViewsExtent;null==fe||I$1y(fe,this.extent)||(this.tilingScheme=Bg.fromExtent(fe,this.extentHelper.viewSpatialReference),this._set("extent",fe))}}get test(){}};e$4o([y$2v()],ofe.prototype,"tilingScheme",void 0),e$4o([y$2v({readOnly:!0})],ofe.prototype,"extent",void 0),e$4o([y$2v({value:!1})],ofe.prototype,"tilingSchemeLocked",void 0),e$4o([y$2v({constructOnly:!0})],ofe.prototype,"viewSpatialReference",void 0),e$4o([y$2v({constructOnly:!0})],ofe.prototype,"layers",void 0),e$4o([y$2v({constructOnly:!0})],ofe.prototype,"extentHelper",void 0),e$4o([y$2v({constructOnly:!0})],ofe.prototype,"viewingMode",void 0),ofe=e$4o([a$4y("esri.views.3d.terrain.TilingSchemeLogic")],ofe);let afe=class t70{constructor(){this.offset=[0,0],this.scale=0,this.tile=null}init(fe,ve,_e,be){this.tile=fe,this.offset[0]=ve,this.offset[1]=_e,this.scale=be}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var lfe;let cfe=lfe=class extends(La.EventedMixin(zi)){constructor(fe){var ve,_e,be;super(fe),this._scaleRangeQueries=new Nde,this._iteratorPool=new pr(Ohe,(fe=>fe.remove=()=>this._iteratorPool.release(fe))),this._postorderIterator=new Ahe,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new sfe,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=[0,0,0],this._eyePosSurfaceSR=[0,0,0],this._splitLimits=new Bde,this._frustum=H$M(),this._viewProjectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Up,this._frameTask=xI,this._allTiles=new jr,this._upsampleInfoPool=new pr(afe),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=u$3J(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=zo.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new que(1/0,-1/0),this.rootTileElevationBounds=new que(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=Cn(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new mhe({...fe,surface:this}),this._isGlobal=!(null==(_e=null==(ve=fe.view)?void 0:ve.state)?void 0:_e.isLocal),this._isGeographic=(null==(be=this._spatialReference)?void 0:be.isGeographic)??!1,this._tileConstructor=this._isGlobal?Fde:Ide}initialize(){const fe=this.view,ve=fe.resourceController,_e=ve.memoryController;this._tileCache=new hJ(((fe,ve)=>_e.newCache(fe,ve)),"terrain-tile"),this._upsampleMapCache=_e.newCache("terrain-upsample",(fe=>fe.unloadMapData())),this._elevationQueryCache=new cue(_e.newCache("elevation-query"));const be=this.overlayManager;this._renderer=new efe(be.renderer,fe._stage,this._allTiles,s$45(fe.spatialReference).radius,_e),this.addHandles([d$3d((()=>be.renderer.isEmpty),(()=>this._evaluateTransparency())),d$3d((()=>this.renderer.visible),(fe=>this.suspended=!fe)),d$3d((()=>this.heading),(fe=>{this._renderer.updateHeading(fe),this._updateTileTextures(aY.FADING)})),d$3d((()=>{var ve,_e;return{heading:null==(ve=fe.camera)?void 0:ve.heading,state:null==(_e=fe.state)?void 0:_e.mode}}),(({heading:fe,state:ve})=>{if(null==fe)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(fe/90)%360);const _e=Math.round(fe)%360,be=Math.abs(_e-this.heading);(ve===PM.IDLE||Math.min(be,360-be)>=30)&&(this.heading=_e)}))],"overlayManager"),this.addHandles([d$3d((()=>this.baseOpacity),(()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?aY.UNFADED:aY.IMMEDIATE)}),Ja),d$3d((()=>this.hasCompositeBlendMode),(()=>this._updateTileTextures(this._evaluateTransparency()?aY.UNFADED:aY.IMMEDIATE)),Ja),d$3d((()=>this.backgroundColor),((fe,ve)=>{(null==fe?void 0:fe.equals(ve))||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(fe))}),Za),d$3d((()=>this.snapLevel),(()=>this._viewChanged=!0),Za),d$3d((()=>this.view.pointsOfInterest),(fe=>{this._renderer.pointsOfInterest=fe,this._watchUpdatingTracking.removeAll(),fe&&this._watchUpdatingTracking.add((()=>fe.focus.renderLocation),(()=>this._allTilesSorted=!1))})),d$3d((()=>_B.TERRAIN_TILE_TREE_SHOW_TILES),(ve=>{ve&&!this._treeDebugger?zt((()=>import("./TerrainTileTree3DDebugger-B78FfYtA.js")),__vite__mapDeps([192,193])).then((({TerrainTileTree3DDebugger:ve})=>{!this._treeDebugger&&_B.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new ve({view:fe}))})):ve||(this._treeDebugger=u$4d(this._treeDebugger))}),Xa)]);const{spatialReference:we}=fe;this._extentHelper=function h$C(fe,ve){return fe===Wf.Global?new hhe(ve):new dhe(ve)}(this.viewingMode,{layers:fe.map.allLayers,layerViews:fe.allLayerViews,viewSpatialReference:we});const Se=new C_({getCollections:()=>{var ve,_e;return null==(_e=null==(ve=fe.defaultsFromMap)?void 0:ve.mapCollections)?void 0:_e.map((({layers:fe})=>fe))},getChildrenFunction:fe=>fe&&"layers"in fe?fe.layers:null}),Te=new ofe({layers:Se,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:we});this._set("tilingSchemeLogic",Te),this._updateTilingScheme(),this._elevationDataRequester=ve.createStreamDataRequester(sce.ELEVATION),this._mapDataRequester=ve.createStreamDataRequester(sce.BASEMAP);const Ee=ve.scheduler;this._frameTask=Ee.registerTask(gI.TERRAIN_SURFACE,this),this.addHandles([d$3d((()=>this._extentHelper.stencilEnabledExtents),(fe=>this._renderer.setStencilEnabledLayerExtents(fe)),Xa),d$3d((()=>this.tilingSchemeLogic.tilingScheme),(()=>this._updateTilingScheme()),Za),d$3d((()=>this.extent),(()=>this._updateRootTiles()),Xa),fe.on("resize",(()=>this._viewChangeUpdate())),d$3d((()=>{const ve=fe.state;return[this._lodBias,this.lodSnapping,fe.quality,ve.camera,ve.contentCamera,ve.fixedContentCamera]}),(()=>this._viewChangeUpdate()),Ja),d$3d((()=>{var ve;return null==(ve=fe.qualitySettings)?void 0:ve.fadeDuration}),(fe=>this._renderer.textureFadingEnabled=fe>0),Xa),d$3d((()=>{var ve;return null==(ve=fe.qualitySettings)?void 0:ve.physicallyBasedRenderingEnabled}),(fe=>this._renderer.pbrMode=fe?yM.Simplified:yM.Disabled),Xa),d$3d((()=>{var ve;return null==(ve=fe.qualitySettings)?void 0:ve.tiledSurface.elevationLevelDelta}),(()=>this._updateAllTileGeometries())),d$3d((()=>this._userClippingExtent),(()=>this._updateClippingExtent()),Za)]),this.addHandles(fe.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",u$4d(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach(((fe,ve)=>this._unregisterTiledLayerView(ve))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",u$4d(this.overlayManager)),this._tileCache=u$4d(this._tileCache),khe.prune(),this._treeDebugger=u$4d(this._treeDebugger),this._renderer=u$4d(this._renderer),this._iteratorPool=u$4d(this._iteratorPool),this._upsampleMapCache=u$4d(this._upsampleMapCache),this._elevationQueryCache=u$4d(this._elevationQueryCache),this._set("view",null),this._extentHelper=u$4d(this._extentHelper),this._upsampleInfoPool=u$4d(this._upsampleInfoPool),function u$Y(){Bue.forEach(((fe,ve)=>{fe[0].forEach((fe=>{})),fe[1].forEach((fe=>{}))}))}(),function r$I(){Fhe.size>0&&Fhe.forEach((fe=>{}))}()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===oY.ON){const fe=this.view,ve=this.tilingScheme,_e=fe.terrainScale;if(ve&&_e){const be=ve.levelAtScale(_e)+fe.qualitySettings.tiledSurface.lodBias,we=ve.getMaxLod();return Math.min(be,we||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?oY.ON:oY.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:fe}=this,{clippingArea:ve}=this.view;if(null==ve||null==fe)return null;const _e=u$3J(),be=u$13(ve,_e,fe)?_e:null,we=this._get("extent");return I$1y(be,we)?we:be}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const fe=U$17(this.groundExtent,this._userClippingExtent,u$3J()),ve=this._get("extent");return I$1y(fe,ve)?ve:fe}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var fe;return null==(fe=this.tilingSchemeLogic)?void 0:fe.extent}get updating(){var fe,ve;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(null==(fe=this._watchUpdatingTracking)?void 0:fe.updating)||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(null==(ve=this.overlayManager)?void 0:ve.updating))}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var fe,ve,_e;return(null==(_e=null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.ground)?void 0:_e.opacity)??1}set baseOpacity(fe){this.view.map.ground.opacity=fe}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(fe){this._renderer.renderOrder=fe,this._set("renderOrder",fe)}get rootTiles(){return this._rootTiles}get spatialReference(){var fe;return(null==(fe=this.tilingScheme)?void 0:fe.spatialReference)??null}get backgroundColor(){var fe,ve,_e;return null==(_e=null==(ve=null==(fe=this.view)?void 0:fe.map)?void 0:ve.ground)?void 0:_e.surfaceColor}set backgroundColor(fe){this.view.map.ground.surfaceColor=fe}set slicePlaneEnabled(fe){this._renderer.slicePlaneEnabled=fe,this._set("slicePlaneEnabled",fe),this._evaluateTransparency()}get tilingSchemeLocked(){var fe;return(null==(fe=this.tilingSchemeLogic)?void 0:fe.tilingSchemeLocked)??!1}get wireframe(){var fe;return null==(fe=this._renderer)?void 0:fe.wireframe}set wireframe(fe){fe!==this._renderer.wireframe&&(this._renderer.wireframe=fe,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===Kpe.Opaque}set suspended(fe){this._set("suspended",fe),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(fe,ve,_e,be){this._renderer.intersect(fe,ve,_e,be)}getElevationLevelDelta(fe){return fe<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(fe,ve,_e,be){const we=this._rootTiles;if(!(null==we?void 0:we.length))return null;if(0===we[0].layerInfo[Wle.ELEVATION].length)return null;let Se=this._elevationProjectorCache.get(be);if(void 0===Se&&(Se=G$S(be,this._spatialReference)??null,this._elevationProjectorCache.set(be,Se)),null==Se)return ar.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const Te=o$44(hfe,fe,ve,_e);return Se(Te,0,Te,0),ct$1(we,Te[0],Te[1])}getElevations(fe,ve,_e){const be=this._rootTiles,we=be?be[0].layerInfo[Wle.ELEVATION].length:0;if((null==be?void 0:be.length)&&0!==we)for(let Se=0;Se<ve;++Se){const ve=3*Se;_e(Se,ct$1(be,fe[ve],fe[ve+1]))}else for(let Se=0;Se<ve;++Se)_e(Se,null)}getScale(fe){if(!this.tilingScheme)return null;if(!c$4l(fe,hfe,this.spatialReference))return ar.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const ve=this._rootTiles;if(null!=ve)for(const _e of ve)if(null==_e?void 0:_e.containsPoint(hfe)){let fe=_e;for(;fe.children[0]&&!fe.rendered;){const ve=fe.children[0].extent;let _e=0;hfe[0]>ve[2]&&(_e+=1),hfe[1]<ve[1]&&(_e+=2),fe=fe.children[_e]}return this._getLodBiasCorrectedScale(fe.level)}return 1/0}_ensureSEBProject(fe){const ve=this._sebProjectorMap.get(fe);if(ve)return ve;const _e=G$S(fe,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(fe,_e),_e}getSphereElevationBounds(fe,ve){const _e=this._ensureSEBProject(ve);if(null==_e)return ar.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;T$1d(fe,dfe);_e(dfe,0,dfe,0);const be=new Ile,we=this._rootTiles;if(null!=we){const fe=[];for(const _e of we)fe.push(_e);let ve=0;for(;ve<fe.length;){const _e=fe[ve];if(++ve,!g$2o(_e.extent,dfe))continue;const we=_e.children;if(null==we[0]||_e.rendered)be.expandElevationRangeValues(_e.elevationBoundsMin,_e.elevationBoundsMax);else for(const ve of we)fe.push(ve)}}return be}getRootElevationBounds(){return new Ile(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(fe,ve){if(!this.tilingScheme)return null;if(!c$4l(fe,dfe,this.spatialReference))return ar.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;dfe[3]=ve;let _e=null;const r65=fe=>{if(fe&&g$2o(fe.extent,dfe)){const ve=fe.children;if(ve[0]&&!fe.rendered)for(const fe of ve)r65(fe);else{const ve=this._getLodBiasCorrectedScale(fe.level);_e=null==_e?ve:Math.min(_e,ve)}}},be=this._rootTiles;if(null!=be)for(const we of be)r65(we);return _e}queryVisibleScaleRange(fe,ve,_e,be){const we=ve?this.tilingScheme.levelAtScale(ve):0,Se=_e?this.tilingScheme.levelAtScale(_e):1/0,Te=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(fe,we+Te,Se+Te,be)}_evaluateTransparency(){var fe,ve;const _e=this.baseOpacity,be=this.overlayManager.renderer.isEmpty,we=this._renderer.transparency,Se=this._allSurfaceLayersTransparent()?be?Kpe.Empty:Kpe.TransparentWithDraped:_e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Kpe.Opaque:Kpe.Semitransparent,Te=we!==Se;return Te&&(this._renderer.transparency=Se,null==(ve=null==(fe=this.view)?void 0:fe._stage)||ve.renderer.setParameters({terrainTransparency:this._renderer.transparency})),Te}_updateTilingScheme(){var fe,ve,_e,be;const we=this.tilingSchemeLogic.tilingScheme;if(we===this.tilingScheme)return;this._isGlobal=!(null==(ve=null==(fe=this.view)?void 0:fe.state)?void 0:ve.isLocal),this.tilingScheme&&this._removeAllTiles();const Se=(null==we?void 0:we.spatialReference)??zo.WebMercator;this._spatialReference=Se,this._isWebMercator=!!(null==Se?void 0:Se.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&O$1s(null==(_e=this.view)?void 0:_e.renderSpatialReference),this._isGeographic=(null==Se?void 0:Se.isGeographic)??!1,this._set("tilingScheme",we),this._tilingSchemeSpatialReference=null==(be=this.tilingScheme)?void 0:be.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),we&&(this._updateTiledLayers(),this._renderer.setTileSize(we.pixelSize),this.overlayManager.setSpatialReference(we.spatialReference),this._updateRootTiles())}_acquireTile(fe,ve,_e,be){const we=this._tileCache.pop(lfe._tileMemcacheKey);return we?(we.init(fe,ve,_e,be,this),we):new this._tileConstructor(fe,ve,_e,be,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:fe,tilingScheme:ve}=this;if(!ve)return;const _e=pfe;let be=ve.rootTilesInExtent(fe,_e,5*Gg);if(null!=this._rootTiles){if(be.length>Gg)return void ar.getLogger(this).warn("Cannot extend surface to encompass all layers because it would result in too many root tiles.");const fe=g$2J(this._rootTiles.map((fe=>fe.lij)),be,ue$3);if(this._updatingRootTiles=!0,fe.removed.length>0||fe.added.length>0){const ve=this._rootTiles.filter((ve=>!(fe.removed.findIndex((fe=>ue$3(fe,ve.lij)))>-1&&(this._purgeTile(ve),1))));fe.added.forEach((fe=>ve.push(this._newRootTile(fe)))),this._setRootTiles(ve)}}else this._updatingRootTiles=!0,be.length>Gg&&(ar.getLogger(this).warn("Surface extent is too large for tile resolution at level 0."),be=ve.rootTilesInExtent(fe,_e,Gg)),this._setRootTiles(be.map((fe=>this._newRootTile(fe))));I$1y(_e,this._rootTilesExtent)||(this._rootTilesExtent=u$3J(_e)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const fe=this._allTiles.filter((fe=>fe.isLoaded&&fe.intersectsClippingArea));fe.sort(u$W),fe.forEach((fe=>this._renderer.updateTileGeometryState(fe))),fe.forEach((fe=>fe.renderData.updateNeighborData())),this._updateTilesGeometries(fe),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(fe){if(0===fe.length)return;fe.sort(u$W);const ve=this.renderer;fe.forEach((fe=>ve.updateGeometryIfNeeded(fe))),fe.forEach((fe=>this._pendingTilesForElevationUpdateEvent.add(fe)))}_shouldSplit(fe){return fe.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===zhe.SPLIT}_newRootTile(fe){const ve=this._acquireTile(0,fe[1],fe[2],null);return this._shouldSplit(ve)&&ve.setPendingUpdate(zhe.SPLIT),this._loadTile(ve),this._markTileToUpdate(ve),this._updateRootTileElevationBounds(),ve}_setRootTiles(fe){if(this._rootTiles=fe,this._allTiles.clear(),null!=fe){const ve=this._iteratorPool.acquire();for(ve.reset(fe);!ve.done;)this._allTiles.push(ve.next());ve.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(fe)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(fe){fe.updateClippingStatus(this.extent)&&fe.resetPendingUpdate(zhe.GEOMETRY)&&this._updateTileGeometryState(fe)}_updateTilesVisibility(fe){if(null==fe)return;const ve=function q$c(fe){for(let ve=0;ve<fe.length;ve++){const _e=fe[ve],be=_e.parent;if(be)for(let fe=0;fe<4;fe++){const ve=be.children[fe];if(ve&&ve!==_e)return!0}}return!1}(fe),_e=this.visibleElevationBounds;let be=ve?_e.min:1/0,we=ve?_e.max:-1/0;const Se=this.extent,Te=this._viewProjectionMatrix;this.setTileTreeDirty();const Ee=this._iteratorPool.acquire();for(Ee.reset(fe);!Ee.done;){const fe=Ee.next();fe.updateClippingStatus(Se)&&fe.resetPendingUpdate(zhe.GEOMETRY)&&this._updateTileGeometryState(fe),fe.computeVisibility(),fe.updateScreenDepth(Te),fe.renderData&&(be=Math.min(fe.elevationBoundsMin,be),we=Math.max(fe.elevationBoundsMax,we))}Ee.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(be)&&isFinite(we)&&(_e.min!==be||_e.max!==we)&&(this.visibleElevationBounds=new que(be,we))}_updateRootTileElevationBounds(){let fe=1/0,ve=-1/0;const _e=this._rootTiles;null!=_e&&_e.forEach((({elevationBoundsMin:_e,elevationBoundsMax:be})=>{fe=Math.min(fe,_e),ve=Math.max(ve,be)}));const be=this.rootTileElevationBounds;be.min===fe&&be.max===ve||(this.rootTileElevationBounds=new que(fe,ve))}_updateViewDependentParameters(){const{camera:fe,contentCamera:ve}=this.view.state,_e=Math.tan(.5*ve.fovX),be=Math.tan(.5*ve.fovY),we=this.tilingScheme.pixelSize,Se=2**-this._lodBias*fe.pixelRatio;this._splitLimits.aboveGround=fe.aboveGround,this._splitLimits.fovX=_e,this._splitLimits.fovY=be,this._splitLimits.relativeWidthLimit=we/fe.width*this.maxTextureScale*Se,this._splitLimits.relativeHeightLimit=we/fe.height*this.maxTextureScale*Se,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=N$P(this._splitLimits.frustum??H$M(),ve.frustum):this._splitLimits.frustum=null,N$P(this._frustum,fe.frustum),c$4k(this._viewProjectionMatrix,ve.projectionMatrix,ve.viewMatrix),r$3w(this._eyePosRenderSR,ve.eye),n$3Y(fe.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(fe){fe.updateVisibility(),this._renderer.updateTileGeometryState(fe)&&this._markTileToUpdate(fe),this._usedMemory=null}_markAllTileNeighborsForUpdate(fe){fe.forEachLoadedNeighbor((fe=>{this._layerViews[Wle.MAP].some(d$P)&&fe.setPendingUpdate(zhe.TEXTURE_FADING),this._pendingTilesToUpdate.add(fe)}))}_updateTileTexture(fe,ve){const _e=fe.resetPendingUpdate(zhe.TEXTURE_FADING)?zhe.TEXTURE_FADING:!!fe.resetPendingUpdate(zhe.TEXTURE_NOFADING)&&zhe.TEXTURE_NOFADING;_e&&(this._renderer.updateTileTexture(fe,_e),this._usedMemory=null,ve.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const fe=ffe.extent;D$19(fe),this._pendingTilesForElevationUpdateEvent.forEach((ve=>m$3A(fe,ve.extent,fe))),this._pendingTilesForElevationUpdateEvent.clear(),ffe.spatialReference=this.spatialReference,this.emit("elevation-change",ffe),this._shouldEmitChangeEvent=!1}runTask(fe){this._handleLayerViewChanges(fe),this._frameTask.processQueue(fe),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,fe),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(fe),this._sortTiles(fe);const ve=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(fe,ve),this._updateElevation(fe),this._updateTextures(fe),ve||this._mergeAndSplit(fe,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),fe.done&&fe.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),nhe&&this._checkTileInvariant(),!fe.hasProgressed)return dI}_checkTileInvariant(){const fe=new Map;this._allTiles.forAll((ve=>fe.set(ve,new Set))),this._allTiles.forAll((ve=>{var _e;if(ve.rendered,ve.isLeaf,ve.rendered,ve.isLeaf,!ve.isLeaf){const e77=fe=>0===fe.unmergableChildCount&&0===fe.maxLevelDeltaNeighborCount;ve.children.reduce(((fe,ve)=>fe+(e77(ve)?0:1)),0);if(ve.unmergableChildCount,ve.lij.toString(),ve.unmergableChildCount,ve.hasPendingUpdate(zhe.MERGE)){ve.hasPendingUpdate(zhe.SPLIT);for(const fe of ve.children)fe.isLeaf||fe.hasPendingUpdate(zhe.MERGE)}}for(let be=0;be<4;++be){if(ve.rendered){const fe=null==(_e=ve.renderData)?void 0:_e.geometryState.edgePeerNeighbors[be];if(null!=fe){{const _e=ve.level-fe.level<=Zg;_e||(ve.level,fe.level)}ve.level,fe.level,ve.lij.toString(),fe.lij.toString()}}const we=ve.level-Zg,s84=fe=>fe.isLeaf||fe.level===ve.level,Se=ve.findNeighborTile(ahe[be],s84);if(null!=Se){if(ve.isLeaf&&ve.level>=Zg){let _e=Se;for(;ve.level-_e.level<Zg;)_e=_e.parent;if(!ue$3([we,ve.lij[1]>>Zg,ve.lij[2]>>Zg],_e.lij)){const be=fe.get(_e);be.has(ve),be.add(ve)}}Se.rendered||(Se.level,ve.level),ve.level,Se.level,ve.level,Se.level}}})),this._allTiles.forAll((ve=>{ve.maxLevelDeltaNeighborCount;const _e=fe.get(ve);_e.size,ve.lij.toString(),_e.size}))}_updateAllTilesStatus(fe){if(!this._viewChanged||!this._rootTiles||fe.done)return;this._viewChanged=!1;const ve=new yfe(this._allTiles.length);ve.pushAll(this._rootTiles);const _e=this.snapLevel,be=this._splitLimits,we=this._eyePosRenderSR;this._allTiles.forAll((fe=>{fe.maxLevelDeltaNeighborCount=0,fe.unmergableChildCount=0}));const Se=this._viewProjectionMatrix;for(;!ve.empty;){const fe=ve.pop(),Te=fe.parent,Ee=null!=Te&&Te.hasPendingUpdate(zhe.MERGE),Ce=Ee?zhe.MERGE:fe.shouldSplit(be,we,_e),Oe=Ce===zhe.SPLIT;fe.isLeaf?_t(fe,Oe):ve.pushAll(fe.children),Ee?(fe.resetPendingUpdate(zhe.SPLIT),fe.isLeaf||fe.setPendingUpdate(zhe.MERGE),this._updateClippingStatus(fe),fe.updateVisibility(),fe.updateScreenDepth(Se)):Oe?(fe.resetPendingUpdate(zhe.MERGE),fe.isLeaf&&fe.setPendingUpdate(zhe.SPLIT)):(fe.resetPendingUpdate(zhe.SPLIT)&&fe.updateAgentSuspension(),Ce===zhe.ELEVATION&&fe.updateAgents(Wle.ELEVATION),fe.isLeaf||(fe.setPendingUpdate(zhe.MERGE),fe.resetPendingUpdate(zhe.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),fe.madeProgress()}_sortTiles(fe){fe.done||this._allTilesSorted||(function d$N(fe,ve){const _e=fe.length;for(let be=0;be<_e;++be)fe.at(be).updateDistanceToPOI(ve);fe.sort(p$1C)}(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),fe.madeProgress())}_markTileToUpdate(fe){O$j(fe.isLoaded),fe.intersectsClippingArea&&(this._pendingTilesToUpdate.add(fe),this._markAllTileNeighborsForUpdate(fe))}_updatePendingTileGeometries(){const fe=this._pendingTilesToUpdate,ve=Array.from(fe.keys()).filter((fe=>fe.isLoaded&&fe.intersectsClippingArea));if(0===ve.length)return void fe.clear();const i52=(_e,be)=>{!(null==be?void 0:be.isLoaded)||!be.intersectsClippingArea||be.level<_e.level||fe.has(be)||(fe.add(be),ve.push(be),be.renderData.updateNeighborData())};ve.sort(u$W);const _e=ve.length;for(let be=0;be<_e;++be){const _e=ve[be];O$j(_e.isLoaded),O$j(_e.intersectsClippingArea);const we=_e.renderData;we.updateNeighborData();const Se=we.dirtyEdgeResolutions,Te=we.geometryState,o39=fe=>{var ve;const be=lhe[fe];i52(_e,null==(ve=Te.cornerPeerNeighbors[fe])?void 0:ve.findCorner(z$b(be),(fe=>fe.isLoaded)))};for(let ve=0;ve<4;++ve)if(Se&1<<ve){const be=we.geometryState.edgePeerNeighbors[ve];be&&(null==be?void 0:be.level)>=_e.level&&be.forAllSubtreeOnSide(J$5(ahe[ve]),(ve=>!(!ve.isLoaded||!ve.intersectsClippingArea||(O$j(fe.has(ve)||u$W(_e,ve)<0),i52(_e,ve),0)))),o39((ve+1)%4),o39(ve)}}fe.clear(),this._updateTilesGeometries(ve),this._shouldEmitChangeEvent=!0,nhe&&she&&this.checkAllTilesWaterproofness()}_mergeAndSplit(fe,ve){if(this.suspended||fe.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let _e=!1;const be=this.view.state.fixedContentCamera;let we=!1;for(;!fe.done;){we=!0;let Se=!1;const Te=!this._allTiles.some((we=>{if(!_e&&!be&&!we.visible)return fe.done;let Te=we;if(we.hasPendingUpdate(zhe.MERGE)){if(!ve||we.unmergableChildCount>0)return fe.done;for(we.resetPendingUpdate(zhe.MERGE);null!=Te.parent&&0===Te.parent.unmergableChildCount&&Te.parent.resetPendingUpdate(zhe.MERGE);)Te=Te.parent;this._mergeTile(Te),Se=!0,fe.madeProgress()}else if(we.resetPendingUpdate(zhe.SPLIT)){let ve=!0;const _e=we.level;if(_e>=Zg){const e77=fe=>fe.isLeaf||_e-fe.level<Zg;for(let fe=0;fe<4;++fe){const be=we.findNeighborTile(ahe[fe],e77);null!=be&&_e-be.level===Zg&&(ve=!1,nhe&&(O$j(be.isLeaf),O$j(be.hasPendingUpdate(zhe.SPLIT))))}}ve?(this._splitTile(we),fe.madeProgress(),Se=!0):we.setPendingUpdate(zhe.SPLIT)}return fe.done}));if(Se&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),Te){if(!_e){_e=!0;continue}if(!Se)break}else this._allTilesDirty=!0}we?fe.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(fe)}_updateElevation(fe){fe.done||(this._allTiles.some((ve=>(ve.resetPendingUpdate(zhe.GEOMETRY)&&(this._updateTileGeometryState(ve),this._shortBatches&&this._updatePendingTileGeometries(),fe.madeProgress()),fe.done))),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(fe){fe.done||this._allTiles.some((ve=>(this._updateTileTexture(ve,fe),fe.done)))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams($A.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const fe=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-2.5*(1-fe)}_getLodBiasCorrectedScale(fe){const ve=this.tilingScheme.levels,_e=e$3Y(fe-this._lodBias,0,ve.length-1),be=_e-Math.floor(_e);return ve[Math.floor(_e)].scale*(1-be)+ve[Math.ceil(_e)].scale*be}_removeAllTiles(){null!=this._rootTiles&&(this._rootTiles.forEach((fe=>this._purgeTile(fe))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(fe){if(!fe.children[0])return;const ve=fe.children.slice();fe.unsetChildren();for(let _e=0;_e<4;++_e)this._purgeTile(ve[_e])}_purgeTile(fe){fe.isLeaf?ft(fe):this._purgeDescendantTiles(fe),this._allTiles.removeUnordered(fe),this._unloadTile(fe),this._tileCache.put(lfe._tileMemcacheKey,fe)}_unloadTile(fe){this._pendingTilesToUpdate.delete(fe),this._pendingTilesForElevationUpdateEvent.delete(fe),fe.unload(this._renderer)}_splitTile(fe){fe.isLeaf,fe.rendered,ft(fe);const ve=fe.level+1,_e=2*fe.lij[1],be=2*fe.lij[2],we=fe.setChildren(this._createTile(ve,_e,be,fe),this._createTile(ve,_e,be+1,fe),this._createTile(ve,_e+1,be,fe),this._createTile(ve,_e+1,be+1,fe));this._allTiles.pushArray(we),fe.updateAgentSuspension(),fe.rendered,this._unloadTile(fe),we.forEach((fe=>this._loadTile(fe))),we.forEach((fe=>this._pendingTilesToUpdate.add(fe))),this._markAllTileNeighborsForUpdate(fe),this._emitTileScaleChange(fe,fe.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),we.forEach((fe=>_t(fe,fe.hasPendingUpdate(zhe.SPLIT)))),++this._performanceInfo.numSplit}_emitTileScaleChange(fe,ve=fe.level){mfe.spatialReference=this.spatialReference,mfe.extent=fe.extent,mfe.scale=this._getLodBiasCorrectedScale(ve),this.emit("scale-change",mfe)}_createTile(fe,ve,_e,be){const we=this._acquireTile(fe,ve,_e,be);return we.updateClippingStatus(this.extent),we.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(we)&&we.setPendingUpdate(zhe.SPLIT),we}get _shortBatches(){return this.view.state.mode!==PM.IDLE}_mergeTile(fe){fe.hasPendingUpdate(zhe.SPLIT),fe.isLeaf,fe.isLeaf||(this._purgeDescendantTiles(fe),fe.renderData,this._loadTile(fe),this._markTileToUpdate(fe),this._emitTileScaleChange(fe),this._shortBatches&&this._updatePendingTileGeometries(),_t(fe,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(fe){fe.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(fe)}_handleLayerViewChanges(fe=wI){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let ve=!1;const _e=new Set;let be=-1;for(let we=this.view.allLayerViews.length-1;we>=0;we--){const fe=this.view.allLayerViews.items[we];if(_e.add(fe.uid),L$d(fe)||x$k(fe))if(this._basemapLayerViewHandles.has(fe.uid)&&!x$k(fe)){const _e=this._layerClassFromLayerView(fe),we=this._getLayerIdxByUID(_e,fe.uid);null!=we&&((we<be||null==be)&&(ve=!0),be=we)}else this._registerTiledLayerView(fe),fe.layer.loaded&&(ve=!0)}this._basemapLayerViewHandles.forEach(((fe,be)=>{_e.has(be)||(this._unregisterTiledLayerView(be),ve=!0)})),ve&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),fe.madeProgress()}_allSurfaceLayersTransparent(){var fe,ve;let _e=0===(null==(ve=null==(fe=this.view.map)?void 0:fe.ground)?void 0:ve.opacity);for(const be of this.view.allLayerViews.items)if(h$D(be)&&!j$1t(be.layer)&&0!==be.fullOpacity)return _e=!1,_e;return _e}_hasCompositeBlendMode(){for(const fe of this.view.allLayerViews.items)if((A$o(fe)||x$k(fe))&&o$H(qde[fe.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(fe){return U$f(fe)?Wle.ELEVATION:Wle.MAP}_registerTiledLayerView(fe){const ve=[];if((A$o(fe)||x$k(fe))&&ve.push(d$3d((()=>fe.layer.blendMode),(()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(aY.UNFADED)}))),!x$k(fe)){const _e=this._layerClassFromLayerView(fe);ve.push(d$3d((()=>fe.suspended),(()=>this._updateTiledLayers()))),ve.push(d$3d((()=>fe.fullOpacity),(()=>this._updateTileTextures(aY.UNFADED)))),ve.push(d$3d((()=>"effectiveScaleRange"in fe.layer?fe.layer.effectiveScaleRange:null),(()=>this._restartAllAgents(_e)))),ve.push(fe.on("data-changed",(()=>{const ve=this._getLayerIdxByUID(_e,fe.uid);null!=ve&&this._invalidateLayerData(ve,_e)})))}this._unregisterTiledLayerView(fe.uid),this._basemapLayerViewHandles.set(fe.uid,ve)}_unregisterTiledLayerView(fe){const ve=this._basemapLayerViewHandles.get(fe);if(ve){for(const fe of ve)fe.remove();this._basemapLayerViewHandles.delete(fe)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const fe=this.view.allLayerViews,ve=[[],[]];let _e=null;fe.forEach((fe=>{if(!fe.layer||fe.suspended||!L$d(fe)||!fe.fullExtent)return;const be=this._layerClassFromLayerView(fe);if(be===Wle.MAP){const ve=fe.displayLevelRange.maxLevel;ve!==1/0&&(null===_e||ve>_e)&&(_e=ve)}ve[be].push(fe)}));for(const be of Yle){const fe=this._layerViews[be],_e=ve[be];_e.reverse();const we=_e.length;let Se=fe.length!==we;const Te=new Array(we),Ee=new Array(fe.length);this._layerIndexByUid[be].clear();for(let ve=0;ve<we;ve++){const we=_e[ve].uid;this._layerIndexByUid[be].set(we,ve);const Ce=fe.indexOf(_e[ve]);Te[ve]=Ce,ve!==Ce&&(Se=!0),Ce>-1&&(Ee[Ce]=ve)}if(Se){const fe=this._postorderIterator;for(fe.reset(this._rootTiles);!fe.done;)fe.next().modifyLayers(Ee,Te,be);this._layerViews[be]=_e,this._restartAllAgents(be),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(_e)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(fe){const ve=this._postorderIterator;for(ve.reset(this._rootTiles);!ve.done;){const _e=ve.next();_e.restartAgents(fe),fe===Wle.ELEVATION&&_e.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(fe,ve){return this._layerViews[ve][fe]}numLayers(fe){return this._layerViews[fe].length}_updateTileTextures(fe){this._allTiles.forAll((ve=>{ve.updateAgents(Wle.MAP),fe===aY.IMMEDIATE?this.renderer.updateTileTexture(ve,zhe.TEXTURE_NOFADING):ve.updateRenderData(Wle.MAP,fe)})),this._evaluateTransparency()}_invalidateLayerData(fe,ve){this._allTiles.forAll((_e=>_e.removeLayerAgent(fe,ve))),this._allTiles.forAll((_e=>_e.invalidateLayerData(fe,ve)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(fe=$A.UPDATE){this.renderer.setNeedsRender(fe)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(fe,ve,_e,be){const we=this.layerViewByIndex(ve,_e),Se=we.layer;return!Se.tilemapCache||d$P(we)?this._requestTileData(fe,_e,we,be):(++this._asyncWorkItems,Se.tilemapCache.fetchAvailability(fe.lij[0],fe.lij[1],fe.lij[2],{...be,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((ve=>{throw--this._asyncWorkItems,s$4o(be),b$2g(ve)||this._dataMissing(fe,_e,we),ve})).then((()=>this._frameTask.schedule((()=>this._requestTileData(fe,_e,we,be)),be.signal))))}_requestTileData(fe,ve,_e,be){const we=ve===Wle.ELEVATION;return be.requester??(be.requester=we?this._elevationDataRequester:this._mapDataRequester),we?U$f(_e)?this._requestElevationTileData(fe,_e,be):Promise.reject():h$D(_e)?this._requestMapTileData(fe,_e,be):Promise.reject()}_requestElevationTileData(fe,ve,_e){++this._asyncWorkItems;const r65=be=>{!c$4_(_e)&&be&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(fe,ve,be))};return ve.fetchTile(fe.lij,_e).then((fe=>this._frameTask.schedule((()=>r65(fe)))),(_e=>{b$2g(_e)||(ar.getLogger(this).error(`Tile ${fe.lij.toString()} layer ${Wle.ELEVATION}/${ve.uid} error ${_e}`),this._dataMissing(fe,Wle.ELEVATION,ve),this.requestUpdate())})).finally((()=>--this._asyncWorkItems))}_elevationDataArrived(fe,ve,_e){const be=this._layerIndexByUid[Wle.ELEVATION].get(ve.uid);if(null==be)return void ar.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Wle.ELEVATION,fe.lij.toString());const we=new Yue(fe.lij,fe.extent,_e);fe.dataArrived(be,Wle.ELEVATION,we);const Se=[fe],Te=fe.level,Ee=this._iteratorPool.acquire();for(Ee.reset(Se);!Ee.done;){const fe=Ee.next();fe.findElevationBoundsForLayer(be,Te),fe.computeElevationBounds()}0===Te&&this._updateRootTileElevationBounds(),Ee.remove(),this._updateTilesVisibility(Se)}_requestMapTileData(fe,ve,_e){++this._asyncWorkItems;const r65=(be,we)=>{b$v(we),c$4_(_e)||(this._dataMissing(fe,Wle.MAP,ve),this.requestUpdate())},s84=fe=>ve=>r65(0,fe);return ve.fetchTile(fe.lij,_e).then((be=>this._frameTask.schedule((()=>{this.requestUpdate(),c$4_(_e)?b$v(be):this._mapTileDataArrived(fe,ve,be)}),_e.signal,s84(be)).catch(s84(be))),((fe,ve=null)=>this._frameTask.schedule((()=>r65(0,ve))))).finally((()=>--this._asyncWorkItems))}_mapTileDataArrived(fe,ve,_e){const be=this._getLayerIdxByUID(Wle.MAP,ve.uid);if(null==be)return b$v(_e),void ar.getLogger(this).warn("TerrainSurface: received data from unknown layer");fe.dataArrived(be,Wle.MAP,_e)}_getLayerIdxByUID(fe,ve){return this._layerIndexByUid[fe].get(ve)}_dataMissing(fe,ve,_e){const be=this._getLayerIdxByUID(ve,_e.uid);null!=be?fe.dataMissing(be,ve):ar.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(fe){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll((fe=>{fe.renderData&&this.overlayManager.setTileParameters(fe)})),this._renderer.setNeedsRender(fe))}get performanceInfo(){const fe=this._performanceInfo;return fe.numNodes=this._allTiles.length,fe.numLeaves=fe.numVisible=fe.numRendered=fe.numLoadedPerLevel.length=fe.numRenderedPerLevel.length=0,this._allTiles.forAll((ve=>{ve.isLeaf&&fe.numLeaves++;const _e=ve.level;ve.renderData&&(fe.numLoadedPerLevel[_e]=(fe.numLoadedPerLevel[_e]||0)+1),ve.visible&&(fe.numVisible++,ve.rendered&&(fe.numRenderedPerLevel[_e]=(fe.numRenderedPerLevel[_e]||0)+1,fe.numRendered++))})),fe}get usedMemory(){return this.tilingScheme?(null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce(((fe,ve)=>fe+ve.usedMemory),0)):null}getUsedMemoryForLayerView(fe){let ve=0;const _e=this._layerClassFromLayerView(fe),be=this._getLayerIdxByUID(_e,fe.uid);return null!=be&&this._allTiles.forAll((fe=>ve+=fe.getUsedMemoryForLayer(_e,be))),ve}getTile(fe){if(null==fe||null==this._rootTiles)return null;const ve=fe.split("/").map((fe=>+fe));if(0===ve[0])return this._rootTiles.find((fe=>fe.lij[1]===ve[1]&&fe.lij[2]===ve[2]));const _e=ve[0],be=ve[1]>>_e,we=ve[2]>>_e;let Se;if(this._rootTiles.some((fe=>fe.lij[1]===be&&fe.lij[2]===we&&(Se=fe,!0))),Se){let fe=1<<ve[0]-1;for(;Se.lij[0]<ve[0];){let _e=ve[1]&fe?2:0;if((ve[2]&fe)>0&&_e++,!Se.children[_e])return null;Se=Se.children[_e],fe>>=1}return Se.lij[0]===ve[0]&&Se.lij[1]===ve[1]&&(Se.lij[2],ve[2]),Se}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(fe){this._renderer.renderPatchBorders=fe}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(fe){this._renderer.visualizeNormals=fe}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(fe){this._renderer.renderingDisabled=fe}get test(){}checkAllTilesWaterproofness(){if(!she)return;const fe=this._rootTiles;if(null==fe)return;const t84=fe=>{var ve,_e,be;return(null==(be=null==(_e=null==(ve=null==fe?void 0:fe.renderData)?void 0:ve.geometry)?void 0:_e.indices)?void 0:be.length)>0},i52=(fe,ve)=>{t84(fe)},r65=fe=>{var ve,_e;if(fe.intersectsClippingArea)if(fe.renderData&&fe.renderData.geometryState,fe.renderData&&fe.renderData.geometry,!(null==(ve=fe.renderData)?void 0:ve.geometry)||(null==(_e=fe.renderData.geometry.indices)||_e.length),t84(fe)){fe.checkGeometryWaterproofness();for(const ve of fe.children)i52(ve)}else if(fe.isLeaf);else for(const be of fe.children)r65(be)},s84=fe=>{var ve;null==(ve=fe.parent)||ve.visible,fe.visible;fe.computeVisibility();fe.visible;if(!fe.isLeaf)for(const _e of fe.children)s84(_e)};for(const ve of fe)r65(ve),s84(ve)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(fe){return this._isGlobal&&fe[2]===this.lijEastEnd(fe[0])-1}isWestEndWrap(fe){return this._isGlobal&&0===fe[2]}lijEastEnd(fe){return 1<<fe+(this._isGeographic?1:0)}wrapEastWest(fe){const ve=this.lijEastEnd(fe[0]),_e=fe[2];if(0<=_e&&_e<ve)return fe;if(!this._isGlobal)return null;const be=(_e+(_e<0?ve:0))%ve;return[fe[0],fe[1],be]}enableInternalChecks(fe){!function H$c(fe){nhe=fe}(fe)}enableWaterproofnessChecks(fe){!function p$1D(fe){she=fe,nhe=nhe||fe}(fe)}};cfe._tileMemcacheKey="TerrainTileMemcache",e$4o([y$2v()],cfe.prototype,"_renderer",void 0),e$4o([y$2v({constructOnly:!0})],cfe.prototype,"_scaleRangeQueries",void 0),e$4o([y$2v({constructOnly:!0})],cfe.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],cfe.prototype,"overlayManager",void 0),e$4o([y$2v()],cfe.prototype,"_hasPendingUpdates",void 0),e$4o([y$2v()],cfe.prototype,"_asyncWorkItems",void 0),e$4o([y$2v()],cfe.prototype,"_allTilesDirty",void 0),e$4o([y$2v()],cfe.prototype,"_allTilesSorted",void 0),e$4o([y$2v()],cfe.prototype,"_viewChanged",void 0),e$4o([y$2v({type:Number})],cfe.prototype,"heading",void 0),e$4o([y$2v()],cfe.prototype,"_splitLimits",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"_watchUpdatingTracking",void 0),e$4o([y$2v()],cfe.prototype,"_frameTask",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"snapLevel",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"lodSnapping",null),e$4o([y$2v()],cfe.prototype,"_userClippingExtent",null),e$4o([y$2v()],cfe.prototype,"_rootTilesExtent",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"extent",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"groundExtent",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"_tilingSchemeExtent",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"updating",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"running",null),e$4o([y$2v(Hue)],cfe.prototype,"updatingProgress",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"updatingProgressValue",null),e$4o([y$2v()],cfe.prototype,"_maxNumUpdating",void 0),e$4o([y$2v()],cfe.prototype,"baseOpacity",null),e$4o([y$2v()],cfe.prototype,"hasCompositeBlendMode",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"viewingMode",null),e$4o([y$2v()],cfe.prototype,"maxTextureScale",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"ready",null),e$4o([y$2v({value:Che.FRONT_TO_BACK})],cfe.prototype,"renderOrder",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"rootTiles",null),e$4o([y$2v()],cfe.prototype,"_rootTiles",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"spatialReference",null),e$4o([y$2v({type:b_})],cfe.prototype,"backgroundColor",null),e$4o([y$2v({value:!1})],cfe.prototype,"slicePlaneEnabled",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"tilingScheme",void 0),e$4o([y$2v({readOnly:!0})],cfe.prototype,"tilingSchemeLocked",null),e$4o([y$2v({readOnly:!0})],cfe.prototype,"tilingSchemeLogic",void 0),e$4o([y$2v()],cfe.prototype,"wireframe",null),e$4o([y$2v({value:!1})],cfe.prototype,"suspended",null),e$4o([y$2v()],cfe.prototype,"fadeDuration",null),e$4o([y$2v()],cfe.prototype,"visibleElevationBounds",void 0),e$4o([y$2v()],cfe.prototype,"rootTileElevationBounds",void 0),e$4o([y$2v()],cfe.prototype,"_layerViewsDirty",void 0),e$4o([y$2v()],cfe.prototype,"renderPatchBorders",null),e$4o([y$2v()],cfe.prototype,"visualizeNormals",null),e$4o([y$2v()],cfe.prototype,"renderingDisabled",null),cfe=lfe=e$4o([a$4y("esri.views.3d.terrain.TerrainSurface")],cfe);const ufe=cfe,hfe=[0,0,0],dfe=[0,0,0,0],pfe=u$3J();new jr;const ffe=new jue("ground"),mfe={spatialReference:null,extent:null,scale:0};function ct$1(fe,ve,_e){var be;for(const we of fe){if(!we.containsPointXY(ve,_e))continue;let fe=we;for(;fe&&!fe.renderData;){const be=(ve>fe.extentMidX?1:0)+(_e<fe.extentMidY?2:0);fe=fe.children[be]}return e$Z(ve,_e,(null==(be=null==fe?void 0:fe.renderData)?void 0:be.geometryState.samplerData)??null)}return null}let yfe=class gt{constructor(fe){this.capacity=fe,this._head=0,this._tail=0,this._data=new Array(fe)}push(fe){const ve=this._tail;if(!(ve<this.capacity))throw new Error("Queue full");this._data[ve]=fe,this._tail=ve+1}pushAll(fe){const ve=fe.length;if(0===ve)return;const _e=this._tail;if(!(_e+ve<=this.capacity))throw new Error("Queue full");for(let be=0;be<ve;++be)this._data[_e+be]=fe[be];this._tail=_e+ve}pop(){const fe=this._head;if(fe<this._tail){const ve=this._data[fe];return this._head=fe+1,ve}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}};function _t(fe,ve){!fe.isLeaf||fe.level<Zg||yt(fe,(fe=>{ve&&mt(fe);const _e=Tt(fe);if(fe.maxLevelDeltaNeighborCount++,_e){let ve=fe.parent;for(;ve;){const fe=Tt(ve);if(ve.unmergableChildCount++,!fe)break;ve=ve.parent}}}))}function mt(fe){if(fe.hasPendingUpdate(zhe.SPLIT))return;let ve=fe.parent;for(;null==ve?void 0:ve.resetPendingUpdate(zhe.MERGE);)ve=ve.parent;fe.resetPendingUpdate(zhe.MERGE),fe.isLeaf&&fe.setPendingUpdate(zhe.SPLIT),fe.level<Zg||yt(fe,(fe=>{mt(fe)}))}function ft(fe){fe.level<Zg||yt(fe,(fe=>{if(fe.maxLevelDeltaNeighborCount--,0===fe.maxLevelDeltaNeighborCount&&0===fe.unmergableChildCount){let ve=fe.parent;for(;ve&&(ve.unmergableChildCount--,Tt(ve));)ve=ve.parent}}))}function Tt(fe){return 0===fe.maxLevelDeltaNeighborCount&&0===fe.unmergableChildCount}function yt(fe,ve){if(fe.level<Zg)return;const _e=fe.level-Zg,be=fe.lij[1]>>Zg,we=fe.lij[2]>>Zg,a55=fe=>fe.isLeaf||fe.level===_e;for(let Se=0;Se<4;++Se){const Te=fe.findNeighborTile(ahe[Se],a55);if(!Te||Te.level!==_e)continue;const Ee=Te.lij;Ee[1]===be&&Ee[2]===we||ve(Te)}}let gfe=class a44{constructor(fe,ve,_e,be){this.operation=fe,this.geometry=ve,this.states=_e,this.sync=be}},vfe=class n40 extends zi{constructor(fe){super(fe),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(fe,ve){const _e=this._dirtyGeomRecords.get(fe);_e&&(_e.forEach(((_e,be)=>{const we=this._ensureGeomRecord(fe,be);_e.forEach((({geometry:fe,operation:_e,states:Se},Te)=>{let Ee=!1;if(_e===XX.UPDATE){const _e=we.get(Te);if(_e){if(Se&JX.TRANSFORMATION){const ve=this.model.getObject(be);this.model.updateRenderGeometryTransformation(ve,fe,_e)&&(Ee=!0)}Ee||ve.updates.push({renderGeometry:_e,updateType:Se})}else s$31(!1,"ModelDirtySet.commitLayer: invalid update")}if(_e===XX.REMOVE||Ee){const fe=we.get(Te);fe?(ve.removes.push(fe),we.delete(Te)):_e===XX.REMOVE&&s$31(!1,"ModelDirtySet.commitLayer: invalid remove")}if(_e===XX.ADD||Ee){const _e=this.model.getObject(be);if(null!=_e){const be=this.model.getRenderGeometry(_e,fe);ve.adds.push(be),we.set(Te,be)}}})),0===we.size&&this._residentGeomRecords.get(fe).delete(be)})),0===this._residentGeomRecords.get(fe).size&&this._residentGeomRecords.delete(fe),this._dirtyGeomRecords.delete(fe),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(fe,ve){const _e=this._dirtyGeomRecords.get(fe);_e&&_e.forEach(((_e,be)=>{const we=this._ensureGeomRecord(fe,be);_e.forEach((({geometry:fe,operation:_e,states:Se,sync:Te},Ee)=>{let Ce=!1;if(_e===XX.UPDATE&&Te){const _e=we.get(Ee);if(_e){if(Se&JX.TRANSFORMATION){const ve=this.model.getObject(be);this.model.updateRenderGeometryTransformation(ve,fe,_e)&&(Ce=!0)}Ce||ve.updates.push({renderGeometry:_e,updateType:Se})}else s$31(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}}))}))}getResidentRenderGeometries(fe,ve){const _e=this._residentGeomRecords.get(fe);_e&&_e.forEach((fe=>fe.forEach((fe=>ve.push(fe)))))}_objectStateChanged(fe,ve){for(const _e of ve.geometries)this._updateOrCreateDirtyRecord(ve,_e,null,XX.UPDATE,fe)}visibilityChanged(fe){this._objectStateChanged(JX.VISIBILITY,fe)}highlightChanged(fe){this._objectStateChanged(JX.HIGHLIGHT,fe)}occlusionChanged(fe){this._objectStateChanged(JX.OCCLUDEE,fe)}attributesChanged({object:fe,geometry:ve,sync:_e}){this._updateOrCreateDirtyRecord(fe,ve,null,XX.UPDATE,JX.GEOMETRY,_e)}layerAdded(fe){fe.objects.forAll((ve=>this._layerObjectAdded(fe,ve)))}layerRemoved(fe){fe.objects.forAll((ve=>this._layerObjectRemoved(fe,ve)))}layerObjectAdded(fe){this._layerObjectAdded(fe.layer,fe.object)}_layerObjectAdded(fe,ve){const _e=fe.id;for(const be of ve.geometries)this._geometryAdded(ve,be,_e)}layerObjectRemoved(fe){this._layerObjectRemoved(fe.layer,fe.object)}layerObjectsAdded(fe){for(const ve of fe.objects)this._layerObjectAdded(fe.layer,ve)}layerObjectsRemoved(fe){for(const ve of fe.objects)this._layerObjectRemoved(fe.layer,ve)}_layerObjectRemoved(fe,ve){const _e=fe.id;for(const be of ve.geometries)this._geometryRemoved(ve,be,_e)}transformationChanged(fe){const ve=this._getParentLayerId(fe),_e=fe.id;this._ensureGeomRecord(ve,_e).forEach((_e=>{this._updateOrCreateDirtyRecord(fe,_e.geometry,ve,XX.UPDATE,JX.TRANSFORMATION)}))}shaderTransformationChanged(fe){const ve=this._getParentLayerId(fe),_e=fe.id;this._ensureGeomRecord(ve,_e).forEach((ve=>{ve.objectShaderTransformationChanged(fe.shaderTransformation)}))}geometryAdded(fe){this._geometryAdded(fe.object,fe.geometry)}_geometryAdded(fe,ve,_e=null){this._updateOrCreateDirtyRecord(fe,ve,_e,XX.ADD)}geometryRemoved(fe){this._geometryRemoved(fe.object,fe.geometry)}_geometryRemoved(fe,ve,_e=null){this._updateOrCreateDirtyRecord(fe,ve,_e,XX.REMOVE)}_updateOrCreateDirtyRecord(fe,ve,_e,be,we=JX.NONE,Se=!1){_e=_e??this._getParentLayerId(fe);const Te=fe.id,Ee=ve.id,Ce=this._ensureDirtyRecord(_e,Te),Oe=Ce.get(Ee);let Re=!1;if(Oe){const fe=Oe.operation;fe===XX.REMOVE&&be===XX.ADD&&Oe.states!==JX.NONE?Oe.operation=XX.UPDATE:fe===XX.REMOVE&&be===XX.ADD||fe===XX.ADD&&be===XX.REMOVE?(Ce.delete(Ee),Re=!0):fe!==XX.UPDATE||be!==XX.REMOVE&&be!==XX.UPDATE?(s$31((fe===XX.REMOVE||fe===XX.ADD)&&be===XX.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),Oe.states|=we):(Oe.operation=be,Oe.states|=we),Oe.sync=Oe.sync||Se}else Ce.set(Ee,new gfe(be,ve,we,Se));this.dirty=!Re||this._hasDirtyGeometryRecords}_ensureGeomRecord(fe,ve){let _e=this._residentGeomRecords.get(fe);_e||(_e=new Map,this._residentGeomRecords.set(fe,_e));let be=_e.get(ve);return be||(be=new Map,_e.set(ve,be)),be}get _hasDirtyGeometryRecords(){for(const fe of this._dirtyGeomRecords.values())for(const ve of fe.values())if(ve.size>0)return!0;return!1}_ensureDirtyRecord(fe,ve){let _e=this._dirtyGeomRecords.get(fe);_e||(_e=new Map,this._dirtyGeomRecords.set(fe,_e));let be=_e.get(ve);return be||(be=new Map,_e.set(ve,be)),be}_getParentLayerId(fe){return fe.parentLayer?fe.parentLayer.id:0}formatDebugInfo(){const fe=["ADD","UPD",void 0,"REM"];let ve="";return this._dirtyGeomRecords.forEach(((_e,be)=>{_e.forEach(((_e,we)=>{ve.length>0&&(ve+="\n"),ve+=be+"."+we;const Se=[];_e.forEach((fe=>{const ve=fe.operation;Se[ve]||(Se[ve]=[]),Se[ve].push(fe.geometry.id)}));for(let be=0;be<Se.length;be++)if(Se[be]){ve+=" "+fe[be-1]+": ";for(let fe=0;fe<Se[be].length;fe++)ve+=Se[be][fe]+", "}}))})),ve}get test(){}};e$4o([y$2v({constructOnly:!0})],vfe.prototype,"model",void 0),e$4o([y$2v()],vfe.prototype,"dirty",void 0),vfe=e$4o([a$4y("esri.views.3d.webgl-engine.lib.ModelDirtySet")],vfe);const _fe=vfe;let $fe=class h25 extends zi{constructor(){super(...arguments),this.dirtySet=new _fe({model:this}),this._content=new Map,this._originFactory=new fX(null)}getObject(fe){return this._content.get(fe)}add(fe){const ve=fe.id;s$31(!this._content.has(ve),"Model/Stage already contains object to be added"),this._content.set(ve,fe),n$2g(fe)&&this.dirtySet.layerAdded(fe)}remove(fe){return!!this._content.has(fe.id)&&(this._content.delete(fe.id),n$2g(fe)&&this.dirtySet.layerRemoved(fe),!0)}addMany(fe){for(const ve of fe)ve&&(s$31(!this._content.has(ve.id),"Model/Stage already contains object to be added"),this._content.set(ve.id,ve))}removeMany(fe){for(const ve of fe)ve&&(s$31(this._content.has(ve.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(ve.id))}has(fe){return this._content.has(fe.id)}forEachOfType(fe,ve){this._content.forEach((_e=>{_e.type===fe&&ve(_e)}))}getRenderGeometry(fe,ve){const _e=new lee(ve,{castShadow:fe.castShadow,objectShaderTransformation:fe.shaderTransformation});_e.transformation=fe.getCombinedStaticTransformation(ve,bfe);const{localOrigin:be}=ve;return _e.localOrigin=null!=be?be:this._originFactory.getOrigin(_e.boundingSphere),_e}updateRenderGeometryTransformation(fe,ve,_e){if(null==fe)return!1;_e.transformation=fe.getCombinedStaticTransformation(ve,bfe);const be=this._originFactory.getOrigin(_e.boundingSphere);return _e.localOrigin!==be}getStats(){const fe={},ve=Array.from(this._content.values());for(let _e=0;_e<eD.COUNT;++_e)fe[_e]=ve.filter((fe=>fe.type===_e)).length;return{contentTypes:fe,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};e$4o([y$2v({constructOnly:!0})],$fe.prototype,"dirtySet",void 0),$fe=e$4o([a$4y("esri.views.3d.webgl-engine.parts.Model")],$fe);const bfe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let wfe=class t71{constructor(fe){this._totalCount=fe,this._componentCountCache=-1,this._indexRanges=[0,fe]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(fe){if(fe<0||fe>=this._totalCount)return!1;if(this.allVisible())return!0;{const ve=this._indexRanges;let _e=0,be=ve.length/2;if(fe<ve[2*_e]||fe>ve[2*be]+ve[2*be+1])return!1;for(;be-_e>0;){const we=Math.floor(.5*(_e+be)),Se=ve[2*we];if(fe<Se){if(be-_e==1)return!1;be=we}else{if(fe<Se+ve[2*we+1])return!0;if(be-_e==1)return!1;_e=we+1}}return!1}}get componentCount(){if(-1===this._componentCountCache){const fe=this._indexRanges;let ve=0;for(let _e=0;_e<fe.length;_e+=2)ve+=fe[_e+1];this._componentCountCache=ve}return this._componentCountCache}reset(fe){"all"===fe||fe.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function n$19(fe){const ve=new Array;if(0===fe.length)return ve;let _e=fe[0],be=1;for(let we=1;we<fe.length;we++){const Se=fe[we];_e+be===Se?be+=1:(ve.push(_e),ve.push(be),_e=Se,be=1)}return ve.push(_e),ve.push(be),ve}(fe),this._componentCountCache=-1}forEachComponent(fe){const ve=this._indexRanges;for(let _e=0;_e<ve.length;_e+=2){const be=ve[_e],we=be+ve[_e+1];for(let ve=be;ve<we;ve++)if(!fe(ve))return!1}return!0}forEachComponentRange(fe){const ve=this._indexRanges;for(let _e=0;_e<ve.length;_e+=2){const be=ve[_e];if(!fe(be,be+ve[_e+1]))return!1}return!0}computeOffsetRanges(fe){const ve=new Array(this._indexRanges.length),_e=this._indexRanges;for(let be=0;be<_e.length;be+=2){const we=_e[be],Se=we+_e[be+1],Te=fe[we],Ee=fe[Se];ve[be]=Te,ve[be+1]=Ee-Te}return ve}};let xfe=class e58{constructor(fe,ve){this.offsets=ve,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const _e=this.count;this.visibility=new wfe(_e),this.materialDataBuffer=fe.getBuffer(_e),this.materialDataIndices=new Uint16Array(_e);for(let be=0;be<_e;be++)this.materialDataIndices[be]=this.materialDataBuffer.acquireIndex()}destroy(){for(let fe=0;fe<this.count;fe++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[fe])}get count(){return this.offsets.length-1}get geometryRanges(){return null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return null==this.highlightCounts?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return null==this.highlightCounts?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const{highlightRanges:fe,defaultRanges:ve}=function h$x(fe,ve,_e){const be=[],we=[];let Se=_e.length,Te=_e.length;return ve.forEachComponent((ve=>(fe[ve]>0?(Se!==ve-1&&(be.length&&be.push(_e[Se+1]-be[be.length-1]),be.push(_e[ve])),Se=ve):(Te!==ve-1&&(we.length&&we.push(_e[Te+1]-we[we.length-1]),we.push(_e[ve])),Te=ve),!0))),be.length&&be.push(_e[Se+1]-be[be.length-1]),we.length&&we.push(_e[Te+1]-we[we.length-1]),{highlightRanges:be,defaultRanges:we}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=fe,this.cachedDefaultRanges=ve}}};let Sfe=class e59{constructor(fe,ve,_e,be,we,Se){this.transform=fe,this.toMapSpace=ve,this.obb=_e,this.components=be,this.renderable=we,this.intersectionGeometry=Se,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=u$4d(this.intersectionGeometry),this.renderable=u$4d(this.renderable),this.components=u$4d(this.components)}};function U$b(fe,ve){return new(function d$H(fe){return fe<128?Uint8Array:fe<32768?Uint16Array:fe<1<<31?Uint32Array:Array}(fe))(ve)}let Tfe=class i41{constructor(fe,ve){this.elementCount=fe,this.model=ve,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=ve.localMode,this.planetCenterZ=ve.planetCenterZ,this.geometryMinZ=ve.geometryMinZ,this.planetCenter=r$3y(0,0,this.planetCenterZ),this.maxBspNodeDepth=ve.maxBspNodeDepth??8,this.minElementCountForBVH=ve.minElementCountForBVH??15,this.minBspNodeElementCount=ve.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||0===this._bspNodes.length&&this._generateBsp()}intersectRay(fe,ve,_e){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(_e):this._intersectRayWithBVH(fe,ve,_e))}_intersectRayWithoutBVH(fe){this._intersectRange(0,this.elementCount)}_intersectRange(fe,ve){this.model.intersectRange(fe,ve)}_intersectRayWithBVH(fe,ve,_e){this._ensureBVH(),_e?this._intersectGeometryWithBVHVerticalRay(fe):this._intersectGeometryWithBVHGeneralRay(fe,ve)}_intersectGeometryWithBVHVerticalRay(fe){let ve=fe[0],_e=fe[1];if(!this.localMode){const{geometryMinZ:be,planetCenterZ:we}=this,Se=(be-we)/(fe[2]-we);ve=fe[0]*Se,_e=fe[1]*Se}const{_bspNodes:be}=this;let we=0;for(;we>=0;){const fe=be[we],{d:Se,dim:Te,minIndexIndex:Ee,minMidIndexIndex:Ce,maxMidIndexIndex:Oe,maxIndexIndex:Re,aabb2D:De}=fe;if(ve<De[0]||ve>De[2]||_e<De[1]||_e>De[3])break;if(-1===Te||-1===fe.child0&&-1===fe.child1){this._intersectRange(Ee,Re);break}{this._intersectRange(Ce,Oe);const be=(0===Te?ve:_e)-Se;if(be<0){if(-1===fe.child0){this._intersectRange(Ee,Ce);break}we=fe.child0}else{if(!(be>0))break;if(-1===fe.child1){this._intersectRange(Oe,Re);break}we=fe.child1}}}}_intersectGeometryWithBVHGeneralRay(fe,ve){let _e=fe[0],be=fe[1],we=ve[0],Se=ve[1];const{geometryMinZ:Te}=this;if(!this.localMode){let Ee=0,Ce=1;const Oe=Math.min(.5*this.planetCenterZ,Te),Re=fe[2],De=ve[2];if(Re<Oe&&De<Oe)return;if(Re<Oe&&(Ee=(Oe-Re)/(De-Re)),De<Oe&&(Ce=(Oe-Re)/(De-Re)),Ee>Ce)return;const Be=(1-Ee)*fe[0]+Ee*ve[0],Ze=(1-Ee)*fe[1]+Ee*ve[1],Xe=(1-Ee)*fe[2]+Ee*ve[2],Je=(1-Ce)*fe[0]+Ce*ve[0],Qe=(1-Ce)*fe[1]+Ce*ve[1],dt=(1-Ce)*fe[2]+Ce*ve[2],{planetCenterZ:$t}=this,bt=Te-$t,wt=bt/(Xe-$t);_e=Be*wt,be=Ze*wt;const xt=bt/(dt-$t);we=Je*xt,Se=Qe*xt}const Ee=we-_e,Ce=Se-be,Oe=this._bspNodes;let Re=1;{const{aabb2D:fe}=Oe[0],e77=(fe,ve,_e,be)=>{if(Math.abs(ve)<1e-5*Math.max(be-_e,1))return!1;const we=ve>0,Se=we?be:_e,Te=fe+Re*ve;return(we?Te<Se:Te>Se)&&(Re=Math.max((Se-fe)/ve,Re),!0)},n53=()=>e77(_e,Ee,fe[0],fe[2]),h34=()=>e77(be,Ce,fe[1],fe[3]);Math.abs(Ee)>=Math.abs(Ce)?n53()||h34():h34()||n53()}const De=[0,0,Re];let Be=0;for(;Be<De.length;){const fe=De[Be];let ve=De[Be+1],we=De[Be+2];if(Be+=3,ve>we)continue;const Se=Oe[fe],{minIndexIndex:Te,maxIndexIndex:Ze}=Se,{child0:Xe,child1:Je,minMidIndexIndex:Qe,maxMidIndexIndex:dt,aabb2D:$t,d:bt,dim:wt}=Se;{const fe=_e+ve*Ee,be=_e+we*Ee,Se=Math.min(fe,be),Te=Math.max(fe,be),Ce=$t[0],Oe=$t[2];if(Te<Ce||Oe<Se)continue;if(Se<Ce){const fe=(Ce-_e)/Ee;Ee>0?ve=Math.max(ve,fe):we=Math.min(we,fe)}if(Oe<Te){const fe=(Oe-_e)/Ee;Ee>0?we=Math.min(we,fe):ve=Math.max(ve,fe)}}{const fe=be+ve*Ce,_e=be+we*Ce,Se=Math.min(fe,_e),Te=Math.max(fe,_e),Ee=$t[1],Oe=$t[3];if(Te<Ee||Oe<Se)continue;if(Se<Ee){const fe=(Ee-be)/Ce;Ce>0?ve=Math.max(ve,fe):we=Math.min(we,fe)}if(Oe<Te){const fe=(Oe-be)/Ce;Ce>0?we=Math.min(we,fe):ve=Math.max(ve,fe)}}if(-1===Xe&&-1===Je)this._intersectRange(Te,Ze);else{const fe=0===wt?_e:be,Se=0===wt?Ee:Ce,Oe=fe+ve*Se,Be=fe+we*Se,$t=Math.min(Oe,Be),xt=Math.max(Oe,Be),St=e$3Y((bt-fe)/Se,0,Re);Te<Qe&&$t<=bt&&(-1!==Xe?(De.push(Xe),De.push(Se>=0?ve:Math.max(ve,St)),De.push(Se>=0?Math.min(we,St):we)):this._intersectRange(Te,Qe)),this._intersectRange(Qe,dt),dt<Ze&&bt<=xt&&(-1!==Je?(De.push(Je),De.push(Se>=0?Math.max(ve,St):ve),De.push(Se>=0?we:Math.min(we,St))):this._intersectRange(dt,Ze))}}}_generateBsp(){const{elementCount:fe}=this;if(fe<1)return;const ve=U$b(fe,fe);this._elementIndexMap=ve;for(let Re=0;Re<fe;++Re)ve[Re]=Re;const _e=this.model.getAabbs2D();let be=0;const we=this._bspNodes;we.length=0;const{localMode:Se}=this;let Te=!1;if(!Se){const{planetCenterZ:fe,geometryMinZ:ve}=this;Te=fe>=0||ve<.5*fe}const Ee=[],x16=(fe,ve,_e,be,we)=>{Ee.push(fe),Ee.push(ve),Ee.push(_e),Ee.push(be<0?-1:(we?0:1)+2*be)},{maxBspNodeDepth:Ce,minBspNodeElementCount:Oe}=this,f31=(fe,be,Ee,Re,De)=>{const Be=we.length;if(Be>0&&(Te||Ee>=Ce||be-fe<Oe))return;const Ze=[0,0,0,0];!function r$F(fe,ve,_e,be,we){let Se=1/0,Te=1/0,Ee=-1/0,Ce=-1/0;for(let Oe=ve;Oe<_e;++Oe){const fe=4*be[Oe];Se=Math.min(Se,we[fe+0]),Te=Math.min(Te,we[fe+1]),Ee=Math.max(Ee,we[fe+2]),Ce=Math.max(Ce,we[fe+3])}fe[0]=Se,fe[1]=Te,fe[2]=Ee,fe[3]=Ce}(Ze,fe,be,ve,_e);const{d:Xe,dim:Je}=Se?function s$Z(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3];let Se,Te;return be-ve>=we-_e?(Te=.5*(ve+be),Se=0):(Te=.5*(_e+we),Se=1),{d:Te,dim:Se}}(Ze):function h$w(fe){const ve=fe[0],_e=fe[1],be=fe[2],we=fe[3];let Se,Te;return be-ve>=we-_e?(Se=0,Te=.5*(ve+be)):(Se=1,Te=.5*(_e+we)),{dim:Se,d:Te}}(Ze),{rangeMidStart:Qe,rangeMidEnd:dt}=function a$13(fe,ve,_e,be,we,Se){let Te=fe;{let fe=ve;for(;Te<fe;){const ve=we[Te];o$A(ve,_e,be,Se)<0?++Te:(--fe,we[Te]=we[fe],we[fe]=ve)}}const Ee=Te;let Ce=Te,Oe=ve;for(;Ce<Oe;){const fe=we[Oe-1];o$A(fe,_e,be,Se)>0?--Oe:(we[Oe-1]=we[Ce],we[Ce]=fe,++Ce)}return{rangeMidStart:Ee,rangeMidEnd:Oe}}(fe,be,Je,Xe,ve,_e),$t=Ee===Ce-1,bt=!$t&&Qe>=fe+Oe,wt=!$t&&be>=dt+Oe;if(bt||wt||0===Be){const ve=new Efe(fe,Qe,dt,be,Je,Xe,Ze);if(bt&&x16(fe,Qe,Ee+1,Be,!0),wt&&x16(dt,be,Ee+1,Be,!1),we.push(ve),-1!==Re){const fe=we[Re];De?fe.child0=Be:fe.child1=Be}}};for(x16(0,fe,0,-1,!1);be<Ee.length;){const fe=Ee[be],ve=Ee[be+1],_e=Ee[be+2],we=Ee[be+3];be+=4;const Se=we>>1;f31(fe,ve,_e,Se,we-(Se<<1)==0)}this._generatedBVH=!0}};function o$A(fe,ve,_e,be){const we=4*fe,Se=be[we+0+ve];return be[we+2+ve]<_e?-1:Se>_e?1:0}let Efe=class c39{constructor(fe,ve,_e,be,we,Se,Te){this.minIndexIndex=fe,this.minMidIndexIndex=ve,this.maxMidIndexIndex=_e,this.maxIndexIndex=be,this.dim=we,this.d=Se,this.aabb2D=Te,this.child0=-1,this.child1=-1}},Pfe=class l34{constructor(fe,ve,_e,be,we,Se,Te,Ee,Ce){this.componentIndex=fe,this.vertexData=ve,this.vertexStride=_e,this.indexData=be,this.startTriangleNumber=we,this.endTriangleNumber=Se,this.geometryMinZ=Te,this.planetCenterZ=Ee,this.localMode=Ce,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=[0,0,0],this.ray0=[0,0,0],this.isVerticalRay=!1,this._triangleHitCallback=m$V,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new Tfe(Se-we,this)}getAabbs2D(){return this.localMode?function F$d(fe,ve,_e,be,we){const Se=ve-fe,Te=new Float64Array(4*Se);for(let Ee=0;Ee<Se;++Ee){const ve=3*(Ee+fe),Se=we*_e[ve+0],Ce=be[Se+0],Oe=be[Se+1],Re=we*_e[ve+1],De=be[Re+0],Be=be[Re+1],Ze=we*_e[ve+2],Xe=be[Ze+0],Je=be[Ze+1],Qe=4*Ee;Te[Qe+0]=Math.min(Ce,De,Xe),Te[Qe+1]=Math.min(Oe,Be,Je),Te[Qe+2]=Math.max(Ce,De,Xe),Te[Qe+3]=Math.max(Oe,Be,Je)}return Te}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):function w$p(fe,ve,_e,be,we,Se,Te){const Ee=Se-Te,Ce=ve-fe,Oe=new Float64Array(4*Ce);for(let Re=0;Re<Ce;++Re){const ve=3*(Re+fe),Se=we*_e[ve+0],Ce=be[Se+0],De=be[Se+1],Be=Ee/(be[Se+2]-Te),Ze=Ce*Be,Xe=De*Be,Je=we*_e[ve+1],Qe=be[Je+0],dt=be[Je+1],$t=Ee/(be[Je+2]-Te),bt=Qe*$t,wt=dt*$t,xt=we*_e[ve+2],St=be[xt+0],Et=be[xt+1],Pt=Ee/(be[xt+2]-Te),Ot=St*Pt,At=Et*Pt,Mt=4*Re;Oe[Mt+0]=Math.min(Ze,bt,Ot),Oe[Mt+1]=Math.min(Xe,wt,At),Oe[Mt+2]=Math.max(Ze,bt,Ot),Oe[Mt+3]=Math.max(Xe,wt,At)}return Oe}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(fe,ve,_e,be,we,Se){r$3w(this.ray0,fe),Ki(this.rayDirection,ve,fe),this.isVerticalRay=_e,this.totalElevationOffset=be,this.normalRequired=Se,this._triangleHitCallback=we,this._bvh.intersectRay(fe,ve,_e),this._triangleHitCallback=m$V}intersectRange(fe,ve){const _e=this._bvh.elementIndexMap;o$z(this.ray0,this.rayDirection,fe,ve,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,_e,this.startTriangleNumber)}getTriangleElevationOffset(fe){return this.totalElevationOffset}};function o$z(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De=null,Be=0){0!==Ee?function y$19(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De=null,Be=0){const Ze=fe[0],Xe=fe[1],Je=fe[2],Qe=ve[0],dt=ve[1],$t=ve[2];for(let bt=_e;bt<be;++bt){const fe=Be+(De?De[bt]:bt),ve=3*fe,_e=Te*we[ve],be=Se[_e],wt=Se[_e+1],xt=Se[_e+2],St=Te*we[ve+1],Et=Se[St],Pt=Se[St+1],Ot=Se[St+2],At=Te*we[ve+2],Mt=Se[At],Rt=Se[At+1],Nt=Se[At+2],Ft=xt-Ce,zt=Ee/Math.sqrt(be*be+wt*wt+Ft*Ft),kt=be+be*zt,Bt=wt+wt*zt,jt=xt+Ft*zt,Gt=Ot-Ce,Ht=Ee/Math.sqrt(Et*Et+Pt*Pt+Gt*Gt),qt=Et+Et*Ht,Wt=Pt+Pt*Ht,Yt=Ot+Gt*Ht,Xt=Nt-Ce,Jt=Ee/Math.sqrt(Mt*Mt+Rt*Rt+Xt*Xt),Qt=qt-kt,Kt=Wt-Bt,er=Yt-jt,tr=Mt+Mt*Jt-kt,rr=Rt+Rt*Jt-Bt,ir=Nt+Xt*Jt-jt,nr=dt*ir-rr*$t,sr=$t*tr-ir*Qe,or=Qe*rr-tr*dt,ar=Qt*nr+Kt*sr+er*or;if(Math.abs(ar)<=zH)continue;const lr=Ze-kt,cr=Xe-Bt,ur=Je-jt,hr=lr*nr+cr*sr+ur*or;if(ar>0){if(hr<0||hr>ar)continue}else if(hr>0||hr<ar)continue;const dr=cr*er-Kt*ur,pr=ur*Qt-er*lr,fr=lr*Kt-Qt*cr,mr=Qe*dr+dt*pr+$t*fr;if(ar>0){if(mr<0||hr+mr>ar)continue}else if(mr>0||hr+mr<ar)continue;const yr=(tr*dr+rr*pr+ir*fr)/ar;yr>=0&&Re(yr,fe,Oe?I$P(Qt,Kt,er,tr,rr,ir,MH):null)}}(fe,ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be):g$1e(fe,ve,_e,be,we,Se,Te,Oe,Re,De,Be)}function m$V(){}function n$18(fe,ve,_e,be){if(_e>=ve)return fe;null==fe&&(fe=function r$E(fe=!0){return{isVisibleBit:!fe,data:new Uint32Array(0)}}());const we=fe.isVisibleBit;let Se=fe.data;const Te=u$Q(Se),Ee=_e/Te|0,Ce=_e-Te*Ee,Oe=(ve-1)/Te|0,Re=Se,De=be===we;if(!(_e<Re.length*Te)&&De){const fe=Ee+1,ve=Math.ceil(Re.length*Ht),_e=Oe+1;let be=Math.max(fe,ve);be=Math.min(be,_e),Se=new Uint32Array(be),Se.set(Re)}return Ee<Se.length&&(Se[Ee]=function o$y(fe,ve,_e){return fe&~(1<<ve)|(_e?1:0)<<ve}(Se[Ee],Ce,De)),fe.data=Se,fe}function i$11(fe,ve){if(null==fe)return!0;const{isVisibleBit:_e,data:be}=fe,we=u$Q(be);return ve<be.length*we?function e$O(fe,ve,_e,be){const we=_e/be|0,Se=_e-we*be;return function s$Y(fe,ve){return!!(fe&1<<ve)}(ve[we],Se)===fe}(_e,be,ve,we):!fe.isVisibleBit}function u$Q(fe){return 8*fe.BYTES_PER_ELEMENT}let Cfe=class m26{constructor(fe,ve,_e,be,we,Se,Te,Ee){this.vertexData=fe,this.vertexStride=ve,this.indexData=_e,this._components=be,this._componentAabbs3D=we,this.geometryMinZ=Se,this.planetCenterZ=Te,this.localMode=Ee,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=Rfe,this._ray1=Ife,this._invDir=[0,0,0],this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=Lfe,this._callback=y$u,this.rayDirectionC=[0,0,0],this._componentIndexMap=null,this._bvh=new Tfe(be.count,this),this.componentIntersectionData=new Array(be.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:fe,planetCenterZ:ve,minZGlobal:_e}=this,be=new Float64Array(4*fe),we=this._componentAabbs3D;for(let Se=0;Se<fe;++Se){const fe=6*Se,Te=we[fe+0],Ee=we[fe+1],Ce=we[fe+2],Oe=we[fe+3],Re=we[fe+4],De=_e/(Ce-ve),Be=_e/(we[fe+5]-ve),Ze=Math.min(Te*De,Te*Be),Xe=Math.min(Ee*De,Ee*Be),Je=Math.max(Oe*De,Oe*Be),Qe=Math.max(Re*De,Re*Be),dt=4*Se;be[dt+0]=Ze,be[dt+1]=Xe,be[dt+2]=Je,be[dt+3]=Qe}return be}getAabbs2DLocal(){const{numComponents:fe}=this,ve=new Float64Array(4*fe),_e=this._componentAabbs3D;for(let be=0;be<fe;++be){const fe=6*be,we=_e[fe+0],Se=_e[fe+1],Te=_e[fe+3],Ee=_e[fe+4],Ce=4*be;ve[Ce+0]=we,ve[Ce+1]=Se,ve[Ce+2]=Te,ve[Ce+3]=Ee}return ve}intersectRay(fe,ve,_e,be,we,Se,Te){const{isVerticalRay:Ee}=Te;this._ray0=fe,this._ray1=ve,this._componentVerticalOffsets=_e,this._verticalOffset=be,this._tolerance=Se,this._intersectionOptions=Te,this._componentIndexMap=this._bvh.elementIndexMap,function B$t(fe,ve,_e){return o$44(_e,1/(ve[0]-fe[0]),1/(ve[1]-fe[1]),1/(ve[2]-fe[2]))}(fe,ve,this._invDir),this._callback=we,this._bvh.intersectRay(fe,ve,Ee),this._callback=y$u}intersectRange(fe,ve){const _e=this._componentIndexMap,be=this._components,we=be.pickability,Se=be.visibility;for(let Te=fe;Te<ve;++Te){const fe=_e?_e[Te]:Te;i$11(we,fe)&&Se.isVisible(fe)&&this._intersectComponent(fe)}}getComponentTriangleCount(fe){const ve=this._components.offsets,_e=ve[fe]/3;return ve[fe+1]/3-_e}getComponentAabb3D(fe,ve){const _e=this._componentAabbs3D,be=6*fe;return ve[0]=_e[be],ve[1]=_e[be+1],ve[2]=_e[be+2],ve[3]=_e[be+3],ve[4]=_e[be+4],ve[5]=_e[be+5],ve}_intersectComponent(fe){if(!i$11(this._components.pickability,fe))return;const ve=this.getComponentAabb3D(fe,Ofe);let _e=!1;const{localMode:be,_componentVerticalOffsets:we,_verticalOffset:Se,_ray0:Te,_ray1:Ee,_invDir:Ce,planetCenterZ:Oe,_tolerance:Re,rayDirectionC:De,componentIntersectionData:Be}=this,{isVerticalRay:Ze}=this._intersectionOptions,Xe=this._components.offsets,Je=r$3w(Afe,Te),Qe=r$3w(Mfe,Ee),dt=(null==we?void 0:we[fe])??0,$t=dt+((null==Se?void 0:Se.offset)??0);if(0!==$t&&(be?(Je[2]=Te[2]-$t,Qe[2]=Ee[2]-$t,_e=!0):null!=Se&&(Se.componentOffset=dt)),null==Se||_e||0===$t||Se.applyToAabb(ve),!k$I(ve,Je,Ce,Re))return;Ki(De,Qe,Je);const bt=Xe[fe]/3,wt=Xe[fe+1]/3,xt=wt-bt,B11=(ve,_e,be)=>{this._callback(ve,_e,fe,be)},{vertexData:St,vertexStride:Et,indexData:Pt,_intersectionOptions:Ot}=this,{normalRequired:At}=Ot;if(xt>Dfe){let ve=Be[fe];null==ve&&(ve=new Pfe(fe,St,Et,Pt,bt,wt,this.geometryMinZ,Oe,be),Be[fe]=ve),ve.intersectRay(Je,Qe,Ze,_e?0:$t,B11,At)}else o$z(Je,De,bt,wt,Pt,St,Et,_e?0:$t,Oe,At,B11)}};const Ofe=i$3t(),Afe=[0,0,0],Mfe=[0,0,0],Rfe=[0,0,0],Ife=[0,0,0],y$u=()=>{},Lfe=new CH,Dfe=40;let Nfe=class b16{constructor(fe,ve,_e){this.viewingMode=fe,this.positionData=ve,this._components=_e,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=[0,0,0],this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=ve.indices?t$2F(ve.indices):l$2O(ve.positions.length/3),this._positions=ve.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(fe,ve){const _e=this._ensureComponentAabbs(),be=6*fe;return ve[0]=_e[be],ve[1]=_e[be+1],ve[2]=_e[be+2],ve[3]=_e[be+3],ve[4]=_e[be+4],ve[5]=_e[be+5],ve}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(fe,ve){ve.indices=this._indices,ve.data=this._positions,ve.stride=3,ve.startIndex=this._components.offsets[fe],ve.endIndex=this._components.offsets[fe+1]}intersect(fe,ve,_e,be,we,Se,Te,Ee){this.verticalOffset=be,this.componentVerticalOffsets=we;const{position:Ce}=Se,Oe=Ki(Ffe,fe,Ce),Re=Ki(zfe,ve,Ce),De=s$3F(kfe,Se.rotationScale);S$1P(Oe,Oe,De),S$1P(Re,Re,De);const Be=u$3n(Vfe,De);if(this.viewingMode===Wf.Global){const fe=this._planetCenter;j$1O(fe,Ce),S$1P(fe,fe,De)}this._intersectComponents(Oe,Re,we,be,((fe,ve,_e,be)=>{Ee(_e,fe,be?S$1P(Ufe,be,Be):null,ve)}),_e,Te)}_computePerComponentAabbs(){const fe=this._aabb,ve=.5*(fe[0]+fe[3]),_e=.5*(fe[1]+fe[4]),be=.5*(fe[2]+fe[5]),we=this._components.count,Se=t$2G(6*we),Te=this._indices,Ee=this._positions,Ce=this._components.offsets;let Oe=0,Re=1/0,De=1/0,Be=1/0,Ze=-1/0,Xe=-1/0,Je=-1/0;for(let Qe=0;Qe<we;Qe++){const fe=Ce[Qe],we=Ce[Qe+1];let dt=1/0,$t=1/0,bt=1/0,wt=-1/0,xt=-1/0,St=-1/0;if(fe<we)for(let ve=fe;ve<we;ve++){const fe=3*Te[ve],_e=Ee[fe],be=Ee[fe+1],we=Ee[fe+2];dt=Math.min(dt,_e),$t=Math.min($t,be),bt=Math.min(bt,we),wt=Math.max(wt,_e),xt=Math.max(xt,be),St=Math.max(St,we)}else dt=ve,$t=_e,bt=be,wt=ve,xt=_e,St=be;Se[Oe++]=dt,Se[Oe++]=$t,Se[Oe++]=bt,Se[Oe++]=wt,Se[Oe++]=xt,Se[Oe++]=St,Re=Math.min(Re,dt),De=Math.min(De,$t),Be=Math.min(Be,bt),Ze=Math.max(Ze,wt),Xe=Math.max(Xe,xt),Je=Math.max(Je,St)}return this._aabb[0]=Re,this._aabb[1]=De,this._aabb[2]=Be,this._aabb[3]=Ze,this._aabb[4]=Xe,this._aabb[5]=Je,Se}_intersectComponents(fe,ve,_e,be,we,Se,Te){let Ee=this._componentBvh;null==Ee&&(Ee=new Cfe(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=Ee),Ee.intersectRay(fe,ve,_e,be,we,Se,Te)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Wf.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const Ffe=[0,0,0],zfe=[0,0,0],kfe=[1,0,0,0,1,0,0,0,1],Ufe=[0,0,0],Vfe=[1,0,0,0,1,0,0,0,1];let Bfe=class t72{constructor(fe,ve,_e){this.material=fe,this.geometry=ve,this.meta=_e}destroy(){this.material.dispose(),this.geometry.dispose()}},jfe=class s71{constructor(fe,ve,_e,be){this.vao=fe,this.primitiveType=ve,this.parameters=_e,this.indexed=be}dispose(){this.vao.dispose()}},Gfe=class r52{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function a$12(fe){return function n$17(fe,ve){return{near:fe,far:ve}}(1/0,-1/0)}function t$T(fe,ve,_e){return fe.near=ve,fe.far=_e,fe}function e$N(fe,ve){null!=ve&&(fe.near=Math.min(fe.near,ve.near),fe.far=Math.max(fe.far,ve.far))}function f$D(fe,ve){return fe.near<=ve&&ve<=fe.far}const Hfe={near:0,far:0};function w$o(fe,ve){const _e=a$12(),{eye:be,frustum:we,viewForward:Se}=fe;ve.forAll((fe=>{const ve=null!=fe.offsetObb?fe.offsetObb:fe.obb,Te=P$1g(Ki(rme,ve.center,be),Se),Ee=ve.projectedRadius(Se);if(f$D(_e,Te-Ee)&&f$D(_e,Te+Ee))return;const Ce=function M$e(fe,ve){let _e=0;for(let be=0;be<Kfe;be++){const we=fe.intersectPlane(ve[be]);if(we>0)return-1;0===we&&(_e|=1<<be)}return _e}(ve,we);if(-1===Ce)return;if(0===Ce)return Wfe.far=Te+Ee,Wfe.near=Te-Ee,void e$N(_e,Wfe);const Oe=qfe.pushNew();Oe.near=Te-Ee,Oe.far=Te+Ee,Oe.mask=Ce,Oe.object=fe}));for(let Te=0;Te<qfe.length;Te++){const fe=qfe.data[Te];if(f$D(_e,fe.near)&&f$D(_e,fe.far))continue;Wfe.far=fe.far,Wfe.near=1/0;0===R$f(null!=fe.object.offsetObb?fe.object.offsetObb:fe.object.obb,be,Xfe,(ve=>{let _e=Jfe;for(let be=0;be<Kfe&&ve.length>0;be++){if(!(fe.mask&1<<be))continue;z$6(we[be],ve,_e);const Se=ve;ve=_e,_e=Se}for(let fe=0;fe<ve.length;fe+=3){o$44(Yfe,ve.data[fe],ve.data[fe+1],ve.data[fe+2]);const _e=P$1g(Ki(Yfe,Yfe,be),Se);Wfe.near=Math.min(Wfe.near,_e)}}))&&(Wfe.near=0),e$N(_e,Wfe)}return qfe.length=0,_e}const qfe=new jr({allocator:fe=>fe||{near:1/0,far:-1/0,mask:0,object:null},deallocator:fe=>(fe.object=null,fe)}),Wfe=a$12(),Yfe=[0,0,0],Zfe=[0,0,0],Xfe=new jr({deallocator:null}),Jfe=new jr({deallocator:null});function z$6(fe,ve,_e){_e.length=0;const be=ve.length-3;A$l(Yfe,ve,be);const we=V$12(fe,Yfe);we<=0&&(_e.push(Yfe[0]),_e.push(Yfe[1]),_e.push(Yfe[2]));let Se=0,Te=we;for(;Se<be;Se+=3){A$l(Zfe,ve,Se);const be=V$12(fe,Zfe);Te*be<0&&(A$1G(Yfe,Zfe,Yfe,be/(be-Te)),P$b(_e,Yfe)),be<=0&&P$b(_e,Zfe),Te=be,r$3w(Yfe,Zfe)}Te*we<0&&(A$l(Zfe,ve,be),A$1G(Yfe,Zfe,Yfe,we/(we-Te)),P$b(_e,Yfe))}function A$l(fe,ve,_e){return o$44(fe,ve.data[_e],ve.data[_e+1],ve.data[_e+2])}function P$b(fe,ve){fe.push(ve[0]),fe.push(ve[1]),fe.push(ve[2])}function R$f(fe,ve,_e,be){O$1e(tme,fe.quaternion),Ki(rme,ve,fe.center),E$1O(rme,rme,tme);const we=fe.halfSize,Se=8*((rme[0]<-we[0]?-1:rme[0]>we[0]?1:0)+3*(rme[1]<-we[1]?-1:rme[1]>we[1]?1:0)+9*(rme[2]<-we[2]?-1:rme[2]>we[2]?1:0)+13),Te=Qfe[Se];if(0===Te)return Te;p$4p(eme,fe.quaternion),f$2D(eme,eme,fe.halfSize);const p48=(ve,_e)=>{const be=Qfe[Se+_e+1];return o$44(ve,((1&be)<<1)-1,(2&be)-1,((4&be)>>1)-1),S$1P(ve,ve,eme),u$3Y(ve,fe.center,ve)};return _e.length=0,P$b(_e,p48(ime,0)),P$b(_e,p48(nme,1)),P$b(_e,p48(rme,2)),P$b(_e,p48(sme,3)),be(_e),1===Te||(_e.length=0,P$b(_e,ime),P$b(_e,sme),P$b(_e,p48(rme,4)),P$b(_e,p48(ome,5)),be(_e),2===Te||(_e.length=0,P$b(_e,ime),P$b(_e,ome),P$b(_e,p48(rme,6)),P$b(_e,nme),be(_e))),Te}const Qfe=(()=>{const fe=new Array(216);let ve=0;const r65=_e=>{for(let be=0;be<_e.length;be++)fe[ve+be]=_e[be];ve+=8};return r65([3,0,6,2,3,1,5,4]),r65([2,0,2,3,1,5,4,0]),r65([3,1,0,2,3,7,5,4]),r65([2,0,1,3,2,6,4,0]),r65([1,0,1,3,2,0,0,0]),r65([2,1,5,7,3,2,0,0]),r65([3,2,0,1,3,7,6,4]),r65([2,2,0,1,3,7,6,0]),r65([3,3,0,1,5,7,6,2]),r65([2,0,1,5,4,6,2,0]),r65([1,0,1,5,4,0,0,0]),r65([2,1,3,7,5,4,0,0]),r65([1,0,2,6,4,0,0,0]),r65([0,0,0,0,0,0,0,0]),r65([1,1,3,7,5,0,0,0]),r65([2,2,3,7,6,4,0,0]),r65([1,2,3,7,6,0,0,0]),r65([2,3,1,5,7,6,2,0]),r65([3,4,0,1,5,7,6,2]),r65([2,5,7,6,4,0,1,0]),r65([3,5,0,1,3,7,6,4]),r65([2,4,5,7,6,2,0,0]),r65([1,4,5,7,6,0,0,0]),r65([2,5,1,3,7,6,4,0]),r65([3,6,0,2,3,7,5,4]),r65([2,6,2,3,7,5,4,0]),r65([3,7,6,2,3,1,5,4]),fe})(),Kfe=4;const eme=[1,0,0,0,1,0,0,0,1],tme=[0,0,0,1],rme=[0,0,0],ime=[0,0,0],nme=[0,0,0],sme=[0,0,0],ome=[0,0,0];let ame=class e60{constructor(fe){this._objects=fe}submit(fe,ve){this._objects.preSubmit(ve),this._objects.visibleObjects.forAll((_e=>_e.renderable.material.submit(fe,ve,_e)))}queryShadowCasterDepthRange(fe){return this._objects.visibleObjects.length?w$o(fe,this._objects.visibleObjects):null}};function o$x(fe){const ve=H$J().vec3f(nO.POSITION);return fe.hasNormals&&ve.vec2i16(nO.NORMALCOMPRESSED,{glNormalized:!0}),fe.textureCoordinates===sO.Default?ve.vec2f(nO.UV0):fe.textureCoordinates===sO.Atlas&&(ve.vec2f(nO.UV0),ve.vec4u16(nO.UVREGION,{glNormalized:!0})),fe.colors&&ve.vec4u8(nO.COLOR,{glNormalized:!0}),ve}let lme=class s72{constructor(){this.externalColor=[0,0,0,0],this.externalColorMixMode=pH.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var cme,ume,hme;function c$1f(fe,ve){const _e=fe.vertex;switch(_e.code.add(o$2P`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),ve.vertexDiscardMode){case cme.None:_e.code.add(o$2P`#define vertexDiscardByOpacity(_opacity_) {}`);break;case cme.Opaque:_e.code.add(o$2P`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case cme.Transparent:_e.code.add(o$2P`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case cme.COUNT:break;default:ve.vertexDiscardMode}}function a$11(fe){return fe&&f$3b(fe)?ume.Mars:fe&&p$4U(fe)?ume.Moon:ume.Earth}!function(fe){fe[fe.None=0]="None",fe[fe.Transparent=1]="Transparent",fe[fe.Opaque=2]="Opaque",fe[fe.COUNT=3]="COUNT"}(cme||(cme={})),function(fe){fe[fe.Earth=1]="Earth",fe[fe.Mars=2]="Mars",fe[fe.Moon=3]="Moon",fe[fe.COUNT=4]="COUNT"}(ume||(ume={})),function(fe){fe[fe.None=0]="None",fe[fe.NoOverlay=1]="NoOverlay",fe[fe.ColorOverlay=2]="ColorOverlay",fe[fe.ColorOverlayWithWater=3]="ColorOverlayWithWater",fe[fe.COUNT=4]="COUNT"}(hme||(hme={}));let dme=class m27 extends HA{constructor(){super(...arguments),this.output=NI.Color,this.textureCoordinateType=sO.None,this.componentData=$H.Uniform,this.cullFace=vA.Back,this.vertexDiscardMode=cme.None,this.doubleSidedMode=PH.WindingOrder,this.alphaDiscardMode=SA.Opaque,this.integratedMeshMode=hme.None,this.transparencyPassType=WR.NONE,this.ellipsoidMode=ume.Earth,this.pbrMode=yM.Disabled,this.normalType=wH.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};function l$$(fe,ve){fe.include(e$24,ve),fe.fragment.include(i$2c);const _e=fe.fragment;_e.uniforms.add(new vH("baseColor",(fe=>fe.baseColor))),_e.uniforms.add(new rq("objectOpacity",(fe=>fe.objectOpacity))),ve.hasVertexColors?_e.code.add(o$2P`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):_e.code.add(o$2P`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),_e.code.add(o$2P`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function l$_(fe,ve){const _e=fe.fragment;switch(ve.doubleSidedMode){case PH.None:_e.code.add(o$2P`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case PH.View:fe.include(v$1b,ve),_e.code.add(o$2P`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case PH.WindingOrder:_e.code.add(o$2P`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:ve.doubleSidedMode;case PH.COUNT:}switch(ve.normalType){case wH.Attribute:case wH.Compressed:fe.include(n$2u,ve),_e.code.add(o$2P`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case wH.ScreenDerivative:fe.include(v$1b,ve),_e.code.add(o$2P`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case wH.Ground:ve.spherical?(fe.include(v$1b,ve),_e.code.add(o$2P`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):_e.code.add(o$2P`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),_e.code.add(o$2P`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:ve.normalType;case wH.COUNT:}}function d$G(fe,ve){const _e=fe.fragment;if(!ve.hasColorTexture||ve.output!==NI.Color&&ve.alphaDiscardMode===SA.Opaque)_e.code.add(o$2P`vec4 readBaseColorTexture() { return vec4(1.0); }`);else{fe.include(s$2X,ve);const be=ve.textureCoordinateType===sO.Atlas;_e.uniforms.add(new dM("baseColorTexture",(fe=>fe.texture))),be?(fe.include(e$2T),_e.code.add(o$2P`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):_e.code.add(o$2P`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}}function V$c(fe){const ve=new gO;ve.include(v$1b,fe),ve.include(n$2u,fe),ve.include(e$24,fe),ve.include(o$2O,fe),ve.include(n$2S,fe),ve.include(m$1V,fe),ve.include(t$28,fe),ve.include(_$O,fe),ve.include(d$G,fe),ve.include(c$1f,fe);const{vertex:_e,fragment:be}=ve;fe.pbrMode!==yM.Normal&&fe.pbrMode!==yM.Schematic||(ve.include(l$2X,fe),fe.hasNormalTexture&&ve.include(T$I,fe));const we=fe.output===NI.Shadow||fe.output===NI.ShadowHighlight||fe.output===NI.ShadowExcludeHighlight;we&&fe.componentData===$H.Varying?_e.code.add(o$2P`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):_e.code.add(o$2P`#define discardShadows(castShadows) {}`);const Se=fe.integratedMeshMode===hme.ColorOverlay||fe.integratedMeshMode===hme.ColorOverlayWithWater,Te=Se&&fe.output===NI.Color&&fe.pbrMode===yM.WaterOnIntegratedMesh;Se&&(ve.include(p$2l,fe),ve.include(C$H,fe),fe.spherical?_e.code.add(o$2P`
      const float invEllipsoidRadius = ${o$2P.float(1/(fe.ellipsoidMode===ume.Earth?Rn.radius:fe.ellipsoidMode===ume.Mars?In.radius:Ln.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):_e.code.add(o$2P`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),Te&&(ve.varyings.add("tbnTangent","vec3"),ve.varyings.add("tbnBiTangent","vec3"),ve.varyings.add("groundNormal","vec3")),_e.code.add(o$2P`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${fe.output===NI.ObjectAndLayerIdColor?o$2P`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${o$2P.float(yj)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${fe.output===NI.ObjectAndLayerIdColor?o$2P`forwardObjectAndLayerIdColor();`:""}
      ${Te?fe.spherical?o$2P`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:o$2P`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${Se?o$2P`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),fe.output===NI.Color&&(be.include(i$2Y),ve.include(a$2L,fe),ve.include(l$$,fe),ve.include(l$_,fe),ve.include(p$2l,fe),fe.transparencyPassType===WR.ColorAlpha&&(ve.outputs.add("fragColor","vec4",0),ve.outputs.add("fragAlpha","float",1)),fe.receiveShadows?(ve.include(m$1P,fe),be.code.add(o$2P`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):be.code.add(o$2P`float evaluateShadow() { return 0.0; }`),Se&&be.uniforms.add(new CO("ovColorTex",((fe,ve)=>O$E(fe,ve)))),be.code.add(o$2P`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${fe.multipassEnabled?o$2P`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Se?o$2P`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),fe.pbrMode===yM.Normal||fe.pbrMode===yM.Schematic?(a$2$(be),be.code.add(o$2P`
        ${fe.pbrMode===yM.Normal?o$2P`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),fe.hasNormalTexture?be.code.add(o$2P`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):be.code.add(o$2P`vec3 shadingNormal = normalVertex;`),be.code.add(o$2P`${fe.spherical?o$2P`vec3 normalGround = normalize(positionWorld());`:o$2P`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),be.code.add(o$2P`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${fe.snowCover?o$2P`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${Se?o$2P` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(fe.receiveShadows?be.code.add(o$2P`float shadow = evaluateShadow();`):fe.spherical?(h$1o(be),be.code.add(o$2P`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):be.code.add(o$2P`float shadow = 0.0;`),Te&&be.uniforms.add(new CO("ovNormalTex",((fe,ve)=>{var _e;return null==(_e=ve.overlay)?void 0:_e.getTexture(hY.WaterNormal)}))),fe.snowCover&&be.code.add(o$2P`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),be.code.add(o$2P`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${Se?o$2P` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${Te?o$2P`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),be.code.add(o$2P`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${fe.transparencyPassType===WR.ColorAlpha?o$2P`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const Ee=fe.output===NI.Depth;return(Ee||we||fe.output===NI.ViewshedShadow)&&(Ee||ve.include(e$23,fe),be.code.add(o$2P`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Ee?"":o$2P`outputDepth(linearDepth);`}
      }
    `)),fe.output===NI.Normal&&(ve.include(l$_,fe),be.code.add(o$2P`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${fe.normalType===wH.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),fe.output===NI.ObjectAndLayerIdColor&&ve.fragment.code.add(o$2P`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Se?o$2P`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),fe.output===NI.Highlight&&(ve.include(a$2n),be.code.add(o$2P`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Se?o$2P`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),ve}e$4o([r$2w({count:NI.COUNT})],dme.prototype,"output",void 0),e$4o([r$2w({count:sO.COUNT})],dme.prototype,"textureCoordinateType",void 0),e$4o([r$2w({count:$H.COUNT})],dme.prototype,"componentData",void 0),e$4o([r$2w({count:vA.COUNT})],dme.prototype,"cullFace",void 0),e$4o([r$2w({count:cme.COUNT})],dme.prototype,"vertexDiscardMode",void 0),e$4o([r$2w({count:PH.COUNT})],dme.prototype,"doubleSidedMode",void 0),e$4o([r$2w({count:SA.COUNT})],dme.prototype,"alphaDiscardMode",void 0),e$4o([r$2w({count:hme.COUNT})],dme.prototype,"integratedMeshMode",void 0),e$4o([r$2w({count:WR.COUNT})],dme.prototype,"transparencyPassType",void 0),e$4o([r$2w({count:ume.COUNT})],dme.prototype,"ellipsoidMode",void 0),e$4o([r$2w({count:yM.COUNT})],dme.prototype,"pbrMode",void 0),e$4o([r$2w({count:wH.COUNT})],dme.prototype,"normalType",void 0),e$4o([r$2w()],dme.prototype,"spherical",void 0),e$4o([r$2w()],dme.prototype,"doublePrecisionRequiresObfuscation",void 0),e$4o([r$2w()],dme.prototype,"hasVertexColors",void 0),e$4o([r$2w()],dme.prototype,"hasNormals",void 0),e$4o([r$2w()],dme.prototype,"hasSlicePlane",void 0),e$4o([r$2w()],dme.prototype,"hasColorTexture",void 0),e$4o([r$2w()],dme.prototype,"receiveAmbientOcclusion",void 0),e$4o([r$2w()],dme.prototype,"receiveShadows",void 0),e$4o([r$2w()],dme.prototype,"blendingEnabled",void 0),e$4o([r$2w()],dme.prototype,"hasScreenSpaceReflections",void 0),e$4o([r$2w()],dme.prototype,"hasPolygonOffset",void 0),e$4o([r$2w()],dme.prototype,"hasMetallicRoughnessTexture",void 0),e$4o([r$2w()],dme.prototype,"hasEmissionTexture",void 0),e$4o([r$2w()],dme.prototype,"hasOcclusionTexture",void 0),e$4o([r$2w()],dme.prototype,"hasNormalTexture",void 0),e$4o([r$2w()],dme.prototype,"hasOccludees",void 0),e$4o([r$2w()],dme.prototype,"multipassEnabled",void 0),e$4o([r$2w()],dme.prototype,"cullAboveGround",void 0),e$4o([r$2w()],dme.prototype,"hasNormalTextureTransform",void 0),e$4o([r$2w()],dme.prototype,"hasCloudsReflections",void 0),e$4o([r$2w()],dme.prototype,"snowCover",void 0),e$4o([r$2w()],dme.prototype,"objectAndLayerIdColor",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"occlusionPass",void 0),e$4o([r$2w({constValue:oO.Draw})],dme.prototype,"pbrTextureBindType",void 0),e$4o([r$2w({constValue:!0})],dme.prototype,"hasSliceHighlight",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"hasSliceInVertexProgram",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"useCustomDTRExponentForWater",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"hasVertexTangents",void 0),e$4o([r$2w({constValue:!0})],dme.prototype,"supportsTextureAtlas",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"highStepCount",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"instancedDoublePrecision",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"hasModelTransformation",void 0),e$4o([r$2w({constValue:!0})],dme.prototype,"useFillLights",void 0),e$4o([r$2w({constValue:!1})],dme.prototype,"objectAndLayerIdColorInstanced",void 0);const pme=Object.freeze(Object.defineProperty({__proto__:null,build:V$c},Symbol.toStringTag,{value:"Module"}));let fme=class N8 extends fA{initializeConfiguration(fe,ve){ve.spherical=fe.viewingMode===Wf.Global,ve.doublePrecisionRequiresObfuscation=fe.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(fe){return new gA(fe.rctx,N8.shader.get().build(this.configuration),mme)}_setPipelineState(fe){const ve=this.configuration,_e=ve.integratedMeshMode!==hme.None,be=fe===WR.NONE,we=fe===WR.FrontFace;return S$1g({blending:ve.output===NI.Color&&ve.blendingEnabled?be?_j:c$2o(fe):null,culling:h$1V(ve.cullFace),depthTest:{func:f$1O(fe)},depthWrite:be||we?OA:null,drawBuffers:ve.output===NI.Depth?{buffers:[sA.NONE]}:s$2m(fe),colorWrite:AA,stencilWrite:_e||ve.hasOccludees?qH:null,stencilTest:_e?u$1Y(wA.IntegratedMeshMaskExcluded):ve.hasOccludees?YH:null,polygonOffset:be||we?ve.hasPolygonOffset?{factor:2,units:2}:null:wj})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};fme.shader=new LO(pme,(()=>zt((()=>Promise.resolve().then((()=>bRe))),void 0)));const mme=new Map([[nO.POSITION,0],[nO.NORMAL,1],[nO.NORMALCOMPRESSED,1],[nO.COLOR,2],[nO.UV0,3],[nO.UVREGION,4],[nO.COMPONENTINDEX,5]]);let yme=class e61 extends iO{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const fe of this._parameterBlocks)this[fe]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const fe of this._parameterBlocks)if(this[fe].dirty)return!0;return!1}},gme=class r53{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function s$V(fe={}){return(ve,_e)=>{const be=ve._parameterCount??0;if(ve._parameterCount=be+1,fe.vectorOps){const we=fe.vectorOps;Object.defineProperty(ve,_e,{get(){return this[be]},set(fe){const ve=this[be];if(null==ve)this[be]=fe;else{if(we.equals(ve,fe))return;we.copy(ve,fe)}this._setDirty()}})}else Object.defineProperty(ve,_e,{get(){return this[be]},set(ve){this[be]!==ve&&(fe.dispose&&this[be]&&this[be].dispose(),this[be]=ve,this._setDirty())}})}}function i$10(){return(fe,ve)=>{const _e=fe._parameterCount??0;fe._parameterCount=_e+1,fe._parameterBlocks=fe._parameterBlocks||[],fe._parameterBlocks.push(_e),Object.defineProperty(fe,ve,{get(){return this[_e]},set(fe){this[_e]!==fe&&(this[_e]=fe,this._setDirty())}})}}let vme=class e62{constructor(fe){this._low=[0,0,0],this._high=[0,0,0],fe&&this.set(fe)}get low(){return this._low}get high(){return this._high}set(fe){r$3w(this._low,r$3w(_me,fe));const ve=Ki(_me,fe,this._low);r$3w(this._high,ve)}get(fe){return u$3Y(fe,this._low,this._high)}getLowScaled(fe){return g$2z(fe,this._low,1)}};const _me=n$2Y();let $me=class R6 extends yme{constructor(fe,ve){super(),this.toMapSpace=ve,this.baseColor=r$35(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=e$3$(QH),this.emissiveFactor=r$3y(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new xme,this.componentParameters=new Sme,this.textureAlphaCutoff=mj,this.alphaDiscardMode=SA.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=ume.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new dme;const _e=new vme(fe.position),be=r$38(fe.rotationScale);s$3F(be,be),u$3n(be,be),this.transformNormalGlobalFromModel=be,this.transformWorldFromModelTL=_e.low,this.transformWorldFromModelTH=_e.high,this.transformWorldFromModelRS=fe.rotationScale}dispose(){this._technique=t$4r(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:null}get textureOcclusion(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(fe,ve,_e,be){const we=this._techniqueConfiguration;we.hasVertexColors=be.colors,we.hasNormals=be.hasNormals,we.textureCoordinateType=be.textureCoordinates,we.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture,we.hasEmissionTexture=null!=this.emissionTexture,we.hasOcclusionTexture=null!=this.occlusionTexture,we.hasNormalTexture=null!=this.normalTexture,we.transparencyPassType=ve.identifier===yY.Material&&null!=_e.transparencyPassType?_e.transparencyPassType:WR.NONE,we.multipassEnabled=ve.identifier===yY.Material&&_e.multipassEnabled,we.cullAboveGround=ve.identifier===yY.Material&&_e.multipassTerrain.cullAboveGround,we.ellipsoidMode=this.ellipsoidMode,we.componentData=this.componentParameters.type,we.cullFace=this.commonMaterialParameters.cullFace,we.doubleSidedMode=this.commonMaterialParameters.doubleSided?PH.View:PH.None,we.hasColorTexture=null!=this.baseColorTexture;const Se=this._computeWhichMaterialPass();if(we.blendingEnabled=Se===bme.Transparent||Se===bme.OpaqueAndTransparent,we.alphaDiscardMode=this.alphaDiscardMode,we.integratedMeshMode=this.isIntegratedMesh?function L$8(fe){var ve;return null!=(null==(ve=fe.overlay)?void 0:ve.getTexture(hY.ColorNoRasterImage))}(_e)?function B$7(fe){var ve;return null!=(null==(ve=fe.overlay)?void 0:ve.getTexture(hY.WaterNormal))}(_e)?hme.ColorOverlayWithWater:hme.ColorOverlay:hme.NoOverlay:hme.None,we.hasPolygonOffset=this.polygonOffsetEnabled,we.pbrMode=we.integratedMeshMode===hme.ColorOverlayWithWater?yM.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?be.needsNormals&&this.isIntegratedMesh?yM.Disabled:yM.Schematic:yM.Normal:yM.Disabled,we.normalType=be.needsNormals?we.hasNormals?wH.Compressed:wH.ScreenDerivative:wH.Ground,we.hasSlicePlane=null!=_e.slicePlane&&this.commonMaterialParameters.hasSlicePlane,ve.identifier===yY.ShadowMap)we.output=NI.Shadow,we.vertexDiscardMode=cme.None;else if(ve.identifier===yY.ViewshedShadowMap)we.output=NI.ViewshedShadow,we.vertexDiscardMode=cme.None;else if(ve.identifier===yY.Highlight)we.output=NI.Highlight,we.vertexDiscardMode=cme.None;else{switch(Se===bme.OpaqueAndTransparent?we.vertexDiscardMode=ve.transparent?cme.Opaque:cme.Transparent:we.vertexDiscardMode=cme.None,we.output=ve.output,we.receiveAmbientOcclusion=!1,we.receiveShadows=!1,ve.output){case NI.Color:we.receiveAmbientOcclusion=null!=_e.ssao,we.hasOccludees=_e.hasOccludees,we.receiveShadows=_e.shadowMap.ready,we.hasScreenSpaceReflections=null!=_e.ssr.lastFrameColor,we.hasCloudsReflections=null!=_e.cloudsFade.data;break;case NI.ObjectAndLayerIdColor:we.objectAndLayerIdColor=!0}we.snowCover=this.hasSnowCover(_e)}return this._technique=fe.releaseAndAcquire(fme,we,this._technique),this._setClean(),this._technique}hasSnowCover(fe){return null!=fe.weather&&fe.weatherVisible&&"snowy"===fe.weather.type&&"enabled"===fe.weather.snowCover}submit(fe,ve,_e){if(0===this.objectOpacity)return;const be=_e.renderable.geometry,we=_e.components,Se=_e.renderable.meta.cameraDepthSquared,Te=we.geometryRanges,Ee=we.highlightRanges,Ce=we.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case bme.Opaque:fe.materialOpaque.submitDraw(this,be,Te,Se);break;case bme.Transparent:fe.materialTransparent.submitDraw(this,be,Te,Se);break;case bme.OpaqueAndTransparent:fe.materialOpaque.submitDraw(this,be,Te,Se),fe.materialTransparent.submitDraw(this,be,Te,Se);break;case bme.IntegratedMesh:fe.materialIntegratedMesh.submitDraw(this,be,Te,Se),function k$a(fe){var ve;return null!=(null==(ve=fe.overlay)?void 0:ve.getTexture(hY.Highlight))}(ve)&&fe.highlightIntegratedMesh.submitDraw(this,be,Te,Se)}const Oe=this.componentParameters.castShadows!==wme.None;Oe&&fe.shadowMap.submitDraw(this,be,Te,Se),null!=Ee&&(fe.highlight.submitDraw(this,be,Ee,Se),Oe&&fe.highlightShadowMap.submitDraw(this,be,Ee,Se)),ve.viewshedEnabled&&fe.viewshedShadowMap.submitDraw(this,be,Te,Se),Oe&&null!=Ce&&fe.defaultShadowMap.submitDraw(this,be,Ce,Se)}_computeWhichMaterialPass(){return this.isIntegratedMesh?bme.IntegratedMesh:this.objectOpacity<1?bme.Transparent:this.componentParameters.opaqueOverride===wme.All?bme.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===SA.Blend||this.alphaDiscardMode===SA.MaskBlend?bme.Transparent:this.componentParameters.transparent===wme.None?bme.Opaque:this.componentParameters.transparent===wme.All?bme.Transparent:bme.OpaqueAndTransparent}};var bme,wme;e$4o([s$V({vectorOps:Ud})],$me.prototype,"baseColor",void 0),e$4o([s$V()],$me.prototype,"usePBR",void 0),e$4o([s$V()],$me.prototype,"hasParametersFromSource",void 0),e$4o([s$V({vectorOps:fn})],$me.prototype,"mrrFactors",void 0),e$4o([s$V({vectorOps:fn})],$me.prototype,"emissiveFactor",void 0),e$4o([s$V({dispose:!0})],$me.prototype,"baseColorTexture",void 0),e$4o([s$V({dispose:!0})],$me.prototype,"metallicRoughnessTexture",void 0),e$4o([s$V({dispose:!0})],$me.prototype,"emissionTexture",void 0),e$4o([s$V({dispose:!0})],$me.prototype,"occlusionTexture",void 0),e$4o([s$V({dispose:!0})],$me.prototype,"normalTexture",void 0),e$4o([s$V()],$me.prototype,"objectOpacity",void 0),e$4o([i$10()],$me.prototype,"commonMaterialParameters",void 0),e$4o([i$10()],$me.prototype,"componentParameters",void 0),e$4o([s$V()],$me.prototype,"textureAlphaCutoff",void 0),e$4o([s$V()],$me.prototype,"alphaDiscardMode",void 0),e$4o([s$V()],$me.prototype,"isIntegratedMesh",void 0),e$4o([s$V()],$me.prototype,"polygonOffsetEnabled",void 0),e$4o([s$V()],$me.prototype,"ellipsoidMode",void 0),e$4o([s$V()],$me.prototype,"hasOccludees",void 0),function(fe){fe[fe.Opaque=0]="Opaque",fe[fe.Transparent=1]="Transparent",fe[fe.OpaqueAndTransparent=2]="OpaqueAndTransparent",fe[fe.IntegratedMesh=3]="IntegratedMesh"}(bme||(bme={}));let xme=class E9 extends gme{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=vA.Back,this.hasSlicePlane=!0}};e$4o([s$V()],xme.prototype,"doubleSided",void 0),e$4o([s$V()],xme.prototype,"cullFace",void 0),e$4o([s$V()],xme.prototype,"hasSlicePlane",void 0);let Sme=class W2 extends gme{constructor(){super(...arguments),this.externalColor=r$35(1,1,1,1),this.externalColorMixMode=pH.Multiply,this.castShadows=wme.All}get transparent(){return this.externalColor[3]<1?wme.All:wme.None}get opaqueOverride(){return this.externalColorMixMode===pH.Replace&&1===this.externalColor[3]?wme.All:wme.None}get visible(){return this.externalColor[3]>0?wme.All:wme.None}get type(){return $H.Uniform}};e$4o([s$V({vectorOps:Ud})],Sme.prototype,"externalColor",void 0),e$4o([s$V()],Sme.prototype,"externalColorMixMode",void 0),e$4o([s$V()],Sme.prototype,"castShadows",void 0),function(fe){fe[fe.All=0]="All",fe[fe.Some=1]="Some",fe[fe.None=2]="None"}(wme||(wme={}));let Tme=class _15 extends gme{constructor(){super(...arguments),this.texture=null,this.transparent=wme.None,this.opaqueOverride=wme.None,this.castShadows=wme.None}get type(){return $H.Varying}};e$4o([s$V()],Tme.prototype,"texture",void 0),e$4o([s$V()],Tme.prototype,"transparent",void 0),e$4o([s$V()],Tme.prototype,"opaqueOverride",void 0),e$4o([s$V()],Tme.prototype,"castShadows",void 0);const Eme=H$J().vec3f(nO.POSITION).u16(nO.COMPONENTINDEX).freeze(),Pme=H$J().vec2u8(nO.SIDENESS).freeze(),Cme=t$2L(Pme),Ome=H$J().vec3f(nO.POSITION0).vec3f(nO.POSITION1).vec2i16(nO.NORMALCOMPRESSED).u16(nO.COMPONENTINDEX).u8(nO.VARIANTOFFSET,{glNormalized:!0}).u8(nO.VARIANTSTROKE).u8(nO.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Ame=H$J().vec3f(nO.POSITION0).vec3f(nO.POSITION1).vec2i16(nO.NORMALCOMPRESSED).vec2i16(nO.NORMAL2COMPRESSED).u16(nO.COMPONENTINDEX).u8(nO.VARIANTOFFSET,{glNormalized:!0}).u8(nO.VARIANTSTROKE).u8(nO.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Mme=new Map([[nO.POSITION0,0],[nO.POSITION1,1],[nO.COMPONENTINDEX,2],[nO.VARIANTOFFSET,3],[nO.VARIANTSTROKE,4],[nO.VARIANTEXTENSION,5],[nO.NORMALCOMPRESSED,6],[nO.NORMAL2COMPRESSED,7],[nO.SIDENESS,8]]);function t$R(fe,ve,_e){const be=ve/3,we=new Uint32Array(_e+1),Se=new Uint32Array(_e+1),s84=(fe,ve)=>{fe<ve?we[fe+1]++:Se[ve+1]++};for(let De=0;De<be;De++){const ve=fe[3*De],_e=fe[3*De+1],be=fe[3*De+2];s84(ve,_e),s84(_e,be),s84(be,ve)}let Te=0,Ee=0;for(let De=0;De<_e;De++){const fe=we[De+1],ve=Se[De+1];we[De+1]=Te,Se[De+1]=Ee,Te+=fe,Ee+=ve}const Ce=new Uint32Array(6*be),Oe=we[_e],w9=(fe,ve,_e)=>{if(fe<ve){const be=we[fe+1]++;Ce[2*be]=ve,Ce[2*be+1]=_e}else{const be=Se[ve+1]++;Ce[2*Oe+2*be]=fe,Ce[2*Oe+2*be+1]=_e}};for(let De=0;De<be;De++){const ve=fe[3*De],_e=fe[3*De+1],be=fe[3*De+2];w9(ve,_e,De),w9(_e,be,De),w9(be,ve,De)}const y16=(fe,ve)=>{const _e=2*fe,be=ve-fe;for(let we=1;we<be;we++){const fe=Ce[_e+2*we],ve=Ce[_e+2*we+1];let be=we-1;for(;be>=0&&Ce[_e+2*be]>fe;be--)Ce[_e+2*be+2]=Ce[_e+2*be],Ce[_e+2*be+3]=Ce[_e+2*be+1];Ce[_e+2*be+2]=fe,Ce[_e+2*be+3]=ve}};for(let De=0;De<_e;De++)y16(we[De],we[De+1]),y16(Oe+Se[De],Oe+Se[De+1]);const Re=new Int32Array(3*be),U10=(ve,_e)=>ve===fe[3*_e]?0:ve===fe[3*_e+1]?1:ve===fe[3*_e+2]?2:-1,u30=(fe,ve)=>{const _e=U10(fe,ve);Re[3*ve+_e]=-1},p48=(fe,ve,_e,be)=>{const we=U10(fe,ve);Re[3*ve+we]=be;const Se=U10(_e,be);Re[3*be+Se]=ve};for(let De=0;De<_e;De++){let fe=we[De];const ve=we[De+1];let _e=Se[De];const be=Se[De+1];for(;fe<ve&&_e<be;){const ve=Ce[2*fe],be=Ce[2*Oe+2*_e];ve===be?(p48(De,Ce[2*fe+1],be,Ce[2*Oe+2*_e+1]),fe++,_e++):ve<be?(u30(De,Ce[2*fe+1]),fe++):(u30(be,Ce[2*Oe+2*_e+1]),_e++)}for(;fe<ve;)u30(De,Ce[2*fe+1]),fe++;for(;_e<be;)u30(Ce[2*Oe+2*_e],Ce[2*Oe+2*_e+1]),_e++}return Re}let Rme=class f20{updateSettings(fe){this.settings=fe,this._edgeHashFunction=fe.reducedPrecision?d$F:l$Z}write(fe,ve,_e){Ume.seed=this._edgeHashFunction(_e);const be=Ume.getIntRange(0,255),we=Ume.getIntRange(0,this.settings.variants-1),Se=Ume.getFloat(),Te=255*(.5*function y$s(fe,ve){return Math.abs(fe)**ve*Math.sign(fe)}(-(1-Math.min(Se/.7,1))+Math.max(0,Se-.7)/(1-.7),1.2)+.5);fe.position0.setVec(ve,_e.position0),fe.position1.setVec(ve,_e.position1),fe.componentIndex.set(ve,_e.componentIndex),fe.variantOffset.set(ve,be),fe.variantStroke.set(ve,we),fe.variantExtension.set(ve,Te)}};const Ime=new Float32Array(6),Lme=new Uint32Array(Ime.buffer),Dme=new Uint32Array(1);function l$Z(fe){return Ime[0]=fe.position0[0],Ime[1]=fe.position0[1],Ime[2]=fe.position0[2],Ime[3]=fe.position1[0],Ime[4]=fe.position1[1],Ime[5]=fe.position1[2],Dme[0]=31*(31*(31*(31*(31*(166811+Lme[0])+Lme[1])+Lme[2])+Lme[3])+Lme[4])+Lme[5],Dme[0]}function d$F(fe){const ve=Ime;ve[0]=h$v(fe.position0[0]),ve[1]=h$v(fe.position0[1]),ve[2]=h$v(fe.position0[2]),ve[3]=h$v(fe.position1[0]),ve[4]=h$v(fe.position1[1]),ve[5]=h$v(fe.position1[2]),Dme[0]=5381;for(let _e=0;_e<Lme.length;_e++)Dme[0]=31*Dme[0]+Lme[_e];return Dme[0]}const Nme=1e4;function h$v(fe){return Math.round(fe*Nme)/Nme}let Fme=class w6{constructor(){this._commonWriter=new Rme}updateSettings(fe){this._commonWriter.updateSettings(fe)}allocate(fe){return Ome.createBuffer(fe)}write(fe,ve,_e){this._commonWriter.write(fe,ve,_e),u$3Y(kme,_e.faceNormal0,_e.faceNormal1),z$1d(kme,kme);const{typedBuffer:be,typedBufferStride:we}=fe.normalCompressed;s$1T(be,ve,kme[0],kme[1],kme[2],we)}};Fme.Layout=Ome,Fme.glLayout=t$2L(Ome,1);let zme=class N9{constructor(){this._commonWriter=new Rme}updateSettings(fe){this._commonWriter.updateSettings(fe)}allocate(fe){return Ame.createBuffer(fe)}write(fe,ve,_e){this._commonWriter.write(fe,ve,_e);{const{typedBuffer:be,typedBufferStride:we}=fe.normalCompressed;s$1T(be,ve,_e.faceNormal0[0],_e.faceNormal0[1],_e.faceNormal0[2],we)}{const{typedBuffer:be,typedBufferStride:we}=fe.normal2Compressed;s$1T(be,ve,_e.faceNormal1[0],_e.faceNormal1[1],_e.faceNormal1[2],we)}}};zme.Layout=Ame,zme.glLayout=t$2L(Ame,1);const kme=[0,0,0],Ume=new Gt;const Vme=-1;function p$1s(fe,ve,_e){const be=fe.vertices.position,we=fe.vertices.componentIndex,Se=qme.position0,Te=qme.position1,Ee=qme.faceNormal0,Ce=qme.faceNormal1,{edges:Oe,normals:Re}=function w$m(fe){const ve=fe.faces.length/3,_e=fe.faces,be=fe.neighbors,we=fe.vertices.position;Gme.length=Hme.length=0;for(let Se=0;Se<ve;Se++){const fe=3*Se,ve=be[fe],Te=be[fe+1],Ee=be[fe+2],Ce=_e[fe],Oe=_e[fe+1],Re=_e[fe+2];we.getVec(Ce,Zme),we.getVec(Oe,Xme),we.getVec(Re,Jme),e$3Z(Xme,Xme,Zme),e$3Z(Jme,Jme,Zme),_$1z(Zme,Xme,Jme),z$1d(Zme,Zme),Hme.pushArray(Zme),(ve===Vme||Ce<Oe)&&(Gme.push(Ce),Gme.push(Oe),Gme.push(Se),Gme.push(ve)),(Te===Vme||Oe<Re)&&(Gme.push(Oe),Gme.push(Re),Gme.push(Se),Gme.push(Te)),(Ee===Vme||Re<Ce)&&(Gme.push(Re),Gme.push(Ce),Gme.push(Se),Gme.push(Ee))}return{edges:Gme,normals:Hme}}(fe),De=Oe.length/4,Be=ve.allocate(De);let Ze=0;const Xe=De,Je=null==_e?void 0:_e.allocate(Xe);let Qe=0,dt=0,$t=0;jme.length=0;for(let Pt=0;Pt<De;++Pt){const fe=4*Pt;be.getVec(Oe.data[fe],Se),be.getVec(Oe.data[fe+1],Te);const ve=jme.pushNew();ve.index=4*Pt,ve.length=x$1W(Se,Te)}jme.sort(((fe,ve)=>ve.length-fe.length));const bt=new Array,wt=new Array;jme.forAll((({length:fe,index:De})=>{const Xe=Oe.data[De],xt=Oe.data[De+1],St=Oe.data[De+2],Et=Oe.data[De+3],Pt=Et===Vme;if(be.getVec(Xe,Se),be.getVec(xt,Te),Pt){const fe=3*St;o$44(Ee,Re.data[fe],Re.data[fe+1],Re.data[fe+2]),r$3w(Ce,Ee),qme.componentIndex=we.get(Xe),qme.cosAngle=P$1g(Ee,Ce)}else{let fe=3*St;if(o$44(Ee,Re.data[fe],Re.data[fe+1],Re.data[fe+2]),fe=3*Et,o$44(Ce,Re.data[fe],Re.data[fe+1],Re.data[fe+2]),qme.componentIndex=we.get(Xe),qme.cosAngle=P$1g(Ee,Ce),function m$R(fe,ve){return fe.cosAngle>ve}(qme,Kme))return;qme.cosAngle<-.9999&&r$3w(Ce,Ee)}dt+=fe,$t++,Pt||function f$B(fe,ve){return fe.cosAngle<ve}(qme,tye)?(ve.write(Be,Ze++,qme),bt.push(fe)):function A$j(fe,ve){const _e=m$3J(fe.cosAngle);return J$M(Yme,fe.position1,fe.position0),_e*(P$1g(_$1z(Wme,fe.faceNormal0,fe.faceNormal1),Yme)>0?-1:1)>ve}(qme,Qme)&&(Je&&_e&&_e.write(Je,Qe++,qme),wt.push(fe))}));const xt=new Float32Array(bt.reverse()),St=new Float32Array(wt.reverse()),Et=Je&&_e?{instancesData:Je.slice(0,Qe),lodInfo:{lengths:St}}:void 0;return{regular:{instancesData:Be.slice(0,Ze),lodInfo:{lengths:xt}},silhouette:Et,averageEdgeLength:dt/$t}}let Bme=class v13{constructor(){this.index=0,this.length=0}};const jme=new jr({allocator:fe=>fe||new Bme,deallocator:null}),Gme=new jr({deallocator:null}),Hme=new jr({deallocator:null}),qme=new class s73{constructor(){this.position0=[0,0,0],this.position1=[0,0,0],this.faceNormal0=[0,0,0],this.faceNormal1=[0,0,0],this.componentIndex=0,this.cosAngle=0}},Wme=[0,0,0],Yme=[0,0,0],Zme=[0,0,0],Xme=[0,0,0],Jme=[0,0,0],Qme=h$2U(4),Kme=Math.cos(Qme),eye=h$2U(35),tye=Math.cos(eye);function f$A(fe){const ve=u$L(fe.data,fe.skipDeduplicate,fe.indices,fe.indicesLength);return iye.updateSettings(fe.writerSettings),nye.updateSettings(fe.writerSettings),p$1s(ve,iye,nye)}function u$L(fe,ve,_e,be){if(ve){const ve=t$R(_e,be,fe.count);return new rye(_e,be,ve,fe)}const we=e$1P(fe.buffer,fe.stride/4,{originalIndices:_e,originalIndicesLength:be}),Se=t$R(we.indices,be,we.uniqueCount);return{faces:we.indices,facesLength:we.indices.length,neighbors:Se,vertices:Eme.createView(we.buffer)}}let rye=class p35{constructor(fe,ve,_e,be){this.faces=fe,this.facesLength=ve,this.neighbors=_e,this.vertices=be}};const iye=new Fme,nye=new zme,sye=H$J().vec3f(nO.POSITION0).vec3f(nO.POSITION1),oye=H$J().vec3f(nO.POSITION0).vec3f(nO.POSITION1).u16(nO.COMPONENTINDEX);let aye=class e63{constructor(fe){this._maxCount=fe,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(fe){this._recycledIndices.push(fe)}},lye=class h26{constructor(fe,ve=1){this._rctx=fe,this._fieldCount=ve,this.textureWidth=4096,this._dirty=!0;const _e=new nM(this.textureWidth,1);_e.samplingMode=HO.NEAREST,_e.wrapMode=qO.CLAMP_TO_EDGE,this._texture=new oM(this._rctx,_e),this._data=new xL(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(fe,ve,_e,be,we,Se){const Te=fe*this._fieldCount+ve;this._dirty=!0,this._data.set(Te,0,_e),this._data.set(Te,1,be),this._data.set(Te,2,we),this._data.set(Te,3,Se)}setDataElement(fe,ve,_e,be){const we=fe*this._fieldCount+ve;this._dirty=!0,this._data.set(we,_e,be)}getDataElement(fe,ve,_e){const be=fe*this._fieldCount+ve;return this._dirty=!0,this._data.get(be,_e)}resizeToFit(fe){const ve=(fe+1)*this._fieldCount;if(ve>this._data.count){const fe=Math.ceil(ve/this.textureWidth)*this.textureWidth,_e=new xL(new ArrayBuffer(4*fe));_e.typedBuffer.set(this._data.typedBuffer),this._data=_e}}updateTexture(){if(!this._dirty)return;const fe=this._texture.descriptor.width,ve=this._texture.descriptor.height;this._data.count>fe*ve&&this._texture.resize(fe,this._data.count/fe),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};let cye=class i42{constructor(fe,ve=1){this.textureBuffer=new lye(fe,ve),this._indexManager=new aye(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const fe=this._indexManager.acquire();return this.textureBuffer.resizeToFit(fe),fe}releaseIndex(fe){this._indexManager.release(fe)}},uye=class r54{constructor(fe,ve=1){this._rctx=fe,this._fieldCount=ve,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter((fe=>0!==fe.activeCount||(fe.dispose(),!1)))}destroy(){this._buffers.forEach((fe=>fe.dispose())),this._buffers=[]}getBuffer(fe){for(const _e of this._buffers)if(_e.availableCount>=fe)return _e;if(fe>65536)return null;const ve=new cye(this._rctx,this._fieldCount);return this._buffers.push(ve),ve}updateTextures(){for(const fe of this._buffers)fe.textureBuffer.updateTexture()}};const k$8=()=>ar.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let hye=class q5{constructor(fe,ve){this._renderManager=fe,this._viewingMode=ve,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new jr,this._hidden=new jr,this._renderSubmit=new ame(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=has("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new uye(fe.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){s$31(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll((fe=>fe.destroy())),this._hidden.forAll((fe=>fe.destroy())),this._visible.clear(),this._hidden.clear()}createObject(fe){const ve=fe.geometry,_e=new xfe(this._componentBufferManager,t$2F(ve.componentOffsets)),be=this._createRenderable(fe,_e),we=new Nfe(this._viewingMode,ve.positionData,_e),Se=new Sfe(fe.transform,fe.toMapSpace,fe.obb.clone(),_e,be,we);return(Se.visible?this._visible:this._hidden).push(Se),Se}destroyObject(fe){const ve=fe;(ve.visible?this._visible:this._hidden).removeUnordered(ve),ve.destroy(),this._notifyDirty()}setObjectVisibility(fe,ve){const _e=fe;ve!==_e.visible&&(ve?(this._hidden.removeUnordered(_e),this._visible.push(_e)):(this._visible.removeUnordered(_e),this._hidden.push(_e)),_e.visible=ve,this._notifyDirty())}preSubmit(fe){const ve=fe.camera.eye;this.visibleObjects.forAll((fe=>fe.renderable.meta.cameraDepthSquared=p$4Z(ve,fe.obb.center)))}getMaterial(fe){return fe.renderable.material}updateMaterial(fe,ve){const _e=fe.renderable.material;ve(_e),_e.dirty&&this._notifyDirty()}setAllComponentVisibilities(fe,ve){const _e=fe;_e.components.visibility.reset(ve),_e.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(fe,ve){return fe.components.visibility.forEachComponent(ve)}getComponentCount(fe){const ve=fe,_e=ve.components.visibility.componentCount;return{visible:_e,invisible:ve.components.count-_e}}setComponentData(fe,ve){const _e=fe,be=_e.renderable.material,we=_e.components,Se=we.materialDataBuffer,Te=we.materialDataIndices,Ee=new lme,Ce=Se.textureBuffer,Oe=new Uint8Array(4),Re=new Uint32Array(Oe.buffer);let De=0,Be=0,Ze=0,Xe=we.verticalOffsets,Je=1/0,Qe=-1/0,dt=!1,$t=!1,bt=0;for(let wt=0;wt<we.count;wt++){ve(wt,Ee),De+=+(Ee.externalColor[3]<1),Be+=+(Ee.externalColorMixMode===pH.Replace&&1===Ee.externalColor[3]),Ze+=+Ee.castShadows,r$1T(Ee.externalColor,Ee.externalColorMixMode,Oe),Oe[2]=254&Oe[2]|+Ee.castShadows,Ce.setData(Te[wt],0,Oe[0],Oe[1],Oe[2],Oe[3]),dt||(dt=wt>0&&bt!==Re[0]),bt=Re[0],$t||($t=0!==Ee.elevationOffset),$t&&null==Xe&&(Xe=new Array(wt).fill(0)),null!=Xe&&(Xe[wt]=Ee.elevationOffset),Je=Math.min(Je,Ee.elevationOffset),Qe=Math.max(Qe,Ee.elevationOffset),C$O(Ee.elevationOffset,Oe),Ce.setData(Te[wt],1,Oe[0],Oe[1],Oe[2],Oe[3]);const fe=Ee.objectAndLayerIdColor;null!=fe&&Ce.setData(Te[wt],2,fe[0],fe[1],fe[2],fe[3]),Ee.pickable!==i$11(we.pickability,wt)&&(we.pickability=n$18(we.pickability,we.count,wt,Ee.pickable))}we.verticalOffsets=$t?Xe:null,_e.offsetObb=$t?L$10(_e.obb,Je,Qe,this._viewingMode,_e.offsetObb??_e.obb.clone()):null,dt||$t||this._hasObjectAndLayerId?(be.componentParameters=new Tme,be.componentParameters.castShadows=H$6(Ze,we.count),be.componentParameters.transparent=H$6(De,we.count),be.componentParameters.opaqueOverride=H$6(Be,we.count),be.componentParameters.texture=Ce,Ce.updateTexture()):(be.componentParameters=new Sme,be.componentParameters.castShadows=Ee.castShadows?wme.All:wme.None,be.componentParameters.externalColor=Ee.externalColor,be.componentParameters.externalColorMixMode=Ee.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(fe,ve,_e,be=!1){fe.intersectionGeometry.getComponentAabb(ve,_e);const we=fe,Se=we.components.verticalOffsets;if(be||null==Se)return _e;const Te=Se[ve];if(this._viewingMode===Wf.Local||0===Te)return _e[2]+=Te,_e[5]+=Te,_e;const Ee=L$$(Te);return Ee.localOrigin=we.transform.position,Ee.applyToAabb(_e)}getComponentObb(fe){return fe.obb}getObjectTransform(fe){return fe.transform}getComponentPositions(fe,ve,_e){return fe.intersectionGeometry.getComponentPositions(ve,_e)}expandRangeWithComponentObjectElevationRange(fe,ve,_e,be){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==ve||be.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const we=fe,Se=we.components,Te=Se.count,Ee=Se.verticalOffsets,Ce=we.intersectionGeometry,Oe=this._viewingMode===Wf.Local,Re=Ce.getComponentAabbs(),De=pye;let Be=1/0,Ze=-1/0;for(let Xe=0;Xe<Te;Xe++){const fe=6*Xe,Se=(null==Ee?void 0:Ee[Xe])??0;let Te=1/0,Ce=-1/0;if(Oe)Te=Re[fe+2]+Se+ve,Ce=Re[fe+5]+Se+ve;else{if(De[0]=Re[fe],De[1]=Re[fe+1],De[2]=Re[fe+2],De[3]=Re[fe+3],De[4]=Re[fe+4],De[5]=Re[fe+5],0!==Se){const fe=L$$(Se);fe.localOrigin=we.transform.position,fe.applyToAabb(De)}const Te=Math.max(Math.abs(De[3]),Math.abs(De[0])),Ee=Math.max(Math.abs(De[4]),Math.abs(De[1])),Ce=ve+De[5]+_e;be.expandElevationRangeValues(ve+De[2],Math.sqrt(Te*Te+Ee*Ee+Ce*Ce)-_e)}be.expandElevationRangeValues(Te,Ce),Be=Math.min(Be,Te),Ze=Math.max(Ze,Ce)}this._elevationRangeCacheVerticalOffset=ve,this._elevationRangeCacheMin=Be,this._elevationRangeCacheMax=Ze}intersect(fe,ve,_e,be,we,Se,Te){const Ee=fe,{transform:Ce}=Ee,{position:Oe}=Ce;return null!=we&&(we.localOrigin=Oe),Ee.intersectionGeometry.intersect(ve,_e,be,we,Ee.components.verticalOffsets,Ce,Se,Te)}addEdges(fe,ve,_e,be,we){const Se=fe,{indices:Te,positions:Ee}=Se.intersectionGeometry,Ce=Se.components.offsets;return ve.addComponentObject(Se,Ee,Te,Ce,_e,be,we)}async extractEdgeInformation(fe,ve,_e){const be=fe,we=be.components.visibility;if(we.allInvisible())return{buffer:oye.createBuffer(0),origin:[0,0,0]};const{indices:Se,positions:Te}=be.intersectionGeometry,Ee=be.components.offsets,Ce=Eme.createBuffer(Te.length/3);t$1t(Ce.position.typedBuffer,Te,Ce.position.typedBufferStride,3),r$1L(Ce.position,Ce.position,be.transform.rotationScale),this._setComponentIndices(Ce.componentIndex,Se,Ee);const Oe=Ce.count,Re=this._computeVisibilityIndices(Se,we,Ee,Oe);return{origin:t$47(be.transform.position),buffer:await ve.extractComponentsEdgeLocations({indices:Re,indicesLength:Re.length,skipDeduplicate:!0,data:Ce,writerSettings:{reducedPrecision:!1,variants:0}},_e)}}_setComponentIndices(fe,ve,_e){let be=0;for(let we=0;we<_e.length-1;we++){const Se=_e[we],Te=_e[we+1];for(let _e=Se;_e<Te;_e++){const we=ve?ve[_e]:_e;fe.set(we,be)}be++}}_computeVisibilityIndices(fe,ve,_e,be){if(fe&&ve.allVisible())return fe;let we=0;ve.forEachComponentRange(((fe,ve)=>(we+=_e[ve]-_e[fe],!0)));const Se=y$2C(fe)?new Array(we):2===(null==fe?void 0:fe.BYTES_PER_ELEMENT)||be<=65536?new Uint16Array(we):new Uint32Array(we);let Te=0;return ve.forEachComponentRange(((ve,be)=>{const we=_e[ve],Ee=_e[be];for(let _e=we;_e<Ee;_e++)Se[Te++]=fe?fe[_e]:_e;return!0})),Se}addComponentHighlight(fe,ve){const _e=fe.components;null==_e.highlightCounts&&(_e.highlightCounts=new Uint32Array(_e.count+1)),0==_e.highlightCounts[ve]++&&(_e.highlightsDirty(),this._notifyDirty()),_e.highlightCounts[_e.count]++}removeComponentHighlight(fe,ve){const _e=fe.components;if(null==_e.highlightCounts)return void k$8().warn("Removing non-existing highlight.");const be=_e.highlightCounts[ve],we=_e.highlightCounts[_e.count];if(0!==be){if(be>1)return _e.highlightCounts[ve]=be-1,void(_e.highlightCounts[_e.count]=we-1);_e.highlightCounts[ve]=0,_e.highlightsDirty(),this._notifyDirty(),1===we?_e.highlightCounts=null:_e.highlightCounts[_e.count]=we-1}else k$8().warn("Removing non-existing highlight.")}clearHighlights(fe){const ve=fe.components;null!=ve.highlightCounts&&(ve.highlightCounts=null,ve.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(fe){return fe.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(fe,ve){const _e=this._renderManager.rctx,be=fe.geometry,we=be.vertices.layoutParameters,Se=rM.createVertex(_e,QO.STATIC_DRAW,be.vertices.data),Te=be.indices?rM.createIndex(_e,QO.STATIC_DRAW,be.indices):null,Ee=t$2L(o$x(we)),Ce=new Uint16Array(be.vertices.count);for(let Xe=0;Xe<ve.count;Xe++){const fe=ve.offsets[Xe],_e=ve.offsets[Xe+1],we=ve.materialDataIndices[Xe];if(null!=be.indices)for(let ve=fe;ve<_e;ve++)Ce[be.indices[ve]]=we;else for(let ve=fe;ve<_e;ve++)Ce[ve]=we}const Oe=rM.createVertex(_e,QO.STATIC_DRAW,Ce.buffer),Re=new $me(fe.transform,fe.toMapSpace),De=new eM(_e,mme,{data:Ee,componentIndices:dye},{data:Se,componentIndices:Oe},Te),Be=new jfe(De,NO.TRIANGLES,we,null!=Te),Ze={cameraDepthSquared:.5,gpuMemoryEstimate:Se.usedMemory+Oe.usedMemory+(null!=Te?Te.usedMemory:0)};return new Bfe(Re,Be,Ze)}_notifyDirty(){this._renderManager.notifyDirty()}};const dye=t$2L(H$J().u16(nO.COMPONENTINDEX));function H$6(fe,ve){return fe===ve?wme.All:0===fe?wme.None:wme.Some}const pye=i$3t();let fye=class o34 extends iO{};function i$_(){const fe=new gO,{outputs:ve,fragment:_e}=fe;return fe.include(o$2A),_e.uniforms.add(new dM("textureInput",(fe=>fe.input))),_e.constants.add("sampleArea","int",Math.ceil(yye/2)),ve.add("fragGrid","vec2"),_e.code.add(o$2P`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${o$2P.int(mye)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),fe}const mye=32,yye=9,gye=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:fye,blurSize:.4,build:i$_,gridCellPixelSize:mye,outlineSize:yye},Symbol.toStringTag,{value:"Module"}));function g$v(){const fe=new gO,{vertex:ve,fragment:_e}=fe,be=ve.code,we=_e.code;return fe.attributes.add(nO.POSITION,"vec2"),fe.varyings.add("uv","vec2"),fe.attributes.add(nO.UV0,"vec2"),ve.uniforms.add(new CO("coverageTex",(fe=>fe.coverageTexture)),new lO("coverageRounding",(fe=>fe.coverageRounding))),be.add(o$2P`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),_e.uniforms.add(new CO("tex",(fe=>fe.blurTexture)),new CO("highlightTexture",(fe=>fe.highlightTexture)),new hO("uColor",(fe=>fe.color)),new hO("haloColor",(fe=>fe.haloColor)),new hO("opacities",(fe=>s$3I(vye,fe.haloOpacity,fe.haloOpacityOccluded,fe.fillOpacity,fe.fillOpacityOccluded)))),_e.constants.add("inner","float",1-(yye-.4)/yye),we.add(o$2P`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),fe}const vye=[0,0,0,0],_ye=Object.freeze(Object.defineProperty({__proto__:null,build:g$v},Symbol.toStringTag,{value:"Module"}));let $ye=class n41 extends fA{initializeProgram(fe){return new gA(fe.rctx,n41.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}};$ye.shader=new LO(_ye,(()=>zt((()=>Promise.resolve().then((()=>wRe))),void 0)));let bye=class d27 extends iO{constructor(){super(...arguments),this.blurSize=[0,0]}};function l$Y(){const fe=new gO,{attributes:ve,varyings:_e,vertex:be,fragment:we}=fe;return ve.add(nO.POSITION,"vec2"),ve.add(nO.UV0,"vec2"),_e.add("blurCoordinate","vec3"),be.uniforms.add(new CO("coverageTex",(fe=>fe.coverageTexture)),new lO("coverageRounding",(fe=>fe.coverageRounding))),be.code.add(o$2P`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),we.uniforms.add(new aq("blurSize",(fe=>fe.blurSize)),new dM("tex",(fe=>fe.blurInputTexture))),we.code.add(o$2P`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),fe}const wye=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:bye,build:l$Y},Symbol.toStringTag,{value:"Module"}));let xye=class a45 extends fA{initializeProgram(fe){return new gA(fe.rctx,a45.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};xye.shader=new LO(wye,(()=>zt((()=>Promise.resolve().then((()=>xRe))),void 0)));let Sye=class l35 extends fA{initializeProgram(fe){return new gA(fe.rctx,l35.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};Sye.shader=new LO(gye,(()=>zt((()=>Promise.resolve().then((()=>SRe))),void 0)));let Tye=class r55 extends iO{constructor(){super(...arguments),this.color=r$35(1,0,1,1),this.haloColor=r$35(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=r$36(1,1)}},Eye=class R7 extends nq{constructor(fe){super(fe),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new Tye,this._downsampleDrawParameters=new fye,this._blurDrawParameters=new bye,this._blurColorFormat=has("mac")?YA.RGBA:YA.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=fe.techniques.acquire(xye),this._downsampleTechnique=fe.techniques.acquire(Sye),this._applyTechnique=fe.techniques.acquire($ye)}initialize(){this.addHandles([d$3d((()=>this.view.highlightOptions.color),(fe=>{this._passParameters.color=E$1l(fe??zle),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender($A.UPDATE)}),Ja),d$3d((()=>this.view.highlightOptions.haloColor),(fe=>{this._passParameters.haloColor=null!=fe?E$1l(fe):this._passParameters.color,this.requestRender($A.UPDATE)}),Ja),d$3d((()=>this.view.highlightOptions.haloOpacity),(fe=>{this._passParameters.haloOpacity=fe??1,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender($A.UPDATE)}),Ja),d$3d((()=>this.view.highlightOptions.fillOpacity),(fe=>{this._passParameters.fillOpacity=fe??.25,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender($A.UPDATE)}),Ja)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=t$4r(this._grid.coverage),this._grid.vao=r$3M(this._grid.vao)}render(fe){var ve,_e,be;if(this.bindParameters.decorations===TA.OFF)return fe.find((({name:fe})=>"highlight-color"===fe));if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender($A.UPDATE),fe.find((({name:fe})=>"highlight-color"===fe));const we=fe.find((({name:fe})=>"highlights"===fe)).getTexture(),Se=this.bindParameters.camera,Te=Se.fullWidth,Ee=Se.fullHeight,Ce=Se.pixelRatio,Oe=Math.ceil(Te/Ce),Re=Math.ceil(Ee/Ce),De=this.renderingContext;this._gridUpdateResources(we),this._gridComputeCoverage(we,this.bindParameters),this._passParameters.highlightTexture=we,this._passParameters.coverageTexture=null==(ve=this._grid.coverage)?void 0:ve.getTexture();const{width:Be,height:Ze}=we.descriptor;o$2R(this._passParameters.coverageRounding,Be/(Math.ceil(Be/mye)*mye),Ze/(Math.ceil(Ze/mye)*mye));const Xe=this._grid.vao;De.bindVAO(Xe);const Je=this.fboCache.acquire(Oe,Re,"highlight blur",this._blurColorFormat);De.unbindTexture(null==(_e=Je.fbo)?void 0:_e.colorTexture),De.bindFramebuffer(Je.fbo),De.setClearColor(0,0,0,0),De.clear(DO.COLOR_BUFFER_BIT),De.setViewport(0,0,Oe,Re),this._blurDrawParameters.blurInputTexture=we,o$2R(this._blurDrawParameters.blurSize,1/Oe,0);const Qe=De.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);De.drawArrays(this._blurTechnique.primitiveType,0,i$2T(Xe,"geometry"));const dt=this.fboCache.acquire(Oe,Re,"highlight blur",this._blurColorFormat);De.unbindTexture(null==(be=dt.fbo)?void 0:be.colorTexture),De.bindFramebuffer(dt.fbo),De.setClearColor(0,0,0,0),De.clear(DO.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=Je.getTexture(),o$2R(this._blurDrawParameters.blurSize,0,1/Re),Qe.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),De.drawArrays(this._blurTechnique.primitiveType,0,i$2T(Xe,"geometry"));const $t=fe.find((({name:fe})=>"highlight-color"===fe));return De.bindFramebuffer($t.fbo),De.setViewport4fv(Se.fullViewport),this._passParameters.blurTexture=dt.getTexture(),De.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),De.drawArrays(this._applyTechnique.primitiveType,0,i$2T(Xe,"geometry")),Je.release(),dt.release(),$t}_gridUpdateResources(fe){var ve;const _e=this.renderingContext,be=this._grid,we=Math.ceil(fe.descriptor.height/mye),Se=Math.ceil(fe.descriptor.width/mye);if(be.vao&&be.verticalCellCount===we&&be.horizontalCellCount===Se)return;be.verticalCellCount=we,be.horizontalCellCount=Se;const Te=we+1,Ee=Se+1,Ce=1/we,Oe=1/Se,Re=new Float32Array(24*Te*Ee);let De=0;for(let Be=0;Be<Te;Be++)for(let fe=0;fe<Ee;fe++)Re[De++]=(fe-.5)*Oe*2-1,Re[De++]=(Be-.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce,Re[De++]=(fe+.5)*Oe*2-1,Re[De++]=(Be-.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce,Re[De++]=(fe-.5)*Oe*2-1,Re[De++]=(Be+.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce,Re[De++]=(fe-.5)*Oe*2-1,Re[De++]=(Be+.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce,Re[De++]=(fe+.5)*Oe*2-1,Re[De++]=(Be-.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce,Re[De++]=(fe+.5)*Oe*2-1,Re[De++]=(Be+.5)*Ce*2-1,Re[De++]=fe*Oe,Re[De++]=Be*Ce;null==(ve=be.vao)||ve.dispose(),be.vao=new tM(_e,mA,{geometry:KA},{geometry:rM.createVertex(_e,QO.STATIC_DRAW,Re)})}_gridComputeCoverage(fe,ve){var _e,be;const we=this.renderingContext,Se=this._grid,Te=fe.descriptor,Ee=Math.ceil(Te.width/mye),Ce=Math.ceil(Te.height/mye);this._downsampleDrawParameters.input=fe,null==(_e=Se.coverage)||_e.release(),Se.coverage=this.fboCache.acquire(Ee,Ce,"highlight coverage",YA.RG),we.unbindTexture(null==(be=Se.coverage.fbo)?void 0:be.colorTexture),we.bindFramebuffer(Se.coverage.fbo),we.bindTechnique(this._downsampleTechnique,ve,this._passParameters,this._downsampleDrawParameters),we.setViewport(0,0,Ee,Ce),we.screen.draw()}get test(){}};e$4o([y$2v()],Eye.prototype,"produces",void 0),e$4o([y$2v()],Eye.prototype,"consumes",void 0),e$4o([y$2v({constructOnly:!0})],Eye.prototype,"techniques",void 0),Eye=e$4o([a$4y("esri.views.3d.webgl-engine.effects.highlight.Highlight")],Eye);let Pye=class s74 extends HA{constructor(){super(...arguments),this.receiveShadows=!0}};function i$Z(fe){const ve=fe.fragment;fe.include(f$1C),ve.include(c$2X),ve.code.add(o$2P`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}e$4o([r$2w()],Pye.prototype,"receiveShadows",void 0);function M$c(fe){const ve=new gO;ve.include(m$1P,fe),ve.include(o$2A),ve.include(i$Z);const _e=ve.fragment;return _e.include(a$32),_e.uniforms.add(new CO("defaultDepthTex",((fe,ve)=>ve.shadowMap.getSnapshot($X.ExcludeHighlight))),new CO("highlightDepthTex",((fe,ve)=>ve.shadowMap.getSnapshot($X.Highlight))),new CO("depthMap",((fe,ve)=>{var _e;return null==(_e=ve.depth)?void 0:_e.attachment})),new CO("highlightTexture",(fe=>fe.highlight)),new hO("uColor",(fe=>fe.shadowColor)),new dO("opacity",(fe=>fe.shadowOpacity)),new dO("occludedOpacity",(fe=>fe.occludedShadowOpacity)),new dO("terminationFactor",(fe=>fe.opacityElevation*fe.dayNightTerminator)),new uO("lightingMainDirectionView",((fe,ve)=>z$1d(Oye,O$1v(Oye,ve.lighting.mainLight.direction,ve.camera.viewInverseTransposeMatrix)))),new pO("inverseViewMatrix",((fe,ve)=>h$2A(Cye,i$45(Cye,ve.camera.viewMatrix,ve.camera.center))))),_e.constants.add("unoccludedHighlightFlag","vec4",uj),_e.code.add(o$2P`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${o$2P.float(.99999)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${o$2P.float(.025)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),ve}const Cye=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Oye=[0,0,0],Aye=Object.freeze(Object.defineProperty({__proto__:null,build:M$c},Symbol.toStringTag,{value:"Module"}));let Mye=class p36 extends Tq{constructor(){super(...arguments),this.shadowColor=r$35(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},Rye=class u22 extends fA{constructor(fe){super(fe,new Pye,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,u22.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA,depthTest:null,depthWrite:null})}get primitiveType(){return NO.TRIANGLE_STRIP}};Rye.shader=new LO(Aye,(()=>zt((()=>Promise.resolve().then((()=>TRe))),void 0)));let Iye=class b17 extends nq{constructor(fe){super(fe),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new Mye,this._maxOpacity=1,this._shadowDifference=.2,this._technique=fe.techniques.acquire(Rye)}initialize(){this.addHandles([d$3d((()=>this.view.highlightOptions.shadowOpacity),(fe=>{this._passParameters.shadowOpacity=fe??.4,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()}),Ja),d$3d((()=>this.view.highlightOptions.shadowDifference),(fe=>{this._shadowDifference=fe??.2,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()}),Ja),d$3d((()=>this.view.highlightOptions.shadowColor),(fe=>{this._passParameters.shadowColor=E$1l(fe??kle),this._updateMaxOpacity()}),Ja)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const fe=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=fe*this._passParameters.shadowColor[3]}render(fe){var ve;const _e=fe.find((({name:fe})=>"composite-color"===fe)),be=this.bindParameters;if(!be.shadowHighlightsVisible||!be.depth||!this._ensureIfVisible(be.camera,be.lighting.mainLight.direction))return _e;if(!this._technique.compiled)return this.requestRender($A.UPDATE),_e;this._passParameters.highlight=null==(ve=fe.find((({name:fe})=>"highlights"===fe)))?void 0:ve.getTexture(),this._passParameters.origin=be.camera.center;const we=this.renderingContext;return we.bindFramebuffer(_e.fbo),we.bindTechnique(this._technique,be,this._passParameters),we.screen.draw(),_e}_ensureIfVisible(fe,ve){this._passParameters.opacityElevation=1-p$4Y(4e4,5e4,fe.relativeElevation);const _e=P$1g(this.viewingMode===Wf.Global?z$1d(Lye,fe.center):o$44(Lye,0,0,1),ve);return this._passParameters.dayNightTerminator=p$4Y(0,1,e$3Y(30*_e,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=.001953125}};e$4o([y$2v()],Iye.prototype,"produces",void 0),e$4o([y$2v()],Iye.prototype,"consumes",void 0),e$4o([y$2v({constructOnly:!0})],Iye.prototype,"viewingMode",void 0),e$4o([y$2v({constructOnly:!0})],Iye.prototype,"techniques",void 0),Iye=e$4o([a$4y("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],Iye);const Lye=[0,0,0];let Dye=class f21 extends iO{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function v$h(){const fe=new gO;return fe.attributes.add(nO.POSITION,"vec2"),fe.vertex.uniforms.add(new hO("drawPosition",((fe,ve)=>function c$1a(fe,ve){const _e=ve.camera.pixelRatio,be=fe.magnifier.offset.x*_e,we=fe.magnifier.offset.y*_e;d$3c(fe.magnifier.position,Nye);const Se=ve.camera.screenToRender(Nye,Fye),Te=Math.ceil(_e*fe.magnifier.size),Ee=ve.camera.fullWidth,Ce=ve.camera.fullHeight;return s$3I(zye,(Se[0]+be)/Ee*2-1,(Se[1]-we)/Ce*2-1,Te/Ee*2,Te/Ce*2)}(fe,ve)))),fe.varyings.add("vUV","vec2"),fe.vertex.code.add(o$2P`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),fe.fragment.uniforms.add(new CO("textureInput",(fe=>fe.input))),fe.fragment.uniforms.add(new CO("textureMask",(fe=>fe.mask))),fe.fragment.uniforms.add(new CO("textureOverlay",(fe=>fe.overlay))),fe.fragment.uniforms.add(new zM("maskEnabled",(fe=>fe.magnifier.maskEnabled))),fe.fragment.uniforms.add(new zM("overlayEnabled",(fe=>fe.magnifier.overlayEnabled))),fe.fragment.code.add(o$2P`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),fe}const Nye=i$4i(),Fye=s$3Y(),zye=[0,0,0,0],kye=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Dye,build:v$h},Symbol.toStringTag,{value:"Module"}));let Uye=class m28 extends fA{initializeProgram(fe){return new gA(fe.rctx,m28.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:AA})}};Uye.shader=new LO(kye,(()=>zt((()=>Promise.resolve().then((()=>ERe))),void 0)));let Vye=class S11 extends nq{constructor(fe){super(fe),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new Dye,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=i$4i(),this._tmpRenderPoint=s$3Y()}initialize(){this.addHandles([d$3d((()=>this.view.magnifier),(fe=>this._update(fe)),Ja)])}_update(fe){if(fe===this._magnifier)return;this.removeAllHandles(),this._magnifier=fe;const s84=()=>{const fe=this._validMagnifier;fe?(this._loadResources(fe),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(d$3d((()=>{var fe;return null==(fe=this._magnifier)?void 0:fe.version}),s84)),s84()}get _validMagnifier(){var fe,ve,_e;return(null==(fe=this._magnifier)?void 0:fe.visible)&&(null==(ve=this._magnifier)?void 0:ve.position)&&(null==(_e=this._magnifier)?void 0:_e.size)>0?this._magnifier:null}get _factor(){var fe;return(null==(fe=this._magnifier)?void 0:fe.factor)||1}destroy(){this._magnifier=null,null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=r$3M(this._vao)}_disposeTextures(){this._passParameters.mask=r$3M(this._passParameters.mask),this._passParameters.overlay=r$3M(this._passParameters.overlay),this._passParameters.input=r$3M(this._passParameters.input)}render(fe){var ve;const _e=this._validMagnifier,be=fe.find((({name:fe})=>"magnifier-color"===fe));if(null==_e)return be;if(null==this._imageSources)return this.requestRender($A.UPDATE),be;const we=this.renderingContext,Se=this.camera.pixelRatio,Te=Math.ceil(Se*_e.size);if(this._vao??(this._vao=i$2S(we,QA,mA,0,1)),this._technique??(this._technique=this.techniques.acquire(Uye)),this._ensureTextureResources(we,Te),!(null==(ve=this._technique)?void 0:ve.compiled)||!this._passParameters.input)return this.requestRender($A.UPDATE),be;const Ee=Math.ceil(1/this._factor*Te),Ce=this._passParameters.input;Ce.resize(Ee,Ee),d$3c(_e.position,this._tmpScreenPoint);const Oe=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),Re=this.camera.fullWidth,De=this.camera.fullHeight,Be=.5*Ee,Ze=.5*Ee;Oe[0]=e$3Y(Oe[0],Be,Re-Be-1),Oe[1]=e$3Y(Oe[1],Ze,De-Ze-1);const Xe=Math.floor(Oe[0]-Be),Je=Math.floor(Oe[1]-Ze);return we.bindFramebuffer(be.fbo),this._technique.program.bindTexture("textureInput",Ce),we.gl.copyTexImage2D(Ce.descriptor.target,0,Ce.descriptor.pixelFormat,Xe,Je,Ee,Ee,0),this._passParameters.magnifier=_e,we.bindTechnique(this._technique,this.bindParameters,this._passParameters),we.bindVAO(this._vao),we.drawArrays(NO.TRIANGLE_STRIP,0,4),be}_loadResources(fe){var ve,_e,be;const{maskUrl:we,overlayUrl:Se}=fe;(null==(ve=this._imageLoadTask)?void 0:ve.maskUrl)===we&&(null==(_e=this._imageLoadTask)?void 0:_e.overlayUrl)===Se||(null==(be=this._imageLoadTask)||be.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:we,overlayUrl:Se,task:d$3e((async fe=>{const ve=null==we||null==Se?async function s$R(fe){const ve=zt((()=>import("./mask-svg-cNit2NTT.js")),[]),_e=zt((()=>import("./overlay-svg-DioSRl-7.js")),[]),be=t$1T((await ve).default,{signal:fe}),we=t$1T((await _e).default,{signal:fe}),Se={mask:await be,overlay:await we};return s$4o(fe),Se}(fe):null,_e=null!=we?t$1T(we,{signal:fe}):ve.then((fe=>fe.mask)),be=null!=Se?t$1T(Se,{signal:fe}):ve.then((fe=>fe.overlay));this._imageSources={mask:await _e,overlay:await be}}))})}_ensureTextureResources(fe,ve){if(null==this._imageSources||this._passParameters.size===ve&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=ve,this._imageSources.overlay.height=this._imageSources.mask.height=ve;const _e=new nM;_e.internalFormat=YO.RGBA,_e.wrapMode=qO.CLAMP_TO_EDGE,_e.flipped=!0,_e.preMultiplyAlpha=!Pt$4(this._imageSources.overlay.src)||!fe.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new oM(fe,_e,this._imageSources.overlay),_e.pixelFormat=_e.internalFormat=YO.ALPHA,_e.preMultiplyAlpha=!1,this._passParameters.mask=new oM(fe,_e,this._imageSources.mask),_e.pixelFormat=_e.internalFormat=YO.RGBA,_e.flipped=!1,this._passParameters.input=new oM(fe,_e)}};e$4o([y$2v()],Vye.prototype,"produces",void 0),e$4o([y$2v()],Vye.prototype,"consumes",void 0),e$4o([y$2v()],Vye.prototype,"_imageSources",void 0),e$4o([y$2v()],Vye.prototype,"_imageLoadTask",void 0),e$4o([y$2v({constructOnly:!0})],Vye.prototype,"techniques",void 0),Vye=e$4o([a$4y("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],Vye);const Bye=8,jye=16;function c$19(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("edgesTexture",(fe=>fe.inputTexture)),new CO("areaTexture",(fe=>fe.areaTexture)),new CO("searchTexture",(fe=>fe.searchTexture))),fe.fragment.code.add(o$2P`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${o$2P.int(Bye)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${o$2P.int(Bye)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${o$2P.int(Bye)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${o$2P.int(Bye)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${o$2P.int(jye)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${o$2P.int(Bye)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),fe}const Gye=Object.freeze(Object.defineProperty({__proto__:null,build:c$19},Symbol.toStringTag,{value:"Module"}));let Hye=class a46 extends fA{initializeProgram(fe){return new gA(fe.rctx,a46.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};function s$P(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("blendWeightsTexture",(fe=>fe.inputTexture)),new CO("colorTexture",(fe=>fe.color))),fe.fragment.code.add(o$2P`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),fe}Hye.shader=new LO(Gye,(()=>zt((()=>Promise.resolve().then((()=>PRe))),void 0)));const qye=Object.freeze(Object.defineProperty({__proto__:null,build:s$P},Symbol.toStringTag,{value:"Module"}));let Wye=class a47 extends fA{initializeProgram(fe){return new gA(fe.rctx,a47.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};Wye.shader=new LO(qye,(()=>zt((()=>Promise.resolve().then((()=>CRe))),void 0)));const Yye=.05,Zye=2;function l$W(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("colorTexture",(fe=>fe.color))),fe.outputs.add("fragEdges","vec2"),fe.fragment.code.add(o$2P`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${o$2P.float(Yye)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${o$2P.float(Zye)}) * delta.xy);

      fragEdges = edges;
    }
  `),fe}const Xye=Object.freeze(Object.defineProperty({__proto__:null,build:l$W},Symbol.toStringTag,{value:"Module"}));let Jye=class l36 extends fA{initializeProgram(fe){return new gA(fe.rctx,l36.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:AA})}};Jye.shader=new LO(Xye,(()=>zt((()=>Promise.resolve().then((()=>ORe))),void 0)));let Qye=class s75 extends iO{},Kye=class g20 extends nq{constructor(fe){super(fe),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new Qye,this._edgeTechnique=fe.techniques.acquire(Jye),this._blendTechnique=fe.techniques.acquire(Hye),this._blurTechnique=fe.techniques.acquire(Wye)}initialize(){this.addHandles([d$3d((()=>this.isEnabled()),(fe=>fe?this.enable():this.disable()),Ja)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const fe=this._abortController.signal;try{const ve=await zt((()=>import("./SMAAData-DCEZ61Cs.js")),[]);await this._loadTextures(ve,fe),this.requestRender($A.UPDATE)}catch{}this._abortController=null}async _loadTextures(fe,ve){s$4o(ve);const[_e,be]=await Promise.allSettled([t$1T(fe.areaTexture,{signal:ve}),t$1T(fe.searchTexure,{signal:ve})]);if(s$4o(ve),"fulfilled"!==_e.status||"fulfilled"!==be.status)return;const we=this.renderingContext;this._areaTexture=w$k(we,HO.LINEAR,YO.RGB,_e.value),this._searchTexture=w$k(we,HO.NEAREST,YO.LUMINANCE,be.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=r$3M(this._searchTexture),this._areaTexture=r$3M(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(fe){var ve,_e;const be=fe.find((({name:fe})=>"aa-color"===fe));if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender($A.UPDATE),be;const we=fe.find((({name:fe})=>"composite-color"===fe)),Se=we.fbo.width,Te=we.fbo.height,Ee=this.renderingContext;Ee.setViewport(0,0,Se,Te);const Ce=this.fboCache.acquire(Se,Te,"smaa edges",YA.RG);Ee.unbindTexture(null==(ve=Ce.fbo)?void 0:ve.colorTexture),Ee.bindFramebuffer(Ce.fbo),Ee.setClearColor(0,0,0,1),Ee.clear(DO.COLOR_BUFFER_BIT),this._smaaParameters.color=we.getTexture(),Ee.bindTechnique(this._edgeTechnique,null,this._smaaParameters),Ee.screen.draw();const Oe=this.fboCache.acquire(Se,Te,"smaa blend");return Ee.unbindTexture(null==(_e=Oe.fbo)?void 0:_e.colorTexture),Ee.bindFramebuffer(Oe.fbo),Ee.setClearColor(0,0,1,1),Ee.clear(DO.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=Ce.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,Ee.bindTechnique(this._blendTechnique,null,this._smaaParameters),Ee.screen.draw(),Ce.release(),Ee.bindFramebuffer(be.fbo),Ee.setClearColor(0,1,0,1),Ee.clear(DO.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=Oe.getTexture(),Ee.bindTechnique(this._blurTechnique,null,this._smaaParameters),Ee.screen.draw(),Oe.release(),be}};function w$k(fe,ve,_e,be){const we=new nM;return we.pixelFormat=_e,we.wrapMode=qO.CLAMP_TO_EDGE,we.width=be.width,we.height=be.height,we.samplingMode=ve,new oM(fe,we,be)}e$4o([y$2v()],Kye.prototype,"produces",void 0),e$4o([y$2v()],Kye.prototype,"consumes",void 0),e$4o([y$2v({constructOnly:!0})],Kye.prototype,"isEnabled",void 0),e$4o([y$2v({constructOnly:!0})],Kye.prototype,"techniques",void 0),e$4o([y$2v()],Kye.prototype,"_abortController",void 0),Kye=e$4o([a$4y("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Kye);let ege=class l37 extends iO{constructor(){super(...arguments),this.opacity=1}};function m$O(fe){const ve=new gO;return ve.include(o$2A),ve.fragment.uniforms.add(new CO("tex",(fe=>fe.texture))),fe.hasOpacityFactor&&ve.fragment.uniforms.add(new dO("opacity",(fe=>fe.opacity))),fe.isDepthBlit&&(ve.fragment.uniforms.add(new lO("nearFar",((fe,ve)=>ve.camera.nearFar))),ve.fragment.include(c$2X),ve.fragment.include(a$32)),ve.fragment.code.add(o$2P`
    void main() {
      ${fe.isDepthBlit?o$2P`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:o$2P`
              fragColor = texture(tex, uv) ${fe.hasOpacityFactor?"* opacity":""};`}
    }`),ve}const tge=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:ege,build:m$O},Symbol.toStringTag,{value:"Module"}));var rge;!function(fe){fe[fe.None=0]="None",fe[fe.Alpha=1]="Alpha",fe[fe.PremultipliedAlpha=2]="PremultipliedAlpha",fe[fe.COUNT=3]="COUNT"}(rge||(rge={}));let ige=class p37 extends HA{constructor(){super(...arguments),this.alphaMode=rge.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};e$4o([r$2w({count:rge.COUNT})],ige.prototype,"alphaMode",void 0),e$4o([r$2w()],ige.prototype,"hasOpacityFactor",void 0),e$4o([r$2w()],ige.prototype,"isDepthBlit",void 0);let nge=class p38 extends fA{initializeProgram(fe){return new gA(fe.rctx,p38.shader.get().build(this.configuration),mA)}initializePipeline(){switch(this.configuration.alphaMode){case rge.None:return S$1g({colorWrite:AA});case rge.Alpha:return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA});case rge.PremultipliedAlpha:case rge.COUNT:return S$1g({blending:s$2Z(FO.ONE,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}}};nge.shader=new LO(tge,(()=>zt((()=>Promise.resolve().then((()=>ARe))),void 0)));let sge=class t73 extends iO{};function a$Y(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("tex",(fe=>fe.texture))),fe.fragment.code.add(o$2P`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),fe}const oge=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:sge,build:a$Y},Symbol.toStringTag,{value:"Module"}));let age=class a48 extends fA{initializeProgram(fe){return new gA(fe.rctx,a48.shader.get().build(),mA)}initializePipeline(){return S$1g({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};age.shader=new LO(oge,(()=>zt((()=>Promise.resolve().then((()=>MRe))),void 0)));let lge=class s76 extends iO{};function n$14(){const fe=new gO;return fe.include(o$2A),fe.fragment.uniforms.add(new CO("colorTexture",(fe=>fe.colorTexture)),new CO("alphaTexture",(fe=>fe.alphaTexture)),new CO("frontFaceTexture",(fe=>fe.frontFaceTexture))),fe.fragment.code.add(o$2P`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),fe}const cge=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:lge,build:n$14},Symbol.toStringTag,{value:"Module"}));let uge=class a49 extends fA{initializeProgram(fe){return new gA(fe.rctx,a49.shader.get().build(),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.SRC_ALPHA,FO.ONE,FO.ONE_MINUS_SRC_ALPHA,FO.ONE_MINUS_SRC_ALPHA),colorWrite:AA})}};uge.shader=new LO(cge,(()=>zt((()=>Promise.resolve().then((()=>RRe))),void 0)));let hge=class n42{constructor(fe,ve){this._rctx=fe,this._techniques=ve,this._configuration=new ige,this._passParameters=new ege,this._oitParameters=new lge,this._hudParameters=new sge}compositeOIT(fe,ve,_e,be){this._oitParameters.colorTexture=ve,this._oitParameters.alphaTexture=_e,this._oitParameters.frontFaceTexture=be;const we=this._techniques.acquire(uge);this._rctx.bindTechnique(we,fe,this._oitParameters),this._rctx.screen.draw(),we.release()}compositeHUD(fe,ve){this._hudParameters.texture=ve;const _e=this._techniques.acquire(age);this._rctx.bindTechnique(_e,fe,this._hudParameters),this._rctx.screen.draw(),_e.release()}composite(fe,ve,_e=rge.None,be=1){this._configuration.alphaMode=_e,this._configuration.hasOpacityFactor=1!==be,this._passParameters.texture=ve,this._passParameters.opacity=be;const we=this._techniques.acquire(nge,this._configuration);this._rctx.bindTechnique(we,fe,this._passParameters),this._rctx.screen.draw(),we.release()}blitDepthToLinearDepth(fe,ve){this._configuration.isDepthBlit=!0,this.composite(fe,ve),this._configuration.isDepthBlit=!1}};const dge=100,pge=500,fge=500,mge=.1;function B$5(fe,ve,_e){return r$1U(ve,fe)*(_e[1]-_e[0])+_e[0]}function M$b(fe,ve,_e){let be=0;if(!ve.some((fe=>!!fe.materialReference&&(be+=fe.numGeometries,be>=1e4))))return bge.compute(fe,ve);const we=a$12();return _e.forAll((ve=>e$N(we,function O$a(fe,ve){if(!ve.visible)return;const _e=a$12(),be=ve.getSpatialQueryAccelerator();return be?function x$c(fe,ve,_e){const be=ve.eye,we=ve.viewForward,Se=ve.frustum,a55=fe=>fe.visible,Te=_e.objectCount;if(Te<pge)t$T(_ge,ve.near,Math.min(fe.near,ve.far)),_e.forEachInDepthRange(be,we,JY.DepthOrder.FRONT_TO_BACK,_ge,((_e,be)=>{T$b(fe,ve,_e),_ge.far=fe.near,be.setRange(_ge)}),Se,a55),t$T(_ge,Math.max(fe.far,ve.near),ve.far),_e.forEachInDepthRange(be,we,JY.DepthOrder.BACK_TO_FRONT,_ge,((_e,be)=>{T$b(fe,ve,_e),_ge.near=fe.far,be.setRange(_ge)}),Se,a55);else{const be=Math.max(Math.min(Te,fge),Math.ceil(Te*mge)),Ee=_e.findClosest(we,JY.DepthOrder.FRONT_TO_BACK,Se,a55,be),Ce=_e.findClosest(we,JY.DepthOrder.BACK_TO_FRONT,Se,a55,be);Ee&&Ce&&(I$9(fe,ve,Ee.boundingVolumeWorldSpace.bounds),I$9(fe,ve,Ce.boundingVolumeWorldSpace.bounds))}}(_e,fe,be):function D$8(fe,ve,_e){$ge.clear(),_e.forAll((fe=>{fe.visible&&0!==fe.geometries.length&&$ge.add(fe)})),$ge.empty||($ge.sort(ve),t$T(_ge,ve.near,Math.min(fe.near,ve.far)),$ge.forEachInDepthRange(_ge,JY.DepthOrder.FRONT_TO_BACK,((_e,be)=>{be<fe.near&&T$b(fe,ve,_e)})),t$T(_ge,Math.max(fe.far,ve.near),ve.far),$ge.forEachInDepthRange(_ge,JY.DepthOrder.BACK_TO_FRONT,((ve,_e,be)=>{fe.far=Math.max(fe.far,be)})))}(_e,fe,ve.objects),_e}(fe,ve)))),we}function T$b(fe,ve,_e){if(!_e.visible)return;if(!s$2N(ve.frustum,_e.boundingVolumeWorldSpace.bounds))return;const be=_e.transformation,we=vge;_e.geometries.forEach((_e=>{c$4k(we,be,_e.transformation);const Se=m$3g(we);F$9(fe,ve,_e.boundingInfo,we,Se)}))}function F$9(fe,ve,_e,be,we){if(null==_e)return;O$1v(gge,_e.center,be);const{eye:Se,viewForward:Te}=ve,Ee=Te[0]*(gge[0]-Se[0])+Te[1]*(gge[1]-Se[1])+Te[2]*(gge[2]-Se[2]);if(gge[3]=_e.radius*we,!(Ee-gge[3]>fe.near&&Ee+gge[3]<fe.far)&&s$2N(ve.frustum,gge))if(_e.radius>dge&&_e.getChildren())for(const Ce of _e.getChildren())F$9(fe,ve,Ce,be,we);else wge.unionDepthRangeWithAABB(fe,ve.viewProjectionMatrix,be,_e.bbMin,_e.bbMax)}function I$9(fe,ve,_e){const be=ve.eye,we=ve.viewForward,Se=(_e[0]-be[0])*we[0]+(_e[1]-be[1])*we[1]+(_e[2]-be[2])*we[2];fe.near=Math.min(fe.near,Se-_e[3]),fe.far=Math.max(fe.far,Se+_e[3])}function E$b(fe,ve,_e){let be=[fe,ve,_e];for(let we=0;we<4;++we){const fe=be;be=[];for(let ve=0;ve<fe.length;++ve){const _e=fe[ve],Se=fe[(ve+1)%fe.length];W$3(Se,we)?(W$3(_e,we)||be.push(K$3(_e,Se,we)),be.push(Se)):W$3(_e,we)&&be.push(K$3(_e,Se,we))}}return be}function W$3(fe,ve){return 0===ve?fe[0]>=-fe[3]:1===ve?fe[1]>=-fe[3]:2===ve?fe[0]<=fe[3]:3===ve?fe[1]<=fe[3]:void s$31(!1)}function K$3(fe,ve,_e){let be=0;return 0===_e?be=(-fe[3]-fe[0])/(ve[0]-fe[0]+ve[3]-fe[3]):1===_e?be=(-fe[3]-fe[1])/(ve[1]-fe[1]+ve[3]-fe[3]):2===_e?be=(fe[3]-fe[0])/(ve[0]-fe[0]-ve[3]+fe[3]):3===_e&&(be=(fe[3]-fe[1])/(ve[1]-fe[1]-ve[3]+fe[3])),_$1l([0,0,0,0],fe,ve,be)}const yge=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],gge=[0,0,0,0],vge=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_ge=a$12(),$ge=new class y12{constructor(){this._items=new jr({allocator:fe=>fe||{object:null,distance:0,near:0,far:0},deallocator:fe=>(fe.object=null,fe.distance=0,fe.near=0,fe.far=0,fe)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(fe){this._items.pushNew().object=fe}sort(fe){const ve=fe.eye,_e=fe.viewForward;this._items.forAll((fe=>{const be=fe.object.boundingVolumeWorldSpace.bounds,we=(be[0]-ve[0])*_e[0]+(be[1]-ve[1])*_e[1]+(be[2]-ve[2])*_e[2];fe.distance=we,fe.near=we-be[3],fe.far=we+be[3]})),this._items.sort(((fe,ve)=>fe.distance-ve.distance))}forEachInDepthRange(fe,ve,_e){if(ve===JY.DepthOrder.FRONT_TO_BACK)for(let be=0;be<this._items.length;++be){const ve=this._items.data[be];ve.far<fe.near||ve.near>fe.far||_e(ve.object,ve.near,ve.far)}else for(let be=this._items.length-1;be>=0;--be){const ve=this._items.data[be];ve.far<fe.near||ve.near>fe.far||_e(ve.object,ve.near,ve.far)}}},bge=new class P6{constructor(){this._view=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._viewProj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._frustum=H$M(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(fe,ve){this._reset(),n$48(this._view,fe.viewMatrix),c$4k(this._viewProj,fe.projectionMatrix,this._view),N$P(this._frustum,fe.frustum);const _e=this._view,be=_e[2],we=_e[6],Se=_e[10],Te=_e[14];ve.forAll((fe=>{fe.materialReference&&fe.forEachGeometry&&fe.forEachGeometry((fe=>{if(!fe.visible||!fe.castShadow)return;const ve=fe.boundingSphere,_e=be*ve[0]+we*ve[1]+Se*ve[2]+Te,Ee=_e-ve[3],Ce=_e+ve[3];this._geometries.push(fe),this._near.push(-Ce),this._far.push(-Ee)}))}));const Ee=new Gfe;if(0===this._geometries.length)return Ee;for(let De=0;De<this._geometries.length;++De)this._near[De]>Ee.far&&(Ee.far=this._near[De]),this._near[De]>2&&this._far[De]<Ee.near&&(Ee.near=this._far[De]);const Ce=this._looseRange;Ce.near=Math.max(.5*Ee.near,2),Ce.far=2*Ee.far;let Oe=0,Re=0;for(let De=0;De<this._geometries.length;++De)this._near[De]<Ee.near&&(this._near[De]>=Ce.near?Ee.near=this._near[De]:this._nearCandidates[Oe++]=De),this._far[De]>Ee.far&&(this._far[De]<=Ce.far?Ee.far=this._far[De]:this._farCandidates[Re++]=De);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return Ee;this._nearCandidates.sort(((fe,ve)=>this._near[fe]<this._near[ve]?-1:this._near[fe]>this._near[ve]?1:0)),this._farCandidates.sort(((fe,ve)=>this._far[fe]<this._far[ve]?1:this._far[fe]>this._far[ve]?-1:0));for(let De=0;De<this._nearCandidates.length;++De){const fe=this._nearCandidates[De];if(this._near[fe]<Ee.near){const ve=this._geometries[fe],_e=ve.boundingInfo;this._includeNearBoundingInfoRec(_e,ve.shaderTransformation,Ee)}}for(let De=0;De<this._farCandidates.length;++De){const fe=this._farCandidates[De];if(this._far[fe]>Ee.far){const ve=this._geometries[fe],_e=ve.boundingInfo;this._includeFarBoundingInfoRec(_e,ve.shaderTransformation,Ee)}}return this._reset(),Ee}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(fe,ve,_e){if(null==fe)return;const be=fe.center;O$1v(gge,be,ve);const we=m$3g(ve),Se=gge[0],Te=gge[1],Ee=gge[2],Ce=fe.radius*we,Oe=this._frustum;if(Oe[0][0]*Se+Oe[0][1]*Te+Oe[0][2]*Ee+Oe[0][3]>Ce||Oe[1][0]*Se+Oe[1][1]*Te+Oe[1][2]*Ee+Oe[1][3]>Ce||Oe[2][0]*Se+Oe[2][1]*Te+Oe[2][2]*Ee+Oe[2][3]>Ce||Oe[3][0]*Se+Oe[3][1]*Te+Oe[3][2]*Ee+Oe[3][3]>Ce)return;const Re=this._view[2]*Se+this._view[6]*Te+this._view[10]*Ee+this._view[14],De=Re+Ce;if(!(-(Re-Ce)<2||-De>=_e.near))if(-De>this._looseRange.near)_e.near=-De;else{if(Ce>dge){const be=fe.getChildren();if(void 0!==be){for(const fe of be)this._includeNearBoundingInfoRec(fe,ve,_e);return}}wge.unionDepthRangeWithAABB(_e,this._viewProj,ve,fe.bbMin,fe.bbMax)}}_includeFarBoundingInfoRec(fe,ve,_e){if(null==fe)return;let be=fe.radius;const we=fe.center;O$1v(gge,we,ve);const Se=m$3g(ve),Te=gge[0],Ee=gge[1],Ce=gge[2];be*=Se;const Oe=this._frustum;if(Oe[0][0]*Te+Oe[0][1]*Ee+Oe[0][2]*Ce+Oe[0][3]>be||Oe[1][0]*Te+Oe[1][1]*Ee+Oe[1][2]*Ce+Oe[1][3]>be||Oe[2][0]*Te+Oe[2][1]*Ee+Oe[2][2]*Ce+Oe[2][3]>be||Oe[3][0]*Te+Oe[3][1]*Ee+Oe[3][2]*Ce+Oe[3][3]>be)return;const Re=this._view[2]*Te+this._view[6]*Ee+this._view[10]*Ce+this._view[14]-be;if(!(-Re<=_e.far))if(-Re<this._looseRange.far)_e.far=-Re;else{if(be>dge){const be=fe.getChildren();if(void 0!==be){for(const fe of be)this._includeFarBoundingInfoRec(fe,ve,_e);return}}wge.unionDepthRangeWithAABB(_e,this._viewProj,ve,fe.bbMin,fe.bbMax)}}},wge=new class N10{constructor(){this._modelViewProj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._clipPosition=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}unionDepthRangeWithAABB(fe,ve,_e,be,we){const Se=this._modelViewProj;c$4k(Se,ve,_e);let Te=!1;for(let Ee=0;Ee<8;++Ee){const fe=this._clipPosition[Ee],ve=0===Ee||3===Ee||4===Ee||7===Ee?be[0]:we[0],_e=0===Ee||1===Ee||4===Ee||5===Ee?be[1]:we[1],Te=Ee<4?be[2]:we[2];fe[0]=Se[0]*ve+Se[4]*_e+Se[8]*Te+Se[12],fe[1]=Se[1]*ve+Se[5]*_e+Se[9]*Te+Se[13],fe[2]=Se[2]*ve+Se[6]*_e+Se[10]*Te+Se[14],fe[3]=Se[3]*ve+Se[7]*_e+Se[11]*Te+Se[15]}for(let Ee=0;Ee<12;++Ee){const ve=E$b(this._clipPosition[yge[Ee][0]],this._clipPosition[yge[Ee][1]],this._clipPosition[yge[Ee][2]]);let _e=!0;for(let fe=0;fe<ve.length;++fe)if(ve[fe][3]>=2){_e=!1;break}if(!_e){Te=!0;for(let _e=0;_e<ve.length;++_e){const be=ve[_e][3];Number.isFinite(be)&&(fe.near=Math.min(be,fe.near),fe.far=Math.max(be,fe.far))}}}return Te}};let xge=class o35{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new xL(new ArrayBuffer(4)),this._layerToOidToColor=new wU,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new wU,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(fe,ve,_e,be,we,Se=null,Te=null,Ee=null){fe&&ve&&_e&&be&&(this._layerUidToId.set(be,_e),this._layerUidToPopupEnabled.set(be,we),we&&this._layerUidToGraphicsUidToObjectId.set(be,ve,{objectId:fe,attributeNodeId:Se,attributeIndex:Te,subLayerId:Ee}))}getObjectAndLayerIdColor(fe){const ve=this.getObjectAndLayerIdColorArray(fe);return r$35(ve.get(0,1),ve.get(0,2),ve.get(0,3),255)}getObjectAndLayerIdColorArray(fe){var ve;if(!fe.layerUid||!fe.graphicUid)return this.colorZero;const _e=this._layerUidToPopupEnabled.get(fe.layerUid);if(void 0===_e)return this.colorZero;if(!1===_e)return this.colorZero;const be=null==(ve=this._layerUidToGraphicsUidToObjectId.get(fe.layerUid,fe.graphicUid))?void 0:ve.objectId;if(!be)return this.colorZero;let we=this._layerToOidToColor.get(fe.layerUid,be);if(!we){for(;!we;){const fe=Math.floor(16777214*Math.random())+1;this._colorToUID.has(fe)||(we=fe)}if(we>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(fe.layerUid,be,we),this._colorToUID.set(we,fe)}const Se=new ArrayBuffer(4);return new DataView(Se).setUint32(0,we,!1),new xL(Se)}getColorToObjectAndLayerIdMapping(){const fe=new Map;for(const[ve,_e]of this._colorToUID.entries()){const be=this._layerUidToGraphicsUidToObjectId.get(_e.layerUid,_e.graphicUid),we=this._layerUidToId.get(_e.layerUid);be&&we&&fe.set(ve,be.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:be.objectId,lid:we,attrId:be.attributeNodeId,attrIdx:be.attributeIndex,subLayerId:be.subLayerId}:{type:"object-and-layer-id",oid:be.objectId,lid:we})}return fe}};var Sge,Tge;!function(fe){fe.OPAQUE="opaque-color",fe.TRANSPARENT="transparent-color",fe.COMPOSITE="composite-color",fe.FINAL="final-color"}(Sge||(Sge={})),function(fe){fe.ANTIALIASING="aa-color",fe.HIGHLIGHTS="highlight-color",fe.MAGNIFIER="magnifier-color"}(Tge||(Tge={}));let Ege=class e64{constructor(fe,ve){this.key=fe,this.free=ve,this.incarnation=0,this._refCount=1}retain(fe=1){this._refCount+=fe}release(){return 0===this._refCount||(--this._refCount,0===this._refCount&&(this.free(),!0))}};var Pge;!function(fe){fe[fe.FBO=0]="FBO",fe[fe.DEPTH=1]="DEPTH",fe[fe.COLOR=2]="COLOR"}(Pge||(Pge={}));let Cge=class e65 extends Ege{constructor(fe,ve,_e){super(fe,_e),this.attachment=ve,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},Oge=class s77 extends Cge{constructor(fe,ve,_e){super(fe,ve,_e),this.attachment=ve,this.type=Pge.COLOR}},Age=class r56 extends Cge{constructor(){super(...arguments),this.type=Pge.DEPTH}};let Mge=class i43 extends Ege{constructor(fe,ve,_e,be,we,Se){super(fe,Se),this.type=Pge.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=ve,this.fbo=_e,this.acquireDepth=be,this.acquireColor=we}dispose(){var fe;null==(fe=this.fbo)||fe.dispose()}get usedMemory(){var fe;return(null==(fe=this.fbo)?void 0:fe.usedMemory)||0}get name(){return this._name}setName(fe){this._name=fe}getTexture(fe=nA.COLOR_ATTACHMENT0){var ve,_e;return fe===oA?null==(ve=this.fbo)?void 0:ve.depthStencilTexture:null==(_e=this.fbo)?void 0:_e.getColorTexture(fe)}getAttachment(fe=nA.COLOR_ATTACHMENT0){return fe===oA?this._depth:this._colors.get(fe)}attachDepth(fe){var ve;return null==fe||fe.retain(),this.detachDepth(),fe&&(null==(ve=this.fbo)||ve.attachDepthStencil(fe.attachment)),this._depth=fe,this}detachDepth(){var fe,ve;null==(fe=this.fbo)||fe.detachDepthStencilTexture(),null==(ve=this.fbo)||ve.detachDepthStencilBuffer(),this._depth=t$4r(this._depth)}obtainDepthTexture(){var fe;const ve=this._depth;return function e$G(fe){return(null==fe?void 0:fe.attachment.type)===iM.Texture}(ve)?(null==(fe=this.fbo)||fe.detachDepthStencilTexture(),this._depth=null,ve):null}attachColor(fe,ve){var _e;return fe.retain(),this.detachColor(ve),null==(_e=this.fbo)||_e.attachColorTexture(fe.attachment,ve),this._colors.set(ve,fe),this}detachColor(fe){var ve;null==(ve=this.fbo)||ve.detachColorTexture(fe);const _e=this._colors.get(fe);this._colors.delete(fe),null==_e||_e.release()}detachAll(){this._colors.forEach(((fe,ve)=>this.detachColor(ve))),this.detachDepth()}},Rge=class i44{constructor(fe,ve){this._last=new jr,this._incarnation=0,this._cache=new hJ(fe,ve)}destroy(){var fe;null==(fe=this._last)||fe.forAll((fe=>fe.dispose())),this._last=null,this._cache.destroy()}set interactive(fe){var ve;fe&&!this._last?this._last=new jr:fe||(null==(ve=this._last)||ve.forAll((fe=>fe.dispose())),this._last=null)}clean(){var fe;null==(fe=this._last)||fe.filterInPlace((fe=>!(fe.incarnation<this._incarnation&&(this._cache.put(fe.key,fe),1))))}frame(){++this._incarnation}pop(fe){if(this._last){const ve=this._last.find((ve=>ve.key===fe));if(ve)return this._last.removeUnordered(ve),ve}return this._cache.pop(fe)}put(fe){fe.incarnation=this._incarnation,this._last?this._last.push(fe):this._cache.put(fe.key,fe)}get usedMemory(){var fe;return(null==(fe=this._last)?void 0:fe.reduce(((fe,ve)=>fe+ve.usedMemory),0))??0}},Ige=class f22{constructor(fe){this.rctx=fe,this._acquired=new Set,this._cache=new Rge(fe.newCache,"FBOCache"),this._depthCache=new Rge(fe.newCache,"DepthAttachmentCache"),this._colorCache=new Rge(fe.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const fe=this.debugCallback;fe&&this._acquired.forEach((ve=>ve.type===Pge.FBO&&fe(ve.name,ve.fbo)))}get usedMemory(){return Array.from(this._acquired.values()).reduce(((fe,ve)=>{var _e;return fe+("getTexture"in ve?(null==(_e=ve.getTexture())?void 0:_e.usedMemory)??0:ve.usedMemory)}),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(fe){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=fe}acquire(fe,ve,_e,be=YA.RGBA){const we=b$i(be,fe,ve);let Se=this._cache.pop(we);if(Se){Se.retain(),Se.setName(_e);const fe=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(Se.fbo),this.rctx.setDrawBuffers([nA.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(fe)}else Se=new Mge(we,_e,new vR(this.rctx,{...Bge[be],width:fe,height:ve}),(fe=>{fe??(fe=ZA.DEPTH_STENCIL_TEXTURE);const ve=this._acquireDepth(fe,Se.fbo.width,Se.fbo.height,`${Se.name} depth`);return Se.attachDepth(ve),ve.release(),Se}),((_e,be)=>{be??(be=YA.RGBA);const we=this._acquireColor(be,fe,ve,`${Se.name} color ${_e}`);return Se.attachColor(we,_e),we.release(),Se}),(()=>{this.debugCallback&&this.debugCallback(Se.name,Se.fbo),this._acquired.delete(Se),Se.detachAll(),this._cache.put(Se)}));return this._trackHandle(Se)}acquireDepth(fe,ve,_e,be){return this._acquireDepth(fe,ve,_e,be)}_acquireDepth(fe,ve,_e,be){const we=b$i(fe,ve,_e),Se=this._depthCache.pop(we);if(Se)return Se.retain(),Se.name=be,this._trackHandle(Se);const Te=fe===ZA.DEPTH_STENCIL_TEXTURE?new Age(we,new oM(this.rctx,{...Gge[fe],width:ve,height:_e}),(()=>{this._acquired.delete(Te),this._depthCache.put(Te)})):new Age(we,new gR(this.rctx,{...Gge[fe],width:ve,height:_e}),(()=>{this._acquired.delete(Te),this._depthCache.put(Te)}));return Te.name=be,this._trackHandle(Te)}_acquireColor(fe,ve,_e,be){const we=b$i(fe,ve,_e),Se=this._colorCache.pop(we);if(Se)return Se.retain(),Se.name=be,this._trackHandle(Se);const Te=new Oge(we,new oM(this.rctx,{...Bge[fe],width:ve,height:_e}),(()=>{this._acquired.delete(Te),this._colorCache.put(Te)}));return Te.name=be,this._trackHandle(Te)}_trackHandle(fe){return this._acquired.add(fe),fe}};const Lge=new Mge("default","default",null,(()=>Lge),(()=>Lge),(()=>{}));function b$i(fe,ve,_e){return`${fe}x${ve}x${_e}`}const Dge=new nM;Dge.pixelFormat=YO.RED,Dge.internalFormat=ZO.R8,Dge.wrapMode=qO.CLAMP_TO_EDGE;const Nge=new nM;Nge.pixelFormat=YO.RG,Nge.internalFormat=ZO.RG8,Nge.wrapMode=qO.CLAMP_TO_EDGE;const Fge=new nM;Fge.internalFormat=ZO.RGBA4,Fge.dataType=XO.UNSIGNED_SHORT_4_4_4_4,Fge.wrapMode=qO.CLAMP_TO_EDGE;const zge=new nM;zge.wrapMode=qO.CLAMP_TO_EDGE;const kge=new nM;kge.wrapMode=qO.CLAMP_TO_EDGE,kge.samplingMode=HO.LINEAR_MIPMAP_LINEAR,kge.hasMipmap=!0,kge.maxAnisotropy=8;const Uge=new nM;Uge.pixelFormat=YO.RED,Uge.dataType=XO.HALF_FLOAT,Uge.internalFormat=ZO.R16F,Uge.samplingMode=HO.NEAREST;const Vge=new nM;Vge.dataType=XO.HALF_FLOAT,Vge.internalFormat=ZO.RGBA16F,Vge.samplingMode=HO.NEAREST;const Bge={[YA.RED]:Dge,[YA.RG]:Nge,[YA.RGBA4]:Fge,[YA.RGBA]:zge,[YA.RGBA_MIPMAP]:kge,[YA.R16F]:Uge,[YA.RGBA16F]:Vge},jge=new nM;jge.pixelFormat=YO.DEPTH_STENCIL,jge.dataType=XO.UNSIGNED_INT_24_8,jge.samplingMode=HO.NEAREST,jge.wrapMode=qO.CLAMP_TO_EDGE;const Gge={[ZA.DEPTH_STENCIL_TEXTURE]:jge,[ZA.DEPTH16_BUFFER]:new yR(JO.DEPTH_COMPONENT16,4)};var Hge;!function(fe){fe[fe.FrontToBack=0]="FrontToBack",fe[fe.BackToFront=1]="BackToFront"}(Hge||(Hge={}));let qge=class i45{constructor(fe,ve,_e=Hge.FrontToBack){this._rctx=fe,this._techniques=ve,this._sorting=_e,this._draws=new jr({initialSize:32,allocator:fe=>fe||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(fe,ve,_e,be){const we=this._draws.pushNew();we.geometry=ve,we.geometryRanges=_e,we.material=fe,we.depthSquaredHint=be,we.indexType=(ve.indexed?ve.vao.indexBuffer.indexType:null)??0}prepare(fe,ve){return this._draws.map((_e=>_e.material.prepareTechnique(this._techniques,fe,ve,_e.geometry.parameters)))}dispatch(fe,ve,_e){const be=this._rctx;this._previouslyBoundDraw.clear();let we=null;const Se=this._draws.length;for(let Te=0;Te<Se;Te++){const Se=_e[Te];Se===we&&Se.configuration.transparencyPassType===WR.NONE||(be.bindTechnique(Se,ve,fe),we=Se);const Ee=this._draws.data[Te],Ce=Ee.geometry;be.bindVAO(Ce.vao),this._previouslyBoundDraw.get(Se)!==Ee.material&&(Se.program.bindDraw(Ee.material,ve,fe),this._previouslyBoundDraw.set(Se,Ee.material));const Oe=Ee.geometryRanges,Re=Oe.length;if(0!==Ee.indexType){const fe=Wge.get(Ee.indexType);for(let ve=0;ve<Re;ve+=2){const _e=Oe[ve],we=Oe[ve+1];be.drawElements(Ce.primitiveType,we,Ee.indexType,_e*fe)}}else for(let fe=0;fe<Re;fe+=2){const ve=Oe[fe],_e=Oe[fe+1];be.drawArrays(Ce.primitiveType,ve,_e)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const fe=this._sorting===Hge.FrontToBack?1:-1;this._draws.sort(((ve,_e)=>{const be=fe*(ve.depthSquaredHint-_e.depthSquaredHint);return 0!==be?be:ve.geometry.vao.byteSize-_e.geometry.vao.byteSize}))}get count(){return this._draws.length}};const Wge=new Map;Wge.set(BO.UNSIGNED_BYTE,1),Wge.set(BO.UNSIGNED_SHORT,2),Wge.set(BO.UNSIGNED_INT,4);let Yge=class M6 extends MN{constructor(){super({}),this._passes=null,this.produces=new Map([[qR.OPAQUE_MATERIAL,fe=>this._produces(fe)],[qR.TRANSPARENT_MATERIAL,fe=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(fe)],[qR.INTEGRATED_MESH,fe=>this._produces(fe)]]),this._materialPassParameters=new gY,this._shadowPassParameters=new vY,this._highlightPassParameters=new _Y,this._viewshedPassParameters=new $Y,this._systems=new Set}initializeRenderContext(fe){this._context=fe;const ve=fe.renderContext.rctx,_e=fe.techniques;this._passes={materialOpaque:new qge(ve,_e),materialTransparent:new qge(ve,_e,Hge.BackToFront),materialIntegratedMesh:new qge(ve,_e),shadowMap:new qge(ve,_e),highlight:new qge(ve,_e),highlightIntegratedMesh:new qge(ve,_e),highlightShadowMap:new qge(ve,_e),viewshedShadowMap:new qge(ve,_e),defaultShadowMap:new qge(ve,_e)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(fe){this._systems.add(fe)}_produces(fe){return 0!==this._systems.size&&null!==this._passes&&(fe===NI.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:fe!==NI.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(fe){if(0!==this._systems.size&&null!==this._passes){for(const fe of Object.values(this._passes))fe.prepareSubmit();this._systems.forEach((ve=>ve.submit(this._passes,fe.bindParameters)));for(const fe of Object.values(this._passes))fe.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(fe){if(0===this._systems.size)return null;const ve=fe.output===NI.Shadow||fe.output===NI.ShadowHighlight||fe.output===NI.ShadowExcludeHighlight?this._shadowPassParameters:fe.output===NI.ViewshedShadow?this._viewshedPassParameters:fe.output===NI.Highlight?this._highlightPassParameters:this._materialPassParameters,_e=fe.bindParameters;return this._updateParameters(_e.camera,ve,_e.slot===qR.TRANSPARENT_MATERIAL),this._materialPassParameters.output=fe.output,this._invoke(fe,((ve,_e)=>ve.prepare(_e,fe.bindParameters)))}renderNode(fe,ve){this._invoke(fe,((_e,be)=>_e.dispatch(be,fe.bindParameters,ve)))}_invoke(fe,ve){if(null===this._passes)return null;switch(fe.bindParameters.slot){case qR.OPAQUE_MATERIAL:switch(fe.output){case NI.Color:case NI.Depth:case NI.Normal:case NI.ObjectAndLayerIdColor:return ve(this._passes.materialOpaque,this._materialPassParameters);case NI.Highlight:return ve(this._passes.highlight,this._highlightPassParameters);case NI.Shadow:return ve(this._passes.shadowMap,this._shadowPassParameters);case NI.ShadowHighlight:return ve(this._passes.highlightShadowMap,this._shadowPassParameters);case NI.ShadowExcludeHighlight:return ve(this._passes.defaultShadowMap,this._shadowPassParameters);case NI.ViewshedShadow:return ve(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case qR.TRANSPARENT_MATERIAL:switch(fe.output){case NI.Color:case NI.Depth:case NI.Normal:case NI.ObjectAndLayerIdColor:return ve(this._passes.materialTransparent,this._materialPassParameters)}break;case qR.INTEGRATED_MESH:switch(fe.output){case NI.Color:case NI.Depth:case NI.Normal:case NI.ObjectAndLayerIdColor:return ve(this._passes.materialIntegratedMesh,this._materialPassParameters);case NI.Highlight:return ve(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(fe){const ve=new Gfe;return this._systems.forEach((_e=>e$N(ve,_e.queryShadowCasterDepthRange(fe)))),ve}_updateParameters(fe,ve,_e){const be=fe.viewInverseTransposeMatrix;o$44(Zge,be[3],be[7],be[11]),Jge.set(Zge),r$3w(ve.transformWorldFromViewTH,Jge.high),r$3w(ve.transformWorldFromViewTL,Jge.low),r$3w(ve.slicePlaneLocalOrigin,Zge),n$3X(ve.transformViewFromCameraRelativeRS,fe.viewMatrix),n$48(ve.transformProjFromView,fe.projectionMatrix),ve.identifier===yY.Material&&(this._materialPassParameters.transparent=_e,u$3n(Xge,ve.transformViewFromCameraRelativeRS),s$3F(ve.transformNormalViewFromGlobal,Xge))}};Yge=e$4o([a$4y("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Yge);const Zge=[0,0,0],Xge=[1,0,0,0,1,0,0,0,1],Jge=new vme;function n$10(fe){return fe.name}let Qge=class n43{constructor(fe){this._context=fe,this._nodes=new jr}destroy(){this._nodes.forEach((fe=>fe.destroy())),this._nodes.clear()}add(fe){this._nodes.push(fe)}remove(fe){this._nodes.remove(fe)}produces(fe){return this._nodes.some((({produces:ve})=>ve===fe))}require(fe,...ve){const _e=this._nodes;return ve.reduce(((ve,be)=>ve+_e.reduce(((ve,{consumes:_e,produces:we})=>ve+(_e.required.includes(fe)&&we===be?1:0)),0)),0)}optional(fe,...ve){const _e=this._nodes;return ve.reduce(((ve,be)=>ve+_e.reduce(((ve,{consumes:_e,produces:we})=>{var Se;return ve+((null==(Se=_e.optional)?void 0:Se.includes(fe))&&we===be?1:0)}),0)),0)}updateAnimation(){return this._nodes.reduce(((fe,ve)=>ve.updateAnimation()||fe),!1)}render(fe,ve,_e=()=>{}){const be=n$10(fe)?fe.name:fe,we=this._nodes.filter((({produces:fe})=>fe===be));return 0===we.length||(we.forEach((we=>{const Se=n$10(fe)?[fe]:[];for(const fe of we.consumes.required){if(fe===be)continue;const we=ve.get(fe);if(!we)return void(_e&&_e(Se));Se.push(we)}if(we.consumes.optional)for(const fe of we.consumes.optional){if(fe===be)continue;const _e=ve.get(fe);_e&&Se.push(_e)}try{const _e=we.doRender(Se,this._context);_e&&_e!==fe&&(n$10(fe)?(fe.release(),fe=_e,ve.set(be,fe)):fe=_e)}catch(br){ar.getLogger(we).errorOnce(br)}_e&&_e(Se)})),this._context.rctx.enforceState()),n$10(fe)?fe:Lge}},Kge=class h27{constructor(fe){this._context=fe,this._renderPlugins=new jr,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=r$2W(0);for(let ve=0;ve<qR.MAX_SLOTS;++ve)this._slots[ve]=[]}destroy(){this._renderPlugins.forEach((fe=>fe.destroy())),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(fe,ve){const s84=()=>{if(null==ve?void 0:ve.aborted)throw fe.uninitializeRenderContext(),u$47();this._renderPlugins.push(fe),fe.materialReference&&this._materialRenderers.set(fe.materialReference,fe),fe.produces.forEach(((ve,_e)=>{this._slots[_e].push(fe)})),this._context.requestRender(),this._renderVersion.value++},_e=fe.initializeRenderContext(this._context,ve);if(S$1T(_e))return _e.then(s84);s84()}remove(fe){if(null!=fe.materialReference&&this._materialRenderers.delete(fe.materialReference),null!=this._renderPlugins.removeUnordered(fe)){for(let ve=0;ve<this._slots.length;++ve)this._slots[ve]=this._slots[ve].filter((ve=>ve!==fe));fe.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll((fe=>{fe.prepareRender&&fe.prepareRender(this._context.renderContext)}))}updateAnimation(fe){let ve=!1;return this._renderPlugins.forAll((_e=>{_e.updateAnimation&&(ve=_e.updateAnimation(fe)||ve)})),ve}renderFeatureChanged(){this._renderPlugins.forAll((fe=>{fe.renderFeatureChanged&&fe.renderFeatureChanged()}))}prepare(...fe){for(const ve of fe)this._context.renderContext.bindParameters.slot=ve,this._slots[ve].forEach((fe=>{const _e=fe.produces.get(ve);(null==_e?void 0:_e(NI.Color))&&(a$2C(fe)&&fe.prepareTechnique(this._context.renderContext),l$2L(fe)&&fe.prepareTechniques(this._context.renderContext))}))}_getRenderables(){const fe=this._context.renderContext.bindParameters.slot,ve=this._context.renderContext.output??NI.Color,_e=new Map;return this._slots[fe].forEach((be=>{const we=be.produces.get(fe);if((null==we?void 0:we(ve))&&(!be.isDecoration||this._context.renderContext.bindParameters.decorations!==TA.OFF))if(a$2C(be)){const fe=be.prepareTechnique(this._context.renderContext);null!=fe&&_e.set(be,fe)}else if(l$2L(be)){const fe=be.prepareTechniques(this._context.renderContext);null!=fe&&_e.set(be,fe)}else _e.set(be,null)})),_e}render(fe,...ve){for(const _e of ve)this._context.renderContext.bindParameters.slot=_e,this._getRenderables().forEach(((ve,_e)=>_e.renderNode(this._context.renderContext,ve,fe)))}queryDepthRange(fe){const ve=new Gfe;return this._renderPlugins.forAll((_e=>{var be;const we=null==(be=_e.queryDepthRange)?void 0:be.call(_e,fe);e$N(ve,we)})),ve}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some((fe=>fe.running))}produces(fe,...ve){for(const _e of ve)if(this._slots[_e].some((ve=>{const be=ve.produces.get(_e);return!!be&&be(fe)})))return!0;return!1}consumes(fe){return this._renderPlugins.some((ve=>ve.consumes().required.includes(fe)))}getMaterialRenderer(fe){return this._materialRenderers.get(fe)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace((fe=>!fe.materialReference||0!==fe.numGeometries||(this._materialRenderers.delete(fe.materialReference),fe.destroy(),!1)))}get hasDecorations(){return this._renderPlugins.some((fe=>fe.isDecoration))}get hasOccludees(){return this._renderPlugins.some((fe=>fe.hasOccludees))}get renderOccludedFlags(){return this._renderPlugins.reduce(((fe,ve)=>fe|ve.renderOccludedFlags),ej.None)}get usedMemory(){return this._renderPlugins.reduce(((fe,ve)=>null!==ve.materialReference?fe:fe+(ve.usedMemory??0)),0)}get test(){}},eve=class o36{constructor(fe){this.techniques=fe,this._blitConfiguration=new ige,this._blitParameters=new ege}render(fe,ve,_e,be,we){fe.bindFramebuffer(_e.fbo);const Se=this.techniques.acquire(nge,this._blitConfiguration);return fe.setClearColor(0,0,0,1),fe.clear(DO.COLOR_BUFFER_BIT),(null==Se?void 0:Se.compiled)?(this._blitParameters.texture=ve.getTexture(),fe.bindTechnique(Se,be,this._blitParameters),fe.screen.draw(),Se.release(),_e):(we($A.UPDATE),_e)}},tve=class e66{constructor(){this._step=ave,this._dilation=1,this._firstIdleTime=0}frame(fe,ve){if(ve?0===this._firstIdleTime&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,has("disable-feature:high-quality-idle"))this._dilation=1;else{const fe=ve?performance.now()-this._firstIdleTime:0;if(fe>=ive+nve)return this._step=1/0,void(this._dilation=1);this._dilation=fe>=ive?sve:1}const _e=e$3Y(fe/rve,ave,lve);this._step===1/0?this._step=_e:this._step=this._step*ove+_e*(1-ove)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const rve=.5,ive=12e4,nve=1e4,sve=10,ove=.9,ave=1e3,lve=1e3/30;let cve=class f23{constructor(fe,ve){this._fbos=fe,this.compositingHelper=ve,this._width=4,this._height=4,this._clearColor=[0,0,0,0]}dispose(){this._color=t$4r(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(fe,ve,_e){this._fbos.interactive=_e===RR.Default;const be=this._fbos.rctx;this._width=fe.fullWidth,this._height=fe.fullHeight,A$18(this,be.parameters.maxTextureSize);const we=this._color;return this._color=null,this.releaseBuffers(),a$42(this._clearColor,ve),we}releaseBuffers(){var fe;null==(fe=this._color)||fe.detachDepth(),this._depth=t$4r(this._depth)}renderHUDVisibility(fe,ve,_e){var be,we;return(null==(be=null==fe?void 0:fe.fbo)?void 0:be.width)===this._width&&(null==(we=null==fe?void 0:fe.fbo)?void 0:we.height)===this._height||(null==fe||fe.release(),fe=this._fbos.acquire(this._width,this._height,"hud visibility",YA.RGBA4)),fe.attachDepth(_e||this.depth),this._fbos.rctx.bindFramebuffer(fe.fbo),this._fbos.rctx.clearFramebuffer(uve),ve(),fe.detachDepth(),fe}compositeToHUDVisibility(fe,ve){var _e;this._fbos.rctx.bindFramebuffer(null==(_e=fe.hudVisibility)?void 0:_e.fbo),this.compositingHelper.compositeHUD(fe,ve)}renderOITPass(fe,ve,_e){let be,we;const{_width:Se,_height:Te}=this;switch(ve){case WR.ColorAlpha:be=this._fbos.acquire(Se,Te,_e?"oit hud color alpha":"oit color alpha",YA.RGBA16F),be.acquireColor(nA.COLOR_ATTACHMENT1,YA.R16F),we=[0,0,0,1];break;case WR.FrontFace:be=this._fbos.acquire(Se,Te,_e?"oit hud front":"oit front"),we=[0,0,0,0]}return _e?be.acquireDepth(ZA.DEPTH16_BUFFER):be.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(be.fbo),this._fbos.rctx.clearFramebuffer(we,_e,_e),fe(),be.detachDepth(),be}compositeToFramebuffer(fe,ve,_e,be){this.bindFbo(),this.compositingHelper.composite(fe,ve,_e,be)}compositeOIT(fe,ve,_e,be){be?(this._fbos.rctx.bindFramebuffer(be.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(DO.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(fe,ve.getTexture(),ve.getTexture(nA.COLOR_ATTACHMENT1),_e.getTexture())}renderDepthDetached(fe){this._bindTarget(this.color),fe(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(fe,ve,_e,be,we=YA.RGBA,Se=ZA.DEPTH16_BUFFER,Te=this._width,Ee=this._height,Ce=null){var Oe,Re;return(null==(Oe=null==fe?void 0:fe.fbo)?void 0:Oe.width)===Te&&(null==(Re=null==fe?void 0:fe.fbo)?void 0:Re.height)===Ee||(fe=t$4r(fe)),fe=fe??this._fbos.acquire(Te,Ee,ve,we),null==Ce||Ce.forEach((ve=>fe.acquireColor(ve.attachment,ve.format))),null!=Se&&fe.acquireDepth(Se),this._fbos.rctx.bindFramebuffer(fe.fbo),this._fbos.rctx.clearFramebuffer(be,!0,!0),_e(),fe}renderToTargets(fe,ve,_e,be,we=!1,Se=!1){this._bindTarget(ve,_e),this._fbos.rctx.clearFramebuffer(be,we,Se),fe(),ve.detachDepth()}bindFbo(){const fe=null==this._color;if(this._bindTarget(this.color,this.depth),fe){const fe=this._fbos.rctx;fe.setClearStencil(0),fe.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),fe.clear(DO.COLOR_BUFFER_BIT|DO.DEPTH_BUFFER_BIT|DO.STENCIL_BUFFER_BIT)}}_bindTarget(fe,ve){fe.attachDepth(ve),this._fbos.rctx.bindFramebuffer(fe.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(fe){const ve=this._ensureColor();ve.attachDepth(this.depth),this._color=fe(ve)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(ZA.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const uve=[0,1,0,1];let hve=class t74{constructor(){this._inputs=new Map}set(fe,ve){this._inputs.set(fe,ve)}get(fe){return this._inputs.get(fe)}has(fe){return this._inputs.has(fe)}release(fe){var ve;(null==(ve=this._inputs.get(fe))?void 0:ve.release())&&this._inputs.delete(fe)}};const dve=255,pve=1/dve;function w$j(fe){const ve=new gO,_e=ve.fragment;return _e.include(a$32),_e.include(c$2X),ve.include(f$1C),ve.include(o$2A),ve.include(m$1P,fe),_e.uniforms.add(new CO("shadowMap",((fe,ve)=>ve.shadowMap.depthTexture)),new CO("depthMap",((fe,ve)=>{var _e;return null==(_e=ve.depth)?void 0:_e.attachment})),new pO("inverseViewMatrix",((fe,ve)=>h$2A(fve,i$45(fve,ve.camera.viewMatrix,ve.camera.center))))),_e.constants.add("sampleValue","float",pve),ve.outputs.add("sampleCount","float"),_e.code.add(o$2P`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),ve}const fve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mve=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:dve,build:w$j},Symbol.toStringTag,{value:"Module"}));var yve;!function(fe){fe[fe.Gradient=0]="Gradient",fe[fe.Threshold=1]="Threshold",fe[fe.COUNT=2]="COUNT"}(yve||(yve={}));let gve=class r57 extends HA{constructor(){super(...arguments),this.visualization=yve.Gradient,this.bandsEnabled=!1}};e$4o([r$2w({count:yve.COUNT})],gve.prototype,"visualization",void 0),e$4o([r$2w()],gve.prototype,"bandsEnabled",void 0);let vve=class p39 extends iO{constructor(fe){super(),this._data=fe,this.sampleScale=0,this.opacityFromElevation=1,this.color=t$3J(_ve),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const _ve=r$35(.01,0,.25,1);function w$i(fe){const ve=new gO,_e=ve.fragment;_e.include(a$32),_e.include(i$2Y),ve.include(f$1C),ve.include(o$2A);const{visualization:be,bandsEnabled:we}=fe;_e.constants.add("inverseSampleValue","float",dve),_e.uniforms.add(new CO("shadowCastMap",(fe=>fe.shadowCastMap)),new dO("sampleScale",(fe=>fe.sampleScale)),new dO("opacityFromElevation",(fe=>fe.opacityFromElevation)),new hO("uColor",(fe=>fe.color)));const Se=be===yve.Gradient,Te=be===yve.Threshold;return Se&&we?_e.uniforms.add(new dO("bandSize",(fe=>fe.bandSize))):Te&&_e.uniforms.add(new dO("threshold",(fe=>fe.threshold))),_e.code.add(o$2P`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${Te?o$2P`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${Se&&we?o$2P`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${Se?o$2P`* strength`:""});
    }
  `),ve}const $ve=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:vve,build:w$i},Symbol.toStringTag,{value:"Module"}));let bve=class m29 extends fA{constructor(fe,ve){super(fe,ve,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,m29.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:_j,colorWrite:AA,depthTest:null,depthWrite:null})}get primitiveType(){return NO.TRIANGLE_STRIP}};bve.shader=new LO($ve,(()=>zt((()=>Promise.resolve().then((()=>IRe))),void 0)));const wve=1/512;let xve=class m30 extends zi{constructor(fe,ve,_e,be){super({}),this._techniques=fe,this._rctx=ve,this._data=_e,this._requestRender=be,this._passParameters=new vve(this._data),this._techniqueConfig=new gve,this._enabled=!1,this._vao=i$2S(ve)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=r$3M(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(bve,this._techniqueConfig,this._technique),this._technique}render(fe){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const ve=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(ve,fe,this._passParameters),this._rctx.drawArrays(ve.primitiveType,0,i$2T(this._vao,"geometry"))}setOptions(fe){void 0!==fe.enabled&&this._setEnabled(fe.enabled),void 0!==fe.color&&this._setColor(fe.color),void 0!==fe.threshold&&(this._threshold=fe.threshold),void 0!==fe.visualization&&(this._visualization=fe.visualization),void 0!==fe.bandSize&&(this._bandSize=fe.bandSize),void 0!==fe.bandsEnabled&&(this._bandsEnabled=fe.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(fe){this._passParameters.opacityFromElevation!==fe&&(this._passParameters.opacityFromElevation=fe,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>wve}get _threshold(){return this._passParameters.threshold}set _threshold(fe){this._threshold!==fe&&(this._passParameters.threshold=fe,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(fe){fe!==this._visualization&&(this._techniqueConfig.visualization=fe,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(fe){fe!==this._bandSize&&(this._passParameters.bandSize=fe,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(fe){fe!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=fe,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(fe){E$1A(fe,this._passParameters.color)||(a$42(this._passParameters.color,fe),this._requestRenderIfRunning())}_setEnabled(fe){fe!==this._enabled&&(fe?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};e$4o([y$2v()],xve.prototype,"opacityFromElevation",null),xve=e$4o([a$4y("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],xve);let Sve=class d28 extends fA{constructor(fe){super(fe,new Pye,(()=>this.destroy()))}initializeProgram(fe){return new gA(fe.rctx,d28.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({blending:l$2_(FO.ONE,FO.ONE,FO.ONE,FO.ONE),colorWrite:AA,depthTest:null,depthWrite:null})}get primitiveType(){return NO.TRIANGLE_STRIP}};Sve.shader=new LO(mve,(()=>zt((()=>Promise.resolve().then((()=>LRe))),void 0)));let Tve=class M7 extends zi{constructor(fe,ve,_e,be,we,Se){super({}),this.fbos=fe,this._stage=_e,this._prepareForShadowMapPass=be,this._renderToShadowMap=we,this._requestRender=Se,this._progress=0,this._sampleCount=0,this._passParameters=new Tq,this._cachedLightDirections=[],this._depthRange=Hfe,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=fe.rctx,this._bindParameters=new uI(new xX(fe,_e.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=i$2S(this._rctx),this._accumulationRenderer=new xve(ve,this._rctx,this,Se);const Te=this._stage.view.resourceController.scheduler;this.addHandles([Te.registerTask(gI.SHADOW_ACCUMULATOR,this),d$3d((()=>_e.renderView),(fe=>{this.removeHandles(Pve),null!=fe&&this.addHandles(fe.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),Pve)}),Ja),d$3d((()=>this._previewing),(()=>this._requestRenderIfEnabled()),Za)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=r$3M(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=r$3M(this._fbo),this._vao=r$3M(this._vao),this._accumulationTechniqueCached=t$4r(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var fe;return null==(fe=this._fbo)?void 0:fe.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(null==this._accumulationTechniqueCached){const fe={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Sve(fe)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&this._sampleCount>0}get canAccumulate(){return null!=this._bindParameters.depth&&this._depthRange!==Hfe&&this._opacityFromElevation>wve}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(fe){const ve=this._cachedLightDirections;if(h$30(ve,fe,H$19))return;const _e=Math.min(dve,fe.length);ve.length=_e,this._sampleCount=_e;for(let be=0;be<_e;++be)ve[be]=r$3w(ve[be]??[0,0,0],fe[be]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(fe){this._accumulationRenderer.opacityFromElevation=fe}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(fe){for(this._prepareForShadowMapPass(this._bindParameters);!fe.done&&!this._isDoneAccumulating;)this._accumulateShadow(),fe.madeProgress();this._requestRender()}renderAccumulation(fe,ve,_e,be){if(this._depthRange=ve,this._updateCamera(_e),this._bindParameters.contentCamera=be,this._bindParameters.depth=fe,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const we=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Eve,this._sampleCount-this._progress);for(let Se=0;Se<we;++Se)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),we>0}render(fe){this._accumulationRenderer.render(fe)}setOptions(fe){if(void 0!==fe.enabled){const ve=null!=this._fbo;fe.enabled!==ve&&(fe.enabled?this._enable():this._disable())}void 0!==fe.previewing&&(this._previewing=fe.previewing),void 0!==fe.lightDirections&&(this._lightDirections=fe.lightDirections),this._accumulationRenderer.setOptions(fe)}readAccumulatedShadow(fe,ve){return!this._isActive||!this._fbo||this._progress<1||fe<0||fe>=this._fbo.width||ve<0||ve>=this._fbo.height?0:(this._fbo.readPixels(fe,ve,1,1,YO.RGBA,XO.UNSIGNED_BYTE,Cve),Cve[0]/this._progress)}_enable(){this._progress=0;const fe=new nM;fe.pixelFormat=YO.RED,fe.internalFormat=ZO.R8,fe.wrapMode=qO.CLAMP_TO_EDGE,this._fbo=new vR(this._rctx,fe),this._requestRender()}_disable(){this._fbo=r$3M(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(DO.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const fe=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(fe,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(fe.primitiveType,0,i$2T(this._vao,"geometry"))}_updateCamera(fe){const ve=this._fbo;if(null==ve)return;const _e=this._bindParameters.camera;fe.equals(_e)||_e.copyFrom(fe),ve.resize(fe.fullWidth,fe.fullHeight),this._opacityFromElevation=1-p$4Y(4e4,5e4,fe.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};e$4o([y$2v()],Tve.prototype,"_progress",void 0),e$4o([y$2v()],Tve.prototype,"_sampleCount",void 0),e$4o([y$2v()],Tve.prototype,"_fbo",void 0),e$4o([y$2v()],Tve.prototype,"_depthRange",void 0),e$4o([y$2v()],Tve.prototype,"_previewing",void 0),e$4o([y$2v()],Tve.prototype,"_accumulationRenderer",void 0),e$4o([y$2v()],Tve.prototype,"_isRefining",null),e$4o([y$2v()],Tve.prototype,"_isActive",null),e$4o([y$2v()],Tve.prototype,"canAccumulate",null),e$4o([y$2v()],Tve.prototype,"_isDoneAccumulating",null),e$4o([y$2v()],Tve.prototype,"_opacityFromElevation",null),e$4o([y$2v()],Tve.prototype,"running",null),Tve=e$4o([a$4y("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Tve);const Eve=6,Pve="renderView",Cve=new Uint8Array(4),Ove=W$H();let Ave=class n44{constructor(){this._plane=W$H()}get isEnabled(){return!ps(this.plane,Ove)}get plane(){return this._plane}set plane(fe){Z$A(fe||Ove,this._plane)}},Mve=class g21 extends NR{constructor(){super(...arguments),this.sectionAngles=[0,0,0,0]}get sectionAnglesDeg(){return e$3C(this.sectionAngles.map((fe=>M$1x(fe))))}set sectionAnglesDeg(fe){this.sectionAngles=e$3C(fe.map((fe=>h$2U(fe))))}get projectionMatrix(){return ud([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const fe=this.sectionAngles[0],ve=this.sectionAngles[1],_e=this.sectionAngles[2],be=this.sectionAngles[3];s$31(fe<=ve),s$31(_e<=be);const we=2*Math.tan(this.fovX/2),Se=2*Math.tan(this.fovY/2),Te=Math.tan(fe),Ee=Math.tan(ve),Ce=Math.tan(_e),Oe=Ee-Te,Re=Math.tan(be)-Ce,De=we/Oe,Be=Se/Re,Ze=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];q$X(Ze,[-(Te+Oe/2)/we*2,-(Ce+Re/2)/Se*2,0]);const Xe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];d$32(Xe,[De,Be,1]);return ud([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Xe,Ze)}get _sectionRatioX(){const fe=Math.tan(this.sectionAngles[0]),ve=Math.tan(this.sectionAngles[1]),_e=2*Math.tan(this.fovX/2);return Math.min(1,(ve-fe)/_e)}setViewport(fe,ve){const _e=ve*this._sectionRatioX;return this.viewport=[fe[0],fe[1],_e,ve],_e}};e$4o([y$2v()],Mve.prototype,"sectionAngles",void 0),e$4o([y$2v()],Mve.prototype,"sectionAnglesDeg",null),e$4o([y$2v()],Mve.prototype,"projectionMatrix",null),e$4o([y$2v()],Mve.prototype,"sectionMatrix",null),e$4o([y$2v()],Mve.prototype,"_sectionRatioX",null),Mve=e$4o([a$4y("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],Mve);let Rve=class x11{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(fe){return fe?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(fe){return Math.ceil(fe/this.textureSizeMultiple)*this.textureSizeMultiple}};const Ive=["front","left","right","back","top","bottom"];let Lve=class g22{constructor(fe){this._fbos=fe,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new Rve,this._maxTextureWidth=Math.min(has("esri-mobile")?4096:16384,fe.rctx.parameters.maxTextureSize)}get depthTexture(){var fe;return null==(fe=this._handle)?void 0:fe.getTexture()}get enabled(){return this._enabled}set enabled(fe){this._enabled=fe,fe||this.disposeOffscreenBuffers()}get isTextureZero(){return 0===this._textureWidth||0===this._textureHeight}get nearFar(){const fe=this.faces;return 0===fe.length?null:fe[0].nearFar}get numActiveFaces(){const fe=this._faces;let ve=0;return Object.keys(fe).forEach((_e=>{fe[_e]&&(ve+=1)})),ve}get faces(){const fe=this._faces,ve=[];for(const _e of Ive){const be=fe[_e];be&&ve.push(be)}return ve}get atlasRegions(){return this.faces.map((fe=>[fe.x/this._textureWidth,(fe.x+fe.width)/this._textureWidth,fe.y/this._textureHeight,(fe.y+fe.height)/this._textureHeight]))}get viewshedProjectionMatrices(){return this.faces.map((fe=>fe.projectionMatrix))}get viewshedViewMatrices(){return this.faces.map((fe=>fe.viewMatrix))}_setupFaceCamera(fe,ve,_e,be){const{observerRenderSpace:we,tiltedUpVector:Se,targetRenderSpace:Te,farDistanceRenderSpace:Ee,horizontalFieldOfView:Ce,verticalFieldOfView:Oe}=ve,Re=[0,0,0];Ki(Re,Te,we);const De=[0,0,0],Be=[0,0,0],B11=(fe,ve)=>{const _e=[0,0,0],be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return p$4z(be,fe,ve),O$1v(_e,Re,be),u$3Y(_e,we,_e),_e};let Ze,Xe=Se;const Je=Math.min(90,Ce),Qe=Math.min(90,Math.max(0,(Ce-90)/2));let dt=-45,$t=45,bt=-45,wt=45;if(function _$c(fe){return!["top","bottom"].includes(fe)}(fe)){const e77=fe=>e$3Y(fe,-45,45);bt=e77(-Oe/2)-this.settings.toleranceBottomTop,wt=e77(+Oe/2)+this.settings.toleranceBottomTop}switch(fe){case"front":Ze=Te,dt=-Je/2,$t=Je/2;break;case"left":Ze=B11(Math.PI/2,Se),dt=45-Qe;break;case"right":Ze=B11(-Math.PI/2,Se),$t=-45+Qe;break;case"top":Ze=u$3Y(De,we,Se),Xe=j$1O(Be,Re);break;case"bottom":Ze=Ki(De,we,Se),Xe=Re;break;case"back":Ze=B11(Math.PI,Se)}const xt=new Mve({center:Ze,eye:we,up:Xe,far:Ee});xt.sectionAnglesDeg=[dt-this.settings.toleranceSides,$t+this.settings.toleranceSides,bt,wt],xt.fovY=Math.PI/2;const St=xt.setViewport(_e,be);return this._faces[fe]=xt,St}_bindFBO(){var fe;const ve=this._fbos.rctx;ve.unbindTexture(this.depthTexture),ve.bindFramebuffer(null==(fe=this._handle)?void 0:fe.fbo)}_computeActiveFaces(fe){const ve=new Set,{horizontalFieldOfView:_e,verticalFieldOfView:be}=fe,we=-be/2,Se=be/2;return 0===_e||0===be||(we<=45&&Se>=-45&&ve.add("front"),_e>90&&(ve.add("left"),ve.add("right")),_e>270&&ve.add("back"),Se>45-this.settings.toleranceBottomTop&&ve.add("top"),we<-45+this.settings.toleranceBottomTop&&ve.add("bottom")),ve}_computeBaseTextureSize(fe,ve,_e,be){const we=Math.min(window.devicePixelRatio,ve)/fe.pixelRatio,Se=this.settings.textureSizeModifier(_e),Te=n$2$(Math.floor(Math.max(fe.fullWidth,fe.fullHeight)*we*Se)),Ee=Math.floor(this._maxTextureWidth/be);return i$2R(Math.min(Ee,Te))}_ensureFBO(){var fe,ve,_e,be,we;const Se=this._textureWidth,Te=this._textureHeight;(null==(ve=null==(fe=this._handle)?void 0:fe.fbo)?void 0:ve.width)===Se&&(null==(be=null==(_e=this._handle)?void 0:_e.fbo)?void 0:be.height)===Te||(null==(we=this._handle)||we.release(),this._handle=this._fbos.acquire(Se,Te,"viewshed shadow map",YA.RGBA4)),this._handle.acquireDepth(ZA.DEPTH16_BUFFER)}clearFBO(){const fe=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),fe.setClearColor(1,1,1,1),fe.clear(DO.COLOR_BUFFER_BIT|DO.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=t$4r(this._handle)}start(fe,ve,_e,be){if(this._faces={},!this.enabled)return!1;const we=this._computeActiveFaces(ve),Se=we.size;if(0===Se)return!1;const Te=this._computeBaseTextureSize(fe,be,_e,Se);if(0===Te)return!1;let Ee=0,Ce=0,Oe=0;return Ive.filter((fe=>we.has(fe))).forEach((fe=>{const _e=function b$h(fe,ve){if(ve<4)return 0;const _e="front"===fe||"left"===fe;return 4===ve?_e?0:1:_e||"right"===fe?0:1}(fe,Se);_e>Ce&&(Oe=Math.max(Oe,Ee),Ee=0),Ce=_e;const be=_e*Te;Ee+=this._setupFaceCamera(fe,ve,[Ee,be],Te)})),Oe=Math.max(Oe,Ee),this._textureWidth=this.settings.textureResizeModulo(Oe),this._textureHeight=function M$7(fe){return fe<4?1:2}(Se)*Te,this.clearFBO(),!0}finish(){var fe;null==(fe=this._handle)||fe.detachDepth()}get test(){return{faces:this._faces,faceTypes:Ive}}};let Dve=class m31 extends iO{constructor(){super(...arguments),this.localOrigin=[0,0,0]}};function n$Z(fe){fe.include(f$1C),fe.fragment.uniforms.add(new pO("inverseViewMatrix",((fe,ve)=>{const _e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return i$45(_e,ve.camera.viewMatrix,fe.localOrigin),e$3H(_e,_e)}))),fe.fragment.code.add(o$2P`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let Nve=class x12 extends Dve{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=dd.flat(),this.viewMatrices=dd.flat()}};function b$g(fe){const ve=new gO,_e=ve.fragment;ve.include(o$2A),ve.include(n$Z),ve.include(e$2T),_e.include(c$2X),_e.include(a$2h),_e.uniforms.add(new CO("depthTexture",((fe,ve)=>{var _e;return null==(_e=ve.depth)?void 0:_e.attachment}))),_e.uniforms.add(new pO("inverseProjectionMatrix",((fe,ve)=>ve.camera.inverseProjectionMatrix)),new pO("inverseViewNormalMatrix",((fe,ve)=>e$3H(Fve,ve.camera.viewInverseTransposeMatrix)))),_e.uniforms.add(new uO("viewshedTargetVector",((fe,ve)=>fe.targetVector)),new uO("viewshedUpVector",((fe,ve)=>fe.upVector)),new lO("viewshedFOVs",((fe,ve)=>fe.fovs)),new lO("viewshedHeadingAndTilt",((fe,ve)=>fe.headingAndTilt)),new lO("viewshedNearFar",((fe,ve)=>fe.shadowMap.nearFar??[1,100]))),_e.uniforms.add(new CO("viewshedShadowMap",(fe=>fe.shadowMap.depthTexture)),new xq("viewshedProjectionMatrices",((fe,ve)=>fe.projectionMatrices),6),new xq("viewshedViewMatrices",((fe,ve)=>fe.viewMatrices),6),new tq("viewshedNumFaces",((fe,ve)=>fe.shadowMap.numActiveFaces)),new dj("viewshedAtlasRegions",((fe,ve)=>fe.shadowMap.atlasRegions.flat()),24)),_e.constants.add("visibleColor","vec4",[0,1,0,.5]),_e.constants.add("occludedColor","vec4",[1,0,0,.5]);const be=fe.useNormalMap;return be?(_e.uniforms.add(new CO("normalMap",((fe,ve)=>fe.normalTexture))),_e.code.add(o$2P`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):ve.include(i$Z),_e.code.add(o$2P`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${be?o$2P`vec3 normal = normalFromTexture();`:o$2P`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),ve}const Fve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zve=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Nve,build:b$g},Symbol.toStringTag,{value:"Module"}));let kve=class l38 extends fA{initializeProgram(fe){return new gA(fe.rctx,l38.shader.get().build(this.configuration),mA)}initializePipeline(){return S$1g({colorWrite:AA,blending:_j})}};kve.shader=new LO(zve,(()=>zt((()=>Promise.resolve().then((()=>DRe))),void 0)));let Uve=class s78 extends HA{constructor(){super(...arguments),this.useNormalMap=!0}};e$4o([r$2w()],Uve.prototype,"useNormalMap",void 0);let Vve=class C9 extends ON{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(fe,ve){super(fe),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new Nve,this._configuration=new Uve,this._viewsheds=new Wa,this.produces=new Map([[qR.VIEWSHED,()=>!0]]),this._renderShadowMap=ve}initialize(){this.addHandles(d$3d((()=>this.view.qualitySettings.maximumPixelRatio),(fe=>this._maximumPixelRatio=fe),Ja))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?PN:EN}initializeRenderContext(fe){this._pluginContext=fe,this._viewshedShadowMap=new Lve(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(fe,ve,_e){var be,we,Se;const{bindParameters:Te,rctx:Ee}=fe;if(!this.enabled||!Te.depth||null==_e)return;const Ce=this._setupNormals(_e);if(null!=this._technique&&this._configuration.useNormalMap===Ce||(this._configuration.useNormalMap=Ce,this._technique=null==(be=this._pluginContext)?void 0:be.techniques.acquire(kve,this._configuration)),null==(we=this._technique)?void 0:we.compiled)for(const Oe of this._viewsheds){const ve=fe.rctx.getBoundFramebufferObject(),_e=this._renderViewshedShadowCubeMap(Te,Oe),be=this._viewshedShadowMap;_e&&null!=be.depthTexture&&!be.isTextureZero&&(this._setPassParameters(Oe),fe.rctx.bindFramebuffer(ve),Ee.bindTechnique(this._technique,Te,this._parameters),Ee.screen.draw())}else null==(Se=this._pluginContext)||Se.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=u$4d(this._technique)}updateViewsheds(fe){const ve=fe.removes;null!=ve&&(Wa.isCollection(ve)?this._viewsheds.removeMany(ve):this._viewsheds.remove(ve));const _e=fe.adds;if(null!=_e)if(Wa.isCollection(_e)){const fe=_e.filter((fe=>!this._viewsheds.includes(fe)));this._viewsheds.addMany(fe)}else this._viewsheds.includes(_e)||this._viewsheds.add(_e)}_renderViewshedShadowCubeMap(fe,ve){const _e=this._viewshedShadowMap;if(!_e.enabled)return!1;const be=_e.start(fe.camera,ve,this.renderHighQuality,this._maximumPixelRatio);if(be)for(const we of _e.faces)this._renderShadowMap(fe,we,NI.ViewshedShadow);return _e.finish(),be}_setPassParameters(fe){const ve=this._parameters,_e=this._viewshedShadowMap,be=fe.observerRenderSpace;ve.localOrigin=be,ve.fovs=[h$2U(fe.horizontalFieldOfView),h$2U(fe.verticalFieldOfView)],ve.headingAndTilt=[h$2U(fe.heading),h$2U(fe.tiltParallelToSurface)],ve.upVector=fe.tiltedUpVector;const we=function V$9(fe,ve){const _e=[0,0,0];return Ki(_e,fe,ve)}(fe.targetRenderSpace,be);ve.targetVector=we,ve.shadowMap=_e;const Se=[],Te=[];for(let Ee=0;Ee<_e.numActiveFaces;Ee++)i$45(Bve,_e.viewshedViewMatrices[Ee],be),Se.push(...Bve.flat()),q$4(_e.viewshedProjectionMatrices[Ee],Bve,jve),Te.push(...jve.flat());ve.viewMatrices=Se,ve.projectionMatrices=Te}_setupNormals(fe){const ve=fe.get("normals"),_e=null==ve?void 0:ve.getTexture();return this._parameters.normalTexture=_e,null!=_e}get test(){return{viewsheds:this._viewsheds}}};function q$4(fe,ve,_e){const be=r$3y(.5,.5,.5);return q$X(_e,be),f$2O(_e,_e,be),ud(_e,_e,fe),ud(_e,_e,ve),_e}e$4o([y$2v()],Vve.prototype,"_pluginContext",void 0),e$4o([y$2v()],Vve.prototype,"fboCache",void 0),e$4o([y$2v()],Vve.prototype,"view",void 0),e$4o([y$2v()],Vve.prototype,"viewshedShadowMap",null),Vve=e$4o([a$4y("esri.views.3d.webgl-engine.lib.Viewshed")],Vve);const Bve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let Gve=class e67{constructor(fe,ve,_e,be,we,Se,Te,Ee,Ce){this.createQuery=fe,this.deleteQuery=ve,this.resultAvailable=_e,this.getResult=be,this.disjoint=we,this.beginTimeElapsed=Se,this.endTimeElapsed=Te,this.createTimestamp=Ee,this.timestampBits=Ce}},Hve=!1;let qve=class r58{constructor(fe,ve){this._timer=fe,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,ve.forEach((fe=>{const ve=this._timer.createQuery(),_e=this._timer.createQuery();this._queryPool.push(ve,_e),this._queryResults.set(fe,null)}))}start(){Hve||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(fe){if(this._timer.disjoint()||null==this._currentQuery||!this._queryResults.has(fe))return this.abort(),null;this._timer.endTimeElapsed();const ve=this._queryResults.get(fe);if(null==ve)return this._queryResults.set(fe,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(ve))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const _e=this._timer.getResult(ve)/1e6;return this._queryPool.unshift(ve),this._queryResults.set(fe,this._currentQuery),this._currentQuery=null,_e}abort(){null!=this._currentQuery&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach((fe=>{this._timer.deleteQuery(fe)})),this._queryResults.forEach((fe=>{null!=fe&&this._timer.deleteQuery(fe)}))}};var Wve;!function(fe){fe.OVERLAY="overlay",fe.PREPARE="prepare",fe.SHADOW_MAP="shadow map",fe.DEPTH="depth",fe.ACCUMULATED_SHADOWS="accumulated shadows",fe.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",fe.NORMALS="normals",fe.SSAO="SSAO",fe.OPAQUE_EDGES="opaque edges",fe.VOXEL="voxel",fe.TRANSPARENT="transparent",fe.TRANSPARENT_EDGES="transparent edges",fe.HUD_VISIBILITY="HUD visibility",fe.TRANSPARENT_TERRAIN="transparent terrain",fe.OPAQUE_ENVIRONMENT="opaque environment",fe.TRANSPARENT_ENVIRONMENT="transparent environment",fe.LASER_LINES="laser lines",fe.VIEWSHED="viewshed",fe.OCCLUDED="occluded",fe.HUD="HUD",fe.HUD_OCCLUDED="HUD occluded",fe.FINISH="finish"}(Wve||(Wve={}));const Yve=Object.values(Sge).concat(Object.values(Tge)).concat(Object.values(Wve)),Zve="Total";let Xve=class p40{constructor(fe){this._rctx=fe,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Ur(Zve),this._cpuTimeSamplers=new Map(Yve.map((fe=>[fe,new Ur(fe)]))),this._enableGPUTimer=0,this._totalGPUTime=new Ur("GPU"),this._gpuTimeSamplers=new Map(Yve.map((fe=>[fe,new Ur(fe)]))),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const fe=[...Yve,Zve];this._gpuTimerPool=function e$D(fe,ve){const _e=fe.capabilities.disjointTimerQuery;return null==_e?null:new qve(_e,ve)}(this._rctx,fe)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let fe=!1;return{hasGPUTimerSupport:!0,remove:()=>{fe||(fe=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=r$3M(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(fe){const ve=performance.now();if(this._cpuTimeSamplers.get(fe).record(ve-this._lastTimeStampCPU),this._lastTimeStampCPU=ve,this._gpuTimerPool){const ve=this._gpuTimerPool.stop(fe);this._gpuTimeSamplers.get(fe).record(ve),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const fe=this._gpuTimerPool.stop(Wve.FINISH);this._gpuTimeSamplers.get(Wve.FINISH).record(fe),this._rctx.gl.flush()}const fe=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+fe,this._totalCPUTime.record(fe),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce(((fe,ve)=>fe+(ve.last||0)),0)),++this._totalFrameCount}};class Pe{constructor(fe,ve,_e,be,we,Se){this._stage=fe,this._techniques=_e,this._rctx=be,this._compositingHelper=we,this._requestRender=Se,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=fe=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=r$35(0,0,0,1),this._sliceHelper=new Ave,this._blit=null,this._state=r$2W(PM.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=Kpe.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new tve,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=r$2W(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new hve,this._releaseNormals=fe=>{fe.some((({name:fe})=>"normals"===fe))&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new Ige(be),this._renderStateFeatures=r$2W(s$2z(!has("disable-feature:high-quality-idle"),fe.view.qualityProfile)),this._offscreen=new cve(this.fboCache,this._compositingHelper),this.performanceInfo=new Xve(this._rctx),this._shadowMap=new xX(this.fboCache,fe.viewingMode),this._viewshed=new Vve({fboCache:this.fboCache,view:fe.view},((fe,ve,_e)=>{ve.setGLViewport(this._rctx);const{camera:be,contentCamera:we}=fe;this._ensureBindParametersCamera(ve,ve),this._renderAllGeometry(_e),this._ensureBindParametersCamera(be,we),fe.camera.setGLViewport(this._rctx)})),this._shadowAccumulator=new Tve(this.fboCache,_e,fe,(fe=>{const ve=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(fe.camera,fe.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=ve}),((fe,ve,_e)=>{const be=this._stage.view.qualitySettings.maximumPixelRatio;fe.shadowMap.start(fe.camera,ve,_e,!0,be),this._renderShadowCascades(NI.Shadow,fe.shadowMap),fe.shadowMap.finish(),fe.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(fe.camera,fe.contentCamera)}),Se),this._renderContext=new gX(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new Qge(this._renderContext),this._plugins=new Kge({renderContext:this._renderContext,techniques:_e,materials:ve,requestRender:Se,controller:fe,fbos:this.fboCache,isFeatureEnabled:fe=>this.isFeatureEnabled(fe)}),this.renderPassManager=new Yge,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[d$3d((()=>this._stage.view.state.camera),(()=>Se()),Ja),d$3d((()=>_B.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES),(fe=>{this._renderHiddenTransparentEdges=fe?()=>this._renderEdges(jG.TRANSPARENT):()=>{},Se()}),Xa),d$3d((()=>{var fe;return null==(fe=this._stage.view.environment.background)?void 0:fe.color}),(fe=>{const ve=fe?E$1l(fe):_d;s$3I(this._backgroundColor,ve[0]*ve[3],ve[1]*ve[3],ve[2]*ve[3],ve[3]),Se()}),Ja),d$3d((()=>this._stage.view.state.camera.relativeElevation),(fe=>{this._inGlobeView=(fe??1/0)>=oq}),Ja)]}destroy(){this._handles.forEach((fe=>fe.remove())),this._gpuTimerHandle=l$4E(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=e$4f(this._loadEdgeViewTask),this._edgeView=u$4d(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),tD.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(fe=null,ve=!has("disable-feature:high-quality-idle")){this._renderStateFeatures.value=s$2z(ve,fe),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(fe,ve=this._state.value){return this._renderStateFeatures.value.get(ve,fe)??!1}setFeatureEnabled(fe,ve,_e){this._renderStateFeatures.mutate((be=>be.set(ve,fe,_e))),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(xU.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(xU.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(NI.Highlight,qR.OPAQUE_MATERIAL,qR.TRANSPARENT_MATERIAL,qR.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,qR.LASERLINES,qR.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(xU.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(xU.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(xU.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=t$4r(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=t$4r(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=t$4r(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=t$4r(this._bindParameters.depth),this._bindParameters.hudVisibility=t$4r(this._bindParameters.hudVisibility)}get updating(){return null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=d$3e((async fe=>{const{EdgeView:ve}=await zt((()=>import("./EdgeView-DFiD3E-9.js")),__vite__mapDeps([194,195,71,27]));s$4o(fe);const _e=this._edgeView=new ve({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:Me(this._stage.view.resourceController)});return this._handles.push(d$3d((()=>_e.updating),(()=>this._requestRender()),Za)),this._requestRender(),this._edgeViewCallbacks.forEach((fe=>fe(_e))),this._edgeViewCallbacks.length=0,_e}))),this._loadEdgeViewTask.promise}withEdgeView(fe){this.loadEdgeView(),null==this._edgeView?this._edgeViewCallbacks.push(fe):fe(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&C$1l(this._bindParameters.ssr.reprojectionMatrix,dd)}set _reprojectionMatrix(fe){a$4J(this._bindParameters.ssr.reprojectionMatrix,fe)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var fe;return!!(null==(fe=this._shadowMap)?void 0:fe.enabled)}setParameters(fe){var ve;const{_shadowMap:_e,_bindParameters:be}=this;if(void 0!==(null==(ve=fe.qualitySettings)?void 0:ve.reflections)&&this._ssrEnabled!==fe.qualitySettings.reflections&&(this._ssrEnabled=fe.qualitySettings.reflections,this._requestRender()),void 0!==fe.shadowMap&&this._shadowMap.enabled!==fe.shadowMap&&(this._shadowMap.enabled=fe.shadowMap,this._requestRender()),void 0!==fe.shadowMapMaxCascades&&_e.maxCascades!==fe.shadowMapMaxCascades&&(_e.maxCascades=fe.shadowMapMaxCascades,this._requestRender()),null!=fe.environment){null!=fe.environment.weather&&(this._bindParameters.weather=fe.environment.weather,this._bindParameters.weatherVisible=!!fe.weatherVisible);const ve="virtual"!==fe.environment.lighting.type;be.enableFillLights!==ve&&(be.enableFillLights=ve,this._requestRender())}void 0!==fe.highQualityTransparency&&this._highQualityTransparencyEnabled!==fe.highQualityTransparency&&(this._highQualityTransparencyEnabled=fe.highQualityTransparency,this._requestRender()),void 0!==fe.hasOverlayWater&&this._hasOverlayWater!==fe.hasOverlayWater&&(this._hasOverlayWater=fe.hasOverlayWater,this._requestRender()),void 0!==fe.slicePlane&&this._sliceHelper.plane!==fe.slicePlane&&(this._sliceHelper.plane=fe.slicePlane,this._requestRender()),void 0!==fe.terrainTransparency&&this._terrainTransparency!==fe.terrainTransparency&&(this._terrainTransparency=fe.terrainTransparency,this._requestRender()),void 0!==fe.shadowCast&&this._shadowAccumulator.setOptions(fe.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(fe,ve){this._isRendering;const{adds:_e,removes:be,updates:we}=fe;if(0===_e.length&&0===be.length&&0===we.length)return;const Se=n$2W(fe);let Te=!1;Se.forEach(((_e,be)=>{if(ve.done)return;let we=this._plugins.getMaterialRenderer(be);if(null==we&&_e.adds.length>0){const fe=new pJ({material:be});fe.initializeRenderContext(this._plugins._context),we=fe,this._plugins.add(we)}we&&(we.modify(_e),0===we.numGeometries&&(Te=!0)),_e.removes.forEach((ve=>fe.removes.removeUnordered(ve))),_e.adds.forEach((ve=>fe.adds.removeUnordered(ve))),_e.updates.forEach((ve=>fe.updates.removeUnordered(ve))),ve.madeProgress()})),Te&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const fe=this._pluginsHas;fe.hudElements=this._plugins.produces(NI.Color,qR.LINE_CALLOUTS_HUD_DEPTH,qR.HUD_MATERIAL,qR.LABEL_MATERIAL),fe.water=this._plugins.produces(NI.Normal,qR.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(fe){const ve=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(fe),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==ve&&(this._gpuTimerHandle=ve?l$4E(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(fe,ve,_e=RR.Default,be=TA.ON){var we,Se,Te,Ee;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const Ce=this._offscreen,{camera:Oe,contentCamera:Re,mode:De,alignPixelEnabled:Be}=fe;this._state.value=De,this._bindParameters.overlay=this.renderOverlay(ve),this._bindParameters.overlay&&this.performanceInfo.advance(Wve.OVERLAY),this._renderContext.time=ve,this._bindParameters.transparencyPassType=WR.NONE,this._bindParameters.alignPixelEnabled=Be,this._bindParameters.decorations=be,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const Ze=this._nodes.produces("magnifier-color"),Xe=this._nodes.produces("final-color"),Je=W$H(this._sliceHelper.plane);be===TA.OFF&&(this._sliceHelper.plane=null),Oe.setGLViewport(this._rctx);const Qe=Ce.initializeFrame(Oe,this._backgroundColor,_e);this.hasReflections?this._bindParameters.ssr.lastFrameColor=Qe:null==Qe||Qe.release(),this._ensureBindParametersCamera(Oe,Re),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&be===TA.ON;const dt=this._plugins.produces(NI.Color,qR.OPAQUE_TERRAIN)&&(this._terrainTransparency===Kpe.Semitransparent||this._terrainTransparency===Kpe.TransparentWithDraped),$t=this._highQualityTransparency&&dt,bt=this._plugins.produces(NI.Color,...t_e);this._prepareShaders($t,bt),this.performanceInfo.advance(Wve.PREPARE);const wt=this._computeDepthRange(Oe);this._renderShadowMap(Oe,this._bindParameters.lighting.mainLight.direction,wt),this._ensureBindParametersCamera(Oe,Re);let xt=this._renderNormals();if(this._pluginInput.set("normals",xt),xt){let fe=null;this._needsDepth&&(fe=xt.getAttachment(oA),null==fe||fe.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(fe),xt=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(wt,Oe,Re),this._ensureBindParametersSSR(ve),this._renderContext.output=NI.Color,Ce.bindFbo(),this._bindParameters.mainColor=Ce.colorTexture,this._bindParameters.mainDepth=Ce.depthTexture;const St=this.plugins.produces(NI.Color,...e_e);St&&this._renderOpaqueGeometry(),this._offscreen.updateColor((fe=>this._renderNodes(Sge.OPAQUE,fe,St))),null==(Se=(we=this.fboCache).debugCallback)||Se.call(we,"opaque-color",this._offscreen.color.fbo),this._renderPlugins(qR.OPAQUE_ENVIRONMENT,Wve.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth($t),this._setMultipassTerrain($t),this._renderEdges(jG.OPAQUE),Ce.bindFbo(),this._renderPlugins(qR.VOXEL,Wve.VOXEL),this._renderHiddenTransparentEdges(),bt&&(this._oitEnabled?this._renderOITPass(Jve.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor((fe=>this._renderNodes(Sge.TRANSPARENT,fe,bt))),null==(Ee=(Te=this.fboCache).debugCallback)||Ee.call(Te,"transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth($t),this._renderHUDVisibility(),$t||this._plugins.render(this._pluginInput,qR.LINE_CALLOUTS);const Et=_e===RR.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(jG.TRANSPARENT);const Pt=dt?this._renderTransparentTerrain():null;Pt&&(this.performanceInfo.advance(Wve.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&($t?this._renderLineCallouts(BR.Occluded):Ce.compositeToHUDVisibility(this._bindParameters,Pt.getTexture()),this._renderHUD(BR.Occluded,Ce.color))),this._setTerrainCulling(!1),Pt&&(Ce.compositeToFramebuffer(this._bindParameters,Pt.getTexture(),rge.PremultipliedAlpha,1),Pt.release(),$t&&(this._renderEdges(jG.OPAQUE),bt&&(this._oitEnabled?this._renderOITPass(Jve.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(Wve.TRANSPARENT)),this._renderEdges(jG.TRANSPARENT))),this._bindParameters.ssao=t$4r(this._bindParameters.ssao),$t&&this._renderLineCallouts(BR.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor((fe=>this._renderNodes(Sge.COMPOSITE,fe)));const Ot=this._nodes.produces("aa-color"),At=!(_e!==RR.Default||Xe||Ze&&be===TA.ON&&_e===RR.Default),Mt=this._pluginInput.get("composite-color"),Rt=At?Lge:this.fboCache.acquire(Mt.fbo.width,Mt.fbo.height,"aa-color"),Nt=Ot?this._renderNodes(Tge.ANTIALIASING,Rt):this._blitToDefault(Mt,Rt,!1);this._pluginInput.set(Tge.ANTIALIASING,Nt),this._renderHUD(BR.NotOccluded,Nt);const Ft=this._renderNodes(Tge.HIGHLIGHTS,Nt);let zt=this._renderNodes(Tge.MAGNIFIER,Ft);return Ze&&be===TA.ON&&_e===RR.Default&&!Xe&&(zt=this._blitToDefault(zt)),Xe?(zt.attachDepth(Ce.depth),this._blitToDefault(this._renderNodes(Sge.FINAL,zt)),zt.detachDepth()):this._pluginInput.set(Sge.FINAL,zt),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=Je,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),_e!==RR.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:Et}}_prepareShaders(fe,ve){this._renderContext.output=NI.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(fe),this._plugins.prepare(qR.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),fe||this._plugins.prepare(qR.LINE_CALLOUTS),ve&&this._prepareTransparencySlots(),this._plugins.prepare(qR.VIEWSHED,qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,qR.TRANSPARENT_ENVIRONMENT,qR.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!has("enable-feature:objectAndLayerId-rendering"))return;const fe=this._renderContext.output,ve=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return ve.acquireDepth(ZA.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(ve.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(NI.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(ve.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=BR.NotOccluded,this._plugins.render(this._pluginInput,qR.HUD_MATERIAL),this._renderContext.output=fe,this.performanceInfo.advance(Wve.OBJECT_AND_LAYER_ID_COLOR),ve}finish(fe){this._hasAnimations||this._animationTimestep.clear();const ve=this.performanceInfo.gpuSamplingEnabled,_e=fe===$A.BACKGROUND;if(_e||ve){const fe=_e?this.performanceInfo.elapsedTime:0,be=ve?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),we=Math.max(fe,be);this._animationTimestep.frame(we,_e)}}readDepthPixels(fe,ve){var _e;if(!this._bindParameters.mainDepth)return;const{width:be,height:we}=this._offscreen,Se=this.fboCache.acquire(be,we,"linear-depth");this._rctx.bindFramebuffer(Se.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),null==(_e=Se.fbo)||_e.readPixels(fe[0],fe[1],fe[2],fe[3],YO.RGBA,XO.UNSIGNED_BYTE,ve),Se.release()}readHUDVisibility(fe,ve,_e,be,we){var Se,Te;null==(Te=null==(Se=this._bindParameters.hudVisibility)?void 0:Se.fbo)||Te.readPixels(fe,ve,_e,be,YO.RGBA,XO.UNSIGNED_BYTE,we)}readAccumulatedShadow(fe){return this._shadowAccumulator.readAccumulatedShadow(fe[0],fe[1])}_setMultipassTerrain(fe){this._setMultipassEnabled(fe),this._setTerrainCulling(fe)}_setMultipassEnabled(fe){this._bindParameters.multipassEnabled=fe}_setTerrainCulling(fe){this._bindParameters.multipassTerrain.cullAboveGround=fe}_renderEdges(fe){const ve=this._edgeView;if(!(null==ve?void 0:ve.shouldRender()))return;const{width:_e,height:be,depth:we}=this._offscreen,Se=this.fboCache.acquire(_e,be,"edges"),Te=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets((()=>ve.render(this._bindParameters,fe)),Se,Te??we,Kve),this._offscreen.compositeToFramebuffer(this._bindParameters,Se.getTexture(),rge.Alpha,1),Se.release(),this.performanceInfo.advance(fe===jG.OPAQUE?Wve.OPAQUE_EDGES:Wve.TRANSPARENT_EDGES)}_renderShadowMap(fe,ve,_e){const be=this._shadowMap;be.enabled&&(be.start(fe,ve,_e,this.isFeatureEnabled(xU.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(NI.ShadowHighlight,this._shadowMap),be.moveSnapshot($X.Highlight),this._renderShadowCascades(NI.ShadowExcludeHighlight,this._shadowMap),be.copySnapshot($X.ExcludeHighlight),this._renderShadowCascades(NI.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(NI.Shadow),be.finish(),fe.setGLViewport(this._rctx),this.performanceInfo.advance(Wve.SHADOW_MAP))}_renderShadowCascades(fe,ve=this._shadowMap){for(const _e of ve.cascades)_e.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(_e.camera,_e.camera),this._renderAllGeometry(fe)}get _needsDepth(){return this._plugins.consumes(NI.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(fe){if(!this._needsDepth||!fe)return void(this._bindParameters.depth=t$4r(this._bindParameters.depth));const{width:ve,height:_e}=this._offscreen,be=this.fboCache.acquire(ve,_e,"depth");be.attachDepth(fe),fe.release(),this._rctx.bindFramebuffer(be.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(NI.Depth),t$4r(this._bindParameters.depth),this._bindParameters.depth=be.obtainDepthTexture(),be.release(),this.performanceInfo.advance(Wve.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=t$4r(this._bindParameters.depth));const{width:fe,height:ve}=this._offscreen,_e=this.fboCache.acquire(fe,ve,"depth").acquireDepth(ZA.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(_e.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(NI.Depth),t$4r(this._bindParameters.depth),this._bindParameters.depth=_e.obtainDepthTexture(),_e.release(),this.performanceInfo.advance(Wve.DEPTH)}_renderMultipassTerrainDepth(fe){if(!fe)return void(this._bindParameters.multipassTerrain.depth=t$4r(this._bindParameters.multipassTerrain.depth));const ve=this._renderContext.output;this._renderContext.output=NI.Depth;const{width:_e,height:be}=this._offscreen,we=this.fboCache.acquire(_e,be,"terrain depth").acquireDepth(ZA.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(we.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),t$4r(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=we.obtainDepthTexture(),this._renderContext.output=ve,we.release()}_renderMultipassGeometryDepth(fe){if(!fe)return void(this._bindParameters.multipassGeometry.depth=t$4r(this._bindParameters.multipassGeometry.depth));const ve=this._renderContext.output,{width:_e,height:be}=this._offscreen,we=this.fboCache.acquire(_e,be,"geometry depth").acquireDepth(ZA.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(we.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(NI.Depth),this._renderContext.output=ve,t$4r(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=we.obtainDepthTexture(),we.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(fe){if(!this._needsDepthRange)return Hfe;const ve=M$b(fe,this._plugins.plugins,this._stage.layers);return e$N(ve,this._plugins.queryDepthRange(fe)),ve.near=Math.max(fe.near,ve.near),ve.far=Math.min(fe.far,ve.far),ve}_renderNormals(){const fe=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),ve=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+fe;if(0===ve)return;const _e=this._offscreen.renderToCachedFBO(null,"normals",(()=>this._renderGeometryForSSAO(NI.Normal)),[0,0,0,0],YA.RGBA,ZA.DEPTH_STENCIL_TEXTURE),be=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return _e.retain(ve+be-1),this.performanceInfo.advance(Wve.NORMALS),_e}_renderSSAO(){const fe=this._pluginInput.get("normals");if(!this.hasSSAO||!fe)return void(null==fe||fe.detachDepth());const ve=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=ve,fe.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Wve.SSAO),ve}_renderAllGeometry(fe){this._renderContext.output=fe,this._plugins.prepare(qR.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(fe),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(fe){this._renderContext.output=fe,this._plugins.prepare(qR.TRANSPARENT_MATERIAL,qR.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(fe){this._renderContext.output=fe,this._plugins.render(this._pluginInput,qR.INTEGRATED_MESH,qR.OPAQUE_TERRAIN,qR.OPAQUE_MATERIAL,qR.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(fe){this._renderContext.output=fe,this._plugins.render(this._pluginInput,qR.OPAQUE_NO_SSAO_DEPTH,qR.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...e_e,qR.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...e_e)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...t_e)}_renderTransparentTerrain(){const fe=this._renderContext.output;if(!this._plugins.produces(fe,qR.TRANSPARENT_TERRAIN))return;const t84=()=>this._plugins.render(this._pluginInput,qR.TRANSPARENT_TERRAIN);if(fe!==NI.Color)return void t84();const{width:ve,height:_e,depth:be}=this._offscreen,we=this.fboCache.acquire(ve,_e,"transparent terrain");return this._offscreen.renderToTargets(t84,we,be,[0,0,0,0]),we}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,qR.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,(()=>this._plugins.render(this._pluginInput,qR.OCCLUSION_PIXELS)),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(Wve.HUD_VISIBILITY)):this._bindParameters.hudVisibility=t$4r(this._bindParameters.hudVisibility)}_renderLineCallouts(fe){if(this._bindParameters.hudRenderStyle=fe,fe===BR.Occluded){const e77=()=>this._plugins.render(this._pluginInput,qR.LINE_CALLOUTS),{width:fe,height:ve,color:_e}=this._offscreen,be=this.fboCache.acquireDepth(ZA.DEPTH16_BUFFER,fe,ve,"line callouts");this._offscreen.renderToTargets(e77,_e,be,void 0,!0,!0),be.release()}else this._plugins.render(this._pluginInput,qR.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,qR.LASERLINES),this._plugins.produces(this._renderContext.output,qR.LASERLINES_CONTRAST_CONTROL)){const fe=this._offscreen,{width:ve,height:_e,depth:be}=fe,we=this.fboCache.acquire(ve,_e,"laser lines"),a55=()=>this._plugins.render(this._pluginInput,qR.LASERLINES_CONTRAST_CONTROL);fe.renderToTargets(a55,we,be,Kve),fe.compositeToFramebuffer(this._bindParameters,we.getTexture(),rge.PremultipliedAlpha,1),we.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(Wve.LASER_LINES)}}_renderHUD(fe,ve){if(this._pluginsHas.hudElements){if(this._oitEnabled){const _e=this._renderOITPass(Jve.HUD,fe);this._rctx.bindFramebuffer(ve.fbo),this._compositingHelper.composite(this._bindParameters,_e.getTexture(),rge.PremultipliedAlpha),_e.release()}else if(fe===BR.Occluded){this._renderContext.output=NI.Color;const t85=()=>this._renderHUDElements(fe),{width:ve,height:_e,color:be}=this._offscreen,we=this.fboCache.acquireDepth(ZA.DEPTH16_BUFFER,ve,_e,"hud");this._offscreen.renderToTargets(t85,be,we,void 0,!0,!0),we.release()}else this._renderContext.output=NI.Color,ve.acquireDepth(ZA.DEPTH16_BUFFER),this._rctx.bindFramebuffer(ve.fbo),this._renderHUDElements(fe),ve.detachDepth();this.performanceInfo.advance(fe===BR.Occluded?Wve.HUD_OCCLUDED:Wve.HUD)}}_renderHUDElements(fe){this._bindParameters.hudRenderStyle=fe,this._plugins.prepare(qR.LINE_CALLOUTS_HUD_DEPTH,qR.HUD_MATERIAL,qR.LABEL_MATERIAL),this._plugins.render(this._pluginInput,qR.LINE_CALLOUTS_HUD_DEPTH,qR.HUD_MATERIAL,qR.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(NI.ShadowHighlight,qR.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const fe=this._offscreen.renderToCachedFBO(null,"highlights",(()=>{this._renderAllGeometry(NI.Highlight),this._rctx.clear(DO.DEPTH_BUFFER_BIT),this._renderHUDElements(BR.Both)}),[0,0,0,0],YA.RGBA4,ZA.DEPTH_STENCIL_TEXTURE);return fe.detachDepth(),fe}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(fe,ve,_e){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,fe,ve,_e)&&this.performanceInfo.advance(Wve.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=NI.Color,this._bindParameters.transparencyPassType=WR.ColorAlpha,this._plugins.prepare(...t_e),this._bindParameters.transparencyPassType=WR.FrontFace,this._plugins.prepare(...t_e),this._bindParameters.transparencyPassType=WR.NONE,this._techniques.acquire(uge).release()}_renderOITPass(fe,ve=BR.Both){const _e=fe===Jve.HUD,be=_e?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,we=_e?()=>this._renderHUDElements(ve):()=>this._renderTransparentMaterial(),Se=this._renderContext.output;this._renderContext.output=NI.Color,this._bindParameters.transparencyPassType=WR.ColorAlpha;const Te=this._offscreen.renderOITPass(we,WR.ColorAlpha,_e);this._bindParameters.transparencyPassType=WR.FrontFace;const Ee=this._offscreen.renderOITPass(we,WR.FrontFace,_e);return this._offscreen.compositeOIT(this._bindParameters,Te,Ee,be),null==be||be.detachDepth(),Ee.release(),Te.release(),this._bindParameters.transparencyPassType=WR.NONE,this._renderContext.output=Se,be}_renderOccluded(){let fe=0;r_e.clear(),this._plugins.plugins.forAll((ve=>{ve.materialReference&&ve.queryRenderOccludedState(ej.OccludeAndTransparentStencil)&&(fe|=ej.OccludeAndTransparentStencil,r_e.push(ve))}));const ve=this._offscreen,r65=(_e,be,we,Se,Te)=>{if(!(fe&be))return;const{width:Ee,height:Ce,depth:Oe}=ve,Re=this.fboCache.acquire(Ee,Ce,"tmp color");ve.renderToTargets(we,Re,Oe,[0,0,0,0],Se,Te),ve.compositeToFramebuffer(this._bindParameters,Re.getTexture(),rge.PremultipliedAlpha,_e),Re.release()},s84=(fe,ve)=>{this._bindParameters.slot=fe,ve.forAll((fe=>{if(a$2C(fe)){const ve=fe.prepareTechnique(this._renderContext);ve&&fe.renderNode(this._renderContext,ve)}}))};0!==r_e.length&&(s84(qR.OCCLUDER_MATERIAL,r_e),r65(.5,ej.OccludeAndTransparentStencil,(()=>s84(qR.TRANSPARENT_OCCLUDER_MATERIAL,r_e)),!1,!1));const _e=r_e.length>0;r_e.clear(),this._plugins.plugins.forAll((ve=>{if(!ve.materialReference)return;const _e=ve.queryRenderOccludedState(ej.OccludeAndTransparent),be=ve.queryRenderOccludedState(ej.Transparent),we=ve.queryRenderOccludedState(ej.Opaque);(_e||be||we)&&(fe|=_e?ej.OccludeAndTransparent:be?ej.Transparent:ej.Opaque,r_e.push(ve))}));const be=this._plugins.renderOccludedFlags;if(fe|=be,!fe)return;const n52=fe=>{this._renderContext.renderOccludedMask=fe,be>ej.Occlude&&this._plugins.render(this._pluginInput,qR.OCCLUDED_TERRAIN),s84(qR.OPAQUE_MATERIAL,r_e),s84(qR.TRANSPARENT_MATERIAL,r_e),s84(qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r_e),this._renderContext.renderOccludedMask=vX};this._renderContext.output=NI.Color,r65(.5,ej.OccludeAndTransparent,(()=>n52(ej.OccludeAndTransparent)),!0,wA.OutlineVisualElementMask),r65(.5,ej.Transparent,(()=>n52(ej.Transparent)),!0,wA.OutlineVisualElementMask),r65(1,ej.Opaque,(()=>n52(ej.Opaque)),!0,wA.OutlineVisualElementMask),(_e||r_e.length>0)&&this.performanceInfo.advance(Wve.OCCLUDED),r_e.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,qR.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,qR.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(Wve.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(xU.HighResolutionViewshed),this._plugins.render(this._pluginInput,qR.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(Wve.VIEWSHED))}_renderPlugins(fe,ve){this._plugins.produces(this._renderContext.output,fe)&&(this._plugins.render(this._pluginInput,fe),this.performanceInfo.advance(ve))}_renderNodes(fe,ve,_e=!1){if(!this._nodes.produces(fe))return _e&&this.performanceInfo.advance(fe),ve;ve.setName(fe),this._pluginInput.set(fe,ve);const be=this._nodes.render(ve,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(fe),be}_blitToDefault(fe,ve=Lge,_e=!0){this._blit||(this._blit=new eve(this._techniques));const be=this._blit.render(this._rctx,fe,ve,this._bindParameters,this._requestRender);return this._pluginInput.set(fe.name,be),_e&&fe.release(),be}_ensureBindParametersCamera(fe,ve){this._bindParameters.camera=fe,this._bindParameters.contentCamera=ve}_ensureBindParametersSSR(fe){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&(this._ssrEnableTime=fe),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=dd:(h$2A(n_e,this._bindParameters.camera.viewMatrix),h$2A(i_e,this._bindParameters.camera.projectionMatrix),c$4k(s_e,n_e,i_e),c$4k(s_e,this._renderContext.lastFrameCamera.viewMatrix,s_e),c$4k(s_e,this._renderContext.lastFrameCamera.projectionMatrix,s_e),this._reprojectionMatrix=s_e);const ve=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=ve>0?Math.min(ve,fe-this._ssrEnableTime)/ve:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=dd,this._ssrEnableTime=null}addRenderNode(fe){this._nodes.add(fe),this._requestRender()}removeRenderNode(fe){this._nodes.remove(fe),this._requestRender()}get usedMemory(){var fe;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:(null==(fe=this.edgeView)?void 0:fe.usedMemory)??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,qR.VIEWSHED)}get test(){}}var Jve,Qve;e$4o([y$2v({readOnly:!0})],Pe.prototype,"fullResolutionAtmosphere",null),e$4o([y$2v()],Pe.prototype,"_edgeView",void 0),e$4o([y$2v()],Pe.prototype,"updating",null),function(fe){fe[fe.Geometry=0]="Geometry",fe[fe.HUD=1]="HUD"}(Jve||(Jve={})),function(fe){fe[fe.Color=0]="Color",fe[fe.LinearDepth=1]="LinearDepth",fe[fe.ShadowMap=2]="ShadowMap",fe[fe.HudVisibility=3]="HudVisibility",fe[fe.ViewshedShadowMap=4]="ViewshedShadowMap"}(Qve||(Qve={}));const Kve=[0,0,0,0],e_e=[qR.INTEGRATED_MESH,qR.OPAQUE_TERRAIN,qR.OPAQUE_MATERIAL,qR.OPAQUE_NO_SSAO_DEPTH],t_e=[qR.TRANSPARENT_MATERIAL,qR.TRANSPARENT_NO_SSAO_DEPTH],r_e=new jr,i_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Me(fe){return ve=>fe.immediate.schedule(ve)}let o_e=class m32{constructor(fe){this._rctx=fe,this._vao=function c$15(fe,ve=QA,_e=mA){const be=new Float32Array([-1,-1,3,-1,-1,3]);return new tM(fe,_e,{geometry:ve},{geometry:rM.createVertex(fe,QO.STATIC_DRAW,be)})}(fe)}destroy(){this._vao=r$3M(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(NO.TRIANGLES,0,3))}get test(){}};let a_e=class n45{constructor(fe){this._rctx=fe,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const fe=n45.getShaderSources();return this._rctx.programCache.acquire(fe.vertex,fe.fragment,new Map([]))}_createIndexbuffer(){return rM.createIndex(this._rctx,QO.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,kO.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(NO.POINTS,1,BO.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},l_e=class h28{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:FO.ONE,dstRGB:FO.ZERO,srcAlpha:FO.ONE,dstAlpha:FO.ZERO},this.blendEquation={mode:zO.ADD,modeAlpha:zO.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=UO.BACK,this.frontFace=VO.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=jO.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:UO.FRONT_AND_BACK,func:jO.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:UO.FRONT_AND_BACK,fail:GO.KEEP,zFail:GO.KEEP,zPass:GO.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[sA.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},c_e=class n46{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<iA.COUNT;)this._current.push(0)}increment(fe,ve,_e=1){var be;this._current[fe]+=_e,null==(be=this._allocations)||be.add(ve)}decrement(fe,ve,_e=1){var be;this._current[fe]-=_e,null==(be=this._allocations)||be.remove(ve)}get current(){return this._current}get total(){return this.current.reduce(((fe,ve,_e)=>fe+(_e<iA.UNCOUNTED?ve:0)),0)}get resourceInformation(){var fe;let ve="";if(this.total>0){ve+="Live objects:\n";for(let fe=0;fe<iA.COUNT;++fe){const _e=this._current[fe];_e>0&&(ve+=`${iA[fe]}: ${_e}\n`)}}return ve+=null==(fe=this._allocations)?void 0:fe.resetLog(),ve}},u_e=class e68{constructor(fe,ve,_e){const be=ve.textureFilterAnisotropic,we=_e.maxAnisotropy??1/0;this.versionString=fe.getParameter(fe.VERSION),this.maxVertexTextureImageUnits=fe.getParameter(fe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=fe.getParameter(fe.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=be?Math.min(fe.getParameter(be.MAX_TEXTURE_MAX_ANISOTROPY),we):1,this.maxTextureImageUnits=fe.getParameter(fe.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=fe.getParameter(fe.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=fe.getParameter(fe.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=fe.getParameter(fe.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=fe.getParameter(fe.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=fe.getParameter(fe.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=fe.getParameter(fe.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=fe.getParameter(fe.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=fe.getParameter(fe.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=fe.getParameter(fe.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=fe.getParameter(fe.MAX_SAMPLES),this.maxDrawBuffers=fe.getParameter(fe.MAX_DRAW_BUFFERS)}};const h_e=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var d_e,p_e={exports:{}};void 0!==(d_e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(p_e.exports=d_e);const f_e=o$2e(p_e.exports);var m_e,y_e={exports:{}};m_e=y_e,function(fe){var ve=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];void 0!==ve&&(m_e.exports=ve)}();const g_e=o$2e(y_e.exports);var v_e={exports:{}};!function(fe){!function(ve){var _e=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();void 0!==_e&&(fe.exports=_e)}()}(v_e);const __e=o$2e(v_e.exports);var $_e=999,b_e=9999,w_e=0,x_e=1,S_e=2,T_e=3,E_e=4,P_e=5,C_e=6,O_e=7,A_e=8,M_e=9,R_e=10,I_e=11,L_e=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function E$9(){var fe,ve,_e,be=0,we=0,Se=$_e,Te=[],Ee=[],Ce=1,Oe=0,Re=0,De=!1,Be=!1,Ze="";return function(ve){return Ee=[],null!==ve?function F7(ve){var Te;for(be=0,_e=(Ze+=ve).length;fe=Ze[be],be<_e;){switch(Te=be,Se){case w_e:be=V9();break;case x_e:be=P9();break;case S_e:be=M10();break;case T_e:be=O16();break;case E_e:be=$5();break;case I_e:be=W5();break;case P_e:be=z10();break;case b_e:be=I12();break;case M_e:be=H7();break;case $_e:be=C12()}Te!==be&&("\n"===Ze[Te]?(Oe=0,++Ce):++Oe)}return we+=be,Ze=Ze.slice(be),Ee}(ve.replace?ve.replace(/\r\n/g,"\n"):ve):function L10(fe){return Te.length&&X4(Te.join("")),Se=R_e,X4("(eof)"),Ee}()};function X4(fe){fe.length&&Ee.push({type:L_e[Se],data:fe,position:Re,line:Ce,column:Oe})}function C12(){return Te=Te.length?[]:Te,"/"===ve&&"*"===fe?(Re=we+be-1,Se=w_e,ve=fe,be+1):"/"===ve&&"/"===fe?(Re=we+be-1,Se=x_e,ve=fe,be+1):"#"===fe?(Se=S_e,Re=we+be,be):/\s/.test(fe)?(Se=M_e,Re=we+be,be):(De=/\d/.test(fe),Be=/[^\w_]/.test(fe),Re=we+be,Se=De?E_e:Be?T_e:b_e,be)}function H7(){return/[^\s]/g.test(fe)?(X4(Te.join("")),Se=$_e,be):(Te.push(fe),ve=fe,be+1)}function M10(){return"\r"!==fe&&"\n"!==fe||"\\"===ve?(Te.push(fe),ve=fe,be+1):(X4(Te.join("")),Se=$_e,be)}function P9(){return M10()}function V9(){return"/"===fe&&"*"===ve?(Te.push(fe),X4(Te.join("")),Se=$_e,be+1):(Te.push(fe),ve=fe,be+1)}function O16(){if("."===ve&&/\d/.test(fe))return Se=P_e,be;if("/"===ve&&"*"===fe)return Se=w_e,be;if("/"===ve&&"/"===fe)return Se=x_e,be;if("."===fe&&Te.length){for(;N14(Te););return Se=P_e,be}if(";"===fe||")"===fe||"("===fe){if(Te.length)for(;N14(Te););return X4(fe),Se=$_e,be+1}var _e=2===Te.length&&"="!==fe;if(/[\w_\d\s]/.test(fe)||_e){for(;N14(Te););return Se=$_e,be}return Te.push(fe),ve=fe,be+1}function N14(fe){for(var ve,_e,be=0;;){if(ve=g_e.indexOf(fe.slice(0,fe.length+be).join("")),_e=g_e[ve],-1===ve){if(be--+fe.length>0)continue;_e=fe.slice(0,1).join("")}return X4(_e),Re+=_e.length,(Te=Te.slice(_e.length)).length}}function W5(){return/[^a-fA-F0-9]/.test(fe)?(X4(Te.join("")),Se=$_e,be):(Te.push(fe),ve=fe,be+1)}function $5(){return"."===fe||/[eE]/.test(fe)?(Te.push(fe),Se=P_e,ve=fe,be+1):"x"===fe&&1===Te.length&&"0"===Te[0]?(Se=I_e,Te.push(fe),ve=fe,be+1):/[^\d]/.test(fe)?(X4(Te.join("")),Se=$_e,be):(Te.push(fe),ve=fe,be+1)}function z10(){return"f"===fe&&(Te.push(fe),ve=fe,be+=1),/[eE]/.test(fe)||"-"===fe&&/[eE]/.test(ve)?(Te.push(fe),ve=fe,be+1):/[^\d]/.test(fe)?(X4(Te.join("")),Se=$_e,be):(Te.push(fe),ve=fe,be+1)}function I12(){if(/[^\d\w_]/.test(fe)){var _e=Te.join("");return Se=f_e.indexOf(_e)>-1?A_e:__e.indexOf(_e)>-1?O_e:C_e,X4(Te.join("")),Se=$_e,be}return Te.push(fe),ve=fe,be+1}}function v$f(fe){return function _$b(fe){var ve=E$9(),_e=[];return(_e=_e.concat(ve(fe))).concat(ve(null))}(fe)}const D_e=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function D$6(fe,ve){for(let _e=ve-1;_e>=0;_e--){const ve=fe[_e];if("whitespace"!==ve.type&&"block-comment"!==ve.type){if("keyword"!==ve.type)break;if("attribute"===ve.data||"in"===ve.data)return!0}}return!1}function R$9(fe,ve,_e,be){be=be||_e;for(const we of fe)if("ident"===we.type&&we.data===_e)return be in ve?ve[be]++:ve[be]=0,R$9(fe,ve,be+"_"+ve[be],be);return _e}function T$8(fe,ve,_e="afterVersion"){function r65(fe,ve){for(let _e=ve;_e<fe.length;_e++){const ve=fe[_e];if("operator"===ve.type&&";"===ve.data)return _e}return null}const be={data:"\n",type:"whitespace"},i52=ve=>ve<fe.length&&/[^\r\n]$/.test(fe[ve].data);let we=function n52(fe){let ve=-1,be=0,we=-1;for(let Se=0;Se<fe.length;Se++){const Te=fe[Se];if("preprocessor"===Te.type&&(/#(if|ifdef|ifndef)\s+.+/.test(Te.data)?++be:/#endif\s*.*/.test(Te.data)&&--be),"afterVersion"!==_e&&"afterPrecision"!==_e||"preprocessor"===Te.type&&Te.data.startsWith("#version")&&(we=Math.max(we,Se)),"afterPrecision"===_e&&"keyword"===Te.type&&"precision"===Te.data){const ve=r65(fe,Se);if(null===ve)throw new Error("precision statement not followed by any semicolons!");we=Math.max(we,ve)}ve<we&&0===be&&(ve=Se)}return ve+1}(fe);i52(we-1)&&fe.splice(we++,0,be);for(const Se of ve)fe.splice(we++,0,Se);i52(we-1)&&i52(we)&&fe.splice(we,0,be)}function S$c(fe,ve,_e,be="lowp"){T$8(fe,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:be},{type:"whitespace",data:" "},{type:"keyword",data:_e},{type:"whitespace",data:" "},{type:"ident",data:ve},{type:"operator",data:";"}],"afterPrecision")}function G$3(fe,ve,_e,be,we="lowp"){T$8(fe,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:be.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:we},{type:"whitespace",data:" "},{type:"keyword",data:_e},{type:"whitespace",data:" "},{type:"ident",data:ve},{type:"operator",data:";"}],"afterPrecision")}function X$2(fe,ve){let _e,be,we=-1;for(let Se=ve;Se<fe.length;Se++){const ve=fe[Se];if("operator"===ve.type&&("["===ve.data&&(_e=Se),"]"===ve.data)){be=Se;break}"integer"===ve.type&&(we=parseInt(ve.data,10))}return _e&&be&&fe.splice(_e,be-_e+1),we}function F$7(fe,ve){if(fe.startsWith("#version 300"))return fe;const _e=v$f(fe);if("300 es"===function x$8(fe,ve="100",_e="300 es"){const be=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const we of fe)if("preprocessor"===we.type){const fe=be.exec(we.data);if(fe){const be=fe[1].replaceAll(/\s{2,}/g," ");if(be===_e)return be;if(be===ve)return we.data="#version "+_e,ve;throw new Error("unknown glsl version: "+be)}}return fe.splice(0,0,{type:"preprocessor",data:"#version "+_e},{type:"whitespace",data:"\n"}),null}(_e,"100","300 es"))return fe;let be=null,we=null;const Se={},Te={};for(let Ee=0;Ee<_e.length;++Ee){const fe=_e[Ee];switch(fe.type){case"keyword":ve===KO.VERTEX_SHADER&&"attribute"===fe.data?fe.data="in":"varying"===fe.data&&(fe.data=ve===KO.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(fe.data.trim())&&(fe.data=fe.data.replaceAll(/(2D|Cube|EXT)/g,"")),ve===KO.FRAGMENT_SHADER&&"gl_FragColor"===fe.data&&(be||(be=R$9(_e,Se,"fragColor"),S$c(_e,be,"vec4")),fe.data=be),ve===KO.FRAGMENT_SHADER&&"gl_FragData"===fe.data){const ve=X$2(_e,Ee+1),be=R$9(_e,Se,"fragData");G$3(_e,be,"vec4",ve,"mediump"),fe.data=be}else ve===KO.FRAGMENT_SHADER&&"gl_FragDepthEXT"===fe.data&&(we||(we=R$9(_e,Se,"gl_FragDepth")),fe.data=we);break;case"ident":if(h_e.includes(fe.data)){if(ve===KO.VERTEX_SHADER&&D$6(_e,Ee))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");fe.data in Te||(Te[fe.data]=R$9(_e,Se,fe.data)),fe.data=Te[fe.data]}}}for(let Ee=_e.length-1;Ee>=0;--Ee){const fe=_e[Ee];if("preprocessor"===fe.type){const ve=fe.data.match(/#extension\s+(.*):/);if((null==ve?void 0:ve[1])&&D_e.has(ve[1].trim())){const fe=_e[Ee+1];_e.splice(Ee,fe&&"whitespace"===fe.type?2:1)}const be=fe.data.match(/#ifdef\s+(.*)/);(null==be?void 0:be[1])&&D_e.has(be[1].trim())&&(fe.data="#if 1");const we=fe.data.match(/#ifndef\s+(.*)/);(null==we?void 0:we[1])&&D_e.has(we[1].trim())&&(fe.data="#if 0")}}return function H$5(fe,ve){return ve}(0,function j$f(fe){return fe.map((fe=>"eof"!==fe.type?fe.data:"")).join("")}(_e))}let N_e=class r59{constructor(fe,ve,_e,be,we=new Map,Se=[]){var Te;this._context=fe,this._locations=be,this._uniformBlockBindings=we,this._transformFeedbackVaryings=Se,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,ve.length,ve=F$7(ve,KO.VERTEX_SHADER),_e=F$7(_e,KO.FRAGMENT_SHADER),this._vShader=s$H(this._context,KO.VERTEX_SHADER,ve),this._fShader=s$H(this._context,KO.FRAGMENT_SHADER,_e),this._vShader&&this._fShader,this._context.instanceCounter.increment(iA.Shader,this),c$2T()&&(this.vertexShader=ve,this.fragmentShader=_e),this.usedMemory=ve.length+_e.length;const Ee=this._context.gl,Ce=Ee.createProgram();Ee.attachShader(Ce,this._vShader),Ee.attachShader(Ce,this._fShader),this._locations.forEach(((fe,ve)=>Ee.bindAttribLocation(Ce,fe,ve))),(null==(Te=this._transformFeedbackVaryings)?void 0:Te.length)&&Ee.transformFeedbackVaryings(Ce,this._transformFeedbackVaryings,Ee.SEPARATE_ATTRIBS),Ee.linkProgram(Ce),c$2T()&&Ee.getProgramParameter(Ce,Ee.LINK_STATUS);for(const[Oe,Re]of this._uniformBlockBindings){const fe=Ee.getUniformBlockIndex(Ce,Oe);fe<4294967295&&Ee.uniformBlockBinding(Ce,fe,Re)}this._glName=Ce,this._context.instanceCounter.increment(iA.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){var fe;return!!(null==(fe=this._transformFeedbackVaryings)?void 0:fe.length)}get compiled(){if(this._compiled)return!0;const fe=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==fe||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,fe.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const fe=this._context.gl,ve=this._context.instanceCounter;this._nameToUniformLocation.forEach((fe=>fe&&ve.decrement(iA.Uniform,fe))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(ve.decrement(iA.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),fe.deleteShader(this._vShader),this._vShader=null,ve.decrement(iA.Shader,this)),this._fShader&&(fe.deleteShader(this._fShader),this._fShader=null),this._glName&&(fe.deleteProgram(this._glName),this._glName=null,ve.decrement(iA.Program,this))}ref(){++this._refCount}_getUniformLocation(fe){const ve=this._nameToUniformLocation.get(fe);if(void 0!==ve)return ve;if(this.glName){const ve=this._context.gl.getUniformLocation(this.glName,fe);return this._nameToUniformLocation.set(fe,ve),ve&&this._context.instanceCounter.increment(iA.Uniform,ve),ve}return null}hasUniform(fe){return null!=this._getUniformLocation(fe)}setUniform1i(fe,ve){const _e=this._nameToUniform1.get(fe);void 0!==_e&&ve===_e||(this._context.gl.uniform1i(this._getUniformLocation(fe),ve),this._nameToUniform1.set(fe,ve))}setUniform1iv(fe,ve){m$F(this._nameToUniform1v,fe,ve)&&this._context.gl.uniform1iv(this._getUniformLocation(fe),ve)}setUniform2iv(fe,ve){m$F(this._nameToUniform2,fe,ve)&&this._context.gl.uniform2iv(this._getUniformLocation(fe),ve)}setUniform3iv(fe,ve){m$F(this._nameToUniform3,fe,ve)&&this._context.gl.uniform3iv(this._getUniformLocation(fe),ve)}setUniform4iv(fe,ve){m$F(this._nameToUniform4,fe,ve)&&this._context.gl.uniform4iv(this._getUniformLocation(fe),ve)}setUniform1f(fe,ve){const _e=this._nameToUniform1.get(fe);void 0!==_e&&ve===_e||(this._context.gl.uniform1f(this._getUniformLocation(fe),ve),this._nameToUniform1.set(fe,ve))}setUniform1fv(fe,ve){m$F(this._nameToUniform1v,fe,ve)&&this._context.gl.uniform1fv(this._getUniformLocation(fe),ve)}setUniform2f(fe,ve,_e){const be=this._nameToUniform2.get(fe);void 0===be?(this._context.gl.uniform2f(this._getUniformLocation(fe),ve,_e),this._nameToUniform2.set(fe,[ve,_e])):ve===be[0]&&_e===be[1]||(this._context.gl.uniform2f(this._getUniformLocation(fe),ve,_e),be[0]=ve,be[1]=_e)}setUniform2fv(fe,ve){m$F(this._nameToUniform2,fe,ve)&&this._context.gl.uniform2fv(this._getUniformLocation(fe),ve)}setUniform3f(fe,ve,_e,be){const we=this._nameToUniform3.get(fe);void 0===we?(this._context.gl.uniform3f(this._getUniformLocation(fe),ve,_e,be),this._nameToUniform3.set(fe,[ve,_e,be])):ve===we[0]&&_e===we[1]&&be===we[2]||(this._context.gl.uniform3f(this._getUniformLocation(fe),ve,_e,be),we[0]=ve,we[1]=_e,we[2]=be)}setUniform3fv(fe,ve){const _e=this._getUniformLocation(fe);null!=_e&&m$F(this._nameToUniform3,fe,ve)&&this._context.gl.uniform3fv(_e,ve)}setUniform4f(fe,ve,_e,be,we){const Se=this._nameToUniform4.get(fe);void 0===Se?(this._context.gl.uniform4f(this._getUniformLocation(fe),ve,_e,be,we),this._nameToUniform4.set(fe,[ve,_e,be,we])):void 0!==Se&&ve===Se[0]&&_e===Se[1]&&be===Se[2]&&we===Se[3]||(this._context.gl.uniform4f(this._getUniformLocation(fe),ve,_e,be,we),Se[0]=ve,Se[1]=_e,Se[2]=be,Se[3]=we)}setUniform4fv(fe,ve){const _e=this._getUniformLocation(fe);null!=_e&&m$F(this._nameToUniform4,fe,ve)&&this._context.gl.uniform4fv(_e,ve)}setUniformMatrix3fv(fe,ve,_e=!1){const be=this._getUniformLocation(fe);null!=be&&m$F(this._nameToUniformMatrix3,fe,ve)&&this._context.gl.uniformMatrix3fv(be,_e,ve)}setUniformMatrix4fv(fe,ve,_e=!1){const be=this._getUniformLocation(fe);null!=be&&m$F(this._nameToUniformMatrix4,fe,ve)&&this._context.gl.uniformMatrix4fv(be,_e,ve)}stop(){}};function s$H(fe,ve,_e){const be=fe.gl,we=be.createShader(ve);return be.shaderSource(we,_e),be.compileShader(we),c$2T()&&be.getShaderParameter(we,be.COMPILE_STATUS),we}function m$F(fe,ve,_e){const be=fe.get(ve);if(!be)return fe.set(ve,Array.from(_e)),!0;const we=_e.length;if(be.length!==we)return fe.set(ve,Array.from(_e)),!0;for(let Se=0;Se<we;++Se){const fe=_e[Se];if(be[Se]!==fe){for(be[Se]=fe;Se<we;++Se)be[Se]=_e[Se];return!0}}return!1}let F_e=class s79{constructor(fe){this._rctx=fe,this._store=new wU}dispose(){this._store.forEach((fe=>fe.forEach((fe=>fe.dispose())))),this._store.clear()}acquire(fe,ve,_e,be){const we=this._store.get(fe,ve);if(null!=we)return we.ref(),we;const Se=new N_e(this._rctx,fe,ve,_e,be);return Se.ref(),this._store.set(fe,ve,Se),Se}get test(){}},z_e=class t75{constructor(){this._result=!1}dispose(){this._program=r$3M(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}},k_e=class d29 extends z_e{constructor(fe){super(),this._rctx=fe,this._helperProgram=null,has("mac")&&has("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var fe;super.dispose(),null==(fe=this._helperProgram)||fe.dispose(),this._helperProgram=null}_test(fe){const ve=this._rctx,_e=ve.getBoundFramebufferObject(),{x:be,y:we,width:Se,height:Te}=ve.getViewport();ve.resetState();const Ee=new nM(1);Ee.wrapMode=qO.CLAMP_TO_EDGE,Ee.samplingMode=HO.NEAREST;const Ce=new vR(ve,Ee),Oe=rM.createIndex(this._rctx,QO.STATIC_DRAW,new Uint8Array([0]));ve.bindFramebuffer(Ce),ve.setViewport(0,0,1,1),ve.useProgram(this._helperProgram),ve.bindBuffer(Oe,kO.ELEMENT_ARRAY_BUFFER),ve.drawElements(NO.POINTS,1,BO.UNSIGNED_BYTE,0),ve.useProgram(fe),ve.bindVAO(null),ve.drawArrays(NO.TRIANGLES,0,258);const Re=new Uint8Array(4);return Ce.readPixels(0,0,1,1,YO.RGBA,XO.UNSIGNED_BYTE,Re),ve.setViewport(be,we,Se,Te),ve.bindFramebuffer(_e),Ce.dispose(),Oe.dispose(),255===Re[0]}_prepareProgram(){const fe=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${o$2P.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,ve=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${o$2P.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(fe,ve,new Map([]))}_prepareHelperProgram(){const fe=a_e.getShaderSources();return this._rctx.programCache.acquire(fe.vertex,fe.fragment,new Map([]))}},U_e=class _16 extends z_e{constructor(fe){super(),this._rctx=fe,this._program=A$e(this._rctx,!1),this._obfuscated=A$e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=r$3M(this._obfuscated)}_test(fe){if(has("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const ve=this._rctx,_e=ve.getBoundFramebufferObject(),{x:be,y:we,width:Se,height:Te}=ve.getViewport(),Ee=this._runProgram(fe),Ce=this._runProgram(this._obfuscated);return ve.setViewport(be,we,Se,Te),ve.bindFramebuffer(_e),0!==Ee&&(0===Ce||Ee/Ce>5)}_runProgram(fe){const ve=this._rctx;ve.resetState();const _e=new nM(1);_e.wrapMode=qO.CLAMP_TO_EDGE,_e.samplingMode=HO.NEAREST;const be=new vR(ve,_e),we=rM.createVertex(ve,QO.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),Se=new eM(ve,new Map([["position",0]]),{geometry:[new JA("position",2,BO.UNSIGNED_SHORT,0,4)]},{geometry:we}),Te=r$3y(5633261.287538229,2626832.878767164,1434988.0495278358),Ee=r$3y(5633271.46742708,2626873.6381334523,1434963.231608387),Ce=new Float32Array(6);t$2O(Te,Ce,3);const Oe=new Float32Array(6);t$2O(Ee,Oe,3),ve.useProgram(fe),fe.setUniform3f("u_highA",Ce[0],Ce[2],Ce[4]),fe.setUniform3f("u_lowA",Ce[1],Ce[3],Ce[5]),fe.setUniform3f("u_highB",Oe[0],Oe[2],Oe[4]),fe.setUniform3f("u_lowB",Oe[1],Oe[3],Oe[5]),ve.bindFramebuffer(be),ve.setViewport(0,0,1,1),ve.bindVAO(Se),ve.drawArrays(NO.TRIANGLE_STRIP,0,4);const Re=new Uint8Array(4);be.readPixels(0,0,1,1,YO.RGBA,XO.UNSIGNED_BYTE,Re),Se.dispose(),be.dispose();const De=(Te[2]-Ee[2])/25,Be=r$1U(Re);return Math.abs(De-Be)}};function A$e(fe,ve){const _e=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${ve?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `;return fe.programCache.acquire(_e,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]]))}let V_e=class b18 extends z_e{constructor(fe){var ve,_e;if(super(),this._rctx=fe,!fe.gl)return;if(!(null==(ve=fe.capabilities.colorBufferFloat)?void 0:ve.textureFloat)||!(null==(_e=fe.capabilities.colorBufferFloat)?void 0:_e.floatBlend))return;this._program=fe.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))}_test(fe){const ve=this._rctx,_e=new nM(1);_e.wrapMode=qO.CLAMP_TO_EDGE,_e.dataType=XO.FLOAT,_e.internalFormat=ZO.RGBA32F,_e.samplingMode=HO.NEAREST;const be=new vR(ve,_e),we=rM.createVertex(ve,QO.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),Se=new eM(ve,new Map([["a_pos",0]]),{geometry:[new JA("a_pos",2,BO.UNSIGNED_SHORT,0,4)]},{geometry:we});ve.gl.getError(),ve.useProgram(fe);const Te=ve.getBoundFramebufferObject(),{x:Ee,y:Ce,width:Oe,height:Re}=ve.getViewport();ve.bindFramebuffer(be),ve.setViewport(0,0,1,1),ve.bindVAO(Se),ve.drawArrays(NO.TRIANGLE_STRIP,0,4);const De=S$1g({blending:s$2Z(FO.ZERO,FO.ONE_MINUS_SRC_ALPHA)});ve.setPipelineState(De),ve.drawArrays(NO.TRIANGLE_STRIP,0,4);const Be=ve.gl.getError();return ve.setViewport(Ee,Ce,Oe,Re),ve.bindFramebuffer(Te),Se.dispose(),be.dispose(),Be!==ve.gl.INVALID_OPERATION||!1}};new JA("a_pos",2,BO.BYTE,0,2),new JA("a_pos",2,BO.BYTE,0,4),new JA("a_tex",2,BO.BYTE,2,4);const B_e={geometry:[new JA("a_pos",2,BO.UNSIGNED_SHORT,0,4)]};let j_e=class f24 extends z_e{constructor(fe){super(),this._rctx=fe;this._program=fe.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(fe){const ve=this._rctx;if(!ve.gl)return fe.dispose(),!0;const _e=new nM(1);_e.wrapMode=qO.CLAMP_TO_EDGE,_e.samplingMode=HO.NEAREST;const be=new vR(ve,_e),we=rM.createVertex(ve,QO.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),Se=new eM(ve,new Map([["a_pos",0]]),B_e,{geometry:we}),Te=new nM;Te.samplingMode=HO.LINEAR,Te.wrapMode=qO.CLAMP_TO_EDGE;const Ee=new oM(ve,Te,G_e);ve.useProgram(fe),ve.bindTexture(Ee,0),fe.setUniform1i("u_texture",0);const Ce=ve.getBoundFramebufferObject(),{x:Oe,y:Re,width:De,height:Be}=ve.getViewport();ve.bindFramebuffer(be),ve.setViewport(0,0,1,1),ve.setClearColor(0,0,0,0),ve.setBlendingEnabled(!1),ve.clear(DO.COLOR_BUFFER_BIT),ve.bindVAO(Se),ve.drawArrays(NO.TRIANGLE_STRIP,0,4);const Ze=new Uint8Array(4);return be.readPixels(0,0,1,1,YO.RGBA,XO.UNSIGNED_BYTE,Ze),Se.dispose(),be.dispose(),Ee.dispose(),ve.setViewport(Oe,Re,De,Be),ve.bindFramebuffer(Ce),255!==Ze[0]}};const G_e=new Image;G_e.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",G_e.width=5,G_e.height=5,G_e.decode();let H_e=class r60{constructor(fe){this.rctx=fe,this.floatBufferBlend=new V_e(fe),this.svgPremultipliesAlpha=new j_e(fe),this.doublePrecisionRequiresObfuscation=new U_e(fe),this.drawArraysRequiresIndicesTypeReset=new k_e(fe)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};let q_e=class u23{constructor(fe,ve){this._gl=fe,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=ve.disabledExtensions||{},this._debugWebGLExtensions=ve.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=function _$8(fe,ve){if(ve.compressedTextureETC)return null;const _e=fe.getExtension("WEBGL_compressed_texture_etc");return _e?{COMPRESSED_R11_EAC:_e.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:_e.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:_e.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:_e.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:_e.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:_e.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:_e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:_e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:_e.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:_e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=function E$8(fe,ve){if(ve.compressedTextureS3TC)return null;const _e=fe.getExtension("WEBGL_compressed_texture_s3tc");return _e?{COMPRESSED_RGB_S3TC_DXT1:_e.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:_e.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:_e.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:_e.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=function R$8(fe,ve){if(ve.textureFilterAnisotropic)return null;const _e=fe.getExtension("EXT_texture_filter_anisotropic")||fe.getExtension("MOZ_EXT_texture_filter_anisotropic")||fe.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return _e?{MAX_TEXTURE_MAX_ANISOTROPY:_e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:_e.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=function t$K(fe,ve){if(ve.disjointTimerQuery)return null;let _e=fe.getExtension("EXT_disjoint_timer_query_webgl2");return _e?new Gve((()=>fe.createQuery()),(ve=>{fe.deleteQuery(ve),Hve=!1}),(ve=>fe.getQueryParameter(ve,fe.QUERY_RESULT_AVAILABLE)),(ve=>fe.getQueryParameter(ve,fe.QUERY_RESULT)),(()=>fe.getParameter(_e.GPU_DISJOINT_EXT)),(ve=>{Hve||(Hve=!0,fe.beginQuery(_e.TIME_ELAPSED_EXT,ve))}),(()=>{fe.endQuery(_e.TIME_ELAPSED_EXT),Hve=!1}),(fe=>_e.queryCounterEXT(fe,_e.TIMESTAMP_EXT)),(()=>fe.getQuery(_e.TIMESTAMP_EXT,_e.QUERY_COUNTER_BITS_EXT))):(_e=fe.getExtension("EXT_disjoint_timer_query"),_e?new Gve((()=>_e.createQueryEXT()),(fe=>{_e.deleteQueryEXT(fe),Hve=!1}),(fe=>_e.getQueryObjectEXT(fe,_e.QUERY_RESULT_AVAILABLE_EXT)),(fe=>_e.getQueryObjectEXT(fe,_e.QUERY_RESULT_EXT)),(()=>fe.getParameter(_e.GPU_DISJOINT_EXT)),(fe=>{Hve||(Hve=!0,_e.beginQueryEXT(_e.TIME_ELAPSED_EXT,fe))}),(()=>{_e.endQueryEXT(_e.TIME_ELAPSED_EXT),Hve=!1}),(fe=>_e.queryCounterEXT(fe,_e.TIMESTAMP_EXT)),(()=>_e.getQueryEXT(_e.TIMESTAMP_EXT,_e.QUERY_COUNTER_BITS_EXT))):null)}(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=function t$H(fe,ve){const _e=!ve.colorBufferHalfFloat&&fe.getExtension("EXT_color_buffer_half_float")||!ve.colorBufferFloat&&fe.getExtension("EXT_color_buffer_float"),be=!ve.colorBufferFloat&&fe.getExtension("EXT_color_buffer_float"),we=!ve.floatBlend&&!ve.colorBufferFloat&&fe.getExtension("EXT_float_blend");return _e||be||we?{textureFloat:!!be,textureHalfFloat:!!_e,floatBlend:!!we,R16F:fe.R16F,RG16F:fe.RG16F,RGBA16F:fe.RGBA16F,R32F:fe.R32F,RG32F:fe.RG32F,RGBA32F:fe.RGBA32F,R11F_G11F_B10F:fe.R11F_G11F_B10F,RGB16F:fe.RGB16F}:null}(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=function e$z(fe,ve){const _e=ve.loseContext&&fe.getExtension("WEBGL_lose_context");return _e?{loseRenderingContext:()=>_e.loseContext()}:null}(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=function e$A(fe,ve){if(ve.textureNorm16)return null;const _e=fe.getExtension("EXT_texture_norm16");return _e?{R16:_e.R16_EXT,RG16:_e.RG16_EXT,RGB16:_e.RGB16_EXT,RGBA16:_e.RGBA16_EXT,R16_SNORM:_e.R16_SNORM_EXT,RG16_SNORM:_e.RG16_SNORM_EXT,RGB16_SNORM:_e.RGB16_SNORM_EXT,RGBA16_SNORM:_e.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=function S$b(fe,ve,_e,be,we){if(ve[_e])return!1;for(const Se of we)if(fe.getExtension(Se))return!0;return!1}(this._gl,this._disabledExtensions,"textureFloatLinear",0,["OES_texture_float_linear"])),this._textureFloatLinear}enable(fe){return this[fe]}},W_e=class y13{constructor(fe,ve){this.gl=fe,this.instanceCounter=new c_e,this.programCache=new F_e(this),this._transformFeedbackRequestInfo=null,this._state=new l_e,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(ve)}configure(fe){this._capabilities=new q_e(this.gl,fe),this._parameters=new u_e(this.gl,this._capabilities,fe),oM.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const ve=this.gl.getParameter(this.gl.VIEWPORT);this._state=new l_e,this._state.viewport={x:ve[0],y:ve[1],width:ve[2],height:ve[3]},this._stateTracker=new BA({setBlending:fe=>{if(fe){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(fe.opRgb,fe.opAlpha),this.setBlendFunctionSeparate(fe.srcRgb,fe.dstRgb,fe.srcAlpha,fe.dstAlpha);const ve=fe.color;this.setBlendColor(ve.r,ve.g,ve.b,ve.a)}else this.setBlendingEnabled(!1)},setCulling:fe=>{fe?(this.setFaceCullingEnabled(!0),this.setCullFace(fe.face),this.setFrontFace(fe.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:fe=>{fe?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(fe.factor,fe.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:fe=>{fe?(this.setDepthTestEnabled(!0),this.setDepthFunction(fe.func)):this.setDepthTestEnabled(!1)},setStencilTest:fe=>{if(fe){this.setStencilTestEnabled(!0);const ve=fe.function;this.setStencilFunction(ve.func,ve.ref,ve.mask);const _e=fe.operation;this.setStencilOp(_e.fail,_e.zFail,_e.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:fe=>{fe?(this.setDepthWriteEnabled(!0),this.setDepthRange(fe.zNear,fe.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:fe=>{fe?this.setColorMask(fe.r,fe.g,fe.b,fe.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:fe=>{fe?this.setStencilWriteMask(fe.mask):this.setStencilWriteMask(0)},setDrawBuffers:fe=>{if(fe)this.setDrawBuffers(fe.buffers);else{const{drawFramebuffer:fe}=this._state;null===fe?this.setDrawBuffers([sA.BACK]):0===fe.colorAttachments.length?this.setDrawBuffers([sA.NONE]):this.setDrawBuffers([nA.COLOR_ATTACHMENT0])}}}),this.enforceState(),r$3M(this._driverTest),this._driverTest=new H_e(this)}dispose(){r$3M(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(kO.ARRAY_BUFFER),this.unbindBuffer(kO.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(kO.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(kO.PIXEL_PACK_BUFFER),this.unbindBuffer(kO.PIXEL_UNPACK_BUFFER),this.unbindBuffer(kO.COPY_READ_BUFFER),this.unbindBuffer(kO.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,a$2Y()}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(fe){this._stateTracker.setPipeline(fe)}setBlendingEnabled(fe){this._state.blend!==fe&&(!0===fe?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=fe,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var fe;null==(fe=this._state.program)||fe.stop(),this._state.program=null}externalTextureUnitUpdate(fe,ve){for(let _e=0;_e<fe.length;++_e)this._state.textureUnitMap[fe[_e]]=null;ve>=0&&(this._state.activeTexture=ve)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(fe,ve,_e,be){fe===this._state.blendColor.r&&ve===this._state.blendColor.g&&_e===this._state.blendColor.b&&be===this._state.blendColor.a||(this.gl.blendColor(fe,ve,_e,be),this._state.blendColor.r=fe,this._state.blendColor.g=ve,this._state.blendColor.b=_e,this._state.blendColor.a=be,this._stateTracker.invalidateBlending())}setBlendFunction(fe,ve){fe===this._state.blendFunction.srcRGB&&ve===this._state.blendFunction.dstRGB||(this.gl.blendFunc(fe,ve),this._state.blendFunction.srcRGB=fe,this._state.blendFunction.srcAlpha=fe,this._state.blendFunction.dstRGB=ve,this._state.blendFunction.dstAlpha=ve,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(fe,ve,_e,be){this._state.blendFunction.srcRGB===fe&&this._state.blendFunction.srcAlpha===_e&&this._state.blendFunction.dstRGB===ve&&this._state.blendFunction.dstAlpha===be||(this.gl.blendFuncSeparate(fe,ve,_e,be),this._state.blendFunction.srcRGB=fe,this._state.blendFunction.srcAlpha=_e,this._state.blendFunction.dstRGB=ve,this._state.blendFunction.dstAlpha=be,this._stateTracker.invalidateBlending())}setBlendEquation(fe){this._state.blendEquation.mode!==fe&&(this.gl.blendEquation(fe),this._state.blendEquation.mode=fe,this._state.blendEquation.modeAlpha=fe,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(fe,ve){this._state.blendEquation.mode===fe&&this._state.blendEquation.modeAlpha===ve||(this.gl.blendEquationSeparate(fe,ve),this._state.blendEquation.mode=fe,this._state.blendEquation.modeAlpha=ve,this._stateTracker.invalidateBlending())}setColorMask(fe,ve,_e,be){this._state.colorMask.r===fe&&this._state.colorMask.g===ve&&this._state.colorMask.b===_e&&this._state.colorMask.a===be||(this.gl.colorMask(fe,ve,_e,be),this._state.colorMask.r=fe,this._state.colorMask.g=ve,this._state.colorMask.b=_e,this._state.colorMask.a=be,this._stateTracker.invalidateColorWrite())}setClearColor(fe,ve,_e,be){this._state.clearColor.r===fe&&this._state.clearColor.g===ve&&this._state.clearColor.b===_e&&this._state.clearColor.a===be||(this.gl.clearColor(fe,ve,_e,be),this._state.clearColor.r=fe,this._state.clearColor.g=ve,this._state.clearColor.b=_e,this._state.clearColor.a=be)}setFaceCullingEnabled(fe){this._state.faceCulling!==fe&&(!0===fe?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=fe,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(fe){this._state.polygonOffsetFill!==fe&&(!0===fe?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=fe,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(fe,ve){this._state.polygonOffset[0]===fe&&this._state.polygonOffset[1]===ve||(this._state.polygonOffset[0]=fe,this._state.polygonOffset[1]=ve,this.gl.polygonOffset(fe,ve),this._stateTracker.invalidatePolygonOffset())}setCullFace(fe){this._state.cullFace!==fe&&(this.gl.cullFace(fe),this._state.cullFace=fe,this._stateTracker.invalidateCulling())}setFrontFace(fe){this._state.frontFace!==fe&&(this.gl.frontFace(fe),this._state.frontFace=fe,this._stateTracker.invalidateCulling())}setScissorTestEnabled(fe){this._state.scissorTest!==fe&&(!0===fe?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=fe)}setScissorRect(fe,ve,_e,be){this._state.scissorRect.x===fe&&this._state.scissorRect.y===ve&&this._state.scissorRect.width===_e&&this._state.scissorRect.height===be||(this.gl.scissor(fe,ve,_e,be),this._state.scissorRect.x=fe,this._state.scissorRect.y=ve,this._state.scissorRect.width=_e,this._state.scissorRect.height=be)}setDepthTestEnabled(fe){this._state.depthTest!==fe&&(!0===fe?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=fe,this._stateTracker.invalidateDepthTest())}setClearDepth(fe){this._state.clearDepth!==fe&&(this.gl.clearDepth(fe),this._state.clearDepth=fe)}setDepthFunction(fe){this._state.depthFunction!==fe&&(this.gl.depthFunc(fe),this._state.depthFunction=fe,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(fe){this._state.depthWrite!==fe&&(this.gl.depthMask(fe),this._state.depthWrite=fe,this._stateTracker.invalidateDepthWrite())}setDepthRange(fe,ve){this._state.depthRange.zNear===fe&&this._state.depthRange.zFar===ve||(this.gl.depthRange(fe,ve),this._state.depthRange.zNear=fe,this._state.depthRange.zFar=ve,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(fe){this._state.stencilTest!==fe&&(!0===fe?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=fe,this._stateTracker.invalidateStencilTest())}setClearStencil(fe){fe!==this._state.clearStencil&&(this.gl.clearStencil(fe),this._state.clearStencil=fe)}setStencilFunction(fe,ve,_e){this._state.stencilFunction.func===fe&&this._state.stencilFunction.ref===ve&&this._state.stencilFunction.mask===_e||(this.gl.stencilFunc(fe,ve,_e),this._state.stencilFunction.face=UO.FRONT_AND_BACK,this._state.stencilFunction.func=fe,this._state.stencilFunction.ref=ve,this._state.stencilFunction.mask=_e,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(fe,ve,_e,be){this._state.stencilFunction.face===fe&&this._state.stencilFunction.func===ve&&this._state.stencilFunction.ref===_e&&this._state.stencilFunction.mask===be||(this.gl.stencilFuncSeparate(fe,ve,_e,be),this._state.stencilFunction.face=fe,this._state.stencilFunction.func=ve,this._state.stencilFunction.ref=_e,this._state.stencilFunction.mask=be,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(fe){this._state.stencilWriteMask!==fe&&(this.gl.stencilMask(fe),this._state.stencilWriteMask=fe,this._stateTracker.invalidateStencilWrite())}setStencilOp(fe,ve,_e){this._state.stencilOperation.face===UO.FRONT_AND_BACK&&this._state.stencilOperation.fail===fe&&this._state.stencilOperation.zFail===ve&&this._state.stencilOperation.zPass===_e||(this.gl.stencilOp(fe,ve,_e),this._state.stencilOperation.face=UO.FRONT_AND_BACK,this._state.stencilOperation.fail=fe,this._state.stencilOperation.zFail=ve,this._state.stencilOperation.zPass=_e,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(fe,ve,_e,be){this._state.stencilOperation.face===fe&&this._state.stencilOperation.fail===ve&&this._state.stencilOperation.zFail===_e&&this._state.stencilOperation.zPass===be||(this.gl.stencilOpSeparate(fe,ve,_e,be),this._state.stencilOperation.face=fe,this._state.stencilOperation.fail=ve,this._state.stencilOperation.zFail=_e,this._state.stencilOperation.zPass=be,this._stateTracker.invalidateStencilTest())}setActiveTexture(fe,ve=!1){const _e=this._state.activeTexture;return fe>=0&&(ve||fe!==this._state.activeTexture)&&(this.gl.activeTexture(rA+fe),this._state.activeTexture=fe),_e}setDrawBuffers(fe){const{drawFramebuffer:ve}=this._state,_e=null===ve,be=_e?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(ve);if((null==be?void 0:be.length)!==fe.length||!be.every(((ve,_e)=>ve===fe[_e])))if(fe.length>this.parameters.maxDrawBuffers);else{if(_e){if(fe.length>1)return;if(fe[0]!==sA.BACK&&fe[0]!==sA.NONE)return}(_e||!fe.includes(sA.BACK))&&(this.gl.drawBuffers(fe),_e?this._state.drawBuffers.defaultFramebuffer=fe:this._state.drawBuffers.fbos.set(ve,fe),this._stateTracker.invalidateDrawBuffers())}}clear(fe,ve=255){var _e;if(fe){if(fe&DO.COLOR_BUFFER_BIT){const fe=null==(_e=this._state.drawFramebuffer)?void 0:_e.colorAttachments;fe&&this.setDrawBuffers(fe),this.setColorMask(!0,!0,!0,!0)}fe&DO.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),fe&DO.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(ve),this.gl.clear(fe)}}clearFramebuffer(fe,ve=!1,_e=!1){let be=0;if(fe){const ve=1e-13,_e=Math.max(ve,fe[3]);this.setClearColor(fe[0],fe[1],fe[2],_e),be|=DO.COLOR_BUFFER_BIT}ve&&(be|=DO.DEPTH_BUFFER_BIT),!1===_e?_e=0:(!0===_e&&(_e=255),be|=DO.STENCIL_BUFFER_BIT),be&&this.clear(be,_e)}drawArrays(fe,ve,_e){var be,we;if(this._transformFeedbackRequestInfo){if(fe!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==(null==(be=this._state.program)?void 0:be.hasTransformFeedbackVaryings))throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(a$2Y()){this._numOfDrawCalls++,this._numOfTriangles+=D$5(fe,_e);const ve=this._state.textureUnitMap;for(let fe=0;fe<ve.length;fe++){const _e=ve[fe];if(null!=_e&&_e===(null==(we=this._state.drawFramebuffer)?void 0:we.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${fe}`)}}this.gl.drawArrays(fe,ve,_e),u$2F(this.gl)}drawArraysInstanced(fe,ve,_e,be){this.gl.drawArraysInstanced(fe,ve,_e,be),u$2F(this.gl)}drawElements(fe,ve,_e,be){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(a$2Y()&&(this._numOfDrawCalls++,this._numOfTriangles+=D$5(fe,ve)),this.gl.drawElements(fe,ve,_e,be),a$2Y()){if(o$2E(this)){const fe=this.getBoundVAO(),ve=null==fe?void 0:fe.indexBuffer;null==fe||fe.vertexBuffers,null==ve||ve.size}}}logInfo(){a$2Y()}resetInfo(){a$2Y()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(fe,ve,_e,be){_e=Math.max(Math.round(_e),1),be=Math.max(Math.round(be),1);const we=this._state.viewport;we.x===fe&&we.y===ve&&we.width===_e&&we.height===be||(we.x=fe,we.y=ve,we.width=_e,we.height=be,this.gl.viewport(fe,ve,_e,be))}setViewport4fv(fe){this.setViewport(fe[0],fe[1],fe[2],fe[3])}restoreViewport({x:fe,y:ve,width:_e,height:be}){this.setViewport(fe,ve,_e,be)}getViewport(){const fe=this._state.viewport;return{x:fe.x,y:fe.y,width:fe.width,height:fe.height}}useProgram(fe){var ve;this._state.program!==fe&&(null==(ve=this._state.program)||ve.stop(),this._state.program=fe,this.gl.useProgram((null==fe?void 0:fe.glName)??null))}bindTexture(fe,ve,_e=!1){this.parameters.maxTextureImageUnits;const be=this._state.textureUnitMap[ve];return null==(null==fe?void 0:fe.glName)?(null!=be&&(this.setActiveTexture(ve,_e),this.gl.bindTexture(be.descriptor.target,null)),this._state.textureUnitMap[ve]=null,be):_e||be!==fe?(this.setActiveTexture(ve,_e),this.gl.bindTexture(fe.descriptor.target,fe.glName),fe.applyChanges(),this._state.textureUnitMap[ve]=fe,be):(fe.isDirty&&(this.setActiveTexture(ve,_e),fe.applyChanges()),be)}unbindTexture(fe){if(null!=fe)for(let ve=0;ve<this.parameters.maxTextureImageUnits;ve++)this._state.textureUnitMap[ve]===fe&&(this.bindTexture(null,ve),this._state.textureUnitMap[ve]=null)}bindFramebuffer(fe,ve=!1){if(ve||this._state.readFramebuffer!==fe||this._state.drawFramebuffer!==fe){if(this._stateTracker.invalidateDrawBuffers(),null==fe)return this.gl.bindFramebuffer(eA.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);fe.initializeAndBind(eA.FRAMEBUFFER),this._state.readFramebuffer=fe,this._state.drawFramebuffer=fe}}bindFramebufferSeparate(fe,ve,_e=!1){const be=ve===eA.READ_FRAMEBUFFER,we=be?this._state.readFramebuffer:this._state.drawFramebuffer;(_e||we!==fe)&&(null==fe?this.gl.bindFramebuffer(ve,null):fe.initializeAndBind(ve),be?this._state.readFramebuffer=fe??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=fe??null))}blitFramebuffer(fe,ve,_e=0,be=0,we=fe.width,Se=fe.height,Te=0,Ee=0,Ce=ve.width,Oe=ve.height,Re=DO.COLOR_BUFFER_BIT,De=HO.NEAREST){this.bindFramebufferSeparate(fe,eA.READ_FRAMEBUFFER),this.bindFramebufferSeparate(ve,eA.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(_e,be,we,Se,Te,Ee,Ce,Oe,Re,De)}bindBuffer(fe,ve){if(fe)switch(ve??(ve=fe.bufferType),ve){case kO.ARRAY_BUFFER:this._state.vertexBuffer=N$8(this.gl,fe,ve,this._state.vertexBuffer);break;case kO.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=N$8(this.gl,fe,ve,this._state.indexBuffer);break;case kO.UNIFORM_BUFFER:this._state.uniformBuffer=N$8(this.gl,fe,ve,this._state.uniformBuffer);break;case kO.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=N$8(this.gl,fe,ve,this._state.pixelPackBuffer);break;case kO.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=N$8(this.gl,fe,ve,this._state.pixelUnpackBuffer);break;case kO.COPY_READ_BUFFER:this._state.copyReadBuffer=N$8(this.gl,fe,ve,this._state.copyReadBuffer);break;case kO.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=N$8(this.gl,fe,ve,this._state.copyWriteBuffer);break;case kO.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=N$8(this.gl,fe,ve,this._state.transformFeedbackBuffer)}}bindRenderbuffer(fe){const ve=this.gl;fe||(ve.bindRenderbuffer(ve.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==fe&&(ve.bindRenderbuffer(ve.RENDERBUFFER,fe.glName),this._state.renderbuffer=fe)}_getBufferBinding(fe,ve){if(ve>=this.parameters.maxUniformBufferBindings||ve<0)return null;const _e=fe===kO.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let be=_e[ve];return null==be&&(be={buffer:null,offset:0,size:0},_e[ve]=be),be}bindBufferBase(fe,ve,_e){const be=this._getBufferBinding(fe,ve);null!=be&&(be.buffer===_e&&0===be.offset&&0===be.size||(this.gl.bindBufferBase(fe,ve,_e?_e.glName:null),be.buffer=_e,be.offset=0,be.size=0))}bindBufferRange(fe,ve,_e,be,we){const Se=this._getBufferBinding(fe,ve);null!=Se&&(Se.buffer===_e&&Se.offset===be&&Se.size===we||be%this._parameters.uniformBufferOffsetAlignment==0&&(this.gl.bindBufferRange(fe,ve,_e.glName,be,we),Se.buffer=_e,Se.offset=be,Se.size=we))}bindUBO(fe,ve,_e,be){null!=ve?(a$2Y()&&(be??ve.byteLength,this._parameters.maxUniformBlockSize),ve.initialize(),void 0!==_e&&void 0!==be?this.bindBufferRange(kO.UNIFORM_BUFFER,fe,ve.buffer,_e,be):this.bindBufferBase(kO.UNIFORM_BUFFER,fe,ve.buffer)):this.bindBufferBase(kO.UNIFORM_BUFFER,fe,null)}unbindUBO(fe){for(let ve=0,_e=this._state.uniformBufferBindingPoints.length;ve<_e;ve++){const _e=this._state.uniformBufferBindingPoints[ve];null!=_e&&_e.buffer===fe.buffer&&this.bindBufferBase(kO.UNIFORM_BUFFER,ve,null)}}unbindBuffer(fe){switch(fe){case kO.ARRAY_BUFFER:this._state.vertexBuffer=N$8(this.gl,null,fe,this._state.vertexBuffer);break;case kO.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=N$8(this.gl,null,fe,this._state.indexBuffer);break;case kO.UNIFORM_BUFFER:this._state.uniformBuffer=N$8(this.gl,null,fe,this._state.uniformBuffer);break;case kO.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=N$8(this.gl,null,fe,this._state.pixelPackBuffer);break;case kO.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=N$8(this.gl,null,fe,this._state.pixelUnpackBuffer);break;case kO.COPY_READ_BUFFER:this._state.copyReadBuffer=N$8(this.gl,null,fe,this._state.copyReadBuffer);break;case kO.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=N$8(this.gl,null,fe,this._state.copyWriteBuffer)}}bindVAO(fe=null){null!=fe?this._state.vertexArrayObject!==fe&&(fe.bind(),this._state.vertexArrayObject=fe):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(fe){const{gl:ve}=this;ve.bindTransformFeedback(ve.TRANSFORM_FEEDBACK,fe.glName)}beginTransformFeedback(fe,ve){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:_e}=this;_e.bindTransformFeedback(_e.TRANSFORM_FEEDBACK,fe.glName),_e.beginTransformFeedback(ve),this._transformFeedbackRequestInfo={primitiveType:ve}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:fe}=this;fe.endTransformFeedback(),fe.bindTransformFeedback(fe.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(fe=10){const{gl:ve}=this,_e=ve.fenceSync(dA.SYNC_GPU_COMMANDS_COMPLETE,0);if(!_e)throw new Error("Client wait failed, could not create sync object");let be;this.instanceCounter.increment(iA.Sync,_e),ve.flush();do{await A$1J(fe),be=ve.clientWaitSync(_e,0,0)}while(be===hA.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(iA.Sync,_e),ve.deleteSync(_e),be===hA.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(fe=eA.FRAMEBUFFER){return fe===eA.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(kO.ARRAY_BUFFER),this.unbindBuffer(kO.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(kO.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(kO.PIXEL_PACK_BUFFER),this.unbindBuffer(kO.PIXEL_UNPACK_BUFFER),this.unbindBuffer(kO.COPY_READ_BUFFER),this.unbindBuffer(kO.COPY_WRITE_BUFFER);for(let fe=0;fe<this.parameters.maxTextureImageUnits;++fe)this.bindTexture(null,fe);this.setBlendingEnabled(!1),this.setBlendFunction(FO.ONE,FO.ZERO),this.setBlendEquation(zO.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(UO.BACK),this.setFrontFace(VO.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(jO.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(jO.ALWAYS,0,0),this.setStencilOp(GO.KEEP,GO.KEEP,GO.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([sA.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var fe,ve,_e;const{gl:be}=this;be.bindVertexArray(null);for(let Se=0;Se<this.parameters.maxVertexAttributes;Se++)be.disableVertexAttribArray(Se);this._state.vertexBuffer?be.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):be.bindBuffer(kO.ARRAY_BUFFER,null),this._state.indexBuffer?be.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):be.bindBuffer(kO.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?be.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):be.bindBuffer(kO.UNIFORM_BUFFER,null);for(let Se=0;Se<this._parameters.maxUniformBufferBindings;Se++){const fe=this._state.uniformBufferBindingPoints[Se];if(null!=fe){const{buffer:ve,offset:_e,size:we}=fe;null!==ve?0===_e&&0===we?be.bindBufferBase(kO.UNIFORM_BUFFER,Se,ve.glName):be.bindBufferRange(kO.UNIFORM_BUFFER,Se,ve.glName,_e,we):be.bindBufferBase(kO.UNIFORM_BUFFER,Se,null)}}if(this._state.pixelPackBuffer?be.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):be.bindBuffer(kO.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?be.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):be.bindBuffer(kO.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?be.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):be.bindBuffer(kO.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?be.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):be.bindBuffer(kO.COPY_WRITE_BUFFER,null),be.bindFramebuffer(eA.READ_FRAMEBUFFER,null),be.readBuffer(be.BACK),this._state.readFramebuffer&&(be.bindFramebuffer(eA.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),be.readBuffer(nA.COLOR_ATTACHMENT0)),be.bindFramebuffer(eA.DRAW_FRAMEBUFFER,(null==(fe=this._state.drawFramebuffer)?void 0:fe.glName)??null),null===this._state.drawFramebuffer){const fe=this._state.drawBuffers.defaultFramebuffer;be.drawBuffers(fe??[sA.BACK])}else{const fe=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);be.drawBuffers(fe??[nA.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const fe=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(fe)}be.useProgram((null==(ve=this._state.program)?void 0:ve.glName)??null),be.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),be.bindRenderbuffer(be.RENDERBUFFER,(null==(_e=this._state.renderbuffer)?void 0:_e.glName)??null),!0===this._state.blend?be.enable(this.gl.BLEND):be.disable(this.gl.BLEND),be.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),be.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),be.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),be.clearDepth(this._state.clearDepth),be.clearStencil(this._state.clearStencil),be.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),be.cullFace(this._state.cullFace),be.depthFunc(this._state.depthFunction),be.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?be.enable(be.DEPTH_TEST):be.disable(be.DEPTH_TEST),be.depthMask(this._state.depthWrite),be.frontFace(this._state.frontFace),be.lineWidth(1),!0===this._state.faceCulling?be.enable(be.CULL_FACE):be.disable(be.CULL_FACE),be.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?be.enable(be.POLYGON_OFFSET_FILL):be.disable(be.POLYGON_OFFSET_FILL),be.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?be.enable(be.SCISSOR_TEST):be.disable(be.SCISSOR_TEST),be.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),be.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?be.enable(be.STENCIL_TEST):be.disable(be.STENCIL_TEST),be.stencilMask(this._state.stencilWriteMask);for(let Se=0;Se<this.parameters.maxTextureImageUnits;Se++){be.activeTexture(rA+Se),be.bindTexture(WO.TEXTURE_2D,null),be.bindTexture(WO.TEXTURE_CUBE_MAP,null),be.bindTexture(WO.TEXTURE_3D,null),be.bindTexture(WO.TEXTURE_2D_ARRAY,null);const fe=this._state.textureUnitMap[Se];null!=fe&&be.bindTexture(fe.descriptor.target,fe.glName)}be.activeTexture(rA+this._state.activeTexture);const we=this._state.viewport;be.viewport(we.x,we.y,we.width,we.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function N$8(fe,ve,_e,be){return ve?be!==ve&&fe.bindBuffer(_e,ve.glName):fe.bindBuffer(_e,null),ve}function D$5(fe,ve){switch(fe){case NO.POINTS:return 2*ve;case NO.TRIANGLES:return ve/3;case NO.TRIANGLE_STRIP:case NO.TRIANGLE_FAN:return ve-2;default:return 0}}let Y_e=class t76 extends W_e{constructor(fe,ve,_e){super(fe,ve),this.gl=fe,this.newCache=_e,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new o_e(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var fe;super.dispose(),null==(fe=this._appleAmdDriverHelper)||fe.dispose(),this.screen.destroy()}bindTechnique(fe,ve,_e,be,we){return this.useProgram(fe.program),this.setPipelineState(fe.getPipeline(!!we)),fe.program.bindPass(_e,ve),be&&fe.program.bindDraw(be,ve,_e),fe.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new a_e(this)),this._appleAmdDriverHelper.run())}get test(){}};function e$y(fe){return!!fe.frameUpdate}let Z_e=class _17 extends zi{constructor(fe,ve,_e){super({}),this._stage=fe,this._techniques=ve,this._rctx=_e,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new La,this._frameTask=fe.view.resourceController.scheduler.registerTask(gI.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(eD.Texture,(fe=>fe.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return null==this._textureTechnique&&(this._textureTechnique=this._techniques.acquire(CJ,new OJ)),this._textureTechnique}acquire(fe){const ve=this._textures.get(fe);return ve?(ve.ref(),ve.loadingPromise??ve):this._createNewRef(fe)}update(){let fe=!1;this._frameUpdates.forEach((ve=>{const _e=ve.texture.frameUpdate(ve.previousToken);_e>=0&&_e!==ve.previousToken&&(ve.previousToken=_e,fe=!0)})),fe&&this.events.emit("changed",$A.BACKGROUND)}_createNewRef(fe){const ve=this._stage.getObject(fe);if(null==ve)return s$31(void 0!==ve),null;const _e=ve.events.on("unloaded",(()=>{_e.remove(),this._onTextureUnloaded(fe)})),be=new X_e(fe,(()=>{this._frameTask.schedule((()=>{be.isUnreferenced&&ve.unload()}))}));return this._textures.set(fe,be),be.ref(),ve.glTexture?(this._updateGLTexture(be,ve.glTexture),e$y(ve)&&this._frameUpdates.set(fe,{texture:ve,previousToken:-1}),be):(this._loadingCount++,be.loadingPromise=this._stage.schedule((()=>{const _e=ve.load(this._rctx),u30=_e=>(this._loadingCount--,be.loadingPromise=null,this._updateGLTexture(be,_e),e$y(ve)&&this._frameUpdates.set(fe,{texture:ve,previousToken:-1}),be);return S$1T(_e)?_e.then(u30,(fe=>(this._loadingCount--,be.loadingPromise=null,b$2g(fe)||ar.getLogger(this).error(fe),null))):u30(_e)})),be.loadingPromise)}_updateGLTexture(fe,ve){fe.glTexture=ve,this.events.emit("changed",$A.UPDATE)}_onTextureUnloaded(fe){this._textures.delete(fe),this._frameUpdates.delete(fe)}};e$4o([y$2v()],Z_e.prototype,"_loadingCount",void 0),e$4o([y$2v()],Z_e.prototype,"_frameTask",void 0),e$4o([y$2v()],Z_e.prototype,"updating",null),Z_e=e$4o([a$4y("esri.views.3d.webgl-engine.lib.TextureRepository")],Z_e);let X_e=class f25{constructor(fe,ve){this.id=fe,this._release=ve,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(ar.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function o$q(fe,ve){return new sZ((ve=>function f$1j(fe,ve){const _e=c$20(fe,IZ,LZ,DZ),be=new nM;return be.internalFormat=YO.RGBA,be.width=IZ,be.height=IZ,be.wrapMode=qO.CLAMP_TO_EDGE,new oM(ve,be,_e)}(ve,fe)),(fe=>fe),ve)}let J_e=class w7 extends zi{constructor(){super(...arguments),this._passParameters=new Q_e,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=e$4f(this._resourcesTask),this._passParameters.waveNormal=r$3M(this._passParameters.waveNormal),this._passParameters.wavePerturbation=r$3M(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(fe){return this._resourcesTask||(this._resourcesTask=d$3e((async ve=>{await Promise.allSettled([this._loadImageResource(fe,n$4t("esri/images/materials/water/normals.jpg"),(fe=>this._passParameters.waveNormal=fe),ve),this._loadImageResource(fe,n$4t("esri/images/materials/water/perturbation.jpg"),(fe=>this._passParameters.wavePerturbation=fe),ve)])}))),this._resourcesTask.finished?bA.LOADED:bA.LOADING}async _loadImageResource(fe,ve,_e,be){try{const we=await t$1T(ve,{signal:be});s$4o(be);const Se=new nM(we.width,we.height);Se.pixelFormat=YO.RGB,Se.samplingMode=HO.LINEAR_MIPMAP_LINEAR,Se.hasMipmap=!0,Se.maxAnisotropy=8,_e(new oM(fe,Se,we))}catch(xv){ar.getLogger(this).error("Failed to load water material normal texture.",xv)}}};e$4o([y$2v()],J_e.prototype,"_resourcesTask",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],J_e.prototype,"updating",null),J_e=e$4o([a$4y("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],J_e);let Q_e=class f26 extends iO{};function o$p(fe,ve){const{format:_e,quality:be,rotation:we,disableDecorations:Se}=fe||{},Te=b$d(fe,ve.padding),Ee=function p$1h(fe,ve){const _e={x:0,y:0,width:ve.width,height:ve.height};if(null==fe?void 0:fe.area){null!=fe.area.x&&(_e.x=Math.floor(fe.area.x)),null!=fe.area.y&&(_e.y=Math.floor(fe.area.y));const be=null!=fe.area.width?Math.floor(fe.area.width):null,we=null!=fe.area.height?Math.floor(fe.area.height):null;if(_e.width=ve.width-_e.x,_e.height=ve.height-_e.y,null!=be&&null!=we)_e.width=Math.min(_e.width,be),_e.height=Math.min(_e.height,we);else if(null==be&&null!=we){const fe=Math.min(_e.width,be);_e.height=fe/_e.width*_e.height,_e.width=fe}else if(null!=be&&null==we){const fe=Math.min(_e.height,we);_e.width=fe/_e.height*_e.width,_e.height=fe}}return function x$7(fe,ve){const _e=Math.floor(Math.max(fe.x,0)),be=Math.floor(Math.max(fe.y,0)),we={x:_e,y:be,width:Math.floor(Math.min(fe.width,ve.width-_e)),height:Math.floor(Math.min(fe.height,ve.height-be))},Se=we.width/we.height,Te=fe.width/fe.height;if(Te===Se)return we;if(Te>Se){const fe=Math.floor(we.width/Te),ve=we.height-fe;return{x:we.x,y:Math.floor(we.y+ve/2),width:we.width,height:fe}}const Ee=Math.floor(we.height*Te),Ce=we.width-Ee;return{x:Math.floor(we.x+Ce/2),y:we.y,width:Ee,height:we.height}}(function y$l(fe,ve){if(null==(null==ve?void 0:ve.width)||null==ve.height)return fe;const _e=ve.width/ve.height,be=fe.width/fe.height;if(be===_e)return fe;if(be<_e){const ve=Math.floor(fe.height*_e);return fe.x-=(ve-fe.width)/2,fe.width=ve,fe}const we=Math.floor(fe.width/_e);return fe.y-=(we-fe.height)/2,fe.height=we,fe}(_e,fe),ve)}(fe,{width:ve.width-Te.left-Te.right,height:ve.height-Te.top-Te.bottom}),{width:Ce,height:Oe}=function m$D(fe,ve){if(!fe)return ve;const _e=fe.width,be=fe.height;if(null!=_e&&null!=be)return{width:Math.floor(_e),height:Math.floor(be)};if(null==_e&&null==be)return ve;const we=ve.width/ve.height;return null==be?{width:Math.floor(_e),height:Math.floor(_e/we)}:{width:Math.floor(be*we),height:Math.floor(be)}}(fe,Ee),Re=function j$e(fe){switch(fe){case"png":case"jpg":case"jpeg":return fe;default:return r$e}}(_e),De=i$e[Re];return{format:Re,quality:e$3Y(null!=be?be:De,0,100),area:Ee,width:Ce,height:Oe,rotation:we,disableDecorations:!!Se,ignoreBackground:!!(null==fe?void 0:fe.ignoreBackground),ignorePadding:!!(null==fe?void 0:fe.ignorePadding)}}function a$Q(fe,ve,_e){const{ctx:be,canvas:we}=l$O(fe,_e),Se=be.getImageData(0,0,fe.width,fe.height),Te=function u$E(fe,ve){const _e=e$e[ve.format],be=ve.quality/100;return fe.toDataURL(_e,be)}(we,ve);return g$l(we),{dataUrl:Te,data:Se}}function r$o(fe,ve){const{ctx:_e,canvas:be}=l$O(fe,ve),we=_e.getImageData(0,0,fe.width,fe.height);return g$l(be),we}function l$O(fe,ve){const _e=function f$q(){return null==K_e&&(K_e=document.createElement("canvas")),K_e}();ve.premultipliedAlpha&&function q$3(fe){const ve=fe.data,_e=ve.length;for(let be=0;be<_e;be+=4){const fe=ve[be+3];if(255!==fe&&fe>0){const _e=255/fe;ve[be]=ve[be]*_e,ve[be+1]=ve[be+1]*_e,ve[be+2]=ve[be+2]*_e}}}(fe),_e.width=fe.width,_e.height=fe.height;const be=_e.getContext("2d",{willReadFrequently:!0});return be.putImageData(fe,0,0),ve.flipY&&function D$4(fe){fe.save(),fe.globalCompositeOperation="copy",fe.scale(1,-1),fe.translate(0,-fe.canvas.height),fe.drawImage(fe.canvas,0,0),fe.restore()}(be),{ctx:be,canvas:_e}}function g$l(fe){fe.width=0,fe.height=0}let K_e=null;function b$d(fe,ve){return!ve||(null==fe?void 0:fe.ignorePadding)?s$e:ve}const e$e={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},r$e="png",i$e={png:100,jpg:98,jpeg:98},s$e={top:0,right:0,bottom:0,left:0};let a$e=class d30{constructor(fe,ve,_e){this.parameters=fe,this.frameHasDecorations=ve,this.fbos=_e}},l$e=class f27{constructor(fe,ve,_e){this._rctx=fe,this._renderFunctions=ve,this._forceCameraHook=_e,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(fe){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene($A.BACKGROUND);const ve=L$1h();return this._screenshotQueue.push({settings:fe,resolver:ve}),ve.promise}update(fe,ve){for(const _e of this._screenshotQueue){if(null==this._rctx){_e.resolver.reject();continue}const be={..._e.settings,pixelRatio:_e.settings.pixelRatio*fe.parameters.camera.pixelRatio},we=this._renderScreenshot(fe,be,ve);_e.resolver(we)}this._screenshotQueue.length=0}_renderScreenshotOverlay(fe,ve,_e){fe.width=ve.width,fe.height=ve.height;const be=fe.getContext("2d"),we=_e.pixelRatio;return be.save(),be.translate(0,ve.height),be.scale(1,-1),_e.region&&be.translate(-_e.region.x,-_e.region.y),be.scale(we,we),ve=this._renderFunctions.renderOverlay(fe,_e.disableDecorations?TA.OFF:TA.ON,ve),be.restore(),ve}_readbackScreenshot(fe,ve){return fe.resample?this._readbackScreenshotResampled({...fe,resample:fe.resample},ve):this._readbackScreenshotImmediate(fe,ve)}_readbackScreenshotResampled(fe,ve){const{framebufferWidth:_e,framebufferHeight:be,region:we,resample:Se}=fe,Te=this._ensureScreenshotEncodeCanvas();let Ee=s$1x(_e,be,Te);this._rctx.gl.readPixels(0,0,_e,be,YO.RGBA,BO.UNSIGNED_BYTE,new Uint8Array(Ee.data.buffer)),ve(),Ee=this._renderScreenshotOverlay(Te,Ee,{...fe,region:void 0});return function w$f(fe,ve,_e,be=0,we=0,Se=fe.width-be,Te=fe.height-we,Ee=!1){const{data:Ce}=fe,{width:Oe,height:Re,data:De}=ve,Be=Se/Oe,Ze=Te/Re,Xe=Math.ceil(Be/2),Je=Math.ceil(Ze/2),Qe=fe.width;for(let dt=0;dt<Re;dt++)for(let fe=0;fe<Oe;fe++){const ve=4*(fe+(Ee?Re-dt-1:dt)*Oe);let _e=0,Se=0,Te=0,$t=0,bt=0,wt=0;const xt=(dt+.5)*Ze;for(let Ee=Math.floor(dt*Ze);Ee<(dt+1)*Ze;Ee++){const ve=Math.abs(xt-(Ee+.5))/Je,Oe=(fe+.5)*Be,Re=ve*ve;for(let De=Math.floor(fe*Be);De<(fe+1)*Be;De++){const fe=Math.abs(Oe-(De+.5))/Xe,ve=Math.sqrt(Re+fe*fe);if(ve>=1)continue;let Be=2*ve*ve*ve-3*ve*ve+1;const Ze=4*(be+De+(we+Ee)*Qe);wt+=Be*Ce[Ze+3],Se+=Be,Te+=Be*Ce[Ze],$t+=Be*Ce[Ze+1],bt+=Be*Ce[Ze+2],_e+=Be}}De[ve]=Te/_e,De[ve+1]=$t/_e,De[ve+2]=bt/_e,De[ve+3]=wt/Se}return ve}(Ee,s$1x(we.width,we.height,Te),0,Se.region.x,be-(Se.region.y+Se.region.height),Se.region.width,Se.region.height)}_readbackScreenshotImmediate(fe,ve){const{framebufferHeight:_e,region:be}=fe,we=this._ensureScreenshotEncodeCanvas(),Se=s$1x(be.width,be.height,we);return this._rctx.gl.readPixels(be.x,_e-(be.y+be.height),be.width,be.height,YO.RGBA,BO.UNSIGNED_BYTE,new Uint8Array(Se.data.buffer)),ve(),this._renderScreenshotOverlay(we,Se,fe)}_renderScreenshot(fe,ve,_e){const be=fe.parameters.camera,we={width:ve.framebufferWidth,height:ve.framebufferHeight};A$18(we,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let Se=!1;const Te=ve.disableDecorations&&fe.frameHasDecorations,Ee=we.width!==be.fullWidth||we.height!==be.fullHeight,Ce=ve.ignorePadding&&be.pixelRatio!==ve.pixelRatio,Oe=Ee||Te||Ce||ve.objectAndLayerIdColor;let Re=null,De=null;if(Oe){const fe=be.clone();if(ve.ignorePadding){const _e=t$3J(fe.padding);for(let be=0;be<4;be++)_e[be]=Math.round(_e[be]/fe.pixelRatio*ve.pixelRatio);fe.padding=_e}fe.fullWidth=we.width,fe.fullHeight=we.height,fe.pixelRatio=ve.pixelRatio;const Te=be.fovX-fe.fovX,Ee=be.fovY-fe.fovY;Te<0&&Te<Ee?fe.fovX=be.fovX:Ee<0&&Ee<Te&&(fe.fovY=be.fovY);const Ce={camera:fe,contentCamera:fe,mode:PM.IDLE,alignPixelEnabled:!0,contentPixelRatio:fe.pixelRatio};this._forceCameraHook(Ce),Se=!0;const Oe=this._renderFunctions.renderScene(Ce,_e,ve.objectAndLayerIdColor?RR.ObjectAndLayerID:RR.Screenshot,ve.disableDecorations?TA.OFF:TA.ON);De=Oe.screen,Re=Oe.oid}this._rctx.bindFramebuffer(null==De?void 0:De.fbo);const Be=this._readbackScreenshot(ve,(()=>{this._rctx.bindFramebuffer(null),null==De||De.release()}));let Ze=null;if(ve.objectAndLayerIdColor){const e77=()=>{this._rctx.bindFramebuffer(null),null==Re||Re.release()};this._rctx.bindFramebuffer(null==Re?void 0:Re.fbo),Ze=this._readbackScreenshot(ve,e77),this._rctx.bindFramebuffer(null)}if(Oe&&!this._rctx.contextAttributes.alpha)for(let Xe=3;Xe<Be.data.length;Xe+=4)Be.data[Xe]=255;if(Ze&&!this._rctx.contextAttributes.alpha)for(let Xe=3;Xe<Ze.data.length;Xe+=4)Ze.data[Xe]=255;return Se&&this._forceCameraHook(fe.parameters),[Be,Ze]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function t$F(fe,ve={}){return fe.getContext("webgl2",ve)||null}let u$e=class B8 extends zi{constructor(fe){super({}),this.events=new La,this.waterTextures=new J_e,this.objectAndLayerIdRenderHelper=has("enable-feature:objectAndLayerId-rendering")?new xge:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=fe.container,this._viewingMode=fe.viewingMode;try{this._initializeContext(fe)}catch(br){return}const{memoryController:ve}=fe.view.resourceController;this.stippleTextures=u$1M(this._rctx,ve),this.markerTextures=o$q(this._rctx,ve),this._techniques=new EY({rctx:this._rctx,viewingMode:fe.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new Z_e(fe,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",(fe=>this.requestRender(fe)))),this._materials=new AY(this._textures,this._techniques,(()=>this.requestRender()),(()=>this.requestRender())),this._compositingHelper=new hge(this._rctx,this._techniques),this.renderer=new Pe(fe,this._materials,this._techniques,this._rctx,this._compositingHelper,(fe=>this.requestRender(fe))),this.addHandles([d$3d((()=>fe.view.ready),(ve=>{ve&&this._createRenderNodes(fe.view,fe.viewingMode)}),Xa),d$3d((()=>{var fe;return null==(fe=this.waterTextures)?void 0:fe.updating}),(()=>this.requestRender()),Xa),d$3d((()=>fe.view.qualityProfile),(fe=>{var ve;return null==(ve=this.renderer)?void 0:ve.updateRenderFeatures(fe)}),Ja)]);const _e={renderScene:(fe,ve,_e,be)=>this.renderer.render(fe,ve,_e,be),requestRenderScene:fe=>this.requestRender(fe),prepareOverlay:()=>fe.options.screenshot.prepareOverlay(),renderOverlay:(ve,_e,be)=>fe.options.screenshot.renderOverlay(ve,_e,be)};this._screenshotManager=new l$e(this._rctx,_e,(fe=>this.events.emit("force-camera-for-screenshot",fe))),this._registerFrameTask(fe)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=l$4E(this._frameTask),this._techniques=u$4d(this._techniques),this._componentObjects=u$4d(this._componentObjects),this._screenshotManager=u$4d(this._screenshotManager),u$4d(this.renderer),this._textures=u$4d(this._textures),u$4d(this.waterTextures),u$4d(this.markerTextures),u$4d(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=u$4d(this._rctx)}_createRenderNodes(fe,ve){new $q({view:fe,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new Kye({view:fe,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new Vye({view:fe,techniques:this._techniques}),new Eye({view:fe,techniques:this._techniques}),new Iye({view:fe,viewingMode:ve,techniques:this._techniques})}requestRender(fe=$A.UPDATE){this._needsRender=!0,fe===$A.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(fe){this._idleSuspend!==fe&&(this._idleSuspend=fe,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(fe){return this._screenshotManager.takeScreenshot(fe).then((fe=>fe[0]))}takeScreenshotWithOID(fe){return fe.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(fe)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(fe,ve,_e,be,we,Se=we){const Te=be.constrainWindowSize(ve,_e,we*be.pixelRatio,Se*be.pixelRatio),Ee=this._ensureDepthBuffer(Te);this.renderer.readDepthPixels(Te,Ee);let Ce=Number.MAX_VALUE;for(let Oe=0;Oe<Te[2]*Te[3];Oe++){const fe=B$5(4*Oe,Ee,be.nearFar);Ce>fe&&fe!==be.nearFar[0]&&fe!==be.nearFar[1]&&(Ce=fe)}if(fe){const we=fe.pickDepth(ve*be.pixelRatio,_e*be.pixelRatio,be);null!=we&&Ce>we&&we!==be.nearFar[0]&&we!==be.nearFar[1]&&(Ce=we)}return Ce===Number.MAX_VALUE?void 0:Ce}_ensureDepthBuffer(fe){const ve=4*fe[2]*fe[3];return(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<ve)&&(this._tmpDepthBuffer=new Uint8Array(ve)),this._tmpDepthBuffer}async reloadShaders(){e$Y(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(fe){const ve=fe.view.state;let _e=!1,be=$A.BACKGROUND,we=!1;const Se={preRender:({time:we})=>{_e=this.updating,be=this._needsUpdate?$A.UPDATE:$A.BACKGROUND,fe.commitSyncLayers();const Se=we-this._lastAnimationUpdate;if(Se>this.renderer.animationTimestep||null!=ve.forcedAnimationTime||_e||this._needsRender){const fe=Se/this.renderer.animationTimeDilation,_e=new KB(ve.camera,fe,ve.forcedAnimationTime);this.renderer.updateAnimation(_e)&&this.requestRender($A.BACKGROUND),this._lastAnimationUpdate=we}},render:({time:fe})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&ve.camera.fullWidth>0&&ve.camera.fullHeight>0){const _e=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(ve,fe),we=!0,_e&&this.renderer.hasReflections&&(this.requestRender($A.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:fe})=>{const _e=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,be=new a$e(ve,_e,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(be,fe)},finish:()=>{we&&(this.renderer.finish(ve.mode===PM.IDLE?be:$A.UPDATE),we=!1)}};this._frameTask=A$1I(Se)}_initializeContext(fe){const ve=fe.options;this._canvas=ve.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const _e={alpha:ve.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:ve.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:ve.preserveDrawingBuffer??!1},be=t$F(this._canvas,_e);null!=be?(this._rctx=function F$6(fe,ve){const _e={disabledExtensions:ve.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:ve.options.debugWebGLExtensions||{},maxAnisotropy:8},s84=(fe,_e)=>ve.view.resourceController.memoryController.newCache(fe,_e);return new Y_e(fe,_e,s84)}(be,fe),this._loadShaderOnlyExtensions(),!ve.alpha&&this._rctx.contextAttributes.alpha&&ar.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&has("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ar.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(fe){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(fe):null}get componentObjectCollection(){return null==this._componentObjects&&(this._componentObjects=new hye(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(fe){this._componentObjects=fe}};e$4o([y$2v({type:Boolean,readOnly:!0})],u$e.prototype,"updating",null),e$4o([y$2v()],u$e.prototype,"_rctx",void 0),e$4o([y$2v()],u$e.prototype,"_container",void 0),e$4o([y$2v()],u$e.prototype,"_canvas",void 0),e$4o([y$2v()],u$e.prototype,"stippleTextures",void 0),e$4o([y$2v()],u$e.prototype,"markerTextures",void 0),e$4o([y$2v()],u$e.prototype,"waterTextures",void 0),e$4o([y$2v({readOnly:!0})],u$e.prototype,"objectAndLayerIdRenderHelper",void 0),e$4o([y$2v()],u$e.prototype,"_textures",void 0),e$4o([y$2v({readOnly:!0})],u$e.prototype,"renderer",void 0),e$4o([y$2v()],u$e.prototype,"_screenshotManager",void 0),e$4o([y$2v()],u$e.prototype,"componentObjectCollection",null),e$4o([y$2v()],u$e.prototype,"_componentObjects",void 0),e$4o([y$2v()],u$e.prototype,"_needsUpdate",void 0),e$4o([y$2v()],u$e.prototype,"_needsWaterReflectionUpdate",void 0),u$e=e$4o([a$4y("esri.views.3d.webgl-engine.parts.RenderView")],u$e);let h$e,d$e=class u24 extends zi{constructor(fe){super(fe),this._model=new $fe,this._layers=new jr,this._asyncChangeSet=new OR,this._syncChangeSet=new OR,this._layerSyncSet=new Set}initialize(){this._set("renderView",new u$e(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(gI.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var fe;return null==(fe=this.renderView)?void 0:fe.renderer}add(fe){this._model.add(fe),n$2g(fe)&&this._addLayer(fe),this.renderView.requestRender()}remove(fe){null!=fe&&!this.destroyed&&this._model.remove(fe)&&(n$2g(fe)&&this._removeLayer(fe),this.renderView.requestRender())}addMany(fe){null!=fe&&(this._model.addMany(fe),this.renderView.requestRender())}removeMany(fe){var ve,_e;null!=fe&&(null==(ve=this._model)||ve.removeMany(fe),null==(_e=this.renderView)||_e.requestRender())}forEachOfType(fe,ve){this._model.forEachOfType(fe,ve)}handleEvent(fe,ve){this.destroyed||(this._model.dirtySet[fe](ve),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(fe){if(this._frameTask.processQueue(fe),this._commit(fe),!fe.hasProgressed)return dI}_commit(fe){const ve=this._model.dirtySet;this._asyncChangeSet.empty||fe.done||(this.renderer.modify(this._asyncChangeSet,fe),this.renderView.requestRender(),fe.madeProgress()),this._layers.forAll((_e=>{if(fe.done)return;const be=this._layerSyncSet.has(_e.id)||_e.updatePolicy===QY.SYNC,we=be?this._syncChangeSet:this._asyncChangeSet;ve.commitLayer(_e.id,we),this._layerSyncSet.delete(_e.id),we.empty||(this.renderer.modify(we,be?wI:fe),this.renderView.requestRender(),fe.madeProgress())})),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wI),this.renderView.requestRender(),fe.madeProgress()),this._layers.forAll((_e=>{fe.done||this._layerSyncSet.has(_e.id)||_e.updatePolicy!==QY.ASYNC||(ve.commitLayer(_e.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,fe),this.renderView.requestRender(),fe.madeProgress()))})),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const fe=this._model.dirtySet;this._layers.forAll((ve=>{this._layerSyncSet.has(ve.id)||ve.updatePolicy===QY.SYNC?(fe.commitLayer(ve.id,this._syncChangeSet),this._layerSyncSet.delete(ve.id)):fe.commitSyncUpdates(ve.id,this._syncChangeSet)}));for(const ve of this._layerSyncSet)fe.commitLayer(ve,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wI),this.renderView.requestRender())}_commitLayer(fe){this._model.dirtySet.commitLayer(fe.id,this._syncChangeSet),this._layerSyncSet.delete(fe.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wI),this.renderView.requestRender())}schedule(fe,ve){return this._frameTask.schedule(fe,ve)}reschedule(fe,ve){return this._frameTask.reschedule(fe,ve)}syncLayer(fe){this._layerSyncSet.add(fe),this.renderView.requestRender()}getObject(fe){return this._model.getObject(fe)}get layers(){return this._layers}_addLayer(fe){this._layers.includes(fe)||this._layers.push(fe)}_removeLayer(fe){this._commitLayer(fe),null!=this._layers.removeUnordered(fe)&&(this._model.dirtySet.getResidentRenderGeometries(fe.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,wI))}addRenderPlugin(fe,ve){const _e=this.renderer.plugins.add(fe,ve),i52=()=>{k$g(fe)&&this.view.sceneIntersectionHelper.addIntersectionHandler(fe)};if(S$1T(_e))return _e.then(i52);i52()}removeRenderPlugin(fe){this.destroyed||(k$g(fe)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(fe),this.renderer.plugins.remove(fe))}get performanceInfo(){return this._model.getStats()}get test(){}};function n$U(fe){return fe&&"function"==typeof fe.highlight}function t$E(fe,ve,_e){return null==fe||fe>=_e&&(0===ve||fe<=ve)}function c$13(fe,ve){if(ve&&fe){const{minScale:_e,maxScale:be}=fe;if(u$C(_e,be))return t$E(ve,_e,be)}return!0}function u$C(fe,ve){return null!=fe&&fe>0||null!=ve&&ve>0}function i$Q(fe){return!(null==fe?void 0:fe.minScale)||!fe.maxScale||fe.minScale>=fe.maxScale}function t$D(){return h$e||(h$e=function n$T(){const fe=new p$e,ve=function l$N(fe){if("undefined"==typeof WebGL2RenderingContext)return null;const ve=document.createElement("canvas");if(!ve)return null;let _e=t$F(ve,{failIfMajorPerformanceCaveat:!0});if(null==_e&&(_e=t$F(ve),null!=_e&&(fe.majorPerformanceCaveat=!0)),null==_e)return _e;fe.available=!0,fe.maxTextureSize=_e.getParameter(_e.MAX_TEXTURE_SIZE),fe.supportsVertexShaderSamplers=_e.getParameter(_e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const be=_e.getShaderPrecisionFormat(_e.FRAGMENT_SHADER,_e.HIGH_FLOAT);return be&&(fe.supportsHighPrecisionFragment=be.precision>0),_e}(fe);return null==ve||(fe.supportsColorBufferFloat=null!==ve.getExtension("EXT_color_buffer_float"),fe.supportsColorBufferFloatBlend=null!==ve.getExtension("EXT_float_blend"),fe.supportsColorBufferHalfFloat=fe.supportsColorBufferFloat||null!==ve.getExtension("EXT_color_buffer_half_float")),fe}()),h$e}d$e.DebugSettings={endFrameContentValidation:!1},e$4o([y$2v({constructOnly:!0})],d$e.prototype,"view",void 0),e$4o([y$2v({constructOnly:!0})],d$e.prototype,"options",void 0),e$4o([y$2v({readOnly:!0})],d$e.prototype,"viewingMode",null),e$4o([y$2v({constructOnly:!0})],d$e.prototype,"container",void 0),e$4o([y$2v({readOnly:!0})],d$e.prototype,"updating",null),e$4o([y$2v({constructOnly:!0})],d$e.prototype,"_model",void 0),e$4o([y$2v()],d$e.prototype,"renderView",void 0),e$4o([y$2v({readOnly:!0})],d$e.prototype,"renderer",null),e$4o([y$2v({readOnly:!0})],d$e.prototype,"running",null),d$e=e$4o([a$4y("esri.views.3d.webgl-engine.Stage")],d$e);let p$e=class o37{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};const f$e="esri-component";let m$e=class p41 extends zi{constructor(){super(...arguments),this.widget=null}destroy(){var fe;this.node=null,null==(fe=this.widget)||fe.destroy()}get id(){var fe,ve;return this._get("id")??(null==(fe=this.widget)?void 0:fe.id)??(null==(ve=this.node)?void 0:ve.id)}set id(fe){this._set("id",fe)}set node(fe){const ve=this._get("node");fe!==ve&&(fe&&fe.classList.add(f$e),ve&&ve.classList.remove(f$e),this._set("node",fe))}castNode(fe){var ve;return null==(ve=this.widget)||ve.destroy(),fe?"string"==typeof fe||function n$S(fe){return fe&&"nodeType"in fe}(fe)?(this._set("widget",null),e$3O(fe)):(function d$u(fe){return fe&&"function"==typeof fe.render}(fe)&&!fe.domNode&&(fe.domNode=document.createElement("div")),this._set("widget",fe),fe.domNode):(this._set("widget",null),null)}};e$4o([y$2v()],m$e.prototype,"id",null),e$4o([y$2v()],m$e.prototype,"node",null),e$4o([s$4b("node")],m$e.prototype,"castNode",null),e$4o([y$2v({readOnly:!0})],m$e.prototype,"widget",void 0),m$e=e$4o([a$4y("esri.views.ui.Component")],m$e);const v$e=m$e,_$e="calcite-mode-";function r$m(){return function e$v(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}().startsWith("dark")}function c$11(){return`${_$e}${r$m()?"dark":"light"}`}function n$R(fe){(function o$n(fe){Array.from(fe.classList).forEach((ve=>{ve.startsWith(_$e)&&fe.classList.remove(ve)}))})(fe),fe.classList.add(c$11())}const $$e={left:0,top:0,bottom:0,right:0},b$e={bottom:30,top:15,right:15,left:15},x$e="esri-ui",S$e={ui:x$e,corner:`${x$e}-corner`,innerContainer:`${x$e}-inner-container`,manualContainer:`${x$e}-manual-container`,cornerContainer:`${x$e}-corner-container`,topLeft:`${x$e}-top-left`,topRight:`${x$e}-top-right`,bottomLeft:`${x$e}-bottom-left`,bottomRight:`${x$e}-bottom-right`};function w$e(fe){return 0===fe?"0":`${fe}px`}function P$6(fe){const ve="object"==typeof fe&&null!==fe&&Object.getPrototypeOf(fe);return null!==ve&&ve!==Object.prototype||!("component"in fe||"index"in fe||"position"in fe)?null:fe}function L$5(fe,{top:ve,bottom:_e,left:be,right:we}){fe.style.top=ve,fe.style.bottom=_e,fe.style.left=be,fe.style.right=we}let E$e=class j10 extends La.EventedAccessor{constructor(fe){super(fe),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=c$4r(),this.view=null,this._applyViewPadding=()=>{const fe=this.container;fe&&L$5(fe,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const fe=this._innerContainer;fe&&L$5(fe,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([d$3d((()=>{var fe;return[null==(fe=this.view)?void 0:fe.padding,this.container]}),this._applyViewPadding,Xa),d$3d((()=>this.padding),this._applyUIPadding,Xa),d$3d((()=>[this.container,this._locale]),(([fe,ve])=>{fe&&fe.setAttribute("lang",ve)}),Xa),f$2W((fe=>{this._locale=fe}))])}destroy(){this.container=null;for(const fe of this._components)fe.destroy();this._components.length=0,this._componentMap.clear()}set container(fe){const ve=this._get("container");fe!==ve&&(fe&&(fe.classList.add(S$e.ui),n$R(fe),this._attachContainers(fe)),ve&&(ve.classList.remove(S$e.ui),L$5(ve,{top:"",bottom:"",left:"",right:""}),n$4k(ve)),this._set("container",fe))}get height(){var fe;const ve=(null==(fe=this.view)?void 0:fe.height)??0;if(0===ve)return ve;const _e=this._getViewPadding(),{top:be,bottom:we}=_e;return Math.max(ve-be-we,0)}get padding(){return this._get("padding")}set padding(fe){this._overrideIfSome("padding",fe)}castPadding(fe){return"number"==typeof fe?{bottom:fe,top:fe,right:fe,left:fe}:{...b$e,...fe}}get width(){var fe;const ve=(null==(fe=this.view)?void 0:fe.width)??0;if(0===ve)return ve;const _e=this._getViewPadding(),{left:be,right:we}=_e;return Math.max(ve-be-we,0)}add(fe,ve){let _e,be,we;if(Array.isArray(fe))return void fe.forEach((fe=>this.add(fe,ve)));const Se=P$6(fe);Se&&({index:_e,position:ve,component:fe,key:be}=Se),ve&&"object"==typeof ve&&({index:_e,key:be,position:ve,internal:we}=ve),!fe||ve&&!this._isValidPosition(ve)||this._add(fe,ve,_e,be,we)}remove(fe,ve){var _e,be;if(!fe)return;if(Array.isArray(fe))return fe.map((fe=>this.remove(fe,ve)));const we=this._find(fe);if(we){if(this._componentMap.has(we)&&(null==(_e=this._componentMap.get(we))?void 0:_e.key)!==ve)return;const fe=this._components.indexOf(we),Se=we.node.parentNode;return null==Se||Se.removeChild(we.node),this._componentMap.delete(we),null==(be=we.widget)||be.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(fe,1)[0]}}empty(fe,ve={removeInternal:!1}){if(Array.isArray(fe)){for(const _e of fe)this.empty(_e,ve);return}const _e=this._positionNameToContainerLookup[fe??"manual"],be=Array.prototype.slice.call(_e.children).map((fe=>this._findByNode(fe))).filter((fe=>{var _e;return null!=fe&&(!(null==(_e=this._componentMap.get(fe))?void 0:_e.internal)||ve.removeInternal)}));for(const we of be)this.remove(we)}move(fe,ve){if(Array.isArray(fe)&&fe.forEach((fe=>this.move(fe,ve))),!fe)return;let _e;const be=P$6(fe)||P$6(ve);if(be&&(_e=be.index,ve=be.position,fe=be.component||fe),ve&&!this._isValidPosition(ve))return;const we=this.remove(fe);we&&this.add(we,{position:ve,index:_e})}find(fe){if(!fe)return null;const ve=this._findById(fe);return ve&&(ve.widget||ve.node)}getComponents(fe,ve={includeInternal:!1}){return fe?Array.isArray(fe)?fe.flatMap((fe=>this._getComponentsAtPosition(fe,ve))):this._getComponentsAtPosition(fe,ve):this._components.filter((fe=>{var _e;return ve.includeInternal||!(null==(_e=this._componentMap.get(fe))?void 0:_e.internal)})).map((({widget:fe,node:ve})=>fe??ve))}getPosition(fe){for(const ve in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[ve].contains(fe))return ve;return null}_add(fe,ve,_e,be,we){fe instanceof v$e||(fe=new v$e({node:fe}));const{widget:Se}=fe;null!=Se&&Se instanceof zi&&Se.addHandles(e$4e((()=>{queueMicrotask((()=>this.remove(fe)))})),this._removeWidgetHandleKey),this._place({component:fe,position:ve,index:_e}),this._components.push(fe),this._componentMap.set(fe,{key:be,internal:we})}_find(fe){return fe?fe instanceof v$e?this._findByComponent(fe):"string"==typeof fe?this._findById(fe):this._findByNode(fe.domNode||fe):null}_getViewPadding(){var fe;return(null==(fe=this.view)?void 0:fe.padding)??$$e}_attachContainers(fe){fe.appendChild(this._innerContainer),fe.appendChild(this._manualContainer)}_initContainers(){const fe=document.createElement("div");fe.classList.add(S$e.innerContainer,S$e.cornerContainer);const ve=document.createElement("div");ve.classList.add(S$e.innerContainer,S$e.manualContainer);const _e=document.createElement("div");_e.classList.add(S$e.topLeft,S$e.corner),fe.appendChild(_e);const be=document.createElement("div");be.classList.add(S$e.topRight,S$e.corner),fe.appendChild(be);const we=document.createElement("div");we.classList.add(S$e.bottomLeft,S$e.corner),fe.appendChild(we);const Se=document.createElement("div");Se.classList.add(S$e.bottomRight,S$e.corner),fe.appendChild(Se),this._innerContainer=fe,this._manualContainer=ve;const Te=g$27();this._cornerNameToContainerLookup={"top-left":_e,"top-right":be,"bottom-left":we,"bottom-right":Se,"top-leading":Te?be:_e,"top-trailing":Te?_e:be,"bottom-leading":Te?Se:we,"bottom-trailing":Te?we:Se},this._positionNameToContainerLookup={manual:ve,...this._cornerNameToContainerLookup}}_isValidPosition(fe){return!!this._positionNameToContainerLookup[fe]}_place(fe){const ve=fe.position??"manual",{component:_e,index:be}=fe,we=this._positionNameToContainerLookup[ve],Se=null!=be&&be>-1;if(function b$c(fe){return fe&&!fe._started&&"function"==typeof fe.postMixInProperties&&"function"==typeof fe.buildRendering&&"function"==typeof fe.postCreate&&"function"==typeof fe.startup}(_e.widget)&&_e.widget.startup(),!Se)return void we.appendChild(_e.node);const Te=Array.from(we.children);0!==be?be>=Te.length?we.appendChild(_e.node):o$3M(_e.node,Te[be]):we.firstChild?o$3M(_e.node,we.firstChild):we.appendChild(_e.node)}_toPixelPosition(fe){return{top:w$e(fe.top),left:w$e(fe.left),right:w$e(fe.right),bottom:w$e(fe.bottom)}}_findByComponent(fe){return this._components.find((ve=>ve===fe))??null}_findById(fe){return this._components.find((({id:ve})=>ve===fe))??null}_findByNode(fe){return this._components.find((({node:ve})=>ve===fe))??null}_getComponentsAtPosition(fe,ve){const _e=this._positionNameToContainerLookup[fe];return Array.prototype.slice.call(_e.children).map((fe=>this._findByNode(fe))).filter(O$1y).filter((fe=>{var _e;return ve.includeInternal||!(null==(_e=this._componentMap.get(fe))?void 0:_e.internal)})).map((({widget:fe,node:ve})=>fe??ve))}};e$4o([y$2v()],E$e.prototype,"_locale",void 0),e$4o([y$2v()],E$e.prototype,"container",null),e$4o([y$2v()],E$e.prototype,"height",null),e$4o([y$2v({value:b$e})],E$e.prototype,"padding",null),e$4o([s$4b("padding")],E$e.prototype,"castPadding",null),e$4o([y$2v()],E$e.prototype,"view",void 0),e$4o([y$2v()],E$e.prototype,"width",null),E$e=e$4o([a$4y("esri.views.ui.UI")],E$e);const O$e=E$e,R$e="randomUUID"in crypto;function n$Q(){if(R$e)return crypto.randomUUID();const fe=crypto.getRandomValues(new Uint16Array(8));fe[3]=4095&fe[3]|16384,fe[4]=16383&fe[4]|32768;const r65=ve=>fe[ve].toString(16).padStart(4,"0");return r65(0)+r65(1)+"-"+r65(2)+"-"+r65(3)+"-"+r65(4)+"-"+r65(5)+r65(6)+r65(7)}function r$l(){return`{${n$Q().toUpperCase()}}`}const I$e={handleInterceptedEvent:(fe,ve,_e,be)=>(fe.scheduleRender(),ve.properties[`on${be.type}`].apply(ve.properties.bind||_e,[be]))},L$e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(fe,ve,_e)=>{"-"===ve.charAt(0)?fe.style.setProperty(ve,_e):fe.style[ve]=_e}},d$t=(fe,ve,_e=!1)=>{let be=fe;return ve.forEach(((fe,we)=>{const Se=(null==be?void 0:be.children)?((fe,ve)=>fe.find(ve))(be.children,(ve=>ve.domNode===fe)):void 0;_e&&!Se&&we!==ve.length-1||(be=Se)})),be},N$e="calcite-mode-auto",z$e="calcite-mode-dark",k$e={autoMode:N$e,darkMode:z$e,lightMode:"calcite-mode-light",rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},U$e=globalThis.calciteConfig,V$e=(null==U$e?void 0:U$e.focusTrapStack)||[],B$e="2.10.1";var G$e={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},H$e=Object.defineProperty,getAssetPath=fe=>{const ve=new URL(fe,ybe.$resourcesUrl$);return ve.origin!==pbe.location.origin?ve.href:ve.pathname},q$e={},isComplexType=fe=>"object"===(fe=typeof fe)||"function"===fe;((fe,ve)=>{for(var _e in ve)H$e(fe,_e,{get:ve[_e],enumerable:!0})})({},{err:()=>err,map:()=>map,ok:()=>ok,unwrap:()=>unwrap,unwrapErr:()=>unwrapErr});var ok=fe=>({isOk:!0,isErr:!1,value:fe}),err=fe=>({isOk:!1,isErr:!0,value:fe});function map(fe,ve){if(fe.isOk){const _e=ve(fe.value);return _e instanceof Promise?_e.then((fe=>ok(fe))):ok(_e)}if(fe.isErr){const ve=fe.value;return err(ve)}throw"should never get here"}var W$e,Y$e,Z$e,unwrap=fe=>{if(fe.isOk)return fe.value;throw fe.value},unwrapErr=fe=>{if(fe.isErr)return fe.value;throw fe.value},X$e="http://www.w3.org/1999/xlink",h$m=(fe,ve,..._e)=>{let be=null,we=null,Se=null,Te=!1,Ee=!1;const Ce=[],walk=ve=>{for(let _e=0;_e<ve.length;_e++)be=ve[_e],Array.isArray(be)?walk(be):null!=be&&"boolean"!=typeof be&&((Te="function"!=typeof fe&&!isComplexType(be))&&(be=String(be)),Te&&Ee?Ce[Ce.length-1].$text$+=be:Ce.push(Te?newVNode(null,be):be),Ee=Te)};if(walk(_e),ve){ve.key&&(we=ve.key),ve.name&&(Se=ve.name);{const fe=ve.className||ve.class;fe&&(ve.class="object"!=typeof fe?fe:Object.keys(fe).filter((ve=>fe[ve])).join(" "))}}if("function"==typeof fe)return fe(null===ve?{}:ve,Ce,ebe);const Oe=newVNode(fe,null);return Oe.$attrs$=ve,Ce.length>0&&(Oe.$children$=Ce),Oe.$key$=we,Oe.$name$=Se,Oe},newVNode=(fe,ve)=>{const _e={$flags$:0,$tag$:fe,$text$:ve,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null};return _e},K$e={},ebe={forEach:(fe,ve)=>fe.map(convertToPublic).forEach(ve),map:(fe,ve)=>fe.map(convertToPublic).map(ve).map(convertToPrivate)},convertToPublic=fe=>({vattrs:fe.$attrs$,vchildren:fe.$children$,vkey:fe.$key$,vname:fe.$name$,vtag:fe.$tag$,vtext:fe.$text$}),convertToPrivate=fe=>{if("function"==typeof fe.vtag){const ve={...fe.vattrs};return fe.vkey&&(ve.key=fe.vkey),fe.vname&&(ve.name=fe.vname),h$m(fe.vtag,ve,...fe.vchildren||[])}const ve=newVNode(fe.vtag,fe.vtext);return ve.$attrs$=fe.vattrs,ve.$children$=fe.vchildren,ve.$key$=fe.vkey,ve.$name$=fe.vname,ve},createEvent=(fe,ve,_e)=>{const be=fe;return{emit:fe=>emitEvent(be,ve,{bubbles:!!(4&_e),composed:!!(2&_e),cancelable:!!(1&_e),detail:fe})}},emitEvent=(fe,ve,_e)=>{const be=ybe.ce(ve,_e);return fe.dispatchEvent(be),be},tbe=new WeakMap,attachStyles=fe=>{const ve=fe.$cmpMeta$,_e=fe.$hostElement$,be=ve.$flags$,we=(ve.$tagName$,()=>{}),Se=((fe,ve,_e)=>{var be;const we=getScopeId(ve,_e),Se=hbe.get(we);if(fe=11===fe.nodeType?fe:fbe,Se)if("string"==typeof Se){fe=fe.head||fe;let _e,Te=tbe.get(fe);if(Te||tbe.set(fe,Te=new Set),!Te.has(we)){{_e=fbe.createElement("style"),_e.innerHTML=Se;const ve=null!=(be=ybe.$nonce$)?be:function queryNonceMetaTagContent(fe){var ve,_e,be;return null!=(be=null==(_e=null==(ve=fe.head)?void 0:ve.querySelector('meta[name="csp-nonce"]'))?void 0:_e.getAttribute("content"))?be:void 0}(fbe);null!=ve&&_e.setAttribute("nonce",ve),fe.insertBefore(_e,fe.querySelector("link"))}4&ve.$flags$&&(_e.innerHTML+="slot-fb{display:contents}slot-fb[hidden]{display:none}"),Te&&Te.add(we)}}else fe.adoptedStyleSheets.includes(Se)||(fe.adoptedStyleSheets=[...fe.adoptedStyleSheets,Se]);return we})(_e.shadowRoot?_e.shadowRoot:_e.getRootNode(),ve,fe.$modeName$);10&be&&(_e["s-sc"]=Se,_e.classList.add(Se+"-h"),2&be&&_e.classList.add(Se+"-s")),we()},getScopeId=(fe,ve)=>"sc-"+(ve&&32&fe.$flags$?fe.$tagName$+"-"+ve:fe.$tagName$),setAccessor=(fe,ve,_e,be,we,Se)=>{if(_e!==be){let Te=isMemberInElement(fe,ve),Ee=ve.toLowerCase();if("class"===ve){const ve=fe.classList,we=parseClassList(_e),Se=parseClassList(be);ve.remove(...we.filter((fe=>fe&&!Se.includes(fe)))),ve.add(...Se.filter((fe=>fe&&!we.includes(fe))))}else if("style"===ve){for(const ve in _e)be&&null!=be[ve]||(ve.includes("-")?fe.style.removeProperty(ve):fe.style[ve]="");for(const ve in be)_e&&be[ve]===_e[ve]||(ve.includes("-")?fe.style.setProperty(ve,be[ve]):fe.style[ve]=be[ve])}else if("key"===ve);else if("ref"===ve)be&&be(fe);else if(fe.__lookupSetter__(ve)||"o"!==ve[0]||"n"!==ve[1]){const Ce=isComplexType(be);if((Te||Ce&&null!==be)&&!we)try{if(fe.tagName.includes("-"))fe[ve]=be;else{const we=null==be?"":be;"list"===ve?Te=!1:null!=_e&&fe[ve]==we||(fe[ve]=we)}}catch(vr){}let Oe=!1;Ee!==(Ee=Ee.replace(/^xlink\:?/,""))&&(ve=Ee,Oe=!0),null==be||!1===be?!1===be&&""!==fe.getAttribute(ve)||(Oe?fe.removeAttributeNS(X$e,ve):fe.removeAttribute(ve)):(!Te||4&Se||we)&&!Ce&&(be=!0===be?"":be,Oe?fe.setAttributeNS(X$e,ve,be):fe.setAttribute(ve,be))}else if(ve="-"===ve[2]?ve.slice(3):isMemberInElement(pbe,Ee)?Ee.slice(2):Ee[2]+ve.slice(3),_e||be){const we=ve.endsWith(ibe);ve=ve.replace(nbe,""),_e&&ybe.rel(fe,ve,_e,we),be&&ybe.ael(fe,ve,be,we)}}},rbe=/\s/,parseClassList=fe=>fe?fe.split(rbe):[],ibe="Capture",nbe=new RegExp(ibe+"$"),updateElement=(fe,ve,_e)=>{const be=11===ve.$elm$.nodeType&&ve.$elm$.host?ve.$elm$.host:ve.$elm$,we=fe&&fe.$attrs$||q$e,Se=ve.$attrs$||q$e;for(const Te of sortedAttrNames(Object.keys(we)))Te in Se||setAccessor(be,Te,we[Te],void 0,_e,ve.$flags$);for(const Te of sortedAttrNames(Object.keys(Se)))setAccessor(be,Te,we[Te],Se[Te],_e,ve.$flags$)};function sortedAttrNames(fe){return fe.includes("ref")?[...fe.filter((fe=>"ref"!==fe)),"ref"]:fe}var sbe=!1,obe=!1,abe=!1,lbe=!1,createElm=(fe,ve,_e,be)=>{var we;const Se=ve.$children$[_e];let Te,Ee,Ce,Oe=0;if(sbe||(abe=!0,"slot"===Se.$tag$&&(W$e&&be.classList.add(W$e+"-s"),Se.$flags$|=Se.$children$?2:1)),null!==Se.$text$)Te=Se.$elm$=fbe.createTextNode(Se.$text$);else if(1&Se.$flags$)Te=Se.$elm$=fbe.createTextNode("");else{if(lbe||(lbe="svg"===Se.$tag$),Te=Se.$elm$=fbe.createElementNS(lbe?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&Se.$flags$?"slot-fb":Se.$tag$),lbe&&"foreignObject"===Se.$tag$&&(lbe=!1),updateElement(null,Se,lbe),null!=W$e&&Te["s-si"]!==W$e&&Te.classList.add(Te["s-si"]=W$e),updateElementScopeIds(Te,be),Se.$children$)for(Oe=0;Oe<Se.$children$.length;++Oe)Ee=createElm(fe,Se,Oe,Te),Ee&&Te.appendChild(Ee);"svg"===Se.$tag$?lbe=!1:"foreignObject"===Te.tagName&&(lbe=!0)}return Te["s-hn"]=Z$e,3&Se.$flags$&&(Te["s-sr"]=!0,Te["s-cr"]=Y$e,Te["s-sn"]=Se.$name$||"",Te["s-rf"]=null==(we=Se.$attrs$)?void 0:we.ref,Ce=fe&&fe.$children$&&fe.$children$[_e],Ce&&Ce.$tag$===Se.$tag$&&fe.$elm$&&putBackInOriginalLocation(fe.$elm$,!1)),Te},putBackInOriginalLocation=(fe,ve)=>{ybe.$flags$|=1;const _e=Array.from(fe.childNodes);if(fe["s-sr"]&&G$e.experimentalSlotFixes){let ve=fe;for(;ve=ve.nextSibling;)ve&&ve["s-sn"]===fe["s-sn"]&&ve["s-sh"]===Z$e&&_e.push(ve)}for(let be=_e.length-1;be>=0;be--){const fe=_e[be];fe["s-hn"]!==Z$e&&fe["s-ol"]&&(insertBefore(parentReferenceNode(fe),fe,referenceNode(fe)),fe["s-ol"].remove(),fe["s-ol"]=void 0,fe["s-sh"]=void 0,abe=!0),ve&&putBackInOriginalLocation(fe,ve)}ybe.$flags$&=-2},addVnodes=(fe,ve,_e,be,we,Se)=>{let Te,Ee=fe["s-cr"]&&fe["s-cr"].parentNode||fe;for(Ee.shadowRoot&&Ee.tagName===Z$e&&(Ee=Ee.shadowRoot);we<=Se;++we)be[we]&&(Te=createElm(null,_e,we,fe),Te&&(be[we].$elm$=Te,insertBefore(Ee,Te,referenceNode(ve))))},removeVnodes=(fe,ve,_e)=>{for(let be=ve;be<=_e;++be){const ve=fe[be];if(ve){const fe=ve.$elm$;nullifyVNodeRefs(ve),fe&&(obe=!0,fe["s-ol"]?fe["s-ol"].remove():putBackInOriginalLocation(fe,!0),fe.remove())}}},isSameVnode=(fe,ve,_e=!1)=>fe.$tag$===ve.$tag$&&("slot"===fe.$tag$?fe.$name$===ve.$name$:!!_e||fe.$key$===ve.$key$),referenceNode=fe=>fe&&fe["s-ol"]||fe,parentReferenceNode=fe=>(fe["s-ol"]?fe["s-ol"]:fe).parentNode,patch=(fe,ve,_e=!1)=>{const be=ve.$elm$=fe.$elm$,we=fe.$children$,Se=ve.$children$,Te=ve.$tag$,Ee=ve.$text$;let Ce;null===Ee?(lbe="svg"===Te||"foreignObject"!==Te&&lbe,("slot"!==Te||sbe)&&updateElement(fe,ve,lbe),null!==we&&null!==Se?((fe,ve,_e,be,we=!1)=>{let Se,Te,Ee=0,Ce=0,Oe=0,Re=0,De=ve.length-1,Be=ve[0],Ze=ve[De],Xe=be.length-1,Je=be[0],Qe=be[Xe];for(;Ee<=De&&Ce<=Xe;)if(null==Be)Be=ve[++Ee];else if(null==Ze)Ze=ve[--De];else if(null==Je)Je=be[++Ce];else if(null==Qe)Qe=be[--Xe];else if(isSameVnode(Be,Je,we))patch(Be,Je,we),Be=ve[++Ee],Je=be[++Ce];else if(isSameVnode(Ze,Qe,we))patch(Ze,Qe,we),Ze=ve[--De],Qe=be[--Xe];else if(isSameVnode(Be,Qe,we))"slot"!==Be.$tag$&&"slot"!==Qe.$tag$||putBackInOriginalLocation(Be.$elm$.parentNode,!1),patch(Be,Qe,we),insertBefore(fe,Be.$elm$,Ze.$elm$.nextSibling),Be=ve[++Ee],Qe=be[--Xe];else if(isSameVnode(Ze,Je,we))"slot"!==Be.$tag$&&"slot"!==Qe.$tag$||putBackInOriginalLocation(Ze.$elm$.parentNode,!1),patch(Ze,Je,we),insertBefore(fe,Ze.$elm$,Be.$elm$),Ze=ve[--De],Je=be[++Ce];else{for(Oe=-1,Re=Ee;Re<=De;++Re)if(ve[Re]&&null!==ve[Re].$key$&&ve[Re].$key$===Je.$key$){Oe=Re;break}Oe>=0?(Te=ve[Oe],Te.$tag$!==Je.$tag$?Se=createElm(ve&&ve[Ce],_e,Oe,fe):(patch(Te,Je,we),ve[Oe]=void 0,Se=Te.$elm$),Je=be[++Ce]):(Se=createElm(ve&&ve[Ce],_e,Ce,fe),Je=be[++Ce]),Se&&insertBefore(parentReferenceNode(Be.$elm$),Se,referenceNode(Be.$elm$))}Ee>De?addVnodes(fe,null==be[Xe+1]?null:be[Xe+1].$elm$,_e,be,Ce,Xe):Ce>Xe&&removeVnodes(ve,Ee,De)})(be,we,ve,Se,_e):null!==Se?(null!==fe.$text$&&(be.textContent=""),addVnodes(be,null,ve,Se,0,Se.length-1)):null!==we&&removeVnodes(we,0,we.length-1),lbe&&"svg"===Te&&(lbe=!1)):(Ce=be["s-cr"])?Ce.parentNode.textContent=Ee:fe.$text$!==Ee&&(be.data=Ee)},updateFallbackSlotVisibility=fe=>{const ve=fe.childNodes;for(const _e of ve)if(1===_e.nodeType){if(_e["s-sr"]){const fe=_e["s-sn"];_e.hidden=!1;for(const be of ve)if(be!==_e)if(be["s-hn"]!==_e["s-hn"]||""!==fe){if(1===be.nodeType&&(fe===be.getAttribute("slot")||fe===be["s-sn"])||3===be.nodeType&&fe===be["s-sn"]){_e.hidden=!0;break}}else if(1===be.nodeType||3===be.nodeType&&""!==be.textContent.trim()){_e.hidden=!0;break}}updateFallbackSlotVisibility(_e)}},cbe=[],markSlotContentForRelocation=fe=>{let ve,_e,be;for(const we of fe.childNodes){if(we["s-sr"]&&(ve=we["s-cr"])&&ve.parentNode){_e=ve.parentNode.childNodes;const fe=we["s-sn"];for(be=_e.length-1;be>=0;be--)if(ve=_e[be],!ve["s-cn"]&&!ve["s-nr"]&&ve["s-hn"]!==we["s-hn"]&&!G$e.experimentalSlotFixes)if(isNodeLocatedInSlot(ve,fe)){let _e=cbe.find((fe=>fe.$nodeToRelocate$===ve));obe=!0,ve["s-sn"]=ve["s-sn"]||fe,_e?(_e.$nodeToRelocate$["s-sh"]=we["s-hn"],_e.$slotRefNode$=we):(ve["s-sh"]=we["s-hn"],cbe.push({$slotRefNode$:we,$nodeToRelocate$:ve})),ve["s-sr"]&&cbe.map((fe=>{isNodeLocatedInSlot(fe.$nodeToRelocate$,ve["s-sn"])&&(_e=cbe.find((fe=>fe.$nodeToRelocate$===ve)),_e&&!fe.$slotRefNode$&&(fe.$slotRefNode$=_e.$slotRefNode$))}))}else cbe.some((fe=>fe.$nodeToRelocate$===ve))||cbe.push({$nodeToRelocate$:ve})}1===we.nodeType&&markSlotContentForRelocation(we)}},isNodeLocatedInSlot=(fe,ve)=>1===fe.nodeType?null===fe.getAttribute("slot")&&""===ve||fe.getAttribute("slot")===ve:fe["s-sn"]===ve||""===ve,nullifyVNodeRefs=fe=>{fe.$attrs$&&fe.$attrs$.ref&&fe.$attrs$.ref(null),fe.$children$&&fe.$children$.map(nullifyVNodeRefs)},insertBefore=(fe,ve,_e)=>{const be=null==fe?void 0:fe.insertBefore(ve,_e);return updateElementScopeIds(ve,fe),be},findScopeIds=fe=>{const ve=[];return fe&&ve.push(...fe["s-scs"]||[],fe["s-si"],fe["s-sc"],...findScopeIds(fe.parentElement)),ve},updateElementScopeIds=(fe,ve,_e=!1)=>{var be;if(fe&&ve&&1===fe.nodeType){const we=new Set(findScopeIds(ve).filter(Boolean));if(we.size&&(null==(be=fe.classList)||be.add(...fe["s-scs"]=[...we]),fe["s-ol"]||_e))for(const ve of Array.from(fe.childNodes))updateElementScopeIds(ve,fe,!0)}},renderVdom=(fe,ve,_e=!1)=>{var be,we,Se,Te,Ee;const Ce=fe.$hostElement$,Oe=fe.$cmpMeta$,Re=fe.$vnode$||newVNode(null,null),De=(Be=ve)&&Be.$tag$===K$e?ve:h$m(null,null,ve);var Be;if(Z$e=Ce.tagName,Oe.$attrsToReflect$&&(De.$attrs$=De.$attrs$||{},Oe.$attrsToReflect$.map((([fe,ve])=>De.$attrs$[ve]=Ce[fe]))),_e&&De.$attrs$)for(const Ze of Object.keys(De.$attrs$))Ce.hasAttribute(Ze)&&!["key","ref","style","class"].includes(Ze)&&(De.$attrs$[Ze]=Ce[Ze]);if(De.$tag$=null,De.$flags$|=4,fe.$vnode$=De,De.$elm$=Re.$elm$=Ce.shadowRoot||Ce,W$e=Ce["s-sc"],sbe=!!(1&Oe.$flags$),Y$e=Ce["s-cr"],obe=!1,patch(Re,De,_e),ybe.$flags$|=1,abe){markSlotContentForRelocation(De.$elm$);for(const fe of cbe){const ve=fe.$nodeToRelocate$;if(!ve["s-ol"]){const fe=fbe.createTextNode("");fe["s-nr"]=ve,insertBefore(ve.parentNode,ve["s-ol"]=fe,ve)}}for(const fe of cbe){const ve=fe.$nodeToRelocate$,Ee=fe.$slotRefNode$;if(Ee){const fe=Ee.parentNode;let _e=Ee.nextSibling;{let Se=null==(be=ve["s-ol"])?void 0:be.previousSibling;for(;Se;){let be=null!=(we=Se["s-nr"])?we:null;if(be&&be["s-sn"]===ve["s-sn"]&&fe===be.parentNode){for(be=be.nextSibling;be===ve||(null==be?void 0:be["s-sr"]);)be=null==be?void 0:be.nextSibling;if(!be||!be["s-nr"]){_e=be;break}}Se=Se.previousSibling}}(!_e&&fe!==ve.parentNode||ve.nextSibling!==_e)&&ve!==_e&&(!ve["s-hn"]&&ve["s-ol"]&&(ve["s-hn"]=ve["s-ol"].parentNode.nodeName),insertBefore(fe,ve,_e),1===ve.nodeType&&(ve.hidden=null!=(Se=ve["s-ih"])&&Se)),ve&&"function"==typeof Ee["s-rf"]&&Ee["s-rf"](ve)}else 1===ve.nodeType&&(_e&&(ve["s-ih"]=null!=(Te=ve.hidden)&&Te),ve.hidden=!0)}}if(obe&&updateFallbackSlotVisibility(De.$elm$),ybe.$flags$&=-2,cbe.length=0,G$e.experimentalScopedSlotChanges&&2&Oe.$flags$)for(const Ze of De.$elm$.childNodes)Ze["s-hn"]===Z$e||Ze["s-sh"]||(_e&&null==Ze["s-ih"]&&(Ze["s-ih"]=null!=(Ee=Ze.hidden)&&Ee),Ze.hidden=!0);Y$e=void 0},scheduleUpdate=(fe,ve)=>{fe.$flags$|=16,fe.$ancestorComponent$;return xbe((()=>dispatchHooks(fe,ve)))},dispatchHooks=(fe,ve)=>{const _e=fe.$hostElement$,be=(fe.$cmpMeta$.$tagName$,()=>{}),we=_e;if(!we)throw new Error(`Can't render component <${_e.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let Se;return Se=safeCall(we,ve?"componentWillLoad":"componentWillUpdate"),Se=enqueue(Se,(()=>safeCall(we,"componentWillRender"))),be(),enqueue(Se,(()=>updateComponent(fe,we,ve)))},enqueue=(fe,ve)=>isPromisey(fe)?fe.then(ve):ve(),isPromisey=fe=>fe instanceof Promise||fe&&fe.then&&"function"==typeof fe.then,updateComponent=async(fe,ve,_e)=>{const be=fe.$hostElement$,we=(fe.$cmpMeta$.$tagName$,()=>{});be["s-rc"],_e&&attachStyles(fe);const Se=(fe.$cmpMeta$.$tagName$,()=>{});callRender(fe,ve,be,_e),Se(),we(),postUpdateComponent(fe)},callRender=(fe,ve,_e,be)=>{try{ve=ve.render&&ve.render(),fe.$flags$&=-17,fe.$flags$|=2,(G$e.hasRenderFn||G$e.reflect)&&(G$e.vdomRender||G$e.reflect)&&(G$e.hydrateServerSide||renderVdom(fe,ve,be))}catch(vr){consoleError(vr,fe.$hostElement$)}return null},postUpdateComponent=fe=>{fe.$cmpMeta$.$tagName$;const endPostUpdate=()=>{},ve=fe.$hostElement$;fe.$ancestorComponent$,safeCall(ve,"componentDidRender"),64&fe.$flags$?(safeCall(ve,"componentDidUpdate"),endPostUpdate()):(fe.$flags$|=64,safeCall(ve,"componentDidLoad"),endPostUpdate())},forceUpdate=fe=>{{const ve=getHostRef(fe),_e=ve.$hostElement$.isConnected;return _e&&2==(18&ve.$flags$)&&scheduleUpdate(ve,!1),_e}},safeCall=(fe,ve,_e)=>{if(fe&&fe[ve])try{return fe[ve](_e)}catch(vr){consoleError(vr)}},setValue=(fe,ve,_e,be)=>{const we=getHostRef(fe),Se=fe,Te=we.$instanceValues$.get(ve),Ee=we.$flags$,Ce=Se;var Oe,Re;Oe=_e,Re=be.$members$[ve][0],_e=null==Oe||isComplexType(Oe)?Oe:4&Re?"false"!==Oe&&(""===Oe||!!Oe):2&Re?parseFloat(Oe):1&Re?String(Oe):Oe;const De=Number.isNaN(Te)&&Number.isNaN(_e);if(_e!==Te&&!De){if(we.$instanceValues$.set(ve,_e),be.$watchers$&&128&Ee){const fe=be.$watchers$[ve];fe&&fe.map((fe=>{try{Ce[fe](_e,Te,ve)}catch(vr){consoleError(vr,Se)}}))}if(2==(18&Ee)){if(Ce.componentShouldUpdate&&!1===Ce.componentShouldUpdate(_e,Te,ve))return;scheduleUpdate(we,!1)}}},proxyComponent=(fe,ve,_e)=>{var be;const we=fe.prototype;if(ve.$members$){fe.watchers&&(ve.$watchers$=fe.watchers);const _e=Object.entries(ve.$members$);_e.map((([fe,[_e]])=>{(31&_e||32&_e)&&Object.defineProperty(we,fe,{get(){return ve=fe,getHostRef(this).$instanceValues$.get(ve);var ve},set(_e){setValue(this,fe,_e,ve)},configurable:!0,enumerable:!0})}));{const Se=new Map;we.attributeChangedCallback=function(fe,_e,be){ybe.jmp((()=>{var Te;const Ee=Se.get(fe);if(this.hasOwnProperty(Ee))be=this[Ee],delete this[Ee];else{if(we.hasOwnProperty(Ee)&&"number"==typeof this[Ee]&&this[Ee]==be)return;if(null==Ee){const we=getHostRef(this),Se=null==we?void 0:we.$flags$;if(Se&&!(8&Se)&&128&Se&&be!==_e){const we=this,Se=null==(Te=ve.$watchers$)?void 0:Te[fe];null==Se||Se.forEach((ve=>{null!=we[ve]&&we[ve].call(we,be,_e,fe)}))}return}}this[Ee]=(null!==be||"boolean"!=typeof this[Ee])&&be}))},fe.observedAttributes=Array.from(new Set([...Object.keys(null!=(be=ve.$watchers$)?be:{}),..._e.filter((([fe,ve])=>15&ve[0])).map((([fe,_e])=>{var be;const we=_e[1]||fe;return Se.set(we,fe),512&_e[0]&&(null==(be=ve.$attrsToReflect$)||be.push([fe,we])),we}))]))}}return fe},initializeComponent=async(fe,ve,_e,be)=>{let we;if(!(32&ve.$flags$)){ve.$flags$|=32,_e.$lazyBundleId$;{we=fe.constructor;const _e=fe.localName;customElements.whenDefined(_e).then((()=>ve.$flags$|=128))}if(we&&we.style){let be=we.style;"string"!=typeof be&&(ve.$modeName$=(fe=>dbe.map((ve=>ve(fe))).find((fe=>!!fe)))(fe),ve.$modeName$&&(be=be[ve.$modeName$]));const Se=getScopeId(_e,ve.$modeName$);if(!hbe.has(Se)){const fe=(_e.$tagName$,()=>{});((fe,ve,_e)=>{let be=hbe.get(fe);vbe&&_e?(be=be||new CSSStyleSheet,"string"==typeof be?be=ve:be.replaceSync(ve)):be=ve,hbe.set(fe,be)})(Se,be,!!(1&_e.$flags$)),fe()}}}ve.$ancestorComponent$;scheduleUpdate(ve,!0)},setContentReference=fe=>{const ve=fe["s-cr"]=fbe.createComment("");ve["s-cn"]=!0,insertBefore(fe,ve,fe.firstChild)},proxyCustomElement=(fe,ve)=>{const _e={$flags$:ve[0],$tagName$:ve[1]};_e.$members$=ve[2],_e.$listeners$=ve[3],_e.$watchers$=fe.$watchers$,_e.$attrsToReflect$=[];const be=fe.prototype.connectedCallback,we=fe.prototype.disconnectedCallback;return Object.assign(fe.prototype,{__registerHost(){registerHost(this,_e)},connectedCallback(){(fe=>{if(!(1&ybe.$flags$)){const ve=getHostRef(fe),_e=ve.$cmpMeta$,be=(_e.$tagName$,()=>{});1&ve.$flags$?(addHostEventListeners(fe,ve,_e.$listeners$),(null==ve?void 0:ve.$lazyInstance$)?ve.$lazyInstance$:(null==ve?void 0:ve.$onReadyPromise$)&&ve.$onReadyPromise$.then((()=>{ve.$lazyInstance$}))):(ve.$flags$|=1,12&_e.$flags$&&setContentReference(fe),_e.$members$&&Object.entries(_e.$members$).map((([ve,[_e]])=>{if(31&_e&&fe.hasOwnProperty(ve)){const _e=fe[ve];delete fe[ve],fe[ve]=_e}})),initializeComponent(fe,ve,_e)),be()}})(this),be&&be.call(this)},disconnectedCallback(){(async fe=>{if(!(1&ybe.$flags$)){const ve=getHostRef(fe);ve.$rmListeners$&&(ve.$rmListeners$.map((fe=>fe())),ve.$rmListeners$=void 0)}})(this),we&&we.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(16&_e.$flags$)})}}),fe.is=_e.$tagName$,proxyComponent(fe,_e)},Fragment=(fe,ve)=>ve,addHostEventListeners=(fe,ve,_e,be)=>{_e&&_e.map((([_e,be,we])=>{const Se=getHostListenerTarget(fe,_e),Te=hostListenerProxy(ve,we),Ee=hostListenerOpts(_e);ybe.ael(Se,be,Te,Ee),(ve.$rmListeners$=ve.$rmListeners$||[]).push((()=>ybe.rel(Se,be,Te,Ee)))}))},hostListenerProxy=(fe,ve)=>_e=>{try{G$e.lazyLoad||fe.$hostElement$[ve](_e)}catch(vr){consoleError(vr)}},getHostListenerTarget=(fe,ve)=>4&ve?fbe:8&ve?pbe:16&ve?fbe.body:fe,hostListenerOpts=fe=>gbe?{passive:!!(1&fe),capture:!!(2&fe)}:!!(2&fe),ube=new WeakMap,getHostRef=fe=>ube.get(fe),registerHost=(fe,ve)=>{const _e={$flags$:0,$hostElement$:fe,$cmpMeta$:ve,$instanceValues$:new Map};return addHostEventListeners(fe,_e,ve.$listeners$),ube.set(fe,_e)},isMemberInElement=(fe,ve)=>ve in fe,consoleError=(fe,ve)=>(0,console.error)(fe,ve),hbe=new Map,dbe=[],pbe="undefined"!=typeof window?window:{},fbe=pbe.document||{head:{}},mbe=pbe.HTMLElement||class{},ybe={$flags$:0,$resourcesUrl$:"",jmp:fe=>fe(),raf:fe=>requestAnimationFrame(fe),ael:(fe,ve,_e,be)=>fe.addEventListener(ve,_e,be),rel:(fe,ve,_e,be)=>fe.removeEventListener(ve,_e,be),ce:(fe,ve)=>new CustomEvent(fe,ve)},gbe=(()=>{let fe=!1;try{fbe.addEventListener("e",null,Object.defineProperty({},"passive",{get(){fe=!0}}))}catch(vr){}return fe})(),vbe=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch(vr){}return!1})(),_be=!1,$be=[],bbe=[],queueTask=(fe,ve)=>_e=>{fe.push(_e),_be||(_be=!0,ve&&4&ybe.$flags$?nextTick(flush):ybe.raf(flush))},consume=fe=>{for(let ve=0;ve<fe.length;ve++)try{fe[ve](performance.now())}catch(vr){consoleError(vr)}fe.length=0},flush=()=>{consume($be),consume(bbe),(_be=$be.length>0)&&ybe.raf(flush)},nextTick=fe=>{return Promise.resolve(ve).then(fe);var ve},wbe=queueTask($be,!1),xbe=queueTask(bbe,!0);
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.1
 */
function initModeChangeEvent(){const{classList:fe}=document.body,ve=window.matchMedia("(prefers-color-scheme: dark)").matches,getMode=()=>fe.contains(z$e)||fe.contains(N$e)&&ve?"dark":"light",emitModeChange=fe=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:fe}})),modeChangeHandler=fe=>{_e!==fe&&emitModeChange(fe),_e=fe};let _e=getMode();emitModeChange(_e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(fe=>modeChangeHandler(fe.matches?"dark":"light"))),new MutationObserver((()=>modeChangeHandler(getMode()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}let Sbe;function n$O(){try{getAssetPath(".")}catch{fe=_$1x(n$4t(Sbe)),ybe.$resourcesUrl$=fe}var fe}function r$j(fe){var ve;const _e=[];for(const be of Object.keys(fe))customElements.get(`calcite-${be}`)||_e.push(null==(ve=fe[be])?void 0:ve.call(fe));return _e.length>0?Promise.all(_e):null}(function appGlobalScript(){"undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document&&("interactive"===document.readyState?initModeChangeEvent():document.addEventListener("DOMContentLoaded",(()=>initModeChangeEvent()),{once:!0})),function stampVersion(){if(U$e&&U$e.version)return;const fe=U$e||globalThis.calciteConfig||{};Object.defineProperty(fe,"version",{value:B$e,writable:!1}),globalThis.calciteConfig=fe}()})(),Sbe="components/assets";const Tbe=Symbol("widget"),Ebe=Symbol("widget-test-data"),Pbe=[],Cbe={},Obe=new WeakMap;function d$s(fe,ve){let _e=ve.children;if(null==_e?void 0:_e.length)for(let we=0;we<_e.length;++we)_e[we]=d$s(fe,_e[we]);else _e=Pbe;const be=ve.vnodeSelector;if(f$o(be)){const we=ve.properties||Cbe,Se=we.key||be;return{vnodeSelector:"div",properties:{key:Se,afterCreate:s$E,afterUpdate:c$$,afterRemoved:a$P,parentWidget:fe,widgetConstructor:be,widgetProperties:{...we,key:Se,children:_e}},children:void 0,text:void 0,domNode:null}}return ve}function s$E(fe,ve,_e,{parentWidget:be,widgetConstructor:we,widgetProperties:Se}){var Te;const Ee=new we(Se);Ee.container=fe,Obe.set(fe,Ee),null==(Te=Ee.afterCreate)||Te.call(Ee,Ee,fe),be.addHandles(e$4e((()=>a$P(fe)))),queueMicrotask((()=>{Ee[Ebe].projector.renderNow()}))}function c$$(fe,ve,_e,{widgetProperties:be}){var we;const Se=Obe.get(fe);Se&&(Se.set(be),null==(we=Se.afterUpdate)||we.call(Se,Se,fe))}function a$P(fe){var ve;const _e=Obe.get(fe);_e&&(null==(ve=_e.afterRemoved)||ve.call(_e,_e,fe),_e.destroy(),Obe.delete(fe))}function f$o(fe){return"function"==typeof fe&&fe[Tbe]}const Abe=new Set;var Mbe;let Rbe=0;function W$2(fe,ve){const _e=Object.prototype.hasOwnProperty;for(const be in ve)_e.call(ve,be)&&_e.call(fe,be)&&(null!=fe[be]&&null!=ve[be]&&"object"==typeof fe[be]&&"object"==typeof ve[be]?W$2(fe[be],ve[be]):fe[be]=ve[be]);return fe}const Ibe=(fe=>{let ve;const _e={...I$e,...fe},be=(fe=>({...L$e,...fe}))(_e),we=be.performanceLogger;let Se,Te=!0,Ee=!1;const Ce=[],Oe=[],h33=(fe,Se,Te)=>{var Ee;let Re;be.eventHandlerInterceptor=(fe,be,Se,Te)=>function(fe){let be;we("domEvent",fe);const Se=((fe,ve)=>{const _e=[];for(;fe&&fe!==ve;)_e.push(fe),fe=fe.parentNode;return _e})(fe.currentTarget,Re.domNode),Te=Se.some((fe=>{var ve;return customElements.get(null==(ve=null==fe?void 0:fe.tagName)?void 0:ve.toLowerCase())}));if(fe.eventPhase!==Event.CAPTURING_PHASE&&Te){const ve=fe.composedPath(),_e=ve.slice(ve.indexOf(fe.currentTarget),ve.indexOf(Re.domNode)).reverse();be=d$t(Re.getLastRender(),_e,!0)}else Se.reverse(),be=d$t(Re.getLastRender(),Se);let Ee;return be&&(Ee=_e.handleInterceptedEvent(ve,be,this,fe)),we("domEventProcessed",fe),Ee},null==(Ee=_e.postProcessProjectionOptions)||Ee.call(_e,be);const De=Te();Re=fe(Se,De,be),be.eventHandlerInterceptor=void 0,Ce.push(Re),Oe.push(Te),_e.afterFirstVNodeRendered&&_e.afterFirstVNodeRendered(Re,De)};let v17=()=>{if(Se=void 0,Te){Te=!1,we("renderStart",void 0);for(let fe=0;fe<Ce.length;fe++){const ve=Oe[fe]();we("rendered",void 0),Ce[fe].update(ve),we("patched",void 0)}we("renderDone",void 0),Te=!0}};return _e.modifyDoRenderImplementation&&(v17=_e.modifyDoRenderImplementation(v17,Ce,Oe)),ve={renderNow:v17,scheduleRender:()=>{Se||Ee||(Se=requestAnimationFrame(v17))},stop:()=>{Se&&(cancelAnimationFrame(Se),Se=void 0),Ee=!0},resume:()=>{Ee=!1,Te=!0,ve.scheduleRender()},append:(fe,ve)=>{h33(n$3$_append,fe,ve)},insertBefore:(fe,ve)=>{h33(n$3$_insertBefore,fe,ve)},merge:(fe,ve)=>{h33(n$3$_merge,fe,ve)},replace:(fe,ve)=>{h33(n$3$_replace,fe,ve)},detach:fe=>{for(let ve=0;ve<Oe.length;ve++)if(Oe[ve]===fe)return Oe.splice(ve,1),Ce.splice(ve,1)[0];throw new Error("renderFunction was not found")}},ve})({postProcessProjectionOptions(fe){const ve=fe.eventHandlerInterceptor,_e=/capture$/i;fe.eventHandlerInterceptor=(fe,be,we,Se)=>{const Te=null==ve?void 0:ve(fe,be,we,Se),Ee=_e.test(fe);if(!((fe=fe.replace(_e,"")).toLowerCase()in we)||Ee){const ve=fe[2].toLowerCase()+fe.slice(3),r66=fe=>null==Te?void 0:Te.call(we,fe);we.addEventListener(ve,r66,Ee);const s85=()=>we.removeEventListener(ve,r66,Ee),_e=Se.afterRemoved;Se.afterRemoved=fe=>{null==_e||_e(fe),s85()}}return Te}},handleInterceptedEvent(fe,ve,_e,be){const{eventPhase:we,type:Se}=be,Te=we===Event.CAPTURING_PHASE;let Ee=`on${Se}${Te?"capture":""}`;const Ce=ve.properties;(Ce&&Ee in Ce||(Ee=`on${Se[0].toUpperCase()}${Se.slice(1)}${Te?"Capture":""}`,Ce&&Ee in Ce))&&(t$3G(),fe.scheduleRender(),Ce[Ee].call(Ce.bind||_e,be))}});let Lbe=!1,Dbe=class O12 extends(n$3T(La.EventedAccessor)){constructor(fe,ve){super(fe,ve),this._attached=!1,this._projector=Ibe,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=k$1C((async()=>{var fe;if(null==(fe=this._messageBundleProps)?void 0:fe.length){const fe=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:fe,propertyName:ve})=>{if(this.destroyed)return;let _e=await h$2D(fe);this.uiStrings&&Object.keys(this.uiStrings)&&(_e=W$2(a$4H(_e),this.uiStrings)),this[ve]=_e})));if(this.destroyed)return;for(const ve of fe)"rejected"===ve.status&&ar.getLogger(this).error("widget-intl:locale-error",this.declaredClass,ve.reason)}await this.loadLocale()})),n$O();const _e="esri-widget-uid-"+n$Q(),be=this.render.bind(this);this._trackingTarget=new yi((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const o39=()=>({vnodeSelector:"div",properties:{key:`${_e}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),i52=()=>{var fe,ve;if(!this._readyForTrueRender||this.destroyed)return null;const we=be()??o39(),Se=we.properties??(we.properties={});if(Se.key??(Se.key=_e),f$o(we.vnodeSelector)){if(!this.visible)return o39()}else this.visible?Se.styles||(Se.styles={}):(Se.class="",Se.styles={display:"none"}),(fe=Se.styles).display??(fe.display="");let Te=0;return null==(ve=we.children)||ve.forEach((fe=>{var ve;f$o(fe.vnodeSelector)||(fe.properties??(fe.properties={}),(ve=fe.properties).key??(ve.key=`${this.id}--${Te++}`))})),d$s(this,we)};this.render=()=>{if(Lbe)return i52();let fe=function e$3z(fe){return Cf.get(fe)}(this)??null;if(fe)return fe;this._trackingTarget.clear(),Lbe=!0;try{fe=f$3w(this._trackingTarget,i52)}catch(ve){throw ar.getLogger(this).error(ve),ve}finally{Lbe=!1}return fe&&function c$4c(fe,ve){Cf.set(fe,ve)}(this,fe),fe};const we=this.beforeFirstRender();we?this._resourcesFetch=we.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),function n$M(fe){Abe.add(fe),fe.finally((()=>Abe.delete(fe)))}(this._resourcesFetch)}normalizeCtorArgs(fe,ve){const _e={...fe};return ve&&(_e.container=ve),_e}postInitialize(){}beforeFirstRender(){var fe;const ve=this.loadDependencies();return(null==(fe=this._messageBundleProps)?void 0:fe.length)||ve?Promise.all([ve,this._loadLocale()]).then((()=>{})).catch(f$3u):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(u$4d(this._trackingTarget),u$4d(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,o$3u(this))}set container(fe){this._get("container")||this._set("container",fe)}castContainer(fe){return e$3O(fe)}get domNode(){return this.container}set domNode(fe){this.container=fe}get icon(){return null}set icon(fe){this._overrideIfSome("icon",fe)}get id(){var fe;return this._get("id")||(null==(fe=this.container)?void 0:fe.id)||Date.now().toString(16)+"-widget-"+Rbe++}set id(fe){fe&&this._set("id",fe)}get label(){return this.declaredClass.split(".").pop()}set label(fe){this._overrideIfSome("label",fe)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(fe){this._set("visible",fe)}get[(Mbe=Tbe,Ebe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(o$3u(this),this._projector.scheduleRender())}own(fe){t$4y(ar.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(fe)}classes(...fe){return f$2H.apply(this,fe)}renderNow(){o$3u(this),this._projector.renderNow()}_postInitialize(){var fe;if(this.destroyed)return;this.scheduleRender(),(null==(fe=this._delegatedEventNames)?void 0:fe.length)&&this.addHandles(d$3d((()=>this.viewModel),((fe,ve)=>{ve&&this.removeHandles("delegated-events"),fe&&n$4I(fe)&&this.addHandles(this._delegatedEventNames.map((ve=>o$4e(fe,ve,(fe=>{this.emit(ve,fe)})))),"delegated-events")}),Ja)),this.postInitialize();const e76=async()=>{await this._loadLocale().catch(f$3u),this.scheduleRender()};this.addHandles([f$2W(e76),d$3d((()=>this.uiStrings),e76),p$4J((()=>this.container),(fe=>{this.destroyed||this._attach(fe)}),{initial:!0,once:!0})])}_attach(fe){fe&&(this._projector.merge(fe,this.render),this._attached=!0)}_detach(fe){var ve;this._attached&&(this._projector.detach(this.render),this._attached=!1),null==(ve=null==fe?void 0:fe.parentNode)||ve.removeChild(fe)}};Dbe[Mbe]=!0,e$4o([y$2v()],Dbe.prototype,"_readyForTrueRender",void 0),e$4o([y$2v({value:null})],Dbe.prototype,"container",null),e$4o([s$4b("container")],Dbe.prototype,"castContainer",null),e$4o([y$2v()],Dbe.prototype,"icon",null),e$4o([y$2v()],Dbe.prototype,"id",null),e$4o([y$2v()],Dbe.prototype,"label",null),e$4o([y$2v()],Dbe.prototype,"renderable",null),e$4o([y$2v()],Dbe.prototype,"uiStrings",void 0),e$4o([y$2v()],Dbe.prototype,"viewModel",void 0),e$4o([y$2v({value:!0})],Dbe.prototype,"visible",null),e$4o([y$2v()],Dbe.prototype,"key",void 0),e$4o([y$2v()],Dbe.prototype,"children",void 0),e$4o([y$2v()],Dbe.prototype,"afterCreate",void 0),e$4o([y$2v()],Dbe.prototype,"afterUpdate",void 0),e$4o([y$2v()],Dbe.prototype,"afterRemoved",void 0),Dbe=e$4o([a$4y("esri.widgets.Widget")],Dbe);const Nbe=Dbe;let Fbe,zbe=null;const kbe=new Map;async function i$O(fe){null==zbe&&(null==Fbe&&(Fbe=zt((()=>import("./Lyr3DWasmPerSceneView-w0kAfvDk.js")),__vite__mapDeps([196,62,71,63,115]))),zbe=await Fbe);const ve=fe.view;let _e=kbe.get(ve);return _e||(_e=new zbe.default({view:ve}),kbe.set(ve,_e)),await _e.initializeWasm(),_e.add3DTilesLayerView(fe)}function l$M(fe){return kbe.get(fe)}function a$O(fe){const ve=fe.view,_e=kbe.get(ve);_e&&_e.remove3DTilesLayerView(fe)<1&&(kbe.delete(ve),0===kbe.size&&(Fbe=null,zbe=null))}function f$n(fe,ve){return fe&&"copyright"in fe&&(!ve||"function"==typeof fe.originOf&&"user"===fe.originOf("copyright"))}function b$b(fe,ve,_e){_e&&ve&&(fe.find((fe=>fe.layerView===ve&&fe.text===_e))||fe.push({text:_e,layerView:ve}))}const Ube=[];let Vbe=class _18 extends zi{constructor(fe){super(fe),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Wa,this.view=null,this._allLayerViewsChange=fe=>{var ve;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const _e=null==(ve=this.view)?void 0:ve.allLayerViews;_e&&(this.addHandles(_e.map((fe=>d$3d((()=>{var ve;return[fe.suspended,null==(ve=fe.layer)?void 0:ve.attributionVisible]}),(()=>this._updateAttributionItems())))).toArray(),"suspension"),_e.forEach((fe=>{"esri.views.3d.layers.Tiles3DLayerView3D"===fe.declaredClass&&this.addHandles(fe.on("visible-geometry-changed",(()=>this._updateAttributionItems())),"visible-geometry-changed")}))),(null==fe?void 0:fe.removed)&&fe.removed.forEach((fe=>{this._pendingAttributions.delete(fe),this._fetchedAttributionData.delete(fe)})),this._updateAttributionItems()},this.addHandles([v$1W((()=>{var fe;return null==(fe=this.view)?void 0:fe.allLayerViews}),"change",(fe=>this._allLayerViewsChange(fe)),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),p$4J((()=>{var fe;return!0===(null==(fe=this.view)?void 0:fe.stationary)}),(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var fe;return(null==(fe=this.view)?void 0:fe.ready)?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const fe=this.view,ve=null==fe?void 0:fe.allLayerViews;if(Ube.length=0,!fe||!ve)return void this._clear();ve.forEach((ve=>{var _e,be;if(ve.suspended||!(null==(_e=ve.layer)?void 0:_e.attributionVisible))return;const we=ve.layer;if(f$n(we,"user"))return void b$b(Ube,ve,we.copyright);if(we.hasAttributionData){if(this._fetchedAttributionData.has(ve)){const _e=this._fetchedAttributionData.get(ve);return void(_e?b$b(Ube,ve,this._getDynamicAttribution(_e,fe,we)):f$n(we)&&b$b(Ube,ve,we.copyright))}return void this._fetchAttributionData(ve)}const Se="portalItem"in we?null==(be=we.portalItem)?void 0:be.accessInformation:void 0;b$b(Ube,ve,Se||we.copyright)}));const _e=ve.find((fe=>{var ve;return"integrated-mesh-3dtiles"===(null==(ve=fe.layer)?void 0:ve.type)}));if(this.view&&_e){const fe=l$M(this.view);if(fe){const ve=fe.getAttributionText();for(let fe=0;fe<ve.length;++fe)b$b(Ube,_e,ve[fe])}}(function y$j(fe,ve){return fe.length!==ve.length||fe.some(((fe,_e)=>fe.text!==ve[_e].text))})(this.items,Ube)&&(this.items.removeAll(),this.items.addMany(Ube)),Ube.length=0,this.notifyChange("state")}async _fetchAttributionData(fe){if(this._pendingAttributions.has(fe))return;this._pendingAttributions.add(fe);const ve=await _$1s(fe.layer.fetchAttributionData());if(this._pendingAttributions.has(fe)){const _e=ve.ok?this._createContributionIndex(ve.value,function g$j(fe){return"bing-maps"===fe.type}(fe.layer)):null;this._pendingAttributions.delete(fe),this._fetchedAttributionData.set(fe,_e)}this._updateAttributionItems()}_createContributionIndex(fe,ve){const _e=fe.contributors,be={};if(!_e)return be;for(let we=0;we<_e.length;we++){const fe=_e[we],Se=fe.coverageAreas;if(!Se)return;for(const _e of Se){const Se=_e.bbox,Te=_e.zoomMin-(ve&&_e.zoomMin?1:0),Ee=_e.zoomMax-(ve&&_e.zoomMax?1:0),Ce={extent:d$3l(new aa({xmin:Se[1],ymin:Se[0],xmax:Se[3],ymax:Se[2],spatialReference:zo.WGS84})),attribution:fe.attribution||"",score:null!=_e.score?_e.score:100,id:we};for(let fe=Te;fe<=Ee;fe++)be[fe]??(be[fe]=[]),be[fe].push(Ce)}}return be.maxKey=Math.max.apply(null,Object.keys(be)),be}_getDynamicAttribution(fe,ve,_e){var be;const{extent:we,scale:Se}=ve;let Te=(null==(be=_e.tileInfo)?void 0:be.scaleToZoom(Se))??0;if(Te=Math.min(fe.maxKey??0,Math.round(Te)),!we||null==Te||Te<=-1)return"";const Ee=fe[Te],Ce=g$2s(we.center.clone().normalize(),ve.spatialReference),Oe=new Set;return Ee?Ee.filter((fe=>{const ve=fe.id,_e=!Oe.has(ve)&&Ce&&fe.extent&&t$3Z(fe.extent,Ce);return _e&&Oe.add(ve),_e})).sort(((fe,ve)=>ve.score-fe.score||fe.objectId-ve.objectId)).map((fe=>fe.attribution)).join(", "):""}};e$4o([y$2v({readOnly:!0,type:Wa})],Vbe.prototype,"items",void 0),e$4o([y$2v({readOnly:!0})],Vbe.prototype,"state",null),e$4o([y$2v()],Vbe.prototype,"view",void 0),Vbe=e$4o([a$4y("esri.widgets.Attribution.AttributionViewModel")],Vbe);const Bbe=Vbe,jbe={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function r$i(fe){return function(ve,..._e){!function e$o(fe){const ve=null==fe?void 0:fe.type;return fe instanceof KeyboardEvent||"keyup"===ve||"keydown"===ve||"keypress"===ve}(ve)?fe.call(this,ve,..._e):function k$1h(fe){return"Enter"===fe||" "===fe}(ve.key)&&(ve.preventDefault(),ve.stopPropagation(),ve.target.click())}}function e$n(fe){return(ve,_e)=>{ve.hasOwnProperty("_messageBundleProps")||(ve._messageBundleProps=ve._messageBundleProps?ve._messageBundleProps.slice():[]),ve._messageBundleProps.push({bundlePath:fe,propertyName:_e})}}var e$m=function(fe){return{vnodeSelector:"",properties:void 0,children:void 0,text:fe.toString(),domNode:null}},o$j=function(fe,ve){for(var _e=0,be=fe.length;_e<be;_e++){var we=fe[_e];Array.isArray(we)?o$j(we,ve):null!=we&&!1!==we&&(we.hasOwnProperty("vnodeSelector")||(we=e$m(we)),ve.push(we))}};function n$K(fe,ve,..._e){return"function"!=typeof fe||f$o(fe)?function(fe,ve){for(var _e=[],be=2;be<arguments.length;be++)_e[be-2]=arguments[be];if(1===_e.length&&"string"==typeof _e[0])return{vnodeSelector:fe,properties:ve||void 0,children:void 0,text:_e[0],domNode:null};var we=[];return o$j(_e,we),{vnodeSelector:fe,properties:ve||void 0,children:we,text:void 0,domNode:null}}(fe,ve,..._e):fe(ve,..._e)}function i$N(...fe){return fe}const Gbe="esri-attribution",Hbe={base:Gbe,poweredBy:`${Gbe}__powered-by`,sources:`${Gbe}__sources`,open:`${Gbe}--open`,sourcesOpen:`${Gbe}__sources--open`,link:`${Gbe}__link`};let qbe=class h29 extends Nbe{constructor(fe,ve){super(fe,ve),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver((fe=>fe.forEach((({target:fe})=>this._checkSourceTextOverflow(fe))))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Bbe}initialize(){this.addHandles(v$1W((()=>{var fe;return null==(fe=this.viewModel)?void 0:fe.items}),"change",(()=>this.scheduleRender())))}destroy(){var fe;null==(fe=this._resizeObserver)||fe.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((fe,ve)=>(fe.includes(ve.text)||fe.push(ve.text),fe)),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(fe){this._overrideIfSome("icon",fe)}get label(){var fe;return(null==(fe=this.messages)?void 0:fe.widgetLabel)??""}set label(fe){this._overrideIfSome("label",fe)}get view(){return this.viewModel.view}set view(fe){this.viewModel.view=fe}render(){const fe={[Hbe.open]:this._isOpen};return n$K("div",{bind:this,class:this.classes(Hbe.base,jbe.widget,fe),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return n$K("div",{class:Hbe.poweredBy},"Powered by"," ",n$K("a",{class:Hbe.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const fe=this._isOpen,ve=this._isInteractive,_e=ve?0:void 0,{attributionText:be}=this,we={[Hbe.sourcesOpen]:fe,[jbe.interactive]:ve};return n$K("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Hbe.sources,we),innerHTML:be,tabIndex:_e})}_afterSourcesNodeCreate(fe){this._prevSourceNodeHeight=fe.clientWidth,this._resizeObserver.observe(fe)}_checkSourceTextOverflow(fe){let ve=!1;const{clientHeight:_e,clientWidth:be,scrollWidth:we}=fe,Se=we>be,Te=this._attributionTextOverflowed!==Se;if(this._attributionTextOverflowed=Se,Te&&(ve=!0),this._isOpen){const fe=_e<this._prevSourceNodeHeight;this._prevSourceNodeHeight=_e,fe&&(this._isOpen=!1,ve=!0)}ve&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};e$4o([y$2v()],qbe.prototype,"_isOpen",void 0),e$4o([y$2v()],qbe.prototype,"_isInteractive",null),e$4o([y$2v()],qbe.prototype,"_attributionTextOverflowed",void 0),e$4o([y$2v()],qbe.prototype,"_prevSourceNodeHeight",void 0),e$4o([y$2v({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],qbe.prototype,"attributionText",null),e$4o([y$2v()],qbe.prototype,"icon",null),e$4o([y$2v()],qbe.prototype,"itemDelimiter",void 0),e$4o([y$2v()],qbe.prototype,"label",null),e$4o([y$2v(),e$n("esri/widgets/Attribution/t9n/Attribution")],qbe.prototype,"messages",void 0),e$4o([y$2v()],qbe.prototype,"view",null),e$4o([y$2v({type:Bbe})],qbe.prototype,"viewModel",void 0),e$4o([function t$x(){return function(fe,ve){if(!fe[ve])throw new TypeError(`Cannot auto bind undefined function '${String(ve)}'`);return{value:r$i(fe[ve])}}}()],qbe.prototype,"_toggleState",null),qbe=e$4o([a$4y("esri.widgets.Attribution")],qbe);const Wbe=qbe;const t$v=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.goToOverride=null,this.view=null}callGoTo(fe){const{view:ve}=this;return n$4O(ve),this.goToOverride?this.goToOverride(ve,fe):ve.goTo(fe.target,fe.options)}};return e$4o([y$2v()],ve.prototype,"goToOverride",void 0),e$4o([y$2v()],ve.prototype,"view",void 0),ve=e$4o([a$4y("esri.widgets.support.GoTo")],ve),ve};let Ybe=class d31 extends(t$v(zi)){constructor(fe){super(fe),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(d$3d((()=>this.view),this._updateRotationWatcher,Xa))}destroy(){this.view=null}get canShowNorth(){return function e$l(fe){var ve,_e;return(null==(ve=null==fe?void 0:fe.spatialReference)?void 0:ve.isWebMercator)||(null==(_e=null==fe?void 0:fe.spatialReference)?void 0:_e.isGeographic)||!1}(this.view)}get state(){var fe;return!(null==(fe=this.view)?void 0:fe.ready)||"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var fe,ve;(null==(fe=this.view)?void 0:fe.ready)&&("2d"===(null==(ve=this.view)?void 0:ve.type)?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:has("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(fe){null!=fe&&this._set("orientation",{z:fe})}_updateForCamera(fe){if(!fe)return;const ve=-fe.heading;this._set("orientation",{x:0,y:0,z:ve})}_updateRotationWatcher(fe){this.removeAllHandles(),fe&&this.addHandles("2d"===fe.type?d$3d((()=>null==fe?void 0:fe.rotation),this._updateForRotation,Xa):d$3d((()=>null==fe?void 0:fe.camera),this._updateForCamera,Xa))}};e$4o([y$2v({readOnly:!0})],Ybe.prototype,"canShowNorth",null),e$4o([y$2v({readOnly:!0})],Ybe.prototype,"orientation",void 0),e$4o([y$2v({readOnly:!0})],Ybe.prototype,"state",null),e$4o([y$2v()],Ybe.prototype,"view",void 0),Ybe=e$4o([a$4y("esri.widgets.Compass.CompassViewModel")],Ybe);const Zbe=Ybe,Xbe="esri-compass",Jbe={base:Xbe,iconContainer:`${Xbe}__icon-container`};let Qbe=class c40 extends Nbe{constructor(fe,ve){super(fe,ve),this.messages=null,this.viewModel=new Zbe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=fe=>({transform:`rotateZ(${fe.z}deg)`})}loadDependencies(){return r$j({button:()=>zt((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209])),icon:()=>zt((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([210,208,199,200,207]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(fe){this.viewModel.goToOverride=fe}get icon(){return"rotation"===this.viewModel.state?"arrow-up":"compass-needle"}set icon(fe){this._overrideIfSome("icon",fe)}get label(){var fe;return(null==(fe=this.messages)?void 0:fe.widgetLabel)??""}set label(fe){this._overrideIfSome("label",fe)}get view(){return this.viewModel.view}set view(fe){this.viewModel.view=fe}reset(){return this.viewModel.reset()}render(){const{orientation:fe,state:ve}=this.viewModel,{messages:_e}=this;return n$K("div",{class:this.classes(Jbe.base,jbe.widget)},n$K("calcite-button",{class:jbe.widgetButton,disabled:"disabled"===ve,kind:"neutral",label:_e.reset,onclick:this._reset,round:!0,scale:"s",title:_e.reset},n$K("div",{"aria-hidden":"true",class:Jbe.iconContainer,title:_e.reset},n$K("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(fe)}))))}};e$4o([y$2v()],Qbe.prototype,"goToOverride",null),e$4o([y$2v()],Qbe.prototype,"icon",null),e$4o([y$2v()],Qbe.prototype,"label",null),e$4o([y$2v(),e$n("esri/widgets/Compass/t9n/Compass")],Qbe.prototype,"messages",void 0),e$4o([y$2v()],Qbe.prototype,"view",null),e$4o([y$2v({type:Zbe})],Qbe.prototype,"viewModel",void 0),Qbe=e$4o([a$4y("esri.widgets.Compass")],Qbe);const Kbe=Qbe,ewe="esri-navigation-toggle",twe=ewe,rwe=`${ewe}--horizontal`;let iwe=class s80 extends zi{constructor(fe){super(fe),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(p$4J((()=>{var fe;return null==(fe=this.view)?void 0:fe.inputManager}),(()=>this._setNavigationMode())))}destroy(){this.view=null}get state(){var fe,ve;return(null==(fe=this.view)?void 0:fe.ready)&&"3d"===(null==(ve=this.view)?void 0:ve.type)?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(fe){this._navigationMode=fe,this._setNavigationMode()}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate")}_setNavigationMode(){var fe;const ve=null==(fe=this.view)?void 0:fe.inputManager;ve&&(ve.primaryDragAction="pan"===this._navigationMode?"pan":"rotate")}};e$4o([y$2v({readOnly:!0})],iwe.prototype,"state",null),e$4o([y$2v()],iwe.prototype,"_navigationMode",void 0),e$4o([y$2v()],iwe.prototype,"view",void 0),iwe=e$4o([a$4y("esri.widgets.NavigationToggle.NavigationToggleViewModel")],iwe);const nwe=iwe;let swe=class c41 extends Nbe{constructor(fe,ve){super(fe,ve),this.messages=null,this.viewModel=new nwe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var fe;const ve="pan"===(null==(fe=this.viewModel)?void 0:fe.navigationMode)?this._rotateButton:this._panButton;null==ve||ve.setFocus(),this.toggle()}}loadDependencies(){return r$j({button:()=>zt((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209]))})}get icon(){return"move"}set icon(fe){this._overrideIfSome("icon",fe)}get label(){var fe;return(null==(fe=this.messages)?void 0:fe.widgetLabel)??""}set label(fe){this._overrideIfSome("label",fe)}set layout(fe){"horizontal"!==fe&&(fe="vertical"),this._set("layout",fe)}get view(){return this.viewModel.view}set view(fe){this.viewModel.view=fe}render(){var fe,ve;const _e="disabled"===(null==(fe=this.viewModel)?void 0:fe.state),be="pan"===(null==(ve=this.viewModel)?void 0:ve.navigationMode),we=this.messages.toggle;return n$K("div",{class:this.classes(twe,jbe.widget,{[rwe]:"horizontal"===this.layout})},n$K("calcite-button",{afterCreate:fe=>{this._panButton=fe},appearance:be?"outline-fill":"solid",class:jbe.widgetButton,disabled:_e,iconStart:"move",kind:"neutral",label:we,onclick:this._toggle,tabIndex:be?void 0:-1,title:we}),n$K("calcite-button",{afterCreate:fe=>{this._rotateButton=fe},appearance:be?"solid":"outline-fill",class:jbe.widgetButton,disabled:_e,iconStart:"rotate",kind:"neutral",label:we,onclick:this._toggle,tabIndex:be?-1:void 0,title:we}))}};e$4o([y$2v()],swe.prototype,"icon",null),e$4o([y$2v()],swe.prototype,"label",null),e$4o([y$2v({value:"vertical"})],swe.prototype,"layout",null),e$4o([y$2v(),e$n("esri/widgets/NavigationToggle/t9n/NavigationToggle")],swe.prototype,"messages",void 0),e$4o([y$2v()],swe.prototype,"view",null),e$4o([y$2v({type:nwe})],swe.prototype,"viewModel",void 0),swe=e$4o([a$4y("esri.widgets.NavigationToggle")],swe);const owe=swe;let awe=class r61 extends zi{get canZoomIn(){var fe,ve,_e;if(!(null==(fe=this.view)?void 0:fe.ready))return!1;const be=null==(_e=null==(ve=this.view)?void 0:ve.constraints)?void 0:_e.effectiveMaxScale;return 0===be||this._scale>be}get canZoomOut(){var fe;const{view:ve}=this;if(!(null==ve?void 0:ve.ready))return!1;const _e=null==(fe=ve.constraints)?void 0:fe.effectiveMinScale;return 0===_e||this._scale<_e}get _scale(){var fe,ve,_e;const be=null==(ve=null==(fe=this.view)?void 0:fe.animation)?void 0:ve.target;return(be&&"then"in be||null==be?void 0:be.scale)??(null==(_e=this.view)?void 0:_e.scale)??0}};e$4o([y$2v({readOnly:!0})],awe.prototype,"canZoomIn",null),e$4o([y$2v({readOnly:!0})],awe.prototype,"canZoomOut",null),e$4o([y$2v()],awe.prototype,"view",void 0),e$4o([y$2v()],awe.prototype,"_scale",null),awe=e$4o([a$4y("esri.widgets.Zoom.ZoomConditions2D")],awe);const lwe=awe;let cwe=class s81 extends zi{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};e$4o([y$2v({readOnly:!0})],cwe.prototype,"canZoomIn",null),e$4o([y$2v({readOnly:!0})],cwe.prototype,"canZoomOut",null),e$4o([y$2v()],cwe.prototype,"view",void 0),cwe=e$4o([a$4y("esri.widgets.Zoom.ZoomConditions3D")],cwe);const uwe=cwe;let hwe=class m33 extends zi{constructor(fe){super(fe)}destroy(){this.view=null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){var fe;return null!=this._zoomConditions&&(null==(fe=this._zoomConditions)?void 0:fe.canZoomOut)}get state(){var fe;return(null==(fe=this.view)?void 0:fe.ready)?"ready":"disabled"}set view(fe){fe?"2d"===fe.type?this._zoomConditions=new lwe({view:fe}):"3d"===fe.type&&(this._zoomConditions=new uwe({view:fe})):this._zoomConditions=null,this._set("view",fe)}zoomIn(){if(!this.canZoomIn)return;const fe=this.view;"2d"===fe.type?fe.mapViewNavigation.zoomIn():d$3z(fe.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const fe=this.view;"2d"===fe.type?fe.mapViewNavigation.zoomOut():d$3z(fe.goTo({zoomFactor:.5}))}};e$4o([y$2v()],hwe.prototype,"_zoomConditions",void 0),e$4o([y$2v()],hwe.prototype,"canZoomIn",null),e$4o([y$2v()],hwe.prototype,"canZoomOut",null),e$4o([y$2v({readOnly:!0})],hwe.prototype,"state",null),e$4o([y$2v()],hwe.prototype,"view",null),hwe=e$4o([a$4y("esri.widgets.Zoom.ZoomViewModel")],hwe);const dwe=hwe,pwe="esri-zoom",fwe="esri-zoom--horizontal";let mwe=class c42 extends Nbe{constructor(fe,ve){super(fe,ve),this.messages=null,this.viewModel=new dwe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return r$j({button:()=>zt((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209]))})}get icon(){return"magnifying-glass-plus"}set icon(fe){this._overrideIfSome("icon",fe)}get label(){var fe;return(null==(fe=this.messages)?void 0:fe.widgetLabel)??""}set label(fe){this._overrideIfSome("label",fe)}set layout(fe){"horizontal"!==fe&&(fe="vertical"),this._set("layout",fe)}set view(fe){this.viewModel.view=fe}get view(){return this.viewModel.view}render(){const fe={[fwe]:"horizontal"===this.layout},{canZoomIn:ve,canZoomOut:_e}=this.viewModel,{zoomIn:be,zoomOut:we}=this.messages;return n$K("div",{class:this.classes(pwe,jbe.widget,fe)},n$K("calcite-button",{class:jbe.widgetButton,disabled:!ve,iconStart:"plus",kind:"neutral",label:be,onclick:this.zoomIn,title:be}),n$K("calcite-button",{class:jbe.widgetButton,disabled:!_e,iconStart:"minus",kind:"neutral",label:we,onclick:this.zoomOut,title:we}))}};e$4o([y$2v()],mwe.prototype,"icon",null),e$4o([y$2v()],mwe.prototype,"label",null),e$4o([y$2v({value:"vertical"})],mwe.prototype,"layout",null),e$4o([y$2v(),e$n("esri/widgets/Zoom/t9n/Zoom")],mwe.prototype,"messages",void 0),e$4o([y$2v()],mwe.prototype,"view",null),e$4o([y$2v({type:dwe})],mwe.prototype,"viewModel",void 0),mwe=e$4o([a$4y("esri.widgets.Zoom")],mwe);const ywe=mwe;let gwe=class h30 extends O$e{constructor(fe){super(fe),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=fe=>{this.components.forEach((ve=>{const _e=this._find(ve),be=null==_e?void 0:_e.widget;(function m$z(fe){return void 0!==(null==fe?void 0:fe.view)})(be)&&(be.view=fe)}))},this._componentsWatcher=(fe,ve)=>{this._removeComponents(ve),this._addComponents(fe),this._adjustPadding(fe)}}initialize(){this.addHandles([d$3d((()=>this.components),this._componentsWatcher,Xa),d$3d((()=>this.view),this._updateViewAwareWidgets,Xa)])}_add(fe,ve,_e,be,we){let Se=fe;if("string"==typeof fe&&this._defaultPositionLookup[fe]){if(this._find(fe))return;Se=this._createComponent(fe)}super._add(Se,ve,_e,be,we)}_removeComponents(fe){fe.forEach((fe=>{const ve=this._find(fe);ve&&(this.remove(ve),ve.destroy())}))}_adjustPadding(fe){if(!fe.includes("attribution")&&!this._isOverridden("padding")){const{top:fe}=this.padding;this.padding=fe}}_addComponents(fe){this.constructed&&fe.forEach((fe=>this.add(this._createComponent(fe),this._defaultPositionLookup[fe])))}_createComponent(fe){const ve=this._createWidget(fe);return new v$e({id:fe,node:ve})}_createWidget(fe){const ve=this.view;switch(fe){case"attribution":return new Wbe({view:ve});case"compass":return new Kbe({view:ve});case"navigation-toggle":return new owe({view:ve});case"zoom":return new ywe({view:ve})}}};e$4o([y$2v()],gwe.prototype,"components",void 0),gwe=e$4o([a$4y("esri.views.ui.DefaultUI")],gwe);const vwe=gwe;let _we=class e69 extends vwe{constructor(fe){super(fe),this.components=["attribution","zoom","navigation-toggle","compass"]}};e$4o([y$2v()],_we.prototype,"components",void 0),_we=e$4o([a$4y("esri.views.ui.3d.DefaultUI3D")],_we);const $we=_we;let bwe=class tt3 extends(o$3v(y$1Q(H$Z(TP)))){constructor(fe){super(fe),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new ev({slicePlane:op},this),this._resourceController=function j$q(fe){return new $ce({view:fe})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new cG({view:this}),this.labeler=new Ioe({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Fp,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new jP,this.environment=new zC,this.environmentManager=new EF,this.floors=new Wa,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new IP({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new cle,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new $we,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Vle,function m$3p(){g$2f()}();const t84=(fe=null)=>{null!=fe&&fe.type===Da.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach((async fe=>{try{await fe.when()}catch{}this._updatingChanged()})))};this.addHandles([v$1W((()=>{var fe;return null==(fe=this.map)?void 0:fe.allLayers}),"after-changes",(fe=>t84(fe)),{onListenerAdd:()=>t84(),onListenerRemove:()=>t84(),sync:!0}),this.allLayerViews.on("after-changes",(fe=>this._updateUpdatingMonitors(fe))),d$3d((()=>this.map),(fe=>{fe&&"load"in fe&&fe.load&&fe.load().catch((()=>{}))}))]),this.inputManager=new gB({view:this}),this.stateManager=new SU({view:this})}initialize(){this.groundView=new Kg({view:this}),this._updateUpdatingMonitors();const e76=()=>this._updateDefaultToMapOptions();this.addHandles(v$1W((()=>{var fe;return null==(fe=this.map)?void 0:fe.allLayers}),"after-changes",e76,{onListenerAdd:e76,onListenerRemove:e76})),this.updatingHandles.add((()=>this.qualitySettings.memoryLimit),(fe=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=fe)}),Xa),this.updatingHandles.add((()=>this.qualitySettings.additionalCacheMemory),(fe=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=fe)}),Xa),this.updatingHandles.add((()=>this.qualitySettings.frameRate??0),(fe=>function j$1U(fe){Yr=Math.max(0,fe)}(fe>0?1e3/Math.ceil(fe):0)),Xa),this.updatingHandles.add((()=>{var fe;return null==(fe=this.map)?void 0:fe.ground}),e76,Ja),this.updatingHandles.add((()=>{var fe,ve;return null==(ve=null==(fe=this.map)?void 0:fe.ground)?void 0:ve.opacity}),(()=>this._updateDefaultHitTestOptions()),Ja),this.addHandles(d$3d((()=>this.spatialReference),(()=>this.notifyChange("clippingArea")),Za))}destroy(){var fe;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=u$4d(this.sharedSymbolResources),this._set("labeler",u$4d(this.labeler)),this._set("deconflictor",u$4d(this.deconflictor)),this._resourceController=u$4d(this._resourceController),this._set("stateManager",u$4d(this.stateManager)),this._set("inputManager",u$4d(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",u$4d(this.environmentManager)),this._set("environment",u$4d(this.environment)),this.groundView=u$4d(this.groundView),this._exitBasemapTerrain(),null==(fe=this._stage)||fe.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var fe;return null==(fe=this.basemapTerrain)?void 0:fe.spatialReference}get animation(){var fe;return null==(fe=this.state)?void 0:fe.animation}get camera(){var fe;return null==(fe=this.stateManager)?void 0:fe.camera}set camera(fe){this.stateManager&&(this.stateManager.camera=fe)}get contentCamera(){var fe;return null==(fe=this.stateManager)?void 0:fe.contentCamera}set contentCamera(fe){this.stateManager&&(this.stateManager.contentCamera=fe)}installContentCameraReset(fe={sticky:!1}){return this.stateManager.installContentCameraReset(fe)}get center(){var fe;return null==(fe=this.stateManager)?void 0:fe.center}set center(fe){this.stateManager&&(this.stateManager.center=fe)}get clippingArea(){if("global"===this.viewingMode)return null;const fe=this.map;let ve=this._userClippingArea||i$4S(fe,"clippingArea");return!this._userClippingArea&&!i$4S(fe,"clippingEnabled")||null==ve?(this._clippingArea=null,null):ve instanceof aa?this.spatialReference&&(ve=it$1(ve,this.spatialReference),null==ve)?(ar.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(ve=ve.clone(),null==ve.intersection(this._groundAndLayersExtent)&&(ve.xmin=ve.xmax,ve.ymin=ve.ymax),ve.zmin=void 0,ve.zmax=void 0,ve.equals(this._clippingArea)||(this._clippingArea=ve),this._clippingArea):(ar.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(fe){this.ready&&"global"===this.viewingMode&&null!=fe?ar.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=fe}get renderDataExtent(){if(this.state.viewingMode===Wf.Global)return null;const fe=this.renderSpatialReference,ve=this.dataExtent;return null==ve||null==fe||ve.spatialReference.equals(fe)?ve:it$1(ve,fe)}get tileInfo(){var fe,ve;return null==(ve=null==(fe=this.basemapTerrain)?void 0:fe.tilingScheme)?void 0:ve.toTileInfo()}get dataExtent(){let fe=this._groundAndLayersExtent;const ve=this.spatialReference||zo.WGS84,_e=it$1(this.clippingArea,ve);null!=_e&&(fe=null!=fe?fe.intersection(_e):_e);const be=this._get("dataExtent");return null!=fe&&fe.equals(be)?be:fe}get _groundAndLayersExtent(){const fe=this.spatialReference||zo.WGS84;let ve;const i52=_e=>{const be=it$1(_e,fe);null!=be&&(null!=ve?ve.union(be):ve=be.clone())},_e=this.basemapTerrain;if(null==_e?void 0:_e.spatialReference){const fe=_e.groundExtent;i52(new aa({xmin:fe[0],ymin:fe[1],zmin:0,xmax:fe[2],ymax:fe[3],zmax:0,spatialReference:_e.spatialReference}))}if(this.map){const e77=fe=>{null==fe.fullExtent||"graphics"===fe.type&&fe.internal||i52(fe.fullExtent)};this.map.allLayers.forEach((fe=>e77(fe)))}if(null==ve)return null;ve.hasZ?(ve.zmin=Math.min(0,ve.zmin??0),ve.zmax=Math.max(0,ve.zmax??0)):(ve.zmin=0,ve.zmax=0);const be=this._get("_groundAndLayersExtent");return ve.equals(be)?be:ve}castEnvironment(fe){var ve;return fe?fe instanceof zC?fe:fe instanceof DC?(null==(ve=this.environment)?void 0:ve.cloneWithWebsceneEnvironment(fe))??zC.fromWebsceneEnvironment(fe):b$2d(zC,fe):new zC}get extent(){var fe;return null==(fe=this.stateManager)?void 0:fe.extent}set extent(fe){this.stateManager&&(this.stateManager.extent=fe)}get screenCenter(){var fe;return null==(fe=this.stateManager)?void 0:fe.screenCenter}get frustum(){var fe;return null==(fe=this.stateManager)?void 0:fe.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var fe;return this.navigating||((null==(fe=this.toolViewManager)?void 0:fe.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){var fe;return(null==(fe=this.state)?void 0:fe.navigating)??!1}get padding(){var fe;return null==(fe=this.stateManager)?void 0:fe.padding}set padding(fe){this.stateManager&&(this.stateManager.padding=fe)}set qualityProfile(fe){Fle.isValidProfile(fe)&&(Fle.apply(fe,this.qualitySettings),this._set("qualityProfile",fe))}get qualityProfile(){return this._get("qualityProfile")||Fle.getDefaultProfile()}set slicePlane(fe){if(null!=this._stage&&this._stage.renderer.setParameters({slicePlane:fe}),null==fe)return void this._set("slicePlane",null);const ve=this._propertiesPool.get("slicePlane");Z$A(fe,ve),this._set("slicePlane",ve)}get typeSpecificPreconditionsReady(){var fe;return!!this.viewingMode&&!!(null==(fe=this.stateManager)?void 0:fe.preinit(this.spatialReference))}get resolution(){return null!=this.spatialReference?o$3w(this.scale,this.spatialReference):0}get scale(){var fe;return null==(fe=this.stateManager)?void 0:fe.scale}set scale(fe){this.stateManager&&(this.stateManager.scale=fe)}get terrainScale(){var fe;return null==(fe=this.stateManager)?void 0:fe.terrainScale}get heightModelInfo(){const fe=this.getDefaultHeightModelInfo();return null!=fe?Eh.deriveUnitFromSR(fe,this.spatialReference):null}get updating(){var fe,ve,_e,be;if(this.destroyed)return!1;let we=0,Se=this.layerViewManager.updating,Te=Se?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((fe=>{if(fe.isFulfilled()){if(fe.updating){if(Se=!0,fe.suspended||L$d(fe))return;++Te,we+=fe.updatingProgress}}else++Te}));for(const Ce of this._updatingObjects)if(null!=Ce&&Ce.updating){const fe=.1;Te+=fe,we+=.5*fe}for(const Ce of this._updatingObjectsWithProgress)null!=Ce&&Ce.updating&&(++Te,we+=Ce.updatingProgress);const Ee=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(Se=!!(Se||Te>0||this.updatingHandles.updating||!this.ready||!this.stationary||Ee||this._createGraphicsViewController||(null==(fe=this.inputManager)?void 0:fe.updating)||(null==(_e=null==(ve=this.map)?void 0:ve.allLayers)?void 0:_e.some((fe=>!fe.isFulfilled())))||(null==(be=this.textures)?void 0:be.updating)),Se?(this._numUpdating=Math.max(Te,this._numUpdating),we+=this._numUpdating-Te):this._numUpdating=0,this._numUpdating>0?we/=this._numUpdating:we=Se?0:1,this._get("updatingProgress")!==we){const fe=performance.now();if(we<1){const ve=Math.min((fe-this._lastUpdateTime)/2e3,1);we=this.updatingProgress*(1-ve)+we*ve}this._set("updatingProgress",we),this._lastUpdateTime=Se&&we<1?fe:0}return Se}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var fe;const ve=this._predeterminedViewingMode;if(null!=ve)return a$3X(ve);const _e=this.spatialReference;return _e?null!=(null==(fe=this.defaultsFromMap)?void 0:fe.viewingMode)&&_e.equals(this.defaultsFromMap.spatialReference)?a$3X(this.defaultsFromMap.viewingMode):r$2Y(_e,Wf.Global)?"global":"local":"global"}set viewingMode(fe){this.ready?ar.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",fe)}get viewpoint(){var fe;return null==(fe=this.stateManager)?void 0:fe.viewpoint}set viewpoint(fe){this.stateManager&&(this.stateManager.viewpoint=fe)}get zoom(){return this.stateManager.zoom}set zoom(fe){this.stateManager&&(this.stateManager.zoom=fe)}get resourceController(){return this._resourceController}get quality(){var fe,ve;return(null==(ve=null==(fe=this._resourceController)?void 0:fe.memoryController)?void 0:ve.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Sce(this)}on(fe,ve,_e,be){return this.viewEvents.on(fe,ve,_e,be)||super.on(fe,ve)}hasEventListener(fe){return super.hasEventListener(fe)||this.viewEvents.hasHandler(fe)}toMap(fe,ve){if(!this.ready)return ar.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;return function I$l(fe,ve,_e,be){var we,Se,Te,Ee,Ce;const Oe=_e?R$m(fe,_e):be,Re=!(!(null==(we=Oe.graphics)?void 0:we.include)&&!(null==(Se=Oe.graphics)?void 0:Se.exclude)),De=!(!(null==(Te=Oe.mediaElements)?void 0:Te.include)&&!(null==(Ee=Oe.mediaElements)?void 0:Ee.exclude)),Be=d$3c(ve);Oe.enableDraped=Oe.include&&!Oe.include.has(Ny)||(null==(Ce=Oe.exclude)?void 0:Ce.has(Ny));const Ze=fe.sceneIntersectionHelper,Xe=T$15(fe.state.viewingMode);if(Xe.options.selectionMode=!0,Xe.options.store=Re||De?Xf.ALL:Xf.MIN,Xe.options.hud=!(null==_e?void 0:_e.excludeHud),Ze.intersectIntersectorScreen(Be,Xe,Oe),Re||De){for(const ve of Xe.results.all){const _e=h$J(ve,fe);if(null==_e)return j$r(fe,ve);if(Re&&("graphic"!==_e.type||S$s(Oe.graphics,_e.graphic)))return j$r(fe,ve);if(De&&("media"!==_e.type||x$n(Oe.mediaElements,_e.element)))return j$r(fe,ve)}return null}return j$r(fe,Xe.results.min)}(this,o$2_(fe)?r$2H(this,fe):fe,ve,this._defaultToMapOptions)}toScreen(fe){if(!this.ready)return ar.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const ve=(null==fe.z?a$3U(this.elevationProvider,fe):null)??0;return c$4l(fe,wwe,this.renderSpatialReference,ve),this.state.camera.projectToScreen(wwe,xwe),c$4u(xwe[0],xwe[1])}pixelSizeAt(fe){return this.ready?fe?(c$4l(fe,wwe,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(wwe)):0:(ar.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(fe){const ve=this.basemapTerrain.overlayManager;return ve?ve.overlayPixelSizeInMapUnits(fe,(()=>this.pixelSizeAt(fe))):1}hitTest(fe,ve){if(!this.ready)return ar.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;return U$h(this,o$2_(fe)?r$2H(this,fe):fe,ve,this._defaultHitTestOptions)}async popupHitTest(fe){return t$1j(this,fe)}goTo(fe,ve){return this.updatingHandles.addPromise(this.stateManager.goTo(fe,ve))}async whenAnalysisView(fe){if(null==fe.parent)throw new Ir("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:fe});switch(fe.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(fe.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(fe)}}whenLayerView(fe){return super.whenLayerView(fe)}async takeScreenshot(fe){const ve=this._completeSettings(fe);await this.whenReady();return a$Q(await this._stage.renderView.takeScreenshot(ve),ve,this._pixelFormat())}async _takeScreenshot(fe){const ve=this._completeSettings(fe);await this.whenReady();return r$o(await this._stage.renderView.takeScreenshot(ve),this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(fe){const ve=this._completeSettings(fe);await this.whenReady();const _e=await this._stage.renderView.takeScreenshotWithOID(ve);return[r$o(_e[0],this._pixelFormat()),r$o(_e[1],this._pixelFormat())]}_completeSettings(fe){const ve=function n$V(fe,ve){const _e=o$p(fe,ve),be=_e.area,we=_e.width/be.width,Se=b$d(_e,ve.padding),Te=Se.left+Se.right,Ee=Se.top+Se.bottom,Ce=ve.width-Te,Oe=ve.height-Ee,Re=Math.floor(Ce*we+Te),De=Math.floor(Oe*we+Ee),Be=(null==fe?void 0:fe.layers)??[],Ze=_e.ignoreBackground,Xe=_e.ignorePadding;return{framebufferWidth:Re,framebufferHeight:De,region:{x:Math.floor(be.x*we)+Se.left,y:Math.floor(be.y*we)+Se.top,width:_e.width,height:_e.height},format:_e.format,quality:_e.quality,rotation:_e.rotation,pixelRatio:we,layers:Be,disableDecorations:_e.disableDecorations,ignoreBackground:Ze,ignorePadding:Xe,objectAndLayerIdColor:!1}}(fe,this);return ve.pixelRatio/=this.state.pixelRatio,function M$5(fe,ve,_e){if(!ve)return fe;const{framebufferWidth:be,framebufferHeight:we,pixelRatio:Se,region:Te}=fe,Ee=b$d(fe,_e),Ce=Ee.left+Ee.right,Oe=Ee.top+Ee.bottom,Re=be-Ce,De=we-Oe,Be=Math.min(8,Math.min((2048-Ce)/Re,(2048-Oe)/De));return Be<1.5?fe:{...fe,framebufferWidth:Math.round(Re*Be)+Ce,framebufferHeight:Math.round(De*Be)+Oe,pixelRatio:Se*Be,resample:{region:{x:Math.round((Te.x-Ee.left)*Be)+Ee.left,y:Math.round((Te.y-Ee.top)*Be)+Ee.top,width:Math.round(Te.width*Be),height:Math.round(Te.height*Be)},width:be,height:we}}}(ve,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(fe){if(!has("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const ve=this._completeSettings(fe);await this.whenReady();const _e=await this._stage.renderView.takeScreenshotWithOID(ve),be=a$Q(_e[0],ve,this._pixelFormat()),we=this._completeSettings(fe);return we.format="png",[be,a$Q(_e[1],we,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(fe){return this.updatingHandles.addPromise(fe)}importLayerView(fe){return l$35_importLayerView(fe)}hasLayerViewModule(fe){return l$35_hasLayerViewModule(fe)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var fe,ve,_e;return this.map&&"initialViewProperties"in this.map&&(null==(fe=this.map.initialViewProperties)?void 0:fe.spatialReference)||(null==(ve=this.defaultsFromMap)?void 0:ve.spatialReference)||(null==(_e=this.defaultsFromMap)?void 0:_e.ready)&&this._initialDefaultSpatialReference||null}async validate(){let fe=function t$C(fe){const ve=t$D();return ve.available?"3d"===fe&&ve.majorPerformanceCaveat?new Ir("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):ve.supportsHighPrecisionFragment?ve.supportsVertexShaderSamplers?null:new Ir("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new Ir("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new Ir("webgl:required","WebGL2 is required but not supported.",(new Error).stack)}(this.type);const ve=has("safari");if(ve&&ve<9&&(fe=new Ir("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ve})),null!=fe)throw ar.getLogger(this).warn("#validate()",fe.message),fe}get _predeterminedViewingMode(){var fe;const ve=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?null==(fe=this.map.initialViewProperties)?void 0:fe.viewingMode:null)??null;return null!=ve?o$3r(ve):null}getSpatialReferenceSupport(fe,ve){const _e=this._predeterminedViewingMode;if(null!=_e)return this._validateSpatialReferenceForViewingMode(fe,ve,_e)?{constraints:this._makeSpatialReferenceConstraints(fe,ve,_e)}:null;const be=this._validateSpatialReferenceForViewingMode(fe,ve,Wf.Local),we=this._validateSpatialReferenceForViewingMode(fe,ve,Wf.Global);return be||we?be&&we?{constraints:this._makeSpatialReferenceConstraints(fe,ve,null)}:be?{constraints:this._makeSpatialReferenceConstraints(fe,ve,Wf.Local)}:{constraints:this._makeSpatialReferenceConstraints(fe,ve,Wf.Global)}:null}_validateSpatialReferenceForViewingMode(fe,ve,_e){return!(!r$2Y(fe,_e)||null!=ve&&!v$1L(ve)&&(y$1_(ve)&&null==k$f(ve,fe,_e)||h$2v(ve)&&_e===Wf.Global))}_makeSpatialReferenceConstraints(fe,ve,_e){if(null==ve)return[{spatialReference:fe,viewingMode:_e}];const{isWebMercator:be,isWGS84:we}=fe;return v$1L(ve)&&(be||we)?we&&_e!==Wf.Local&&null!==V$g(ve.tileInfo,ve.fullExtent,fe,Wf.Global)?[{spatialReference:be?zo.WGS84:zo.WebMercator,viewingMode:_e}]:[{spatialReference:fe,viewingMode:_e},{spatialReference:zo.WebMercator,viewingMode:_e}]:y$1_(ve)||h$2v(ve)||!be&&!we?y$1_(ve)&&be&&_e!==Wf.Global?[{spatialReference:fe,viewingMode:_e},{spatialReference:zo.WGS84,viewingMode:Wf.Local}]:[{spatialReference:fe,viewingMode:_e}]:[{spatialReference:fe,viewingMode:_e},{spatialReference:be?zo.WGS84:zo.WebMercator,viewingMode:_e}]}_validateSpatialReference(fe){const ve=null!=this.getSpatialReferenceSupport(fe),_e=this._predeterminedViewingMode;return ve||(null!=_e?ar.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${a$3X(_e)} viewing mode.`):fe.isGeographic&&ar.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),ve}whenReady(){return new Promise((fe=>{this.ready?fe(this):this._resolveWhenReady.push(fe)}))}trackGraphicState(fe){if(!fe.graphic)return ar.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const ve=this.getViewForGraphic(fe.graphic);let _e=null,be=!1;const s84=ve=>{var we;!be&&null!=ve&&"processor"in ve&&"graphics-3d"===(null==(we=ve.processor)?void 0:we.type)&&ve.processor.graphicsCore&&(_e=ve.processor.graphicsCore.trackGraphicState(fe))};return null!=ve?s84(ve):this.whenViewForGraphic(fe.graphic,{waitForLayer:!0}).then((fe=>s84(fe)),(()=>{})).catch((()=>{})),e$4e((()=>{be=!0,null!=_e&&(_e.remove(),_e=null)}))}highlight(fe){if(Array.isArray(fe))return o$4o(fe.map((fe=>this.highlight(fe))));if(Wa.isCollection(fe))return o$4o(fe.toArray().map((fe=>this.highlight(fe))));const ve=this.getViewForGraphic(fe);return ve&&"highlight"in ve?ve.highlight(fe):e$4e()}maskOccludee(fe){if(!fe)return ar.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const ve=this.getViewForGraphic(fe);let _e=null,be=!1;const s84=ve=>{!be&&null!=ve&&function e$w(fe){return fe&&"function"==typeof fe.maskOccludee}(ve)&&(_e=ve.maskOccludee(fe))};return null!=ve?s84(ve):this.whenViewForGraphic(fe,{waitForLayer:!0}).then((fe=>s84(fe)),(()=>{})).catch((()=>{})),e$4e((()=>{be=!0,null!=_e&&(_e.remove(),_e=null)}))}getViewForGraphic(fe){return fe.layer===this.graphics?this.graphicsView:fe.layer?this.allLayerViews.find((ve=>ve.layer===fe.layer)):null}graphicChanged(fe){null!=this.graphicsView&&this.graphicsView.graphicChanged(fe)}async whenViewForGraphic(fe,ve){if(fe.layer===this)return await w$1T((()=>this.graphicsView)),this.graphicsView;if(!fe.layer||!this.map)throw new Ir("no-view-for-graphic");return ve&&ve.waitForLayer&&!this.map.allLayers.includes(fe.layer)?new Promise(((ve,_e)=>{const be=this.map.allLayers.on("change",(we=>{we.added.includes(fe.layer)&&(be.remove(),this.whenLayerView(fe.layer).then(ve,_e))}))})):this.whenLayerView(fe.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new ufe({view:this})),this._set("elevationProvider",new Lle({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new nue({view:this})),this._set("featureTiles",new nle({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e76=()=>{var fe;const ve=null==(fe=this.basemapTerrain)?void 0:fe.extent;if(this.clippingArea||ve)if(ve&&this.basemapTerrain.spatialReference){const fe=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?K$D(c$4z(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;null!=this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(fe):this.featureTiles.filterExtent=fe}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add((()=>_B.FEATURE_TILE_TREE_SHOW_TILES),(fe=>{fe&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(zt((()=>import("./FeatureTileTree3DDebugger-DM1PlW85.js")),__vite__mapDeps([211,193]))).then((({FeatureTileTree3DDebugger:fe})=>{!this._featureTreeDebugger&&_B.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new fe({view:this}))})):fe||!this._featureTreeDebugger||_B.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)}),Ja),this.updatingHandles.add((()=>this.clippingArea),e76,Ja),this.updatingHandles.add((()=>this.basemapTerrain.extent),e76,Ja)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const fe=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(fe)||this._set("mapCoordsHelper",new qle(this.map,fe));const ve=this.state.isGlobal,_e=z$_(ve,fe);_e!==this.renderSpatialReference&&(this._set("renderCoordsHelper",nce.create(this.state.viewingMode,_e)),ve||this.addHandles(d$3d((()=>{var fe;return null==(fe=this.basemapTerrain)?void 0:fe.extent}),(fe=>{const ve=this.renderCoordsHelper.spatialReference;null==fe||0===fe[0]&&0===fe[1]&&0===fe[2]&&0===fe[3]||!i$48(fe,this.basemapTerrain.spatialReference,Swe,ve)||(this.renderCoordsHelper.extent=Swe)}),Za),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(By/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(fe=null){null!=fe&&fe.type===Da.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach((fe=>{fe.destroyed||(this.addHandles(d$3d((()=>[fe.updating,fe.updatingProgress]),(()=>this._updatingChanged()),Za),"updatingMonitors"),fe.when((()=>this._updatingChanged()),(()=>this._updatingChanged())))})),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(fe,ve,_e){if(!this.overlay||!this.overlay.hasVisibleItems)return _e;const be=fe.getContext("2d");return be.putImageData(_e,0,0),this.overlay.renderCanvas(fe,{disableDecorations:ve===TA.OFF}),be.getImageData(0,0,_e.width,_e.height)}_initStage(){const fe={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(fe,ve,_e)=>this._renderScreenshotOverlay(fe,ve,_e)}},ve=new wle(this.state.viewingMode,(fe=>this._stage.layers.forAll(fe)),this);this._set("sceneIntersectionHelper",ve);const _e=e$3O(this.surface);this._stage=new d$e({view:this,options:fe,container:_e}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add((()=>this.qualitySettings.highQualityTransparency),(fe=>this._stage.renderer.setParameters({highQualityTransparency:fe})),Xa),this.on("pointer-move",(()=>{var fe;return null==(fe=this._stage)?void 0:fe.renderer.resetAnimation()})),o$4e(this._stage.renderView.canvas,"webglcontextlost",(fe=>{this.fatalError=new Ir("webgl-context-lost",fe.statusMessage)}))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(By/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=u$4d(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(fe){this._exitSurface(),this.state.init(fe,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Ace({view:this,viewingMode:fe,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e76=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e76,e76),this._updatingChanged()}async _createGraphicsViewAsync(fe){const ve=(await zt((async()=>{const{default:fe}=await import("./GraphicsView3D-D-zmwbfX.js");return{default:fe}}),__vite__mapDeps([212,125,110,23,15,16]))).default;s$4o(fe),await w$1T((()=>{var fe;return null==(fe=this.basemapTerrain)?void 0:fe.ready}),fe),this._set("graphicsView",new ve({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const fe=o$3r(this.viewingMode);fe===Wf.Global&&(this._clippingArea=null),this._initSurface(fe),this._set("ready",!0),this.addHandles(v$1W((()=>this.graphics),"after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded();const ve=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,_e=null==ve?void 0:ve.environment;_e&&n$4d(this.environment,_e),this.timeExtent=null==ve?void 0:ve.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new Ece(this._stage,this.resourceController.scheduler));const be=this._resolveWhenReady;this._resolveWhenReady=[],be.forEach((fe=>fe(this)))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",u$4d(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ny);for(const fe of this.map.allLayers.items)m$3d(fe.type)&&this._defaultToMapOptions.include.add(fe.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Ny);for(const fe of this.map.allLayers.items)m$3d(fe.type)&&fe.opacity<1&&this._defaultHitTestOptions.exclude.add(fe.uid)}}};function it$1(fe,ve){return null!=fe&&J$G(fe.spatialReference,ve)?K$D(fe,ve):null}bwe.type="3d",e$4o([y$2v()],bwe.prototype,"_userClippingArea",void 0),e$4o([y$2v()],bwe.prototype,"_resourceController",void 0),e$4o([y$2v()],bwe.prototype,"_stage",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"deconflictor",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"labeler",void 0),e$4o([y$2v(l$40(Fp,"analyses"))],bwe.prototype,"analyses",void 0),e$4o([y$2v({type:PP,readOnly:!0})],bwe.prototype,"animation",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"basemapTerrain",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"elevationProvider",void 0),e$4o([y$2v()],bwe.prototype,"camera",null),e$4o([y$2v({type:Xo})],bwe.prototype,"contentCamera",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"canvas",void 0),e$4o([y$2v({type:Yo})],bwe.prototype,"center",null),e$4o([y$2v({type:aa})],bwe.prototype,"clippingArea",null),e$4o([y$2v({type:jP})],bwe.prototype,"constraints",void 0),e$4o([y$2v({type:aa,readOnly:!0})],bwe.prototype,"renderDataExtent",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"tileInfo",null),e$4o([y$2v({type:aa,readOnly:!0})],bwe.prototype,"dataExtent",null),e$4o([y$2v({type:aa,readOnly:!0})],bwe.prototype,"_groundAndLayersExtent",null),e$4o([y$2v({type:zC})],bwe.prototype,"environment",void 0),e$4o([s$4b("environment")],bwe.prototype,"castEnvironment",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"environmentManager",void 0),e$4o([y$2v({type:aa})],bwe.prototype,"extent",null),e$4o([y$2v()],bwe.prototype,"floors",void 0),e$4o([y$2v()],bwe.prototype,"screenCenter",null),e$4o([y$2v()],bwe.prototype,"frustum",null),e$4o([y$2v({type:Number,readOnly:!0})],bwe.prototype,"fullOpacity",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"graphicsView",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"analysisViewManager",void 0),e$4o([y$2v()],bwe.prototype,"groundView",void 0),e$4o([y$2v({type:Boolean})],bwe.prototype,"initialExtentRequired",null),e$4o([y$2v()],bwe.prototype,"_defaultsFromMapSettings",null),e$4o([y$2v()],bwe.prototype,"interacting",null),e$4o([y$2v()],bwe.prototype,"stationary",null),e$4o([y$2v()],bwe.prototype,"navigating",null),e$4o([y$2v()],bwe.prototype,"map",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"mapCoordsHelper",void 0),e$4o([y$2v()],bwe.prototype,"padding",null),e$4o([y$2v({type:nue,readOnly:!0})],bwe.prototype,"pointsOfInterest",void 0),e$4o([y$2v({type:nle,readOnly:!0})],bwe.prototype,"featureTiles",void 0),e$4o([y$2v()],bwe.prototype,"_featureTreeDebugger",void 0),e$4o([y$2v({type:Boolean})],bwe.prototype,"screenSizePerspectiveEnabled",void 0),e$4o([y$2v({constructOnly:!0})],bwe.prototype,"deactivatedWebGLExtensions",void 0),e$4o([y$2v({constructOnly:!0})],bwe.prototype,"debugWebGLExtensions",void 0),e$4o([y$2v({constructOnly:!0})],bwe.prototype,"renderCanvas",void 0),e$4o([y$2v({constructOnly:!0})],bwe.prototype,"state",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"inputManager",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"stateManager",void 0),e$4o([y$2v({type:["low","medium","high"]})],bwe.prototype,"qualityProfile",null),e$4o([y$2v({type:ice,get(){let fe=this._get("qualitySettings");return fe||(fe=new ice,Fle.apply(this.qualityProfile,fe)),fe}})],bwe.prototype,"qualitySettings",void 0),e$4o([y$2v()],bwe.prototype,"slicePlane",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"typeSpecificPreconditionsReady",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"renderCoordsHelper",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"sceneIntersectionHelper",void 0),e$4o([y$2v({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],bwe.prototype,"resolution",null),e$4o([y$2v({type:Number})],bwe.prototype,"scale",null),e$4o([y$2v()],bwe.prototype,"heightModelInfo",null),e$4o([y$2v()],bwe.prototype,"spatialReference",void 0),e$4o([y$2v({type:Boolean,constructOnly:!0})],bwe.prototype,"alphaCompositingEnabled",void 0),e$4o([y$2v({constructOnly:!0})],bwe.prototype,"preserveDrawingBufferEnabled",void 0),e$4o([y$2v({type:Boolean})],bwe.prototype,"supersampleScreenshotsEnabled",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"type",void 0),e$4o([y$2v(),s$4b((fe=>fe instanceof vwe?fe:g$2C($we,fe)))],bwe.prototype,"ui",void 0),e$4o([y$2v({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],bwe.prototype,"updating",null),e$4o([y$2v()],bwe.prototype,"_updatingObjects",null),e$4o([y$2v()],bwe.prototype,"_updatingObjectsWithProgress",null),e$4o([y$2v({type:Number,readOnly:!0,dependsOn:["updating"]})],bwe.prototype,"updatingProgress",void 0),e$4o([y$2v({type:["global","local"]})],bwe.prototype,"viewingMode",null),e$4o([y$2v({type:Ra})],bwe.prototype,"viewpoint",null),e$4o([y$2v({type:Number})],bwe.prototype,"zoom",null),e$4o([y$2v({type:Vle})],bwe.prototype,"highlightOptions",void 0),e$4o([y$2v({readOnly:!0})],bwe.prototype,"quality",null),e$4o([y$2v({readOnly:!0})],bwe.prototype,"resolutionScale",null),e$4o([y$2v()],bwe.prototype,"textures",void 0),bwe=e$4o([a$4y("esri.views.SceneView")],bwe);const wwe=[0,0,0],xwe=i$4i(),Swe=u$3J(),Twe=bwe,Ewe={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Pwe={read:{reader:n$1R},write:{allowNull:!0,writer:a$1I}},Cwe={json:{read:!1,write:!1,origins:{"web-map":Pwe,"portal-item":Pwe}}},l$L=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return e$4o([y$2v(Ewe)],ve.prototype,"blendMode",void 0),e$4o([y$2v(Cwe)],ve.prototype,"effect",void 0),ve=e$4o([a$4y("esri.layers.mixins.BlendLayer")],ve),ve},t$t=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const fe={minScale:this.minScale,maxScale:this.maxScale},ve=this.parent;ve&&"effectiveScaleRange"in ve&&function r$f(fe,ve){return fe.minScale=fe.minScale>0?ve.minScale>0?Math.min(fe.minScale,ve.minScale):fe.minScale:ve.minScale,fe.maxScale=fe.maxScale>0?ve.maxScale>0?Math.max(fe.maxScale,ve.maxScale):fe.maxScale:ve.maxScale,fe}(fe,ve.effectiveScaleRange);const _e=this._get("effectiveScaleRange");return _e&&_e.minScale===fe.minScale&&_e.maxScale===fe.maxScale?_e:fe}};return e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0}})],ve.prototype,"minScale",void 0),e$4o([y$2v({type:Number,nonNullable:!0,json:{write:!0}})],ve.prototype,"maxScale",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"effectiveScaleRange",null),ve=e$4o([a$4y("esri.layers.mixins.ScaleRangeLayer")],ve),ve};var Owe;let Awe=Owe=class extends Pn{constructor(fe){super(fe)}async collectRequiredFields(fe,ve){return h$2h(fe,ve,this.expression)}clone(){return new Owe({expression:this.expression,title:this.title})}equals(fe){return this.expression===fe.expression&&this.title===fe.title}};e$4o([y$2v({type:String,json:{write:!0}})],Awe.prototype,"expression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],Awe.prototype,"title",void 0),Awe=Owe=e$4o([a$4y("esri.symbols.support.FeatureExpressionInfo")],Awe);const Mwe=Awe;var Rwe;const Iwe=i$4y()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Lwe=new An({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Dwe=Rwe=class extends Pn{constructor(fe){super(fe),this.offset=null}readFeatureExpressionInfo(fe,ve){return null!=fe?fe:ve.featureExpression&&0===ve.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(fe,ve,_e,be){ve[_e]=fe.write({},be),"0"===fe.expression&&(ve.featureExpression={value:0})}get mode(){const{offset:fe,featureExpressionInfo:ve}=this;return this._isOverridden("mode")?this._get("mode"):null!=fe||ve?"relative-to-ground":"on-the-ground"}set mode(fe){this._override("mode",fe)}set unit(fe){this._set("unit",fe)}write(fe,ve){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(fe,ve):null}clone(){return new Rwe({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(fe){return this.mode===fe.mode&&this.offset===fe.offset&&this.unit===fe.unit&&o$4q(this.featureExpressionInfo,fe.featureExpressionInfo)}};e$4o([y$2v({type:Mwe,json:{write:!0}})],Dwe.prototype,"featureExpressionInfo",void 0),e$4o([o$40("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Dwe.prototype,"readFeatureExpressionInfo",null),e$4o([r$3s("featureExpressionInfo",{featureExpressionInfo:{type:Mwe},"featureExpression.value":{type:[0]}})],Dwe.prototype,"writeFeatureExpressionInfo",null),e$4o([y$2v({type:Iwe.apiValues,nonNullable:!0,json:{type:Iwe.jsonValues,read:Iwe.read,write:{writer:Iwe.write,isRequired:!0}}})],Dwe.prototype,"mode",null),e$4o([y$2v({type:Number,json:{write:!0}})],Dwe.prototype,"offset",void 0),e$4o([y$2v({type:kG,json:{type:String,read:Lwe.read,write:Lwe.write}})],Dwe.prototype,"unit",null),Dwe=Rwe=e$4o([a$4y("esri.symbols.support.ElevationInfo")],Dwe);const Nwe=Dwe;let Fwe=class c43 extends(l$L(t$t(Y_))){constructor(fe){super(fe),this.elevationInfo=null,this.graphics=new IT,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(fe){return this.graphics.add(fe),this}addMany(fe){return this.graphics.addMany(fe),this}removeAll(){return this.graphics.removeAll(),this}remove(fe){this.graphics.remove(fe)}removeMany(fe){this.graphics.removeMany(fe)}on(fe,ve){return super.on(fe,ve)}graphicChanged(fe){this.emit("graphic-update",fe)}};e$4o([y$2v({type:Nwe})],Fwe.prototype,"elevationInfo",void 0),e$4o([y$2v(l$40(IT,"graphics"))],Fwe.prototype,"graphics",void 0),e$4o([y$2v({type:["show","hide"]})],Fwe.prototype,"listMode",void 0),e$4o([y$2v()],Fwe.prototype,"screenSizePerspectiveEnabled",void 0),e$4o([y$2v({readOnly:!0})],Fwe.prototype,"type",void 0),e$4o([y$2v({constructOnly:!0})],Fwe.prototype,"internal",void 0),Fwe=e$4o([a$4y("esri.layers.GraphicsLayer")],Fwe);const zwe=Fwe;let kwe=class r62{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(_r),this._values=new Map,this.multipleOriginsSupported=!0}clone(fe){const ve=new r62,_e=this._originStores[gr.DEFAULTS];_e&&_e.forEach(((fe,_e)=>{ve.set(_e,a$4H(fe),gr.DEFAULTS)}));for(let be=gr.SERVICE;be<_r;be++){const _e=this._originStores[be];_e&&_e.forEach(((_e,we)=>{fe&&fe.has(we)||ve.set(we,a$4H(_e),be)}))}return ve}get(fe,ve){const _e=void 0===ve?this._values:this._originStores[ve];return _e?_e.get(fe):void 0}keys(fe){const ve=null==fe?this._values:this._originStores[fe];return ve?[...ve.keys()]:[]}set(fe,ve,_e=gr.USER){let be=this._originStores[_e];if(be||(be=new Map,this._originStores[_e]=be),be.set(fe,ve),!this._values.has(fe)||this._propertyOriginMap.get(fe)<=_e){const be=this._values.get(fe);return this._values.set(fe,ve),this._propertyOriginMap.set(fe,_e),be!==ve}return!1}delete(fe,ve=gr.USER){const _e=this._originStores[ve];if(!_e)return;const be=_e.get(fe);if(_e.delete(fe),this._values.has(fe)&&this._propertyOriginMap.get(fe)===ve){this._values.delete(fe);for(let _e=ve-1;_e>=0;_e--){const ve=this._originStores[_e];if(ve&&ve.has(fe)){this._values.set(fe,ve.get(fe)),this._propertyOriginMap.set(fe,_e);break}}}return be}has(fe,ve){const _e=void 0===ve?this._values:this._originStores[ve];return!!_e&&_e.has(fe)}revert(fe,ve){for(;ve>0&&!this.has(fe,ve);)--ve;const _e=this._originStores[ve],be=null==_e?void 0:_e.get(fe),we=this._values.get(fe);return this._values.set(fe,be),this._propertyOriginMap.set(fe,ve),we!==be}originOf(fe){return this._propertyOriginMap.get(fe)||gr.DEFAULTS}forEach(fe){this._values.forEach(fe)}};const u$z=fe=>{let ve=class extends fe{constructor(...fe){super(...fe);const ve=t$4p(this),_e=ve.store,be=new kwe;ve.store=be,e$3X(ve,_e,be)}read(fe,ve){u$3W(this,fe,ve)}getAtOrigin(fe,ve){const _e=a$L(this),be=n$4L(ve);if("string"==typeof fe)return _e.get(fe,be);const we={};return fe.forEach((fe=>{we[fe]=_e.get(fe,be)})),we}originOf(fe){return t$4m(this.originIdOf(fe))}originIdOf(fe){return a$L(this).originOf(fe)}revert(fe,ve){const _e=a$L(this),be=n$4L(ve),we=t$4p(this);let Se;Se="string"==typeof fe?"*"===fe?_e.keys(be):[fe]:fe,Se.forEach((fe=>{we.invalidate(fe),_e.revert(fe,be),we.commit(fe)}))}};return ve=e$4o([a$4y("esri.core.ReadOnlyMultiOriginJSONSupport")],ve),ve};function a$L(fe){return t$4p(fe).store}let Uwe=class f28 extends(u$z(zi)){};Uwe=e$4o([a$4y("esri.core.ReadOnlyMultiOriginJSONSupport")],Uwe);const l$J=fe=>{let ve=class extends fe{constructor(...fe){super(...fe)}clear(fe,ve="user"){return O$6(this).delete(fe,n$4L(ve))}write(fe,ve){return d$3s(this,fe=fe||{},ve),fe}setAtOrigin(fe,ve,_e){t$4p(this).setAtOrigin(fe,ve,n$4L(_e))}removeOrigin(fe){const ve=O$6(this),_e=n$4L(fe),be=ve.keys(_e);for(const we of be)ve.originOf(we)===_e&&ve.set(we,ve.get(we,_e),gr.USER)}updateOrigin(fe,ve){const _e=O$6(this),be=n$4L(ve),we=o$4m(this,fe);for(let Se=be+1;Se<_r;++Se)_e.delete(fe,Se);_e.set(fe,we,be)}toJSON(fe){return this.write({},fe)}};return ve=e$4o([a$4y("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],ve),ve.prototype.toJSON.isDefaultToJSON=!0,ve};function O$6(fe){return t$4p(fe).store}const S$a=fe=>{let ve=class extends(l$J(u$z(fe))){constructor(...fe){super(...fe)}};return ve=e$4o([a$4y("esri.core.MultiOriginJSONSupport")],ve),ve};let Vwe=class m34 extends(S$a(zi)){};Vwe=e$4o([a$4y("esri.core.MultiOriginJSONSupport")],Vwe);const i$L=fe=>{let ve=class extends fe{get apiKey(){var fe;return this._isOverridden("apiKey")?this._get("apiKey"):function s$A(fe){return"portalItem"in fe}(this)?null==(fe=this.portalItem)?void 0:fe.apiKey:null}set apiKey(fe){null!=fe?this._override("apiKey",fe):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return e$4o([y$2v({type:String})],ve.prototype,"apiKey",null),ve=e$4o([a$4y("esri.layers.mixins.APIKeyMixin")],ve),ve};let Bwe=class e70{constructor(fe,ve=0,_e=fe.lods[fe.lods.length-1].level){this.tileInfo=fe,this.minLOD=ve,this.maxLOD=_e,fe.lodAt(ve)||(this.minLOD=fe.lods[0].level),fe.lodAt(_e)||(this.maxLOD=fe.lods[fe.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(fe,ve,_e){var be;const we=null==(be=this.tileInfo)?void 0:be.lodAt(fe);return!we||fe<this.minLOD||fe>this.maxLOD?"unavailable":we.cols&&we.rows?_e>=we.cols[0]&&_e<=we.cols[1]&&ve>=we.rows[0]&&ve<=we.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(fe,ve,_e,be){await D$1i(be);const we=this.getAvailability(fe,ve,_e);if("unavailable"===we)throw new Ir("tile-map:tile-unavailable","Tile is not available",{level:fe,row:ve,col:_e});return we}async fetchAvailabilityUpsample(fe,ve,_e,be,we){await D$1i(we),be.level=fe,be.row=ve,be.col=_e;const Se=this.tileInfo;return Se.updateTileInfo(be),this.fetchAvailability(fe,ve,_e,we).catch((fe=>{if(b$2g(fe))throw fe;if(Se.upsampleTile(be))return this.fetchAvailabilityUpsample(be.level,be.row,be.col,be,we);throw fe}))}};let jwe=class l39{constructor(fe){!function s$z(fe){if(!(null==fe?void 0:fe.location))throw new Ir("tilemap:missing-location","Location missing from tilemap response");if(!1===fe.valid)throw new Ir("tilemap:invalid","Tilemap response was marked as invalid");if(!fe.data)throw new Ir("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(fe.data))throw new Ir("tilemap:data-mismatch","Data must be an array of numbers");if(fe.data.length!==fe.location.width*fe.location.height)throw new Ir("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(fe);const{location:ve,data:_e}=fe;this.location=Object.freeze(a$4H(ve));const be=this.location.width,we=this.location.height;let Se=!0,Te=!0;const Ee=function n$G(fe,ve=!1){return fe<=rr?ve?new Array(fe).fill(0):new Array(fe):new Uint32Array(fe)}(Math.ceil(be*we/32));let Ce=0;for(let Oe=0;Oe<_e.length;Oe++){const fe=Oe%32;_e[Oe]?(Te=!1,Ee[Ce]|=1<<fe):Se=!1,31===fe&&++Ce}Te?(this._availability="unavailable",this.byteSize=40):Se?(this._availability="available",this.byteSize=40):(this._availability=Ee,this.byteSize=40+A$1L(Ee))}getAvailability(fe,ve){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const _e=(fe-this.location.top)*this.location.width+(ve-this.location.left),be=_e%32,we=_e>>5,Se=this._availability;return we<0||we>Se.length?"unknown":Se[we]&1<<be?"available":"unavailable"}static fromDefinition(fe,ve){const _e=fe.service.request||U$1a,{row:be,col:we,width:Se,height:Te}=fe,Ee={query:{f:"json"}};return ve=ve?{...Ee,...ve}:Ee,_e(function n$F(fe){var ve;let _e;if(null==(ve=fe.service.tileServers)?void 0:ve.length){const ve=fe.service.tileServers;_e=`${ve&&ve.length?ve[fe.row%ve.length]:fe.service.url}/tilemap/${fe.level}/${fe.row}/${fe.col}/${fe.width}/${fe.height}`}else _e=`${fe.service.url}/tilemap/${fe.level}/${fe.row}/${fe.col}/${fe.width}/${fe.height}`;const be=fe.service.query;return be&&(_e=`${_e}?${be}`),_e}(fe),ve).then((fe=>fe.data)).catch((fe=>{var ve;if(422===(null==(ve=null==fe?void 0:fe.details)?void 0:ve.httpStatus))return{location:{top:be,left:we,width:Se,height:Te},valid:!0,data:new Array(Se*Te).fill(0)};throw fe})).then((fe=>{if(fe.location&&(fe.location.top!==be||fe.location.left!==we||fe.location.width!==Se||fe.location.height!==Te))throw new Ir("tilemap:location-mismatch","Tilemap response for different location than requested",{response:fe,definition:{top:be,left:we,width:Se,height:Te}});return l39.fromJSON(fe)}))}static fromJSON(fe){return Object.freeze(new l39(fe))}};function r$d(fe){return`${fe.level}/${fe.row}/${fe.col}/${fe.width}/${fe.height}`}var Gwe;let Hwe=Gwe=class extends zi{constructor(fe){super(fe),this._pendingTilemapRequests={},this.request=U$1a,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new W9(2*bce.MEGABYTES),this.addHandles(d$3d((()=>{const{layer:fe}=this;return[null==fe?void 0:fe.parsedUrl,null==fe?void 0:fe.tileServers,null==fe?void 0:fe.apiKey,null==fe?void 0:fe.customParameters]}),(()=>this._initializeTilemapDefinition()),Xa))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(fe,ve,_e){if(!this.layer.tileInfo.lodAt(fe)||fe<this.effectiveMinLOD||fe>this.effectiveMaxLOD)return"unavailable";const be=this._tilemapFromCache(fe,ve,_e,this._tmpTilemapDefinition);return be?be.getAvailability(ve,_e):"unknown"}fetchAvailability(fe,ve,_e,be){return!this.layer.tileInfo.lodAt(fe)||fe<this.effectiveMinLOD||fe>this.effectiveMaxLOD?Promise.reject(new Ir("tile-map:tile-unavailable","Tile is not available",{level:fe,row:ve,col:_e})):this._fetchTilemap(fe,ve,_e,be).catch((fe=>fe)).then((be=>{if(be instanceof jwe){const we=be.getAvailability(ve,_e);if("unavailable"===we)throw new Ir("tile-map:tile-unavailable","Tile is not available",{level:fe,row:ve,col:_e});return we}if(b$2g(be))throw be;return"unknown"}))}fetchAvailabilityUpsample(fe,ve,_e,be,we){be.level=fe,be.row=ve,be.col=_e;const Se=this.layer.tileInfo;Se.updateTileInfo(be);const Te=this.fetchAvailability(fe,ve,_e,we).catch((fe=>{if(b$2g(fe))throw fe;if(Se.upsampleTile(be))return this.fetchAvailabilityUpsample(be.level,be.row,be.col,be,we);throw fe}));return this._fetchAvailabilityUpsamplePrefetch(be.id,fe,ve,_e,we,Te),Te}async _fetchAvailabilityUpsamplePrefetch(fe,ve,_e,be,we,Se){if(!this._prefetchingEnabled||null==fe)return;const Te=`prefetch-${fe}`;if(this.hasHandles(Te))return;const Ee=new AbortController;Se.then((()=>Ee.abort()),(()=>Ee.abort()));let Ce=!1;const Oe=e$4e((()=>{Ce||(Ce=!0,Ee.abort())}));if(this.addHandles(Oe,Te),await y$2y(10,Ee.signal).catch((()=>{})),Ce||(Ce=!0,this.removeHandles(Te)),c$4_(Ee))return;const Re=new Fg(fe,ve,_e,be),De={...we,signal:Ee.signal},Be=this.layer.tileInfo;for(let Ze=0;Gwe._prefetches.length<Gwe._maxPrefetch&&Be.upsampleTile(Re);++Ze){const fe=this.fetchAvailability(Re.level,Re.row,Re.col,De);Gwe._prefetches.push(fe);const t85=()=>{Gwe._prefetches.removeUnordered(fe)};fe.then(t85,t85)}}_fetchTilemap(fe,ve,_e,be){if(!this.layer.tileInfo.lodAt(fe)||fe<this.effectiveMinLOD||fe>this.effectiveMaxLOD)return Promise.reject(new Ir("tilemap-cache:level-unavailable",`Level ${fe} is unavailable in the service`));const we=this._tmpTilemapDefinition,Se=this._tilemapFromCache(fe,ve,_e,we);if(Se)return Promise.resolve(Se);const Te=null==be?void 0:be.signal;return be={...be,signal:null},new Promise(((fe,ve)=>{m$3R(Te,(()=>ve(u$47())));const _e=r$d(we);let Se=this._pendingTilemapRequests[_e];if(!Se){Se=jwe.fromDefinition(we,be).then((fe=>(this._tilemapCache.put(_e,fe,fe.byteSize),fe)));const e78=()=>{delete this._pendingTilemapRequests[_e]};this._pendingTilemapRequests[_e]=Se,Se.then(e78,e78)}Se.then(fe,ve)}))}_initializeTilemapDefinition(){var fe;if(!this.layer.parsedUrl)return;const{parsedUrl:ve,apiKey:_e,customParameters:be}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:ve.path,query:v$21({...ve.query,...be,token:_e??(null==(fe=ve.query)?void 0:fe.token)}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(fe,ve,_e,be){be.level=fe,be.row=ve-ve%this.size,be.col=_e-_e%this.size;const we=r$d(be);return this._tilemapCache.get(we)}get test(){}};Hwe._maxPrefetch=4,Hwe._prefetches=new jr({initialSize:Gwe._maxPrefetch}),e$4o([y$2v({constructOnly:!0})],Hwe.prototype,"layer",void 0),e$4o([y$2v({constructOnly:!0})],Hwe.prototype,"minLOD",void 0),e$4o([y$2v({constructOnly:!0})],Hwe.prototype,"maxLOD",void 0),e$4o([y$2v({constructOnly:!0})],Hwe.prototype,"request",void 0),e$4o([y$2v({constructOnly:!0})],Hwe.prototype,"size",void 0),Hwe=Gwe=e$4o([a$4y("esri.layers.support.TilemapCache")],Hwe);const p$1c=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){var fe,ve;null==(ve=null==(fe=this.tilemapCache)?void 0:fe.destroy)||ve.call(fe)}readMinScale(fe,ve){return null!=ve.minLOD&&null!=ve.maxLOD?fe:0}readMaxScale(fe,ve){return null!=ve.minLOD&&null!=ve.maxLOD?fe:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(fe,ve,_e){var be;const we=null==(be=ve.capabilities)?void 0:be.includes("Tilemap");let{minLOD:Se,maxLOD:Te,minScale:Ee,maxScale:Ce}=ve;if(null==Se&&null==Te&&0!==Ee&&0!==Ce){const e77=fe=>Math.round(1e4*fe)/1e4;Ee=e77(Ee||ve.tileInfo.lods[0].scale),Ce=e77(Ce||ve.tileInfo.lods[ve.tileInfo.lods.length-1].scale);for(const fe of ve.tileInfo.lods){const ve=e77(fe.scale);Se=ve>=Ee?fe.level:Se,Te=ve>=Ce?fe.level:Te}}if(we)return new Hwe({layer:this,minLOD:Se,maxLOD:Te});if(ve.tileInfo){const fe=new Vg;return fe.read(ve.tileInfo,_e),new Bwe(fe,Se,Te)}return null}};return e$4o([y$2v({json:{read:{source:"copyrightText"}}})],ve.prototype,"copyright",void 0),e$4o([y$2v()],ve.prototype,"minScale",void 0),e$4o([o$40("service","minScale")],ve.prototype,"readMinScale",null),e$4o([y$2v()],ve.prototype,"maxScale",void 0),e$4o([o$40("service","maxScale")],ve.prototype,"readMaxScale",null),e$4o([y$2v({type:zo})],ve.prototype,"spatialReference",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"supportsBlankTile",null),e$4o([y$2v({type:Vg})],ve.prototype,"tileInfo",void 0),e$4o([y$2v()],ve.prototype,"tilemapCache",void 0),e$4o([o$40("service","tilemapCache",["capabilities","tileInfo"])],ve.prototype,"readTilemapCache",null),e$4o([y$2v()],ve.prototype,"version",void 0),ve=e$4o([a$4y("esri.layers.mixins.ArcGISCachedService")],ve),ve},l$H=fe=>{let ve=class extends fe{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const fe=d$2m(this.url);if(null!=fe&&fe.title)return fe.title}return this._get("title")||""}set title(fe){this._set("title",fe)}set url(fe){this._set("url",y$1C(fe,ar.getLogger(this)))}};return e$4o([y$2v()],ve.prototype,"title",null),e$4o([y$2v({type:String})],ve.prototype,"url",null),ve=e$4o([a$4y("esri.layers.mixins.ArcGISService")],ve),ve},e$i=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.customParameters=null}};return e$4o([y$2v({type:Object,json:{write:{overridePolicy:fe=>({enabled:!!(fe&&Object.keys(fe).length>0)})}}})],ve.prototype,"customParameters",void 0),ve=e$4o([a$4y("esri.layers.mixins.CustomParametersMixin")],ve),ve},qwe=(fe=>["operational-layers","basemap","ground"])(),Wwe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Ywe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},Zwe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},Xwe={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":Wwe,"web-map/basemap":Ywe,"web-map/tables":Zwe,"link-chart/operational-layers":{...Wwe,LinkChartLayer:!0},"link-chart/basemap":Ywe,"link-chart/tables":Zwe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},Jwe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:qwe}}},Qwe={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(fe,ve)=>!ve.disablePopup},write:{enabled:!0,writer(fe,ve,_e){ve[_e]=!fe}}}},Kwe={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:qwe}}},exe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:f$2v}}},txe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:qwe}}},rxe={value:null,type:Nwe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:qwe}}};function c$R(fe){return{type:fe,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const ixe={write:{enabled:!0,layerContainerTypes:qwe},read:!0},nxe={type:Number,json:{origins:{"web-document":ixe,"portal-item":{write:!0}}}},sxe={...nxe,json:{...nxe.json,origins:{"web-document":{...ixe,write:{enabled:!0,layerContainerTypes:qwe,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(fe,ve,_e)=>{var be;return _e&&"service"!==_e.origin||!ve.drawingInfo||void 0===ve.drawingInfo.transparency?(null==(be=ve.layerDefinition)?void 0:be.drawingInfo)&&void 0!==ve.layerDefinition.drawingInfo.transparency?r$2U(ve.layerDefinition.drawingInfo.transparency):void 0:r$2U(ve.drawingInfo.transparency)}}}},oxe={type:aa,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(fe,ve)=>{const _e=aa.fromJSON(fe);return null!=ve.spatialReference&&"object"==typeof ve.spatialReference&&(_e.spatialReference=zo.fromJSON(ve.spatialReference)),_e}}}},read:!1}},axe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},lxe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:qwe}}},name:"layerDefinition.minScale",write:!0}},cxe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:qwe}}},name:"layerDefinition.maxScale",write:!0}},uxe={json:{write:{ignoreOrigin:!0,layerContainerTypes:qwe},origins:{"web-map":{read:!1,write:!1}}}},b$9=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(fe,ve,_e){var be;return"Group Layer"===(null==(be=null==_e?void 0:_e.portalItem)?void 0:be.type)?void 0:fe}writeListMode(fe,ve,_e,be){(be&&"ground"===be.layerContainerType||fe&&g$2x(this,_e,{},be))&&(ve[_e]=fe)}writeOperationalLayerType(fe,ve,_e,be){fe&&"tables"!==(null==be?void 0:be.layerContainerType)&&(ve.layerType=fe)}writeTitle(fe,ve){ve.title=fe??"Layer"}readTimeExtent(fe){return fe?j_.fromArray(fe):null}writeTimeExtent(fe,ve,_e,be){fe&&"tables"!==be.layerContainerType&&(fe.isEmpty?(null==be?void 0:be.messages)&&be.messages.push(new Ir("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):ve[_e]=fe.toArray())}read(fe,ve){ve&&(ve.layer=this),function d$3t(fe,ve,_e,be=En){var we;const Se={...be,messages:[]};_e(Se),null==(we=Se.messages)||we.forEach((ve=>{"warning"!==ve.type||fe.loaded?(null==be?void 0:be.messages)&&be.messages.push(ve):fe.loadWarnings.push(ve)}))}(this,0,(ve=>super.read(fe,ve)),ve)}write(fe,ve){var _e,be;if(!this.persistenceEnabled&&!(null==ve?void 0:ve.ignorePersistenceEnabled))return null;if(null==ve?void 0:ve.origin){const fe=`${ve.origin}/${ve.layerContainerType||"operational-layers"}`,be=Xwe[fe];let we=!!(null==be?void 0:be[this.operationalLayerType]);if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===fe&&(we=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===fe&&(we=!1),!we)return null==(_e=ve.messages)||_e.push(new Ir("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${fe}'`,{layer:this})),null}const we=super.write(fe,{...ve,layer:this}),Se=!!ve&&!!ve.messages&&!!ve.messages.filter((fe=>fe instanceof Ir&&"web-document-write:property-required"===fe.name)).length;return Z$I(null==we?void 0:we.url)?(null==(be=null==ve?void 0:ve.messages)||be.push(new Ir("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&Se?null:we}beforeSave(){}};return e$4o([y$2v({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],ve.prototype,"id",void 0),e$4o([o$40("id",["id"])],ve.prototype,"readId",null),e$4o([y$2v(uxe)],ve.prototype,"listMode",void 0),e$4o([r$3s("listMode")],ve.prototype,"writeListMode",null),e$4o([y$2v({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:qwe}}}}})],ve.prototype,"operationalLayerType",void 0),e$4o([r$3s("operationalLayerType")],ve.prototype,"writeOperationalLayerType",null),e$4o([y$2v(nxe)],ve.prototype,"opacity",void 0),e$4o([y$2v({type:Boolean,readOnly:!1})],ve.prototype,"persistenceEnabled",void 0),e$4o([y$2v({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],ve.prototype,"title",void 0),e$4o([r$3s("title"),r$3s(["web-scene"],"title")],ve.prototype,"writeTitle",null),e$4o([y$2v({type:j_,json:{origins:{"web-scene":{write:{layerContainerTypes:qwe}}}}})],ve.prototype,"visibilityTimeExtent",void 0),e$4o([o$40("visibilityTimeExtent")],ve.prototype,"readTimeExtent",null),e$4o([r$3s(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Ci,Oi]]}})],ve.prototype,"writeTimeExtent",null),e$4o([y$2v({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:qwe}}},name:"visibility",write:!0}})],ve.prototype,"visible",void 0),ve=e$4o([a$4y("esri.layers.mixins.OperationalLayer")],ve),ve};function i$J(fe,ve){if(!s$x(fe,ve)){const _e=fe.typeKeywords;_e?_e.push(ve):fe.typeKeywords=[ve]}}function s$x(fe,ve){var _e;return!!(null==(_e=fe.typeKeywords)?void 0:_e.includes(ve))}function c$Q(fe){return s$x(fe,hxe.HOSTED_SERVICE)}function a$I(fe,ve){const _e=fe.typeKeywords;if(_e){const fe=_e.indexOf(ve);fe>-1&&_e.splice(fe,1)}}function u$x(fe,ve,_e){_e?i$J(fe,ve):a$I(fe,ve)}async function l$F(fe){const ve=fe.clone().normalize();let _e;if(ve.length>1)for(const be of ve)_e?be.width>_e.width&&(_e=be):_e=be;else _e=ve[0];return async function o$g(fe){const ve=fe.spatialReference;if(ve.isWGS84)return fe.clone();if(ve.isWebMercator)return R$1f(fe);const _e=zo.WGS84;return await N$13(ve,_e),K$D(fe,_e)}(_e)}const hxe={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function p$1a(fe){var ve;const{portal:_e,isOrgItem:be,itemControl:we}=fe,Se=null==(ve=_e.user)?void 0:ve.privileges;let Te=!Se||Se.includes("features:user:edit"),Ee=!!be&&!!(null==Se?void 0:Se.includes("features:user:fullEdit"));const Ce="update"===we||"admin"===we;return Ce?Ee=Te=!0:Ee&&(Te=!0),{features:{edit:Te,fullEdit:Ee},content:{updateItem:Ce}}}const j$a=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=u$4d(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(fe){fe!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",fe))}readPortalItem(fe,ve,_e){if(ve.itemId)return new n_({id:ve.itemId,portal:null==_e?void 0:_e.portal})}writePortalItem(fe,ve){(null==fe?void 0:fe.id)&&(ve.itemId=fe.id)}async loadFromPortal(fe,ve){var _e;if(null==(_e=this.portalItem)?void 0:_e.id)try{const{load:_e}=await zt((()=>import("./layersLoader-BOfTpi_L.js")),__vite__mapDeps([213,74,73,72]));return s$4o(ve),await _e({instance:this,supportedTypes:fe.supportedTypes,validateItem:fe.validateItem,supportsData:fe.supportsData,layerModuleTypeMap:fe.layerModuleTypeMap},ve)}catch(Dr){throw b$2g(Dr)||ar.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${Dr}`),Dr}}async finishLoadEditablePortalLayer(fe){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(fe).catch((fe=>(a$4D(fe),!0))))}async setUserPrivileges(fe,ve){if(!ir.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(ve);if(this.url)try{const{features:{edit:_e,fullEdit:be},content:{updateItem:we}}=await this._fetchUserPrivileges(fe,ve);this._set("userHasEditingPrivileges",_e),this._set("userHasFullEditingPrivileges",be),this._set("userHasUpdateItemPrivileges",we)}catch(vv){a$4D(vv)}}async _fetchUserPrivileges(fe,ve){let _e=this.portalItem;if(!fe||!_e||!_e.loaded||_e.sourceUrl)return this._fetchFallbackUserPrivileges(ve);const be=fe===_e.id;if(be&&_e.portal.user)return p$1a(_e);let we,Se;if(be)we=_e.portal.url;else try{we=await x$1x(this.url,ve)}catch(Oe){a$4D(Oe)}if(!we||!function W$O(fe,ve){if(!fe||!ve)return!1;fe=z$1c(fe),ve=z$1c(ve);const _e=a$4r(fe),be=a$4r(ve);return null!=_e&&null!=be?_e.portalHostname===be.portalHostname:null==_e&&null==be&&F$1a(fe,ve,!0)}(we,_e.portal.url))return this._fetchFallbackUserPrivileges(ve);try{const fe=null!=ve?ve.signal:null;Se=await(null==Ts?void 0:Ts.getCredential(`${we}/sharing`,{prompt:!1,signal:fe}))}catch(Oe){a$4D(Oe)}const Te=!0,Ee=!1,Ce=!1;if(!Se)return{features:{edit:Te,fullEdit:Ee},content:{updateItem:Ce}};try{if(be?await _e.reload():(_e=new n_({id:fe,portal:{url:we}}),await _e.load(ve)),_e.portal.user)return p$1a(_e)}catch(Oe){a$4D(Oe)}return{features:{edit:Te,fullEdit:Ee},content:{updateItem:Ce}}}async _fetchFallbackUserPrivileges(fe){let ve=!0;try{ve=await this._fetchUserHasEditingPrivileges(fe)}catch(Dr){a$4D(Dr)}return{features:{edit:ve,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(fe){const ve=this.url?null==Ts?void 0:Ts.findCredential(this.url):null;if(!ve)return!0;const _e=dxe.credential===ve?dxe.user:await this._fetchEditingUser(fe);return dxe.credential=ve,dxe.user=_e,null==(null==_e?void 0:_e.privileges)||_e.privileges.includes("features:user:edit")}async _fetchEditingUser(fe){var ve,_e;const be=null==(_e=null==(ve=this.portalItem)?void 0:ve.portal)?void 0:_e.user;if(be)return be;const we=null==Ts?void 0:Ts.findServerInfo(this.url??"");if(!(null==we?void 0:we.owningSystemUrl))return null;const Se=`${we.owningSystemUrl}/sharing/rest`,Te=Gv.getDefault();if(Te&&Te.loaded&&K$I(Te.restUrl)===K$I(Se))return Te.user;const Ee=`${Se}/community/self`,Ce=null!=fe?fe.signal:null,Oe=await _$1s(U$1a(Ee,{authMode:"no-prompt",query:{f:"json"},signal:Ce}));return Oe.ok?kv.fromJSON(Oe.value.data):null}read(fe,ve){ve&&(ve.layer=this),super.read(fe,ve)}write(fe,ve){var _e;const be=null==ve?void 0:ve.portal,we=(null==(_e=this.portalItem)?void 0:_e.id)&&(this.portalItem.portal||Gv.getDefault());return be&&we&&!N$1a(we.restUrl,be.restUrl)?(ve.messages&&ve.messages.push(new Ir("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(fe,{...ve,layer:this})}};return e$4o([y$2v({type:n_})],ve.prototype,"portalItem",null),e$4o([o$40("web-document","portalItem",["itemId"])],ve.prototype,"readPortalItem",null),e$4o([r$3s("web-document","portalItem",{itemId:{type:String}})],ve.prototype,"writePortalItem",null),e$4o([y$2v({clonable:!1})],ve.prototype,"resourceReferences",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],ve.prototype,"userHasEditingPrivileges",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],ve.prototype,"userHasFullEditingPrivileges",void 0),e$4o([y$2v({type:Boolean,readOnly:!0})],ve.prototype,"userHasUpdateItemPrivileges",void 0),ve=e$4o([a$4y("esri.layers.mixins.PortalLayer")],ve),ve},dxe={credential:null,user:null};let pxe=null;let fxe=class n47{constructor(fe,ve){this._spriteSource=fe,this._maxTextureSize=ve,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded","url"===fe.type&&fe.spriteFormat&&(this._spriteImageFormat=fe.spriteFormat),fe.pixelRatio&&(this.devicePixelRatio=fe.pixelRatio),this.baseURL=fe.spriteUrl}get spriteNames(){const fe=[];for(const ve in this._spritesData)fe.push(ve);return fe.sort(),fe}getSpriteInfo(fe){return this._spritesData?this._spritesData[fe]:null}async load(fe){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(fe),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(fe){this._isRetina=this.devicePixelRatio>1.15;const{width:ve,height:_e,data:be,json:we}=await this._getSpriteData(this._spriteSource,fe),Se=Object.keys(we);if(!Se||0===Se.length||!be)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=we,this.width=ve,this.height=_e;const Te=Math.max(this._maxTextureSize,4096);if(ve>Te||_e>Te){const fe=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${Te} pixels}`;throw ar.getLogger("esri.layers.support.SpriteSource").error(fe),new Ir("SpriteSource",fe)}let Ee;for(let Ce=0;Ce<be.length;Ce+=4)Ee=be[Ce+3]/255,be[Ce]=be[Ce]*Ee,be[Ce+1]=be[Ce+1]*Ee,be[Ce+2]=be[Ce+2]*Ee;this.image=be}async _getSpriteData(fe,ve){if("image"===fe.type){let ve,_e;if(this.devicePixelRatio<1.15){if(!fe.spriteSource1x)throw new Ir("SpriteSource","no image data provided for low resolution sprites!");ve=fe.spriteSource1x.image,_e=fe.spriteSource1x.json}else{if(!fe.spriteSource2x)throw new Ir("SpriteSource","no image data provided for high resolution sprites!");ve=fe.spriteSource2x.image,_e=fe.spriteSource2x.json}return"width"in ve&&"height"in ve&&"data"in ve&&(t$4t(ve.data)||e$4i(ve.data))?{width:ve.width,height:ve.height,data:new Uint8Array(ve.data),json:_e}:{...d$n(ve),json:_e}}const _e=I$1E(this.baseURL),be=_e.query?"?"+v$21(_e.query):"",we=this._isRetina?"@2x":"",Se=`${_e.path}${we}.${this._spriteImageFormat}${be}`,Te=`${_e.path}${we}.json${be}`,[Ee,Ce]=await Promise.all([U$1a(Te,ve),U$1a(Se,{responseType:"image",...ve})]);return{...d$n(Ce.data),json:Ee.data}}};function d$n(fe){const ve=document.createElement("canvas"),_e=ve.getContext("2d");ve.width=fe.width,ve.height=fe.height,_e.drawImage(fe,0,0,fe.width,fe.height);const be=_e.getImageData(0,0,fe.width,fe.height);return{width:fe.width,height:fe.height,data:new Uint8Array(be.data)}}let mxe=class l40{constructor(fe){this.url=fe}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=U$1a(this.url).then((fe=>fe.data.index))),this._tileIndexPromise}async dataKey(fe,ve){const _e=await this.fetchTileIndex();return s$4o(ve),this._getIndexedDataKey(_e,fe)}_getIndexedDataKey(fe,ve){const _e=[ve];if(ve.level<0||ve.row<0||ve.col<0||ve.row>>ve.level>0||ve.col>>ve.level>0)return null;let be=ve;for(;0!==be.level;)be=new pue(be.level-1,be.row>>1,be.col>>1,be.world),_e.push(be);let we,Se,Te=fe,Ee=_e.pop();if(1===Te)return Ee;for(;_e.length;)if(we=_e.pop(),Se=(1&we.col)+((1&we.row)<<1),Te){if(0===Te[Se]){Ee=null;break}if(1===Te[Se]){Ee=we;break}Ee=we,Te=Te[Se]}return Ee}},yxe=class l41{constructor(fe,ve){this._tilemap=fe,this._tileIndexUrl=ve}destroy(){this._tilemap=u$4d(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(fe){return this._tileIndexPromise||(this._tileIndexPromise=U$1a(this._tileIndexUrl,{query:{...null==fe?void 0:fe.query}}).then((fe=>fe.data.index))),this._tileIndexPromise}dataKey(fe,ve){const{level:_e,row:be,col:we}=fe,Se=new pue(fe);return this._tilemap.fetchAvailabilityUpsample(_e,be,we,Se,ve).then((()=>(Se.world=fe.world,Se))).catch((fe=>{if(b$2g(fe))throw fe;return null}))}},gxe=class l42{constructor(fe){this._tileUrl=fe,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(fe){var ve;(null==this._promise||c$4_(null==(ve=this._abortController)?void 0:ve.signal))&&(this._promise=this._makeRequest(this._tileUrl));const _e=this._abortOptions;return _e.push(fe),m$3R(fe,(()=>{_e.every((fe=>c$4_(fe)))&&this._abortController.abort()})),this._promise.then((fe=>a$4H(fe)))}async _makeRequest(fe){this._abortController=new AbortController;const{data:ve}=await U$1a(fe,{responseType:"array-buffer",signal:this._abortController.signal});return ve}};const vxe=new Map;function c$P(fe,ve,_e,be,we){const Se=I$1E(fe),Te=Se.query;if(Te)for(const[Ee,Ce]of Object.entries(Te))switch(Ce){case"{x}":Te[Ee]=be.toString();break;case"{y}":Te[Ee]=_e.toString();break;case"{z}":Te[Ee]=ve.toString()}return function p$19(fe,ve){return r$3B(vxe,fe,(()=>new gxe(fe))).getData(ve).finally((()=>vxe.delete(fe)))}(Et$4(Se.path.replaceAll(/\{z\}/gi,ve.toString()).replaceAll(/\{y\}/gi,_e.toString()).replaceAll(/\{x\}/gi,be.toString()),{...Se.query}),we)}let _xe=class u25{constructor(fe,ve,_e){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=fe,this.sourceUrl=ve;const be=I$1E(this.sourceUrl),we=a$4H(_e),Se=we.tiles;if(be)for(let De=0;De<Se.length;De++){const fe=I$1E(Se[De]);fe&&(Y$F(fe.path)||(fe.path=V$19(be.path,fe.path)),Se[De]=Et$4(fe.path,{...be.query,...fe.query}))}this.tileServers=Se;const Te=_e.capabilities&&_e.capabilities.split(",").map((fe=>fe.toLowerCase().trim())),Ee=!0===(null==_e?void 0:_e.exportTilesAllowed),Ce=!0===(null==Te?void 0:Te.includes("tilemap")),Oe=Ee&&_e.hasOwnProperty("maxExportTilesCount")?_e.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:Ee,supportsTileMap:Ce},exportTiles:Ee?{maxExportTilesCount:+Oe}:null},this.tileInfo=Vg.fromJSON(we.tileInfo);const Re=_e.tileMap?Et$4(V$19(be.path,_e.tileMap),be.query??{}):null;Ce?(this.type="vector-tile",this.tilemap=new yxe(new Hwe({layer:{parsedUrl:be,tileInfo:this.tileInfo},minLOD:we.minLOD??this.tileInfo.lods[0].level,maxLOD:we.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),Re)):Re&&(this.tilemap=new mxe(Re)),this.fullExtent=aa.fromJSON(_e.fullExtent),this.initialExtent=aa.fromJSON(_e.initialExtent)}destroy(){var fe;null==(fe=this.tilemap)||fe.destroy()}async getRefKey(fe,ve){var _e;return await(null==(_e=this.tilemap)?void 0:_e.dataKey(fe,ve))??fe}requestTile(fe,ve,_e,be){return c$P(this.tileServers[ve%this.tileServers.length],fe,ve,_e,be)}isCompatibleWith(fe){const ve=this.tileInfo,_e=fe.tileInfo;if(!ve.spatialReference.equals(_e.spatialReference))return!1;if(!ve.origin.equals(_e.origin))return!1;if(Math.round(ve.dpi)!==Math.round(_e.dpi))return!1;const be=ve.lods,we=_e.lods,Se=Math.min(be.length,we.length);for(let Te=0;Te<Se;Te++){const fe=be[Te],ve=we[Te];if(fe.level!==ve.level||Math.round(fe.scale)!==Math.round(ve.scale))return!1}return!0}};function d$m(...fe){let ve;for(const _e of fe)if(null!=_e)if(pt$9(_e)){if(ve){const fe=ve.split("://")[0];ve=fe+":"+_e.trim()}}else ve=Y$F(_e)?_e:V$19(ve,_e);return ve?qt$3(ve):void 0}async function S$9(fe,ve,_e,be,we){let Se,Te,Ee;if(s$4o(we),"string"==typeof _e){const fe=K$I(_e);Ee=await U$1a(fe,{...we,responseType:"json",query:{f:"json",...null==we?void 0:we.query}}),Ee.ssl&&(Se&&(Se=Se.replace(/^http:/i,"https:")),Te&&(Te=Te.replace(/^http:/i,"https:"))),Se=fe,Te=fe}else null!=_e&&(Ee={data:_e},Se=_e.jsonUrl||null,Te=be);const Ce=null==Ee?void 0:Ee.data;if(w$b(Ce))return fe.styleUrl=Se||null,async function j$9(fe,ve,_e,be){const we=_e?Rt$3(_e):q$10();fe.styleBase=we,fe.style=ve,ve["sprite-format"]&&"webp"===ve["sprite-format"].toLowerCase()&&(fe.spriteFormat="webp");const Se=[];if(ve.sources&&ve.sources.esri){const _e=ve.sources.esri;_e.url?await S$9(fe,"esri",d$m(we,_e.url),void 0,be):Se.push(S$9(fe,"esri",_e,we,be))}for(const Te of Object.keys(ve.sources))"esri"!==Te&&"vector"===ve.sources[Te].type&&(ve.sources[Te].url?Se.push(S$9(fe,Te,d$m(we,ve.sources[Te].url),void 0,be)):ve.sources[Te].tiles&&Se.push(S$9(fe,Te,ve.sources[Te],we,be)));await Promise.all(Se)}(fe,Ce,Te,we);if(function U$7(fe){return!w$b(fe)}(Ce))return fe.sourceUrl?g$g(fe,Ce,Te,!1,ve,we):(fe.sourceUrl=Se||null,g$g(fe,Ce,Te,!0,ve,we));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function h$f(fe){return"object"==typeof fe&&!!fe&&"tilejson"in fe&&null!=fe.tilejson}function w$b(fe){return!!fe&&"sources"in fe&&!!fe.sources}async function g$g(fe,ve,_e,be,we,Se){const Te=_e?qt$3(_e)+"/":q$10(),Ee=function v$a(fe){const ve=512;if(function N$7(fe){return fe.hasOwnProperty("tileInfo")}(fe)){const _e=null==fe?void 0:fe.tileInfo;return null!=_e&&(null==_e.rows&&(_e.rows=ve),null==_e.cols&&(_e.cols=ve)),fe}const _e={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100,latestWkid:3857}};let be=null;if(h$f(fe)){const{bounds:ve}=fe;if(ve){const fe=d$3l({x:ve[0],y:ve[1],spatialReference:a$4H(ho)}),_e=d$3l({x:ve[2],y:ve[3],spatialReference:a$4H(ho)});be={xmin:fe.x,ymin:fe.y,xmax:_e.x,ymax:_e.y,spatialReference:a$4H(po)}}}null===be&&(be=_e);let we=78271.51696400007,Se=295828763.7957775;const Te=[],Ee=fe.hasOwnProperty("maxzoom")&&null!=fe.maxzoom?+fe.maxzoom:22,Ce=0,Oe=0;for(let Re=0;Re<=Ee;Re++)Te.push({level:Re,scale:Se,resolution:we}),we/=2,Se/=2;return{capabilities:"TilesOnly",initialExtent:be,fullExtent:_e,minScale:Ce,maxScale:Oe,tiles:fe.tiles,tileInfo:{rows:ve,cols:ve,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:Te,spatialReference:a$4H(po)}}}(ve),Ce=new _xe(we,Et$4(Te,(null==Se?void 0:Se.query)??{}),Ee);if(!be&&fe.primarySourceName in fe.sourceNameToSource){const ve=fe.sourceNameToSource[fe.primarySourceName];if(!ve.isCompatibleWith(Ce))return;null!=Ce.fullExtent&&(null!=ve.fullExtent?ve.fullExtent.union(Ce.fullExtent):ve.fullExtent=Ce.fullExtent.clone()),ve.tileInfo&&Ce.tileInfo&&ve.tileInfo.lods.length<Ce.tileInfo.lods.length&&(ve.tileInfo=Ce.tileInfo)}if(be&&(fe.sourceBase=Te,fe.source=ve,fe.validatedSource=Ee,fe.primarySourceName=we),fe.sourceNameToSource[we]=Ce,!h$f(fe)&&"defaultStyles"in ve&&!fe.style){if(null==ve.defaultStyles)throw new Error;return"string"==typeof ve.defaultStyles?S$9(fe,"",d$m(Te,ve.defaultStyles,"root.json"),void 0,Se):S$9(fe,"",ve.defaultStyles,d$m(Te,"root.json"),Se)}}function e$g(fe,ve){return{...l$B(fe,ve),readResourcePaths:[]}}function o$e(fe,ve,_e){const be=I$1E(fe.itemUrl);return{...l$B(fe,ve),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:be?{rootPath:be.path,writtenUrls:[]}:null,resources:_e?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l$B(fe,ve){return{origin:ve,url:I$1E(fe.itemUrl),portal:fe.portal||Gv.getDefault(),portalItem:fe}}const $xe=1e-6;function r$b(fe,ve){if(fe===ve)return!0;if(null==fe&&null!=ve)return!1;if(null!=fe&&null==ve)return!1;if(null==fe||null==ve)return!1;if(!fe.spatialReference.equals(ve.spatialReference)||fe.dpi!==ve.dpi)return!1;const _e=fe.origin,be=ve.origin;if(Math.abs(_e.x-be.x)>=$xe||Math.abs(_e.y-be.y)>=$xe)return!1;let we,Se;fe.lods[0].scale>ve.lods[0].scale?(we=fe,Se=ve):(Se=fe,we=ve);for(let Te=we.lods[0].scale;Te>=Se.lods[Se.lods.length-1].scale-$xe;Te/=2)if(Math.abs(Te-Se.lods[0].scale)<$xe)return!0;return!1}function o$d(fe,ve){if(fe===ve)return fe;if(null==fe&&null!=ve)return ve;if(null!=fe&&null==ve)return fe;if(null==fe||null==ve)return null;const _e=fe.size[0],be=fe.format,we=fe.dpi,Se=new Yo({x:fe.origin.x,y:fe.origin.y}),Te=fe.spatialReference,Ee=fe.lods[0].scale>ve.lods[0].scale?fe.lods[0]:ve.lods[0],Ce=fe.lods[fe.lods.length-1].scale<=ve.lods[ve.lods.length-1].scale?fe.lods[fe.lods.length-1]:ve.lods[ve.lods.length-1],Oe=Ee.scale,Re=Ee.resolution,De=Ce.scale,Be=[];let Ze=Oe,Xe=Re,Je=0;for(;Ze>De;)Be.push(new Ng({level:Je,resolution:Xe,scale:Ze})),Je++,Ze/=2,Xe/=2;return new Vg({size:[_e,_e],dpi:we,format:be||"pbf",origin:Se,lods:Be,spatialReference:Te})}let bxe=class t77{constructor(fe){this._array=[],this._stride=fe}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(fe,ve){return 65535&fe|ve<<16}static i8888to32(fe,ve,_e,be){return 255&fe|(255&ve)<<8|(255&_e)<<16|be<<24}static i8816to32(fe,ve,_e){return 255&fe|(255&ve)<<8|_e<<16}};var wxe,xxe,Sxe;(Sxe=wxe||(wxe={}))[Sxe.R8_SIGNED=0]="R8_SIGNED",Sxe[Sxe.R8_UNSIGNED=1]="R8_UNSIGNED",Sxe[Sxe.R16_SIGNED=2]="R16_SIGNED",Sxe[Sxe.R16_UNSIGNED=3]="R16_UNSIGNED",Sxe[Sxe.R8G8_SIGNED=4]="R8G8_SIGNED",Sxe[Sxe.R8G8_UNSIGNED=5]="R8G8_UNSIGNED",Sxe[Sxe.R16G16_SIGNED=6]="R16G16_SIGNED",Sxe[Sxe.R16G16_UNSIGNED=7]="R16G16_UNSIGNED",Sxe[Sxe.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED",Sxe[Sxe.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED",Sxe[Sxe.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR",Sxe[Sxe.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY",Sxe[Sxe.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN",function(fe){fe[fe.UNIFORM=0]="UNIFORM",fe[fe.DATA_DRIVEN=1]="DATA_DRIVEN",fe[fe.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN",fe[fe.UNUSED=3]="UNUSED"}(xxe||(xxe={}));let Txe=class r63{constructor(fe){this._locations=new Map,this._key=fe}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(fe,ve,_e,be,we){const Se=this.getUniforms();for(const Te of Se){const{name:Se,type:Ee,getValue:Ce}=Te,Oe=Ce(_e,ve,be,we);if(null!==Oe)switch(Ee){case"float":fe.setUniform1f(Se,Oe);break;case"vec2":fe.setUniform2fv(Se,Oe);break;case"vec4":fe.setUniform4fv(Se,Oe)}}}encodeAttributes(fe,ve,_e,be){var we;const Se=this.attributesInfo(),Te=this.getEncodingInfos(),Ee=[];let Ce=0,Oe=0;for(const Re of Object.keys(Te)){const De=Te[Re],{type:Be,precisionFactor:Ze,isLayout:Xe}=Se[Re],Je=Xe?_e.getLayoutProperty(Re):_e.getPaintProperty(Re),Qe=null==(we=Je.interpolator)?void 0:we.getInterpolationRange(ve);let dt=0;for(const _e of De){const{offset:we,bufferElementsToAdd:Se}=_e;if(Se>0){for(let fe=0;fe<Se;fe++)Ee.push(0);Ce+=Oe,Oe=_e.bufferElementsToAdd}const Te=be??Je.getValue(Qe?Qe[dt]:ve,fe);switch(Be){case wxe.R8_SIGNED:case wxe.R8_UNSIGNED:Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we);break;case wxe.R16_SIGNED:case wxe.R16_UNSIGNED:Ee[Ce]|=this._encodeShort(Te*(Ze||1),8*we);break;case wxe.R8G8_SIGNED:case wxe.R8G8_UNSIGNED:Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we),Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we+8);break;case wxe.R16G16_SIGNED:case wxe.R16G16_UNSIGNED:Ee[Ce]|=this._encodeShort(Te*(Ze||1),8*we),Ee[Ce]|=this._encodeShort(Te*(Ze||1),8*we+16);break;case wxe.R8G8B8A8_SIGNED:case wxe.R8G8B8A8_UNSIGNED:Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we),Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we+8),Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we+16),Ee[Ce]|=this._encodeByte(Te*(Ze||1),8*we+24);break;case wxe.R8G8B8A8_COLOR:Ee[Ce]=this._encodeColor(Te);break;case wxe.R16G16B16A16_DASHARRAY:case wxe.R16G16B16A16_PATTERN:this._encodePattern(Ce,Ee,Te);break;default:throw new Error("Unsupported encoding type")}dt++}}return Ee}getAtributeState(fe){let ve=0;const _e=3+2*fe;return ve|=this._bit(_e),ve|=this._bit(_e+1)<<1,ve}_buildAttributesInfo(){const fe=[],ve={},_e={};let be=-1;const we=this.attributesInfo(),Se=this.attributes();let Te=-1;for(const Re of Se){Te++;const Se=this.getAtributeState(Te);if(Se===xxe.UNIFORM||Se===xxe.UNUSED)continue;const Ee=we[Re],Ce=[];ve[Re]=Ce;const Oe=Ee.type;for(let ve=0;ve<Se;ve++){const{dataType:ve,bytesPerElement:we,count:Se,normalized:Te}=r63._encodingInfo[Oe],Ee=we*Se,Re=`${ve}-${!0===Te}`;let De=_e[Re],Be=0;if(!De||De.count+Se>4)be++,De={dataIndex:be,count:0,offset:0},4!==Se&&(_e[Re]=De),fe.push({location:-1,name:"a_data_"+be,count:Se,type:ve,normalized:Te}),Be=Math.ceil(Math.max(Ee/4,1));else{const ve=fe[De.dataIndex];ve.count+=Se,Be=Math.ceil(Math.max(ve.count*we/4,1))-Math.ceil(Math.max(De.offset/4,1))}Ce.push({dataIndex:De.dataIndex,offset:De.offset,bufferElementsToAdd:Be}),De.offset+=Ee,De.count+=Se}}for(const Re of fe)switch(Re.type){case BO.BYTE:case BO.UNSIGNED_BYTE:Re.count=4;break;case BO.SHORT:case BO.UNSIGNED_SHORT:Re.count+=Re.count%2}this._buildVertexBufferLayout(fe);let Ee=0;const Ce=this._layoutInfo.geometry;for(const Re of Ce)this._locations.set(Re.name,Ee++);const Oe=this._layoutInfo.opacity;if(Oe)for(const Re of Oe)this._locations.set(Re.name,Ee++);this._buildShaderInfo(fe,ve),this._propertyEncodingInfo=ve}_buildVertexBufferLayout(fe){const ve={},_e=this.geometryInfo();let be=_e[0].stride;if(0===fe.length)ve.geometry=_e;else{const we=[];let Se=be;for(const ve of fe)be+=i$I(ve.type)*ve.count;for(const fe of _e)we.push(new JA(fe.name,fe.count,fe.type,fe.offset,be,fe.normalized));for(const ve of fe)we.push(new JA(ve.name,ve.count,ve.type,Se,be,ve.normalized)),Se+=i$I(ve.type)*ve.count;ve.geometry=we}this.opacityInfo()&&(ve.opacity=this.opacityInfo()),this._layoutInfo=ve,this._stride=be}_buildShaderInfo(fe,ve){let _e="\n",be="\n";const we=[];for(const Ce of fe)_e+=`attribute ${this._getType(Ce.count)} ${Ce.name};\n`;const Se=this.attributes(),Te=this.attributesInfo();let Ee=-1;for(const Ce of Se){Ee++;const{name:fe,type:Se,precisionFactor:Oe,isLayout:Re}=Te[Ce],De=Oe&&1!==Oe?" * "+1/Oe:"",{bytesPerElement:Be,count:Ze}=r63._encodingInfo[Se],E12=fe=>`a_data_${fe.dataIndex}${a$G(Ze,fe.offset,Be)}`;switch(this.getAtributeState(Ee)){case xxe.UNIFORM:{const ve=this._getType(Ze),Te=`u_${fe}`;we.push({name:Te,type:ve,getValue:(fe,ve,_e,be)=>{const we=Re?fe.getLayoutValue(Ce,ve):fe.getPaintValue(Ce,ve);if(Se===wxe.R16G16B16A16_DASHARRAY){const _e=fe.getDashKey(we,fe.getLayoutValue("line-cap",ve)),Se=be.getMosaicItemPosition(_e,!1);if(null==Se)return null;const{tl:Te,br:Ee}=Se;return[Te[0],Ee[1],Ee[0],Te[1]]}if(Se===wxe.R16G16B16A16_PATTERN){const fe=be.getMosaicItemPosition(we,!Ce.includes("line-"));if(null==fe)return null;const{tl:ve,br:_e}=fe;return[ve[0],_e[1],_e[0],ve[1]]}if(Se===wxe.R8G8B8A8_COLOR){const fe=we[3];return[fe*we[0],fe*we[1],fe*we[2],fe]}return we}}),_e+=`uniform ${ve} ${Te};\n`,be+=`${ve} ${fe} = ${Te};\n`}break;case xxe.DATA_DRIVEN:{const _e=E12(ve[Ce][0]);be+=`${this._getType(Ze)} ${fe} = ${_e}${De};\n`}break;case xxe.INTERPOLATED_DATA_DRIVEN:{const Se=`u_t_${fe}`;we.push({name:Se,type:"float",getValue:(fe,ve,_e,be)=>(Re?fe.getLayoutProperty(Ce):fe.getPaintProperty(Ce)).interpolator.interpolationUniformValue(_e,ve)}),_e+=`uniform float ${Se};\n`;const Te=E12(ve[Ce][0]),Ee=E12(ve[Ce][1]);be+=`${this._getType(Ze)} ${fe} = mix(${Te}${De}, ${Ee}${De}, ${Se});\n`}}}this._shaderHeader=_e,this._shaderMain=be,this._uniforms=we}_bit(fe){return(this._key&1<<fe)>>fe}_getType(fe){switch(fe){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(fe){const ve=255*fe[3];return bxe.i8888to32(fe[0]*ve,fe[1]*ve,fe[2]*ve,ve)}_encodePattern(fe,ve,_e){if(!(null==_e?void 0:_e.rect))return;const be=_e.rect,we=_e.width,Se=_e.height;ve[fe]=this._encodeShort(be.x+2,0),ve[fe]|=this._encodeShort(be.y+2+Se,16),ve[fe+1]=this._encodeShort(be.x+2+we,0),ve[fe+1]|=this._encodeShort(be.y+2,16)}_encodeByte(fe,ve){return(255&fe)<<ve}_encodeShort(fe,ve){return(65535&fe)<<ve}};Txe._encodingInfo={[wxe.R8_SIGNED]:{dataType:BO.BYTE,bytesPerElement:1,count:1,normalized:!1},[wxe.R8_UNSIGNED]:{dataType:BO.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[wxe.R16_SIGNED]:{dataType:BO.SHORT,bytesPerElement:2,count:1,normalized:!1},[wxe.R16_UNSIGNED]:{dataType:BO.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[wxe.R8G8_SIGNED]:{dataType:BO.BYTE,bytesPerElement:1,count:2,normalized:!1},[wxe.R8G8_UNSIGNED]:{dataType:BO.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[wxe.R16G16_SIGNED]:{dataType:BO.SHORT,bytesPerElement:2,count:2,normalized:!1},[wxe.R16G16_UNSIGNED]:{dataType:BO.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[wxe.R8G8B8A8_SIGNED]:{dataType:BO.BYTE,bytesPerElement:1,count:4,normalized:!1},[wxe.R8G8B8A8_UNSIGNED]:{dataType:BO.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[wxe.R8G8B8A8_COLOR]:{dataType:BO.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[wxe.R16G16B16A16_DASHARRAY]:{dataType:BO.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[wxe.R16G16B16A16_PATTERN]:{dataType:BO.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const i$I=fe=>{switch(fe){case BO.FLOAT:case BO.INT:case BO.UNSIGNED_INT:return 4;case BO.SHORT:case BO.UNSIGNED_SHORT:case BO.HALF_FLOAT:return 2;case BO.BYTE:case BO.UNSIGNED_BYTE:return 1}},a$G=(fe,ve,_e)=>{const be=ve/_e;if(1===fe)switch(be){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===fe)switch(be){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===fe)switch(be){case 0:return".xyz";case 1:return".yzw"}return""};let Exe=class T8 extends Txe{constructor(fe){super(fe)}geometryInfo(){return T8.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return T8.ATTRIBUTES}attributesInfo(){return T8.ATTRIBUTES_INFO}};Exe.ATTRIBUTES=[],Exe.GEOMETRY_LAYOUT=[new JA("a_pos",2,BO.BYTE,0,2)],Exe.ATTRIBUTES_INFO={};let Pxe=class t78 extends Txe{constructor(fe){super(fe)}geometryInfo(){return t78.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return t78.ATTRIBUTES}attributesInfo(){return t78.ATTRIBUTES_INFO}};Pxe.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],Pxe.GEOMETRY_LAYOUT=[new JA("a_pos",2,BO.SHORT,0,4)],Pxe.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:wxe.R8_UNSIGNED},"circle-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:wxe.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:wxe.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:wxe.R8_UNSIGNED,precisionFactor:32}};let Cxe=class l43 extends Txe{constructor(fe){super(fe)}geometryInfo(){return l43.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return l43.ATTRIBUTES}attributesInfo(){return l43.ATTRIBUTES_INFO}};Cxe.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],Cxe.GEOMETRY_LAYOUT=[new JA("a_pos",2,BO.SHORT,0,4)],Cxe.ATTRIBUTES_INFO={"fill-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:wxe.R16G16B16A16_PATTERN,isOptional:!0}};let Oxe=class T9 extends Txe{constructor(fe,ve){super(fe),this._usefillColor=ve}geometryInfo(){return T9.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?T9.ATTRIBUTES_FILL:T9.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?T9.ATTRIBUTES_INFO_FILL:T9.ATTRIBUTES_INFO_OUTLINE}};Oxe.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],Oxe.ATTRIBUTES_FILL=["fill-color","fill-opacity"],Oxe.GEOMETRY_LAYOUT=[new JA("a_pos",2,BO.SHORT,0,8),new JA("a_offset",2,BO.BYTE,4,8),new JA("a_xnormal",2,BO.BYTE,6,8)],Oxe.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100}},Oxe.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100}};let Axe=class i46 extends Txe{constructor(fe){super(fe)}geometryInfo(){return i46.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return i46.ATTRIBUTES}attributesInfo(){return i46.ATTRIBUTES_INFO}};Axe.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],Axe.GEOMETRY_LAYOUT=[new JA("a_pos",2,BO.SHORT,0,16),new JA("a_extrude_offset",4,BO.BYTE,4,16),new JA("a_dir_normal",4,BO.BYTE,8,16),new JA("a_accumulatedDistance",2,BO.UNSIGNED_SHORT,12,16)],Axe.ATTRIBUTES_INFO={"line-width":{name:"width",type:wxe.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:wxe.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:wxe.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:wxe.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:wxe.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:wxe.R16G16B16A16_DASHARRAY,isOptional:!0}};const Mxe=[new JA("a_pos",2,BO.SHORT,0,16),new JA("a_vertexOffset",2,BO.SHORT,4,16),new JA("a_texAngleRange",4,BO.UNSIGNED_BYTE,8,16),new JA("a_levelInfo",4,BO.UNSIGNED_BYTE,12,16)],Rxe=[new JA("a_opacityInfo",1,BO.UNSIGNED_BYTE,0,1)];let Ixe=class i47 extends Txe{constructor(fe){super(fe)}geometryInfo(){return Mxe}opacityInfo(){return Rxe}attributes(){return i47.ATTRIBUTES}attributesInfo(){return i47.ATTRIBUTES_INFO}};Ixe.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],Ixe.ATTRIBUTES_INFO={"icon-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:wxe.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:wxe.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:wxe.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:wxe.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};let Lxe=class c44 extends Txe{constructor(fe){super(fe)}geometryInfo(){return Mxe}opacityInfo(){return Rxe}attributes(){return c44.ATTRIBUTES}attributesInfo(){return c44.ATTRIBUTES_INFO}};function e$f(fe,ve,_e,be){const we=3*fe,Se=3*(_e-fe)-we,Te=1-we-Se,Ee=3*ve,Ce=3*(be-ve)-Ee,Oe=1-Ee-Ce;function c50(fe){return((Te*fe+Se)*fe+we)*fe}function b21(fe){return(3*Te*fe+2*Se)*fe+we}return function(fe,ve=1e-6){return function l49(fe){return((Oe*fe+Ce)*fe+Ee)*fe}(function p48(fe,ve){let _e,be,we,Se,Te,Ee;for(we=fe,Ee=0;Ee<8;Ee++){if(Se=c50(we)-fe,Math.abs(Se)<ve)return we;if(Te=b21(we),Math.abs(Te)<1e-6)break;we-=Se/Te}if(_e=0,be=1,we=fe,we<_e)return _e;if(we>be)return be;for(;_e<be;){if(Se=c50(we),Math.abs(Se-fe)<ve)return we;fe>Se?_e=we:be=we,we=.5*(be-_e)+_e}return we}(fe,ve))}}Lxe.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],Lxe.ATTRIBUTES_INFO={"text-color":{name:"color",type:wxe.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:wxe.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:wxe.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:wxe.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:wxe.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:wxe.R8_UNSIGNED,isLayout:!0}};const Dxe={kind:"null"},Nxe={kind:"number"},Fxe={kind:"string"},zxe={kind:"boolean"},kxe={kind:"color"},Uxe={kind:"object"},Vxe={kind:"value"};function a$E(fe,ve){return{kind:"array",itemType:fe,n:ve}}const Bxe=[Dxe,Nxe,Fxe,zxe,kxe,Uxe,a$E(Vxe)];function k$4(fe){if("array"===fe.kind){const ve=k$4(fe.itemType);return"number"==typeof fe.n?`array<${ve}, ${fe.n}>`:"value"===fe.itemType.kind?"array":`array<${ve}>`}return fe.kind}function l$z(fe){if(null===fe)return Dxe;if("string"==typeof fe)return Fxe;if("boolean"==typeof fe)return zxe;if("number"==typeof fe)return Nxe;if(fe instanceof b_)return kxe;if(Array.isArray(fe)){let ve;for(const _e of fe){const fe=l$z(_e);if(ve){if(ve!==fe){ve=Vxe;break}}else ve=fe}return a$E(ve||Vxe,fe.length)}return"object"==typeof fe?Uxe:Vxe}function c$N(fe,ve){if("array"===ve.kind)return"array"===fe.kind&&(0===fe.n&&"value"===fe.itemType.kind||c$N(fe.itemType,ve.itemType))&&("number"!=typeof ve.n||ve.n===fe.n);if("value"===ve.kind)for(const _e of Bxe)if(c$N(fe,_e))return!0;return ve.kind===fe.kind}function d$l(fe){if(null===fe)return"";const ve=typeof fe;return"string"===ve?fe:"number"===ve||"boolean"===ve?String(fe):fe instanceof b_?fe.toString():JSON.stringify(fe)}let jxe=class _19{constructor(fe){this._parent=fe,this._vars={}}add(fe,ve){this._vars[fe]=ve}get(fe){return this._vars[fe]?this._vars[fe]:this._parent?this._parent.get(fe):null}},Gxe=class x13{constructor(){this.type=Nxe}static parse(fe){if(fe.length>1)throw new Error('"zoom" does not expect arguments');return new x13}evaluate(fe,ve){return ve}},Hxe=class E10{constructor(fe,ve,_e){this._lhs=fe,this._rhs=ve,this._compare=_e,this.type=zxe}static parse(fe,ve,_e){if(3!==fe.length&&4!==fe.length)throw new Error(`"${fe[0]}" expects 2 or 3 arguments`);if(4===fe.length)throw new Error(`"${fe[0]}" collator not supported`);return new E10(pt(fe[1],ve),pt(fe[2],ve),_e)}evaluate(fe,ve){return this._compare(this._lhs.evaluate(fe,ve),this._rhs.evaluate(fe,ve))}},qxe=class P7{constructor(fe,ve,_e,be,we){this._operator=fe,this.type=ve,this.interpolation=_e,this.input=be,this._stops=we}static parse(fe,ve,_e){const be=fe[0];if(fe.length<5)throw new Error(`"${be}" expects at least 4 arguments`);const we=fe[1];if(!Array.isArray(we)||0===we.length)throw new Error(`"${we}" is not a valid interpolation`);switch(we[0]){case"linear":if(1!==we.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==we.length||"number"!=typeof we[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==we.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let fe=1;fe<5;fe++){const ve=we[fe];if("number"!=typeof ve||ve<0||ve>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${fe[0]}" unknown interpolation type "${we[0]}"`)}if(fe.length%2!=1)throw new Error(`"${be}" expects an even number of arguments`);const Se=pt(fe[2],ve,Nxe);let Te;"interpolate-hcl"===be||"interpolate-lab"===be?Te=kxe:_e&&"value"!==_e.kind&&(Te=_e);const Ee=[];for(let Ce=3;Ce<fe.length;Ce+=2){const _e=fe[Ce];if("number"!=typeof _e)throw new Error(`"${be}" requires stop inputs as literal numbers`);if(Ee.length&&Ee[Ee.length-1][0]>=_e)throw new Error(`"${be}" requires strictly ascending stop inputs`);const we=pt(fe[Ce+1],ve,Te);Te||(Te=we.type),Ee.push([_e,we])}if(Te&&Te!==kxe&&Te!==Nxe&&("array"!==Te.kind||Te.itemType!==Nxe))throw new Error(`"${be}" cannot interpolate type ${k$4(Te)}`);return new P7(be,Te,we,Se,Ee)}evaluate(fe,ve){const _e=this._stops;if(1===_e.length)return _e[0][1].evaluate(fe,ve);const be=this.input.evaluate(fe,ve);if(be<=_e[0][0])return _e[0][1].evaluate(fe,ve);if(be>=_e[_e.length-1][0])return _e[_e.length-1][1].evaluate(fe,ve);let we=0;for(;++we<_e.length&&!(be<_e[we][0]););const Se=_e[we-1][0],Te=_e[we][0],Ee=P7.interpolationRatio(this.interpolation,be,Se,Te),Ce=_e[we-1][1].evaluate(fe,ve),Oe=_e[we][1].evaluate(fe,ve);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(Ce)&&Array.isArray(Oe))return Ce.map(((fe,ve)=>p$20(fe,Oe[ve],Ee)));if("color"===this.type.kind&&Ce instanceof b_&&Oe instanceof b_){const fe=new b_(Ce),ve=new b_(Oe);return new b_([p$20(fe.r,ve.r,Ee),p$20(fe.g,ve.g,Ee),p$20(fe.b,ve.b,Ee),p$20(fe.a,ve.a,Ee)])}if("number"===this.type.kind&&"number"==typeof Ce&&"number"==typeof Oe)return p$20(Ce,Oe,Ee);throw new Error(`"${this._operator}" cannot interpolate type ${k$4(this.type)}`)}if("interpolate-hcl"===this._operator){const fe=j$1b(Ce),ve=j$1b(Oe),_e=ve.h-fe.h,be=y$1A({h:fe.h+Ee*(_e>180||_e<-180?_e-360*Math.round(_e/360):_e),c:p$20(fe.c,ve.c,Ee),l:p$20(fe.l,ve.l,Ee)});return new b_({a:p$20(Ce.a,Oe.a,Ee),...be})}if("interpolate-lab"===this._operator){const fe=A$1f(Ce),ve=A$1f(Oe),_e=y$1A({l:p$20(fe.l,ve.l,Ee),a:p$20(fe.a,ve.a,Ee),b:p$20(fe.b,ve.b,Ee)});return new b_({a:p$20(Ce.a,Oe.a,Ee),..._e})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(fe,ve){const _e=this._stops;if(1===_e.length)return 0;if(fe>=_e[_e.length-1][0])return 0;let be=0;for(;++be<_e.length&&!(fe<_e[be][0]););const we=_e[be-1][0],Se=_e[be][0];return P7.interpolationRatio(this.interpolation,ve,we,Se)}getInterpolationRange(fe){const ve=this._stops;if(1===ve.length){const fe=ve[0][0];return[fe,fe]}const _e=ve[ve.length-1][0];if(fe>=_e)return[_e,_e];let be=0;for(;++be<ve.length&&!(fe<ve[be][0]););return[ve[be-1][0],ve[be][0]]}static interpolationRatio(fe,ve,_e,be){let we=0;return"linear"===fe[0]?we=P7._exponentialInterpolationRatio(ve,1,_e,be):"exponential"===fe[0]?we=P7._exponentialInterpolationRatio(ve,fe[1],_e,be):"cubic-bezier"===fe[0]&&(we=e$f(fe[1],fe[2],fe[3],fe[4])(P7._exponentialInterpolationRatio(ve,1,_e,be),1e-5)),we<0?we=0:we>1&&(we=1),we}static _exponentialInterpolationRatio(fe,ve,_e,be){const we=be-_e;if(0===we)return 0;const Se=fe-_e;return 1===ve?Se/we:(ve**Se-1)/(ve**we-1)}},Wxe=class Q4{constructor(fe,ve){this._args=fe,this._calculate=ve,this.type=Nxe}static parse(fe,ve,_e){const be=fe.slice(1).map((fe=>pt(fe,ve)));return new Q4(be,_e)}evaluate(fe,ve){let _e;return this._args&&(_e=this._args.map((_e=>_e.evaluate(fe,ve)))),this._calculate(_e)}};class rt3{constructor(fe,ve){this._args=fe,this._calculate=ve,this.type=Nxe}static parse(fe,ve){const _e=fe.slice(1).map((fe=>pt(fe,ve)));return new rt3(_e,rt3.ops[fe[0]])}evaluate(fe,ve){let _e;return this._args&&(_e=this._args.map((_e=>_e.evaluate(fe,ve)))),this._calculate(_e)}}rt3.ops={abs:fe=>Math.abs(fe[0]),acos:fe=>Math.acos(fe[0]),asin:fe=>Math.asin(fe[0]),atan:fe=>Math.atan(fe[0]),ceil:fe=>Math.ceil(fe[0]),cos:fe=>Math.cos(fe[0]),e:()=>Math.E,floor:fe=>Math.floor(fe[0]),ln:fe=>Math.log(fe[0]),ln2:()=>Math.LN2,log10:fe=>Math.log(fe[0])/Math.LN10,log2:fe=>Math.log(fe[0])/Math.LN2,max:fe=>Math.max(...fe),min:fe=>Math.min(...fe),pi:()=>Math.PI,round:fe=>Math.round(fe[0]),sin:fe=>Math.sin(fe[0]),sqrt:fe=>Math.sqrt(fe[0]),tan:fe=>Math.tan(fe[0])};class st{constructor(fe){this._args=fe,this.type=Fxe}static parse(fe,ve){return new st(fe.slice(1).map((fe=>pt(fe,ve))))}evaluate(fe,ve){return this._args.map((_e=>_e.evaluate(fe,ve))).join("")}}class nt{constructor(fe,ve){this._arg=fe,this._calculate=ve,this.type=Fxe}static parse(fe,ve){if(2!==fe.length)throw new Error(`${fe[0]} expects 1 argument`);const _e=pt(fe[1],ve);return new nt(_e,nt.ops[fe[0]])}evaluate(fe,ve){return this._calculate(this._arg.evaluate(fe,ve))}}nt.ops={downcase:fe=>fe.toLowerCase(),upcase:fe=>fe.toUpperCase()};class at{constructor(fe){this._args=fe,this.type=kxe}static parse(fe,ve){if(4!==fe.length)throw new Error('"rgb" expects 3 arguments');const _e=fe.slice(1).map((fe=>pt(fe,ve)));return new at(_e)}evaluate(fe,ve){const _e=this._validate(this._args[0].evaluate(fe,ve)),be=this._validate(this._args[1].evaluate(fe,ve)),we=this._validate(this._args[2].evaluate(fe,ve));return new b_({r:_e,g:be,b:we})}_validate(fe){if("number"!=typeof fe||fe<0||fe>255)throw new Error(`${fe}: invalid color component`);return Math.round(fe)}}class ot{constructor(fe){this._args=fe,this.type=kxe}static parse(fe,ve){if(5!==fe.length)throw new Error('"rgba" expects 4 arguments');const _e=fe.slice(1).map((fe=>pt(fe,ve)));return new ot(_e)}evaluate(fe,ve){const _e=this._validate(this._args[0].evaluate(fe,ve)),be=this._validate(this._args[1].evaluate(fe,ve)),we=this._validate(this._args[2].evaluate(fe,ve)),Se=this._validateAlpha(this._args[3].evaluate(fe,ve));return new b_({r:_e,g:be,b:we,a:Se})}_validate(fe){if("number"!=typeof fe||fe<0||fe>255)throw new Error(`${fe}: invalid color component`);return Math.round(fe)}_validateAlpha(fe){if("number"!=typeof fe||fe<0||fe>1)throw new Error(`${fe}: invalid alpha color component`);return fe}}class it{constructor(fe){this._color=fe,this.type=a$E(Nxe,4)}static parse(fe,ve){if(2!==fe.length)throw new Error('"to-rgba" expects 1 argument');const _e=pt(fe[1],ve);return new it(_e)}evaluate(fe,ve){return new b_(this._color.evaluate(fe,ve)).toRgba()}}class lt{constructor(fe,ve){this.type=fe,this._args=ve}static parse(fe,ve){const _e=fe[0];if(fe.length<2)throw new Error(`${_e} expects at least one argument`);let be,we=1;if("array"===_e){if(fe.length>2){switch(fe[1]){case"string":be=Fxe;break;case"number":be=Nxe;break;case"boolean":be=zxe;break;default:throw new Error('"array" type argument must be string, number or boolean')}we++}else be=Vxe;let ve;if(fe.length>3){if(ve=fe[2],null!==ve&&("number"!=typeof ve||ve<0||ve!==Math.floor(ve)))throw new Error('"array" length argument must be a positive integer literal');we++}be=a$E(be,ve)}else switch(_e){case"string":be=Fxe;break;case"number":be=Nxe;break;case"boolean":be=zxe;break;case"object":be=Uxe}const Se=[];for(;we<fe.length;we++){const _e=pt(fe[we],ve);Se.push(_e)}return new lt(be,Se)}evaluate(fe,ve){let _e;for(const be of this._args){const we=be.evaluate(fe,ve);if(_e=l$z(we),c$N(_e,this.type))return we}throw new Error(`Expected ${k$4(this.type)} but got ${k$4(_e)}`)}}class ut{constructor(fe,ve){this.type=fe,this._args=ve}static parse(fe,ve){const _e=fe[0],be=ut.types[_e];if(be===zxe||be===Fxe){if(2!==fe.length)throw new Error(`${_e} expects one argument`)}else if(fe.length<2)throw new Error(`${_e} expects at least one argument`);const we=[];for(let Se=1;Se<fe.length;Se++){const _e=pt(fe[Se],ve);we.push(_e)}return new ut(be,we)}evaluate(fe,ve){if(this.type===zxe)return Boolean(this._args[0].evaluate(fe,ve));if(this.type===Fxe)return d$l(this._args[0].evaluate(fe,ve));if(this.type===Nxe){for(const _e of this._args){const be=Number(_e.evaluate(fe,ve));if(!isNaN(be))return be}return null}if(this.type===kxe){for(const _e of this._args)try{const be=ut.toColor(_e.evaluate(fe,ve));if(be instanceof b_)return be}catch{}return null}}static toBoolean(fe){return Boolean(fe)}static toString(fe){return d$l(fe)}static toNumber(fe){const ve=Number(fe);if(isNaN(ve))throw new Error(`"${fe}" is not a number`);return ve}static toColor(fe){if(fe instanceof b_)return fe;if("string"==typeof fe){const ve=b_.fromString(fe);if(ve)return ve;throw new Error(`"${fe}" is not a color`)}if(Array.isArray(fe))return b_.fromArray(fe);throw new Error(`"${fe}" is not a color`)}}ut.types={"to-boolean":zxe,"to-color":kxe,"to-number":Nxe,"to-string":Fxe};class ct{constructor(fe){this._val=fe,this.type=l$z(fe)}static parse(fe){if(2!==fe.length)throw new Error('"literal" expects 1 argument');return new ct(fe[1])}evaluate(fe,ve){return this._val}}class ht{constructor(fe){this._arg=fe,this.type=Fxe}static parse(fe,ve){if(2!==fe.length)throw new Error('"typeof" expects 1 argument');return new ht(pt(fe[1],ve))}evaluate(fe,ve){return k$4(l$z(this._arg.evaluate(fe,ve)))}}function pt(fe,ve,_e){const be=typeof fe;if("string"===be||"boolean"===be||"number"===be||null===fe){if(_e)switch(_e.kind){case"string":"string"!==be&&(fe=ut.toString(fe));break;case"number":"number"!==be&&(fe=ut.toNumber(fe));break;case"color":fe=ut.toColor(fe)}fe=["literal",fe]}if(!Array.isArray(fe)||0===fe.length)throw new Error("Expression must be a non empty array");const we=fe[0];if("string"!=typeof we)throw new Error("First element of expression must be a string");const Se=Yxe[we];if(void 0===Se)throw new Error(`Invalid expression operator "${we}"`);if(!Se)throw new Error(`Unimplemented expression operator "${we}"`);return Se.parse(fe,ve,_e)}const Yxe={array:lt,boolean:lt,collator:null,format:null,image:null,literal:ct,number:lt,"number-format":null,object:lt,string:lt,"to-boolean":ut,"to-color":ut,"to-number":ut,"to-string":ut,typeof:ht,accumulated:null,"feature-state":null,"geometry-type":class b19{constructor(){this.type=Fxe}static parse(fe){if(fe.length>1)throw new Error('"geometry-type" does not expect arguments');return new b19}evaluate(fe,ve){if(!fe)return null;switch(fe.type){case hK.Point:return"Point";case hK.LineString:return"LineString";case hK.Polygon:return"Polygon";default:return null}}},id:class v14{constructor(){this.type=Vxe}static parse(fe){if(fe.length>1)throw new Error('"id" does not expect arguments');return new v14}evaluate(fe,ve){return null==fe?void 0:fe.id}},"line-progress":null,properties:class d32{constructor(){this.type=Uxe}static parse(fe){if(fe.length>1)throw new Error('"properties" does not expect arguments');return new d32}evaluate(fe,ve){return null==fe?void 0:fe.values}},at:class O13{constructor(fe,ve,_e){this.type=fe,this._index=ve,this._array=_e}static parse(fe,ve){if(3!==fe.length)throw new Error('"at" expects 2 arguments');const _e=pt(fe[1],ve,Nxe),be=pt(fe[2],ve);return new O13(be.type.itemType,_e,be)}evaluate(fe,ve){const _e=this._index.evaluate(fe,ve),be=this._array.evaluate(fe,ve);if(_e<0||_e>=be.length)throw new Error('"at" index out of bounds');if(_e!==Math.floor(_e))throw new Error('"at" index must be an integer');return be[_e]}},get:class F5{constructor(fe,ve){this._key=fe,this._obj=ve,this.type=Vxe}static parse(fe,ve){let _e,be;switch(fe.length){case 2:return _e=pt(fe[1],ve),new F5(_e);case 3:return _e=pt(fe[1],ve),be=pt(fe[2],ve),new F5(_e,be);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(fe,ve){const _e=this._key.evaluate(fe,ve);return this._obj?this._obj.evaluate(fe,ve)[_e]:null==fe?void 0:fe.values[_e]}},has:class G8{constructor(fe,ve){this._key=fe,this._obj=ve,this.type=zxe}static parse(fe,ve){let _e,be;switch(fe.length){case 2:return _e=pt(fe[1],ve),new G8(_e);case 3:return _e=pt(fe[1],ve),be=pt(fe[2],ve),new G8(_e,be);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(fe,ve){const _e=this._key.evaluate(fe,ve);return this._obj?_e in this._obj.evaluate(fe,ve):!!(null==fe?void 0:fe.values[_e])}},in:class V6{constructor(fe,ve){this._key=fe,this._vals=ve,this.type=zxe}static parse(fe,ve){if(3!==fe.length)throw new Error('"in" expects 2 arguments');return new V6(pt(fe[1],ve),pt(fe[2],ve))}evaluate(fe,ve){const _e=this._key.evaluate(fe,ve);return this._vals.evaluate(fe,ve).includes(_e)}},"index-of":class D3{constructor(fe,ve,_e){this._item=fe,this._array=ve,this._from=_e,this.type=Nxe}static parse(fe,ve){if(fe.length<3||fe.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const _e=pt(fe[1],ve),be=pt(fe[2],ve);if(4===fe.length){const we=pt(fe[3],ve,Nxe);return new D3(_e,be,we)}return new D3(_e,be)}evaluate(fe,ve){const _e=this._item.evaluate(fe,ve),be=this._array.evaluate(fe,ve);if(this._from){const we=this._from.evaluate(fe,ve);if(we!==Math.floor(we))throw new Error('"index-of" index must be an integer');return be.indexOf(_e,we)}return be.indexOf(_e)}},length:class H5{constructor(fe){this._arg=fe,this.type=Nxe}static parse(fe,ve){if(2!==fe.length)throw new Error('"length" expects 2 arguments');const _e=pt(fe[1],ve);return new H5(_e)}evaluate(fe,ve){const _e=this._arg.evaluate(fe,ve);if("string"==typeof _e)return _e.length;if(Array.isArray(_e))return _e.length;throw new Error('"length" expects string or array')}},slice:class J3{constructor(fe,ve,_e,be){this.type=fe,this._array=ve,this._from=_e,this._to=be}static parse(fe,ve){if(fe.length<3||fe.length>4)throw new Error('"slice" expects 2 or 3 arguments');const _e=pt(fe[1],ve),be=pt(fe[2],ve,Nxe);if(be.type!==Nxe)throw new Error('"slice" index must return a number');if(4===fe.length){const we=pt(fe[3],ve,Nxe);if(we.type!==Nxe)throw new Error('"slice" index must return a number');return new J3(_e.type,_e,be,we)}return new J3(_e.type,_e,be)}evaluate(fe,ve){const _e=this._array.evaluate(fe,ve);if(!Array.isArray(_e)&&"string"!=typeof _e)throw new Error('"slice" input must be an array or a string');const be=this._from.evaluate(fe,ve);if(be<0||be>=_e.length)throw new Error('"slice" index out of bounds');if(be!==Math.floor(be))throw new Error('"slice" index must be an integer');if(this._to){const we=this._to.evaluate(fe,ve);if(we<0||we>=_e.length)throw new Error('"slice" index out of bounds');if(we!==Math.floor(we))throw new Error('"slice" index must be an integer');return _e.slice(be,we)}return _e.slice(be)}},"!":class N11{constructor(fe){this._arg=fe,this.type=zxe}static parse(fe,ve){if(2!==fe.length)throw new Error('"!" expects 1 argument');return new N11(pt(fe[1],ve))}evaluate(fe,ve){return!this._arg.evaluate(fe,ve)}},"!=":class M8 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe!==ve))}},"<":class k7 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe<ve))}},"<=":class A13 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe<=ve))}},"==":class $3 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe===ve))}},">":class j11 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe>ve))}},">=":class q6 extends Hxe{static parse(fe,ve){return Hxe.parse(fe,ve,((fe,ve)=>fe>=ve))}},all:class C10{constructor(fe){this._args=fe,this.type=zxe}static parse(fe,ve){const _e=[];for(let be=1;be<fe.length;be++)_e.push(pt(fe[be],ve));return new C10(_e)}evaluate(fe,ve){for(const _e of this._args)if(!_e.evaluate(fe,ve))return!1;return!0}},any:class R8{constructor(fe){this._args=fe,this.type=zxe}static parse(fe,ve){const _e=[];for(let be=1;be<fe.length;be++)_e.push(pt(fe[be],ve));return new R8(_e)}evaluate(fe,ve){for(const _e of this._args)if(_e.evaluate(fe,ve))return!0;return!1}},case:class I9{constructor(fe,ve,_e){this.type=fe,this._args=ve,this._fallback=_e}static parse(fe,ve,_e){if(fe.length<4)throw new Error('"case" expects at least 3 arguments');if(fe.length%2==1)throw new Error('"case" expects an odd number of arguments');let be;const we=[];for(let Te=1;Te<fe.length-1;Te+=2){const Se=pt(fe[Te],ve),Ee=pt(fe[Te+1],ve,_e);be||(be=Ee.type),we.push({condition:Se,output:Ee})}const Se=pt(fe[fe.length-1],ve,_e);return be||(be=Se.type),new I9(be,we,Se)}evaluate(fe,ve){for(const _e of this._args)if(_e.condition.evaluate(fe,ve))return _e.output.evaluate(fe,ve);return this._fallback.evaluate(fe,ve)}},coalesce:class L8{constructor(fe,ve){this.type=fe,this._args=ve}static parse(fe,ve){if(fe.length<2)throw new Error('"coalesce" expects at least 1 argument');let _e;const be=[];for(let we=1;we<fe.length;we++){const Se=pt(fe[we],ve);_e||(_e=Se.type),be.push(Se)}return new L8(_e,be)}evaluate(fe,ve){for(const _e of this._args){const be=_e.evaluate(fe,ve);if(null!==be)return be}return null}},match:class U7{constructor(fe,ve,_e,be,we){this.type=fe,this._input=ve,this._labels=_e,this._outputs=be,this._fallback=we}static parse(fe,ve){if(fe.length<3)throw new Error('"match" expects at least 3 arguments');if(fe.length%2==0)throw new Error('"case" expects an even number of arguments');let _e;const be=pt(fe[1],ve),we=[],Se={};let Te;for(let Ee=2;Ee<fe.length-1;Ee+=2){let be=fe[Ee];Array.isArray(be)||(be=[be]);for(const fe of be){const ve=typeof fe;if("string"!==ve&&"number"!==ve)throw new Error('"match" requires string or number literal as labels');if(Te){if(ve!==Te)throw new Error('"match" requires labels to have the same type')}else Te=ve;Se[fe]=we.length}const Ce=pt(fe[Ee+1],ve);_e||(_e=Ce.type),we.push(Ce)}return new U7(_e,be,Se,we,pt(fe[fe.length-1],ve))}evaluate(fe,ve){const _e=this._input.evaluate(fe,ve);return(this._outputs[this._labels[_e]]||this._fallback).evaluate(fe,ve)}},within:null,interpolate:qxe,"interpolate-hcl":qxe,"interpolate-lab":qxe,step:class S12{constructor(fe,ve,_e){this.type=fe,this._input=ve,this._stops=_e}static parse(fe,ve){if(fe.length<5)throw new Error('"step" expects at least 4 arguments');if(fe.length%2!=1)throw new Error('"step" expects an even number of arguments');const _e=pt(fe[1],ve,Nxe);let be;const we=[];we.push([-1/0,pt(fe[2],ve)]);for(let Se=3;Se<fe.length;Se+=2){const _e=fe[Se];if("number"!=typeof _e)throw new Error('"step" requires stop inputs as literal numbers');if(we.length&&we[we.length-1][0]>=_e)throw new Error('"step" requires strictly ascending stop inputs');const Te=pt(fe[Se+1],ve);be||(be=Te.type),we.push([_e,Te])}return new S12(be,_e,we)}evaluate(fe,ve){const _e=this._stops;if(1===_e.length)return _e[0][1].evaluate(fe,ve);const be=this._input.evaluate(fe,ve);let we=0;for(;++we<_e.length&&!(be<_e[we][0]););return this._stops[we-1][1].evaluate(fe,ve)}},let:class B9{constructor(fe,ve){this.type=fe,this._output=ve}static parse(fe,ve,_e){if(fe.length<4)throw new Error('"let" expects at least 3 arguments');if(fe.length%2==1)throw new Error('"let" expects an odd number of arguments');const be=new jxe(ve);for(let Se=1;Se<fe.length-1;Se+=2){const _e=fe[Se];if("string"!=typeof _e)throw new Error(`"let" requires a string to define variable names - found ${_e}`);be.add(_e,pt(fe[Se+1],ve))}const we=pt(fe[fe.length-1],be,_e);return new B9(we.type,we)}evaluate(fe,ve){return this._output.evaluate(fe,ve)}},var:class T10{constructor(fe,ve){this.type=fe,this.output=ve}static parse(fe,ve,_e){if(2!==fe.length||"string"!=typeof fe[1])throw new Error('"var" requires just one literal string argument');const be=ve.get(fe[1]);if(!be)throw new Error(`${fe[1]} must be defined before being used in a "var" expression`);return new T10(_e||Vxe,be)}evaluate(fe,ve){return this.output.evaluate(fe,ve)}},concat:st,downcase:nt,"is-supported-script":null,"resolved-locale":null,upcase:nt,rgb:at,rgba:ot,"to-rgba":it,"-":class W3 extends Wxe{static parse(fe,ve){switch(fe.length){case 2:return Wxe.parse(fe,ve,(fe=>-fe[0]));case 3:return Wxe.parse(fe,ve,(fe=>fe[0]-fe[1]));default:throw new Error('"-" expects 1 or 2 arguments')}}},"*":class X2 extends Wxe{static parse(fe,ve){return Wxe.parse(fe,ve,(fe=>{let ve=1;for(const _e of fe)ve*=_e;return ve}))}},"/":class Y2 extends Wxe{static parse(fe,ve){if(3===fe.length)return Wxe.parse(fe,ve,(fe=>fe[0]/fe[1]));throw new Error('"/" expects 2 arguments')}},"%":class Z3 extends Wxe{static parse(fe,ve){if(3===fe.length)return Wxe.parse(fe,ve,(fe=>fe[0]%fe[1]));throw new Error('"%" expects 2 arguments')}},"^":class tt4 extends Wxe{static parse(fe,ve){if(3===fe.length)return Wxe.parse(fe,ve,(fe=>fe[0]**fe[1]));throw new Error('"^" expects 1 or 2 arguments')}},"+":class et2 extends Wxe{static parse(fe,ve){return Wxe.parse(fe,ve,(fe=>{let ve=0;for(const _e of fe)ve+=_e;return ve}))}},abs:rt3,acos:rt3,asin:rt3,atan:rt3,ceil:rt3,cos:rt3,e:rt3,floor:rt3,ln:rt3,ln2:rt3,log10:rt3,log2:rt3,max:rt3,min:rt3,pi:rt3,round:rt3,sin:rt3,sqrt:rt3,tan:rt3,zoom:Gxe,"heatmap-density":null,"has-id":class K3{constructor(){this.type=zxe}static parse(fe){if(1!==fe.length)throw new Error('"has-id" expects no arguments');return new K3}evaluate(fe,ve){return void 0!==(null==fe?void 0:fe.id)}},none:class z8{constructor(fe){this._args=fe,this.type=zxe}static parse(fe,ve){const _e=[];for(let be=1;be<fe.length;be++)_e.push(pt(fe[be],ve));return new z8(_e)}evaluate(fe,ve){for(const _e of this._args)if(_e.evaluate(fe,ve))return!1;return!0}}};let Zxe=class t79{constructor(fe){this._expression=fe}filter(fe,ve){if(!this._expression)return!0;try{return this._expression.evaluate(fe,ve)}catch(t84){return!0}}static createFilter(fe){if(!fe)return null;this.isLegacyFilter(fe)&&(fe=this.convertLegacyFilter(fe));try{const ve=pt(fe,null,zxe);return new t79(ve)}catch(vv){return null}}static isLegacyFilter(fe){if(!Array.isArray(fe))return!0;if(0===fe.length)return!0;switch(fe[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===fe.length&&"string"==typeof fe[1]&&!Array.isArray(fe[2]);case"in":return fe.length>=3&&"string"==typeof fe[1]&&!Array.isArray(fe[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let ve=1;ve<fe.length;ve++)if(this.isLegacyFilter(fe[ve]))return!0;return!1;case"has":return 2===fe.length&&("$id"===fe[1]||"$type"===fe[1]);default:return!1}}static convertLegacyFilter(fe){if(!Array.isArray(fe)||0===fe.length)return!0;const ve=fe[0];if(1===fe.length)return"any"!==ve;switch(ve){case"==":return t79.convertComparison("==",fe[1],fe[2]);case"!=":return t79.negate(t79.convertComparison("==",fe[1],fe[2]));case">":case"<":case">=":case"<=":return t79.convertComparison(ve,fe[1],fe[2]);case"in":return t79.convertIn(fe[1],fe.slice(2));case"!in":return t79.negate(t79.convertIn(fe[1],fe.slice(2)));case"any":case"all":case"none":return t79.convertCombining(ve,fe.slice(1));case"has":return t79.convertHas(fe[1]);case"!has":return t79.negate(t79.convertHas(fe[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(fe,ve,_e){switch(ve){case"$type":return[fe,["geometry-type"],_e];case"$id":return[fe,["id"],_e];default:return[fe,["get",ve],_e]}}static convertIn(fe,ve){switch(fe){case"$type":return["in",["geometry-type"],["literal",ve]];case"$id":return["in",["id"],["literal",ve]];default:return["in",["get",fe],["literal",ve]]}}static convertHas(fe){switch(fe){case"$type":return!0;case"$id":return["has-id"];default:return["has",fe]}}static convertCombining(fe,ve){return[fe].concat(ve.map(this.convertLegacyFilter))}static negate(fe){return["!",fe]}},Xxe=class h31{constructor(fe,ve){let _e;switch(this.isDataDriven=!1,this.interpolator=null,fe.type){case"number":case"color":_e=!0;break;case"array":_e="number"===fe.value;break;default:_e=!1}if(null==ve&&(ve=fe.default),Array.isArray(ve)&&ve.length>0&&Yxe[ve[0]]){const _e={number:Nxe,color:kxe,string:Fxe,boolean:zxe,enum:Fxe};try{const be=pt(ve,null,"array"===fe.type?a$E(_e[fe.value]||Vxe,fe.length):_e[fe.type]);this.getValue=this._buildExpression(be,fe),this.isDataDriven=!0,be instanceof qxe&&be.input instanceof Gxe&&(this.interpolator=be)}catch(we){this.getValue=this._buildSimple(fe.default)}return}_e&&"interval"===ve.type&&(_e=!1);const be=(null==ve?void 0:ve.stops)&&ve.stops.length>0;if(be)for(const Se of ve.stops)Se[1]=this._validate(Se[1],fe);if(this.isDataDriven=!!ve&&!!ve.property,this.isDataDriven)if(void 0!==ve.default&&(ve.default=this._validate(ve.default,fe)),be)switch(ve.type){case"identity":this.getValue=this._buildIdentity(ve,fe);break;case"categorical":this.getValue=this._buildCategorical(ve,fe);break;default:this.getValue=_e?this._buildInterpolate(ve,fe):this._buildInterval(ve,fe)}else this.getValue=this._buildIdentity(ve,fe);else be?this.getValue=_e?this._buildZoomInterpolate(ve):this._buildZoomInterval(ve):(ve=this._validate(ve,fe),this.getValue=this._buildSimple(ve))}_validate(fe,ve){if("number"===ve.type){if(null!=ve.minimum&&fe<ve.minimum)return ve.minimum;if(null!=ve.maximum&&fe>ve.maximum)return ve.maximum}else"color"===ve.type?fe=h31._parseColor(fe):"enum"===ve.type?"string"==typeof fe&&(fe=ve.values.indexOf(fe)):"array"===ve.type&&"enum"===ve.value?fe=fe.map((fe=>"string"==typeof fe?ve.values.indexOf(fe):fe)):"string"===ve.type&&(fe=d$l(fe));return fe}_buildSimple(fe){return()=>fe}_buildExpression(fe,ve){return(_e,be)=>{try{const we=fe.evaluate(be,_e);return void 0===we?ve.default:this._validate(we,ve)}catch(Yf){return ve.default}}}_buildIdentity(fe,ve){return(_e,be)=>{let we;return be&&(we=be.values[fe.property]),void 0!==we&&(we=this._validate(we,ve)),null!=we?we:void 0!==fe.default?fe.default:ve.default}}_buildCategorical(fe,ve){return(_e,be)=>{let we;return be&&(we=be.values[fe.property]),we=this._categorical(we,fe.stops),void 0!==we?we:void 0!==fe.default?fe.default:ve.default}}_buildInterval(fe,ve){return(_e,be)=>{let we;return be&&(we=be.values[fe.property]),"number"==typeof we?this._interval(we,fe.stops):void 0!==fe.default?fe.default:ve.default}}_buildInterpolate(fe,ve){return(_e,be)=>{let we;return be&&(we=be.values[fe.property]),"number"==typeof we?this._interpolate(we,fe.stops,fe.base||1):void 0!==fe.default?fe.default:ve.default}}_buildZoomInterpolate(fe){return ve=>this._interpolate(ve,fe.stops,fe.base||1)}_buildZoomInterval(fe){return ve=>this._interval(ve,fe.stops)}_categorical(fe,ve){const _e=ve.length;for(let be=0;be<_e;be++)if(ve[be][0]===fe)return ve[be][1]}_interval(fe,ve){const _e=ve.length;let be=0;for(let we=0;we<_e&&ve[we][0]<=fe;we++)be=we;return ve[be][1]}_interpolate(fe,ve,_e){let be,we;const Se=ve.length;for(let Te=0;Te<Se;Te++){const _e=ve[Te];if(!(_e[0]<=fe)){we=_e;break}be=_e}if(be&&we){const ve=we[0]-be[0],Se=fe-be[0],Te=1===_e?Se/ve:(_e**Se-1)/(_e**ve-1);if(Array.isArray(be[1])){const fe=be[1],ve=we[1],_e=[];for(let be=0;be<fe.length;be++)_e.push(p$20(fe[be],ve[be],Te));return _e}return p$20(be[1],we[1],Te)}return be?be[1]:we?we[1]:void 0}static _isEmpty(fe){for(const ve in fe)if(fe.hasOwnProperty(ve))return!1;return!0}static _parseColor(fe){return Array.isArray(fe)?fe:("string"==typeof fe&&(fe=new b_(fe)),fe instanceof b_&&!this._isEmpty(fe)?b_.toUnitRGBA(fe):void 0)}};var Jxe;!function(fe){fe[fe.BUTT=0]="BUTT",fe[fe.ROUND=1]="ROUND",fe[fe.SQUARE=2]="SQUARE",fe[fe.UNKNOWN=4]="UNKNOWN"}(Jxe||(Jxe={}));let Qxe=class T11{constructor(fe,ve,_e,be){switch(this.type=fe,this.typeName=ve.type,this.id=ve.id,this.source=ve.source,this.sourceLayer=ve["source-layer"],this.minzoom=ve.minzoom,this.maxzoom=ve.maxzoom,this.filter=ve.filter,this.layout=ve.layout,this.paint=ve.paint,this.z=_e,this.uid=be,fe){case ape.BACKGROUND:this._layoutDefinition=ype.backgroundLayoutDefinition,this._paintDefinition=ype.backgroundPaintDefinition;break;case ape.FILL:this._layoutDefinition=ype.fillLayoutDefinition,this._paintDefinition=ype.fillPaintDefinition;break;case ape.LINE:this._layoutDefinition=ype.lineLayoutDefinition,this._paintDefinition=ype.linePaintDefinition;break;case ape.SYMBOL:this._layoutDefinition=ype.symbolLayoutDefinition,this._paintDefinition=ype.symbolPaintDefinition;break;case ape.CIRCLE:this._layoutDefinition=ype.circleLayoutDefinition,this._paintDefinition=ype.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=Zxe.createFilter(this.filter)}getLayoutProperty(fe){return this._layoutProperties[fe]}getPaintProperty(fe){return this._paintProperties[fe]}getLayoutValue(fe,ve,_e){let be;const we=this._layoutProperties[fe];return we&&(be=we.getValue(ve,_e)),void 0===be&&(be=this._layoutDefinition[fe].default),be}getPaintValue(fe,ve,_e){let be;const we=this._paintProperties[fe];return we&&(be=we.getValue(ve,_e)),void 0===be&&(be=this._paintDefinition[fe].default),be}isPainterDataDriven(){const fe=this._paintProperties;if(fe)for(const ve in fe)if(fe[ve].isDataDriven)return!0;return!1}isIntersectingFeature(fe,ve,_e,be,we,Se,Te){return!1}getFeatureInflatedBounds(fe,ve,_e,be){return null}_parseLayout(fe){const ve={};for(const _e in fe){const be=this._layoutDefinition[_e];be&&(ve[_e]=new Xxe(be,fe[_e]))}return ve}_parsePaint(fe){const ve={};for(const _e in fe){const be=this._paintDefinition[_e];be&&(ve[_e]=new Xxe(be,fe[_e]))}return ve}computeAttributesKey(fe,ve,_e,be){let we=0,Se=0;for(const Te of ve){let fe=3;if(!Te||Te!==be){const ve=_e[Te],{isLayout:be,isOptional:we}=ve,Se=be?this.getLayoutProperty(Te):this.getPaintProperty(Te);fe=(null==Se?void 0:Se.interpolator)?2:(null==Se?void 0:Se.isDataDriven)?1:we&&!Se?3:0}Se|=fe<<we,we+=2}return Se<<3|fe}},Kxe=class V7 extends Qxe{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this.backgroundMaterial=new Exe(this.computeAttributesKey(hue.BACKGROUND,Exe.ATTRIBUTES,Exe.ATTRIBUTES_INFO))}},eSe=class v15 extends Qxe{constructor(fe,ve,_e,be){super(fe,ve,_e,be);const we=this.getPaintProperty("fill-color"),Se=this.getPaintProperty("fill-opacity"),Te=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=null==we?void 0:we.isDataDriven,this.hasDataDrivenOpacity=null==Se?void 0:Se.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(null==Te?void 0:Te.isDataDriven);const Ee=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!Ee,this.hasDataDrivenOutlineColor=null==Ee?void 0:Ee.isDataDriven,this.hasDataDrivenOutline=Ee?Ee.isDataDriven:!!we&&we.isDataDriven,this.hasDataDrivenOutline=(Ee?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new Cxe(this.computeAttributesKey(hue.FILL,Cxe.ATTRIBUTES,Cxe.ATTRIBUTES_INFO)),this.outlineMaterial=new Oxe(this.computeAttributesKey(hue.OUTLINE,this.outlineUsesFillColor?Oxe.ATTRIBUTES_FILL:Oxe.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?Oxe.ATTRIBUTES_INFO_FILL:Oxe.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(fe,ve,_e,be){const we=R$4(fe);if(!we)return null;const Se=this.getPaintValue("fill-translate",ve,fe),Te=be*Math.max(Se[0],Se[1]);return we[0]-=Te,we[2]-=Te,we[1]+=Te,we[3]+=Te,we}isIntersectingFeature(fe,ve,_e,be,we,Se,Te){const Ee=be.getGeometry();if(!Ee)return!1;const Ce=8/Te.normalizationRatio;fe=fe/Te.normalizationRatio+Te.normalizationOffsetX,ve=ve/Te.normalizationRatio+Te.normalizationOffsetY;const Oe=b$O(this.getPaintValue("fill-translate",we,be),this.getPaintValue("fill-translate-anchor",we,be),Se,8);return!!function I$E(fe,ve,_e){let be,we,Se,Te=0;for(const Ee of _e){be=Ee.length;for(let _e=1;_e<be;++_e)we=Ee[_e-1],Se=Ee[_e],we.y>ve!=Se.y>ve&&((Se.x-we.x)*(ve-we.y)-(Se.y-we.y)*(fe-we.x)>0?Te++:Te--)}return 0!==Te}(fe-=Ce*Oe.x,ve-=Ce*Oe.y,Ee)||N$s(fe,ve,Ee,Ce*_e)}},tSe=class x14 extends Qxe{constructor(fe,ve,_e,be){var we,Se,Te,Ee,Ce,Oe,Re,De,Be;super(fe,ve,_e,be);const Ze=this.getPaintProperty("line-pattern");if(this.lineMaterial=new Axe(this.computeAttributesKey(hue.LINE,Axe.ATTRIBUTES,Axe.ATTRIBUTES_INFO,Ze?"line-dasharray":"")),this.hasDataDrivenLine=(null==(we=this.getPaintProperty("line-blur"))?void 0:we.isDataDriven)||(null==(Se=this.getPaintProperty("line-color"))?void 0:Se.isDataDriven)||(null==(Te=this.getPaintProperty("line-gap-width"))?void 0:Te.isDataDriven)||(null==(Ee=this.getPaintProperty("line-offset"))?void 0:Ee.isDataDriven)||(null==(Ce=this.getPaintProperty("line-opacity"))?void 0:Ce.isDataDriven)||(null==(Oe=this.getPaintProperty("line-pattern"))?void 0:Oe.isDataDriven)||(null==(Re=this.getPaintProperty("line-dasharray"))?void 0:Re.isDataDriven)||(null==(De=this.getLayoutProperty("line-cap"))?void 0:De.isDataDriven)||(null==(Be=this.getPaintProperty("line-width"))?void 0:Be.isDataDriven),this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const fe=this.getPaintProperty("line-width");if(!fe||"number"==typeof fe&&.5*fe<1.05){const fe=this.getPaintProperty("line-offset");(!fe||"number"==typeof fe&&0===fe)&&(this.canUseThinTessellation=!0)}}}getDashKey(fe,ve){let _e;switch(ve){case Jxe.BUTT:_e="Butt";break;case Jxe.ROUND:_e="Round";break;case Jxe.SQUARE:_e="Square";break;default:_e="Butt"}return`dasharray-[${fe.toString()}]-${_e}`}getFeatureInflatedBounds(fe,ve,_e,be){const we=R$4(fe);if(!we)return null;const Se=this.getPaintValue("line-translate",ve,fe),Te=be*Math.max(Se[0],Se[1]);we[0]-=Te,we[2]-=Te,we[1]+=Te,we[3]+=Te;const Ee=be*Math.abs(this.getPaintValue("line-offset",ve,fe)||0),Ce=be*(this.getPaintValue("line-width",ve,fe)/2);return we[0]-=Ee+Ce,we[1]-=Ee+Ce,we[2]+=Ee+Ce,we[3]+=Ee+Ce,we}isIntersectingFeature(fe,ve,_e,be,we,Se,Te){let Ee=be.getGeometry();if(!Ee)return!1;const Ce=8/Te.normalizationRatio;fe=fe/Te.normalizationRatio+Te.normalizationOffsetX,ve=ve/Te.normalizationRatio+Te.normalizationOffsetY;const Oe=b$O(this.getPaintValue("line-translate",we,be),this.getPaintValue("line-translate-anchor",we,be),Se,8);fe-=Ce*Oe.x,ve-=Ce*Oe.y;const Re=Ce*this.getPaintValue("line-offset",we,be)||0;0!==Re&&(Ee=function P$r(fe,ve){if(0===ve||Number.isNaN(ve))return fe;const _e=[],be=new pK(0,0),we=new pK(0,0),Se=new pK(0,0);for(let Te=0;Te<fe.length;Te++){const Ee=fe[Te],Ce=[];for(let fe=0;fe<Ee.length;fe++){const _e=Ee[fe-1],Te=Ee[fe],Oe=Ee[fe+1];0===fe?be.setCoords(0,0):be.assignSub(Te,_e).normalize().rightPerpendicular(),fe===Ee.length-1?we.setCoords(0,0):we.assignSub(Oe,Te).normalize().rightPerpendicular(),Se.assignAdd(be,we).normalize();const Re=Se.x*we.x+Se.y*we.y;0!==Re&&Se.scale(1/Re),Ce.push(pK.add(Te,Se.scale(ve)))}_e.push(Ce)}return _e}(Ee,-Re));return N$s(fe,ve,Ee,Ce*(_e+this.getPaintValue("line-width",we,be)/2))}},rSe=class I10 extends Qxe{constructor(fe,ve,_e,be){var we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je;super(fe,ve,_e,be),this.iconMaterial=new Ixe(this.computeAttributesKey(hue.ICON,Ixe.ATTRIBUTES,Ixe.ATTRIBUTES_INFO)),this.textMaterial=new Lxe(this.computeAttributesKey(hue.TEXT,Lxe.ATTRIBUTES,Lxe.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=(null==(we=this.getPaintProperty("icon-color"))?void 0:we.isDataDriven)||(null==(Se=this.getPaintProperty("icon-halo-blur"))?void 0:Se.isDataDriven)||(null==(Te=this.getPaintProperty("icon-halo-color"))?void 0:Te.isDataDriven)||(null==(Ee=this.getPaintProperty("icon-halo-width"))?void 0:Ee.isDataDriven)||(null==(Ce=this.getPaintProperty("icon-opacity"))?void 0:Ce.isDataDriven)||(null==(Oe=this.getLayoutProperty("icon-size"))?void 0:Oe.isDataDriven),this.hasDataDrivenText=(null==(Re=this.getPaintProperty("text-color"))?void 0:Re.isDataDriven)||(null==(De=this.getPaintProperty("text-halo-blur"))?void 0:De.isDataDriven)||(null==(Be=this.getPaintProperty("text-halo-color"))?void 0:Be.isDataDriven)||(null==(Ze=this.getPaintProperty("text-halo-width"))?void 0:Ze.isDataDriven)||(null==(Xe=this.getPaintProperty("text-opacity"))?void 0:Xe.isDataDriven)||(null==(Je=this.getLayoutProperty("text-size"))?void 0:Je.isDataDriven)}},iSe=class A14 extends Qxe{constructor(fe,ve,_e,be){super(fe,ve,_e,be),this.circleMaterial=new Pxe(this.computeAttributesKey(hue.CIRCLE,Pxe.ATTRIBUTES,Pxe.ATTRIBUTES_INFO))}getFeatureInflatedBounds(fe,ve,_e,be){const we=R$4(fe);if(!we)return null;const Se=this.getPaintValue("circle-translate",ve,fe),Te=Math.max(Se[0],Se[1]);we[0]-=Te,we[2]-=Te,we[1]+=Te,we[3]+=Te;const Ee=be*(8*(this.getPaintValue("circle-radius",ve,fe)+this.getPaintValue("circle-stroke-width",ve,fe))/2);return we[0]-=Ee,we[1]-=Ee,we[2]+=Ee,we[3]+=Ee,we}isIntersectingFeature(fe,ve,_e,be,we,Se,Te){const Ee=be.getGeometry();if(!Ee)return!1;const Ce=8/Te.normalizationRatio;fe=fe/Te.normalizationRatio+Te.normalizationOffsetX,ve=ve/Te.normalizationRatio+Te.normalizationOffsetY,_e*=Ce;const Oe=b$O(this.getPaintValue("circle-translate",we,be),this.getPaintValue("circle-translate-anchor",we,be),Se,Ce),Re=Ce*(this.getPaintValue("circle-radius",we,be)+this.getPaintValue("circle-stroke-width",we,be));let De,Be;for(const Ze of Ee)if(Ze)for(const be of Ze)if(De=be.x+Oe.x,Be=be.y+Oe.y,Math.sqrt((fe-De)*(fe-De)+(ve-Be)*(ve-Be))-_e<=Re)return!0;return!1}},nSe=class U8{constructor(fe,ve,_e){let be;this.allowOverlap=fe.getLayoutValue("icon-allow-overlap",ve),this.ignorePlacement=fe.getLayoutValue("icon-ignore-placement",ve),this.keepUpright=fe.getLayoutValue("icon-keep-upright",ve),this.optional=fe.getLayoutValue("icon-optional",ve),this.rotationAlignment=fe.getLayoutValue("icon-rotation-alignment",ve),this.rotationAlignment===upe.AUTO&&(this.rotationAlignment=_e?upe.MAP:upe.VIEWPORT),be=fe.getLayoutProperty("icon-anchor"),(null==be?void 0:be.isDataDriven)?this._anchorProp=be:this.anchor=fe.getLayoutValue("icon-anchor",ve),be=fe.getLayoutProperty("icon-offset"),(null==be?void 0:be.isDataDriven)?this._offsetProp=be:this.offset=fe.getLayoutValue("icon-offset",ve),be=fe.getLayoutProperty("icon-padding"),(null==be?void 0:be.isDataDriven)?this._paddingProp=be:this.padding=fe.getLayoutValue("icon-padding",ve),be=fe.getLayoutProperty("icon-rotate"),(null==be?void 0:be.isDataDriven)?this._rotateProp=be:this.rotate=fe.getLayoutValue("icon-rotate",ve),be=fe.getLayoutProperty("icon-size"),(null==be?void 0:be.isDataDriven)?this._sizeProp=be:this.size=fe.getLayoutValue("icon-size",ve)}update(fe,ve){this._anchorProp&&(this.anchor=this._anchorProp.getValue(fe,ve)),this._offsetProp&&(this.offset=this._offsetProp.getValue(fe,ve)),this._paddingProp&&(this.padding=this._paddingProp.getValue(fe,ve)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(fe,ve)),this._sizeProp&&(this.size=this._sizeProp.getValue(fe,ve))}},sSe=class O14{constructor(fe,ve,_e){let be;this.allowOverlap=fe.getLayoutValue("text-allow-overlap",ve),this.ignorePlacement=fe.getLayoutValue("text-ignore-placement",ve),this.keepUpright=fe.getLayoutValue("text-keep-upright",ve),this.optional=fe.getLayoutValue("text-optional",ve),this.rotationAlignment=fe.getLayoutValue("text-rotation-alignment",ve),this.rotationAlignment===upe.AUTO&&(this.rotationAlignment=_e?upe.MAP:upe.VIEWPORT),be=fe.getLayoutProperty("text-anchor"),(null==be?void 0:be.isDataDriven)?this._anchorProp=be:this.anchor=fe.getLayoutValue("text-anchor",ve),be=fe.getLayoutProperty("text-justify"),(null==be?void 0:be.isDataDriven)?this._justifyProp=be:this.justify=fe.getLayoutValue("text-justify",ve),be=fe.getLayoutProperty("text-letter-spacing"),(null==be?void 0:be.isDataDriven)?this._letterSpacingProp=be:this.letterSpacing=fe.getLayoutValue("text-letter-spacing",ve),be=fe.getLayoutProperty("text-line-height"),(null==be?void 0:be.isDataDriven)?this._lineHeightProp=be:this.lineHeight=fe.getLayoutValue("text-line-height",ve),be=fe.getLayoutProperty("text-max-angle"),(null==be?void 0:be.isDataDriven)?this._maxAngleProp=be:this.maxAngle=fe.getLayoutValue("text-max-angle",ve),be=fe.getLayoutProperty("text-max-width"),(null==be?void 0:be.isDataDriven)?this._maxWidthProp=be:this.maxWidth=fe.getLayoutValue("text-max-width",ve),be=fe.getLayoutProperty("text-offset"),(null==be?void 0:be.isDataDriven)?this._offsetProp=be:this.offset=fe.getLayoutValue("text-offset",ve),be=fe.getLayoutProperty("text-padding"),(null==be?void 0:be.isDataDriven)?this._paddingProp=be:this.padding=fe.getLayoutValue("text-padding",ve),be=fe.getLayoutProperty("text-rotate"),(null==be?void 0:be.isDataDriven)?this._rotateProp=be:this.rotate=fe.getLayoutValue("text-rotate",ve),be=fe.getLayoutProperty("text-size"),(null==be?void 0:be.isDataDriven)?this._sizeProp=be:this.size=fe.getLayoutValue("text-size",ve),be=fe.getLayoutProperty("text-writing-mode"),(null==be?void 0:be.isDataDriven)?this._writingModeProp=be:this.writingMode=fe.getLayoutValue("text-writing-mode",ve)}update(fe,ve){this._anchorProp&&(this.anchor=this._anchorProp.getValue(fe,ve)),this._justifyProp&&(this.justify=this._justifyProp.getValue(fe,ve)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(fe,ve)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(fe,ve)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(fe,ve)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(fe,ve)),this._offsetProp&&(this.offset=this._offsetProp.getValue(fe,ve)),this._paddingProp&&(this.padding=this._paddingProp.getValue(fe,ve)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(fe,ve)),this._sizeProp&&(this.size=this._sizeProp.getValue(fe,ve)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(fe,ve))}};function R$4(fe){const ve=null==fe?void 0:fe.getGeometry();if(null==ve)return null;let _e=1/0,be=1/0,we=-1/0,Se=-1/0;for(const Te of ve)if(Te)for(const fe of Te)_e=Math.min(_e,fe.x),be=Math.min(be,fe.y),we=Math.max(we,fe.x),Se=Math.max(Se,fe.y);return a$4j(_e,be,we,Se)}let oSe=class l44{constructor(fe){if(this._style=fe,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,fe.layers||(fe.layers=[]),this.version=parseFloat(fe.version),this.layers=fe.layers.map(((fe,ve,_e)=>this._create(fe,ve,_e))).filter((fe=>!!fe)),this.layers)for(let ve=0;ve<this.layers.length;ve++){const fe=this.layers[ve];this._layerByName[fe.id]=fe,this._uidToLayer.set(fe.uid,fe),fe.type===ape.BACKGROUND&&this.backgroundBucketIds.push(fe.id)}this._identifyRefLayers()}isPainterDataDriven(fe){const ve=this._layerByName[fe];return!!ve&&ve.isPainterDataDriven()}getStyleLayerId(fe){return fe>=this.layers.length?null:this.layers[fe].id}getStyleLayerByUID(fe){return this._uidToLayer.get(fe)??null}getStyleLayerIndex(fe){const ve=this._layerByName[fe];return ve?this.layers.indexOf(ve):-1}setStyleLayer(fe,ve){if(!(null==fe?void 0:fe.id))return;const _e=this._style;null!=ve&&ve>=this.layers.length&&(ve=this.layers.length-1);let be,we=!0;const Se=this._layerByName[fe.id];if(Se){const Te=this.layers.indexOf(Se);ve||(ve=Te),ve===Te?(we=!1,be=l44._recreateLayer(fe,Se),this.layers[ve]=be,_e.layers[ve]=fe):(this.layers.splice(Te,1),_e.layers.splice(Te,1),be=this._create(fe,ve,this.layers),this.layers.splice(ve,0,be),_e.layers.splice(ve,0,fe))}else be=this._create(fe,ve,this.layers),!ve||ve>=this.layers.length?(this.layers.push(be),_e.layers.push(fe)):(this.layers.splice(ve,0,be),_e.layers.splice(ve,0,fe));this._layerByName[fe.id]=be,this._uidToLayer.set(be.uid,be),we&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(fe){const ve=this._layerByName[fe];return ve?{type:ve.typeName,id:ve.id,source:ve.source,"source-layer":ve.sourceLayer,minzoom:ve.minzoom,maxzoom:ve.maxzoom,filter:ve.filter,layout:ve.layout,paint:ve.paint}:null}deleteStyleLayer(fe){const ve=this._layerByName[fe];if(ve){delete this._layerByName[fe],this._uidToLayer.delete(ve.uid);const _e=this.layers.indexOf(ve);this.layers.splice(_e,1),this._style.layers.splice(_e,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(fe){return this._layerByName[fe]}getLayoutProperties(fe){const ve=this._layerByName[fe];return ve?ve.layout:null}getPaintProperties(fe){const ve=this._layerByName[fe];return ve?ve.paint:null}setPaintProperties(fe,ve){const _e=this._layerByName[fe];if(!_e)return;const be={type:_e.typeName,id:_e.id,source:_e.source,"source-layer":_e.sourceLayer,minzoom:_e.minzoom,maxzoom:_e.maxzoom,filter:_e.filter,layout:_e.layout,paint:ve},we=l44._recreateLayer(be,_e),Se=this.layers.indexOf(_e);this.layers[Se]=we,this._style.layers[Se].paint=ve,this._layerByName[_e.id]=we,this._uidToLayer.set(_e.uid,we)}setLayoutProperties(fe,ve){const _e=this._layerByName[fe];if(!_e)return;const be={type:_e.typeName,id:_e.id,source:_e.source,"source-layer":_e.sourceLayer,minzoom:_e.minzoom,maxzoom:_e.maxzoom,filter:_e.filter,layout:ve,paint:_e.paint},we=l44._recreateLayer(be,_e),Se=this.layers.indexOf(_e);this.layers[Se]=we,this._style.layers[Se].layout=ve,this._layerByName[_e.id]=we,this._uidToLayer.set(_e.uid,we)}setStyleLayerVisibility(fe,ve){const _e=this._layerByName[fe];if(!_e)return;const be=_e.layout||{};be.visibility=ve;const we={type:_e.typeName,id:_e.id,source:_e.source,"source-layer":_e.sourceLayer,minzoom:_e.minzoom,maxzoom:_e.maxzoom,filter:_e.filter,layout:be,paint:_e.paint},Se=l44._recreateLayer(we,_e),Te=this.layers.indexOf(_e);this.layers[Te]=Se,this._style.layers[Te].layout=be,this._layerByName[_e.id]=Se,this._uidToLayer.set(_e.uid,Se)}getStyleLayerVisibility(fe){const ve=this._layerByName[fe];if(!ve)return"none";const _e=ve.layout;return(null==_e?void 0:_e.visibility)??"visible"}_recomputeZValues(){const fe=this.layers,ve=1/(fe.length+1);for(let _e=0;_e<fe.length;_e++)fe[_e].z=1-(1+_e)*ve}_identifyRefLayers(){const fe=[],ve=[];let _e=0;for(const be of this.layers){const we=be.layout;if(be.type===ape.FILL){const ve=be;let Se=be.source+"|"+be.sourceLayer;Se+="|"+((null==we?void 0:we.visibility)??""),Se+="|"+be.minzoom,Se+="|"+be.maxzoom,Se+="|"+JSON.stringify(be.filter),(ve.hasDataDrivenFill||ve.hasDataDrivenOutline)&&(Se+="|"+_e),fe.push({key:Se,layer:be})}else if(be.type===ape.LINE){const fe=be,Se=be.paint,Te=null!=Se&&(null!=Se["line-pattern"]||null!=Se["line-dasharray"]);let Ee=be.source+"|"+be.sourceLayer;Ee+="|"+((null==we?void 0:we.visibility)??""),Ee+="|"+be.minzoom,Ee+="|"+be.maxzoom,Ee+="|"+JSON.stringify(be.filter),Ee+="|"+(void 0!==we?we["line-cap"]:""),Ee+="|"+(void 0!==we?we["line-join"]:""),(fe.hasDataDrivenLine||Te)&&(Ee+="|"+_e),ve.push({key:Ee,layer:be})}++_e}this._assignRefLayers(fe),this._assignRefLayers(ve)}_assignRefLayers(fe){let ve,_e;fe.sort(((fe,ve)=>fe.key<ve.key?-1:fe.key>ve.key?1:0));const be=fe.length;for(let we=0;we<be;we++){const Se=fe[we];if(Se.key===ve)Se.layer.refLayerId=_e;else if(ve=Se.key,_e=Se.layer.id,Se.layer.type===ape.FILL){if(!Se.layer.getPaintProperty("fill-outline-color"))for(let Te=we+1;Te<be;Te++){const be=fe[Te];if(be.key!==ve)break;if(be.layer.getPaintProperty("fill-outline-color")){fe[we]=be,fe[Te]=Se,_e=be.layer.id;break}}}else if(Se.layer.type===ape.LINE){let Te=Se.layer;for(let Ee=we+1;Ee<be;Ee++){const be=fe[Ee];if(be.key!==ve)break;const Ce=be.layer;(Te.canUseThinTessellation&&!Ce.canUseThinTessellation||!Te.canUseThinTessellation&&(Ce.getPaintProperty("line-pattern")||Ce.getPaintProperty("line-dasharray")))&&(Te=Ce,fe[we]=be,fe[Ee]=Se,_e=be.layer.id)}}}}_create(fe,ve,_e){const be=1-(1+ve)*(1/(_e.length+1)),we=this._runningId++;switch(fe.type){case"background":return new Kxe(ape.BACKGROUND,fe,be,we);case"fill":return new eSe(ape.FILL,fe,be,we);case"line":return new tSe(ape.LINE,fe,be,we);case"symbol":return new rSe(ape.SYMBOL,fe,be,we);case"raster":return null;case"circle":return new iSe(ape.CIRCLE,fe,be,we)}return null}static _recreateLayer(fe,ve){switch(fe.type){case"background":return new Kxe(ape.BACKGROUND,fe,ve.z,ve.uid);case"fill":return new eSe(ape.FILL,fe,ve.z,ve.uid);case"line":return new tSe(ape.LINE,fe,ve.z,ve.uid);case"symbol":return new rSe(ape.SYMBOL,fe,ve.z,ve.uid);case"raster":return null;case"circle":return new iSe(ape.CIRCLE,fe,ve.z,ve.uid)}return null}},aSe=class N12 extends(l$L(t$t(p$1c(l$H(b$9(j$a(e$i(i$L(S$a(Y_)))))))))){constructor(...fe){super(...fe),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null,this.path=null}normalizeCtorArgs(fe,ve){return"string"==typeof fe?{url:fe,...ve}:fe}destroy(){var fe;if(this.sourceNameToSource)for(const ve of Object.values(this.sourceNameToSource))null==ve||ve.destroy();null==(fe=this.primarySource)||fe.destroy(),this._spriteSourceMap.clear()}async prefetchResources(fe){await this.loadSpriteSource(globalThis.devicePixelRatio||1,fe)}load(fe){const ve=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},fe).catch(a$4D).then((async()=>{var ve;if(!(null==(ve=this.portalItem)?void 0:ve.id))return;const _e=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await U$1a(_e,{...fe,query:{f:"json",...this.customParameters,token:this.apiKey}})).data&&this.read({url:_e},e$g(this.portalItem,"portal-item"))})).catch(a$4D).then((()=>this._loadStyle(fe)));return this.addResolvingPromise(ve),Promise.resolve(this)}get attributionDataUrl(){const fe=this.currentStyleInfo,ve=(null==fe?void 0:fe.serviceUrl)&&I$1E(fe.serviceUrl);if(!ve)return null;const _e=this._getDefaultAttribution(ve.path);return _e?Et$4(_e,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const fe=this.primarySource;return fe?fe.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){var fe;return(null==(fe=this.primarySource)?void 0:fe.fullExtent)||null}get initialExtent(){var fe;return(null==(fe=this.primarySource)?void 0:fe.initialExtent)||null}get parsedUrl(){return this.serviceUrl?I$1E(this.serviceUrl):null}get serviceUrl(){var fe;return(null==(fe=this.currentStyleInfo)?void 0:fe.serviceUrl)||null}get spatialReference(){var fe;return(null==(fe=this.tileInfo)?void 0:fe.spatialReference)??null}get styleUrl(){var fe;return(null==(fe=this.currentStyleInfo)?void 0:fe.styleUrl)||null}writeStyleUrl(fe,ve){fe&&pt$9(fe)&&(fe=`https:${fe}`);const _e=a$4r(fe);ve.styleUrl=U$X(fe,_e)}get tileInfo(){var fe;const ve=[];for(const be in this.sourceNameToSource)ve.push(this.sourceNameToSource[be]);let _e=(null==(fe=this.primarySource)?void 0:fe.tileInfo)||new Vg;if(ve.length>1)for(let be=0;be<ve.length;be++)r$b(_e,ve[be].tileInfo)&&(_e=o$d(_e,ve[be].tileInfo));return _e}readTilemapCache(fe,ve){var _e;return(null==(_e=ve.capabilities)?void 0:_e.includes("Tilemap"))?new Hwe({layer:this}):null}readVersion(fe,ve){return ve.version?parseFloat(ve.version):parseFloat(ve.currentVersion)}async loadSpriteSource(fe=1,ve){var _e,be;if(!this._spriteSourceMap.has(fe)){const we=t$D().maxTextureSize,Se=(null==(_e=this.currentStyleInfo)?void 0:_e.spriteUrl)?Et$4(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,Te=new fxe({type:"url",spriteUrl:Se,pixelRatio:fe,spriteFormat:null==(be=this.currentStyleInfo)?void 0:be.spriteFormat},we);await Te.load(ve),this._spriteSourceMap.set(fe,Te)}return this._spriteSourceMap.get(fe)}async setSpriteSource(fe,ve){if(!fe)return null;const _e=t$D().maxTextureSize,be=fe.spriteUrl,we=be?Et$4(be,{...this.customParameters,token:this.apiKey}):null;if(!we&&"url"===fe.type)return null;const Se=new fxe(fe,_e);try{await Se.load(ve);const _e=fe.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(_e,Se),we&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=we),this.emit("spriteSource-change",{spriteSource:Se}),Se}catch(GC){a$4D(GC)}return null}async loadStyle(fe,ve){var _e;const be=fe||this.style||this.url;return this._loadingTask&&"string"==typeof be&&this.url===be||(null==(_e=this._loadingTask)||_e.abort(),this._loadingTask=d$3e((fe=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(be,{signal:fe}))),ve)),this._loadingTask.promise}getStyleLayerId(fe){return this.styleRepository.getStyleLayerId(fe)}getStyleLayerIndex(fe){return this.styleRepository.getStyleLayerIndex(fe)}getPaintProperties(fe){var ve;return a$4H(null==(ve=this.styleRepository)?void 0:ve.getPaintProperties(fe))}setPaintProperties(fe,ve){const _e=this.styleRepository.isPainterDataDriven(fe);this.styleRepository.setPaintProperties(fe,ve);const be=this.styleRepository.isPainterDataDriven(fe);this.emit("paint-change",{layer:fe,paint:ve,isDataDriven:_e||be})}getStyleLayer(fe){return a$4H(this.styleRepository.getStyleLayer(fe))}setStyleLayer(fe,ve){this.styleRepository.setStyleLayer(fe,ve),this.emit("style-layer-change",{layer:fe,index:ve})}deleteStyleLayer(fe){this.styleRepository.deleteStyleLayer(fe),this.emit("delete-style-layer",{layer:fe})}getLayoutProperties(fe){return a$4H(this.styleRepository.getLayoutProperties(fe))}setLayoutProperties(fe,ve){this.styleRepository.setLayoutProperties(fe,ve),this.emit("layout-change",{layer:fe,layout:ve})}setStyleLayerVisibility(fe,ve){this.styleRepository.setStyleLayerVisibility(fe,ve),this.emit("style-layer-visibility-change",{layer:fe,visibility:ve})}getStyleLayerVisibility(fe){return this.styleRepository.getStyleLayerVisibility(fe)}write(fe,ve){return(null==ve?void 0:ve.origin)&&!this.styleUrl?(ve.messages&&ve.messages.push(new Ir("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(fe,ve)}getTileUrl(fe,ve,_e){return null}async _getSourceAndStyle(fe,ve){if(!fe)throw new Error("invalid style!");const _e=await async function x$5(fe,ve){const _e={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[be,we]="string"==typeof fe?[fe,null]:[null,fe.jsonUrl];return await S$9(_e,"esri",fe,we,ve),{layerDefinition:_e.validatedSource,url:be,serviceUrl:_e.sourceUrl,style:_e.style,styleUrl:_e.styleUrl,spriteUrl:_e.style.sprite&&d$m(_e.styleBase,_e.style.sprite),spriteFormat:_e.spriteFormat,glyphsUrl:_e.style.glyphs&&d$m(_e.styleBase,_e.style.glyphs),sourceNameToSource:_e.sourceNameToSource,primarySourceName:_e.primarySourceName}}(fe,{...ve,query:{...this.customParameters,token:this.apiKey}});"webp"===_e.spriteFormat&&(await function o$f(fe){if(pxe)return pxe;const ve={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return pxe=new Promise((_e=>{const be=new Image;be.onload=()=>{be.onload=be.onerror=null,_e(be.width>0&&be.height>0)},be.onerror=()=>{be.onload=be.onerror=null,_e(!1)},be.src="data:image/webp;base64,"+ve[fe]})),pxe}("lossy")||(_e.spriteFormat="png")),this._set("currentStyleInfo",{..._e}),"string"==typeof fe?(this.url=fe,this.style=null):(this.url=null,this.style=fe),this._set("sourceNameToSource",_e.sourceNameToSource),this._set("primarySource",_e.sourceNameToSource[_e.primarySourceName]),this._set("styleRepository",new oSe(_e.style)),this.read(_e.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(fe){const ve=fe.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^/]+)?\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/vectortileserver/i),_e=["OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2","World_Hillshade_v2"];if(!ve)return;const be=ve[2]&&ve[2].toLowerCase();if(!be)return;const we=ve[1]||"";for(const Se of _e)if(Se.toLowerCase().includes(be))return K$I(`//static.arcgis.com/attribution/Vector${we}/${Se}`)}async _loadStyle(fe){var ve;return(null==(ve=this._loadingTask)?void 0:ve.promise)??this.loadStyle(null,fe)}};e$4o([y$2v({readOnly:!0})],aSe.prototype,"attributionDataUrl",null),e$4o([y$2v({type:["show","hide"]})],aSe.prototype,"listMode",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],aSe.prototype,"blendMode",void 0),e$4o([y$2v({readOnly:!0,json:{read:!1}})],aSe.prototype,"capabilities",null),e$4o([y$2v({readOnly:!0})],aSe.prototype,"currentStyleInfo",void 0),e$4o([y$2v({json:{read:!1},readOnly:!0,type:aa})],aSe.prototype,"fullExtent",null),e$4o([y$2v({json:{read:!1},readOnly:!0,type:aa})],aSe.prototype,"initialExtent",null),e$4o([y$2v({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],aSe.prototype,"isReference",void 0),e$4o([y$2v({type:["VectorTileLayer"]})],aSe.prototype,"operationalLayerType",void 0),e$4o([y$2v({readOnly:!0})],aSe.prototype,"parsedUrl",null),e$4o([y$2v()],aSe.prototype,"style",void 0),e$4o([y$2v({readOnly:!0})],aSe.prototype,"serviceUrl",null),e$4o([y$2v({type:zo,readOnly:!0})],aSe.prototype,"spatialReference",null),e$4o([y$2v({readOnly:!0})],aSe.prototype,"styleRepository",void 0),e$4o([y$2v({readOnly:!0})],aSe.prototype,"sourceNameToSource",void 0),e$4o([y$2v({readOnly:!0})],aSe.prototype,"primarySource",void 0),e$4o([y$2v({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],aSe.prototype,"styleUrl",null),e$4o([r$3s(["portal-item","web-document"],"styleUrl")],aSe.prototype,"writeStyleUrl",null),e$4o([y$2v({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:Vg})],aSe.prototype,"tileInfo",null),e$4o([y$2v()],aSe.prototype,"tilemapCache",void 0),e$4o([o$40("service","tilemapCache",["capabilities","tileInfo"])],aSe.prototype,"readTilemapCache",null),e$4o([y$2v({json:{read:!1},readOnly:!0,value:"vector-tile"})],aSe.prototype,"type",void 0),e$4o([y$2v({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],aSe.prototype,"url",void 0),e$4o([y$2v({readOnly:!0})],aSe.prototype,"version",void 0),e$4o([o$40("version",["version","currentVersion"])],aSe.prototype,"readVersion",null),e$4o([y$2v({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],aSe.prototype,"path",void 0),aSe=e$4o([a$4y("esri.layers.VectorTileLayer")],aSe);const lSe=aSe,cSe=Object.freeze(Object.defineProperty({__proto__:null,default:lSe},Symbol.toStringTag,{value:"Module"}));var uSe;let hSe=uSe=class extends Pn{constructor(fe){super(fe),this.minValue=0,this.maxValue=0}clone(){return new uSe({minValue:this.minValue,maxValue:this.maxValue})}};var dSe;e$4o([y$2v({type:Number,json:{write:!0}})],hSe.prototype,"minValue",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],hSe.prototype,"maxValue",void 0),hSe=uSe=e$4o([a$4y("esri.renderers.support.AuthoringInfoClassBreakInfo")],hSe);let pSe=dSe=class extends Pn{constructor(fe){super(fe),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new dSe({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:a$4H(this.classBreakInfos)})}};var fSe;e$4o([y$2v({type:String,json:{write:!0}})],pSe.prototype,"field",void 0),e$4o([y$2v({type:String,json:{write:!0}})],pSe.prototype,"normalizationField",void 0),e$4o([y$2v({type:String,json:{write:!0}})],pSe.prototype,"label",void 0),e$4o([y$2v({type:[hSe],json:{write:!0}})],pSe.prototype,"classBreakInfos",void 0),pSe=dSe=e$4o([a$4y("esri.renderers.support.AuthoringInfoFieldInfo")],pSe);let mSe=fSe=class extends Pn{constructor(fe){super(fe),this.label=null,this.size=null,this.value=null}clone(){return new fSe({label:this.label,value:this.value,size:this.size})}};e$4o([y$2v({type:String,json:{write:!0}})],mSe.prototype,"label",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],mSe.prototype,"size",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],mSe.prototype,"value",void 0),mSe=fSe=e$4o([a$4y("esri.renderers.support.AuthoringInfoSizeStop")],mSe);const ySe=mSe;var gSe;const vSe=new An({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),_Se=new An({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),$Se={key:fe=>"number"==typeof fe?"number":"string",typeMap:{number:Number,string:String},base:null},bSe=["high-to-low","above-and-below","centered-on","extremes"],wSe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],xSe=["seconds","minutes","hours","days","months","years"];let SSe=gSe=class extends Pn{constructor(fe){super(fe),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(fe){return"string"==typeof fe||"number"==typeof fe?fe:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(fe){this._set("normalizationField",fe)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(fe){this._set("referenceSizeScale",fe)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(fe){this._set("referenceSizeSymbolStyle",fe)}castStartTime(fe){return"string"==typeof fe||"number"==typeof fe?fe:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(fe){this._set("sizeStops",fe)}get style(){return"color"===this.type?this._get("style"):null}set style(fe){this._set("style",fe)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(fe){this._set("theme",fe)}clone(){return new gSe({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:a$4H(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};e$4o([y$2v({types:$Se,json:{write:!0}})],SSe.prototype,"endTime",void 0),e$4o([s$4b("endTime")],SSe.prototype,"castEndTime",null),e$4o([y$2v({type:String,json:{write:!0}})],SSe.prototype,"field",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],SSe.prototype,"maxSliderValue",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],SSe.prototype,"minSliderValue",void 0),e$4o([y$2v({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],SSe.prototype,"normalizationField",null),e$4o([y$2v({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],SSe.prototype,"referenceSizeScale",null),e$4o([y$2v({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],SSe.prototype,"referenceSizeSymbolStyle",null),e$4o([y$2v({types:$Se,json:{write:!0}})],SSe.prototype,"startTime",void 0),e$4o([s$4b("startTime")],SSe.prototype,"castStartTime",null),e$4o([y$2v({type:[ySe],json:{origins:{"web-scene":{write:!1}},write:!0}})],SSe.prototype,"sizeStops",null),e$4o([y$2v({type:vSe.apiValues,value:null,json:{type:vSe.jsonValues,read:vSe.read,write:vSe.write}})],SSe.prototype,"style",null),e$4o([y$2v({type:wSe,value:null,json:{type:wSe,origins:{"web-scene":{type:bSe,write:{writer:(fe,ve)=>{bSe.includes(fe)&&(ve.theme=fe)}}}},write:!0}})],SSe.prototype,"theme",null),e$4o([y$2v({type:_Se.apiValues,json:{type:_Se.jsonValues,read:_Se.read,write:_Se.write}})],SSe.prototype,"type",void 0),e$4o([y$2v({type:xSe,json:{type:xSe,write:!0}})],SSe.prototype,"units",void 0),SSe=gSe=e$4o([a$4y("esri.renderers.support.AuthoringInfoVisualVariable")],SSe);const TSe=SSe;let ESe=class e71 extends Pn{constructor(fe){super(fe),this.type=null}};e$4o([y$2v({readOnly:!0,json:{read:!1,write:!0}})],ESe.prototype,"type",void 0),ESe=e$4o([a$4y("esri.rest.support.ColorRamp")],ESe);const PSe=ESe;var CSe;let OSe=CSe=class extends PSe{constructor(fe){super(fe),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new CSe({fromColor:a$4H(this.fromColor),toColor:a$4H(this.toColor),algorithm:this.algorithm})}};e$4o([o$3g({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],OSe.prototype,"algorithm",void 0),e$4o([y$2v({type:b_,json:{type:[Ci],write:!0}})],OSe.prototype,"fromColor",void 0),e$4o([y$2v({type:b_,json:{type:[Ci],write:!0}})],OSe.prototype,"toColor",void 0),e$4o([y$2v({type:["algorithmic"]})],OSe.prototype,"type",void 0),OSe=CSe=e$4o([a$4y("esri.rest.support.AlgorithmicColorRamp")],OSe);const ASe=OSe;var MSe;let RSe=MSe=class extends PSe{constructor(fe){super(fe),this.colorRamps=null,this.type="multipart"}clone(){return new MSe({colorRamps:a$4H(this.colorRamps)})}};e$4o([y$2v({type:[ASe],json:{write:!0}})],RSe.prototype,"colorRamps",void 0),e$4o([y$2v({type:["multipart"]})],RSe.prototype,"type",void 0),RSe=MSe=e$4o([a$4y("esri.rest.support.MultipartColorRamp")],RSe);const ISe=RSe,LSe={key:"type",base:PSe,typeMap:{algorithmic:ASe,multipart:ISe}};function p$14(fe){return(null==fe?void 0:fe.type)?"algorithmic"===fe.type?ASe.fromJSON(fe):"multipart"===fe.type?ISe.fromJSON(fe):null:null}var DSe;const NSe=new An({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),FSe=new An({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),zSe=new An({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),kSe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let USe=DSe=class extends Pn{constructor(fe){super(fe),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const fe=this._get("classificationMethod"),ve=this.type;return ve&&"relationship"!==ve?"class-breaks-size"===ve||"class-breaks-color"===ve?fe||"manual":null:fe}set classificationMethod(fe){this._set("classificationMethod",fe)}readColorRamp(fe){return fe?p$14(fe):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(fe){this._set("fields",fe)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(fe){this._set("field1",fe)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(fe){this._set("field2",fe)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(fe){this._set("flowTheme",fe)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(fe){this._set("focus",fe)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(fe){this._set("numClasses",fe)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(fe){this._set("statistics",fe)}get standardDeviationInterval(){const fe=this.type;return fe&&"relationship"!==fe&&"class-breaks-size"!==fe&&"class-breaks-color"!==fe||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(fe){this._set("standardDeviationInterval",fe)}get type(){return this._get("type")}set type(fe){let ve=fe;"classed-size"===fe?ve="class-breaks-size":"classed-color"===fe&&(ve="class-breaks-color"),this._set("type",ve)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(fe){this._set("univariateSymbolStyle",fe)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(fe){this._set("univariateTheme",fe)}clone(){var fe;return new DSe({classificationMethod:this.classificationMethod,colorRamp:a$4H(this.colorRamp),fadeRatio:a$4H(this.fadeRatio),fields:null==(fe=this.fields)?void 0:fe.slice(0),field1:a$4H(this.field1),field2:a$4H(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((fe=>fe.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};e$4o([y$2v({type:NSe.apiValues,value:null,json:{type:NSe.jsonValues,read:NSe.read,write:NSe.write,origins:{"web-document":{default:"manual",type:NSe.jsonValues,read:NSe.read,write:NSe.write}}}})],USe.prototype,"classificationMethod",null),e$4o([y$2v({types:LSe,json:{write:!0}})],USe.prototype,"colorRamp",void 0),e$4o([o$40("colorRamp")],USe.prototype,"readColorRamp",null),e$4o([y$2v({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],USe.prototype,"fadeRatio",void 0),e$4o([y$2v({type:[String],value:null,json:{write:!0}})],USe.prototype,"fields",null),e$4o([y$2v({type:pSe,value:null,json:{write:!0}})],USe.prototype,"field1",null),e$4o([y$2v({type:pSe,value:null,json:{write:!0}})],USe.prototype,"field2",null),e$4o([y$2v({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],USe.prototype,"flowTheme",null),e$4o([y$2v({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],USe.prototype,"focus",null),e$4o([y$2v({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],USe.prototype,"isAutoGenerated",void 0),e$4o([y$2v({type:Number,value:null,json:{type:Ci,write:!0}})],USe.prototype,"numClasses",null),e$4o([y$2v({type:kSe,json:{type:kSe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],USe.prototype,"lengthUnit",void 0),e$4o([y$2v({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],USe.prototype,"maxSliderValue",void 0),e$4o([y$2v({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],USe.prototype,"minSliderValue",void 0),e$4o([y$2v({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],USe.prototype,"statistics",null),e$4o([y$2v({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],USe.prototype,"standardDeviationInterval",null),e$4o([y$2v({type:FSe.apiValues,value:null,json:{type:FSe.jsonValues,read:FSe.read,write:FSe.write,origins:{"web-scene":{type:zSe.jsonValues,write:{writer:zSe.write,overridePolicy:fe=>({enabled:"flow"!==fe})}}}}})],USe.prototype,"type",null),e$4o([y$2v({type:[TSe],json:{write:!0}})],USe.prototype,"visualVariables",void 0),e$4o([y$2v({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],USe.prototype,"univariateSymbolStyle",null),e$4o([y$2v({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],USe.prototype,"univariateTheme",null),USe=DSe=e$4o([a$4y("esri.renderers.support.AuthoringInfo")],USe);const VSe=USe,BSe=new An({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let jSe=class a50 extends Pn{constructor(fe){super(fe),this.authoringInfo=null,this.type=null}async getRequiredFields(fe){if(!this.collectRequiredFields)return[];const ve=new Set;return await this.collectRequiredFields(ve,fe),Array.from(ve).sort()}getSymbol(fe,ve){}async getSymbolAsync(fe,ve){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};e$4o([y$2v({type:VSe,json:{write:!0}})],jSe.prototype,"authoringInfo",void 0),e$4o([y$2v({type:BSe.apiValues,readOnly:!0,json:{type:BSe.jsonValues,read:!1,write:{writer:BSe.write,ignoreOrigin:!0}}})],jSe.prototype,"type",void 0),jSe=e$4o([a$4y("esri.renderers.Renderer")],jSe);const GSe=jSe;function e$c(fe){var ve,_e;return(null==(_e=null==(ve=fe.match(HSe))?void 0:ve[1])?void 0:_e.replace(/\\'/g,"'"))??null}const HSe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var qSe;let WSe=qSe=class extends Pn{constructor(){super(...arguments),this.title=null}clone(){return new qSe({title:this.title})}};var YSe;e$4o([y$2v({type:String,json:{write:!0}})],WSe.prototype,"title",void 0),WSe=qSe=e$4o([a$4y("esri.renderers.support.LegendOptions")],WSe);let ZSe=YSe=class extends WSe{constructor(){super(...arguments),this.showLegend=null}clone(){return new YSe({title:this.title,showLegend:this.showLegend})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],ZSe.prototype,"showLegend",void 0),ZSe=YSe=e$4o([a$4y("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],ZSe);const XSe=ZSe,JSe=new An({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let QSe=class u26 extends Pn{constructor(fe){super(fe),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(fe){return null==fe?fe:"function"==typeof fe?(ar.getLogger(this).error(".field: field must be a string value"),null):u$42(fe)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};e$4o([y$2v()],QSe.prototype,"index",void 0),e$4o([y$2v({type:JSe.apiValues,readOnly:!0,json:{read:JSe.read,write:JSe.write}})],QSe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],QSe.prototype,"field",void 0),e$4o([s$4b("field")],QSe.prototype,"castField",null),e$4o([y$2v({type:String,json:{write:!0}})],QSe.prototype,"valueExpression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],QSe.prototype,"valueExpressionTitle",void 0),e$4o([y$2v({readOnly:!0})],QSe.prototype,"arcadeRequired",null),e$4o([y$2v({type:XSe,json:{write:!0}})],QSe.prototype,"legendOptions",void 0),QSe=e$4o([a$4y("esri.renderers.visualVariables.VisualVariable")],QSe);const KSe=QSe;var eTe;let tTe=eTe=class extends Pn{constructor(fe){super(fe),this.color=null,this.label=null,this.value=null}writeValue(fe,ve,_e){ve[_e]=fe??0}clone(){return new eTe({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};e$4o([y$2v({type:b_,json:{type:[Ci],write:!0}})],tTe.prototype,"color",void 0),e$4o([y$2v({type:String,json:{write:!0}})],tTe.prototype,"label",void 0),e$4o([y$2v({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],tTe.prototype,"value",void 0),e$4o([r$3s("value")],tTe.prototype,"writeValue",null),tTe=eTe=e$4o([a$4y("esri.renderers.visualVariables.support.ColorStop")],tTe);const rTe=tTe;var iTe;let nTe=iTe=class extends KSe{constructor(fe){super(fe),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(fe){fe&&Array.isArray(fe)&&(fe=fe.filter((fe=>!!fe))).sort(((fe,ve)=>fe.value-ve.value)),this._set("stops",fe)}clone(){var fe;return new iTe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((fe=>fe.clone())),legendOptions:null==(fe=this.legendOptions)?void 0:fe.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((fe=>fe.value||0))}};e$4o([y$2v({readOnly:!0})],nTe.prototype,"cache",null),e$4o([y$2v({type:["color"],json:{type:["colorInfo"]}})],nTe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],nTe.prototype,"normalizationField",void 0),e$4o([y$2v({type:[rTe],json:{write:!0}})],nTe.prototype,"stops",null),nTe=iTe=e$4o([a$4y("esri.renderers.visualVariables.ColorVariable")],nTe);const sTe=nTe;var oTe;let aTe=oTe=class extends Pn{constructor(fe){super(fe),this.label=null,this.opacity=null,this.value=null}readOpacity(fe,ve){return r$2U(ve.transparency)}writeOpacity(fe,ve,_e){ve[_e]=n$3O(fe)}clone(){return new oTe({label:this.label,opacity:this.opacity,value:this.value})}};e$4o([y$2v({type:String,json:{write:!0}})],aTe.prototype,"label",void 0),e$4o([y$2v({type:Number,json:{type:Ci,write:{target:"transparency"}}})],aTe.prototype,"opacity",void 0),e$4o([o$40("opacity",["transparency"])],aTe.prototype,"readOpacity",null),e$4o([r$3s("opacity")],aTe.prototype,"writeOpacity",null),e$4o([y$2v({type:Number,json:{write:!0}})],aTe.prototype,"value",void 0),aTe=oTe=e$4o([a$4y("esri.renderers.visualVariables.support.OpacityStop")],aTe);const lTe=aTe;var cTe;let uTe=cTe=class extends KSe{constructor(fe){super(fe),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(fe){fe&&Array.isArray(fe)&&(fe=fe.filter((fe=>!!fe))).sort(((fe,ve)=>fe.value-ve.value)),this._set("stops",fe)}clone(){var fe;return new cTe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((fe=>fe.clone())),legendOptions:null==(fe=this.legendOptions)?void 0:fe.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((fe=>fe.value||0))}};e$4o([y$2v({readOnly:!0})],uTe.prototype,"cache",null),e$4o([y$2v({type:["opacity"],json:{type:["transparencyInfo"]}})],uTe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],uTe.prototype,"normalizationField",void 0),e$4o([y$2v({type:[lTe],json:{write:!0}})],uTe.prototype,"stops",null),uTe=cTe=e$4o([a$4y("esri.renderers.visualVariables.OpacityVariable")],uTe);const hTe=uTe;var dTe;let pTe=dTe=class extends KSe{constructor(fe){super(fe),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(fe,ve,_e,be){if(null==be?void 0:be.messages){const fe=`visualVariables[${this.index}]`;be.messages.push(new Ir("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:fe+".valueExpressionTitle",context:be}))}}clone(){var fe;return new dTe({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:null==(fe=this.legendOptions)?void 0:fe.clone()})}};e$4o([y$2v({readOnly:!0})],pTe.prototype,"cache",null),e$4o([y$2v({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],pTe.prototype,"axis",void 0),e$4o([y$2v({type:["rotation"],json:{type:["rotationInfo"]}})],pTe.prototype,"type",void 0),e$4o([y$2v({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],pTe.prototype,"rotationType",void 0),e$4o([y$2v({type:String,json:{write:!0}})],pTe.prototype,"valueExpressionTitle",void 0),e$4o([r$3s("web-scene","valueExpressionTitle")],pTe.prototype,"writeValueExpressionTitleWebScene",null),pTe=dTe=e$4o([a$4y("esri.renderers.visualVariables.RotationVariable")],pTe);const fTe=pTe;var mTe;let yTe=mTe=class extends Pn{constructor(fe){super(fe),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new mTe({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};e$4o([y$2v({type:String,json:{write:!0}})],yTe.prototype,"label",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],yTe.prototype,"size",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],yTe.prototype,"value",void 0),e$4o([y$2v({type:Boolean,json:{write:!1}})],yTe.prototype,"useMinValue",void 0),e$4o([y$2v({type:Boolean,json:{write:!1}})],yTe.prototype,"useMaxValue",void 0),yTe=mTe=e$4o([a$4y("esri.renderers.visualVariables.support.SizeStop")],yTe);const gTe=yTe;var vTe;let _Te=vTe=class extends XSe{constructor(){super(...arguments),this.customValues=null}clone(){var fe;return new vTe({title:this.title,showLegend:this.showLegend,customValues:null==(fe=this.customValues)?void 0:fe.slice(0)})}};e$4o([y$2v({type:[Number],json:{write:!0}})],_Te.prototype,"customValues",void 0),_Te=vTe=e$4o([a$4y("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],_Te);const $Te=_Te;var bTe;const wTe=new An({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),xTe=new An({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function g$e(fe){if(null!=fe)return"string"==typeof fe||"number"==typeof fe?function e$b(fe){return o$3L(fe)}(fe):"size"===fe.type?e$1R(fe)?fe:(delete(fe={...fe}).type,new STe(fe)):void 0}function V$6(fe,ve,_e){if("object"!=typeof fe)return fe;const be=new STe;return be.read(fe,_e),be}let STe=bTe=class extends KSe{constructor(fe){super(fe),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&ZW.test(this.valueExpression)}}set index(fe){e$1R(this.maxSize)&&(this.maxSize.index=`visualVariables[${fe}].maxSize`),e$1R(this.minSize)&&(this.minSize.index=`visualVariables[${fe}].minSize`),this._set("index",fe)}get inputValueType(){return t$1Y(this)}set maxDataValue(fe){fe&&this.stops&&(ar.getLogger(this).warn("cannot set maxDataValue when stops is not null."),fe=null),this._set("maxDataValue",fe)}set maxSize(fe){fe&&this.stops&&(ar.getLogger(this).warn("cannot set maxSize when stops is not null."),fe=null),this._set("maxSize",fe)}castMaxSize(fe){return g$e(fe)}readMaxSize(fe,ve,_e){return V$6(fe,0,_e)}set minDataValue(fe){fe&&this.stops&&(ar.getLogger(this).warn("cannot set minDataValue when stops is not null."),fe=null),this._set("minDataValue",fe)}set minSize(fe){fe&&this.stops&&(ar.getLogger(this).warn("cannot set minSize when stops is not null."),fe=null),this._set("minSize",fe)}castMinSize(fe){return g$e(fe)}readMinSize(fe,ve,_e){return V$6(fe,0,_e)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(fe){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?fe&&Array.isArray(fe)&&(fe=fe.filter((fe=>!!fe))).sort(((fe,ve)=>fe.value-ve.value)):fe&&(ar.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),fe=null),this._set("stops",fe)}get transformationType(){return function a$29(fe,ve){const _e=ve||t$1Y(fe),be=fe.valueUnit||"unknown";return _e===HW.Unknown?qW.Constant:fe.stops?qW.Stops:null!=fe.minSize&&null!=fe.maxSize&&null!=fe.minDataValue&&null!=fe.maxDataValue?qW.ClampedLinear:"unknown"===be?null!=fe.minSize&&null!=fe.minDataValue?fe.minSize&&fe.minDataValue?qW.Proportional:qW.Additive:qW.Identity:qW.RealWorldSize}(this,this.inputValueType)}readValueExpression(fe,ve){return fe||ve.expression&&"$view.scale"}writeValueExpressionWebScene(fe,ve,_e,be){if("$view.scale"===fe){if(null==be?void 0:be.messages){const fe=this.index,ve="string"==typeof fe?fe:`visualVariables[${fe}]`;be.messages.push(new Ir("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:ve+".valueExpression",context:be}))}}else ve[_e]=fe}readValueUnit(fe){return fe?xTe.read(fe):null}clone(){var fe,ve;return new bTe({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:e$1R(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:e$1R(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:null==(fe=this.stops)?void 0:fe.map((fe=>fe.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:null==(ve=this.legendOptions)?void 0:ve.clone()})}flipSizes(){if(this.transformationType===qW.ClampedLinear){const{minSize:fe,maxSize:ve}=this;return this.minSize=ve,this.maxSize=fe,this}if(this.transformationType===qW.Stops){const fe=this.stops;if(!fe)return this;const ve=fe.map((fe=>fe.size)).reverse(),_e=fe.length;for(let be=0;be<_e;be++)fe[be].size=ve[be];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var fe;return null==(fe=this.stops)?void 0:fe.map((fe=>fe.value||0))}};e$4o([y$2v({readOnly:!0})],STe.prototype,"cache",null),e$4o([y$2v({type:wTe.apiValues,json:{type:wTe.jsonValues,origins:{"web-map":{read:!1}},read:wTe.read,write:wTe.write}})],STe.prototype,"axis",void 0),e$4o([y$2v()],STe.prototype,"index",null),e$4o([y$2v({type:String,readOnly:!0})],STe.prototype,"inputValueType",null),e$4o([y$2v({type:$Te,json:{write:!0}})],STe.prototype,"legendOptions",void 0),e$4o([y$2v({type:Number,value:null,json:{write:!0}})],STe.prototype,"maxDataValue",null),e$4o([y$2v({type:Number,value:null,json:{write:!0}})],STe.prototype,"maxSize",null),e$4o([s$4b("maxSize")],STe.prototype,"castMaxSize",null),e$4o([o$40("maxSize")],STe.prototype,"readMaxSize",null),e$4o([y$2v({type:Number,value:null,json:{write:!0}})],STe.prototype,"minDataValue",null),e$4o([y$2v({type:Number,value:null,json:{write:!0}})],STe.prototype,"minSize",null),e$4o([s$4b("minSize")],STe.prototype,"castMinSize",null),e$4o([o$40("minSize")],STe.prototype,"readMinSize",null),e$4o([y$2v({type:String,json:{write:!0}})],STe.prototype,"normalizationField",void 0),e$4o([y$2v({readOnly:!0})],STe.prototype,"arcadeRequired",null),e$4o([y$2v({type:String})],STe.prototype,"scaleBy",void 0),e$4o([y$2v({type:[gTe],value:null,json:{write:!0}})],STe.prototype,"stops",null),e$4o([y$2v({type:["outline"],json:{write:!0}})],STe.prototype,"target",void 0),e$4o([y$2v({type:String,readOnly:!0})],STe.prototype,"transformationType",null),e$4o([y$2v({type:["size"],json:{type:["sizeInfo"]}})],STe.prototype,"type",void 0),e$4o([y$2v({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],STe.prototype,"useSymbolValue",void 0),e$4o([y$2v({type:String,json:{write:!0}})],STe.prototype,"valueExpression",void 0),e$4o([o$40("valueExpression",["valueExpression","expression"])],STe.prototype,"readValueExpression",null),e$4o([r$3s("web-scene","valueExpression")],STe.prototype,"writeValueExpressionWebScene",null),e$4o([y$2v({type:["radius","diameter","area","width","distance"],json:{write:!0}})],STe.prototype,"valueRepresentation",void 0),e$4o([y$2v({type:xTe.apiValues,json:{write:xTe.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],STe.prototype,"valueUnit",void 0),e$4o([o$40("valueUnit")],STe.prototype,"readValueUnit",null),STe=bTe=e$4o([a$4y("esri.renderers.visualVariables.SizeVariable")],STe);const TTe=STe,ETe={color:sTe,size:TTe,opacity:hTe,rotation:fTe},PTe=new An({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),CTe=/^\[([^\]]+)\]$/i;let OTe=class m35 extends zi{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(fe){if(this._resetVariables(),null==(fe=fe&&fe.filter((fe=>!!fe)))?void 0:fe.length){for(const ve of fe)switch(ve.type){case"color":this.colorVariables.push(ve);break;case"opacity":this.opacityVariables.push(ve);break;case"rotation":this.rotationVariables.push(ve);break;case"size":this.sizeVariables.push(ve)}this.sizeVariables.length&&this.sizeVariables.some((fe=>!!fe.target))&&fe.sort(((fe,ve)=>{let _e=null;return _e=fe.target===ve.target?0:fe.target?1:-1,_e}));for(let ve=0;ve<fe.length;ve++)fe[ve].index=ve;this._set("visualVariables",fe)}else this._set("visualVariables",fe)}readVariables(fe,ve,_e){const{rotationExpression:be,rotationType:we}=ve,Se=null==be?void 0:be.match(CTe),Te=null==Se?void 0:Se[1];if(Te&&(fe||(fe=[]),fe.push({type:"rotationInfo",rotationType:we,field:Te})),fe)return fe.map((fe=>{const ve=PTe.read(fe.type),be=ETe[ve];be||(ar.getLogger(this).warn(`Unknown variable type: ${ve}`),(null==_e?void 0:_e.messages)&&_e.messages.push(new Mi("visual-variable:unsupported",`visualVariable of type '${ve}' is not supported`,{definition:fe,context:_e})));const we=new be;return we.read(fe,_e),we}))}writeVariables(fe,ve){const _e=[];for(const be of fe){const fe=be.toJSON(ve);fe&&_e.push(fe)}return _e}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};e$4o([y$2v()],OTe.prototype,"visualVariables",null),OTe=e$4o([a$4y("esri.renderers.visualVariables.VisualVariableFactory")],OTe);const ATe=OTe,MTe={base:KSe,key:"type",typeMap:{opacity:hTe,color:sTe,rotation:fTe,size:TTe}},v$5=fe=>{let ve=class extends fe{constructor(){super(...arguments),this._vvFactory=new ATe}set visualVariables(fe){this._vvFactory.visualVariables=fe,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(fe,ve,_e){return this._vvFactory.readVariables(fe,ve,_e)}writeVisualVariables(fe,ve,_e,be){ve[_e]=this._vvFactory.writeVariables(fe,be)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const fe of this.visualVariables)if(fe.arcadeRequired)return!0;return!1}hasVisualVariables(fe,ve){return fe?this.getVisualVariablesForType(fe,ve).length>0:this.getVisualVariablesForType("size",ve).length>0||this.getVisualVariablesForType("color",ve).length>0||this.getVisualVariablesForType("opacity",ve).length>0||this.getVisualVariablesForType("rotation",ve).length>0}getVisualVariablesForType(fe,ve){const _e=this.visualVariables;return _e?_e.filter((_e=>_e.type===fe&&("string"==typeof ve?_e.target===ve:!1!==ve||!_e.target))):[]}async collectVVRequiredFields(fe,ve){let _e=[];this.visualVariables&&(_e=_e.concat(this.visualVariables));for(const be of _e)be&&(be.field&&w$1u(fe,ve,be.field),be.normalizationField&&w$1u(fe,ve,be.normalizationField),be.valueExpression&&(y$e(be.valueExpression,fe,ve)||await h$2h(fe,ve,be.valueExpression)))}};return e$4o([y$2v({types:[MTe],value:null,json:{write:!0}})],ve.prototype,"visualVariables",null),e$4o([o$40("visualVariables",["visualVariables","rotationType","rotationExpression"])],ve.prototype,"readVisualVariables",null),e$4o([r$3s("visualVariables")],ve.prototype,"writeVisualVariables",null),ve=e$4o([a$4y("esri.renderers.mixins.VisualVariablesMixin")],ve),ve};function y$e(fe,ve,_e){const be=e$c(fe);return null!=be&&(w$1u(ve,_e,be),!0)}const RTe={types:TT,json:{write:{writer:l$1z},origins:{"web-scene":{types:PT,write:{writer:l$1z},read:{reader:u$41({types:PT})}}}}},ITe=n$4R({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},RTe),LTe={types:{base:nw,key:"type",typeMap:{"simple-fill":_T.typeMap["simple-fill"],"picture-fill":_T.typeMap["picture-fill"],"polygon-3d":_T.typeMap["polygon-3d"]}},json:{write:{writer:l$1z},origins:{"web-scene":{type:nT,write:{writer:l$1z}}}}},DTe={cast:fe=>null==fe||"string"==typeof fe||"number"==typeof fe?fe:`${fe}`,json:{type:String,write:{writer:(fe,ve)=>{ve.value=null==fe?void 0:fe.toString()}}}};var NTe;let FTe=NTe=class extends Pn{constructor(fe){super(fe),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var fe;return new NTe({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:(null==(fe=this.symbol)?void 0:fe.clone())??null})}getMeshHash(){const fe=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${fe}`}};e$4o([y$2v({type:String,json:{write:!0}})],FTe.prototype,"description",void 0),e$4o([y$2v({type:String,json:{write:!0}})],FTe.prototype,"label",void 0),e$4o([y$2v({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],FTe.prototype,"minValue",void 0),e$4o([y$2v({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],FTe.prototype,"maxValue",void 0),e$4o([y$2v(ITe)],FTe.prototype,"symbol",void 0),FTe=NTe=e$4o([a$4y("esri.renderers.support.ClassBreakInfo")],FTe);const zTe=FTe;var kTe;const UTe="percent-of-total",VTe="field",BTe=new An({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:UTe,esriNormalizeByField:VTe}),jTe=b$2d(zTe);let GTe=kTe=class extends(v$5(GSe)){constructor(fe){super(fe),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(fe,ve,_e){if(!Array.isArray(fe))return;let be=ve.minValue;return fe.map((fe=>{const ve=new zTe;return ve.read(fe,_e),null==ve.minValue&&(ve.minValue=be),null==ve.maxValue&&(ve.maxValue=ve.minValue),be=ve.maxValue,ve}))}writeClassBreakInfos(fe,ve,_e,be){const we=fe.map((fe=>fe.write({},be)));this._areClassBreaksConsecutive()&&we.forEach((fe=>delete fe.classMinValue)),ve[_e]=we}castField(fe){return null==fe?fe:"function"==typeof fe?(ar.getLogger(this).error(".field: field must be a string value"),null):u$42(fe)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let fe=this._get("normalizationType");const ve=!!this.normalizationField,_e=null!=this.normalizationTotal;return ve||_e?(fe=ve&&VTe||_e&&UTe||null,ve&&_e&&ar.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):fe!==VTe&&fe!==UTe||(fe=null),fe}set normalizationType(fe){this._set("normalizationType",fe)}addClassBreakInfo(fe,ve,_e){let be=null;be="number"==typeof fe?new zTe({minValue:fe,maxValue:ve,symbol:OT(_e)}):jTe(a$4H(fe)),this.classBreakInfos.push(be),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(fe,ve){const _e=this.classBreakInfos.length;for(let be=0;be<_e;be++){const _e=[this.classBreakInfos[be].minValue,this.classBreakInfos[be].maxValue];if(_e[0]===fe&&_e[1]===ve){this.classBreakInfos.splice(be,1);break}}}getBreakIndex(fe,ve){return this.valueExpression&&null==(null==ve?void 0:ve.arcade)&&ar.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(fe,ve):this._getBreakIndexForField(fe)}async getClassBreakInfo(fe,ve){let _e=ve;this.valueExpression&&null==(null==ve?void 0:ve.arcade)&&(_e={..._e,arcade:await i$3H()});const be=this.getBreakIndex(fe,_e);return-1!==be?this.classBreakInfos[be]:null}getSymbol(fe,ve){if(this.valueExpression&&null==(null==ve?void 0:ve.arcade))return void ar.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const _e=this.getBreakIndex(fe,ve);return _e>-1?this.classBreakInfos[_e].symbol:this.defaultSymbol}async getSymbolAsync(fe,ve){let _e=ve;if(this.valueExpression&&null==(null==ve?void 0:ve.arcade)){const fe=await i$3H(),{arcadeUtils:ve}=fe;ve.hasGeometryOperations(this.valueExpression)&&await ve.enableGeometryOperations(),_e={..._e,arcade:fe}}const be=this.getBreakIndex(fe,_e);return be>-1?this.classBreakInfos[be].symbol:this.defaultSymbol}getSymbols(){const fe=[];return this.classBreakInfos.forEach((ve=>{ve.symbol&&fe.push(ve.symbol)})),this.defaultSymbol&&fe.push(this.defaultSymbol),fe}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((fe,ve)=>fe+ve.getAttributeHash()),"")}getMeshHash(){const fe=JSON.stringify(this.backgroundFillSymbol),ve=JSON.stringify(this.defaultSymbol),_e=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${fe}.${ve}.${this.classBreakInfos.reduce(((fe,ve)=>fe+ve.getMeshHash()),"")}.${_e}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var fe,ve;return new kTe({field:this.field,backgroundFillSymbol:null==(fe=this.backgroundFillSymbol)?void 0:fe.clone(),defaultLabel:this.defaultLabel,defaultSymbol:null==(ve=this.defaultSymbol)?void 0:ve.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:a$4H(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:a$4H(this.visualVariables),legendOptions:a$4H(this.legendOptions),authoringInfo:a$4H(this.authoringInfo)})}async collectRequiredFields(fe,ve){const _e=[this.collectVVRequiredFields(fe,ve),this.collectSymbolFields(fe,ve)];await Promise.all(_e)}async collectSymbolFields(fe,ve){const _e=[...this.getSymbols().map((_e=>_e.collectRequiredFields(fe,ve))),h$2h(fe,ve,this.valueExpression)];w$1u(fe,ve,this.field),w$1u(fe,ve,this.normalizationField),await Promise.all(_e)}_getBreakIndexForExpression(fe,ve){const{viewingMode:_e,scale:be,spatialReference:we,arcade:Se,timeZone:Te}=ve??{},{valueExpression:Ee}=this;let Ce=this._compiledValueExpression.valueExpression===Ee?this._compiledValueExpression.compiledFunction:null;const Oe=Se.arcadeUtils;if(!Ce){const fe=Oe.createSyntaxTree(Ee);Ce=Oe.createFunction(fe),this._compiledValueExpression.compiledFunction=Ce}this._compiledValueExpression.valueExpression=Ee;const Re=Oe.executeFunction(Ce,Oe.createExecContext(fe,Oe.getViewInfo({viewingMode:_e,scale:be,spatialReference:we}),Te));return this._getBreakIndexfromInfos(Re)}_getBreakIndexForField(fe){const ve=this.field,_e=fe.attributes,be=this.normalizationType;let we=parseFloat(_e[ve]);if(be){const fe=this.normalizationTotal,ve=parseFloat(this.normalizationField?_e[this.normalizationField]:void 0);if("log"===be)we=Math.log(we)*Math.LOG10E;else if(be!==UTe||null==fe||isNaN(fe)){if(be===VTe&&!isNaN(ve)){if(isNaN(we)||isNaN(ve))return-1;we/=ve}}else we=we/fe*100}return this._getBreakIndexfromInfos(we)}_getBreakIndexfromInfos(fe){const ve=this.isMaxInclusive;if(null!=fe&&"number"==typeof fe&&!isNaN(fe))for(let _e=0;_e<this.classBreakInfos.length;_e++){const be=[this.classBreakInfos[_e].minValue,this.classBreakInfos[_e].maxValue];if(be[0]<=fe&&(ve?fe<=be[1]:fe<be[1]))return _e}return-1}_areClassBreaksConsecutive(){const fe=this.classBreakInfos,ve=fe.length;for(let _e=1;_e<ve;_e++)if(fe[_e-1].maxValue!==fe[_e].minValue)return!1;return!0}};e$4o([y$2v(LTe)],GTe.prototype,"backgroundFillSymbol",void 0),e$4o([y$2v({type:[zTe]})],GTe.prototype,"classBreakInfos",void 0),e$4o([o$40("classBreakInfos")],GTe.prototype,"readClassBreakInfos",null),e$4o([r$3s("classBreakInfos")],GTe.prototype,"writeClassBreakInfos",null),e$4o([y$2v({type:String,json:{write:!0}})],GTe.prototype,"defaultLabel",void 0),e$4o([y$2v(RTe)],GTe.prototype,"defaultSymbol",void 0),e$4o([y$2v({type:String,json:{write:!0}})],GTe.prototype,"field",void 0),e$4o([s$4b("field")],GTe.prototype,"castField",null),e$4o([y$2v({type:Boolean})],GTe.prototype,"isMaxInclusive",void 0),e$4o([y$2v({type:WSe,json:{write:!0}})],GTe.prototype,"legendOptions",void 0),e$4o([y$2v({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],GTe.prototype,"minValue",null),e$4o([y$2v({type:String,json:{write:!0}})],GTe.prototype,"normalizationField",void 0),e$4o([y$2v({type:Number,cast:fe=>a$4C(fe),json:{write:!0}})],GTe.prototype,"normalizationTotal",void 0),e$4o([y$2v({type:BTe.apiValues,value:null,json:{type:BTe.jsonValues,read:BTe.read,write:BTe.write}})],GTe.prototype,"normalizationType",null),e$4o([o$3g({classBreaks:"class-breaks"})],GTe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],GTe.prototype,"valueExpression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],GTe.prototype,"valueExpressionTitle",void 0),GTe=kTe=e$4o([a$4y("esri.renderers.ClassBreaksRenderer")],GTe);const HTe=GTe;let qTe=class t80{};function r$8(fe){return fe instanceof Zone?fe===qTe.instance:"unknown"===(null==fe?void 0:fe.toString().toLowerCase())}function i$w(fe){return r$8(fe)?qTe.instance:fe}qTe.instance=new IANAZone("Etc/UTC");const WTe=new Map;let YTe=class Z4{static fromJSON(fe){return new Z4(fe.fields,fe.timeZoneByFieldName)}static fromLayer(fe){return new Z4(fe.fields??[],S$5(fe))}static fromLayerJSON(fe){return new Z4(fe.fields??[],S$5(fe))}constructor(fe=[],ve){var _e;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=fe||[],this._timeZoneByFieldName=ve?new Map(ve):null;const be=[];for(const we of this.fields){const fe=null==we?void 0:we.name,ve=M$3(fe);if(fe&&ve){const Se=w$6(fe);this._fieldsMap.set(fe,we),this._fieldsMap.set(Se,we),this._normalizedFieldsMap.set(ve,we),be.push(`${Se}:${we.type}:${null==(_e=this._timeZoneByFieldName)?void 0:_e.get(fe)}`),ge$6(we)?(this.dateFields.push(we),this._dateFieldsSet.add(we)):pe$a(we)&&(this._numericFieldsSet.add(we),this.numericFields.push(we)),we$2(we)||xe(we)||(we.editable=null==we.editable||!!we.editable,we.nullable=null==we.nullable||!!we.nullable)}}be.sort(),this.uid=be.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const fe of this.fields)we$2(fe)||xe(fe)||fe.nullable||void 0!==H$T(fe)||this._requiredFields.push(fe)}return this._requiredFields}equals(fe){return this.uid===(null==fe?void 0:fe.uid)}has(fe){return null!=this.get(fe)}get(fe){if(!fe)return;let ve=this._fieldsMap.get(fe);return ve||(ve=this._fieldsMap.get(w$6(fe))??this._normalizedFieldsMap.get(M$3(fe)),ve&&this._fieldsMap.set(fe,ve),ve)}getTimeZone(fe){const ve=this.get(fe&&"string"!=typeof fe?fe.name:fe);return ve?this._timeZoneByFieldName?this._timeZoneByFieldName.get(ve.name):"date"===ve.type||"esriFieldTypeDate"===ve.type?(ar.getLogger("esri.layers.support.FieldsIndex").error(new Ir("getTimeZone:no-timezone-information",`no time zone information for field '${ve.name}'`)),Tu):ZTe.has(ve.type)?Su:null:null}getLuxonTimeZone(fe){const ve=this.getTimeZone(fe);return ve?ve===Su?qTe.instance:ve===Tu?FixedOffsetZone.utcInstance:r$3B(WTe,ve,(()=>IANAZone.create(ve))):null}isDateField(fe){return this._dateFieldsSet.has(this.get(fe))}isTimeOnlyField(fe){return be$3(this.get(fe))}isNumericField(fe){return this._numericFieldsSet.has(this.get(fe))}normalizeFieldName(fe){var ve;return(null==(ve=this.get(fe))?void 0:ve.name)??void 0}toJSON(){return{fields:this.fields.map((fe=>a$4s(fe)?fe.toJSON():fe)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function w$6(fe){return fe.trim().toLowerCase()}function M$3(fe){var ve;return(null==(ve=c$3S(fe))?void 0:ve.toLowerCase())??""}const ZTe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function S$5(fe){const ve=new Map;if(!fe.fields)return ve;const _e=!0===fe.datesInUnknownTimezone,{timeInfo:be,editFieldsInfo:we}=fe,Se=(be?"startField"in be?be.startField:be.startTimeField:"")??"",Te=(be?"endField"in be?be.endField:be.endTimeField:"")??"",Ee=function g$d(fe){return"dateFieldsTimeZone"in fe}(fe)?fe.dateFieldsTimeZone??null:fe.dateFieldsTimeReference?f$2V(fe.dateFieldsTimeReference):null,Ce=we?function y$c(fe){return"timeZone"in fe}(we)?we.timeZone??Ee:we.dateFieldsTimeReference?f$2V(we.dateFieldsTimeReference):Ee??Tu:null,Oe=be?function _$3(fe){return"timeZone"in fe}(be)?be.timeZone??Ee:be.timeReference?f$2V(be.timeReference):Ee:null,Re=new Map([[w$6((null==we?void 0:we.creationDateField)??""),Ce],[w$6((null==we?void 0:we.editDateField)??""),Ce],[w$6(Se),Oe],[w$6(Te),Oe]]);for(const{name:De,type:Be}of fe.fields)if(ZTe.has(Be))ve.set(De,Su);else if("date"!==Be&&"esriFieldTypeDate"!==Be)ve.set(De,null);else if(_e)ve.set(De,Su);else{const fe=Re.get(w$6(De??""))??Ee;ve.set(De,fe)}return ve}const XTe="esri.renderers.support.DictionaryLoader",JTe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let QTe=class g23{constructor(fe,ve,_e){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new W9(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=fe,this.config=ve,this.fieldMap=_e}getSymbolFields(){return this._symbolFields}async getSymbolAsync(fe,ve){var _e;let be;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(ve));try{be=await this._dictionaryPromise}catch(De){if(b$2g(De))return this._dictionaryPromise=null,null}const we=null==(_e=this._dictionaryVersion)?void 0:_e.since(4,0),Se={};if(this.fieldMap)for(const Ze of this._symbolFields){const ve=B$l(this.fieldMap[Ze],this._fieldIndex);if(ve){const _e=fe.attributes[ve];Se[Ze]=we?_e:null!=_e?""+fe.attributes[ve]:""}else Se[Ze]=""}let Te=null;try{Te=null==be?void 0:be(Se,ve)}catch(Be){return null}if(!Te||"string"!=typeof Te||"invalid"===Te)return null;const Ee=Te.split(";"),Ce=[],Oe=[];for(const Ze of Ee)if(Ze)if(Ze.includes("po:")){const fe=Ze.substr(3).split("|");if(3===fe.length){const ve=fe[0],_e=fe[1];let be=fe[2];if("DashTemplate"===_e)be=be.split(" ").map((fe=>Number(fe)));else if("Color"===_e){const fe=new b_(be).toRgba();be=[fe[0],fe[1],fe[2],255*fe[3]]}else be=Number(be);Oe.push({primitiveName:ve,propertyName:_e,value:be,defaultValue:null})}}else if(Ze.includes("|")){for(const fe of Ze.split("|"))if(this._itemNames.has(fe)){Ce.push(fe);break}}else this._itemNames.has(Ze)&&Ce.push(Ze);const Re=null==fe.geometry||!fe.geometry.hasZ&&"point"===fe.geometry.type;return this._cimPartsToCIMSymbol(fe,Ce,Oe,Re,ve)}async fetchResources(fe){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void ar.getLogger(XTe).error("no valid URL!");const ve=U$1a(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=fe?fe.signal:null}),[{data:_e}]=await Promise.all([ve,i$3H()]);if(!_e)throw this._dictionaryPromise=null,new Ir("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:be,dictionary_version:we,expression:Se,itemsNames:Te}=_e,Ee=Se;let Ce=!1;we&&(this._dictionaryVersion=Cre.parse(we),Ce=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+_e.cimRefTemplateUrl,this._itemNames=new Set(Te),this._symbolFields=be.symbol;const Oe={};if(this.config){const fe=this.config;for(const ve in fe)Oe[ve]=fe[ve]}if(be.configuration)for(const Be of be.configuration)Oe.hasOwnProperty(Be.name)||(Oe[Be.name]=Be.value);const Re=[];if((null==fe?void 0:fe.fields)&&this.fieldMap)for(const Be in this.fieldMap){const ve=this.fieldMap[Be],_e=fe.fields.filter((fe=>fe.name.toLowerCase()===(null==ve?void 0:ve.toLowerCase())));_e.length>0&&Re.push({..._e[0],type:Ce?_e[0].type:"esriFieldTypeString"})}Re.length>0&&(this._fieldIndex=new YTe(Re));const De=((fe,ve,_e,be)=>i$.create(fe,ve,_e,be,["$feature","$view"],[]))(Ee,null!=fe?fe.spatialReference:null,Re,Oe).then((fe=>{const ve={scale:0};return(_e,be)=>{if(null==fe)return null;const we=fe.repurposeFeature({geometry:null,attributes:_e});return ve.scale=null!=be?be.scale??void 0:void 0,fe.evaluate({$feature:we,$view:ve},fe.services)}})).catch((fe=>(ar.getLogger(XTe).error("Creating dictionary expression failed:",fe),null)));return this._dictionaryPromise=De,De}async _cimPartsToCIMSymbol(fe,ve,_e,be,we){const Se=new Array(ve.length);for(let Ce=0;Ce<ve.length;Ce++)Se[Ce]=this._getSymbolPart(ve[Ce],we);let Te=await Promise.all(Se);const Ee=this.fieldMap;if(Ee){Te=a$4H(Te);for(const ve of Te)$9.applyDictionaryTextOverrides(ve,fe,Ee,this._fieldIndex,j$I(ve))}return new aw({data:_$2(Te,_e,be)})}async _getSymbolPart(fe,ve){const _e=this._symbolCache.get(fe);if(_e)return _e;if(this._ongoingRequests.has(fe))return this._ongoingRequests.get(fe).then((fe=>fe.data));const be=U$1a(this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,fe),{responseType:"json",query:{f:"json"},...ve});this._ongoingRequests.set(fe,be),be.finally((()=>this._ongoingRequests.delete(fe)));try{const ve=await be;return this._symbolCache.put(fe,ve.data),ve.data}catch(da){throw da}}};function _$2(fe,ve,_e){if(!fe||0===fe.length)return null;const be={...fe[0]};if(fe.length>1){be.symbolLayers=[];for(const ve of fe){const fe=ve;be.symbolLayers.unshift(...fe.symbolLayers)}}return _e&&(be.callout=JTe),{type:"CIMSymbolReference",symbol:be,primitiveOverrides:ve}}var KTe;let eEe=KTe=class extends(v$5(GSe)){constructor(fe){super(fe),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new QTe(this.url,this.config,this.fieldMap)}writeData(fe,ve){fe&&(ve.scalingExpressionInfo={expression:fe,returnType:"number"})}writeVisualVariables(fe,ve,_e,be){(null==be?void 0:be.origin)||super.writeVisualVariables(fe,ve,_e,be)}clone(){return new KTe({config:a$4H(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:a$4H(this.fieldMap),url:a$4H(this.url),visualVariables:a$4H(this.visualVariables)})}async getSymbolAsync(fe,ve){return this._loader.getSymbolAsync(fe,ve)}async collectRequiredFields(fe,ve){await this.collectVVRequiredFields(fe,ve),this.scaleExpression&&await h$2h(fe,ve,this.scaleExpression);for(const _e in this.fieldMap){const be=this.fieldMap[_e];ve.has(be)&&fe.add(be)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((fe,ve)=>fe+ve.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};e$4o([y$2v({type:QTe})],eEe.prototype,"_loader",null),e$4o([y$2v({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],eEe.prototype,"config",void 0),e$4o([y$2v({type:Object,json:{write:!0}})],eEe.prototype,"fieldMap",void 0),e$4o([y$2v({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],eEe.prototype,"scaleExpression",void 0),e$4o([r$3s("scaleExpression")],eEe.prototype,"writeData",null),e$4o([y$2v({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(fe){return{enabled:!!fe&&!!this.scaleExpression}}}}})],eEe.prototype,"scaleExpressionTitle",void 0),e$4o([y$2v({type:String,json:{write:!0}})],eEe.prototype,"url",void 0),e$4o([r$3s("visualVariables")],eEe.prototype,"writeVisualVariables",null),eEe=KTe=e$4o([a$4y("esri.renderers.DictionaryRenderer")],eEe);const tEe=eEe;var rEe;let iEe=rEe=class extends Pn{constructor(fe){super(fe),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(fe){return null==fe?fe:"function"==typeof fe?(ar.getLogger(this).error(".field: field must be a string value"),null):u$42(fe)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var fe;return new rEe({color:null==(fe=this.color)?void 0:fe.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};e$4o([y$2v({type:b_,json:{type:[Number],write:!0}})],iEe.prototype,"color",void 0),e$4o([y$2v({type:String,json:{write:!0}})],iEe.prototype,"field",void 0),e$4o([s$4b("field")],iEe.prototype,"castField",null),e$4o([y$2v({type:String,json:{write:!0}})],iEe.prototype,"label",void 0),e$4o([y$2v({type:String,json:{write:!0}})],iEe.prototype,"valueExpression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],iEe.prototype,"valueExpressionTitle",void 0),iEe=rEe=e$4o([a$4y("esri.renderers.support.AttributeColorInfo")],iEe);const nEe=iEe;var sEe;let oEe=sEe=class extends Pn{constructor(){super(...arguments),this.unit=null}clone(){return new sEe({unit:this.unit})}};e$4o([y$2v({type:String,json:{write:!0}})],oEe.prototype,"unit",void 0),oEe=sEe=e$4o([a$4y("esri.renderers.support.DotDensityLegendOptions")],oEe);const aEe=oEe;var lEe;let cEe=lEe=class extends(v$5(GSe)){constructor(fe){super(fe),this.attributes=null,this.backgroundColor=new b_([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Dw,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(fe){if(null==this.referenceScale)return this.dotValue;const ve=fe/this.referenceScale*this.dotValue;return ve<1?1:ve}getSymbol(){return new lT({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var fe;return(null==(fe=this.attributes)?void 0:fe.reduce(((fe,ve)=>fe+ve.getAttributeHash()),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new lEe({attributes:a$4H(this.attributes),backgroundColor:a$4H(this.backgroundColor),dotBlendingEnabled:a$4H(this.dotBlendingEnabled),dotShape:a$4H(this.dotShape),dotSize:a$4H(this.dotSize),dotValue:a$4H(this.dotValue),legendOptions:a$4H(this.legendOptions),outline:a$4H(this.outline),referenceScale:a$4H(this.referenceScale),seed:a$4H(this.seed),visualVariables:a$4H(this.visualVariables),authoringInfo:a$4H(this.authoringInfo)})}getControllerHash(){var fe;return`${null==(fe=this.attributes)?void 0:fe.map((fe=>fe.field||fe.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(fe,ve){await this.collectVVRequiredFields(fe,ve);for(const _e of this.attributes??[])_e.valueExpression&&await h$2h(fe,ve,_e.valueExpression),_e.field&&fe.add(_e.field)}};e$4o([y$2v({type:[nEe],json:{write:!0}})],cEe.prototype,"attributes",void 0),e$4o([y$2v({type:b_,json:{write:!0}})],cEe.prototype,"backgroundColor",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],cEe.prototype,"dotBlendingEnabled",void 0),e$4o([y$2v({type:String,json:{write:!1}})],cEe.prototype,"dotShape",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],cEe.prototype,"dotSize",void 0),e$4o([y$2v({type:aEe,json:{write:!0}})],cEe.prototype,"legendOptions",void 0),e$4o([y$2v({type:Dw,json:{default:null,write:!0}})],cEe.prototype,"outline",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],cEe.prototype,"dotValue",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],cEe.prototype,"referenceScale",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],cEe.prototype,"seed",void 0),e$4o([o$3g({dotDensity:"dot-density"})],cEe.prototype,"type",void 0),cEe=lEe=e$4o([a$4y("esri.renderers.DotDensityRenderer")],cEe);const uEe=cEe;var hEe;let dEe=hEe=class extends Pn{constructor(fe){super(fe),this.color=null,this.ratio=null}clone(){return new hEe({color:this.color&&this.color.clone(),ratio:this.ratio})}};e$4o([y$2v({type:b_,json:{type:[Ci],default:null,write:!0}})],dEe.prototype,"color",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],dEe.prototype,"ratio",void 0),dEe=hEe=e$4o([a$4y("esri.renderers.support.HeatmapColorStop")],dEe);const pEe=dEe;let fEe=class p42 extends(i$4F(Pn)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};e$4o([y$2v({type:String,json:{write:!0}})],fEe.prototype,"minLabel",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fEe.prototype,"maxLabel",void 0),e$4o([y$2v({type:String,json:{write:!0}})],fEe.prototype,"title",void 0),fEe=e$4o([a$4y("esri.renderers.support.HeatmapLegendOptions")],fEe);function s$u(fe,ve,_e,be){let{color:we,ratio:Se}=ve,{color:Te,ratio:Ee}=_e;if(Ee===Se){const fe=1e-6;1===Ee?Se-=fe:Ee+=fe}const Ce=e$3Y((be-Se)/(Ee-Se),0,1);_$1l(fe,we.toArray(),Te.toArray(),Ce)}function f$f(fe){const ve=new Uint8ClampedArray(2048);if((fe=fe.filter((({ratio:fe})=>fe>=0&&fe<=1)).sort(((fe,ve)=>fe.ratio-ve.ratio)).map((({color:fe,ratio:ve})=>({color:fe,ratio:Math.max(ve,.001)})))).length<1)return ve;let _e=fe[0],be=fe[0],we=1;const Se=[0,0,0,0];for(let Te=0;Te<512;Te++){const Ee=(Te+.5)/512;for(;Ee>be.ratio&&we<fe.length;)_e=be,be=fe[we++];s$u(Se,_e,be,Ee),ve.set(Se,4*Te)}return ve}function l$t(fe,ve,_e){const be=Math.sqrt(fe**2+ve**2)/_e;return be>1?0:3/(Math.PI*_e**2)*(1-be**2)**2}function u$o(fe){return"function"==typeof fe?fe:fe?ve=>+ve[fe]:()=>1}var mEe;function D$2(fe){if(null!=fe){const{maxDensity:ve,minDensity:_e,radius:be}=fe;if(null!=ve||null!=_e||null!=be){const{blurRadius:ve,maxPixelIntensity:_e,minPixelIntensity:be,...we}=fe;return we}}return fe}let yEe=mEe=class extends GSe{constructor(fe){super(fe),this.authoringInfo=null,this.colorStops=[new pEe({ratio:0,color:new b_("rgba(255, 140, 0, 0)")}),new pEe({ratio:.75,color:new b_("rgba(255, 140, 0, 1)")}),new pEe({ratio:.9,color:new b_("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(fe){return D$2(fe)}get blurRadius(){return function a$q(fe){return u$3E(fe)/2.4}(this.radius)}set blurRadius(fe){const ve=this.maxPixelIntensity,_e=this.minPixelIntensity;this._set("radius",function e$9(fe){return e$3N(2.4*fe)}(fe)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",ve*this._pixelIntensityToDensity),this._set("minDensity",_e*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(fe){this._set("maxDensity",fe*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(fe){this._set("minDensity",fe*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(5.76*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(fe,ve){this._warnedProps[fe]||"user"===t$4p(this).getDefaultOrigin()&&(this._warnedProps[fe]=!0,v$27((()=>{i$4Y(ar.getLogger(this),fe,{replacement:`${String(ve)} (suggested value: ${this._get(ve)})`,version:"4.24"})})))}read(fe,ve){fe=D$2(fe),super.read(fe,ve)}getSymbol(){return new dT}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(fe,ve){const _e=this.field,be=this.valueExpression;_e&&"string"==typeof _e&&w$1u(fe,ve,_e),be&&"string"==typeof be&&await h$2h(fe,ve,be)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new mEe({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:a$4H(this.colorStops),field:this.field,legendOptions:a$4H(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};e$4o([y$2v({type:VSe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],yEe.prototype,"authoringInfo",void 0),e$4o([y$2v({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],yEe.prototype,"blurRadius",null),e$4o([y$2v({type:[pEe],json:{write:!0}})],yEe.prototype,"colorStops",void 0),e$4o([y$2v({type:String,json:{write:!0}})],yEe.prototype,"field",void 0),e$4o([y$2v({type:fEe,json:{write:!0}})],yEe.prototype,"legendOptions",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],yEe.prototype,"maxDensity",void 0),e$4o([y$2v({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],yEe.prototype,"maxPixelIntensity",null),e$4o([y$2v({type:Number,json:{write:!0}})],yEe.prototype,"minDensity",void 0),e$4o([y$2v({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],yEe.prototype,"minPixelIntensity",null),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],yEe.prototype,"radius",void 0),e$4o([y$2v({type:Number,range:{min:0},json:{default:0,write:!0}})],yEe.prototype,"referenceScale",void 0),e$4o([o$3g({heatmap:"heatmap"})],yEe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],yEe.prototype,"valueExpression",void 0),e$4o([y$2v({type:String})],yEe.prototype,"valueExpressionTitle",void 0),e$4o([y$2v({readOnly:!0})],yEe.prototype,"_pixelIntensityToDensity",null),yEe=mEe=e$4o([a$4y("esri.renderers.HeatmapRenderer")],yEe);const gEe=yEe;let vEe=class i48 extends(i$4F(Pn)){constructor(){super(...arguments),this.color=new b_([0,0,0,0]),this.label=null,this.threshold=0}};e$4o([y$2v({type:b_,json:{write:!0}})],vEe.prototype,"color",void 0),e$4o([y$2v({type:String,json:{write:!0}})],vEe.prototype,"label",void 0),e$4o([y$2v({type:Number,range:{min:0,max:1},json:{write:!0}})],vEe.prototype,"threshold",void 0),vEe=e$4o([a$4y("esri.renderers.support.OthersCategory")],vEe);let _Ee=class p43 extends(i$4F(Pn)){constructor(){super(...arguments),this.title=null}};e$4o([y$2v({type:String,json:{write:!0}})],_Ee.prototype,"title",void 0),_Ee=e$4o([a$4y("esri.renderers.support.PieChartLegendOptions")],_Ee);let $Ee=class f29 extends(v$5(i$4F(GSe))){constructor(fe){super(fe),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new b_([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new vEe,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var fe;return new dT({size:this.size?this.size/2+((null==(fe=this.outline)?void 0:fe.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(O$1y)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((fe,ve)=>fe+ve.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((fe,ve)=>fe+JSON.stringify(ve)),"")}async collectRequiredFields(fe,ve){await this.collectVVRequiredFields(fe,ve);for(const _e of this.attributes)_e.valueExpression&&await h$2h(fe,ve,_e.valueExpression),_e.field&&fe.add(_e.field)}};e$4o([y$2v({type:[nEe],json:{write:!0}})],$Ee.prototype,"attributes",void 0),e$4o([y$2v({type:lT,json:{default:null,write:!0}})],$Ee.prototype,"backgroundFillSymbol",void 0),e$4o([y$2v({type:b_,json:{write:!0}})],$Ee.prototype,"defaultColor",void 0),e$4o([y$2v({type:String,json:{write:!0}})],$Ee.prototype,"defaultLabel",void 0),e$4o([y$2v({type:Number,range:{min:0,max:1},json:{write:!0}})],$Ee.prototype,"holePercentage",void 0),e$4o([y$2v({type:vEe,json:{write:!0}})],$Ee.prototype,"othersCategory",void 0),e$4o([y$2v({type:_Ee,json:{write:!0}})],$Ee.prototype,"legendOptions",void 0),e$4o([y$2v({type:Dw,json:{default:null,write:!0}})],$Ee.prototype,"outline",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],$Ee.prototype,"size",void 0),e$4o([o$3g({pieChart:"pie-chart"})],$Ee.prototype,"type",void 0),$Ee=e$4o([a$4y("esri.renderers.PieChartRenderer")],$Ee);const bEe=$Ee;var wEe;let xEe=wEe=class extends(v$5(GSe)){constructor(fe){super(fe),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(fe,ve){await Promise.all([this.collectSymbolFields(fe,ve),this.collectVVRequiredFields(fe,ve)])}async collectSymbolFields(fe,ve){await Promise.all(this.getSymbols().map((_e=>_e.collectRequiredFields(fe,ve))))}getSymbol(fe,ve){return this.symbol}async getSymbolAsync(fe,ve){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((fe,ve)=>fe+ve.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((fe,ve)=>fe+JSON.stringify(ve)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new wEe({description:this.description,label:this.label,symbol:a$4H(this.symbol),visualVariables:a$4H(this.visualVariables),authoringInfo:a$4H(this.authoringInfo)})}};e$4o([y$2v({type:String,json:{write:!0}})],xEe.prototype,"description",void 0),e$4o([y$2v({type:String,json:{write:!0}})],xEe.prototype,"label",void 0),e$4o([y$2v(ITe)],xEe.prototype,"symbol",void 0),e$4o([o$3g({simple:"simple"})],xEe.prototype,"type",void 0),xEe=wEe=e$4o([a$4y("esri.renderers.SimpleRenderer")],xEe);const SEe=xEe,TEe=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function r$7(fe){return fe instanceof zi}function f$d(fe){return fe instanceof Wa?Object.keys(fe.items):r$7(fe)?t$4p(fe).keys():fe?Object.keys(fe):[]}function i$s(fe,ve){return fe instanceof Wa?fe.items[ve]:fe[ve]}function u$n(fe){return fe?fe.declaredClass:null}function c$B(fe,ve){var _e;const be=fe.diff;if(be&&"function"==typeof be)return be(fe,ve);const we=f$d(fe),Se=f$d(ve);if(0===we.length&&0===Se.length)return;if(!we.length||!Se.length||function l$s(fe,ve){return!(!Array.isArray(fe)||!Array.isArray(ve))&&fe.length!==ve.length}(fe,ve))return{type:"complete",oldValue:fe,newValue:ve};const Te=Se.filter((fe=>!we.includes(fe))),Ee=we.filter((fe=>!Se.includes(fe))),Ce=we.filter((_e=>Se.includes(_e)&&i$s(fe,_e)!==i$s(ve,_e))).concat(Te,Ee).sort(),Oe=u$n(fe);if(Oe&&TEe.has(Oe)&&Ce.length)return{type:"complete",oldValue:fe,newValue:ve};let Re;const De=r$7(fe)&&r$7(ve);for(const Be of Ce){const we=i$s(fe,Be),Se=i$s(ve,Be);let Te;if((De||"function"!=typeof we&&"function"!=typeof Se)&&we!==Se&&(null!=we||null!=Se)){if(be&&be[Be]&&"function"==typeof be[Be])Te=null==(_e=be[Be])?void 0:_e.call(be,we,Se);else if(we instanceof Date&&Se instanceof Date){if(we.getTime()===Se.getTime())continue;Te={type:"complete",oldValue:we,newValue:Se}}else Te="object"==typeof we&&"object"==typeof Se&&u$n(we)===u$n(Se)?c$B(we,Se):{type:"complete",oldValue:we,newValue:Se};null!=Te&&(null!=Re?Re.diff[Be]=Te:Re={type:"partial",diff:{[Be]:Te}})}}return Re}function s$t(fe,ve){return function p$T(fe,ve){if(null==fe)return!1;const _e=ve.split(".");let be=fe;for(const we of _e){if("complete"===be.type)return!0;if("partial"!==be.type)return!1;{const fe=be.diff[we];if(!fe)return!1;be=fe}}return!0}(fe,ve)}function y$a(fe,ve){if(!fe)return!1;if("partial"===fe.type){const _e=Object.keys(fe.diff);return 1===_e.length&&_e[0]===ve}return!1}function d$g(fe,ve){if("function"!=typeof fe&&"function"!=typeof ve&&(null!=fe||null!=ve))return null==fe||null==ve||"object"==typeof fe&&"object"==typeof ve&&u$n(fe)!==u$n(ve)?{type:"complete",oldValue:fe,newValue:ve}:c$B(fe,ve)}function m$l(fe){if(null==fe)return!0;switch(fe.type){case"complete":return!1;case"collection":{const ve=fe;for(const fe of ve.added)if(!m$l(fe))return!1;for(const fe of ve.removed)if(!m$l(fe))return!1;for(const fe of ve.changed)if(!m$l(fe))return!1;return!0}case"partial":for(const ve in fe.diff)if(!m$l(fe.diff[ve]))return!1;return!0}}let EEe=class c45 extends(i$4F(Pn)){constructor(fe){super(fe),this.value=null,this.value2=null,this.value3=null}};e$4o([y$2v(DTe)],EEe.prototype,"value",void 0),e$4o([y$2v(DTe)],EEe.prototype,"value2",void 0),e$4o([y$2v(DTe)],EEe.prototype,"value3",void 0),EEe=e$4o([a$4y("esri.renderers.support.UniqueValue")],EEe);const PEe=EEe;let CEe=class n48 extends(i$4F(Pn)){constructor(fe){super(fe),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(fe){if(null==fe)return null;const ve=typeof(fe=Array.isArray(fe)?fe:[fe])[0];return"string"===ve||"number"===ve?fe.map((fe=>new PEe({value:fe}))):"object"===ve?fe[0]instanceof PEe?fe:fe.map((fe=>new PEe(fe))):null}};e$4o([y$2v({type:String,json:{write:!0}})],CEe.prototype,"description",void 0),e$4o([y$2v({type:String,json:{write:!0}})],CEe.prototype,"label",void 0),e$4o([y$2v(RTe)],CEe.prototype,"symbol",void 0),e$4o([y$2v({type:[PEe],json:{type:[[String]],read:{reader:fe=>fe?fe.map((fe=>new PEe({value:fe[0],value2:fe[1],value3:fe[2]}))):null},write:{writer:(fe,ve)=>{const _e=[];for(const be of fe){const fe=[be.value,be.value2,be.value3].filter(O$1y).map((fe=>fe.toString()));_e.push(fe)}ve.values=_e}}}})],CEe.prototype,"values",void 0),e$4o([s$4b("values")],CEe.prototype,"castValues",null),CEe=e$4o([a$4y("esri.renderers.support.UniqueValueClass")],CEe);const OEe=CEe;let AEe=class i49 extends(i$4F(Pn)){constructor(fe){super(fe),this.heading=null,this.classes=null}};e$4o([y$2v({type:String,json:{write:!0}})],AEe.prototype,"heading",void 0),e$4o([y$2v({type:[OEe],json:{write:!0}})],AEe.prototype,"classes",void 0),AEe=e$4o([a$4y("esri.renderers.support.UniqueValueGroup")],AEe);const MEe=AEe;var REe;let IEe=REe=class extends Pn{constructor(fe){super(fe),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new REe({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var fe;const ve=JSON.stringify(null==(fe=this.symbol)?void 0:fe.toJSON());return`${this.value}.${ve}`}};e$4o([y$2v({type:String,json:{write:!0}})],IEe.prototype,"description",void 0),e$4o([y$2v({type:String,json:{write:!0}})],IEe.prototype,"label",void 0),e$4o([y$2v(ITe)],IEe.prototype,"symbol",void 0),e$4o([y$2v(DTe)],IEe.prototype,"value",void 0),IEe=REe=e$4o([a$4y("esri.renderers.support.UniqueValueInfo")],IEe);const LEe=IEe;var DEe;const NEe="esri.renderers.UniqueValueRenderer",N$2=()=>ar.getLogger(NEe),FEe="uvInfos-watcher",zEe="uvGroups-watcher",kEe=b$2d(LEe);let UEe=DEe=class extends(v$5(GSe)){constructor(fe){super(fe),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(fe,ve){if(!fe&&!ve)return;if(!fe||!ve)return{type:"complete",oldValue:fe,newValue:ve};let _e=!1;const be={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let we=0;we<ve.length;we++){const Se=fe.find((fe=>fe.value===ve[we].value));Se?d$g(Se,ve[we])?(be.changed.push({type:"complete",oldValue:Se,newValue:ve[we]}),_e=!0):be.unchanged.push({oldValue:Se,newValue:ve[we]}):(be.added.push(ve[we]),_e=!0)}for(let we=0;we<fe.length;we++)ve.find((ve=>ve.value===fe[we].value))||(be.removed.push(fe[we]),_e=!0);return _e?be:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(fe){this._set("field",fe),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(fe){return null==fe||"function"==typeof fe?fe:u$42(fe)}writeField(fe,ve,_e,be){"string"==typeof fe?ve[_e]=fe:(null==be?void 0:be.messages)?be.messages.push(new Ir("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):N$2().error(".field: cannot write field to JSON since it's not a string value")}set field2(fe){this._set("field2",fe),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(fe){this._set("field3",fe),this._updateUniqueValues()}set valueExpression(fe){this._set("valueExpression",fe),this._updateUniqueValues()}set defaultSymbol(fe){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",fe)}set fieldDelimiter(fe){this._set("fieldDelimiter",fe),this._updateUniqueValues()}readPortal(fe,ve,_e){return _e.portal||Gv.getDefault()}readStyleOrigin(fe,ve,_e){if(ve.styleName)return Object.freeze({styleName:ve.styleName});if(ve.styleUrl){const fe=u$37(ve.styleUrl,_e);return Object.freeze({styleUrl:fe})}}writeStyleOrigin(fe,ve,_e,be){fe.styleName?ve.styleName=fe.styleName:fe.styleUrl&&(ve.styleUrl=m$2_(fe.styleUrl,be))}set uniqueValueGroups(fe){this.styleOrigin?N$2().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",fe),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(fe){this.styleOrigin?N$2().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",fe),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(fe,ve){var _e;if(this.styleOrigin)return void N$2().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let be;be="object"==typeof fe?kEe(fe):new LEe({value:fe,symbol:OT(ve)}),null==(_e=this.uniqueValueInfos)||_e.push(be),this._valueInfoMap[be.value]=be,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(fe){if(this.styleOrigin)return void N$2().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const ve=this.uniqueValueInfos;if(ve)for(let _e=0;_e<ve.length;_e++){const be=ve[_e];if(String(be.value)===String(fe)){delete this._valueInfoMap[fe],ve.splice(_e,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(fe,ve){let _e=ve;return this.valueExpression&&null==(null==ve?void 0:ve.arcade)&&(_e={..._e,arcade:await i$3H()}),this._getUniqueValueInfo(fe,_e)}getSymbol(fe,ve){if(this.valueExpression&&null==(null==ve?void 0:ve.arcade))return void N$2().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const _e=this._getUniqueValueInfo(fe,ve);return(null==_e?void 0:_e.symbol)||this.defaultSymbol}async getSymbolAsync(fe,ve){let _e=ve;if(this.valueExpression&&null==(null==_e?void 0:_e.arcade)){const fe=await i$3H(),{arcadeUtils:ve}=fe;ve.hasGeometryOperations(this.valueExpression)&&await ve.enableGeometryOperations(),_e={..._e,arcade:fe}}const be=this._getUniqueValueInfo(fe,_e);return(null==be?void 0:be.symbol)||this.defaultSymbol}getSymbols(){const fe=[];for(const ve of this.uniqueValueInfos??[])ve.symbol&&fe.push(ve.symbol);return this.defaultSymbol&&fe.push(this.defaultSymbol),fe}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((fe,ve)=>fe+ve.getAttributeHash()),"")}getMeshHash(){var fe;return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${null==(fe=this.uniqueValueInfos)?void 0:fe.reduce(((fe,ve)=>fe+ve.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const fe=new DEe({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:a$4H(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:a$4H(this.visualVariables),legendOptions:a$4H(this.legendOptions),authoringInfo:a$4H(this.authoringInfo),backgroundFillSymbol:a$4H(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(fe._isDefaultSymbolDerived=!0),fe._set("portal",this.portal);const ve=a$4H(this.uniqueValueInfos),_e=a$4H(this.uniqueValueGroups);return this.styleOrigin&&(fe._set("styleOrigin",Object.freeze(a$4H(this.styleOrigin))),Object.freeze(ve),Object.freeze(_e)),fe._set("uniqueValueInfos",ve),fe._updateValueInfoMap(),fe._set("uniqueValueGroups",_e),fe._isInfosSource=this._isInfosSource,fe._watchUniqueValueInfosAndGroups(),fe}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(fe,ve){const _e=[this.collectVVRequiredFields(fe,ve),this.collectSymbolFields(fe,ve)];await Promise.all(_e)}async collectSymbolFields(fe,ve){const _e=[...this.getSymbols().map((_e=>_e.collectRequiredFields(fe,ve))),h$2h(fe,ve,this.valueExpression)];w$1u(fe,ve,this.field),w$1u(fe,ve,this.field2),w$1u(fe,ve,this.field3),await Promise.all(_e)}populateFromStyle(){return y$P(this.styleOrigin,{portal:this.portal}).then((fe=>{var ve;const _e=[];return this._valueInfoMap={},(null==fe?void 0:fe.data)&&Array.isArray(fe.data.items)&&fe.data.items.forEach((ve=>{const be=new vT({styleUrl:fe.styleUrl,styleName:fe.styleName,portal:this.portal,name:ve.name});this.defaultSymbol||ve.name!==fe.data.defaultItem||(this.defaultSymbol=be,this._isDefaultSymbolDerived=!0);const we=new LEe({value:ve.name,symbol:be});_e.push(we),this._valueInfoMap[ve.name]=we})),this._set("uniqueValueInfos",Object.freeze(_e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&(null==(ve=this.uniqueValueInfos)?void 0:ve.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:fe}=this;if(fe)for(const ve of fe)this._valueInfoMap[ve.value+""]=ve}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(FEe);const{uniqueValueInfos:fe}=this;if(fe){const ve=[];for(const _e of fe)ve.push(d$3d((()=>({symbol:_e.symbol,value:_e.value,label:_e.label,description:_e.description})),((fe,ve)=>{fe!==ve&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(ve,FEe)}}_watchUniqueValueGroups(){this.removeHandles(zEe);const{uniqueValueGroups:fe}=this;if(fe){const ve=[];for(const _e of fe){ve.push(d$3d((()=>({classes:_e.classes})),((fe,ve)=>{fe!==ve&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const fe of _e.classes??[])ve.push(d$3d((()=>({symbol:fe.symbol,values:fe.values,label:fe.label,description:fe.description})),((fe,ve)=>{fe!==ve&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(ve,zEe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const fe=[],{field:ve,field2:_e,field3:be,fieldDelimiter:we,uniqueValueGroups:Se,valueExpression:Te}=this;if(!ve&&!Te)return this._set("uniqueValueInfos",fe),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const Ee=!(!ve||!_e);for(const Ce of Se)for(const ve of Ce.classes??[]){const{symbol:Se,label:Te,values:Ce,description:Oe}=ve;for(const ve of Ce??[]){const{value:Ce,value2:Re,value3:De}=ve,Be=[Ce];_e&&Be.push(Re),be&&Be.push(De);const Ze=Ee?Be.join(we||""):Be[0]??void 0;fe.push(new LEe({symbol:Se,label:Te,value:Ze,description:Oe}))}}this._set("uniqueValueInfos",fe),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(fe=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:ve,field2:_e,valueExpression:be,fieldDelimiter:we,uniqueValueInfos:Se}=this;if(!ve&&!be||!Se.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const Te=!(!ve||!_e),Ee=Se.map((fe=>{var ve;const{symbol:_e,label:be,value:Se,description:Ee}=fe,[Ce,Oe,Re]=Te?(null==(ve=null==Se?void 0:Se.toString())?void 0:ve.split(we||""))||[]:[Se];return new OEe({symbol:_e,label:be,description:Ee,values:[new PEe({value:Ce,value2:Oe,value3:Re})]})})),Ce=[new MEe({classes:Ee})];fe&&Object.freeze(Ce),this._set("uniqueValueGroups",Ce),this._watchUniqueValueGroups()}_getUniqueValueInfo(fe,ve){return this.valueExpression?this._getUnqiueValueInfoForExpression(fe,ve):this._getUnqiueValueInfoForFields(fe)}_getUnqiueValueInfoForExpression(fe,ve){const{viewingMode:_e,scale:be,spatialReference:we,arcade:Se,timeZone:Te}=ve??{};let Ee=this._cache.compiledFunc;const Ce=Se.arcadeUtils;if(!Ee){const fe=Ce.createSyntaxTree(this.valueExpression);Ee=Ce.createFunction(fe),this._cache.compiledFunc=Ee}const Oe=Ce.executeFunction(Ee,Ce.createExecContext(fe,Ce.getViewInfo({viewingMode:_e,scale:be,spatialReference:we}),Te));return this._valueInfoMap[Oe+""]}_getUnqiueValueInfoForFields(fe){const ve=this.field,_e=fe.attributes;let be;if(this.field2){const fe=this.field2,we=this.field3,Se=[];ve&&Se.push(_e[ve]),fe&&Se.push(_e[fe]),we&&Se.push(_e[we]),be=Se.join(this.fieldDelimiter||"")}else ve&&(be=_e[ve]);return this._valueInfoMap[be+""]}static fromPortalStyle(fe,ve){const _e=new DEe(null==ve?void 0:ve.properties);_e._set("styleOrigin",Object.freeze({styleName:fe})),_e._set("portal",(null==ve?void 0:ve.portal)||Gv.getDefault());const be=_e.populateFromStyle();return be.catch((ve=>{N$2().error(`#fromPortalStyle('${fe}'[, ...])`,"Failed to create unique value renderer from style name",ve)})),be}static fromStyleUrl(fe,ve){const _e=new DEe(null==ve?void 0:ve.properties);_e._set("styleOrigin",Object.freeze({styleUrl:fe}));const be=_e.populateFromStyle();return be.catch((ve=>{N$2().error(`#fromStyleUrl('${fe}'[, ...])`,"Failed to create unique value renderer from style URL",ve)})),be}};e$4o([y$2v({readOnly:!0})],UEe.prototype,"_cache",null),e$4o([o$3g({uniqueValue:"unique-value"})],UEe.prototype,"type",void 0),e$4o([y$2v(LTe)],UEe.prototype,"backgroundFillSymbol",void 0),e$4o([y$2v({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],UEe.prototype,"field",null),e$4o([s$4b("field")],UEe.prototype,"castField",null),e$4o([r$3s("field")],UEe.prototype,"writeField",null),e$4o([y$2v({type:String,value:null,json:{write:!0}})],UEe.prototype,"field2",null),e$4o([y$2v({type:String,value:null,json:{write:!0}})],UEe.prototype,"field3",null),e$4o([y$2v({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],UEe.prototype,"orderByClassesEnabled",void 0),e$4o([y$2v({type:String,value:null,json:{write:!0}})],UEe.prototype,"valueExpression",null),e$4o([y$2v({type:String,json:{write:!0}})],UEe.prototype,"valueExpressionTitle",void 0),e$4o([y$2v({type:WSe,json:{write:!0}})],UEe.prototype,"legendOptions",void 0),e$4o([y$2v({type:String,json:{write:!0}})],UEe.prototype,"defaultLabel",void 0),e$4o([y$2v(n$4R({...RTe},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],UEe.prototype,"defaultSymbol",null),e$4o([y$2v({type:String,value:null,json:{write:!0}})],UEe.prototype,"fieldDelimiter",null),e$4o([y$2v({type:Gv,readOnly:!0})],UEe.prototype,"portal",void 0),e$4o([o$40("portal",["styleName"])],UEe.prototype,"readPortal",null),e$4o([y$2v({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],UEe.prototype,"styleOrigin",void 0),e$4o([o$40("styleOrigin",["styleName","styleUrl"])],UEe.prototype,"readStyleOrigin",null),e$4o([r$3s("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],UEe.prototype,"writeStyleOrigin",null),e$4o([y$2v({type:[MEe],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(fe,ve,_e)=>(ve.uniqueValueGroups||function z$1(fe){const{field1:ve,field2:_e,field3:be,fieldDelimiter:we,uniqueValueInfos:Se,valueExpression:Te}=fe,Ee=!(!ve||!_e);return[{classes:(Se??[]).map((fe=>{var Se;const{symbol:Ce,label:Oe,value:Re,description:De}=fe,[Be,Ze,Xe]=Ee?(null==(Se=null==Re?void 0:Re.toString())?void 0:Se.split(we||""))||[]:[Re],Je=[];return(ve||Te)&&Je.push(Be),_e&&Je.push(Ze),be&&Je.push(Xe),{symbol:Ce,label:Oe,values:[Je],description:De}}))}]}(ve)).map((fe=>MEe.fromJSON(fe,_e)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],UEe.prototype,"uniqueValueGroups",null),e$4o([y$2v({type:[LEe],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],UEe.prototype,"uniqueValueInfos",null),UEe=DEe=e$4o([a$4y(NEe)],UEe);const VEe=UEe,BEe={key:"type",base:GSe,typeMap:{heatmap:gEe,simple:SEe,"unique-value":VEe,"class-breaks":HTe,"dot-density":uEe,dictionary:tEe,"pie-chart":bEe},errorContext:"renderer"},jEe={key:"type",base:GSe,typeMap:{simple:SEe,"unique-value":VEe,"class-breaks":HTe,heatmap:gEe},errorContext:"renderer",validate:function p$R(fe){switch(fe.type){case"simple":return function c$y(fe){if(fe.symbol)return fe;ar.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(fe);case"unique-value":return function f$c(fe){const ve=fe.uniqueValueInfos,_e=null==ve?void 0:ve.filter((({symbol:fe,label:ve},_e)=>(fe||ar.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${_e}] ${ve}) without a symbol from web scene.`),!!fe)));return(null==_e?void 0:_e.length)!==(null==ve?void 0:ve.length)&&(fe.uniqueValueInfos=_e),fe}(fe);case"class-breaks":return function d$f(fe){const ve=fe.classBreakInfos,_e=null==ve?void 0:ve.filter((({symbol:fe,label:ve},_e)=>(fe||ar.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${_e}] ${ve}) without a symbol from web scene.`),!!fe)));return(null==_e?void 0:_e.length)!==(null==ve?void 0:ve.length)&&(fe.classBreakInfos=_e),fe}(fe);case"heatmap":return fe}}};function t$h(fe,ve){return o$a(fe,null,ve)}const GEe=u$41({types:BEe});function o$a(fe,ve,_e){return fe?fe&&(fe.styleName||fe.styleUrl)&&"uniqueValue"!==fe.type?((null==_e?void 0:_e.messages)&&_e.messages.push(new Mi("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+fe.type+"'",{definition:fe,context:_e})),null):GEe(fe,ve,_e):null}var HEe;let qEe=HEe=class extends Pn{constructor(fe){super(fe),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new HEe({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e$4o([y$2v({type:String,json:{write:!0}})],qEe.prototype,"expression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],qEe.prototype,"name",void 0),e$4o([y$2v({type:["boolean","date","number","string"],json:{write:!0}})],qEe.prototype,"returnType",void 0),e$4o([y$2v({type:String,json:{write:!0}})],qEe.prototype,"title",void 0),qEe=HEe=e$4o([a$4y("esri.form.ExpressionInfo")],qEe);const WEe=qEe;let YEe=class e72 extends Pn{constructor(fe){super(fe),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};e$4o([y$2v({type:String,json:{write:!0}})],YEe.prototype,"description",void 0),e$4o([y$2v({type:String,json:{write:!0}})],YEe.prototype,"label",void 0),e$4o([y$2v()],YEe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],YEe.prototype,"visibilityExpression",void 0),YEe=e$4o([a$4y("esri.form.elements.Element")],YEe);const ZEe=YEe;var XEe;let JEe=XEe=class extends Pn{constructor(fe){super(fe),this.type=null}clone(){return new XEe({type:this.type})}};e$4o([y$2v({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],JEe.prototype,"type",void 0),JEe=XEe=e$4o([a$4y("esri.form.elements.inputs.AttachmentInput")],JEe);const QEe=JEe;var KEe;let ePe=KEe=class extends ZEe{constructor(fe){super(fe),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new KEe({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};e$4o([y$2v({type:String,json:{write:!0}})],ePe.prototype,"attachmentKeyword",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ePe.prototype,"editableExpression",void 0),e$4o([y$2v({type:QEe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ePe.prototype,"input",void 0),e$4o([y$2v({type:["attachment"],json:{read:!1,write:!0}})],ePe.prototype,"type",void 0),ePe=KEe=e$4o([a$4y("esri.form.elements.AttachmentElement")],ePe);const tPe=ePe;let rPe=class e73 extends Pn{constructor(fe){super(fe),this.type=null}};e$4o([y$2v()],rPe.prototype,"type",void 0),rPe=e$4o([a$4y("esri.form.elements.inputs.Input")],rPe);const iPe=rPe;let nPe=class s82 extends iPe{constructor(fe){super(fe),this.maxLength=null,this.minLength=0}};e$4o([y$2v({type:Number,json:{write:!0}})],nPe.prototype,"maxLength",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],nPe.prototype,"minLength",void 0),nPe=e$4o([a$4y("esri.form.elements.inputs.TextInput")],nPe);const sPe=nPe;var oPe;let aPe=oPe=class extends sPe{constructor(fe){super(fe),this.type="barcode-scanner"}clone(){return new oPe({maxLength:this.maxLength,minLength:this.minLength})}};e$4o([y$2v({type:["barcode-scanner"],json:{read:!1,write:!0}})],aPe.prototype,"type",void 0),aPe=oPe=e$4o([a$4y("esri.form.elements.inputs.BarcodeScannerInput")],aPe);const lPe=aPe;var cPe;let uPe=cPe=class extends iPe{constructor(fe){super(fe),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new cPe({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};e$4o([y$2v({type:String,json:{write:!0}})],uPe.prototype,"noValueOptionLabel",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],uPe.prototype,"showNoValueOption",void 0),e$4o([y$2v({type:["combo-box"],json:{read:!1,write:!0}})],uPe.prototype,"type",void 0),uPe=cPe=e$4o([a$4y("esri.form.elements.inputs.ComboBoxInput")],uPe);const hPe=uPe;var dPe;function s$m(fe){return null!=fe?fe:null}function a$p(fe){return null!=fe?fe:null}let pPe=dPe=class extends iPe{constructor(fe){super(fe),this.max=null,this.min=null,this.type="date-picker"}readMax(fe,ve){return s$m(ve.max)}writeMax(fe,ve){ve.max=a$p(fe)}readMin(fe,ve){return s$m(ve.min)}writeMin(fe,ve){ve.min=a$p(fe)}clone(){return new dPe({max:this.max,min:this.min})}};e$4o([y$2v({type:String,json:{type:String,write:!0}})],pPe.prototype,"max",void 0),e$4o([o$40("max")],pPe.prototype,"readMax",null),e$4o([r$3s("max")],pPe.prototype,"writeMax",null),e$4o([y$2v({type:String,json:{type:String,write:!0}})],pPe.prototype,"min",void 0),e$4o([o$40("min")],pPe.prototype,"readMin",null),e$4o([r$3s("min")],pPe.prototype,"writeMin",null),e$4o([y$2v({type:["date-picker"],json:{read:!1,write:!0}})],pPe.prototype,"type",void 0),pPe=dPe=e$4o([a$4y("esri.form.elements.inputs.DatePickerInput")],pPe);const fPe=pPe;var mPe;function p$J(fe){return null!=fe?fe:null}function m$i(fe){return null!=fe?fe:null}let yPe=mPe=class extends iPe{constructor(fe){super(fe),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(fe,ve){return p$J(ve.max)}writeMax(fe,ve){ve.max=m$i(fe)}readMin(fe,ve){return p$J(ve.min)}writeMin(fe,ve){ve.min=m$i(fe)}readTimeResolution(fe,ve){return p$J(ve.timeResolution)}writeTimeResolution(fe,ve){ve.timeResolution=m$i(fe)}clone(){return new mPe({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],yPe.prototype,"includeTimeOffset",void 0),e$4o([y$2v({type:String,json:{type:String,write:!0}})],yPe.prototype,"max",void 0),e$4o([o$40("max")],yPe.prototype,"readMax",null),e$4o([r$3s("max")],yPe.prototype,"writeMax",null),e$4o([y$2v({type:String,json:{type:String,write:!0}})],yPe.prototype,"min",void 0),e$4o([o$40("min")],yPe.prototype,"readMin",null),e$4o([r$3s("min")],yPe.prototype,"writeMin",null),e$4o([y$2v({type:String,json:{type:String,write:!0}})],yPe.prototype,"timeResolution",void 0),e$4o([o$40("timeResolution")],yPe.prototype,"readTimeResolution",null),e$4o([r$3s("timeResolution")],yPe.prototype,"writeTimeResolution",null),e$4o([y$2v({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],yPe.prototype,"type",void 0),yPe=mPe=e$4o([a$4y("esri.form.elements.inputs.DateTimeOffsetPickerInput")],yPe);const gPe=yPe;var vPe;function s$k(fe){return null!=fe?new Date(fe):null}function m$h(fe){return fe?fe.getTime():null}let _Pe=vPe=class extends iPe{constructor(fe){super(fe),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(fe,ve){return s$k(ve.max)}writeMax(fe,ve){ve.max=m$h(fe)}readMin(fe,ve){return s$k(ve.min)}writeMin(fe,ve){ve.min=m$h(fe)}clone(){return new vPe({includeTime:this.includeTime,max:this.max,min:this.min})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],_Pe.prototype,"includeTime",void 0),e$4o([y$2v({type:Date,json:{type:Number,write:!0}})],_Pe.prototype,"max",void 0),e$4o([o$40("max")],_Pe.prototype,"readMax",null),e$4o([r$3s("max")],_Pe.prototype,"writeMax",null),e$4o([y$2v({type:Date,json:{type:Number,write:!0}})],_Pe.prototype,"min",void 0),e$4o([o$40("min")],_Pe.prototype,"readMin",null),e$4o([r$3s("min")],_Pe.prototype,"writeMin",null),e$4o([y$2v({type:["datetime-picker"],json:{read:!1,write:!0}})],_Pe.prototype,"type",void 0),_Pe=vPe=e$4o([a$4y("esri.form.elements.inputs.DateTimePickerInput")],_Pe);const $Pe=_Pe;var bPe;let wPe=bPe=class extends iPe{constructor(fe){super(fe),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new bPe({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};e$4o([y$2v({type:String,json:{write:!0}})],wPe.prototype,"noValueOptionLabel",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],wPe.prototype,"showNoValueOption",void 0),e$4o([y$2v({type:["radio-buttons"],json:{read:!1,write:!0}})],wPe.prototype,"type",void 0),wPe=bPe=e$4o([a$4y("esri.form.elements.inputs.RadioButtonsInput")],wPe);const xPe=wPe;var SPe;let TPe=SPe=class extends iPe{constructor(fe){super(fe),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new SPe({offValue:this.offValue,onValue:this.onValue})}};e$4o([y$2v({type:[String,Number],json:{write:!0}})],TPe.prototype,"offValue",void 0),e$4o([y$2v({type:[String,Number],json:{write:!0}})],TPe.prototype,"onValue",void 0),e$4o([y$2v({type:["switch"],json:{read:!1,write:!0}})],TPe.prototype,"type",void 0),TPe=SPe=e$4o([a$4y("esri.form.elements.inputs.SwitchInput")],TPe);const EPe=TPe;var PPe;let CPe=PPe=class extends sPe{constructor(fe){super(fe),this.type="text-area"}clone(){return new PPe({maxLength:this.maxLength,minLength:this.minLength})}};e$4o([y$2v({type:["text-area"],json:{read:!1,write:!0}})],CPe.prototype,"type",void 0),CPe=PPe=e$4o([a$4y("esri.form.elements.inputs.TextAreaInput")],CPe);const OPe=CPe;var APe;let MPe=APe=class extends sPe{constructor(fe){super(fe),this.type="text-box"}clone(){return new APe({maxLength:this.maxLength,minLength:this.minLength})}};e$4o([y$2v({type:["text-box"],json:{read:!1,write:!0}})],MPe.prototype,"type",void 0),MPe=APe=e$4o([a$4y("esri.form.elements.inputs.TextBoxInput")],MPe);const RPe=MPe;var IPe;function p$D(fe){return null!=fe?fe:null}function m$g(fe){return null!=fe?fe:null}let LPe=IPe=class extends iPe{constructor(fe){super(fe),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(fe,ve){return p$D(ve.max)}writeMax(fe,ve){ve.max=m$g(fe)}readMin(fe,ve){return p$D(ve.min)}writeMin(fe,ve){ve.min=m$g(fe)}readTimeResolution(fe,ve){return p$D(ve.timeResolution)}writeTimeResolution(fe,ve){ve.timeResolution=m$g(fe)}clone(){return new IPe({max:this.max,min:this.min,timeResolution:this.timeResolution})}};e$4o([y$2v({type:String,json:{type:String,write:!0}})],LPe.prototype,"max",void 0),e$4o([o$40("max")],LPe.prototype,"readMax",null),e$4o([r$3s("max")],LPe.prototype,"writeMax",null),e$4o([y$2v({type:String,json:{type:String,write:!0}})],LPe.prototype,"min",void 0),e$4o([o$40("min")],LPe.prototype,"readMin",null),e$4o([r$3s("min")],LPe.prototype,"writeMin",null),e$4o([y$2v({type:String,json:{type:String,write:!0}})],LPe.prototype,"timeResolution",void 0),e$4o([o$40("timeResolution")],LPe.prototype,"readTimeResolution",null),e$4o([r$3s("timeResolution")],LPe.prototype,"writeTimeResolution",null),e$4o([y$2v({type:["time-picker"],json:{read:!1,write:!0}})],LPe.prototype,"type",void 0),LPe=IPe=e$4o([a$4y("esri.form.elements.inputs.TimePickerInput")],LPe);const DPe={base:iPe,key:"type",typeMap:{"barcode-scanner":lPe,"combo-box":hPe,"date-picker":fPe,"datetime-picker":$Pe,"datetimeoffset-picker":gPe,"radio-buttons":xPe,switch:EPe,"text-area":OPe,"text-box":RPe,"time-picker":LPe}};var NPe;let FPe=NPe=class extends ZEe{constructor(fe){super(fe),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(fe){this._set("editable",fe)}clone(){return new NPe({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};e$4o([y$2v({types:tE,json:{read:{reader:i$3h},write:!0}})],FPe.prototype,"domain",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],FPe.prototype,"editable",null),e$4o([y$2v({type:String,json:{write:!0}})],FPe.prototype,"editableExpression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],FPe.prototype,"fieldName",void 0),e$4o([y$2v({type:String,json:{write:!0}})],FPe.prototype,"hint",void 0),e$4o([y$2v({types:DPe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],FPe.prototype,"input",void 0),e$4o([y$2v({type:String,json:{write:!0}})],FPe.prototype,"requiredExpression",void 0),e$4o([y$2v({type:String,json:{read:!1,write:!0}})],FPe.prototype,"type",void 0),e$4o([y$2v({type:String,json:{write:!0}})],FPe.prototype,"valueExpression",void 0),FPe=NPe=e$4o([a$4y("esri.form.elements.FieldElement")],FPe);const zPe=FPe;var kPe;let UPe=kPe=class extends ZEe{constructor(fe){super(fe),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new kPe({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:a$4H(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};e$4o([y$2v({type:Number,json:{write:!0}})],UPe.prototype,"displayCount",void 0),e$4o([y$2v({type:["list"],json:{write:!0}})],UPe.prototype,"displayType",void 0),e$4o([y$2v({type:String,json:{write:!0}})],UPe.prototype,"editableExpression",void 0),e$4o([y$2v({type:[xb],json:{write:!0}})],UPe.prototype,"orderByFields",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],UPe.prototype,"relationshipId",void 0),e$4o([y$2v({type:["relationship"],json:{read:!1,write:!0}})],UPe.prototype,"type",void 0),UPe=kPe=e$4o([a$4y("esri.form.elements.RelationshipElement")],UPe);const VPe=UPe;var BPe;let jPe=BPe=class extends ZEe{constructor(fe){super(fe),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new BPe({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};e$4o([y$2v({type:String,json:{write:!0}})],jPe.prototype,"text",void 0),e$4o([y$2v({type:String,json:{write:!0}})],jPe.prototype,"textFormat",void 0),e$4o([y$2v({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],jPe.prototype,"type",void 0),jPe=BPe=e$4o([a$4y("esri.form.elements.TextElement")],jPe);const GPe=jPe;function i$j(fe){return{typesWithGroup:{base:ZEe,key:"type",typeMap:{attachment:tPe,field:zPe,group:fe,relationship:VPe,text:GPe}},typesWithoutGroup:{base:ZEe,key:"type",typeMap:{attachment:tPe,field:zPe,relationship:VPe,text:GPe}}}}function m$f(fe,ve,_e=!0){if(!fe)return null;const be=_e?ve.typesWithGroup.typeMap:ve.typesWithoutGroup.typeMap;return fe.filter((fe=>be[fe.type])).map((fe=>be[fe.type].fromJSON(fe)))}function s$d(fe,ve,_e=!0){if(!fe)return null;const be=_e?ve.typesWithGroup.typeMap:ve.typesWithoutGroup.typeMap;return fe.filter((fe=>be[fe.type])).map((fe=>fe.toJSON()))}function u$i(fe,ve,_e=!0){return fe?fe.map((fe=>T$1p(_e?ve.typesWithGroup:ve.typesWithoutGroup,fe))):null}var HPe;let qPe=HPe=class extends ZEe{constructor(fe){super(fe),this.elements=null,this.initialState="expanded",this.type="group"}castElements(fe){return u$i(fe,WPe,!1)}readElements(fe,ve){return m$f(ve.formElements,WPe,!1)}writeElements(fe,ve){ve.formElements=s$d(fe,WPe,!1)}clone(){return new HPe({description:this.description,elements:a$4H(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};e$4o([y$2v({json:{write:!0}})],qPe.prototype,"elements",void 0),e$4o([s$4b("elements")],qPe.prototype,"castElements",null),e$4o([o$40("elements",["formElements"])],qPe.prototype,"readElements",null),e$4o([r$3s("elements")],qPe.prototype,"writeElements",null),e$4o([y$2v({type:["collapsed","expanded"],json:{write:!0}})],qPe.prototype,"initialState",void 0),e$4o([y$2v({type:String,json:{read:!1,write:!0}})],qPe.prototype,"type",void 0),qPe=HPe=e$4o([a$4y("esri.form.elements.GroupElement")],qPe);const WPe=i$j(qPe),t$g=fe=>"field"===fe.type,e$6=fe=>"group"===fe.type,p$A=fe=>"text"===fe.type;var YPe;const ZPe=i$j(qPe);let XPe=YPe=class extends Pn{constructor(fe){super(fe),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(fe){return u$i(fe,ZPe)}readElements(fe,ve){return m$f(ve.formElements,ZPe)}writeElements(fe,ve){ve.formElements=s$d(fe,ZPe)}clone(){return new YPe({description:this.description,expressionInfos:a$4H(this.expressionInfos),elements:a$4H(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(fe,ve){const _e=new Set,{description:be,elements:we,expressionInfos:Se,title:Te}=this;if(U$4(_e,fe,be),U$4(_e,fe,Te),!we)return[];const Ee=function k$1(fe,ve){if(!ve||0===ve.length)return[];const _e=H$2(fe),be=[];for(const we of ve)_e.has(we.name)&&be.push(we.expression);return be}(we,Se).map((ve=>h$2h(_e,fe,ve)));await Promise.all(Ee);for(const Ce of we)g$b(_e,{fieldsIndex:fe,relationships:ve},Ce);return Array.from(_e).sort()}};function g$b(fe,ve,_e){var be;const{fieldsIndex:we}=ve;if(!we||we.fields.length!==fe.size)switch(U$4(fe,we,_e.label),U$4(fe,we,_e.description),_e.type){case"field":w$1u(fe,we,_e.fieldName);break;case"group":_e.elements.forEach((_e=>g$b(fe,ve,_e)));break;case"relationship":if(ve.relationships){const be=ve.relationships.find((fe=>fe.id===_e.relationshipId));be&&w$1u(fe,we,be.keyField)}b$1H(fe,we,null==(be=_e.orderByFields)?void 0:be.map((fe=>fe.field)));break;case"text":U$4(fe,we,_e.text)}}function H$2(fe){const ve=new Set;for(const _e of fe)if(t$4d(ve,_e.visibilityExpression),!p$A(_e))if(e$6(_e))r$3C(ve,H$2(_e.elements));else if(t$4d(ve,_e.editableExpression),t$g(_e)){const{requiredExpression:fe,valueExpression:be}=_e;r$3C(ve,[fe,be])}return ve}function U$4(fe,ve,_e){b$1H(fe,ve,Xe$1(_e))}e$4o([y$2v({type:String,json:{write:!0}})],XPe.prototype,"description",void 0),e$4o([y$2v({json:{write:!0}})],XPe.prototype,"elements",void 0),e$4o([s$4b("elements")],XPe.prototype,"castElements",null),e$4o([o$40("elements",["formElements"])],XPe.prototype,"readElements",null),e$4o([r$3s("elements")],XPe.prototype,"writeElements",null),e$4o([y$2v({type:[WEe],json:{write:!0}})],XPe.prototype,"expressionInfos",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],XPe.prototype,"preserveFieldValuesWhenHidden",void 0),e$4o([y$2v({type:String,json:{write:!0}})],XPe.prototype,"title",void 0),XPe=YPe=e$4o([a$4y("esri.form.FormTemplate")],XPe);const JPe=XPe;function t$f(fe,ve,_e){if(null==fe.hasM||fe.hasZ)for(const be of ve)for(const fe of be)fe.length>2&&(fe[2]*=_e)}function i$i(fe,ve,_e){if(!fe&&!ve||!_e)return;const be=L$1d(_e);o$9(fe,_e,be),o$9(ve,_e,be)}function o$9(fe,ve,_e){if(fe)for(const be of fe)s$c(be.geometry,ve,_e)}function s$c(fe,ve,_e){if(!(null==fe?void 0:fe.spatialReference)||G$Y(fe.spatialReference,ve))return;const be=L$1d(fe.spatialReference)/_e;if(1!==be)if("x"in fe)null!=fe.z&&(fe.z*=be);else if("rings"in fe)t$f(fe,fe.rings,be);else if("paths"in fe)t$f(fe,fe.paths,be);else if("points"in fe&&(null==fe.hasM||fe.hasZ))for(const we of fe.points)we.length>2&&(we[2]*=be)}function t$e(fe,ve,_e){if(!(null==_e?void 0:_e.features)||!_e.hasZ)return;const be=o$3F(_e.geometryType,ve,fe.outSpatialReference);if(null!=be)for(const we of _e.features)be(we.geometry)}var QPe;const KPe=new An({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let eCe=QPe=class extends Pn{constructor(fe){super(fe),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(fe,ve){var _e;const be=zo.fromJSON(ve.spatialReference),we=[];for(let Se=0;Se<fe.length;Se++){const ve=fe[Se],Te=RT.fromJSON(ve),Ee=null==(_e=ve.geometry)?void 0:_e.spatialReference;null==Te.geometry||Ee||(Te.geometry.spatialReference=be);const Ce=ve.aggregateGeometries,Oe=Te.aggregateGeometries;if(Ce&&null!=Oe)for(const fe in Oe){const ve=Oe[fe],_e=Ce[fe],we=null==_e?void 0:_e.spatialReference;null==ve||we||(ve.spatialReference=be)}we.push(Te)}return we}writeGeometryType(fe,ve,_e,be){if(fe)return void KPe.write(fe,ve,_e,be);const{features:we}=this;if(we)for(const Se of we)if(null!=(null==Se?void 0:Se.geometry))return void KPe.write(Se.geometry.type,ve,_e,be)}readQueryGeometry(fe,ve){if(!fe)return null;const _e=!!fe.spatialReference,be=y$2e(fe);return be&&!_e&&ve.spatialReference&&(be.spatialReference=zo.fromJSON(ve.spatialReference)),be}writeSpatialReference(fe,ve){if(fe)return void(ve.spatialReference=fe.toJSON());const{features:_e}=this;if(_e)for(const be of _e)if(be&&null!=be.geometry&&be.geometry.spatialReference)return void(ve.spatialReference=be.geometry.spatialReference.toJSON())}clone(){return new QPe(this.cloneProperties())}cloneProperties(){return a$4H({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(fe){const ve=this.write();if(ve.features&&Array.isArray(fe)&&fe.length>0)for(let _e=0;_e<ve.features.length;_e++){const be=ve.features[_e];if(be.geometry){const ve=null==fe?void 0:fe[_e];be.geometry=(null==ve?void 0:ve.toJSON())||be.geometry}}return ve}quantize(fe){const{scale:[ve,_e],translate:[be,we]}=fe,Se=this.features,Te=this._getQuantizationFunction(this.geometryType,(fe=>Math.round((fe-be)/ve)),(fe=>Math.round((we-fe)/_e)));for(let Ee=0,Ce=Se.length;Ee<Ce;Ee++)(null==Te?void 0:Te(Se[Ee].geometry))||(Se.splice(Ee,1),Ee--,Ce--);return this.transform=fe,this}unquantize(){var fe,ve;const{geometryType:_e,features:be,transform:we}=this;if(!we)return this;const{translate:[Se,Te],scale:[Ee,Ce]}=we;let Oe=null,Re=null;if(this.hasZ&&null!=(null==(fe=null==we?void 0:we.scale)?void 0:fe[2])){const{translate:[,,fe],scale:[,,ve]}=we;Oe=_e=>_e*ve+fe}if(this.hasM&&null!=(null==(ve=null==we?void 0:we.scale)?void 0:ve[3])){const{translate:[,,,fe],scale:[,,,ve]}=we;Re=_e=>null==_e?_e:_e*ve+fe}const De=this._getHydrationFunction(_e,(fe=>fe*Ee+Se),(fe=>Te-fe*Ce),Oe,Re);for(const{geometry:Be}of be)null!=Be&&De&&De(Be);return this.transform=null,this}_quantizePoints(fe,ve,_e){let be,we;const Se=[];for(let Te=0,Ee=fe.length;Te<Ee;Te++){const Ee=fe[Te];if(Te>0){const fe=ve(Ee[0]),Te=_e(Ee[1]);fe===be&&Te===we||(Se.push([fe-be,Te-we]),be=fe,we=Te)}else be=ve(Ee[0]),we=_e(Ee[1]),Se.push([be,we])}return Se.length>0?Se:null}_getQuantizationFunction(fe,ve,_e){return"point"===fe?fe=>(fe.x=ve(fe.x),fe.y=_e(fe.y),fe):"polyline"===fe||"polygon"===fe?fe=>{const be=f$2Z(fe)?fe.rings:fe.paths,we=[];for(let Se=0,Te=be.length;Se<Te;Se++){const fe=be[Se],Te=this._quantizePoints(fe,ve,_e);Te&&we.push(Te)}return we.length>0?(f$2Z(fe)?fe.rings=we:fe.paths=we,fe):null}:"multipoint"===fe?fe=>{const be=this._quantizePoints(fe.points,ve,_e);return be&&be.length>0?(fe.points=be,fe):null}:"extent"===fe?fe=>fe:null}_getHydrationFunction(fe,ve,_e,be,we){return"point"===fe?fe=>{fe.x=ve(fe.x),fe.y=_e(fe.y),be&&(fe.z=be(fe.z))}:"polyline"===fe||"polygon"===fe?fe=>{const Se=f$2Z(fe)?fe.rings:fe.paths;let Te,Ee;for(let be=0,we=Se.length;be<we;be++){const fe=Se[be];for(let be=0,we=fe.length;be<we;be++){const we=fe[be];be>0?(Te+=we[0],Ee+=we[1]):(Te=we[0],Ee=we[1]),we[0]=ve(Te),we[1]=_e(Ee)}}if(be&&we)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];for(let ve=0,_e=fe.length;ve<_e;ve++){const _e=fe[ve];_e[2]=be(_e[2]),_e[3]=we(_e[3])}}else if(be)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];for(let ve=0,_e=fe.length;ve<_e;ve++){const _e=fe[ve];_e[2]=be(_e[2])}}else if(we)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];for(let ve=0,_e=fe.length;ve<_e;ve++){const _e=fe[ve];_e[2]=we(_e[2])}}}:"extent"===fe?fe=>{fe.xmin=ve(fe.xmin),fe.ymin=_e(fe.ymin),fe.xmax=ve(fe.xmax),fe.ymax=_e(fe.ymax),be&&null!=fe.zmax&&null!=fe.zmin&&(fe.zmax=be(fe.zmax),fe.zmin=be(fe.zmin)),we&&null!=fe.mmax&&null!=fe.mmin&&(fe.mmax=we(fe.mmax),fe.mmin=we(fe.mmin))}:"multipoint"===fe?fe=>{const Se=fe.points;let Te,Ee;for(let be=0,we=Se.length;be<we;be++){const fe=Se[be];be>0?(Te+=fe[0],Ee+=fe[1]):(Te=fe[0],Ee=fe[1]),fe[0]=ve(Te),fe[1]=_e(Ee)}if(be&&we)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];fe[2]=be(fe[2]),fe[3]=we(fe[3])}else if(be)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];fe[2]=be(fe[2])}else if(we)for(let ve=0,_e=Se.length;ve<_e;ve++){const fe=Se[ve];fe[2]=we(fe[2])}}:null}};e$4o([y$2v({type:String,json:{write:!0}})],eCe.prototype,"displayFieldName",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],eCe.prototype,"exceededTransferLimit",void 0),e$4o([y$2v({type:[RT],json:{write:!0}})],eCe.prototype,"features",void 0),e$4o([o$40("features")],eCe.prototype,"readFeatures",null),e$4o([y$2v({type:[oE],json:{write:!0}})],eCe.prototype,"fields",void 0),e$4o([y$2v({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:KPe.read}}})],eCe.prototype,"geometryType",void 0),e$4o([r$3s("geometryType")],eCe.prototype,"writeGeometryType",null),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],eCe.prototype,"hasM",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],eCe.prototype,"hasZ",void 0),e$4o([y$2v({types:Oa,json:{write:!0}})],eCe.prototype,"queryGeometry",void 0),e$4o([o$40("queryGeometry")],eCe.prototype,"readQueryGeometry",null),e$4o([y$2v({type:zo,json:{write:!0}})],eCe.prototype,"spatialReference",void 0),e$4o([r$3s("spatialReference")],eCe.prototype,"writeSpatialReference",null),e$4o([y$2v({json:{write:!0}})],eCe.prototype,"transform",void 0),eCe=QPe=e$4o([a$4y("esri.rest.support.FeatureSet")],eCe),eCe.prototype.toJSON.isDefaultToJSON=!0;const tCe=eCe;let rCe=0,iCe=class T12 extends(Sv.LoadableMixin(n$3T(Wa))){constructor(fe){super(fe),this._idToClientGraphic=null,this.type="memory"}load(fe){const ve=null!=fe?fe.signal:null;return this.addResolvingPromise(this._startWorker(ve)),Promise.resolve(this)}destroy(){var fe;null==(fe=this._connection)||fe.close(),this._connection=null}get _workerGeometryType(){var fe;const ve=null==(fe=this.layer)?void 0:fe.geometryType;return ve?this._geometryTypeRequiresClientGraphicMapping(ve)?"polygon":ve:null}applyEdits(fe){return this.load().then((()=>this._applyEdits(fe)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(fe,ve={}){await this.load(ve);const _e=await this._connection.invoke("queryFeatures",fe?fe.toJSON():null,ve);t$e(fe,this.layer.spatialReference,_e);const be=tCe.fromJSON(_e);if(!this._requiresClientGraphicMapping())return be;const we=this.layer.objectIdField;for(const Se of be.features){const fe=Se.attributes[we],ve=this._idToClientGraphic.get(fe);ve&&(Se.geometry=ve.geometry)}return be.geometryType=this.layer.geometryType,be}async queryFeaturesJSON(fe,ve={}){if(this._requiresClientGraphicMapping())throw new Ir("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(ve);const _e=await this._connection.invoke("queryFeatures",fe?fe.toJSON():null,ve);return t$e(fe,this.layer.spatialReference,_e),_e}queryFeatureCount(fe,ve={}){return this.load(ve).then((()=>this._connection.invoke("queryFeatureCount",fe?fe.toJSON():null,ve)))}queryObjectIds(fe,ve={}){return this.load(ve).then((()=>this._connection.invoke("queryObjectIds",fe?fe.toJSON():null,ve)))}queryExtent(fe,ve={}){return this.load(ve).then((()=>this._connection.invoke("queryExtent",fe?fe.toJSON():null,ve))).then((fe=>({count:fe.count,extent:aa.fromJSON(fe.extent)})))}querySnapping(fe,ve={}){return this.load(ve).then((()=>this._connection.invoke("querySnapping",fe,ve)))}async _applyEdits(fe){if(!this._connection)throw new Ir("feature-layer-source:edit-failure","Memory source not loaded");const ve=this.layer.objectIdField;let _e=null;const be=[],we=[];await Promise.all([this._prepareClientMapping(fe.addFeatures,null),this._prepareClientMapping(fe.updateFeatures,null)]);const n52=fe=>"objectId"in fe&&null!=fe.objectId?fe.objectId:"attributes"in fe&&null!=fe.attributes[ve]?fe.attributes[ve]:null;if(fe.addFeatures&&(_e=this._prepareAddFeatures(fe.addFeatures)),fe.deleteFeatures)for(const Ce of fe.deleteFeatures){const fe=n52(Ce);null!=fe&&be.push(fe)}const Se=fe.updateFeatures&&this._idToClientGraphic?new Map:null;if(fe.updateFeatures)for(const Ce of fe.updateFeatures)if(we.push(this._serializeFeature(Ce)),Se){const fe=n52(Ce);null!=fe&&Se.set(fe,Ce)}i$i(_e?_e.features:null,we,this.layer.spatialReference);const{fullExtent:Te,featureEditResults:Ee}=await this._connection.invoke("applyEdits",{adds:_e?_e.features:[],updates:we,deletes:be});return this.fullExtent=Te,_e&&_e.finish(Ee.uidToObjectId),this._updateClientGraphicIds(Se,Ee),this._createEditsResult(Ee)}async _prepareClientMapping(fe,ve){if("mesh"!==this._layerOrSourceGeometryType||null==fe)return;const _e=[];for(const{geometry:be}of fe)null==be||"mesh"!==be.type||be.hasExtent||be.loaded||_e.push(be.load({signal:ve}));_e.length&&await Promise.all(_e)}_updateClientGraphicIds(fe,ve){if(this._idToClientGraphic){if(fe)for(const _e of ve.updateResults){if(!_e.success)continue;const ve=fe.get(_e.objectId);null!=ve&&this._addIdToClientGraphic(ve)}for(const fe of ve.deleteResults)fe.success&&this._idToClientGraphic.delete(fe.objectId)}}_createEditsResult(fe){return{addFeatureResults:fe.addResults?fe.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:fe.updateResults?fe.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:fe.deleteResults?fe.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(fe){const ve=!0===fe.success?null:fe.error||{code:void 0,description:void 0};return{objectId:fe.objectId,globalId:fe.globalId,error:ve?new Ir("feature-layer-source:edit-failure",ve.description,{code:ve.code}):null}}_prepareAddFeatures(fe){const ve=new Map,_e=new Array(fe.length);let be=null;for(let Se=0;Se<fe.length;Se++){const we=fe[Se],Te=this._serializeFeature(we);be||null==we.geometry||(be=we.geometry.type),_e[Se]=Te,ve.set(`${Te.uid}`,we)}const we=this;return{features:_e,inferredGeometryType:be,finish(fe){const _e=we.sourceJSON.objectIdField;for(const be in fe){const Se=fe[be],Te=ve.get(be);Te&&(Te.attributes||(Te.attributes={}),-1===Se?delete Te.attributes[_e]:Te.attributes[_e]=Se,we._addIdToClientGraphic(Te))}}}}_addIdToClientGraphic(fe){var ve;if(!this._idToClientGraphic)return;const _e=this.sourceJSON.objectIdField,be=null==(ve=fe.attributes)?void 0:ve[_e];null!=be&&this._idToClientGraphic.set(be,fe)}get _layerOrSourceGeometryType(){var fe,ve;return(null==(fe=this.layer)?void 0:fe.geometryType)??(null==(ve=this.sourceJSON)?void 0:ve.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(fe){return this._geometryTypeRequiresClientGraphicMapping(fe.type)}_geometryTypeRequiresClientGraphicMapping(fe){return"mesh"===fe||"multipatch"===fe||"extent"===fe}_serializeFeature(fe){const{attributes:ve}=fe,_e=this._geometryForSerialization(fe),be=(rCe++).toString();return _e?{uid:be,geometry:_e.toJSON(),attributes:ve}:{uid:be,attributes:ve}}_geometryForSerialization(fe){const{geometry:ve}=fe;return null==ve?null:this._geometryRequiresClientGraphicMapping(ve)?ve.extent?wa.fromExtent(ve.extent):null:ve}async _startWorker(fe){this._connection=await p$4D("MemorySourceWorker",{strategy:has("feature-layers-workers")?"dedicated":"local",signal:fe,registryTarget:this});const{fields:ve,spatialReference:_e,objectIdField:be,hasM:we,hasZ:Se,timeInfo:Te,dateFieldsTimeZone:Ee}=this.layer,Ce="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,fe);const Oe=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",(fe=>{ar.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),fe.preventDefault()})));const Re={features:Oe.features,fields:null==ve?void 0:ve.map((fe=>fe.toJSON())),geometryType:Pa.toJSON(this._workerGeometryType),hasM:"mesh"!==this._layerOrSourceGeometryType&&we,hasZ:"mesh"===this._layerOrSourceGeometryType||Se,objectIdField:be,spatialReference:Ce?null:_e&&_e.toJSON(),timeInfo:(null==Te?void 0:Te.toJSON())??null,dateFieldsTimeZone:Ee},De=await this._connection.invoke("load",Re,{signal:fe});for(const Ze of De.warnings)ar.getLogger(this.layer).warn("#load()",`${Ze.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:Ze});De.featureErrors.length&&ar.getLogger(this.layer).warn("#load()",`Encountered ${De.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:De.featureErrors});const Be=De.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(Oe.inferredGeometryType)&&(Be.geometryType=Pa.toJSON(Oe.inferredGeometryType)),this.sourceJSON=Be,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),Oe.finish(De.assignedObjectIds)}};e$4o([n$4l({Type:RT,ensureType:b$2d(RT)})],iCe.prototype,"itemType",void 0),e$4o([y$2v()],iCe.prototype,"type",void 0),e$4o([y$2v({constructOnly:!0})],iCe.prototype,"layer",void 0),e$4o([y$2v({readOnly:!0})],iCe.prototype,"_workerGeometryType",null),e$4o([y$2v()],iCe.prototype,"sourceJSON",void 0),iCe=e$4o([a$4y("esri.layers.graphics.sources.MemorySource")],iCe);const nCe=function o$m(){return`{${n$Q()}}`}(),sCe=new Map,oCe=new Map;async function o$8(fe,ve,_e){if(!fe||!_e)return!1;if(!ve)return!0;const be=new URL(fe).host;let we=sCe.get(be);if(!we){const ve=fe.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");we=(await U$1a(ve,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return we===ve}async function i$h(fe,ve,_e=!1){var be,we,Se;if(!fe||!ve)return!0;const Te=fe.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),Ee=null==(be=oCe.get(Te))?void 0:be.entries();if(Ee)for(const[Ce,Oe]of Ee)if(Oe.name===ve){const fe=!(null==(we=Oe.stack)?void 0:we.hasForwardEdits());if(!fe&&_e){const[{deleteForwardEdits:fe},{default:ve}]=await Promise.all([zt((()=>import("./deleteForwardEdits-DtmOymKK.js")),[]),zt((()=>import("./DeleteForwardEditsParameters-C5ZH_dhm.js")),[])]),_e=await fe(Te,Ce,new ve({sessionId:nCe,moment:Oe.moment}));return _e.success&&(null==(Se=Oe.stack)||Se.clearForwardEdits()),_e.success}return fe}return!0}function c$s(fe,ve){var _e;if(!fe)return!1;const be=fe.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),we=null==(_e=oCe.get(be))?void 0:_e.entries();if(we)for(const[Se,Te]of we)if(Te.name===ve)return"edit"===Te.lockType;return!1}const aCe=new La.EventEmitter;function c$r(fe,ve,_e=null,be=!1){const we=L$1h();return be=null==ve||be,aCe.emit("apply-edits",{serviceUrl:fe,layerId:ve,gdbVersion:_e,mayReceiveServiceEdits:be,result:we.promise}),we}const lCe=Symbol();function p$z(fe){return null!=fe&&"object"==typeof fe&&lCe in fe}function b$3(fe){return null!=fe&&"object"==typeof fe&&"gdbVersion"in fe}function g$9(fe,ve,_e){const be=new URL(fe).host,we=sCe.get(be),d35=fe=>!fe||fe===we;return d35(ve)&&d35(_e)||ve===_e}const F$2=fe=>{var ve;let _e=class extends fe{constructor(...fe){super(...fe),this[ve]=!0,this._applyEditsHandler=fe=>{const{serviceUrl:ve,layerId:_e,gdbVersion:be,mayReceiveServiceEdits:we,result:Se}=fe,Te=ve===this.url,Ee=null!=_e&&null!=this.layerId&&_e===this.layerId,Ce=b$3(this),Oe=b$3(this)&&g$9(ve,be,this.gdbVersion);if(!Te||Ce&&!Oe||!Ee&&!we)return;this.lastEditsEventDate=new Date;const Re=Se.then((fe=>{var _e;if(Ee&&(fe.addedFeatures.length||fe.updatedFeatures.length||fe.deletedFeatures.length||fe.addedAttachments.length||fe.updatedAttachments.length||fe.deletedAttachments.length))return this.emit("edits",a$4H(fe)),fe;const we=null==(_e=fe.editedFeatures)?void 0:_e.find((({layerId:fe})=>fe===this.layerId));if(we){const{adds:ve,updates:_e,deletes:be}=we.editedFeatures,Se={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:ve?ve.map((({attributes:fe})=>({objectId:this.objectIdField&&fe[this.objectIdField],globalId:this.globalIdField&&fe[this.globalIdField]}))):[],deletedFeatures:be?be.map((({attributes:fe})=>({objectId:this.objectIdField&&fe[this.objectIdField],globalId:this.globalIdField&&fe[this.globalIdField]}))):[],updatedFeatures:_e?_e.map((({current:{attributes:fe}})=>({objectId:this.objectIdField&&fe[this.objectIdField],globalId:this.globalIdField&&fe[this.globalIdField]}))):[],editedFeatures:a$4H(fe.editedFeatures),exceededTransferLimit:!1,historicMoment:a$4H(fe.historicMoment)};return this.emit("edits",Se),Se}const Se={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:a$4H(fe.editedFeatures),exceededTransferLimit:!1,historicMoment:a$4H(fe.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(ve,be,Se.historicMoment)&&this.emit("edits",Se),Se})).then((fe=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(ve,be,fe.historicMoment)&&(this.historicMoment=fe.historicMoment),fe)));this.emit("apply-edits",{result:Re})},this._updateMomentHandler=fe=>{const{serviceUrl:ve,gdbVersion:_e,moment:be}=fe,we=ve===this.url,Se=b$3(this),Te=b$3(this)&&g$9(ve,_e,this.gdbVersion),Ee=b$3(this)&&!g$9(ve,this.gdbVersion,null);we&&Se&&Te&&Ee&&"historicMoment"in this&&this.historicMoment!==be&&(this.historicMoment=be)},this.when().then((()=>{this.addHandles(function l$l(fe){return aCe.on("apply-edits",new WeakRef(fe))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function h$8(fe){return aCe.on("update-moment",new WeakRef(fe))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(fe,ve,_e){return"historicMoment"in this&&this.historicMoment!==_e&&c$s(fe,ve)}};return ve=lCe,e$4o([y$2v()],_e.prototype,"lastEditsEventDate",void 0),_e=e$4o([a$4y("esri.layers.mixins.EditBusLayer")],_e),_e};var cCe;const uCe=new An({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),hCe=new An({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let dCe=cCe=class extends Pn{constructor(fe){super(fe),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(fe={}){const{where:ve,geometry:_e,spatialRelationship:be,timeExtent:we,objectIds:Se,units:Te,distance:Ee}=this;return new FE({geometry:a$4H(_e),objectIds:a$4H(Se),spatialRelationship:be,timeExtent:a$4H(we),where:ve,units:Te,distance:Ee,...fe})}clone(){const{where:fe,geometry:ve,spatialRelationship:_e,timeExtent:be,objectIds:we,units:Se,distance:Te}=this;return new cCe({geometry:a$4H(ve),objectIds:a$4H(we),spatialRelationship:_e,timeExtent:a$4H(be),where:fe,units:Se,distance:Te})}};e$4o([y$2v({type:String,json:{write:!0}})],dCe.prototype,"where",void 0),e$4o([y$2v({types:Oa,json:{write:!0}})],dCe.prototype,"geometry",void 0),e$4o([y$2v({type:uCe.apiValues,json:{name:"spatialRel",read:{reader:uCe.read},write:{allowNull:!1,writer:uCe.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],dCe.prototype,"spatialRelationship",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy(fe){return{enabled:null!=fe&&null!=this.geometry}}}}})],dCe.prototype,"distance",void 0),e$4o([y$2v({type:[Number],json:{write:!0}})],dCe.prototype,"objectIds",void 0),e$4o([y$2v({type:hCe.apiValues,json:{read:hCe.read,write:{writer:hCe.write,overridePolicy(fe){return{enabled:null!=fe&&null!=this.geometry}}}}})],dCe.prototype,"units",void 0),e$4o([y$2v({type:j_,json:{write:!0}})],dCe.prototype,"timeExtent",void 0),dCe=cCe=e$4o([a$4y("esri.layers.support.FeatureFilter")],dCe);const pCe=dCe;var fCe;const mCe={read:{reader:n$1R},write:{writer:a$1I,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},yCe={read:{reader:n$1R},write:{writer:a$1I,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},gCe={name:"showExcludedLabels",default:!0};let vCe=fCe=class extends Pn{constructor(fe){super(fe),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(fe,ve){var _e,be;const we=super.write(fe,ve);if(null==ve?void 0:ve.origin){if(we.filter){const fe=Object.keys(we.filter);if(fe.length>1||"where"!==fe[0])return null==(_e=ve.messages)||_e.push(new Ir("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:ve.layer,effect:this})),null}if("showExcludedLabels"in we)return null==(be=ve.messages)||be.push(new Ir("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:ve.layer,effect:this})),null}return we}clone(){return new fCe({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};e$4o([y$2v({type:pCe,json:{write:{allowNull:!0,writer(fe,ve,_e,be){const we=null==fe?void 0:fe.write({},be);we&&0!==Object.keys(we).length?e$4h(_e,we,ve):e$4h(_e,null,ve)}}}})],vCe.prototype,"filter",void 0),e$4o([y$2v({json:{read:n$1R,write:{writer:a$1I,allowNull:!0},origins:{"web-map":mCe,"portal-item":mCe}}})],vCe.prototype,"includedEffect",void 0),e$4o([y$2v({json:{read:n$1R,write:{writer:a$1I,allowNull:!0},origins:{"web-map":yCe,"portal-item":yCe}}})],vCe.prototype,"excludedEffect",void 0),e$4o([y$2v({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":gCe,"portal-item":gCe}}})],vCe.prototype,"excludedLabelsVisible",void 0),vCe=fCe=e$4o([a$4y("esri.layers.support.FeatureEffect")],vCe);const _Ce=vCe,$Ce={write:{allowNull:!0}},bCe={type:_Ce,json:{origins:{"web-map":$Ce,"portal-item":$Ce}}},c$p=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.featureEffect=null}};return e$4o([y$2v(bCe)],ve.prototype,"featureEffect",void 0),ve=e$4o([a$4y("esri.layers.mixins.FeatureEffectLayer")],ve),ve};let wCe=class l45 extends(i$4F(Pn)){constructor(fe){super(fe),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};e$4o([y$2v()],wCe.prototype,"creatorField",void 0),e$4o([y$2v()],wCe.prototype,"creationDateField",void 0),e$4o([y$2v()],wCe.prototype,"editorField",void 0),e$4o([y$2v()],wCe.prototype,"editDateField",void 0),e$4o([y$2v()],wCe.prototype,"realm",void 0),e$4o([y$2v(c$4q("dateFieldsTimeReference",!0))],wCe.prototype,"timeZone",void 0),wCe=e$4o([a$4y("esri.layers.support.EditFieldsInfo")],wCe);const xCe=wCe;let SCe=class p44 extends(i$4F(Pn)){constructor(fe){super(fe)}};async function r$6(fe,ve,_e){ve=ve.clone(),fe.capabilities.query.supportsMaxRecordCountFactor&&(ve.maxRecordCountFactor=u$f(fe));const be=t$c(fe),we=fe.capabilities.query.supportsPagination;ve.start=0,ve.num=be;let Se=null;for(;;){const Te=await fe.source.queryFeaturesJSON(ve,_e);if(null==Se?Se=Te:Se.features=Se.features.concat(Te.features),Se.exceededTransferLimit=Te.exceededTransferLimit,!we||!Te.exceededTransferLimit)break;ve.start+=be}return Se}function t$c(fe){return u$f(fe)*function a$j(fe){return fe.capabilities.query.maxRecordCount||2e3}(fe)}function u$f(fe){return fe.capabilities.query.supportsMaxRecordCountFactor?FE.MAX_MAX_RECORD_COUNT_FACTOR:1}var TCe;e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"name",void 0),e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"fields",void 0),e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"isAscending",void 0),e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"indexType",void 0),e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"isUnique",void 0),e$4o([y$2v({constructOnly:!0,json:{write:!0}})],SCe.prototype,"description",void 0),SCe=e$4o([a$4y("esri.layers.support.FeatureIndex")],SCe);let ECe=TCe=class extends Pn{constructor(fe){super(fe),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(fe,ve){ve.resultOffset=this.start,ve.resultRecordCount=this.num||10}clone(){return new TCe(a$4H({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};e$4o([y$2v({type:[String],json:{write:!0}})],ECe.prototype,"attachmentTypes",void 0),e$4o([y$2v({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],ECe.prototype,"attachmentsWhere",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],ECe.prototype,"cacheHint",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],ECe.prototype,"keywords",void 0),e$4o([y$2v({type:[Number],json:{write:!0}})],ECe.prototype,"globalIds",void 0),e$4o([y$2v({json:{write:!0}})],ECe.prototype,"name",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultRecordCount"}}})],ECe.prototype,"num",void 0),e$4o([y$2v({type:[Number],json:{write:!0}})],ECe.prototype,"objectIds",void 0),e$4o([y$2v({type:Boolean,json:{default:!1,write:!0}})],ECe.prototype,"returnMetadata",void 0),e$4o([y$2v({type:[Number],json:{write:!0}})],ECe.prototype,"size",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultOffset"}}})],ECe.prototype,"start",void 0),e$4o([r$3s("start"),r$3s("num")],ECe.prototype,"writeStart",null),e$4o([y$2v({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ECe.prototype,"where",void 0),ECe=TCe=e$4o([a$4y("esri.rest.support.AttachmentQuery")],ECe),ECe.from=b$2d(ECe);const PCe=ECe;var CCe;let OCe=CCe=class extends Pn{constructor(fe){super(fe),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(fe,ve){ve.historicMoment=fe&&fe.getTime()}writeStart(fe,ve){ve.resultOffset=this.start,ve.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(ve.definitionExpression="1=1")}clone(){return new CCe(a$4H({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};e$4o([y$2v({type:Boolean,json:{write:!0}})],OCe.prototype,"cacheHint",void 0),e$4o([y$2v({type:wE,json:{write:!0}})],OCe.prototype,"dynamicDataSource",void 0),e$4o([y$2v({type:String,json:{write:!0}})],OCe.prototype,"gdbVersion",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],OCe.prototype,"geometryPrecision",void 0),e$4o([y$2v({type:Date})],OCe.prototype,"historicMoment",void 0),e$4o([r$3s("historicMoment")],OCe.prototype,"_writeHistoricMoment",null),e$4o([y$2v({type:Number,json:{write:!0}})],OCe.prototype,"maxAllowableOffset",void 0),e$4o([y$2v({json:{write:!0}})],OCe.prototype,"objectIds",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],OCe.prototype,"orderByFields",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],OCe.prototype,"outFields",void 0),e$4o([y$2v({type:zo,json:{read:{source:"outSR"},write:{target:"outSR"}}})],OCe.prototype,"outSpatialReference",void 0),e$4o([y$2v({json:{write:!0}})],OCe.prototype,"relationshipId",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultOffset"}}})],OCe.prototype,"start",void 0),e$4o([r$3s("start"),r$3s("num")],OCe.prototype,"writeStart",null),e$4o([y$2v({type:Number,json:{read:{source:"resultRecordCount"}}})],OCe.prototype,"num",void 0),e$4o([y$2v({json:{write:!0}})],OCe.prototype,"returnGeometry",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],OCe.prototype,"returnM",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],OCe.prototype,"returnZ",void 0),e$4o([y$2v({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],OCe.prototype,"where",void 0),OCe=CCe=e$4o([a$4y("esri.rest.support.RelationshipQuery")],OCe),OCe.from=b$2d(OCe);const ACe=OCe,MCe=Object.freeze(Object.defineProperty({__proto__:null,default:ACe},Symbol.toStringTag,{value:"Module"})),RCe=new An({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function m$c(fe,ve,_e,be){const we=await G$1(fe);if(await h$7(fe,ve,be),!we.addAttachment)throw new Ir(be,"Layer source does not support addAttachment capability");return we.addAttachment(ve,_e)}function h$7(fe,ve,_e){var be,we;const{attributes:Se}=ve,{objectIdField:Te}=fe;return(null==(we=null==(be=fe.capabilities)?void 0:be.data)?void 0:we.supportsAttachment)?ve?Se?Te&&Se[Te]?Promise.resolve():Promise.reject(new Ir(_e,`feature is missing the identifying attribute ${Te}`)):Promise.reject(new Ir(_e,"'attributes' are required on a feature to query attachments")):Promise.reject(new Ir(_e,"A feature is required to add/delete/update attachments")):Promise.reject(new Ir(_e,"this layer doesn't support attachments"))}async function w$4(fe,ve,_e,be,we){const Se=await G$1(fe);if(await h$7(fe,ve,we),!Se.updateAttachment)throw new Ir(we,"Layer source does not support updateAttachment capability");return Se.updateAttachment(ve,_e,be)}async function b$2(fe,ve,_e){const{applyEdits:be}=await zt((()=>import("./editingSupport-BNx5CWnq.js")),__vite__mapDeps([214,18,19,103])),we=await fe.load();let Se=_e;return"feature"===we.type&&we.infoFor3D&&null!=ve.deleteFeatures&&null!=we.globalIdField&&(Se={...Se,globalIdToObjectId:await J$1(we,ve.deleteFeatures,we.globalIdField)}),be(we,we.source,ve,_e)}async function j$3(fe,ve,_e,be){const we=await G$1(fe);if(await h$7(fe,ve,be),!we.deleteAttachments)throw new Ir(be,"Layer source does not support deleteAttachments capability");return we.deleteAttachments(ve,_e)}async function I$3(fe,ve,_e){const be=(await fe.load({signal:null==ve?void 0:ve.signal})).source;if(!be.fetchRecomputedExtents)throw new Ir(_e,"Layer source does not support fetchUpdates capability");return be.fetchRecomputedExtents(ve)}async function q$1(fe,ve,_e,be){var we,Se;ve=PCe.from(ve),await fe.load();const Te=fe.source,Ee=fe.capabilities;if(!(null==(we=null==Ee?void 0:Ee.data)?void 0:we.supportsAttachment))throw new Ir(be,"this layer doesn't support attachments");const{attachmentTypes:Ce,objectIds:Oe,globalIds:Re,num:De,size:Be,start:Ze,where:Xe}=ve;if(!(null==(Se=null==Ee?void 0:Ee.operations)?void 0:Se.supportsQueryAttachments)&&((null==Ce?void 0:Ce.length)>0||(null==Re?void 0:Re.length)>0||(null==Be?void 0:Be.length)>0||De||Ze||Xe))throw new Ir(be,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",ve);if(!((null==Oe?void 0:Oe.length)||(null==Re?void 0:Re.length)||Xe))throw new Ir(be,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",ve);if(!Te.queryAttachments)throw new Ir(be,"Layer source does not support queryAttachments capability",ve);return Te.queryAttachments(ve)}async function F$1(fe,ve,_e,be){const we=await G$1(fe);if(!we.queryObjectIds)throw new Ir(be,"Layer source does not support queryObjectIds capability");return we.queryObjectIds(FE.from(ve)??fe.createQuery(),_e)}async function A$5(fe,ve,_e,be){const we=await G$1(fe);if(!we.queryFeatureCount)throw new Ir(be,"Layer source does not support queryFeatureCount capability");return we.queryFeatureCount(FE.from(ve)??fe.createQuery(),_e)}async function O$3(fe,ve,_e,be){const we=await G$1(fe);if(!we.queryExtent)throw new Ir(be,"Layer source does not support queryExtent capability");return we.queryExtent(FE.from(ve)??fe.createQuery(),_e)}async function P$3(fe,ve,_e,be){const we=await G$1(fe);if(!we.queryRelatedFeatures)throw new Ir(be,"Layer source does not support queryRelatedFeatures capability");return we.queryRelatedFeatures(ACe.from(ve),_e)}async function S$3(fe,ve,_e,be){const we=await G$1(fe);if(!we.queryRelatedFeaturesCount)throw new Ir(be,"Layer source does not support queryRelatedFeaturesCount capability");return we.queryRelatedFeaturesCount(ACe.from(ve),_e)}async function E$3(fe){const ve=fe.source;if(null==ve?void 0:ve.refresh)try{const{dataChanged:_e,updates:be}=await ve.refresh();if(null!=be&&(fe.sourceJSON={...fe.sourceJSON,...be},fe.read(be,{origin:"service",url:fe.parsedUrl})),_e)return!0}catch{}if(fe.definitionExpression)try{return(await e$3l(fe.definitionExpression,fe.fieldsIndex)).hasDateFunctions}catch{}return!1}function x$2(fe){var ve,_e;const be=new FE,we=null==(ve=fe.capabilities)?void 0:ve.data,Se=null==(_e=fe.capabilities)?void 0:_e.query;be.historicMoment=fe.historicMoment,be.gdbVersion=fe.gdbVersion,be.returnGeometry=!0,Se&&(be.compactGeometryEnabled=Se.supportsCompactGeometry,be.defaultSpatialReferenceEnabled=Se.supportsDefaultSpatialReference),we&&(we.supportsZ&&null!=fe.returnZ&&(be.returnZ=fe.returnZ),we.supportsM&&null!=fe.returnM&&(be.returnM=fe.returnM)),be.outFields=["*"];const{timeOffset:Te,timeExtent:Ee}=fe;return be.timeExtent=null!=Te&&null!=Ee?Ee.offset(-Te.value,Te.unit):Ee||null,be.multipatchOption="multipatch"===fe.geometryType?"xyFootprint":null,be}function R$2(fe){const{globalIdField:ve,fields:_e}=fe;if(ve)return ve;if(_e)for(const be of _e)if("esriFieldTypeGlobalID"===be.type)return be.name}function M$1(fe){const{objectIdField:ve,fields:_e}=fe;if(ve)return ve;if(_e)for(const be of _e)if("esriFieldTypeOID"===be.type)return be.name}async function G$1(fe){return(await fe.load()).source}async function T$1(fe,ve,_e){var be;const we=null==(be=fe.parsedUrl)?void 0:be.path;we&&fe.authenticationTriggerEvent===ve&&await async function Q$2(fe,ve){if(!Ts)return;if(Ts.findCredential(fe))return;let _e;try{const be=await x$1x(fe,ve);be&&(_e=await Ts.checkSignInStatus(`${be}/sharing`))}catch(xv){}if(_e)try{const _e=null!=ve?ve.signal:null;await Ts.getCredential(fe,{signal:_e})}catch(xv){}}(we,_e)}function v$4(fe){return!Z$1(fe)&&(fe.userHasUpdateItemPrivileges||fe.editingEnabled)}const ICe=u$41({types:TT});function U$3(fe,ve){var _e;if(fe.defaultSymbol)return(null==(_e=fe.types)?void 0:_e.length)?new VEe({defaultSymbol:ICe(fe.defaultSymbol,fe,ve),field:fe.typeIdField,uniqueValueInfos:fe.types.map((fe=>({id:fe.id,symbol:ICe(fe.symbol,fe,ve)})))}):new SEe({symbol:ICe(fe.defaultSymbol,fe,ve)})}async function J$1(fe,ve,_e){if(null==ve)return null;const be=[],{objectIdField:we}=fe;if(ve.forEach((fe=>{let ve=null;if("attributes"in fe){const{attributes:be}=fe;ve={globalId:be[_e],objectId:null!=be[we]&&-1!==be[we]?be[we]:null}}else ve={globalId:fe.globalId,objectId:null!=fe.objectId&&-1!==fe.objectId?fe.objectId:null};null!=ve.globalId&&(null!=ve.objectId&&-1!==ve.objectId||be.push(ve.globalId))})),0===be.length)return null;const Se=fe.createQuery();Se.where=be.map((fe=>`${_e}='${fe}'`)).join(" OR "),Se.returnGeometry=!1,Se.outFields=[we,_e],Se.cacheHint=!1;const Te=await b$26(r$6(fe,Se));if(!Te.ok)return null;const Ee=new Map,Ce=Te.value.features;for(const Oe of Ce){const fe=Oe.attributes[_e],ve=Oe.attributes[we];null!=fe&&null!=ve&&-1!==ve&&Ee.set(fe,ve)}return Ee}function N$1(fe,ve,_e){if(!ve||!_e||!fe)return null;const be=_e.getAttribute(ve);return null==be?null:fe.find((fe=>{const{id:ve}=fe;return null!=ve&&ve.toString()===be.toString()}))??null}function Z$1(fe){var ve;return(null==(ve=fe.sourceJSON)?void 0:ve.isMultiServicesView)||function $$1(fe){var ve,_e;return!!(null==(_e=null==(ve=fe.sourceJSON)?void 0:ve.capabilities)?void 0:_e.toLowerCase().split(",").map((fe=>fe.trim())).includes("map"))}(fe)}let LCe=class a51 extends(i$4F(Pn)){constructor(fe){super(fe),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};e$4o([y$2v({type:String,json:{read:{source:"shapeAreaFieldName"}}})],LCe.prototype,"shapeAreaField",void 0),e$4o([y$2v({type:String,json:{read:{source:"shapeLengthFieldName"}}})],LCe.prototype,"shapeLengthField",void 0),e$4o([y$2v({type:String,json:{read:fe=>Io.read(fe)||Lo.read(fe)}})],LCe.prototype,"units",void 0),LCe=e$4o([a$4y("esri.layers.support.GeometryFieldsInfo")],LCe);const DCe=LCe;var NCe;let FCe=NCe=class extends Pn{constructor(fe){super(fe),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Wa}clone(){return new NCe({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};e$4o([y$2v({type:String,json:{write:!0}})],FCe.prototype,"floorField",void 0),e$4o([y$2v({json:{read:!1,write:!1}})],FCe.prototype,"viewAllMode",void 0),e$4o([y$2v({json:{read:!1,write:!1}})],FCe.prototype,"viewAllLevelIds",void 0),FCe=NCe=e$4o([a$4y("esri.layers.support.LayerFloorInfo")],FCe);const zCe=FCe,kCe=new An({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),UCe=new An({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let VCe=class l46 extends(i$4F(Pn)){constructor(fe){super(fe),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};e$4o([y$2v({json:{read:kCe.read,write:kCe.write}})],VCe.prototype,"cardinality",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"composite",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"id",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"keyField",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"keyFieldInRelationshipTable",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"name",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"relatedTableId",void 0),e$4o([y$2v({json:{read:!0,write:!0}})],VCe.prototype,"relationshipTableId",void 0),e$4o([y$2v({json:{read:UCe.read,write:UCe.write}})],VCe.prototype,"role",void 0),VCe=e$4o([a$4y("esri.layers.support.Relationship")],VCe);const BCe=VCe;function n$m(fe,ve,_e){return!!t$b(fe,ve,_e)}function r$5(fe,ve,_e){return t$b(fe,ve,_e)}function t$b(fe,ve,_e){return fe&&fe.hasOwnProperty(ve)?fe[ve]:_e}const jCe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function o$7(fe){var ve;const _e=null==(ve=null==fe?void 0:fe.supportedSpatialAggregationStatistics)?void 0:ve.map((fe=>fe.toLowerCase()));return{envelope:!!(null==_e?void 0:_e.includes("envelopeaggregate")),centroid:!!(null==_e?void 0:_e.includes("centroidaggregate")),convexHull:!!(null==_e?void 0:_e.includes("convexhullaggregate"))}}function u$d(fe,ve){var _e;const be=null==(_e=null==fe?void 0:fe.supportedOperationsWithCacheHint)?void 0:_e.map((fe=>fe.toLowerCase()));return!!(null==be?void 0:be.includes(ve.toLowerCase()))}function a$f(fe,ve){return{analytics:n$l(fe),attachment:i$f(fe),data:c$l(fe),metadata:d$9(fe),operations:l$h(fe.capabilities,fe,ve),query:y$6(fe,ve),queryRelated:m$b(fe),queryTopFeatures:h$6(fe),editing:C$4(fe)}}function n$l(fe){return{supportsCacheHint:u$d(fe.advancedQueryCapabilities,"queryAnalytics")}}function i$f(fe){const ve=fe.attachmentProperties,_e={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:u$d(fe.advancedQueryCapabilities,"queryAttachments"),supportsResize:n$m(fe,"supportsAttachmentsResizing",!1)};return ve&&Array.isArray(ve)&&ve.forEach((fe=>{const ve=jCe[fe.name];ve&&(_e[ve]=!!fe.isEnabled)})),_e}function c$l(fe){return{isVersioned:n$m(fe,"isDataVersioned",!1),supportsAttachment:n$m(fe,"hasAttachments",!1),supportsM:n$m(fe,"hasM",!1),supportsZ:n$m(fe,"hasZ",!1)}}function d$9(fe){return{supportsAdvancedFieldProperties:n$m(fe,"supportsFieldDescriptionProperty",!1)}}function l$h(fe,ve,_e){const be=fe?fe.toLowerCase().split(",").map((fe=>fe.trim())):[],we=_e?d$2m(_e):null,Se=be.includes(null!=we&&"MapServer"===we.serverType?"data":"query"),Te=be.includes("editing")&&!ve.datesInUnknownTimezone;let Ee=Te&&be.includes("create"),Ce=Te&&be.includes("delete"),Oe=Te&&be.includes("update");const Re=be.includes("changetracking"),De=ve.advancedQueryCapabilities;return Te&&!(Ee||Ce||Oe)&&(Ee=Ce=Oe=!0),{supportsCalculate:n$m(ve,"supportsCalculate",!1),supportsTruncate:n$m(ve,"supportsTruncate",!1),supportsValidateSql:n$m(ve,"supportsValidateSql",!1),supportsAdd:Ee,supportsDelete:Ce,supportsEditing:Te,supportsChangeTracking:Re,supportsQuery:Se,supportsQueryAnalytics:n$m(De,"supportsQueryAnalytic",!1),supportsQueryAttachments:n$m(De,"supportsQueryAttachments",!1),supportsQueryTopFeatures:n$m(De,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:n$m(ve,"supportsAttachmentsResizing",!1),supportsSync:be.includes("sync"),supportsUpdate:Oe,supportsExceedsLimitStatistics:n$m(ve,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:n$m(ve,"supportsAsyncConvert3D",!1)}}function y$6(fe,ve){const _e=fe.advancedQueryCapabilities,be=fe.ownershipBasedAccessControlForFeatures,we=fe.archivingInfo,Se=fe.currentVersion,Te=!(null==ve?void 0:ve.includes("MapServer"))||Se>=has("mapserver-pbf-version-support"),Ee=g$1O(ve),Ce=new Set((fe.supportedQueryFormats??"").split(",").map((fe=>fe.toLowerCase().trim())));return{maxRecordCount:r$5(fe,"maxRecordCount",void 0),maxRecordCountFactor:r$5(fe,"maxRecordCountFactor",void 0),standardMaxRecordCount:r$5(fe,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:o$7(_e),supportsCacheHint:n$m(_e,"supportsQueryWithCacheHint",!1)||u$d(_e,"query"),supportsCentroid:n$m(_e,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:Ee,supportsDefaultSpatialReference:n$m(_e,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:n$m(_e,"supportsDisjointSpatialRel",!1),supportsDistance:n$m(_e,"supportsQueryWithDistance",!1),supportsDistinct:n$m(_e,"supportsDistinct",fe.supportsAdvancedQueries),supportsExtent:n$m(_e,"supportsReturningQueryExtent",!1),supportsFormatPBF:Te&&Ce.has("pbf"),supportsFullTextSearch:n$m(_e,"supportsFullTextSearch",!1),supportsGeometryProperties:n$m(_e,"supportsReturningGeometryProperties",!1),supportsHavingClause:n$m(_e,"supportsHavingClause",!1),supportsHistoricMoment:n$m(we,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:n$m(_e,"supportsMaxRecordCountFactor",!1),supportsOrderBy:n$m(_e,"supportsOrderBy",fe.supportsAdvancedQueries),supportsPagination:n$m(_e,"supportsPagination",!1),supportsPercentileStatistics:n$m(_e,"supportsPercentileStatistics",!1),supportsQuantization:n$m(fe,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:n$m(fe,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:n$m(be,"allowAnonymousToQuery",!0),supportsQueryByOthers:n$m(be,"allowOthersToQuery",!0),supportsQueryGeometry:n$m(fe,"supportsReturningQueryGeometry",!1),supportsResultType:n$m(_e,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:n$m(_e,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:n$m(_e,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:n$m(fe,"useStandardizedQueries",!1),supportsStatistics:n$m(_e,"supportsStatistics",fe.supportsStatistics),supportsTopFeaturesQuery:n$m(_e,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:r$5(fe,"tileMaxRecordCount",void 0)}}function m$b(fe){const ve=fe.advancedQueryCapabilities,_e=n$m(ve,"supportsAdvancedQueryRelated",!1);return{supportsPagination:n$m(ve,"supportsQueryRelatedPagination",!1),supportsCount:_e,supportsOrderBy:_e,supportsCacheHint:u$d(ve,"queryRelated")}}function h$6(fe){return{supportsCacheHint:u$d(fe.advancedQueryCapabilities,"queryTopFilter")}}function C$4(fe){const ve=fe.ownershipBasedAccessControlForFeatures,_e=fe?fe.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:n$m(fe,"allowGeometryUpdates",!0),supportsGlobalId:n$m(fe,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:n$m(fe,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:n$m(fe,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:n$m(fe,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:n$m(fe,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:n$m(ve,"allowAnonymousToDelete",!0),supportsDeleteByOthers:n$m(ve,"allowOthersToDelete",!0),supportsUpdateByAnonymous:n$m(ve,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:n$m(ve,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:n$m(_e,"supportsAsyncApplyEdits",!1),zDefault:r$5(fe,"zDefault",void 0)}}function g$7(fe){var ve;return{operations:{supportsAppend:n$m(fe,"supportsAppend",!1),supportsExportClip:n$m(fe,"supportsExportClip",!1),supportsExportFrameset:n$m(fe,"supportsExportFrameset",!1),supportsMensuration:n$m(fe,"supportsMensuration",!1),supportsUpdate:n$m(fe,"supportsUpdate",!1)},query:{supportsCoverageQuery:(null==(ve=null==fe?void 0:fe.playbackInfo)?void 0:ve.klv["0601"])??!1}}}let GCe=class c46 extends(i$4F(Pn)){constructor(fe){super(fe),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(fe){if(!fe)return null;const ve={};for(const _e of Object.keys(fe))ve[_e]=i$3h(fe[_e]);return ve}writeDomains(fe,ve){var _e;if(!fe)return;const be={};for(const we of Object.keys(fe))fe[we]&&(be[we]=null==(_e=fe[we])?void 0:_e.toJSON());ve.domains=be}};e$4o([y$2v({type:Number,json:{write:!0}})],GCe.prototype,"code",void 0),e$4o([y$2v({type:Object,json:{write:!0}})],GCe.prototype,"defaultValues",void 0),e$4o([y$2v({json:{write:!0}})],GCe.prototype,"domains",void 0),e$4o([o$40("domains")],GCe.prototype,"readDomains",null),e$4o([r$3s("domains")],GCe.prototype,"writeDomains",null),e$4o([y$2v({type:String,json:{write:!0}})],GCe.prototype,"name",void 0),GCe=e$4o([a$4y("esri.layers.support.Subtype")],GCe);const HCe=GCe,R$1=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(Wa.ofType(SCe)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=zo.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:fe}=this;if(fe){const{query:ve,operations:_e,editing:be}=fe;if(!ve.supportsQueryByOthers||!ve.supportsQueryByAnonymous)return"load";if(_e.supportsEditing&&!(be.supportsUpdateByOthers&&be.supportsUpdateByAnonymous&&be.supportsDeleteByOthers&&be.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(function V$2(fe){var ve,_e,be;let we=null==(ve=fe.sourceJSON)?void 0:ve.cacheMaxAge;if(!we)return!1;const Se=null==(be=null==(_e=fe.editingInfo)?void 0:_e.lastEditDate)?void 0:be.getTime();return null==Se||(we*=1e3,Date.now()-Se<we)}(this))return"load";if(this.hasUpdateItemRestrictions)return fe.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const ve=this.editFieldsInfo;return((null==ve?void 0:ve.creatorField)||(null==ve?void 0:ve.editorField))&&(null==fe?void 0:fe.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(fe,ve){return a$f(ve,this.url)}readEditingInfo(fe,ve){const{editingInfo:_e}=ve;return _e?{lastEditDate:null!=_e.lastEditDate?new Date(_e.lastEditDate):null}:null}get effectiveCapabilities(){const fe=this.capabilities;if(!fe)return null;const ve=a$4H(fe),{operations:_e,editing:be}=ve;return Z$1(this)?(this.userHasUpdateItemPrivileges&&(_e.supportsQuery=!0),ve):this.userHasUpdateItemPrivileges?(_e.supportsAdd=_e.supportsDelete=_e.supportsEditing=_e.supportsQuery=_e.supportsUpdate=be.supportsDeleteByOthers=be.supportsGeometryUpdate=be.supportsUpdateByOthers=!0,ve):(this.userHasFullEditingPrivileges&&_e.supportsEditing&&(_e.supportsAdd=_e.supportsDelete=_e.supportsUpdate=be.supportsGeometryUpdate=!0),ve)}readGlobalIdFieldFromService(fe,ve){return R$2(ve)}get hasFullEditingRestrictions(){const fe=this.capabilities;if(!fe||Z$1(this))return!1;const{operations:ve,editing:_e}=fe;return ve.supportsEditing&&!(ve.supportsAdd&&ve.supportsDelete&&ve.supportsUpdate&&_e.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const fe=this.capabilities;if(!fe)return!1;const{operations:ve,editing:_e}=fe;return Z$1(this)?!ve.supportsQuery:!(ve.supportsAdd&&ve.supportsDelete&&ve.supportsEditing&&ve.supportsQuery&&ve.supportsUpdate&&_e.supportsDeleteByOthers&&_e.supportsGeometryUpdate&&_e.supportsUpdateByOthers)}readIsTableFromService(fe,ve){return"Table"===ve.type}readMaxScale(fe,ve){return ve.effectiveMaxScale||fe||0}readMinScale(fe,ve){return ve.effectiveMinScale||fe||0}readObjectIdFieldFromService(fe,ve){return M$1(ve)}readServiceDefinitionExpression(fe,ve){return ve.definitionQuery||ve.definitionExpression}set url(fe){if(null==fe)return void this._set("url",fe);const ve=S$1k({layer:this,url:fe,nonStandardUrlAllowed:!0,logger:ar.getLogger(this)});this._set("url",ve.url),null!=ve.layerId&&this._set("layerId",ve.layerId)}writeUrl(fe,ve,_e,be){C$15(this,fe,null,ve,be)}readVersion(fe,ve){return function C$5(fe){return fe.currentVersion?fe.currentVersion:fe.hasOwnProperty("capabilities")||fe.hasOwnProperty("drawingInfo")||fe.hasOwnProperty("hasAttachments")||fe.hasOwnProperty("htmlPopupType")||fe.hasOwnProperty("relationships")||fe.hasOwnProperty("timeInfo")||fe.hasOwnProperty("typeIdField")||fe.hasOwnProperty("types")?10:9.3}(ve)}};return e$4o([y$2v({readOnly:!0})],ve.prototype,"authenticationTriggerEvent",null),e$4o([y$2v({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],ve.prototype,"copyright",void 0),e$4o([y$2v({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],ve.prototype,"capabilities",void 0),e$4o([o$40("service","capabilities")],ve.prototype,"readCapabilitiesFromService",null),e$4o([y$2v(c$4q("dateFieldsTimeReference"))],ve.prototype,"dateFieldsTimeZone",void 0),e$4o([y$2v({type:Boolean})],ve.prototype,"datesInUnknownTimezone",void 0),e$4o([y$2v({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],ve.prototype,"definitionExpression",void 0),e$4o([y$2v({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],ve.prototype,"displayField",void 0),e$4o([y$2v({readOnly:!0,type:xCe})],ve.prototype,"editFieldsInfo",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"editingInfo",void 0),e$4o([o$40("editingInfo")],ve.prototype,"readEditingInfo",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"effectiveCapabilities",null),e$4o([y$2v((()=>{const fe=a$4H(rxe),ve=fe.json.origins;return ve["web-map"]={read:!1,write:!1},ve["portal-item"]={read:!1,write:!1},fe})())],ve.prototype,"elevationInfo",void 0),e$4o([y$2v({type:zCe,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:qwe}}}}})],ve.prototype,"floorInfo",void 0),e$4o([y$2v({type:aa,json:{origins:{service:{read:{source:"extent"}}}}})],ve.prototype,"fullExtent",void 0),e$4o([y$2v()],ve.prototype,"gdbVersion",void 0),e$4o([y$2v({readOnly:!0,type:DCe,json:{read:{source:"geometryProperties"}}})],ve.prototype,"geometryFieldsInfo",void 0),e$4o([y$2v({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:RCe.read}}}})],ve.prototype,"geometryType",void 0),e$4o([y$2v({type:String})],ve.prototype,"globalIdField",void 0),e$4o([o$40("service","globalIdField",["globalIdField","fields"])],ve.prototype,"readGlobalIdFieldFromService",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"hasFullEditingRestrictions",null),e$4o([y$2v({type:Boolean,json:{origins:{service:{read:!0}}}})],ve.prototype,"hasM",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"hasUpdateItemRestrictions",null),e$4o([y$2v({type:Boolean,json:{origins:{service:{read:!0}}}})],ve.prototype,"hasZ",void 0),e$4o([y$2v({readOnly:!0,type:Eh})],ve.prototype,"heightModelInfo",void 0),e$4o([y$2v({type:Date})],ve.prototype,"historicMoment",void 0),e$4o([y$2v({type:Wa.ofType(SCe),readOnly:!0})],ve.prototype,"indexes",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"isTable",void 0),e$4o([o$40("service","isTable",["type"])],ve.prototype,"readIsTableFromService",null),e$4o([y$2v({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],ve.prototype,"layerId",void 0),e$4o([y$2v(cxe)],ve.prototype,"maxScale",void 0),e$4o([o$40("service","maxScale",["maxScale","effectiveMaxScale"])],ve.prototype,"readMaxScale",null),e$4o([y$2v(lxe)],ve.prototype,"minScale",void 0),e$4o([o$40("service","minScale",["minScale","effectiveMinScale"])],ve.prototype,"readMinScale",null),e$4o([y$2v({type:String})],ve.prototype,"objectIdField",void 0),e$4o([o$40("service","objectIdField",["objectIdField","fields"])],ve.prototype,"readObjectIdFieldFromService",null),e$4o([y$2v(c$4q("preferredTimeReference"))],ve.prototype,"preferredTimeZone",void 0),e$4o([y$2v({type:[BCe],readOnly:!0})],ve.prototype,"relationships",void 0),e$4o([y$2v({type:Boolean})],ve.prototype,"returnM",void 0),e$4o([y$2v({type:Boolean})],ve.prototype,"returnZ",void 0),e$4o([y$2v({readOnly:!0,json:{write:!1}})],ve.prototype,"serverGens",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"serviceDefinitionExpression",void 0),e$4o([o$40("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],ve.prototype,"readServiceDefinitionExpression",null),e$4o([y$2v({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ve.prototype,"serviceItemId",void 0),e$4o([y$2v()],ve.prototype,"sourceJSON",void 0),e$4o([y$2v({type:zo,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],ve.prototype,"spatialReference",void 0),e$4o([y$2v({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],ve.prototype,"subtypeField",void 0),e$4o([y$2v({type:[HCe],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ve.prototype,"subtypes",void 0),e$4o([y$2v({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],ve.prototype,"trackIdField",void 0),e$4o([y$2v(exe)],ve.prototype,"url",null),e$4o([r$3s("url")],ve.prototype,"writeUrl",null),e$4o([y$2v({json:{origins:{service:{read:!0}},read:!1}})],ve.prototype,"version",void 0),e$4o([o$40("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],ve.prototype,"readVersion",null),ve=e$4o([a$4y("esri.layers.mixins.FeatureLayerBase")],ve),ve};let qCe=class p45 extends(i$4F(Pn)){constructor(fe){super(fe),this.expression=null,this.title=null,this.returnType=null}};e$4o([y$2v({type:String,json:{write:!0}})],qCe.prototype,"expression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],qCe.prototype,"title",void 0),e$4o([y$2v({type:String,json:{write:!0}})],qCe.prototype,"returnType",void 0),qCe=e$4o([a$4y("esri.layers.support.ExpressionInfo")],qCe);const WCe=qCe;var YCe;let ZCe=YCe=class extends Pn{constructor(fe){super(fe),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new YCe({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:a$4H(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};e$4o([y$2v({type:Boolean,json:{write:!0}})],ZCe.prototype,"isAutoGenerated",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ZCe.prototype,"name",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ZCe.prototype,"alias",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ZCe.prototype,"onStatisticField",void 0),e$4o([y$2v({type:WCe,json:{write:!0}})],ZCe.prototype,"onStatisticExpression",void 0),e$4o([y$2v({type:String,json:{write:!0}})],ZCe.prototype,"statisticType",void 0),ZCe=YCe=e$4o([a$4y("esri.layers.support.AggregateField")],ZCe);const XCe=ZCe;let JCe=class t81 extends Pn{constructor(){super(...arguments),this.type=null}};var QCe;e$4o([y$2v({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],JCe.prototype,"type",void 0),JCe=e$4o([a$4y("esri.layers.support.FeatureReduction")],JCe);let KCe=QCe=class extends Pn{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(fe,ve){return ve.value?E$X(ve.value):fe}writeExpression(fe,ve,_e){null!=this.value&&(fe=E$X(this.value)),null!=fe&&(ve[_e]=fe)}clone(){return new QCe({expression:this.expression,title:this.title,value:this.value})}};e$4o([y$2v({type:String,json:{write:{writerEnsuresNonNull:!0}}})],KCe.prototype,"expression",void 0),e$4o([o$40("expression",["expression","value"])],KCe.prototype,"readExpression",null),e$4o([r$3s("expression")],KCe.prototype,"writeExpression",null),e$4o([y$2v({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],KCe.prototype,"title",void 0),e$4o([y$2v({json:{read:!1,write:!1}})],KCe.prototype,"value",void 0),KCe=QCe=e$4o([a$4y("esri.layers.support.LabelExpressionInfo")],KCe);const eOe=KCe;var tOe;const rOe=new An({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function P$2(fe,ve,_e){return{enabled:!b$1W(null==_e?void 0:_e.layer)}}function x$1(fe){var ve;return!fe||"service"!==fe.origin&&!("map-image"===(null==(ve=fe.layer)?void 0:ve.type))}function E$2(fe){var ve,_e;return!!function g$6(fe){return"map-image"===(null==fe?void 0:fe.type)}(fe)&&!!(null==(_e=null==(ve=fe.capabilities)?void 0:ve.exportMap)?void 0:_e.supportsArcadeExpressionForLabeling)}let iOe=tOe=class extends Pn{static evaluateWhere(fe,ve){const t84=(fe,ve,_e)=>{switch(ve){case"=":return fe==_e;case"<>":return fe!=_e;case">":return fe>_e;case">=":return fe>=_e;case"<":return fe<_e;case"<=":return fe<=_e}return!1};try{if(null==fe)return!0;const _e=fe.split(" ");if(3===_e.length)return t84(ve[_e[0]],_e[1],_e[2]);if(7===_e.length){const fe=t84(ve[_e[0]],_e[1],_e[2]),be=_e[3],we=t84(ve[_e[4]],_e[5],_e[6]);switch(be){case"AND":return fe&&we;case"OR":return fe||we}}return!1}catch(xv){}}constructor(fe){super(fe),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=$8,this.useCodedValues=void 0,this.where=null}readLabelExpression(fe,ve){const _e=ve.labelExpressionInfo;if(!_e||!_e.value&&!_e.expression)return fe}writeLabelExpression(fe,ve,_e){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)fe=function u$24(fe){return fe.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const ve=_$L(this.labelExpressionInfo.expression);ve&&(fe="["+ve+"]")}null!=fe&&(ve[_e]=fe)}writeLabelExpressionInfo(fe,ve,_e,be){if(null==fe&&null!=this.labelExpression&&x$1(be))fe=new eOe({expression:this.getLabelExpressionArcade()});else if(!fe)return;const we=fe.toJSON(be);we.expression&&(ve[_e]=we)}writeMaxScale(fe,ve){(fe||this.minScale)&&(ve.maxScale=fe)}writeMinScale(fe,ve){(fe||this.maxScale)&&(ve.minScale=fe)}getLabelExpression(){return x$U(this)}getLabelExpressionArcade(){return function f$1M(fe){const ve=x$U(fe);if(!ve)return null;switch(ve.type){case"conventional":return E$X(ve.expression);case"arcade":return ve.expression}return null}(this)}getLabelExpressionSingleField(){return g$1j(this)}hash(){return JSON.stringify(this)}clone(){return new tOe({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:a$4H(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:a$4H(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};e$4o([y$2v({type:String,json:{write:!0}})],iOe.prototype,"name",void 0),e$4o([y$2v({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:P$2}}}}})],iOe.prototype,"allowOverrun",void 0),e$4o([y$2v({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:P$2}}}}})],iOe.prototype,"deconflictionStrategy",void 0),e$4o([y$2v({type:String,json:{write:{overridePolicy(fe,ve,_e){return this.labelExpressionInfo&&"service"===(null==_e?void 0:_e.origin)&&E$2(_e.layer)?{enabled:!1}:{allowNull:!0}}}}})],iOe.prototype,"labelExpression",void 0),e$4o([o$40("labelExpression")],iOe.prototype,"readLabelExpression",null),e$4o([r$3s("labelExpression")],iOe.prototype,"writeLabelExpression",null),e$4o([y$2v({type:eOe,json:{write:{overridePolicy:(fe,ve,_e)=>function j$2(fe){return x$1(fe)||E$2(null==fe?void 0:fe.layer)}(_e)?{allowNull:!0}:{enabled:!1}}}})],iOe.prototype,"labelExpressionInfo",void 0),e$4o([r$3s("labelExpressionInfo")],iOe.prototype,"writeLabelExpressionInfo",null),e$4o([y$2v({type:rOe.apiValues,json:{type:rOe.jsonValues,read:rOe.read,write:rOe.write}})],iOe.prototype,"labelPlacement",void 0),e$4o([y$2v({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],iOe.prototype,"labelPosition",void 0),e$4o([y$2v({type:Number})],iOe.prototype,"maxScale",void 0),e$4o([r$3s("maxScale")],iOe.prototype,"writeMaxScale",null),e$4o([y$2v({type:Number})],iOe.prototype,"minScale",void 0),e$4o([r$3s("minScale")],iOe.prototype,"writeMinScale",null),e$4o([y$2v({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:P$2}}}}})],iOe.prototype,"repeatLabel",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:P$2}}}}})],iOe.prototype,"repeatLabelDistance",void 0),e$4o([y$2v({types:ET,json:{origins:{"web-scene":{types:CT,write:i$1w,default:null}},write:i$1w,default:null}})],iOe.prototype,"symbol",void 0),e$4o([y$2v({type:Boolean,json:{write:!0}})],iOe.prototype,"useCodedValues",void 0),e$4o([y$2v({type:String,json:{write:!0}})],iOe.prototype,"where",void 0),iOe=tOe=e$4o([a$4y("esri.layers.support.LabelClass")],iOe);const nOe=iOe;var sOe;let oOe=sOe=class extends JCe{constructor(fe){super(fe),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=o$3L("12px"),this.fields=[],this.renderer=null}writeFields(fe,ve,_e){e$4h(_e,fe.filter((fe=>"avg_angle"!==fe.statisticType)).map((fe=>fe.toJSON())),ve)}readRenderer(fe,ve,_e){var be;const we=null==(be=ve.drawingInfo)?void 0:be.renderer;return we?o$a(we,ve,_e)??void 0:U$3(ve,_e)}clone(){return new sOe({fields:a$4H(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:a$4H(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:a$4H(this.popupTemplate),renderer:a$4H(this.renderer),binType:a$4H(this.binType),size:this.size})}};e$4o([o$3g({binning:"binning"})],oOe.prototype,"type",void 0),e$4o([o$3g({geohash:"geohash",square:"square"}),y$2v({type:["geohash","square"]})],oOe.prototype,"binType",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],oOe.prototype,"fixedBinLevel",void 0),e$4o([y$2v({type:[nOe],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],oOe.prototype,"labelingInfo",void 0),e$4o([y$2v(Kwe)],oOe.prototype,"labelsVisible",void 0),e$4o([y$2v({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],oOe.prototype,"maxScale",void 0),e$4o([y$2v(Qwe)],oOe.prototype,"popupEnabled",void 0),e$4o([y$2v({type:ew,json:{name:"popupInfo",write:!0}})],oOe.prototype,"popupTemplate",void 0),e$4o([y$2v({type:Number,cast:fe=>"auto"===fe?fe:o$3L(fe)})],oOe.prototype,"size",void 0),e$4o([y$2v({type:[XCe],json:{write:!0}})],oOe.prototype,"fields",void 0),e$4o([r$3s("fields")],oOe.prototype,"writeFields",null),e$4o([y$2v({types:BEe,json:{write:{target:"drawingInfo.renderer"}}})],oOe.prototype,"renderer",void 0),e$4o([o$40("renderer",["drawingInfo.renderer"])],oOe.prototype,"readRenderer",null),oOe=sOe=e$4o([a$4y("esri.layers.support.FeatureReductionBinning")],oOe);const aOe=oOe;var lOe;function S$1(fe){var ve;return"simple"===fe.type&&!(null==(ve=fe.visualVariables)?void 0:ve.length)}let cOe=lOe=class extends Pn{constructor(fe){super(fe),this.type="cluster",this.clusterRadius=o$3L("80px"),this.clusterMinSize=o$3L("12px"),this.clusterMaxSize=o$3L("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(fe,ve,_e){var be,we;const Se=null==(be=ve.drawingInfo)?void 0:be.renderer;return(null==(we=null==Se?void 0:Se.authoringInfo)?void 0:we.isAutoGenerated)?null:Se?S$1(Se)?null:o$a(Se,ve,_e)??void 0:U$3(ve,_e)}readSymbol(fe,ve,_e){var be,we;const Se=null==(be=ve.drawingInfo)?void 0:be.renderer;if(null==(we=null==Se?void 0:Se.authoringInfo)?void 0:we.isAutoGenerated)return null;if(Se&&S$1(Se)){const fe=o$a(Se,ve,_e);return null==fe?void 0:fe.symbol}return null}writeSymbol(fe,ve,_e,be){var we,Se;const Te=null==(Se=null==(we=this.renderer)?void 0:we.authoringInfo)?void 0:Se.isAutoGenerated;if(!this.renderer||Te){const _e=new SEe({symbol:fe});ve.drawingInfo={renderer:_e.write({},be)}}}writeFields(fe,ve,_e){e$4h(_e,fe.filter((fe=>"avg_angle"!==fe.statisticType)).map((fe=>fe.toJSON())),ve)}readFields(fe,ve,_e){return fe.filter((fe=>!fe.isAutoGenerated)).map((fe=>XCe.fromJSON(fe)))}clone(){return new lOe({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:a$4H(this.labelingInfo),labelsVisible:this.labelsVisible,fields:a$4H(this.fields),maxScale:this.maxScale,renderer:a$4H(this.renderer),symbol:a$4H(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:a$4H(this.popupTemplate)})}};e$4o([y$2v({type:["cluster"],readOnly:!0,json:{write:!0}})],cOe.prototype,"type",void 0),e$4o([y$2v({type:Number,cast:fe=>"auto"===fe?fe:o$3L(fe),json:{write:!0}})],cOe.prototype,"clusterRadius",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],cOe.prototype,"clusterMinSize",void 0),e$4o([y$2v({type:Number,cast:o$3L,json:{write:!0}})],cOe.prototype,"clusterMaxSize",void 0),e$4o([y$2v({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],cOe.prototype,"maxScale",void 0),e$4o([y$2v(Qwe)],cOe.prototype,"popupEnabled",void 0),e$4o([y$2v({type:ew,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],cOe.prototype,"popupTemplate",void 0),e$4o([y$2v({types:BEe,json:{write:{target:"drawingInfo.renderer"}}})],cOe.prototype,"renderer",void 0),e$4o([o$40("renderer",["drawingInfo.renderer"])],cOe.prototype,"readRenderer",null),e$4o([y$2v({types:xT})],cOe.prototype,"symbol",void 0),e$4o([o$40("symbol",["drawingInfo.renderer"])],cOe.prototype,"readSymbol",null),e$4o([r$3s("symbol")],cOe.prototype,"writeSymbol",null),e$4o([y$2v({type:[nOe],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],cOe.prototype,"labelingInfo",void 0),e$4o([y$2v(Kwe)],cOe.prototype,"labelsVisible",void 0),e$4o([y$2v({type:[XCe],json:{write:!0}})],cOe.prototype,"fields",void 0),e$4o([r$3s("fields")],cOe.prototype,"writeFields",null),e$4o([o$40("fields")],cOe.prototype,"readFields",null),cOe=lOe=e$4o([a$4y("esri.layers.support.FeatureReductionCluster")],cOe);const uOe=cOe;var hOe;let dOe=hOe=class extends JCe{constructor(fe){super(fe),this.type="selection"}clone(){return new hOe}};e$4o([y$2v({type:["selection"]})],dOe.prototype,"type",void 0),dOe=hOe=e$4o([a$4y("esri.layers.support.FeatureReductionSelection")],dOe);const pOe=dOe,fOe={key:"type",base:JCe,typeMap:{cluster:uOe,binning:aOe}},mOe={types:{key:"type",base:JCe,typeMap:{selection:pOe,cluster:uOe,binning:aOe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:fOe},"portal-item":{types:fOe},"web-scene":{types:{key:"type",base:JCe,typeMap:{selection:pOe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:qwe}}}}},yOe={Base64:0,Hex:1,String:2,Raw:3},gOe=8,vOe=(1<<gOe)-1;function e$5(fe,ve){const _e=(65535&fe)+(65535&ve);return(fe>>16)+(ve>>16)+(_e>>16)<<16|65535&_e}function i$d(fe,ve,_e,be,we,Se){return e$5(function s$8(fe,ve){return fe<<ve|fe>>>32-ve}(e$5(e$5(ve,fe),e$5(be,Se)),we),_e)}function h$4(fe,ve,_e,be,we,Se,Te){return i$d(ve&_e|~ve&be,fe,ve,we,Se,Te)}function a$c(fe,ve,_e,be,we,Se,Te){return i$d(ve&be|_e&~be,fe,ve,we,Se,Te)}function l$f(fe,ve,_e,be,we,Se,Te){return i$d(ve^_e^be,fe,ve,we,Se,Te)}function g$3(fe,ve,_e,be,we,Se,Te){return i$d(_e^(ve|~be),fe,ve,we,Se,Te)}function x15(fe,ve=yOe.Hex){const _e=ve||yOe.Base64,be=function p$l(fe,ve){fe[ve>>5]|=128<<ve%32,fe[14+(ve+64>>>9<<4)]=ve;let _e=1732584193,be=-271733879,we=-1732584194,Se=271733878;for(let Te=0;Te<fe.length;Te+=16){const ve=_e,Ee=be,Ce=we,Oe=Se;_e=h$4(_e,be,we,Se,fe[Te],7,-680876936),Se=h$4(Se,_e,be,we,fe[Te+1],12,-389564586),we=h$4(we,Se,_e,be,fe[Te+2],17,606105819),be=h$4(be,we,Se,_e,fe[Te+3],22,-1044525330),_e=h$4(_e,be,we,Se,fe[Te+4],7,-176418897),Se=h$4(Se,_e,be,we,fe[Te+5],12,1200080426),we=h$4(we,Se,_e,be,fe[Te+6],17,-1473231341),be=h$4(be,we,Se,_e,fe[Te+7],22,-45705983),_e=h$4(_e,be,we,Se,fe[Te+8],7,1770035416),Se=h$4(Se,_e,be,we,fe[Te+9],12,-1958414417),we=h$4(we,Se,_e,be,fe[Te+10],17,-42063),be=h$4(be,we,Se,_e,fe[Te+11],22,-1990404162),_e=h$4(_e,be,we,Se,fe[Te+12],7,1804603682),Se=h$4(Se,_e,be,we,fe[Te+13],12,-40341101),we=h$4(we,Se,_e,be,fe[Te+14],17,-1502002290),be=h$4(be,we,Se,_e,fe[Te+15],22,1236535329),_e=a$c(_e,be,we,Se,fe[Te+1],5,-165796510),Se=a$c(Se,_e,be,we,fe[Te+6],9,-1069501632),we=a$c(we,Se,_e,be,fe[Te+11],14,643717713),be=a$c(be,we,Se,_e,fe[Te],20,-373897302),_e=a$c(_e,be,we,Se,fe[Te+5],5,-701558691),Se=a$c(Se,_e,be,we,fe[Te+10],9,38016083),we=a$c(we,Se,_e,be,fe[Te+15],14,-660478335),be=a$c(be,we,Se,_e,fe[Te+4],20,-405537848),_e=a$c(_e,be,we,Se,fe[Te+9],5,568446438),Se=a$c(Se,_e,be,we,fe[Te+14],9,-1019803690),we=a$c(we,Se,_e,be,fe[Te+3],14,-187363961),be=a$c(be,we,Se,_e,fe[Te+8],20,1163531501),_e=a$c(_e,be,we,Se,fe[Te+13],5,-1444681467),Se=a$c(Se,_e,be,we,fe[Te+2],9,-51403784),we=a$c(we,Se,_e,be,fe[Te+7],14,1735328473),be=a$c(be,we,Se,_e,fe[Te+12],20,-1926607734),_e=l$f(_e,be,we,Se,fe[Te+5],4,-378558),Se=l$f(Se,_e,be,we,fe[Te+8],11,-2022574463),we=l$f(we,Se,_e,be,fe[Te+11],16,1839030562),be=l$f(be,we,Se,_e,fe[Te+14],23,-35309556),_e=l$f(_e,be,we,Se,fe[Te+1],4,-1530992060),Se=l$f(Se,_e,be,we,fe[Te+4],11,1272893353),we=l$f(we,Se,_e,be,fe[Te+7],16,-155497632),be=l$f(be,we,Se,_e,fe[Te+10],23,-1094730640),_e=l$f(_e,be,we,Se,fe[Te+13],4,681279174),Se=l$f(Se,_e,be,we,fe[Te],11,-358537222),we=l$f(we,Se,_e,be,fe[Te+3],16,-722521979),be=l$f(be,we,Se,_e,fe[Te+6],23,76029189),_e=l$f(_e,be,we,Se,fe[Te+9],4,-640364487),Se=l$f(Se,_e,be,we,fe[Te+12],11,-421815835),we=l$f(we,Se,_e,be,fe[Te+15],16,530742520),be=l$f(be,we,Se,_e,fe[Te+2],23,-995338651),_e=g$3(_e,be,we,Se,fe[Te],6,-198630844),Se=g$3(Se,_e,be,we,fe[Te+7],10,1126891415),we=g$3(we,Se,_e,be,fe[Te+14],15,-1416354905),be=g$3(be,we,Se,_e,fe[Te+5],21,-57434055),_e=g$3(_e,be,we,Se,fe[Te+12],6,1700485571),Se=g$3(Se,_e,be,we,fe[Te+3],10,-1894986606),we=g$3(we,Se,_e,be,fe[Te+10],15,-1051523),be=g$3(be,we,Se,_e,fe[Te+1],21,-2054922799),_e=g$3(_e,be,we,Se,fe[Te+8],6,1873313359),Se=g$3(Se,_e,be,we,fe[Te+15],10,-30611744),we=g$3(we,Se,_e,be,fe[Te+6],15,-1560198380),be=g$3(be,we,Se,_e,fe[Te+13],21,1309151649),_e=g$3(_e,be,we,Se,fe[Te+4],6,-145523070),Se=g$3(Se,_e,be,we,fe[Te+11],10,-1120210379),we=g$3(we,Se,_e,be,fe[Te+2],15,718787259),be=g$3(be,we,Se,_e,fe[Te+9],21,-343485551),_e=e$5(_e,ve),be=e$5(be,Ee),we=e$5(we,Ce),Se=e$5(Se,Oe)}return[_e,be,we,Se]}(function o$5(fe){const ve=[];for(let _e=0,be=fe.length*gOe;_e<be;_e+=gOe)ve[_e>>5]|=(fe.charCodeAt(_e/gOe)&vOe)<<_e%32;return ve}(fe),fe.length*gOe);switch(_e){case yOe.Raw:return be;case yOe.Hex:return function c$i(fe){const ve="0123456789abcdef",_e=[];for(let be=0,we=4*fe.length;be<we;be++)_e.push(ve.charAt(fe[be>>2]>>be%4*8+4&15)+ve.charAt(fe[be>>2]>>be%4*8&15));return _e.join("")}(be);case yOe.String:return function u$c(fe){const ve=[];for(let _e=0,be=32*fe.length;_e<be;_e+=gOe)ve.push(String.fromCharCode(fe[_e>>5]>>>_e%32&vOe));return ve.join("")}(be);case yOe.Base64:return function f$9(fe){const ve=[];for(let _e=0,be=4*fe.length;_e<be;_e+=3){const be=(fe[_e>>2]>>_e%4*8&255)<<16|(fe[_e+1>>2]>>(_e+1)%4*8&255)<<8|fe[_e+2>>2]>>(_e+2)%4*8&255;for(let we=0;we<4;we++)8*_e+6*we>32*fe.length?ve.push("="):ve.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(be>>6*(3-we)&63))}return ve.join("")}(be)}}has.add("esri-cluster-arcade-enabled",!0);const _Oe=has("esri-cluster-arcade-enabled"),$Oe=new Set(["simple-line","simple-fill","picture-fill"]);function d$8(fe,ve){let _e=ve.clone();if(!c$h(_e))return _e;if(ve.getSymbols().some((fe=>$Oe.has(fe.type)))&&(_e=new SEe({symbol:new dT})),_e.authoringInfo||(_e.authoringInfo=new VSe),_e.authoringInfo.isAutoGenerated=!0,"visualVariables"in _e){const ve=(_e.visualVariables||[]).filter((fe=>"$view.scale"!==fe.valueExpression));ve.forEach((ve=>{"rotation"===ve.type?ve.field?ve.field=g$2(fe,ve.field,"avg_angle","number"):ve.valueExpression&&(ve.field=b$1(fe,ve.valueExpression,"avg_angle","number"),ve.valueExpression=null):ve.normalizationField?(ve.field=g$2(fe,ve.field,"avg_norm","number",ve.normalizationField),ve.normalizationField=null):ve.field?ve.field=g$2(fe,ve.field,"avg","number"):ve.valueExpression&&(ve.field=b$1(fe,ve.valueExpression,"avg","number"),ve.valueExpression=null)})),_e.visualVariables=ve}switch(_e.type){case"simple":break;case"pie-chart":for(const ve of _e.attributes)ve.field?ve.field=g$2(fe,ve.field,"sum","number"):ve.valueExpression&&(ve.field=b$1(fe,ve.valueExpression,"sum","number"),ve.valueExpression=null);break;case"unique-value":_e.field?_e.field=g$2(fe,_e.field,"mode","string"):_e.valueExpression&&(_e.field=b$1(fe,_e.valueExpression,"mode","string"),_e.valueExpression=null);break;case"class-breaks":_e.normalizationField?(_e.field=g$2(fe,_e.field,"avg_norm","number",_e.normalizationField),_e.normalizationField=null):_e.field?_e.field=g$2(fe,_e.field,"avg","number"):_e.valueExpression&&(_e.field=b$1(fe,_e.valueExpression,"avg","number"),_e.valueExpression=null)}return _e}const c$h=fe=>{const r65=ve=>ar.getLogger("esri.views.2d.layers.support.clusterUtils").error(new Ir("Unsupported-renderer",ve,{renderer:fe}));if(!fe)return!1;switch(fe.type){case"unique-value":if(fe.field2||fe.field3)return r65("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(fe.normalizationField){const ve=fe.normalizationType;if("field"!==ve)return r65(`FeatureReductionCluster does not support a normalizationType of ${ve}`),!1}break;case"simple":case"pie-chart":break;default:return r65(`FeatureReductionCluster does not support renderers of type ${fe.type}`),!1}if(!_Oe){if("valueExpression"in fe&&fe.valueExpression)return r65("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in fe&&fe.visualVariables||[]).some((fe=>!(!("valueExpression"in fe)||!fe.valueExpression))))return r65("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function b$1(fe,ve,_e,be){const we=x15(ve),Se="mode"===_e?`cluster_type_${we}`:"sum"===_e?`cluster_sum_${we}`:`cluster_avg_${we}`;return fe.some((fe=>fe.name===Se))||fe.push(new XCe({name:Se,isAutoGenerated:!0,onStatisticExpression:new WCe({expression:ve,returnType:be}),statisticType:_e})),Se}function g$2(fe,ve,_e,be,we){if("cluster_count"===ve||fe.some((fe=>fe.name===ve)))return ve;const Se=function v$2(fe,ve,_e){switch(fe){case"sum":return`cluster_sum_${ve}`;case"avg":case"avg_angle":return`cluster_avg_${ve}`;case"mode":return`cluster_type_${ve}`;case"avg_norm":{const fe=_e,be="field";return"cluster_avg_"+x15(ve.toLowerCase()+",norm:"+be+","+fe.toLowerCase())}}}(_e,ve,we);return fe.some((fe=>fe.name===Se))||("avg_norm"===_e?fe.push(new XCe({name:Se,isAutoGenerated:!0,onStatisticExpression:new WCe({expression:`$feature.${ve} / $feature.${we}`,returnType:be}),statisticType:"avg"})):fe.push(new XCe({name:Se,isAutoGenerated:!0,onStatisticField:ve,statisticType:_e}))),Se}const c$g=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.addHandles(d$3d((()=>this.renderer),(()=>{if(this.featureReduction){const fe=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",fe)}}),Za))}set featureReduction(fe){const ve=this._normalizeFeatureReduction(fe);this._set("featureReduction",ve)}set renderer(fe){}_withClusterVariable(fe,ve,_e){const be=fe.clone();return"visualVariables"in be&&(be.visualVariables||(be.visualVariables=[]),be.visualVariables.some((fe=>"size"===fe.type))||be.visualVariables.push(new TTe({field:"cluster_count",stops:[new gTe({value:1}),new gTe({useMinValue:!0,size:ve}),new gTe({useMaxValue:!0,size:_e})]}))),be}_normalizeFeatureReduction(fe){var ve;if("cluster"!==(null==fe?void 0:fe.type))return fe;const _e=fe.clone(),be=[new XCe({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],we=(_e.fields??[]).filter((fe=>!fe.isAutoGenerated)),Se=fe.renderer&&!(null==(ve=fe.renderer.authoringInfo)?void 0:ve.isAutoGenerated),{clusterMinSize:Te,clusterMaxSize:Ee}=_e;if(Se){_e.fields=[...be,...we];const fe=this._withClusterVariable(_e.renderer,Te,Ee);return _e.effectiveFeatureRenderer=fe,_e.effectiveClusterRenderer=fe,_e}if(fe.symbol){if(_e.fields=[...be,...we],_e.renderer=null,!this.renderer)return _e.effectiveFeatureRenderer=null,_e.effectiveClusterRenderer=null,_e;const ve=d$8(be,this.renderer),Se=this._withClusterVariable(ve,Te,Ee),Ce="visualVariables"in Se&&Se.visualVariables?Se.visualVariables:[],Oe=new SEe({symbol:fe.symbol,visualVariables:Ce});return _e.fields=[...be,...we],_e.effectiveFeatureRenderer=Se,_e.effectiveClusterRenderer=Oe,_e}if(!this.renderer)return fe;const Ce=d$8(be,this.renderer);_e.fields=[...be,...we],_e.renderer=Ce;const Oe=this._withClusterVariable(Ce,Te,Ee);return _e.effectiveFeatureRenderer=Oe,_e.effectiveClusterRenderer=Oe,_e}};return e$4o([y$2v(mOe)],ve.prototype,"featureReduction",null),ve=e$4o([a$4y("esri.layers.mixins.FeatureReductionLayer")],ve),ve};var bOe;const wOe=new An({asc:"ascending",desc:"descending"});let xOe=bOe=class extends Pn{constructor(fe){super(fe),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new bOe({field:this.field,valueExpression:this.valueExpression,order:this.order})}};e$4o([y$2v({type:String,json:{write:!0}})],xOe.prototype,"field",void 0),e$4o([y$2v({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],xOe.prototype,"valueExpression",void 0),e$4o([y$2v({type:wOe.apiValues,json:{type:wOe.jsonValues,read:wOe.read,write:wOe.write}})],xOe.prototype,"order",void 0),xOe=bOe=e$4o([a$4y("esri.layers.support.OrderByInfo")],xOe);const SOe=xOe;const TOe={type:[SOe],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:function i$b(fe,ve,_e){if(!fe)return null;const be=fe.find((fe=>!!fe.field));if(!be)return null;const we=new SOe;return we.read(be,_e),[we]}},write:{writer:function n$f(fe,ve,_e,be){const we=fe.find((fe=>!!fe.field));we&&e$4h(_e,[we.toJSON()],ve)}}}},p$i=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.orderBy=null}};return e$4o([y$2v(TOe)],ve.prototype,"orderBy",void 0),ve=e$4o([a$4y("esri.layers.mixins.OrderedLayer")],ve),ve};let EOe=class e74 extends zi{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};e$4o([y$2v()],EOe.prototype,"updating",void 0),e$4o([y$2v()],EOe.prototype,"status",void 0),EOe=e$4o([a$4y("esri.layers.support.PublishingInfo")],EOe);const POe=EOe,COe=Symbol(),n$e=fe=>{var ve;let _e=class extends fe{constructor(){super(...arguments),this[ve]=!0}get publishingInfo(){if(this.destroyed)return null;const fe=this._get("publishingInfo");if(fe)return fe;const ve=new POe;return this._checkPublishingStatus(ve),ve}_checkPublishingStatus(fe){let ve=0;const o39=async be=>{let we;fe.updating=!0;try{we=await this.fetchPublishingStatus()}catch(Se){we="unavailable"}"published"!==we&&"unavailable"!==we||("publishing"===fe.status&&this.refresh(),_e.remove()),fe.status=we,fe.updating=!1,_e.removed||(ve=setTimeout(o39,be,be+125))},_e={removed:!1,remove(){this.removed=!0,clearTimeout(ve)}};this.when().catch((()=>_e.remove())),o39(250),this.addHandles(_e)}};return ve=COe,e$4o([y$2v({readOnly:!0,clonable:!1})],_e.prototype,"publishingInfo",null),_e=e$4o([a$4y("esri.layers.mixins.PublishableLayer")],_e),_e},OOe=new Wa,AOe=new WeakMap;function c$e(fe,ve){return Number.isFinite(fe)&&Number.isFinite(ve)?ve<=0?fe:c$e(ve,fe%ve):0}let MOe=0,ROe=0;function a$a(){const fe=Date.now();let ve=!1;for(const _e of OOe){const be=_e.deref();be?be.refreshInterval&&fe-(AOe.get(be)??0)+5>=6e4*be.refreshInterval&&(AOe.set(be,fe),be.refresh(fe)):ve=!0}if(ve)for(let _e=OOe.length-1;_e>=0;_e--)OOe.at(_e).deref()||OOe.removeAt(_e)}function m$a(fe){return null!=fe&&"object"==typeof fe&&"refreshTimestamp"in fe&&"refresh"in fe}i$4J((()=>{const fe=Date.now();let ve=0;for(const _e of OOe){const be=_e.deref();be&&(ve=c$e(Math.round(6e4*be.refreshInterval),ve),be.refreshInterval?AOe.get(be)||AOe.set(be,fe):AOe.delete(be))}if(ve!==ROe){if(ROe=ve,clearInterval(MOe),0===ROe)return void(MOe=0);MOe=setInterval(a$a,ROe)}}));const f$7=fe=>{let ve=class extends fe{constructor(...fe){super(...fe),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=k$1C((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function n$d(fe){(function f$8(fe){return null!=fe&&"object"==typeof fe&&"refreshInterval"in fe&&"refresh"in fe})(fe)&&OOe.push(new WeakRef(fe))}(this)}),(()=>{}))}destroy(){!function s$7(fe){const ve=OOe.find((ve=>ve.deref()===fe));ve&&OOe.remove(ve)}(this)}castRefreshInterval(fe){return fe>=.1?fe:fe<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(fe=Date.now()){d$3z(this._debounceHasDataChanged()).then((ve=>{ve&&this._set("refreshTimestamp",fe),this.emit("refresh",{dataChanged:ve})}),(fe=>{ar.getLogger(this).error(fe),this.emit("refresh",{dataChanged:!1,error:fe})}))}async hasDataChanged(){return!0}get test(){}};return e$4o([y$2v({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:qwe}}}}})],ve.prototype,"refreshInterval",void 0),e$4o([s$4b("refreshInterval")],ve.prototype,"castRefreshInterval",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"refreshTimestamp",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"refreshParameters",null),ve=e$4o([a$4y("esri.layers.mixins.RefreshableLayer")],ve),ve},IOe=i$4y()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let LOe=class m36 extends(i$4F(Pn)){constructor(fe){super(fe),this.unit="milliseconds",this.value=0}toMilliseconds(){return m$2W(this.value,this.unit,"milliseconds")}};e$4o([o$3g(IOe,{nonNullable:!0})],LOe.prototype,"unit",void 0),e$4o([y$2v({type:Number,json:{write:!0},nonNullable:!0})],LOe.prototype,"value",void 0),LOe=e$4o([a$4y("esri.TimeInterval")],LOe);const DOe=LOe;function p$g(fe,ve){return DOe.fromJSON({value:fe,unit:ve})}let NOe=class u27 extends(i$4F(Pn)){constructor(fe){super(fe),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(fe,ve){return ve.timeExtent&&Array.isArray(ve.timeExtent)&&2===ve.timeExtent.length?j_.fromArray(ve.timeExtent):null}writeFullTimeExtent(fe,ve){null!=(null==fe?void 0:fe.start)&&null!=fe.end?ve.timeExtent=fe.toArray():ve.timeExtent=null}readInterval(fe,ve){return ve.timeInterval&&ve.timeIntervalUnits?p$g(ve.timeInterval,ve.timeIntervalUnits):ve.defaultTimeInterval&&ve.defaultTimeIntervalUnits?p$g(ve.defaultTimeInterval,ve.defaultTimeIntervalUnits):null}writeInterval(fe,ve){ve.timeInterval=(null==fe?void 0:fe.toJSON().value)??null,ve.timeIntervalUnits=(null==fe?void 0:fe.toJSON().unit)??null}};e$4o([y$2v({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],NOe.prototype,"cumulative",void 0),e$4o([y$2v({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],NOe.prototype,"endField",void 0),e$4o([y$2v({type:j_,json:{write:{enabled:!0,allowNull:!0}}})],NOe.prototype,"fullTimeExtent",void 0),e$4o([o$40("fullTimeExtent",["timeExtent"])],NOe.prototype,"readFullTimeExtent",null),e$4o([r$3s("fullTimeExtent")],NOe.prototype,"writeFullTimeExtent",null),e$4o([y$2v({type:Boolean,json:{write:!0}})],NOe.prototype,"hasLiveData",void 0),e$4o([y$2v({type:DOe,json:{write:{enabled:!0,allowNull:!0}}})],NOe.prototype,"interval",void 0),e$4o([o$40("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],NOe.prototype,"readInterval",null),e$4o([r$3s("interval")],NOe.prototype,"writeInterval",null),e$4o([y$2v({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],NOe.prototype,"startField",void 0),e$4o([y$2v(c$4q("timeReference",!0))],NOe.prototype,"timeZone",void 0),e$4o([y$2v({type:String,json:{write:{enabled:!0,allowNull:!0}}})],NOe.prototype,"trackIdField",void 0),e$4o([y$2v({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],NOe.prototype,"useTime",void 0),e$4o([y$2v({type:[Date],json:{read:!1}})],NOe.prototype,"stops",void 0),NOe=e$4o([a$4y("esri.layers.support.TimeInfo")],NOe);const FOe=NOe,zOe={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:qwe}}},l$b=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(fe,ve){const _e=ve.timeInfo.exportOptions;if(!_e)return null;const be=_e.timeOffset,we=IOe.fromJSON(_e.timeOffsetUnits);return be&&we?new DOe({value:be,unit:we}):null}set timeInfo(fe){g$1X(fe,this.fieldsIndex),this._set("timeInfo",fe)}};return e$4o([y$2v({type:j_,json:{write:!1}})],ve.prototype,"timeExtent",void 0),e$4o([y$2v({type:DOe})],ve.prototype,"timeOffset",void 0),e$4o([o$40("service","timeOffset",["timeInfo.exportOptions"])],ve.prototype,"readOffset",null),e$4o([y$2v({value:null,type:FOe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ve.prototype,"timeInfo",null),e$4o([y$2v(zOe)],ve.prototype,"useViewTime",void 0),ve=e$4o([a$4y("esri.layers.mixins.TemporalLayer")],ve),ve},kOe=new An({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let UOe=class a52 extends(i$4F(Pn)){constructor(fe){super(fe),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};e$4o([y$2v({json:{write:!0}})],UOe.prototype,"name",void 0),e$4o([y$2v({json:{write:!0}})],UOe.prototype,"description",void 0),e$4o([y$2v({json:{read:kOe.read,write:kOe.write}})],UOe.prototype,"drawingTool",void 0),e$4o([y$2v({json:{write:!0}})],UOe.prototype,"prototype",void 0),e$4o([y$2v({json:{write:!0}})],UOe.prototype,"thumbnail",void 0),UOe=e$4o([a$4y("esri.layers.support.FeatureTemplate")],UOe);const VOe=UOe;let BOe=class c47 extends(i$4F(Pn)){constructor(fe){super(fe),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(fe){const ve={};for(const _e of Object.keys(fe))ve[_e]=i$3h(fe[_e]);return ve}writeDomains(fe,ve){var _e;const be={};for(const we of Object.keys(fe))fe[we]&&(be[we]=null==(_e=fe[we])?void 0:_e.toJSON());ve.domains=be}};e$4o([y$2v({json:{write:!0}})],BOe.prototype,"id",void 0),e$4o([y$2v({json:{write:!0}})],BOe.prototype,"name",void 0),e$4o([y$2v({json:{write:!0}})],BOe.prototype,"domains",void 0),e$4o([o$40("domains")],BOe.prototype,"readDomains",null),e$4o([r$3s("domains")],BOe.prototype,"writeDomains",null),e$4o([y$2v({type:[VOe],json:{write:!0}})],BOe.prototype,"templates",void 0),BOe=e$4o([a$4y("esri.layers.support.FeatureType")],BOe);const jOe=BOe;function s$6(){return{fields:{type:[oE],value:null,set:function(fe){if(fe&&has("big-integer-warning-enabled")){const ve=fe.filter((fe=>"big-integer"===fe.type||"oid"===fe.type&&(fe.length||0)>=8));if(ve.length){const fe=ve.map((fe=>`'${fe.name}'`)).join(", ");ar.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${fe}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",fe)}},fieldsIndex:{readOnly:!0,get(){return YTe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(fe){this._userOutFields=fe,this.notifyChange("outFields")},get:function(){var fe;const ve=this._userOutFields;if(!(null==ve?void 0:ve.length))return null;if(ve.includes("*"))return["*"];if(!this.fields)return ve;for(const _e of ve){(null==(fe=this.fieldsIndex)?void 0:fe.has(_e))||ar.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${_e} found in outFields`,{layer:this,outFields:ve})}return I$1h(this.fieldsIndex,ve)}}}}const t$7=()=>ar.getLogger("esri.layers.support.labelingInfo"),GOe=/\[([^[\]]+)\]/gi;function l$9(fe,ve,_e){return fe?fe.map((fe=>{var be;const we=new nOe;if(we.read(fe,_e),we.labelExpression){const fe=ve.fields||(null==(be=ve.layerDefinition)?void 0:be.fields)||this.fields;we.labelExpression=we.labelExpression.replaceAll(GOe,((ve,_e)=>`[${function s$5(fe,ve){if(!ve)return fe;const _e=fe.toLowerCase();for(let be=0;be<ve.length;be++){const fe=ve[be].name;if(fe.toLowerCase()===_e)return fe}return fe}(_e,fe)}]`))}return we})):null}const HOe={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function a$8(fe,ve){const _e=[];for(const be of fe){const fe=be.labelPlacement,we=HOe[ve];if(!be.symbol)return t$7().warn("No ILabelClass symbol specified."),[];if(!we)return t$7().error(new Ir("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${ve}' is not supported`)),[];if(we.includes(fe))_e.push(be);else{const Se=we[0];fe&&t$7().warn(`Found invalid label placement type ${fe} for ${ve}. Defaulting to ${Se}`);const Te=be.clone();Te.labelPlacement=Se,_e.push(Te)}}return _e}const qOe=[];function t$6(fe,ve){if(g$1O(fe.url??""))return!0;const{wkid:_e}=ve;for(const be of qOe){if((fe.version??0)>=be[0])return!0;if("function"==typeof be[1]&&(be[1]=be[1]()),be[1].has(_e))return!1}return!0}async function t$5(fe,ve,_e){const be=fe&&fe.getAtOrigin&&fe.getAtOrigin("renderer",ve.origin);if(be&&"unique-value"===be.type&&be.styleOrigin){const we=await _$1s(be.populateFromStyle());if(s$4o(_e),!1===we.ok){const _e=we.error;(null==ve?void 0:ve.messages)&&ve.messages.push(new Mi("renderer:style-reference",`Failed to create unique value renderer from style reference: ${_e.message}`,{error:_e,context:ve})),fe.clear("renderer",null==ve?void 0:ve.origin)}}}var WOe;qOe.push([10.91,()=>{const fe=new Set([9709,9716,9741,9761,9766]);for(let ve=9712;ve<=9713;ve++)fe.add(ve);for(let ve=9748;ve<=9749;ve++)fe.add(ve);for(let ve=20904;ve<=20932;ve++)fe.add(ve);for(let ve=21004;ve<=21032;ve++)fe.add(ve);for(let ve=21207;ve<=21264;ve++)fe.add(ve);for(let ve=21307;ve<=21364;ve++)fe.add(ve);for(let ve=23301;ve<=23333;ve++)fe.add(ve);for(let ve=102759;ve<=102760;ve++)fe.add(ve);for(let ve=102934;ve<=102955;ve++)fe.add(ve);return fe}]),qOe.push([10.9,()=>{const fe=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let ve=9356;ve<=9360;ve++)fe.add(ve);for(let ve=9404;ve<=9407;ve++)fe.add(ve);for(let ve=9476;ve<=9482;ve++)fe.add(ve);for(let ve=9487;ve<=9494;ve++)fe.add(ve);for(let ve=9697;ve<=9699;ve++)fe.add(ve);return fe}]),qOe.push([10.81,()=>{const fe=new Set([9265,9333,103598,103699]);for(let ve=9248;ve<=9254;ve++)fe.add(ve);for(let ve=9271;ve<=9273;ve++)fe.add(ve);for(let ve=9284;ve<=9285;ve++)fe.add(ve);for(let ve=21453;ve<=21463;ve++)fe.add(ve);return fe}]),qOe.push([10.8,()=>{const fe=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let ve=8035;ve<=8036;ve++)fe.add(ve);for(let ve=8455;ve<=8456;ve++)fe.add(ve);for(let ve=8518;ve<=8529;ve++)fe.add(ve);for(let ve=8533;ve<=8536;ve++)fe.add(ve);for(let ve=8538;ve<=8540;ve++)fe.add(ve);for(let ve=8677;ve<=8679;ve++)fe.add(ve);for(let ve=8902;ve<=8903;ve++)fe.add(ve);for(let ve=8907;ve<=8910;ve++)fe.add(ve);for(let ve=8949;ve<=8951;ve++)fe.add(ve);for(let ve=8972;ve<=8987;ve++)fe.add(ve);for(let ve=9039;ve<=9040;ve++)fe.add(ve);for(let ve=9068;ve<=9069;ve++)fe.add(ve);for(let ve=9140;ve<=9141;ve++)fe.add(ve);for(let ve=9148;ve<=9150;ve++)fe.add(ve);for(let ve=9153;ve<=9159;ve++)fe.add(ve);for(let ve=9205;ve<=9218;ve++)fe.add(ve);for(let ve=9221;ve<=9222;ve++)fe.add(ve);for(let ve=54098;ve<=54101;ve++)fe.add(ve);return fe}]),qOe.push([10.71,()=>{const fe=new Set([6316]);for(let ve=8351;ve<=8353;ve++)fe.add(ve);for(let ve=9294;ve<=9297;ve++)fe.add(ve);for(let ve=22619;ve<=22621;ve++)fe.add(ve);for(let ve=103586;ve<=103594;ve++)fe.add(ve);return fe}]);let YOe=WOe=class extends Pn{constructor(fe){super(fe),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new WOe({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};e$4o([y$2v({type:[String],json:{write:!0}})],YOe.prototype,"groupByFields",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],YOe.prototype,"topCount",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],YOe.prototype,"orderByFields",void 0),YOe=WOe=e$4o([a$4y("esri.rest.support.TopFilter")],YOe);const ZOe=YOe;var XOe;const JOe=new An({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),QOe=new An({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let KOe=XOe=class extends Pn{constructor(fe){super(fe),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(fe,ve){ve.resultOffset=this.start,ve.resultRecordCount=this.num||10}clone(){return new XOe(a$4H({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};e$4o([y$2v({type:Boolean,json:{write:!0}})],KOe.prototype,"cacheHint",void 0),e$4o([y$2v({type:Number,json:{write:{overridePolicy:fe=>({enabled:fe>0})}}})],KOe.prototype,"distance",void 0),e$4o([y$2v({types:Oa,json:{read:y$2e,write:!0}})],KOe.prototype,"geometry",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],KOe.prototype,"geometryPrecision",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],KOe.prototype,"maxAllowableOffset",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultRecordCount"}}})],KOe.prototype,"num",void 0),e$4o([y$2v({json:{write:!0}})],KOe.prototype,"objectIds",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],KOe.prototype,"orderByFields",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],KOe.prototype,"outFields",void 0),e$4o([y$2v({type:zo,json:{read:{source:"outSR"},write:{target:"outSR"}}})],KOe.prototype,"outSpatialReference",void 0),e$4o([y$2v({type:String,json:{write:!0}})],KOe.prototype,"resultType",void 0),e$4o([y$2v({json:{write:!0}})],KOe.prototype,"returnGeometry",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],KOe.prototype,"returnM",void 0),e$4o([y$2v({type:Boolean,json:{write:{overridePolicy:fe=>({enabled:fe})}}})],KOe.prototype,"returnZ",void 0),e$4o([y$2v({type:Number,json:{read:{source:"resultOffset"}}})],KOe.prototype,"start",void 0),e$4o([r$3s("start"),r$3s("num")],KOe.prototype,"writeStart",null),e$4o([y$2v({type:String,json:{read:{source:"spatialRel",reader:JOe.read},write:{target:"spatialRel",writer:JOe.write}}})],KOe.prototype,"spatialRelationship",void 0),e$4o([y$2v({type:j_,json:{write:!0}})],KOe.prototype,"timeExtent",void 0),e$4o([y$2v({type:ZOe,json:{write:!0}})],KOe.prototype,"topFilter",void 0),e$4o([y$2v({type:String,json:{read:QOe.read,write:{writer:QOe.write,overridePolicy(fe){return{enabled:null!=fe&&null!=this.distance&&this.distance>0}}}}})],KOe.prototype,"units",void 0),e$4o([y$2v({type:String,json:{write:!0}})],KOe.prototype,"where",void 0),KOe=XOe=e$4o([a$4y("esri.rest.support.TopFeaturesQuery")],KOe),KOe.from=b$2d(KOe);const eAe=KOe;function p$d({displayField:fe,editFieldsInfo:ve,fields:_e,objectIdField:be,title:we},Se){if(!_e)return null;const Te=function w$2(fe,ve){const _e=null==ve?void 0:ve.visibleFieldNames;return function f$5(fe,ve){const _e=fe;return ve&&(fe=fe.filter((fe=>!ve.includes(fe.type)))),fe===_e&&(fe=fe.slice()),fe.sort(d$6),fe}(fe.fields??[],(null==ve?void 0:ve.ignoreFieldTypes)||tAe).map((ve=>new z$({fieldName:ve.name,isEditable:q$M(ve,fe),label:ve.alias,format:g$1(ve),visible:c$b(ve,{...fe,visibleFieldNames:_e})})))}({editFieldsInfo:ve,fields:_e,objectIdField:be},Se);if(!Te.length)return null;const Ee=function y$4(fe){const ve=function _$17({displayField:fe,fields:ve}){return fe||((null==ve?void 0:ve.length)?S$1s(ve,"name-or-title")||S$1s(ve,"unique-identifier")||S$1s(ve,"type-or-category")||function A$1i(fe){for(const ve of fe){if(!(null==ve?void 0:ve.name))continue;const fe=ve.name.toLowerCase();if(fe.includes("name")||fe.includes("title"))return ve.name}return null}(ve):null)}(fe),{titleBase:_e}=fe;return ve?`${_e}: {${ve.trim()}}`:_e??""}({titleBase:we,fields:_e,displayField:fe}),Ce=function j12(){return[new V$,new S$]}();return new ew({title:Ee,content:Ce,fieldInfos:Te})}const c$b=(fe,ve)=>ve.visibleFieldNames?ve.visibleFieldNames.has(fe.name):function B$P(fe,ve){var _e;const be=(null==(_e=fe.name)?void 0:_e.toLowerCase())??"";return!(null!=(null==ve?void 0:ve.objectIdField)&&be===ve.objectIdField.toLowerCase()||null!=(null==ve?void 0:ve.globalIdField)&&be===ve.globalIdField.toLowerCase()||X$o(ve).includes(be)||u$.has(fe.type)||h$.some((fe=>fe.test(be))))}(fe,ve);function d$6(fe,ve){return"oid"===fe.type?-1:"oid"===ve.type?1:v$1(fe)?-1:v$1(ve)?1:(fe.alias||fe.name).toLocaleLowerCase().localeCompare((ve.alias||ve.name).toLocaleLowerCase())}function g$1(fe){switch(fe.type){case"small-integer":case"integer":case"single":return new D$({digitSeparator:!0,places:0});case"double":return new D$({digitSeparator:!0,places:2});case"string":return Ge$2(fe.name)?new D$({digitSeparator:!0,places:0}):void 0;default:return}}function v$1(fe){var ve;if("name"===(fe.name&&fe.name.toLowerCase()))return!0;return"name"===(null==(ve=fe.alias)?void 0:ve.toLowerCase())}const tAe=["geometry","blob","raster","guid","xml"];var rAe;!function(fe){fe[fe.SAVE=0]="SAVE",fe[fe.SAVE_AS=1]="SAVE_AS"}(rAe||(rAe={}));const iAe="FeatureLayer";function $e(fe,ve){return new Ir("layer:unsupported",`Layer (${fe.title}, ${fe.id}) of type '${fe.declaredClass}' ${ve}`,{layer:fe})}function Ge(fe){return fe&&fe instanceof Wa}const nAe=s$6();function We(fe,ve,_e){const be=!!(null==_e?void 0:_e.writeLayerSchema);return{enabled:be,ignoreOrigin:be}}let sAe=class extends(R$1(c$g(c$p(n$e(F$2(l$L(p$i(l$b(t$t(f$7(l$H(b$9(j$a(S$a(e$i(i$L(i$4F(Y_)))))))))))))))))){constructor(...fe){super(...fe),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=zo.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=k$1C((async(fe,ve,_e)=>{const{save:be,saveAs:we}=await zt((()=>import("./featureLayerUtils-BsNTakUV.js")),__vite__mapDeps([215,216,74]));switch(fe){case rAe.SAVE:return be(this,ve);case rAe.SAVE_AS:return we(this,_e,ve)}}))}destroy(){var fe;null==(fe=this.source)||fe.destroy()}normalizeCtorArgs(fe,ve){return"string"==typeof fe?{url:fe,...ve}:fe}load(fe){var ve;const _e=null!=fe?fe.signal:null;if((null==(ve=this.portalItem)?void 0:ve.loaded)&&this.source)return this.addResolvingPromise(this.createGraphicsSource(_e).then((fe=>this.initLayerProperties(fe)))),Promise.resolve(this);const be=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},fe).catch(a$4D).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const fe=await this._fetchFirstValidLayerId(_e);null!=fe&&(this.layerId=fe)}if(!this.url&&!this._hasMemorySource())throw new Ir("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(_e))})).then((()=>T$1(this,"load",fe)));return this.addResolvingPromise(be),Promise.resolve(this)}readCapabilities(fe,ve){return a$f(ve=ve.layerDefinition||ve,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var fe;return!(this.loaded&&!(null==(fe=this.capabilities)?void 0:fe.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(fe){this._overrideIfSome("editingEnabled",fe)}readEditingEnabled(fe,ve){return this._readEditingEnabled(ve,!1)}readEditingEnabledFromWebMap(fe,ve,_e){return this._readEditingEnabled(ve,!0,_e)}writeEditingEnabled(fe,ve){this._writeEditingEnabled(fe,ve,!1)}writeEditingEnabledToWebMap(fe,ve,_e,be){this._writeEditingEnabled(fe,ve,!0,be)}get effectiveEditingEnabled(){return v$4(this)}readIsTable(fe,ve){return"Table"===(ve=(null==ve?void 0:ve.layerDefinition)??ve).type||!ve.geometryType}writeIsTable(fe,ve,_e,be){(null==be?void 0:be.writeLayerSchema)&&e$4h(_e,fe?"Table":"Feature Layer",ve)}readGlobalIdField(fe,ve){return R$2(ve.layerDefinition||ve)}readObjectIdField(fe,ve){return M$1(ve.layerDefinition||ve)}get parsedUrl(){const fe=I$1E(this.url);return null!=fe&&(null!=this.dynamicDataSource?fe.path=V$19(fe.path,"dynamicLayer"):null!=this.layerId&&(fe.path=V$19(fe.path,this.layerId.toString()))),fe}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(fe){p$46(fe,this.fieldsIndex),this._set("renderer",fe)}readRenderer(fe,ve,_e){var be;const we=null==(be=(ve=ve.layerDefinition||ve).drawingInfo)?void 0:be.renderer;if(we){const fe=o$a(we,ve,_e)??void 0;return fe||ar.getLogger(this).error("Failed to create renderer",{rendererDefinition:ve.drawingInfo.renderer,layer:this,context:_e}),fe}return U$3(ve,_e)}set source(fe){const ve=this._get("source");ve!==fe&&(Ge(ve)&&this._resetMemorySource(ve),Ge(fe)&&this._initMemorySource(fe),this._set("source",fe))}castSource(fe){return fe?Array.isArray(fe)||fe instanceof Wa?new iCe({layer:this,items:fe}):fe:null}readSource(fe,ve){const _e=tCe.fromJSON(ve.featureSet);return new iCe({layer:this,items:(null==_e?void 0:_e.features)??[]})}readTemplates(fe,ve){const _e=ve.editFieldsInfo,be=null==_e?void 0:_e.creatorField,we=null==_e?void 0:_e.editorField;return fe=null==fe?void 0:fe.map((fe=>VOe.fromJSON(fe))),this._fixTemplates(fe,be),this._fixTemplates(fe,we),fe}readTitle(fe,ve){var _e,be,we;const Se=(null==(_e=ve.layerDefinition)?void 0:_e.name)??ve.name,Te=ve.title||(null==(be=ve.layerDefinition)?void 0:be.title);if(Se){const fe=null==(we=this.portalItem)?void 0:we.title;if("item-title"===this.sublayerTitleMode)return this.url?w$1n(this.url,Se):Se;let ve=Se;if(!ve&&this.url){const fe=d$2m(this.url);null!=fe&&(ve=fe.title)}if(!ve)return;return"item-title-and-service-name"===this.sublayerTitleMode&&fe&&fe!==ve&&(ve=fe+" - "+ve),m$2u(ve)}if("item-title"===this.sublayerTitleMode&&Te)return Te}readTitleFromWebMap(fe,ve){var _e;return ve.title||(null==(_e=ve.layerDefinition)?void 0:_e.name)}readTypeIdField(fe,ve){let _e=(ve=ve.layerDefinition||ve).typeIdField;if(_e&&ve.fields){_e=_e.toLowerCase();const fe=ve.fields.find((fe=>fe.name.toLowerCase()===_e));fe&&(_e=fe.name)}return _e}readTypes(fe,ve){fe=(ve=ve.layerDefinition||ve).types;const _e=ve.editFieldsInfo,be=null==_e?void 0:_e.creatorField,we=null==_e?void 0:_e.editorField;return null==fe?void 0:fe.map((fe=>(fe=jOe.fromJSON(fe),this._fixTemplates(fe.templates,be),this._fixTemplates(fe.templates,we),fe)))}readVisible(fe,ve){var _e;return null!=(null==(_e=ve.layerDefinition)?void 0:_e.defaultVisibility)?!!ve.layerDefinition.defaultVisibility:null!=ve.visibility?!!ve.visibility:void 0}async addAttachment(fe,ve){return m$c(this,fe,ve,iAe)}async updateAttachment(fe,ve,_e){return w$4(this,fe,ve,_e,iAe)}async applyEdits(fe,ve){return b$2(this,fe,ve)}async uploadAssets(fe,ve){return async function g$8(fe,ve,_e){const{uploadAssets:be}=await zt((()=>import("./editingSupport-BNx5CWnq.js")),__vite__mapDeps([214,18,19,103])),we=await fe.load();return be(we,we.source,ve,_e)}(this,fe,ve)}on(fe,ve){return super.on(fe,ve)}createPopupTemplate(fe){return p$d(this,fe)}async createGraphicsSource(fe){if(this._hasMemorySource()&&this.source)return this.source.load({signal:fe});const{default:ve}=await h$2_(zt((()=>import("./FeatureLayerSource-CSPBNDDE.js")),__vite__mapDeps([217,102,103,101,214,18,19,25,22,218,219,34,32,33,67,220])),fe);return new ve({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:fe})}createQuery(){const fe=x$2(this);fe.dynamicDataSource=this.dynamicDataSource;const ve=null!=this.subtypeCode?`${this.subtypeField} = ${this.subtypeCode}`:null,_e=n$3I(this.definitionExpression,ve);return fe.where=_e||"1=1",fe}async deleteAttachments(fe,ve){return j$3(this,fe,ve,iAe)}async fetchRecomputedExtents(fe){return I$3(this,fe,iAe)}getFeatureType(fe){return N$1(this.types,this.typeIdField,fe)}getFieldDomain(fe,ve){var _e;const be=null==ve?void 0:ve.feature,we=function L$3(fe,ve){const{subtypes:_e,subtypeField:be}=fe;if(!ve||!(null==_e?void 0:_e.length)||!be)return null;const we=ve.attributes[be];return null==we?null:_e.find((fe=>fe.code===we))}(this,be);if(we){const ve=null==(_e=we.domains)?void 0:_e[fe];return"inherited"===(null==ve?void 0:ve.type)?this._getLayerDomain(fe):ve}const Se=this.getFeatureType(be);if(Se){const ve=Se.domains&&Se.domains[fe];if(ve&&"inherited"!==ve.type)return ve}return this._getLayerDomain(fe)}getField(fe){return this.fieldsIndex.get(fe)}async queryAttachments(fe,ve){return q$1(this,fe,0,iAe)}async queryFeatures(fe,ve){const _e=await this.load(),be=await _e.source.queryFeatures(FE.from(fe)??_e.createQuery(),ve);if(null==be?void 0:be.features)for(const we of be.features)we.layer=we.sourceLayer=_e;return be}async queryObjectIds(fe,ve){return F$1(this,fe,ve,iAe)}async queryFeatureCount(fe,ve){return A$5(this,fe,ve,iAe)}async queryExtent(fe,ve){return O$3(this,fe,ve,iAe)}async queryRelatedFeatures(fe,ve){return P$3(this,fe,ve,iAe)}async queryRelatedFeaturesCount(fe,ve){return S$3(this,fe,ve,iAe)}async queryTopFeatures(fe,ve){var _e;const{source:be,capabilities:we}=await this.load();if(!be.queryTopFeatures||!(null==(_e=null==we?void 0:we.query)?void 0:_e.supportsTopFeaturesQuery))throw new Ir(iAe,"Layer source does not support queryTopFeatures capability");const Se=await be.queryTopFeatures(eAe.from(fe),ve);if(null==Se?void 0:Se.features)for(const Te of Se.features)Te.layer=Te.sourceLayer=this;return Se}async queryTopObjectIds(fe,ve){const{source:_e,capabilities:be}=await this.load();if(!_e.queryTopObjectIds||!(null==be?void 0:be.query.supportsTopFeaturesQuery))throw new Ir(iAe,"Layer source does not support queryTopObjectIds capability");return _e.queryTopObjectIds(eAe.from(fe),ve)}async queryTopFeaturesExtent(fe,ve){var _e;const{source:be,capabilities:we}=await this.load();if(!be.queryTopExtents||!(null==(_e=null==we?void 0:we.query)?void 0:_e.supportsTopFeaturesQuery))throw new Ir(iAe,"Layer source does not support queryTopExtents capability");return be.queryTopExtents(eAe.from(fe),ve)}async queryTopFeatureCount(fe,ve){var _e;const{source:be,capabilities:we}=await this.load();if(!be.queryTopCount||!(null==(_e=null==we?void 0:we.query)?void 0:_e.supportsTopFeaturesQuery))throw new Ir(iAe,"Layer source does not support queryFeatureCount capability");return be.queryTopCount(eAe.from(fe),ve)}read(fe,ve){const _e=fe.featureCollection;if((_e||"Feature Collection"===fe.type)&&(this.resourceInfo=fe),_e){const fe=_e.layers;fe&&1===fe.length&&(super.read(fe[0],ve),null!=_e.showLegend&&super.read({showLegend:_e.showLegend},ve))}super.read(fe,ve),ve&&"service"===ve.origin&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(fe,ve){ve={...ve,origin:(null==ve?void 0:ve.origin)??void 0,writeLayerSchema:(null==ve?void 0:ve.writeLayerSchema)??this._hasMemorySource()};const{origin:_e,layerContainerType:be,messages:we}=ve;if(this.dynamicDataSource)return null==we||we.push($e(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(("web-map"===_e||"web-scene"===_e)&&"tables"!==be)return null==we||we.push($e(this,`a table source can only be written to tables, not ${be}`)),null;if(this._hasMemorySource())return null==we||we.push($e(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&("web-map"===_e||"web-scene"===_e)&&"tables"===be)return null==we||we.push($e(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(fe,ve)}clone(){if(this._hasMemorySource())throw new Ir(iAe,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(fe){var ve;return!!this.loaded&&("memory"===(null==(ve=this.source)?void 0:ve.type)||t$6(this,fe))}async save(fe){return this._debouncedSaveOperations(rAe.SAVE,fe)}async saveAs(fe,ve){return this._debouncedSaveOperations(rAe.SAVE_AS,ve,fe)}_readEditingEnabled(fe,ve,_e){var be;let we=null==(be=fe.layerDefinition)?void 0:be.capabilities;return we?this._hasEditingCapability(we):(we=fe.capabilities,ve&&"web-map"===(null==_e?void 0:_e.origin)&&!this._hasMemorySource()&&we?this._hasEditingCapability(we):void 0)}_hasEditingCapability(fe){return fe.toLowerCase().split(",").map((fe=>fe.trim())).includes("editing")}_writeEditingEnabled(fe,ve,_e,be){var we,Se;if(!fe){const fe=(null==(Se=null==(we=this.capabilities)?void 0:we.operations)?void 0:Se.supportsSync)?"Query,Sync":"Query";e$4h("layerDefinition.capabilities",fe,ve),_e&&!(null==be?void 0:be.writeLayerSchema)&&(ve.capabilities=fe)}}_getLayerDomain(fe){const ve=this.fieldsIndex.get(fe);return ve?ve.domain:null}_fetchFirstValidLayerId(fe){return U$1a(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:fe}).then((fe=>{const ve=fe.data;if(ve)return this.findFirstValidLayerId(ve)}))}async initLayerProperties(fe){var ve;return this._set("source",fe),fe.sourceJSON&&(this.sourceJSON=fe.sourceJSON,this.read(fe.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:null==(ve=this.portalItem)?void 0:ve.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),p$46(this.renderer,this.fieldsIndex),g$1X(this.timeInfo,this.fieldsIndex),t$5(this,{origin:"service"})}async hasDataChanged(){return E$3(this)}async fetchPublishingStatus(){const fe=this.source;return(null==fe?void 0:fe.fetchPublishingStatus)?fe.fetchPublishingStatus():"unavailable"}_verifyFields(){var fe,ve;const _e=(null==(fe=this.parsedUrl)?void 0:fe.path)??"undefined";this.objectIdField,this.isTable||this._hasMemorySource()||-1!==_e.search(/\/FeatureServer\//i)||null==(ve=this.fields)||ve.some((fe=>"geometry"===fe.type))}_fixTemplates(fe,ve){fe&&fe.forEach((fe=>{var _e;const be=null==(_e=fe.prototype)?void 0:_e.attributes;be&&ve&&delete be[ve]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new Ir("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new Ir("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(fe){fe.forEach((fe=>{fe.layer=this,fe.sourceLayer=this})),this.addHandles([fe.on("after-add",(fe=>{fe.item.layer=this,fe.item.sourceLayer=this})),fe.on("after-remove",(fe=>{fe.item.layer=null,fe.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(fe){fe.forEach((fe=>{fe.layer=null,fe.sourceLayer=null})),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(fe){return Array.isArray(fe.layers)&&fe.layers.length>0?fe.layers[0].id:Array.isArray(fe.tables)&&fe.tables.length>0?fe.tables[0].id:void 0}};e$4o([o$40("service","capabilities")],sAe.prototype,"readCapabilities",null),e$4o([y$2v({json:{origins:{"web-scene":{write:!1}},write:!0}})],sAe.prototype,"charts",void 0),e$4o([y$2v({readOnly:!0})],sAe.prototype,"createQueryVersion",null),e$4o([y$2v({json:{read:{source:"layerDefinition.copyrightText"}}})],sAe.prototype,"copyright",void 0),e$4o([y$2v({json:{read:{source:"layerDefinition.displayField"}}})],sAe.prototype,"displayField",void 0),e$4o([y$2v({types:_T,readOnly:!0})],sAe.prototype,"defaultSymbol",void 0),e$4o([y$2v({type:wE})],sAe.prototype,"dynamicDataSource",void 0),e$4o([y$2v({type:Boolean})],sAe.prototype,"editingEnabled",null),e$4o([o$40(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],sAe.prototype,"readEditingEnabled",null),e$4o([o$40("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],sAe.prototype,"readEditingEnabledFromWebMap",null),e$4o([r$3s(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],sAe.prototype,"writeEditingEnabled",null),e$4o([r$3s("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],sAe.prototype,"writeEditingEnabledToWebMap",null),e$4o([y$2v({readOnly:!0})],sAe.prototype,"effectiveEditingEnabled",null),e$4o([y$2v({...nAe.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:We}}}}})],sAe.prototype,"fields",void 0),e$4o([y$2v(nAe.fieldsIndex)],sAe.prototype,"fieldsIndex",void 0),e$4o([y$2v({type:JPe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],sAe.prototype,"formTemplate",void 0),e$4o([y$2v({json:{read:{source:"layerDefinition.extent"}}})],sAe.prototype,"fullExtent",void 0),e$4o([y$2v({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:We,writer(fe,ve,_e){const be=fe?RCe.toJSON(fe):null;be&&e$4h(_e,be,ve)}}}},read:{source:"layerDefinition.geometryType",reader:RCe.read}}})],sAe.prototype,"geometryType",void 0),e$4o([y$2v({json:{read:{source:"layerDefinition.hasM"}}})],sAe.prototype,"hasM",void 0),e$4o([y$2v({json:{read:{source:"layerDefinition.hasZ"}}})],sAe.prototype,"hasZ",void 0),e$4o([y$2v(axe)],sAe.prototype,"id",void 0),e$4o([y$2v({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],sAe.prototype,"infoFor3D",void 0),e$4o([y$2v({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],sAe.prototype,"isTable",void 0),e$4o([o$40("service","isTable",["type","geometryType"]),o$40("isTable",["layerDefinition.type","layerDefinition.geometryType"])],sAe.prototype,"readIsTable",null),e$4o([r$3s("web-map","isTable")],sAe.prototype,"writeIsTable",null),e$4o([y$2v(Kwe)],sAe.prototype,"labelsVisible",void 0),e$4o([y$2v({type:[nOe],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:l$9,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:l$9,write:{enabled:!0,layerContainerTypes:qwe}}},name:"layerDefinition.drawingInfo.labelingInfo",read:l$9,write:!0}})],sAe.prototype,"labelingInfo",void 0),e$4o([y$2v((()=>{const fe=a$4H(sxe);return fe.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(fe,ve,_e){e$4h(_e,n$3O(fe),ve)}}},fe})())],sAe.prototype,"opacity",void 0),e$4o([y$2v(txe)],sAe.prototype,"legendEnabled",void 0),e$4o([y$2v({type:["show","hide"],json:(()=>{const fe=a$4H(uxe.json);return fe.origins["portal-item"]={read:!1,write:!1},fe})()})],sAe.prototype,"listMode",void 0),e$4o([o$40("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],sAe.prototype,"readGlobalIdField",null),e$4o([y$2v({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:We}}}}})],sAe.prototype,"objectIdField",void 0),e$4o([o$40("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],sAe.prototype,"readObjectIdField",null),e$4o([y$2v({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],sAe.prototype,"operationalLayerType",void 0),e$4o([y$2v(nAe.outFields)],sAe.prototype,"outFields",void 0),e$4o([y$2v({readOnly:!0})],sAe.prototype,"parsedUrl",null),e$4o([y$2v({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],sAe.prototype,"path",void 0),e$4o([y$2v(Qwe)],sAe.prototype,"popupEnabled",void 0),e$4o([y$2v({type:ew,json:{name:"popupInfo",write:!0}})],sAe.prototype,"popupTemplate",void 0),e$4o([y$2v({readOnly:!0})],sAe.prototype,"defaultPopupTemplate",null),e$4o([y$2v({types:BEe,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:jEe,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:qwe,overridePolicy:(fe,ve,_e)=>({ignoreOrigin:null==_e?void 0:_e.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(fe,ve,_e)=>({ignoreOrigin:null==_e?void 0:_e.writeLayerSchema})}}})],sAe.prototype,"renderer",null),e$4o([o$40("service","renderer",["drawingInfo.renderer","defaultSymbol"]),o$40("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],sAe.prototype,"readRenderer",null),e$4o([y$2v()],sAe.prototype,"resourceInfo",void 0),e$4o([y$2v((()=>{const fe=a$4H(Jwe);return fe.json.origins["portal-item"]={read:!1,write:!1},fe})())],sAe.prototype,"screenSizePerspectiveEnabled",void 0),e$4o([y$2v({clonable:!1})],sAe.prototype,"source",null),e$4o([s$4b("source")],sAe.prototype,"castSource",null),e$4o([o$40("portal-item","source",["featureSet"]),o$40("web-map","source",["featureSet"])],sAe.prototype,"readSource",null),e$4o([y$2v({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],sAe.prototype,"spatialReference",void 0),e$4o([y$2v({type:Number})],sAe.prototype,"subtypeCode",void 0),e$4o([y$2v({type:[VOe]})],sAe.prototype,"templates",void 0),e$4o([o$40("templates",["editFieldsInfo","creatorField","editorField","templates"])],sAe.prototype,"readTemplates",null),e$4o([y$2v({type:FOe})],sAe.prototype,"timeInfo",void 0),e$4o([y$2v()],sAe.prototype,"title",void 0),e$4o([o$40("service","title",["name"]),o$40("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],sAe.prototype,"readTitle",null),e$4o([o$40("web-map","title",["layerDefinition.name","title"])],sAe.prototype,"readTitleFromWebMap",null),e$4o([y$2v({type:String})],sAe.prototype,"sublayerTitleMode",void 0),e$4o([y$2v({json:{read:!1}})],sAe.prototype,"type",void 0),e$4o([y$2v({type:String})],sAe.prototype,"typeIdField",void 0),e$4o([o$40("service","typeIdField"),o$40("typeIdField",["layerDefinition.typeIdField"])],sAe.prototype,"readTypeIdField",null),e$4o([y$2v({type:[jOe]})],sAe.prototype,"types",void 0),e$4o([o$40("service","types",["types"]),o$40("types",["layerDefinition.types"])],sAe.prototype,"readTypes",null),e$4o([y$2v({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],sAe.prototype,"visible",void 0),e$4o([o$40("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],sAe.prototype,"readVisible",null),sAe=e$4o([a$4y("esri.layers.FeatureLayer")],sAe);const oAe=sAe,aAe=Object.freeze(Object.defineProperty({__proto__:null,default:oAe},Symbol.toStringTag,{value:"Module"}));let lAe=class n49 extends(s$3x(Vwe)){constructor(fe){super(fe),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(fe,ve){return"string"==typeof ve.alias?ve.alias:"string"==typeof ve.name?ve.name:""}readIdOnlyOnce(fe){return-1!==this.id?this.id:"number"==typeof fe?fe:-1}};e$4o([y$2v({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],lAe.prototype,"title",void 0),e$4o([o$40("service","title",["alias","name"])],lAe.prototype,"readTitle",null),e$4o([y$2v()],lAe.prototype,"layer",void 0),e$4o([y$2v({type:Ci,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],lAe.prototype,"id",void 0),e$4o([o$40("service","id")],lAe.prototype,"readIdOnlyOnce",null),e$4o([y$2v(c$R(String))],lAe.prototype,"modelName",void 0),e$4o([y$2v(c$R(Boolean))],lAe.prototype,"isEmpty",void 0),e$4o([y$2v({type:Boolean,nonNullable:!0})],lAe.prototype,"legendEnabled",void 0),e$4o([y$2v({type:Boolean,json:{name:"visibility",write:!0}})],lAe.prototype,"visible",void 0),e$4o([y$2v({type:Number,json:{write:!0}})],lAe.prototype,"opacity",void 0),lAe=e$4o([a$4y("esri.layers.buildingSublayers.BuildingSublayer")],lAe);const cAe=lAe,uAe={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};async function r$2(fe,ve,_e,be,we,Se,Te){let Ee=null;if(null!=_e){const ve=`${fe}/nodepages/`,Ce=ve+Math.floor(_e.rootIndex/_e.nodesPerPage);try{return{type:"page",rootPage:(await U$1a(Ce,{query:{f:"json",...be,token:we},responseType:"json",signal:Te})).data,rootIndex:_e.rootIndex,pageSize:_e.nodesPerPage,lodMetric:_e.lodSelectionMetricType,urlPrefix:ve}}catch(Re){null!=Se&&Se.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",Ce,Re),Ee=Re}}if(!ve)return null;const Ce=`${fe}/nodes/`,Oe=Ce+(null==ve?void 0:ve.split("/").pop());try{return{type:"node",rootNode:(await U$1a(Oe,{query:{f:"json",...be,token:we},responseType:"json",signal:Te})).data,urlPrefix:Ce}}catch(Re){throw new Ir("sceneservice:root-node-missing","Root node missing.",{pageError:Ee,nodeError:Re,url:Oe})}}let hAe=class p46 extends Pn{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};e$4o([y$2v({type:Number})],hAe.prototype,"nodesPerPage",void 0),e$4o([y$2v({type:Number})],hAe.prototype,"rootIndex",void 0),e$4o([y$2v({type:String})],hAe.prototype,"lodSelectionMetricType",void 0),hAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SNodePageDefinition")],hAe);let dAe=class i50 extends Pn{constructor(){super(...arguments),this.factor=1}};e$4o([y$2v({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],dAe.prototype,"id",void 0),e$4o([y$2v({type:Number})],dAe.prototype,"factor",void 0),dAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SMaterialTexture")],dAe);let pAe=class n50 extends Pn{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};e$4o([y$2v({type:[Number]})],pAe.prototype,"baseColorFactor",void 0),e$4o([y$2v({type:dAe})],pAe.prototype,"baseColorTexture",void 0),e$4o([y$2v({type:dAe})],pAe.prototype,"metallicRoughnessTexture",void 0),e$4o([y$2v({type:Number})],pAe.prototype,"metallicFactor",void 0),e$4o([y$2v({type:Number})],pAe.prototype,"roughnessFactor",void 0),pAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SMaterialPBRMetallicRoughness")],pAe);let fAe=class a53 extends Pn{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};e$4o([o$3g({opaque:"opaque",mask:"mask",blend:"blend"})],fAe.prototype,"alphaMode",void 0),e$4o([y$2v({type:Number})],fAe.prototype,"alphaCutoff",void 0),e$4o([y$2v({type:Boolean})],fAe.prototype,"doubleSided",void 0),e$4o([o$3g({none:"none",back:"back",front:"front"})],fAe.prototype,"cullFace",void 0),e$4o([y$2v({type:dAe})],fAe.prototype,"normalTexture",void 0),e$4o([y$2v({type:dAe})],fAe.prototype,"occlusionTexture",void 0),e$4o([y$2v({type:dAe})],fAe.prototype,"emissiveTexture",void 0),e$4o([y$2v({type:[Number]})],fAe.prototype,"emissiveFactor",void 0),e$4o([y$2v({type:pAe})],fAe.prototype,"pbrMetallicRoughness",void 0),fAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SMaterialDefinition")],fAe);let mAe=class l47 extends Pn{};e$4o([y$2v({type:String,json:{read:{source:["name","index"],reader:(fe,ve)=>null!=fe?fe:`${ve.index}`}}})],mAe.prototype,"name",void 0),e$4o([o$3g({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],mAe.prototype,"format",void 0),mAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3STextureFormat")],mAe);let yAe=class y14 extends Pn{constructor(){super(...arguments),this.atlas=!1}};e$4o([y$2v({type:[mAe]})],yAe.prototype,"formats",void 0),e$4o([y$2v({type:Boolean})],yAe.prototype,"atlas",void 0),yAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3STextureSetDefinition")],yAe);let gAe=class u28 extends Pn{};e$4o([o$3g({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],gAe.prototype,"type",void 0),e$4o([y$2v({type:Number})],gAe.prototype,"component",void 0),gAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SGeometryAttribute")],gAe);let vAe=class d33 extends Pn{};e$4o([o$3g({draco:"draco"})],vAe.prototype,"encoding",void 0),e$4o([y$2v({type:[String]})],vAe.prototype,"attributes",void 0),vAe=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SGeometryCompressedAttributes")],vAe);let _Ae=class c48 extends Pn{constructor(){super(...arguments),this.offset=0}};e$4o([y$2v({type:Number})],_Ae.prototype,"offset",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"position",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"normal",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"uv0",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"color",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"uvRegion",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"featureId",void 0),e$4o([y$2v({type:gAe})],_Ae.prototype,"faceRange",void 0),e$4o([y$2v({type:vAe})],_Ae.prototype,"compressedAttributes",void 0),_Ae=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SGeometryBuffer")],_Ae);let $Ae=class m37 extends Pn{};e$4o([o$3g({triangle:"triangle"})],$Ae.prototype,"topology",void 0),e$4o([y$2v()],$Ae.prototype,"geometryBuffers",void 0),$Ae=e$4o([a$4y("esri.layers.support.I3SLayerDefinitions.I3SGeometryDefinition")],$Ae);const bAe=!0,wAe={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function r$1(fe,ve,_e){return{identifier:String.fromCharCode.apply(null,new Uint8Array(fe,_e+wAe.identifierOffset,wAe.identifierLength)),version:ve.getUint16(_e+wAe.versionOffset,bAe),checksum:ve.getUint32(_e+wAe.checksumOffset,bAe)}}const xAe={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function c$9(fe){const ve=new DataView(fe,0);let _e=0;const{identifier:be,version:we}=r$1(fe,ve,_e);if(_e+=wAe.byteCount,"LEPCC     "!==be)throw new Ir("lepcc-decode-error","Bad identifier");if(we>1)throw new Ir("lepcc-decode-error","Unknown version");const Se=function i$6(fe,ve){return{sizeLo:fe.getUint32(ve+xAe.sizeLo,bAe),sizeHi:fe.getUint32(ve+xAe.sizeHi,bAe),minX:fe.getFloat64(ve+xAe.minX,bAe),minY:fe.getFloat64(ve+xAe.minY,bAe),minZ:fe.getFloat64(ve+xAe.minZ,bAe),maxX:fe.getFloat64(ve+xAe.maxX,bAe),maxY:fe.getFloat64(ve+xAe.maxY,bAe),maxZ:fe.getFloat64(ve+xAe.maxZ,bAe),errorX:fe.getFloat64(ve+xAe.errorX,bAe),errorY:fe.getFloat64(ve+xAe.errorY,bAe),errorZ:fe.getFloat64(ve+xAe.errorZ,bAe),count:fe.getUint32(ve+xAe.count,bAe),reserved:fe.getUint32(ve+xAe.reserved,bAe)}}(ve,_e);if(_e+=xAe.byteCount,Se.sizeHi*2**32+Se.sizeLo!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");const Te=new Float64Array(3*Se.count),Ee=[],Ce=[],Oe=[],Re=[];if(_e=s$3(fe,_e,Ee),_e=s$3(fe,_e,Ce),_e=s$3(fe,_e,Oe),_e=s$3(fe,_e,Re),_e!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad length");let De=0,Be=0;for(let Ze=0;Ze<Ee.length;Ze++){Be+=Ee[Ze];let fe=0;for(let ve=0;ve<Ce[Ze];ve++){fe+=Oe[De];const ve=Re[De];Te[3*De]=Math.min(Se.maxX,Se.minX+2*Se.errorX*fe),Te[3*De+1]=Math.min(Se.maxY,Se.minY+2*Se.errorY*Be),Te[3*De+2]=Math.min(Se.maxZ,Se.minZ+2*Se.errorZ*ve),De++}}return{errorX:Se.errorX,errorY:Se.errorY,errorZ:Se.errorZ,result:Te}}function s$3(fe,ve,_e){const be=[];ve=d$4(fe,ve,be);const we=[];for(let Se=0;Se<be.length;Se++){we.length=0,ve=d$4(fe,ve,we);for(let fe=0;fe<we.length;fe++)_e.push(we[fe]+be[Se])}return ve}function d$4(fe,ve,_e){const be=new DataView(fe,ve),we=be.getUint8(0),Se=31&we,Te=!!(32&we),Ee=(192&we)>>6;let Ce=0;if(0===Ee)Ce=be.getUint32(1,bAe),ve+=5;else if(1===Ee)Ce=be.getUint16(1,bAe),ve+=3;else{if(2!==Ee)throw new Ir("lepcc-decode-error","Bad count type");Ce=be.getUint8(1),ve+=2}if(Te)throw new Ir("lepcc-decode-error","LUT not implemented");const Oe=Math.ceil(Ce*Se/8),Re=new Uint8Array(fe,ve,Oe);let De=0,Be=0,Ze=0;const Xe=-1>>>32-Se;for(let Je=0;Je<Ce;Je++){for(;Be<Se;)De|=Re[Ze]<<Be,Be+=8,Ze+=1;_e[Je]=De&Xe,De>>>=Se,Be-=Se,Be+Se>32&&(De|=Re[Ze-1]>>8-Be)}return ve+Ze}const SAe={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function u$8(fe){const ve=new DataView(fe,0);let _e=0;const{identifier:be,version:we}=r$1(fe,ve,_e);if(_e+=wAe.byteCount,"ClusterRGB"!==be)throw new Ir("lepcc-decode-error","Bad identifier");if(we>1)throw new Ir("lepcc-decode-error","Unknown version");const Se=function a$5(fe,ve){return{sizeLo:fe.getUint32(ve+SAe.sizeLo,bAe),sizeHi:fe.getUint32(ve+SAe.sizeHi,bAe),count:fe.getUint32(ve+SAe.count,bAe),colorMapCount:fe.getUint16(ve+SAe.colorMapCount,bAe),lookupMethod:fe.getUint8(ve+SAe.lookupMethod),compressionMethod:fe.getUint8(ve+SAe.compressionMethod)}}(ve,_e);if(_e+=SAe.byteCount,Se.sizeHi*2**32+Se.sizeLo!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");if((2===Se.lookupMethod||1===Se.lookupMethod)&&0===Se.compressionMethod){if(3*Se.colorMapCount+Se.count+_e!==fe.byteLength||Se.colorMapCount>256)throw new Ir("lepcc-decode-error","Bad count");const ve=new Uint8Array(fe,_e,3*Se.colorMapCount),be=new Uint8Array(fe,_e+3*Se.colorMapCount,Se.count),we=new Uint8Array(3*Se.count);for(let fe=0;fe<Se.count;fe++){const _e=be[fe];we[3*fe]=ve[3*_e],we[3*fe+1]=ve[3*_e+1],we[3*fe+2]=ve[3*_e+2]}return we}if(0===Se.lookupMethod&&0===Se.compressionMethod){if(3*Se.count+_e!==fe.byteLength||0!==Se.colorMapCount)throw new Ir("lepcc-decode-error","Bad count");return new Uint8Array(fe,_e).slice()}if(Se.lookupMethod<=2&&1===Se.compressionMethod){if(_e+3!==fe.byteLength||1!==Se.colorMapCount)throw new Ir("lepcc-decode-error","Bad count");const be=ve.getUint8(_e),we=ve.getUint8(_e+1),Te=ve.getUint8(_e+2),Ee=new Uint8Array(3*Se.count);for(let fe=0;fe<Se.count;fe++)Ee[3*fe]=be,Ee[3*fe+1]=we,Ee[3*fe+2]=Te;return Ee}throw new Ir("lepcc-decode-error","Bad method "+Se.lookupMethod+","+Se.compressionMethod)}const TAe={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function w$1(fe){const ve=new DataView(fe,0);let _e=0;const{identifier:be,version:we}=r$1(fe,ve,_e);if(_e+=wAe.byteCount,"Intensity "!==be)throw new Ir("lepcc-decode-error","Bad identifier");if(we>1)throw new Ir("lepcc-decode-error","Unknown version");const Se=function h$2(fe,ve){return{sizeLo:fe.getUint32(ve+TAe.sizeLo,bAe),sizeHi:fe.getUint32(ve+TAe.sizeHi,bAe),count:fe.getUint32(ve+TAe.count,bAe),scaleFactor:fe.getUint16(ve+TAe.scaleFactor,bAe),bitsPerPoint:fe.getUint8(ve+TAe.bitsPerPoint),reserved:fe.getUint8(ve+TAe.reserved)}}(ve,_e);if(_e+=TAe.byteCount,Se.sizeHi*2**32+Se.sizeLo!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");const Te=new Uint16Array(Se.count);if(8===Se.bitsPerPoint){if(Se.count+_e!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");const ve=new Uint8Array(fe,_e,Se.count);for(let fe=0;fe<Se.count;fe++)Te[fe]=ve[fe]*Se.scaleFactor}else if(16===Se.bitsPerPoint){if(2*Se.count+_e!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");const ve=new Uint16Array(fe,_e,Se.count);for(let fe=0;fe<Se.count;fe++)Te[fe]=ve[fe]*Se.scaleFactor}else{const ve=[];if(d$4(fe,_e,ve)!==fe.byteLength)throw new Ir("lepcc-decode-error","Bad size");for(let fe=0;fe<Se.count;fe++)Te[fe]=ve[fe]*Se.scaleFactor}return Te}const u$7=()=>ar.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function a$4(fe,ve,_e){let be="",we=0;for(;we<_e;){const Se=fe[ve+we];if(Se<128)be+=String.fromCharCode(Se),we++;else if(Se>=192&&Se<224){if(we+1>=_e)throw new Ir("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const Te=(31&Se)<<6|63&fe[ve+we+1];be+=String.fromCharCode(Te),we+=2}else if(Se>=224&&Se<240){if(we+2>=_e)throw new Ir("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const Te=(15&Se)<<12|(63&fe[ve+we+1])<<6|63&fe[ve+we+2];be+=String.fromCharCode(Te),we+=3}else{if(!(Se>=240&&Se<248))throw new Ir("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(we+3>=_e)throw new Ir("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const Te=(7&Se)<<18|(63&fe[ve+we+1])<<12|(63&fe[ve+we+2])<<6|63&fe[ve+we+3];if(Te>=65536){const fe=55296+(Te-65536>>10),ve=56320+(1023&Te);be+=String.fromCharCode(fe,ve)}else be+=String.fromCharCode(Te);we+=4}}}return be}function s$2(fe,ve){const _e={byteOffset:0,byteCount:0,fields:Object.create(null)};let be=0;for(let we=0;we<ve.length;we++){const Se=ve[we],Te=Se.valueType||Se.type,Ee=CAe[Te];_e.fields[Se.property]=Ee(fe,be),be+=PAe[Te].BYTES_PER_ELEMENT}return _e.byteCount=be,_e}function f$3(fe,ve,_e){const be=[];let we,Se,Te=0;for(Se=0;Se<fe;Se+=1){if(we=ve[Se],we>0){if(be.push(a$4(_e,Te,we-1)),0!==_e[Te+we-1])throw new Ir("string-array-error","Invalid string array: missing null termination.")}else be.push(null);Te+=we}return be}function l$6(fe,ve){return new PAe[ve.valueType](fe,ve.byteOffset,ve.count*ve.valuesPerElement)}function y$2(fe,ve,_e){if(ve!==fe&&u$7().error(`Invalid ${_e} buffer size\n expected: ${fe}, actual: ${ve})`),ve<fe)throw new Ir("buffer-too-small","Binary buffer is too small",{expectedSize:fe,actualSize:ve})}function w8(fe,ve){const _e=s$2(fe,ve&&ve.header);let be=_e.byteCount;const we={isDraco:!1,header:_e,byteOffset:_e.byteCount,byteCount:0,vertexAttributes:{}},Se=_e.fields,Te=null!=Se.vertexCount?Se.vertexCount:Se.count;for(const Oe of ve.ordering){if(!ve.vertexAttributes[Oe])continue;const fe={...ve.vertexAttributes[Oe],byteOffset:be,count:Te},_e=EAe[Oe]||"_"+Oe;we.vertexAttributes[_e]=fe,be+=E$1(fe.valueType)*fe.valuesPerElement*Te}const Ee=Se.faceCount;if(ve.faces&&Ee){we.faces={};for(const fe of ve.ordering){if(!ve.faces[fe])continue;const _e={...ve.faces[fe],byteOffset:be,count:Ee};we.faces[fe]=_e,be+=E$1(_e.valueType)*_e.valuesPerElement*Ee}}const Ce=Se.featureCount;if(ve.featureAttributes&&ve.featureAttributeOrder&&Ce){we.featureAttributes={};for(const fe of ve.featureAttributeOrder){if(!ve.featureAttributes[fe])continue;const _e={...ve.featureAttributes[fe],byteOffset:be,count:Ce};we.featureAttributes[fe]=_e,be+=("UInt64"===_e.valueType?8:E$1(_e.valueType))*_e.valuesPerElement*Ce}}return y$2(be,fe.byteLength,"geometry"),we.byteCount=be-we.byteOffset,we}function p$b(fe,ve){return fe&&fe.compressedAttributes&&"draco"===fe.compressedAttributes.encoding?function v16(fe){const ve={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const _e of fe)switch(_e){case"position":break;case"normal":ve.normal=!0;break;case"uv0":ve.uv0=!0;break;case"color":ve.color=!0;break;case"uv-region":ve.uvRegion=!0;break;case"feature-index":ve.featureIndex=!0}return ve}(fe.compressedAttributes.attributes):fe?function g24(fe){return{isDraco:!1,isLegacy:!1,color:null!=fe.color,normal:null!=fe.normal,uv0:null!=fe.uv0,uvRegion:null!=fe.uvRegion,featureIndex:null!=fe.faceRange&&null!=fe.featureId}}(fe):function m$6(fe){const ve={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const _e of fe.ordering)if(fe.vertexAttributes[_e])switch(_e){case"position":break;case"normal":ve.normal=!0;break;case"color":ve.color=!0;break;case"uv0":ve.uv0=!0;break;case"region":ve.uvRegion=!0}return fe.featureAttributes&&fe.featureAttributeOrder&&(ve.featureIndex=!0),ve}(ve)}const EAe={position:nO.POSITION,normal:nO.NORMAL,color:nO.COLOR,uv0:nO.UV0,region:nO.UVREGION};function I11(fe,ve,_e){if("lepcc-rgb"===fe.encoding)return u$8(ve);if("lepcc-intensity"===fe.encoding)return w$1(ve);if(null!=fe.encoding&&""!==fe.encoding)throw new Ir("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");fe["attributeByteCounts "]&&!fe.attributeByteCounts&&(u$7().warn("Warning: Trailing space in 'attributeByteCounts '."),fe.attributeByteCounts=fe["attributeByteCounts "]),"ObjectIds"===fe.ordering[0]&&fe.hasOwnProperty("objectIds")&&(u$7().warn("Warning: Case error in objectIds"),fe.ordering[0]="objectIds");const be=function b20(fe,ve,_e){const be=null!=ve.header?s$2(fe,ve.header):{byteOffset:0,byteCount:0,fields:{count:_e}},we={header:be,byteOffset:be.byteCount,byteCount:0,entries:Object.create(null)};let Se=be.byteCount;for(let Te=0;Te<ve.ordering.length;Te++){const fe=ve.ordering[Te],_e=a$4H(ve[fe]);if(_e.count=be.fields.count??0,"String"===_e.valueType){if(_e.byteOffset=Se,_e.byteCount=be.fields[fe+"ByteCount"],"UTF-8"!==_e.encoding)throw new Ir("unsupported-encoding","Unsupported String encoding.",{encoding:_e.encoding});if(_e.timeEncoding&&"ECMA_ISO8601"!==_e.timeEncoding)throw new Ir("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:_e.timeEncoding})}else{if(!O$2(_e.valueType))throw new Ir("unsupported-value-type","Unsupported binary valueType",{valueType:_e.valueType});{const fe=E$1(_e.valueType);Se+=Se%fe!=0?fe-Se%fe:0,_e.byteOffset=Se,_e.byteCount=fe*_e.valuesPerElement*_e.count}}Se+=_e.byteCount??0,we.entries[fe]=_e}return we.byteCount=Se-we.byteOffset,we}(ve,fe,_e);y$2(be.byteOffset+be.byteCount,ve.byteLength,"attribute");const we=be.entries.attributeValues||be.entries.objectIds;if(we){if("String"===we.valueType){const fe=be.entries.attributeByteCounts,_e=l$6(ve,fe),Se=function d$3(fe,ve){return new Uint8Array(fe,ve.byteOffset,ve.byteCount)}(ve,we);return we.timeEncoding?function c$8(fe,ve,_e){return f$3(fe,ve,_e).map((fe=>{const ve=fe?Date.parse(fe):null;return null==ve||Number.isNaN(ve)?null:ve}))}(fe.count,_e,Se):f$3(fe.count,_e,Se)}return l$6(ve,we)}throw new Ir("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const PAe={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},CAe={Float32:(fe,ve)=>new DataView(fe,0).getFloat32(ve,!0),Float64:(fe,ve)=>new DataView(fe,0).getFloat64(ve,!0),UInt8:(fe,ve)=>new DataView(fe,0).getUint8(ve),Int8:(fe,ve)=>new DataView(fe,0).getInt8(ve),UInt16:(fe,ve)=>new DataView(fe,0).getUint16(ve,!0),Int16:(fe,ve)=>new DataView(fe,0).getInt16(ve,!0),UInt32:(fe,ve)=>new DataView(fe,0).getUint32(ve,!0),Int32:(fe,ve)=>new DataView(fe,0).getInt32(ve,!0)};function O$2(fe){return PAe.hasOwnProperty(fe)}function E$1(fe){return O$2(fe)?PAe[fe].BYTES_PER_ELEMENT:0}function n$7(fe,ve,_e,be,we){const Se="east-north-up"===_e?t$47(fe):function c$7(fe,ve,_e){const be=[0,0,0],we=fe[3],Se=2**(Math.ceil(Math.log(we)*Math.LOG2E/AAe)*AAe+OAe);if(_e.isGeographic){const ve=Se/s$45(_e).radius*180/Math.PI,we=Math.round(fe[1]/ve),Te=Math.max(-90,Math.min(90,we*ve)),Ee=ve/Math.cos((Math.abs(Te)-ve/2)/180*Math.PI),Ce=Math.round(fe[0]/Ee)*Ee;be[0]=Ce,be[1]=Te}else{const ve=Math.round(fe[0]/Se),_e=Math.round(fe[1]/Se);be[0]=ve*Se,be[1]=_e*Se}const Te=fe[2]+ve,Ee=Math.round(Te/Se);return be[2]=Ee*Se,be}(fe,ve,be),Te=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u$3m(be,Se,Te,we),Te}const OAe=1,AAe=5-OAe;function U$2(fe){return fe?parseInt(fe.substring(fe.lastIndexOf("/")+1,fe.length),10):void 0}function N13(fe){var ve;if(has("disable-feature:i3s-draco")||!fe)return!1;for(const _e of fe)for(const fe of _e.geometryBuffers)if("draco"===(null==(ve=fe.compressedAttributes)?void 0:ve.encoding))return!0;return!1}function k8(fe,ve,_e,be){_e.traverse(ve,(ve=>{const _e=ve.serviceMbsInIndexSR;return(null!=_e&&O$1(fe,_e))!==RAe.OUTSIDE&&(be(ve),!0)}))}function D4(fe,ve,_e){let be=0,we=0;for(let Se=0;Se<ve.length&&be<fe.length;Se++)fe[be]===ve[Se]&&(_e(Se)&&(fe[we]=fe[be],we++),be++);fe.length=we}function W4(fe,ve,_e){let be=0,we=0;for(;be<_e.length;)w$24(fe,_e[be])>=0===ve&&(_e[we]=_e[be],we++),be++;_e.length=we}const MAe=u$3J();function q7(fe,ve){if(0===ve.rotationScale[1]&&0===ve.rotationScale[2]&&0===ve.rotationScale[3]&&0===ve.rotationScale[5]&&0===ve.rotationScale[6]&&0===ve.rotationScale[7])return MAe[0]=(fe[0]-ve.position[0])/ve.rotationScale[0],MAe[1]=(fe[1]-ve.position[1])/ve.rotationScale[4],MAe[2]=(fe[2]-ve.position[0])/ve.rotationScale[0],MAe[3]=(fe[3]-ve.position[1])/ve.rotationScale[4],MAe}var RAe;function O$1(fe,ve){const _e=ve[0],be=ve[1],we=ve[3],Se=fe[0]-_e,Te=_e-fe[2],Ee=fe[1]-be,Ce=be-fe[3],Oe=Math.max(Se,Te,0),Re=Math.max(Ee,Ce,0),De=Oe*Oe+Re*Re;return De>we*we?RAe.OUTSIDE:De>0?RAe.INTERSECTS_CENTER_OUTSIDE:-Math.max(Se,Te,Ee,Ce)>we?RAe.INSIDE:RAe.INTERSECTS_CENTER_INSIDE}function L$1(fe,ve,_e){const be=[],we=null==_e?void 0:_e.missingFields,Se=null==_e?void 0:_e.originalFields;for(const Te of fe){const fe=Te.toLowerCase();let _e=!1;for(const we of ve)if(fe===we.name.toLowerCase()){be.push(we.name),_e=!0,Se&&Se.push(Te);break}!_e&&we&&we.push(Te)}return be}async function A$1(fe,ve,_e,be,we,Se){if(0===ve.length)return[];const Te=fe.attributeStorageInfo;if(null!=fe.associatedLayer)try{return await async function P$1(fe,ve,_e,be,we){ve.sort(((fe,ve)=>fe.attributes[_e]-ve.attributes[_e]));const Se=ve.map((fe=>fe.attributes[_e])),Te=[],Ee=L$1(be,fe.fields,{originalFields:Te}),Ce=await B10(fe,Se,Ee,we);for(let Oe=0;Oe<ve.length;Oe++){const fe=ve[Oe],_e=Ce[Oe],be={};if(fe.attributes)for(const ve in fe.attributes)be[ve]=fe.attributes[ve];for(let ve=0;ve<Te.length;ve++)be[Te[ve]]=_e[Ee[ve]];fe.attributes=be}return ve}(fe.associatedLayer,ve,_e,be,Se)}catch(Yf){if(fe.associatedLayer.loaded)throw Yf}if(Te){const Ee=function K$1(fe,ve,_e){const be=new Map,we=[],Se=_e();for(const Te of fe){const fe=Te.attributes[ve];for(let ve=0;ve<Se.length;ve++){const _e=Se[ve],Ee=_e.featureIds.indexOf(fe);if(Ee>=0){let fe=be.get(_e.node);fe||(fe={node:_e.node,indices:[],graphics:[]},we.push(fe),be.set(_e.node,fe)),fe.indices.push(Ee),fe.graphics.push(Te);for(let _e=ve;_e>0;_e--)Se[_e]=Se[_e-1];Se[0]=_e;break}}}return we}(ve,_e,we);if(null==Ee)throw new Ir("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ce=fe.parsedUrl.path;return(await Promise.all(Ee.map((ve=>function G9(fe,ve,_e,be,we,Se,Te,Ee){return $4(fe,ve,_e.resources.attributes,be,we,Se,Te,Ee)}(Ce,Te,ve.node,ve.indices,be,fe.apiKey,fe.customParameters,Se).then((fe=>{for(let _e=0;_e<ve.graphics.length;_e++){const be=ve.graphics[_e],we=fe[_e];if(be.attributes)for(const fe in be.attributes)fe in we||(we[fe]=be.attributes[fe]);be.attributes=we}return ve.graphics})))))).flat()}throw new Ir("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function B10(fe,ve,_e,be){const we=fe.capabilities.query.maxRecordCount;if(null!=we&&ve.length>we){const Se=p$59(ve,we);return Promise.all(Se.map((ve=>B10(fe,ve,_e,be)))).then((fe=>fe.flat()))}const Se=new FE({objectIds:ve,outFields:_e,orderByFields:[fe.objectIdField]});return fe.queryFeatures(Se,be).then((fe=>{if(fe&&fe.features&&fe.features.length===ve.length)return fe.features.map((fe=>fe.attributes));throw new Ir("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}async function $4(fe,ve,_e,be,we,Se,Te,Ee){const Ce=[];for(const De of ve)if(De&&we.includes(De.name)){const ve=`${fe}/nodes/${_e}/attributes/${De.key}/0`;Ce.push({url:ve,storageInfo:De})}const Oe=await Promise.allSettled(Ce.map((fe=>U$1a(fe.url,{responseType:"array-buffer",query:{...Te,token:Se},signal:null==Ee?void 0:Ee.signal}).then((ve=>I11(fe.storageInfo,ve.data)))))),Re=[];for(const De of be){const fe={};for(let ve=0;ve<Oe.length;ve++){const _e=Oe[ve];if("fulfilled"===_e.status){const be=_e.value;fe[Ce[ve].storageInfo.name]=Q$1(be,De)}}Re.push(fe)}return Re}!function(fe){fe[fe.OUTSIDE=0]="OUTSIDE",fe[fe.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",fe[fe.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",fe[fe.INSIDE=3]="INSIDE"}(RAe||(RAe={}));const IAe=-32768,LAe=-(2**31);function Q$1(fe,ve){if(!fe)return null;const _e=fe[ve];return c$54(fe)?_e===IAe?null:_e:a$4I(fe)?_e===LAe?null:_e:_e!=_e?null:_e}function Z5(fe){const ve=fe.store,_e=ve.indexCRS||ve.geographicCRS,be=void 0===_e?ve.indexWKT:void 0;if(be){if(!fe.spatialReference)throw new Ir("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(be!==fe.spatialReference.wkt)throw new Ir("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const we=_e?new zo(U$2(_e)):fe.spatialReference;return we.equals(fe.spatialReference)?fe.spatialReference:we}function H$1(fe){const ve=fe.store,_e=ve.vertexCRS||ve.projectedCRS,be=void 0===_e?ve.vertexWKT:void 0;if(be){if(!fe.spatialReference)throw new Ir("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(be!==fe.spatialReference.wkt)throw new Ir("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const we=_e?new zo(U$2(_e)):fe.spatialReference;return we.equals(fe.spatialReference)?fe.spatialReference:we}function J4(fe,ve){return null==ve?"@null":ve===a$40(ve)?"@ECEF":fe.equals(ve)?"":null!=ve.wkid?"@"+ve.wkid:null}function X3(fe,ve,_e){if(!J$G(fe,ve))throw new Ir("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===_e&&!function ee3(fe,ve){return fe.equals(ve)||fe.isWGS84&&ve.isWebMercator||fe.isWebMercator&&ve.isWGS84}(fe,ve))throw new Ir("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Y3(fe,ve,_e){var be,we,Se,Te;if((null==(be=fe.serviceUpdateTimeStamp)?void 0:be.lastUpdate)!==(null==(we=ve.serviceUpdateTimeStamp)?void 0:we.lastUpdate)||!_e.isEmpty||(null==(Se=fe.associatedLayer)?void 0:Se.url)!==(null==(Te=ve.associatedLayer)?void 0:Te.url))throw new Ir("layerview:recycle-failed")}function te2(fe,ve,_e){const be=Z5(fe),we=H$1(fe);X3(be,ve,_e),X3(we,ve,_e)}function oe2(fe){var ve;if(null==(null==(ve=fe.store)?void 0:ve.defaultGeometrySchema)||!function re(fe){var ve;return!(null!=fe.geometryType&&"triangles"!==fe.geometryType||null!=fe.topology&&"PerAttributeArray"!==fe.topology||null==(null==(ve=fe.vertexAttributes)?void 0:ve.position))}(fe.store.defaultGeometrySchema))throw new Ir("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:fe.parsedUrl.path})}function ne2(fe,ve){te2(fe,ve.spatialReference,ve.viewingMode)}function ae(fe){var ve;if(null==(null==(ve=fe.store)?void 0:ve.defaultGeometrySchema)||!function ie2(fe){var ve;return!(null==fe.geometryType||"points"!==fe.geometryType||null!=fe.topology&&"PerAttributeArray"!==fe.topology||null!=fe.encoding&&""!==fe.encoding&&"lepcc-xyz"!==fe.encoding||null==(null==(ve=fe.vertexAttributes)?void 0:ve.position))}(fe.store.defaultGeometrySchema))throw new Ir("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function se(fe,ve){X3(fe.spatialReference,ve.spatialReference,ve.viewingMode)}function ce(fe){return"mesh-3d"===fe.type}function ue(fe){var ve;if(null==fe||!function le3(fe){return"simple"===fe.type||"class-breaks"===fe.type||"unique-value"===fe.type}(fe))return!0;if(("unique-value"===fe.type||"class-breaks"===fe.type)&&null==fe.defaultSymbol)return!0;const _e=fe.getSymbols();if(0===_e.length)return!0;for(const be of _e){if(!ce(be)||0===be.symbolLayers.length)return!0;for(const fe of be.symbolLayers.items)if("fill"!==fe.type||null==(null==(ve=fe.material)?void 0:ve.color)||"replace"!==fe.material.colorMixMode)return!0}return!1}const DAe=g$1f({color:[0,0,0,0],opacity:0});class pe2{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function me2(fe){const ve=new pe2;let _e=!1,be=!1;for(const we of fe.symbolLayers.items)if("fill"===we.type&&we.enabled){const fe=we.material,Se=we.edges;if(null!=fe&&!_e){const be=fe.color,Se=e$2a(fe.colorMixMode);ve.material=null!=be?{color:[be.r/255,be.g/255,be.b/255],alpha:be.a,colorMixMode:Se}:{color:[1,1,1],alpha:1,colorMixMode:pH.Multiply},ve.castShadows=we.castShadows,_e=!0}null==Se||be||(ve.edgeMaterial=f$1G(Se,{}),be=!0)}return ve.material||(ve.material={color:[1,1,1],alpha:1,colorMixMode:pH.Multiply}),ve}function de2(fe,ve){return(0|fe)+(0|ve)|0}function he2(fe,ve,_e,be,we,Se,Te){if(!Se||0===Se.length||null==ve||!fe.serviceMbsInIndexSR)return null;const Ee=n$7(fe.serviceMbsInIndexSR,we,"none",_e,ve);h$2A(BAe,Ee);let Ce=null;let Oe=1/0,Re=-1/0;const T14=Se=>{if("replace"!==Se.type)return;const Ee=Se.geometry;if(!(null==Ee?void 0:Ee.hasZ))return;D$19(FAe);const De=Ee.spatialReference||be,Be=Ee.rings.reduce(((fe,_e)=>_e.reduce(((fe,_e)=>(o$44(UAe,_e[0],_e[1],_e[2]),n$3Y(UAe,De,UAe,ve),O$1v(UAe,UAe,BAe),f$31(FAe,UAe),Math.min(UAe[2],fe))),fe)),1/0);(()=>{if(!Ce)if(Ce=NAe,D$19(zAe),null!=fe.serviceObbInIndexSR){fe.serviceObbInIndexSR.transform(kAe,_e,ve,we,Te),kAe.getCorners(Ce);for(const fe of Ce)O$1v(fe,fe,BAe),f$31(zAe,fe)}else{const be=fe.serviceMbsInIndexSR;if(!be)return;const Se=be[3];n$3Y(be,_e,UAe,ve),O$1v(UAe,UAe,BAe),UAe[2]+=we;for(let fe=0;fe<8;++fe){const ve=1&fe?Se:-Se,_e=2&fe?Se:-Se,be=4&fe?Se:-Se,we=Ce[fe];r$3w(we,[UAe[0]+ve,UAe[1]+_e,UAe[2]+be]),f$31(zAe,we)}}})(),E$1H(zAe,FAe)&&(Oe=Math.min(Oe,Be),Re=Math.max(Re,Be))};if(Se.forEach((fe=>T14(fe))),Oe===1/0)return null;for(let Xe=0;Xe<8;++Xe)De=VAe.data,Be=3*Xe,Ze=Ce[Xe],O$1v(UAe,Ze,Ee),De[Be]=UAe[0],De[Be+1]=UAe[1],De[Be+2]=UAe[2],Be+=24,Ze[2]=Oe,O$1v(UAe,Ze,Ee),De[Be]=UAe[0],De[Be+1]=UAe[1],De[Be+2]=UAe[2],Be+=24,Ze[2]=Re,O$1v(UAe,Ze,Ee),De[Be]=UAe[0],De[Be+1]=UAe[1],De[Be+2]=UAe[2];var De,Be,Ze;return J$z(VAe)}function ye(fe){return fe[3]>=0}function ge(fe){null!=fe&&(fe[3]=-1)}const NAe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],FAe=u$3J(),zAe=u$3J(),kAe=new cy,UAe=[0,0,0],VAe={data:new Array(72),size:3,exclusive:!0,stride:3},BAe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];async function n$6(fe,ve=fe.popupTemplate){var _e,be;if(null==ve)return[];const we=await ve.getRequiredFields(fe.fieldsIndex),{lastEditInfoEnabled:Se}=ve,{objectIdField:Te,typeIdField:Ee,globalIdField:Ce,relationships:Oe}=fe;if(we.includes("*"))return["*"];const Re=Se?function j$1l(fe){return fe?I$1h(fe.fieldsIndex,z$T(fe)):[]}(fe):[],De=I$1h(fe.fieldsIndex,[...we,...Re]);return Ee&&De.push(Ee),De&&Te&&(null==(_e=fe.fieldsIndex)?void 0:_e.has(Te))&&!De.includes(Te)&&De.push(Te),De&&Ce&&(null==(be=fe.fieldsIndex)?void 0:be.has(Ce))&&!De.includes(Ce)&&De.push(Ce),Oe&&Oe.forEach((ve=>{var _e;const{keyField:be}=ve;De&&be&&(null==(_e=fe.fieldsIndex)?void 0:_e.has(be))&&!De.includes(be)&&De.push(be)})),De}function p$a(fe,ve){return fe.popupTemplate?fe.popupTemplate:null!=ve&&ve.defaultPopupTemplateEnabled&&null!=fe.defaultPopupTemplate?fe.defaultPopupTemplate:null}function u$6(fe,ve){return null!=p$a(fe,{defaultPopupTemplateEnabled:ve})}const jAe=s$6();let GAe=class extends(Sv.LoadableMixin(n$3T(cAe))){constructor(fe){super(fe),this.type="building-component",this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){var fe,ve;return this.layer?{path:`${null==(fe=this.layer.parsedUrl)?void 0:fe.path}/sublayers/${this.id}`,query:null==(ve=this.layer.parsedUrl)?void 0:ve.query}:{path:""}}get fieldsIndex(){return new YTe(this.fields)}readAssociatedLayer(fe,ve){const _e=this.layer.associatedFeatureServiceItem,be=ve.associatedLayerID;return null!=_e&&"number"==typeof be?new oAe({portalItem:_e,customParameters:this.customParameters,layerId:be}):null}get objectIdField(){if(null!=this.fields)for(const fe of this.fields)if("oid"===fe.type)return fe.name;return null}get displayField(){return null!=this.associatedLayer?this.associatedLayer.displayField:void 0}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(fe){const ve=null!=fe?fe.signal:null,_e=this._fetchService(ve).then((()=>{this.indexInfo=r$2(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,ar.getLogger(this),ve)}));return this.addResolvingPromise(_e),Promise.resolve(this)}createPopupTemplate(fe){return p$d(this,fe)}async _fetchService(fe){const ve=(await U$1a(this.parsedUrl.path,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:fe})).data;this.read(ve,{origin:"service",url:this.parsedUrl})}getField(fe){return this.fieldsIndex.get(fe)}getFieldDomain(fe,ve){var _e,be,we;const Se=null==(be=null==(_e=this.getFeatureType(null==ve?void 0:ve.feature))?void 0:_e.domains)?void 0:be[fe];return Se&&"inherited"!==Se.type?Se:(null==(we=this.getField(fe))?void 0:we.domain)??null}getFeatureType(fe){return fe&&null!=this.associatedLayer?this.associatedLayer.getFeatureType(fe):null}get types(){return null!=this.associatedLayer?this.associatedLayer.types??[]:[]}get typeIdField(){return null!=this.associatedLayer?this.associatedLayer.typeIdField:null}get geometryType(){return"3d-object"===this.layerType?"mesh":"point"}get profile(){return"3d-object"===this.layerType?"mesh-pyramids":"points"}get capabilities(){const fe=null!=this.associatedLayer&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:uAe,{query:ve,data:{supportsZ:_e,supportsM:be,isVersioned:we}}=fe;return{query:ve,data:{supportsZ:_e,supportsM:be,isVersioned:we}}}createQuery(){const fe=new FE;return"mesh"!==this.geometryType&&(fe.returnGeometry=!0,fe.returnZ=!0),fe.where=this.definitionExpression||"1=1",fe.sqlFormat="standard",fe}queryExtent(fe,ve){return this._getAssociatedLayerForQuery().then((_e=>_e.queryExtent(fe||this.createQuery(),ve)))}queryFeatureCount(fe,ve){return this._getAssociatedLayerForQuery().then((_e=>_e.queryFeatureCount(fe||this.createQuery(),ve)))}queryFeatures(fe,ve){return this._getAssociatedLayerForQuery().then((_e=>_e.queryFeatures(fe||this.createQuery(),ve))).then((fe=>{if(null==fe?void 0:fe.features)for(const ve of fe.features)ve.layer=this.layer,ve.sourceLayer=this;return fe}))}queryObjectIds(fe,ve){return this._getAssociatedLayerForQuery().then((_e=>_e.queryObjectIds(fe||this.createQuery(),ve)))}async queryCachedAttributes(fe,ve){const _e=x$1j(this.fieldsIndex,await n$6(this,p$a(this)));return $4(this.parsedUrl.path,this.attributeStorageInfo,fe,ve,_e,this.apiKey,this.customParameters)}async queryCachedFeature(fe,ve){const _e=await this.queryCachedAttributes(fe,[ve]);if(!_e||0===_e.length)throw new Ir("scenelayer:feature-not-in-cached-data","Feature not found in cached data");return new RT({attributes:_e[0],layer:this,sourceLayer:this})}getFieldUsageInfo(fe){return this.fieldsIndex.has(fe)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:null!=this.associatedLayer}}_getAssociatedLayerForQuery(){const fe=this.associatedLayer;return null!=fe&&fe.loaded?Promise.resolve(fe):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),null==this.associatedLayer)throw new Ir("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(vr){throw new Ir("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:vr})}return this.associatedLayer}};e$4o([y$2v({readOnly:!0})],GAe.prototype,"parsedUrl",null),e$4o([y$2v({type:hAe,readOnly:!0})],GAe.prototype,"nodePages",void 0),e$4o([y$2v({type:[fAe],readOnly:!0})],GAe.prototype,"materialDefinitions",void 0),e$4o([y$2v({type:[yAe],readOnly:!0})],GAe.prototype,"textureSetDefinitions",void 0),e$4o([y$2v({type:[$Ae],readOnly:!0})],GAe.prototype,"geometryDefinitions",void 0),e$4o([y$2v({readOnly:!0})],GAe.prototype,"serviceUpdateTimeStamp",void 0),e$4o([y$2v({readOnly:!0})],GAe.prototype,"store",void 0),e$4o([y$2v({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],GAe.prototype,"rootNode",void 0),e$4o([y$2v({readOnly:!0})],GAe.prototype,"attributeStorageInfo",void 0),e$4o([y$2v(jAe.fields)],GAe.prototype,"fields",void 0),e$4o([y$2v({readOnly:!0})],GAe.prototype,"fieldsIndex",null),e$4o([y$2v({readOnly:!0,type:oAe})],GAe.prototype,"associatedLayer",void 0),e$4o([o$40("service","associatedLayer",["associatedLayerID"])],GAe.prototype,"readAssociatedLayer",null),e$4o([y$2v(jAe.outFields)],GAe.prototype,"outFields",void 0),e$4o([y$2v({type:String,readOnly:!0})],GAe.prototype,"objectIdField",null),e$4o([y$2v({readOnly:!0,type:String,json:{read:!1}})],GAe.prototype,"displayField",null),e$4o([y$2v({readOnly:!0,type:String})],GAe.prototype,"apiKey",null),e$4o([y$2v({readOnly:!0,type:String})],GAe.prototype,"customParameters",null),e$4o([y$2v({readOnly:!0,type:aa})],GAe.prototype,"fullExtent",null),e$4o([y$2v({readOnly:!0,type:zo})],GAe.prototype,"spatialReference",null),e$4o([y$2v({readOnly:!0})],GAe.prototype,"version",null),e$4o([y$2v({readOnly:!0,type:Nwe})],GAe.prototype,"elevationInfo",null),e$4o([y$2v({readOnly:!0,type:Number})],GAe.prototype,"minScale",null),e$4o([y$2v({readOnly:!0,type:Number})],GAe.prototype,"maxScale",null),e$4o([y$2v({readOnly:!0,type:Number})],GAe.prototype,"effectiveScaleRange",null),e$4o([y$2v({type:["hide","show"],json:{write:!0}})],GAe.prototype,"listMode",void 0),e$4o([y$2v({types:jEe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],GAe.prototype,"renderer",void 0),e$4o([y$2v({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],GAe.prototype,"definitionExpression",void 0),e$4o([y$2v(Qwe)],GAe.prototype,"popupEnabled",void 0),e$4o([y$2v({type:ew,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],GAe.prototype,"popupTemplate",void 0),e$4o([y$2v({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],GAe.prototype,"normalReferenceFrame",void 0),e$4o([y$2v({readOnly:!0,json:{read:!1}})],GAe.prototype,"defaultPopupTemplate",null),e$4o([y$2v()],GAe.prototype,"types",null),e$4o([y$2v()],GAe.prototype,"typeIdField",null),e$4o([y$2v({json:{write:!1}}),o$3g(new An({"3DObject":"3d-object",Point:"point"}))],GAe.prototype,"layerType",void 0),e$4o([y$2v()],GAe.prototype,"geometryType",null),e$4o([y$2v()],GAe.prototype,"profile",null),e$4o([y$2v({readOnly:!0,json:{read:!1}})],GAe.prototype,"capabilities",null),e$4o([y$2v({readOnly:!0})],GAe.prototype,"statisticsInfo",void 0),GAe=e$4o([a$4y("esri.layers.buildingSublayers.BuildingComponentSublayer")],GAe);const HAe=GAe;var qAe;const WAe={type:Wa,readOnly:!0,json:{origins:{service:{read:{source:"sublayers",reader:p$9}}},read:!1}};function p$9(fe,ve,_e){if(fe&&Array.isArray(fe))return new Wa(fe.map((fe=>{const ve=function y$1(fe){return"group"===fe.layerType?YAe:HAe}(fe);if(ve){const be=new ve;return be.read(fe,_e),be}return(null==_e?void 0:_e.messages)&&fe&&_e.messages.push(new Mi("building-scene-layer:unsupported-sublayer-type","Building scene sublayer of type '"+(fe.type||"unknown")+"' are not supported",{definition:fe,context:_e})),null})))}let YAe=qAe=class extends cAe{constructor(fe){super(fe),this.type="building-group",this.listMode="show",this.sublayers=null}loadAll(){return a$3S(this,(fe=>qAe.forEachSublayer(this.sublayers,(ve=>{"building-group"!==ve.type&&fe(ve)}))))}};e$4o([y$2v({type:["hide","show","hide-children"],json:{write:!0}})],YAe.prototype,"listMode",void 0),e$4o([y$2v(WAe)],YAe.prototype,"sublayers",void 0),YAe=qAe=e$4o([a$4y("esri.layers.buildingSublayers.BuildingGroupSublayer")],YAe),function(fe){fe.sublayersProperty=WAe,fe.readSublayers=p$9,fe.forEachSublayer=function e76(fe,ve){fe.forEach((fe=>{ve(fe),"building-group"===fe.type&&e76(fe.sublayers,ve)}))}}(YAe||(YAe={}));const ZAe=YAe;function i$5(fe){return fe&&"getAtOrigin"in fe&&"originOf"in fe}function i$4(fe){(null==fe?void 0:fe.writtenProperties)&&fe.writtenProperties.forEach((({target:fe,propName:ve,newOrigin:_e})=>{i$5(fe)&&_e&&fe.originOf(ve)!==_e&&fe.updateOrigin(ve,_e)}))}function l$4(fe){const ve=fe.lastIndexOf("/");return-1===ve?[".",fe]:[fe.slice(0,ve),fe.slice(ve+1)]}function i$3(fe){const[ve,_e]=function u$4(fe){const ve=Ht$2(fe);return null==ve?[fe,""]:[fe.slice(0,fe.length-ve.length-1),`.${ve}`]}(fe),[be,we]=l$4(ve);return[be,we,_e]}async function p$8(fe){return"blob"===fe.type?fe.blob:"json"===fe.type?new Blob([fe.jsonString],{type:"application/json"}):(await U$1a(fe.url,{responseType:"blob"})).data}function m$5(fe,ve){if(!fe.hasPath())return null;const[_e,,be]=i$3(fe.path);return fe.portalItem.resourceFromPath(V$19(_e,ve+be))}const XAe=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:async function a$2(fe,ve,_e,be){const we=new Map;for(const{resource:Te,content:Ee,compress:Ce,access:Oe}of ve){if(!Te.hasPath())throw new Ir(`portal-item-resource-${_e}:invalid-path`,"Resource does not have a valid path");const[fe,ve]=l$4(Te.path),be=`${fe}/${Ce??""}/${Oe??""}`;we.has(be)||we.set(be,{prefix:fe,compress:Ce,access:Oe,files:[]}),we.get(be).files.push({fileName:ve,content:Ee})}await fe.load(be);const Se=V$19(fe.userItemUrl,"add"===_e?"addResources":"updateResources");for(const{prefix:Te,compress:Ee,access:Ce,files:Oe}of we.values()){const ve=25;for(let _e=0;_e<Oe.length;_e+=ve){const we=Oe.slice(_e,_e+ve),Re=new FormData;Te&&"."!==Te&&Re.append("resourcesPrefix",Te),Ee&&Re.append("compress","true"),Ce&&Re.append("access",Ce);let De=0;for(const{fileName:fe,content:ve}of we)Re.append("file"+ ++De,ve,fe);Re.append("f","json"),await fe.portal.request(Se,{method:"post",body:Re,signal:null==be?void 0:be.signal})}}},contentToBlob:p$8,fetchResources:async function o$1(fe,ve={},_e){await fe.load(_e);const be=V$19(fe.itemUrl,"resources"),{start:we=1,num:Se=10,sortOrder:Te="asc",sortField:Ee="resource"}=ve,Ce={query:{start:we,num:Se,sortOrder:Te,sortField:Ee,token:fe.apiKey},signal:null==_e?void 0:_e.signal},Oe=await fe.portal.request(be,Ce);return{total:Oe.total,nextStart:Oe.nextStart,resources:Oe.resources.map((({created:ve,size:_e,resource:be})=>({created:new Date(ve),size:_e,resource:fe.resourceFromPath(be)})))}},getSiblingOfSameType:function f$2(fe,ve){if(!fe.hasPath())return null;const[_e,,be]=i$3(fe.path);return fe.portalItem.resourceFromPath(V$19(_e,ve+be))},getSiblingOfSameTypeI:m$5,removeAllResources:async function c$5(fe,ve){await fe.load(ve);const _e=V$19(fe.userItemUrl,"removeResources");return fe.portal.request(_e,{method:"post",query:{deleteAll:!0},signal:null==ve?void 0:ve.signal})},removeResource:async function n$4(fe,ve,_e){if(!ve.hasPath())throw new Ir("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await fe.load(_e);const be=V$19(fe.userItemUrl,"removeResources");await fe.portal.request(be,{method:"post",query:{resource:ve.path},signal:null==_e?void 0:_e.signal}),ve.portalItem=null},splitPrefixFileNameAndExtension:i$3},Symbol.toStringTag,{value:"Module"}));async function p$7(fe,ve,_e){const be=await u$3(fe,ve,_e);await h32(be,ve,_e)}async function u$3(fe,ve,_e){if(!(null==ve?void 0:ve.resources))return;const be=ve.portalItem===fe.portalItem?new Set(fe.paths):new Set;fe.paths.length=0,fe.portalItem=ve.portalItem;const we=new Set(ve.resources.toKeep.map((fe=>fe.resource.path))),Se=new Set,Te=[];we.forEach((ve=>{be.delete(ve),fe.paths.push(ve)}));const Ee=[],Ce=[],Oe=[];for(const De of ve.resources.toUpdate)if(be.delete(De.resource.path),we.has(De.resource.path)||Se.has(De.resource.path)){const{resource:ve,content:_e,finish:be}=De,we=m$5(ve,n$Q());fe.paths.push(we.path),Ee.push({resource:we,content:await p$8(_e),compress:De.compress}),be&&Oe.push((()=>be(we)))}else{fe.paths.push(De.resource.path),Ce.push({resource:De.resource,content:await p$8(De.content),compress:De.compress});const ve=De.finish;ve&&Oe.push((()=>ve(De.resource))),Se.add(De.resource.path)}for(const De of ve.resources.toAdd)if(fe.paths.push(De.resource.path),be.has(De.resource.path))be.delete(De.resource.path);else{Ee.push({resource:De.resource,content:await p$8(De.content),compress:De.compress});const fe=De.finish;fe&&Oe.push((()=>fe(De.resource)))}if(Ee.length||Ce.length){const{addOrUpdateResources:fe}=await zt((()=>Promise.resolve().then((()=>XAe))),void 0);await fe(ve.portalItem,Ee,"add",_e),await fe(ve.portalItem,Ce,"update",_e)}if(Oe.forEach((fe=>fe())),0===Te.length)return be;const Re=await async function P$1h(fe){return(await Promise.allSettled(fe)).filter((fe=>"rejected"===fe.status)).map((fe=>fe.reason))}(Te);if(s$4o(_e),Re.length>0)throw new Ir("save:resources","Failed to save one or more resources",{errors:Re});return be}async function h32(fe,ve,_e){if(!fe||!ve.portalItem)return;const be=[];for(const we of fe){const fe=ve.portalItem.resourceFromPath(we);be.push(fe.portalItem.removeResource(fe,_e))}await v$28(be)}function i$2(fe){if(ir.apiKey&&c$4K(fe.portal.url))throw new Ir("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${fe.portal.url} when using an api key`)}async function r64(fe){const ve=[];for(const _e of fe.allLayers)if("beforeSave"in _e&&"function"==typeof _e.beforeSave){const fe=_e.beforeSave();fe&&ve.push(fe)}await Promise.allSettled(ve)}const JAe=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function t$3(fe,ve,_e){let be=(fe.messages??[]).filter((({type:fe})=>"error"===fe)).map((({name:fe,message:ve,details:_e})=>new Ir(fe,ve,_e)));if(fe.blockedRelativeUrls&&(be=be.concat(fe.blockedRelativeUrls.map((fe=>new Ir("url:unsupported",`Relative url '${fe}' is not supported`))))),_e){const{ignoreUnsupported:fe,supplementalUnsupportedErrors:ve=[],requiredPropertyChecksDisabled:we}=_e;fe&&(be=be.filter((({name:fe})=>!(JAe.has(fe)||ve.includes(fe))))),we&&(be=be.filter((fe=>"web-document-write:property-required"!==fe.name)))}if(be.length>0)throw new Ir(ve.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:be})}const L9=fe=>{let ve=class extends fe{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=k$1C((async(fe,ve,_e)=>{switch(fe){case rMe.SAVE:return this._save(ve);case rMe.SAVE_AS:return this._saveAs(_e,ve)}}))}readSpatialReference(fe,ve){return T13(ve)}readFullExtent(fe,ve,_e){if(null!=fe&&"object"==typeof fe){const be=null==fe.spatialReference?{...fe,spatialReference:T13(ve)}:fe;return aa.fromJSON(be,_e)}const be=ve.store,we=T13(ve);return null==we||null==(null==be?void 0:be.extent)||!Array.isArray(be.extent)||be.extent.some((fe=>fe<QAe))?null:new aa({xmin:be.extent[0],ymin:be.extent[1],xmax:be.extent[2],ymax:be.extent[3],spatialReference:we})}parseVersionString(fe){const ve={major:Number.NaN,minor:Number.NaN,versionString:fe},_e=fe.split(".");return _e.length>=2&&(ve.major=parseInt(_e[0],10),ve.minor=parseInt(_e[1],10)),ve}readVersion(fe,ve){const _e=ve.store,be=null!=_e.version?_e.version.toString():"";return this.parseVersionString(be)}readTitlePortalItem(fe){return"item-title"!==this.sublayerTitleMode?void 0:fe}readTitleService(fe,ve){var _e;const be=null==(_e=this.portalItem)?void 0:_e.title;if("item-title"===this.sublayerTitleMode)return this.url?w$1n(this.url,ve.name):ve.name;let we=ve.name;if(!we&&this.url){const fe=d$2m(this.url);null!=fe&&(we=fe.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&be&&(we=be+" - "+we),m$2u(we)}set url(fe){if(null==fe)return void this._set("url",fe);const ve=S$1k({layer:this,url:fe,nonStandardUrlAllowed:!1,logger:ar.getLogger(this)});this._set("url",ve.url),null!=ve.layerId&&this._set("layerId",ve.layerId)}writeUrl(fe,ve,_e,be){C$15(this,fe,"layers",ve,be)}get parsedUrl(){const fe=I$1E(this._get("url"));return fe&&null!=this.layerId&&(fe.path=`${fe.path}/layers/${this.layerId}`),fe}async _fetchIndexAndUpdateExtent(fe,ve){var _e;this.indexInfo=r$2((null==(_e=this.parsedUrl)?void 0:_e.path)??"",this.rootNode,fe,this.customParameters,this.apiKey,ar.getLogger(this),ve),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(fe){var ve,_e,be,we;if("page"===(null==fe?void 0:fe.type)){const we=fe.rootIndex%fe.pageSize,Se=null==(_e=null==(ve=fe.rootPage)?void 0:ve.nodes)?void 0:_e[we];if(null==(null==(be=null==Se?void 0:Se.obb)?void 0:be.center)||null==Se.obb.halfSize)throw new Ir("sceneservice:invalid-node-page","Invalid node page.");if(Se.obb.center[0]<QAe||null==this.fullExtent||this.fullExtent.hasZ)return;const Te=Se.obb.halfSize,Ee=Se.obb.center[2],Ce=Math.sqrt(Te[0]*Te[0]+Te[1]*Te[1]+Te[2]*Te[2]);this.fullExtent.zmin=Ee-Ce,this.fullExtent.zmax=Ee+Ce}else if("node"===(null==fe?void 0:fe.type)){const ve=null==(we=fe.rootNode)?void 0:we.mbs;if(!Array.isArray(ve)||4!==ve.length||ve[0]<QAe)return;const _e=ve[2],be=ve[3],{fullExtent:Se}=this;Se&&(Se.zmin=_e-be,Se.zmax=_e+be)}}async _fetchService(fe){if(null==this.url)throw new Ir("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const ve=await this._fetchFirstLayerId(fe);null!=ve&&(this.layerId=ve)}return this._fetchServiceLayer(fe)}async _fetchFirstLayerId(fe){const ve=await U$1a(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:fe});if(ve.data&&Array.isArray(ve.data.layers)&&ve.data.layers.length>0)return ve.data.layers[0].id}async _fetchServiceLayer(fe){var ve;const _e=await U$1a((null==(ve=this.parsedUrl)?void 0:ve.path)??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:fe});_e.ssl&&this.url&&(this.url=this.url.replace(/^http:/i,"https:"));let be=!1;if(_e.data.layerType&&"Voxel"===_e.data.layerType&&(be=!0),be)return this._fetchVoxelServiceLayer();const we=_e.data;this.read(we,this._getServiceContext()),this.validateLayer(we)}async _fetchVoxelServiceLayer(fe){var ve;const _e=(await U$1a((null==(ve=this.parsedUrl)?void 0:ve.path)+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:fe})).data;this.read(_e,this._getServiceContext()),this.validateLayer(_e)}_getServiceContext(){var fe;return{origin:"service",portalItem:this.portalItem,portal:null==(fe=this.portalItem)?void 0:fe.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(fe){}async _saveAs(fe,ve){var _e;const be={...tMe,...ve};let we=n_.from(fe);if(!we)throw new Ir("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");i$2(we),we.id&&(we=we.clone(),we.id=null);const Se=we.portal||Gv.getDefault();await this._ensureLoadBeforeSave(),we.type=eMe,we.portal=Se;const Te=o$e(we,"portal-item",!0),Ee={layers:[this.write({},Te)]};return await Promise.all(Te.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(Ee,Te,be),this.url&&(we.url=this.url),we.title||(we.title=this.title),O15(we,be,KAe.newItem),await Se.signIn(),await(null==(_e=Se.user)?void 0:_e.addItem({item:we,folder:null==be?void 0:be.folder,data:Ee})),await p$7(this.resourceReferences,Te),this.portalItem=we,i$4(Te),Te.portalItem=we,we}async _save(fe){const ve={...tMe,...fe};if(!this.portalItem)throw new Ir("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(i$2(this.portalItem),this.portalItem.type!==eMe)throw new Ir("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${eMe}"`);await this._ensureLoadBeforeSave();const _e=o$e(this.portalItem,"portal-item",!0),be={layers:[this.write({},_e)]};return await Promise.all(_e.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(be,_e,ve),this.url&&(this.portalItem.url=this.url),this.portalItem.title||(this.portalItem.title=this.title),O15(this.portalItem,ve,KAe.existingItem),await async function n$3(fe,ve,_e,be,we){const Se=await u$3(_e,be,we);await fe.update({data:ve}),await h32(Se,be,we)}(this.portalItem,be,this.resourceReferences,_e),i$4(_e),this.portalItem}async _validateAgainstJSONSchema(fe,ve,_e){const be=null==_e?void 0:_e.validationOptions;t$3(ve,{errorName:"sceneservice:save"},{ignoreUnsupported:null==be?void 0:be.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const we=null;if((null==be?void 0:be.enabled)&&we){const ve=(await we()).validate(fe,_e.portalItemLayerType);if(!ve.length)return;const Se=`Layer item did not validate:\n${ve.join("\n")}`;if(ar.getLogger(this).error(`_validateAgainstJSONSchema(): ${Se}`),"throw"===be.failPolicy){const fe=ve.map((fe=>new Ir("sceneservice:schema-validation",fe)));throw new Ir("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:fe})}}}};return e$4o([y$2v(axe)],ve.prototype,"id",void 0),e$4o([y$2v({type:zo})],ve.prototype,"spatialReference",void 0),e$4o([o$40("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],ve.prototype,"readSpatialReference",null),e$4o([y$2v({type:aa})],ve.prototype,"fullExtent",void 0),e$4o([o$40("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],ve.prototype,"readFullExtent",null),e$4o([y$2v({readOnly:!0,type:Eh})],ve.prototype,"heightModelInfo",void 0),e$4o([y$2v({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],ve.prototype,"minScale",void 0),e$4o([y$2v({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],ve.prototype,"maxScale",void 0),e$4o([y$2v({readOnly:!0})],ve.prototype,"version",void 0),e$4o([o$40("version",["store.version"])],ve.prototype,"readVersion",null),e$4o([y$2v({type:String,json:{read:{source:"copyrightText"}}})],ve.prototype,"copyright",void 0),e$4o([y$2v({type:String,json:{read:!1}})],ve.prototype,"sublayerTitleMode",void 0),e$4o([y$2v({type:String})],ve.prototype,"title",void 0),e$4o([o$40("portal-item","title")],ve.prototype,"readTitlePortalItem",null),e$4o([o$40("service","title",["name"])],ve.prototype,"readTitleService",null),e$4o([y$2v({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],ve.prototype,"layerId",void 0),e$4o([y$2v(exe)],ve.prototype,"url",null),e$4o([r$3s("url")],ve.prototype,"writeUrl",null),e$4o([y$2v()],ve.prototype,"parsedUrl",null),e$4o([y$2v({readOnly:!0})],ve.prototype,"store",void 0),e$4o([y$2v({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],ve.prototype,"rootNode",void 0),ve=e$4o([a$4y("esri.layers.mixins.SceneService")],ve),ve},QAe=-1e38;function T13(fe){if(null!=fe.spatialReference)return zo.fromJSON(fe.spatialReference);const ve=fe.store,_e=ve.indexCRS||ve.geographicCRS,be=_e&&parseInt(_e.substring(_e.lastIndexOf("/")+1,_e.length),10);return null!=be?new zo(be):null}function O15(fe,ve,_e){fe.typeKeywords||(fe.typeKeywords=[]);const be=ve.getTypeKeywords();for(const we of be)fe.typeKeywords.push(we);fe.typeKeywords&&(fe.typeKeywords=fe.typeKeywords.filter(((fe,ve,_e)=>_e.indexOf(fe)===ve)),_e===KAe.newItem&&(fe.typeKeywords=fe.typeKeywords.filter((fe=>"Hosted Service"!==fe))))}var KAe;!function(fe){fe[fe.existingItem=0]="existingItem",fe[fe.newItem=1]="newItem"}(KAe||(KAe={}));const eMe="Scene Service",tMe={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var rMe;async function s83(fe,ve){const _e=d$2m(fe);if(!_e)throw new Ir("invalid-url","Invalid scene service url");const be={...ve,sceneServerUrl:_e.url.path,layerId:_e.sublayer??void 0};if(be.sceneLayerItem??(be.sceneLayerItem=await async function l$3(fe){const ve=(await c$4(fe)).serviceItemId;if(!ve)return null;const _e=new n_({id:ve,apiKey:fe.apiKey}),be=await async function u$2(fe){const ve=null==Ts?void 0:Ts.findServerInfo(fe.sceneServerUrl);if(null==ve?void 0:ve.owningSystemUrl)return ve.owningSystemUrl;const _e=fe.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const ve=(await U$1a(_e,{query:{f:"json"},responseType:"json",signal:fe.signal})).data.owningSystemUrl;if(ve)return ve}catch(we){a$4D(we)}return null}(fe);null!=be&&(_e.portal=new Gv({url:be}));try{return _e.load({signal:fe.signal})}catch(Se){return a$4D(Se),null}}(be)),null==be.sceneLayerItem)return f$1(be.sceneServerUrl.replace("/SceneServer","/FeatureServer"),be);const we=await async function y15({sceneLayerItem:fe,signal:ve}){if(!fe)return null;try{const _e=(await fe.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:ve})).find((fe=>"Feature Service"===fe.type))||null;if(!_e)return null;const be=new n_({portal:_e.portal,id:_e.id});return await be.load(),be}catch(t84){return a$4D(t84),null}}(be);if(!(null==we?void 0:we.url))throw new Ir("related-service-not-found","Could not find feature service through portal item relationship");be.featureServiceItem=we;const Se=await f$1(we.url,be);return Se.portalItem=we,Se}async function c$4(fe){if(fe.rootDocument)return fe.rootDocument;const ve={query:{f:"json",...fe.customParameters,token:fe.apiKey},responseType:"json",signal:fe.signal};try{const _e=await U$1a(fe.sceneServerUrl,ve);fe.rootDocument=_e.data}catch{fe.rootDocument={}}return fe.rootDocument}async function f$1(fe,ve){var _e,be,we;const Se=d$2m(fe);if(!Se)throw new Ir("invalid-feature-service-url","Invalid feature service url");const Te=Se.url.path,Ee=ve.layerId;if(null==Ee)return{serverUrl:Te};const Ce=c$4(ve),Oe=ve.featureServiceItem?await ve.featureServiceItem.fetchData("json"):null,Re=null==(we=(null==(_e=null==Oe?void 0:Oe.layers)?void 0:_e[0])||(null==(be=null==Oe?void 0:Oe.tables)?void 0:be[0]))?void 0:we.customParameters,y16=fe=>{const _e={query:{f:"json",...Re},responseType:"json",authMode:fe,signal:ve.signal};return U$1a(Te,_e)},De=y16("anonymous").catch((()=>y16("no-prompt"))),[Be,Ze]=await Promise.all([De,Ce]),Xe=null==Ze?void 0:Ze.layers,Je=Be.data&&Be.data.layers;if(!Array.isArray(Je))throw new Error("expected layers array");if(Array.isArray(Xe)){for(let Qe=0;Qe<Math.min(Xe.length,Je.length);Qe++)if(Xe[Qe].id===Ee)return{serverUrl:Te,layerId:Je[Qe].id}}else if(null!=Ee&&Ee<Je.length)return{serverUrl:Te,layerId:Je[Ee].id};throw new Error("could not find matching associated sublayer")}!function(fe){fe[fe.SAVE=0]="SAVE",fe[fe.SAVE_AS=1]="SAVE_AS"}(rMe||(rMe={}));let iMe=class extends Pn{constructor(){super(...arguments),this.type=null}};e$4o([y$2v({type:String,readOnly:!0,json:{write:!0}})],iMe.prototype,"type",void 0),iMe=e$4o([a$4y("esri.layers.support.BuildingFilterAuthoringInfo")],iMe);const nMe=iMe;var sMe;let oMe=sMe=class extends Pn{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new sMe({filterType:this.filterType,filterValues:a$4H(this.filterValues)})}};e$4o([y$2v({type:String,json:{write:!0}})],oMe.prototype,"filterType",void 0),e$4o([y$2v({type:[String],json:{write:!0}})],oMe.prototype,"filterValues",void 0),oMe=sMe=e$4o([a$4y("esri.layers.support.BuildingFilterAuthoringInfoType")],oMe);const aMe=oMe;var lMe;const cMe=Wa.ofType(aMe);let uMe=lMe=class extends Pn{clone(){return new lMe({filterTypes:a$4H(this.filterTypes)})}};e$4o([y$2v({type:cMe,json:{write:!0}})],uMe.prototype,"filterTypes",void 0),uMe=lMe=e$4o([a$4y("esri.layers.support.BuildingFilterAuthoringInfoBlock")],uMe);const hMe=uMe;var dMe;const pMe=Wa.ofType(hMe);let fMe=dMe=class extends nMe{constructor(){super(...arguments),this.type="checkbox"}clone(){return new dMe({filterBlocks:a$4H(this.filterBlocks)})}};e$4o([y$2v({type:["checkbox"]})],fMe.prototype,"type",void 0),e$4o([y$2v({type:pMe,json:{write:!0}})],fMe.prototype,"filterBlocks",void 0),fMe=dMe=e$4o([a$4y("esri.layers.support.BuildingFilterAuthoringInfoCheckbox")],fMe);const mMe=fMe;let yMe=class t82 extends Pn{};e$4o([y$2v({readOnly:!0,json:{read:!1}})],yMe.prototype,"type",void 0),yMe=e$4o([a$4y("esri.layers.support.BuildingFilterMode")],yMe);const gMe=yMe;var vMe;let _Me=vMe=class extends gMe{constructor(){super(...arguments),this.type="solid"}clone(){return new vMe}};e$4o([y$2v({type:["solid"],readOnly:!0,json:{write:!0}})],_Me.prototype,"type",void 0),_Me=vMe=e$4o([a$4y("esri.layers.support.BuildingFilterModeSolid")],_Me);const $Me=_Me;var bMe;let wMe=bMe=class extends gMe{constructor(){super(...arguments),this.type="wire-frame",this.edges=null}clone(){return new bMe({edges:a$4H(this.edges)})}};e$4o([o$3g({wireFrame:"wire-frame"})],wMe.prototype,"type",void 0),e$4o([y$2v($w)],wMe.prototype,"edges",void 0),wMe=bMe=e$4o([a$4y("esri.layers.support.BuildingFilterModeWireFrame")],wMe);const xMe=wMe;var SMe;let TMe=SMe=class extends gMe{constructor(){super(...arguments),this.type="x-ray"}clone(){return new SMe}};e$4o([y$2v({type:["x-ray"],readOnly:!0,json:{write:!0}})],TMe.prototype,"type",void 0),TMe=SMe=e$4o([a$4y("esri.layers.support.BuildingFilterModeXRay")],TMe);const EMe=TMe;var PMe;const CMe={nonNullable:!0,types:{key:"type",base:gMe,typeMap:{solid:$Me,"wire-frame":xMe,"x-ray":EMe}},json:{read:fe=>{switch(null==fe?void 0:fe.type){case"solid":return $Me.fromJSON(fe);case"wireFrame":return xMe.fromJSON(fe);case"x-ray":return EMe.fromJSON(fe);default:return}},write:{enabled:!0,isRequired:!0}}};let OMe=PMe=class extends Pn{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new $Me,this.title=""}clone(){return new PMe({filterExpression:this.filterExpression,filterMode:a$4H(this.filterMode),title:this.title})}};e$4o([y$2v({type:String,json:{write:{enabled:!0,isRequired:!0}}})],OMe.prototype,"filterExpression",void 0),e$4o([y$2v(CMe)],OMe.prototype,"filterMode",void 0),e$4o([y$2v({type:String,json:{write:{enabled:!0,isRequired:!0}}})],OMe.prototype,"title",void 0),OMe=PMe=e$4o([a$4y("esri.layers.support.BuildingFilterBlock")],OMe);const AMe=OMe;var MMe;const RMe=Wa.ofType(AMe);let IMe=MMe=class extends Pn{constructor(){super(...arguments),this.description=null,this.filterBlocks=null,this.id=n$Q(),this.name=null}clone(){return new MMe({description:this.description,filterBlocks:a$4H(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:a$4H(this.filterAuthoringInfo)})}};e$4o([y$2v({type:String,json:{write:!0}})],IMe.prototype,"description",void 0),e$4o([y$2v({type:RMe,json:{write:{enabled:!0,isRequired:!0}}})],IMe.prototype,"filterBlocks",void 0),e$4o([y$2v({types:{key:"type",base:nMe,typeMap:{checkbox:mMe}},json:{read:fe=>"checkbox"===(null==fe?void 0:fe.type)?mMe.fromJSON(fe):null,write:!0}})],IMe.prototype,"filterAuthoringInfo",void 0),e$4o([y$2v({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],IMe.prototype,"id",void 0),e$4o([y$2v({type:String,json:{write:{enabled:!0,isRequired:!0}}})],IMe.prototype,"name",void 0),IMe=MMe=e$4o([a$4y("esri.layers.support.BuildingFilter")],IMe);const LMe=IMe;let DMe=class extends Pn{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};e$4o([y$2v({type:String})],DMe.prototype,"fieldName",void 0),e$4o([y$2v({type:String})],DMe.prototype,"modelName",void 0),e$4o([y$2v({type:String})],DMe.prototype,"label",void 0),e$4o([y$2v({type:Number})],DMe.prototype,"min",void 0),e$4o([y$2v({type:Number})],DMe.prototype,"max",void 0),e$4o([y$2v({json:{read:fe=>Array.isArray(fe)&&(fe.every((fe=>"string"==typeof fe))||fe.every((fe=>"number"==typeof fe)))?fe.slice():null}})],DMe.prototype,"mostFrequentValues",void 0),e$4o([y$2v({type:[Number]})],DMe.prototype,"subLayerIds",void 0),DMe=e$4o([a$4y("esri.layers.support.BuildingSummaryStatistics.BuildingFieldStatistics")],DMe);let NMe=class extends(Sv.LoadableMixin(n$3T(Pn))){constructor(){super(...arguments),this.url=null}get fields(){return this.loaded||"loading"===this.loadStatus?this._get("fields"):(ar.getLogger(this).error("building summary statistics are not loaded"),null)}load(fe){const ve=null!=fe?fe.signal:null;return this.addResolvingPromise(this._fetchService(ve)),Promise.resolve(this)}async _fetchService(fe){const ve=(await U$1a(this.url,{query:{f:"json"},responseType:"json",signal:fe})).data;this.read(ve,{origin:"service"})}};e$4o([y$2v({constructOnly:!0,type:String})],NMe.prototype,"url",void 0),e$4o([y$2v({readOnly:!0,type:[DMe],json:{read:{source:"summary"}}})],NMe.prototype,"fields",null),NMe=e$4o([a$4y("esri.layers.support.BuildingSummaryStatistics")],NMe);const FMe=NMe,zMe=Wa.ofType(LMe),kMe=a$4H(ZAe.sublayersProperty),UMe=null==(Ce=kMe.json)?void 0:Ce.origins;UMe&&(UMe["web-scene"]={type:[HAe],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},UMe["portal-item"]={type:[HAe],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});let VMe=class extends(L9(l$H(b$9(j$a(t$t(S$a(e$i(i$L(Y_))))))))){constructor(fe){super(fe),this.operationalLayerType="BuildingSceneLayer",this.allSublayers=new C_({getCollections:()=>[this.sublayers],getChildrenFunction:fe=>"building-group"===fe.type?fe.sublayers:null}),this.sublayers=null,this._sublayerOverrides=null,this.filters=new zMe,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type="building-scene"}normalizeCtorArgs(fe){return"string"==typeof fe?{url:fe}:fe??{}}destroy(){this.allSublayers.destroy()}readSublayers(fe,ve,_e){const be=ZAe.readSublayers(fe,ve,_e);return ZAe.forEachSublayer(be,(fe=>fe.layer=this)),this._sublayerOverrides&&(this.applySublayerOverrides(be,this._sublayerOverrides),this._sublayerOverrides=null),be}applySublayerOverrides(fe,{overrides:ve,context:_e}){ZAe.forEachSublayer(fe,(fe=>fe.read(ve.get(fe.id),_e)))}readSublayerOverrides(fe,ve){var _e;const be=new Map;for(const we of fe)null!=we&&"object"==typeof we&&"number"==typeof we.id?be.set(we.id,we):null==(_e=ve.messages)||_e.push(new Ir("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:we}));return{overrides:be,context:ve}}writeSublayerOverrides(fe,ve,_e){const be=[];ZAe.forEachSublayer(this.sublayers,(fe=>{const ve=fe.write({},_e);Object.keys(ve).length>1&&be.push(ve)})),be.length>0&&(ve.sublayers=be)}writeUnappliedOverrides(fe,ve){ve.sublayers=[],fe.overrides.forEach((fe=>{ve.sublayers.push(a$4H(fe))}))}write(fe,ve){return fe=super.write(fe,ve),!ve||"web-scene"!==ve.origin&&"portal-item"!==ve.origin||(this.sublayers?this.writeSublayerOverrides(this.sublayers,fe,ve):this._sublayerOverrides&&this.writeUnappliedOverrides(this._sublayerOverrides,fe)),fe}read(fe,ve){if(super.read(fe,ve),ve&&("web-scene"===ve.origin||"portal-item"===ve.origin)&&null!=fe&&Array.isArray(fe.sublayers)){const _e=this.readSublayerOverrides(fe.sublayers,ve);this.sublayers?this.applySublayerOverrides(this.sublayers,_e):this._sublayerOverrides=_e}}readSummaryStatistics(fe,ve){var _e;if("string"==typeof ve.statisticsHRef){const fe=V$19(null==(_e=this.parsedUrl)?void 0:_e.path,ve.statisticsHRef);return new FMe({url:fe})}return null}set elevationInfo(fe){this._set("elevationInfo",fe),this._validateElevationInfo()}load(fe){const ve=null!=fe?fe.signal:null,_e=this.loadFromPortal({supportedTypes:["Scene Service"]},fe).catch(a$4D).then((()=>this._fetchService(ve))).then((()=>this._fetchAssociatedFeatureService(ve)));return this.addResolvingPromise(_e),Promise.resolve(this)}loadAll(){return t$3u(this,(fe=>{ZAe.forEachSublayer(this.sublayers,(ve=>{"building-group"!==ve.type&&fe(ve)})),this.summaryStatistics&&fe(this.summaryStatistics)}))}async saveAs(fe,ve){return this._debouncedSaveOperations(rMe.SAVE_AS,{...ve,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"},fe)}async save(){const fe={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"};return this._debouncedSaveOperations(rMe.SAVE,fe)}validateLayer(fe){if(!fe.layerType||"Building"!==fe.layerType)throw new Ir("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:fe.layerType})}_getTypeKeywords(){return["Building"]}async _fetchAssociatedFeatureService(fe){try{const{portalItem:ve}=await s83(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:fe});this.associatedFeatureServiceItem=ve}catch(Dr){ar.getLogger(this).warn("Associated feature service item could not be loaded",Dr)}}_validateElevationInfo(){const fe=this.elevationInfo,ve="Building scene layers";$$7(ar.getLogger(this),Z$7(ve,"absolute-height",fe)),$$7(ar.getLogger(this),w$x(ve,fe))}};e$4o([y$2v({type:["BuildingSceneLayer"]})],VMe.prototype,"operationalLayerType",void 0),e$4o([y$2v({readOnly:!0})],VMe.prototype,"allSublayers",void 0),e$4o([y$2v(kMe)],VMe.prototype,"sublayers",void 0),e$4o([o$40("service","sublayers")],VMe.prototype,"readSublayers",null),e$4o([y$2v({type:zMe,nonNullable:!0,json:{write:!0}})],VMe.prototype,"filters",void 0),e$4o([y$2v({type:String,json:{write:!0}})],VMe.prototype,"activeFilterId",void 0),e$4o([y$2v({readOnly:!0,type:FMe})],VMe.prototype,"summaryStatistics",void 0),e$4o([o$40("summaryStatistics",["statisticsHRef"])],VMe.prototype,"readSummaryStatistics",null),e$4o([y$2v({type:[String],json:{read:!1}})],VMe.prototype,"outFields",void 0),e$4o([y$2v(oxe)],VMe.prototype,"fullExtent",void 0),e$4o([y$2v(txe)],VMe.prototype,"legendEnabled",void 0),e$4o([y$2v({type:["show","hide","hide-children"]})],VMe.prototype,"listMode",void 0),e$4o([y$2v(c$R(zo))],VMe.prototype,"spatialReference",void 0),e$4o([y$2v(rxe)],VMe.prototype,"elevationInfo",null),e$4o([y$2v({json:{read:!1},readOnly:!0})],VMe.prototype,"type",void 0),e$4o([y$2v()],VMe.prototype,"associatedFeatureServiceItem",void 0),VMe=e$4o([a$4y("esri.layers.BuildingSceneLayer")],VMe);const BMe=VMe,jMe=Object.freeze(Object.defineProperty({__proto__:null,default:BMe},Symbol.toStringTag,{value:"Module"}));function create_fragment$2(fe){let ve;return{c(){ve=element("div"),attr(ve,"class","map-container svelte-n86d70")},m(_e,be){insert(_e,ve,be),fe[2](ve)},p:noop,i:noop,o:noop,d(_e){_e&&detach(ve),fe[2](null)}}}function instance$2(fe,ve,_e){let be,we,Se,Te=new zwe;ir.apiKey="AAPKfb786cc2758148739175c3ec34911c15ZmP9fvQ4IkY-MIc7PqC8pirSsJPVFRXx68tuu71NEskmmiWOCf2EEhMHvilOFZlQ";const Ee=new Yo({longitude:11.4260974,latitude:48.7651622,z:200}),Ce=new Yo({longitude:11.4260974,latitude:48.7651622,z:0}),Oe=new dT({color:[156,39,176],outline:{color:[156,39,176,.6],width:22},size:"22px",style:"circle"}),Re=new Dw({color:[156,39,176,.8],width:2}),De=new RT({geometry:Ee,symbol:Oe}),Be=new Ta({paths:[[[Ce.longitude,Ce.latitude,Ce.z],[Ee.longitude,Ee.latitude,Ee.z]]],spatialReference:{wkid:4326}}),Ze=new RT({geometry:Be,symbol:Re});return onMount((()=>{(async()=>{try{const fe=new g_({baseLayers:[new lSe({portalItem:{id:"96a7dfbbadc0457faa3031a7f86c1b67"}})]}),ve=new BMe({portalItem:{id:"ca0470dbbddb4db28bad74ed39949e25"}});we=new X_({basemap:fe,layers:[Te,ve]}),Se=new Twe({container:be,map:we,camera:{position:{latitude:0,longitude:0,z:5e7},tilt:0},environment:{atmosphereEnabled:!1,starsEnabled:!0},ui:{components:[]}}),Se.when((()=>{Te.addMany([De,Ze]),Se.goTo({center:[11.4260974,48.7651622],zoom:16,tilt:70,heading:0},{duration:5e3}).catch((function(fe){fe.name}))}))}catch(fe){}})()})),function onDestroy(fe){get_current_component().$$.on_destroy.push(fe)}((()=>{null==Se||Se.destroy()})),[be,"contact-map",function div_binding(fe){bt[fe?"unshift":"push"]((()=>{be=fe,_e(0,be)}))}]}let GMe=class Map2 extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$2,create_fragment$2,safe_not_equal,{id:1})}get id(){return this.$$.ctx[1]}};function get_each_context(fe,ve,_e){const be=fe.slice();return be[7]=ve[_e],be}function create_if_block(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt,$t,bt,wt=ensure_array_like(fe[2]),xt=[];for(let St=0;St<wt.length;St+=1)xt[St]=create_each_block(get_each_context(fe,wt,St));return Qe=new GMe({props:{id:"contact-map"}}),{c(){ve=element("div"),_e=element("div"),be=element("h1"),we=text(fe[1]),Te=space(),Ee=element("hr"),Ce=space(),Oe=element("div"),Oe.innerHTML='<p class="contact-info svelte-1hqcpaq">Visit us at: <strong>123 Racing Street, Ingolstadt, Germany</strong><br/>\n            Call us: <strong>+49 123 456 789</strong><br/>\n            Email: <strong><a href="mailto:info@racinghub.com" class="contact-email svelte-1hqcpaq">info@racinghub.com</a></strong></p>',De=space(),Be=element("div");for(let fe=0;fe<xt.length;fe+=1)xt[fe].c();Xe=space(),Je=element("div"),create_component(Qe.$$.fragment),dt=space(),$t=element("div"),attr(be,"class","fw-bold text-primary"),attr(_e,"class","text-center mb-3"),attr(Be,"class","social-media mt-4 svelte-1hqcpaq"),attr(Je,"class","map-container mt-4 svelte-1hqcpaq"),attr($t,"class","col-md-12"),attr(ve,"class","container text-center transition-container svelte-1hqcpaq")},m(fe,Se){insert(fe,ve,Se),append(ve,_e),append(_e,be),append(be,we),append(ve,Te),append(ve,Ee),append(ve,Ce),append(ve,Oe),append(ve,De),append(ve,Be);for(let ve=0;ve<xt.length;ve+=1)xt[ve]&&xt[ve].m(Be,null);append(ve,Xe),append(ve,Je),mount_component(Qe,Je,null),append(ve,dt),append(ve,$t),bt=!0},p(fe,ve){if((!bt||2&ve)&&set_data(we,fe[1]),4&ve){let _e;for(wt=ensure_array_like(fe[2]),_e=0;_e<wt.length;_e+=1){const be=get_each_context(fe,wt,_e);xt[_e]?xt[_e].p(be,ve):(xt[_e]=create_each_block(be),xt[_e].c(),xt[_e].m(Be,null))}for(;_e<xt.length;_e+=1)xt[_e].d(1);xt.length=wt.length}},i(fe){bt||(fe&&(Se||add_render_callback((()=>{Se=create_in_transition(_e,slide,{duration:1e3}),Se.start()}))),fe&&(Re||add_render_callback((()=>{Re=create_in_transition(Oe,fade,{delay:500,duration:1e3}),Re.start()}))),fe&&(Ze||add_render_callback((()=>{Ze=create_in_transition(Be,fade,{delay:700,duration:1e3}),Ze.start()}))),transition_in(Qe.$$.fragment,fe),bt=!0)},o(fe){transition_out(Qe.$$.fragment,fe),bt=!1},d(fe){fe&&detach(ve),destroy_each(xt,fe),destroy_component(Qe)}}}function create_each_block(fe){let ve,_e,be,we,Se,Te;return{c(){ve=element("a"),_e=element("i"),we=space(),attr(_e,"class",be="h3 "+fe[7][1]+" svelte-1hqcpaq"),attr(ve,"class","btn shadow-sm mx-1 social-icon svelte-1hqcpaq"),attr(ve,"href",Se=fe[7][2]),attr(ve,"target","_blank"),attr(ve,"rel","noopener noreferrer"),attr(ve,"aria-label",Te=fe[7][0])},m(fe,be){insert(fe,ve,be),append(ve,_e),append(ve,we)},p(fe,we){4&we&&be!==(be="h3 "+fe[7][1]+" svelte-1hqcpaq")&&attr(_e,"class",be),4&we&&Se!==(Se=fe[7][2])&&attr(ve,"href",Se),4&we&&Te!==(Te=fe[7][0])&&attr(ve,"aria-label",Te)},d(fe){fe&&detach(ve)}}}function create_default_slot(fe){let ve,_e,be=fe[3]&&create_if_block(fe);return{c(){be&&be.c(),ve=empty()},m(fe,we){be&&be.m(fe,we),insert(fe,ve,we),_e=!0},p(fe,_e){fe[3]?be?(be.p(fe,_e),8&_e&&transition_in(be,1)):(be=create_if_block(fe),be.c(),transition_in(be,1),be.m(ve.parentNode,ve)):be&&(group_outros(),transition_out(be,1,1,(()=>{be=null})),check_outros())},i(fe){_e||(transition_in(be),_e=!0)},o(fe){transition_out(be),_e=!1},d(fe){fe&&detach(ve),be&&be.d(fe)}}}function create_fragment$1(fe){let ve,_e,be,we;return _e=new Saos({props:{animation:"",$$slots:{default:[create_default_slot]},$$scope:{ctx:fe}}}),{c(){ve=element("div"),create_component(_e.$$.fragment),attr(ve,"class",be="bg-"+fe[5]+" text-"+fe[4]+" d-flex justify-content-center align-items-center min-vh-100 flex-column svelte-1hqcpaq"),attr(ve,"id",fe[0]),set_style(ve,"padding-top","58px"),set_style(ve,"background-color","transparent",1)},m(fe,be){insert(fe,ve,be),mount_component(_e,ve,null),we=!0},p(fe,[Se]){const Te={};1038&Se&&(Te.$$scope={dirty:Se,ctx:fe}),_e.$set(Te),(!we||48&Se&&be!==(be="bg-"+fe[5]+" text-"+fe[4]+" d-flex justify-content-center align-items-center min-vh-100 flex-column svelte-1hqcpaq"))&&attr(ve,"class",be),(!we||1&Se)&&attr(ve,"id",fe[0])},i(fe){we||(transition_in(_e.$$.fragment,fe),we=!0)},o(fe){transition_out(_e.$$.fragment,fe),we=!1},d(fe){fe&&detach(ve),destroy_component(_e)}}}function instance$1(fe,ve,_e){let be=!1;onMount((()=>_e(3,be=!0)));let{Id:we}=ve,{contact_title:Se="Get in Touch with RacingHub!"}=ve,{social:Te=[["Facebook","fab fa-facebook-f","https://www.facebook.com/RacingHub"],["Twitter","fab fa-twitter","https://twitter.com/RacingHub"],["Instagram","fab fa-instagram","https://instagram.com/RacingHub"],["LinkedIn","fab fa-linkedin-in","https://www.linkedin.com/company/RacingHub"]]}=ve,{state:Ee}=ve,Ce="dark",Oe="light";return"dark"==Ee&&(Ce="light",Oe="dark"),fe.$$set=fe=>{"Id"in fe&&_e(0,we=fe.Id),"contact_title"in fe&&_e(1,Se=fe.contact_title),"social"in fe&&_e(2,Te=fe.social),"state"in fe&&_e(6,Ee=fe.state)},[we,Se,Te,be,Ce,Oe,Ee]}class Contact extends SvelteComponent{constructor(fe){super(),init(this,fe,instance$1,create_fragment$1,safe_not_equal,{Id:0,contact_title:1,social:2,state:6})}}function create_fragment(fe){let ve,_e,be,we,Se,Te,Ee,Ce,Oe,Re,De,Be,Ze,Xe,Je,Qe,dt;return be=new Navbar({props:{brand:HMe,nav_items:fe[2],state:WMe}}),Se=new Header({props:{state:WMe}}),Ee=new About({props:{Id:"about",state:WMe}}),Oe=new Services({props:{Id:"services",state:WMe}}),De=new Contact({props:{Id:"contact",contact_title:qMe,social:fe[3],state:WMe}}),Ze=new Footer({props:{brand:HMe,state:WMe}}),{c(){ve=element("main"),_e=element("div"),create_component(be.$$.fragment),we=space(),create_component(Se.$$.fragment),Te=space(),create_component(Ee.$$.fragment),Ce=space(),create_component(Oe.$$.fragment),Re=space(),create_component(De.$$.fragment),Be=space(),create_component(Ze.$$.fragment),Xe=space(),Je=element("button"),Je.textContent="Jetzt Termin buchen",attr(_e,"class","bg-pattern"),attr(Je,"class","cta-button svelte-1tjebrb"),attr(ve,"class",Qe="bg-"+fe[1]+" text-"+fe[0]+" min-vh-100 svelte-1tjebrb")},m(fe,Qe){insert(fe,ve,Qe),append(ve,_e),mount_component(be,_e,null),append(_e,we),mount_component(Se,_e,null),append(_e,Te),mount_component(Ee,_e,null),append(_e,Ce),mount_component(Oe,_e,null),append(_e,Re),mount_component(De,_e,null),append(_e,Be),mount_component(Ze,_e,null),append(ve,Xe),append(ve,Je),dt=!0},p(fe,[_e]){(!dt||3&_e&&Qe!==(Qe="bg-"+fe[1]+" text-"+fe[0]+" min-vh-100 svelte-1tjebrb"))&&attr(ve,"class",Qe)},i(fe){dt||(transition_in(be.$$.fragment,fe),transition_in(Se.$$.fragment,fe),transition_in(Ee.$$.fragment,fe),transition_in(Oe.$$.fragment,fe),transition_in(De.$$.fragment,fe),transition_in(Ze.$$.fragment,fe),dt=!0)},o(fe){transition_out(be.$$.fragment,fe),transition_out(Se.$$.fragment,fe),transition_out(Ee.$$.fragment,fe),transition_out(Oe.$$.fragment,fe),transition_out(De.$$.fragment,fe),transition_out(Ze.$$.fragment,fe),dt=!1},d(fe){fe&&detach(ve),destroy_component(be),destroy_component(Se),destroy_component(Ee),destroy_component(Oe),destroy_component(De),destroy_component(Ze)}}}let HMe="Racing Hub",qMe="Get in Touch with RacingHub!",WMe="dark";function instance(fe,ve,_e){let be="dark",we="light";return be="light",we="dark",onMount((()=>{const fe=document.querySelectorAll("section");document.querySelector(".cta-button");const ve=new IntersectionObserver((fe=>{fe.forEach((fe=>{fe.isIntersecting?fe.target.classList.add("visible"):fe.target.classList.remove("visible")}))}));fe.forEach((fe=>{ve.observe(fe)}))})),["light","dark",[["Home","#"],["About","#about"],["Services","#services"],["Contact","#contact"]],[["Facebook","fab fa-facebook-f","https://www.facebook.com/RacingHub"],["Twitter","fab fa-twitter","https://twitter.com/RacingHub"],["Instagram","fab fa-instagram","https://instagram.com/RacingHub"],["LinkedIn","fab fa-linkedin-in","https://www.linkedin.com/company/RacingHub"]]]}new class App extends SvelteComponent{constructor(fe){super(),init(this,fe,instance,create_fragment,safe_not_equal,{})}}({target:document.body});const YMe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:OO,build:S$1i},Symbol.toStringTag,{value:"Module"})),ZMe=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:aM,build:n$2_},Symbol.toStringTag,{value:"Module"})),XMe=Object.freeze(Object.defineProperty({__proto__:null,build:v$1h},Symbol.toStringTag,{value:"Module"})),JMe=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:aR,build:S$1e},Symbol.toStringTag,{value:"Module"})),QMe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:pR,build:u$2t},Symbol.toStringTag,{value:"Module"})),KMe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:CI,build:h$1R},Symbol.toStringTag,{value:"Module"})),eRe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:JI,SimpleAtmospherePassParameters:XI,build:v$1a},Symbol.toStringTag,{value:"Module"})),tRe=Object.freeze(Object.defineProperty({__proto__:null,build:h$1L},Symbol.toStringTag,{value:"Module"})),rRe=Object.freeze(Object.defineProperty({__proto__:null,build:d$1W},Symbol.toStringTag,{value:"Module"})),iRe=Object.freeze(Object.defineProperty({__proto__:null,build:F$C,calculateAnchorPosForRendering:D$G},Symbol.toStringTag,{value:"Module"})),nRe=Object.freeze(Object.defineProperty({__proto__:null,build:f$1D},Symbol.toStringTag,{value:"Module"})),sRe=Object.freeze(Object.defineProperty({__proto__:null,build:f$1B,getRadius:d$1y},Symbol.toStringTag,{value:"Module"})),oRe=Object.freeze(Object.defineProperty({__proto__:null,build:H$w},Symbol.toStringTag,{value:"Module"})),aRe=Object.freeze(Object.defineProperty({__proto__:null,build:I$N},Symbol.toStringTag,{value:"Module"})),lRe=Object.freeze(Object.defineProperty({__proto__:null,build:S$Y},Symbol.toStringTag,{value:"Module"})),cRe=Object.freeze(Object.defineProperty({__proto__:null,build:y$11,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"})),uRe=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:SY,build:l$27},Symbol.toStringTag,{value:"Module"})),hRe=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:AJ,build:l$21},Symbol.toStringTag,{value:"Module"})),dRe=Object.freeze(Object.defineProperty({__proto__:null,build:C$t},Symbol.toStringTag,{value:"Module"})),pRe=Object.freeze(Object.defineProperty({__proto__:null,build:u$1h},Symbol.toStringTag,{value:"Module"})),fRe=Object.freeze(Object.defineProperty({__proto__:null,build:O$s},Symbol.toStringTag,{value:"Module"})),mRe=Object.freeze(Object.defineProperty({__proto__:null,build:f$S},Symbol.toStringTag,{value:"Module"})),yRe=Object.freeze(Object.defineProperty({__proto__:null,build:S$y},Symbol.toStringTag,{value:"Module"})),gRe=Object.freeze(Object.defineProperty({__proto__:null,build:S$v},Symbol.toStringTag,{value:"Module"})),vRe=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:tde,build:B$c},Symbol.toStringTag,{value:"Module"})),_Re=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Kde},build:u$V},Symbol.toStringTag,{value:"Module"})),$Re=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Cpe,ColorizerStretchUniforms:Ppe,ColorizerUniforms:Epe,build:h$A},Symbol.toStringTag,{value:"Module"})),bRe=Object.freeze(Object.defineProperty({__proto__:null,build:V$c},Symbol.toStringTag,{value:"Module"})),wRe=Object.freeze(Object.defineProperty({__proto__:null,build:g$v},Symbol.toStringTag,{value:"Module"})),xRe=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:bye,build:l$Y},Symbol.toStringTag,{value:"Module"})),SRe=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:fye,blurSize:.4,build:i$_,gridCellPixelSize:mye,outlineSize:yye},Symbol.toStringTag,{value:"Module"})),TRe=Object.freeze(Object.defineProperty({__proto__:null,build:M$c},Symbol.toStringTag,{value:"Module"})),ERe=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Dye,build:v$h},Symbol.toStringTag,{value:"Module"})),PRe=Object.freeze(Object.defineProperty({__proto__:null,build:c$19},Symbol.toStringTag,{value:"Module"})),CRe=Object.freeze(Object.defineProperty({__proto__:null,build:s$P},Symbol.toStringTag,{value:"Module"})),ORe=Object.freeze(Object.defineProperty({__proto__:null,build:l$W},Symbol.toStringTag,{value:"Module"})),ARe=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:ege,build:m$O},Symbol.toStringTag,{value:"Module"})),MRe=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:sge,build:a$Y},Symbol.toStringTag,{value:"Module"})),RRe=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:lge,build:n$14},Symbol.toStringTag,{value:"Module"})),IRe=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:vve,build:w$i},Symbol.toStringTag,{value:"Module"})),LRe=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:dve,build:w$j},Symbol.toStringTag,{value:"Module"})),DRe=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Nve,build:b$g},Symbol.toStringTag,{value:"Module"}));export{c$2m as $,Ja as A,l$2B as B,QY as C,o$27 as D,i$2x as E,P$$ as F,G$Y as G,n$3Y as H,zo as I,J$G as J,h$2e as K,_$1z as L,M$h as M,z$1d as N,o$44 as O,Xa as P,n$4A as Q,C_ as R,zi as S,tY as T,d$g as U,Wa as V,b$2g as W,i$26 as X,l$2b as Y,Y_ as Z,zt as _,a$4y as a,f$P as a$,e$4e as a0,xA as a1,FE as a2,P$G as a3,Z9 as a4,Y3 as a5,u$6 as a6,n$1E as a7,gI as a8,Z5 as a9,r$3O as aA,t$4s as aB,l$43 as aC,j$1E as aD,Fa as aE,s$4u as aF,bce as aG,v$20 as aH,j$1K as aI,F$18 as aJ,J$K as aK,T$1k as aL,e$3Y as aM,m$2t as aN,xn as aO,K$G as aP,A$1z as aQ,ge$6 as aR,Fe$1 as aS,Ie$4 as aT,g$2j as aU,E$1D as aV,x$1G as aW,I$1w as aX,Tu as aY,k$1t as aZ,tCe as a_,W4 as aa,pCe as ab,a$1x as ac,O$1g as ad,w$1T as ae,p$a as af,x$1j as ag,n$6 as ah,Re$1 as ai,lT as aj,b_ as ak,eT as al,PS as am,xS as an,$S as ao,rS as ap,mT as aq,f$3i as ar,jr as as,y$2D as at,Wt as au,o$2e as av,Yo as aw,Ta as ax,ua as ay,aa as az,Ir as b,s$46 as b$,f$2Z as b0,pr as b1,g$1N as b2,s$4o as b3,a$3d as b4,Gue as b5,u$C as b6,i$Q as b7,V$g as b8,u$47 as b9,g$1Z as bA,Z$I as bB,v$1z as bC,x15 as bD,n$Q as bE,V$19 as bF,it$h as bG,Ht$2 as bH,Kv as bI,r$3B as bJ,e$3$ as bK,bM as bL,r$3y as bM,q$H as bN,t$47 as bO,y$1w as bP,z$M as bQ,I$1q as bR,A$1a as bS,P$18 as bT,h$2A as bU,e$3G as bV,B$11 as bW,e$3E as bX,h$30 as bY,U$1a as bZ,W$M as b_,m$a as ba,n$3T as bb,La as bc,v$1W as bd,gr as be,p$4D as bf,L$1i as bg,g$2s as bh,a$1k as bi,r$3s as bj,Pn as bk,Mi as bl,on as bm,a$4H as bn,Ile as bo,Z$z as bp,ge as bq,r$35 as br,d$3w as bs,o$4l as bt,p$4e as bu,m$2_ as bv,Qv as bw,i$5 as bx,n$4L as by,Y$F as bz,c$4_ as c,j$1a as c$,j$R as c0,l$t as c1,z_ as c2,be$3 as c3,i$3H as c4,u$3E as c5,u$o as c6,An as c7,o$3g as c8,m$1j as c9,Da as cA,n$4G as cB,i$3t as cC,O$1y as cD,Z$t as cE,gt$6 as cF,u$3J as cG,F$1b as cH,D$19 as cI,n$3I as cJ,d$2Y as cK,a$4s as cL,w$1X as cM,u$3F as cN,l$49 as cO,m$3w as cP,s$3_ as cQ,a$4i as cR,g$2p as cS,tv as cT,o$4o as cU,pv as cV,e$35 as cW,u$2J as cX,q$J as cY,d$2c as cZ,n$44 as c_,dd as ca,x$1V as cb,i$28 as cc,j$1O as cd,a$40 as ce,u$3m as cf,S$G as cg,c$4k as ch,f$2O as ci,j$1r as cj,e$1T as ck,V$t as cl,B$j as cm,G$f as cn,k$u as co,q$l as cp,w$L as cq,v$H as cr,f$1u as cs,Y$a as ct,z$1a as cu,e$3F as cv,c$4l as cw,e$3Z as cx,O$1v as cy,r$2W as cz,wce as d,Pj as d$,p$2Z as d0,l$31 as d1,w8 as d2,l$6 as d3,c$9 as d4,I11 as d5,_$1p as d6,W$J as d7,K$D as d8,W$L as d9,e$3A as dA,P$1g as dB,g$2z as dC,u$3Y as dD,h$2x as dE,Ny as dF,Zf as dG,a$2O as dH,v$1Q as dI,ej as dJ,k$1k as dK,G$$ as dL,E$1A as dM,a$42 as dN,GZ as dO,lee as dP,gt$9 as dQ,h$2z as dR,y$1t as dS,m$2j as dT,j$18 as dU,p$2U as dV,nO as dW,NJ as dX,l$3X as dY,a$1_ as dZ,u$1I as d_,Bs as da,Vs as db,Us as dc,Ws as dd,Qs as de,Y$A as df,M$1g as dg,H$13 as dh,a$3U as di,T$15 as dj,Xf as dk,m$3f as dl,d$3c as dm,l$47 as dn,Ed as dp,g$1o as dq,S$1E as dr,p$1L as ds,s$4g as dt,r$3w as du,i$4i as dv,$$D as dw,E$1z as dx,F$11 as dy,j$1w as dz,e$4o as e,Te$2 as e$,c$3A as e0,f$1L as e1,VG as e2,Pd as e3,ht$a as e4,RZ as e5,x$1W as e6,yse as e7,Bi as e8,q$X as e9,h$m as eA,forceUpdate as eB,proxyCustomElement as eC,mbe as eD,K$e as eE,getAssetPath as eF,i$4 as eG,g$2J as eH,l$F as eI,a$I as eJ,u$x as eK,hxe as eL,L$14 as eM,i$J as eN,n_ as eO,o$e as eP,t$3 as eQ,i$2 as eR,W6 as eS,Y6 as eT,X6 as eU,p$z as eV,c$r as eW,L$1h as eX,B$W as eY,ot$i as eZ,r$l as e_,pD as ea,Om as eb,e$3y as ec,c$1q as ed,h$2U as ee,c$4z as ef,d$2m as eg,h$21 as eh,bt$5 as ei,I$1E as ej,s83 as ek,Np as el,p$1c as em,l$H as en,b$9 as eo,j$a as ep,S$a as eq,a$4D as er,v$21 as es,o$40 as et,Eh as eu,exe as ev,e$g as ew,t$5 as ex,s$x as ey,Gv as ez,t$3R as f,c$3z as f$,A$1B as f0,C$1p as f1,c$4r as f2,o$4s as f3,f$A as f4,u$L as f5,p$1s as f6,Eme as f7,sye as f8,oye as f9,lt$7 as fA,MW as fB,t$4t as fC,cy as fD,n$49 as fE,t$2W as fF,O$1e as fG,E$1O as fH,n$2Y as fI,n$4T as fJ,dt$8 as fK,F$1a as fL,$t$1 as fM,o$4x as fN,N$13 as fO,oE as fP,Ea as fQ,p$3d as fR,n$4t as fS,y$2C as fT,f$3z as fU,n$4H as fV,i$1k as fW,s$1f as fX,g$2C as fY,W9 as fZ,F$V as f_,HL as fa,qL as fb,ite as fc,ho as fd,YTe as fe,rE as ff,H$T as fg,K$u as fh,ot$8 as fi,rt$8 as fj,p$4N as fk,et$7 as fl,nt$8 as fm,tt$9 as fn,c$3S as fo,pe$a as fp,AW as fq,OW as fr,Ae$1 as fs,Ue$1 as ft,ye$6 as fu,_e$5 as fv,N$17 as fw,A$1F as fx,_$1x as fy,Et$4 as fz,d$3d as g,S$1T as g$,u$3V as g0,i$4F as g1,l$L as g2,f$7 as g3,t$t as g4,ir as g5,axe as g6,txe as g7,nw as g8,Dw as g9,I$1y as gA,ma as gB,e$4h as gC,zwe as gD,Vg as gE,Ng as gF,g$1O as gG,s$4b as gH,v$27 as gI,V$e as gJ,wbe as gK,createEvent as gL,y$2e as gM,n$4V as gN,_$1o as gO,y$F as gP,h$2_ as gQ,g$2F as gR,J$c as gS,S$1U as gT,Qee as gU,S$1O as gV,m$3H as gW,eAe as gX,t$e as gY,zN as gZ,Uo as g_,XS as ga,dT as gb,e$i as gc,i$L as gd,M$1x as ge,vo as gf,m$3K as gg,b$2c as gh,Ki as gi,$$7 as gj,Z$7 as gk,w$x as gl,rxe as gm,t$4m as gn,u$37 as go,l$b as gp,i$41 as gq,d$3n as gr,j_ as gs,t$3u as gt,t$6 as gu,c$4q as gv,Ci as gw,oAe as gx,m$3A as gy,V$14 as gz,Up as h,Q$F as h$,jle as h0,n$1u as h1,R$1f as h2,d$3l as h3,p$7 as h4,k$1C as h5,d$3z as h6,Cn as h7,nn$2 as h8,f$2Q as h9,TG as hA,S$1P as hB,u$3n as hC,o$2R as hD,i$3X as hE,c$47 as hF,r$2_ as hG,o$3R as hH,l$33 as hI,GW as hJ,l$2K as hK,se$e as hL,q$11 as hM,b$1Z as hN,v$1N as hO,v$22 as hP,K$B as hQ,S$19 as hR,l$4E as hS,a$4C as hT,ki as hU,Wue as hV,Rg as hW,n$4O as hX,Fg as hY,R$1e as hZ,L$18 as h_,Ih as ha,Lh as hb,h$2B as hc,Rn as hd,M$1o as he,s$41 as hf,ct$a as hg,E$1H as hh,t$2H as hi,t$2G as hj,a$4g as hk,_B as hl,m$3R as hm,e$3R as hn,XX as ho,CZ as hp,qO as hq,_$1s as hr,nY as hs,U$17 as ht,o$3d as hu,d$1D as hv,a$2l as hw,s$1h as hx,i$47 as hy,c$2k as hz,Za as i,t$4p as i$,Wt$2 as i0,Sv as i1,T$1 as i2,i$i as i3,i$h as i4,c$s as i5,o$8 as i6,nCe as i7,A$1J as i8,a$1B as i9,Q8 as iA,D6 as iB,Q5 as iC,f$2v as iD,p$i as iE,c$g as iF,c$p as iG,p$46 as iH,g$1X as iI,p$d as iJ,Kwe as iK,nOe as iL,l$9 as iM,nxe as iN,Qwe as iO,ew as iP,BEe as iQ,jEe as iR,Jwe as iS,VOe as iT,s$6 as iU,n$3J as iV,l$3B as iW,t$3q as iX,f$2t as iY,r64 as iZ,rAe as i_,wE as ia,o$3F as ib,pt$5 as ic,M$1r as id,O$1m as ie,CW as ig,z$w as ih,n$3P as ii,PW as ij,e$44 as ik,q1 as il,TK as im,EK as io,_$1j as ip,V$11 as iq,JY as ir,M$1i as is,st$j as it,A$1I as iu,R$n as iv,p$1Y as iw,c$1X as ix,V$w as iy,$9 as iz,wa as j,A$1L as j$,L9 as j0,rMe as j1,hAe as j2,fAe as j3,yAe as j4,$Ae as j5,a$3w as j6,e$3c as j7,i$1n as j8,x$1P as j9,w$4 as jA,b$2 as jB,j$3 as jC,I$3 as jD,q$1 as jE,F$1 as jF,A$5 as jG,O$3 as jH,P$3 as jI,S$3 as jJ,E$3 as jK,FOe as jL,v$28 as jM,sxe as jN,ACe as jO,Ts as jP,Ss as jQ,n$4E as jR,te2 as jS,N13 as jT,A$1 as jU,S$1u as jV,J$z as jW,e$2E as jX,o$3V as jY,i$4r as jZ,Z$j as j_,Pa as ja,jOe as jb,Wn as jc,Ct$5 as jd,pt$9 as je,K$I as jf,o$a as jg,U$3 as jh,Nwe as ji,cxe as jj,lxe as jk,u$41 as jl,SEe as jm,x$2 as jn,JPe as jo,GSe as jp,VEe as jq,HTe as jr,K6 as js,Q6 as jt,J6 as ju,R$1 as jv,F$2 as jw,v$4 as jx,w$1n as jy,m$c as jz,n$4c as k,a$f as k$,fle as k0,w$24 as k1,Q$1 as k2,Cm as k3,L$1 as k4,D4 as k5,r$U as k6,o$T as k7,L$1d as k8,s$2a as k9,jO as kA,UO as kB,GO as kC,m$2W as kD,bR as kE,$R as kF,nce as kG,Wf as kH,z$_ as kI,aU as kJ,xU as kK,G$I as kL,gle as kM,UT as kN,SOe as kO,N$1 as kP,o$3L as kQ,e$3N as kR,X$x as kS,rx as kT,m$3z as kU,o$35 as kV,B$N as kW,b$2d as kX,c$53 as kY,Cre as kZ,c$Q as k_,ste as ka,y$1o as kb,_$1y as kc,l$2d as kd,jt as ke,x$1f as kf,v$1k as kg,s$3Y as kh,x$1H as ki,A$1G as kj,x$1B as kk,q$V as kl,n$48 as km,eZ as kn,Qq as ko,t$3J as kp,R$w as kq,b$K as kr,rY as ks,eD as kt,o$4q as ku,r$1Y as kv,l$4F as kw,Zh as kx,ON as ky,qR as kz,qg as l,a$36 as l$,s$4m as l0,x$1h as l1,lE as l2,PCe as l3,a$8 as l4,zCe as l5,BCe as l6,Vwe as l7,DateTime as l8,FixedOffsetZone as l9,PL as lA,uL as lB,wL as lC,EL as lD,cL as lE,c$1Z as lF,NL as lG,CL as lH,SL as lI,X$z as lJ,a$4j as lK,h$2J as lL,s$45 as lM,S$1r as lN,F$15 as lO,Dh as lP,Nh as lQ,Gh as lR,jue as lS,qTe as lT,Zone as lU,IANAZone as lV,Ph as lW,Rh as lX,Ch as lY,c$4u as lZ,x$o as l_,b$1x as la,g$2x as lb,l$4D as lc,NO as ld,SA as le,vA as lf,CH as lg,vle as lh,i$O as li,l$M as lj,a$O as lk,fo as ll,n$3X as lm,s$3F as ln,pd as lo,i$45 as lp,I$1t as lq,t$3L as lr,sO as ls,o$x as lt,A$V as lu,wme as lv,a$11 as lw,EA as lx,hL as ly,xL as lz,has as m,_d as m$,XO as m0,nM as m1,ZO as m2,YO as m3,HO as m4,oM as m5,md as m6,r$3M as m7,Epe as m8,t$D as m9,Qre as mA,r$3D as mB,t$4e as mC,Oa as mD,o$3w as mE,b$1H as mF,M$x as mG,S$1j as mH,JX as mI,b$26 as mJ,r$6 as mK,I$1h as mL,J$w as mM,M$17 as mN,f$3u as mO,HAe as mP,W$H as mQ,Gr as mR,n$3g as mS,Z$A as mT,m$25 as mU,ds as mV,V$12 as mW,H$$ as mX,p$4z as mY,Od as mZ,d$32 as m_,ae$e as ma,s$34 as mb,e$2F as mc,Ere as md,l$1B as me,s$1w as mf,Bee as mg,r$19 as mh,Xee as mi,o$11 as mj,tte as mk,t$1_ as ml,r$1L as mm,u$1P as mn,f$10 as mo,f$12 as mp,o$15 as mq,f$$ as mr,o$12 as ms,l$1E as mt,u$1j as mu,e$1n as mv,n$2n as mw,e$1o as mx,vL as my,Gee as mz,ar as n,u$3Z as n$,h$V as n0,no as n1,R$1h as n2,Bwe as n3,Fragment as n4,k$e as n5,I$1u as n6,f$1G as n7,pH as n8,X3 as n9,_Ce as nA,v$1v as nB,L$X as nC,O$17 as nD,w$1u as nE,je as nF,M$K as nG,e$3l as nH,pl as nI,t$h as nJ,Ewe as nK,Cwe as nL,bCe as nM,mOe as nN,TOe as nO,zOe as nP,$$B as nQ,as as nR,t$E as nS,Noe as nT,c$4e as nU,yI as nV,t$3M as nW,I$1c as nX,_$12 as nY,r$36 as nZ,s$4f as n_,N$1f as na,e$n as nb,Nbe as nc,r$j as nd,n$K as ne,c$11 as nf,l$4G as ng,A$1E as nh,et$g as ni,o$4e as nj,t$42 as nk,T$1n as nl,n$4u as nm,o$4d as nn,f$3s as no,e$45 as np,it$7 as nq,ct$6 as nr,i$4L as ns,u$44 as nt,t$4u as nu,c$55 as nv,l$4c as nw,rr as nx,b$_ as ny,u$25 as nz,H_ as o,rTe as o$,i$3I as o0,tt$k as o1,ut$d as o2,c$4$ as o3,Rb as o4,DOe as o5,$4 as o6,J$1 as o7,P$h as o8,JCe as o9,O$1l as oA,y$2p as oB,k$11 as oC,fd as oD,u$1k as oE,w$1h as oF,f$1q as oG,t$4y as oH,G$D as oI,U$U as oJ,E$1l as oK,wt$6 as oL,mt$7 as oM,YE as oN,R$1b as oO,ft$8 as oP,l$3_ as oQ,pt$8 as oR,at$d as oS,nn as oT,L$S as oU,n$3H as oV,m$3G as oW,_p as oX,g$7 as oY,i$4y as oZ,WSe as o_,pOe as oa,r$2U as ob,uAe as oc,f$1Y as od,z$H as oe,j$11 as of,ple as og,dle as oh,R$Y as oi,u$23 as oj,e$3C as ok,st$e as ol,xI as om,x$V as on,i$w as oo,r$8 as op,J$b as oq,ix as or,a$4K as os,ote as ot,Rt$3 as ou,G$_ as ov,b$1q as ow,g$Q as ox,D$14 as oy,ji as oz,p$4J as p,Vve as p$,_T as p0,H$19 as p1,p$4v as p2,p$4Z as p3,a$1o as p4,b$1Y as p5,p$1K as p6,n$2c as p7,m$16 as p8,b$z as p9,v$1_ as pA,l$4a as pB,l$4d as pC,r$3n as pD,o$3U as pE,Z$G as pF,K$j as pG,t$3Z as pH,r$3o as pI,lJ as pJ,aJ as pK,l$4z as pL,O$16 as pM,wI as pN,j$1V as pO,dn as pP,w$1_ as pQ,g$2l as pR,y$24 as pS,g$2c as pT,s$31 as pU,ud as pV,v$1M as pW,o$3r as pX,$n as pY,c$3c as pZ,J$E as p_,w$w as pa,V$h as pb,i$48 as pc,F$17 as pd,j$1I as pe,F$T as pf,ZE as pg,BE as ph,a$1p as pi,m$17 as pj,BO as pk,gm as pl,r$37 as pm,T$19 as pn,It$2 as po,x$M as pp,$$k as pq,H$t as pr,U$C as ps,at$9 as pt,ht$7 as pu,y$2k as pv,x$1S as pw,e$1S as px,t$1Z as py,s$2b as pz,iY as q,oe2 as q$,yOe as q0,IE as q1,u$1X as q2,KH as q3,r$2t as q4,mte as q5,i$4v as q6,k$1i as q7,sJ as q8,r$12 as q9,H$1 as qA,pI as qB,u$13 as qC,k8 as qD,ace as qE,lce as qF,t$c as qG,p$59 as qH,r$3P as qI,n$4S as qJ,Z$p as qK,O$1q as qL,N$16 as qM,ha as qN,m$2a as qO,NZ as qP,o$3E as qQ,wee as qR,rZ as qS,f$2W as qT,h$2D as qU,h$2$ as qV,I$1K as qW,L$$ as qX,yle as qY,ue as qZ,h$K as q_,T$1d as qa,et$f as qb,de2 as qc,n$2t as qd,QH as qe,mj as qf,y$2c as qg,p$b as qh,w$22 as qi,$$J as qj,H$M as qk,n$43 as ql,O$1s as qm,G$S as qn,u$21 as qo,L$P as qp,ye as qq,L$10 as qr,r$33 as qs,hn as qt,s$2N as qu,z$$ as qv,O$1 as qw,RAe as qx,I$14 as qy,sce as qz,c$13 as r,fX as r$,ne2 as r0,J4 as r1,B$f as r2,g$12 as r3,t$2L as r4,he2 as r5,n$7 as r6,W$K as r7,e$2D as r8,t$2F as r9,nSe as rA,sSe as rB,mpe as rC,hpe as rD,hK as rE,h$_ as rF,p$20 as rG,BQ as rH,d$1f as rI,mK as rJ,yK as rK,ape as rL,due as rM,oSe as rN,hie as rO,g$O as rP,boe as rQ,e$1Y as rR,TW as rS,E$1j as rT,d$1w as rU,m$1O as rV,ev as rW,kW as rX,CB as rY,PB as rZ,Mle as r_,r$39 as ra,s$3I as rb,mS as rc,me2 as rd,jG as re,m$1I as rf,b$Y as rg,A$S as rh,DAe as ri,q7 as rj,N$10 as rk,pK as rl,upe as rm,W8 as rn,Fue as ro,D8 as rp,dpe as rq,P8 as rr,f$19 as rs,a$1J as rt,F8 as ru,bxe as rv,uue as rw,Nr as rx,ppe as ry,cpe as rz,s$3x as s,Vue as s$,dI as s0,t$4a as s1,E$1m as s2,Wq as s3,m$l as s4,F$z as s5,t$3P as s6,y$15 as s7,BG as s8,MS as s9,v$5 as sA,VSe as sB,LSe as sC,p$14 as sD,TTe as sE,fTe as sF,R$x as sG,T$F as sH,D$s as sI,h$1j as sJ,zTe as sK,Ai as sL,ISe as sM,LEe as sN,$T as sO,bT as sP,wT as sQ,qt$3 as sR,o$4m as sS,c$4Q as sT,x$1u as sU,i$3J as sV,i$4C as sW,c$4P as sX,o$1M as sY,pue as sZ,bue as s_,d$15 as sa,vT as sb,xoe as sc,b$13 as sd,Hq as se,koe as sf,m$2r as sg,e$3D as sh,r$2C as si,T$_ as sj,_$1l as sk,L$17 as sl,J$M as sm,f$2J as sn,a$41 as so,A$1s as sp,D$12 as sq,w$1L as sr,k$13 as ss,j$1J as st,xue as su,y$1C as sv,i$4Y as sw,a$4d as sx,c$4H as sy,Hwe as sz,t$4r as t,z$ as t$,t$1f as t0,e$13 as t1,W1 as t2,rM as t3,QO as t4,eM as t5,Z1 as t6,o$43 as t7,fpe as t8,n$2p as t9,b$1t as tA,qi as tB,Sp as tC,Q$B as tD,E$1k as tE,g$1Y as tF,r$31 as tG,x$1I as tH,L$R as tI,vd as tJ,o$2T as tK,wn as tL,bn as tM,f$2c as tN,t$4h as tO,Lo as tP,Io as tQ,Do as tR,OE as tS,j$1R as tT,Ge$2 as tU,i$4d as tV,jbe as tW,b$1V as tX,v$1K as tY,g$27 as tZ,f$2H as t_,zue as ta,t$22 as tb,Y1 as tc,hue as td,lpe as te,FO as tf,D$f as tg,ohe as th,A$1f as ti,z$Q as tj,j$1b as tk,y$1A as tl,Gt as tm,a$4k as tn,G$V as to,N$1a as tp,n$3Z as tq,E$r as tr,e$3_ as ts,ZC as tt,R$1a as tu,j$1x as tv,pn as tw,j$1z as tx,Y$x as ty,l$4n as tz,u$4d as u,y$1k as u$,pEe as u0,h$Z as u1,s$4A as u2,q$ as u3,o$2Y as u4,r$m as u5,A$ as u6,$b as u7,Cb as u8,V$ as u9,M$1p as uA,z$17 as uB,ee$g as uC,Z$H as uD,i$2$ as uE,UC as uF,kC as uG,VC as uH,i$4s as uI,BC as uJ,R$P as uK,v$15 as uL,M$1A as uM,R$1m as uN,E$1I as uO,R$1g as uP,x$1T as uQ,n$R as uR,i$4J as uS,u$12 as uT,r$W as uU,r$3L as uV,t$4q as uW,d$X as uX,R$_ as uY,w$1U as uZ,v$v as u_,i$4U as ua,xu as ub,i$N as uc,i$3$ as ud,N$p as ue,g$V as uf,Vb as ug,Gb as uh,Wb as ui,t$v as uj,n$U as uk,_n as ul,WC as um,$$F as un,fte as uo,l$1J as up,p$1Z as uq,_$1v as ur,r$3q as us,Ys as ut,o$3I as uu,re$e as uv,G$W as uw,u$1y as ux,R$18 as uy,L$13 as uz,RT as v,u$4f as v$,y$1B as v0,t$3N as v1,y$R as v2,b$21 as v3,it$c as v4,l$3V as v5,x$1z as v6,x$1E as v7,g$1v as v8,J$D as v9,oO as vA,N_e as vB,t$4z as vC,g$Y as vD,z$o as vE,s$1F as vF,i$1L as vG,Y4 as vH,K1 as vI,j1 as vJ,G1 as vK,o$4b as vL,PK as vM,a$1N as vN,o$39 as vO,p$2u as vP,g$1i as vQ,d$2A as vR,Su as vS,l$1S as vT,Nt$1 as vU,N$B as vV,w$$ as vW,bo as vX,O$G as vY,Q1 as vZ,H1 as v_,k$1y as va,f$2a as vb,M$11 as vc,p$2$ as vd,l$1r as ve,J$d as vf,a$1L as vg,c$1R as vh,X5 as vi,n$1T as vj,e$1x as vk,a$1M as vl,i$1M as vm,s$1G as vn,O$1o as vo,B1 as vp,Q$e as vq,A$E as vr,_K as vs,oK as vt,t$3Y as vu,o0 as vv,u0 as vw,J1 as vx,X1 as vy,l$1P as vz,Hue as w,y$1M as w$,ft$5 as w0,fl as w1,y$a as w2,s$t as w3,CE as w4,gO as w5,d$1$ as w6,o$2n as w7,o$2P as w8,P$H as w9,i$2J as wA,bj as wB,Ote as wC,fM as wD,VH as wE,lL as wF,d$1K as wG,tj as wH,b$1F as wI,z$S as wJ,uD as wK,iO as wL,tx as wM,nj as wN,FI as wO,pO as wP,aq as wQ,lO as wR,hM as wS,a$32 as wT,a$2n as wU,mA as wV,sA as wW,JA as wX,AN as wY,g$1A as wZ,Y$s as w_,a$2L as wa,CO as wb,dO as wc,WR as wd,e$2S as we,NI as wf,LO as wg,s$2Z as wh,r$2w as wi,fA as wj,gA as wk,S$1g as wl,c$2o as wm,h$1V as wn,f$1O as wo,OA as wp,l$2s as wq,s$2m as wr,AA as ws,qH as wt,ZH as wu,YH as wv,_$N as ww,GI as wx,hse as wy,h$1Q as wz,d$3e as x,wH as x$,tM as x0,mle as x1,m$18 as x2,ae as x3,se as x4,L$i as x5,YT as x6,BT as x7,_$1k as x8,U$14 as x9,E$Z as xA,b$19 as xB,_$16 as xC,D$V as xD,WE as xE,P$Y as xF,N$X as xG,u$3j as xH,HA as xI,U$13 as xJ,p$4I as xK,l$2C as xL,ss as xM,m$3h as xN,ms as xO,Ad as xP,YI as xQ,ZI as xR,oR as xS,xH as xT,rq as xU,u$1_ as xV,dM as xW,v$W as xX,aO as xY,Mme as xZ,zO as x_,d$2$ as xa,b$1_ as xb,h$1I as xc,f$31 as xd,hO as xe,l$2_ as xf,pM as xg,c$4O as xh,NR as xi,k$K as xj,j$1A as xk,y$2a as xl,B$10 as xm,r$3a as xn,y$25 as xo,n$3W as xp,f$20 as xq,p$2Q as xr,uO as xs,yj as xt,_j as xu,wj as xv,QB as xw,d$20 as xx,p$2m as xy,H$J as xz,y$2v as y,vme as y0,Pme as y1,uye as y2,SH as y3,t$1t as y4,C$O as y5,Cme as y6,Fme as y7,zme as y8,k$G as y9,b$20 as yA,Hh as yB,nd as yC,XW as yD,pte as yE,eie as yF,cSe as yG,MCe as yH,aAe as yI,jMe as yJ,fa as ya,F$1f as yb,x$i as yc,i$4n as yd,N$C as ye,Bg as yf,nT as yg,mx as yh,y$2z as yi,e$c as yj,o$2A as yk,d$1z as yl,TJ as ym,vR as yn,i$2S as yo,DO as yp,i$2T as yq,f$f as yr,l$2O as ys,$v as yt,c$2X as yu,f$1C as yv,z$13 as yw,PN as yx,p$4y as yy,i$2n as yz,e$4f as z};
