import{br as e,dM as t,dN as i,dW as r,dZ as s,d_ as a,d$ as n,aM as o,H as l,e0 as u,e1 as h,e2 as _,O as d,e3 as p,e4 as m,e5 as c,Q as g}from"./index-DSIPxOWi.js";import{a as S}from"./LineVisualElement-EjMrPPob.js";class x extends S{constructor(t){super(t),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=e(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=e(1,1,1,1),this._elevationInfo=null,this.applyProperties(t)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){t(e,this._color)||(i(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){t(e,this._outlineColor)||(i(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(r.SIZE).data,s=this._geometrySize;i[0]=s,i[1]=s,e.geometryVertexAttributeUpdated(e.geometries[0],r.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:s(this._primitive),distanceFieldBoundingBox:v,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null==(e=this._texture)?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/f}createExternalResources(){this._texture=a(this._primitive,this._preferredTextureSize),this._material=new n(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return o(2*this._geometrySize,16,128)}calculateMapBounds(e){var t;const i=null==(t=this.object)?void 0:t.geometries[0];if(!i)return!1;const s=i.attributes.get(r.POSITION).data;return l(s,this.view.renderCoordsHelper.spatialReference,z,this.view.spatialReference),u(e,z),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:r}=this.view,s=h(e,r,_.fromElevationInfo(this.elevationInfo),i),a=d(p.get(),e.x,e.y,s),n=p.get();l(a,e.spatialReference,n,i.spatialReference);const o=this._geometrySize;return m(t,null,n,null,[o,o],[0,0,0,1])}}const f=c,v=[f/2,f/2,1-f/2,1-f/2],z=g();export{x};
