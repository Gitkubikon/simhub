import{d as e,I as r,fP as s,v as o,nx as l,e as u,y as d,a as p,S as h,ns as y,b3 as m,b9 as g,ny as v,u as w,g as b,C as x,nz as P,P as R,A as O,p as q,nA as M,ab as E,bd as C,mL as I,ag as S,n as V,a2 as N,c4 as D,mM as T,nB as A,mN as j,nC as Q,nD as L,mF as H,nE as G,b as Z,af as B,nF as k,ah as U,nG as $,w as z}from"./index-DSIPxOWi.js";import{a as J,C as Y,T as W,u as K}from"./HeatmapDensity.glsl-jGaN0eX9.js";import{l as X}from"./LayerView3D-ApO6iJqK.js";import{E as ee,c as te}from"./query-C2USZ63O.js";import{h as re}from"./WorkerHandle-Bq2affGI.js";import{h as ie}from"./EventedSet-D3TBRYG7.js";import{o as se}from"./floorFilterUtils-2NbRkqHK.js";import{y as ae}from"./LayerView-DMoB2q_T.js";import{i as oe}from"./RefreshableLayerView-MYyyoaX8.js";class t extends e{constructor(e,r,s,o,l,u){super(e.usedMemory,e.displayedFeatures,e.totalFeatures,e.maximumFeatures,e.nodes,e.core),this.storedFeatures=r,this.totalVertices=s,this.partial=o,this.mode=l,this.symbolComplexity=u}}class n{constructor(e){this._controller=e,this._handle=new c((r=>e.schedule(r)))}destroy(){this._handle.destroy()}invoke(e,l){return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof r&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,l).then((e=>{let l=0,u=0;const d=r.fromJSON(e.spatialReference);e.spatialReference=d;const i2=async r=>{const p=e.fields;if(p)for(;l<p.length;)if(p[l]=s.fromJSON(p[l]),l++,r.madeProgress())return this._controller.reschedule((e=>i2(e)));const h=e.features;for(;u<h.length;){const e=h[u];++u,e.uid=o.generateUID();const s=e.geometry;if(null!=s&&(s.spatialReference=d,a(s),r.madeProgress()))return this._controller.reschedule((e=>i2(e)))}return e};return this._controller.schedule((e=>i2(e)))}))):Promise.resolve(null)}}function a(e){switch(e.type){case"polyline":e.paths.reduce(((e,r)=>e+r.length),0)<l&&(e.paths=e.hasZ||e.hasM?e.paths.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.paths.map((e=>e.map((e=>[e[0],e[1]])))));break;case"polygon":e.rings.reduce(((e,r)=>e+r.length),0)<l&&(e.rings=e.hasZ||e.hasM?e.rings.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.rings.map((e=>e.map((e=>[e[0],e[1]])))))}}class c extends re{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:e=>[e.buffer]},e)}}let ne=class extends h{constructor(e){super(e)}get implicitFields(){var e;if(!(null==(e=this.layer.outFields)?void 0:e.includes("*")))return new Set;const r=new Set(this.layerView.requiredFields),s=new Set(this.layerView.availableFields);return y(s,r)}get queryFeaturesDehydrated(){var e;const{layer:r}=this,s=r.capabilities,o=s&&s.query,l=o&&o.supportsFormatPBF,u=r.parsedUrl;if(l){null==this._decoder&&(this._decoder=new n(this.controller));const s={sourceSpatialReference:(null==(e=r.spatialReference)?void 0:e.toJSON())??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:ce};return(e,r)=>ee(u,e,"pbf",this._createRequestOptions(r)).then((e=>(m(r),null!=this._decoder?this._decoder.invoke({buffer:e.data,options:s},r.signal):Promise.reject(g()))))}return(e,s)=>te(u,e,r.spatialReference,this._createRequestOptions(s)).then((e=>v(e.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:ce})))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}destroy(){this._decoder=w(this._decoder)}_createRequestOptions(e){return{...e,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query}}}};u([d({constructOnly:!0})],ne.prototype,"layer",void 0),u([d({constructOnly:!0})],ne.prototype,"layerView",void 0),u([d({constructOnly:!0})],ne.prototype,"controller",void 0),u([d({readOnly:!0})],ne.prototype,"implicitFields",null),u([d({readOnly:!0})],ne.prototype,"queryFeaturesDehydrated",null),ne=u([p("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],ne);let le=class extends h{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.layer.queryFeatures(e,r)}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}};u([d({constructOnly:!0})],le.prototype,"layer",void 0),u([d({readOnly:!0})],le.prototype,"queryFeaturesDehydrated",null),le=u([p("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],le);let ue=class extends h{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.layer.queryFeatures(e,r)}};u([d({constructOnly:!0})],ue.prototype,"layer",void 0),ue=u([p("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],ue);let de=class extends h{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.source.queryFeaturesJSON(e,r).then(v,(s=>{if(s&&"query-features-json:unsupported"===s.name)return this.layer.queryFeatures(e,r);throw s}))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}};u([d({constructOnly:!0})],de.prototype,"layer",void 0),u([d({constructOnly:!0})],de.prototype,"source",void 0),de=u([p("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],de);const ce=1024;class i{constructor(e){this._memoryCache=null,this._capabilities=null;const r=e.layerView.layer;this._layerView=e.layerView,this.objectIdField=r.objectIdField,this.globalIdField="globalIdField"in r?r.globalIdField:null,this._returnZ=e.returnZ,this._returnM=e.returnM;const s=this._layerView.view.resourceController;this.query=function F(e,r){const{layer:s}=e;return"feature"===s.type&&"feature-layer"===s.source.type||"catalog-footprint"===s.type?"infoFor3D"in s&&null!=s.infoFor3D?new le({layer:s}):new ne({layer:s,layerView:e,controller:r}):"feature"===s.type&&"memory"===s.source.type||"csv"===s.type||"geojson"===s.type||"oriented-imagery"===s.type||"wfs"===s.type?new de({layer:s,source:s.source}):"ogc-feature"===s.type?new ue({layer:s}):null}(this._layerView,s.normal),s&&this._memoryCacheEnabled&&(this._memoryCache=s.memoryController.newCache(`fl-${r.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}destroy(){this._memoryCache=w(this._memoryCache),this.query.destroy()}createQuery(){const e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){const e=this._layerView.view.resourceController;return e?e.scheduler:null}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return null!=this._capabilities||(this._capabilities=J(this._layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this._layerView.layer,(null==r?void 0:r.message)??r)}}let pe=class f extends Y{constructor(e){super(e),this._controllerTotal=0,this._processorTotal=0,this._needsRefresh=!1,this.suspendResumeExtentMode="data"}initialize(){this.addHandles(b((()=>({controller:this.controller,suspended:this.suspended})),(({controller:e,suspended:r})=>{e&&!r&&this._needsRefresh&&(e.refetch(),this._needsRefresh=!1)})))}destroy(){this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){var e;return(null==(e=this.controller)?void 0:e.maximumNumberOfFeatures)??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get updatingProgressValue(){var e,r;let s=0;if(null==(e=this.controller)?void 0:e.updating){const e=this.controller.updatingRemaining,r=Math.max(this.controller.updatingTotal,this._controllerTotal);r>0&&(s=(r-e)/r,this._controllerTotal=r)}let o=0;if(null==(r=this.processor)?void 0:r.updating){const e=this.processor.updatingRemaining,r=Math.max(e,this._processorTotal);r>0&&(o=(r-e)/r,this._processorTotal=r)}return.5*(s+o)}get updatePolicy(){if(!this.controller)return x.ASYNC;switch(this.controller.mode){case"snapshot":{const e=he.get(this.layer.geometryType);return null==e||this.controller.serviceDataCount>e?x.ASYNC:x.SYNC}case"tiles":return x.ASYNC}}get usedMemory(){var e,r;return((null==(e=this.processor)?void 0:e.usedMemory)??0)+((null==(r=this.controller)?void 0:r.memoryForUnusedFeatures)??0)}get unloadedMemory(){var e,r,s,o;const l=(null==(e=this.processor)?void 0:e.unprocessedMemoryEstimate)??0,u=(null==(r=this.controller)?void 0:r.expectedFeatureDiff)??0,d=(null==(s=this.processor)?void 0:s.loadedFeatures)??0,p=d+u>0?d/(d+u):1;return l+u*((null==(o=this.processor)?void 0:o.usedMemoryPerFeature)??0)*p}get ignoresMemoryFactor(){var e;return null==(e=this.controller)?void 0:e.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){var e,r,s,o,l,u;const d=null==(e=this.controller)?void 0:e.displayFeatureLimit,p=null!=d?d.averageSymbolComplexity:void 0,h=null!=p?`f:${p.verticesPerFeature},v:${p.verticesPerCoordinate}`:"n/a";return new t(super.performanceInfo,(null==(s=null==(r=this.controller)?void 0:r.performanceInfo)?void 0:s.storedFeatures)??0,(null==(l=null==(o=this.controller)?void 0:o.performanceInfo)?void 0:l.totalVertices)??0,this.maximumNumberOfFeaturesExceeded,(null==(u=this.controller)?void 0:u.mode)??"n/a",h)}async doRefresh(e){const{controller:r,processor:s,suspended:o}=this;e&&r&&(o?this._needsRefresh=!0:(r.refetch(),this._needsRefresh=!1)),s.refreshFilter()}setVisibility(e,r){var s;null==(s=this.processor)||s.setObjectIdVisibility(e,r)}getMissingAttributesForFeature(e){return this.controller.getMissingAttributesForFeature(e)}getHydratedGeometry(e){const r=this.graphics3DProcessor;if(null==r)return null;const s=r.graphics3DGraphicsByObjectID;if(null==s)return null;const o=s.get(e);return null==o?null:P(o.graphic.geometry)}createController(){this._fetcherContext=new i({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const e=new W({layerView:this.layerView,context:this._fetcherContext,graphics:new ie,extent:this.clippingExtent});return this.updatingHandles.add((()=>e.serviceDataExtent),(e=>{this.processor&&(this.processor.dataExtent=e)}),R),this.addHandles(b((()=>this.suspended&&this.layerView.updateSuspended),(r=>{r?e.suspend():e.resume()}),O)),this.updatingHandles.add((()=>{var e;return null==(e=this.processor)?void 0:e.displayFeatureLimit}),(r=>e.displayFeatureLimit=r),R),this.addHandles(q((()=>!this.updating),(()=>{this._controllerTotal=0,this._processorTotal=0}))),e}beforeSetController(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};u([d()],pe.prototype,"layerView",void 0),u([d()],pe.prototype,"controller",void 0),u([d()],pe.prototype,"_controllerTotal",void 0),u([d()],pe.prototype,"_processorTotal",void 0),u([d()],pe.prototype,"_needsRefresh",void 0),u([d()],pe.prototype,"maximumNumberOfFeatures",null),u([d()],pe.prototype,"maximumNumberOfFeaturesExceeded",null),u([d()],pe.prototype,"updatingProgressValue",null),u([d()],pe.prototype,"updatePolicy",null),u([d()],pe.prototype,"suspendResumeExtentMode",void 0),pe=u([p("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],pe);const he=new Map([["point",5e3],["polygon",500],["polyline",1e3]]),_=e=>{let r=class extends e{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([b((()=>{var e;const r=this.layer;return[r&&"elevationInfo"in r?null==(e=r.elevationInfo)?void 0:e.featureExpressionInfo:null,r&&"displayField"in r?r.displayField:null,r&&"timeInfo"in r&&r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,this.filter,this.featureEffect,this.timeExtent]}),(()=>this._handleRequiredFieldsChange()),O),C((()=>{var e;return null==(e=this.view)?void 0:e.floors}),"change",(()=>this._handleRequiredFieldsChange())),C((()=>{const e=this.layer;return e&&"sublayers"in e?e.sublayers:null}),"change",(()=>this._handleRequiredFieldsChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:r},requiredFields:s}=this;return"outFields"in e&&e.outFields?I(r,[...S(r,e.outFields),...s]):I(r,s)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){V.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},r=null!=this.filter?this.filter.createQuery(e):new N(e);if("floorInfo"in this.layer&&this.layer.floorInfo){const e=se(this);null!=e&&(r.where=r.where?`(${r.where}) AND (${e})`:e)}return null!=this.timeExtent&&(r.timeExtent=null!=r.timeExtent?r.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),r}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new N(e)}queryFeatures(e,r){throw new Error("missing implementation")}queryObjectIds(e,r){throw new Error("missing implementation")}queryFeatureCount(e,r){throw new Error("missing implementation")}queryExtent(e,r){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,r){return this._validateFetchPopupFeatures(e,r),this._fetchPopupFeatures(e,r)}_loadArcadeModules(e){var r;return(null==(r=e.expressionInfos)?void 0:r.length)||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?D():Promise.resolve()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:r,layer:{fieldsIndex:s,objectIdField:o}}=this,l="renderer"in r&&r.renderer,u="orderBy"in r&&r.orderBy,d="featureReduction"in r?r.featureReduction:null,p=new Set,h=await Promise.allSettled([l?l.collectRequiredFields(p,s):null,T(p,r),e&&"elevationInfo"in r?A(p,r):null,null!=this.filter?j(p,r,this.filter):null,e||null==this.featureEffect?null:j(p,r,this.featureEffect.filter),!e&&d?Q(p,r,d):null,!e&&u?L(p,r,u):null]);if("timeInfo"in r&&r.timeInfo&&this.timeExtent&&H(p,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"floorInfo"in r&&r.floorInfo&&H(p,r.fieldsIndex,[r.floorInfo.floorField]),"feature"===r.type&&e&&null!=r.infoFor3D&&(null==r.globalIdField&&V.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),H(p,r.fieldsIndex,[r.globalIdField])),"subtype-group"===r.type){G(p,s,r.subtypeField);const e=r.sublayers.map((e=>{var r;return Promise.all([null==(r=e.renderer)?void 0:r.collectRequiredFields(p,s),T(p,e)])}));await Promise.allSettled(e)}if("catalog-footprint"===r.type&&r.parent){const e=r.parent;H(p,s,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}for(const m of h)"rejected"===m.status&&V.getLogger(this).error(m.reason);G(p,s,o),e&&"displayField"in r&&r.displayField&&G(p,s,r.displayField);const y=Array.from(p).sort();this._set("requiredFields",y)}_validateFetchPopupFeatures(e,r){if(null!=r)for(const s of e){const e=s.origin&&"layer"in s.origin?s.origin.layer:s.layer;if("popupEnabled"in e&&!e.popupEnabled)throw new Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e});if(s.isAggregate){const r="featureReduction"in e?e.featureReduction:null;if(!(r&&"popupTemplate"in r&&r.popupEnabled&&r.popupTemplate))throw new Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e})}else if("popupTemplate"in e&&!B(e,r))throw new Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}}_popupFeatureHasRequiredFields(e,r){return k(r,e)}async _fetchPopupFeatures(e,r){var s;const o=new Array(e.length),l=new Map,u=await this._createPopupQuery(e.map((e=>{var r;return(null==(r=e.origin)?void 0:r.layer)??e.layer})),r);for(let d=0;d<e.length;d++){const p=e[d];if(p.isAggregate){o[d]=p;continue}const h=(null==(s=p.origin)?void 0:s.layer)??p.layer;if(!h||!("popupEnabled"in h))continue;const y=S(this.layer.fieldsIndex,u.outFields),g=B(h,r);if(null==g)continue;const v=await this._loadArcadeModules(g);m(r),v&&v.arcadeUtils.hasGeometryOperations(g)||!this._popupFeatureHasRequiredFields(p,y)?l.set(p.getObjectId(),{graphic:p,index:d}):o[d]=p}if("stream"===this.layer.type||0===l.size)return o.filter(Boolean);u.objectIds=Array.from(l.keys());try{const e=await this.layer.queryFeatures(u,r);for(const r of e.features){const{graphic:{geometry:e,origin:s},index:u}=l.get(r.getObjectId());r.geometry||(r.geometry=e),r.origin=s,o[u]=r}}catch{}return o.filter(Boolean)}async _createPopupQuery(e,r){const s=this.layer.createQuery(),o=new Set;let l=!1;const u=e??[this.layer];for(const d of u){if(!("popupEnabled"in d))continue;const e=B(d,r);if(null==e)continue;const s=await this._loadArcadeModules(e);m(r);const u=s&&s.arcadeUtils.hasGeometryOperations(e);l=!("point"!==this.layer.geometryType&&!u);const p=await U(this.layer,e);m(r);for(const r of p)o.add(r)}if(s.returnGeometry=l,s.returnZ=l,s.returnM=l,s.outFields=Array.from(o),s.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const e=se(this);null!=e&&(s.where=s.where?`(${s.where}) AND (${e})`:e)}return s}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return u([d()],r.prototype,"_updatingRequiredFieldsPromise",void 0),u([d({readOnly:!0})],r.prototype,"availableFields",null),u([d({readOnly:!0})],r.prototype,"dataUpdating",void 0),u([d({type:M})],r.prototype,"featureEffect",null),u([d({type:E})],r.prototype,"filter",void 0),u([d()],r.prototype,"layer",void 0),u([d({type:Number})],r.prototype,"maximumNumberOfFeatures",null),u([d({readOnly:!0,type:Boolean})],r.prototype,"maximumNumberOfFeaturesExceeded",null),u([d({readOnly:!0})],r.prototype,"requiredFields",void 0),u([d()],r.prototype,"suspended",void 0),u([d()],r.prototype,"view",void 0),r=u([p("esri.views.layers.FeatureLayerView")],r),r};let ye=class extends(oe(K(_(X(ae))))){constructor(e){super(e)}initialize(){this.addHandles(b((()=>this._updatingRequiredFieldsPromise),(e=>this._updatingHandles.addPromise(e)),O))}destroy(){this._updatingHandles.removeAll(),this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(e){this.graphicsPipeline.maximumNumberOfFeatures=e}get maximumNumberOfFeaturesExceeded(){return null!=this.graphicsPipeline&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){var e;return(null==(e=this.graphicsPipeline)?void 0:e.updatingProgressValue)??0}get updatePolicy(){var e;return(null==(e=this.graphicsPipeline)?void 0:e.updatePolicy)??x.ASYNC}get hasZ(){const e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:r.supportsZ)}get hasM(){const e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM}setVisibility(e,r){var s;null==(s=this.graphicsPipeline)||s.setVisibility(e,r)}createQuery(){return super.createQuery()}queryFeatures(e,r){const t2=()=>super.queryFeatures(e,r);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(e),t2):t2()}createGraphicsPipeline(){return new pe({layerView:this})}async doRefresh(e){return await this.graphicsPipeline.doRefresh(e)}_popupFeatureHasRequiredFields(e,r){if(!super._popupFeatureHasRequiredFields(e,r))return!1;const s=$(e,this.layer.objectIdField);if(null==s)return!0;const o=this.graphicsPipeline.getMissingAttributesForFeature(s);if(null==o)return!0;for(const l of r)if(o.has(l))return!1;return!0}get usedMemory(){var e;return(null==(e=this.graphicsPipeline)?void 0:e.usedMemory)??0}get unloadedMemory(){var e;return(null==(e=this.graphicsPipeline)?void 0:e.unloadedMemory)??0}get ignoresMemoryFactor(){var e;return(null==(e=this.graphicsPipeline)?void 0:e.ignoresMemoryFactor)??!1}async _queryFeaturesMesh(e,r){await this._validateQueryFeaturesMesh(e);const s=await r(),o=this.graphicsPipeline;if((null==e?void 0:e.outStatistics)||null==o)return s;const l=this.layer.objectIdField,u=[];for(const d of s.features)if(d.geometry){const e=o.getHydratedGeometry(d.attributes[l]);e&&(d.geometry=e,u.push(d))}else u.push(d);return s.features=u,s}async _validateQueryFeaturesMesh(e){if(!e)return;const t2=e=>{throw new Z("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${e}'`)},r=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const s of r)null!=e[s]&&t2(s);"returnM"in e&&e.returnM&&t2("returnM"),"returnCentroid"in e&&e.returnCentroid&&t2("returnCentroid"),null==e.outSpatialReference||e.outSpatialReference.equals(this.view.spatialReference)||t2("outSpatialReference")}get test(){}};u([d()],ye.prototype,"layer",void 0),u([d()],ye.prototype,"graphicsPipeline",void 0),u([d()],ye.prototype,"maximumNumberOfFeatures",null),u([d()],ye.prototype,"maximumNumberOfFeaturesExceeded",null),u([d(z)],ye.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],ye.prototype,"updatingProgressValue",null),u([d({readOnly:!0})],ye.prototype,"updatePolicy",null),u([d({readOnly:!0})],ye.prototype,"hasZ",null),u([d({readOnly:!0})],ye.prototype,"hasM",null),ye=u([p("esri.views.3d.layers.FeatureLayerViewBase3D")],ye);const me=ye;export{me as g};
