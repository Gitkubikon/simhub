const __vite__fileDeps=["assets/calcite-icon-I_Xwj0DW.js","assets/icon-DN35inCc.js","assets/index-DSIPxOWi.js","assets/index-B_7YxLDX.css","assets/dom-CG95YN3b.js","assets/guid-DBupVat2.js","assets/observers-4D3dvPBC.js","assets/chartUtilsAm5-DRrzCagg.js","assets/Theme-BWSWhkMY.js","assets/Tooltip-D6Kx2Qdx.js","assets/DefaultTheme-B_ukJDZB.js","assets/chartCommon-TAiNm-wm.js","assets/Button-UQGbSFzx.js","assets/ColorSet-Dk-MXJxU.js","assets/pieChart-Dm7_yUDQ.js","assets/Tick-DYjp9NXF.js","assets/xyChart-B7x-V05x.js","assets/arcade-pJSHUs8p.js","assets/TimeOnly-C5lZbbIX.js","assets/ImmutableArray-BLzlMo4D.js","assets/calcite-loader-CKsSCnMM.js","assets/loader-DnD0exo2.js","assets/calcite-list-BvNQA5EB.js","assets/interactive-Dv2N9_bt.js","assets/resources4-CYtDHm3W.js","assets/utils3-DuvlTtif.js","assets/loadable-TuT7-EDA.js","assets/t9n-Dkvwz2Wg.js","assets/key-Bjfr4614.js","assets/debounce-Z6QnFls1.js","assets/input2-FN40mhAY.js","assets/form-BR8JUNQO.js","assets/label-B0K2ZKoz.js","assets/component-BaDXbCam.js","assets/scrim-DRbAIrdV.js","assets/calcite-list-item-RYHR2PjI.js","assets/action-Dvbm1zId.js","assets/calcite-notice-B5LcMWxf.js","assets/conditionalSlot-CDvqoXHX.js","assets/openCloseComponent-DPRdqyP2.js","assets/calcite-action-Dt6-g_b1.js","assets/calcite-flow-item-CyK_4Qbv.js","assets/action-menu-BUIA3NwG.js","assets/floating-ui-BBcbf-ex.js","assets/focusTrapComponent-BWL-aVr7.js","assets/geometryEngineAsync--5NbEF1a.js","assets/calcite-action-bar-CXh0y-e8.js","assets/action-group-DPxpKt1q.js","assets/calcite-action-group-DzAQV4Db.js","assets/calcite-button-BNKeIR-C.js","assets/calcite-flow-D2Vx6E1X.js","assets/calcite-list-item-group-B83YhT4c.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{aV as i,aA as r,aU as o,aD as a,ad as _,nF as b,n as I,c3 as A,c4 as x,tU as L,aC as k,tV as O,V as B,e as z,y as W,gH as H,v as U,a as X,S as G,g as Y,P as J,b as K,l3 as ve,fS as _e,nb as be,nc as Me,bd as Ie,nd as Ae,_ as Ce,ne as Ee,tW as xe,tX as $e,tY as Le,tZ as Re,t_ as ke,aM as Pe,o4 as Oe,t$ as Ne,ak as Ve,u0 as Se,u1 as De,u2 as Be,bJ as je,gQ as qe,jM as ze,q1 as We,a2 as He,fp as Ue,bZ as Ze,jO as Qe,cD as Xe,u3 as Ge,u4 as Ye,u5 as Je,gx as Ke,u6 as et,aw as tt,u7 as it,u8 as nt,u9 as st,ua as rt,g1 as ot,s as at,h6 as lt,h5 as dt,u as ut,i8 as ct,ub as ht,W as pt,bc as mt,p as vt,gz as ft,uc as gt,m as yt,ud as _t,ue as wt,uf as bt,sG as Mt,sI as It,ug as Ft,uh as At,ui as Ct,mO as Et,uj as xt,aj as Tt,d8 as $t,i as Lt,h3 as Rt,fO as kt,k0 as Pt,Z as Ot,uk as Nt,sw as Vt,ae as St}from"./index-DSIPxOWi.js";import{s as Dt}from"./substitute-DBNnxKeF.js";import{T as Bt}from"./unitFormatUtils-B9MPZ1wj.js";import{a as jt}from"./AttachmentInfo-u2TyaLjZ.js";import{Z as qt,N as zt}from"./utils-DEUXBrCj.js";import{s as Wt}from"./executeQueryJSON-DDi8KdIf.js";import"./normalizeUtilsCommon-BU8xfl77.js";import"./pbf-B53Txr8m.js";import{s as Ht}from"./ReactiveSet-XbWJTkHf.js";import"./query-C2USZ63O.js";import"./normalizeUtils-BrH-PrZy.js";import"./pbfQueryUtils-DUjEbwA9.js";function e$a(i,r,o,a){let _=null,b=1e3;"number"==typeof r?(b=r,a=o):(_=r??null,b=o);let I,A=0;const a2=()=>{A=0,i.apply(a,I)},c6=(...i)=>{_&&_.apply(a,i),I=i,b?A||(A=setTimeout(a2,b)):a2()};return c6.remove=()=>{A&&(clearTimeout(A),A=0)},c6.forceUpdate=()=>{A&&(clearTimeout(A),a2())},c6.hasPendingUpdates=()=>!!A,c6}function n$a(i){var r;switch(null==i?void 0:i.type){case"point":return i;case"extent":return i.center;case"polygon":return i.centroid;case"multipoint":case"polyline":return null==(r=i.extent)?void 0:r.center;default:return null}}function n$9(i){return i?{backgroundImage:`url(${i})`}:{}}const m$7=()=>I.getLogger("esri.widgets.Feature.support.featureUtils"),Ut=/href=(""|'')/gi,Zt=/(\{([^{\r\n]+)\})/g,Qt=/'/g,Xt=/^\s*expression\//i,Gt=/(\n)/gi,Yt=/[\u00A0-\u9999<>&]/gim,Jt=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,Kt=/^(?:mailto:|tel:)/,ei="relationships/",ti=i("short-date-short-time");function L$2(i){if(null!=i)return(i.sourceLayer||i.layer)??void 0}async function E$2({type:i,value:r,event:o}){try{return"function"==typeof r?r(o):r}catch(a){return void m$7().error("error",`An error occurred when calling the "${i}" function`,{error:a,graphic:o.graphic,value:r})}}function v$4(i=""){if(i)return!Kt.test(i.trim().toLowerCase())}function x$3(i){return!!i&&Xt.test(i)}function C$4(i,r){const o=function A$2(i,r){if(!r||!x$3(r)||!i)return;const o=r.replace(Xt,"").toLowerCase();return i.find((({name:i})=>i.toLowerCase()===o))}(r,null==i?void 0:i.fieldName);return o?o.title||null:i?i.label||i.fieldName:null}function q$1(i,r){const o=$$1(r,i);return o?o.name:i}function $$1(i,r){return i&&"function"==typeof i.getField&&r?i.getField(r)??null:null}function k$4(i){return`${i}`.trim()}function D({attributes:i,globalAttributes:r,layer:o,text:a,expressionAttributes:_,fieldInfoMap:b}){return a?z$3({formattedAttributes:r,template:Q(a,{...r,..._,...i},o),fieldInfoMap:b}):""}function z$3({formattedAttributes:i,template:o,fieldInfoMap:a}){return k$4(function U$2(i){return i.replaceAll(Ut,"")}(r(r(o,(i=>function M$3(i,r){const o=r.get(i.toLowerCase());return`{${(null==o?void 0:o.fieldName)||i}}`}(i,a))),i)))}function G$2(i,r=!1){const o={...i};return Object.keys(o).forEach((i=>function O$1(i,r,o=!1){const a=r[i];if("string"==typeof a){const _="%27",b=(o?encodeURIComponent(a):a).replaceAll(Qt,_);r[i]=b}}(i,o,r))),o}function P(i,r){return i.replaceAll(Zt,((i,o,a)=>{const _=$$1(r,a);return _?`{${_.name}}`:o}))}function Q(i,o,a){const _=P(i,a);return _?_.replaceAll(Jt,((i,a,_)=>function S$1(i,o,a){const _=(o=k$4(o))&&"{"!==o[0];return r(i,G$2(a,_||!1))}(i,a||_,o))):_}function J$1(i){return function H$2(i){return null!=i&&"object"==typeof i&&"fieldsIndex"in i&&"geometryType"in i&&"getField"in i&&"load"in i&&"loaded"in i&&"objectIdField"in i&&"spatialReference"in i&&"type"in i&&("feature"===i.type||"scene"===i.type||"sublayer"===i.type)&&"when"in i}(i)&&function B$1(i){return null!=i&&"object"==typeof i&&"createQuery"in i&&"queryFeatureCount"in i&&"queryObjectIds"in i&&"queryRelatedFeatures"in i&&"queryRelatedFeaturesCount"in i&&"relationships"in i}(i)}function V(i,r){var o;const{fieldInfos:a,fieldName:_,preventPlacesFormatting:b,layer:I,timeZone:A}=r,x=Y$1(a,_),B=$$1(I,_);if(x&&!L(_)){const r=null==B?void 0:B.type,a=null==(o=x.format)?void 0:o.dateFormat;if("date"===r||"date-only"===r||"time-only"===r||"timestamp-offset"===r||a)return zt(i,{format:a,fieldType:r,timeZoneOptions:{layerTimeZone:I&&"preferredTimeZone"in I?I.preferredTimeZone:null,viewTimeZone:A,datesInUnknownTimezone:!(!I||!("datesInUnknownTimezone"in I)||!I.datesInUnknownTimezone)}})}const z=null==x?void 0:x.format;return"string"==typeof i&&L(_)&&z?function W$3(i,r){return i=i.trim(),/\d{2}-\d{2}/.test(i)?i:i.includes(",")?X$1(i,",",", ",r):i.includes(";")?X$1(i,";","; ",r):i.includes(" ")?X$1(i," "," ",r):k(Number(i),O(r))}(i,z):"string"==typeof(i=function _$1(i,r){if("string"==typeof i&&r&&null==r.dateFormat&&(null!=r.places||null!=r.digitSeparator)){const r=Number(i);if(!isNaN(r))return r}return i}(i,z))||null==i||null==z?ae(i):k(i,b?{...O(z),minimumFractionDigits:0,maximumFractionDigits:20}:O(z))}function X$1(i,r,o,a){return i.trim().split(r).map((i=>k(Number(i),O(a)))).join(o)}function Y$1(i,r){if((null==i?void 0:i.length)&&r)return i.find((i=>{var o;return(null==(o=i.fieldName)?void 0:o.toLowerCase())===r.toLowerCase()}))}function ie(i){const r=[];if(!i)return r;const{fieldInfos:o,content:a}=i;return o&&r.push(...o),a&&Array.isArray(a)?(a.forEach((i=>{if("fields"===i.type){const o=null==i?void 0:i.fieldInfos;o&&r.push(...o)}})),r):r}function oe(i){return i.replaceAll(Yt,(i=>`&#${i.charCodeAt(0)};`))}function ae(i){return"string"==typeof i?i.replaceAll(Gt,'<br class="esri-text-new-line" />'):i}function le(i){var r;const{value:o,fieldName:a,fieldInfos:_,fieldInfoMap:b,layer:I,graphic:x,timeZone:L}=i;if(null==o)return"";const k=function te({fieldName:i,value:r,graphic:o,layer:a}){if(de(i))return null;if(!a||"function"!=typeof a.getFieldDomain)return null;const _=o&&a.getFieldDomain(i,{feature:o});return _&&"coded-value"===_.type?_.getName(r):null}({fieldName:a,value:o,graphic:x,layer:I});if(k)return k;const O=function ee({fieldName:i,graphic:r,layer:o}){if(de(i))return null;if(!o||"function"!=typeof o.getFeatureType)return null;const{typeIdField:a}=o;if(!a||i!==a)return null;const _=o.getFeatureType(r);return _?_.name:null}({fieldName:a,graphic:x,layer:I});if(O)return O;if(b.get(a.toLowerCase()))return V(o,{fieldInfos:_||Array.from(b.values()),fieldName:a,layer:I,timeZone:L});const B=null==(r=null==I?void 0:I.fieldsIndex)?void 0:r.get(a);return B&&(qt(B)||A(B))?zt(o,{fieldType:B.type,timeZoneOptions:{layerTimeZone:I&&"preferredTimeZone"in I?I.preferredTimeZone:null,viewTimeZone:L,datesInUnknownTimezone:!(!I||!("datesInUnknownTimezone"in I)||!I.datesInUnknownTimezone)}}):ae(o)}function ue({fieldInfos:i,attributes:r,layer:o,graphic:a,fieldInfoMap:_,relatedInfos:b,timeZone:I}){const A={};return null==b||b.forEach((r=>function me({attributes:i,relatedInfo:r,fieldInfoMap:o,fieldInfos:a,layer:_,timeZone:b}){var I,A;i&&r&&(null==(I=r.relatedFeatures)||I.forEach((I=>ye({attributes:i,graphic:I,relatedInfo:r,fieldInfoMap:o,fieldInfos:a,layer:_,timeZone:b}))),null==(A=r.relatedStatsFeatures)||A.forEach((I=>ye({attributes:i,graphic:I,relatedInfo:r,fieldInfoMap:o,fieldInfos:a,layer:_,timeZone:b}))))}({attributes:A,relatedInfo:r,fieldInfoMap:_,fieldInfos:i,layer:o,timeZone:I}))),r&&Object.keys(r).forEach((b=>{const x=r[b];A[b]=le({fieldName:b,fieldInfos:i,fieldInfoMap:_,layer:o,value:x,graphic:a,timeZone:I})})),A}async function se(i,r){var o,a;const{layer:b,graphic:I,outFields:A,objectIds:x,returnGeometry:L,spatialReference:k}=i,O=x[0];if("number"!=typeof O&&"string"!=typeof O){const i="Could not query required fields for the specified feature. The feature's ID is invalid.",r={layer:b,graphic:I,objectId:O,requiredFields:A};return m$7().warn(i,r),null}if(!(null==(a=null==(o=_(b))?void 0:o.operations)?void 0:a.supportsQuery)){const i="The specified layer cannot be queried. The following fields will not be available.",r={layer:b,graphic:I,requiredFields:A,returnGeometry:L};return m$7().warn(i,r),null}const B=b.createQuery();return B.objectIds=x,B.outFields=(null==A?void 0:A.length)?A:[b.objectIdField],B.returnGeometry=!!L,B.returnZ=!!L,B.returnM=!!L,B.outSpatialReference=k,(await b.queryFeatures(B,r)).features[0]}async function ce({graphic:i,popupTemplate:r,layer:o,spatialReference:a},_){if(!o||!r)return;if("function"==typeof o.load&&await o.load(_),!i.attributes)return;const I=o.objectIdField,A=i.attributes[I];if(null==A)return;const L=[A],k=await r.getRequiredFields(o.fieldsIndex),O=b(k,i),B=O?[]:k.includes(I)?k:[...k,I],z=r.returnGeometry||await async function fe(i){var r;if(!(null==(r=i.expressionInfos)?void 0:r.length))return!1;const o=await x(),{arcadeUtils:{hasGeometryFunctions:a}}=o;return a(i)}(r);if(O&&!z)return;const W=await se({layer:o,graphic:i,outFields:B,objectIds:L,returnGeometry:z,spatialReference:a},_);W&&(W.geometry&&(i.geometry=W.geometry),W.attributes&&(i.attributes={...i.attributes,...W.attributes}))}function de(i=""){return!!i&&i.includes(ei)}function ye({attributes:i,graphic:r,relatedInfo:o,fieldInfos:a,fieldInfoMap:_,layer:b,timeZone:I}){i&&r&&o&&Object.keys(r.attributes).forEach((A=>{const x=function pe(i){return i?`${ei}${i.layerId}/${i.fieldName}`:""}({layerId:o.relation.id.toString(),fieldName:A}),L=r.attributes[A];i[x]=le({fieldName:x,fieldInfos:a,fieldInfoMap:_,layer:b,value:L,graphic:r,timeZone:I})}))}const ge=i=>{if(!i)return!1;const r=i.toUpperCase();return r.includes("CURRENT_TIMESTAMP")||r.includes("CURRENT_DATE")||r.includes("CURRENT_TIME")},he=({layer:i,method:r,query:o,definitionExpression:a})=>{var _,b;if(!(null==(b=null==(_=i.capabilities)?void 0:_.query)?void 0:b.supportsCacheHint)||"attachments"===r)return;const I=null!=o.where?o.where:null,A=null!=o.geometry?o.geometry:null;ge(a)||ge(I)||"extent"===(null==A?void 0:A.type)||"tile"===o.resultType||(o.cacheHint=!0)};function we(i,r){return null==i?void 0:i.allTables.find((i=>{var o;return"feature"===i.type&&i.layerId===r.id&&i.url===(null==(o=r.layer)?void 0:o.url)}))}function Fe({map:i,relationship:r,relationship:{relatedTableId:o},relatedLayer:a,layers:_}){var b;if(!_)return null;for(const I of _){if("map-image"===I.type){const o=Fe({layers:I.sublayers,map:i,relatedLayer:a,relationship:r})||Fe({layers:I.subtables,map:i,relatedLayer:a,relationship:r});if(o)return o;continue}if(!J$1(I))continue;if("sublayer"===a.type){if(I!==a&&I.id===o)return I.isTable?we(i,I):I;continue}const _="scene"===a.type&&a.associatedLayer?a.associatedLayer.url:a.url;if(!_)return null;if("sublayer"!==I.type){if(I!==a&&I.url===_&&I.layerId===o)return I}else if(I!==a&&(null==(b=I.layer)?void 0:b.url)===_&&I.id===o)return I.isTable?we(i,I):I}return null}const ii={editing:!1,operations:{add:!0,update:!0,delete:!0}},ni=B.ofType(jt);let si=class u extends G{constructor(i){super(i),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...ii},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new ni,this.fileInfos=new B,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(Y((()=>this.graphic),(()=>this._graphicChanged()),J))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(i){return{...ii,...i}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:i}=this;if(!i)return!1;const r=i.layer||i.sourceLayer;return(null==r?void 0:r.loaded)&&"capabilities"in r&&r.capabilities&&"operations"in r.capabilities&&"supportsResizeAttachments"in r.capabilities.operations&&r.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:i,attachmentInfos:r}=this;if(!i||"function"!=typeof i.queryAttachments)throw new K("invalid-layer","getAttachments(): A valid layer is required.");const o=this._getObjectId(),a=new ve({objectIds:[o],returnMetadata:!0}),_=[],b=i.queryAttachments(a).then((i=>i[o]||_)).catch((()=>_));this._getAttachmentsPromise=b,this.notifyChange("state");const I=await b;return r.destroyAll(),I.length&&r.addMany(I),this._getAttachmentsPromise=null,this.notifyChange("state"),I}async addAttachment(i,r=this.graphic){var o;const{_attachmentLayer:a,attachmentInfos:_,capabilities:b}=this;if(!r)throw new K("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:r});if(!i)throw new K("invalid-attachment","addAttachment(): An attachment is required.",{attachment:i});if(!(null==(o=b.operations)?void 0:o.add))throw new K("invalid-capabilities","addAttachment(): add capabilities are required.");if(!a||"function"!=typeof a.addAttachment)throw new K("invalid-layer","addAttachment(): A valid layer is required.");const I=a.addAttachment(r,i).then((i=>this._queryAttachment(i.objectId,r))),A=await I;return _.add(A),A}async deleteAttachment(i){var r;const{_attachmentLayer:o,attachmentInfos:a,graphic:_,capabilities:b}=this;if(!i)throw new K("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!(null==(r=b.operations)?void 0:r.delete))throw new K("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!o||"function"!=typeof o.deleteAttachments)throw new K("invalid-layer","deleteAttachment(): A valid layer is required.");if(!_)throw new K("invalid-graphic","deleteAttachment(): A graphic is required.");const I=o.deleteAttachments(_,[i.id]).then((()=>i)),A=await I;return a.remove(A),A.destroy(),A}async updateAttachment(i,r=this.activeAttachmentInfo){var o;const{_attachmentLayer:a,attachmentInfos:_,graphic:b,capabilities:I}=this;if(!i)throw new K("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:i});if(!r)throw new K("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:r});if(!(null==(o=I.operations)?void 0:o.update))throw new K("invalid-capabilities","updateAttachment(): Update capabilities are required.");const A=_.indexOf(r);if(!a||"function"!=typeof a.updateAttachment)throw new K("invalid-layer","updateAttachment(): A valid layer is required.");if(!b)throw new K("invalid-graphic","updateAttachment(): A graphic is required.");const x=a.updateAttachment(b,r.id,i).then((i=>this._queryAttachment(i.objectId))),L=await x;return _.splice(A,1,L),L}async commitFiles(){return await Promise.all(this.fileInfos.items.map((i=>this.addAttachment(i.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(i,r){if(!i||!r)return null;const o={file:i,form:r};return this.fileInfos.add(o),o}updateFile(i,r,o=this.activeFileInfo){if(!i||!r||!o)return null;const a=this.fileInfos.indexOf(o);return a>-1&&this.fileInfos.splice(a,1,{file:i,form:r}),this.fileInfos.items[a]}deleteFile(i){const r=this.fileInfos.find((r=>r.file===i));return r?(this.fileInfos.remove(r),r):null}async _queryAttachment(i,r){const{_attachmentLayer:o}=this;if(!i||!(null==o?void 0:o.queryAttachments))throw new K("invalid-attachment-id","Could not query attachment.");const a=this._getObjectId(r),_=new ve({objectIds:[a],attachmentsWhere:`AttachmentId=${i}`,returnMetadata:!0});return o.queryAttachments(_).then((i=>i[a][0]))}_getObjectId(i=this.graphic){return(null==i?void 0:i.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:i}=this,r=L$2(i);this._attachmentLayer=r?"scene"===r.type&&null!=r.associatedLayer?r.associatedLayer:r:null}};z([W()],si.prototype,"capabilities",void 0),z([H("capabilities")],si.prototype,"castCapabilities",null),z([W()],si.prototype,"activeAttachmentInfo",void 0),z([W()],si.prototype,"activeFileInfo",void 0),z([W({readOnly:!0,type:ni})],si.prototype,"attachmentInfos",void 0),z([W()],si.prototype,"fileInfos",void 0),z([W({type:U})],si.prototype,"graphic",void 0),z([W()],si.prototype,"mode",void 0),z([W({readOnly:!0})],si.prototype,"state",null),z([W()],si.prototype,"filesEnabled",void 0),z([W({readOnly:!0})],si.prototype,"supportsResizeAttachments",null),si=z([X("esri.widgets.Attachments.AttachmentsViewModel")],si);const ri=si;function e$8(i){const r=i.toLowerCase();return"image/bmp"===r||"image/emf"===r||"image/exif"===r||"image/gif"===r||"image/x-icon"===r||"image/jpeg"===r||"image/png"===r||"image/tiff"===r||"image/x-wmf"===r}const oi="esri-icon-left",ai="esri-icon-plus",li="esri-icon-right",di="esri-icon-table",ui="esri-icon-trash",ci="esri-icon-zoom-in-magnifying-glass",hi={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},pi="esri-attachments",mi={base:pi,loaderContainer:`${pi}__loader-container`,loader:`${pi}__loader`,fadeIn:`${pi}--fade-in`,container:`${pi}__container`,containerList:`${pi}__container--list`,containerPreview:`${pi}__container--preview`,actions:`${pi}__actions`,deleteButton:`${pi}__delete-button`,addAttachmentButton:`${pi}__add-attachment-button`,errorMessage:`${pi}__error-message`,items:`${pi}__items`,item:`${pi}__item`,itemButton:`${pi}__item-button`,itemMask:`${pi}__item-mask`,itemMaskIcon:`${pi}__item-mask--icon`,itemImage:`${pi}__image`,itemImageResizable:`${pi}__image--resizable`,itemLabel:`${pi}__label`,itemFilename:`${pi}__filename`,itemChevronIcon:`${pi}__item-chevron-icon`,itemLink:`${pi}__item-link`,itemLinkOverlay:`${pi}__item-link-overlay`,itemLinkOverlayIcon:`${pi}__item-link-overlay-icon`,itemEditIcon:`${pi}__item-edit-icon`,itemAddIcon:`${pi}__item-add-icon`,itemAddButton:`${pi}__item-add-button`,formNode:`${pi}__form-node`,fileFieldset:`${pi}__file-fieldset`,fileLabel:`${pi}__file-label`,fileName:`${pi}__file-name`,fileInput:`${pi}__file-input`,metadata:`${pi}__metadata`,metadataFieldset:`${pi}__metadata-fieldset`,progressBar:`${pi}__progress-bar`},vi=window.CSS;let fi=class M extends Me{constructor(i,r){super(i,r),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...hi},this._supportsImageOrientation=vi&&vi.supports&&vi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(i){return(null==i?void 0:i.viewModel)||(i={viewModel:new ri,...i}),i}initialize(){this.addHandles([Ie((()=>{var i;return null==(i=this.viewModel)?void 0:i.attachmentInfos}),"change",(()=>this.scheduleRender())),Ie((()=>{var i;return null==(i=this.viewModel)?void 0:i.fileInfos}),"change",(()=>this.scheduleRender())),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.mode}),(()=>this._modeChanged()),J)])}loadDependencies(){return Ae({icon:()=>Ce((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([0,1,2,3,4,5,6]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(i){this.viewModel.capabilities=i}get effectiveDisplayType(){const{displayType:i}=this;return i&&"auto"!==i?i:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(i){this.viewModel.graphic=i}get icon(){return"attachment"}set icon(i){this._overrideIfSome("icon",i)}get label(){var i;return(null==(i=this.messages)?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}castVisibleElements(i){return{...hi,...i}}addAttachment(){const{_addAttachmentForm:i,viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.addAttachment(i).then((i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i))).catch((i=>{throw this._set("submitting",!1),this._set("error",new K("attachments:add-attachment",this.messages.addErrorMessage,i)),i}))}deleteAttachment(i){const{viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.deleteAttachment(i).then((i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i))).catch((i=>{throw this._set("submitting",!1),this._set("error",new K("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i}))}updateAttachment(){const{viewModel:i}=this,{_updateAttachmentForm:r}=this;return this._set("submitting",!0),this._set("error",null),i.updateAttachment(r).then((r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r))).catch((i=>{throw this._set("submitting",!1),this._set("error",new K("attachments:update-attachment",this.messages.updateErrorMessage,i)),i}))}addFile(){const i=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",i}updateFile(){const{viewModel:i}=this,r=i.updateFile(this.selectedFile,this._updateAttachmentForm,i.activeFileInfo);return i.mode="view",r}deleteFile(i){var r;const o=this.viewModel.deleteFile(i||(null==(r=this.viewModel.activeFileInfo)?void 0:r.file));return this.viewModel.mode="view",o}render(){const{submitting:i,viewModel:r}=this,{state:o}=r;return Ee("div",{class:this.classes(mi.base,xe.widget)},i?this._renderProgressBar():null,"loading"===o?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:i,visibleElements:r}=this;return i&&r.errorMessage?Ee("div",{class:mi.errorMessage,key:"error-message"},i.message):null}_renderAttachments(){const{activeFileInfo:i,mode:r,activeAttachmentInfo:o}=this.viewModel;return"add"===r?this._renderAddForm():"edit"===r?this._renderDetailsForm(o||i):this._renderAttachmentContainer()}_renderLoading(){return Ee("div",{class:mi.loaderContainer,key:"loader"},Ee("div",{class:mi.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?Ee("div",{class:mi.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:i,selectedFile:r}=this,o=i||!r,a=this.visibleElements.cancelAddButton?Ee("button",{bind:this,class:this.classes(xe.button,xe.buttonTertiary,xe.buttonSmall,xe.buttonHalf,i&&xe.buttonDisabled),disabled:i,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,_=this.visibleElements.addSubmitButton?Ee("button",{class:this.classes(xe.button,xe.buttonSecondary,xe.buttonSmall,xe.buttonHalf,{[xe.buttonDisabled]:o}),disabled:o,type:"submit"},this.messages.add):null,b=r?Ee("span",{class:mi.fileName,key:"file-name"},r.name):null,I=Ee("form",{afterCreate:$e,afterRemoved:Le,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Ee("fieldset",{class:mi.fileFieldset},b,Ee("label",{class:this.classes(mi.fileLabel,xe.button,xe.buttonSecondary)},r?this.messages.changeFile:this.messages.selectFile,Ee("input",{bind:this,class:mi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),_,a);return Ee("div",{class:mi.formNode,key:"add-form-container"},I)}_renderDetailsForm(i){var r,o,a;const{visibleElements:_,viewModel:b,selectedFile:I,submitting:A}=this,{capabilities:x}=b,L=A||!I;let k,O,B,z;I?(k=I.type,O=I.name,B=I.size):i&&"file"in i?(k=i.file.type,O=i.file.name,B=i.file.size):i&&"contentType"in i&&(k=i.contentType,O=i.name,B=i.size,z=i.url);const W=x.editing&&(null==(r=x.operations)?void 0:r.delete)&&_.deleteButton?Ee("button",{bind:this,class:this.classes(xe.button,xe.buttonSmall,xe.buttonTertiary,mi.deleteButton,{[xe.buttonDisabled]:A}),disabled:A,key:"delete-button",onclick:r=>this._submitDeleteAttachment(r,i),type:"button"},this.messages.delete):void 0,H=x.editing&&(null==(o=x.operations)?void 0:o.update)&&_.updateButton?Ee("button",{class:this.classes(xe.button,xe.buttonSmall,xe.buttonThird,{[xe.buttonDisabled]:L}),disabled:L,key:"update-button",type:"submit"},this.messages.update):void 0,U=this.visibleElements.cancelUpdateButton?Ee("button",{bind:this,class:this.classes(xe.button,xe.buttonSmall,xe.buttonTertiary,xe.buttonThird,{[xe.buttonDisabled]:A}),disabled:A,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,X=x.editing&&(null==(a=x.operations)?void 0:a.update)?Ee("fieldset",{class:mi.fileFieldset,key:"file"},Ee("span",{class:mi.fileName,key:"file-name"},O),Ee("label",{class:this.classes(mi.fileLabel,xe.button,xe.buttonSecondary)},this.messages.changeFile,Ee("input",{bind:this,class:mi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,G=Ee("fieldset",{class:mi.metadataFieldset,key:"size"},Ee("label",null,Bt(this.messagesUnits,B??0))),Y=Ee("fieldset",{class:mi.metadataFieldset,key:"content-type"},Ee("label",null,k)),J=null!=z?Ee("a",{class:mi.itemLink,href:z,rel:"noreferrer",target:"_blank"},this._renderImageMask(i,400),Ee("div",{class:mi.itemLinkOverlay},Ee("span",{class:mi.itemLinkOverlayIcon},Ee("calcite-icon",{icon:"launch"})))):this._renderImageMask(i,400),K=Ee("form",{afterCreate:$e,afterRemoved:Le,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:r=>this._submitUpdateAttachment(r,i)},Ee("div",{class:mi.metadata},G,Y),X,Ee("div",{class:mi.actions},W,U,H));return Ee("div",{class:mi.formNode,key:"edit-form-container"},J,K)}_renderImageMask(i,r){return i?"file"in i?this._renderGenericImageMask(i.file.name,i.file.type):this._renderImageMaskForAttachment(i,r):null}_renderGenericImageMask(i,r){const{supportsResizeAttachments:o}=this.viewModel,a=function p$8(i){const r=_e("esri/themes/base/images/files/");return i?"text/plain"===i?`${r}text-32.svg`:"application/pdf"===i?`${r}pdf-32.svg`:"text/csv"===i?`${r}csv-32.svg`:"application/gpx+xml"===i?`${r}gpx-32.svg`:"application/x-dwf"===i?`${r}cad-32.svg`:"application/postscript"===i||"application/json"===i||"text/xml"===i||"model/vrml"===i?`${r}code-32.svg`:"application/x-zip-compressed"===i||"application/x-7z-compressed"===i||"application/x-gzip"===i||"application/x-tar"===i||"application/x-gtar"===i||"application/x-bzip2"===i||"application/gzip"===i||"application/x-compress"===i||"application/x-apple-diskimage"===i||"application/x-rar-compressed"===i||"application/zip"===i?`${r}zip-32.svg`:i.includes("image/")?`${r}image-32.svg`:i.includes("audio/")?`${r}sound-32.svg`:i.includes("video/")?`${r}video-32.svg`:i.includes("msexcel")||i.includes("ms-excel")||i.includes("spreadsheetml")?`${r}excel-32.svg`:i.includes("msword")||i.includes("ms-word")||i.includes("wordprocessingml")?`${r}word-32.svg`:i.includes("powerpoint")||i.includes("presentationml")?`${r}report-32.svg`:`${r}generic-32.svg`:`${r}generic-32.svg`}(r),_={[mi.itemImageResizable]:o};return Ee("div",{class:this.classes(mi.itemMaskIcon,mi.itemMask),key:a},Ee("img",{alt:i,class:this.classes(_,mi.itemImage),src:a,title:i}))}_renderImageMaskForAttachment(i,r){const{supportsResizeAttachments:o}=this.viewModel;if(!i)return null;const{contentType:a,name:_,url:b}=i;if(!o||!e$8(a))return this._renderGenericImageMask(_,a);const I=this._getCSSTransform(i),A=I?{transform:I,"image-orientation":"none"}:{},x=`${b}${(null==b?void 0:b.includes("?"))?"&":"?"}w=${r}`,L={[mi.itemImageResizable]:o};return Ee("div",{class:this.classes(mi.itemMask),key:x},Ee("img",{alt:_,class:this.classes(L,mi.itemImage),src:x,styles:A,title:_}))}_renderFile(i){const{file:r}=i;return Ee("li",{class:mi.item,key:r},Ee("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:mi.itemButton,key:"details-button",onclick:()=>this._startEditFile(i),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(i),Ee("label",{class:mi.itemLabel},Ee("span",{class:mi.itemFilename},r.name||this.messages.noTitle),Ee("span",{"aria-hidden":"true",class:this.classes(mi.itemChevronIcon,Re(this.container)?oi:li)}))))}_renderAttachmentInfo({attachmentInfo:i,displayType:r}){const{viewModel:o,effectiveDisplayType:a}=this,{capabilities:_,supportsResizeAttachments:b}=o,{contentType:I,name:A,url:x}=i,L=this._renderImageMask(i,"list"===r?48:400),k=_.editing?Ee("span",{"aria-hidden":"true",class:this.classes(mi.itemChevronIcon,Re(this.container)?oi:li)}):null,O=[L,"preview"===a&&b&&e$8(I)?null:Ee("label",{class:mi.itemLabel},Ee("span",{class:mi.itemFilename},A||this.messages.noTitle),k)],B=_.editing?Ee("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:mi.itemButton,"data-attachment-info-id":i.id,key:"details-button",onclick:()=>this._startEditAttachment(i),title:this.messages.attachmentDetails,type:"button"},O):Ee("a",{class:mi.itemButton,href:x??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},O);return Ee("li",{class:mi.item,key:i},B)}_renderAttachmentContainer(){var i;const{effectiveDisplayType:r,viewModel:o,visibleElements:a}=this,{attachmentInfos:_,capabilities:b,fileInfos:I}=o,A=!!(null==_?void 0:_.length),x=!!(null==I?void 0:I.length),L={[mi.containerList]:"preview"!==r,[mi.containerPreview]:"preview"===r},k=b.editing&&(null==(i=b.operations)?void 0:i.add)&&a.addButton?Ee("button",{bind:this,class:this.classes(xe.button,xe.buttonTertiary,mi.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},Ee("span",{"aria-hidden":"true",class:this.classes(mi.itemAddIcon,ai)}),this.messages.add):void 0,O=A?Ee("ul",{class:mi.items,key:"attachments-list"},_.toArray().map((i=>this._renderAttachmentInfo({attachmentInfo:i,displayType:r})))):void 0,B=x?Ee("ul",{class:mi.items,key:"file-list"},I.toArray().map((i=>this._renderFile(i)))):void 0,z=x||A?void 0:Ee("div",{class:xe.empty},this.messages.noAttachments);return Ee("div",{class:this.classes(mi.container,L),key:"attachments-container"},O,B,z,k)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(i){var r;const o=null==(r=i.target.files)?void 0:r.item(0);this._set("selectedFile",o)}_submitDeleteAttachment(i,r){i.preventDefault(),r&&("file"in r?this.deleteFile(r.file):r&&this.deleteAttachment(r))}_submitAddAttachment(i){i.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(i,r){i.preventDefault(),r&&"file"in r?this.updateFile():this.updateAttachment()}_startEditAttachment(i){const{viewModel:r}=this;r.activeFileInfo=null,r.activeAttachmentInfo=i,r.mode="edit"}_startEditFile(i){const{viewModel:r}=this;r.activeAttachmentInfo=null,r.activeFileInfo=i,r.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(i){i.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(i){const{orientationInfo:r}=i;return!this._supportsImageOrientation&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};z([W()],fi.prototype,"capabilities",null),z([W()],fi.prototype,"displayType",void 0),z([W({readOnly:!0})],fi.prototype,"effectiveDisplayType",null),z([W()],fi.prototype,"graphic",null),z([W()],fi.prototype,"icon",null),z([W()],fi.prototype,"label",null),z([W(),be("esri/widgets/Attachments/t9n/Attachments")],fi.prototype,"messages",void 0),z([W(),be("esri/core/t9n/Units")],fi.prototype,"messagesUnits",void 0),z([W({readOnly:!0})],fi.prototype,"selectedFile",void 0),z([W({readOnly:!0})],fi.prototype,"submitting",void 0),z([W({readOnly:!0})],fi.prototype,"error",void 0),z([W({type:ri})],fi.prototype,"viewModel",void 0),z([W()],fi.prototype,"visibleElements",void 0),z([H("visibleElements")],fi.prototype,"castVisibleElements",null),fi=z([X("esri.widgets.Attachments")],fi);const gi=fi;let yi=class s extends ri{constructor(i){super(i),this.description=null,this.title=null}};z([W()],yi.prototype,"description",void 0),z([W()],yi.prototype,"title",void 0),yi=z([X("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],yi);const _i=yi;function e$7({level:i,class:r,...o},a){const _=function s$6(i){return Pe(Math.ceil(i),1,6)}(i);return Ee(`h${_}`,{...o,"aria-level":String(_),class:ke(xe.heading,r),role:"heading"},a)}const wi="esri-feature-element-info",bi={base:wi,title:`${wi}__title`,description:`${wi}__description`};let Mi=class c extends Me{constructor(i,r){super(i,r),this.description=null,this.headingLevel=2,this.title=null}render(){return Ee("div",{class:bi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:i}=this;return i?Ee(e$7,{class:bi.title,innerHTML:i,level:this.headingLevel}):null}_renderDescription(){const{description:i}=this;return i?Ee("div",{class:bi.description,innerHTML:i,key:"description"}):null}};z([W()],Mi.prototype,"description",void 0),z([W()],Mi.prototype,"headingLevel",void 0),z([W()],Mi.prototype,"title",void 0),Mi=z([X("esri.widgets.Feature.support.FeatureElementInfo")],Mi);const Ii=Mi,Fi="esri-feature-attachments";let Ai=class h extends Me{constructor(i,r){super(i,r),this._featureElementInfo=null,this.attachmentsWidget=new gi,this.headingLevel=2,this.viewModel=new _i}initialize(){this._featureElementInfo=new Ii,this.addHandles([Y((()=>{var i,r;return[null==(i=this.viewModel)?void 0:i.description,null==(r=this.viewModel)?void 0:r.title,this.headingLevel]}),(()=>this._setupFeatureElementInfo()),J),Y((()=>this.viewModel),(i=>this.attachmentsWidget.viewModel=i),J)])}destroy(){var i;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),null==(i=this._featureElementInfo)||i.destroy()}get description(){return this.viewModel.description}set description(i){this.viewModel.description=i}get displayType(){return this.attachmentsWidget.displayType}set displayType(i){this.attachmentsWidget.displayType=i}get graphic(){return this.viewModel.graphic}set graphic(i){this.viewModel.graphic=i}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}render(){var i;const{attachmentsWidget:r}=this;return Ee("div",{class:Fi},null==(i=this._featureElementInfo)?void 0:i.render(),null==r?void 0:r.render())}_setupFeatureElementInfo(){var i;const{description:r,title:o,headingLevel:a}=this;null==(i=this._featureElementInfo)||i.set({description:r,title:o,headingLevel:a})}};z([W({readOnly:!0})],Ai.prototype,"attachmentsWidget",void 0),z([W()],Ai.prototype,"description",null),z([W()],Ai.prototype,"displayType",null),z([W()],Ai.prototype,"graphic",null),z([W()],Ai.prototype,"headingLevel",void 0),z([W()],Ai.prototype,"title",null),z([W({type:_i})],Ai.prototype,"viewModel",void 0),Ai=z([X("esri.widgets.Feature.FeatureAttachments")],Ai);const Ci=Ai;let Ei=class c2 extends G{constructor(i){super(i),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(Y((()=>this.creator),(i=>{this._destroyContent(),this._createContent(i)}),J))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:i,graphic:r,destroyer:o}=this;i&&r&&(E$2({type:"content",value:o,event:{graphic:r}}),this._set("created",null))}async _createContent(i){const r=this.graphic;if(!r||!i)return;const o=E$2({type:"content",value:i,event:{graphic:r}});this._loadingPromise=o,this.notifyChange("state");const a=await o;o===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",a))}};z([W({readOnly:!0})],Ei.prototype,"created",void 0),z([W()],Ei.prototype,"creator",void 0),z([W()],Ei.prototype,"destroyer",void 0),z([W({type:U})],Ei.prototype,"graphic",void 0),z([W({readOnly:!0})],Ei.prototype,"state",null),Ei=z([X("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Ei);const xi=Ei;function e$6(i){return r=>{r.hasOwnProperty("_delegatedEventNames")||(r._delegatedEventNames=r._delegatedEventNames?r._delegatedEventNames.slice():[]);const o=r._delegatedEventNames,a=Array.isArray(i)?i:function t$7(i){return i.split(",").map((i=>i.trim()))}(i);o.push(...a)}}function e$5(i){return i&&"function"==typeof i.render}const Ti="esri-feature-content",$i={base:Ti,loaderContainer:`${Ti}__loader-container`,loader:`${Ti}__loader`};let Li=class l extends Me{constructor(i,r){super(i,r),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach((i=>{v$4(i.href)&&!i.hasAttribute("target")&&i.setAttribute("target","_blank")}))}}get creator(){var i;return null==(i=this.viewModel)?void 0:i.creator}set creator(i){this.viewModel&&(this.viewModel.creator=i)}get graphic(){var i;return null==(i=this.viewModel)?void 0:i.graphic}set graphic(i){this.viewModel&&(this.viewModel.graphic=i)}render(){var i;const r=null==(i=this.viewModel)?void 0:i.state;return Ee("div",{class:$i.base},"loading"===r?this._renderLoading():this._renderCreated())}_renderLoading(){return Ee("div",{class:$i.loaderContainer,key:"loader"},Ee("div",{class:$i.loader}))}_renderCreated(){var i;const r=null==(i=this.viewModel)?void 0:i.created;return r?r instanceof HTMLElement?Ee("div",{afterCreate:this._attachToNode,bind:r,key:r}):e$5(r)?Ee("div",{key:r},!r.destroyed&&r.render()):Ee("div",{afterCreate:this._addTargetToAnchors,innerHTML:r,key:r}):null}_attachToNode(i){i.appendChild(this)}};z([W()],Li.prototype,"creator",null),z([W()],Li.prototype,"graphic",null),z([W({type:xi})],Li.prototype,"viewModel",void 0),Li=z([X("esri.widgets.Feature.FeatureContent")],Li);const Ri=Li;let ki=class l2 extends G{constructor(i){super(i),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:i,fieldInfos:r}=this,o=[];return null==r||r.forEach((r=>{if(r.hasOwnProperty("visible")&&!r.visible)return;const a=r.clone();a.label=C$4(a,i),o.push(a)})),o}};z([W()],ki.prototype,"attributes",void 0),z([W({type:[Oe]})],ki.prototype,"expressionInfos",void 0),z([W()],ki.prototype,"description",void 0),z([W({type:[Ne]})],ki.prototype,"fieldInfos",void 0),z([W({readOnly:!0})],ki.prototype,"formattedFieldInfos",null),z([W()],ki.prototype,"title",void 0),ki=z([X("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],ki);const Pi=ki,Oi=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];const Ni="esri-feature-fields",Vi={base:Ni,fieldHeader:`${Ni}__field-header`,fieldData:`${Ni}__field-data`,fieldDataDate:`${Ni}__field-data--date`};let Si=class c3 extends Me{constructor(i,r){super(i,r),this._featureElementInfo=null,this.viewModel=new Pi,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Ii,this.addHandles(Y((()=>{var i,r;return[null==(i=this.viewModel)?void 0:i.description,null==(r=this.viewModel)?void 0:r.title]}),(()=>this._setupFeatureElementInfo()),J))}destroy(){var i;null==(i=this._featureElementInfo)||i.destroy()}get attributes(){return this.viewModel.attributes}set attributes(i){this.viewModel.attributes=i}get description(){return this.viewModel.description}set description(i){this.viewModel.description=i}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(i){this.viewModel.expressionInfos=i}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(i){this.viewModel.fieldInfos=i}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}render(){var i;return Ee("div",{class:Vi.base},null==(i=this._featureElementInfo)?void 0:i.render(),this._renderFields())}_renderFieldInfo(i,o){var a;const{attributes:_}=this.viewModel,b=i.fieldName||"",I=i.label||b,A=_?null==_[b]?"":_[b]:"",x=!!(null==(a=i.format)?void 0:a.dateFormat),L="number"!=typeof A||x?function a$2(i,o){if("string"!=typeof o||!o)return o;const a=Oi.find((i=>i.pattern.test(o)));if(!a)return o;const _=o.match(a.pattern),b=null==_?void 0:_[2],I=r(r(a.label,{messages:i,hierPart:b}),{appName:a.appName}),A=a.target?` target="${a.target}"`:"",x="_blank"===a.target?' rel="noreferrer"':"";return o.replace(a.pattern,`<a${A} href="$1"${x}>${I}</a>`)}(this.messagesURIUtils,A):this._forceLTR(A),k={[Vi.fieldDataDate]:x};return Ee("tr",{key:`fields-element-info-row-${b}-${o}`},Ee("th",{class:Vi.fieldHeader,innerHTML:I,key:`fields-element-info-row-header-${b}-${o}`}),Ee("td",{class:this.classes(Vi.fieldData,k),innerHTML:L,key:`fields-element-info-row-data-${b}-${o}`}))}_renderFields(){const{formattedFieldInfos:i}=this.viewModel;return(null==i?void 0:i.length)?Ee("table",{class:xe.table,summary:this.messages.fieldsSummary},Ee("tbody",null,i.map(((i,r)=>this._renderFieldInfo(i,r))))):null}_setupFeatureElementInfo(){var i;const{description:r,title:o}=this;null==(i=this._featureElementInfo)||i.set({description:r,title:o})}_forceLTR(i){return`&lrm;${i}`}};z([W()],Si.prototype,"attributes",null),z([W()],Si.prototype,"description",null),z([W()],Si.prototype,"expressionInfos",null),z([W()],Si.prototype,"fieldInfos",null),z([W()],Si.prototype,"title",null),z([W({type:Pi,nonNullable:!0})],Si.prototype,"viewModel",void 0),z([W(),be("esri/widgets/Feature/t9n/Feature")],Si.prototype,"messages",void 0),z([W(),be("esri/widgets/support/t9n/uriUtils")],Si.prototype,"messagesURIUtils",void 0),Si=z([X("esri.widgets.Feature.FeatureFields")],Si);const Di=Si,Bi={maximumFractionDigits:20};const ji="<",qi=">";function r$3(i,r,o,a){let _="";return 0===r?_=`${ji} `:r===o&&(_=`${qi} `),_+function c$4(i){return k(i,Bi)}(i)}const zi=new Ve([64,64,64]);async function r$2(i,r,o){let a=!1,_=[],b=[];if(i.stops){const r=i.stops;_=r.map((i=>i.value)),a=r.some((i=>!!i.label)),a&&(b=r.map((i=>i.label)))}const I=_[0],A=_[_.length-1];if(null==I&&null==A)return null;const x=a?null:function n$5(i,r){const o=[],a=i.length-1;return 5===i.length?o.push(0,2,4):o.push(0,a),i.map(((i,r)=>o.includes(r)?r$3(i,r,a):null))}(_);return(await Promise.all(_.map((async(r,o)=>({value:r,color:"opacity"===i.type?await t$5(r,i):(await Ce((async()=>{const{getColor:i}=await import("./index-DSIPxOWi.js").then((i=>i.yD));return{getColor:i}}),__vite__mapDeps([2,3]))).getColor(i,r),label:a?b[o]:(null==x?void 0:x[o])??""}))))).reverse()}async function t$5(i,r,o){const a=new Ve(zi),_=(await Ce((async()=>{const{getOpacity:i}=await import("./index-DSIPxOWi.js").then((i=>i.yD));return{getOpacity:i}}),__vite__mapDeps([2,3]))).getOpacity(r,i);return null!=_&&(a.a=_),a}async function w$5(i,r,o){je(i,r,(()=>[])).push(...o)}async function x$2(i){var r,o;const a=new Map;if(!i)return a;if("visualVariables"in i&&i.visualVariables){const r=i.visualVariables.filter((i=>"color"===i.type));for(const i of r){const r=(await r$2(i)??[]).map((i=>i.color));await w$5(a,i.field||i.valueExpression,r)}}if("heatmap"===i.type){const r=function r$1(i){if(!i.colorStops)return[];const r=[...i.colorStops].filter((i=>{var r;return(null==(r=i.color)?void 0:r.a)>0}));let o=r.length-1;if(r&&r[0]){const i=r[o];i&&1!==i.ratio&&(r.push(new Se({ratio:1,color:i.color})),o++)}return r.map(((r,a)=>{var _,b;let I="";return 0===a?I=(null==(_=i.legendOptions)?void 0:_.minLabel)||"low":a===o&&(I=(null==(b=i.legendOptions)?void 0:b.maxLabel)||"high"),{color:r.color,label:I,ratio:r.ratio}})).reverse()}(i).map((i=>i.color));await w$5(a,i.field||i.valueExpression,r)}else if("pie-chart"===i.type){for(const r of i.attributes)await w$5(a,r.field||r.valueExpression,[r.color]);await w$5(a,"default",[null==(r=null==i?void 0:i.othersCategory)?void 0:r.color,De(i.backgroundFillSymbol,null)])}else if("dot-density"===i.type){for(const r of i.attributes)await w$5(a,r.field||r.valueExpression,[r.color]);await w$5(a,"default",[i.backgroundColor])}else if("unique-value"===i.type)if("predominance"===(null==(o=i.authoringInfo)?void 0:o.type))for(const _ of i.uniqueValueInfos??[])await w$5(a,_.value.toString(),[De(_.symbol,null)]);else{const r=(i.uniqueValueInfos??[]).map((i=>De(i.symbol,null))),{field:o,field2:_,field3:b,valueExpression:I}=i;(o||I)&&await w$5(a,o||I,r),_&&await w$5(a,_,r),b&&await w$5(a,b,r)}else if("class-breaks"===i.type){const r=i.classBreakInfos.map((i=>De(i.symbol,null))),{field:o,valueExpression:_}=i;await w$5(a,o??_,r)}else"simple"===i.type&&await w$5(a,"default",[De(i.symbol,null)]);return"defaultSymbol"in i&&i.defaultSymbol&&await w$5(a,"default",[De(i.defaultSymbol,null)]),a.forEach(((i,r)=>{const o=Be(i.filter(Boolean),((i,r)=>JSON.stringify(i)===JSON.stringify(r)));a.set(r,o)})),a}i("short-date");const m$4=()=>I.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Wi=new Map;function y$4(i){if(!de(i))return null;const[r,o]=i.split("/").slice(1);return{layerId:r,fieldName:o}}function F$3(i,r){const o=function j$3(i,r){if(!r.relationships)return null;let o=null;const{relationships:a}=r;return a.some((r=>r.id===parseInt(i,10)&&(o=r,!0))),o}(i,r);if(o)return{url:`${r.url}/${o.relatedTableId}`,sourceSpatialReference:r.spatialReference,relation:o,relatedFields:[],outStatistics:[]}}async function U$1(i,r,o,a){const _=o.layerId.toString(),{layerInfo:b,relation:I,relatedFields:A,outStatistics:x,url:L,sourceSpatialReference:k}=r,O=function b$4(i){return i?Be(i):void 0}(A),B=function R(i){return i?Be(i,((i,r)=>JSON.stringify(i.toJSON())===JSON.stringify(r.toJSON()))):void 0}(x);if(!b||!I)return null;const z=function g$5({originRelationship:i,relationships:r,layerId:o}){return r.find((({relatedTableId:r,id:a})=>`${r}`===o&&a===(null==i?void 0:i.id)))??null}({originRelationship:I,relationships:b.relationships,layerId:_});if((null==z?void 0:z.relationshipTableId)&&z.keyFieldInRelationshipTable){const r=(await function S(i,r,o,a){var _;const b=new Qe;return b.outFields=["*"],b.relationshipId="number"==typeof r.id?r.id:parseInt(r.id,10),b.objectIds=[i.attributes[o.objectIdField]],(null==(_=o.queryRelatedFeatures)?void 0:_.call(o,b,a))??Promise.resolve({})}(i,z,o,a))[i.attributes[o.objectIdField]];if(!r)return null;const _=r.features.map((i=>i.attributes[b.objectIdField]));if((null==B?void 0:B.length)&&b.supportsStatistics){const i=new He;i.where=function w$4(i,r,o){let a=0;const _=[];for(;a<r.length;)_.push(`${i} IN (${r.slice(a,o+a)})`),a+=o;return _.join(" OR ")}(b.objectIdField,_,1e3),i.outFields=O,i.outStatistics=B,i.sourceSpatialReference=k;const o={features:Promise.resolve(r),statsFeatures:Wt(L,i)};return ze(o)}}const W=null==z?void 0:z.keyField;if(W){const r=Ue(function v$3(i,r){if(null!=i){r=r.toLowerCase();for(const o of i)if(o&&o.name.toLowerCase()===r)return o}return null}(b.fields,W)),o=function h$2(i,r){const o=r.toLowerCase();for(const a in i)if(a.toLowerCase()===o)return i[a];return null}(i.attributes,I.keyField),_=r?`${W}=${o}`:`${W}='${o}'`,A=Wt(L,new He({where:_,outFields:O,sourceSpatialReference:k}),a),x=(null==B?void 0:B.length)&&b.supportsStatistics?Wt(L,new He({where:_,outFields:O,outStatistics:B,sourceSpatialReference:k}),a):null,z={features:A};return x&&(z.statsFeatures=x),ze(z)}return null}function N({relatedInfos:i,layer:r},o){const a={};return i.forEach(((i,o)=>{const{relation:_}=i;if(!_){const i=new K("relation-required","A relation is required on a layer to retrieve related records.");throw m$4().error(i),i}const{relatedTableId:b}=_;if("number"!=typeof b){const i=new K("A related table ID is required on a layer to retrieve related records.");throw m$4().error(i),i}const I=`${r.url}/${b}`,A=Wi.get(I),x=A??function $(i,r){return Ze(i,{query:{f:"json"},signal:null==r?void 0:r.signal})}(I);A||Wi.set(I,x),a[o]=x})),qe(ze(a),o)}const Hi={chartAnimation:!0};let Ui=class v extends G{constructor(i){super(i),this.abilities={...Hi},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(i){return{...Hi,...i}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(i){this._setContentElementMedia(i)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(i){const{formattedMediaInfoCount:r}=this,o=(i+r)%r;this.activeMediaInfoIndex=o}_pageContentElementMedia(i){const{activeMediaInfoIndex:r}=this,o=r+i;this._setContentElementMedia(o)}_formatMediaInfos(){const{mediaInfos:i,layer:r}=this,o=this.attributes??{},a=this.formattedAttributes??{},_=this.expressionAttributes??{},b=this.fieldInfoMap??new Map;return(null==i?void 0:i.map((i=>{const I=null==i?void 0:i.clone();if(!I)return null;if(I.title=D({attributes:o,fieldInfoMap:b,globalAttributes:a,expressionAttributes:_,layer:r,text:I.title}),I.caption=D({attributes:o,fieldInfoMap:b,globalAttributes:a,expressionAttributes:_,layer:r,text:I.caption}),I.altText=D({attributes:o,fieldInfoMap:b,globalAttributes:a,expressionAttributes:_,layer:r,text:I.altText}),"image"===I.type){if(!I.value)return;return this._setImageValue({value:I.value,formattedAttributes:a,layer:r}),I.value.sourceURL?I:void 0}if("pie-chart"===I.type||"line-chart"===I.type||"column-chart"===I.type||"bar-chart"===I.type){if(!I.value)return;return this._setChartValue({value:I.value,chartType:I.type,attributes:o,formattedAttributes:a,layer:r,expressionAttributes:_}),I}return null})).filter(Xe))??[]}_setImageValue(i){const r=this.fieldInfoMap??new Map,{value:o,formattedAttributes:a,layer:_}=i,{linkURL:b,sourceURL:I}=o;if(I){const i=P(I,_);o.sourceURL=z$3({formattedAttributes:a,template:i,fieldInfoMap:r})}if(b){const i=P(b,_);o.linkURL=z$3({formattedAttributes:a,template:i,fieldInfoMap:r})}}_setChartValue(i){const{value:r,attributes:o,formattedAttributes:a,chartType:_,layer:b,expressionAttributes:I}=i,{popupTemplate:A,relatedInfos:x}=this,{fields:L,normalizeField:k}=r,O=b;if(r.fields=function R$1(i,r){return i&&i.map((i=>q$1(i,r)))}(L,O),k&&(r.normalizeField=q$1(k,O)),!L.some((i=>!!(null!=a[i]||de(i)&&(null==x?void 0:x.size)))))return;const B=(null==A?void 0:A.fieldInfos)??[];L.forEach(((i,b)=>{var A;const x=null==(A=r.colors)?void 0:A[b];if(de(i))return void(r.series=[...r.series,...this._getRelatedChartInfos({fieldInfos:B,fieldName:i,formattedAttributes:a,chartType:_,value:r,color:x})]);const L=this._getChartOption({value:r,attributes:o,chartType:_,formattedAttributes:a,expressionAttributes:I,fieldName:i,fieldInfos:B,color:x});r.series.push(L)}))}_getRelatedChartInfos(i){var r;const{fieldInfos:o,fieldName:a,formattedAttributes:_,chartType:b,value:I,color:A}=i,x=[],L=y$4(a),k=L&&(null==(r=this.relatedInfos)?void 0:r.get(L.layerId.toString()));if(!k)return x;const{relatedFeatures:O,relation:B}=k;if(!B||!O)return x;const{cardinality:z}=B;return O.forEach((i=>{const{attributes:r}=i;r&&Object.keys(r).forEach((i=>{i===L.fieldName&&x.push(this._getChartOption({value:I,attributes:r,formattedAttributes:_,fieldName:a,chartType:b,relatedFieldName:i,hasMultipleRelatedFeatures:(null==O?void 0:O.length)>1,fieldInfos:o,color:A}))}))})),"one-to-many"===z||"many-to-many"===z?x:[x[0]]}_getTooltip({label:i,value:r,chartType:o}){return"pie-chart"===o?`${i}`:`${i}: ${r}`}_getChartOption(i){var r;const{value:o,attributes:a,formattedAttributes:_,expressionAttributes:b,fieldName:I,relatedFieldName:A,fieldInfos:x,chartType:L,hasMultipleRelatedFeatures:k,color:O}=i,B=this.layer,z=this.fieldInfoMap??new Map,{normalizeField:W,tooltipField:H}=o,U=W?de(W)?a[y$4(W).fieldName]:a[W]:null,X=x$3(I)&&b&&void 0!==b[I]?b[I]:A&&void 0!==a[A]?a[A]:void 0!==a[I]?a[I]:_[I],G=new Ge({fieldName:I,color:O,value:void 0===X?null:X&&U?X/U:X});if(de(I)){const i=z.get(I.toLowerCase()),r=H&&z.get(H.toLowerCase()),o=(null==i?void 0:i.fieldName)??I,b=k&&H?y$4(H).fieldName:(null==r?void 0:r.fieldName)??H,x=k&&b?a[b]:_[b]??(null==i?void 0:i.label)??(null==i?void 0:i.fieldName)??A,O=k&&A?a[A]:_[o];return G.tooltip=this._getTooltip({label:x,value:O,chartType:L}),G}const Y=Y$1(x,I),J=q$1(I,B),K=H&&void 0!==_[H]?_[H]:C$4(Y||new Ne({fieldName:J}),null==(r=this.popupTemplate)?void 0:r.expressionInfos),ve=_[J];return G.tooltip=this._getTooltip({label:K,value:ve,chartType:L}),G}};z([W()],Ui.prototype,"abilities",void 0),z([H("abilities")],Ui.prototype,"castAbilities",null),z([W()],Ui.prototype,"activeMediaInfoIndex",void 0),z([W({readOnly:!0})],Ui.prototype,"activeMediaInfo",null),z([W()],Ui.prototype,"attributes",void 0),z([W()],Ui.prototype,"description",void 0),z([W()],Ui.prototype,"fieldInfoMap",void 0),z([W()],Ui.prototype,"formattedAttributes",void 0),z([W()],Ui.prototype,"expressionAttributes",void 0),z([W({readOnly:!0})],Ui.prototype,"formattedMediaInfos",null),z([W()],Ui.prototype,"isAggregate",void 0),z([W()],Ui.prototype,"layer",void 0),z([W({readOnly:!0})],Ui.prototype,"formattedMediaInfoCount",null),z([W()],Ui.prototype,"mediaInfos",void 0),z([W()],Ui.prototype,"popupTemplate",void 0),z([W()],Ui.prototype,"relatedInfos",void 0),z([W()],Ui.prototype,"title",void 0),Ui=z([X("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Ui);const Zi=Ui,Qi="esri-feature-media",Xi={base:Qi,mediaContainer:`${Qi}__container`,mediaItemContainer:`${Qi}__item-container`,mediaItem:`${Qi}__item`,mediaItemText:`${Qi}__item-text`,mediaItemTitle:`${Qi}__item-title`,mediaItemCaption:`${Qi}__item-caption`,mediaNavigation:`${Qi}__item-navigation`,mediaPagination:`${Qi}__pagination`,mediaPaginationText:`${Qi}__pagination-text`,mediaPrevious:`${Qi}__previous`,mediaPreviousIconLTR:`${Qi}__previous-icon`,mediaPreviousIconRTL:`${Qi}__previous-icon--rtl`,mediaNext:`${Qi}__next`,mediaNextIconLTR:`${Qi}__next-icon`,mediaNextIconRTL:`${Qi}__next-icon--rtl`,mediaChart:`${Qi}__chart`,mediaPaginationButton:`${Qi}__pagination-button`,mediaPaginationIcon:`${Qi}__pagination-icon`,mediaChartRendered:`${Qi}__chart--rendered`},Gi="category",Yi="value";let Ji=class T extends Me{constructor(i,r){super(i,r),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new Zi,this.messages=null,this._disposeChart=i=>{var r;null==(r=this._chartRootMap.get(i))||r.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:r,viewModel:o}=this;if(r||!o||!i)return;const{createRoot:a}=await Ce((()=>import("./chartUtilsAm5-DRrzCagg.js")),__vite__mapDeps([7,2,3,8,9,10])),_=await a(i);this._chartRootMap.set(i,_),this._renderChart({mediaInfo:o.activeMediaInfo,root:_})}}initialize(){this._featureElementInfo=new Ii,this.addHandles([Y((()=>{var i,r;return[null==(i=this.viewModel)?void 0:i.activeMediaInfo,null==(r=this.viewModel)?void 0:r.activeMediaInfoIndex]}),(()=>this._setupMediaRefreshTimer()),J),Y((()=>{var i,r;return[null==(i=this.viewModel)?void 0:i.description,null==(r=this.viewModel)?void 0:r.title]}),(()=>this._setupFeatureElementInfo()),J)])}loadDependencies(){return Ae({icon:()=>Ce((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([0,1,2,3,4,5,6]))})}destroy(){var i;this._clearMediaRefreshTimer(),null==(i=this._featureElementInfo)||i.destroy()}get attributes(){return this.viewModel.attributes}set attributes(i){this.viewModel.attributes=i}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(i){this.viewModel.activeMediaInfoIndex=i}get description(){return this.viewModel.description}set description(i){this.viewModel.description=i}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(i){this.viewModel.fieldInfoMap=i}get layer(){return this.viewModel.layer}set layer(i){this.viewModel.layer=i}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(i){this.viewModel.mediaInfos=i}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(i){this.viewModel.popupTemplate=i}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(i){this.viewModel.relatedInfos=i}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}render(){var i;return Ee("div",{bind:this,class:Xi.base,onkeyup:this._handleMediaKeyup},null==(i=this._featureElementInfo)?void 0:i.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:i,activeMediaInfoIndex:r}=this.viewModel,o=this._renderMediaText();return i?Ee("div",{class:Xi.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),Ee("div",{class:Xi.mediaNavigation},o,i>1?Ee("div",{class:Xi.mediaPagination},this._renderMediaPageButton("previous"),Ee("span",{class:Xi.mediaPaginationText},Dt(this.messages.pageText,{index:r+1,total:i})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:i}=this.viewModel;if(!i)return null;const r=i&&i.title?Ee("div",{class:Xi.mediaItemTitle,innerHTML:i.title,key:"media-title"}):null,o=i&&i.caption?Ee("div",{class:Xi.mediaItemCaption,innerHTML:i.caption,key:"media-caption"}):null;return r||o?Ee("div",{class:Xi.mediaItemText,key:"media-text"},r,o):null}_renderImageMediaInfo(i){if(!i.value)return null;const{_refreshIntervalInfo:r}=this,{activeMediaInfoIndex:o,formattedMediaInfoCount:a}=this.viewModel,{value:_,refreshInterval:b,altText:I,title:A,type:x}=i,{sourceURL:L,linkURL:k}=_,O=v$4(k??void 0)?"_blank":"_self",B="_blank"===O?"noreferrer":"",z=b?r:null,W=z?z.timestamp:0,H=z?z.sourceURL:L,U=Ee("img",{alt:I||A,key:`media-${x}-${o}-${a}-${W}`,src:H??void 0});return(k?Ee("a",{href:k,rel:B,target:O,title:A},U):null)??U}_renderChartMediaInfo(i){const{activeMediaInfoIndex:r,formattedMediaInfoCount:o}=this.viewModel;return Ee("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Xi.mediaChart,key:`media-${i.type}-${r}-${o}`})}_renderMediaInfoType(){const{activeMediaInfo:i}=this.viewModel;return i?"image"===i.type?this._renderImageMediaInfo(i):i.type.includes("chart")?this._renderChartMediaInfo(i):null:null}_renderMediaInfo(){const{activeMediaInfo:i}=this.viewModel;return i?Ee("div",{class:Xi.mediaItemContainer,key:"media-container"},Ee("div",{class:Xi.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(i){if(this.viewModel.formattedMediaInfoCount<2)return null;const r="previous"===i,o=r?this.messages.previous:this.messages.next,a=r?"chevron-left":"chevron-right",_=r?"media-previous":"media-next",b=r?this._previous:this._next;return Ee("button",{"aria-label":o,bind:this,class:Xi.mediaPaginationButton,key:_,onclick:b,tabIndex:0,title:o,type:"button"},Ee("calcite-icon",{class:Xi.mediaPaginationIcon,icon:a,scale:"s"}))}_setupFeatureElementInfo(){var i;const{description:r,title:o}=this;null==(i=this._featureElementInfo)||i.set({description:r,title:o})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:i,layer:r}=this.viewModel;return i&&(null==r?void 0:r.featureReduction)&&"renderer"in r.featureReduction?r.featureReduction.renderer:null==r?void 0:r.renderer}async _getSeriesColors(i){const{colorAm5:r}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),o=new Map;return i.forEach((i=>{i.color&&o.set(i,r(i.color.toCss(!0)))})),o}async _getRendererColors(){const{colorAm5:i}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),r=new Map,o=this._getRenderer();if(!o)return r;const a=await x$2(o);return a.delete("default"),Array.from(a.values()).every((i=>1===(null==i?void 0:i.length)))?(Array.from(a.keys()).forEach((o=>{var _,b;const I=null==(b=null==(_=a.get(o))?void 0:_[0])?void 0:b.toCss(!0);I&&r.set(o,i(I))})),r):r}_handleMediaKeyup(i){const{key:r}=i;"ArrowLeft"===r&&(i.stopPropagation(),this.viewModel.previous()),"ArrowRight"===r&&(i.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Ye()}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}async _renderChart(i){const{root:r,mediaInfo:o}=i,{value:a,type:_}=o,{ResponsiveThemeAm5:b,DarkThemeAm5:I,AnimatedThemeAm5:A,ColorSetAm5:x,ThemeAm5:L,esriChartColorSet:k}=await Ce((async()=>{const{ResponsiveThemeAm5:i,DarkThemeAm5:r,AnimatedThemeAm5:o,ColorSetAm5:a,ThemeAm5:_,esriChartColorSet:b}=await import("./chartCommon-TAiNm-wm.js");return{ResponsiveThemeAm5:i,DarkThemeAm5:r,AnimatedThemeAm5:o,ColorSetAm5:a,ThemeAm5:_,esriChartColorSet:b}}),__vite__mapDeps([11,8,2,3,12,9,13])),O=L.new(r);O.rule("ColorSet").set("colors",k),O.rule("ColorSet").set("reuse",!0);const B=[b.new(r),O];Je()&&B.push(I.new(r)),this._canAnimateChart()&&B.push(A.new(r)),r.setThemes(B);const z=await this._getRendererColors(),W=await this._getSeriesColors(a.series),H=x.new(r,{}),U=W.get(a.series[0]),X=U?{lineSettings:{stroke:U}}:void 0,G=a.series.map(((i,r)=>{const o=W.get(i)||z.get(i.fieldName)||H.getIndex(r);return{[Gi]:i.tooltip,[Yi]:i.value,columnSettings:{fill:o,stroke:o},...X}})).filter((i=>"pie-chart"!==_||null!=i.value&&i.value>0));"pie-chart"===_?this._createPieChart(i,G):this._createXYChart(i,G)}_getDirection(){return Re(this.container)?"rtl":"ltr"}_isInversed(){return!!Re(this.container)}async _customizeChartTooltip(i,r="horizontal"){var o;const{colorAm5:a}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13]));i.setAll({pointerOrientation:r}),null==(o=i.get("background"))||o.setAll({stroke:a("rgba(50, 50, 50, 1)")}),i.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})}async _createPieChart(i,r){const{TooltipAm5:o}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),{PieChartAm5:a,PieSeriesAm5:_}=await Ce((async()=>{const{PieChartAm5:i,PieSeriesAm5:r}=await import("./pieChart-Dm7_yUDQ.js");return{PieChartAm5:i,PieSeriesAm5:r}}),__vite__mapDeps([14,2,3,15,8,13,10])),{mediaInfo:b,root:I}=i,{title:A}=b,x=(null==b?void 0:b.altText)||(null==b?void 0:b.title)||"",L=I.container.children.push(a.new(I,{ariaLabel:x,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),k="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",O=o.new(I,{labelText:k}),B=L.series.push(_.new(I,{name:A,valueField:Yi,categoryField:Gi,tooltip:O}));B.ticks.template.set("forceHidden",!0),B.labels.template.set("forceHidden",!0),B.slices.template.states.create("active",{shiftRadius:5}),this._customizeChartTooltip(O),B.slices.template.setAll({ariaLabel:k,focusable:!0,templateField:"columnSettings"}),B.data.setAll(r),B.appear(this._getChartSeriesAnimationMS()),L.appear(this._getChartAnimationMS()),L.root.dom.classList.toggle(Xi.mediaChartRendered,!0)}_getMinSeriesValue(i){let r=0;return i.forEach((i=>r=Math.min(i.value,r))),r}async _createColumnChart(i,r,o){const{TooltipAm5:a,ScrollbarAm5:_}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),{CategoryAxisAm5:b,AxisRendererXAm5:I,ValueAxisAm5:A,AxisRendererYAm5:x,ColumnSeriesAm5:L}=await Ce((async()=>{const{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,ColumnSeriesAm5:_}=await import("./xyChart-B7x-V05x.js");return{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,ColumnSeriesAm5:_}}),__vite__mapDeps([16,8,2,3,13,10,15,12])),{mediaInfo:k,root:O}=r,{value:B,title:z}=k;i.setAll({wheelX:"panX",wheelY:"zoomX"});const W=i.xAxes.push(b.new(O,{renderer:I.new(O,{inversed:this._isInversed()}),categoryField:Gi}));W.get("renderer").labels.template.setAll({forceHidden:!0});const H=i.yAxes.push(A.new(O,{renderer:x.new(O,{inside:!1}),min:this._getMinSeriesValue(B.series)}));H.get("renderer").labels.template.setAll({direction:this._getDirection()});const U="{categoryX}",X=a.new(O,{labelText:U}),G=i.series.push(L.new(O,{name:z,xAxis:W,yAxis:H,valueYField:Yi,categoryXField:Gi,tooltip:X}));this._customizeChartTooltip(X),G.columns.template.setAll({ariaLabel:U,focusable:!0,templateField:"columnSettings"}),B.series.length>15&&i.set("scrollbarX",_.new(O,{orientation:"horizontal"})),W.data.setAll(o),G.data.setAll(o),G.appear(this._getChartSeriesAnimationMS()),i.appear(this._getChartAnimationMS())}async _createBarChart(i,r,o){const{TooltipAm5:a,ScrollbarAm5:_}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),{CategoryAxisAm5:b,AxisRendererXAm5:I,ValueAxisAm5:A,AxisRendererYAm5:x,ColumnSeriesAm5:L}=await Ce((async()=>{const{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,ColumnSeriesAm5:_}=await import("./xyChart-B7x-V05x.js");return{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,ColumnSeriesAm5:_}}),__vite__mapDeps([16,8,2,3,13,10,15,12])),{mediaInfo:k,root:O}=r,{value:B,title:z}=k;i.setAll({wheelX:"panY",wheelY:"zoomY"});const W=i.yAxes.push(b.new(O,{renderer:x.new(O,{inversed:!0}),categoryField:Gi}));W.get("renderer").labels.template.setAll({forceHidden:!0});const H=i.xAxes.push(A.new(O,{renderer:I.new(O,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(B.series)}));H.get("renderer").labels.template.setAll({direction:this._getDirection()});const U="{categoryY}",X=a.new(O,{labelText:U}),G=i.series.push(L.new(O,{name:z,xAxis:H,yAxis:W,valueXField:Yi,categoryYField:Gi,tooltip:X}));this._customizeChartTooltip(X,"vertical"),G.columns.template.setAll({ariaLabel:U,focusable:!0,templateField:"columnSettings"}),B.series.length>15&&i.set("scrollbarY",_.new(O,{orientation:"vertical"})),W.data.setAll(o),G.data.setAll(o),G.appear(this._getChartSeriesAnimationMS()),i.appear(this._getChartAnimationMS())}async _createLineChart(i,r,o){var a,_,b;const{TooltipAm5:I,ScrollbarAm5:A}=await Ce((()=>import("./chartCommon-TAiNm-wm.js")),__vite__mapDeps([11,8,2,3,12,9,13])),{CategoryAxisAm5:x,AxisRendererXAm5:L,ValueAxisAm5:k,AxisRendererYAm5:O,LineSeriesAm5:B}=await Ce((async()=>{const{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,LineSeriesAm5:_}=await import("./xyChart-B7x-V05x.js");return{CategoryAxisAm5:i,AxisRendererXAm5:r,ValueAxisAm5:o,AxisRendererYAm5:a,LineSeriesAm5:_}}),__vite__mapDeps([16,8,2,3,13,10,15,12])),{root:z,mediaInfo:W}=r,{value:H,title:U}=W;i.setAll({wheelX:"panX",wheelY:"zoomX"});const X=i.xAxes.push(x.new(z,{renderer:L.new(z,{inversed:this._isInversed()}),categoryField:Gi}));X.get("renderer").labels.template.setAll({forceHidden:!0});const G=i.yAxes.push(k.new(z,{renderer:O.new(z,{inside:!1}),min:this._getMinSeriesValue(H.series)}));G.get("renderer").labels.template.setAll({direction:this._getDirection()});const Y=null==(_=null==(a=o[0])?void 0:a.lineSettings)?void 0:_.stroke,J=I.new(z,{getFillFromSprite:!Y,labelText:"{categoryX}"});Y&&(null==(b=J.get("background"))||b.setAll({fill:Y}));const K=i.series.push(B.new(z,{name:U,xAxis:X,yAxis:G,valueYField:Yi,categoryXField:Gi,tooltip:J}));K.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(J,"vertical"),H.series.length>15&&i.set("scrollbarX",A.new(z,{orientation:"horizontal"})),X.data.setAll(o),K.data.setAll(o),K.appear(this._getChartSeriesAnimationMS()),i.appear(this._getChartAnimationMS())}async _createXYChart(i,r){const{XYChartAm5:o,XYCursorAm5:a}=await Ce((()=>import("./xyChart-B7x-V05x.js")),__vite__mapDeps([16,8,2,3,13,10,15,12])),{root:_,mediaInfo:b}=i,{type:I}=b,A=(null==b?void 0:b.altText)||(null==b?void 0:b.title)||"",x=_.container.children.push(o.new(_,{ariaLabel:A,focusable:!0,panX:!0,panY:!0}));x.set("cursor",a.new(_,{})),"column-chart"===I&&await this._createColumnChart(x,i,r),"bar-chart"===I&&await this._createBarChart(x,i,r),"line-chart"===I&&await this._createLineChart(x,i,r),x.root.dom.classList.toggle(Xi.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:i}=this;i&&(clearTimeout(i),this._refreshTimer=null)}_updateMediaInfoTimestamp(i){const r=Date.now();this._refreshIntervalInfo={timestamp:r,sourceURL:i&&this._getImageSource(i,r)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:i}=this.viewModel;"image"===(null==i?void 0:i.type)&&(null==i?void 0:i.refreshInterval)>0&&this._setRefreshTimeout(i)}_setRefreshTimeout(i){const{refreshInterval:r,value:o}=i,a=6e4*r;this._updateMediaInfoTimestamp(o.sourceURL);const _=setInterval((()=>{this._updateMediaInfoTimestamp(o.sourceURL)}),a);this._refreshTimer=_}_getImageSource(i,r){const o=i.includes("?")?"&":"?",[a,_=""]=i.split("#");return`${a}${o}timestamp=${r}${_?"#":""}${_}`}};z([W()],Ji.prototype,"_refreshIntervalInfo",void 0),z([W()],Ji.prototype,"attributes",null),z([W()],Ji.prototype,"activeMediaInfoIndex",null),z([W()],Ji.prototype,"description",null),z([W()],Ji.prototype,"fieldInfoMap",null),z([W()],Ji.prototype,"layer",null),z([W()],Ji.prototype,"mediaInfos",null),z([W()],Ji.prototype,"popupTemplate",null),z([W()],Ji.prototype,"relatedInfos",null),z([W()],Ji.prototype,"title",null),z([W({type:Zi})],Ji.prototype,"viewModel",void 0),z([W(),be("esri/widgets/Feature/t9n/Feature")],Ji.prototype,"messages",void 0),Ji=z([X("esri.widgets.Feature.FeatureMedia")],Ji);const Ki=Ji,s$3=()=>I.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function p$4(i){return"string"==typeof i?ae(oe(i)):Array.isArray(i)?function c$3(i){return`<ul class="esri-widget__list">${i.map((i=>`<li>${"string"==typeof i?ae(oe(i)):i}</li>`)).join("")}</ul>`}(i):"esri.arcade.Dictionary"===(null==i?void 0:i.declaredClass)?function u$2(i){const r=i.keys().map((r=>{const o=i.field(r);return`<tr><th>${r}</th><td>${"string"==typeof o?ae(oe(o)):o}</td></tr>`})).join("");return`<table class="${xe.table}">${r}</table>`}(i):i}function l$4(){return Ce((()=>import("./arcade-pJSHUs8p.js")),__vite__mapDeps([17,2,3,18,19]))}async function y$2({graphic:i,view:r,options:o}){const{isAggregate:a,layer:_}=i;if(!a||!_||"2d"!==(null==r?void 0:r.type))return[];const b=await r.whenLayerView(_);if(!function d$3(i){return"createQuery"in i&&"queryFeatures"in i}(b))return[];const I=b.createQuery(),A=i.getObjectId();I.aggregateIds=null!=A?[A]:[];const{features:x}=await b.queryFeatures(I,o);return x}async function g$3({expressionInfo:i,arcade:r,interceptor:o,spatialReference:a,map:_,graphic:b,location:I,view:A,options:x}){var L;if(!(null==i?void 0:i.expression))return null;const{isAggregate:k}=b,O=(b.sourceLayer||b.layer)??void 0,B=k?"feature-reduction-popup":"popup",z=r.createArcadeProfile(B),W=r.createArcadeExecutor(i.expression,z).catch((r=>s$3().error("arcade-executor-error",{error:r,expressionInfo:i}))),[H,U]=await Promise.all([y$2({graphic:b,view:A,options:x}),W]);if(!U)return null;const X="feature-reduction-popup"===B?function f$2({layer:i,aggregatedFeatures:r,interceptor:o}){const{fields:a,objectIdField:_,geometryType:b,spatialReference:I,displayField:A}=i;return new Ke({fields:a,objectIdField:_,geometryType:b,spatialReference:I,displayField:A,interceptor:o,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:r})}({layer:O,aggregatedFeatures:H,interceptor:o}):void 0,G={..."feature-reduction-popup"===B?{$aggregatedFeatures:X}:{$datastore:null==O?void 0:O.url,$layer:"feature"===(null==O?void 0:O.type)||"subtype-sublayer"===(null==O?void 0:O.type)||"catalog-footprint"===(null==O?void 0:O.type)||"oriented-imagery"===(null==O?void 0:O.type)?O:"scene"===(null==O?void 0:O.type)&&null!=O.associatedLayer?O.associatedLayer:void 0,$map:_,$userInput:I,$graph:"knowledge-graph-sublayer"===(null==O?void 0:O.type)?null==(L=null==O?void 0:O.parentCompositeLayer)?void 0:L.knowledgeGraph:void 0},$feature:b},Y={abortSignal:(null==x?void 0:x.signal)??void 0,interceptor:o??void 0,rawOutput:!0,spatialReference:a??void 0,timeZone:null==A?void 0:A.timeZone};return await U.executeAsync(G,Y).catch((r=>s$3().error("arcade-execution-error",{error:r,graphic:b,expressionInfo:i}))).finally((()=>null==X?void 0:X.destroy()))}async function m$3({expressionInfos:i,spatialReference:r,graphic:o,interceptor:a,map:_,view:b,location:I,options:A}){if(!(null==i?void 0:i.length))return{};const x=await l$4(),L={};for(const B of i)L[`expression/${B.name}`]=g$3({expressionInfo:B,arcade:x,interceptor:a,spatialReference:r,map:_,graphic:o,location:I,view:b,options:A});const k=await ze(L),O={};for(const B in k)O[B]=p$4(k[B].value);return O}let en=class j extends G{constructor(i){super(i),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var i,r;const o=null==(i=this.contentElement)?void 0:i.type;null==(r=this.contentElementViewModel)||r.destroy();const a="fields"===o?new Pi:"media"===o?new Zi:"text"===o?new xi:null;this._set("contentElementViewModel",a)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=e$a(this._compile,1,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:o,spatialReference:a,map:_,location:b,view:I,_abortController:A}=this;if(!i||!r)return void this._set("contentElement",null);const x=await l$4();if(A!==this._abortController)return;const L=await g$3({arcade:x,expressionInfo:i,graphic:r,location:b,interceptor:o,map:_,spatialReference:a,view:I});if(!L||"esri.arcade.Dictionary"!==L.declaredClass)return void this._set("contentElement",null);const k=await L.castAsJsonAsync(null==A?void 0:A.signal),O=null==k?void 0:k.type,B="media"===O?it.fromJSON(k):"text"===O?nt.fromJSON(k):"fields"===O?st.fromJSON(k):null;this._set("contentElement",B)},this.addHandles([Y((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),J),Y((()=>[this.contentElement]),(()=>this._createVM()),J)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var i;this._cancelQuery(),null==(i=this.contentElementViewModel)||i.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var i;return(null==(i=this.view)?void 0:i.spatialReference)??null}set spatialReference(i){this._override("spatialReference",i)}get state(){const{_abortController:i,contentElement:r,contentElementViewModel:o}=this;return i?"loading":r||o?"ready":"disabled"}get map(){var i;return(null==(i=this.view)?void 0:i.map)??null}set map(i){this._override("map",i)}};z([W()],en.prototype,"_abortController",void 0),z([W({type:et})],en.prototype,"expressionInfo",void 0),z([W({type:U})],en.prototype,"graphic",void 0),z([W({readOnly:!0})],en.prototype,"contentElement",void 0),z([W({readOnly:!0})],en.prototype,"contentElementViewModel",void 0),z([W()],en.prototype,"interceptor",void 0),z([W({type:tt})],en.prototype,"location",void 0),z([W()],en.prototype,"spatialReference",null),z([W({readOnly:!0})],en.prototype,"state",null),z([W()],en.prototype,"map",null),z([W()],en.prototype,"view",void 0),en=z([X("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],en);const tn=en,nn="esri-feature",sn={base:`${nn}-expression`,loadingSpinnerContainer:`${nn}__loading-container`};let rn=class g extends Me{constructor(i,r){super(i,r),this._contentWidget=null,this.viewModel=new tn}initialize(){this.addHandles(Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.contentElementViewModel}),(()=>this._setupExpressionWidget()),J))}loadDependencies(){return Ae({loader:()=>Ce((()=>import("./calcite-loader-CKsSCnMM.js")),__vite__mapDeps([20,21,2,3,5]))})}destroy(){this._destroyContentWidget()}render(){var i;const{state:r}=this.viewModel;return Ee("div",{class:sn.base},"loading"===r?this._renderLoading():"disabled"===r?null:null==(i=this._contentWidget)?void 0:i.render())}_renderLoading(){return Ee("div",{class:sn.loadingSpinnerContainer,key:"loading-container"},Ee("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:i}=this;i&&(i.viewModel=null,i.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:i,contentElement:r}=this.viewModel,o=null==r?void 0:r.type;this._destroyContentWidget();const a=i?"fields"===o?new Di({viewModel:i}):"media"===o?new Ki({viewModel:i}):"text"===o?new Ri({viewModel:i}):null:null;this._contentWidget=a,this.scheduleRender()}};z([W({type:tn})],rn.prototype,"viewModel",void 0),rn=z([X("esri.widgets.Feature.FeatureExpression")],rn);const on=rn;var an,ln;(ln=an||(an={})).TOO_SHORT="length-validation-error::too-short",ln.TOO_LONG="length-validation-error::too-long";const z$2=i=>{var r;const o=[];if(i.formTemplate){const{description:a,title:_}=i.formTemplate;null==(r=i.fields)||r.forEach((i=>{const r=_&&rt(_,i.name),b=a&&rt(a,i.name);(r||b)&&o.push(i.name)}))}return o};let dn=class g2 extends(ot(at(G))){constructor(i){super(i),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await lt(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await lt(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await lt(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryDebounced=dt(this._queryController,100),this._queryFeatureCountDebounced=dt(this._queryFeatureCountController,100),this._queryPageDebounced=dt(this._queryPageController,100),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.destroyAll(),this.destroyed||r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:null==i?void 0:i.signal}))))},this.addHandles([Y((()=>{var i;return[this.displayCount,this.graphic,this.layer,null==(i=this.layer)?void 0:i.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]}),(()=>this._queryDebounced()),J),Y((()=>[this.featurePage,this.showAllEnabled]),(()=>this._queryPageDebounced())),Y((()=>[this.layer,this.relationshipId,this.objectId,this.canQuery]),(()=>this._queryFeatureCountDebounced()))])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(i){const{featuresPerPage:r,featureCount:o}=this,a=Math.ceil(o/r)||1;this._set("featurePage",Math.min(Math.max(i,1),a))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:i,relatedLayer:r}=this;return i&&(null==r?void 0:r.loaded)?i.map((i=>{const o=i.clone();return o.field=q$1(i.field,r),o})):i??[]}get supportsCacheHint(){var i,r,o;return!!(null==(o=null==(r=null==(i=this.layer)?void 0:i.capabilities)?void 0:r.queryRelated)?void 0:o.supportsCacheHint)}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){var i,r;const o=null==(r=null==(i=this.layer)?void 0:i.capabilities)?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&(null==o?void 0:o.supportsCount)&&(null==o?void 0:o.supportsPagination))}get itemDescriptionFieldName(){var i;return(null==(i=this.orderByFieldsFixedCasing[0])?void 0:i.field)||null}set displayCount(i){this._set("displayCount",Math.min(Math.max(i,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var i,r;return(this.objectIdField&&(null==(r=null==(i=this.graphic)?void 0:i.attributes)?void 0:r[this.objectIdField]))??null}get objectIdField(){var i;return(null==(i=this.layer)?void 0:i.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new B}get relatedLayer(){const{layer:i,map:r,relationship:o}=this;return(null==i?void 0:i.loaded)&&r&&o?function Te(i,r,o){var a,_;return i&&r&&o?"sublayer"===r.type?Fe({layers:null==(a=r.layer)?void 0:a.sublayers,map:i,relatedLayer:r,relationship:o})||Fe({layers:null==(_=r.layer)?void 0:_.subtables,map:i,relatedLayer:r,relationship:o}):Fe({layers:i.allLayers,map:i,relatedLayer:r,relationship:o})||Fe({layers:i.allTables,map:i,relatedLayer:r,relationship:o}):null}(r,i,o)??null:null}get relationship(){var i;const{relationshipId:r,layer:o}=this;return null!=r?(null==(i=null==o?void 0:o.relationships)?void 0:i.find((({id:i})=>i===r)))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new B}get state(){const{_queryAbortController:i,_queryFeatureCountAbortController:r,_queryPageAbortController:o,canQuery:a,_loaded:_,canLoad:b}=this;return r||b&&!_?"loading":i||o?"querying":a?"ready":"disabled"}getRelatedFeatureByObjectId(i){return this.relatedFeatures.find((r=>r.getObjectId()===i))}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var i;null==(i=this.relatedFeatureViewModels)||i.destroyAll()}async _queryFeatureCount(){const{layer:i,relatedLayer:r,relationshipId:o,objectId:a,_queryFeatureCountAbortController:_,canQuery:b,supportsCacheHint:I}=this;if(await(null==i?void 0:i.load()),await(null==r?void 0:r.load()),!b||!i||!r||null==a)return void this._set("featureCount",0);const A=r.createQuery(),x=new Qe({cacheHint:I,relationshipId:o,returnGeometry:!1,objectIds:[a],where:A.where??void 0}),L=await i.queryRelatedFeaturesCount(x,{signal:null==_?void 0:_.signal});this._set("featureCount",L[a]||0)}_sliceFeatures(i){const{showAllEnabled:r,displayCount:o}=this;return r?i:o?i.slice(0,o):[]}async _queryPage(){const{relatedFeatures:i,featurePage:r,showAllEnabled:o,_queryPageAbortController:a,featureCount:_}=this;!o||r<2||!_||i.addMany(await this._queryRelatedFeatures({signal:null==a?void 0:a.signal}))}async _queryRelatedFeatures(i){var r;const{orderByFieldsFixedCasing:o,showAllEnabled:a,featuresPerPage:_,displayCount:b,layer:I,relationshipId:A,featurePage:x,featureCount:L,relatedLayer:k,supportsCacheHint:O}=this,{canQuery:B,objectId:z}=this;if(!B||!I||!k||null==z)return[];const W=a?((x-1)*_+L)%L:0,H=a?_:b,U=k.objectIdField,X=[...o.map((i=>i.field)),...z$2(k),U].filter(Xe),G=o.map((i=>`${i.field} ${i.order}`)),Y=k.createQuery(),J=new Qe({orderByFields:G,start:W,num:H,outFields:X,cacheHint:O,relationshipId:A,returnGeometry:!1,objectIds:[z],where:Y.where??void 0}),K=(null==(r=(await I.queryRelatedFeatures(J,{signal:null==i?void 0:i.signal}))[z])?void 0:r.features)||[];return K.forEach((i=>{i.sourceLayer=k,i.layer=k})),K}};z([W()],dn.prototype,"_loaded",void 0),z([W()],dn.prototype,"_queryAbortController",void 0),z([W()],dn.prototype,"_queryPageAbortController",void 0),z([W()],dn.prototype,"_queryFeatureCountAbortController",void 0),z([W({value:1})],dn.prototype,"featurePage",null),z([W()],dn.prototype,"featuresPerPage",void 0),z([W({readOnly:!0})],dn.prototype,"orderByFieldsFixedCasing",null),z([W({readOnly:!0})],dn.prototype,"supportsCacheHint",null),z([W({readOnly:!0})],dn.prototype,"canLoad",null),z([W({readOnly:!0})],dn.prototype,"canQuery",null),z([W()],dn.prototype,"description",void 0),z([W({readOnly:!0})],dn.prototype,"itemDescriptionFieldName",null),z([W({value:3})],dn.prototype,"displayCount",null),z([W({type:U})],dn.prototype,"graphic",void 0),z([W()],dn.prototype,"layer",void 0),z([W()],dn.prototype,"map",void 0),z([W({readOnly:!0})],dn.prototype,"objectId",null),z([W({readOnly:!0})],dn.prototype,"objectIdField",null),z([W()],dn.prototype,"orderByFields",void 0),z([W({readOnly:!0})],dn.prototype,"relatedFeatures",null),z([W({readOnly:!0})],dn.prototype,"relatedLayer",null),z([W({readOnly:!0})],dn.prototype,"relationship",null),z([W()],dn.prototype,"featureCount",void 0),z([W({readOnly:!0})],dn.prototype,"relatedFeatureViewModels",null),z([W()],dn.prototype,"relationshipId",void 0),z([W()],dn.prototype,"showAllEnabled",void 0),z([W()],dn.prototype,"state",null),z([W()],dn.prototype,"title",void 0),dn=z([X("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],dn);const un=dn,cn="esri-feature",hn=`${cn}-relationship`,pn={base:hn,listContainer:`${hn}__list`,listItem:`${hn}__list-item`,listItemHidden:`${hn}__list-item--hidden`,listContainerQuerying:`${hn}__list--querying`,featureObserver:`${cn}__feature-observer`,stickySpinnerContainer:`${cn}__sticky-loading-container`,loadingSpinnerContainer:`${cn}__loading-container`},mn={title:!0,description:!0};let vn=class F extends Me{constructor(i,r){super(i,r),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver((([i])=>{(null==i?void 0:i.isIntersecting)&&this._increaseFeaturePage()}),{root:window.document}),this.headingLevel=2,this.viewModel=new un,this.messages=null,this.messagesCommon=null,this.visibleElements={...mn},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:r,relatedFeatures:o,featuresPerPage:a,featurePage:_}=this.viewModel;"ready"===i&&r&&o.length>=a*_&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Ii,this.addHandles([Y((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),J),Y((()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode]),(()=>this._handleRelatedFeatureObserverChange())),Ie((()=>this.viewModel.relatedFeatureViewModels),"change",(()=>this._setupRelatedFeatureViewModels()))])}loadDependencies(){return Ae({icon:()=>Ce((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([0,1,2,3,4,5,6])),list:()=>Ce((()=>import("./calcite-list-BvNQA5EB.js")),__vite__mapDeps([22,2,3,4,5,23,6,24,25,26,27,28,29,1,30,31,32,33,21,34])),"list-item":()=>Ce((()=>import("./calcite-list-item-RYHR2PjI.js")),__vite__mapDeps([35,2,3,4,5,23,27,28,6,26,25,24,36,33,1,21])),loader:()=>Ce((()=>import("./calcite-loader-CKsSCnMM.js")),__vite__mapDeps([20,21,2,3,5])),notice:()=>Ce((()=>import("./calcite-notice-B5LcMWxf.js")),__vite__mapDeps([37,2,3,38,6,4,5,26,27,28,39,33,1]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ut(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:i,featureCount:r,displayCount:o,state:a}=this.viewModel;return!i&&!!r&&"ready"===a&&(r>o||0===o)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(i){this.viewModel.description=i}get featureCountDescription(){const{messages:i}=this,{featureCount:r}=this.viewModel;return Dt(null==i?void 0:i.numberRecords,{number:r})}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}castVisibleElements(i){return{...mn,...i}}render(){var i;const{state:r}=this.viewModel;return Ee("div",{class:this.classes(pn.base,xe.widget)},null==(i=this._featureElementInfo)?void 0:i.render(),"loading"===r?this._renderLoading():"disabled"===r?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?Ee("div",{class:pn.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return Ee("calcite-loader",{inline:!0,label:""})}_renderLoading(){return Ee("div",{class:pn.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return Ee("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const i=Re(this.container)?"chevron-left":"chevron-right";return Ee("calcite-icon",{icon:i,scale:"s",slot:"content-end"})}_renderRelatedFeature(i){var r;const{itemDescriptionFieldName:o}=this.viewModel,a=i.title;i.description=o&&(null==(r=i.formattedAttributes)?void 0:r.global[o]);const _="loading"===i.state;return Ee("calcite-list-item",{class:this.classes(pn.listItem,{[pn.listItemHidden]:_}),description:i.description??"",key:i.uid,label:a,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:i})},this._renderChevronIconNode())}_renderShowAllListItem(){var i;return this.displayShowAllButton?Ee("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:null==(i=this.messages)?void 0:i.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var i;return Ee("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},Ee("div",{slot:"message"},null==(i=this.messages)?void 0:i.noRelatedFeatures))}_renderFeatureObserver(){return Ee("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:pn.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:i}=this.viewModel;return Ee("calcite-list",null,i.toArray().map((i=>this._renderRelatedFeature(i))),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:i}=this,{state:r}=this.viewModel;return Ee("div",{class:this.classes(pn.listContainer,{[pn.listContainerQuerying]:"querying"===r}),key:"list-container"},i?this._renderList():"ready"===r?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var i;return Ee("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},Ee("div",{slot:"message"},null==(i=this.messages)?void 0:i.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:i}=this.viewModel,r="related-feature-viewmodels";this.removeHandles(r),null==i||i.forEach((i=>{this.addHandles(Y((()=>[i.title,i.state]),(()=>this.scheduleRender()),J),r)})),this.scheduleRender()}_setupFeatureElementInfo(){var i;const{headingLevel:r,visibleElements:o}=this,a=o.description&&this.description,_=o.title&&this.title;null==(i=this._featureElementInfo)||i.set({description:a,title:_,headingLevel:r})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:i,showAllEnabled:r}=this.viewModel;await ct(0),this._relatedFeatureIntersectionObserverNode&&"ready"===i&&r&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(i){this._relatedFeatureIntersectionObserverNode=i}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};z([W()],vn.prototype,"_relatedFeatureIntersectionObserverNode",void 0),z([W({readOnly:!0})],vn.prototype,"displayShowAllButton",null),z([W({readOnly:!0})],vn.prototype,"displayListItems",null),z([W()],vn.prototype,"description",null),z([W({readOnly:!0})],vn.prototype,"featureCountDescription",null),z([W()],vn.prototype,"headingLevel",void 0),z([W()],vn.prototype,"title",null),z([W({type:un})],vn.prototype,"viewModel",void 0),z([W(),be("esri/widgets/Feature/t9n/Feature")],vn.prototype,"messages",void 0),z([W(),be("esri/t9n/common")],vn.prototype,"messagesCommon",void 0),z([W()],vn.prototype,"visibleElements",void 0),z([H("visibleElements")],vn.prototype,"castVisibleElements",null),vn=z([X("esri.widgets.Feature.FeatureRelationship")],vn);const fn=vn;var gn;const yn="content-view-models",_n="relationship-view-models",wn={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let bn=gn=class extends(at(G)){constructor(i){super(i),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=e$a(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...wn},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=i=>{const{abilities:r}=this;return"attachments"===i.type&&!!r.attachmentsContent||"custom"===i.type&&!!r.customContent||"fields"===i.type&&!!r.fieldsContent||"media"===i.type&&!!r.mediaContent||"text"===i.type&&!!r.textContent||"expression"===i.type&&!!r.expressionContent||"relationship"===i.type&&!!r.relationshipContent},this.addHandles(Y((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),J))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function re(i,r){const o=new Map;if(!i)return o;for(const a of i){if(!a.fieldName)continue;const i=q$1(a.fieldName,r);a.fieldName=i,o.set(i.toLowerCase(),a)}return o}(ie(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return L$2(this.graphic)}castAbilities(i){return{...wn,...i}}get isTable(){var i;return(null==(i=this._sourceLayer)?void 0:i.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(i){this._set("graphic",(null==i?void 0:i.clone())??null)}get spatialReference(){var i;return(null==(i=this.view)?void 0:i.spatialReference)??null}set spatialReference(i){this._override("spatialReference",i)}get timeZone(){var i;return(null==(i=this.view)?void 0:i.timeZone)??ht}set timeZone(i){this._overrideIfSome("timeZone",i)}get map(){var i;return(null==(i=this.view)?void 0:i.map)||null}set map(i){this._override("map",i)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(i,r){const o=this.contentViewModels[i];o instanceof Zi&&o.setActiveMedia(r)}nextMedia(i){const r=this.contentViewModels[i];r instanceof Zi&&r.next()}previousMedia(i){const r=this.contentViewModels[i];r instanceof Zi&&r.previous()}async updateGeometry(){var i;const{graphic:r,spatialReference:o,_sourceLayer:a}=this;await(null==a?void 0:a.load());const _=null==a?void 0:a.objectIdField;if(!_||!r||!a)return;const b=null==(i=null==r?void 0:r.attributes)?void 0:i[_];if(null==b)return;const I=[b];if(!r.geometry){const i=await se({layer:a,graphic:r,outFields:[],objectIds:I,returnGeometry:!0,spatialReference:o}),_=null==i?void 0:i.geometry;_&&(r.geometry=_)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:i}=this;if(!i)return;const r=new AbortController;this._featureAbortController=r;try{await this._queryFeature({signal:r.signal})}catch(o){pt(o)||(this._error=o,I.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:o,graphic:i,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===r&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:i}=this;i&&i.abort(),this._featureAbortController=null}_compileContentElement(i,r){return"attachments"===i.type?this._compileAttachments(i,r):"custom"===i.type?this._compileCustom(i,r):"fields"===i.type?this._compileFields(i,r):"media"===i.type?this._compileMedia(i,r):"text"===i.type?this._compileText(i,r):"expression"===i.type?this._compileExpression(i,r):"relationship"===i.type?this._compileRelationship(i,r):void 0}_compileContent(i){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(i)?i.filter(this._isAllowedContentType).map(((i,r)=>this._compileContentElement(i,r))).filter(Xe):"string"==typeof i?this._compileText(new nt({text:i}),0).text:i}_destroyContentViewModels(){this.removeHandles(_n),this.removeHandles(yn),this.contentViewModels.forEach((i=>i&&!i.destroyed&&i.destroy())),this._set("contentViewModels",[])}_matchesFeature(i,r){var o;const a=null==(o=null==i?void 0:i.graphic)?void 0:o.getObjectId(),_=null==r?void 0:r.getObjectId();return null!=a&&null!=_&&a===_}_setRelatedFeaturesViewModels({relatedFeatureViewModels:i,relatedFeatures:r,map:o}){const{view:a,spatialReference:_,timeZone:b}=this;null==r||r.filter(Boolean).forEach((r=>{i.some((i=>this._matchesFeature(i,r)))||i.add(new gn({abilities:{relationshipContent:!1},map:o,view:a,spatialReference:_,timeZone:b,graphic:r}))})),i.forEach((o=>{(null==r?void 0:r.find((i=>this._matchesFeature(o,i))))||i.remove(o)}))}_setExpressionContentVM(i,r){const o=this.formattedAttributes,{contentElement:a,contentElementViewModel:_}=i,b=null==a?void 0:a.type;_&&b&&("fields"===b&&(this._createFieldsFormattedAttributes({contentElement:a,contentElementIndex:r,formattedAttributes:o}),_.set(this._createFieldsVMParams(a,r))),"media"===b&&(this._createMediaFormattedAttributes({contentElement:a,contentElementIndex:r,formattedAttributes:o}),_.set(this._createMediaVMParams(a,r))),"text"===b&&_.set(this._createTextVMParams(a)))}_compileRelationship(i,r){const{displayCount:o,orderByFields:a,relationshipId:_,title:b,description:I}=i,{_sourceLayer:A,graphic:x,map:L}=this;if(!J$1(A))return;const k=new un({displayCount:o,graphic:x,orderByFields:a,relationshipId:_,layer:A,map:L,...this._compileTitleAndDesc({title:b,description:I})});return this.contentViewModels[r]=k,this.addHandles(Ie((()=>k.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(k))),_n),i}_compileExpression(i,r){const{expressionInfo:o}=i,{graphic:a,map:_,spatialReference:b,view:I,location:A}=this,x=new tn({expressionInfo:o,graphic:a,interceptor:gn.interceptor,map:_,spatialReference:b,view:I,location:A});return this.contentViewModels[r]=x,this.addHandles(Y((()=>x.contentElementViewModel),(()=>this._setExpressionContentVM(x,r)),J),yn),i}_compileAttachments(i,r){const{graphic:o}=this,{description:a,title:_}=i;return this.contentViewModels[r]=new _i({graphic:o,...this._compileTitleAndDesc({title:_,description:a})}),i}_compileCustom(i,r){const{graphic:o}=this,{creator:a,destroyer:_}=i;return this.contentViewModels[r]=new xi({graphic:o,creator:a,destroyer:_}),i}_compileTitleAndDesc({title:i,description:r}){const{_fieldInfoMap:o,_sourceLayer:a,graphic:_,formattedAttributes:b}=this,I=null==_?void 0:_.attributes,A=this._expressionAttributes,x=b.global;return{title:D({attributes:I,fieldInfoMap:o,globalAttributes:x,expressionAttributes:A,layer:a,text:i}),description:D({attributes:I,fieldInfoMap:o,globalAttributes:x,expressionAttributes:A,layer:a,text:r})}}_createFieldsVMParams(i,r){const o=this._effectivePopupTemplate,a=this.formattedAttributes,_={...null==a?void 0:a.global,...null==a?void 0:a.content[r]},b=(null==i?void 0:i.fieldInfos)||(null==o?void 0:o.fieldInfos),I=null==b?void 0:b.filter((({fieldName:i})=>!!i&&(x$3(i)||de(i)||_.hasOwnProperty(i)))),A=null==o?void 0:o.expressionInfos,{description:x,title:L}=i;return{attributes:_,expressionInfos:A,fieldInfos:I,...this._compileTitleAndDesc({title:L,description:x})}}_compileFields(i,r){const o=i.clone(),a=new Pi(this._createFieldsVMParams(i,r));return this.contentViewModels[r]=a,o.fieldInfos=a.formattedFieldInfos.slice(0),o}_createMediaVMParams(i,r){const{abilities:o,graphic:a,_fieldInfoMap:_,_effectivePopupTemplate:b,relatedInfos:I,_sourceLayer:A,_expressionAttributes:x}=this,L=this.formattedAttributes,k=(null==a?void 0:a.attributes)??{},{description:O,mediaInfos:B,title:z}=i;return{abilities:{chartAnimation:o.chartAnimation},activeMediaInfoIndex:i.activeMediaInfoIndex||0,attributes:k,isAggregate:null==a?void 0:a.isAggregate,layer:A,fieldInfoMap:_,formattedAttributes:{...null==L?void 0:L.global,...null==L?void 0:L.content[r]},expressionAttributes:x,mediaInfos:B,popupTemplate:b,relatedInfos:I,...this._compileTitleAndDesc({title:z,description:O})}}_compileMedia(i,r){const o=i.clone(),a=new Zi(this._createMediaVMParams(i,r));return o.mediaInfos=a.formattedMediaInfos.slice(0),this.contentViewModels[r]=a,o}_createTextVMParams(i){var r;const{graphic:o,_fieldInfoMap:a,_sourceLayer:_,_expressionAttributes:b}=this;if(i&&i.text){const I=(null==o?void 0:o.attributes)??{},A=(null==(r=this.formattedAttributes)?void 0:r.global)??{};i.text=D({attributes:I,fieldInfoMap:a,globalAttributes:A,expressionAttributes:b,layer:_,text:i.text})}return{graphic:o,creator:i.text}}_compileText(i,r){const o=i.clone();return this.contentViewModels[r]=new xi(this._createTextVMParams(o)),o}_compileLastEditInfo(){const{_effectivePopupTemplate:i,_sourceLayer:r,graphic:_,timeZone:b}=this;if(!i)return;const{lastEditInfoEnabled:I}=i,A=null==r?void 0:r.editFieldsInfo;return I&&A?function ne(i,r,_,b){const{creatorField:I,creationDateField:A,editorField:x,editDateField:L}=i;if(!r)return;const k=o(b&&"preferredTimeZone"in b?b.preferredTimeZone:null,!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone),_,ti,"date"),O={...ti,...k},B=r[L];if("number"==typeof B){const i=r[x];return{type:"edit",date:a(B,O),user:i}}const z=r[A];if("number"==typeof z){const i=r[I];return{type:"create",date:a(z,O),user:i}}return null}(A,null==_?void 0:_.attributes,b,r):void 0}_compileTitle(i){var r;const{_fieldInfoMap:o,_sourceLayer:a,graphic:_,_expressionAttributes:b}=this;return D({attributes:(null==_?void 0:_.attributes)??{},fieldInfoMap:o,globalAttributes:(null==(r=this.formattedAttributes)?void 0:r.global)??{},expressionAttributes:b,layer:a,text:i})}async _getTitle(){const{_effectivePopupTemplate:i,graphic:r}=this;return r?E$2({type:"title",value:null==i?void 0:i.title,event:{graphic:r}}):null}async _getContent(){const{_effectivePopupTemplate:i,graphic:r}=this;return r?E$2({type:"content",value:null==i?void 0:i.content,event:{graphic:r}}):null}async _queryFeature(i){const{_featureAbortController:r,_sourceLayer:o,graphic:a,_effectivePopupTemplate:_}=this,b=this.map,I=this.view,A=this.spatialReference,x=this.location;if(r!==this._featureAbortController||!a)return;await ce({graphic:a,popupTemplate:_,layer:o,spatialReference:A},i);const{content:{value:L},title:{value:k}}=await ze({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:O}}=await ze({checkForRelatedFeatures:this._checkForRelatedFeatures(i),expressionAttributes:m$3({expressionInfos:null==_?void 0:_.expressionInfos,spatialReference:A,graphic:a,map:b,interceptor:gn.interceptor,view:I,options:i,location:x})});r===this._featureAbortController&&a&&(this._expressionAttributes=O,this._graphicExpressionAttributes={...a.attributes,...O},this._set("formattedAttributes",this._createFormattedAttributes(L)),this._set("title",this._compileTitle(k)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(L)||null))}_createMediaFormattedAttributes({contentElement:i,contentElementIndex:r,formattedAttributes:o}){const{_effectivePopupTemplate:a,graphic:_,relatedInfos:b,_sourceLayer:I,_fieldInfoMap:A,_graphicExpressionAttributes:x,timeZone:L}=this;o.content[r]=ue({fieldInfos:null==a?void 0:a.fieldInfos,graphic:_,attributes:{...x,...i.attributes},layer:I,fieldInfoMap:A,relatedInfos:b,timeZone:L})}_createFieldsFormattedAttributes({contentElement:i,contentElementIndex:r,formattedAttributes:o}){if(i.fieldInfos){const{graphic:a,relatedInfos:_,_sourceLayer:b,_fieldInfoMap:I,_graphicExpressionAttributes:A,timeZone:x}=this;o.content[r]=ue({fieldInfos:i.fieldInfos,graphic:a,attributes:{...A,...i.attributes},layer:b,fieldInfoMap:I,relatedInfos:_,timeZone:x})}}_createFormattedAttributes(i){const{_effectivePopupTemplate:r,graphic:o,relatedInfos:a,_sourceLayer:_,_fieldInfoMap:b,_graphicExpressionAttributes:I,timeZone:A}=this,x={global:ue({fieldInfos:null==r?void 0:r.fieldInfos,graphic:o,attributes:I,layer:_,fieldInfoMap:b,relatedInfos:a,timeZone:A}),content:[]};return Array.isArray(i)&&i.forEach(((i,r)=>{"fields"===i.type&&this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:r,formattedAttributes:x}),"media"===i.type&&this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:r,formattedAttributes:x})})),x}_checkForRelatedFeatures(i){const{graphic:r,_effectivePopupTemplate:o}=this;return this._queryRelatedInfos(r,ie(o),i)}async _queryRelatedInfos(i,r,o){const{relatedInfos:a,_sourceLayer:_}=this;a.clear();const b=null!=(null==_?void 0:_.associatedLayer)?await(null==_?void 0:_.associatedLayer.load(o)):_;if(!b||!i)return;const I=r.filter((i=>!!i.fieldName&&de(i.fieldName)));if(!(null==I?void 0:I.length))return;r.forEach((i=>this._configureRelatedInfo(i,b)));const A=await N({relatedInfos:a,layer:b},o);Object.keys(A).forEach((i=>{var r;const o=a.get(i.toString()),_=null==(r=A[i])?void 0:r.value;o&&_&&(o.layerInfo=_.data)}));const x=await function T$2({graphic:i,relatedInfos:r,layer:o},a){const _={};return r.forEach(((r,b)=>{r.layerInfo&&(_[b]=U$1(i,r,o,a))})),ze(_)}({graphic:i,relatedInfos:a,layer:b},o);Object.keys(x).forEach((i=>{var r;!function I$3(i,r){if(!r)return;if(!i)return;const{features:o,statsFeatures:a}=i,_=null==o?void 0:o.value;r.relatedFeatures=_?_.features:[];const b=null==a?void 0:a.value;r.relatedStatsFeatures=b?b.features:[]}(null==(r=x[i])?void 0:r.value,a.get(i.toString()))}))}_configureRelatedInfo(i,r){const{relatedInfos:o}=this,a=y$4(i.fieldName||"");if(!a)return;const{layerId:_,fieldName:b}=a;if(!_)return;const I=o.get(_.toString())||F$3(_,r);I&&(function q({relatedInfo:i,fieldName:r,fieldInfo:o}){var a,_;if(null==(a=i.relatedFields)||a.push(r),o.statisticType){const a=new We({statisticType:o.statisticType,onStatisticField:r,outStatisticFieldName:r});null==(_=i.outStatistics)||_.push(a)}}({relatedInfo:I,fieldName:b,fieldInfo:i}),this.relatedInfos.set(_,I))}};bn.interceptor=new class e{constructor(i,r){this.preLayerQueryCallback=i,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}}((({query:i,layer:r,method:o})=>{he({layer:r,method:o,query:i,definitionExpression:`${r.definitionExpression} ${r.serviceDefinitionExpression??""}`})}),(({queryPayload:i,layer:r,method:o})=>{he({layer:r,method:o,query:i,definitionExpression:`${r.definitionExpression} ${r.serviceDefinitionExpression??""}`})})),z([W()],bn.prototype,"_error",void 0),z([W()],bn.prototype,"_featureAbortController",void 0),z([W({readOnly:!0})],bn.prototype,"_effectivePopupTemplate",null),z([W({readOnly:!0})],bn.prototype,"_fieldInfoMap",null),z([W({readOnly:!0})],bn.prototype,"_sourceLayer",null),z([W()],bn.prototype,"abilities",void 0),z([H("abilities")],bn.prototype,"castAbilities",null),z([W({readOnly:!0})],bn.prototype,"content",void 0),z([W({readOnly:!0})],bn.prototype,"contentViewModels",void 0),z([W()],bn.prototype,"description",void 0),z([W({type:Boolean})],bn.prototype,"defaultPopupTemplateEnabled",void 0),z([W({readOnly:!0})],bn.prototype,"isTable",null),z([W({readOnly:!0})],bn.prototype,"state",null),z([W({readOnly:!0})],bn.prototype,"formattedAttributes",void 0),z([W({type:U,value:null})],bn.prototype,"graphic",null),z([W({readOnly:!0})],bn.prototype,"lastEditInfo",void 0),z([W({type:tt})],bn.prototype,"location",void 0),z([W({readOnly:!0})],bn.prototype,"relatedInfos",void 0),z([W()],bn.prototype,"spatialReference",null),z([W()],bn.prototype,"timeZone",null),z([W({readOnly:!0})],bn.prototype,"title",void 0),z([W()],bn.prototype,"map",null),z([W({readOnly:!0})],bn.prototype,"waitingForContent",null),z([W()],bn.prototype,"view",void 0),bn=gn=z([X("esri.widgets.Feature.FeatureViewModel")],bn);const Mn=bn,In="esri-feature",Fn={base:In,container:`${In}__size-container`,title:`${In}__title`,main:`${In}__main-container`,btn:`${In}__button`,icon:`${In}__icon`,content:`${In}__content`,contentNode:`${In}__content-node`,contentNodeText:`${In}__content-node--text`,contentElement:`${In}__content-element`,text:`${In}__text`,lastEditedInfo:`${In}__last-edited-info`,fields:`${In}__fields`,fieldHeader:`${In}__field-header`,fieldData:`${In}__field-data`,fieldDataDate:`${In}__field-data--date`,loadingSpinnerContainer:`${In}__loading-container`},n$3=i=>{let r=class extends i{constructor(){super(...arguments),this.renderNodeContent=i=>e$5(i)&&!i.destroyed?Ee("div",{class:Fn.contentNode,key:i},i.render()):i instanceof HTMLElement?Ee("div",{afterCreate:this._attachToNode,bind:i,class:Fn.contentNode,key:i}):function t$6(i){return i&&"function"==typeof i.postMixInProperties&&"function"==typeof i.buildRendering&&"function"==typeof i.postCreate&&"function"==typeof i.startup}(i)?Ee("div",{afterCreate:this._attachToNode,bind:i.domNode,class:Fn.contentNode,key:i}):null}_attachToNode(i){i.appendChild(this)}};return r=z([X("esri.widgets.Feature.support.FeatureContentMixin")],r),r};var An;const Cn={title:!0,content:!0,lastEditedInfo:!0},En="relationship-handles";let xn=An=class extends(n$3(Me)){constructor(i,r){super(i,r),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Cn},this.viewModel=new Mn}initialize(){this.addHandles(Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.contentViewModels}),(()=>this._setupContentWidgets()),J))}loadDependencies(){return Ae({notice:()=>Ce((()=>import("./calcite-notice-B5LcMWxf.js")),__vite__mapDeps([37,2,3,38,6,4,5,26,27,28,39,33,1])),loader:()=>Ce((()=>import("./calcite-loader-CKsSCnMM.js")),__vite__mapDeps([20,21,2,3,5]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(i){this.viewModel.graphic=i}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(i){this.viewModel.defaultPopupTemplateEnabled=i}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(i){this._overrideIfSome("icon",i)}get label(){var i;return(null==(i=this.messages)?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(i){this.viewModel.spatialReference=i}get timeZone(){return this.viewModel.timeZone}set timeZone(i){this.viewModel.timeZone=i}get title(){return this.viewModel.title}castVisibleElements(i){return{...Cn,...i}}get map(){return this.viewModel.map}set map(i){this.viewModel.map=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}setActiveMedia(i,r){return this.viewModel.setActiveMedia(i,r)}nextMedia(i){return this.viewModel.nextMedia(i)}previousMedia(i){return this.viewModel.previousMedia(i)}render(){const{state:i}=this.viewModel,r=Ee("div",{class:Fn.container,key:"container"},this._renderTitle(),"error"===i?this._renderError():"loading"===i?this._renderLoading():this._renderContentContainer());return Ee("div",{class:this.classes(Fn.base,xe.widget)},r)}_renderError(){const{messagesCommon:i,messages:r,visibleElements:o}=this;return Ee("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},o.title?Ee("div",{key:"error-title",slot:"title"},i.errorMessage):null,Ee("div",{key:"error-message",slot:"message"},r.loadingError))}_renderLoading(){return Ee("div",{class:Fn.loadingSpinnerContainer,key:"loading-container"},Ee("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:i}=this;return i.content?Ee("div",{class:Fn.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:i,title:r}=this;return i.title?Ee(e$7,{class:Fn.title,innerHTML:r,level:this.headingLevel}):null}_renderContent(){const i=this.viewModel.content,r="content";if(!i)return null;if(Array.isArray(i))return i.length?Ee("div",{class:Fn.contentNode,key:`${r}-content-elements`},i.map(this._renderContentElement,this)):null;if("string"==typeof i){const i=this._contentWidgets[0];return!i||i.destroyed?null:Ee("div",{class:this.classes(Fn.contentNode,Fn.contentNodeText),key:`${r}-content`},i.render())}return this.renderNodeContent(i)}_renderContentElement(i,r){var o;const{visibleElements:a}=this;if("boolean"!=typeof a.content&&!(null==(o=a.content)?void 0:o[i.type]))return null;switch(i.type){case"attachments":return this._renderAttachments(r);case"custom":return this._renderCustom(i,r);case"fields":return this._renderFields(r);case"media":return this._renderMedia(r);case"text":return this._renderText(i,r);case"expression":return this._renderExpression(r);case"relationship":return this._renderRelationship(r);default:return null}}_renderAttachments(i){const r=this._contentWidgets[i];if(!r||r.destroyed)return null;const{state:o,attachmentInfos:a}=r.viewModel;return"loading"===o||a.length>0?Ee("div",{class:this.classes(Fn.contentElement),key:this._buildKey("attachments-element",i)},r.render()):null}_renderRelationship(i){const r=this._contentWidgets[i];return r&&!r.destroyed&&this.flowItems?Ee("div",{class:Fn.contentElement,key:this._buildKey("relationship-element",i)},r.render()):null}_renderExpression(i){const r=this._contentWidgets[i];return!r||r.destroyed?null:Ee("div",{class:Fn.contentElement,key:this._buildKey("expression-element",i)},r.render())}_renderCustom(i,r){const{creator:o}=i,a=this._contentWidgets[r];return!a||a.destroyed?null:o?Ee("div",{class:Fn.contentElement,key:this._buildKey("custom-element",r)},a.render()):null}_renderFields(i){const r=this._contentWidgets[i];return!r||r.destroyed?null:Ee("div",{class:Fn.contentElement,key:this._buildKey("fields-element",i)},r.render())}_renderMedia(i){const r=this._contentWidgets[i];return!r||r.destroyed?null:Ee("div",{class:Fn.contentElement,key:this._buildKey("media-element",i)},r.render())}_renderLastEditInfo(){const{visibleElements:i,messages:r}=this,{lastEditInfo:o}=this.viewModel;if(!o||!i.lastEditedInfo)return null;const{date:a,user:_}=o,b="edit"===o.type?_?r.lastEditedByUser:r.lastEdited:_?r.lastCreatedByUser:r.lastCreated,I=Dt(b,{date:a,user:_});return Ee("div",{class:this.classes(Fn.lastEditedInfo,Fn.contentElement),key:"edit-info-element"},I)}_renderText(i,r){const o=i.text,a=this._contentWidgets[r];return!a||a.destroyed?null:o?Ee("div",{class:this.classes(Fn.contentElement,Fn.text),key:this._buildKey("text-element",r)},a.render()):null}_buildKey(i,...r){var o,a;return`${i}__${(null==(a=null==(o=this.viewModel)?void 0:o.graphic)?void 0:a.uid)||"0"}-${r.join("-")}`}_destroyContentWidget(i){i&&(i.viewModel=null,!i.destroyed&&i.destroy())}_destroyContentWidgets(){this.removeHandles(En),this._contentWidgets.forEach((i=>this._destroyContentWidget(i))),this._contentWidgets=[]}_addFeatureRelationshipHandles(i){const{flowItems:r,visibleElements:o}=this;this.addHandles([Ie((()=>i),"select-record",(({featureViewModel:i})=>{r&&(i.abilities={relationshipContent:!0},r.push(new An({flowItems:r,viewModel:i,visibleElements:o})))})),Ie((()=>i),"show-all-records",(()=>{if(!r)return;const{viewModel:o}=i;o.showAllEnabled=!0;const a=new fn({visibleElements:{title:!1,description:!1},viewModel:o});this._addFeatureRelationshipHandles(a),r.push(a)}))],En)}_setupContentWidgets(){var i;this._destroyContentWidgets();const{headingLevel:r,visibleElements:o}=this,a=null==(i=this.viewModel)?void 0:i.content,{contentViewModels:_}=this.viewModel;if(Array.isArray(a))a.forEach(((i,a)=>{if("attachments"===i.type&&(this._contentWidgets[a]=new Ci({displayType:i.displayType,headingLevel:o.title&&r<6?r+1:r,viewModel:_[a]})),"fields"===i.type&&(this._contentWidgets[a]=new Di({viewModel:_[a]})),"media"===i.type&&(this._contentWidgets[a]=new Ki({viewModel:_[a]})),"text"===i.type&&(this._contentWidgets[a]=new Ri({viewModel:_[a]})),"custom"===i.type&&(this._contentWidgets[a]=new Ri({viewModel:_[a]})),"expression"===i.type&&(this._contentWidgets[a]=new on({viewModel:_[a]})),"relationship"===i.type){const i=new fn({viewModel:_[a]});this._addFeatureRelationshipHandles(i),this._contentWidgets[a]=i}}),this);else{const i=_[0];i&&!i.destroyed&&(this._contentWidgets[0]=new Ri({viewModel:i}))}this.scheduleRender()}};z([W()],xn.prototype,"graphic",null),z([W()],xn.prototype,"defaultPopupTemplateEnabled",null),z([W()],xn.prototype,"flowItems",void 0),z([W()],xn.prototype,"headingLevel",void 0),z([W({readOnly:!0})],xn.prototype,"isTable",null),z([W()],xn.prototype,"icon",null),z([W()],xn.prototype,"label",null),z([W(),be("esri/widgets/Feature/t9n/Feature")],xn.prototype,"messages",void 0),z([W(),be("esri/t9n/common")],xn.prototype,"messagesCommon",void 0),z([W()],xn.prototype,"spatialReference",null),z([W()],xn.prototype,"timeZone",null),z([W({readOnly:!0})],xn.prototype,"title",null),z([W()],xn.prototype,"visibleElements",void 0),z([H("visibleElements")],xn.prototype,"castVisibleElements",null),z([W()],xn.prototype,"map",null),z([W()],xn.prototype,"view",null),z([W({type:Mn})],xn.prototype,"viewModel",void 0),xn=An=z([X("esri.widgets.Feature")],xn);const Tn=xn;let $n=class c4 extends mt.EventedAccessor{constructor(i){super(i),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([vt((()=>{const i=this.screenLocationEnabled?this.view:null;return i?[i.size,"3d"===i.type?i.camera:i.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),Y((()=>this.screenLocation),((i,r)=>{null!=i&&null!=r&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:i,view:r,screenLocationEnabled:o}=this,a=null==r?void 0:r.spatialReference,_=a?ft(i,a).geometry:null;return o&&_&&(null==r?void 0:r.ready)?r.toScreen(_):null}};z([W()],$n.prototype,"location",void 0),z([W()],$n.prototype,"screenLocation",null),z([W()],$n.prototype,"screenLocationEnabled",void 0),z([W()],$n.prototype,"view",void 0),$n=z([X("esri.widgets.support.AnchorElementViewModel")],$n);const Ln=$n;let Rn=class t extends Ln{constructor(i){super(i),this.visible=!1}};z([W()],Rn.prototype,"visible",void 0),Rn=z([X("esri.widgets.Spinner.SpinnerViewModel")],Rn);const kn=Rn,Pn="esri-spinner",On=Pn,Nn=`${Pn}--start`,Vn=`${Pn}--finish`;let Sn=class p extends Me{constructor(i,r){super(i,r),this._animationDelay=500,this._animationPromise=null,this.viewModel=new kn}initialize(){this.addHandles(Y((()=>this.visible),(i=>this._visibleChange(i))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(i){this.viewModel.location=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}get visible(){return this.viewModel.visible}set visible(i){this.viewModel.visible=i}show(i){const{location:r,promise:o}=i??{};r&&(this.viewModel.location=r),this.visible=!0;o&&o.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:i}=this,{screenLocation:r}=this.viewModel,o=!!r,a=i&&o,_=!i&&o,b={[Nn]:a,[Vn]:_},I=this._getPositionStyles();return Ee("div",{class:this.classes(On,b),styles:I})}_visibleChange(i){if(i)return void(this.viewModel.screenLocationEnabled=!0);const r=ct(this._animationDelay);this._animationPromise=r,r.catch((()=>{})).then((()=>{this._animationPromise===r&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:i,view:r}=this.viewModel;if(null==r||null==i)return{};const{padding:o}=r;return{left:i.x-o.left+"px",top:i.y-o.top+"px"}}};z([W()],Sn.prototype,"location",null),z([W()],Sn.prototype,"view",null),z([W({type:kn})],Sn.prototype,"viewModel",void 0),z([W()],Sn.prototype,"visible",null),Sn=z([X("esri.widgets.Spinner")],Sn);const Dn=Sn,Bn="esri-features",jn={icon:`${Bn}__icon`,actionImage:`${Bn}__action-image`,base:Bn,container:`${Bn}__container`,contentContainer:`${Bn}__content-container`,contentFeature:`${Bn}__content-feature`,flowItemCollapsed:`${Bn}__flow-item--collapsed`,header:`${Bn}__header`,footer:`${Bn}__footer`,featureMenuObserver:`${Bn}__feature-menu-observer`,actionExit:`${Bn}__action--exit`,loader:`${Bn}__loader`,featuresHeading:`${Bn}__heading`,paginationActionBar:`${Bn}__pagination-action-bar`,paginationPrevious:`${Bn}__pagination-previous`,paginationNext:`${Bn}__pagination-next`};let qn=class n extends Me{constructor(i,r){super(i,r),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=i=>{this.emit("open-related-feature",{feature:i})}}loadDependencies(){return Ae({action:()=>Ce((()=>import("./calcite-action-Dt6-g_b1.js")),__vite__mapDeps([40,36,2,3,4,5,23,26,27,28,6,33,1,21])),"flow-item":()=>Ce((()=>import("./calcite-flow-item-CyK_4Qbv.js")),__vite__mapDeps([41,2,3,4,5,23,26,27,28,6,42,36,33,1,21,43,29,44,39,34]))})}render(){const{flowItems:i}=this,r=null==i?void 0:i.toArray();return Ee(gt,null,null==r?void 0:r.map((i=>this._renderRelatedRecordsFlowItem(i))))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var i;const r=null==(i=this.flowItems)?void 0:i.pop();r&&("showAllEnabled"in r.viewModel&&(r.viewModel.showAllEnabled=!1),r&&(r.viewModel=null,r.destroy()))}_renderRelatedRecordsFlowItem(i){var r;const{messages:o,closable:a,closed:_}=this,b="graphic"in i&&!i.isTable&&(null==(r=i.graphic)?void 0:r.geometry),I=o.exitRelatedRecords,A=o.selectFeature;return Ee("calcite-flow-item",{bind:this,closable:a,closed:_,description:this._getRelatedRecordsFlowItemDescription(i),heading:i.title??"",key:`flow-item-${i.viewModel.uid}`,onCalciteFlowItemBack:i=>{i.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},Ee("calcite-action",{appearance:"transparent",bind:this,class:jn.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:I,title:I}),b?Ee("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(i),slot:"header-actions-end",text:A,title:A}):null,Ee("div",{class:jn.container},i.render()))}_getRelatedRecordsFlowItemDescription(i){return"featureCountDescription"in i?i.featureCountDescription:i.viewModel.description??""}};z([W()],qn.prototype,"flowItems",void 0),z([W(),be("esri/widgets/Features/t9n/Features")],qn.prototype,"messages",void 0),z([W()],qn.prototype,"closed",void 0),z([W()],qn.prototype,"closable",void 0),qn=z([X("esri.widgets.Features.FeaturesRelatedRecords")],qn);const zn=qn;var Wn,Hn;(Hn=Wn||(Wn={}))[Hn.size=22]="size",Hn[Hn.lineWidth=50]="lineWidth",Hn[Hn.maxSize=120]="maxSize",Hn[Hn.maxOutlineSize=80]="maxOutlineSize",Hn[Hn.tallSymbolWidth=20]="tallSymbolWidth";yt("android");function k$2(i){return i&&"opacity"in i?i.opacity*k$2(i.parent):1}async function L$1(i,r){var o;if(!i)return;const a=i.sourceLayer,_=(null!=r&&r.useSourceLayer?a:i.layer)??a,b=k$2(_);if(null!=i.symbol&&(null==r||!0!==r.ignoreGraphicSymbol)){const o="web-style"===i.symbol.type?await wt(i.symbol,{...r,cache:null!=r?r.webStyleCache:null}):i.symbol.clone();return bt(o,null,b),o}const I=(null==r?void 0:r.renderer)??function C(i){if(i)return"renderer"in i?i.renderer:void 0}(_);let A=I&&"getSymbolAsync"in I?await I.getSymbolAsync(i,r):null;if(!A)return;if(A="web-style"===A.type?await A.fetchSymbol({...r,cache:null!=r?r.webStyleCache:null}):A.clone(),!I||!("visualVariables"in I)||!(null==(o=I.visualVariables)?void 0:o.length))return bt(A,null,b),A;if("arcadeRequiredForVisualVariables"in I&&I.arcadeRequiredForVisualVariables&&null==(null==r?void 0:r.arcade)){const i={...r};i.arcade=await x(),r=i}const{getColor:L,getOpacity:k,getAllSizes:O,getRotationAngle:B}=await Ce((()=>import("./index-DSIPxOWi.js").then((i=>i.yD))),__vite__mapDeps([2,3])),z=[],W=[],H=[],U=[];for(const x of I.visualVariables)switch(x.type){case"color":z.push(x);break;case"opacity":W.push(x);break;case"rotation":U.push(x);break;case"size":x.target||H.push(x)}const X=!!z.length&&z[z.length-1],G=X?L(X,i,r):null,Y=!!W.length&&W[W.length-1];let J=Y?k(Y,i,r):null;if(null!=b&&(J=null!=J?J*b:b),bt(A,G,J),H.length){const o=O(H,i,r);await Mt(A,o)}for(const x of U)It(A,B(x,i,r),x.axis);return A}yt("chrome"),_t(),Wn.size,Wn.maxSize,Wn.maxOutlineSize,Wn.lineWidth,Wn.tallSymbolWidth;const Un=B.ofType({key:"type",defaultKeyValue:"button",base:Ft,typeMap:{button:At,toggle:Ct}}),Zn=new At({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:ci}),Qn=new At({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:ui}),Xn=new At({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ci}),Gn=new Ct({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:di,value:!1}),c5=()=>I.getLogger("esri.widgets.Popup.PopupViewModel"),u2=i=>{const{event:r,view:o,viewModel:a}=i,{action:_}=r;if(!_)return Promise.reject(new K("trigger-action:missing-arguments","Event has no action"));const{disabled:b,id:I}=_;if(!I)return Promise.reject(new K("trigger-action:invalid-action","action.id is missing"));if(b)return Promise.reject(new K("trigger-action:invalid-action","Action is disabled"));if(I===Zn.id)return async function w(i){var r;const{location:o,selectedFeature:a,view:_,zoomFactor:b}=i,I=l$1(i);if(!_||!I){const i=new K("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:I,view:_});throw c5().error(i),i}const A=_.scale/b,x=null==(r=i.selectedFeature)?void 0:r.geometry,L=x??o,k=null!=L&&"point"===L.type&&await async function g3(i,r){if("3d"!==(null==r?void 0:r.type)||!i||"esri.Graphic"!==i.declaredClass)return!0;const o=r.getViewForGraphic(i);if(o&&"whenGraphicBounds"in o){let r=null;try{r=await o.whenGraphicBounds(i,{useViewElevation:!0})}catch(a){}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}(a,_);Zn.active=!0,Zn.disabled=!0;try{await i.zoomTo({target:{target:I,scale:k?A:void 0}})}catch(O){const i=new K("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:a});c5().error(i)}finally{Zn.active=!1,Zn.disabled=!1,i.zoomToLocation=null,k&&(i.location=L)}}(a).catch(Et);if(I===Xn.id)return async function f(i){const{selectedFeature:r,view:o}=i;if("2d"!==(null==o?void 0:o.type)){const i=new K("zoomToCluster:invalid-view","View must be 2d MapView.",{view:o});throw c5().error(i),i}if(!r||!d(r)){const i=new K("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:r});throw c5().error(i),i}const[a,_]=await p$1(o,r);Xn.active=!0,Xn.disabled=!0;const{extent:b}=await a.queryExtent(_);b&&await i.zoomTo({target:b}),Xn.active=!1,Xn.disabled=!1}(a);if(I===Gn.id)return a.browseClusterEnabled=!a.browseClusterEnabled,a.featureMenuOpen=a.browseClusterEnabled,Promise.resolve();if(I===Qn.id){a.visible=!1;const{selectedFeature:i}=a;if(!i)return Promise.reject(new K(`trigger-action:${Qn.id}`,"selectedFeature is required",{selectedFeature:i}));const{sourceLayer:r}=i;return r?r.remove(i):null==o||o.graphics.remove(i),Promise.resolve()}return Promise.resolve()};function l$1(i){const{selectedFeature:r,location:o,view:a}=i;return a?r??o??null:null}function d(i){var r,o;return!!i&&i.isAggregate&&"cluster"===(null==(o=null==(r=i.sourceLayer)?void 0:r.featureReduction)?void 0:o.type)}async function p$1(i,r){const o=await i.whenLayerView(r.sourceLayer),a=o.createQuery(),_=r.getObjectId();return a.aggregateIds=null!=_?[_]:[],[o,a]}const Yn="location-scale-handle";let Jn=null;let Kn=class extends(xt(Ln)){constructor(i){super(i),this._pendingPromises=new Ht,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Un,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new U({symbol:new Tt({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=dt((async i=>{var r,o,a,_;const{spatialReference:b}=this,A=null==(o=null==(r=this.selectedFeature)?void 0:r.geometry)?void 0:o.type,x=this.location??i;if(A&&"mesh"!==A&&b&&x&&this.selectedFeature)if("point"!==A)try{const i=this.selectedFeature;let r=i.geometry;const o=this._getHighlightLayer(i),I=i.getObjectId();if(!o||!this.view)return;if(I){const i=null==(a=this.view)?void 0:a.allLayerViews.find((i=>i.layer.uid===o.uid));if(!i||!("queryFeatures"in i))return;const A=i.createQuery();A.outSpatialReference=b,A.objectIds=[I],A.returnGeometry=!0;const{features:x}=await i.queryFeatures(A);r=null==(_=x[0])?void 0:_.geometry}if(!r||"mesh"===r.type)return;if(r=$t(r,b),Jn||(Jn=await Ce((()=>import("./geometryEngineAsync--5NbEF1a.js")),__vite__mapDeps([45,2,3]))),!(await Jn.intersects(r,x))){const o=(await Jn.nearestCoordinate(r,x)).coordinate??x;this.selectedFeature===i&&(this.location=o)}}catch(L){pt(L)||I.getLogger(this).error(L)}else this.location=n$a(this.selectedFeature.geometry)??x}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),Y((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),Y((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),Y((()=>{var i,r;return null==(r=null==(i=this.view)?void 0:i.animation)?void 0:r.state}),(i=>this._animationStateChange(i))),Y((()=>this.location),(i=>this._locationChange(i))),Y((()=>this.selectedFeature),(i=>this._selectedFeatureChange(i))),Y((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),Y((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),Y((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(i=>u2({event:i,viewModel:this,view:this.view}))),vt((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),Lt),Y((()=>[this.features,this.map,this.spatialReference,this.timeZone]),(()=>this._updateFeatureVMs())),Y((()=>{var i;return null==(i=this.view)?void 0:i.scale}),(()=>this._viewScaleChange())),vt((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),Y((()=>this.browseClusterEnabled),(i=>i?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const i=this._get("allActions")||new Un;i.removeAll();const{actions:r,defaultActions:o,defaultPopupTemplateEnabled:a,includeDefaultActions:_,selectedFeature:b}=this,I=_?o.concat(r):r,A=b&&("function"==typeof b.getEffectivePopupTemplate&&b.getEffectivePopupTemplate(a)||b.popupTemplate),x=null==A?void 0:A.actions,L=(null==A?void 0:A.overwriteActions)?x:(null==x?void 0:x.concat(I))??I;return null==L||L.filter(Boolean).forEach((r=>i.add(r))),i}get defaultActions(){const i=this._get("defaultActions")||new Un;return i.removeAll(),i.addMany(d(this.selectedFeature)?[Xn.clone(),Gn.clone()]:[Zn.clone()]),i}get featureCount(){return this.features.length}set features(i){const r=i||[];this._set("features",r);const{pendingPromisesCount:o,promiseCount:a,selectedFeatureIndex:_}=this,b=a&&r.length;b&&o&&-1===_?this.selectedFeatureIndex=0:b&&-1!==_||(this.selectedFeatureIndex=r.length?0:-1)}set location(i){var r,o;let a=i;const _=null==(r=this.spatialReference)?void 0:r.isWebMercator;(null==(o=null==i?void 0:i.spatialReference)?void 0:o.isWGS84)&&_&&(a=Rt(i)),this._set("location",a)}get map(){var i;return(null==(i=this.view)?void 0:i.map)??null}set map(i){this._override("map",i)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(i){this._pendingPromises.clear(),this.features=[],Array.isArray(i)&&i.length?(this._set("promises",i),(i=i.slice(0)).forEach((i=>this._pendingPromises.add(i))),i.reduce(((i,r)=>i.finally((()=>r.then((i=>{this._pendingPromises.has(r)&&this._updateFeatures(i)})).finally((()=>this._pendingPromises.delete(r))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:i,selectedFeatureIndex:r}=this;return-1===r?null:i[r]||null}get selectedFeatureIndex(){const i=this._get("selectedFeatureIndex");return"number"==typeof i?i:-1}set selectedFeatureIndex(i){const{featureCount:r}=this;i=isNaN(i)||i<-1||!r?-1:(i+r)%r,this.activeFeature=null,this._set("selectedFeatureIndex",i)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var i;return(null==(i=this.view)?void 0:i.spatialReference)??null}set spatialReference(i){this._override("spatialReference",i)}get state(){const{view:i,map:r}=this;return i?i.ready?"ready":"disabled":r?"ready":"disabled"}get timeZone(){var i;return(null==(i=this.view)?void 0:i.timeZone)??ht}set timeZone(i){this._overrideIfSome("timeZone",i)}get waitingForContents(){return this.featureViewModels.some((i=>i.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:i}=this,r=l$1(this);return r&&i?this.callGoTo({target:{target:r,scale:i.scale}}):Promise.reject(new K("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:r,view:i}))}zoomTo(i){return this.callGoTo(i)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(i,r){var o;const{view:a}=this;if(!a||!i)throw new K("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:i,view:a});return a.fetchPopupFeatures(i,{pointerType:null==(o=null==r?void 0:r.event)?void 0:o.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null==r?void 0:r.signal})}open(i){const r={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...i,visible:!0},{fetchFeatures:o}=r;delete r.fetchFeatures,o&&this._setFetchFeaturesPromises(r.location);const a=["actionsMenuOpen","collapsed"];for(const _ of a)delete r[_];this.set(r)}triggerAction(i){const r=this.allActions.at(i);r&&!r.disabled&&this.emit("trigger-action",{action:r})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function y(i){Gn.value=!1;const r=i.features.filter((i=>d(i)));r.length&&(i.features=r)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:i,selectedFeature:r}=this;"2d"===(null==i?void 0:i.type)?d(r)?(await async function v2(i){const{view:r,selectedFeature:o}=i;if(!r||!o)return;const[a,_]=await p$1(r,o),{extent:b}=await a.queryExtent(_);i.selectedClusterBoundaryFeature.geometry=b,r.graphics.add(i.selectedClusterBoundaryFeature)}(this),await async function m(i){const{selectedFeature:r,view:o}=i;if(!o||!r)return;const[a,_]=await p$1(o,r);Gn.active=!0,Gn.disabled=!0;const{features:b}=await a.queryFeatures(_);Gn.active=!1,Gn.disabled=!1,Gn.value=!0,null==i||i.open({features:[r].concat(b),featureMenuOpen:!0})}(this)):I.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",r):I.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",r)}handleViewClick(i){this._fetchFeaturesAndOpen(i)}_animationStateChange(i){this.zoomToLocation||(Zn.disabled="waiting-for-target"===i)}_clearBrowsedClusterGraphics(){var i,r;const o=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Xe);null==(r=null==(i=this.view)?void 0:i.graphics)||r.removeMany(o),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(d(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(i){const{selectedFeature:r,updateLocationEnabled:o,view:a}=this;a&&o&&i&&(!r||r.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:i,featureCount:r,featurePage:o,featuresPerPage:a,featureViewModels:_}=this;if(null===o)return;const b=((o-1)*a+r)%r,I=b+a;_.slice(b,I).forEach(((r,o)=>{r&&(r.graphic??(r.graphic=i[b+o]))}))}async _selectedFeatureChange(i){var r,o;const{location:a,updateLocationEnabled:_,view:b}=this;if(!i||!b)return;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(b.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),d(i))return;return i.symbol=await L$1(i),this._selectedClusterFeature=i,void b.graphics.add(this._selectedClusterFeature)}const I=null==(r=i.sourceLayer)?void 0:r.type;if("map-image"!==I&&"imagery"!==I&&"imagery-tile"!==I||(i.symbol=await L$1(i)),!_&&a||!i.geometry){if(_&&!i.geometry){await this.centerAtLocation();const i=null==(o=b.center)?void 0:o.clone();i&&(this.location=i)}}else this.location=n$a(i.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(i){const{pendingFeatures:r}=await this._fetchFeaturesWithController({mapPoint:i});this.promises=r}_destroyFeatureVMs(){this.featureViewModels.forEach((i=>i&&!i.destroyed&&i.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:i,features:r,featureViewModels:o,view:a,spatialReference:_,map:b,timeZone:I,location:A}=this;if(d(i)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!(null==r?void 0:r.length))return;const x=o.slice(0),L=[];r.forEach(((r,o)=>{if(!r)return;let k=null;if(x.some(((i,o)=>(i&&i.graphic===r&&(k=i,x.splice(o,1)),!!k))),k)L[o]=k;else{const x=new Mn({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:_,graphic:r===i?r:null,location:A,map:b,view:a,timeZone:I});L[o]=x}})),x.forEach((i=>i&&!i.destroyed&&i.destroy())),this._set("featureViewModels",L)}async _getScreenPoint(i,r){const{spatialReference:o,view:a}=this;if(!a)return null;await(null==a?void 0:a.when());const _=null==i?void 0:i.spatialReference;return _&&o?(await kt(_,o,null,r),a.toScreen(i)):null}_cancelFetchingFeatures(){const i=this._fetchFeaturesController;i&&i.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures({mapPoint:i,screenPoint:r,event:o,signal:a}){return this.fetchFeatures(r??await this._getScreenPoint(i??this.location,{signal:a}),{signal:a,event:o})}_fetchFeaturesWithController({mapPoint:i,screenPoint:r,event:o}){this._cancelFetchingFeatures();const a=new AbortController,{signal:_}=a;this._fetchFeaturesController=a;const b=this._projectScreenPointAndFetchFeatures({mapPoint:i,screenPoint:r,signal:_,event:o});return b.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),b}async _fetchFeaturesAndOpen(i){const{mapPoint:r,screenPoint:o}=i,{view:a}=this;this.removeHandles(Yn),this.addHandles([Y((()=>{var i;return null==(i=this.view)?void 0:i.scale}),(()=>this._debouncedLocationUpdate(r).catch((i=>{pt(i)||I.getLogger(this).error(i)})))),vt((()=>!this.visible),(()=>{this.removeHandles(Yn)}),{once:!0})],Yn);const{pendingFeatures:_}=await this._fetchFeaturesWithController({mapPoint:r,screenPoint:o,event:i});(null==a?void 0:a.popup)&&"open"in a.popup&&a.popup.open({location:r??void 0,promises:_})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(i,r){return await i.when(),i.whenLayerView(r)}_getHighlightLayer(i){const{layer:r,sourceLayer:o}=i;return o&&"layer"in o&&o.layer?o.layer:"map-notes"===(null==o?void 0:o.type)||"subtype-group"===(null==o?void 0:o.type)?o:r}_getHighlightTarget(i,r,o){if(function Z(i,r){return"building-scene"===i||"2d"===r&&("map-image"===i||"tile"===i||"imagery"===i||"imagery-tile"===i)}(r.type,o))return i;const a=i.getObjectId();if(null!=a)return a;const _="imagery"===r.type?void 0:"objectIdField"in r?r.objectIdField||Pt:null,b=i.attributes;return b&&_&&b[_]||i}_mapIncludesLayer(i){var r,o;return!!(null==(o=null==(r=this.map)?void 0:r.allLayers)?void 0:o.includes(i))}async _highlightActiveFeature(){const i="highlight-active-feature";this.removeHandles(i);const{highlightEnabled:r,view:o,activeFeature:a,visible:_}=this;if(!(a&&o&&r&&_))return;const b=this._getHighlightLayer(a);if(!(b&&b instanceof Ot&&this._mapIncludesLayer(b)))return;const I=this._getLayerView(o,b);this._highlightActiveFeaturePromise=I;const A=await I;if(!(A&&Nt(A)&&this._highlightActiveFeaturePromise===I&&this.activeFeature&&this.highlightEnabled))return;const x=A.highlight(this._getHighlightTarget(a,b,o.type));this.addHandles(x,i)}async _highlightSelectedFeature(){const i="highlight-selected-feature";this.removeHandles(i);const{selectedFeature:r,highlightEnabled:o,view:a,visible:_}=this;if(!(r&&a&&o&&_))return;const b=this._getHighlightLayer(r);if(!(b&&b instanceof Ot&&this._mapIncludesLayer(b)))return;const I=this._getLayerView(a,b);this._highlightSelectedFeaturePromise=I;const A=await I;if(!(A&&Nt(A)&&this._highlightSelectedFeaturePromise===I&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const x=A.highlight(this._getHighlightTarget(r,b,a.type));this.addHandles(x,i)}_updateFeatures(i){const{features:r}=this,o=i.filter((i=>!r.includes(i)));(null==o?void 0:o.length)&&(this.features=r.concat(o))}};z([W()],Kn.prototype,"_fetchFeaturesController",void 0),z([W({type:Un})],Kn.prototype,"actions",void 0),z([W({readOnly:!0})],Kn.prototype,"active",null),z([W()],Kn.prototype,"activeFeature",void 0),z([W({readOnly:!0})],Kn.prototype,"allActions",null),z([W()],Kn.prototype,"autoCloseEnabled",void 0),z([W()],Kn.prototype,"browseClusterEnabled",void 0),z([W()],Kn.prototype,"content",void 0),z([W({type:Un,readOnly:!0})],Kn.prototype,"defaultActions",null),z([W({type:Boolean})],Kn.prototype,"defaultPopupTemplateEnabled",void 0),z([W({readOnly:!0})],Kn.prototype,"featureCount",null),z([W()],Kn.prototype,"featurePage",void 0),z([W({value:[]})],Kn.prototype,"features",null),z([W()],Kn.prototype,"featuresPerPage",void 0),z([W()],Kn.prototype,"featureMenuOpen",void 0),z([W()],Kn.prototype,"featureViewModelAbilities",void 0),z([W({readOnly:!0})],Kn.prototype,"featureViewModels",void 0),z([W()],Kn.prototype,"highlightEnabled",void 0),z([W()],Kn.prototype,"includeDefaultActions",void 0),z([W({type:tt})],Kn.prototype,"location",null),z([W()],Kn.prototype,"map",null),z([W({readOnly:!0})],Kn.prototype,"pendingPromisesCount",null),z([W({readOnly:!0})],Kn.prototype,"promiseCount",null),z([W()],Kn.prototype,"promises",null),z([W({readOnly:!0})],Kn.prototype,"selectedClusterBoundaryFeature",void 0),z([W({value:null,readOnly:!0})],Kn.prototype,"selectedFeature",null),z([W({value:-1})],Kn.prototype,"selectedFeatureIndex",null),z([W({readOnly:!0})],Kn.prototype,"selectedFeatureViewModel",null),z([W({readOnly:!0})],Kn.prototype,"state",null),z([W()],Kn.prototype,"timeZone",null),z([W()],Kn.prototype,"title",void 0),z([W()],Kn.prototype,"updateLocationEnabled",void 0),z([W()],Kn.prototype,"view",void 0),z([W()],Kn.prototype,"visible",void 0),z([W({readOnly:!0})],Kn.prototype,"waitingForContents",null),z([W({readOnly:!0})],Kn.prototype,"waitingForResult",null),z([W()],Kn.prototype,"zoomFactor",void 0),z([W()],Kn.prototype,"zoomToLocation",void 0),z([W()],Kn.prototype,"centerAtLocation",null),Kn=z([X("esri.widgets.Features.FeaturesViewModel")],Kn);const es=Kn;let ts=class s2 extends G{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};z([W({type:Boolean,nonNullable:!0})],ts.prototype,"actionBar",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"closeButton",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"collapseButton",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"featureNavigation",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"featureListLayerTitle",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"flow",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"heading",void 0),z([W({type:Boolean,nonNullable:!0})],ts.prototype,"spinner",void 0),ts=z([X("esri.widgets.Features.FeaturesVisibleElements")],ts);const is=ts,ns="selected-index",ss="features-spinner";function k$1(i){return(null==i?void 0:i.declaredClass.startsWith("esri.layers."))??!1}let rs=class E extends(n$3(Me)){constructor(i,r){super(i,r),this._featureMenuIntersectionObserverCallback=([i])=>{(null==i?void 0:i.isIntersecting)&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new B,this._relatedRecordsWidget=new zn({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new Un,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new es,this.visibleElements=new is,this._renderAction=(i,r)=>{const o=this._getActionTitle(i),{type:a,active:_,uid:b,disabled:I,indicator:A}=i;return i.visible?Ee("calcite-action",{active:"toggle"===a&&i.value,appearance:"solid",bind:this,"data-action-uid":b,disabled:I,icon:this._getActionIcon(i),indicator:A,key:`action-${r}`,loading:_,onclick:this._triggerAction,scale:"s",text:o,title:this._hideActionText?o:void 0},this._getFallbackIcon(i)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=i=>{this._focusOn===i&&requestAnimationFrame((async()=>{var r,o;switch(i){case"menu-flow-item":await(null==(r=this._featureMenuViewportNode)?void 0:r.setFocus());break;case"root-flow-item":await(null==(o=this._rootFlowItemNode)?void 0:o.setFocus())}this._focusOn=null}))},this._focusFlowItemNodeThrottled=e$a(this._focusFlowItemNode,50),this._displaySpinnerThrottled=e$a((()=>this._displaySpinner()),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.active}),(()=>this._toggleScreenLocationEnabled())),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.active}),(i=>this._relatedRecordsWidget.closed=!i)),Y((()=>{var i;return null==(i=this.visibleElements)?void 0:i.closeButton}),(i=>this._relatedRecordsWidget.closable=i)),Y((()=>{var i;return null==(i=this.visibleElements)?void 0:i.spinner}),(i=>this._spinnerEnabledChange(i))),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.view}),((i,r)=>this._viewChange(i,r))),Y((()=>{var i,r;return null==(r=null==(i=this.viewModel)?void 0:i.view)?void 0:r.ready}),((i,r)=>this._viewReadyChange(i??!1,r??!1))),Y((()=>{var i,r;return[null==(i=this.viewModel)?void 0:i.waitingForResult,null==(r=this.viewModel)?void 0:r.location]}),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.screenLocation}),(()=>this._closeOpenActionMenu())),Y((()=>this.selectedFeatureWidget),(()=>this._destroyRelatedRecordsFlowItemWidgets())),Y((()=>{var i;const r=null==(i=this.selectedFeatureWidget)?void 0:i.viewModel;return[null==r?void 0:r.title,null==r?void 0:r.state]}),(()=>this._setTitleFromFeatureWidget())),Y((()=>{var i;const r=null==(i=this.selectedFeatureWidget)?void 0:i.viewModel;return[null==r?void 0:r.content,null==r?void 0:r.state]}),(()=>this._setContentFromFeatureWidget())),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.featureViewModels}),(()=>this._featureMenuViewportScrollTop())),this._relatedRecordsWidget.on("close",(()=>this.close())),this._relatedRecordsWidget.on("exit",(()=>this._destroyRelatedRecordsFlowItemWidgets())),this._relatedRecordsWidget.on("open-related-feature",(({feature:i})=>this._openRelatedFeature(i)))])}loadDependencies(){return Ae({action:()=>Ce((()=>import("./calcite-action-Dt6-g_b1.js")),__vite__mapDeps([40,36,2,3,4,5,23,26,27,28,6,33,1,21])),"action-bar":()=>Ce((()=>import("./calcite-action-bar-CXh0y-e8.js")),__vite__mapDeps([46,2,3,38,6,4,5,26,27,28,47,42,36,23,33,1,21,43,29,44,39])),"action-group":()=>Ce((()=>import("./calcite-action-group-DzAQV4Db.js")),__vite__mapDeps([48,47,2,3,38,6,26,27,4,5,28,42,36,23,33,1,21,43,29,44,39])),button:()=>Ce((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([49,2,3,31,4,5,23,32,33,26,27,28,6,1,21])),flow:()=>Ce((()=>import("./calcite-flow-D2Vx6E1X.js")),__vite__mapDeps([50,2,3,6,26])),"flow-item":()=>Ce((()=>import("./calcite-flow-item-CyK_4Qbv.js")),__vite__mapDeps([41,2,3,4,5,23,26,27,28,6,42,36,33,1,21,43,29,44,39,34])),list:()=>Ce((()=>import("./calcite-list-BvNQA5EB.js")),__vite__mapDeps([22,2,3,4,5,23,6,24,25,26,27,28,29,1,30,31,32,33,21,34])),"list-item":()=>Ce((()=>import("./calcite-list-item-RYHR2PjI.js")),__vite__mapDeps([35,2,3,4,5,23,27,28,6,26,25,24,36,33,1,21])),"list-item-group":()=>Ce((()=>import("./calcite-list-item-group-B83YhT4c.js")),__vite__mapDeps([51,2,3,23,24])),loader:()=>Ce((()=>import("./calcite-loader-CKsSCnMM.js")),__vite__mapDeps([20,21,2,3,5]))})}destroy(){var i,r;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),null==(i=this._featureMenuIntersectionObserver)||i.disconnect(),null==(r=this._relatedRecordsWidget)||r.destroy()}get _hideActionText(){var i;if(!this.responsiveActionsEnabled)return!1;const r=null==(i=this.view)?void 0:i.widthBreakpoint;return"xsmall"===r||"small"===r||"medium"===r}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(i){this.viewModel.content=i}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(i){this.viewModel.featureMenuOpen=i}get features(){return this.viewModel.features}set features(i){this.viewModel.features=i}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(i){this.viewModel.goToOverride=i}get location(){return this.viewModel.location}set location(i){this.viewModel.location=i}get label(){var i;return(null==(i=this.messages)?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get map(){return this.viewModel.map}set map(i){this.viewModel.map=i}get promises(){return this.viewModel.promises}set promises(i){this.viewModel.promises=i}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(i){this.viewModel.selectedFeatureIndex=i}get selectedFeatureWidget(){const{_feature:i,headingLevel:r,_relatedRecordsFlowItems:o,timeZone:a,spatialReference:_,map:b}=this,{selectedFeatureViewModel:I}=this.viewModel,A={title:!1};return I?(i?(i.viewModel=I,i.visibleElements=A):this._feature=new Tn({flowItems:o,headingLevel:r+1,timeZone:a,spatialReference:_,map:b,viewModel:I,visibleElements:A}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(i){this.viewModel.spatialReference=i}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}get timeZone(){return this.viewModel.timeZone}set timeZone(i){this.viewModel.timeZone=i}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(i){this.viewModel.updateLocationEnabled=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}get visible(){return this.viewModel.visible}set visible(i){this.viewModel.visible=i}blur(){var i;const{active:r}=this.viewModel;r?null==(i=this._rootFlowItemNode)||i.blur():I.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(i,r){return this.viewModel.fetchFeatures(i,r)}focus(){const{active:i}=this.viewModel;i?this._setFocusOn():I.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(i){this.removeHandles(ns);const r={collapsed:(null==i?void 0:i.collapsed)??!1};this.set(r),this.viewModel.open(i),this.addHandles(vt((()=>!this.viewModel.waitingForResult),(()=>this._addSelectedFeatureIndexHandle()),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(i){return this.viewModel.triggerAction(i)}render(){return Ee("div",{bind:this,class:this.classes(jn.base,xe.widget,xe.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?Ee("div",{class:jn.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:Ee("div",{class:jn.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:i,viewModel:r}=this,{featureCount:o,selectedFeatureIndex:a,pendingPromisesCount:_}=r;return Ee("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:i.selectFeature,loading:_>0,onclick:this._openFeatureMenu,scale:"s",text:Dt(i.pageText,{index:k(a+1),total:k(o)}),textEnabled:!0,title:i.selectFeature})}_renderPagination(){const{previous:i,next:r}=this.messagesCommon.pagination;return Ee("calcite-action-bar",{class:jn.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},Ee("calcite-action-group",{scale:"s"},Ee("calcite-action",{appearance:"solid",class:jn.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:i,onclick:this._previousFeature,scale:"s",text:i,title:i}),Ee("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:r,onclick:this._nextFeature,scale:"s",text:r,title:r})))}_renderFeatureMenuItem(i){const{selectedFeatureViewModel:r,featureViewModels:o}=this.viewModel,a=i===r,_=o.indexOf(i);return Ee("calcite-list-item",{bind:this,"data-feature-index":_,key:`feature-menu-item-${i.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:a,onCalciteListItemSelect:this._selectFeature},Ee("span",{innerHTML:i.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:i}=this.viewModel,r=new Map;return i.forEach((i=>{const o=null==i?void 0:i.graphic;if(!o)return;const{layer:a,sourceLayer:_}=o,b=(k$1(a)?a:null)||(k$1(_)?_:null),I=r.get(b)??[];r.set(b,[...I,i])})),r}_renderFeatureMenu(){const{featureViewModels:i}=this.viewModel,r=this._groupResultsByLayer();return i.length?Ee("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(r.keys(),(i=>{var o;const a=null==(o=r.get(i))?void 0:o.map((i=>this._renderFeatureMenuItem(i))),_=i?i.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&null!==_?Ee("calcite-list-item-group",{heading:_,key:(null==i?void 0:i.uid)||"map-graphics"},a):a}))):null}_renderHeaderAction(i,r){const o=i.title||"";return i.visible?Ee("calcite-action",{active:"toggle"===i.type&&i.value,appearance:"solid",bind:this,"data-action-uid":i.uid,disabled:i.disabled,icon:i.icon??void 0,indicator:i.indicator,key:`header-action-${r}`,loading:i.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:o,title:o}):null}_renderHeaderActions(){return this.headerActions.map(((i,r)=>this._renderHeaderAction(i,r))).toArray()}_renderContentFeature(){const{headingLevel:i,visibleElements:r,_isCollapsed:o,_collapseEnabled:a,featureNavigationTop:_}=this,{title:b,active:I}=this.viewModel,A=r.heading&&b?b:"";return Ee("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[jn.contentFeature]:!0,[jn.flowItemCollapsed]:o}),closable:r.closeButton,closed:!I,collapsed:o,collapseDirection:_?"down":"up",collapsible:a,headingLevel:i,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},A?Ee(e$7,{class:this.classes(jn.featuresHeading,xe.heading),innerHTML:A,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),o?null:Ee("div",{class:this.classes(jn.container,jn.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:i,featureMenuOpen:r,messages:o,messagesCommon:a}=this,{active:_,featureViewModels:b,pendingPromisesCount:I}=i;return r?Ee("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!_,description:Dt(o.total,{total:b.length}),heading:o.selectFeature,key:"feature-menu",loading:i.waitingForContents,onCalciteFlowItemBack:i=>{i.preventDefault(),this._handleFeatureMenuBack()}},I>0?Ee("calcite-loader",{class:jn.loader,inline:!0,key:"feature-menu-loader",label:a.loading,slot:"header-actions-end"}):null,Ee("div",{class:jn.container},this._renderFeatureMenu()),Ee("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:jn.featureMenuObserver}),Ee("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},a.back)):null}_renderContentContainer(){const i=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?Ee("calcite-flow",{key:"content-container"},i):i}_getFallbackIcon(i){const{className:r,icon:o}=i;if(o)return null;const a=function e$9({action:i,feature:r}){const o=null==r?void 0:r.attributes,a="image"in i?i.image:void 0;return a&&o?Dt(a,o):a??""}({action:i,feature:this.selectedFeature}),_={[jn.icon]:!!r,[jn.actionImage]:!!a};return r&&(_[r]=!0),a||r?Ee("span",{"aria-hidden":"true",class:this.classes(jn.icon,_),key:"icon",styles:n$9(a)}):null}_renderActionBar(){var i;return!this._isCollapsed&&this.visibleElements.actionBar&&(null==(i=this.viewModel.allActions)?void 0:i.length)?Ee("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},Ee("calcite-action-group",{afterCreate:i=>this._actionBarMenuNode=i,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var i;const r=null==(i=this.viewModel)?void 0:i.content;return r?"string"==typeof r?Ee("div",{class:Fn.contentNode,innerHTML:r,key:r}):this.renderNodeContent(r):null}_setFocusOn(){this.renderNow(),requestAnimationFrame((()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"}))}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(i){await i.viewModel.updateGeometry();const r=i.graphic,o=null==r?void 0:r.geometry;if(null==o||null==r)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:o});const a=n$a(o);this.open({features:[r],location:null!=a?a:void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(i){this._rootFlowItemNode=i,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(i){this._featureMenuViewportNode=i,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(i){var r;const{viewModel:o}=this,a=i.currentTarget["data-feature-index"];o.activeFeature=(null==(r=o.features)?void 0:r[a])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(i){const r=i.currentTarget["data-feature-index"];isNaN(r)||(this.viewModel.selectedFeatureIndex=r),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(i){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(i),this._featureMenuIntersectionObserverNode=i}_getActionIcon(i){return i.icon?i.icon:i.image||i.className?void 0:"question"}_getActionTitle(i){const{messages:r,selectedFeature:o,messagesCommon:a}=this,{id:_}=i,b=null==o?void 0:o.attributes,I=i.title??"",A="zoom-to-feature"===_?Dt(I,{messages:r}):"remove-selected-feature"===_?Dt(I,{messages:a}):"zoom-to-clustered-features"===_||"browse-clustered-features"===_?Dt(I,{messages:r}):i.title;return A&&b?Dt(A,b):A??""}_onMainKeydown(i){const{key:r}=i;"ArrowLeft"===r&&(i.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===r&&(i.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:i}=this;i&&(this.viewModel.content=i)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:i,messagesCommon:r}=this,o=null==i?void 0:i.viewModel;i&&(this.viewModel.title="error"===(null==o?void 0:o.state)?null==r?void 0:r.errorMessage:(null==o?void 0:o.title)||"")}_addSelectedFeatureIndexHandle(){const i=Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.selectedFeatureIndex}),((i,r)=>this._selectedFeatureIndexUpdated(i,r)));this.addHandles(i,ns)}_selectedFeatureIndexUpdated(i,r){const{featureCount:o}=this.viewModel;o&&i!==r&&-1!==i&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(i){const r=i.currentTarget;if(r.disabled)return;const o=r.dataset.actionUid,a=this.headerActions.find((({uid:i})=>i===o));a&&!a.disabled&&("toggle"===(null==a?void 0:a.type)&&(a.value=!a.value),this.emit("trigger-header-action",{action:a}))}_triggerAction(i){const r=i.currentTarget;if(r.disabled)return;const o=r.dataset.actionUid,{allActions:a}=this.viewModel,_=a.findIndex((i=>i.uid===o)),b=a.at(_);b&&"toggle"===b.type&&(b.value=!b.value),this.viewModel.triggerAction(_)}_createSpinner(i){i&&(this._spinner=new Dn({view:i}),i.ui.add(this._spinner,{key:ss,position:"manual",internal:!0}))}_wireUpView(i){var r;this._destroySpinner(),i&&(null==(r=this.visibleElements)?void 0:r.spinner)&&this._createSpinner(i)}_hideSpinner(){const{_spinner:i}=this;i&&(i.location=null,i.hide())}_viewReadyChange(i,r){var o;i?this._wireUpView(null==(o=this.viewModel)?void 0:o.view):r&&this.viewModel.clear()}_viewChange(i,r){i&&r&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:i}=this;i&&(i.viewModel=null,!i.destroyed&&i.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:i}=this;i&&(i.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain((i=>{"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy()}))}_toggleScreenLocationEnabled(){const{viewModel:i}=this;i&&(i.screenLocationEnabled=i.active)}_displaySpinner(){const{_spinner:i}=this;if(!i)return;const{location:r,waitingForResult:o}=this.viewModel;o&&r?i.show({location:r}):i.hide()}_destroySpinner(){var i;const{_spinner:r,view:o}=this;r&&(null==(i=null==o?void 0:o.ui)||i.remove(r,ss),r.destroy(),this._spinner=null)}_spinnerEnabledChange(i){var r;this._destroySpinner(),i&&this._createSpinner(null==(r=this.viewModel)?void 0:r.view)}};z([W()],rs.prototype,"_focusOn",void 0),z([W()],rs.prototype,"_relatedRecordsFlowItems",void 0),z([W()],rs.prototype,"_hideActionText",null),z([W()],rs.prototype,"_featureNavigationVisible",null),z([W()],rs.prototype,"_isCollapsed",null),z([W()],rs.prototype,"_collapseEnabled",null),z([W({readOnly:!0})],rs.prototype,"active",null),z([W()],rs.prototype,"collapsed",void 0),z([W()],rs.prototype,"content",null),z([W()],rs.prototype,"icon",null),z([W()],rs.prototype,"featureMenuOpen",null),z([W()],rs.prototype,"featureNavigationTop",void 0),z([W()],rs.prototype,"features",null),z([W()],rs.prototype,"goToOverride",null),z([W({type:Un})],rs.prototype,"headerActions",void 0),z([W()],rs.prototype,"headingLevel",void 0),z([W()],rs.prototype,"location",null),z([W()],rs.prototype,"label",null),z([W()],rs.prototype,"map",null),z([W(),be("esri/widgets/Features/t9n/Features")],rs.prototype,"messages",void 0),z([W(),be("esri/t9n/common")],rs.prototype,"messagesCommon",void 0),z([W()],rs.prototype,"promises",null),z([W()],rs.prototype,"responsiveActionsEnabled",void 0),z([W({readOnly:!0})],rs.prototype,"selectedFeature",null),z([W()],rs.prototype,"selectedFeatureIndex",null),z([W({readOnly:!0})],rs.prototype,"selectedFeatureWidget",null),z([W()],rs.prototype,"spatialReference",null),z([W()],rs.prototype,"title",null),z([W()],rs.prototype,"timeZone",null),z([W()],rs.prototype,"updateLocationEnabled",null),z([W()],rs.prototype,"view",null),z([W({type:es}),e$6(["triggerAction","trigger-action"])],rs.prototype,"viewModel",void 0),z([W({type:is,nonNullable:!0})],rs.prototype,"visibleElements",void 0),z([W()],rs.prototype,"visible",null),rs=z([X("esri.widgets.Features")],rs);const os=rs,as="esri-popup",ls=`${as}--is-docked`,ds={base:as,baseHidden:`${as}--hidden`,main:`${as}__main-container`,shadow:`${as}--shadow`,isDocked:ls,isDockedTopLeft:`${ls}-top-left`,isDockedTopCenter:`${ls}-top-center`,isDockedTopRight:`${ls}-top-right`,isDockedBottomLeft:`${ls}-bottom-left`,isDockedBottomCenter:`${ls}-bottom-center`,isDockedBottomRight:`${ls}-bottom-right`,alignTopCenter:`${as}--aligned-top-center`,alignBottomCenter:`${as}--aligned-bottom-center`,alignTopLeft:`${as}--aligned-top-left`,alignBottomLeft:`${as}--aligned-bottom-left`,alignTopRight:`${as}--aligned-top-right`,alignBottomRight:`${as}--aligned-bottom-right`,pointer:`${as}__pointer`,pointerDirection:`${as}__pointer-direction`};let us=class extends es{constructor(i){super(i)}};us=z([X("esri.widgets.Popup.PopupViewModel")],us);const cs=us;let hs=class extends G{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};z([W({type:Boolean,nonNullable:!0})],hs.prototype,"actionBar",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"closeButton",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"collapseButton",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"featureNavigation",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"featureListLayerTitle",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"heading",void 0),z([W({type:Boolean,nonNullable:!0})],hs.prototype,"spinner",void 0),hs=z([X("esri.widgets.Popup.PopupVisibleElements")],hs);const ps=hs,ms={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let vs=class extends Me{constructor(i,r){super(i,r),this._dockAction=new At({id:"popup-dock-action"}),this._featuresWidget=new os({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new cs,this.visibleElements=new ps}initialize(){this.addHandles([Y((()=>{var i,r;return[null==(r=null==(i=this.viewModel)?void 0:i.view)?void 0:r.widthBreakpoint,this.dockEnabled]}),(()=>this._handleDockIcon()),J),Y((()=>{var i,r;return[this.dockEnabled,null==(i=this.messages)?void 0:i.undock,null==(r=this.messages)?void 0:r.dock]}),(()=>this._handleDockEnabled()),J),Y((()=>this.dockOptions),(i=>{const{_dockAction:r}=this,o=this._featuresWidget.headerActions;o.remove(r),i.buttonEnabled&&o.add(r)}),J),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.screenLocation}),(()=>this._positionContainer())),Y((()=>{var i;return[null==(i=this.viewModel)?void 0:i.active,this.dockEnabled]}),(()=>this._toggleScreenLocationEnabled())),Y((()=>{var i,r,o,a,_,b,I;return[null==(i=this.viewModel)?void 0:i.screenLocation,null==(o=null==(r=this.viewModel)?void 0:r.view)?void 0:o.padding,null==(_=null==(a=this.viewModel)?void 0:a.view)?void 0:_.size,null==(b=this.viewModel)?void 0:b.active,null==(I=this.viewModel)?void 0:I.location,this.alignment]}),(()=>this.reposition())),Y((()=>{var i,r;return null==(r=null==(i=this.viewModel)?void 0:i.view)?void 0:r.size}),((i,r)=>this._updateDockEnabledForViewSize(i,r))),Y((()=>{var i;return null==(i=this.viewModel)?void 0:i.view}),((i,r)=>this._viewChange(i,r))),Y((()=>{var i,r;return null==(r=null==(i=this.viewModel)?void 0:i.view)?void 0:r.ready}),((i,r)=>this._viewReadyChange(i??!1,r??!1))),Y((()=>this.viewModel),(()=>this._featuresWidget.viewModel=this.viewModel),J),Y((()=>this._featureNavigationTop),(i=>this._featuresWidget.featureNavigationTop=i),J),Y((()=>this.headingLevel),(i=>this._featuresWidget.headingLevel=i),J),Y((()=>this.visibleElements.actionBar),(i=>this._featuresWidget.visibleElements.actionBar=!!i),J),Y((()=>this.visibleElements.closeButton),(i=>this._featuresWidget.visibleElements.closeButton=!!i),J),Y((()=>this.visibleElements.collapseButton),(i=>this._featuresWidget.visibleElements.collapseButton=!!i),J),Y((()=>this.visibleElements.heading),(i=>this._featuresWidget.visibleElements.heading=!!i),J),Y((()=>this.visibleElements.spinner),(i=>this._featuresWidget.visibleElements.spinner=!!i),J),Y((()=>this.visibleElements.featureNavigation),(i=>this._featuresWidget.visibleElements.featureNavigation=!!i),J),Y((()=>this.visibleElements.featureListLayerTitle),(i=>this._featuresWidget.visibleElements.featureListLayerTitle=!!i),J),Ie((()=>this._featuresWidget),"trigger-header-action",(i=>{i.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)}))])}normalizeCtorArgs(i){const r={...i};return null!=(null==i?void 0:i.visibleElements)&&(r.visibleElements=new ps(i.visibleElements),null!=i.collapseEnabled&&(r.visibleElements.collapseButton=i.collapseEnabled),null!=i.spinnerEnabled&&(r.visibleElements.spinner=i.spinnerEnabled)),r}destroy(){var i;this._dockAction.destroy(),null==(i=this._featuresWidget)||i.destroy()}get _featureNavigationTop(){const{currentAlignment:i,currentDockPosition:r}=this;return"bottom-left"===i||"bottom-center"===i||"bottom-right"===i||"top-left"===r||"top-center"===r||"top-right"===r}get actions(){return this.viewModel.actions}set actions(i){this.viewModel.actions=i}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(i){this.viewModel.autoCloseEnabled=i}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(i){this.viewModel.defaultPopupTemplateEnabled=i}get content(){return this.viewModel.content}set content(i){this.viewModel.content=i}get collapsed(){return this._featuresWidget.collapsed}set collapsed(i){this._featuresWidget.collapsed=i}get collapseEnabled(){return Vt(I.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(i){Vt(I.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=i}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ms}set dockOptions(i){var r,o;const a={...ms},_=null==(o=null==(r=this.viewModel)?void 0:r.view)?void 0:o.breakpoints,b={};_&&(b.width=_.xsmall,b.height=_.xsmall);const I={...a,...i},A={...a.breakpoint,...b},{breakpoint:x}=I;"object"==typeof x?I.breakpoint={...A,...x}:x&&(I.breakpoint=A),this._set("dockOptions",I),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(i){this.viewModel.featureMenuOpen=i}get features(){return this.viewModel.features}set features(i){this.viewModel.features=i}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(i){this.viewModel.goToOverride=i}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(i){this.viewModel.highlightEnabled=i}get icon(){return"popup"}set icon(i){this._overrideIfSome("icon",i)}get location(){return this.viewModel.location}set location(i){this.viewModel.location=i}get label(){var i;return(null==(i=this.messages)?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get promises(){return this.viewModel.promises}set promises(i){this.viewModel.promises=i}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(i){this.viewModel.selectedFeatureIndex=i}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return Vt(I.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(i){Vt(I.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=i}get title(){return this.viewModel.title}set title(i){this.viewModel.title=i}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(i){this.viewModel.updateLocationEnabled=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}get visible(){return this.viewModel.visible}set visible(i){this.viewModel.visible=i}blur(){const{active:i}=this.viewModel;i||I.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(i,r){return this.viewModel.fetchFeatures(i,r)}focus(){const{active:i}=this.viewModel;i||I.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame((()=>{this._featuresWidget.focus()}))}next(){return this.viewModel.next()}open(i){const r=!!i&&!!i.featureMenuOpen,o={collapsed:!!i&&!!i.collapsed,featureMenuOpen:r};this.set(o),this.viewModel.open(i),this._shouldFocus(i)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(i){return this.viewModel.triggerAction(i)}render(){var i,r,o,a;const{dockEnabled:_,currentAlignment:b,currentDockPosition:I}=this,{active:A,screenLocation:x}=this.viewModel,L=A&&_,k=A&&!_,O=null==(r=null==(i=this.selectedFeature)?void 0:i.layer)?void 0:r.title,B=null==(a=null==(o=this.selectedFeature)?void 0:o.layer)?void 0:a.id,z={[ds.alignTopCenter]:"top-center"===b,[ds.alignBottomCenter]:"bottom-center"===b,[ds.alignTopLeft]:"top-left"===b,[ds.alignBottomLeft]:"bottom-left"===b,[ds.alignTopRight]:"top-right"===b,[ds.alignBottomRight]:"bottom-right"===b,[ds.isDocked]:L,[ds.shadow]:k,[ds.isDockedTopLeft]:"top-left"===I,[ds.isDockedTopCenter]:"top-center"===I,[ds.isDockedTopRight]:"top-right"===I,[ds.isDockedBottomLeft]:"bottom-left"===I,[ds.isDockedBottomCenter]:"bottom-center"===I,[ds.isDockedBottomRight]:"bottom-right"===I};return Ee("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(ds.base,z,{[ds.baseHidden]:!x&&!_}),"data-layer-id":B,"data-layer-title":O,role:"presentation"},A?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:Ee("div",{class:ds.pointer,key:"popup-pointer",role:"presentation"},Ee("div",{class:this.classes(ds.pointerDirection,ds.shadow)}))}_renderMainContainer(){const{dockEnabled:i}=this,r={[ds.shadow]:i};return Ee("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(ds.main,xe.widget,r)},this._featuresWidget.render())}async _shouldFocus(i){(null==i?void 0:i.shouldFocus)&&(await St((()=>{var i;return!0===(null==(i=this.viewModel)?void 0:i.active)})),this.focus())}_isOutsideView(i){const{popupHeight:r,popupWidth:o,screenLocation:a,side:_,view:b}=i;if(isNaN(o)||isNaN(r)||!b||!a)return!1;const I=b.padding;return"right"===_&&a.x+o/2>b.width-I.right||"left"===_&&a.x-o/2<I.left||"top"===_&&a.y-r<I.top||"bottom"===_&&a.y+r>b.height-I.bottom}_calculateAutoAlignment(i){if("auto"!==i)return i;const{_pointerOffsetInPx:r,_containerNode:o,_mainContainerNode:a,viewModel:_}=this,{screenLocation:b,view:I}=_;if(null==b||!I||!o)return"top-center";function l4(i){return parseInt(i.replaceAll(/[^-\d.]/g,""),10)}const A=a?window.getComputedStyle(a,null):null,x=A?l4(A.getPropertyValue("max-height")):0,L=A?l4(A.getPropertyValue("height")):0,{height:k,width:O}=o.getBoundingClientRect(),B=O+r,z=Math.max(k,x,L)+r,W=this._isOutsideView({popupHeight:z,popupWidth:B,screenLocation:b,side:"right",view:I}),H=this._isOutsideView({popupHeight:z,popupWidth:B,screenLocation:b,side:"left",view:I}),U=this._isOutsideView({popupHeight:z,popupWidth:B,screenLocation:b,side:"top",view:I}),X=this._isOutsideView({popupHeight:z,popupWidth:B,screenLocation:b,side:"bottom",view:I});return H?U?"bottom-right":"top-right":W?U?"bottom-left":"top-left":U?X?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(i){return"function"==typeof i?i.call(this):i}_getCurrentAlignment(){const{alignment:i,dockEnabled:r}=this;return r||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(i)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(i){const r=["left","right"];return Re(this.container)&&r.reverse(),null==i?void 0:i.replace(/leading/gi,r[0]).replaceAll(/trailing/gi,r[1])}_callDockPosition(i){return"function"==typeof i?i.call(this):i}_getDockPosition(){var i;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(i=this.dockOptions)?void 0:i.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(i){var r;if("auto"!==i)return i;const o=null==(r=this.viewModel)?void 0:r.view,a=Re(this.container)?"top-left":"top-right";if(!o)return a;const _=o.padding||{left:0,right:0,top:0,bottom:0},b=o.width-_.left-_.right,{breakpoints:I}=o;return I&&b<=I.xsmall?"bottom-center":a}_getDockIcon(){const i=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(i){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var i,r;this._dockAction.title=this.dockEnabled?null==(i=this.messages)?void 0:i.undock:null==(r=this.messages)?void 0:r.dock}_setMainContainerNode(i){this._mainContainerNode=i}_positionContainer(i=this._containerNode){if(i&&(this._containerNode=i),!this._containerNode)return;const{screenLocation:r}=this.viewModel,{width:o}=this._containerNode.getBoundingClientRect(),a=this._calculatePositionStyle(r,o);a&&Object.assign(this._containerNode.style,a)}_calculateFullWidth(i){const{currentAlignment:r,_pointerOffsetInPx:o}=this;return"top-left"===r||"bottom-left"===r||"top-right"===r||"bottom-right"===r?i+o:i}_calculateAlignmentPosition(i,r,o,a){const{currentAlignment:_,_pointerOffsetInPx:b}=this;if(!o)return;const{padding:I}=o,A=a/2,x=o.height-r,L=o.width-i;return"bottom-center"===_?{top:r+b-I.top,left:i-A-I.left}:"top-left"===_?{bottom:x+b-I.bottom,right:L+b-I.right}:"bottom-left"===_?{top:r+b-I.top,right:L+b-I.right}:"top-right"===_?{bottom:x+b-I.bottom,left:i+b-I.left}:"bottom-right"===_?{top:r+b-I.top,left:i+b-I.left}:"top-center"===_?{bottom:x+b-I.bottom,left:i-A-I.left}:void 0}_calculatePositionStyle(i,r){const{dockEnabled:o,view:a}=this;if(!a)return;if(o)return{left:"",top:"",right:"",bottom:""};if(null==i||!r)return;const _=this._calculateFullWidth(r),b=this._calculateAlignmentPosition(i.x,i.y,a,_);return b?{top:void 0!==b.top?`${b.top}px`:"auto",left:void 0!==b.left?`${b.left}px`:"auto",bottom:void 0!==b.bottom?`${b.bottom}px`:"auto",right:void 0!==b.right?`${b.right}px`:"auto"}:void 0}_viewChange(i,r){i&&r&&(this.close(),this.clear())}_viewReadyChange(i,r){i?this._wireUpView():r&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(i,r,o){const[a,_]=i,[b,I]=r,{width:A=0,height:x=0}=o??{};return a<=A&&b>A||a>A&&b<=A||_<=x&&I>x||_>x&&I<=x}_updateDockEnabledForViewSize(i,r){var o,a;if(!i||!r)return;const _=(null==(a=null==(o=this.viewModel)?void 0:o.view)?void 0:a.padding)||{left:0,right:0,top:0,bottom:0},b=_.left+_.right,I=_.top+_.bottom,A=[],x=[];A[0]=i[0]-b,A[1]=i[1]-I,x[0]=r[0]-b,x[1]=r[1]-I;const{dockOptions:L}=this,k=L.breakpoint;this._dockingThresholdCrossed(A,x,k)&&this._setDockEnabledForViewSize(L),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:i,viewModel:r}=this;if(!r)return;const o=r.active&&!i;r.screenLocationEnabled=o}_shouldDockAtCurrentViewSize(i){var r,o;const a=i.breakpoint,_=null==(o=null==(r=this.viewModel)?void 0:r.view)?void 0:o.ui;if(!_)return!1;const{width:b,height:I}=_;if(isNaN(b)||isNaN(I))return!1;if(!a)return!1;const A=a.hasOwnProperty("width")&&b<=(a.width??0),x=a.hasOwnProperty("height")&&I<=(a.height??0);return A||x}_setDockEnabledForViewSize(i){i.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(i))}};z([W({readOnly:!0})],vs.prototype,"_featureNavigationTop",null),z([W()],vs.prototype,"actions",null),z([W({readOnly:!0})],vs.prototype,"active",null),z([W()],vs.prototype,"alignment",void 0),z([W()],vs.prototype,"autoCloseEnabled",null),z([W()],vs.prototype,"defaultPopupTemplateEnabled",null),z([W()],vs.prototype,"content",null),z([W()],vs.prototype,"collapsed",null),z([W()],vs.prototype,"collapseEnabled",null),z([W({readOnly:!0})],vs.prototype,"currentAlignment",null),z([W({readOnly:!0})],vs.prototype,"currentDockPosition",null),z([W()],vs.prototype,"dockOptions",null),z([W()],vs.prototype,"dockEnabled",void 0),z([W({readOnly:!0})],vs.prototype,"featureCount",null),z([W()],vs.prototype,"featureMenuOpen",null),z([W()],vs.prototype,"features",null),z([W()],vs.prototype,"goToOverride",null),z([W()],vs.prototype,"headingLevel",void 0),z([W()],vs.prototype,"highlightEnabled",null),z([W()],vs.prototype,"icon",null),z([W()],vs.prototype,"location",null),z([W()],vs.prototype,"label",null),z([W(),be("esri/widgets/Popup/t9n/Popup")],vs.prototype,"messages",void 0),z([W()],vs.prototype,"promises",null),z([W({readOnly:!0})],vs.prototype,"selectedFeature",null),z([W()],vs.prototype,"selectedFeatureIndex",null),z([W({readOnly:!0})],vs.prototype,"selectedFeatureWidget",null),z([W()],vs.prototype,"spinnerEnabled",null),z([W()],vs.prototype,"title",null),z([W()],vs.prototype,"updateLocationEnabled",null),z([W()],vs.prototype,"view",null),z([W({type:cs}),e$6(["triggerAction","trigger-action"])],vs.prototype,"viewModel",void 0),z([W()],vs.prototype,"visible",null),z([W({type:ps,nonNullable:!0})],vs.prototype,"visibleElements",void 0),vs=z([X("esri.widgets.Popup")],vs);const fs=vs;export{fs as default};
