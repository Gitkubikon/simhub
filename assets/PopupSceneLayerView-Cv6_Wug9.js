import{e,a as t,b as a,af as s,ag as r,ah as p,ai as n}from"./index-DSIPxOWi.js";const i=o=>{let c=class extends o{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;if(!r)throw new a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!s(t,e))throw new a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const a="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let o=[];"fieldsIndex"in this.layer&&(o=r(this.layer.fieldsIndex,await p(a,s(this.layer,t)))),await this.prepareFetchPopupFeatures(o);const c=new Set,h=[],l=[];for(const s of e)n(o,s,c)?l.push(s):h.push(s);if(0===l.length)return h;const u=new Map;for(let s=0;s<e.length;s++)u.set(e[s].getObjectId()??0,s);const d=await this.whenGraphicAttributes(l,[...c]).catch((()=>l)).then((e=>h.concat(e)));return d.sort(((e,t)=>{const a=e.getObjectId()??0,s=u.get(a)??0,r=t.getObjectId()??0;return s-(u.get(r)??0)})),d}};return c=e([t("esri.views.3d.layers.support.PopupSceneLayerView")],c),c};export{i};
