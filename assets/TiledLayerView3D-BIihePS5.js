import{e,y as t,w as i,b5 as a,a as r,b6 as n,b7 as s,d as o,b as h,ae as c,b8 as m}from"./index-DSIPxOWi.js";const p=u=>{let d=class extends u{constructor(){super(...arguments),this.hasMixedImageFormats=!0}get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get visibleAtCurrentScale(){if(!n(this.layer.minScale,this.layer.maxScale)||!this.view.terrainScale)return!0;const e=Math.round(this.view.basemapTerrain.tilingScheme.levelAtScale(this.view.terrainScale));return e>=this.displayLevelRange.minLevel&&e<=this.displayLevelRange.maxLevel}get dataScaleRange(){const e=this.tileInfo.lods;let t=e[0].scale,i=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:e,effectiveMaxLOD:a}=this.layer.tilemapCache;t=this.tileInfo.lodAt(e).scale,i=this.tileInfo.lodAt(a).scale}return{minScale:t,maxScale:i}}canResume(){var e,t,i;const a=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null==(e=this.layer)?void 0:e.loaded)&&!(null==(t=this.parent)?void 0:t.suspended)&&(null==(i=this.view)?void 0:i.ready)&&s(a)&&this.visibleAtCurrentTimeExtent||!1}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,t)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,t=this.layer.maxScale||this.dataScaleRange.maxScale,i=this.levelRangeFromScaleRange(e,t);return this.layer.maxScale&&i.maxLevel++,i}get performanceInfo(){return new o(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e){return this.layer.getTileUrl(e[0],e[1],e[2])}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new h("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));this.addResolvingPromise(c((()=>{var e,t;return null==(t=null==(e=this.view)?void 0:e.basemapTerrain)?void 0:t.tilingSchemeLocked})).then((()=>{var e;const t=this.view.basemapTerrain.tilingScheme,i="tilemapCache"in this.layer?null==(e=this.layer.tilemapCache)?void 0:e.effectiveMaxLOD:void 0,a=this._getTileInfoCompatibilityError(this.tileInfo,t,i);if(a)throw a})))}_getTileInfoSupportError(e,t){var i;const a=m(e,t,this.view.spatialReference,this.view.state.viewingMode,"tilemapCache"in this.layer?null==(i=this.layer.tilemapCache)?void 0:i.effectiveMaxLOD:void 0);if(!a)return;const r={layer:this.layer,error:a};switch(a.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":return new h("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",r);default:return new h("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",r)}}_getTileInfoCompatibilityError(e,t,i){return null!=e&&t.compatibleWith(e,i)?null:new h("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},a=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!a)return i;const r=a.levels[0],l=e=>{const t=Math.log(r.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,l(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,l(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return e([t({readOnly:!0})],d.prototype,"imageFormatIsOpaque",null),e([t({readOnly:!0})],d.prototype,"updating",void 0),e([t(i)],d.prototype,"updatingProgress",void 0),e([t(a)],d.prototype,"updatingProgressValue",void 0),e([t()],d.prototype,"hasMixedImageFormats",void 0),e([t()],d.prototype,"fullExtent",null),e([t({readOnly:!0})],d.prototype,"isOpaque",null),e([t({readOnly:!0})],d.prototype,"visibleAtCurrentScale",null),e([t()],d.prototype,"dataScaleRange",null),e([t({readOnly:!0})],d.prototype,"dataLevelRange",null),e([t({readOnly:!0})],d.prototype,"displayLevelRange",null),e([t()],d.prototype,"layer",void 0),d=e([r("esri.views.3d.layers.TiledLayerView3D")],d),d};export{p};
