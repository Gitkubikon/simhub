import{e,y as t,a as i,S as s,g as a,A as r,n as o,xc as l,w5 as d,w6 as c,wc as u,dW as h,w8 as p,xe as m,wg as v,_ as w,wi as L,wd as f,wj as E,wk as C,wl as P,xu as S,wm as z,kA as V,wp as M,ws as x,ld as D,wx as R,xz as G,xw as H,kz as k,wf as I,xg as Q,wH as U,br as B,O as W,N as F,cx as q,L as K,e6 as $,cy as J,Q as X,bV as Y,dJ as Z,ql as ee,xF as te,dN as ie,ke as se,u as ne,e3 as ae,xG as re,du as oe,dQ as le,gi as de,pP as ce,xH as ue,oK as he,pf as ge,oI as pe,um as _e,oi as me,n0 as ve,qT as ye,P as we,dC as be,dD as Le,mb as fe,aK as Ee,xh as Ae,aI as Ce,qU as Oe,c$ as Pe,ee as Se,ki as ze,kh as Ve}from"./index-DSIPxOWi.js";import{e as Me,a as xe}from"./interfaces-BqQPACG7.js";import{s as Te}from"./AnalysisView3D-CNsY6W7Z.js";import{r as De,t as je}from"./projectionUtils-B1mpMSec.js";import{f as Re,i as Ge,a as Ne}from"./geodesicLengthMeasurementUtils-Pq-FipkN.js";import{g as He,y as ke,j as Ie,M as Qe,w as Ue}from"./TextOverlayItem-BcN_gvXw.js";import{f as Be,_ as We,m as Fe,v as qe}from"./Segment-ByPzCwlk.js";import{a as Ke,f as $e}from"./LineVisualElement-EjMrPPob.js";import{D as Je}from"./RightAngleQuadVisualElement-CPtUkCyd.js";import"./geometryEngine-Bp1TD6MM.js";import"./geometryEngineBase-9EI9fooq.js";import"./hydrated-DE1HcVsK.js";import"./unitFormatUtils-B9MPZ1wj.js";import"./EngineVisualElement-Cxk2Aaf7.js";let Xe=class extends s{constructor(e){super(e)}initialize(){this.addHandles([a((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),r),a((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),r),a((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),r)])}_applyProjectionAndElevationAlignment(e){if(null==e)return e;const{spatialReference:t,elevationProvider:i}=this.view;return De(e,t,i)??(je(this.analysis,e.spatialReference,o.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if(null==e||null==t)return null;const s=l(e,t),a=Re(e,t);if(null==s)return null;let r,o;switch(i){case Me.Auto:o=null!=a?"geodesic":"euclidean",r=a??s.horizontal;break;case Me.Geodesic:if(null==a)return null;o="geodesic",r=a;break;case Me.Euclidean:o="euclidean",r=s.horizontal}return{mode:o,directDistance:s.direct,horizontalDistance:r,verticalDistance:s.vertical,distance:i===Me.Euclidean||s.horizontal.value<=Ge?s.direct:a??s.horizontal}}};var Ye,Ze,et;function n(e){const t=new d,{vertex:i,fragment:s}=t;c(i,e),i.uniforms.add(new u("width",(e=>e.width))),t.attributes.add(h.POSITION,"vec3"),t.attributes.add(h.NORMAL,"vec3"),t.attributes.add(h.UV0,"vec2"),t.attributes.add(h.LENGTH,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),i.code.add(p`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = length;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),s.uniforms.add(new u("outlineSize",(e=>e.outlineSize)),new m("outlineColor",(e=>e.outlineColor)),new u("stripeLength",(e=>e.stripeLength)),new m("stripeEvenColor",(e=>e.stripeEvenColor)),new m("stripeOddColor",(e=>e.stripeOddColor)));const a=1/Math.sqrt(2);return s.code.add(p`
    const float INV_SQRT2 = ${p.float(a)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      fragColor = color;
    }
  `),t}e([t()],Xe.prototype,"view",void 0),e([t()],Xe.prototype,"analysis",void 0),e([t()],Xe.prototype,"viewData",void 0),e([t()],Xe.prototype,"_computedResult",null),Xe=e([i("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],Xe),(et=Ye||(Ye={}))[et.None=0]="None",et[et.Direct=1]="Direct",et[et.Triangle=2]="Triangle",et[et.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(Ze||(Ze={}));const tt=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));class g extends E{constructor(e,t,i){super(e,t,i)}initializeProgram(e){return new C(e.rctx,g.shader.get().build(this.configuration),st)}_setPipelineState(e){const t=e===f.NONE,i=this.configuration;return P({blending:i.transparent?t?S:z(e):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:V.LESS},depthWrite:M,colorWrite:x})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return D.TRIANGLE_STRIP}}g.shader=new v(tt,(()=>w((()=>Promise.resolve().then((()=>Et))),void 0)));let it=class T extends R{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=f.NONE}};e([L()],it.prototype,"polygonOffsetEnabled",void 0),e([L()],it.prototype,"transparent",void 0),e([L({count:f.COUNT})],it.prototype,"transparencyPassType",void 0);const st=new Map([[h.POSITION,0],[h.NORMAL,1],[h.UV0,2],[h.LENGTH,3]]);class O extends H{constructor(e){super(e,new A),this._vertexAttributeLocations=st,this.produces=new Map([[k.OPAQUE_MATERIAL,e=>!this._transparent&&e===I.Color],[k.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>this._transparent&&e===I.Color]]),this._configuration=new it}getConfiguration(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration}intersect(){}createGLMaterial(e){return new _(e)}createBufferWriter(){return new ct}get _transparent(){const{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}}class _ extends Q{beginSlot(e){return this.ensureTechnique(g,e)}}class A extends U{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=B(1,.5,0,1),this.stripeEvenColor=B(1,1,1,1),this.stripeOddColor=B(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const nt=G().vec3f(h.POSITION).vec3f(h.NORMAL).vec2f(h.UV0).f32(h.LENGTH),at=X(),rt=X(),ot=X(),lt=X(),dt=X();let ct=class j{constructor(){this.vertexBufferLayout=nt}elementCount(e){return 2*(e.attributes.get(h.POSITION).indices.length/2+1)}write(e,t,i,s,a){const{data:r,indices:o}=i.attributes.get(h.POSITION),l=i.attributes.get(h.NORMAL).data,d=r.length/3;o&&o.length;const c=at,u=rt,p=ot,m=lt,v=dt,w=s.position,L=s.normal,f=s.uv0;let E=0;for(let h=0;h<d;++h){const i=3*h;if(W(c,r[i],r[i+1],r[i+2]),h<d-1){const e=3*(h+1);W(u,r[e],r[e+1],r[e+2]),W(v,l[e],l[e+1],l[e+2]),F(v,v),q(p,u,c),F(p,p),K(m,v,p),F(m,m)}const s=$(c,u);e&&t&&(J(c,c,e),J(u,u,e),J(m,m,t));const o=a+2*h,C=o+1;w.setVec(o,c),w.setVec(C,c),L.setVec(o,m),L.setVec(C,m),f.set(o,0,E),f.set(o,1,-1),f.set(C,0,E),f.set(C,1,1),h<d-1&&(E+=s)}const C=s.length;for(let h=0;h<2*d;++h)C.set(a+h,E)}},ut=class y extends Ke{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=X(),this._originTransform=Y(),this._arrowCenter=X(),this._renderOccluded=Z.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=ee(),this._contrastColor=ee(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:e})}}get color(){return this._color}set color(e){te(e,this._color)||(ie(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){te(e,this._color)||(ie(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){const e=this._color,t=this._contrastColor,i=this._stripesEnabled?t:e;this._arrowMaterial=new O({outlineColor:e,stripeEvenColor:i,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new se,this._handles.add(a((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles=ne(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){var t;if(null==(null==(t=this._geometry)?void 0:t.startRenderSpace)||null==this._geometry.endRenderSpace)return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,e.addGeometry(i),this._viewChanged()}_createArrowGeometry(e,t,i,s){const a=this.view,r=a.renderCoordsHelper,o=[],l=[],c2=(e,t)=>{const s=ae.get();q(s,e,i),o.push(s),l.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=ae.get();if(r.worldUpAtPosition(this._arrowCenter,i),function b(e,t,i){const s=de(ht,t,e),a=K(ht,s,i);return 0===ce(a)}(e,t,i)){const{heading:t,tilt:s}=a.camera,{direction:r}=re(a,e,t,s,gt);oe(i,r)}c2(e,i),c2(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),a=ae.get(),o=ae.get();s.eval(i,a),r.worldUpAtPosition(a,o),c2(a,o)}}return le(this._arrowMaterial,o,l)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;const e=this._color,t=this._contrastColor,i=this._stripesEnabled?t:e,s=e,a=e;this._arrowMaterial.setParameters({stripeEvenColor:i,outlineColor:s,stripeOddColor:a})}};const ht=X(),gt=ue();let pt=class extends s{get _parameters(){const e=this.view.effectiveTheme,{accentColor:t,textColor:i}=e,s=he(t),a=ge(t,.75),r=he(pe(t)),o=pe(i,_e.Low);return{accentColor:s,contrastColor:r,translucentAccentColor:a,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:me(o,.6),textCalloutColor:me(o,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if(null==e||null==t||e.equals(t))return Ye.None;const i=this.analysisView.result;if(null==i)return Ye.Direct;if("geodesic"===this.actualVisualizedMeasurement)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?Ye.ProjectedGeodesic:Ye.Direct;const{verticalDistance:s,horizontalDistance:a}=i,r=s.value,o=a.value;return Math.min(r/o,o/r)<this.triangleCollapseRatioThreshold?Ye.Direct:Ye.Triangle}get actualVisualizedMeasurement(){const{measurementMode:e,result:t}=this.analysisView;switch(e){case Me.Auto:return null!=t&&t.horizontalDistance.value>Ge?"geodesic":"euclidean";case Me.Euclidean:return"euclidean";case Me.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return null==this._triangleOrientationOverride}set allowVisualElementsOrientationChange(e){null==this._triangleOrientationOverride!==e&&(null==this._triangleOrientationOverride?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return"geodesic"===this.actualVisualizedMeasurement?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(e){super(e),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=X(),this._endPosition=X(),this._cornerPosition=X(),this._startPositionAtSeaLevel=X(),this._endPositionAtSeaLevel=X(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=Ze.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){const e=this._parameters,t={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:i,guideStippleLengthPixels:s,triangleLineWidth:o,geodesicProjectionLineWidth:l,directLabelFontSize:d,verticalLabelFontSize:c,horizontalLabelFontSize:u}=e;this._segmentVisualElement=new ut({...t,geometry:null,renderOccluded:Z.OccludeAndTransparent}),this._triangleVisualElement=new $e({...t,width:o,renderOccluded:Z.OccludeAndTransparent}),this._rightAngleQuad=new Je({...t,renderOccluded:Z.OccludeAndTransparent});const h={...t,polygonOffset:!0,renderOccluded:Z.OccludeAndTransparent};this._projectedGeodesicLine=new $e({...h,width:l,stipplePattern:ve(s)}),this._geodesicStartHint=new $e({...h,width:i,stipplePattern:ve(s)}),this._geodesicEndHint=new $e({...h,width:i,stipplePattern:ve(s)}),this._segmentLabel=new Be({...t,fontSize:d}),this._verticalLabel=new Be({...t,fontSize:c}),this._horizontalLabel=new Be({...t,fontSize:u}),this.addHandles([a((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),r),a((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),r),a((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),r),a((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),r),a((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),r),ye((async()=>this._updateMessageBundle())),a((()=>this._parameters),(({textBackgroundColor:e,textCalloutColor:t,textColor:i,translucentAccentColor:s,accentColor:a,contrastColor:r})=>{const{_segmentLabel:o,_verticalLabel:l,_horizontalLabel:d,_triangleVisualElement:c,_rightAngleQuad:u,_projectedGeodesicLine:h,_geodesicStartHint:p,_geodesicEndHint:m,_segmentVisualElement:v}=this;o.backgroundColor=e,o.calloutColor=t,o.textColor=i,l.backgroundColor=e,l.calloutColor=t,l.textColor=i,d.backgroundColor=e,d.calloutColor=t,d.textColor=i,c.color=s,u.color=s,h.color=s,p.color=s,m.color=s,v.color=a,v.contrastColor=r}),we)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=ne(this._segmentVisualElement),this._triangleVisualElement=ne(this._triangleVisualElement),this._rightAngleQuad=ne(this._rightAngleQuad),this._projectedGeodesicLine=ne(this._projectedGeodesicLine),this._geodesicStartHint=ne(this._geodesicStartHint),this._geodesicEndHint=ne(this._geodesicEndHint),this._segmentLabel=ne(this._segmentLabel),this._verticalLabel=ne(this._verticalLabel),this._horizontalLabel=ne(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case Ye.None:break;case Ye.Direct:this._segmentVisualElement.visible=!0;break;case Ye.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case Ye.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:r,visualizedMeasurement:o,stripeLength:l}){const d=e.renderCoordsHelper;if(null==d||null==s||null==a||s.equals(a))return;let c=this._startPosition,u=this._endPosition;d.toRenderCoords(s,c),d.toRenderCoords(a,u);const h=r===Ze.AboveSegment?1:-1,p=h*(d.getAltitude(u)-d.getAltitude(c));p<0&&(c=this._endPosition,u=this._startPosition);const m="geodesic"===o?new We(this._startPosition,this._endPosition,d.spatialReference):new Fe(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=m,this._updateSegmentStripeLength(l),i){case Ye.Direct:this._updateSegment(m,r);break;case Ye.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:m,orientation:r,startPosition:c,endPosition:u,deltaSign:h,altitudeDelta:p});break;case Ye.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:r,startPosition:c,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===Ze.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:a,endPosition:r,deltaSign:o,altitudeDelta:l}){const d=this._cornerPosition;e.worldUpAtPosition(a,d),be(d,d,o*Math.abs(l)),Le(d,d,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[d[0],d[1],d[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:a,center:d,next:r};const c=new Fe(a,d),u=new Fe(d,r),h=function N(e,t,i,s,a){const r=mt,o=vt;a.projectToRenderScreen(i,r),a.projectToRenderScreen(t,o);const l={segment:"bottom",horizontal:"top",vertical:r[0]<o[0]?"left":"right"};{const s=yt,r=wt;if(Ne(e,i,a,s),Ne(e,t,a,r),Pe(s,r)>=_t){const e=Math.sign(s[1])===Math.sign(r[1]);l.segment=e?qe(l.vertical):l.vertical}else{const e=bt;Ne(i,t,a,e),Pe(e,r)>=_t&&(l.segment=Math.sign(e[0])===Math.sign(r[0])?qe(l.horizontal):l.horizontal)}}if(s===Ze.BelowSegment){const e3=e=>"top"===e?"bottom":"top";l.segment=e3(l.segment),l.horizontal=e3(l.horizontal),l.vertical=e3(l.vertical)}return l}(a,r,d,s,t);this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const a=new We(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new Fe(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new Fe(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=t===Ze.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){null!=e?(this._segmentLabel.text="euclidean"===t?e.directDistance:e.horizontalDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,a=this._verticalLabel;if(i.visible=!1,s.visible=!1,a.visible=!1,e)switch(t){case Ye.Direct:i.visible=!0;break;case Ye.Triangle:i.visible=!0,s.visible=!0,a.visible=!0;break;case Ye.ProjectedGeodesic:i.visible=!0;case Ye.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if(null==t||null==e)return null;const{directDistance:i,horizontalDistance:s,verticalDistance:a}=t,r=this.analysisView.unit,r2=e=>({directDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(r){case"metric":return r2({directDistance:i&&Qe(e,i),horizontalDistance:s&&Qe(e,s),verticalDistance:a&&Ue(e,a)});case"imperial":return r2({directDistance:i&&ke(e,i),horizontalDistance:s&&ke(e,s),verticalDistance:a&&Ie(e,a)});default:return r2({directDistance:i&&He(e,i,r),horizontalDistance:s&&He(e,s,r),verticalDistance:a&&He(e,a,r)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;null!=e?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(null!=this._triangleOrientationOverride)return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===Ze.Auto?this.view.state.camera.aboveGround?Ze.AboveSegment:Ze.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!(null==t?void 0:t.state))return!1;const i=t.state.camera,s=t.renderCoordsHelper;if(!s)return!1;const a=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if(null==e)return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&fe(s,"meters");break;case"imperial":i=s&&fe(s,Ee(s.value,s.unit));break;default:i=s&&fe(s,t)}return null==i?null:Ae(i.value/30)*Ce(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,Oe("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){}};e([t()],pt.prototype,"_parameters",null),e([t()],pt.prototype,"_triangleOrientationOverride",void 0),e([t()],pt.prototype,"messages",void 0),e([t()],pt.prototype,"view",void 0),e([t()],pt.prototype,"analysis",void 0),e([t()],pt.prototype,"analysisView",void 0),e([t()],pt.prototype,"loadingMessages",void 0),e([t()],pt.prototype,"visible",null),e([t()],pt.prototype,"viewMode",null),e([t()],pt.prototype,"actualVisualizedMeasurement",null),e([t()],pt.prototype,"visualElementOrientation",void 0),e([t()],pt.prototype,"triangleCollapseRatioThreshold",void 0),e([t()],pt.prototype,"allowVisualElementsOrientationChange",null),e([t()],pt.prototype,"labels",null),e([t()],pt.prototype,"_labelsText",null),e([t()],pt.prototype,"_actualVisualElementsOrientation",null),e([t()],pt.prototype,"_measurementArrowStripeLength",null),pt=e([i("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],pt);const _t=Math.cos(Se(12)),mt=ze(),vt=ze(),yt=Ve(),wt=Ve(),bt=Ve();let Lt=class extends(Te(s)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=Me.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new pt({view:e,analysis:t,analysisView:this}),this._analysisController=new Xe({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=ne(this._analysisController),this._analysisVisualization=ne(this._analysisVisualization)}get updating(){var e;return!!(null==(e=this._analysisVisualization)?void 0:e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){var e;return(null==(e=this._analysisVisualization.labels.direct)?void 0:e.text)??""}get horizontalLabelText(){var e;return(null==(e=this._analysisVisualization.labels.horizontal)?void 0:e.text)??""}get verticalLabelText(){var e;return(null==(e=this._analysisVisualization.labels.vertical)?void 0:e.text)??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};e([t()],Lt.prototype,"updating",null),e([t({readOnly:!0})],Lt.prototype,"type",void 0),e([t({constructOnly:!0,nonNullable:!0})],Lt.prototype,"analysis",void 0),e([t()],Lt.prototype,"result",void 0),e([t()],Lt.prototype,"measurementMode",void 0),e([t()],Lt.prototype,"elevationAlignedStartPoint",void 0),e([t()],Lt.prototype,"elevationAlignedEndPoint",void 0),e([t({readOnly:!0})],Lt.prototype,"viewMode",null),e([t({readOnly:!0})],Lt.prototype,"actualVisualizedMeasurement",null),e([t()],Lt.prototype,"visualElementOrientation",null),e([t()],Lt.prototype,"allowVisualElementsOrientationChange",null),e([t()],Lt.prototype,"triangleCollapseRatioThreshold",null),e([t({readOnly:!0})],Lt.prototype,"directLabelText",null),e([t({readOnly:!0})],Lt.prototype,"horizontalLabelText",null),e([t({readOnly:!0})],Lt.prototype,"verticalLabelText",null),e([t()],Lt.prototype,"_analysisVisualization",void 0),e([t()],Lt.prototype,"_analysisController",void 0),e([t()],Lt.prototype,"unit",null),e([t(xe)],Lt.prototype,"_defaultUnit",void 0),Lt=e([i("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],Lt);const ft=Lt,Et=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));export{ft as default};
