import{e as i,S as e,T as t,h as s,C as r,U as n,W as a,g as l,i as o,u as h,X as p,Y as u,Z as c,$ as d,a0 as y,a1 as g,a2 as f,v as m,V as b,A as v,y as C,a as w,a3 as V,a4 as E}from"./index-DSIPxOWi.js";import{z as x,p as S,u as _,s as G,a as O}from"./Graphics3DObjectStates-B77mD6jz.js";let P=class extends e{constructor(i){super(i),this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=t.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new s}initialize(){const{layer:i}=this,e="effectiveScaleRange"in i?i:null,t=this.scaleVisibilityEnabled&&null!=e,s=new x({owner:this,layer:this.owner.layer,preferredUpdatePolicy:r.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(i,e)=>new S({graphicsCoreOwner:this,graphicsCore:i,queryGraphicUIDsInExtent:e,elevationProvider:this.view.elevationProvider}),scaleVisibility:t?(i,t)=>new _({graphicsCoreOwner:this,layer:e,queryGraphicUIDsInExtent:t,graphicsCore:i,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:i=>new G(i)}});if(this._set("graphicsCore",s),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new O({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const i=this.owner;this._updatingHandles.add((()=>i.fullOpacity),(()=>this.graphicsCore.opacityChange()))}if("elevationInfo"in i){const e=i;this._updatingHandles.add((()=>e.elevationInfo),((i,e)=>{n(i,e)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}))}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(i){if(a(i))return;throw i}this.destroyed||(this.addHandles(l((()=>this.view.clippingArea),(()=>this._updateClippingExtent()),o)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",h(this.frustumVisibility)),this._set("graphicsCore",h(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibility(){var i;return null==(i=this.graphicsCore)?void 0:i.scaleVisibility}get elevationAlignment(){var i;return null==(i=this.graphicsCore)?void 0:i.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){var i;return!!((null==(i=this.graphicsCore)?void 0:i.updating)||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){var i;return null==(i=this.graphicsCore)?void 0:i.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var i;return null==(i=this.graphicsCore)?void 0:i.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(i){this.graphicsCore.notifyGraphicGeometryChanged(i)}notifyGraphicVisibilityChanged(i){this.graphicsCore.notifyGraphicVisibilityChanged(i)}getRenderingInfo(i,e,t){const s=p(i,{renderer:e,arcade:t});if(null==s?void 0:s.color){const i=s.color;i[0]=i[0]/255,i[1]=i[1]/255,i[2]=i[2]/255}return s}getRenderingInfoAsync(i,e,t,s){return u(i,{renderer:e,arcade:t,...s})}getHit(i){if(this.owner.loadedGraphics){const e=this.owner.loadedGraphics.find((e=>e.uid===i));if(e){const i=this.layer instanceof c?this.layer:null,t=d(e,i);return{type:"graphic",graphic:t,layer:t.layer}}}return null}whenGraphicBounds(i,e){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(i,e):Promise.reject()}computeAttachmentOrigin(i,e){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(i,e):null}getSymbolLayerSize(i,e){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(i,e):null}maskOccludee(i){var e;const t=null==(e=this.graphicsCore)?void 0:e.objectStates;if(!t)return y();const{set:s,handle:r}=t.acquireSet(g.MaskOccludee,null);return t.setUid(s,i.uid),r}highlight(i){var e;const t=null==(e=this.graphicsCore)?void 0:e.objectStates;if(!t)return y();if(i instanceof f)return A;if("number"==typeof i)return this.highlight([i]);if(i instanceof m)return this.highlight([i]);if(i instanceof b&&(i=i.toArray()),Array.isArray(i)&&i.length>0){if(i[0]instanceof m){const e=i.map((i=>i.uid)),{set:s,handle:r}=t.acquireSet(g.Highlight,null);return t.setUids(s,e),r}if("number"==typeof i[0]){const e=i,{set:s,handle:r}=t.acquireSet(g.Highlight,null);return t.setObjectIds(s,e),r}}return A}_setupSuspendResumeExtent(){const{scaleVisibility:i,frustumVisibility:e}=this;if(null==i&&null==e)return;const t2=({computedExtent:t,extentPadding:s})=>{this._suspendResumeExtent=V(t,this._suspendResumeExtent,E,s),null!=i&&i.setExtent(this._suspendResumeExtent),null!=e&&e.setExtent(this._suspendResumeExtent)};this.addHandles(l((()=>{var i,e;return{computedExtent:null==(i=this.graphicsCore)?void 0:i.computedExtent,extentPadding:null==(e=this.graphicsCore)?void 0:e.extentPadding}}),(i=>t2(i)),v))}_updateClippingExtent(){const i=this.view.clippingArea;this.graphicsCore.setClippingExtent(i,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};i([C()],P.prototype,"type",void 0),i([C({constructOnly:!0})],P.prototype,"owner",void 0),i([C()],P.prototype,"layer",null),i([C()],P.prototype,"view",null),i([C({constructOnly:!0})],P.prototype,"graphicsCore",void 0),i([C()],P.prototype,"scaleVisibility",null),i([C({constructOnly:!0})],P.prototype,"frustumVisibility",void 0),i([C()],P.prototype,"elevationAlignment",null),i([C()],P.prototype,"scaleVisibilitySuspended",null),i([C({readOnly:!0})],P.prototype,"frustumVisibilitySuspended",null),i([C()],P.prototype,"suspended",null),i([C({readOnly:!0})],P.prototype,"updating",null),i([C()],P.prototype,"loadedGraphics",null),i([C()],P.prototype,"fullOpacity",null),i([C()],P.prototype,"slicePlaneEnabled",null),i([C()],P.prototype,"drapeSourceType",void 0),i([C()],P.prototype,"updatePolicy",null),i([C({constructOnly:!0})],P.prototype,"scaleVisibilityEnabled",void 0),i([C({constructOnly:!0})],P.prototype,"frustumVisibilityEnabled",void 0),i([C()],P.prototype,"initializePromise",void 0),P=i([w("esri.views.3d.layers.graphics.GraphicsProcessor")],P);const A=y();export{P as O};
