import{c9 as n,bW as t,ca as r,cb as e,cc as o,cd as l,ce as a,cf as i,cg as s,ch as c,ci as u,bU as f,cj as g,ck as p,cl as m,cm as v,cn as A,co as x,cp as R,cq as w,cr as y,cs as d,ct as h,cu as E,aI as S,bV as F,cv as T,Q as U,n as b,cw as O,cx as C,cy as j}from"./index-DSIPxOWi.js";const G=()=>b.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function N(n,t,{vertexSpace:r,spatialReference:e}){if("georeferenced"===r.type){const o=n;if(!O(t,o,e))return!1;const{origin:l}=r;return C(n,o,l),!0}const o=a(e),l=n;if(!O(t,l,o))return!1;const{origin:s}=r,c=nn;if(!i(e,s,c,o))return!1;const u=f(nn,c);return null!=u&&(j(n,l,u),!0)}function M(E,S,F){const{vertexSpace:T,transform:U,vertexAttributes:b}=E,O=J(E.spatialReference,F,tn.SOURCE|tn.TARGET);if(n(T,S)&&(!U||t(U.localMatrix,r))&&e(O,1)){const{position:n,normal:t,tangent:r}=b,e=null==F?void 0:F.allowBufferReuse;return{position:e?n:n.slice(),normal:e?t:null==t?void 0:t.slice(),tangent:e?r:null==r?void 0:r.slice()}}switch(E.vertexSpace.type){case"local":return"local"===S.type?function P({vertexAttributes:n,spatialReference:t,transform:r},{origin:e},o,l){const u=a(t);if(!i(t,e,Y,u))return s(G(),t,u),null;if(r&&c(Y,Y,r.localMatrix),!i(t,o,Z,u))return s(G(),u,t),null;f(Z,Z);const g=c(Y,Z,Y);return I(g,t,l,tn.SOURCE|tn.TARGET),q(n,g)}(E,E.vertexSpace,S.origin,F):function B({spatialReference:n,vertexAttributes:t,transform:r},{origin:e},u,f){const g=a(n);if(!i(n,e,Y,g))return s(G(),n,g),null;r&&c(Y,Y,r.localMatrix),I(Y,n,f,tn.SOURCE);const w=new Float64Array(t.position.length),y=function z(n,t,r,e){p(e,n,t);const o=new Float64Array(n.length);return A(e,o,r)?o:(s(G(),a(r),r),null)}(t.position,Y,n,w);if(!y)return null;const d=function D(n,t,r,e,o){if(null==r)return null;const l=new Float32Array(r.length);return m(r,l,e),x(l,n,t,o,l)?l:(s(G(),a(o),o),null)}(y,w,t.normal,Y,n);if(t.normal&&!d)return null;const h=function H(n,t,r,e,o){if(null==r)return null;const l=new Float32Array(r.length);return v(r,l,e),R(l,n,t,o,l)?l:(s(G(),a(o),o),null)}(y,w,t.tangent,Y,n);if(t.tangent&&!h)return null;if(u){const n=l(_,u);o(y,y,n)}return{position:y,normal:d,tangent:h}}(E,E.vertexSpace,S.origin,F);case"georeferenced":return"local"===S.type?function L({vertexAttributes:n,spatialReference:t,transform:r},{origin:e},l,c){const m=a(t);if(!i(t,l,Y,m))return s(G(),t,m),null;const v=1/J(t,c,tn.TARGET);u(Y,Y,[v,v,v]);const A=f(Z,Y),{position:x,normal:R,tangent:E}=function V(n,t,r){if(!t)return n;if(!r){const{position:r,normal:e,tangent:l}=n;return{position:o(new Float64Array(r.length),r,t),tangent:l,normal:e}}const e=q(n,r.localMatrix);return o(e.position,e.position,t),e}(n,e,r),S=new Float64Array(x.length),F=function K(n,t,r,e){const o=w(n,t,e);if(!o)return s(G(),t,a(t)),null;const l=new Float64Array(o.length);return p(l,o,r),l}(x,t,A,S);if(!F)return null;const T=g($,A),U=function Q(n,t,r,e,o,l){if(null==n)return null;const i=l??new Float32Array(n.length);return y(n,t,r,e,i)?(d(i,i,o),i):(s(G(),e,a(e)),null)}(R,x,S,t,T,R!==n.normal?R:void 0);if(!U&&R)return null;const b=function W(n,t,r,e,o,l){if(null==n)return null;const i=l??new Float32Array(n.length);return h(n,t,r,e,i)?(d(i,i,o,4),i):(s(G(),e,a(e)),null)}(E,x,S,t,T,E!==n.tangent?E:void 0);return!b&&E?null:{position:F,normal:U,tangent:b}}(E,E.vertexSpace,S.origin,F):function k({vertexAttributes:n,transform:t,spatialReference:r},{origin:e},a,i){const{position:s,normal:c,tangent:u}=t?q(n,t.localMatrix):n,f=new Float64Array(s.length);let g=s;if(e&&(g=o(f,g,e)),a){const n=l(_,a);g=o(f,g,n)}J(r,i,tn.NONE);const p=null==i?void 0:i.allowBufferReuse;return{position:g!==n.position||p?g:g.slice(),normal:c!==n.normal||p?c:null==c?void 0:c.slice(),tangent:u!==n.tangent||p?u:null==u?void 0:u.slice()}}(E,E.vertexSpace,S.origin,F)}}function q(n,t){const r=new Float64Array(n.position.length);p(r,n.position,t);const e=n.normal?new Float32Array(n.normal.length):null,o=n.tangent?new Float32Array(n.tangent.length):null;return e&&n.normal&&m(n.normal,e,t),o&&n.tangent&&v(n.tangent,o,t),{position:r,normal:e,tangent:o}}function I(n,t,r,e){const o=J(t,r,e);1!==o&&u(n,n,[o,o,o])}function J(n,t,r){const e=!!(r&tn.SOURCE),o=!!(r&tn.TARGET),l=null==t?void 0:t.sourceUnit,a=null==t?void 0:t.targetUnit;if(!l&&!a)return 1;let i=X(l,n);!e&&l&&1!==i&&(G().warn("source unit conversion not supported"),i=1);let s=1/X(a,n);return!o&&a&&1!==s&&(G().warn("target unit conversion not supported"),s=1),i*s}function X(n,t){if(null==n)return 1;const r=E(t);return 1/S(r,"meters",n)}const Y=F(),Z=F(),$=T(),_=U(),nn=F();var tn,rn;(rn=tn||(tn={}))[rn.NONE=0]="NONE",rn[rn.SOURCE=1]="SOURCE",rn[rn.TARGET=2]="TARGET";export{M,N,X};
