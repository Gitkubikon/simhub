import{fV as t}from"./index-DSIPxOWi.js";var r={},n={},i={};Object.defineProperty(i,"__esModule",{value:!0}),i.loop=i.conditional=i.parse=void 0;i.parse=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(r))r.forEach((function(r){return e(t,r,n,i)}));else if("function"==typeof r)r(t,n,i,e);else{var a=Object.keys(r)[0];Array.isArray(r[a])?(i[a]={},e(t,r[a],n,i[a])):i[a]=r[a](t,n,i,e)}return n};i.conditional=function(t,r){return function(n,i,a,o){r(n,i,a)&&o(n,t,i,a)}};i.loop=function(t,r){return function(n,i,a,o){for(var d=[],s=n.pos;r(n,i,a);){var u={};if(o(n,t,i,u),n.pos===s)break;s=n.pos,d.push(u)}return d}};var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.readBits=a.readArray=a.readUnsigned=a.readString=a.peekBytes=a.readBytes=a.peekByte=a.readByte=a.buildStream=void 0;a.buildStream=function(t){return{data:t,pos:0}};var c=function(){return function(t){return t.data[t.pos++]}};a.readByte=c;a.peekByte=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+t]}};var l=function(t){return function(r){return r.data.subarray(r.pos,r.pos+=t)}};a.readBytes=l;a.peekBytes=function(t){return function(r){return r.data.subarray(r.pos,r.pos+t)}};a.readString=function(t){return function(r){return Array.from(l(t)(r)).map((function(t){return String.fromCharCode(t)})).join("")}};a.readUnsigned=function(t){return function(r){var n=l(2)(r);return t?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};a.readArray=function(t,r){return function(n,i,a){for(var o="function"==typeof r?r(n,i,a):r,d=l(t),s=new Array(o),u=0;u<o;u++)s[u]=d(n);return s}};a.readBits=function(t){return function(r){for(var n=function(t){return t.data[t.pos++]}(r),i=new Array(8),a=0;a<8;a++)i[7-a]=!!(n&1<<a);return Object.keys(t).reduce((function(r,n){var a=t[n];return a.length?r[n]=function(t,r,n){for(var i=0,a=0;a<n;a++)i+=t[r+a]&&Math.pow(2,n-a-1);return i}(i,a.index,a.length):r[n]=i[a.index],r}),{})}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i,n=a,o={blocks:function(t){for(var r=[],i=t.data.length,a=0,o=(0,n.readByte)()(t);0!==o&&o;o=(0,n.readByte)()(t)){if(t.pos+o>=i){var d=i-t.pos;r.push((0,n.readBytes)(d)(t)),a+=d;break}r.push((0,n.readBytes)(o)(t)),a+=o}for(var s=new Uint8Array(a),u=0,f=0;f<r.length;f++)s.set(r[f],u),u+=r[f].length;return s}},d=(0,r.conditional)({gce:[{codes:(0,n.readBytes)(2)},{byteSize:(0,n.readByte)()},{extras:(0,n.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,n.readUnsigned)(!0)},{transparentColorIndex:(0,n.readByte)()},{terminator:(0,n.readByte)()}]},(function(t){var r=(0,n.peekBytes)(2)(t);return 33===r[0]&&249===r[1]})),s=(0,r.conditional)({image:[{code:(0,n.readByte)()},{descriptor:[{left:(0,n.readUnsigned)(!0)},{top:(0,n.readUnsigned)(!0)},{width:(0,n.readUnsigned)(!0)},{height:(0,n.readUnsigned)(!0)},{lct:(0,n.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,n.readArray)(3,(function(t,r,n){return Math.pow(2,n.descriptor.lct.size+1)}))},(function(t,r,n){return n.descriptor.lct.exists})),{data:[{minCodeSize:(0,n.readByte)()},o]}]},(function(t){return 44===(0,n.peekByte)()(t)})),u=(0,r.conditional)({text:[{codes:(0,n.readBytes)(2)},{blockSize:(0,n.readByte)()},{preData:function(t,r,i){return(0,n.readBytes)(i.text.blockSize)(t)}},o]},(function(t){var r=(0,n.peekBytes)(2)(t);return 33===r[0]&&1===r[1]})),f=(0,r.conditional)({application:[{codes:(0,n.readBytes)(2)},{blockSize:(0,n.readByte)()},{id:function(t,r,i){return(0,n.readString)(i.blockSize)(t)}},o]},(function(t){var r=(0,n.peekBytes)(2)(t);return 33===r[0]&&255===r[1]})),p=(0,r.conditional)({comment:[{codes:(0,n.readBytes)(2)},o]},(function(t){var r=(0,n.peekBytes)(2)(t);return 33===r[0]&&254===r[1]})),g=[{header:[{signature:(0,n.readString)(3)},{version:(0,n.readString)(3)}]},{lsd:[{width:(0,n.readUnsigned)(!0)},{height:(0,n.readUnsigned)(!0)},{gct:(0,n.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,n.readByte)()},{pixelAspectRatio:(0,n.readByte)()}]},(0,r.conditional)({gct:(0,n.readArray)(3,(function(t,r){return Math.pow(2,r.lsd.gct.size+1)}))},(function(t,r){return r.lsd.gct.exists})),{frames:(0,r.loop)([d,f,p,s,u],(function(t){var r=(0,n.peekByte)()(t);return 33===r||44===r}))}];t.default=g}(n);var o={};Object.defineProperty(o,"__esModule",{value:!0}),o.deinterlace=void 0;o.deinterlace=function(t,r){for(var n=new Array(t.length),i=t.length/r,a=[0,4,2,1],o=[8,8,4,2],d=0,s=0;s<4;s++)for(var u=a[s];u<i;u+=o[s])f=u,p=d,g=void 0,g=t.slice(p*r,(p+1)*r),n.splice.apply(n,[f*r,r].concat(g)),d++;var f,p,g;return n};var d={};Object.defineProperty(d,"__esModule",{value:!0}),d.lzw=void 0;d.lzw=function(t,r,n){var i,a,o,d,s,u,f,p,g,y,h,m,v,w,x,B,b=4096,k=n,A=new Array(n),U=new Array(b),S=new Array(b),z=new Array(4097);for(s=1+(a=1<<(y=t)),i=a+2,f=-1,o=(1<<(d=y+1))-1,p=0;p<a;p++)U[p]=0,S[p]=p;for(h=m=v=w=x=B=0,g=0;g<k;){if(0===w){if(m<d){h+=r[B]<<m,m+=8,B++;continue}if(p=h&o,h>>=d,m-=d,p>i||p==s)break;if(p==a){o=(1<<(d=y+1))-1,i=a+2,f=-1;continue}if(-1==f){z[w++]=S[p],f=p,v=p;continue}for(u=p,p==i&&(z[w++]=v,p=f);p>a;)z[w++]=S[p],p=U[p];v=255&S[p],z[w++]=v,i<b&&(U[i]=f,S[i]=v,!(++i&o)&&i<b&&(d++,o+=i)),f=u}w--,A[x++]=z[w],g++}for(g=x;g<k;g++)A[g]=0;return A},Object.defineProperty(r,"__esModule",{value:!0});var s=r.decompressFrames=r.decompressFrame=h=r.parseGIF=void 0,u=function I(t){return t&&t.__esModule?t:{default:t}}(n),f=i,p=a,g=o,y=d;var h=r.parseGIF=function(t){var r=new Uint8Array(t);return(0,f.parse)((0,p.buildStream)(r),u.default)},M=function(t,r,n){if(t.image){var i=t.image,a=i.descriptor.width*i.descriptor.height,o=(0,y.lzw)(i.data.minCodeSize,i.data.blocks,a);i.descriptor.lct.interlaced&&(o=(0,g.deinterlace)(o,i.descriptor.width));var d={pixels:o,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return i.descriptor.lct&&i.descriptor.lct.exists?d.colorTable=i.lct:d.colorTable=r,t.gce&&(d.delay=10*(t.gce.delay||10),d.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(d.transparentIndex=t.gce.transparentColorIndex)),n&&(d.patch=function(t){for(var r=t.pixels.length,n=new Uint8ClampedArray(4*r),i=0;i<r;i++){var a=4*i,o=t.pixels[i],d=t.colorTable[o]||[0,0,0];n[a]=d[0],n[a+1]=d[1],n[a+2]=d[2],n[a+3]=o!==t.transparentIndex?255:0}return n}(d)),d}};r.decompressFrame=M;let m,v,w;async function G(r,n){const i=h(r),a=s(i,!0),{width:o,height:d}=i.lsd,u=function P(t,r){return m??(m=document.createElement("canvas")),m.width=t,m.height=r,m.getContext("2d",{willReadFrequently:!0})}(o,d),f=[],p=[];let g=0;for(const s of a){const r=t(s.delay||100);p.push(r),g+=r;const n=(y=new ImageData(s.patch,s.dims.width,s.dims.height),v??(v=document.createElement("canvas")),w??(w=v.getContext("2d",{willReadFrequently:!0})),v.width=y.width,v.height=y.height,w.putImageData(y,0,0),v),i=3===s.disposalType?u.getImageData(s.dims.left,s.dims.top,s.dims.width,s.dims.height):void 0;u.drawImage(n,s.dims.left,s.dims.top);const a=u.getImageData(0,0,o,d);f.push(a),1===s.disposalType||(2===s.disposalType?u.clearRect(s.dims.left,s.dims.top,s.dims.width,s.dims.height):3===s.disposalType&&u.putImageData(i,s.dims.left,s.dims.top))}var y;return{frameCount:a.length,duration:g,frameDurations:p,getFrame:t=>f[t],width:o,height:d}}s=r.decompressFrames=function(t,r){return t.frames.filter((function(t){return t.image})).map((function(n){return M(n,t.gct,r)}))};const x=[71,73,70];function q(t){const r=new Uint8Array(t);return!x.some(((t,n)=>t!==r[n]))}function V(t){if(!q(t))return!1;const r=new DataView(t),n=r.getUint8(10);let i=13+(128&n?3*2**(1+(7&n)):0),a=0,o=!1;for(;!o;){switch(r.getUint8(i++)){case 33:if(!o2())return!1;break;case 44:d2();break;case 59:o=!0;break;default:return!1}if(a>1)return!0}function o2(){switch(r.getUint8(i++)){case 249:!function s2(){i++,i+=4,f2()}();break;case 1:!function c2(){a++,i++,i+=12,f2()}();break;case 254:!function u2(){f2()}();break;case 255:!function l2(){i++,i+=8,i+=3,f2()}();break;default:return!1}return!0}function d2(){a++,i+=8;const t=r.getUint8(i++);i+=128&t?3*2**(1+(7&t)):0,i++,f2()}function f2(){let t;for(;t=r.getUint8(i++);)i+=t}return!1}export{V as isAnimatedGIF,q as isGIF,G as parseGif};
