import{g0 as e,V as t,ej as i,bZ as o,e as s,y as r,a,j0 as n,en as p,eo as d,ep as l,g4 as y,eq as c,gc as h,gd as m,bd as u,i as f,go as g,er as v,j1 as S,b as w,gj as T,gk as _,n as j,gl as I,j2 as O,j3 as x,j4 as L,j5 as b,et as M,gm as N,Z as A}from"./index-DSIPxOWi.js";import{j as D}from"./persistable-Bz3xp-b5.js";import{f as E}from"./SceneModification-yCQPZUfb.js";import"./resourceExtension-BScMZjEL.js";var J;let V=J=class extends(e(t.ofType(E))){constructor(e){super(e),this.url=null}clone(){return new J({url:this.url,items:this.items.map((e=>e.clone()))})}toJSON(e){return this.toArray().map((t=>t.toJSON(e))).filter((e=>!!e.geometry))}static fromJSON(e,t){const i=new J;for(const o of e)i.add(E.fromJSON(o,t));return i}static async fromUrl(e,t,s){const r={url:i(e),origin:"service"},a=await o(e,{responseType:"json",signal:null==s?void 0:s.signal}),n=t.toJSON(),p=[];for(const i of a.data)p.push(E.fromJSON({...i,geometry:{...i.geometry,spatialReference:n}},r));return new J({url:e,items:p})}};s([r({type:String})],V.prototype,"url",void 0),V=J=s([a("esri.layers.support.SceneModifications")],V);const K=V;let P=class extends(n(p(d(l(y(c(h(m(A))))))))){constructor(...e){super(...e),this.geometryType="mesh",this.operationalLayerType="IntegratedMeshLayer",this.type="integrated-mesh",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.profile="mesh-pyramids",this.modifications=null,this._modificationsSource=null,this.path=null}initialize(){this.addHandles(u((()=>this.modifications),"after-changes",(()=>this.modifications=this.modifications),f))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}readModifications(e,t,i){this._modificationsSource={url:g(e,i),context:i}}set elevationInfo(e){this._set("elevationInfo",e),this._validateElevationInfo()}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=null==e?void 0:e.signal;try{await this.loadFromPortal({supportedTypes:["Scene Service"]},e)}catch(i){v(i)}if(await this._fetchService(t),null!=this._modificationsSource){const t=await K.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin("modifications",t,this._modificationsSource.context.origin),this._modificationsSource=null}await this._fetchIndexAndUpdateExtent(this.nodePages,t)}beforeSave(){if(null!=this._modificationsSource)return this.load().then((()=>{}),(()=>{}))}async saveAs(e,t){return this._debouncedSaveOperations(S.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"};return this._debouncedSaveOperations(S.SAVE,e)}validateLayer(e){if(e.layerType&&"IntegratedMesh"!==e.layerType)throw new w("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new w("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new w("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"})}_getTypeKeywords(){return["IntegratedMeshLayer"]}_validateElevationInfo(){const e=this.elevationInfo,t="Integrated mesh layers";T(j.getLogger(this),_(t,"absolute-height",e)),T(j.getLogger(this),I(t,e))}};s([r({type:String,readOnly:!0})],P.prototype,"geometryType",void 0),s([r({type:["show","hide"]})],P.prototype,"listMode",void 0),s([r({type:["IntegratedMeshLayer"]})],P.prototype,"operationalLayerType",void 0),s([r({json:{read:!1},readOnly:!0})],P.prototype,"type",void 0),s([r({type:O,readOnly:!0})],P.prototype,"nodePages",void 0),s([r({type:[x],readOnly:!0})],P.prototype,"materialDefinitions",void 0),s([r({type:[L],readOnly:!0})],P.prototype,"textureSetDefinitions",void 0),s([r({type:[b],readOnly:!0})],P.prototype,"geometryDefinitions",void 0),s([r({readOnly:!0})],P.prototype,"serviceUpdateTimeStamp",void 0),s([r({type:K}),D({origins:["web-scene","portal-item"],type:"resource",prefix:"modifications"})],P.prototype,"modifications",void 0),s([M(["web-scene","portal-item"],"modifications")],P.prototype,"readModifications",null),s([r(N)],P.prototype,"elevationInfo",null),s([r({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],P.prototype,"path",void 0),P=s([a("esri.layers.IntegratedMeshLayer")],P);const U=P;export{U as default};
