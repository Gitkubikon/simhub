import{ex as a,eO as y,V as i}from"./index-DSIPxOWi.js";import{d as L,e as o}from"./portalLayers-CiL_1SNh.js";import{b as c}from"./fetchService-CJQ8-6Ub.js";function t(a,y){return!(!a.layerType||"ArcGISFeatureLayer"!==a.layerType)&&a.featureCollectionType===y}async function l(i,O,V){if(!O)return;const k=O.map((i=>async function G(i,O){return async function f(i,L,o){const s=new i;return s.read(L,o.context),"group"===s.type&&("GroupLayer"===L.layerType?await w(s,L,o):b(L)?function h(a,i,L){i.itemId&&(a.portalItem=new y({id:i.itemId,portal:null==L?void 0:L.portal}),a.when((()=>{var y,o;const t2=y=>{var o,c;const s=y.layerId;F(y,a,i,s,L);const u=null==(c=null==(o=i.featureCollection)?void 0:o.layers)?void 0:c[s];u&&y.read(u,L)};null==(y=a.layers)||y.forEach(t2),null==(o=a.tables)||o.forEach(t2)})))}(s,L,o.context):A(L)&&await async function C(a,y,i){var L;const o=c.FeatureLayer,s=await o(),u=y.featureCollection,p=null==u?void 0:u.showLegend,S=null==(L=null==u?void 0:u.layers)?void 0:L.map(((L,o)=>{const c=new s;c.read(L,i);const u={...i,ignoreDefaults:!0};return F(c,a,y,o,u),null!=p&&c.read({showLegend:p},u),c}));a.layers.addMany(S??[])}(s,L,o.context)),await a(s,o.context),s}(await async function M(a,i){var O,V;const k=i.context,B=function v(a){let y;switch(a.origin){case"web-scene":switch(a.layerContainerType){case"basemap":y=S;break;case"ground":y=u;break;case"tables":y=p;break;default:y=s}break;case"link-chart":switch(a.layerContainerType){case"basemap":y=W;break;case"tables":y=m;break;default:y=T}break;default:switch(a.layerContainerType){case"basemap":y=g;break;case"tables":y=I;break;default:y=d}}return y}(k);let D=a.layerType||a.type;!D&&(null==i?void 0:i.defaultLayerType)&&(D=i.defaultLayerType);const U=B[D];let x=U?c[U]:c.UnknownLayer;if(b(a)){const i=null==k?void 0:k.portal;if(a.itemId){const s=new y({id:a.itemId,portal:i});await s.load();const u=(await L(s,new o)).className||"UnknownLayer";x=c[u]}}else"ArcGISFeatureLayer"===D?function e(a){return t(a,"notes")}(a)||function r(a){return t(a,"markup")}(a)?x=c.MapNotesLayer:function n(a){return t(a,"route")}(a)?x=c.RouteLayer:A(a)&&(x=c.GroupLayer):(null==(O=a.wmtsInfo)?void 0:O.url)&&a.wmtsInfo.layerIdentifier?x=c.WMTSLayer:"WFS"===D&&"2.0.0"!==(null==(V=a.wfsInfo)?void 0:V.version)&&(x=c.UnsupportedLayer);return x()}(i,O),i,O)}(i,V))),B=await Promise.allSettled(k);for(const a of B)"rejected"===a.status||a.value&&i.add(a.value)}const s={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISSceneServiceLayer:"SceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BuildingSceneLayer:"BuildingSceneLayer",CatalogLayer:"CatalogLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",IntegratedMesh3DTilesLayer:"IntegratedMesh3DTilesLayer",IntegratedMeshLayer:"IntegratedMeshLayer",KML:"KMLLayer",LineOfSightLayer:"LineOfSightLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",PointCloudLayer:"PointCloudLayer",RasterDataLayer:"UnsupportedLayer",VectorTileLayer:"VectorTileLayer",Voxel:"VoxelLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},u={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},p={ArcGISFeatureLayer:"FeatureLayer"},S={ArcGISImageServiceLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",DefaultTileLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WMS:"UnsupportedLayer",WebTiledLayer:"WebTileLayer"},d={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",CatalogLayer:"CatalogLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoJSON:"GeoJSONLayer",GeoRSS:"GeoRSSLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",KnowledgeGraphLayer:"KnowledgeGraphLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},I={ArcGISFeatureLayer:"FeatureLayer",SubtypeGroupTable:"UnsupportedLayer"},g={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",DefaultTileLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},T={...d,LinkChartLayer:"LinkChartLayer"},m={...I},W={...g};function A(a){var y,i;return"ArcGISFeatureLayer"===a.layerType&&!b(a)&&((null==(i=null==(y=a.featureCollection)?void 0:y.layers)?void 0:i.length)??0)>1}function b(a){return"Feature Collection"===a.type}async function w(a,y,L){const o=new i,c=l(o,Array.isArray(y.layers)?y.layers:[],L);try{try{if(await c,"group"===a.type)return a.layers.addMany(o),a}catch(s){a.destroy();for(const a of o)a.destroy();throw s}}catch(s){throw s}}function F(a,y,i,L,o){var c;a.read({id:`${y.id}-sublayer-${L}`,visibility:(null==(c=i.visibleLayers)?void 0:c.includes(L))??!0},o)}export{w as populateGroupLayer,l as populateOperationalLayers};
