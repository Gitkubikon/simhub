import{s as e,bd as t,i as r,g as n,kX as s,V as i,e as o,y as l,az as u,et as P,gH as L,a as j,l7 as M,b as q,cD as B,I as W,ej as $,l8 as G,l9 as H,c7 as J,g2 as Z,gp as Q,g3 as Y,g4 as ee,eo as te,ep as re,eq as ne,R as se,er as ie,fz as ae,gq as oe,bZ as le,la as ue,G as pe,gV as de,iP as ce,v as me,jc as fe,g5 as ye,bn as he,bj as ge,g7 as be,gw as xe,ev as ve,Z as we,lb as Se}from"./index-DSIPxOWi.js";import{o as Ne}from"./crsUtils-BYzP3ULO.js";import{a as Ie}from"./ExportWMSImageParameters-QCOpDXr6.js";import{t as Ee}from"./imageBitmapUtils-CleAXumn.js";var Fe;let Oe=0,Re=Fe=class extends(e(M)){constructor(e){super(e),this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.name=null,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.sublayers=null,this.spatialReferences=null,this.title=null,this.addHandles([t((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=this,e.layer=this.layer}),r),t((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),r),n((()=>this.sublayers),((e,t)=>{if(t)for(const r of t)r.layer=r.parent=null;if(e)for(const r of e)r.parent=this,r.layer=this.layer}),r),n((()=>this.layer),(e=>{if(this.sublayers)for(const t of this.sublayers)t.layer=e}),r)])}get id(){return this._get("id")??Oe++}set id(e){this._set("id",e)}readLegendUrl(e,t){return t.legendUrl??t.legendURL??null}get effectiveScaleRange(){const{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}castSublayers(e){return s(i.ofType(Fe),e)}set visible(e){this._setAndNotifyLayer("visible",e)}clone(){var e,t,r;const n=new Fe;return this.hasOwnProperty("description")&&(n.description=this.description),this.hasOwnProperty("fullExtent")&&(n.fullExtent=this.fullExtent.clone()),this.hasOwnProperty("fullExtents")&&(n.fullExtents=(null==(e=this.fullExtents)?void 0:e.map((e=>e.clone())))??null),this.hasOwnProperty("legendUrl")&&(n.legendUrl=this.legendUrl),this.hasOwnProperty("legendEnabled")&&(n.legendEnabled=this.legendEnabled),this.hasOwnProperty("layer")&&(n.layer=this.layer),this.hasOwnProperty("name")&&(n.name=this.name),this.hasOwnProperty("parent")&&(n.parent=this.parent),this.hasOwnProperty("queryable")&&(n.queryable=this.queryable),this.hasOwnProperty("sublayers")&&(n.sublayers=null==(t=this.sublayers)?void 0:t.map((e=>e.clone()))),this.hasOwnProperty("spatialReferences")&&(n.spatialReferences=null==(r=this.spatialReferences)?void 0:r.map((e=>e))),this.hasOwnProperty("visible")&&(n.visible=this.visible),this.hasOwnProperty("title")&&(n.title=this.title),n}_setAndNotifyLayer(e,t){const r=this.layer;this._get(e)!==t&&(this._set(e,t),r&&r.emit("wms-sublayer-update",{propertyName:e,id:this.id}))}};o([l()],Re.prototype,"description",void 0),o([l({readOnly:!0})],Re.prototype,"dimensions",void 0),o([l({type:u,json:{name:"extent"}})],Re.prototype,"fullExtent",void 0),o([l()],Re.prototype,"fullExtents",void 0),o([l({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],Re.prototype,"id",null),o([l({type:String,json:{name:"legendUrl",write:{ignoreOrigin:!0}}})],Re.prototype,"legendUrl",void 0),o([P("legendUrl",["legendUrl","legendURL"])],Re.prototype,"readLegendUrl",null),o([l({type:Boolean,json:{name:"showLegend",origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],Re.prototype,"legendEnabled",void 0),o([l()],Re.prototype,"layer",void 0),o([l()],Re.prototype,"maxScale",void 0),o([l()],Re.prototype,"minScale",void 0),o([l({readOnly:!0})],Re.prototype,"effectiveScaleRange",null),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Re.prototype,"name",void 0),o([l()],Re.prototype,"parent",void 0),o([l({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],Re.prototype,"popupEnabled",void 0),o([l({type:Boolean,json:{write:{ignoreOrigin:!0}}})],Re.prototype,"queryable",void 0),o([l()],Re.prototype,"sublayers",void 0),o([L("sublayers")],Re.prototype,"castSublayers",null),o([l({type:[Number],json:{read:{source:"spatialReferences"}}})],Re.prototype,"spatialReferences",void 0),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Re.prototype,"title",void 0),o([l({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],Re.prototype,"visible",null),Re=Fe=o([j("esri.layers.support.WMSSublayer")],Re);const Pe=Re,Ae={84:4326,83:4269,27:4267};function a(e){if(!e)return null;const t={idCounter:-1};"string"==typeof e&&(e=(new DOMParser).parseFromString(e,"text/xml"));const r=e.documentElement;if("ServiceExceptionReport"===r.nodeName){const e=Array.prototype.slice.call(r.childNodes).map((e=>e.textContent)).join("\r\n");throw new q("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",e)}const n=x("Capability",r),s=x("Service",r),i=n&&x("Request",n);if(!n||!s||!i)return null;const o=x("Layer",n);if(!o)return null;const l="WMS_Capabilities"===r.nodeName||"WMT_MS_Capabilities"===r.nodeName?r.getAttribute("version"):"1.3.0",P=g("Title",s,"")||g("Name",s,""),L=g("AccessConstraints",s,""),j=/^none$/i.test(L)?"":L,M=g("Abstract",s,""),W=parseInt(g("MaxWidth",s,"5000"),10),$=parseInt(g("MaxHeight",s,"5000"),10),G=b(i,"GetMap"),H=y(i,"GetMap"),J=S(o,l,t);if(!J)return null;let Z,Q=0;const Y=Array.prototype.slice.call(n.childNodes),ee=J.sublayers??[],U2=e=>{null!=e&&ee.push(e)};Y.forEach((e=>{"Layer"===e.nodeName&&(0===Q?Z=e:1===Q?(J.name&&(J.name="",U2(S(Z,l,t))),U2(S(e,l,t))):U2(S(e,l,t)),Q++)}));let te=J.sublayers,re=J.extent;const ne=J.fullExtents??[];if(te||(te=[]),0===te.length&&te.push(J),!re){const e=new u(te[0].extent);J.extent=e.toJSON(),re=J.extent}const se=J.spatialReferences.length>0?J.spatialReferences:m(J),ie=y(i,"GetFeatureInfo"),ae=ie?b(i,"GetFeatureInfo"):null,oe=f(te),le=J.minScale||0,ue=J.maxScale||0,pe=J.dimensions??[],de=oe.reduce(((e,t)=>e.concat(t.dimensions??[])),[]),ce=pe.concat(de).filter(C);let me=null;if(ce.length){const e=ce.map((e=>{const{extent:t}=e;return function E(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}(t)?t.map((e=>e.getTime())):null==t?void 0:t.map((e=>[e.min.getTime(),e.max.getTime()]))})).flat(2).filter(B);me={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[Math.min(...e),Math.max(...e)]}}return{copyright:j,description:M,dimensions:pe,extent:re,fullExtents:ne,featureInfoFormats:ae,featureInfoUrl:ie,mapUrl:H,maxWidth:W,maxHeight:$,maxScale:ue,minScale:le,layers:oe,spatialReferences:se,supportedImageFormatTypes:G,timeInfo:me,title:P,version:l}}function m(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(const t of e.sublayers){const e=m(t);if(e.length>0)return e}return[]}function f(e){var t;let r=[];for(const n of e)r.push(n),(null==(t=n.sublayers)?void 0:t.length)&&(r=r.concat(f(n.sublayers)),delete n.sublayers);return r}function d(e,t,r){return t.getAttribute(e)??r}function x(e,t){for(let r=0;r<t.childNodes.length;r++){const n=t.childNodes[r];if(w(n)&&n.nodeName===e)return n}return null}function h(e,t){if(null==t)return[];const r=[];for(let n=0;n<t.childNodes.length;n++){const s=t.childNodes[n];w(s)&&s.nodeName===e&&r.push(s)}return r}function g(e,t,r){var n;return(null==(n=x(e,t))?void 0:n.textContent)??r}function N(e,t,r){if(!e)return null;const n=parseFloat(e.getAttribute("minx")),s=parseFloat(e.getAttribute("miny")),i=parseFloat(e.getAttribute("maxx")),o=parseFloat(e.getAttribute("maxy"));let l,P,L,j;r?(l=isNaN(s)?-Number.MAX_VALUE:s,P=isNaN(n)?-Number.MAX_VALUE:n,L=isNaN(o)?Number.MAX_VALUE:o,j=isNaN(i)?Number.MAX_VALUE:i):(l=isNaN(n)?-Number.MAX_VALUE:n,P=isNaN(s)?-Number.MAX_VALUE:s,L=isNaN(i)?Number.MAX_VALUE:i,j=isNaN(o)?Number.MAX_VALUE:o);const M=new W({wkid:t});return new u({xmin:l,ymin:P,xmax:L,ymax:j,spatialReference:M})}function y(e,t){const r=x(t,e);if(r){const e=x("DCPType",r);if(e){const t=x("HTTP",e);if(t){const e=x("Get",t);if(e){let t=function p(e,t,r,n){const s=x(e,r);return s?d(t,s,n):n}("OnlineResource","xlink:href",e,null);if(t)return t.indexOf("&")===t.length-1&&(t=t.substring(0,t.length-1)),function T(e,t){const r=[],n=$(e);for(const s in n.query)n.query.hasOwnProperty(s)&&(t.includes(s.toLowerCase())||r.push(s+"="+n.query[s]));return n.path+(r.length?"?"+r.join("&"):"")}(t,["service","request"])}}}}return null}function b(e,t){const r=h("Operation",e);if(!r.length)return h("Format",x(t,e)).map((({textContent:e})=>e)).filter(B);const n=[];for(const s of r)if(s.getAttribute("name")===t){const e=h("Format",s);for(const{textContent:t}of e)null!=t&&n.push(t)}return n}function A(e,t,r){const n=x(t,e);if(!n)return r;const{textContent:s}=n;if(null==s||""===s)return r;const i=Number(s);return isNaN(i)?r:i}function S(e,t,r){if(!e)return null;const n={id:r.idCounter++,fullExtents:[],parentLayerId:null,queryable:"1"===e.getAttribute("queryable"),spatialReferences:[],sublayers:null},s=x("LatLonBoundingBox",e),i=x("EX_GeographicBoundingBox",e);let o=null;s&&(o=N(s,4326)),i&&(o=new u(0,0,0,0,new W({wkid:4326})),o.xmin=parseFloat(g("westBoundLongitude",i,"0")),o.ymin=parseFloat(g("southBoundLatitude",i,"0")),o.xmax=parseFloat(g("eastBoundLongitude",i,"0")),o.ymax=parseFloat(g("northBoundLatitude",i,"0"))),s||i||(o=new u(-180,-90,180,90,new W({wkid:4326}))),n.minScale=A(e,"MaxScaleDenominator",0),n.maxScale=A(e,"MinScaleDenominator",0);const l=["1.0.0","1.1.0","1.1.1"].includes(t)?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach((e=>{var s;if("Name"===e.nodeName)n.name=e.textContent||"";else if("Title"===e.nodeName)n.title=e.textContent||"";else if("Abstract"===e.nodeName)n.description=e.textContent||"";else if("BoundingBox"===e.nodeName){const r=e.getAttribute(l);if(r&&0===r.indexOf("EPSG:")){const n=parseInt(r.substring(5),10);0===n||isNaN(n)||o||(o="1.3.0"===t?N(e,n,Ne(n)):N(e,n))}const s=null==r?void 0:r.indexOf(":");if(s&&s>-1){let i=parseInt(r.substring(s+1,r.length),10);0===i||isNaN(i)||(i=Ae[i]??i);const o="1.3.0"===t?N(e,i,Ne(i)):N(e,i);o&&n.fullExtents&&n.fullExtents.push(o)}}else if(e.nodeName===l)((null==(s=e.textContent)?void 0:s.split(" "))??[]).forEach((e=>{const t=e.includes(":")?parseInt(e.split(":")[1],10):parseInt(e,10);if(0!==t&&!isNaN(t)){const e=Ae[t]??t;n.spatialReferences.includes(e)||n.spatialReferences.push(e)}}));else if("Style"!==e.nodeName||n.legendUrl){if("Layer"===e.nodeName){const s=S(e,t,r);s&&(s.parentLayerId=n.id,n.sublayers||(n.sublayers=[]),n.sublayers.push(s))}}else{const t=x("LegendURL",e);if(t){const e=x("OnlineResource",t);e&&(n.legendUrl=e.getAttribute("xlink:href"))}}})),n.extent=null==o?void 0:o.toJSON(),n.dimensions=h("Dimension",e).filter((e=>e.getAttribute("name")&&e.getAttribute("units")&&e.textContent)).map((e=>{const t=e.getAttribute("name"),r=e.getAttribute("units"),n=e.textContent,s=e.getAttribute("unitSymbol")??void 0,i=e.getAttribute("default")??void 0,o="0"!==d("default",e,"0"),l="0"!==d("nearestValue",e,"0"),u="0"!==d("current",e,"0");return C({name:t,units:r})?{name:"time",units:"ISO8601",extent:R(n),default:R(i),multipleValues:o,nearestValue:l,current:u}:function F(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}({name:t,units:r})?{name:"elevation",units:r,extent:I(n),unitSymbol:s,default:I(i),multipleValues:o,nearestValue:l}:{name:t,units:r,extent:v(n),unitSymbol:s,default:v(i),multipleValues:o,nearestValue:l}})),n}function w(e){return e.nodeType===Node.ELEMENT_NODE}function C(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function I(e){if(!e)return;const t=e.includes("/"),r=e.split(",");return t?r.map((e=>{const t=e.split("/");return t.length<2?null:{min:parseFloat(t[0]),max:parseFloat(t[1]),resolution:t.length>=3&&"0"!==t[2]?parseFloat(t[2]):void 0}})).filter(B):r.map((e=>parseFloat(e)))}function v(e){if(!e)return;const t=e.includes("/"),r=e.split(",");return t?r.map((e=>{const t=e.split("/");return t.length<2?null:{min:t[0],max:t[1],resolution:t.length>=3&&"0"!==t[2]?t[2]:void 0}})).filter(B):r}function R(e){if(!e)return;const t=e.includes("/"),r=e.split(",");return t?r.map((e=>{const t=e.split("/");return t.length<2?null:{min:U(t[0]),max:U(t[1]),resolution:t.length>=3&&"0"!==t[2]?V$1(t[2]):void 0}})).filter(B):r.map((e=>U(e)))}function U(e){return G.fromISO(e,{zone:H.utcInstance}).toJSDate()}function V$1(e){const t=e.match(/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i);return t?{years:O(t[1]),months:O(t[2]),days:O(t[3]),hours:O(t[4]),minutes:O(t[5]),seconds:O(t[6])}:null}function O(e){if(!e)return 0;const t=e.match(/(?:\d+(?:\.|,)\d+|\d+)/);if(!t)return 0;const r=t[0].replace(",",".");return Number(r)}function _(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}function k(e){if(!e||e.isAllTime||e.isEmpty)return;const{start:t,end:r}=e;return t&&r&&t.getTime()===r.getTime()?`${_(t)}`:`${t?_(t):"0000-01-01T00:00:00Z"}/${r?_(r):"9999-12-31T23:59:59Z"}`}const Le=new Set([102100,3857,102113,900913]),Ue=new Set([3395,54004]);const je=new J({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});function V(e){return"text/html"===e}function z(e){return"text/plain"===e}let Me=class extends(Z(Q(Y(ee(te(re(ne(we)))))))){constructor(...e){super(...e),this.allSublayers=new se({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.version=null,this.addHandles([t((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=e.layer=this}),r),t((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),r),n((()=>this.sublayers),((e,t)=>{if(t)for(const r of t)r.layer=r.parent=null;if(e)for(const r of e)r.parent=r.layer=this}),r)])}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this.allSublayers.destroy()}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(ie).then((()=>this._fetchService(t)))),Promise.resolve(this)}readFullExtentFromItemOrMap(e,t){const r=t.extent;return r?new u({xmin:r[0][0],ymin:r[0][1],xmax:r[1][0],ymax:r[1][1]}):null}writeFullExtent(e,t){t.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return null==this.featureInfoFormats?null:this.featureInfoFormats.find(V)??this.featureInfoFormats.find(z)??null}set featureInfoFormat(e){null==e?(this.revert("featureInfoFormat","service"),this._clearOverride("featureInfoFormat")):(V(e)||z(e))&&this._override("featureInfoFormat",e)}readImageFormat(e,t){const r=t.supportedImageFormatTypes;return r&&r.includes("image/png")?"image/png":r&&r[0]}readSpatialReferenceFromItemOrDocument(e,t){return new W(t.spatialReferences[0])}writeSpatialReferences(e,t){var r;const n=null==(r=this.spatialReference)?void 0:r.wkid;e&&n?(t.spatialReferences=e.filter((e=>e!==n)),t.spatialReferences.unshift(n)):t.spatialReferences=e}readSublayersFromItemOrMap(e,t,r){return X(t.layers,r,t.visibleLayers)}readSublayers(e,t,r){return X(t.layers,r)}writeSublayers(e,t,r,n){var s,i;t.layers=[];const o=new Map,l=e.flatten((({sublayers:e})=>e??[]));for(const u of l)if("number"==typeof(null==(s=u.parent)?void 0:s.id)){const e=o.get(u.parent.id);null!=e?e.push(u.id):o.set(u.parent.id,[u.id])}for(const u of l){const e={sublayer:u,...n},r=u.write({parentLayerId:"number"==typeof(null==(i=u.parent)?void 0:i.id)?u.parent.id:-1},e);if(o.has(u.id)&&(r.sublayerIds=o.get(u.id)),!u.sublayers&&u.name){const r=u.write({},e);delete r.id,t.layers.push(r)}}t.visibleLayers=l.filter((({visible:e,sublayers:t})=>e&&!t)).map((({name:e})=>e)).toArray()}set url(e){if(!e)return void this._set("url",e);const{path:t,query:r}=$(e);for(const s in r)/^(request|service)$/i.test(s)&&delete r[s];const n=ae(t,r??{});this._set("url",n)}createExportImageParameters(e,t,r,n){const s=(null==n?void 0:n.pixelRatio)??1,i=oe({extent:e,width:t})*s,o=new Ie({layer:this,scale:i}),{xmin:l,ymin:u,xmax:P,ymax:L,spatialReference:j}=e,M=function D(e,t){let r=e.wkid;return null==t?r:(null!=r&&t.includes(r)||!e.latestWkid||(r=e.latestWkid),null!=r&&Le.has(r)?t.find((e=>Le.has(e)))||t.find((e=>Ue.has(e)))||102100:r)}(j,this.spatialReferences),q="1.3.0"===this.version&&Ne(M)?`${u},${l},${L},${P}`:`${l},${u},${P},${L}`,B=o.toJSON(),W="1.3.0"===this.version?"crs":"srs";return{bbox:q,[W]:null==M||isNaN(M)?void 0:"EPSG:"+M,...B}}async fetchImage(e,t,r,n){const s=this.mapUrl,i=this.createExportImageParameters(e,t,r,n);if(!i.layers){const e=document.createElement("canvas");return e.width=t,e.height=r,e}const o=k(null==n?void 0:n.timeExtent),l={responseType:"image",query:this._mixCustomParameters({width:t,height:r,...i,time:o,...this.refreshParameters}),signal:null==n?void 0:n.signal};return le(s??"",l).then((e=>e.data))}async fetchImageBitmap(e,t,r,n){const s=this.mapUrl??"",i=this.createExportImageParameters(e,t,r,n);if(!i.layers){const e=document.createElement("canvas");return e.width=t,e.height=r,e}const o=k(null==n?void 0:n.timeExtent),l={responseType:"blob",query:this._mixCustomParameters({width:t,height:r,...i,time:o,...this.refreshParameters}),signal:null==n?void 0:n.signal},{data:u}=await le(s,l);return Ee(u,s,null==n?void 0:n.signal)}fetchFeatureInfo(e,t,r,n,s){const i=oe({extent:e,width:t}),o=function c(e){const t=e.filter((e=>e.popupEnabled&&e.name&&e.queryable));return t.length?t.map((({name:e})=>e)).join():null}(new Ie({layer:this,scale:i}).visibleSublayers);if(null==this.featureInfoUrl||null==o)return Promise.resolve([]);if(null==this.fetchFeatureInfoFunction&&null==this.featureInfoFormat)return Promise.resolve([]);const l="1.3.0"===this.version?{I:n,J:s}:{x:n,y:s},u={query_layers:o,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:t,height:r,...l},P={...this.createExportImageParameters(e,t,r),...u},L=this._mixCustomParameters(P);return null!=this.fetchFeatureInfoFunction?this.fetchFeatureInfoFunction(L):this._defaultFetchFeatureInfoFunction(ae(this.featureInfoUrl,L))}findSublayerById(e){return this.allSublayers.find((t=>t.id===e))}findSublayerByName(e){return this.allSublayers.find((t=>t.name===e))}serviceSupportsSpatialReference(e){return ue(this.url)||null!=this.spatialReferences&&this.spatialReferences.some((t=>{const r=900913===t?W.WebMercator:new W({wkid:t});return pe(r,e)}))}_defaultFetchFeatureInfoFunction(e){const t=document.createElement("iframe");t.src=de(e),t.style.border="none",t.style.margin="0",t.style.width="100%",t.setAttribute("sandbox","");const r=new ce({title:this.title,content:t}),n=new me({sourceLayer:this,popupTemplate:r});return Promise.resolve([n])}async _fetchService(e){var t;if(!this.resourceInfo&&(null==(t=this.parsedUrl)?void 0:t.path)){const{path:t,query:r}=this.parsedUrl,{data:n}=await le(t,{query:{SERVICE:"WMS",REQUEST:"GetCapabilities",...r,...this.customParameters},responseType:"xml",signal:e});this.resourceInfo=a(n)}if(this.parsedUrl){const e=new fe(this.parsedUrl.path),{httpsDomains:t}=ye.request;"https"!==e.scheme||e.port&&"443"!==e.port||!e.host||t.includes(e.host)||t.push(e.host)}this.read(this.resourceInfo,{origin:"service"})}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;const t={...this.customParameters,...this.customLayerParameters};for(const r in t)e[r.toLowerCase()]=t[r];return e}};function X(e,t,r){e=e??[];const n=new Map;e.every((e=>null==e.id))&&(e=he(e)).forEach(((e,t)=>e.id=t));for(const i of e){const e=new Pe;e.read(i,t),r&&!r.includes(e.name)&&(e.visible=!1),n.set(e.id,e)}const s=[];for(const o of e){const e=null!=o.id?n.get(o.id):null;if(e)if(null!=o.parentLayerId&&o.parentLayerId>=0){const t=n.get(o.parentLayerId);if(!t)continue;t.sublayers||(t.sublayers=new i),t.sublayers.push(e)}else s.push(e)}return s}o([l({readOnly:!0})],Me.prototype,"allSublayers",void 0),o([l({json:{type:Object,write:!0}})],Me.prototype,"customParameters",void 0),o([l({json:{type:Object,write:!0}})],Me.prototype,"customLayerParameters",void 0),o([l({type:String,json:{write:!0}})],Me.prototype,"copyright",void 0),o([l()],Me.prototype,"description",void 0),o([l({readOnly:!0})],Me.prototype,"dimensions",void 0),o([l({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],Me.prototype,"fullExtent",void 0),o([P(["web-document","portal-item"],"fullExtent",["extent"])],Me.prototype,"readFullExtentFromItemOrMap",null),o([ge(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],Me.prototype,"writeFullExtent",null),o([l()],Me.prototype,"fullExtents",void 0),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"featureInfoFormat",null),o([l({type:[String],readOnly:!0})],Me.prototype,"featureInfoFormats",void 0),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"featureInfoUrl",void 0),o([l()],Me.prototype,"fetchFeatureInfoFunction",void 0),o([l({type:String,json:{origins:{"web-document":{default:"image/png",type:je.jsonValues,read:{reader:je.read,source:"format"},write:{writer:je.write,target:"format"}}}}})],Me.prototype,"imageFormat",void 0),o([P("imageFormat",["supportedImageFormatTypes"])],Me.prototype,"readImageFormat",null),o([l({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],Me.prototype,"imageMaxHeight",void 0),o([l({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],Me.prototype,"imageMaxWidth",void 0),o([l()],Me.prototype,"imageTransparency",void 0),o([l(be)],Me.prototype,"legendEnabled",void 0),o([l({type:["show","hide","hide-children"]})],Me.prototype,"listMode",void 0),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"mapUrl",void 0),o([l({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Me.prototype,"isReference",void 0),o([l({type:["WMS"]})],Me.prototype,"operationalLayerType",void 0),o([l()],Me.prototype,"resourceInfo",void 0),o([l({type:W,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],Me.prototype,"spatialReference",void 0),o([P(["web-document","portal-item"],"spatialReference",["spatialReferences"])],Me.prototype,"readSpatialReferenceFromItemOrDocument",null),o([l({type:[xe],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],Me.prototype,"spatialReferences",void 0),o([ge(["web-document","portal-item"],"spatialReferences")],Me.prototype,"writeSpatialReferences",null),o([l({type:i.ofType(Pe),json:{write:{target:"layers",overridePolicy(e,t,r){if(function K(e,t){return e.some((e=>{for(const r in e)if(Se(e,r,null,t))return!0;return!1}))}(this.allSublayers,r))return{ignoreOrigin:!0}}}}})],Me.prototype,"sublayers",void 0),o([P(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],Me.prototype,"readSublayersFromItemOrMap",null),o([P("service","sublayers",["layers"])],Me.prototype,"readSublayers",null),o([ge("sublayers",{layers:{type:[Pe]},visibleLayers:{type:[String]}})],Me.prototype,"writeSublayers",null),o([l({json:{read:!1},readOnly:!0,value:"wms"})],Me.prototype,"type",void 0),o([l(ve)],Me.prototype,"url",null),o([l({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"version",void 0),Me=o([j("esri.layers.WMSLayer")],Me);const _e=Me;export{_e as default};
