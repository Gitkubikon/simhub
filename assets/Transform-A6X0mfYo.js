import{lO as e,lP as n,lQ as r,ha as s,G as o,dt as a,hd as l,lR as c,bc as u,S as d,lS as h,dj as p,dk as v,O as m,n as E,bo as _,cI as R,gO as x,cy as g,gy as y,e as S,y as C,a as b,bV as O,bp as M,Q as N}from"./index-DSIPxOWi.js";import{a as w}from"./RenderTexture-DbJC7CTU.js";function f(u,d,h,p){if(null==d||null==p)return!1;const v=e(d,n),m=e(p,r);if(v===m&&v!==s.UNKNOWN||o(d,p))return h[0]=1,h[1]=1,h[2]=1,!0;if(v===s.SPHERICAL_ECEF){const e=a(u),n=e/Math.sqrt(u[0]*u[0]+u[1]*u[1]),r=e/l.radius;if(m===s.WEB_MERCATOR)return h[0]=n*r,h[1]=n*r,h[2]=1,!0;if(m===s.WGS84||m===s.CGCS2000){const e=c;return h[0]=e*n*r,h[1]=e*r,h[2]=1,!0}}else if(v===s.PLATE_CARREE){if(m===s.WGS84||m===s.CGCS2000)return h[0]=c,h[1]=c,h[2]=1,!0;if(m===s.WEB_MERCATOR){const e=u[1]/l.radius;return h[0]=1,h[1]=1/Math.cos(e),h[2]=1,!0}}return!1}let H=class extends(u.EventedMixin(d)){constructor(e){super(e),this._tmpEvent=new h,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=p(this.view.state.viewingMode),this._intersector.options.store=v.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return null==(n=null==(e=this.view)?void 0:e.elevationProvider)?void 0:n.spatialReference}getElevation(e,n,r,s){const o=this._renderCoordsHelper,a=m(A,e,n,r);if(!o.toRenderCoords(a,s,a))return E.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:l,_intersector:c,intersectionHandler:u}=this,d=l.fullExtent,h=null!=d&&Number.isFinite(d.xmin)&&Number.isFinite(d.xmax)&&Number.isFinite(d.ymin)&&Number.isFinite(d.ymax)&&Number.isFinite(d.zmin)&&Number.isFinite(d.zmax)?new _(d.zmin,d.zmax):l.elevationRange;if(null==h)return null;const p=l.elevationOffset,v=h.elevationRangeMin+p,R=h.elevationRangeMax+p,x=o.setAltitude(F,R,a),g=o.setAltitude(G,v,a);return c.reset(x,g,null),u.intersect(c,null,x,g,null,!0),c.results.min.getIntersectionPoint(a)?o.getAltitude(a):null}getSphereElevationBounds(e,n){return w(e,n,z,this._renderSR),this._layerElevationSource.getElevationRange(z)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return(null==e?void 0:e.hasZ)?new _(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){R(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){R(n);for(const r of e)this._expandExtent(r,n)}_expandExtent(e,n){const r=this.spatialReference;if(null==r)return;if(null==e)return;x(j,e.quaternion),j[12]=e.center[0],j[13]=e.center[1],j[14]=e.center[2];const s=e.halfSize;for(let o=0;o<8;++o)A[0]=1&o?s[0]:-s[0],A[1]=2&o?s[1]:-s[1],A[2]=4&o?s[2]:-s[2],g(A,A,j),this._renderCoordsHelper.fromRenderCoords(A,A,r),y(n,A,n)}};S([C({constructOnly:!0})],H.prototype,"layerElevationSource",void 0),S([C({constructOnly:!0})],H.prototype,"intersectionHandler",void 0),S([C({constructOnly:!0})],H.prototype,"view",void 0),S([C()],H.prototype,"spatialReference",null),H=S([b("esri.views.3d.layers.i3s.LayerElevationProvider")],H);const j=O(),z=M(0,0,0,0),A=N(),F=N(),G=N();class t{constructor(e,n,r,s){this.toMapSpace=e,this.transform=n,this.obb=r,this.geometry=s}}class i{constructor(e,n){this.position=e,this.rotationScale=n,this.origin=void 0}}export{f,i,t,H as x};
