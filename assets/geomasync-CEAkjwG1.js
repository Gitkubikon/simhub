import{jP as t,bZ as e,g_ as r,az as a,ax as i,aw as s,j as o,ay as l,gM as u,ez as c,jQ as f,d9 as d}from"./index-DSIPxOWi.js";import{a0 as w,a as h,X as m,v as y,w as p,m as v,b as g,r as P,U as I,Q as A,Z as F,B as R,P as b,af as x,ag as N,ah as j,g as O,F as S,ai as D,aj as T,E as L,ak as C,N as U,A as Z,al as J,am as z,I as M,an as q,ao as k}from"./arcadeUtils-CHsZDnQG.js";import{c as E,r as W,b as B}from"./TimeOnly-C5lZbbIX.js";import{l as V}from"./portalUtils-CJNVYHNM.js";import{disjoint as H,intersects as Q,touches as _,crosses as G,within as K,contains as X,overlaps as Y,equals as $,relate as nn,intersect as tn,union as en,difference as rn,symmetricDifference as an,clip as sn,cut as on,planarArea as ln,geodesicArea as un,planarLength as cn,geodesicLength as fn,distance as dn,densify as wn,geodesicDensify as hn,generalize as mn,buffer as yn,geodesicBuffer as pn,offset as vn,rotate as gn,simplify as Pn,isSimple as In,convexHull as An,nearestCoordinate as bn,nearestVertex as Nn}from"./geometryEngineAsync--5NbEF1a.js";import"./ImmutableArray-BLzlMo4D.js";import"./number-DXNV0RYc.js";import"./hash-BjBdcEEU.js";async function n(r,a,i){var s,o;if(!(null==(s=t)?void 0:s.findCredential(r.restUrl)))return null;if("loaded"===r.loadStatus&&""===a&&(null==(o=r.user)?void 0:o.sourceJSON)&&!1===i)return r.user.sourceJSON;const l={responseType:"json",query:{f:"json"}};if(i&&(l.query.returnUserLicenseTypeExtensions=!0),""===a){const t=await e(r.restUrl+"/community/self",l);if(t.data){const e=t.data;if(null==e?void 0:e.username)return e}return null}const u=await e(r.restUrl+"/community/users/"+a,l);if(u.data){const t=u.data;return t.error?null:t}return null}function Fn(t){return 0===f.indexOf("4.")?o.fromExtent(t):new o({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function Rn(t,e,a){if(h(t,2,2,e,a),t[0]instanceof r&&t[1]instanceof r);else if(t[0]instanceof r&&null===t[1]);else if(t[1]instanceof r&&null===t[0]);else if(null!==t[0]||null!==t[1])throw new g(e,P.InvalidParameter,a)}async function jn(t,e){if("polygon"!==t.type&&"polyline"!==t.type&&"extent"!==t.type)return 0;let r=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(r=q(t.spatialReference)/d(t.spatialReference));let a=0;if("polyline"===t.type)for(const i of t.paths)for(let t=1;t<i.length;t++)a+=k(i[t],i[t-1],r);else if("polygon"===t.type)for(const i of t.rings){for(let t=1;t<i.length;t++)a+=k(i[t],i[t-1],r);(i[0][0]!==i[i.length-1][0]||i[0][1]!==i[i.length-1][1]||void 0!==i[0][2]&&i[0][2]!==i[i.length-1][2])&&(a+=k(i[0],i[i.length-1],r))}else"extent"===t.type&&(a+=2*k([t.xmin,t.ymin,0],[t.xmax,t.ymin,0],r),a+=2*k([t.xmin,t.ymin,0],[t.xmin,t.ymax,0],r),a*=2,a+=4*Math.abs(b(t.zmax,0)*r-b(t.zmin,0)*r));const s=new i({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:[[0,0],[0,a]]});return cn(s,e)}function xn(t){"async"===t.mode&&(t.functions.disjoint=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null===i[0]||null===i[1]||H(i[0],i[1]))))},t.functions.intersects=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&Q(i[0],i[1]))))},t.functions.touches=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&_(i[0],i[1]))))},t.functions.crosses=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&G(i[0],i[1]))))},t.functions.within=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&K(i[0],i[1]))))},t.functions.contains=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&X(i[0],i[1]))))},t.functions.overlaps=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null!==i[0]&&null!==i[1]&&Y(i[0],i[1]))))},t.functions.equals=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>(h(s,2,2,e,a),s[0]===s[1]||(s[0]instanceof r&&s[1]instanceof r?$(s[0],s[1]):(m(s[0])&&m(s[1])||!!(y(s[0])&&y(s[1])||p(s[0])&&p(s[1])))&&s[0].equals(s[1])))))},t.functions.relate=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,3,3,e,a),s[0]instanceof r&&s[1]instanceof r)return nn(s[0],s[1],v(s[2]));if(s[0]instanceof r&&null===s[1])return!1;if(s[1]instanceof r&&null===s[0])return!1;if(null===s[0]&&null===s[1])return!1;throw new g(e,P.InvalidParameter,a)}))},t.functions.intersection=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null===i[0]||null===i[1]?null:tn(i[0],i[1]))))},t.functions.union=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{const o=[];if(0===(s=w(s)).length)throw new g(e,P.WrongNumberOfParameters,a);if(1===s.length)if(I(s[0])){const t=w(s[0]);for(let i=0;i<t.length;i++)if(null!==t[i]){if(!(t[i]instanceof r))throw new g(e,P.InvalidParameter,a);o.push(t[i])}}else{if(!A(s[0])){if(s[0]instanceof r)return F(E(s[0]),e.spatialReference);if(null===s[0])return null;throw new g(e,P.InvalidParameter,a)}{const t=w(s[0].toArray());for(let i=0;i<t.length;i++)if(null!==t[i]){if(!(t[i]instanceof r))throw new g(e,P.InvalidParameter,a);o.push(t[i])}}}else for(let l=0;l<s.length;l++)if(null!==s[l]){if(!(s[l]instanceof r))throw new g(e,P.InvalidParameter,a);o.push(s[l])}return 0===o.length?null:en(o)}))},t.functions.difference=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null===i[0]?null:null===i[1]?E(i[0]):rn(i[0],i[1]))))},t.functions.symmetricdifference=function(e,r){return t.standardFunctionAsync(e,r,((t,a,i)=>(Rn(i=w(i),e,r),null===i[0]&&null===i[1]?null:null===i[0]?E(i[1]):null===i[1]?E(i[0]):an(i[0],i[1]))))},t.functions.clip=function(e,i){return t.standardFunctionAsync(e,i,((t,s,o)=>{if(o=w(o),h(o,2,2,e,i),!(o[1]instanceof a)&&null!==o[1])throw new g(e,P.InvalidParameter,i);if(null===o[0])return null;if(!(o[0]instanceof r))throw new g(e,P.InvalidParameter,i);return null===o[1]?null:sn(o[0],o[1])}))},t.functions.cut=function(e,a){return t.standardFunctionAsync(e,a,((t,s,o)=>{if(o=w(o),h(o,2,2,e,a),!(o[1]instanceof i)&&null!==o[1])throw new g(e,P.InvalidParameter,a);if(null===o[0])return[];if(!(o[0]instanceof r))throw new g(e,P.InvalidParameter,a);return null===o[1]?[E(o[0])]:on(o[0],o[1])}))},t.functions.area=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,s)=>{if(h(s,1,2,e,a),null===(s=w(s))[0])return 0;if(R(s[0])){const t=await s[0].sumArea(W(b(s[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new g(e,P.Cancelled,a);return t}if(I(s[0])||A(s[0])){const t=x(s[0],e.spatialReference);return null===t?0:ln(t,W(b(s[1],-1)))}if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return ln(s[0],W(b(s[1],-1)))}))},t.functions.areageodetic=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,s)=>{if(h(s,1,2,e,a),null===(s=w(s))[0])return 0;if(R(s[0])){const t=await s[0].sumArea(W(b(s[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new g(e,P.Cancelled,a);return t}if(I(s[0])||A(s[0])){const t=x(s[0],e.spatialReference);return null===t?0:un(t,W(b(s[1],-1)))}if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return un(s[0],W(b(s[1],-1)))}))},t.functions.length=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,s)=>{if(h(s,1,2,e,a),null===(s=w(s))[0])return 0;if(R(s[0])){const t=await s[0].sumLength(B(b(s[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new g(e,P.Cancelled,a);return t}if(I(s[0])||A(s[0])){const t=N(s[0],e.spatialReference);return null===t?0:cn(t,B(b(s[1],-1)))}if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return cn(s[0],B(b(s[1],-1)))}))},t.functions.length3d=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(h(s,1,2,e,a),null===(s=w(s))[0])return 0;if(I(s[0])||A(s[0])){const t=N(s[0],e.spatialReference);return null===t?0:!0===t.hasZ?jn(t,B(b(s[1],-1))):cn(t,B(b(s[1],-1)))}if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return!0===s[0].hasZ?jn(s[0],B(b(s[1],-1))):cn(s[0],B(b(s[1],-1)))}))},t.functions.lengthgeodetic=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,s)=>{if(h(s,1,2,e,a),null===(s=w(s))[0])return 0;if(R(s[0])){const t=await s[0].sumLength(B(b(s[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new g(e,P.Cancelled,a);return t}if(I(s[0])||A(s[0])){const t=N(s[0],e.spatialReference);return null===t?0:fn(t,B(b(s[1],-1)))}if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return fn(s[0],B(b(s[1],-1)))}))},t.functions.distance=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{s=w(s),h(s,2,3,e,a);let o=s[0];(I(s[0])||A(s[0]))&&(o=j(s[0],e.spatialReference));let l=s[1];if((I(s[1])||A(s[1]))&&(l=j(s[1],e.spatialReference)),!(o instanceof r))throw new g(e,P.InvalidParameter,a);if(!(l instanceof r))throw new g(e,P.InvalidParameter,a);return dn(o,l,B(b(s[2],-1)))}))},t.functions.distancegeodetic=function(e,r){return t.standardFunctionAsync(e,r,((t,a,o)=>{o=w(o),h(o,2,3,e,r);const l=o[0],u=o[1];if(!(l instanceof s))throw new g(e,P.InvalidParameter,r);if(!(u instanceof s))throw new g(e,P.InvalidParameter,r);const c=new i({paths:[],spatialReference:l.spatialReference});return c.addPath([l,u]),fn(c,B(b(o[2],-1)))}))},t.functions.densify=function(e,s){return t.standardFunctionAsync(e,s,((t,l,u)=>{if(u=w(u),h(u,2,3,e,s),null===u[0])return null;if(!(u[0]instanceof r))throw new g(e,P.InvalidParameter,s);const c=O(u[1]);if(isNaN(c))throw new g(e,P.InvalidParameter,s);if(c<=0)throw new g(e,P.InvalidParameter,s);return u[0]instanceof o||u[0]instanceof i?wn(u[0],c,B(b(u[2],-1))):u[0]instanceof a?wn(Fn(u[0]),c,B(b(u[2],-1))):u[0]}))},t.functions.densifygeodetic=function(e,s){return t.standardFunctionAsync(e,s,((t,l,u)=>{if(u=w(u),h(u,2,3,e,s),null===u[0])return null;if(!(u[0]instanceof r))throw new g(e,P.InvalidParameter,s);const c=O(u[1]);if(isNaN(c))throw new g(e,P.InvalidParameter,s);if(c<=0)throw new g(e,P.InvalidParameter,s);return u[0]instanceof o||u[0]instanceof i?hn(u[0],c,B(b(u[2],-1))):u[0]instanceof a?hn(Fn(u[0]),c,B(b(u[2],-1))):u[0]}))},t.functions.generalize=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,2,4,e,a),null===s[0])return null;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);const o=O(s[1]);if(isNaN(o))throw new g(e,P.InvalidParameter,a);return mn(s[0],o,S(b(s[2],!0)),B(b(s[3],-1)))}))},t.functions.buffer=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,2,3,e,a),null===s[0])return null;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);const o=O(s[1]);if(isNaN(o))throw new g(e,P.InvalidParameter,a);return 0===o?E(s[0]):yn(s[0],o,B(b(s[2],-1)))}))},t.functions.buffergeodetic=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,2,3,e,a),null===s[0])return null;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);const o=O(s[1]);if(isNaN(o))throw new g(e,P.InvalidParameter,a);return 0===o?E(s[0]):pn(s[0],o,B(b(s[2],-1)))}))},t.functions.offset=function(e,r){return t.standardFunctionAsync(e,r,((t,a,s)=>{if(s=w(s),h(s,2,6,e,r),null===s[0])return null;if(!(s[0]instanceof o||s[0]instanceof i))throw new g(e,P.InvalidParameter,r);const l=O(s[1]);if(isNaN(l))throw new g(e,P.InvalidParameter,r);const u=O(b(s[4],10));if(isNaN(u))throw new g(e,P.InvalidParameter,r);const c=O(b(s[5],0));if(isNaN(c))throw new g(e,P.InvalidParameter,r);return vn(s[0],l,B(b(s[2],-1)),v(b(s[3],"round")).toLowerCase(),u,c)}))},t.functions.rotate=function(e,i){return t.standardFunctionAsync(e,i,((t,l,u)=>{if(u=w(u),h(u,2,3,e,i),null===u[0])return null;if(!(u[0]instanceof r))throw new g(e,P.InvalidParameter,i);const c=u[0]instanceof a?o.fromExtent(u[0]):u[0],f=O(u[1]);if(isNaN(f))throw new g(e,P.InvalidParameter,i);const d=b(u[2],null);if(null===d)return gn(c,f);if(d instanceof s)return gn(c,f,d);throw new g(e,P.InvalidParameter,i)}))},t.functions.centroid=function(e,u){return t.standardFunctionAsync(e,u,((t,c,f)=>{if(f=w(f),h(f,1,1,e,u),null===f[0])return null;let d=f[0];if((I(f[0])||A(f[0]))&&(d=j(f[0],e.spatialReference)),null===d)return null;if(!(d instanceof r))throw new g(e,P.InvalidParameter,u);return d instanceof s?F(E(d),e.spatialReference):d instanceof o?d.centroid:d instanceof i?D(d):d instanceof l?T(d):d instanceof a?d.center:null}))},t.functions.measuretocoordinate=function(e,a){return t.standardFunctionAsync(e,a,((t,s,o)=>{if(o=w(o),h(o,2,2,e,a),null===o[0])return null;let l=o[0];if((I(o[0])||A(o[0]))&&(l=N(o[0],e.spatialReference)),null===l)return null;if(!(l instanceof r))throw new g(e,P.InvalidParameter,a);if(!(l instanceof i))throw new g(e,P.InvalidParameter,a);if(L(!1===o[1]))throw new g(e,P.InvalidParameter,a);const u=C(l,o[1]);return u?U.convertObjectToArcadeDictionary(u,Z(e),!1,!0):null}))},t.functions.pointtocoordinate=function(e,a){return t.standardFunctionAsync(e,a,((t,o,l)=>{if(l=w(l),h(l,2,2,e,a),null===l[0])return null;let u=l[0];if((I(l[0])||A(l[0]))&&(u=N(l[0],e.spatialReference)),null===u)return null;if(!(u instanceof r))throw new g(e,P.InvalidParameter,a);if(!(u instanceof i))throw new g(e,P.InvalidParameter,a);const c=l[1];if(null===c)return null;if(!(c instanceof s))throw new g(e,P.InvalidParameter,a);if(L(!1===l[1]))throw new g(e,P.InvalidParameter,a);const f=J(u,c);return f?U.convertObjectToArcadeDictionary(f,Z(e),!1,!0):null}))},t.functions.distancetocoordinate=function(e,a){return t.standardFunctionAsync(e,a,((t,s,o)=>{if(o=w(o),h(o,2,2,e,a),null===o[0])return null;let l=o[0];if((I(o[0])||A(o[0]))&&(l=N(o[0],e.spatialReference)),null===l)return null;if(!(l instanceof r))throw new g(e,P.InvalidParameter,a);if(!(l instanceof i))throw new g(e,P.InvalidParameter,a);if(L(!1===o[1]))throw new g(e,P.InvalidParameter,a);const u=z(l,o[1]);return u?U.convertObjectToArcadeDictionary(u,Z(e),!1,!0):null}))},t.functions.multiparttosinglepart=function(e,c){return t.standardFunctionAsync(e,c,(async(t,f,d)=>{if(d=w(d),h(d,1,1,e,c),null===d[0])return null;if(!(d[0]instanceof r))throw new g(e,P.InvalidParameter,c);if(d[0]instanceof s)return[F(E(d[0]),e.spatialReference)];if(d[0]instanceof a)return[F(E(d[0]),e.spatialReference)];const m=await Pn(d[0]);if(m instanceof o){const t=[],e=[];for(let r=0;r<m.rings.length;r++)if(m.isClockwise(m.rings[r])){const e=u({rings:[m.rings[r]],hasZ:!0===m.hasZ,hasM:!0===m.hasM,spatialReference:m.spatialReference.toJSON()});t.push(e)}else e.push({ring:m.rings[r],pt:m.getPoint(r,0)});for(let r=0;r<e.length;r++)for(let a=0;a<t.length;a++)if(t[a].contains(e[r].pt)){t[a].addRing(e[r].ring);break}return t}if(m instanceof i){const t=[];for(let e=0;e<m.paths.length;e++){const r=u({paths:[m.paths[e]],hasZ:!0===m.hasZ,hasM:!0===m.hasM,spatialReference:m.spatialReference.toJSON()});t.push(r)}return t}if(d[0]instanceof l){const t=[],r=F(E(d[0]),e.spatialReference);for(let e=0;e<r.points.length;e++)t.push(r.getPoint(e));return t}return null}))},t.functions.issimple=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,1,1,e,a),null===s[0])return!0;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return In(s[0])}))},t.functions.simplify=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,1,1,e,a),null===s[0])return null;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return Pn(s[0])}))},t.functions.convexhull=function(e,a){return t.standardFunctionAsync(e,a,((t,i,s)=>{if(s=w(s),h(s,1,1,e,a),null===s[0])return null;if(!(s[0]instanceof r))throw new g(e,P.InvalidParameter,a);return An(s[0])}))},t.functions.getuser=function(e,r){return t.standardFunctionAsync(e,r,(async(t,a,i)=>{var s,o;h(i,0,2,e,r);let l=b(i[1],""),u=!0===l;if(l=!0===l||!1===l?"":v(l),0===i.length||i[0]instanceof M){let t;t=(null==(s=e.services)?void 0:s.portal)?e.services.portal:c.getDefault(),i.length>0&&(t=V(i[0],t));const r=await n(t,l,u);if(r){const t=JSON.parse(JSON.stringify(r));for(const e of["lastLogin","created","modified"])void 0!==t[e]&&null!==t[e]&&(t[e]=new Date(t[e]));return U.convertObjectToArcadeDictionary(t,Z(e))}return null}let f=null;if(R(i[0])&&(f=i[0]),f){if(u=!1,l)return null;await f.load();const t=await f.getOwningSystemUrl();if(!t){if(!l){const t=await f.getIdentityUser();return t?U.convertObjectToArcadeDictionary({username:t},Z(e)):null}return null}let r;r=(null==(o=e.services)?void 0:o.portal)?e.services.portal:c.getDefault(),r=V(new M(t),r);const a=await n(r,l,u);if(a){const t=JSON.parse(JSON.stringify(a));for(const e of["lastLogin","created","modified"])void 0!==t[e]&&null!==t[e]&&(t[e]=new Date(t[e]));return U.convertObjectToArcadeDictionary(t,Z(e))}return null}throw new g(e,P.InvalidParameter,r)}))},t.functions.nearestcoordinate=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,o)=>{if(o=w(o),h(o,2,2,e,a),!(o[0]instanceof r||null===o[0]))throw new g(e,P.InvalidParameter,a);if(!(o[1]instanceof s||null===o[1]))throw new g(e,P.InvalidParameter,a);if(null===o[0]||null===o[1])return null;const l=await bn(o[0],o[1]);return null===l?null:U.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},Z(e),!1,!0)}))},t.functions.nearestvertex=function(e,a){return t.standardFunctionAsync(e,a,(async(t,i,o)=>{if(o=w(o),h(o,2,2,e,a),!(o[0]instanceof r||null===o[0]))throw new g(e,P.InvalidParameter,a);if(!(o[1]instanceof s||null===o[1]))throw new g(e,P.InvalidParameter,a);if(null===o[0]||null===o[1])return null;const l=await Nn(o[0],o[1]);return null===l?null:U.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},Z(e),!1,!0)}))})}export{xn as registerFunctions};
