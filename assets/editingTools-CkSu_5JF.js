const __vite__fileDeps=["assets/calcite-button-BNKeIR-C.js","assets/index-DSIPxOWi.js","assets/index-B_7YxLDX.css","assets/form-BR8JUNQO.js","assets/dom-CG95YN3b.js","assets/guid-DBupVat2.js","assets/interactive-Dv2N9_bt.js","assets/label-B0K2ZKoz.js","assets/component-BaDXbCam.js","assets/loadable-TuT7-EDA.js","assets/t9n-Dkvwz2Wg.js","assets/key-Bjfr4614.js","assets/observers-4D3dvPBC.js","assets/icon-DN35inCc.js","assets/loader-DnD0exo2.js","assets/calcite-icon-I_Xwj0DW.js","assets/calcite-input-Ch73Rboo.js","assets/input2-FN40mhAY.js","assets/calcite-dropdown-BaxqQ9bY.js","assets/floating-ui-BBcbf-ex.js","assets/debounce-Z6QnFls1.js","assets/openCloseComponent-DPRdqyP2.js","assets/calcite-dropdown-item-1XlYGPpf.js","assets/resources3-C6ETc1g5.js","assets/calcite-dropdown-group-DO1CdXTp.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as g,y as _,a as S,S as O,x as T,qU as I,b3 as k,g as C,bd as $,a0 as B,ak as K,oi as J,oI as tt,um as et,tn as it,tA as nt,hD as ot,kg as st,d1 as at,nY as rt,cX as lt,e3 as ct,p1 as pt,un as ut,k8 as dt,ee as ht,c_ as vt,l_ as gt,oh as mt,dv as ft,Q as _t,A as yt,uo as bt,ec as Mt,bc as xt,dJ as St,dM as Ot,dN as Rt,O as Ct,dD as Dt,dC as At,dO as $t,up as Pt,dP as Vt,kr as Lt,dW as zt,hi as Ht,fE as Ut,e0 as Gt,uq as Ft,e2 as Nt,ji as Zt,j8 as Bt,V as Yt,h as Xt,ae as Wt,ur as qt,us as Kt,ut as Jt,aw as Qt,I as te,da as ee,b as ie,db as ne,uu as oe,j as se,aI as ae,n1 as re,uv as le,h2 as ce,h3 as pe,uw as ue,lM as de,ux as he,bX as ve,qN as ge,dB as me,cx as fe,N as _e,L as be,uy as Me,uz as we,fH as Se,cD as Oe,ay as Te,ax as Ee,uA as Ie,bn as ke,bY as Re,fw as Ce,kj as De,uB as Ae,d9 as $e,pi as Pe,p9 as je,H as Ve,du as Le,tN as ze,uC as He,tr as Ue,l$ as Ge,uD as Fe,tK as Ne,uE as Ze,aC as Be,mb as Ye,pY as Xe,cd as We,tB as qe,i9 as Ke,bO as Je,oz as Qe,cb as ti,cM as ei,id as ii,cU as ni,uF as oi,bE as si,uG as ai,uH as ri,hI as li,uI as ci,uJ as pi,uK as ui,uL as di,nc as hi,ne as vi,nb as gi,uc as mi,t_ as fi,nd as _i,_ as yi,mO as bi,u4 as Mi,uM as wi,i8 as xi,uN as Si,uO as Oi,uP as Ti,uQ as Ei,uR as Ii,u as ki,nj as Ri,tZ as Ci,gD as Di,uS as Ai,v as $i,uT as Pi,kH as ji,ku as Vi,U as Li,lZ as zi,h6 as Hi,pj as Ui,on as Gi,ds as Fi,uU as Ni,P as Zi,oK as Bi,e1 as Yi,p as Xi,nZ as Wi,ts as qi,i as Ki,uV as Ji,lc as Qi,uW as tn,cz as en,cC as nn,uX as on,F as sn,uY as an,cw as rn,uZ as ln,u_ as cn,u$ as pn,v0 as un,dy as dn,dz as hn,dx as vn,sm as gn,v1 as mn,ki as fn,hP as _n,p_ as yn,pg as bn,ke as Mn,hS as wn,oL as xn,oN as Sn,v2 as On,bM as Tn,ca as En,dt as In,ol as kn,gT as Rn,ph as Cn,bP as Dn,bQ as An,ge as $n,iu as Pn,mY as jn,mZ as Vn,m_ as Ln,ch as zn,ci as Hn,v3 as Un,oM as Gn,e7 as Fn,lf as Nn,pf as Zn,tL as Bn,aM as Yn,v4 as Xn,bV as Wn,p3 as qn,v5 as Kn,v6 as Jn,v7 as Qn,v8 as to,oQ as eo,mU as io,dr as no,mT as oo,v9 as so,va as ao,e8 as ro,ss as lo,mQ as co,dp as po,c$ as uo,vb as ho,vc as vo,cW as go,vd as mo,cu as fo,hM as _o,c5 as yo,ve as bo,vf as Mo,dm as wo,J as xo,d8 as So,e6 as Oo}from"./index-DSIPxOWi.js";import{e as To,a as Eo,x as Io,k as ko,C as Ro,F as Co,S as Do,U as Ao,q as $o}from"./TextOverlayItem-BcN_gvXw.js";import{u as Po,c as jo,m as Vo,p as Lo,e as zo,f as Ho,R as Uo,d as Go}from"./SnappingOperation-CpAicAwN.js";import{l as Fo,b as No,A as Zo,r as Bo,u as Yo}from"./geodesicLengthMeasurementUtils-Pq-FipkN.js";import{j as Xo,A as Wo,t as qo,n as Ko,c as Jo,u as Qo,a as ts,b as es,o as is,q as ns,f as os,i as ss,m as as,k as rs,I as ls,d as cs,p as ps,g as us,e as ds,l as hs,h as vs,r as gs,x as ms,P as fs,s as _s,v as ys,w as bs,y as Ms,z as ws}from"./MoveManipulation-4UnOjdbg.js";import{G as xs}from"./ExtendedLineVisualElement-C_fk7Jva.js";import{r as Ss,t as Os}from"./vec4f32-APunXZaC.js";import{t as Ts}from"./EngineVisualElement-Cxk2Aaf7.js";import{c as Es}from"./Laserlines.glsl-C_dc6leb.js";import{a as Is,i as ks}from"./dehydratedFeatureComparison-dI04k89u.js";import{simplify as Rs,distance as Cs}from"./geometryEngine-Bp1TD6MM.js";import{e as Ds,r as As}from"./MediaLayerView3D-D6RJug-G.js";import{t as $s,u as Ps,w as js,Z as Vs,x as Ls,z as zs,A as Hs,B as Us,C as Gs,M as Fs,D as Ns,R as Zs,I as Bs,g as Ys,U as Xs,F as Ws,G as qs,H as Ks,L as Js,N as Qs}from"./SnappingManagerPool-BslN_FM5.js";import{N as ta}from"./MeshTransform-Y0ppddED.js";import{f as ea,p as ia}from"./keybindings-DkkJsHdp.js";import{U as na,o as oa,j as sa}from"./euclideanAreaMeasurementUtils-D_-Y3voK.js";import{n as aa,p as ra,D as la,t as ca,e as pa,v as ua,j as da,S as ha,z as va,d as ga,l as ma,c as fa,M as _a,F as ya,a as ba,U as Ma,w as wa,o as xa}from"./ShadedColorMaterial.glsl-C-XXTK_B.js";import{t as Sa}from"./memoize-Dzy0sPL8.js";import{b as Oa}from"./unitFormatUtils-B9MPZ1wj.js";import{s as Ta}from"./ReactiveSet-XbWJTkHf.js";import{P as Ea,E as Ia,p as ka,a as Ra,b as Ca,Z as Da,Y as Aa,e as $a,t as Pa,c as ja,d as Va,f as La}from"./EditGeometryOperations-sseMUvB1.js";import{o as za}from"./manipulatorUtils-ypp-R_oV.js";import{x as Ha}from"./PointVisualElement-kTFgcxXB.js";import{M as Ua,C as Ga,A as Fa,D as Na,O as Za,G as Ba}from"./dragEventPipeline3D-C-8mYpU2.js";import{I as Ya,H as Xa,S as Wa,g as qa,l as Ka,_ as Ja,v as Qa,a as tr,E as er,i as ir,c as nr,k as or,U as sr}from"./SlicePlaneMaterial.glsl-AaZx_lGc.js";import{l as ar}from"./Factory-CfOltYNW.js";import{i as rr}from"./drapedUtils-DOQFzwPw.js";import"./RightAngleQuadVisualElement-CPtUkCyd.js";import"./PointSnappingHint-Ct-FTQTL.js";import"./LineVisualElement-EjMrPPob.js";import"./geometryEngineBase-9EI9fooq.js";import"./hydrated-DE1HcVsK.js";import"./MediaElementView-DU1VM6lV.js";import"./normalizeUtilsSync-B5F66Zka.js";import"./normalizeUtilsCommon-BU8xfl77.js";import"./LayerView3D-ApO6iJqK.js";import"./ImageMaterial.glsl-V3C9c4TG.js";import"./LayerView-DMoB2q_T.js";import"./geometry2dUtils-4c9qUvJ6.js";import"./floorFilterUtils-2NbRkqHK.js";import"./sliceToolConfig-Doq59PhP.js";import"./persistable-Bz3xp-b5.js";import"./resourceExtension-BScMZjEL.js";import"./projectionUtils-B1mpMSec.js";const lr={default:15,far:25};let cr=class A extends O{constructor(g){super(g),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const g=T((async g=>{const _=await I("esri/core/t9n/Units");k(g),this._messagesUnits=_}));this.addHandles([C((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((g=>$((()=>{var g;return null==(g=this.context)?void 0:g.editGeometryOperations}),g,(()=>this._update())))),B((()=>g.abort())),C((()=>this._colors),(g=>this._updateStyle(g)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){}get _edgeDistancePixels(){return lr[this.edgeDistance]}get _colors(){var g;const _=(null==(g=this.context)?void 0:g.view.effectiveTheme.textColor)??K.fromArray([255,255,255]);return{textColor:_,backgroundColor:J(tt(_,et.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:g,stagedVertex:_}=this;if(!g)return this._destroyUnusedLabels();const{editGeometryOperations:S}=g,{components:O,geometry:T,coordinateHelper:I}=S.data;if(!T)return this._destroyUnusedLabels();const k=O.length;for(let C=0;C<k;++C){const O=R$9(T,S,_,I,C);if(O.length<2||!q$5(O,g.view,g.elevationInfo,I.spatialReference))continue;const $=1===k&&!it(O);let B=hr,K=vr;this.toScreenPointArray(g,O[0],B);for(let _=1;_<O.length;++_){const S=O[_-1],T=O[_];this.toScreenPointArray(g,T,K),this._addLabel(g,S,B,T,K,$),[B,K]=[K,B]}}this._destroyUnusedLabels()}_updateStyle({textColor:g,backgroundColor:_}){const S=this._nextLabelIndex,O=this._labelInfos;for(let T=0;T<S;++T){const{label:S}=O[T];S.textColor=g,S.backgroundColor=_}}_addLabel(g,_,S,O,T,I){const{label:k}=this._getOrCreateLabel(g);if(!this.visible||nt(S,T)<3025)return void(k.visible=!1);const{spatialReference:C}=g.editGeometryOperations.data,$=Po(_,O,C),B=this._messagesUnits,K=To(g.view);k.text=null!=B&&null!=$?Eo(B,$,K):"",k.visible=!0;const J=T[0]-S[0],tt=T[1]-S[1];I?ot(ur,-tt,J):ot(ur,tt,-J),st(ur,ur),at(ur,ur,this._edgeDistancePixels),rt(dr,S,T,.5),lt(dr,dr,ur),k.position=[dr[0],dr[1]],Math.abs(ur[0])>Math.abs(ur[1])?k.anchor=ur[0]>0?"left":"right":k.anchor=-ur[1]<0?"top":"bottom"}_getOrCreateLabel(g){var _;const S=this._labelInfos.length>this._nextLabelIndex,{textColor:O,backgroundColor:T}=this._colors;if(S){const g=this._labelInfos[this._nextLabelIndex++],{label:_}=g;return _.textColor=O,_.backgroundColor=T,g}const I=new Io({anchor:"center",fontSize:8,textColor:O,backgroundColor:T});null==(_=g.view.overlay)||_.items.add(I);const k={label:I};return this._labelInfos.push(k),this._nextLabelIndex=this._labelInfos.length,k}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:g}){var _,S;null==(S=null==(_=this.context)?void 0:_.view.overlay)||S.items.remove(g),g.destroy()}};function R$9(g,_,S,O,T){const I=[];if(_.data.components[T].iterateVertices((g=>{I.push(O.toXYZ(g.pos,ct.get()))})),0===T&&null!=S&&I.push(O.toXYZ(S,ct.get())),I.length<2)return I;const k=I[0],C=I[I.length-1];return"polygon"===g.type&&I.length>2&&!pt(k,C)&&I.push(k),I}function q$5(g,_,S,O){if("2d"===_.type)return!0;const T=ut(O)??1,I=dt(O),n14=g=>gt(_,g,O,S,mt)??0;for(let k=1;k<g.length;++k){const _=g[k-1],S=g[k],O=(S[0]-_[0])*T,C=(S[1]-_[1])*T,$=(n14(S)-n14(_))*I;if(Math.abs($)/Math.sqrt(O*O+C*C)>pr)return!1}return!0}g([_()],cr.prototype,"context",void 0),g([_()],cr.prototype,"stagedVertex",void 0),g([_()],cr.prototype,"visible",void 0),g([_()],cr.prototype,"edgeDistance",void 0),g([_()],cr.prototype,"updating",null),g([_()],cr.prototype,"_messagesUnits",void 0),g([_()],cr.prototype,"_edgeDistancePixels",null),g([_()],cr.prototype,"_colors",null),cr=g([S("esri.views.interactive.SegmentLabels")],cr);const pr=ht(5),ur=vt(),dr=vt(),hr=ft(),vr=ft();let gr=class a extends cr{getCameraOrExtent({view:g}){return g.state.camera}toScreenPointArray({view:g,elevationInfo:_,editGeometryOperations:S},O,T=ft()){const{spatialReference:I}=S.data.coordinateHelper;return Fo(O,I,_,g,mr),g.state.camera.projectToScreen(mr,T),T}};gr=g([S("esri.views.3d.interactive.SegmentLabels3D")],gr);const mr=_t();function a$9(g){const _=g.graphic;return _?[C((()=>"visible"in g?g.visible:g.displaying),(g=>{g&&_.notifyMeshTransformChanged({action:bt.EnableFastUpdates})}),{...yt}),B((()=>_.notifyMeshTransformChanged({action:bt.DisableFastUpdates})))]:[]}let fr=class w extends Ts{constructor(g){super(g),this._attachmentOrigin=Mt(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new xt,this._geometry=null,this._width=1,this._color=Ss(1,0,1,1),this._innerWidth=0,this._innerColor=Ss(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=St.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=g.view.spatialReference,this._laserline=new Es({view:g.view,isDecoration:g.isDecoration}),this.applyProperties(g),this.attached=g.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(g){return{view:g,createResources:g=>this._createObject3DResources(g),destroyResources:D$9,recreateGeometry:(g,_)=>{g.geometries.length=0,this._recreateGeometry(_,g.material,g.geometries)}}}createDrapedResourceFactory(g){return{view:g,createResources:()=>this._createDrapedResources(),destroyResources:D$9,recreateGeometry:g=>{g.geometries=this._createRenderGeometriesDraped(g.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(g){this._laserline.attached=this._laserlineAttached,g&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(g){this._geometry=g,this.recreateGeometry()}get width(){return this._width}set width(g){g!==this._width&&(this._width=g,this._updateMaterial())}get color(){return this._color}set color(g){Ot(g,this._color)||(Rt(this._color,g),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(g){g!==this._innerWidth&&(this._innerWidth=g,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(g){Ot(g,this._innerColor)||(Rt(this._innerColor,g),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(g){const _=null!=g!=(null!=this._stipplePattern);this._stipplePattern=g,_?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(g){g&&this._stippleOffColor&&Ot(g,this._stippleOffColor)||(this._stippleOffColor=g?Os(g):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(g){g!==this._falloff&&(this._falloff=g,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(g){this._elevationInfo=g,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(g){this._laserlineStyle=g,this._laserline.attached=this._laserlineAttached,null!=g&&(this._laserline.style=g)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(g){this._laserlineEnabled!==g&&(this._laserlineEnabled=g,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(g){g!==this._renderOccluded&&(this._renderOccluded=g,this._updateMaterial())}get attachmentOrigin(){var g;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const _=null==(g=this.object3dResources.resources)?void 0:g.geometries;if(!_||0===_.length)return null;Ct(yr,0,0,0);let S=0;for(const O of _)O.computeAttachmentOrigin(_r)&&(Dt(yr,yr,_r),S++);return 0===S?null:(At(yr,yr,1/S),this.view.renderCoordsHelper.fromRenderCoords(yr,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===St.OccludeAndTransparentStencil?St.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(g,_,S){this._createRenderGeometries(_,S);for(const O of S)g.addGeometry(O);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(g){const _=new $t(this._materialParameters),S=new Array;return this._recreateGeometry(g,_,S),{material:_,geometries:S,forEach:g=>{g(_),S.forEach(g)}}}_createDrapedResources(){const g=new $t(this._materialParameters);return{material:g,geometries:this._createRenderGeometriesDraped(g)}}_createRenderGeometriesDraped(g){const{geometry:_,view:S}=this,O=S.basemapTerrain.spatialReference;return null==_||null==O?[]:Pt(_,O).lines.map((({position:_})=>{const T={overlayInfo:{spatialReference:O,renderCoordsHelper:S.renderCoordsHelper},attributeData:{position:_},removeDuplicateStartEnd:this._isClosed};return new Vt(Lt(g,T))}))}calculateMapBounds(g){if(null==this.object3dResources.resources)return!1;const _=this.view.renderCoordsHelper;for(const S of this.object3dResources.resources.geometries){const O=S.attributes.get(zt.POSITION),T=Ht(O.data.length);Ut(O.data,_.spatialReference,0,T,this.view.spatialReference,0,O.data.length/3),Gt(g,T)}return!0}_createRenderGeometries(g,_){const S=this.geometry;if(null==S)return;const O=Ft(S,this.view.elevationProvider,this.view.renderCoordsHelper,Nt.fromElevationInfo(this.elevationInfo??new Zt({mode:Bt(S,null)}))),T=new Array;for(const{position:I,mapPositions:k}of O.lines){const S={mapPositions:k,attributeData:{position:I},removeDuplicateStartEnd:this._isClosed};_.push(Lt(g,S)),T.push(I)}this._laserline.pathVerticalPlane=T}};function D$9(g){g.geometries=[]}const _r=_t(),yr=_t();let br=class e extends xt.EventedAccessor{constructor(g){super(g),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};var Mr,wr,xr,Sr;g([_({constructOnly:!0})],br.prototype,"graphic",void 0),g([_()],br.prototype,"tracking",void 0),g([_()],br.prototype,"displaying",void 0),g([_()],br.prototype,"isDraped",void 0),br=g([S("esri.views.3d.layers.graphics.GraphicState")],br),(wr=Mr||(Mr={}))[wr.NeverApplied=0]="NeverApplied",wr[wr.Applied=1]="Applied",wr[wr.Undone=2]="Undone",(Sr=xr||(xr={})).UndoRedoUpdating="UndoRedoUpdating",Sr.UndoInvalidError="UndoInvalidError",Sr.RedoInvalidError="RedoInvalidError",Sr.ApplyInvalidError="ApplyInvalidError";const Or={[xr.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[xr.UndoInvalidError]:"There are no items to Undo",[xr.RedoInvalidError]:"There are no items to Redo",[xr.ApplyInvalidError]:"Cannot apply an item that is already applied"};let Tr=class d extends Error{constructor(){super(Or[xr.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},Er=class n extends Error{constructor(){super(Or[xr.UndoInvalidError]),this.type="undo-redo-undo-error"}},Ir=class e2 extends Error{constructor(){super(Or[xr.RedoInvalidError]),this.type="undo-redo-redo-error"}},kr=class t extends Error{constructor(){super(Or[xr.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Rr,Cr;(Cr=Rr||(Rr={}))[Cr.Apply=0]="Apply",Cr[Cr.Undo=1]="Undo",Cr[Cr.Redo=2]="Redo";let Dr=class n2 extends O{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=Mr.NeverApplied}get canUndo(){return this.status===Mr.Applied}get canRedo(){return this.status===Mr.Undone}async executeUndoRedoOperation(g){switch(g){case Rr.Apply:if(this.status!==Mr.NeverApplied)throw new kr;return await this.apply(),void(this.status=Mr.Applied);case Rr.Undo:if(this.status!==Mr.Applied)throw new Er;return await this.undo(),void(this.status=Mr.Undone);case Rr.Redo:if(this.status!==Mr.Undone)throw new Er;return await this.redo(),void(this.status=Mr.Applied)}}};g([_()],Dr.prototype,"name",void 0),g([_()],Dr.prototype,"tag",void 0),Dr=g([S("esri.undoredo.UndoableOperation")],Dr);let Ar=class u extends O{constructor(){super(...arguments),this._stack=new Yt,this._stackPosition=-1,this._updatingHandles=new Xt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((g=>g.destroy()))}_drainStack(){this._stack.drain((g=>g.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Er;if(this.updating)throw new Tr;const g=this._stack.getItemAt(this._stackPosition);await this._updatingHandles.addPromise((async()=>{await g.executeUndoRedoOperation(Rr.Undo),--this._stackPosition,g.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Ir;if(this.updating)throw new Tr;const g=this._stack.getItemAt(this._stackPosition+1);await this._updatingHandles.addPromise((async()=>{await g.executeUndoRedoOperation(Rr.Redo),++this._stackPosition})())}peekUndo(){return this.canUndo?this._stack.getItemAt(this._stackPosition):null}peekRedo(){return this.canRedo?this._stack.getItemAt(this._stackPosition+1):null}async inject(g){if(this.updating)throw new Tr;await this._updatingHandles.addPromise((async()=>{g.status===Mr.NeverApplied&&await g.executeUndoRedoOperation(Rr.Apply),g.canUndo?(this._stack.splice(this._stackPosition+1,0,g),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((g=>g.destroy())),this._stackPosition=-1)})())}async add(g){if(this.updating)throw new Tr;await this._updatingHandles.addPromise((async()=>{g.status===Mr.NeverApplied&&await g.executeUndoRedoOperation(Rr.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),g.canUndo?(this._stack.push(g),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(g,_=!1){if(this.updating&&!_)return;await Wt((()=>!this.updating));const S=new Yt;for(let O=0;O<this._stack.length;O++){const _=this._stack.getItemAt(O);_.tag===g?(_.destroy(),O===this._stackPosition&&(this._stackPosition=S.length-1)):S.push(_)}this._stack=S,this._stackPosition>S.length-1&&(this._stackPosition=S.length-1)}async clear(g=!1){if(this.updating&&!g)throw new Tr;await Wt((()=>!this.updating)),this._drainStack()}};function _$2(){return Kt()}function w$5(){return qt()}function E$7(g,_){const S=[];g=(g=(g=g.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const O=function R$8(g){let _=null;if(g||(g=te.WGS84),g.wkid){if(_=ee.geogcs(g.wkid),!_)throw new ie("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!g.wkt2&&!g.wkt)throw new ie("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(_=ee.fromString(ne.PE_TYPE_GEOGCS,g.wkt2||g.wkt),!_)throw new ie("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return _}(_);return Jt.dmsToGeog(O,1,[g],S)?new Qt(S[0][0],S[0][1],te.WGS84):null}g([_()],Ar.prototype,"_stack",void 0),g([_()],Ar.prototype,"_stackPosition",void 0),g([_()],Ar.prototype,"updating",null),g([_({readOnly:!0})],Ar.prototype,"canUndo",null),g([_({readOnly:!0})],Ar.prototype,"hasUndo",null),g([_({readOnly:!0})],Ar.prototype,"canRedo",null),g([_({readOnly:!0})],Ar.prototype,"hasRedo",null),Ar=g([S("esri.UndoRedo")],Ar);let $r=class l{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var Pr;let jr=Pr=class extends se{constructor(...g){super(...g),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(g,_){let S;if(null==g?void 0:g.center)S=g;else{if(null==g?void 0:g.rings)return super.normalizeCtorArgs(g,_);S={center:g}}return{...super.normalizeCtorArgs(),...S,..._}}initialize(){const g=this.center,_=this.numberOfPoints;if(this.hasZ=(null==g?void 0:g.hasZ)??!1,0!==this.rings.length||!g)return;const S=ae(this.radius,this.radiusUnit,"meters"),O=g.spatialReference;let T,I="geographic";if(O.isWebMercator?I="webMercator":(null!=(O.wkid&&re[O.wkid])||(O.wkt2||O.wkt)&&le(O.wkt2||O.wkt))&&(I="projected"),this.geodesic){let O;switch(I){case"webMercator":O=ce(g);break;case"projected":break;case"geographic":O=g}T=this._createGeodesicCircle(O,S,_),"webMercator"===I&&(T=pe(T))}else{let O;"webMercator"===I||"projected"===I?O=S/ut(g.spatialReference):"geographic"===I&&(O=ue(S,"meters",de(g.spatialReference).radius)),T=this._createPlanarCircle(g,O,_)}this.spatialReference=T.spatialReference,this.addRing(T.rings[0])}clone(){const{center:g,numberOfPoints:_,radius:S,radiusUnit:O,geodesic:T}=this;return new Pr({center:null==g?void 0:g.clone(),numberOfPoints:_,radius:S,radiusUnit:O,geodesic:T})}_createGeodesicCircle(g,_,S){let O=0;const T=[];for(;O<360;){const I=[0,0],k=[g.x,g.y];No(I,k,O,_,te.WGS84),this.hasZ&&I.push(g.z),T.push(I),O+=360/S}return T.push(T[0]),new se(T)}_createPlanarCircle(g,_,S){const O=[],T=2*Math.PI/S;for(let I=0;I<S;++I){const S=T*I,k=[g.x+Math.cos(-S)*_,g.y+Math.sin(-S)*_];this.hasZ&&k.push(g.z),O.push(k)}return O.push(O[0]),new se({spatialReference:g.spatialReference,rings:[O]})}};g([_({type:Qt})],jr.prototype,"center",void 0),g([_()],jr.prototype,"geodesic",void 0),g([_()],jr.prototype,"numberOfPoints",void 0),g([_()],jr.prototype,"radius",void 0),g([_()],jr.prototype,"radiusUnit",void 0),jr=Pr=g([S("esri.geometry.Circle")],jr);const Vr=jr;function g$4(g,_,S=null){return null!=S?[g,_,S]:[g,_]}function w$4(g,_,S=null){return null!=S?{x:g,y:_,z:S}:{x:g,y:_}}let Lr=class R{constructor(g){this.spatialReference=g}mapToLocalMultiple(g){return g.map((g=>this.mapToLocal(g))).filter(Oe)}get doUnnormalization(){return!1}},zr=class W extends Lr{constructor(g,_,S=null){super(_),this._defaultZ=S,this.transform=Ds(),this.transformInv=Ds(),this.transform=As(g),he(this.transformInv,this.transform)}makeMapPoint(g,_){return g$4(g,_,this._defaultZ)}mapToLocal(g){return w$4(this.transform[0]*g[0]+this.transform[2]*g[1]+this.transform[4],this.transform[1]*g[0]+this.transform[3]*g[1]+this.transform[5])}localToMap(g){return g$4(this.transformInv[0]*g.x+this.transformInv[2]*g.y+this.transformInv[4],this.transformInv[1]*g.x+this.transformInv[3]*g.y+this.transformInv[5],this._defaultZ)}},Hr=class v extends Lr{constructor(g,_){super(g.spatialReference),this.view=g,this.defaultZ=null,this.pWS=_t(),this.tangentFrameUpWS=_t(),this.tangentFrameRightWS=_t(),this.tangentFrameForwardWS=_t(),this.localFrameRightWS=_t(),this.localFrameUpWS=_t(),this.worldToLocalTransform=ve(),this.localToWorldTransform=ve(),this.scale=1,this.scale=g.resolution,this.referenceMapPoint=_,this.defaultZ=_.hasZ?_.z:null;const S=g.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ge.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ge.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ge.Z,this.tangentFrameForwardWS);const O=_t();At(O,this.tangentFrameForwardWS,me(S,this.tangentFrameForwardWS)),fe(this.localFrameRightWS,S,O),_e(this.localFrameRightWS,this.localFrameRightWS),be(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Me(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),we(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(g,_){return g$4(g,_,this.defaultZ)}mapToLocal(g){const _=_t();this.view.renderCoordsHelper.toRenderCoords(new Qt({x:g[0],y:g[1],spatialReference:this.spatialReference}),_),Se(_,_,this.worldToLocalTransform);const S=this.view.renderCoordsHelper.fromRenderCoords(_,new Qt({spatialReference:this.view.spatialReference}));return null!=S?w$4(S.x/this.scale,S.y/this.scale):null}localToMap(g){const _=_t();this.view.renderCoordsHelper.toRenderCoords(new Qt({x:g.x*this.scale,y:g.y*this.scale,spatialReference:this.spatialReference}),_),Se(_,_,this.localToWorldTransform);const S=this.view.renderCoordsHelper.fromRenderCoords(_,new Qt({spatialReference:this.view.spatialReference}));return null!=S?g$4(S.x,S.y,this.defaultZ):null}};function g$3(g,_){const S=new Qt({x:g[0],y:g[1],spatialReference:_});return g.length>2&&(S.z=g[2]),S}function R$6(g,_,S){const O=new Ee({paths:g,spatialReference:_});return S&&Ie(O),O}function j$5(g,_,S,O=!0){const T=ke(g);T.forEach((g=>{const _=g[0],S=g[g.length-1];Re(_,S)&&1!==g.length||g.push(g[0])}));let I=new se({rings:T,spatialReference:_});return I.rings.forEach((g=>{it(g)||g.reverse()})),S&&Ie(I),O&&I.isSelfIntersecting&&Ce(_)&&(I=Rs(I)),I}function T$7(g,_,S){const O=_.mapToLocalMultiple(g),T=[],I={x:O[0].x,y:O[0].y},k=O[1].x,C=O[1].y,$=Math.round(k-I.x),B=Math.round(C-I.y),K=Math.max(Math.abs($),Math.abs(B));if(S){const g={x:I.x+K,y:I.y+K},_={x:I.x-K,y:I.y-K};T.push(w$4(g.x,_.y),w$4(_.x,_.y),w$4(_.x,g.y),w$4(g.x,g.y))}else{const g={x:$>0?I.x+K:I.x-K,y:B>0?I.y+K:I.y-K};T.push(w$4(I.x,I.y),w$4(g.x,I.y),w$4(g.x,g.y),w$4(I.x,g.y))}return U$7(j$5([T.map((g=>_.localToMap(g))).filter(Oe)],_.spatialReference,_.doUnnormalization,!0),T,_)}function U$7(g,_,S){const O=P$6(_[3],_[2],S),T=P$6(_[1],_[2],S),I=P$6(_[0],_[1],S),k=P$6(_[0],_[3],S);return{geometry:g,midpoints:null!=O&&null!=T&&null!=I&&null!=k?{top:O,right:T,bottom:I,left:k}:null}}function P$6(g,_,S){Gr[0]=g.x,Gr[1]=g.y,Gr[2]=0,Fr[0]=_.x,Fr[1]=_.y,Fr[2]=0,De(Gr,Gr,Fr,.5),Ur.x=Gr[0],Ur.y=Fr[1],Ur.z=Fr[2];const O=S.localToMap(Ur);return null!=O?g$3(O,S.spatialReference):null}const Ur=w$4(0,0,0),Gr=_t(),Fr=_t();function L$7(g,_,S,O){const T=_.mapToLocalMultiple(g);let I=null,k=null;if(S)I=T[0],k=T[1];else{const g=T[0],_=T[1],S=Math.round(_.x-g.x),O=Math.round(_.y-g.y),C=Math.max(Math.abs(S),Math.abs(O));I=w$4(S>0?g.x+C/2:g.x-C/2,O>0?g.y+C/2:g.y-C/2),k=w$4(Math.abs(S)>Math.abs(O)?I.x-C/2:I.x,Math.abs(S)>Math.abs(O)?I.y:I.y-C/2)}const C=_.localToMap(I),$=_.localToMap(k);if(null==C||null==$)return null;_.doUnnormalization&&Ae([[C,$]],_.spatialReference);const B=g$3(C,_.spatialReference),K=g$3($,_.spatialReference),J=$e(_.spatialReference);let tt=0;if(Ce(_.spatialReference))tt=J*Cs(B,K,null);else{const g=I.x-k.x,_=I.y-k.y;tt=J*Math.sqrt(g*g+_*_)*1}const et=new Vr({center:B,radius:tt,radiusUnit:"meters",spatialReference:_.spatialReference});return{geometry:j$5(et.rings,et.spatialReference,!1),center:B,edge:K}}function e$6(g,_){switch(g){case"point":case"multipoint":return"point";case"polyline":return function t$4(g){return(null!=g&&"polyline"===g.type&&g.paths.length?g.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(_);case"polygon":return function o$4(g){const _=null!=g&&"polygon"===g.type&&g.rings.length?g.rings[0].length:0;return _<3?"polylineZeroVertices":_<4?"polygonOneVertex":"polygonTwoVertices"}(_);default:return}}const Nr=20,Zr=1,Br=.1,Yr=_t();function b$4(g,_,S){if(null==_||null==g)return;const O=Fe(S.measurementSR);if(null==O)return;const T=G$3(g,S);if(null==T)return;const I=ze(_,O);return new Ls(T,I)}function A$8(g,_,S,O){if(null==S||null==g)return;const T=G$3(g,O);if(null==T)return;const I=zs(S),s7=g=>{if(null==g)return;const _=Ps(),S=Ne(g,"degrees","geographic");return Fs(_,T,O.measurementSR,10,S,O.mode)?new Ns(T,_):void 0},c8=()=>{if(null!=_&&null!=g)return zs(Zs(_,g))};switch(O.directionMode){case Hs.Absolute:return s7(I);case Hs.Relative:{const g=c8();if(null==g)return;return s7(g+I)}case Hs.RelativeBilateral:{const g=c8();if(null==g)return;return Us([s7(g+I),s7(g-I)])}}}function B$5(g,_){const S=function C$5(g,_){var S;return(null==(S=E$6(g,_))?void 0:S.value)??void 0}(g,_);return null!=S?new Gs(S):void 0}function P$5(g,_,S){const{context:O,longitude:T,latitude:I,direction:k,distance:C,elevation:$}=S;if(null!=T||null!=I||null!=C||null!=$||null!=k){if(null!=T||null!=I){const g=zs(T),_=zs(I),S=D$8($,O);return new Vs(g,_,S)}return function T$6(g,_,{context:S,direction:O,distance:T,elevation:I}){if(null==_)return B$5(I,S);const{view:k,elevationInfo:C,measurementSR:$}=S,B=$s(_,k,C);if(!$||!Ve(B,_.spatialReference,Xr,$))return;const[K,J]=Xr,tt=null!=T?ze(T,"meters"):void 0,et=zs(O),it=D$8(I,S),h4=g=>{const _=new Bs([K,J],$,tt,it,g);return null==tt||null==g||null==it&&S.hasZ?_:new Ys(_.closestTo(B))};if(null==et)return h4(void 0);const U2=()=>{if(null!=g&&null!=_)return zs(Zs(g,_))};switch(S.directionMode){case Hs.Absolute:return h4(et);case Hs.Relative:{const g=U2();if(null==g)return;return h4(g+et)}case Hs.RelativeBilateral:{const g=U2();if(null==g)return;return Us([h4(g+et),h4(g-et)])}}}(g,_,S)}}function V$5(g){return"geodesic"===g.context.mode?P$5(null,null,g):q$4(g)}function k$4(g,_,S){const{context:O,x:T,y:I,distance:k,direction:C,elevation:$}=S;return"geodesic"===O.mode?P$5(_,g,S):null!=T||null!=I?q$4(S):function z$5(g){let _;for(const S of g)S&&(_=(null==_?void 0:_.intersect(S))??S);return _}([b$4(g,k,O),A$8(g,_,C,O),B$5($,O)])}function q$4({x:g,y:_,elevation:S,context:O}){Kr.x=(null==g?void 0:g.value)??0,Kr.y=(null==_?void 0:_.value)??0,Kr.spatialReference=O.spatialReference;const T=G$3(Kr,O,Wr);return new Vs(null!=g&&null!=T?T[0]:void 0,null!=_&&null!=T?T[1]:void 0,D$8(S,O))}function G$3(g,_,S=Ps()){const{view:O,elevationInfo:T,measurementSR:I,origin:k,mode:C}=_;if($s(g,O,T,S),Ve(S,g.spatialReference,S,I))return"geodesic"!==C&&fe(S,S,k),S}function D$8(g,_){const S=E$6(g,_);return null!=S?ze(S,"meters"):void 0}function E$6(g,{view:_,origin:S,elevationInfo:O,hasZ:T,measurementSR:I}){if(null==g||!T)return;const k=He(I);if(null==k)return;const[C,$]=S,B=ze(g,k),K="3d"===(null==_?void 0:_.type)?Ue(_,C,$,B,I,O):B;return null!=K?Ge(K,k):void 0}const Xr=Ps(),Wr=Ps(),qr=Ps(),Kr=Mt(0,0,0,te.WGS84),Jr=1,Qr=6;function D$7(g,_){return{angleRelative:x$2,direction:j$4,directionRelative:R$5,directionRelativeBilateral:$$1,latitudeDecimalDegrees:w$2,longitudeDecimalDegrees:F$6,area:(S,O)=>ko(g,S,O??_.area),length:(S,O,T)=>Eo(g,S,O??_.length,T),lengthRelative:(S,O)=>Ro(g,S,O??_.length),totalLength:(S,O)=>Eo(g,S,O??_.length),verticalLength:(S,O)=>Co(g,S,O??_.length),verticalLengthRelative:(S,O)=>Do(g,S,O??_.verticalLength),percentage:T$5,scalar:b$3,scale:Z$2}}function x$2(g){return Be(g,{signDisplay:"exceptZero",...z$4(Jr)})}function j$4(g){return Ao(g,g.rotationType,Jr)}function R$5(g){const _=zs(g);return Be(_,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:_>0?"never":"exceptZero",...z$4(Jr)})}function $$1(g){return Ao(g,g.rotationType,Jr)}function F$6(g){return U$6(g,el)}function w$2(g){return U$6(g,il)}function U$6(g,_){return Ao(Ye(g,"degrees"),"geographic",Qr,_,!1)}function q$3(g,_){const S=_.normalize(Ye(g,"degrees").value,void 0,!1);return b$3(Ze(S),Qr)}function T$5(g){return Be(g.value,{style:"percent"})}function Z$2(g){return Be(g,{style:"percent",maximumFractionDigits:0})}function b$3(g,_){return Be(g.value,z$4(_))}function z$4(g){return{minimumFractionDigits:g,maximumFractionDigits:g}}function B$4(g){return(_,S)=>{const O=oe(_);return null!=O?g(O,S):null}}const C$4=g=>{let _=`[-+]?[0-9${g.thousands}]+`;return""!==g.decimal&&(_+=`${g.decimal}[0-9]+`),new RegExp(`^(${_}\\s*)${g.separator}(\\s*${_})$`,"i")},tl=[];for(const Gp of[",","\\|","\\s+"])for(const g of["\\.",",",""])for(const _ of["",",","\\."," ","\\s+"])Gp!==g&&Gp!==_&&g!==_&&tl.push({separator:Gp,decimal:g,thousands:_,pattern:C$4({decimal:g,thousands:_,separator:Gp})});function k$3(g,_,S){let O=g.replaceAll(/[\s+]/g,"");return""!==S&&(O=O.replaceAll(S,"")),""!==_&&(O=O.replaceAll(_,".")),O}function H$2(g){return K$2(function g$6(g){var _;return g&&_$2()?oe(g)??(null==(_=E$7(`0° 0' 0" N | ${g}`))?void 0:_.longitude)??null:null}(g))}function J$2(g){return K$2(function m$5(g){var _;return g&&_$2()?oe(g)??(null==(_=E$7(`${g} | 00° 00' 00" E`))?void 0:_.latitude)??null:null}(g))}function K$2(g){return null!=g?Ne(g,"degrees","geographic"):null}const el=new Xe(-180,180),il=new Xe(-90,90);function R$4(g,_){const S=Ke(_.vertexSpace),{scale:O,orientation:T}=g,{transform:I}=_,k=function F$5(g){if(!g)return 0;const _=E$4(g.rotationAxis);return null!=_?_*g.rotationAngle:null}(I);S&&null!=k?(T.actual=Ne(k,"degrees","arithmetic"),T.visible=!0):(T.actual=null,T.visible=!1),S?(O.actual=Ze(q$2(I)),O.visible=!0):(O.actual=null,O.visible=!1)}function k$2(g,_,S){var O,T,I,k,C,$,B;if(!_||!Ke(_.vertexSpace))return;const K=_.transform??(_.transform=new ta),{rotationAngle:J,rotationAxis:tt}=K,et=Xs(g.orientation.actual),it=E$4(tt);if(null!=et&&null!=it&&et!==J){null==(O=null==S?void 0:S.onRotateStart)||O.call(S,J);const g=et*it;K.rotationAngle=g,null==(T=null==S?void 0:S.onRotate)||T.call(S,g),null==(I=null==S?void 0:S.onRotateStop)||I.call(S,g)}const nt=null==(k=g.scale.actual)?void 0:k.value,ot=q$2(K);if(null!=nt&&nt!==ot){const{scale:g}=K;let _;if(null==(C=null==S?void 0:S.onScaleStart)||C.call(S,g[0],g[1],g[2]),0===ot)_=Je(Qe);else{const S=nt/ot;_=At(_t(),g,S)}K.scale=_,null==($=null==S?void 0:S.onScale)||$.call(S,_[0],_[1],_[2]),null==(B=null==S?void 0:S.onScaleStop)||B.call(S,_[0],_[1],_[2])}}function V$4(g,_){const{x:S,y:O,z:T}=_,{x:I,y:k,z:C}=function D$6(g,_){var S,O,T;let I,k,C;if(g.geographic){I=zs(g.longitude.actual),k=zs(g.latitude.actual),ei(_)&&(null!=I&&null!=k?[I,k]=ii(I,k,nl):null!=I?I=ii(I,0,nl)[0]:null!=k&&(k=ii(0,k,nl)[1]));const S=g.elevation.actual,O=He(_);C=null!=O&&null!=S?ze(S,O):void 0}else I=null==(S=g.x.actual)?void 0:S.value,k=null==(O=g.y.actual)?void 0:O.value,C=null==(T=g.elevation.actual)?void 0:T.value;return{x:I,y:k,z:C}}(g,_.spatialReference);return{dx:null==I||ti(I,S)?0:I-S,dy:null==k||ti(k,O)?0:k-O,dz:null==C||null==T||ti(C,T)?0:C-T}}const nl=[0,0];function E$4(g){return pt(g,qe)?1:pt(g,ol)?-1:null}const ol=We(_t(),qe);function q$2(g){return g?Math.max(...g.scale):1}function G$1(g,_){return!("key-down"!==g.type||g.key!==ea.enterInputMode||!_||!function O$2(g){const _=null==g?void 0:g.sketchOptions;if(!_)return!1;const{inputEnabled:S,visibleElements:O}=_.tooltips;return S&&!0===g.editableFields.some((({name:g})=>"x"===g||"y"===g?O.coordinates:O[g]))}(_.info)||(_.enterInputMode(),g.stopPropagation(),0))}function T$4(g){let _=null;return ni([g.on("paste",(async S=>{null==_||_.abort(),_=T((async()=>{_$2()||await w$5(),B$3(S,g.info)}))})),T((()=>w$5())),B((()=>null==_?void 0:_.abort()))])}function B$3(g,_){var S;if(!_||!("geographic"in _))return;const O=null==(S=g.clipboardData)?void 0:S.getData("text");if(O)if(_.geographic){const S=function G$2(g){if(!g||null!=oe(g)||!_$2())return null;const _=E$7(g),S=K$2(null==_?void 0:_.latitude),O=K$2(null==_?void 0:_.longitude);return null!=O&&null!=S?{latitude:S,longitude:O}:null}(O);S&&(_.longitude.applyValue(S.longitude),_.latitude.applyValue(S.latitude),g.stopPropagation(),g.preventDefault())}else{const S=function M$6(g){for(const{decimal:_,thousands:S,pattern:O}of tl){O.lastIndex=0;const T=g.match(O);if(!T)continue;const I=oe(k$3(T[1],_,S)),k=oe(k$3(T[2],_,S));if(null!=I&&null!=k)return{x:Ze(I),y:Ze(k)}}return null}(O);S&&(_.x.applyValue(S.x),_.y.applyValue(S.y),g.stopPropagation(),g.preventDefault())}}let sl=class r extends O{constructor(g){super(g),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((g=>g.visible&&!g.readOnly))}clearInputValues(){this.allFields.forEach((g=>g.clearInputValue()))}};g([_()],sl.prototype,"sketchOptions",void 0),g([_()],sl.prototype,"visibleElements",null),g([_()],sl.prototype,"helpMessage",void 0),g([_()],sl.prototype,"viewType",void 0),g([_()],sl.prototype,"allFields",null),g([_()],sl.prototype,"editableFields",null),sl=g([S("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],sl);let al=class i extends sl{constructor(g){super(g),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=oi}get allFields(){return[]}};g([_()],al.prototype,"type",void 0),g([_()],al.prototype,"radius",void 0),g([_()],al.prototype,"xSize",void 0),g([_()],al.prototype,"ySize",void 0),g([_()],al.prototype,"area",void 0),g([_()],al.prototype,"allFields",null),al=g([S("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],al);let rl=class s extends O{constructor(g){super(g),this.actual=null,this.lockable=!0,this.id=si(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(g){this.lockable&&this._set("committed",g)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(g){this.inputValue=g}onCommit(g,_,S){this.lockable?this._onCommitLockable(g,S):this._onCommitNonLockable(S),this.invalid&&"commit-and-exit"===g||S.onCommit(_,g)}_onCommitLockable(g,_){const{inputValue:S,locked:O}=this;O&&n$f(S)?this.unlock():("commit-and-exit"===g&&!O||null!=S)&&this._parseInputAndLock(_)}_onCommitNonLockable(g){const{inputValue:_}=this;n$f(_)?this.setActual(null):null!=_&&this._parseInputAndSetActual(g)}applyValue(g){this.lockable?this.lock(g):this.setActual(g)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(g){this.actual=g,this.clearInputValue()}lock(g){this.lockable&&(this.committed=g??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(g){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(g))}getSuffix(g){const{suffix:_}=this;return"function"==typeof _?_(g):_}getFormattedValue(g){const{actual:_,committed:S,format:O}=this;return null!=S?O(S,g):null!=_?O(_,g):null}getRawDisplayValue(g){const{actual:_,committed:S,inputValue:O}=this;return null!=O?O:this.lockable&&null!=S?this.formatForInputMode(S,g):null!=_?this.formatForInputMode(_,g):null}_parseInputAndSetActual(g){const{inputValue:_}=this;if(null==_||n$f(_))return this.setActual(null);const S=this.parse(_,g);null!=S?this.setActual(S):this.invalid=!0}_parseInputAndLock(g){const{inputValue:_,actual:S}=this;if(n$f(_))return this.unlock();if(null==_)return this.lock(S);const O=this.parse(_,g);null!=O?this.lock(O):this.invalid=!0}};function n$f(g){return null!=g&&""===g.trim()}g([_()],rl.prototype,"actual",void 0),g([_()],rl.prototype,"committed",null),g([_()],rl.prototype,"dirty",null),g([_()],rl.prototype,"format",void 0),g([_()],rl.prototype,"formatForInputMode",void 0),g([_()],rl.prototype,"lockable",void 0),g([_()],rl.prototype,"locked",null),g([_()],rl.prototype,"id",void 0),g([_()],rl.prototype,"inputValue",void 0),g([_()],rl.prototype,"name",void 0),g([_()],rl.prototype,"parse",void 0),g([_()],rl.prototype,"readOnly",void 0),g([_()],rl.prototype,"suffix",void 0),g([_()],rl.prototype,"title",void 0),g([_()],rl.prototype,"visible",void 0),g([_()],rl.prototype,"invalid",void 0),g([_()],rl.prototype,"unlockOnVertexPlacement",void 0),rl=g([S("esri.views.interactive.tooltip.fields.TooltipField")],rl);let ll=class c extends rl{constructor(g){super(g),this.showAsZ=!1}normalizeCtorArgs(g){const e6=g=>g.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:ai,parse:B$4(((g,_)=>Ge(g,e6(_)))),format:(g,_)=>_.formatters.verticalLength(g),formatForInputMode:(g,_)=>_.formatters.scalar(Ye(g,e6(_))),suffix:g=>g.inputUnitInfos.verticalLength.abbreviation,title:g=>g.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...g}}};g([_()],ll.prototype,"showAsZ",void 0),ll=g([S("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],ll);let cl=class p extends rl{constructor(g){super(g),this.precision=1}normalizeCtorArgs(g){return{name:"orientation",actual:null,parse:B$4(((g,_)=>Ne(g,(g=>g.inputUnitInfos.orientation.unit)(_),"geographic"))),format:g=>{const _=Ws(g);return Ao(_,"geographic",this.precision)},formatForInputMode:(g,_)=>{const S=Ws(g);return _.formatters.scalar(S)},suffix:g=>g.inputUnitInfos.orientation.abbreviation,title:g=>g.messages.sketch.orientation,...g}}};function b$2(g){const n14=g=>g.inputUnitInfos.direction.unit,i15=g=>g.sketchOptions.values.effectiveDirectionMode;return new rl({name:"direction",actual:ri,parse:B$4(((g,_)=>Ne(g,n14(_),"geographic"))),format:(g,_)=>{const S=i15(_),O=qs(g,S);switch(S){case Hs.Absolute:return _.formatters.direction(O);case Hs.Relative:return _.formatters.directionRelative(O);case Hs.RelativeBilateral:return _.formatters.directionRelativeBilateral(O)}},formatForInputMode:(g,_)=>{const S=qs(g,i15(_));return _.formatters.scalar(Ye(S,n14(_)))},suffix:g=>g.inputUnitInfos.direction.abbreviation,title:g=>{const _=i15(g),{absolute:S,relative:O}=g.messages.sketch.direction;switch(_){case Hs.Absolute:return S;case Hs.Relative:case Hs.RelativeBilateral:return O}},...g})}function I$4(g){const e6=g=>g.inputUnitInfos.length.unit;return new rl({name:"distance",actual:ai,parse:B$4(((g,_)=>Ge(Math.max(g,0),e6(_)))),format:(g,_)=>_.formatters.length(g),formatForInputMode:(g,_)=>_.formatters.scalar(Ye(g,e6(_))),suffix:g=>g.inputUnitInfos.length.abbreviation,title:g=>g.messages.sketch.distance,...g})}function U$5(){return I$4({format:(g,_)=>_.formatters.totalLength(g),title:g=>g.messages.sketch.totalLength,readOnly:!0})}function x$1(g){return new cl(g)}function F$4(g){return D$5("scale",{name:"scale",actual:null,parse:B$4((g=>Ze(Math.abs(g)))),...g})}function M$5(g){const e6=g=>g.inputUnitInfos.area.unit;return new rl({name:"area",actual:oi,parse:B$4(((g,_)=>li(g,e6(_)))),format:(g,_)=>_.formatters.area(g),formatForInputMode:(g,_)=>_.formatters.scalar(Ye(g,e6(_))),suffix:g=>g.inputUnitInfos.area.abbreviation,title:g=>g.messages.sketch.area,readOnly:!0,...g})}function k$1(g){return new rl({name:"x",actual:ri,parse:H$2,format:(g,_)=>_.formatters.longitudeDecimalDegrees(g),formatForInputMode:g=>function L$6(g){return q$3(g,el)}(g),suffix:g=>g.inputUnitInfos.longitudeLatitude.abbreviation,title:g=>g.messages.sketch.longitude,...g})}function j$3(g){return new rl({name:"y",actual:ri,parse:J$2,format:(g,_)=>_.formatters.latitudeDecimalDegrees(g),formatForInputMode:g=>function A$7(g){return q$3(g,il)}(g),suffix:g=>g.inputUnitInfos.longitudeLatitude.abbreviation,title:g=>g.messages.sketch.latitude,...g})}function D$5(g,_){return new rl({actual:Ze(0),parse:B$4((g=>Ze(g))),format:(g,_)=>_.formatters.scalar(g),formatForInputMode:(g,_)=>_.formatters.scalar(g),title:_=>_.messages.sketch[g],..._})}g([_()],cl.prototype,"precision",void 0),cl=g([S("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],cl);const h$6=O=>{let T=class extends O{constructor(){super(...arguments),this.longitude=k$1(),this.latitude=j$3(),this.x=function y$2(g){return D$5("x",{name:"x",...g})}(),this.y=function R$3(g){return D$5("y",{name:"y",...g})}(),this.elevation=function w$1(g){return new ll(g)}(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(g,_=(null==g?void 0:g.spatialReference)){if(this.geographic=!!_&&Bo(_),null==g)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const _=ci(g,pl);this._setActualLonLat(K$2(null==_?void 0:_[0]),K$2(null==_?void 0:_[1]))}else this._setActualXY(Ze(g.x),Ze(g.y))}_setActualLonLat(g,_){this.longitude.actual=g,this.latitude.actual=_}_setActualXY(g,_){this.x.actual=g,this.y.actual=_}};return g([_()],T.prototype,"geographic",void 0),g([_()],T.prototype,"effectiveX",null),g([_()],T.prototype,"effectiveY",null),g([_()],T.prototype,"key",null),T=g([S("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],T),T},pl=[0,0];let ul=class p2 extends(h$6(sl)){constructor(g){super(g),this.type="draw-mesh",this.orientation=x$1({lockable:!1}),this.scale=F$4({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};g([_()],ul.prototype,"helpMessage",void 0),g([_()],ul.prototype,"allFields",null),ul=g([S("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],ul);let dl=class i2 extends(h$6(sl)){constructor(g){super(g),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};g([_()],dl.prototype,"helpMessage",void 0),g([_()],dl.prototype,"allFields",null),dl=g([S("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],dl);let hl=class c2 extends(h$6(sl)){constructor(g){super(g),this.type="draw-polygon",this.direction=b$2(),this.distance=I$4({title:g=>g.messages.sketch.distance}),this.area=M$5(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};g([_()],hl.prototype,"xyMode",void 0),g([_()],hl.prototype,"helpMessage",void 0),g([_()],hl.prototype,"allFields",null),hl=g([S("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],hl);let vl=class c3 extends(h$6(sl)){constructor(g){super(g),this.type="draw-polyline",this.direction=b$2(),this.distance=I$4({title:g=>g.messages.sketch.distance}),this.totalLength=U$5(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};g([_()],vl.prototype,"helpMessage",void 0),g([_()],vl.prototype,"xyMode",void 0),g([_()],vl.prototype,"allFields",null),vl=g([S("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],vl);let gl=class p3 extends sl{constructor(g){super(g),this.type="draw-rectangle",this.xSize=ai,this.ySize=ai,this.area=oi}get allFields(){return[]}};function u$3(g,_=na()){return function o$3(g,_,S=na()){{const _=oa(g);return null!=_?_:sa(g,S)}}(g,0,_)}function T$3(g){const{directionOptions:_,geometryType:S,sketchOptions:O,tooltipInfos:T}=g,r5=_=>{const S=J$1(g).mode,O=T[_].elevation;"relative-to-ground"===S||"relative-to-scene"===S||"on-the-ground"===S?O.lock(N$2(g)):O.unlock()};switch(S){case"polygon":case"polyline":r5(S),(g=>{if(_){const S=T[g].direction;S.committed=_.angle,S.unlockOnVertexPlacement=!1,O.values.directionMode=_.mode}})(S);break;case"point":case"mesh":r5(S)}}function b$1(g,_){const{drawOperation:S,view:O}=_,T=I$3(_),I=J$1(_);if("2d"===O.type||!g||"absolute-height"!==I.mode||1!==(null==S?void 0:S.numCommittedVertices)||!T||"draw-polyline"!==T.type&&"draw-polygon"!==T.type||T.elevation.locked)return;const[k,C,$]=g,B=function B$2(g,_,S,O,T){const{view:I,drawOperation:k}=T;if("3d"!==I.type||!k)return;S??(S=0);const C=K$1(T),$=J$1(T),B=Ue(I,g,_,S,C,$,O);return di(B,C)??N$2(T)}(k,C,$,I,_);null!=B&&T.elevation.lock(B)}function U$4(g){var _;null==(_=I$3(g))||_.allFields.forEach((g=>{g.unlockOnVertexPlacement&&g.unlock()}))}function I$3({geometryType:g,graphic:_,tooltipInfos:S}){var O;return"multipoint"===g||(null==(O=null==_?void 0:_.geometry)?void 0:O.type)!==ml[g]?null:S[g]}g([_()],gl.prototype,"type",void 0),g([_()],gl.prototype,"xSize",void 0),g([_()],gl.prototype,"ySize",void 0),g([_()],gl.prototype,"area",void 0),g([_()],gl.prototype,"allFields",null),gl=g([S("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],gl);const ml={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function D$4(g,_){switch(null==g?void 0:g.type){case"draw-point":!function P$3(g,_){var S;const O=null==(S=_.graphic)?void 0:S.geometry;"point"===(null==O?void 0:O.type)&&(L$5(g,O,_),g.helpMessage=e$6("point",O))}(g,_);break;case"draw-polyline":!function z$3(g,_){const{createOperationGeometry:S,drawOperation:O}=_,T=null!=S?S.full:null;"polyline"===(null==T?void 0:T.type)&&(Z$1(g,_),g.totalLength.actual=O.lastVertex?jo(T)??ai:null,g.helpMessage=e$6("polyline",T))}(g,_);break;case"draw-polygon":!function S$7(g,_){const{createOperationGeometry:S,drawOperation:O}=_,T=null!=S?S.full:null;"polygon"===(null==T?void 0:T.type)&&(Z$1(g,_),g.area.actual=O.lastVertex?u$3(T)??oi:null,g.helpMessage=e$6("polygon",T))}(g,_);break;case"draw-rectangle":!function F$3(g,_){g.sketchOptions=_.sketchOptions,g.xSize=q$1(_),g.ySize=E$3(_),g.area=R$2(_)}(g,_);break;case"draw-circle":!function A$6(g,_){const{forceUniformSize:S,sketchOptions:O}=_;g.sketchOptions=O,g.radius=S?function X$1({createOperationGeometry:g}){var _;return(null!=(null==(_=null==g?void 0:g.circle)?void 0:_.center)&&null!=g.circle.edge?Vo(g.circle.center,g.circle.edge):null)??ai}(_):null,g.xSize=S?null:q$1(_),g.ySize=S?null:E$3(_),g.area=R$2(_)}(g,_);break;case"draw-mesh":!function G(g,_){const{graphic:S,view:O}=_,T=null==S?void 0:S.geometry;"3d"===O.type&&"mesh"===(null==T?void 0:T.type)&&(L$5(g,T.origin,_),R$4(g,T),g.helpMessage=function i$f(g,_){const S=null==g?void 0:g.geometry;if(!g||"mesh"!==(null==S?void 0:S.type)||!_)return;const{renderCoordsHelper:O,elevationProvider:T}=_,{camera:I}=_.state,{extent:k}=S,{center:C,spatialReference:$}=k,B=$e($),K=dt($),J=$e(O.spatialReference),tt=k.width*B,et=k.height*K,it=(k.zmax??0)*K,nt=it-(k.zmin??0)*K,ot=Math.max(tt,et,nt)/J,{x:st,y:at}=C,rt=C.z??0;Ct(Yr,st,at,rt),O.toRenderCoords(Yr,$,Yr);const lt=ot/I.computeScreenPixelSizeAt(Yr);if(lt>I.width*Zr)return"meshTooClose";if(lt<Nr)return"meshTooFar";const ct=Pe(g),{absoluteZ:pt}=je(st,at,it,$,_,ct);return pt<(T.getElevation(st,at,rt,$,"ground")??0)*K+nt*Br?"meshUnderground":"mesh"}(S,O))}(g,_)}}function L$5(g,_,S){const{drawOperation:O,view:T,sketchOptions:I}=S,{cursorVertex:k}=O;if(g.sketchOptions=I,g.viewType=T.type,g.setLocationFromPoint(_,K$1(S)),H$1(g.elevation,S),!k)return void(O.constraints=void 0);const C=k;O.constraints={context:Q$1(C,S),x:g.x.committed,y:g.y.committed,longitude:g.longitude.committed,latitude:g.latitude.committed,elevation:g.elevation.committed,distance:null,direction:null}}function Z$1(g,_){const{drawOperation:S,sketchOptions:O,view:T}=_,{cursorVertex:I,lastVertex:k,secondToLastVertex:C}=S,$=O.values.effectiveDirectionMode;g.sketchOptions=O,g.viewType=T.type;const B=k&&I?Vo(k,I)??ai:null;if(g.distance.actual=B,g.distance.readOnly=null==k,g.direction.actual=null,g.direction.readOnly=!0,k&&I&&("absolute"===$||C)){const _=Ks(C,k,I,$);g.direction.actual=_??pi,g.direction.readOnly=!1}g.setLocationFromPoint(I,K$1(_)),H$1(g.elevation,_);const K=function C$3(g,{sketchOptions:_}){const S=_.tooltips.xyMode;return"auto"===S?g?"direction-distance":"coordinates":S}(k,_);g.xyMode=K,g.direction.visible="direction-distance"===K,g.distance.visible="direction-distance"===K,g.effectiveX.visible="coordinates"===K,g.effectiveY.visible="coordinates"===K;const J=I??k;S.constraints=J?{context:Q$1(J,_),x:g.x.committed,y:g.y.committed,longitude:g.longitude.committed,latitude:g.latitude.committed,elevation:g.elevation.committed,distance:g.distance.committed,direction:g.direction.committed}:void 0}function H$1(g,_){const{drawOperation:S}=_,O=(null==S?void 0:S.cursorVertex)??(null==S?void 0:S.lastVertex);g.actual=ui(O)??N$2(_),g.visible=S.hasZ,g.readOnly=!1,g.showAsZ=!0}function R$2(g){var _;const S=null==(_=g.createOperationGeometry)?void 0:_.full;return"polygon"!==(null==S?void 0:S.type)?oi:u$3(S)??oi}function q$1(g){var _,S;const O=null==(S=null==(_=g.createOperationGeometry)?void 0:_.rectangle)?void 0:S.midpoints;return(null!=O?Vo(O.left,O.right):null)??ai}function E$3(g){var _,S;const O=null==(S=null==(_=g.createOperationGeometry)?void 0:_.rectangle)?void 0:S.midpoints;return(null!=O?Vo(O.top,O.bottom):null)??ai}function J$1(g){return g.drawOperation.elevationInfo??mt}function K$1(g){return g.drawOperation.coordinateHelper.spatialReference}function N$2(g){const _=dt(K$1(g));return Ge(g.defaultZ*_,"meters")}function Q$1(g,_){return function Z$3(g,_,S,O,T,I){let k="geodesic",C=Zo(S);const $=Ps();return $s(g,_,O,$),$[2]=0,C&&Ve($,S,$,C)||(k="euclidean",C=S),{mode:k,view:_,elevationInfo:O,hasZ:T,directionMode:I,spatialReference:g.spatialReference,measurementSR:C,origin:$}}(g,_.view,K$1(_),J$1(_),_.drawOperation.coordinateHelper.hasZ(),_.sketchOptions.values.effectiveDirectionMode)}let fl=class t2 extends O{constructor(g){super(g),this.enabled=!1}};g([_({type:Boolean,nonNullable:!0})],fl.prototype,"enabled",void 0),fl=g([S("esri.views.interactive.sketch.SketchLabelOptions")],fl);const _l=fl;let yl=class t3 extends O{constructor(g){super(g),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};g([_({type:String,nonNullable:!0})],yl.prototype,"mode",void 0),yl=g([S("esri.views.interactive.sketch.SketchTooltipElevationOptions")],yl);let bl=class a2 extends O{constructor(g){super(g),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};g([_({type:Boolean,nonNullable:!0})],bl.prototype,"area",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"coordinates",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"direction",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"distance",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"elevation",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"header",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"helpMessage",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"orientation",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"radius",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"rotation",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"scale",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"size",void 0),g([_({type:Boolean,nonNullable:!0})],bl.prototype,"totalLength",void 0),bl=g([S("esri.views.interactive.sketch.SketchTooltipVisibleElements")],bl);const Ml=bl;let wl=class r2 extends O{constructor(g){super(g),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new yl,this.visibleElements=new Ml,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};g([_({type:Boolean,nonNullable:!0})],wl.prototype,"enabled",void 0),g([_()],wl.prototype,"forceEnabled",void 0),g([_()],wl.prototype,"effectiveEnabled",null),g([_()],wl.prototype,"helpMessage",void 0),g([_()],wl.prototype,"helpMessageIcon",void 0),g([_({type:Boolean,nonNullable:!0})],wl.prototype,"inputEnabled",void 0),g([_({type:yl,nonNullable:!0})],wl.prototype,"elevation",void 0),g([_({type:Ml,nonNullable:!0})],wl.prototype,"visibleElements",void 0),g([_()],wl.prototype,"visualVariables",void 0),g([_()],wl.prototype,"xyMode",void 0),wl=g([S("esri.views.interactive.sketch.SketchTooltipOptions")],wl);const xl=wl;let Sl=class s2 extends O{constructor(g){super(g),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?Hs.RelativeBilateral:Hs.Relative;case"absolute":return Hs.Absolute}}};g([_({type:String,nonNullable:!0})],Sl.prototype,"directionMode",void 0),g([_({type:Boolean,nonNullable:!0})],Sl.prototype,"relativeDirectionIsBilateral",void 0),g([_()],Sl.prototype,"effectiveDirectionMode",null),Sl=g([S("esri.views.interactive.sketch.SketchValueOptions")],Sl);const Ol=Sl;let Tl=class c4 extends O{constructor(g){super(g),this.labels=new _l,this.tooltips=new xl,this.values=new Ol}};g([_({nonNullable:!0,type:_l})],Tl.prototype,"labels",void 0),g([_({nonNullable:!0,type:xl})],Tl.prototype,"tooltips",void 0),g([_({nonNullable:!0,type:Ol})],Tl.prototype,"values",void 0),Tl=g([S("esri.views.interactive.sketch.SketchOptions")],Tl);const El=Tl,Il="esri-tooltip",kl=`${Il}-content`,Rl=`${Il}-content--input`,Cl=`${Il}-content__header`,Dl=`${Il}-content__header__spacer`,Al=`${Il}-content__header__actions`,$l=`${Il}-draw-header-actions`,Pl=`${Il}-table`,jl=`${Il}-help-message`,Vl=`${Il}-help-message__text`,Ll=`${Il}-help-message__icon`,zl=`${Il}-field`,Hl={base:zl,inputMode:`${zl}--input`,title:`${zl}__title`,value:`${zl}__value`};let Ul=class c5 extends hi{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return vi("div",{class:this.classes({[Hl.base]:!0,[Hl.inputMode]:"input"===this.mode})},vi("div",{class:Hl.title},this.title),vi("div",{class:Hl.value},this.value))}};g([_()],Ul.prototype,"hidden",void 0),g([_()],Ul.prototype,"mode",void 0),g([_()],Ul.prototype,"title",void 0),g([_()],Ul.prototype,"value",void 0),Ul=g([S("esri.views.interactive.tooltip.components.TooltipField")],Ul);const Gl={base:`${Il}-value-by-value`};let Fl=class a3 extends hi{constructor(){super(...arguments),this.divider="×"}render(){return vi("div",{class:Gl.base},vi("span",null,this.left),vi("span",null,this.divider),vi("span",null,this.right))}};g([_()],Fl.prototype,"left",void 0),g([_()],Fl.prototype,"divider",void 0),g([_()],Fl.prototype,"right",void 0),Fl=g([S("esri.views.interactive.tooltip.components.ValueByValue")],Fl);let Nl=class D extends hi{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transition=null,this._mode="feedback",this._getFormatters=Sa(D$7),this._onDiscard=()=>{this.info.clearInputValues(),this.exitInputMode()},this._onCommit=(g,_)=>{if("commit-and-exit"===_)return void this.exitInputMode();if("commit-on-blur"===_)return;const S=this._getFocusableElements(),O=S.length,T=S.indexOf(g);if(-1===T)return void this.exitInputMode();const I=((T+("commit-and-next"===_?1:-1))%O+O)%O;S$6(S.at(I))},this._handleTab=g=>{if(g.code!==ea.next)return;const _=this._getFocusableElements(),S=_.at(0),O=_.at(-1);S&&O&&(g.shiftKey?document.activeElement===S&&(g.preventDefault(),S$6(O)):document.activeElement===O&&(g.preventDefault(),S$6(S)))}}get mode(){return this._mode}get _displayUnits(){const g=To(this.tooltip.view);return{length:g,verticalLength:g,area:g,angle:"degrees"}}get _inputUnitInfos(){const g=this._messagesUnits,e6=_=>({unit:_,abbreviation:Oa(g,_,"abbr")}),_=To(this.tooltip.view),S=e6(Oi(_)),O=e6(Ti(_)),T=e6(Ei(_)),I=e6("degrees");return{length:S,lengthRelative:S,verticalLength:O,verticalLengthRelative:O,area:T,direction:I,orientation:I,rotation:I,longitudeLatitude:I}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:g}=this.info.sketchOptions.tooltips,_=this._renderedContent,S=this._renderedActions,O=this._renderedHelpMessage,T=_.length>0,I=T||!!O,k="input"===this.mode;return vi("div",{class:fi(kl,k&&Rl),onkeydown:this._handleTab},k&&I&&g.header?vi("div",{class:Cl,key:"header"},vi("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),S.length>0?vi(mi,null,vi("div",{class:Dl,key:"spacer"}),vi("div",{class:Al,key:"actions"},S)):null):null,T?vi("div",{class:Pl,key:"content"},..._):null,O)}_renderActions(){return null}loadDependencies(){return _i({button:()=>yi((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),icon:()=>yi((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([15,13,1,2,4,5,12])),input:()=>yi((()=>import("./calcite-input-Ch73Rboo.js")),__vite__mapDeps([16,17,1,2,4,5,3,6,11,7,8,9,10,12,13]))})}async enterInputMode(g){try{await this._transitionTo("input"),await this._focusField(g)}catch(wr){bi(wr)}}async exitInputMode({focusOnView:g=!0}={}){var _;try{const{container:S,info:O}=this;O.clearInputValues();const T=g?null==(_=null==S?void 0:S.closest(".esri-view"))?void 0:_.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),T instanceof HTMLElement&&T.focus()}catch(wr){bi(wr)}}get _renderedContent(){return H(this._renderContent())}get _renderedActions(){return H(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:g,visibleElements:_}=this.info;if(!_.helpMessage)return null;const S=g.tooltips.helpMessage??this._defaultHelpMessage;if(!S)return null;const O=g.tooltips.helpMessageIcon??"information";return vi("div",{class:jl,key:"help-message"},O?vi("calcite-icon",{class:Ll,icon:O,scale:"s"}):null,vi("div",{class:Vl},S))}get _defaultHelpMessage(){var g,_,S;const{helpMessage:O,viewType:T}=this.info;if(null==O)return null;const I="3d"===T?"helpMessages3d":"helpMessages2d";return null==(S=null==(_=null==(g=this._messagesTooltip)?void 0:g.sketch)?void 0:_[I])?void 0:S[O]}async _focusField(g){var _;null==(_=this._focusAbortController)||_.abort(),this._focusAbortController=new AbortController;const{signal:S}=this._focusAbortController;await this._waitForInputs(),k(S);const O=this._getFocusableInputs(),T=g?O.find((_=>_.getAttribute("data-field-name")===g)):O.at(0);await S$6(T)}async _transitionTo(g){var _,S;if(this._mode===g)return;const o2=()=>{this._mode=g};if(!(null==(_=this.domNode)?void 0:_.firstChild)||!document.startViewTransition||Mi())return void o2();this.autoRenderingEnabled=!1,null==(S=this._transition)||S.skipTransition();const O=this._transition=document.startViewTransition((()=>{if(!this.destroyed)return this.autoRenderingEnabled=!0,o2(),this.renderNow(),wi()}));try{await this._transition.finished}finally{O===this._transition&&(this._transition=null)}}async _waitForInputs(){const t5=()=>{var g;return Array.from((null==(g=this.domNode)?void 0:g.querySelectorAll("calcite-input"))??[])};for(;0===t5().length;)await xi(Zl);await Si()}_getFocusableInputs(){var g;return Array.from((null==(g=this.domNode)?void 0:g.querySelectorAll("calcite-input:not([read-only]):not([disabled])"))??[])}_getFocusableElements(){var g;const _=null==(g=this.domNode)?void 0:g.querySelector(`.${$l}`);return[...Array.from((null==_?void 0:_.querySelectorAll(`.${Al} calcite-button:not([disabled])`))??[]),...this._getFocusableInputs()]}};async function S$6(g){await(null==g?void 0:g.setFocus())}function H(g){return(Array.isArray(g)?g:[g]).flat(10).filter((g=>!!g))}g([gi("esri/core/t9n/Units"),_()],Nl.prototype,"_messagesUnits",void 0),g([gi("esri/views/interactive/tooltip/t9n/Tooltip"),_()],Nl.prototype,"_messagesTooltip",void 0),g([_()],Nl.prototype,"info",void 0),g([_()],Nl.prototype,"tooltip",void 0),g([_()],Nl.prototype,"_mode",void 0),g([_()],Nl.prototype,"mode",null),g([_()],Nl.prototype,"_displayUnits",null),g([_()],Nl.prototype,"_inputUnitInfos",null),g([_()],Nl.prototype,"_formatters",null),g([_()],Nl.prototype,"fieldContext",null),g([_()],Nl.prototype,"_renderedContent",null),g([_()],Nl.prototype,"_renderedActions",null),g([_()],Nl.prototype,"_renderedHelpMessage",null),g([_()],Nl.prototype,"_defaultHelpMessage",null),Nl=g([S("esri.views.interactive.tooltip.content.TooltipContent")],Nl);const Zl=20;let Bl=class n3 extends Nl{_renderContent(){const{area:g,radius:_,xSize:S,ySize:O,visibleElements:T}=this.info,I=this._messagesTooltip.sketch,k=this._formatters;return vi(mi,null,T.radius&&null!=_?vi(Ul,{title:I.radius,value:k.length(_)}):null,T.size&&null!=S&&null!=O?vi(Ul,{title:I.size,value:vi(Fl,{left:k.length(S),right:k.length(O)})}):null,T.area?vi(Ul,{title:I.area,value:k.area(g)}):null)}};Bl=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Bl);const Yl=`${Il}-editable-field`,Xl={base:Yl,inputMode:`${Yl}--input`,feedbackMode:`${Yl}--feedback`,readOnly:`${Yl}--read-only`,locked:`${Yl}--locked`,title:`${Yl}__title`,value:`${Yl}__value`,valueContent:`${Yl}__value__content`,valueContentReadOnly:`${Yl}__value__content--read-only`,lockIcon:`${Yl}__lock-icon`,input:`${Yl}__input`,inputSuffix:`${Yl}__input-suffix`,button:`${Yl}__button`},Wl="lock",ql="unlock";let Kl=class h extends hi{constructor(){super(...arguments),this._input=null,this._onKeyDown=g=>{g.key===ea.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=g=>{const _=this._input;if(_)switch(g.key){case ea.commit:return this.field.onCommit("commit-and-exit",_,this.context);case ea.next:{g.preventDefault(),g.stopPropagation();const S=g.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(S,_,this.context)}}},this._onInput=g=>{this.field.onInput(g.target.value)},this._onInputBlur=()=>{const g=this._input;g&&this.field.onCommit("commit-on-blur",g,this.context)},this._selectText=()=>{const t5=()=>{var g;this._input===document.activeElement&&(null==(g=this._input)||g.selectText())};t5(),Si().then(t5)}}initialize(){this.addHandles(C((()=>this._rawDisplayValue),(()=>{const{committed:g,inputValue:_}=this.field;g||_||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return _i({button:()=>yi((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),icon:()=>yi((()=>import("./calcite-icon-I_Xwj0DW.js")),__vite__mapDeps([15,13,1,2,4,5,12])),input:()=>yi((()=>import("./calcite-input-Ch73Rboo.js")),__vite__mapDeps([16,17,1,2,4,5,3,6,11,7,8,9,10,12,13]))})}render(){const{field:g,mode:_}=this,S="input"===_,{locked:O,readOnly:T}=g;return vi("div",{class:this.classes({[Xl.base]:!0,[Xl.feedbackMode]:"feedback"===_,[Xl.inputMode]:"input"===_,[Xl.locked]:O,[Xl.readOnly]:T})},vi("div",{class:Xl.title,key:"title"},this._title),vi("div",{class:Xl.value,key:"value",onkeydown:this._onKeyDown},S?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Jl}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:g}=this.field;return"string"==typeof g?g:g(this.context)}_renderValueFeedbackMode(){return vi(mi,null,vi("div",{class:Xl.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?vi("calcite-icon",{class:Xl.lockIcon,icon:Wl,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return vi("div",{class:this.classes(Xl.valueContent,Xl.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){var g;const{field:_}=this,{name:S,invalid:O,locked:T}=_,I=(null==(g=this.context)?void 0:g.messages.sketch)??{},k=T?I.unlockConstraint:I.lockConstraint;return vi(mi,null,vi("calcite-input",{afterCreate:g=>{this._input=g},class:Xl.input,"data-field-name":S,"data-testid":`tooltip-field-${S}`,onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:O?"invalid":"idle",type:"text",value:this._rawDisplayValue??Jl,onCalciteInputInput:this._onInput}),vi("div",{class:Xl.inputSuffix,key:"suffix"},this._suffix),_.lockable?vi("calcite-button",{alignment:"center",appearance:"transparent",class:Xl.button,"data-testid":`tooltip-field-${S}-lock`,iconStart:T?Wl:ql,key:"lock",kind:"neutral",label:k,onclick:()=>{_.toggleLock(this.context)},scale:"s",tabIndex:-1,title:k}):vi("div",{key:"lock-empty"}))}};g([_()],Kl.prototype,"field",void 0),g([_()],Kl.prototype,"context",void 0),g([_()],Kl.prototype,"mode",void 0),g([_()],Kl.prototype,"_input",void 0),g([_()],Kl.prototype,"_formattedValue",null),g([_()],Kl.prototype,"_rawDisplayValue",null),g([_()],Kl.prototype,"_suffix",null),g([_()],Kl.prototype,"_title",null),Kl=g([S("esri.views.interactive.tooltip.components.TooltipEditableField")],Kl);const Jl="—";function i$c(g){const _=g.fields.filter((g=>!0===(null==g?void 0:g.visible)));return 0===_.length?null:vi(mi,null,_.map((_=>vi(Kl,{context:g.context,field:_,key:_.id,mode:g.mode}))))}let Ql=class s3 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{visibleElements:O}=_;return vi(i$c,{context:g,fields:[O.coordinates?_.effectiveX:void 0,O.coordinates?_.effectiveY:void 0,O.elevation?_.elevation:void 0,O.orientation?_.orientation:void 0,O.scale?_.scale:void 0],mode:S})}};Ql=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Ql);let tc=class i3 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{elevation:O,visibleElements:T}=_;return vi(i$c,{context:g,fields:[T.coordinates?_.effectiveX:void 0,T.coordinates?_.effectiveY:void 0,T.elevation?O:void 0],mode:S})}};tc=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],tc);const ec={absolute:"absolute-direction",relative:"relative-direction"};let ic=class p4 extends hi{constructor(g){super(g),this.visibleElements={}}render(){return vi("div",{class:$l},this._isElementVisible("direction")?vi(l$a,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return _i({button:()=>yi((()=>import("./calcite-button-BNKeIR-C.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),dropdown:()=>yi((()=>import("./calcite-dropdown-BaxqQ9bY.js")),__vite__mapDeps([18,1,2,4,5,19,20,6,11,9,12,21])),"dropdown-item":()=>yi((()=>import("./calcite-dropdown-item-1XlYGPpf.js")),__vite__mapDeps([22,1,2,4,5,9,8,6,23,13,12])),"dropdown-group":()=>yi((()=>import("./calcite-dropdown-group-DO1CdXTp.js")),__vite__mapDeps([24,1,2,12,23]))})}_isElementVisible(g){var _;return(null==(_=this.visibleElements)?void 0:_[g])??this.sketchOptions.tooltips.visibleElements[g]}};function l$a(g){var _,S,O,T;const{directionMode:I}=g.sketchOptions.values,k=null==(_=g.messages)?void 0:_.sketch,C=null==(S=null==k?void 0:k.directionModeSelect)?void 0:S.title,$="absolute",B="relative";return vi("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:_=>{var S,O;const T=null==(O=null==(S=_.target.selectedItems)?void 0:S[0])?void 0:O.getAttribute("data-mode");g.sketchOptions.values.directionMode=T??"absolute"}},vi("calcite-button",{alignment:"end",appearance:"transparent",iconStart:ec[I],kind:"neutral",label:C,scale:"s",slot:"trigger",title:C}),vi("calcite-dropdown-group",{selectionMode:"single"},vi("calcite-dropdown-item",{"data-mode":B,"data-testid":"tooltip-direction-mode-relative",iconStart:ec.relative,key:"relative",selected:I===B},null==(O=null==k?void 0:k.directionModeSelect)?void 0:O.relative),vi("calcite-dropdown-item",{"data-mode":$,"data-testid":"tooltip-direction-mode-absolute",iconStart:ec.absolute,key:"absolute",selected:I===$},null==(T=null==k?void 0:k.directionModeSelect)?void 0:T.absolute)))}g([gi("esri/views/interactive/tooltip/t9n/Tooltip"),_()],ic.prototype,"messages",void 0),g([_()],ic.prototype,"sketchOptions",void 0),g([_()],ic.prototype,"visibleElements",void 0),ic=g([S("esri.views.interactive.tooltip.components.DrawHeaderActions")],ic);let nc=class n4 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{xyMode:O,visibleElements:T}=_;return vi(i$c,{context:g,fields:[..."direction-distance"===O?[T.direction?_.direction:void 0,T.distance?_.distance:void 0]:[T.coordinates?_.effectiveX:void 0,T.coordinates?_.effectiveY:void 0],T.elevation?_.elevation:void 0,T.area?_.area:void 0],mode:S})}_renderActions(){const{xyMode:g,sketchOptions:_}=this.info;return vi(ic,{sketchOptions:_,visibleElements:{direction:"direction-distance"===g}})}};nc=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],nc);let oc=class n5 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{xyMode:O,visibleElements:T}=_;return vi(i$c,{context:g,fields:[..."direction-distance"===O?[T.direction?_.direction:void 0,T.distance?_.distance:void 0]:[T.coordinates?_.effectiveX:void 0,T.coordinates?_.effectiveY:void 0],T.elevation?_.elevation:void 0,T.totalLength?_.totalLength:void 0],mode:S})}_renderActions(){const{xyMode:g,sketchOptions:_}=this.info;return vi(ic,{sketchOptions:_,visibleElements:{direction:"direction-distance"===g}})}};oc=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],oc);let sc=class n6 extends Nl{_renderContent(){const{area:g,xSize:_,ySize:S,visibleElements:O}=this.info,T=this._messagesTooltip.sketch,I=this._formatters;return vi(mi,null,O.size&&null!=_&&null!=S?vi(Ul,{title:T.size,value:vi(Fl,{left:I.length(_),right:I.length(S)})}):null,O.area?vi(Ul,{title:T.area,value:I.area(g)}):null)}};sc=g([S("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],sc);let ac=class n7 extends Nl{_renderContent(){const{angle:g,visibleElements:_}=this.info,S=this._messagesTooltip.sketch;return vi(mi,null,_.rotation?vi(Ul,{title:S.rotation,value:this._formatters.angleRelative(g)}):null)}};ac=g([S("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],ac);let rc=class n8 extends Nl{_renderContent(){const g=this.info,{visibleElements:_}=g,S=this._messagesTooltip.sketch,O=this._formatters;return vi(mi,null,_.size?vi(Ul,{title:S.size,value:vi(Fl,{left:O.length(g.xSize),right:O.length(g.ySize)})}):null,_.scale?vi(Ul,{title:S.scale,value:vi(Fl,{left:O.scale(g.xScale),right:O.scale(g.yScale)})}):null)}};rc=g([S("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],rc);let lc=class i4 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{visibleElements:O}=_;return vi(i$c,{context:g,fields:[O.coordinates?_.effectiveX:void 0,O.coordinates?_.effectiveY:void 0,O.elevation?_.elevation:void 0],mode:S})}};lc=g([S("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],lc);let cc=class l2 extends Nl{_renderContent(){const{area:g,distance:_,totalLength:S,visibleElements:O}=this.info,T=this._messagesTooltip.sketch,I=this._formatters;return vi(mi,null,O.distance?vi(Ul,{title:T.distance,value:I.lengthRelative(_)}):null,O.area&&null!=g?vi(Ul,{title:T.area,value:I.area(g)}):null,O.totalLength&&null!=S?vi(Ul,{title:T.totalLength,value:I.length(S)}):null)}};cc=g([S("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],cc);let pc=class i5 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{visibleElements:O}=_;return vi(i$c,{context:g,fields:[O.coordinates?_.effectiveX:void 0,O.coordinates?_.effectiveY:void 0,O.elevation?_.elevation:void 0,O.area&&"polygon"===_.geometryType?_.area:null,O.totalLength&&"polyline"===_.geometryType?_.totalLength:null],mode:S})}};pc=g([S("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],pc);let uc=class l3 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch,O=this._formatters;return vi(mi,null,_.orientation&&null!=g.orientation?vi(Ul,{key:"orientation",title:S.orientation,value:Ao(g.orientation,g.rotationType,g.orientationPrecision)}):null,_.size&&null!=g.size?vi(Ul,{key:"size",title:S.size,value:O.length(g.size,g.sizeUnit,g.sizePrecision)}):null)}};uc=g([S("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],uc);let dc=class s4 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{visibleElements:O}=_;return vi(i$c,{context:g,fields:[O.coordinates?_.effectiveX:void 0,O.coordinates?_.effectiveY:void 0,O.elevation?_.elevation:void 0,O.orientation?_.orientation:void 0,O.scale?_.scale:void 0],mode:S})}};dc=g([S("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],dc);let hc=class i6 extends Nl{_renderContent(){const{fieldContext:g,info:_,mode:S}=this,{visibleElements:O}=_;return vi(i$c,{context:g,fields:[O.coordinates?_.effectiveX:void 0,O.coordinates?_.effectiveY:void 0,O.elevation?_.elevation:void 0],mode:S})}};hc=g([S("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],hc);let vc=class l4 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch;return vi(mi,null,_.rotation&&null!=g.rotation?vi(Ul,{key:"rotation",title:S.rotation,value:$o(g.rotation,g.rotationType,g.rotationPrecision)}):null,_.orientation&&null!=g.orientation?vi(Ul,{key:"orientation",title:S.orientation,value:Ao(g.orientation,g.rotationType,g.orientationPrecision)}):null)}};vc=g([S("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],vc);let gc=class l5 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch,O=this._formatters;return vi(mi,null,_.scale&&null!=g.scale?vi(Ul,{key:"scale",title:S.scale,value:O.percentage(g.scale)}):null,_.size&&null!=g.size?vi(Ul,{key:"size",title:S.size,value:O.length(g.size,g.sizeUnit,g.sizePrecision)}):null)}};gc=g([S("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],gc);let mc=class n9 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch,O=this._formatters;return vi(mi,null,_.distance?vi(Ul,{title:S.distance,value:O.length(g.distance)}):null)}};mc=g([S("esri.views.interactive.tooltip.content.TooltipContentTranslate")],mc);let fc=class i7 extends Nl{_renderContent(){const{distance:g,elevation:_,area:S,totalLength:O,visibleElements:T}=this.info,I=this._messagesTooltip.sketch,k=this._formatters;return vi(mi,null,T.distance?vi(Ul,{title:I.distance,value:k.length(g)}):null,T.elevation&&null!=(null==_?void 0:_.actual)?vi(Ul,{title:I.elevation,value:k.verticalLength(_.actual)}):null,T.area&&null!=S?vi(Ul,{title:I.area,value:k.area(S)}):null,T.totalLength&&null!=O?vi(Ul,{title:I.totalLength,value:k.length(O)}):null)}};fc=g([S("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],fc);let _c=class n10 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch,O=this._formatters;return vi(mi,null,_.distance?vi(Ul,{title:S.distance,value:O.length(g.distance)}):null)}};_c=g([S("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],_c);let yc=class n11 extends Nl{_renderContent(){const{info:g}=this,{visibleElements:_}=g,S=this._messagesTooltip.sketch;return vi(mi,null,_.distance?vi(Ul,{title:S.distance,value:this._formatters.verticalLengthRelative(g.distance)}):null)}};yc=g([S("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],yc);const bc={base:`${Il}`};let Mc=class h2 extends xt.EventedAccessor{constructor(g){super(g),this.info=null,this.position=null,this.content=null,this.contentContainer=(()=>{const g=document.createElement("div");return g.classList.add(bc.base),Ii(g),g})()}initialize(){const{contentContainer:g}=this;this.addHandles([C((()=>{var g;return null==(g=this.view.overlay)?void 0:g.surface}),(_=>{g.remove(),null==_||_.appendChild(g)}),yt),C((()=>this.info),((_,S)=>{if(null!=this.content&&null!=_&&null!=S&&_.type===S.type)this.content.info=_;else{this.content=ki(this.content);const S=function h$3(g,_){if(null==_)return null;const S=document.createElement("div");switch(_.type){case"draw-point":return new tc({tooltip:g,info:_,container:S});case"draw-polygon":return new nc({tooltip:g,info:_,container:S});case"draw-polyline":return new oc({tooltip:g,info:_,container:S});case"draw-mesh":return new Ql({tooltip:g,info:_,container:S});case"draw-rectangle":return new sc({tooltip:g,info:_,container:S});case"draw-circle":return new Bl({tooltip:g,info:_,container:S});case"extent-rotate":return new ac({tooltip:g,info:_,container:S});case"extent-scale":return new rc({tooltip:g,info:_,container:S});case"move-point":return new lc({tooltip:g,info:_,container:S});case"selected-vertex":return new pc({tooltip:g,info:_,container:S});case"transform-absolute":return new uc({tooltip:g,info:_,container:S});case"transform-point":return new hc({tooltip:g,info:_,container:S});case"transform-mesh":return new dc({tooltip:g,info:_,container:S});case"transform-rotate":return new vc({tooltip:g,info:_,container:S});case"transform-scale":return new gc({tooltip:g,info:_,container:S});case"translate":return new mc({tooltip:g,info:_,container:S});case"translate-vertex":return new fc({tooltip:g,info:_,container:S});case"translate-z":return new yc({tooltip:g,info:_,container:S});case"translate-xy":return new _c({tooltip:g,info:_,container:S});case"reshape-edge-offset":return new cc({tooltip:g,info:_,container:S})}}(this,_);S&&(this.content=S,S.container&&g.appendChild(S.container),this.exitInputMode())}}),yt),C((()=>({container:this.contentContainer,content:this.content,screenPoint:this._screenPoint,positionMode:this.positionMode,position:this.position})),m$2,yt),Ri(this.contentContainer,"paste",(g=>{this.emit("paste",g)}))])}destroy(){this.info=null,this.content=ki(this.content),this.contentContainer.remove()}get positionMode(){var g;return"input"===(null==(g=this.content)?void 0:g.mode)?"fixed":"follow-cursor"}get mode(){var g;return(null==(g=this.content)?void 0:g.mode)??"feedback"}get _screenPoint(){const{inputManager:g}=this.view;return(null==g?void 0:g.multiTouchActive)?null:null==g?void 0:g.latestPointerLocation}get visible(){var g;return"none"!==(null==(g=this.contentContainer)?void 0:g.style.display)}clear(){this.info=null}async enterInputMode(g){var _;await(null==(_=this.content)?void 0:_.enterInputMode(g))}async exitInputMode(g){var _;await(null==(_=this.content)?void 0:_.exitInputMode(g))}};function m$2(g){if("fixed"===g.positionMode&&!g.position)return;const{style:_}=g.container,S=g.position??g.screenPoint;if(null!=S&&null!=g.content){_.display="block";const O=Ci(g.container),T=`translate(${Math.round(S.x)+wc[0]*(O?-1:1)}px, ${Math.round(S.y)+wc[1]}px)`;_.transform=O?`translate(-100%, 0) ${T}`:T}else _.display="none"}g([_({nonNullable:!0})],Mc.prototype,"view",void 0),g([_()],Mc.prototype,"info",void 0),g([_()],Mc.prototype,"positionMode",null),g([_()],Mc.prototype,"position",void 0),g([_()],Mc.prototype,"content",void 0),g([_()],Mc.prototype,"mode",null),g([_()],Mc.prototype,"contentContainer",void 0),g([_()],Mc.prototype,"_screenPoint",null),Mc=g([S("esri.views.interactive.tooltip.Tooltip")],Mc);const wc=[20,20];let xc=class E extends(xt.EventedMixin(aa)){constructor(g){super(g),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new El}initialize(){const{view:g}=this;this.internalGraphicsLayer=new Di({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const _=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function M$4(g,_){return{point:new dl({sketchOptions:_,viewType:g}),polyline:new vl({sketchOptions:_,viewType:g}),polygon:new hl({sketchOptions:_,viewType:g}),mesh:new ul({sketchOptions:_,viewType:g}),rectangle:new gl({sketchOptions:_}),circle:new al({sketchOptions:_})}}(g.type,this.sketchOptions);const S=this.tooltip=new Mc({view:g});T$3(this._tooltipsContext),this._coordinateFormatterLoadTask=T((()=>w$5())),this.addHandles([_.on("vertex-add",(g=>this.onVertexAdd(g))),_.on("vertex-remove",(g=>this.onVertexRemove(g))),_.on("vertex-update",(g=>this.onVertexUpdate(g))),_.on("cursor-update",(g=>this.onCursorUpdate(g))),_.on("cursor-remove",(()=>this._updateGraphic())),_.on("complete",(g=>this.onComplete(g))),this._coordinateFormatterLoadTask,S.on("paste",(g=>B$3(g,this.activeTooltipInfo))),C((()=>this.cursor),(g=>{_.cursor=g}),yt),Ai((()=>{const{activeTooltipInfo:g,sketchOptions:_}=this;D$4(g,this._tooltipsContext),S.info=_.tooltips.effectiveEnabled?g:null})),Ai((()=>{_.constraintZ=function Y$1(g){const{geometryType:_,tooltipInfos:S}=g;switch(_){case"point":case"mesh":case"polyline":case"polygon":{const O=S[_].elevation.committed;if(!O)return;return ze(O,"meters")/dt(K$1(g))}default:return}}(this._tooltipsContext)}))]),this.finishToolCreation()}destroy(){this.drawOperation=ki(this.drawOperation),this.tooltip=ki(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=ki(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(g){this._set("centered",g),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(g){this._set("cursor",g)}set enabled(g){this.drawOperation.interactive=g,this._set("enabled",g)}set forceUniformSize(g){this._set("forceUniformSize",g),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(g){this._set("graphicSymbol",g),null!=this._graphic&&(this._graphic.symbol=g)}set mode(g){const _=this.drawOperation;_&&(_.drawingMode=g),this._set("mode",g)}get updating(){var g;return(null==(g=this.drawOperation)?void 0:g.updating)??!1}get undoRedo(){const{view:{type:g,map:_}}=this;return"2d"===g&&_&&"undoRedo"in _&&_.undoRedo instanceof Ar?_.undoRedo:null}set undoRedo(g){this._override("undoRedo",g)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(g){this.destroyed||G$1(g,this.tooltip)||this.drawOperation.onInputEvent(g)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&T$3(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Oc.outline),this.removeHandles(Oc.regularVertices),this.removeHandles(Oc.activeVertex),this.removeHandles(Oc.activeEdge),this.removeHandles(Sc)}_createOrUpdateGraphic(g){if(null!=this._graphic)return this.updateGraphicGeometry(g),this._graphic;const _=new $i({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=_,this.updateGraphicGeometry(g),this.internalGraphicsLayer.add(_),this.addHandles(this.initializeGraphic(_)),this.notifyChange("graphic"),this.addHandles(B((()=>{this.internalGraphicsLayer.remove(_),this._graphic===_&&(this._graphic=null)})),Sc),_}updateGraphicGeometry(g){this._graphic.geometry=g}_getCreateOperationGeometry(g={operationComplete:!1}){var _,S;if(null==this.drawOperation)return;const{coordinateHelper:O,view:T,visualizationCursorVertex:I,lastVertex:k,committedVertices:C,geometryIncludingUncommittedVertices:$,numCommittedVertices:B}=this.drawOperation;if(!(B>0||null!=I))return;const K=g.operationComplete?C:$,J=K.length,tt=null!=I?O.pointToArray(I):null,et=this._drawSpatialReference,it="3d"===T.type&&"global"===T.viewingMode,nt=new $r;nt.committedVertices=C,nt.cursorVertex=tt;const{geometryType:ot}=this;switch(ot){case"point":case"mesh":nt.full=O.arrayToPoint(K[0]);break;case"multipoint":nt.full=J>0?function d$3(g,_){return new Te({points:g,spatialReference:_})}(K,et):null;break;case"polyline":case"polygon":J>0&&(nt.full="polygon"===ot?j$5([K],et,it,!0):R$6([K],et,it),nt.cursorEdge=null!=tt&&k&&!Is(I,k)?R$6([[tt,O.pointToArray(k)]],et,it):null,nt.outline=J>1?nt.full:null);break;case"circle":case"rectangle":{if(nt.committedVertices=nt.cursorVertex=null,!J)break;const O=function F$8(g,_){if("2d"===g.type)return new zr(g.state.transform,g.spatialReference,_.length>2?_[2]:null);if("3d"===g.type){const S=_.length>2?new Qt({x:_[0],y:_[1],z:_[2],spatialReference:g.spatialReference}):new Qt({x:_[0],y:_[1],spatialReference:g.spatialReference});return new Hr(g,S)}return null}(T,K[0]),I=K[0],k=O.makeMapPoint(I[0]+Tc*T.resolution,I[1]);"circle"===ot?1===J&&g.operationComplete?nt.circle=L$7([I,k],O,!0):2===J&&(this.forceUniformSize?nt.circle=L$7(K,O,this.centered):nt.rectangle=function v$3(g,_,S){const O=_.mapToLocalMultiple(g),T=O[0],I=O[1],k=Math.round(I.x-T.x),C=Math.round(I.y-T.y),$=w$4(S?T.x:T.x+k/2,S?T.y:T.y+C/2),B=S?k:k/2,K=S?C:C/2,J=[],tt=2*Math.PI/60;function h4(g){const _=Math.cos(g),S=Math.sin(g);return w$4(B*_+$.x,K*S+$.y)}for(let lt=0;lt<60;lt++)J.push(h4(lt*tt));J.push(J[0]);const{spatialReference:et,doUnnormalization:it}=_,nt=j$5([J.map((g=>_.localToMap(g))).filter(Oe)],et,it,!1),ot=_.localToMap(h4(Math.PI/2)),st=_.localToMap(h4(0)),at=_.localToMap(h4(-Math.PI/2)),rt=_.localToMap(h4(Math.PI));return{geometry:nt,midpoints:null!=ot&&null!=st&&null!=at&&null!=rt?{top:g$3(ot,et),right:g$3(st,et),bottom:g$3(at,et),left:g$3(rt,et)}:null}}(K,O,this.centered)):1===J&&g.operationComplete?nt.rectangle=T$7([I,k],O,!0):2===J&&(nt.rectangle=this.forceUniformSize?T$7(K,O,this.centered):function b$5(g,_,S){let O=_.mapToLocalMultiple(g);if(1===O.length){const g=48,_=O[0];O=[w$4(_.x-g,_.y+g),w$4(_.x+g,_.y-g),w$4(_.x+g,_.y-g),w$4(_.x-g,_.y+g)]}const T=[],I={x:O[0].x,y:O[0].y},k={x:O[1].x,y:O[1].y};if(S){const g=Math.round(k.x-I.x),_=Math.round(k.y-I.y);T.push(w$4(I.x-g,I.y-_),w$4(k.x,I.y-_),w$4(k.x,k.y),w$4(I.x-g,k.y))}else T.push(w$4(I.x,I.y),w$4(k.x,I.y),w$4(k.x,k.y),w$4(I.x,k.y));return U$7(j$5([T.map((g=>_.localToMap(g))).filter(Oe)],_.spatialReference,_.doUnnormalization,!0),T,_)}(K,O,this.centered)),nt.full=null!=nt.circle?nt.circle.geometry:null==(_=nt.rectangle)?void 0:_.geometry,nt.outline="polygon"===(null==(S=nt.full)?void 0:S.type)?nt.full:null;break}default:return null}return nt}initializeGraphic(g){return B()}onComplete(g){if(!this.drawOperation)return;this._updateGraphic();let _=null;if(this.drawOperation.isCompleted){const g=this._getCreateOperationGeometry({operationComplete:!0});null!=g&&(_=this._createOrUpdateGraphic(g.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:_,...g})}onCursorUpdate(g){this._updateGraphic(),this.emit("cursor-update",g)}onDeactivate(){const{drawOperation:g}=this;g&&(g.isCompleted||g.cancel())}onOutlineChanged(g){return B()}onCursorEdgeChanged(g){return B()}onVertexAdd(g){var _;U$4(this._tooltipsContext),this._updateGraphic(),b$1(null==(_=g.vertices.at(0))?void 0:_.coordinates,this._tooltipsContext),this.emit("vertex-add",g)}onVertexRemove(g){U$4(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",g)}onVertexUpdate(g){this._updateGraphic(),this.emit("vertex-update",g)}_updateGraphic(){const g=this._getCreateOperationGeometry();this._createOperationGeometry=g,null!=g?(null!=g.cursorEdge?this.addHandles(this.onCursorEdgeChanged(g.cursorEdge),Oc.activeEdge):this.removeHandles(Oc.activeEdge),null!=g.outline?this.addHandles(this.onOutlineChanged(g.outline),Oc.outline):this.removeHandles(Oc.outline),null!=g.committedVertices?this.addHandles(this.onRegularVerticesChanged(g.committedVertices),Oc.regularVertices):this.removeHandles(Oc.regularVertices),null!=g.cursorVertex?this.addHandles(this.onActiveVertexChanged(g.cursorVertex),Oc.activeVertex):this.removeHandles(Oc.activeVertex),null!=g.full?this._createOrUpdateGraphic(g.full):this.removeHandles(Sc)):this._destroyAllVisualizations()}get activeTooltipInfo(){var g;return(null==(g=this._coordinateFormatterLoadTask)?void 0:g.finished)?I$3(this._tooltipsContext):null}};g([_()],xc.prototype,"_coordinateFormatterLoadTask",void 0),g([_()],xc.prototype,"_createOperationGeometry",void 0),g([_()],xc.prototype,"_tooltipsContext",null),g([_({value:!0})],xc.prototype,"centered",null),g([_()],xc.prototype,"cursor",null),g([_({nonNullable:!0})],xc.prototype,"defaultZ",void 0),g([_({constructOnly:!0})],xc.prototype,"directionOptions",void 0),g([_()],xc.prototype,"drawOperation",void 0),g([_({value:!0})],xc.prototype,"enabled",null),g([_({value:!0})],xc.prototype,"forceUniformSize",null),g([_({constructOnly:!0})],xc.prototype,"geometryType",void 0),g([_()],xc.prototype,"graphic",null),g([_({constructOnly:!0})],xc.prototype,"graphicProperties",void 0),g([_()],xc.prototype,"graphicSymbol",null),g([_({constructOnly:!0})],xc.prototype,"hasZ",void 0),g([_({constructOnly:!0})],xc.prototype,"geometryToPlace",void 0),g([_()],xc.prototype,"mode",null),g([_()],xc.prototype,"snappingManager",void 0),g([_()],xc.prototype,"snapToScene",void 0),g([_()],xc.prototype,"tooltip",void 0),g([_()],xc.prototype,"tooltipInfos",void 0),g([_({constructOnly:!0,type:El})],xc.prototype,"sketchOptions",void 0),g([_()],xc.prototype,"updating",null),g([_({constructOnly:!0,nonNullable:!0})],xc.prototype,"view",void 0),g([_({constructOnly:!0})],xc.prototype,"undoRedo",null),g([_()],xc.prototype,"activeTooltipInfo",null),xc=g([S("esri.views.draw.DrawGraphicTool")],xc);const Sc=Symbol("create-operation-graphic"),Oc={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function F$2(g){switch(g){case"point":case"polyline":case"polygon":case"multipoint":return g;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Tc=48,Ec="click";class t4{constructor({consumesClicks:g,grabbableForEvent:_}){this.events=new xt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=g,this.grabbableForEvent=_}destroy(){}intersectionDistance(g,_){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const Ic=Symbol(),kc=Symbol();let Rc=class F extends(xt.EventedMixin(O)){constructor(g){super(g),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Ta,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Xt,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Sa(V$5),this._getPolylineOrPolygonConstraint=Sa(k$4),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new _l,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==g.elevationInfo&&(this.elevationInfo=Pi(!!g.hasZ))}initialize(){const{geometryType:g,view:_}=this,S=_.spatialReference,O="viewingMode"in _.state?_.state.viewingMode:ji.Local,T="segment"===g||"multipoint"===g?"polyline":g;this.coordinateHelper=Ea(this.hasZ,this.hasM,S),this._editGeometryOperations=new Ia(new ka(T,this.coordinateHelper),O),this._snappingOperation=new Lo({view:_}),this.addHandles([C((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:g,constraint:_},S)=>{const{snappingOptions:O}=this;if(O&&(O.forceDisabled=null!=_&&Js(_)),null!=S&&g===S.stagedPoint&&_!==S.constraint)return this._onKeyboardBasedChange();this._processCursor(g??this._screenToMap(this._stagedScreenPoint))}),{equals:(g,_)=>g.stagedPoint===_.stagedPoint&&Vi(g.constraint,_.constraint)}),C((()=>this.view.viewpoint),((g,_)=>{g&&_&&Li(g,_)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new Ra(S,O),this._editGeometryOperations.data.components.push(this._activeComponent);const I=this.segmentLabels;null!=I&&(I.context={view:_,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(C((()=>this.labelOptions.enabled),(g=>{I.visible=g}),yt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(g=>{var _,S,O,T;const I=g.vertices.map((g=>({componentIndex:0,vertexIndex:g.index,coordinates:this.coordinateHelper.vectorToArray(g.pos)}))),k=I.map((g=>g.coordinates)),C=this.coordinateHelper.vectorToDehydratedPoint(null==(_=this._activeComponent.getFirstVertex())?void 0:_.pos)??null;Is(C,this.firstVertex)||(this.firstVertex=C);const $=this.coordinateHelper.vectorToDehydratedPoint(null==(S=this._activeComponent.getLastVertex())?void 0:S.pos)??null;Is($,this.lastVertex)||(this.lastVertex=$);const B=this.coordinateHelper.vectorToDehydratedPoint(null==(T=null==(O=this._activeComponent.edges.at(-1))?void 0:O.leftVertex)?void 0:T.pos)??null;switch(Is(B,this.secondToLastVertex)||(this.secondToLastVertex=B),this._processCursor(this.cursorVertex),g.type){case"vertex-add":this.emit(g.type,{...g,added:k,vertices:I});break;case"vertex-update":this.emit(g.type,{...g,updated:k,vertices:I});break;case"vertex-remove":this.emit(g.type,{...g,removed:k,vertices:I})}})));const k=this._manipulator=new t4({consumesClicks:!1,grabbableForEvent:g=>"click"!==this.drawingMode||"touch"===g.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(k),k.grabbable="point"!==g,this.addHandles([k.events.on("immediate-click",(g=>this._onImmediateClick(g))),k.events.on("immediate-double-click",(g=>this._onImmediateDoubleClick(g))),C((()=>this.drawingMode),(()=>{this.removeHandles(Ic),this.addHandles(this._createManipulatorDragPipeline(k),Ic)}),yt),C((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:g})=>{k.cursor=g}),yt)]),Qs(this,(()=>{const g=this.view.inputManager.latestPointerType??"mouse",_=this._getSnappingContext(g);if(null!=this.snappingManager){const g=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,_);this._updatingHandles.addPromise(Hi(g))}}))}destroy(){ki(this.segmentLabels),ki(this._snappingOperation),this._editGeometryOperations=ki(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:g,_manipulator:_}=this;return null!=g&&this._pointerDownStates.has(g)||_.grabbing||!_.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const g=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==g}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((g=>this.coordinateHelper.vectorToArray(g.pos)))}get _constraint(){const{constraints:g,constraintsEnabled:_}=this;if(g&&_)switch(this.geometryType){case"point":return this._getPointConstraint(g);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,g)}}set drawingMode(g){this._set("drawingMode",g??Ec)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(g){this._manipulator.interactive=g}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:g,lastVertex:_,firstVertex:S,geometryType:O}=this;return"polygon"===O&&ks(g,S)||ks(g,_)?null:g}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:g,committableVertex:_,coordinateHelper:S}=this,O=g.slice();return null!=_&&O.push(S.pointToArray(_)),O}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:g}=this;null!=g&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(g))}complete(g){var _;const S=(null==g?void 0:g.aborted)||!1;this._snappingOperation.abort(),null==(_=this.snappingManager)||_.doneSnapping();const{geometryType:O,numCommittedVertices:T}=this,I="multipoint"===O&&0===T||"polyline"===O&&T<2||"polygon"===O&&T<3;"segment"!==O&&"point"!==O||this.commitStagedVertex(),this._createOperationCompleted=!I,(this.isCompleted||S)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((g,_)=>({componentIndex:0,vertexIndex:_,coordinates:g}))),aborted:S,type:"complete"}))}onInputEvent(g){switch(g.type){case"pointer-down":this._pointerDownStates.add(g.pointerId);break;case"pointer-up":this._pointerDownStates.delete(g.pointerId)}switch(g.type){case"pointer-move":return this._onPointerMove(g);case"hold":return this._onHold(g)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(g){var _,S;const O=ke(this.cursorVertex),T=ke(g),I=T&&((null==(_=this._updateAndGetEffectiveDrawSurface())?void 0:_.constrainZ(T))??T),k=this._snapToClosingVertex(I),C=this._applyConstraints(k);ks(O,C)||(this._set("cursorVertex",C),null==(S=this.segmentLabels)||S.set("stagedVertex",null!=C?this.coordinateHelper.pointToVector(C):null),null==C||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(C)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(g){if(null==g||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return g;const _=this._mapToScreen(g);if(!_)return g;const S=this._activeComponent;return this._vertexWithinPointerDistance(S.vertices[0].pos,_)?this.firstVertex:this._vertexWithinPointerDistance(S.vertices.at(-1).pos,_)?this.lastVertex:g}_createManipulatorDragPipeline(g){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(g);case"freehand":return this._createManipulatorDragPipelineFreehand(g);case"hybrid":return this._createManipulatorDragPipelineHybrid(g)}}_createManipulatorDragPipelineClick(g){return ra(g,((g,_,S,O)=>{const T="touch"===O&&this._snappingEnabled;if(this.isCompleted||!T)return;const{snappingStep:I,cancelSnapping:k}=Ho({predicate:()=>T,snappingManager:this.snappingManager,snappingContext:new zo({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:O,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});S=S.next((g=>(T&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),g))).next(k),_.next(this._screenToMapDragEventStep()).next((g=>("start"===g.action&&(this._processCursor(g.mapStart),("segment"===this.geometryType||T&&!this.numCommittedVertices)&&this.commitStagedVertex()),g))).next(la(this.view,this.elevationInfo)).next(...I).next((g=>(T&&(this._processCursor(g.mapEnd),"end"===g.action&&this.commitStagedVertex()),g))).next((g=>("end"===g.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),g)))}))}_createManipulatorDragPipelineFreehand(g){return ra(g,((g,_)=>{this.isCompleted||_.next(this._screenToMapDragEventStep()).next((g=>("start"===g.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(g.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),g))).next((g=>{switch(g.action){case"start":case"update":this._processCursor(g.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return g}))}))}_createManipulatorDragPipelineHybrid(g){return ra(g,((g,_)=>{this.isCompleted||_.next(this._screenToMapDragEventStep()).next((g=>("start"===g.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),kc),this._processCursor(g.mapStart),this.commitStagedVertex()),g))).next((g=>{switch(g.action){case"start":case"update":this._processCursor(g.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(kc),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return g}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:g,constraintZ:_,geometryType:S,numCommittedVertices:O}=this;return g?null!=_||"segment"===S&&O>0:("segment"===S||"polygon"===S)&&O>0}_updateAndGetEffectiveDrawSurface(){var g;const{constraintsEnabled:_,coordinateHelper:S,drawSurface:O,elevationDrawSurface:T,snapToSceneEnabled:I}=this;if(null==T)return O;if(!this.hasZ)return T.defaultZ=null,T;const k=null==(g=this.elevationInfo)?void 0:g.mode;let C=this.defaultZ,$=_||"absolute-height"===k;return null!=I&&($=I),"on-the-ground"===k&&($=!1),this._drawAtFixedElevation&&(C=(_?this.constraintZ:null)??S.getZ(this._activeComponent.vertices[0].pos),$=!1),$?O:(T.defaultZ=C,T)}_mapToScreen(g){var _;return null==(_=this._updateAndGetEffectiveDrawSurface())?void 0:_.mapToScreen(g)}_onHold(g){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===g.pointerType&&this._snappingEnabled&&this._processCursor(g.mapPoint),g.stopPropagation()}_onImmediateClick(g){if(!("mouse"===g.pointerType&&2===g.button||this._manipulator.dragging))try{const{drawingMode:_,geometryType:S}=this;this._stagedPointerType=g.pointerType,this._stagedScreenPoint=g.screenPoint;const O=this._screenToMap(g.screenPoint);if(null==O)return;if(null==O||"freehand"===_&&"point"!==S)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(O),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==g.pointerType&&this._processCursor(null),("freehand"===_||"point"===S||"segment"===S&&2===this.numCommittedVertices||"segment"===S&&"hybrid"===_&&1===this.numCommittedVertices)&&this.complete()}finally{g.stopPropagation()}}_onImmediateDoubleClick(g){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),g.stopPropagation())}_onPointerMove(g){const _=zi(g.x,g.y);this._stagedScreenPoint=_,this._stagedPointerType=g.pointerType,this._stagedPointerId=g.pointerId,this._isDragging?this._snappingOperation.abort():(g.stopPropagation(),this._processCursorMovementRelativeToSurface(_,g.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(g,_){var S;const O=this._snappingOperation,T=this._screenToMap(g),I=this._requiresScenePoint?null==(S=this.drawSurface)?void 0:S.screenToMap(g):null;if(null==T)return this._hideDefaultCursor=!0,this._processCursor(null),void O.abort();this._hideDefaultCursor=!1;const k=this.snappingManager;if(null==k)return this._processCursor(T),void O.abort();const C=this._getSnappingContext(_);this._updatingHandles.addPromise(Hi(O.snap({point:T,scenePoint:I},k,C)))}_applyConstraints(g){const{_constraint:_,constraints:S}=this;if(!g||!S||!_)return g;const{context:O}=S,T=G$3(g,O),I=T?_.closestTo(T):void 0;if(!I)return g;const k=function W$1(g,_,S,O){const{view:T,measurementSR:I,spatialReference:k,origin:C,mode:$}=S;if("geodesic"===$?Le(qr,g):Dt(qr,g,C),Ve(qr,I,qr,k))return js(qr,T,_,S,O)}(I,g,O),C="2d"===this.view.type||"absolute-height"!==O.elevationInfo.mode;return null!=k&&C&&null!=this.constraintZ&&this.hasZ&&(k.z=this.constraintZ),k}_screenToMap(g){var _;return g?null==(_=this._updateAndGetEffectiveDrawSurface())?void 0:_.screenToMap(g):null}_screenToMapDragEventStep(){let g=null;return _=>{if("start"===_.action&&(g=this._screenToMap(_.screenStart)),null==g)return null;const S=this._screenToMap(_.screenEnd);return null!=S?{..._,mapStart:g,mapEnd:S}:null}}_vertexWithinPointerDistance(g,_){const S=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(g));return null!=S&&function R$1(g,_,S){const O=g.x-_.x,T=g.y-_.y;return O*O+T*T<=S}(S,_,25)}_getSnappingContext(g){var _;const S=this._drawAtFixedElevation?null==(_=this.elevationDrawSurface)?void 0:_.defaultZ:null;return new zo({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:g,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=S?{value:S,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};g([_()],Rc.prototype,"_hideDefaultCursor",void 0),g([_()],Rc.prototype,"_stagedPointerId",void 0),g([_()],Rc.prototype,"_isDragging",null),g([_()],Rc.prototype,"_snappingOperation",void 0),g([_()],Rc.prototype,"_snappingEnabled",null),g([_({constructOnly:!0})],Rc.prototype,"graphic",void 0),g([_()],Rc.prototype,"constraintsEnabled",void 0),g([_()],Rc.prototype,"constraints",void 0),g([_()],Rc.prototype,"_constraint",null),g([_()],Rc.prototype,"constraintZ",void 0),g([_()],Rc.prototype,"defaultZ",void 0),g([_()],Rc.prototype,"isDraped",void 0),g([_({value:Ec})],Rc.prototype,"drawingMode",null),g([_({constructOnly:!0})],Rc.prototype,"elevationDrawSurface",void 0),g([_({constructOnly:!0})],Rc.prototype,"elevationInfo",void 0),g([_({constructOnly:!0,type:_l})],Rc.prototype,"labelOptions",void 0),g([_({constructOnly:!0})],Rc.prototype,"geometryType",void 0),g([_({constructOnly:!0})],Rc.prototype,"hasM",void 0),g([_({constructOnly:!0})],Rc.prototype,"hasZ",void 0),g([_()],Rc.prototype,"cursor",void 0),g([_()],Rc.prototype,"effectiveCursor",null),g([_()],Rc.prototype,"loading",void 0),g([_({constructOnly:!0})],Rc.prototype,"manipulators",void 0),g([_({constructOnly:!0})],Rc.prototype,"drawSurface",void 0),g([_({constructOnly:!0})],Rc.prototype,"segmentLabels",void 0),g([_({constructOnly:!0})],Rc.prototype,"snappingManager",void 0),g([_({constructOnly:!0})],Rc.prototype,"snappingVisualizer",void 0),g([_()],Rc.prototype,"snapToSceneEnabled",void 0),g([_({readOnly:!0})],Rc.prototype,"cursorVertex",null),g([_({readOnly:!0})],Rc.prototype,"visualizationCursorVertex",null),g([_()],Rc.prototype,"committableVertex",null),g([_()],Rc.prototype,"firstVertex",void 0),g([_()],Rc.prototype,"lastVertex",void 0),g([_()],Rc.prototype,"secondToLastVertex",void 0),g([_()],Rc.prototype,"updating",null),g([_({constructOnly:!0})],Rc.prototype,"view",void 0),Rc=g([S("esri.views.draw.DrawOperation")],Rc);let Cc=class c6{constructor(g,_,S,O=null){this._elevationInfo=g,this.defaultZ=_,this._view=S,this._excludeGraphics=O}screenToMap(g){const{defaultZ:_,_view:S}=this,O=S.sceneIntersectionHelper.intersectElevationFromScreen(ft(g.x,g.y),this._elevationInfo,_??0,this._excludeGraphics);return null==_&&null!=O&&(O.z=void 0),O}mapToScreen(g){const _=Mt(g.x,g.y,Ui(this._view,g,this._elevationInfo),g.spatialReference);return this._view.toScreen(_)}constrainZ(g){const{defaultZ:_}=this;return null!=_&&g.z!==_&&((g=Gi(g)).z=_),g}},Dc=class l6{constructor(g,_,S=[]){this.view=g,this.elevationInfo=_,this.exclude=S}screenToMap(g){const _=this.view.toMap(g,{exclude:this.exclude,excludeHud:!0});return null!=_&&(_.z=Fi(_,this.view,this.elevationInfo)),_}mapToScreen(g){let _=g;return null!=this.elevationInfo&&(_=Mt(g.x,g.y,Ui(this.view,g,this.elevationInfo),g.spatialReference)),this.view.toScreen(_)}constrainZ(g){return g}};new te;let Ac=class z extends xc{constructor(g){super(g),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new Xo({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:g,offset:_,unit:S}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Zt({mode:g,offset:_,unit:S})}normalizeCtorArgs(g){if(!g.elevationInfo){const _=g.hasZ??!0;return{...g,elevationInfo:Pi(_)}}return g}initializeGraphic(g){const{view:_}=this,S=this._createGraphicState=new br({graphic:g});return ni([_.maskOccludee(g),_.trackGraphicState(S),C((()=>({element:this._outlineVisualElement,isDraped:S.isDraped})),(({element:g,isDraped:_})=>{g&&(g.isDraped=_)}),yt),Ai((()=>{k$2(this.tooltipInfos.mesh,this.geometryToPlace)})),this._setupLoadingIndicator(S),...a$9(S)])}makeDrawOperation(){const{geometryType:g}=this,_="circle"!==g&&"rectangle"!==g;return new Rc({view:this.view,manipulators:this.manipulators,geometryType:F$2(g),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Dc(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Cc(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Uo,segmentLabels:_?new gr:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===Ni(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(g){const{view:_}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[g],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(g),B();const S=this._settings,O=S.manipulators.vertex,T=new Go({view:_,spatialReference:_.spatialReference,vertices:[g],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:O.size,outlineSize:O.outlineSize,renderOccluded:O.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=T;const I=S.visualElements.zVerticalLine,k=new xs({view:_,extensionType:I.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=k;const $=ni([C((()=>S.visualElements.zVerticalLine),(g=>g.apply(k)),Zi),C((()=>({selectedColor:Bi(S.colors.selected),outlineColor:Bi(S.manipulators.vertex.outlineColor)})),(({selectedColor:g,outlineColor:_})=>{T.color=g,T.outlineColor=_}),Zi),B((()=>{this._activeVertexVisualElement=ki(this._activeVertexVisualElement),this._verticalLineVisualElement=ki(this._verticalLineVisualElement)}))]);return T.attached=!0,this._updateVerticalLineVisualElement(g),$}_updateVerticalLineVisualElement(g){const _=this._verticalLineVisualElement;if(!_)return;const{renderCoordsHelper:S,elevationProvider:O}=this.view;Ct(Pc,g[0],g[1],g[2]),$c.setFromElevationInfo(this.elevationInfo),Pc[2]=Yi(Pc,O,$c,S),S.toRenderCoords(Pc,this.view.spatialReference,Pc)?(_.setStartEndFromWorldDownAtLocation(Pc),_.attached=!0):_.attached=!1}onOutlineChanged(g){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=g,B();const _=this.internalGraphicsLayer.elevationInfo,{view:S}=this,O=this._settings,T=new fr({view:S,geometry:g,elevationInfo:_,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===Ni(this.hasZ,_),attached:!1,isDecoration:!0});this._outlineVisualElement=T;const I=ni([C((()=>O.visualElements.lineObjects.outline),(g=>g.apply(T)),Zi),C((()=>O.visualElements.lineObjects.shadowStyle),(g=>g.apply(T)),Zi),B((()=>{this._outlineVisualElement=ki(this._outlineVisualElement)}))]);return T.attached=!0,T.laserlineEnabled=!0,I}onRegularVerticesChanged(g){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=g,B();const{view:_}=this,S=this._settings,O=S.manipulators.vertex,T=new Go({view:_,spatialReference:_.spatialReference,vertices:g,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:O.size,outlineSize:O.outlineSize,renderOccluded:O.renderOccluded,attached:!1,isDecoration:!0}),I=ni([C((()=>({color:Bi(S.manipulators.vertex.color),outlineColor:Bi(S.manipulators.vertex.outlineColor)})),(({color:g,outlineColor:_})=>{T.color=g,T.outlineColor=_}),Zi),B((()=>{this._verticesVisualElement=ki(this._verticesVisualElement)}))]);return T.attached=!0,this._verticesVisualElement=T,I}updateGraphicGeometry(g){if("mesh"!==this.geometryType||"point"!==(null==g?void 0:g.type))super.updateGraphicGeometry(g);else{const _=this.geometryToPlace;null==_||_.centerAt(g),k$2(this.tooltipInfos.mesh,_);const S=this._graphic;_&&S.geometry===_||(S.geometry=_)}}_setupLoadingIndicator(g){const{drawOperation:_}=this;if(!this.geometryToPlace)return _.loading=!1,null;_.loading=!0;const S=B((()=>{_.loading=!1}));let O;const l10=()=>O&&cancelAnimationFrame(O);return ni([Xi((()=>g.displaying),(()=>{l10(),O=requestAnimationFrame((()=>S.remove()))}),{...yt,once:!0}),B(l10),S])}};g([_({constructOnly:!0})],Ac.prototype,"elevationInfo",void 0),g([_({constructOnly:!0})],Ac.prototype,"geometryType",void 0),g([_()],Ac.prototype,"type",void 0),g([_({constructOnly:!0})],Ac.prototype,"view",void 0),Ac=g([S("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ac);const $c=new Nt,Pc=_t();function r$3(g){if(null==g||"polyline"!==g.type&&"polygon"!==g.type)return 0;const _="polyline"===g.type?g.paths:g.rings,S=qi();for(const O of _)for(let g=0;g<O.length-1;g++){const _=O[g],T=O[g+1],I=_[0]-T[0],k=_[1]-T[1];if(I*I+k*k>S)return Math.atan2(T[1]-_[1],T[0]-_[0])}return 0}var jc,Vc,Lc,zc;function m$1(g,_,S){function l10(){const g=S(),_=g.sketchOptions.tooltips.effectiveEnabled?g.activeTooltipInfo:null;return{...g,activeTooltipInfo:_}}let O=!1;function m2({activeTooltipInfo:S,sketchOptions:T}){O=!0,S&&(S.sketchOptions=T,v$1(S,_)),g.info=S,O=!1}return ni([C(l10,m2,yt),C((()=>{const g=l10(),{activeTooltipInfo:S}=g;if(S)return{context:g,activeTooltipInfo:S,key:S.key,geometry:ca(_)}}),((g,S)=>{g&&!O&&S&&S.key!==g.key&&function f(g,_,{callbacks:S}){const O=ca(_);switch(null==O?void 0:O.type){case"mesh":u$1(g,O.origin,_,S),"orientation"in g&&"scale"in g&&k$2(g,O,S);break;case"point":u$1(g,O,_,S)}}(g.activeTooltipInfo,_,g.context)}),Ki),_.on("committed",(()=>m2(l10()))),T$4(g)])}function u$1(g,_,S,O){var T,I,k,C;const{dx:$,dy:B,dz:K}=V$4(g,_);0===$&&0===B&&0===K||(null==(T=O.onMoveStart)||T.call(O),null==(I=S.operations)||I.move($,B,K,Ca.NEW_STEP),null==(k=O.onMove)||k.call(O,$,B,K),null==(C=O.onMoveStop)||C.call(O))}function v$1(g,_){const S=ca(_);if(!g||!S||"mesh"!==S.type&&"point"!==S.type)return;const O="mesh"===S.type,T=O?S.origin:S;g.setLocationFromPoint(T),y$1(g,T,_),"transform-mesh"===g.type&&O&&R$4(g,S),g.clearInputValues()}function y$1(g,_,S){var O;g.elevation.actual=ui(_),g.elevation.visible=!!(null==(O=S.operations)?void 0:O.data.coordinateHelper.hasZ()),g.elevation.readOnly=!1,g.elevation.showAsZ=!0}(Vc=jc||(jc={}))[Vc.SUPPORTED=0]="SUPPORTED",Vc[Vc.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",Vc[Vc.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",Vc[Vc.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",Vc[Vc.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",Vc[Vc.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED",(zc=Lc||(Lc={}))[zc.NONE=0]="NONE",zc[zc.ANY=1]="ANY",zc[zc.Z=2]="Z",zc[zc.XY=4]="XY";let Hc=class a4{constructor(){this.grabbingState=Lc.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(g){this.grabbingState=Lc.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,g.forEachManipulator(((g,_)=>{if(_===Wo.TRANSLATE_Z&&(this.zManipulator=g),g instanceof pa&&(g.selected&&(0===this.numSelected&&(this.firstSelected=g),this.numSelected++),null==this.firstGrabbedXY&&g.grabbing&&_===Wo.TRANSLATE_XY&&(this.firstGrabbedXY=g)),g.grabbing)switch(this.grabbingState|=Lc.ANY,_){case Wo.TRANSLATE_Z:this.grabbingState|=Lc.Z;break;case Wo.TRANSLATE_XY:this.grabbingState|=Lc.XY}}))}};function y(g){const{object:_}=g,S=function S$5(g){const{view:_,object:S}=g,O=ca(S),T=new fr({view:_,geometry:D$2(O)?O:null,elevationInfo:S.elevationInfo,attached:!1,isDecoration:!0}),I=new Xo({getTheme:()=>_.effectiveTheme}),m2=()=>{T.attached=S.visible},k=ni([C((()=>I.visualElements.lineObjects.outline),(g=>g.apply(T)),Zi),C((()=>I.visualElements.lineObjects.shadowStyle),(g=>g.apply(T)),Zi),C((()=>S.visible),m2),C((()=>S.isDraped),(g=>{T.isDraped=g}),Zi),S.on("committed",(()=>{const g=ca(S);T.geometry=D$2(g)?g:null})),Qi(T)]);return m2(),{visualElement:T,remove:()=>k.remove()}}(g),O=[S,M$2(g,S.visualElement)];return _.maskOccludee&&O.push(_.maskOccludee()),{visualElement:S.visualElement,remove:()=>Ji(O)}}function M$2(g,_){const{object:S,view:O}=g,T=[],I=S.elevationInfo,k="on-the-ground"===I.mode||!I.offset&&"absolute-height"!==I.mode,$=new Hc,B=new Xo({getTheme:()=>O.effectiveTheme}),K=B.visualElements,J=new xs({view:O,extensionType:K.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.OccludeAndTransparent,isDecoration:!0}),tt=ht(K.heightPlaneAngleCutoff),et=new Es({view:O,attached:!1,angleCutoff:tt,isDecoration:!0}),it=en(1);T.push(C((()=>({lineShadowStyle:B.visualElements.lineObjects.shadowStyle,pointShadowStyle:B.visualElements.pointObjects.shadowStyle,alpha:it.value})),(({lineShadowStyle:g,pointShadowStyle:S,alpha:O})=>{g.apply(_,O),S.apply(J,O)}),Zi));const nt=en(1);T.push(C((()=>({heightPlane:B.visualElements.heightPlane,alpha:nt.value})),(({heightPlane:g,alpha:_})=>g.apply(et,_)),Zi));const P2=()=>{$.update(g);const O=ca(S);if(!S.visible||k&&(S.isDraped||!D$2(O)||!O.hasZ))return _.laserlineEnabled=!1,J.attached=!1,void(et.attached=!1);_.laserlineEnabled=!0;const T=$.grabbingState&Lc.XY?K.laserlineAlphaMultiplier:1;it.value=T;const I=$.grabbingState&Lc.Z?K.laserlineAlphaMultiplier:1;nt.value=I,function T$2(g,_){const S=1===_.numSelected?_.firstSelected:_.numSelected>1&&null!=_.firstGrabbedXY?_.firstGrabbedXY:null;null!=S?(g.setStartEndFromWorldDownAtLocation(S.renderLocation),g.attached=!0):g.attached=!1}(J,$),function O$1(g,_,S,O){if(O.numSelected>0){Ct(Uc,0,0,0);let _=0;g.forEachManipulator(((g,S)=>{S===Wo.TRANSLATE_XY&&g.selected&&g instanceof pa&&(Dt(Uc,Uc,g.renderLocation),_++)})),_>0?(S.heightManifoldTarget=At(Uc,Uc,1/_),S.attached=!0):S.attached=!1}else{const O=_.attachmentOrigin;null!=O&&g.view.renderCoordsHelper.toRenderCoords(O,Uc)?(S.heightManifoldTarget=Uc,S.attached=!0):S.attached=!1}}(g,_,et,$)};T.push(C((()=>B.visualElements.zVerticalLine),(g=>g.apply(J)),Zi)),T.push(S.on("committed",P2),C((()=>S.visible),P2),_.events.on("attachment-origin-changed",P2),Qi(J),Qi(et));const ot=[],X2=()=>{Ji(ot),ot.length=0,g.forEachManipulator((g=>ot.push(g.events.on("grab-changed",P2)))),g.forEachManipulator((g=>ot.push(g.events.on("select-changed",P2)))),P2()};return X2(),T.push(g.onManipulatorsChanged(X2),tn((()=>ni(ot)))),ni(T)}function D$2(g){return null!=g&&("polygon"===g.type||"polyline"===g.type)}const Uc=_t();function P$1(g){const _=[],S=function S$4(g,_){const{view:S,object:O}=g,T=new Ha({view:S,geometry:V$2(ca(O)),elevationInfo:O.elevationInfo,isDecoration:!0});return function A$2(g,_,S){const{view:O,object:T}=g,a7=()=>{_.attached=T.visible},I=new Xo({getTheme:()=>O.effectiveTheme});(function L$1(g,_,S){const{view:O,object:T}=g;let I=null;const a7=g=>{null!=I&&(I.remove(),I=null),T.isDraped&&null!=g&&(I=function M$1(g,_,S){const O=g.elevationProvider.spatialReference;rn(_,Gc,O);const T=Gc[0],I=Gc[1];return g.elevationProvider.on("elevation-change",(g=>{ln(g.extent,T,I)&&S()}))}(O,g,(()=>{_.geometry=g})))},s7=()=>{const g=V$2(ca(T));null!=g&&on(T.elevationInfo)&&(g.z=0),a7(g),_.geometry=g};S.push(T.on("committed",s7),tn((()=>I))),s7()})(g,_,S),I.visualElements.pointObjects.outline.apply(_),S.push(C((()=>T.visible),a7,Zi))}(g,T,_),_.push(Qi(T)),T}(g,_);return function I$1(g,_,S){const{view:O,object:T}=g,I=new Xo({getTheme:()=>O.effectiveTheme}),k=new xs({view:O,extensionType:I.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.OccludeAndTransparent,isDecoration:!0});_.push(C((()=>I.visualElements.zVerticalLine),(g=>g.apply(k)),Zi));const $=new Es({view:O,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),B=ht(I.visualElements.heightPlaneAngleCutoff),K=new Es({view:O,attached:!1,angleCutoff:B,isDecoration:!0}),J=T.elevationInfo,tt=Nt.fromElevationInfo(J),et="on-the-ground"===J.mode||!J.offset&&"absolute-height"!==J.mode,it=new Hc,nt=en(1);_.push(C((()=>({heightPlane:I.visualElements.heightPlane,alpha:nt.value})),(({heightPlane:g,alpha:_})=>g.apply(K,_)),Zi));const ot=en(1);_.push(C((()=>({shadowStyle:I.visualElements.pointObjects.shadowStyle,alpha:ot.value})),(({shadowStyle:g,alpha:_})=>g.apply($,_)),Zi));const B2=()=>{it.update(g);let _=V$2(ca(T));const C=et&&(T.isDraped||null==_||!_.hasZ);let B=!0;if(C||null==_)B=!1;else{on(T.elevationInfo)&&(_=_.clone(),_.z=0);const g=Yi(_,O.elevationProvider,tt,O.renderCoordsHelper);Ct(Gc,_.x,_.y,g),Ve(Gc,_.spatialReference,Gc,O.renderCoordsHelper.spatialReference),k.setStartEndFromWorldDownAtLocation(Gc),$.intersectsWorldUpAtLocation=Gc}const J=it.grabbingState&Lc.Z?I.visualElements.laserlineAlphaMultiplier:1;nt.value=J;const st=sn(Fc);!C&&T.visible&&S.calculateMapBounds(st)&&Ve(an(st,Gc),O.spatialReference,Gc,O.renderCoordsHelper.spatialReference)?(K.heightManifoldTarget=Gc,K.attached=!0):K.attached=!1;const at=it.grabbingState&Lc.XY?I.visualElements.laserlineAlphaMultiplier:1;ot.value=at;const rt=B&&T.visible&&!C;$.attached=rt,k.attached=rt};_.push(C((()=>[T.visible,T.isDraped]),B2),T.on("committed",B2)),g.forEachManipulator((g=>{_.push(g.events.on("grab-changed",B2))})),_.push(Qi($)),_.push(Qi(k)),_.push(Qi(K)),B2()}(g,_,S),{visualElement:S,remove:()=>Ji(_)}}function V$2(g){return null==g?null:"point"===g.type?g:"mesh"===g.type?g.anchor.clone():null}const Gc=_t(),Fc=nn();function l$4(g){var _;switch(null==(_=ca(g.object))?void 0:_.type){case"point":case"mesh":return P$1(g);case"polygon":case"polyline":return y(g);default:return null}}let Nc=class l7 extends qo{constructor(g){var _,S;super(),this._view=g.view,this._tool=g.tool,this._object=g.object,this._manipulator=null==(S=(_=this._object).createManipulator)?void 0:S.call(_,{selectable:!0,cursor:"move"}),this.forEachManipulator((g=>this._tool.manipulators.add(g)))}destroy(){this.forEachManipulator((g=>{this._tool.manipulators.remove(g),g.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(g){this._manipulator&&g(this._manipulator,Wo.TRANSLATE_XY)}createManipulatedObjectDragPipeline(g){return Ko(this._object,g,(g=>this.createDragPipeline(g)))}createDragPipeline(g){if(!this._manipulator)return B();const _=this._view;return ra(this._manipulator,((S,O,T,I,k)=>{var C;const $=null==(C=this._object.operations)?void 0:C.data.spatialReference,B=O.next((g=>$?g:null)).next(Ua(k,_,this._object,$)).next(ua()).next(da());g(S,B,T,I,k)}))}};function r$2(g){var _,S;if(g.graphic&&"graphics"!==(null==(_=g.graphic.layer)?void 0:_.type))return jc.GRAPHICS_LAYER_MISSING;const O=null==(S=g.operations)?void 0:S.data.type;if(!O)return jc.GEOMETRY_TYPE_UNSUPPORTED;switch(O){case"polygon":case"point":case"polyline":case"mesh":break;default:return jc.GEOMETRY_TYPE_UNSUPPORTED}const T=g.elevationInfo;return cn(T)?jc.ELEVATION_MODE_UNSUPPORTED:jc.SUPPORTED}let Zc=class i8 extends(h$6(sl)){constructor(g){super(g),this.type="move-point",this.allFields.forEach((g=>{g.lockable=!1,g.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};g([_()],Zc.prototype,"allFields",null),Zc=g([S("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],Zc);let Bc=class i9 extends sl{constructor(g){super(g),this.type="translate",this.distance=ai}clear(){this.distance=ai}};g([_()],Bc.prototype,"type",void 0),g([_()],Bc.prototype,"distance",void 0),Bc=g([S("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],Bc);let Yc=class i10 extends sl{constructor(g){super(g),this.type="translate-xy",this.distance=ai}};g([_()],Yc.prototype,"type",void 0),g([_()],Yc.prototype,"distance",void 0),Yc=g([S("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],Yc);let Xc=class i11 extends sl{constructor(g){super(g),this.type="translate-z",this.distance=ai}clear(){this.distance=ai}};g([_()],Xc.prototype,"type",void 0),g([_()],Xc.prototype,"distance",void 0),Xc=g([S("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],Xc);class L{constructor(g){this.objects=g,this.type="move-start"}}class N{constructor(g,_,S){this.dx=g,this.dy=_,this.objects=S,this.type="move"}}class q{constructor(g){this.objects=g,this.type="move-stop"}}const Wc=Symbol("manipulators"),qc=Symbol("tooltips");let Kc=class extends aa{constructor(g){super(g),this._infos=new Map,this.events=new xt,this.objects=new Yt,this.enableZ=!0,this.sketchOptions=new El,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new Xt,this._moveManipulation=null}initialize(){const{view:g}=this;this.tooltip=new Mc({view:g}),this.addHandles([this.objects.on("change",(g=>{g.removed.forEach((g=>this.removeHandles(g))),this._updateObjectInfos(g),this._setupFastTransformUpdates(g.added),this._refreshManipulators()})),this.objects.on("change",(()=>this._connectTooltips()))]);const _=this.objects.toArray();this._updateObjectInfos({added:_,removed:[]}),this._setupFastTransformUpdates(_),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=ki(this.tooltip),this._moveManipulation=ki(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(g){if(!this.destroyed&&!G$1(g,this.tooltip))return super.onInputEvent(g)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){var g;const{objects:_}=this;if(1!==_.length)return!1;const S=null==(g=ca(_.at(0)))?void 0:g.type;return"point"===S||"mesh"===S}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:g,removed:_}){for(const S of g){if(r$2(S)!==jc.SUPPORTED)continue;const g=new Q(S);this._infos.set(S,g)}for(const S of _)this._infos.delete(S)}_setupFastTransformUpdates(g){for(const _ of g){const g=this._infos.get(_);this.addHandles(a$9(g.object),_)}}_refreshManipulators(){if(this.removeHandles(Wc),this._moveManipulation=ki(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const g=Array.from(this._infos.values());this._createManipulators(g),this._createVisualElements(g),this._updateMoveManipulation(g)}_createManipulators(g){for(const _ of g){const S=_.object;_.manipulationXY=new Nc({tool:this,view:this.view,object:S}),_.manipulationXY.forEachManipulator((g=>{this.addHandles([g.events.on("immediate-click",(g=>{this.events.emit("immediate-click",{...g,object:S}),g.stopPropagation()})),g.events.on("grab-changed",(({action:g})=>{"start"===g?this._showTooltip(Jo.XY):this._hideTooltip()}))],Wc)})),this.addHandles(_.manipulationXY.createDragPipeline(((_,S,O,T)=>this._buildDragEventPipeline(g,Jo.XY,_,S,O,T))),Wc)}this._createMoveManipulation(g)}_createMoveManipulation(g){var _;const S=new Qo({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===g.length?Qo.radiusForSymbol(null==(_=g[0].object.graphic)?void 0:_.symbol):ts});this._moveManipulation=S,S.elevationInfo={mode:"absolute-height",offset:0},S.forEachManipulator((g=>{this.addHandles(g.events.on("immediate-click",(_=>{const O=this.objects.at(0);!S.zManipulation.hasManipulator(g)&&1===this.objects.length&&O&&this.events.emit("immediate-click",{..._,object:O}),_.stopPropagation()})),Wc)}));const e6=g=>_=>{this.addHandles([_.events.on("focus-changed",(({action:_})=>{"focus"===_?this._showTooltip(g):this._hideTooltip()})),_.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=ai)}))],Wc)};this._moveManipulation.xyManipulation.forEachManipulator(e6(Jo.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(e6(Jo.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(e6(Jo.Z));const i15=()=>this._updateMoveManipulation(g);for(const k of g)this.addHandles([k.object.on("committed",i15),C((()=>k.object.visible),i15)],Wc);const O=g[g.length-1];this.addHandles(O.object.on("committed",(()=>this._updateMoveManipulationAngle(O))),Wc);const{object:T}=O,{operations:I}=T;if(I){const _=T.graphic;this.addHandles(S.createDragPipeline(((_,S,O,T,I)=>this._buildDragEventPipeline(g,_,S,O,T,I)),T.elevationInfo,I.data.spatialReference,_),Wc)}this._updateMoveManipulationAngle(O)}_createVisualElements(g){for(const _ of g){const S=_.object,O=l$4({view:this.view,object:S,forEachManipulator:g=>{var S,O;null==(S=_.manipulationXY)||S.forEachManipulator(g),null==(O=this._moveManipulation)||O.forEachManipulator(g)},onManipulatorsChanged:()=>B()});null!=O&&(_.geometryRepresentation=O.visualElement,_.geometryRepresentation instanceof fr&&this.addHandles([_.geometryRepresentation.events.on("attachment-origin-changed",(()=>{_.object.isDraped||this._updateMoveManipulation(g)})),C((()=>_.object.isDraped),(()=>this._updateMoveManipulation(g)))],Wc),this.addHandles(O,Wc))}}_updateMoveManipulationAngle(g){this._moveManipulation&&(this._moveManipulation.angle=r$3(ca(g.object)))}_updateMoveManipulation(g){const _=Mt(0,0,0,this.view.spatialReference);let S=0,O=!1;const T=this._moveManipulation;if(T){for(const T of g){if(!T.object.visible)continue;this.enableZ&&za(T.object.operations,T.object.elevationInfo)&&(O=!0);const g=T.geometryRepresentation instanceof fr&&!T.object.isDraped?T.geometryRepresentation.attachmentOrigin:T.object.origin;if(null!=g){const{x:O,y:T,z:I}=g;_.x+=O,_.y+=T,I&&(_.z??(_.z=0),_.z+=I),S++}}S>0?(_.x/=S,_.y/=S,_.z??(_.z=0),_.z/=S,T.location=_,T.xyManipulation.available=!0,T.xyAxisManipulation.available=!0,T.zManipulation.available=O):T.available=!1}}_buildDragEventPipeline(g,_,S,O,T,I){const k=[],C=[];let $=null,B=null;const c8=()=>{for(const g of k)g.dragging=!1;k.length=0,C.length=0,$=null,B=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===g.length&&_===Jo.XY){const _=g[0].object;({steps:O,cancel:T}=this._buildSnappingPipelineSteps(_,_.elevationInfo,O,T,I))}return T=T.next((g=>null==B?void 0:B(g))).next((()=>(C.length&&this.events.emit("move-stop",new q(C)),this.destroyed||c8(),null))),{steps:O=O.next((_=>{var O,T;if("start"===_.action){k.length=0,C.length=0;for(const _ of g)_.dragging||!(null==(O=_.manipulationXY)?void 0:O.hasManipulator(S))&&(null==(T=_.manipulationXY)?void 0:T.grabbing)||(k.push(_),C.push(_.object),_.dragging=!0);if(0!==C.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),$=ha(C),B=va(C),this._emitRecordUndo(),this.events.emit("move-start",new L(C)),this.destroyed))return null}return 0!==C.length?_:null})).next((g=>null==$?void 0:$(g))).next((g=>(this._updateMoveTooltip(_,g),g))).next((g=>{switch(g.action){case"start":case"update":if(g.translationX||g.translationY||g.translationZ){const _=this.view.toScreen(g.mapStart),S=this.view.toScreen(g.mapEnd),O=S.x-_.x,T=S.y-_.y;if(this.events.emit("move",new N(O,T,C)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new q(C)),this.destroyed)return null;c8()}return null})),cancel:T}}_connectTooltips(){let g;if(this.removeHandles(qc),this._shouldShowMovePointTooltip){const _=this.objects.at(0),{events:S}=this;this._movePointTooltipInfo??(this._movePointTooltipInfo=new Zc({viewType:this.view.type,sketchOptions:this.sketchOptions}));const O={onMoveStart:()=>{this._emitRecordUndo(),S.emit("move-start",new L([_]))},onMove:()=>S.emit("move",new N(0,0,[_])),onMoveStop:()=>S.emit("move-stop",new q([_]))};g=m$1(this.tooltip,_,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:O})))}else g=C((()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null),(g=>{this.tooltip.info=g}),yt);this.addHandles(g,qc)}_showTooltip(g){this._shouldShowMovePointTooltip||this._updateMoveTooltip(g)}_hideTooltip(){var g;this._shouldShowMovePointTooltip||(null==(g=this.tooltip)||g.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(g,_){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:S}=this;switch(g){case Jo.XY:this._latestTooltipInfo=this._translateTooltipInfo??(this._translateTooltipInfo=new Bc({sketchOptions:S})),W2(this._latestTooltipInfo,_,((g,_)=>Vo(g,_)));break;case Jo.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??(this._translateXYTooltipInfo=new Yc({sketchOptions:S})),W2(this._latestTooltipInfo,_,((g,S)=>un(Vo(g,S),es(_))));break;case Jo.Z:this._latestTooltipInfo=this._translateZTooltipInfo??(this._translateZTooltipInfo=new Xc({sketchOptions:S})),W2(this._latestTooltipInfo,_,pn)}this._latestTooltipInfo.sketchOptions=S}_emitRecordUndo(){const g=this.objects.toArray().map((g=>{var _;return null==(_=g.createUndoRecord)?void 0:_.call(g)})).filter(Oe);g.length>0&&this.events.emit("record-undo",{updates:g})}_buildSnappingPipelineSteps(g,_,S,O,T){const I=ca(g);if(null==I||"point"!==I.type&&"mesh"!==I.type)return{steps:S,cancel:O};const k=("point"===I.type?I:I.anchor).clone(),C=new zo({elevationInfo:_,pointer:T,editGeometryOperations:Ia.fromGeometry(k,this.view.state.viewingMode),visualizer:new Uo,excludeFeature:g.graphic}),$=this.snappingManager,{snappingStep:B,cancelSnapping:K}=Ho({snappingContext:C,snappingManager:$,updatingHandles:this._updatingHandles});return O=O.next(K),{steps:S=S.next((_=>(k.z=Ui(this.view,k,g.elevationInfo,{mode:"absolute-height",offset:0}),{..._,snapOrigin:C.coordinateHelper.pointToVector(k)}))).next(...B),cancel:O}}};g([_({constructOnly:!0,nonNullable:!0})],Kc.prototype,"view",void 0),g([_()],Kc.prototype,"objects",void 0),g([_({constructOnly:!0,nonNullable:!0})],Kc.prototype,"enableZ",void 0),g([_({constructOnly:!0,type:El})],Kc.prototype,"sketchOptions",void 0),g([_({constructOnly:!0})],Kc.prototype,"snappingManager",void 0),g([_()],Kc.prototype,"type",void 0),g([_()],Kc.prototype,"updating",null),g([_()],Kc.prototype,"_latestTooltipInfo",void 0),g([_()],Kc.prototype,"_shouldShowMovePointTooltip",null),g([_()],Kc.prototype,"activeTooltipInfo",null),Kc=g([S("esri.views.3d.interactive.editingTools.move.MoveTool3D")],Kc);class Q{constructor(g){this.object=g,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function W2(g,_,S){if(null==_||"end"===_.action)return void(g.distance=ai);const{mapStart:O,mapEnd:T}=_,I=S(O,T);g.distance=null!=I?I:ai}function m(g,_,S){const O="on-the-ground"===S.mode?Da.XY:Da.XYZ;return new Aa(g,O,_,0)}function p$4(g,_,S){const O=_t();if(!g.renderCoordsHelper.toRenderCoords(_,O))return null;const T=j$2(g,_,dn(S.plane)),I=j$2(g,_,S.edgeDirection);if(null==T||null==I)return null;const k=be(_t(),T,I);return hn(O,k,vn())}function j$2(g,_,S){const O=Mt(_.x+S[0],_.y+S[1],_.z+S[2],_.spatialReference),T=_t(),I=_t();return g.renderCoordsHelper.toRenderCoords(_,T)&&g.renderCoordsHelper.toRenderCoords(O,I)?gn(I,T,I):null}let Jc=class p5 extends sl{constructor(g){super(g),this.type="reshape-edge-offset",this.distance=ai,this.area=null,this.totalLength=null}};g([_()],Jc.prototype,"type",void 0),g([_()],Jc.prototype,"distance",void 0),g([_()],Jc.prototype,"area",void 0),g([_()],Jc.prototype,"totalLength",void 0),Jc=g([S("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],Jc);let Qc=class p6 extends(h$6(sl)){constructor(g){super(g),this.type="selected-vertex",this.area=M$5(),this.totalLength=U$5(),this.geometryType="polyline",this.allFields.forEach((g=>{g.lockable=!1,g.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,"polygon"===this.geometryType?this.area:this.totalLength]}};function X(g,_,S){function a7(){const g=S(),_=g.sketchOptions.tooltips.effectiveEnabled?g.activeTooltipInfo:null;return{...g,activeTooltipInfo:_}}let O=!1;function l10(S){O=!0,function V$1(g,{activeTooltipInfo:_,selectedVertexManipulatorInfo:S,sketchOptions:O}){if(_)switch(_.sketchOptions=O,null==_?void 0:_.type){case"move-point":v$1(_,g);break;case"selected-vertex":!function Y(g,_,S){var O;if(!g||"selected-vertex"!==g.type)return;const T=null==_?void 0:_.manipulator.location;g.setLocationFromPoint(T),y$1(g,T,S);const I=null==(O=S.operations)?void 0:O.data.geometry;switch(null==I?void 0:I.type){case"polygon":g.geometryType="polygon",g.totalLength.visible=!1,g.area.actual=u$3(I);break;case"polyline":g.geometryType="polyline",g.totalLength.actual=jo(I),g.area.visible=!1}}(_,S,g)}}(_,S),g.info=S.activeTooltipInfo,O=!1}return ni([C(a7,l10,yt),C((()=>{const g=a7(),{activeTooltipInfo:S}=g;if(S&&"key"in S)return{context:g,activeTooltipInfo:S,key:S.key,geometry:ca(_)}}),((g,S)=>{g&&!O&&S&&S.key!==g.key&&function E$1(g,_,{selectedVertexManipulatorInfo:S,callbacks:O}){const T=ca(_);switch(null==T?void 0:T.type){case"mesh":"move-point"===g.type&&u$1(g,T.origin,_,O);break;case"point":"move-point"===g.type&&u$1(g,T,_,O);break;case"polyline":case"polygon":"selected-vertex"===g.type&&function R2(g,_,S,O){var T,I,k,C;if("vertex"!==(null==_?void 0:_.type))return;const{dx:$,dy:B,dz:K}=V$4(g,_.manipulator.location);0===$&&0===B&&0===K||(null==(T=O.onReshapeStart)||T.call(O),null==(I=S.operations)||I.moveVertices([_.handle],$,B,K,Ca.NEW_STEP),null==(k=O.onReshape)||k.call(O),null==(C=O.onReshapeStop)||C.call(O))}(g,S,_,O)}}(g.activeTooltipInfo,_,g.context)}),Ki),_.on("committed",(()=>l10(a7()))),T$4(g)])}function P(g,_,S){if(null!=_&&"end"!==_.action){const{mapStart:O,mapEnd:T}=_,I=S(O,T);g.distance=null!=I?I:ai}else g.distance=ai}function A$1(g,_,{sketchOptions:S,tooltipInfos:O}){var T;const I=O.edgeOffset;if(I.distance=ai,null!=_&&"end"!==_.action){const S=g.operations,{mapEnd:O,signedDistance:T,operation:k}=_;if(null!=T&&null!=S){const _=S.data.coordinateHelper,C=T*k.selectedArrow;I.distance=function D$1(g,_,S,O,T){if(g){const g=T.toXYZ(T.pointToVector(S)),I=yn(O,g,ct.get()),k=Yo(I,g,T.spatialReference);if(null!=k)return Ge(k.value*Math.sign(_),k.unit)}return Ge(_*$e(S.spatialReference),"meters")}(g.isDraped,C,O,k.plane,_)}}const k=null==(T=g.operations)?void 0:T.data.geometry;return I.area="polygon"===(null==k?void 0:k.type)?u$3(k):null,I.totalLength="polyline"===(null==k?void 0:k.type)?jo(k):null,I.sketchOptions=S,I}g([_()],Qc.prototype,"geometryType",void 0),g([_()],Qc.prototype,"allFields",null),Qc=g([S("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],Qc);const tp=Symbol();let ep=class extends O{get grabbingOrDragging(){return this._numGrabbing+this._numDragging>0}get _operations(){return this.object.operations}constructor(g){super(g),this._selectedIndex=0,this._manipulatorHandles=new Mn,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=ap.NONE,this._updatingHandles=new Xt,this._recreatingManipulators=!1,this._settings=new Xo({getTheme:()=>this.view.effectiveTheme}),this.events=new xt,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null}initialize(){const{view:g}=this,_=this._settings.manipulators,S=_.vertex;this.tooltipInfos=function S$3(g,_){const S=null==_?void 0:_.type;return{edgeOffset:new Jc({sketchOptions:g,viewType:S}),movePoint:new Zc({sketchOptions:g,viewType:S}),selectedVertex:new Qc({sketchOptions:g,viewType:S}),translate:new Bc({sketchOptions:g,viewType:S}),translateXY:new Yc({sketchOptions:g,viewType:S}),translateZ:new Xc({sketchOptions:g,viewType:S})}}(this._sketchOptions,g),this._vertexManipulatorMaterial=ga(Bi(S.color),S.renderOccluded),this._vertexManipulatorOutlineMaterial=ma(Bi(S.outlineColor),S.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=ma(Bi(S.hoverOutlineColor),S.renderOccluded);const O=_.edge;this._edgeManipulatorMaterial=ga(Bi(O.color),O.renderOccluded),this._edgeManipulatorOutlineMaterial=ma(Bi(O.outlineColor),O.renderOccluded);const T=_.edgeOffset;this._edgeOffsetManipulatorMaterial=ga(Bi(T.color),T.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=ga(Bi(T.hoverColor),T.renderOccluded,!1);const I=_.selected;this._selectedManipulatorMaterial=ga(Bi(I.color),I.renderOccluded),this._selectedManipulatorOutlineMaterial=ma(Bi(I.outlineColor),I.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=ma(Bi(I.hoverOutlineColor),I.renderOccluded),this.tooltip=new Mc({view:g}),this.addHandles([C((()=>{const g=this._settings.manipulators;return{vertexSettings:g.vertex,edgeSettings:g.edge,edgeOffsetSettings:g.edgeOffset,selectedSettings:g.selected}}),(({vertexSettings:g,edgeSettings:_,edgeOffsetSettings:S,selectedSettings:O})=>{g.applyColor(this._vertexManipulatorMaterial),g.applyOutline(this._vertexManipulatorOutlineMaterial),g.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),_.applyColor(this._edgeManipulatorMaterial),_.applyOutline(this._edgeManipulatorOutlineMaterial),S.applyColor(this._edgeOffsetManipulatorMaterial),S.applyHover(this._edgeOffsetManipulatorHoverMaterial),O.applyColor(this._selectedManipulatorMaterial),O.applyOutline(this._selectedManipulatorOutlineMaterial),O.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),C((()=>this.object.visible),(g=>{for(const _ of this._manipulatorInfos)_.manipulator.available=g,"edge"===_.type&&"edgeManipulator"in _&&(_.edgeManipulator.available=g)})),C((()=>this._numGrabbing+this._numDragging===0),(g=>this._toggleAutoHideManipulators(g))),C((()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:g,enabled:_,edgeOffsetEnabled:S})=>{null!=g&&(g.visible=_,g.edgeDistance=S?"far":"default")}),Zi),X(this.tooltip,this.object,(()=>this._tooltipsContext)),$((()=>this._operations),"vertex-update",(g=>{this._updateManipulatorPositions(g.vertices)}),{onListenerAdd:()=>this._recreateManipulators()}),$((()=>{var g;return null==(g=this._operations)?void 0:g.data}),"change",(g=>{"undo"!==g.operation&&"redo"!==g.operation||this._recreateManipulators()}))])}destroy(){this._segmentLabels=ki(this._segmentLabels),this.tooltip=ki(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const g=this._manipulatorInfos.filter((g=>g.manipulator.selected&&"vertex"===g.type));return this._removeVertices(g),g.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=ki(this._moveManipulation),this._objectMoveManipulation=ki(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(g){if(null==this._operations)return;const _=this.object.elevationInfo;for(const S of this._operations.data.components){const O=null==g?void 0:g.byComponentIndex.get(S.index);for(const g of S.vertices){const S=null==O?void 0:O.has(g.index);this._createVertexOrEdgeManipulator(g,_,S)}for(const g of S.edges)this._createVertexOrEdgeManipulator(g,_)}this._createObjectMoveManipulation(),this._createMoveManipulation(_),this._createVisualElements()}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){var g;return null==(g=this._operations)?void 0:g.redo()}undo(){var g;return this.events.emit("undo"),null==(g=this._operations)?void 0:g.undo()}_recreateManipulators(){var g,_;if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&(null==(_=null==(g=this._segmentLabels)?void 0:g.context)?void 0:_.editGeometryOperations)===this._operations||(this._segmentLabels=ki(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const g=this._sketchOptions.labels;this._segmentLabels=new gr({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:g},visible:g.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(g,_){if("end"===_.action)return _;let S=0;const O=[],T=this._manipulatorInfos.some((g=>"vertex"===g.type&&g.manipulator.selected)),I=g===rp.SELECTED_OR_ALL&&T;for(const k of this._manipulatorInfos)"vertex"===k.type&&(k.manipulator.grabbing||I&&!k.manipulator.selected||O.push(k),S++);if(this._moveVertices(O,_),O.length===S){if(this._updateEventState(ap.MOVING),this.destroyed)return _;this.events.emit("move",{type:"move",dx:_.screenDeltaX,dy:_.screenDeltaY,object:this.object})}else{if(this._updateEventState(ap.RESHAPING),this.destroyed)return _;this.events.emit("reshape",{type:"reshape",object:this.object})}return _}_toggleAutoHideManipulators(g){this.autoHideManipulators&&(g?this.removeHandles(tp):this.tool.manipulators.forEach((({manipulator:g})=>{var _;const S=null==(_=g.disableDisplay)?void 0:_.call(g);S&&this.addHandles(S,tp)})))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((g,_)=>"vertex"===_.type&&_.manipulator.selected?g+1:g),0)>1}_perVertexManipulatorDragAction(g){if(this._updateEventState(ap.RESHAPING),this.destroyed)return;const{mapDeltaX:_,mapDeltaY:S,mapDeltaZ:O}=g;if(!_&&!S&&!O)return;const T=[];for(const I of this._manipulatorInfos)"vertex"===I.type&&(I.manipulator.selected&&!I.manipulator.grabbing||I===g.info)&&T.push(I);this._moveVertices(T,g,Ca.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(g){if(g===this._reshapeEventState)return!1;switch(g){case ap.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case ap.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case ap.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case ap.MOVING:switch(this._reshapeEventState){case ap.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case ap.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case ap.RESHAPING:switch(this._reshapeEventState){case ap.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case ap.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const _=this._reshapeEventState!==g;return this._reshapeEventState=g,_}_createObjectMoveManipulation(){const{tool:g,view:_,object:S,_operations:O}=this;if(O){if(this._objectMoveManipulation=new Nc({tool:g,view:_,object:S}),this.enableMoveObject){let g=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline(((_,S,T)=>{S.next((g=>this._trackNumDragging(g))).next((_=>("start"===_.action&&(g=O.createUndoGroup()),_))).next((g=>this._perObjectManipulatorDragAction(rp.ALL,g))).next((g=>(this._updateTranslateObjectTooltip(Jo.XY,g),g))).next((_=>{"end"===_.action&&(this._resetTooltip(),g=wn(g))})),T.next((()=>this._onDragCancel(!0,(()=>g=wn(g)))))}))),this._objectMoveManipulation.forEachManipulator((g=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(g,!1))))}else this._objectMoveManipulation.forEachManipulator((g=>{g.grabbable=!1,g.cursor=null}));this._objectMoveManipulation.forEachManipulator((g=>this._manipulatorHandles.add(g.events.on("immediate-click",(g=>{this._manipulatorInfos.some((g=>g.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...g,object:this.object}),g.stopPropagation()})))))}}_createMoveManipulation(g){var _;const{object:S,tool:O,view:T,_operations:I}=this;if(!I)return;this._moveManipulation=new Qo({tool:O,view:T,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&za(S.operations,S.elevationInfo),snapToScene:!1,radius:Qo.radiusForSymbol(null==(_=S.graphic)?void 0:_.symbol)}),this._moveManipulation.forEachManipulator((g=>this.addHandles([g.events.on("immediate-click",(_=>{this._moveManipulation.zManipulation.hasManipulator(g)||this._manipulatorInfos.some((g=>g.manipulator.selected))||this.events.emit("immediate-click",{..._,object:this.object}),_.stopPropagation()})),this._watchAndUpdateGrabState(g,!1)])));const o2=g=>_=>{this.addHandles(_.events.on("focus-changed",(({action:_})=>{"focus"===_?this._updateTranslateTooltip(g):this._resetTooltip()})))};this._moveManipulation.xyManipulation.forEachManipulator(o2(Jo.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o2(Jo.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o2(Jo.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const k=I.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((_,T,k,C,$)=>{const{snappingStep:B,cancelSnapping:K}=Ho({predicate:g=>!!g.info,snappingManager:O.snappingManager,snappingContext:new zo({editGeometryOperations:I,elevationInfo:g,pointer:$,excludeFeature:S.graphic,visualizer:new Uo}),updatingHandles:this._updatingHandles,useZ:!1});return C=C.next((g=>(this._onDragCancel(),g))).next(K),{steps:k=k.next((g=>this._trackNumDragging(g))).next((g=>{const _=this._manipulatorInfos.filter((g=>"vertex"===g.type&&g.manipulator.selected));return g.manipulatorType===Wo.TRANSLATE_XY&&1===_.length?{...g,info:_[0],snapOrigin:_[0].handle.pos}:g})).next(la(this.view,g,S.graphic??void 0)).next(...B).next(ua()).next((g=>this._perObjectManipulatorDragAction(rp.SELECTED_OR_ALL,g))).next((g=>(this._updateTranslateTooltip(_,g),g))),cancel:C}}),g,k,S.graphic),C((()=>S.visible),(()=>this._updateMoveManipulationPosition()),Zi),S.on("committed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),C((()=>S.isDraped),(g=>{this._updateMoveManipulationPosition();const _="align-move-manipulation";g?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),_):this.removeHandles(_)}),Zi)])}_createVisualElements(){const{object:g,view:_}=this,S=l$4({view:_,object:g,forEachManipulator:g=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(g),this._moveManipulation.forEachManipulator(g);for(const _ of this._manipulatorInfos)g(_.manipulator,Wo.TRANSLATE_XY)}},onManipulatorsChanged:g=>this.events.on("manipulators-changed",g)});null!=S&&(this._outlineVisualElement=S.visualElement instanceof fr?S.visualElement:null);const O=this._outlineVisualElement;if(null!=O){const t6=()=>{g.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add($((()=>O.events),"attachment-origin-changed",t6,{onListenerAdd:t6}))}this._manipulatorHandles.add(S)}_createEdgeOffsetManipulator(g,_=this.object.elevationInfo){var S;const O=this._operations;if(g.component.vertices.length<=2||!O)return null;const T=this._settings.manipulators.edgeOffset,I=T.size/2,k=I+T.collisionPadding,C=I/k,$=C*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=xn(this._edgeOffsetManipulatorMaterial,$,C/2,C/2,T.height,T.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=xn(this._edgeOffsetManipulatorMaterial,-$,C/2,C/2,T.height,-T.offset));const B=[new fa(this._edgeOffsetManipulatorGeometryInside.instantiate(),Sn.Unfocused),new fa(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Sn.Focused),new fa(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Sn.Unfocused),new fa(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Sn.Focused)],K=new pa({view:this.view,renderObjects:B,elevationInfo:"on-the-ground"!==_.mode||On(null==(S=this.object.graphic)?void 0:S.symbol)?{mode:"absolute-height",offset:0}:_,worldOriented:!1,focusMultiplier:1,radius:k,available:this.object.visible,collisionType:{type:"disc",direction:Tn(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),J=new pa({view:this.view,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1}}),tt={manipulator:K,handle:g,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:J,elevationInfo:_,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(tt,T.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(tt);const et=[];for(const it of[g.leftVertex,g.rightVertex]){const g=this._getManipulatorInfoFromHandle(it);null!=g&&et.push(g.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(tt))))}tt.locationUpdateHandle=ni(et),this._manipulatorHandles.add(tt.locationUpdateHandle,K),this._manipulatorHandles.add([this._watchAndUpdateGrabState(K,!0),this._watchAndUpdateGrabState(J,!0)],K),this._manipulatorHandles.add(ra(K,this._createEdgeOffsetPipeline(tt,_)),K),this._manipulatorHandles.add(ra(J,((g,S,T,I)=>{if("touch"===I)this._createEdgeOffsetPipeline(tt,_)(g,S,T);else if(this.enableMoveObject){const I=this.object.graphic,k=O.data.spatialReference;S.next((g=>this._trackNumDragging(g))).next(_a(this.view,g.elevationAlignedLocation)).next(Na(this.view,g.elevationAlignedLocation,_,k,I)).next(da()).next(ua()).next((g=>this._perObjectManipulatorDragAction(rp.ALL,g))).next((g=>(this._updateTranslateObjectTooltip(Jo.XY,g),g))).next((g=>{"end"===g.action&&this._resetTooltip()})),T.next((()=>this._onDragCancel(!g.metadata.deleting)))}})),K);const m2=g=>{this._manipulatorInfos.some((g=>g.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...g,object:this.object}),g.stopPropagation()};return this._manipulatorHandles.add([K.events.on("immediate-click",m2),J.events.on("immediate-click",m2),K.events.on("focus-changed",(({action:g})=>{"focus"===g?this._updateEdgeOffsetTooltip(null):this._resetTooltip()}))],K),this._manipulatorInfos.push(tt),this.manipulators.add(K),this.manipulators.add(J),this.events.emit("manipulators-changed"),tt}_autoHideEdgeOffsetManipulator(g,_){const S=g.manipulator,O=g.edgeManipulator,n14=()=>{g.visibilityHandle=wn(g.visibilityHandle);const T=this._getManipulatorInfoFromHandle(g.handle.leftVertex),I=this._getManipulatorInfoFromHandle(g.handle.rightVertex),k=null!=T&&null!=I&&function C$1(g,_,S){const O=S.projectToRenderScreen(g,fn()),T=S.projectToRenderScreen(_,fn());return null!=O&&null!=T?_n(fe(O,O,T)):0}(T.manipulator.renderLocation,I.manipulator.renderLocation,this.view.state.camera)<_;(!S.focused&&!O.focused||k)&&(S.grabbable=!k,O.grabbable=!k,g.visibilityHandle=ni([S.disableDisplay(),B((()=>{S.grabbable=!0,O.grabbable=this.enableMoveObject}))]))};this._manipulatorHandles.add([S.events.on("focus-changed",n14),O.events.on("focus-changed",n14),B((()=>{wn(g.visibilityHandle),O.metadata.deleting=!0,this.manipulators.remove(O)}))],S),n14()}_updateEdgeOffsetManipulator(g){if(!this._operations)return;this._updateManipulatorPosition(g);const{coordinateHelper:_}=this._operations.data,S=p$4(this.view,g.manipulator.elevationAlignedLocation,m(_,g.handle,g.manipulator.elevationInfo)),O=this._getManipulatorInfoFromHandle(g.handle.leftVertex),T=this._getManipulatorInfoFromHandle(g.handle.rightVertex);if(null==O||null==T)return;const I=O.manipulator.renderLocation,k=T.manipulator.renderLocation,C=null!=S?function g$1(g,_,S){const O=dn(g),T=gn(_t(),_,S),I=be(_t(),T,O),k=be(_t(),T,I);return mn(T[0],T[1],T[2],0,I[0],I[1],I[2],0,k[0],k[1],k[2],0,0,0,0,1)}(S,I,k):En;g.manipulator.modelTransform=C,g.edgeManipulator.elevationAlignedLocation=g.manipulator.elevationAlignedLocation,g.edgeManipulator.modelTransform=C;const $=In(fe(np,I,k))/2;g.edgeManipulator.collisionType={type:"line",paths:[[[-$,0,0],[$,0,0]]]}}_createEdgeOffsetPipeline(g,_){return(S,O,T)=>{const I=this._operations;if(!I)return;this._clearSelection();const{step:k,cleanup:C}=this._initializeEdgeOffset(g,_,I);O.next((g=>this._trackNumDragging(g))).next(_a(this.view,S.elevationAlignedLocation)).next(k).next(Ga(this.view)).next(Fa(this.view,I.data.spatialReference)).next(ua()).next((g=>{const{operation:_,mapEnd:S}=g;return null==_||null==S?g:("start"===g.action&&_.selectArrowFromStartPoint(S),{...g,signedDistance:_.signedDistanceToPoint(S)})})).next(this._applyEdgeOffsetStep(g)).next(this._showEdgeOffsetTooltip()).next((g=>{"end"===g.action&&C()})),T.next((()=>{S.metadata.deleting||(C(),this._onDragCancel())}))}}_initializeEdgeOffset(g,_,S){const{view:O}=this,T=m(S.data.coordinateHelper,g.handle,_),I=S.createUndoGroup(),k=p$4(O,g.manipulator.elevationAlignedLocation,T);if(T.requiresSplitEdgeLeft){const _=this._getManipulatorInfoFromHandle(g.handle.leftVertex.leftEdge);null!=_&&this._splitEdgeManipulator(_,1)}if(T.requiresSplitEdgeRight){const _=this._getManipulatorInfoFromHandle(g.handle.rightVertex.rightEdge);null!=_&&this._splitEdgeManipulator(_,0)}const c8=()=>new Ee({paths:[[g.handle.leftVertex.pos,g.handle.rightVertex.pos]],spatialReference:S.data.spatialReference}),$=this._settings,B=new fr({view:O,isDraped:this.object.isDraped,geometry:c8(),elevationInfo:g.elevationInfo,width:$.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0});let K;const f2=()=>{this._cleanEdgeOffsetCollapsedEdges(g),K=wn(K)},J=this.events.on("undo",f2);return K=ni([C((()=>Bi(this._accentColor)),(g=>B.color=g),Zi),Qi(B),C((()=>this.object.isDraped),(g=>B.isDraped=g)),this.object.on("committed",(()=>B.geometry=c8())),I,J]),B.attached=!0,{step:g=>null==T||null==k?(f2(),null):{...g,operation:T,plane:k},cleanup:f2}}_applyEdgeOffsetStep(g){return _=>{if(this.destroyed||null==_.operation)return _;this._updateEventState(ap.RESHAPING);const{mapDeltaX:S,mapDeltaY:O,mapDeltaZ:T}=_;return(S||O||T)&&(this._offsetEdge(g,_),this.events.emit("reshape",{type:"reshape",object:this.object})),_}}_showEdgeOffsetTooltip(){return g=>(null!=g.signedDistance&&this.object.operations?this._updateEdgeOffsetTooltip(g):this._resetTooltip(),g)}_cleanEdgeOffsetCollapsedEdges(g){var _,S;if(!this._operations)return;const O=null==(_=g.handle.leftVertex.leftEdge)?void 0:_.leftVertex,T=g.handle.leftVertex,I=null==(S=g.handle.rightVertex.rightEdge)?void 0:S.rightVertex,k=g.handle.rightVertex,C=this._operations.data.coordinateHelper,$=[];if(O&&C.distance(O.pos,T.pos)<op){const g=this._getManipulatorInfoFromHandle(T);null!=g&&$.push(g)}if(C.distance(T.pos,k.pos)<op||I&&C.distance(I.pos,k.pos)<op){const g=this._getManipulatorInfoFromHandle(k);null!=g&&$.push(g)}$.length&&this._removeVertices($)}_createVertexOrEdgeManipulator(g,_=this.object.elevationInfo,S=!1){var O;const{view:T,_operations:I}=this;if(!I)return null;const k=this._settings;if("edge"===g.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(g,_);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:g,outlineSize:_}=xe(k.manipulators.vertex);this._vertexManipulatorGeometry=kn(this._vertexManipulatorMaterial,g,16,16),this._vertexManipulatorOutlineGeometry=kn(this._vertexManipulatorOutlineMaterial,_,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:g,outlineSize:_}=xe(k.manipulators.edge);this._edgeManipulatorGeometry=kn(this._edgeManipulatorMaterial,g,16,16),this._edgeManipulatorOutlineGeometry=kn(this._edgeManipulatorOutlineMaterial,_,16,16)}const C=null==(O=this._operations)?void 0:O.data.type,$="point"===C||"mesh"===C?[]:[new fa(this._vertexManipulatorGeometry.instantiate(),sp.Vertex|Sn.Unselected),new fa(this._vertexManipulatorOutlineGeometry.instantiate(),sp.Vertex|Sn.Unfocused|Sn.Unselected),new fa(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),sp.Vertex|Sn.Focused|Sn.Unselected),new fa(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Sn.Selected),new fa(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Sn.Selected|Sn.Unfocused),new fa(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Sn.Selected|Sn.Focused)];this.enableMidpoints&&$.push(new fa(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),sp.Edge|Sn.Focused|Sn.Unselected),new fa(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),sp.Edge|Sn.Focused|Sn.Unselected),new fa(this._edgeManipulatorGeometry.instantiate(),sp.Edge|Sn.Unfocused|Sn.Unselected),new fa(this._edgeManipulatorOutlineGeometry.instantiate(),sp.Edge|Sn.Unfocused|Sn.Unselected));const B=new pa({view:T,renderObjects:$,elevationInfo:_,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1}});B.selected=S,this._setTypeSpecificManipulatorSettings(B,g,_);const K="edge"===g.type?{manipulator:B,handle:g,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:B,handle:g,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(K),this.manipulators.add(B),this._updateManipulatorPosition(K),"edge"===K.type){const g=[];for(const _ of[K.handle.leftVertex,K.handle.rightVertex]){const S=this._getManipulatorInfoFromHandle(_);null!=S&&g.push(S.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(K))))}K.locationUpdateHandle=ni(g),this._manipulatorHandles.add(K.locationUpdateHandle,B)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(B,!0),B);const J=ra(B,((g,S,O,T)=>{let k=null;const{snappingStep:C,cancelSnapping:$}=Ho({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new zo({editGeometryOperations:I,elevationInfo:_,pointer:T,excludeFeature:this.object.graphic,visualizer:new Uo}),updatingHandles:this._updatingHandles,useZ:!1});O=O.next((_=>(this._onDragCancel(!g.metadata.deleting,(()=>k=wn(k))),_))).next($),S.next((g=>this._trackNumDragging(g))).next((g=>{if("start"===g.action&&this._operations&&(k=this._operations.createUndoGroup()),"edge"===K.type){const _=this._splitEdgeManipulator(K);return{...g,info:_,snapOrigin:_.handle.pos}}return{...g,info:K,snapOrigin:K.handle.pos}})).next(_a(this.view,g.elevationAlignedLocation)).next(Na(this.view,g.elevationAlignedLocation,this.object.elevationInfo,g.location.spatialReference,this.object.graphic)).next(la(this.view,_,this.object.graphic??void 0)).next(...C).next(ua()).next((g=>{this._perVertexManipulatorDragAction(g),"end"===g.action&&(k=wn(k)),this._resetTooltip()}))}));return this._manipulatorHandles.add([J,B.events.on("immediate-click",(g=>this._manipulatorClickCallback(g,K))),B.events.on("select-changed",(()=>{K.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()})),B.events.on("focus-changed",(()=>{this._resetTooltip()}))],B),this.events.emit("manipulators-changed"),K}_trackNumDragging(g){switch(g.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return g}_onDragCancel(g=!0,_){switch(this._numDragging--,g&&this.undo(),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case ap.NONE:break;case ap.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case ap.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}_&&_(),this.destroyed||this._updateEventState(ap.NONE)}_setTypeSpecificManipulatorSettings(g,_,S){var O,T;const I=this._settings;switch(_.type){case"vertex":{g.state=sp.Vertex,g.selectable=!0,g.cursor="move",g.collisionPriority=2;const{size:_,collisionPadding:T}=I.manipulators.vertex;g.radius=_/2+T,g.elevationInfo=S;const k=null==(O=this._operations)?void 0:O.data.type;g.interactive=null!=k&&"point"!==k&&"mesh"!==k;break}case"edge":{g.state=sp.Edge,g.selectable=!1,g.cursor="copy",g.collisionPriority=-1;const{size:_,collisionPadding:O}=I.manipulators.edge;g.radius=_/2+O,g.elevationInfo="on-the-ground"!==S.mode||On(null==(T=this.object.graphic)?void 0:T.symbol)?{mode:"absolute-height",offset:0}:S;break}}}_watchAndUpdateGrabState(g,_){return g.events.on("grab-changed",(S=>this._onGrabStateChanged(g,_,S.action,S.pointerType)))}_onGrabStateChanged(g,_,S,O="mouse"){if(!this._recreatingManipulators){if("start"===S)_&&this._updateSelection(g),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(ap.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==O||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((g=>{var _;const{manipulator:S}=g,O=null==(_=this._operations)?void 0:_.data.type;S.interactive=S.grabbing||!this._numGrabbing&&null!=O&&"point"!==O&&"mesh"!==O,"edgeManipulator"in g&&(g.edgeManipulator.interactive=g.edgeManipulator.grabbing||!this._numGrabbing)})),this._objectMoveManipulation.forEachManipulator((g=>{g.interactive=g.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const g of this._manipulatorInfos)g.manipulator.grabbing||(g.manipulator.selected=!1)}_updateSelection(g){g.grabbing&&!g.selected&&g.selectable&&(this._clearSelection(),g.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(g){null!=g&&(g.manipulator.metadata.deleting=!0,this.manipulators.remove(g.manipulator),this._manipulatorHandles.remove(g.manipulator),Rn(this._manipulatorInfos,g),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(g){if(g)for(const _ of this._manipulatorInfos)if(g===_.handle)return _;return null}_updateManipulatorPositions(g){for(const _ of g)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(_))}_updateManipulatorPosition(g){const _=this._operations;if(null!=g&&_)if("vertex"===g.type)g.manipulator.location=_.data.coordinateHelper.vectorToDehydratedPoint(g.handle.pos,ip),g.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=g.manipulator.renderLocation);else if("edge"===g.type){const S=this._getManipulatorInfoFromHandle(g.handle.leftVertex),O=this._getManipulatorInfoFromHandle(g.handle.rightVertex);if(null==S||null==O)return;const T=S.manipulator,I=O.manipulator;if(null!=g.manipulator.elevationInfo&&"on-the-ground"===g.manipulator.elevationInfo.mode){const S=T.location,O=I.location,k=.5,C=S.x+k*(O.x-S.x),$=S.y+k*(O.y-S.y),B=S.hasZ&&O.hasZ?0:void 0;g.manipulator.location=Mt(C,$,B,_.data.spatialReference)}else De(np,T.renderLocation,I.renderLocation,.5),g.manipulator.renderLocation=np}}_splitEdgeManipulator(g,_=.5){const S=this._operations,O=S.splitEdge(g.handle,_).createdVertex;g.locationUpdateHandle=wn(g.locationUpdateHandle);const T=this.object.elevationInfo;let I;this.enableEdgeOffset?(this._removeManipulator(g),I=this._createVertexOrEdgeManipulator(O)):(I=g,I.handle=O,I.type="vertex",this._setTypeSpecificManipulatorSettings(g.manipulator,g.handle,T)),O.leftEdge&&this._createVertexOrEdgeManipulator(O.leftEdge),O.rightEdge&&this._createVertexOrEdgeManipulator(O.rightEdge),this._updateManipulatorPosition(I),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(g.manipulator);const k=this._updateEventState(ap.RESHAPING),C=S.data.coordinateHelper.vectorToArray(I.handle.pos),$=S.data.components.indexOf(O.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:C,componentIndex:$,vertexIndex:O.index}],added:C}),k&&this._updateEventState(ap.NONE),I}_updateMoveManipulationPosition(){var g,_,S,O;const T=Ct(np,0,0,0);let I=0,k=!1,C=null,$=null;for(const J of this._manipulatorInfos)"vertex"===J.type&&(J.manipulator.selected?(I++,Dt(T,T,J.manipulator.renderLocation),null==C||J.selectedIndex>C.selectedIndex?($=C,C=J):(null==$||J.selectedIndex>$.selectedIndex)&&($=J)):k=!0);const B=this.object,K=null==(g=this._operations)?void 0:g.data.geometry;if(0===I){const g=B.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=g,this._moveManipulation.xyAxisManipulation.available=g,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=g,this._moveManipulation.zManipulation.available=g&&this.enableZShape&&za(this._operations,B.elevationInfo),this._moveManipulation.angle=r$3(K),this._moveManipulation.radius=Qo.radiusForSymbol(null==(_=B.graphic)?void 0:_.symbol)}else{const g=B.visible;this._moveManipulation.xyManipulation.available=g,this._moveManipulation.xyAxisManipulation.available=g,this._moveManipulation.zManipulation.available=g&&this.enableZVertex&&za(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=g&&1!==I;let _=0;if(null!=C){const g=C.handle.pos,T=null!=$?$.handle.pos:(null==(S=C.handle.leftEdge)?void 0:S.leftVertex)?C.handle.leftEdge.leftVertex.pos:null,I=null==$&&(null==(O=C.handle.rightEdge)?void 0:O.rightVertex)?C.handle.rightEdge.rightVertex.pos:null;T&&I?this._moveManipulation.xyAxisManipulation.available=!1:T?_=ye(T,g):I&&(_=ye(g,I))}this._moveManipulation.angle=_,this._moveManipulation.radius=is}0!==I&&k?(At(T,T,1/I),ip.spatialReference=this._operations.data.spatialReference,ip.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(T,ip),this._moveManipulation.elevationAlignedLocation=ip):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?ya(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(g){var _;const S=new Array,O=this._operations;if(O){for(const T of g){const g=T.handle.component;if("vertex"===T.type&&O.canRemoveVertex(g)){S.push(T.handle),this._removeManipulator(T),this._removeManipulator(this._getManipulatorInfoFromHandle(T.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(T.handle.rightEdge));const I=null==(_=O.removeVertices([T.handle]).removedVertices)?void 0:_[0].createdEdge;I?this._createVertexOrEdgeManipulator(I):this.enableEdgeOffset&&g.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(g.edges[0]))}}if(S.length>0){const g=S.map((g=>{const _=O.data.components.indexOf(g.component);return{coordinates:O.data.coordinateHelper.vectorToArray(g.pos),componentIndex:_,vertexIndex:g.index}})),_=this._updateEventState(ap.RESHAPING);if(this.destroyed)return;if(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:g.map((g=>g.coordinates)),vertices:g}),this.destroyed)return;if(_&&(this._updateEventState(ap.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(g,_,S=("start"===_.action?Ca.NEW_STEP:Ca.ACCUMULATE_STEPS)){const O=this._operations;if(O){g.length>0&&O.moveVertices(g.map((g=>g.handle)),_.mapDeltaX,_.mapDeltaY,_.mapDeltaZ,S);for(const _ of g)this._updateManipulatorPosition(_)}}_offsetEdge(g,_){if(null==_.operation||null==_.signedDistance)return;const S=this._operations;if(!S)return;const O=_.operation.clone();O.distance=_.signedDistance,S.updateVertices([g.handle.leftVertex,g.handle.rightVertex],O),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(g.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(g.handle.rightVertex))}_manipulatorClickCallback(g,_){g.shiftKey||this._clearSelection(),"vertex"===_.type&&(_.manipulator.selected=!_.manipulator.selected,this.enableDeleteVertices&&g.button===Cn.Right&&this._removeVertices([_])),"edge"===_.type&&g.button===Cn.Left&&this._splitEdgeManipulator(_),g.stopPropagation()}_updateTranslateTooltip(g,_){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(g,_)}_updateTranslateObjectTooltip(g,_){this.activeTooltipInfo=function Z(g,_,{sketchOptions:S,tooltipInfos:O}){let T=null;switch(g){case Jo.XY:T=O.translate,P(T,_,((g,_)=>Vo(g,_)));break;case Jo.XY_AXIS:T=O.translateXY,P(T,_,((g,S)=>un(Vo(g,S),es(_))));break;case Jo.Z:T=O.translateZ,P(T,_,pn)}return T.sketchOptions=S,T}(g,_,this._tooltipsContext)}_updateEdgeOffsetTooltip(g){this.activeTooltipInfo=A$1(this.object,g,this._tooltipsContext)}_resetTooltip(){this.activeTooltipInfo=this._defaultTooltipInfo}get _defaultTooltipInfo(){var g;switch(null==(g=this._operations)?void 0:g.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const g=this._manipulatorInfos.filter((g=>"vertex"===g.type&&g.manipulator.selected));return 1===g.length?g[0]:null}get _tooltipsContext(){const{events:g}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:{onReshapeStart:()=>g.emit("reshape",{type:"reshape-start",object:this.object}),onReshape:()=>g.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>g.emit("reshape",{type:"reshape-stop",object:this.object}),onMoveStart:()=>g.emit("move",{type:"move-start",object:this.object,dx:0,dy:0}),onMove:()=>g.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>g.emit("move",{type:"move-stop",object:this.object,dx:0,dy:0})}}}get test(){}};function xe(g){const _=g.size/2,S=_+g.collisionPadding;return{size:_/S,outlineSize:(_+g.outlineSize)/S}}function ye(g,_){return Math.atan2(_[1]-g[1],_[0]-g[0])+Math.PI/2}g([_()],ep.prototype,"_numGrabbing",void 0),g([_()],ep.prototype,"_numDragging",void 0),g([_()],ep.prototype,"grabbingOrDragging",null),g([_()],ep.prototype,"_operations",null),g([_()],ep.prototype,"_segmentLabels",void 0),g([_({constructOnly:!0})],ep.prototype,"tool",void 0),g([_()],ep.prototype,"tooltip",void 0),g([_()],ep.prototype,"activeTooltipInfo",void 0),g([_({readOnly:!0})],ep.prototype,"updating",null),g([_()],ep.prototype,"manipulators",null),g([_()],ep.prototype,"view",null),g([_()],ep.prototype,"object",null),g([_()],ep.prototype,"enableZShape",null),g([_()],ep.prototype,"enableDeleteVertices",null),g([_()],ep.prototype,"enableZVertex",null),g([_()],ep.prototype,"autoHideManipulators",null),g([_()],ep.prototype,"enableMoveObject",null),g([_()],ep.prototype,"enableMidpoints",null),g([_()],ep.prototype,"enableEdgeOffset",null),g([_()],ep.prototype,"_sketchOptions",null),g([_()],ep.prototype,"_accentColor",null),g([_()],ep.prototype,"_tooltipsContext",null),ep=g([S("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],ep);const ip=Mt(0,0,void 0,te.WGS84),np=_t(),op=1e-6;var sp,ap,rp;!function(g){g.Vertex=bn.Custom1,g.Edge=bn.Custom2}(sp||(sp={})),function(g){g[g.NONE=0]="NONE",g[g.MOVING=1]="MOVING",g[g.RESHAPING=2]="RESHAPING"}(ap||(ap={})),function(g){g[g.ALL=0]="ALL",g[g.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(rp||(rp={}));let lp=class l8 extends aa{constructor(g){super(g),this.events=new xt,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new El,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const g=this._reshapeOperation=new ep({tool:this});this.addHandles([g.events.on("reshape",(g=>this.events.emit("reshape",g))),g.events.on("move",(g=>this.events.emit("move",g))),g.events.on("vertex-add",(g=>this.events.emit("vertex-add",g))),g.events.on("vertex-remove",(g=>this.events.emit("vertex-remove",g))),g.events.on("immediate-click",(g=>this.events.emit("immediate-click",{...g,object:this.object}))),this.view.on("pointer-down",["Shift"],(g=>g.stopPropagation()))]),this.finishToolCreation()}destroy(){this._reshapeOperation=ki(this._reshapeOperation)}get updating(){var g;return((this.object.updating??!1)||(null==(g=this._reshapeOperation)?void 0:g.updating))??!1}get activeTooltipInfo(){var g;return(null==(g=this._reshapeOperation)?void 0:g.activeTooltipInfo)??null}get tooltip(){var g;return(null==(g=this._reshapeOperation)?void 0:g.tooltip)??null}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.undo()}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.redo()}onInputEvent(g){const _=this._reshapeOperation;_&&!_.grabbingOrDragging&&G$1(g,_.tooltip)||!this.enableDeleteVertices||"key-down"!==g.type||!ia.delete.includes(g.key)||this._reshapeOperation.removeSelectedVertices()>0&&g.stopPropagation()}reset(){}get test(){}};g([_()],lp.prototype,"_reshapeOperation",void 0),g([_()],lp.prototype,"view",void 0),g([_({constructOnly:!0})],lp.prototype,"object",void 0),g([_()],lp.prototype,"enableZShape",void 0),g([_()],lp.prototype,"enableZVertex",void 0),g([_()],lp.prototype,"enableMoveObject",void 0),g([_()],lp.prototype,"enableDeleteVertices",void 0),g([_()],lp.prototype,"autoHideManipulators",void 0),g([_()],lp.prototype,"enableMidpoints",void 0),g([_()],lp.prototype,"enableEdgeOffset",void 0),g([_()],lp.prototype,"type",void 0),g([_({type:El})],lp.prototype,"sketchOptions",void 0),g([_()],lp.prototype,"snappingManager",void 0),g([_()],lp.prototype,"updating",null),g([_()],lp.prototype,"activeTooltipInfo",null),g([_()],lp.prototype,"tooltip",null),g([_()],lp.prototype,"automaticManipulatorSelection",void 0),lp=g([S("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],lp);let cp=class p7 extends O{constructor(g){super(g),this._interactionState=null}initialize(){this.addHandles([Xi((()=>{const g=this._interactionState;return g&&g.angle!==g.previousAngle?{interactionState:g,angle:g.state.angle}:null}),(({interactionState:g})=>{this._updateMeshRotation(g)}),Ki),Xi((()=>{const g=this._interactionState;return g&&g.scale!==g.previousScale?{interactionState:g,scale:g.state.scale}:null}),(({interactionState:g})=>{this._updateMeshSize(g)}),Ki)])}get initialAngle(){var g;return(null==(g=this._interactionState)?void 0:g.initialAngle)??0}get angle(){var g;const _=this.geometry.transform;if(null==_)return(null==(g=this._interactionState)?void 0:g.angle)??0;const S=Dn(_.rotation)[2];return Math.abs(S)>.999999?ht(An(_.rotation))*Math.sign(S):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var g;return(null==(g=this._interactionState)?void 0:g.scale)??1}startInteraction(){const g=new pp({angle:this.angle});this._interactionState=g;const e6=()=>{this._interactionState=null};return{state:g,done:e6,cancel:()=>{g.cancel(),e6()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(g){const{angle:_,previousAngle:S}=g;g.previousAngle=_;const O=$n(_-S);this.geometry.rotate(0,0,O,{origin:this.geometry.anchor})}_updateMeshSize(g){const{scale:_,previousScale:S}=g;g.previousScale=_;const O=_/S,T=this.geometry.anchor;this.geometry.scale(O,{origin:T})}};g([_({constructOnly:!0})],cp.prototype,"object",void 0),g([_({constructOnly:!0})],cp.prototype,"geometry",void 0),g([_({constructOnly:!0})],cp.prototype,"viewingMode",void 0),g([_()],cp.prototype,"initialAngle",null),g([_()],cp.prototype,"angle",null),g([_()],cp.prototype,"angleClockwise",null),g([_()],cp.prototype,"relativeAngle",null),g([_()],cp.prototype,"relativeAngleClockwise",null),g([_()],cp.prototype,"scale",null),g([_()],cp.prototype,"_interactionState",void 0),cp=g([S("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],cp);let pp=class extends O{get state(){const{angle:g,scale:_}=this;return{angle:g,scale:_}}constructor(g){super(g),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=g.angle,this.previousAngle=g.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};g([_()],pp.prototype,"angle",void 0),g([_()],pp.prototype,"initialAngle",void 0),g([_()],pp.prototype,"previousAngle",void 0),g([_()],pp.prototype,"previousScale",void 0),g([_()],pp.prototype,"scale",void 0),g([_()],pp.prototype,"state",null),pp=g([S("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],pp);let up=class a5 extends O{constructor(g){super(g),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(Xi((()=>null!=this._interactionState?this._interactionState.state:null),(g=>{this._updateSymbol(g)}),Ki))}get initialAngle(){var g;return(null==(g=this._interactionState)?void 0:g.initialAngle)??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function c7(g){return-ht(g)}(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var g;return(null==(g=this._interactionState)?void 0:g.scale)??1}get size(){const g=this._sizeReferenceSymbolLayer;if(null==g)return null;const _=this.findLayerView(),S=this._graphicSymbol;if(null==_||null==S||"point-3d"!==S.type)return null;const O=_.getSymbolLayerSize(S,g);if("size"in O&&null!=O.size)return O.size;const T=this.sizeAxis;return!("width"in O)||null==O.width||null!=T&&"width"!==T&&"all"!==T&&"width-and-depth"!==T?!("depth"in O)||null==g.depth||null!=T&&"depth"!==T&&"all"!==T&&"width-and-depth"!==T?!("height"in O)||null==g.height||null!=T&&"height"!==T&&"all"!==T?null:O.height:O.depth:O.width}get _sizeReferenceSymbolLayer(){const g=this._graphicSymbol;return null==g||0===g.symbolLayers.length?null:g.symbolLayers.find((g=>"object"===g.type))}get _orientationReferenceSymbolLayer(){const g=this._graphicSymbol;return null==g||0===g.symbolLayers.length?null:g.symbolLayers.find((g=>"object"===g.type&&null!=g.heading))}get _graphicSymbol(){var g;return null!=(null==(g=this.graphic)?void 0:g.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(g){this.graphic.symbol=g}startInteraction(){const g=this._graphicSymbol,_=this.findLayerView();if(null!=this._interactionState||null==g||null==_)return dp;const S=g.symbolLayers.map((S=>"object"===S.type?_.getSymbolLayerSize(g,S):null)).toArray(),O=g.clone(),T=this.angle,I=new hp({originalSymbol:O,angle:T,initialSizes:S});this._interactionState=I;const r5=()=>{this._interactionState=null};return{state:I,done:r5,cancel:()=>{this._graphicSymbol=O,r5()}}}createUndoRecord(){let g=this.graphic.symbol,_=null;return{undo:S=>{_=S.symbol,S.symbol=g},redo:S=>{g=S.symbol,S.symbol=_}}}_updateSymbol({scale:g,angle:_,originalSymbol:S,initialSizes:O}){const T=this._graphicSymbol;if(null==T||"point-3d"!==T.type)return;const I=T.clone(),k=-$n(_-this.initialAngle);let C=!1;this._forEachObjectSymbolLayerPair(S,I,((_,S,T)=>{const I=(_.heading??0)+k;S.heading!==I&&(S.heading=I,C=!0);const $=O[T];if(null!=$&&"width"in $){$.width=this.sizeFilter($.width),$.height=this.sizeFilter($.height),$.depth=this.sizeFilter($.depth);const _=$.width*g;S.width!==_&&(S.width=_,C=!0);const O=$.depth*g;S.depth!==O&&(S.depth=O,C=!0);const T=$.height*g;S.height!==T&&(S.height=T,C=!0)}})),C&&(this._graphicSymbol=I)}_forEachObjectSymbolLayerPair(g,_,S){g.symbolLayers.forEach(((g,O)=>{const T=_.symbolLayers.at(O);"object"===g.type&&"object"===T.type&&S(g,T,O)}))}};g([_()],up.prototype,"initialAngle",null),g([_()],up.prototype,"angle",null),g([_()],up.prototype,"angleClockwise",null),g([_()],up.prototype,"orientation",null),g([_()],up.prototype,"orientationClockwise",null),g([_()],up.prototype,"relativeAngle",null),g([_()],up.prototype,"relativeAngleClockwise",null),g([_()],up.prototype,"scale",null),g([_()],up.prototype,"size",null),g([_()],up.prototype,"sizeAxis",void 0),g([_({constructOnly:!0})],up.prototype,"graphic",void 0),g([_()],up.prototype,"_interactionState",void 0),g([_({constructOnly:!0})],up.prototype,"findLayerView",void 0),g([_({constructOnly:!0})],up.prototype,"sizeFilter",void 0),g([_()],up.prototype,"_sizeReferenceSymbolLayer",null),g([_()],up.prototype,"_orientationReferenceSymbolLayer",null),g([_()],up.prototype,"_graphicSymbol",null),up=g([S("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],up);const dp={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let hp=class extends O{get state(){const{originalSymbol:g,angle:_,initialAngle:S,scale:O,initialSizes:T}=this;return{originalSymbol:g,angle:_,initialAngle:S,scale:O,initialSizes:T}}constructor(g){super(g),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=g.angle}};g([_()],hp.prototype,"originalSymbol",void 0),g([_()],hp.prototype,"angle",void 0),g([_()],hp.prototype,"initialAngle",void 0),g([_()],hp.prototype,"initialSizes",void 0),g([_()],hp.prototype,"scale",void 0),g([_()],hp.prototype,"state",null),hp=g([S("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],hp);let vp=class e3 extends sl{constructor(g){super(g),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};g([_()],vp.prototype,"type",void 0),g([_()],vp.prototype,"orientation",void 0),g([_()],vp.prototype,"orientationPrecision",void 0),g([_()],vp.prototype,"rotationType",void 0),g([_()],vp.prototype,"size",void 0),g([_()],vp.prototype,"sizePrecision",void 0),g([_()],vp.prototype,"sizeUnit",void 0),vp=g([S("esri.views.interactive.tooltip.infos.TransformAbsoluteTooltipInfo")],vp);let gp=class e4 extends sl{constructor(g){super(g),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};g([_()],gp.prototype,"type",void 0),g([_()],gp.prototype,"rotation",void 0),g([_()],gp.prototype,"rotationPrecision",void 0),g([_()],gp.prototype,"orientation",void 0),g([_()],gp.prototype,"orientationPrecision",void 0),g([_()],gp.prototype,"rotationType",void 0),gp=g([S("esri.views.interactive.tooltip.infos.TransformRotateTooltipInfo")],gp);let mp=class extends sl{constructor(g){super(g),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};var fp;g([_()],mp.prototype,"type",void 0),g([_()],mp.prototype,"scale",void 0),g([_()],mp.prototype,"size",void 0),g([_()],mp.prototype,"sizeUnit",void 0),g([_()],mp.prototype,"sizePrecision",void 0),mp=g([S("esri.views.interactive.tooltip.infos.TransformScaleTooltipInfo")],mp),function(g){g.ScaleIn=bn.Custom2,g.ScaleOut=bn.Custom3,g.RotateLeft=bn.Custom4,g.RotateRight=bn.Custom5,g.Unlocked=bn.Custom7,g.DelayedFocused=bn.Custom8,g.TouchInput=bn.Custom12}(fp||(fp={}));let _p=class extends O{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(g){this._ringManipulator.location=g}set elevationAlignedLocation(g){this._ringManipulator.elevationAlignedLocation=g}get grabbing(){return this._ringManipulator.grabbing}set interactive(g){this._ringManipulator.interactive=g}get updating(){return!!this._activeAnimation}get tooltipEffectiveEnabled(){return this.sketchOptions.tooltips.effectiveEnabled&&this.tooltipEnabled}constructor(g){super(g),this.mode=null,this.tooltipEnabled=!0,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=ns,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new xt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>{var g;return"scale"===(null==(g=this._scaleRotateDragData)?void 0:g.mode)?this.adapter.scale:1}}initialize(){this.tooltip=new Mc({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([Xi((()=>!this.tooltipEffectiveEnabled),(()=>this.tooltip.clear()),Zi),C((()=>{const{adapter:g}=this,{info:_}=this.tooltip;return _===this._absoluteTooltipInfo&&this.getFocused()?[_,g.size,g.orientationClockwise]:[null]}),(([g])=>{g&&this._updateFocusTooltip()})),C((()=>{const{adapter:g}=this;return[g.angle,g.scale]}),(()=>this._updateManipulatorTransform()))])}destroy(){var g;null==(g=this._activeAnimation)||g.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this.tooltip=ki(this.tooltip)}startAnimation(g){this.cancelActiveAnimation(),g.start();const _=Pn({update:({deltaTime:_})=>{g.update(_)&&this.cancelActiveAnimation()}});this._activeAnimation={...g,frameTask:_}}cancelActiveAnimation(){var g;null==(g=this._activeAnimation)||g.frameTask.remove(),this._activeAnimation=ki(this._activeAnimation)}forEachManipulator(g){g(this._ringManipulator,Wo.SCALE_ROTATE)}_createManipulator(){const g=this._createRingManipulator();this._ringManipulator=g,this.tool.manipulators.add(g);const _=this.tool.object,S=ra(g,((g,S,O)=>{this._scaleRotateDragData=null;const T=this.adapter.startInteraction(),I={mode:"none",origin:Je(g.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=I,this._updateDragState();const k=ct.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(g.renderLocation,k),S.next(Za(this.tool.view,hn(g.renderLocation,k,vn()))).next((g=>{const S=dn(g.plane),O=ba(g.renderStart,g.renderEnd,I.origin,S),k=Bn.shortestSignedDiff(I.angle,O);I.angleDir=Yn(I.angleDir+k,-as,as),I.angle=O;const C=function Tt(g,_){const S=fe(ct.get(),_.renderStart,g.origin),O=fe(ct.get(),_.renderEnd,g.origin),T=In(S),I=In(O);return 0===T?0:I/T}(I,g),$=C-this.adapter.scale;if(I.scaleDir=Yn(I.scaleDir+$,-rs,rs),this._onScaleChanged(),"none"===I.mode){const S=this.mode||function jt(g,_,S,O){const{renderStart:T,renderEnd:I}=g,k=wt(T,O,ct.get()),C=wt(I,O,ct.get());if(qn(k,C)<vs*vs)return null;const $=fe(ct.get(),T,S),B=be(ct.get(),$,dn(_)),K=T,J=Dt(ct.get(),K,B),tt=wt(S,O,ct.get()),et=k,it=wt(J,O,ct.get()),nt=fe(ct.get(),it,et),ot=fe(ct.get(),k,tt),st=Kn(et,nt),at=Kn(tt,ot);return Jn(st,C)<Jn(at,C)?"rotate":"scale"}(g,g.plane,I.origin,this.tool.view.state.camera);if(null!=S){switch(S){case"rotate":this.tool.events.emit("rotate-start",{object:_,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:_,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}I.mode=S}}switch(I.mode){case"rotate":T.state.angle=I.initialAngle+O;break;case"scale":T.state.scale=C,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),g.action){case"start":case"update":switch(I.mode){case"rotate":this.tool.events.emit("rotate",{object:_,angle:$n(I.angle)});break;case"scale":this.tool.events.emit("scale",{object:_,xScale:C,yScale:C})}break;case"end":switch(I.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:_,angle:$n(I.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:_,xScale:C,yScale:C})}}return"end"===g.action&&(this.startAnimation(It(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),T.done()),g})).next(this._updateTooltipPipelineStep(I)),O.next((()=>{if(T.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:_,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:_,xScale:1,yScale:1})}this.startAnimation(It(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([S,g.events.on("focus-changed",(g=>{"focus"===g.action?this.startAnimation(function kt(g,_,S){let O=0,T=null;const s7=()=>!1;return{start:()=>{T=g.getFocused,g.getFocused=s7,O=0,_()},update:g=>(O+=g,!(null==T?void 0:T())||O>=S.delayMs?yp.STOP:yp.CONTINUE),destroy:()=>{T&&(g.getFocused=T),_()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),g.events.on("immediate-click",(g=>{g.stopPropagation()})),C((()=>this.tool.object.visible),(g=>this._ringManipulator.available=g),Zi)])}_updateTooltipPipelineStep(g){return _=>{const{sketchOptions:S}=this,{visualVariables:O}=S.tooltips;if(!this.tooltipEffectiveEnabled)return _;if("end"===_.action)return this._updateFocusTooltip(),_;const{tooltip:T}=this;switch(g.mode){case"scale":{T.info=this._scaleTooltipInfo??(this._scaleTooltipInfo=new mp({sketchOptions:S}));const{size:g,scale:_}=this.adapter,I=null==O?void 0:O.size,k=T.info;k.sketchOptions=S,k.scale=Ze(_),k.size=null!=g?Ge(g,"meters"):void 0,k.sizePrecision=Et(null==I?void 0:I.valueType),k.sizeUnit=null==I?void 0:I.unit;break}case"rotate":{T.info=this._rotateTooltipInfo??(this._rotateTooltipInfo=new gp({sketchOptions:S}));const{orientationClockwise:g,relativeAngleClockwise:_}=this.adapter,I=null==O?void 0:O.rotation,k=Et(null==I?void 0:I.valueType),C=T.info;C.sketchOptions=S,C.rotation=null!=_?Ne(_,"radians","geographic"):void 0,C.rotationPrecision=k,C.rotationType=(null==I?void 0:I.rotationType)??"geographic",C.orientation=null!=g?Ne(g,"radians","geographic"):void 0,C.orientationPrecision=k;break}}return _}}_updateFocusTooltip(){const{sketchOptions:g,tooltip:_}=this,{visualVariables:S}=g.tooltips;if(this.tooltipEffectiveEnabled)if(this.getFocused()){const O=null==S?void 0:S.rotation,T=null==S?void 0:S.size,I=this.mode,{size:k,orientationClockwise:C}=this.adapter,$=null!=C&&(null==I||"rotate"===I),B=null!=k&&(null==I||"scale"===I);_.info=this._absoluteTooltipInfo??(this._absoluteTooltipInfo=new vp({sketchOptions:g}));const K=_.info;K.sketchOptions=g,K.orientation=$?Ne(C,"radians","geographic"):void 0,K.orientationPrecision=Et(null==O?void 0:O.valueType),K.rotationType=(null==O?void 0:O.rotationType)??"geographic",K.size=B?Ge(k,"meters"):void 0,K.sizeUnit=null==T?void 0:T.unit,K.sizePrecision=Et(null==T?void 0:T.valueType)}else _.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(fp.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){var g;if(this._ringManipulator.updateStateEnabled(fp.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==(null==(g=this._scaleRotateDragData)?void 0:g.mode))),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(fp.ScaleIn|fp.ScaleOut,!1),this._ringManipulator.updateStateEnabled(fp.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(fp.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(fp.RotateLeft|fp.RotateRight,!1),this._ringManipulator.updateStateEnabled(fp.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(fp.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(fp.ScaleIn|fp.ScaleOut|fp.RotateLeft|fp.RotateRight,!1)}_updateManipulatorTransform(){const g=jn(Vn.get(),this.adapter.angle,Tn(0,0,1));if(null==g)return;const _=this.getScale(),S=Ln(Vn.get(),Ct(ct.get(),_,_,_));this._ringManipulator.modelTransform=zn(Vn.get(),S,g)}_createRingManipulator(){const t5=(g,_,S)=>{const O=[],T=Math.ceil(gs*(_-g)/(2*Math.PI));for(let I=0;I<T+1;I++){const k=g+I*(_-g)/T;O.push(Tn(S*Math.cos(k),S*Math.sin(k),0))}return O},e6=g=>t5(0,2*Math.PI,g),g=this._createMaterial(1),i15=(_,S,O=g)=>Xn(O,(g=>[[-g/2,0],[g/2,0],[g/2,fs/2],[-g/2,fs/2]])(S),_,[],[],!1),_=e6(ls),S=i15(_,ss),O={left:new Array,right:new Array},T=[];for(let rt=0;rt<2;rt++){const _=rt*Math.PI-Math.PI/4,S=Math.PI/2-ms,I=_+S,k=_+Math.PI/2-S,C=t5(I,k,cs),$=i15(C,hs);T.push(C),T.push(t5(I,k,ps-ss/2)),O.left.push($),O.right.push($.instantiate());for(let T=0;T<2;T++){const _=0===T,S=Wn();if(_){Hn(S,S,[1,-1,1]),Un(S,S,-I,[0,0,1]);const g=Math.round(os*(C.length-1));S[12]=C[g][0],S[13]=C[g][1],S[14]=C[g][2]}else{Un(S,S,k,[0,0,1]);const g=Math.round((1-os)*(C.length-1));S[12]=C[g][0],S[13]=C[g][1],S[14]=C[g][2]}const $=xn(g,ys,0,_s,fs);Gn($,S),(_?O.left:O.right).push($)}}const I=[];for(let rt=0;rt<2;rt++){const g=rt*Math.PI-Math.PI/4,_=Math.PI/2-Ms,S=g+_,O=g+Math.PI/2-_,T=t5(S,O,ps);I.push(i15(T,hs))}const k=this._createMaterial(.66),C=this._createMaterial(.5),$=this._createMaterial(.33),B=e6(ls+us),K=e6(ls+ds),J=i15(B,hs,k),tt=i15(K,hs,$),et=e6(ls-us),it=e6(ls-ds),nt=i15(et,hs,k),ot=i15(it,hs,$);let st=[new fa(S,fp.DelayedFocused),new fa(S.instantiate({material:C}),Sn.None)];this.mode&&"scale"!==this.mode||(st=st.concat([...I.map((g=>new fa(g,fp.DelayedFocused|fp.Unlocked))),new fa(J,fp.DelayedFocused|fp.ScaleIn),new fa(tt,fp.DelayedFocused|fp.ScaleIn),new fa(nt,fp.DelayedFocused|fp.ScaleOut),new fa(ot,fp.DelayedFocused|fp.ScaleOut)])),this.mode&&"rotate"!==this.mode||(st=st.concat([...O.right.map((g=>new fa(g.instantiate(),fp.DelayedFocused|fp.Unlocked))),...O.left.map((g=>new fa(g,fp.DelayedFocused|fp.RotateLeft))),...O.right.map((g=>new fa(g,fp.DelayedFocused|fp.RotateRight)))]));const at=[_,...T];return new pa({view:this.tool.view,renderObjects:st,autoScaleRenderObjects:!1,worldOriented:!0,radius:ss,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:at,direction:Tn(0,0,1)}})}_createMaterial(g){const _=new Fn({cullFace:Nn.Back,renderOccluded:St.Transparent,isDecoration:!0});return this.addHandles(C((()=>({color:Zn(this.tool.view.effectiveTheme.accentColor,g)})),(g=>_.setParameters(g)),Zi)),_}get test(){}};function wt(g,_,S){return _.projectToScreen(g,bp),Ct(S,bp[0],bp[1],0)}var yp;function It(g,_){let S=null,O=1;const i15=()=>O;return{start:()=>{O=g.getScale(),S=g.getScale,g.getScale=i15,_()},update:g=>(O+=((O+1)/2-O)*Math.min(g*bs,1),_(),Math.abs(O-1)<.01?yp.STOP:yp.CONTINUE),destroy:()=>{S&&(g.getScale=S),_()}}}function Et(g){switch(g){case"integer":case"long":return 0;default:return null}}g([_({constructOnly:!0})],_p.prototype,"tool",void 0),g([_({constructOnly:!0})],_p.prototype,"adapter",void 0),g([_({constructOnly:!0})],_p.prototype,"sketchOptions",void 0),g([_()],_p.prototype,"mode",void 0),g([_()],_p.prototype,"tooltipEnabled",void 0),g([_()],_p.prototype,"_activeAnimation",void 0),g([_()],_p.prototype,"updating",null),g([_()],_p.prototype,"tooltipEffectiveEnabled",null),_p=g([S("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],_p),function(g){g[g.CONTINUE=0]="CONTINUE",g[g.STOP=1]="STOP"}(yp||(yp={}));const bp=ft();let Mp=class r3 extends(h$6(sl)){constructor(g){super(g),this.type="transform-mesh",this.orientation=x$1({actual:null,lockable:!1}),this.scale=F$4({actual:null,lockable:!1}),this.allFields.forEach((g=>{g.lockable=!1,g.setActual(null)}))}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};g([_()],Mp.prototype,"key",null),g([_()],Mp.prototype,"allFields",null),Mp=g([S("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Mp);let wp=class i12 extends(h$6(sl)){constructor(g){super(g),this.type="transform-point",this.allFields.forEach((g=>{g.lockable=!1,g.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};g([_()],wp.prototype,"allFields",null),wp=g([S("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],wp);let xp=class extends aa{constructor(g){super(g),this.events=new xt,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new El,this.type="transform-3d",this._updatingHandles=new Xt,this._scaleRotate=null}initialize(){var g,_;const{events:S,object:O,view:T}=this;this.tooltip=new Mc({view:T}),this._moveManipulation=new Qo({tool:this,view:T,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&za(O.operations,O.elevationInfo),radius:Qo.radiusForSymbol(null==(g=O.graphic)?void 0:g.symbol)}),this._moveManipulation.forEachManipulator((g=>this.addHandles(g.events.on("immediate-click",(g=>{S.emit("immediate-click",{...g,object:this.object}),g.stopPropagation()})))));const I=O.elevationInfo;if(this._moveManipulation.elevationInfo=I,this.addHandles(a$9(O)),this._moveManipulation.createManipulatedObjectDragPipeline(((g,_,S,k,C)=>{var $;if(g===Jo.XY){const{snappingStep:g,cancelSnapping:_}=Ho({snappingContext:new zo({elevationInfo:I,pointer:C,editGeometryOperations:Ia.fromGeometry(new Qt({spatialReference:null==($=O.operations)?void 0:$.data.spatialReference}),T.state.viewingMode),visualizer:new Uo,excludeFeature:O.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});k=k.next(_),S=S.next(Ma(this.view,I)).next(...g)}return{steps:S,cancel:k}}),O,(g=>{const{action:_,object:O,dxScreen:T,dyScreen:I}=g,k={object:O,dxScreen:T,dyScreen:I};switch(_){case"start":this._emitRecordUndo(),S.emit("translate-start",k);break;case"update":S.emit("translate",k);break;case"end":S.emit("translate-stop",k)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(C((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const g=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new _p({tool:this,mode:g,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions,tooltipEnabled:"mesh"!==(null==(_=ca(O))?void 0:_.type)}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([l$4({view:this.view,object:O,forEachManipulator:g=>this._forEachManipulator(g),onManipulatorsChanged:()=>B()}),O.on("committed",(()=>this._onGeometryChanged())),this._hideManipulatorsForObjectState(),C((()=>T.scale),(()=>this._updateMoveAngle()))].filter(Oe)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((g=>{g instanceof pa&&this.addHandles(g.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))}));const k=null==T?void 0:T.type,{sketchOptions:$}=this;this._meshTooltipInfo=new Mp({viewType:k,sketchOptions:$}),this._pointTooltipInfo=new wp({viewType:k,sketchOptions:$});const K={object:O,dxScreen:0,dyScreen:0},J={onMoveStart:()=>{this._emitRecordUndo(),S.emit("translate-start",{...K})},onMove:()=>S.emit("translate",{...K}),onMoveStop:()=>S.emit("translate-stop",{...K}),onRotateStart:g=>{this._emitRecordUndo(),S.emit("rotate-start",{object:O,angle:g})},onRotate:g=>S.emit("rotate",{object:O,angle:g}),onRotateStop:g=>S.emit("rotate-stop",{object:O,angle:g}),onScaleStart:(g,_)=>{this._emitRecordUndo(),S.emit("scale-start",{object:O,xScale:g,yScale:_})},onScale:(g,_)=>S.emit("scale",{object:O,xScale:g,yScale:_}),onScaleStop:(g,_)=>S.emit("scale-stop",{object:O,xScale:g,yScale:_})};this.addHandles(m$1(this.tooltip,this.object,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:J})))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=ki(this._scaleRotate),this._scaleRotateAdapter=ki(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(g){if(!this.destroyed&&!G$1(g,this.tooltip))return super.onInputEvent(g)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){var g,_,S,O;const T=ca(this.object);return"mesh"===(null==T?void 0:T.type)?new cp({object:this.object,geometry:T,viewingMode:this.view.state.viewingMode}):new up({graphic:this.object.graphic,sizeFilter:g=>this._enforceNonZeroSize(g),findLayerView:()=>this.view.allLayerViews.find((g=>{var _;return g.layer===(null==(_=this.object.graphic)?void 0:_.layer)})),sizeAxis:(null==(O=null==(S=null==(_=null==(g=this.sketchOptions)?void 0:g.tooltips)?void 0:_.visualVariables)?void 0:S.size)?void 0:O.axis)??null})}_forEachManipulator(g){var _,S;null==(_=this._moveManipulation)||_.forEachManipulator(g),null==(S=this._scaleRotate)||S.forEachManipulator(g)}_hideManipulatorsForObjectState(){return C((()=>this.object.visible),(g=>{this._forEachManipulator((_=>_.available=g)),this._moveManipulation.zManipulation.available=g&&this.enableZ&&za(this.object.operations,this.object.elevationInfo)}))}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(g){this._moveManipulation&&(this._moveManipulation.snapToScene=g),this._set("snapToScene",g)}get updating(){var g;return this._updatingHandles.updating||!!(null==(g=this._scaleRotate)?void 0:g.updating)}get activeTooltipInfo(){var g,_,S;return null!=(null==(_=null==(g=this._scaleRotate)?void 0:g.tooltip)?void 0:_.info)?null:"mesh"===(null==(S=ca(this.object))?void 0:S.type)?this._meshTooltipInfo:this._pointTooltipInfo}set location(g){this._moveManipulation.location=g,this._scaleRotate&&(this._scaleRotate.location=g)}set elevationAlignedLocation(g){this._moveManipulation.elevationAlignedLocation=g,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=g)}reset(){}onHide(){var g;null==(g=this._scaleRotate)||g.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:g}=this,_=g.state.viewingMode===ji.Local||g.scale<ws;this._moveManipulation.angle=_?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){ya(this,this.object)}_enforceNonZeroSize(g){return g||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};g([_({constructOnly:!0,nonNullable:!0})],xp.prototype,"view",void 0),g([_({constructOnly:!0,nonNullable:!0})],xp.prototype,"object",void 0),g([_({constructOnly:!0,nonNullable:!0})],xp.prototype,"enableZ",void 0),g([_()],xp.prototype,"enableRotation",void 0),g([_()],xp.prototype,"enableScaling",void 0),g([_({constructOnly:!0,type:El})],xp.prototype,"sketchOptions",void 0),g([_({value:!1})],xp.prototype,"snapToScene",null),g([_({constructOnly:!0})],xp.prototype,"snappingManager",void 0),g([_({readOnly:!0})],xp.prototype,"type",void 0),g([_({readOnly:!0})],xp.prototype,"updating",null),g([_()],xp.prototype,"activeTooltipInfo",null),xp=g([S("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],xp);class b{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(g,_){this._tool=g,this._bounds=_,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const S=this._tool,O=S.view;this.moveXYObjectManipulation=new Nc({view:O,tool:S,object:this._object}),S.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Ya(O,Xa.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Wa,S.manipulators.add(this.moveZManipulator),S.addHandles([this._createMoveZDragPipeline()]),S.addHandles([S.events.on("translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(g){this.moveXYObjectManipulation.forEachManipulator(g),g(this.moveZManipulator,Wo.TRANSLATE_Z)}updateManipulators(g,_){const S=this.moveZManipulator,O=Qn(Vn.get(),g,Math.PI);O[12]=0,O[13]=0,O[14]=0,S.modelTransform=O,S.renderLocation=fe(ct.get(),_.origin,_.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const g=this._tool,_=this._moveXYTooltipInfo??(this._moveXYTooltipInfo=new Bc({sketchOptions:g.sketchOptions}));if(this.moveXYObjectManipulation.dragging){const S=this._bounds,O=S.mapBoundsStart.origin,T=S.mapBounds.origin,{renderSpatialReference:I}=g.view;if(!I)return null;const k=Po(O,T,I);if(null==k)return null;_.distance=k}else _.distance=ai;return _}_computeMoveZTooltipInfo(){const g=this._tool,_=this._moveZTooltipInfo??(this._moveZTooltipInfo=new Xc({sketchOptions:g.sketchOptions}));if(this.moveZManipulator.dragging){const S=this._bounds,O=S.mapBoundsStart.origin,T=S.mapBounds.origin,{renderSpatialReference:I}=g.view;if(!I)return null;const k=to(O,T,I);if(null==k)return null;_.distance=k}else _.distance=ai;return _}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline(((g,_,S)=>this._applyObjectMoveSteps(_,S)))}_createMoveZDragPipeline(){if(!this._operations)return B();const g=this._operations.data.spatialReference;return ra(this.moveZManipulator,((_,S,O)=>{const T=Je(_.renderLocation),I=S.next(Ba(this._tool.view,T,g)).next(da());this._applyObjectMoveSteps(I,O)}))}_applyObjectMoveSteps(g,_){const{_tool:S,_object:O}=this,T=g.next((g=>("start"===g.action&&(S.inputState={type:"move"},this._bounds.backupMapBounds(),S.events.emit("translate-start",{object:O,dxScreen:g.screenDeltaX,dyScreen:g.screenDeltaY})),g))).next(ua()).next(this._moveDragUpdateGeometry()).next((g=>{const _={object:O,dxScreen:g.screenDeltaX,dyScreen:g.screenDeltaY};switch(g.action){case"start":case"update":(g.mapEnd.x-g.mapStart.x||g.mapEnd.y-g.mapStart.y||(g.mapEnd.z??0)-(g.mapStart.z??0))&&S.events.emit("translate",_);break;case"end":S.inputState=null,S.events.emit("translate-stop",_)}return g}));return _.next((()=>{null!=S.inputState&&S.events.emit("translate-stop",{object:O,dxScreen:0,dyScreen:0}),S.cancel()})),T}_moveDragUpdateGeometry(){const g=this._tool;return _=>{if(null==g.inputState||"move"!==g.inputState.type)return _;const S="start"===_.action?Ca.NEW_STEP:Ca.ACCUMULATE_STEPS;if(this._operations){const g=this._operations.move(_.mapDeltaX,_.mapDeltaY,_.mapDeltaZ,S);this._bounds.updateMapBoundsFromOperation(g)}return _}}}let Sp=class s5 extends sl{constructor(g){super(g),this.type="extent-rotate",this.angle=0}};g([_()],Sp.prototype,"type",void 0),g([_()],Sp.prototype,"angle",void 0),Sp=g([S("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],Sp);class M{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(g,_,S){var O;this._tool=g,this._bounds=_,this._snapRotation=S,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const T=this._tool,I=T.view,k=!(null==(O=I._stage)?void 0:O.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this.rotateManipulator=new qa(I,((g,_)=>ar(I.textures,{accentColor:g,contrastColor:_,preMultiplyAlpha:k}))),T.addHandles([this.rotateManipulator.events.on("grab-changed",(g=>this._onRotateGrab(g))),this._createRotateDragPipeline(this.rotateManipulator)]),T.manipulators.add(this.rotateManipulator),T.addHandles([T.events.on("rotate-start",(g=>this._startAngle=g.angle)),T.events.on("rotate",(g=>this._endAngle=g.angle)),T.events.on("rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(g){g(this.rotateManipulator,Wo.ROTATE)}updateManipulators(g,_){const S=this._bounds.mapBounds.plane[2]<0?Math.PI:0,O=eo(Vn.get(),g,S);O[12]=0,O[13]=0,O[14]=0,this.rotateManipulator.modelTransform=O,this.rotateManipulator.renderLocation=Dt(ct.get(),_.origin,_.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const g=this._rotateTooltipInfo??(this._rotateTooltipInfo=new Sp({sketchOptions:this._tool.sketchOptions}));return g.angle=this._startAngle-this._endAngle,g}_onRotateGrab({action:g,screenPoint:_}){const S=this._tool,O=this._bounds;if("start"!==g||!_)return;const T=Ka(O.displayBounds,S.view.renderCoordsHelper,Ja.HEADING,vn()),I=io(S.view.state.camera,_);no(T,I,ct.get())&&(O.backupMapBounds(),S.inputState={type:"rotate",rotatePlane:T})}_createRotateDragPipeline(g){const{_tool:_,_object:S}=this;return ra(g,((g,O,T)=>{const I=_.inputState;null!=I&&(O.next((g=>("start"===g.action&&_.events.emit("rotate-start",{object:S,angle:0}),g))).next(Za(_.view,I.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(I)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next((g=>{const O={object:S,angle:$n(g.rotateAngle)};switch(g.action){case"start":case"update":_.events.emit("rotate",O);break;case"end":_.inputState=null,_.events.emit("rotate-stop",O)}return g})),T.next((()=>{null!=_.inputState&&_.events.emit("rotate-stop",{object:S,angle:0}),_.cancel()})))}))}_rotateDragRenderPlaneToRotate(g){return _=>{const S=dn(g.rotatePlane),O=ba(_.renderStart,_.renderEnd,this._bounds.displayBounds.origin,S);return{..._,rotateAxis:S,rotateAngle:O}}}_rotateDragUpdateGeometry(){const g=this._bounds;return _=>{const S=Le(_t(),g.mapBoundsStart.origin),O="start"===_.action?Ca.NEW_STEP:Ca.ACCUMULATE_STEPS;if(this._operations){const T=this._operations.rotate(S,_.rotateAngle,O,$a.REPLACE);oo(g.mapBoundsStart,g.mapBounds),g.updateMapBoundsFromOperation(T)}return _}}}function T$1(g,_,S){if(g instanceof Pa){if(g.operation instanceof ja)return function V(g,_,S=!1){const O=S?-1:1,T=Tn(O*g.dx,O*g.dy,O*g.dz);Dt(_.origin,_.origin,T),so(_)}(g.operation,_,S),!0;if(g.operation instanceof Va)return function v2(g,_,S=!1){const O=S?-g.angle:g.angle;ao(_.basis1,_.basis1,ro,O),ao(_.basis2,_.basis2,ro,O),so(_)}(g.operation,_,S),!0;if(g.operation instanceof La)return function h3(g,_,S=!1){const O=S?1/g.factor1:g.factor1,T=S?1/g.factor2:g.factor2;At(_.basis1,_.basis1,O),At(_.basis2,_.basis2,T),lo(_.origin,_.origin,g.origin,g.axis1,O),lo(_.origin,_.origin,g.origin,g.axis2,T),so(_)}(g.operation,_,S),!0}return!1}class x{constructor(g,_){this._tool=g,this.mapBounds=co(),this.mapBoundsStart=co(),this.displayBounds=co(),g.addHandles($((()=>g.object),"modified-externally",(()=>this._resetMapBounds()),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=_}get displayBoundsMargin(){var g,_;const{view:S,object:O}=this._tool,T=ca(O),I=(null==(g=S.pointsOfInterest)?void 0:g.centerOnSurfaceFrequent.location)??(null==(_=null==T?void 0:T.extent)?void 0:_.center);return I?Op*S.pixelSizeAt(I):0}backupMapBounds(){oo(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){var g;this._calculateDisplayBounds(),null==(g=this._onDisplayBoundsChanged)||g.call(this)}updateMapBoundsFromOperation(g){(function d2(g,_){return T$1(g,_,!1)})(g,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(g){(function E2(g,_){return T$1(g,_,!0)})(g,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){var g;const{view:_,attachmentOrigin:S,object:O}=this._tool,T=null==(g=O.operations)?void 0:g.data;if(!T)return;const I=T.geometry;this.spatialReference=I.spatialReference;const k=function n$3(g){const _=r$3(g);return Wi(Math.cos(_),Math.sin(_))}(I);at(k,k,-1);const C=_.spatialReference,$=I.spatialReference,B=S?_.pixelSizeAt(S)*fo(C)/$e($):0;!function F2(g,_,S,O){O||(O=co());const T=ot(po.get(),g[1],-g[0]),I=ot(po.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),k=ot(po.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),C=po.get();_.components.forEach((_=>_.vertices.forEach((({pos:_})=>{ot(C,uo(g,_),uo(T,_)),ho(I,I,C),vo(k,k,C)}))));const $=1e-6,B=ot(po.get(),k[0]-I[0]<$?S/2:0,k[1]-I[1]<$?S/2:0);return go(I,I,B),lt(k,k,B),at(O.basis1,g,(k[0]-I[0])/2),at(O.basis2,T,(k[1]-I[1])/2),ot(O.origin,I[0]*g[0]+I[1]*T[0],I[0]*g[1]+I[1]*T[1]),lt(O.origin,O.origin,O.basis1),lt(O.origin,O.origin,O.basis2),so(O),O}(k,T,Tp*B,this.mapBounds)}_calculateDisplayBounds(){const{view:g,attachmentOrigin:_}=this._tool,S=(null==_?void 0:_.z)??Yi(this.mapBounds.origin,g.elevationProvider,Nt.fromElevationInfo(this._tool.object.elevationInfo),g.renderCoordsHelper),O=oo(this.mapBounds);O.origin[2]=S??0,function U(g,_,S,O=0,T){T||(T=co()),_.toRenderCoords(g.origin,S,T.origin);const I=ct.get();Dt(I,g.origin,g.basis1),Dt(I,I,g.basis2),_.toRenderCoords(I,S,I);const k=ct.get();Dt(k,g.origin,g.basis1),fe(k,k,g.basis2),_.toRenderCoords(k,S,k);const C=ct.get();fe(C,g.origin,g.basis1),fe(C,C,g.basis2),_.toRenderCoords(C,S,C);const $=ct.get();fe($,g.origin,g.basis1),Dt($,$,g.basis2),_.toRenderCoords($,S,$);const B=De(ct.get(),I,k,.5);fe(B,B,T.origin);const K=De(ct.get(),C,$,.5);fe(K,T.origin,K),De(T.basis1,B,K,.5);const J=De(ct.get(),$,I,.5);fe(J,J,T.origin);const tt=De(ct.get(),k,C,.5);fe(tt,T.origin,tt),De(T.basis2,J,tt,.5);const et=be(ct.get(),T.basis1,T.basis2),it=be(et,et,T.basis1);return _e(it,it),At(T.basis2,it,me(T.basis2,it)),At(T.basis1,T.basis1,1+O/In(T.basis1)),At(T.basis2,T.basis2,1+O/In(T.basis2)),so(T),T}(O,g.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const Op=10,Tp=80;function S$2(g,_,S){return fe(Rp,fe(Rp,g.origin,g.basis1),g.basis2),_o(kp,Rp,g.basis1,2),_o(Ip,kp,g.basis2,2),_o(Ep,Rp,g.basis2,2),Rp[2]=kp[2]=Ip[2]=Ep[2]=_,function o$1({topLeft:g,topRight:_,bottomRight:S,bottomLeft:O,spatialReference:T}){const I=mo(Po(O,S,T),Po(g,_,T));if(null==I)return null;const k=mo(Po(S,_,T),Po(O,g,T));return null==k?null:{xSize:I,ySize:k}}({topLeft:Ep,topRight:Ip,bottomRight:kp,bottomLeft:Rp,spatialReference:S})}const Ep=_t(),Ip=_t(),kp=_t(),Rp=_t();let Cp=class i13 extends sl{constructor(g){super(g),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=ai,this.ySize=ai}};g([_()],Cp.prototype,"type",void 0),g([_()],Cp.prototype,"xScale",void 0),g([_()],Cp.prototype,"yScale",void 0),g([_()],Cp.prototype,"xSize",void 0),g([_()],Cp.prototype,"ySize",void 0),Cp=g([S("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],Cp);let Dp=class j{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const g=this._operations.data;if(g.geometry.hasZ){const _=g.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const S of g.components)for(const g of S.vertices){const S=_.getZ(g.pos)??0;this._zMax=Math.max(S,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(g,_,S){this._tool=g,this._bounds=_,this._preserveAspectRatioStep=S,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=co(),this._displayBoundsMarginStart=0,this._startScale=vt(),this._endScale=vt(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const O=this._tool,T=O.view;this.resizeManipulators=this._resizeHandles.map((g=>{const _=new Qa(T,g);return O.addHandles([_.events.on("grab-changed",(g=>this._onResizeGrab(g))),this._createResizeDragPipeline(_,g)]),_})),O.manipulators.addMany(this.resizeManipulators),O.addHandles([O.events.on("scale-start",(g=>{ot(this._startScale,g.xScale,g.yScale),ot(this._endScale,g.xScale,g.yScale)})),O.events.on("scale",(g=>{ot(this._endScale,g.xScale,g.yScale)})),O.events.on("scale-stop",(()=>{ot(this._startScale,0,0),ot(this._endScale,0,0)}))]),this._operations&&O.addHandles(this._operations.data.on("change",(()=>{var g;"resize"!==(null==(g=O.inputState)?void 0:g.type)&&(this._zMaxDirty=!0)})))}destroy(){this.forEachManipulator((g=>{this._tool.manipulators.remove(g),g.destroy()}))}forEachManipulator(g){this.resizeManipulators.forEach((_=>g(_,Wo.SCALE)))}updateManipulators(g,_){this.resizeManipulators.forEach(((S,O)=>{tr(S,this._resizeHandles[O],g,_)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((g=>g.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){const g=this._tool,_=this._scaleTooltipInfo??(this._scaleTooltipInfo=new Cp({sketchOptions:g.sketchOptions})),S=S$2(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return null==S?null:(_.xSize=S.xSize,_.ySize=S.ySize,null!=this._sizeStart&&this.resizeManipulators.some((g=>g.dragging))?(_.xScale=S.xSize.value/this._sizeStart.xSize.value,_.yScale=S.ySize.value/this._sizeStart.ySize.value):(_.xScale=1,_.yScale=1),_)}_onResizeGrab({action:g,screenPoint:_}){const S=this._tool,O=this._bounds;if("start"!==g||!_)return;const T=io(S.view.state.camera,_);no(O.displayBounds.plane,T,ct.get())&&(O.backupMapBounds(),oo(O.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=O.displayBoundsMargin,this._sizeStart=S$2(O.mapBoundsStart,this.zMax,O.spatialReference),S.inputState={type:"resize"})}_createResizeDragPipeline(g,_){const{_tool:S,_object:O}=this;return ra(g,((g,T,I)=>{null!=S.inputState&&(T.next((g=>("start"===g.action&&S.events.emit("scale-start",{object:O,xScale:1,yScale:1}),g))).next(Za(S.view,this._displayBoundsStart.plane)).next((g=>({...g,handle:_}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((g=>{const _={object:O,xScale:g.factor1,yScale:g.factor2};switch(g.action){case"start":case"update":S.events.emit("scale",_);break;case"end":S.inputState=null,S.events.emit("scale-stop",_)}return g})),I.next((()=>{null!=S.inputState&&S.events.emit("scale-stop",{object:O,xScale:1,yScale:1}),S.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const g=this._bounds;return _=>{const S=this._displayBoundsStart,O=_.handle.direction,T=g.displayBoundsMargin,I=this._displayBoundsMarginStart,k=Le(ct.get(),S.origin);_o(k,k,S.basis1,-O[0]),_o(k,k,S.basis2,-O[1]);const C=fe(ct.get(),_.renderEnd,k),$=fe(ct.get(),_.renderStart,k),B=er(_.handle),K=ir(S),J=ir(g.displayBounds)/K,x2=(g,_)=>{if(0===g)return 1;let S=In(_),O=.5*g*me(_,C)/S;const k=O<0?-1:1;B&&(O+=(S-.5*g*me(_,$)/S)*k*J);const K=S<1.5*I?1:Ap;return S=Math.max(S-I,Ap),k>0&&(O-=T),k*Math.max(k*(O/S),K)};return{..._,factor1:x2(O[0],S.basis1),factor2:x2(O[1],S.basis2)}}}_resizeDragUpdateGeometry(){const g=this._bounds;return _=>{const S=Le(_t(),g.mapBoundsStart.origin);_o(S,S,g.mapBoundsStart.basis1,-_.handle.direction[0]),_o(S,S,g.mapBoundsStart.basis2,-_.handle.direction[1]);const O=ot(vt(),g.mapBoundsStart.basis1[0],g.mapBoundsStart.basis1[1]);st(O,O);const T="start"===_.action?Ca.NEW_STEP:Ca.ACCUMULATE_STEPS;if(this._operations){const I=this._operations.scale(S,O,_.factor1,_.factor2,T,$a.REPLACE);oo(g.mapBoundsStart,g.mapBounds),g.updateMapBoundsFromOperation(I)}return _}}};const Ap=1e-6;class a6{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(g){if(this._enabled!==g&&null!=this._lastDragEvent&&null!=this._next){const _={...this._lastDragEvent,action:"update"};g&&n$2(_),this._next.execute(_)}this._enabled=g}createDragEventPipelineStep(){this._lastDragEvent=null;const g=new wa;return this._next=g,[g=>(this._lastDragEvent="end"!==g.action?{...g}:null,this._enabled&&n$2(g),g),g]}get test(){}}function n$2(g){const _=er(g.handle)?Math.max(Math.abs(g.factor1),Math.abs(g.factor2)):0===g.handle.direction[0]?Math.abs(g.factor2):Math.abs(g.factor1);g.factor1=g.factor1<0?-_:_,g.factor2=g.factor2<0?-_:_}let $p=class n12{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=ht(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(g){if(this._enabled!==g&&null!=this._lastDragEvent&&null!=this._next){const _={...this._lastDragEvent,action:"update"};g&&this._adjustRotation(_),this._next.execute(_)}this._enabled=g}createDragEventPipelineStep(){this._lastDragEvent=null;const g=new wa;return this._next=g,[g=>(this._lastDragEvent="end"!==g.action?{...g}:null,this._enabled&&this._adjustRotation(g),g),g]}_adjustRotation(g){g.rotateAngle=Math.round(g.rotateAngle/this.incrementRadians)*this.incrementRadians}},Pp=class extends aa{get updating(){return!!this.object.updating}constructor(g){super(g),this.events=new xt,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new El,this._preserveAspectRatio=new a6,this._snapRotation=new $p,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:g,object:_}=this,S=this._bounds=new x(this,(()=>this._updateManipulators()));this._extentMove=new b(this,S),this._extentScale=new Dp(this,S,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new M(this,S,(()=>this._snapRotation.createDragEventPipelineStep())),this.addHandles([C((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Wo.TRANSLATE_Z))),C((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((g=>this._updateManipulatorAvailability(g,Wo.SCALE))))),C((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Wo.ROTATE)))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const O=l$4({view:g,object:_,forEachManipulator:g=>this._forEachManipulator(g),onManipulatorsChanged:()=>B()});if(null!=O){const{visualElement:g}=O;g instanceof fr&&(this._outlineVisualElement=g,this.addHandles(g.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(O)}this.addHandles([_.on("committed",(()=>this._onGeometryChanged())),C((()=>this.object.visible),(()=>this._updateAllManipulatorAvailability())),C((()=>this.object.isDraped),(()=>this._graphicDrapedChanged()),Zi),C((()=>{var _;return null==(_=g.pointsOfInterest)?void 0:_.centerOnSurfaceFrequent.location}),(()=>S.updateDisplayBounds()))]);this._forEachManipulator((g=>{this.addHandles(g.events.on("grab-changed",(()=>{this.grabbing=g.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((g,S)=>{this.addHandles(g.events.on("immediate-click",(g=>{S===Wo.TRANSLATE_XY&&this.events.emit("immediate-click",{...g,object:_}),g.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:g}=this,_=this.tooltip=new Mc({view:g}),i15=()=>{_.info=this._getUpdatedTooltipInfo()};this.addHandles([C((()=>this.sketchOptions.tooltips.effectiveEnabled),i15),this.events.on("translate-start",i15),this.events.on("translate",i15),this.events.on("translate-stop",(()=>this.tooltip.clear())),this.events.on("rotate-start",i15),this.events.on("rotate",i15),this.events.on("rotate-stop",i15),this.events.on("scale-start",i15),this.events.on("scale",i15),this.events.on("scale-stop",i15)]),this._forEachManipulator((g=>{this.addHandles([g.events.on("focus-changed",i15),g.events.on("grab-changed",i15),g.events.on("drag",(g=>{"cancel"===g.action?this.tooltip.clear():i15()}))])}))}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(jp),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(g=>{null!=this._attachmentOrigin&&ln(g.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),jp)}_updateManipulators(){if(!this.visible)return;const g=this._bounds.displayBounds,_=nr(g,Vn.get());this._extentMove.updateManipulators(_,g),this._extentScale.updateManipulators(_,g),this._extentRotate.updateManipulators(_,g)}_updateAllManipulatorAvailability(){this._forEachManipulator(((g,_)=>this._updateManipulatorAvailability(g,_)))}_updateManipulatorAvailability(g,_){const S=this.grabbing&&!g.grabbing;if(g.interactive=!S,g instanceof pa){const O=this.object.visible,T=this.enableZ&&za(this.object.operations,this.object.elevationInfo);switch(_){case Wo.ROTATE:g.available=O&&this.enableRotation;break;case Wo.SCALE:g.available=O&&(this.enableScaling||this.enableRotation||T),g.interactive=!S&&this.enableScaling,g.state=this.enableScaling?or:sr;break;case Wo.TRANSLATE_Z:g.available=O&&T;break;default:g.available=O}}}_forEachManipulator(g){this._extentMove.forEachManipulator(g),this._extentScale.forEachManipulator(g),this._extentRotate.forEachManipulator(g)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(g){this._preserveAspectRatio.enabled=g,this._set("preserveAspectRatio",g)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(g){this._snapRotation.enabled=g,this._set("snapRotation",g)}get attachmentOrigin(){var g,_,S;const O=this.object.isDraped?null:null==(g=this._outlineVisualElement)?void 0:g.attachmentOrigin;return this._attachmentOrigin=O??this.object.origin??(null==(S=null==(_=ca(this.object))?void 0:_.extent)?void 0:S.center),this._attachmentOrigin}reset(){}cancel(){var g;if(this.canUndo){const _=null==(g=this.object.operations)?void 0:g.undo();_&&this._bounds.updateMapBoundsFromOperationInverse(_)}this.inputState=null}get canUndo(){var g;return!!(null==(g=this.object.operations)?void 0:g.canUndo)}undo(){var g;if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const _=null==(g=this.object.operations)?void 0:g.undo();_&&this._bounds.updateMapBoundsFromOperationInverse(_)}}get canRedo(){var g;return!!(null==(g=this.object.operations)?void 0:g.canRedo)}redo(){var g;if(this.canRedo){const _=null==(g=this.object.operations)?void 0:g.redo();_&&this._bounds.updateMapBoundsFromOperation(_)}}get test(){}};g([_()],Pp.prototype,"updating",null),g([_({constructOnly:!0,nonNullable:!0})],Pp.prototype,"view",void 0),g([_({constructOnly:!0,nonNullable:!0})],Pp.prototype,"object",void 0),g([_()],Pp.prototype,"enableZ",void 0),g([_()],Pp.prototype,"enableScaling",void 0),g([_()],Pp.prototype,"enableRotation",void 0),g([_({constructOnly:!0,type:El})],Pp.prototype,"sketchOptions",void 0),g([_()],Pp.prototype,"preserveAspectRatio",null),g([_()],Pp.prototype,"snapRotation",null),g([_()],Pp.prototype,"grabbing",void 0),g([_()],Pp.prototype,"inputState",void 0),g([_({readOnly:!0})],Pp.prototype,"type",void 0),g([_()],Pp.prototype,"tooltip",void 0),Pp=g([S("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],Pp);const jp="draped-elevation-changes";function r4(g){return null!=g&&"mesh"===g.type?function o(g){return Ke(g.vertexSpace)?function i14(g,_,S){let O=null==_?void 0:_.clone(),T=Je(S.origin),I=null,k=null;return{undo:()=>{var _;I=null==(_=g.transform)?void 0:_.clone(),k=Je(S.origin),g.transform=O,g.vertexSpace.origin=T},redo:()=>{var _;O=null==(_=g.transform)?void 0:_.clone(),T=Je(S.origin),g.transform=I,g.vertexSpace.origin=k}}}(g,g.transform,g.vertexSpace):function l$1(g){let _,S=g.vertexAttributes.clonePositional();return{undo:()=>{_=g.vertexAttributes.clonePositional(),g.vertexAttributes=S},redo:()=>{S=g.vertexAttributes.clonePositional(),g.vertexAttributes=_}}}(g)}(g):function n13(g){let _=g,S=null;return{undo(g){S=g.geometry,g.geometry=_},redo(g){_=g.geometry,g.geometry=S}}}(g)}let Vp=class extends O{set graphic(g){this._circleCollisionCache=null,this._originalSymbol=g.symbol,this._set("graphic",g),this.attachSymbolChanged()}get elevationInfo(){const{layer:g}=this.graphic,_=g&&"elevationInfo"in g?g.elevationInfo:null,S=bo(this.graphic),O=_?_.offset:0;return new Zt({mode:S,offset:O})}set focusedSymbol(g){g!==this._get("focusedSymbol")&&(this._set("focusedSymbol",g),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(g){g!==this._get("grabbing")&&(this._set("grabbing",g),this._updateGraphicSymbol())}set hovering(g){g!==this._get("hovering")&&(this._set("hovering",g),this._updateGraphicSymbol())}set selected(g){g!==this._get("selected")&&(this._set("selected",g),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:g?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(g){super(g),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new xt.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(g){const _=this.graphic;if(!1===_.visible)return null;const S=_.geometry;if(null==S)return null;const O=this._get("focusedSymbol"),T=null!=O?O:_.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,g,S,T):this._intersectDistance3D(this.view,g,_)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=C((()=>{var g;return null==(g=this.graphic)?void 0:g.symbol}),(g=>{null!=g&&g!==this.focusedSymbol&&g!==this._originalSymbol&&(this._originalSymbol=g,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),Ki)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(g,_,S,O){var T,I;if(null==(O=O||Mo(S)))return null;let k=this._circleCollisionCache;if("point"===S.type&&"cim"===O.type&&"CIMPointSymbol"===(null==(T=O.data.symbol)?void 0:T.type)&&O.data.symbol.symbolLayers){const{offsetX:T,offsetY:I,size:k}=function s6(g){let _=0,S=0,O=0;return g?("cim"===g.type&&g.data.symbol&&"symbolLayers"in g.data.symbol&&g.data.symbol.symbolLayers&&g.data.symbol.symbolLayers.map((g=>{"CIMVectorMarker"===g.type&&g.anchorPoint&&(Math.abs(g.anchorPoint.x)>_&&(_=g.anchorPoint.x),Math.abs(g.anchorPoint.y)>S&&(S=g.anchorPoint.y),null!=g.size&&g.size>O&&(O=g.size))})),_=yo(_),S=yo(S),O=yo(O),{offsetX:_,offsetY:S,size:O}):{offsetX:_,offsetY:S,size:O}}(O),C=wo(_,zp),$=k/2,B=g.toScreen(S),K=B.x+T,J=B.y+I;return nt(C,[K,J])<$*$?1:null}if("point"!==S.type||"simple-marker"!==O.type)return rr(_,S,g)?1:null;if(null==k||!k.originalPoint.equals(S)){const _=S,T=g.spatialReference;if(xo(_.spatialReference,T)){const g=So(_,T);k={originalPoint:_.clone(),mapPoint:g,radiusPx:yo(O.size)},this._circleCollisionCache=k}}if(null!=k){const S=wo(_,zp),T=null==(I=g.toScreen)?void 0:I.call(g,k.mapPoint);if(!T)return null;const C=k.radiusPx,$=T.x+yo(O.xoffset),B=T.y-yo(O.yoffset);return nt(S,[$,B])<C*C?1:null}return null}_intersectDistance3D(g,_,S){const O=g.toMap(_,{include:[S]});return O&&rn(O,Lp,g.renderSpatialReference)?Oo(Lp,g.state.camera.eye):null}};g([_({constructOnly:!0,nonNullable:!0})],Vp.prototype,"graphic",null),g([_()],Vp.prototype,"elevationInfo",null),g([_({constructOnly:!0,nonNullable:!0})],Vp.prototype,"view",void 0),g([_({value:null})],Vp.prototype,"focusedSymbol",null),g([_({constructOnly:!0})],Vp.prototype,"layer",void 0),g([_()],Vp.prototype,"interactive",void 0),g([_()],Vp.prototype,"selectable",void 0),g([_()],Vp.prototype,"grabbable",void 0),g([_({value:!1})],Vp.prototype,"grabbing",null),g([_()],Vp.prototype,"dragging",void 0),g([_()],Vp.prototype,"hovering",null),g([_({value:!1})],Vp.prototype,"selected",null),g([_()],Vp.prototype,"cursor",void 0),Vp=g([S("esri.views.interactive.GraphicManipulator")],Vp);const Lp=_t(),zp=ft(),Hp=Symbol();let Up=class extends xt.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return Pe(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return xa(this.view,this.graphic)}constructor(g){super(g),this._updatingHandles=new Xt}destroy(){this._operations=ki(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new br({graphic:this.graphic}),this._graphicState.on("changed",(()=>this.emit("committed"))),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add((()=>this.graphic.geometry),(g=>{var _,S;if(g!==(null==(_=this._operations)?void 0:_.data.geometry)){if(!g||"multipoint"===(null==g?void 0:g.type)||"extent"===(null==g?void 0:g.type))return ki(this._operations),this.removeHandles(Hp),void(this._operations=null);if(null==(S=this._operations)?void 0:S.trySetGeometry(g))this.emit("modified-externally");else{ki(this._operations),this.removeHandles(Hp);const _=Ia.fromGeometry(g,this.view.state.viewingMode);this._operations=_,this.addHandles(_.data.on("change",(()=>this.graphic.geometry=_.data.geometry)),Hp)}}}),Zi))}createManipulator(g){return new Vp({view:this.view,graphic:this.graphic,...g})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const g=this.graphic.geometry;"mesh"===(null==g?void 0:g.type)&&this.graphic.notifyMeshTransformChanged({action:bt.UpdateFastLocalOrigin})}toMap(g){return this.view.toMap(g,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:g}}=this;return r4(g)}};g([_({constructOnly:!0})],Up.prototype,"view",void 0),g([_({constructOnly:!0})],Up.prototype,"graphic",void 0),g([_()],Up.prototype,"_operations",void 0),g([_()],Up.prototype,"operations",null),g([_()],Up.prototype,"updating",null),Up=g([S("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],Up);export{Ac as DrawGraphicTool3D,Pp as ExtentTransformTool,Up as ManipulatedObject3DGraphic,Kc as MoveTool3D,lp as ReshapeTool3D,xp as TransformTool3D};
